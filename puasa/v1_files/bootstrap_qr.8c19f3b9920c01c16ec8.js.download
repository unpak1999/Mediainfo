/*! Copyright (c) 2022 WhatsApp Inc. All Rights Reserved. */
(self.webpackChunkwhatsapp_web_client=self.webpackChunkwhatsapp_web_client||[]).push([[9209],{63509:(e,t,n)=>{var r={"./f00.png":31213,"./f01.png":8750,"./f02.png":48738,"./f03.png":15494,"./f04.png":15885,"./f05.png":5851,"./f06.png":68540,"./f07.png":30293,"./f08.png":91131,"./f09.png":27879,"./f10.png":8610,"./f11.png":32641,"./f12.png":98479,"./f13.png":25670,"./f14.png":759,"./f15.png":52264,"./f16.png":86035,"./f17.png":94878,"./f18.png":67514,"./f19.png":23533,"./f20.png":86319,"./f21.png":65664,"./f22.png":10191,"./f23.png":48850,"./f24.png":92553,"./f25.png":53453,"./f26.png":78691,"./f27.png":17430,"./f28.png":40610,"./f29.png":78643,"./f30.png":73434,"./f31.png":54981,"./f32.png":86488,"./f33.png":28881,"./f34.png":71199,"./f35.png":97836,"./f36.png":77985,"./f37.png":73570,"./f38.png":42949,"./f39.png":21404,"./f40.png":21792,"./f41.png":86197,"./f42.png":79685,"./f43.png":39346,"./f44.png":89128,"./f45.png":86904,"./f46.png":86906,"./f47.png":63265,"./f48.png":7029,"./f49.png":39871,"./f50.png":58360,"./f51.png":35277,"./f52.png":63418,"./f53.png":58235,"./f54.png":132,"./f55.png":33417,"./f56.png":50407,"./f57.png":29423,"./f58.png":32176,"./f59.png":50874,"./f60.png":21578,"./f61.png":22129,"./f62.png":33819,"./f63.png":97359,"./f64.png":39887,"./f65.png":38275,"./f66.png":71673,"./f67.png":21264,"./f68.png":96007,"./f69.png":59163,"./f70.png":91732,"./f71.png":3913,"./f72.png":92293,"./f73.png":51577,"./f74.png":26347,"./f75.png":70345,"./f76.png":60318,"./f77.png":86426,"./f78.png":62002,"./f79.png":49889,"./f80.png":24324,"./f81.png":59354,"./f82.png":74992,"./f83.png":80502,"./f84.png":74260,"./f85.png":64108,"./f86.png":71042,"./f87.png":95563,"./f88.png":64594,"./f89.png":68005,"./f90.png":16888,"./f91.png":52943,"./f92.png":24613,"./f93.png":94922,"./f94.png":18725,"./f95.png":82950,"./f96.png":7251,"./f97.png":17978,"./f98.png":86273,"./f99.png":31666,"./favicon-error.png":10331,"./favicon-error2.png":72174,"./favicon.png":68431};function i(e){var t=a(e);return n(t)}function a(e){if(!n.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}i.keys=function(){return Object.keys(r)},i.resolve=a,e.exports=i,i.id=63509},76554:(e,t,n)=>{var r={"./f00.png":95203,"./f01.png":66574,"./f02.png":19833,"./f03.png":39974,"./f04.png":86727,"./f05.png":78808,"./f06.png":71258,"./f07.png":64497,"./f08.png":66114,"./f09.png":12430,"./f10.png":29809,"./f11.png":41191,"./f12.png":87642,"./f13.png":26841,"./f14.png":7967,"./f15.png":38817,"./f16.png":65587,"./f17.png":38297,"./f18.png":61665,"./f19.png":16962,"./f20.png":42387,"./f21.png":74420,"./f22.png":84319,"./f23.png":43302,"./f24.png":34444,"./f25.png":14231,"./f26.png":15842,"./f27.png":25925,"./f28.png":10149,"./f29.png":90154,"./f30.png":701,"./f31.png":27707,"./f32.png":95169,"./f33.png":77763,"./f34.png":98593,"./f35.png":16569,"./f36.png":35807,"./f37.png":82439,"./f38.png":41360,"./f39.png":93127,"./f40.png":62369,"./f41.png":55876,"./f42.png":31990,"./f43.png":36009,"./f44.png":24580,"./f45.png":61400,"./f46.png":78354,"./f47.png":27020,"./f48.png":27961,"./f49.png":8725,"./f50.png":25129,"./f51.png":33690,"./f52.png":15722,"./f53.png":94416,"./f54.png":59965,"./f55.png":97937,"./f56.png":91425,"./f57.png":40564,"./f58.png":35705,"./f59.png":1474,"./f60.png":5285,"./f61.png":60792,"./f62.png":1219,"./f63.png":66899,"./f64.png":14772,"./f65.png":61160,"./f66.png":26671,"./f67.png":18327,"./f68.png":8659,"./f69.png":80157,"./f70.png":14440,"./f71.png":90805,"./f72.png":39619,"./f73.png":30472,"./f74.png":60325,"./f75.png":59019,"./f76.png":69536,"./f77.png":71717,"./f78.png":35033,"./f79.png":62003,"./f80.png":65263,"./f81.png":39681,"./f82.png":61422,"./f83.png":50966,"./f84.png":60408,"./f85.png":69738,"./f86.png":87724,"./f87.png":93370,"./f88.png":63963,"./f89.png":13976,"./f90.png":26034,"./f91.png":41727,"./f92.png":54257,"./f93.png":61109,"./f94.png":2801,"./f95.png":11318,"./f96.png":25889,"./f97.png":30341,"./f98.png":51222,"./f99.png":53279,"./favicon-error.png":81740,"./favicon-error2.png":5079,"./favicon.png":49420};function i(e){var t=a(e);return n(t)}function a(e){if(!n.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}i.keys=function(){return Object.keys(r)},i.resolve=a,e.exports=i,i.id=76554},23098:module=>{var e={},aa={},l;for(l in e)e.hasOwnProperty(l)&&(aa[l]=e[l]);function ba(e){eval.call(null,e)}for(l in e.read=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},"undefined"!=typeof arguments&&(e.arguments=arguments),"undefined"!=typeof console?(e.print||(e.print=function(e){console.log(e)}),e.printErr||(e.printErr=function(e){console.log(e)})):e.print||(e.print=function(){}),void 0===e.setWindowTitle&&(e.setWindowTitle=function(e){document.title=e}),!e.load&&e.read&&(e.load=function(t){ba(e.read(t))}),e.print||(e.print=function(){}),e.printErr||(e.printErr=e.print),e.arguments||(e.arguments=[]),e.thisProgram||(e.thisProgram="./this.program"),e.print=e.print,e.S=e.printErr,e.preRun=[],e.postRun=[],aa)aa.hasOwnProperty(l)&&(e[l]=aa[l]);var n={cb:function(e){ca=e},Ua:function(){return ca},na:function(){return m},X:function(e){m=e},Aa:function(e){switch(e){case"i1":case"i8":return 1;case"i16":return 2;case"i32":return 4;case"i64":return 8;case"float":return 4;case"double":return 8;default:return"*"===e[e.length-1]?n.H:"i"===e[0]?(assert(0==(e=parseInt(e.substr(1)))%8),e/8):0}},Ta:function(e){return Math.max(n.Aa(e),n.H)},dd:16,Bd:function(e,t){return"double"===t||"i64"===t?7&e&&(assert(4==(7&e)),e+=4):assert(0==(3&e)),e},od:function(e,t,r){return r||"i64"!=e&&"double"!=e?e?Math.min(t||(e?n.Ta(e):0),n.H):Math.min(t,8):8},J:function(t,n,r){return r&&r.length?(r.splice||(r=Array.prototype.slice.call(r)),r.splice(0,0,n),e["dynCall_"+t].apply(null,r)):e["dynCall_"+t].call(null,n)},U:[],Ma:function(e){for(var t=0;t<n.U.length;t++)if(!n.U[t])return n.U[t]=e,2*(1+t);throw"Finished up all reserved function pointers. Use a higher value for RESERVED_FUNCTION_POINTERS."},$a:function(e){n.U[(e-2)/2]=null},M:function(t){n.M.ma||(n.M.ma={}),n.M.ma[t]||(n.M.ma[t]=1,e.S(t))},ha:{},rd:function(e,t){assert(t),n.ha[t]||(n.ha[t]={});var r=n.ha[t];return r[e]||(r[e]=function(){return n.J(t,e,arguments)}),r[e]},pd:function(){throw"You must build with -s RETAIN_COMPILER_SETTINGS=1 for Runtime.getCompilerSetting or emscripten_get_compiler_setting to work"},W:function(e){var t=m;return m=(m=m+e|0)+15&-16,t},Ia:function(e){var t=p;return p=(p=p+e|0)+15&-16,t},P:function(e){var t=v;return(e=(v=(v=v+e|0)+15&-16)>=w)&&(z("Cannot enlarge memory arrays. Either (1) compile with  -s TOTAL_MEMORY=X  with X higher than the current value "+w+", (2) compile with  -s ALLOW_MEMORY_GROWTH=1  which adjusts the size at runtime but prevents some optimizations, (3) set Module.TOTAL_MEMORY to a higher value before the program runs, or if you want malloc to return NULL (0) instead of this abort, compile with  -s ABORTING_MALLOC=0 "),e=!0),e?(v=t,0):t},ea:function(e,t){return Math.ceil(e/(t||16))*(t||16)},xd:function(e,t,n){return n?+(e>>>0)+4294967296*+(t>>>0):+(e>>>0)+4294967296*+(0|t)},La:8,H:4,ed:0};e.Runtime=n,n.addFunction=n.Ma,n.removeFunction=n.$a;var A=!1,da,fa,ca,ha,ia,buffer;function assert(e,t){e||z("Assertion failed: "+t)}function ga(a){var b=e["_"+a];if(!b)try{b=eval("_"+a)}catch(e){}return assert(b,"Cannot call unknown function "+a+" (perhaps LLVM optimizations or closure removed it?)"),b}function ma(e,t,n){switch("*"===(n=n||"i8").charAt(n.length-1)&&(n="i32"),n){case"i1":case"i8":D[e>>0]=t;break;case"i16":E[e>>1]=t;break;case"i32":F[e>>2]=t;break;case"i64":fa=[t>>>0,(da=t,1<=+na(da)?0<da?(0|oa(+pa(da/4294967296),4294967295))>>>0:~~+qa((da-+(~~da>>>0))/4294967296)>>>0:0)],F[e>>2]=fa[0],F[e+4>>2]=fa[1];break;case"float":ra[e>>2]=t;break;case"double":sa[e>>3]=t;break;default:z("invalid type for setValue: "+n)}}function ta(e,t){switch("*"===(t=t||"i8").charAt(t.length-1)&&(t="i32"),t){case"i1":case"i8":return D[e>>0];case"i16":return E[e>>1];case"i32":case"i64":return F[e>>2];case"float":return ra[e>>2];case"double":return sa[e>>3];default:z("invalid type for setValue: "+t)}return null}function G(e,t,r,i){var a,o;"number"==typeof e?(a=!0,o=e):(a=!1,o=e.length);var s,l,c="string"==typeof t?t:null;if(r=4==r?i:[ua,n.W,n.Ia,n.P][void 0===r?2:r](Math.max(o,c?1:t.length)),a){for(i=r,assert(0==(3&r)),e=r+(-4&o);i<e;i+=4)F[i>>2]=0;for(e=r+o;i<e;)D[i++>>0]=0;return r}if("i8"===c)return e.subarray||e.slice?H.set(e,r):H.set(new Uint8Array(e),r),r;for(i=0;i<o;){var d=e[i];"function"==typeof d&&(d=n.sd(d)),0===(a=c||t[i])?i++:("i64"==a&&(a="i32"),ma(r+i,d,a),l!==a&&(s=n.Aa(a),l=a),i+=s)}return r}function la(t,n){if(0===n||!t)return"";for(var r,i=0,a=0;(i|=r=H[t+a>>0],0!=r||n)&&(a++,!n||a!=n););if(n||(n=a),r="",128>i){for(;0<n;)i=String.fromCharCode.apply(String,H.subarray(t,t+Math.min(n,1024))),r=r?r+i:i,t+=1024,n-=1024;return r}return e.UTF8ToString(t)}function za(e,t){for(var n,r,i,a,o,s="";;){if(!(n=e[t++]))return s;128&n?(r=63&e[t++],192==(224&n)?s+=String.fromCharCode((31&n)<<6|r):(i=63&e[t++],224==(240&n)?n=(15&n)<<12|r<<6|i:(a=63&e[t++],240==(248&n)?n=(7&n)<<18|r<<12|i<<6|a:(o=63&e[t++],248==(252&n)?n=(3&n)<<24|r<<18|i<<12|a<<6|o:n=(1&n)<<30|r<<24|i<<18|a<<12|o<<6|63&e[t++])),65536>n?s+=String.fromCharCode(n):(n-=65536,s+=String.fromCharCode(55296|n>>10,56320|1023&n)))):s+=String.fromCharCode(n)}}function Aa(e,t,n,r){if(!(0<r))return 0;var i=n;r=n+r-1;for(var a=0;a<e.length;++a){var o=e.charCodeAt(a);if(55296<=o&&57343>=o&&(o=65536+((1023&o)<<10)|1023&e.charCodeAt(++a)),127>=o){if(n>=r)break;t[n++]=o}else{if(2047>=o){if(n+1>=r)break;t[n++]=192|o>>6}else{if(65535>=o){if(n+2>=r)break;t[n++]=224|o>>12}else{if(2097151>=o){if(n+3>=r)break;t[n++]=240|o>>18}else{if(67108863>=o){if(n+4>=r)break;t[n++]=248|o>>24}else{if(n+5>=r)break;t[n++]=252|o>>30,t[n++]=128|o>>24&63}t[n++]=128|o>>18&63}t[n++]=128|o>>12&63}t[n++]=128|o>>6&63}t[n++]=128|63&o}}return t[n]=0,n-i}function Ba(e){for(var t=0,n=0;n<e.length;++n){var r=e.charCodeAt(n);55296<=r&&57343>=r&&(r=65536+((1023&r)<<10)|1023&e.charCodeAt(++n)),127>=r?++t:t=2047>=r?t+2:65535>=r?t+3:2097151>=r?t+4:67108863>=r?t+5:t+6}return t}function Ca(t){var r=!!e.___cxa_demangle;if(r)try{var i=ua(t.length);ka(t.substr(1),i);var a=ua(4),o=e.___cxa_demangle(i,0,0,a);if(0===ta(a,"i32")&&o)return la(o)}catch(e){}finally{i&&Da(i),a&&Da(a),o&&Da(o)}var s=3,l={v:"void",b:"bool",c:"char",s:"short",i:"int",l:"long",f:"float",d:"double",w:"wchar_t",a:"signed char",h:"unsigned char",t:"unsigned short",j:"unsigned int",m:"unsigned long",x:"long long",y:"unsigned long long",z:"..."},c=[],d=!0;i=t;try{if("Object._main"==t||"_main"==t)return"main()";if("number"==typeof t&&(t=la(t)),"_"!==t[0]||"_"!==t[1]||"Z"!==t[2])return t;switch(t[3]){case"n":return"operator new()";case"d":return"operator delete()"}i=function e(n,r,i){r=r||1/0;var a,o="",u=[];if("N"===t[s]){for(s++,"K"===t[s]&&s++,a=[];"E"!==t[s];)if("S"===t[s]){s++;var p=t.indexOf("_",s);a.push(c[t.substring(s,p)||0]||"?"),s=p+1}else if("C"===t[s])a.push(a[a.length-1]),s+=2;else{var f=(p=parseInt(t.substr(s))).toString().length;if(!p||!f){s--;break}var h=t.substr(s+f,p);a.push(h),c.push(h),s+=f+p}if(s++,a=a.join("::"),0==--r)return n?[a]:a}else("K"===t[s]||d&&"L"===t[s])&&s++,(p=parseInt(t.substr(s)))&&(f=p.toString().length,a=t.substr(s+f,p),s+=f+p);d=!1,"I"===t[s]?(s++,p=e(!0),o+=(f=e(!0,1,!0))[0]+" "+a+"<"+p.join(", ")+">"):o=a;e:for(;s<t.length&&0<r--;)if(a=t[s++],a in l)u.push(l[a]);else switch(a){case"P":u.push(e(!0,1,!0)[0]+"*");break;case"R":u.push(e(!0,1,!0)[0]+"&");break;case"L":s++,p=t.indexOf("E",s)-s,u.push(t.substr(s,p)),s+=p+2;break;case"A":if(p=parseInt(t.substr(s)),s+=p.toString().length,"_"!==t[s])throw"?";s++,u.push(e(!0,1,!0)[0]+" ["+p+"]");break;case"E":break e;default:o+="?"+a;break e}return i||1!==u.length||"void"!==u[0]||(u=[]),n?(o&&u.push(o+"?"),u):o+"("+u.join(", ")+")"}()}catch(e){i+="?"}return 0<=i.indexOf("?")&&!r&&n.M("warning: a problem occurred in builtin C++ name demangling; build with  -s DEMANGLE_SUPPORT=1  to link in libcxxabi demangling"),i}function Ea(){return Fa().replace(/__Z[\w\d_]+/g,(function(e){var t=Ca(e);return e===t?e:e+" ["+t+"]"}))}function Fa(){var e=Error();if(!e.stack){try{throw Error(0)}catch(t){e=t}if(!e.stack)return"(no stack trace available)"}return e.stack.toString()}function Ga(){var e=v;return 0<e%4096&&(e+=4096-e%4096),e}(function(){function a(e){return{arguments:(e=e.toString().match(d).slice(1))[0],body:e[1],returnValue:e[2]}}var b={stackSave:function(){n.na()},stackRestore:function(){n.X()},arrayToC:function(e){var t=n.W(e.length);return ja(e,t),t},stringToC:function(e){var t=0;return null!=e&&0!==e&&ka(e,t=n.W(1+(e.length<<2))),t}},c={string:b.stringToC,array:b.arrayToC};ia=function(e,t,r,i,a){e=ga(e);var o=[],s=0;if(i)for(var l=0;l<i.length;l++){var d=c[r[l]];d?(0===s&&(s=n.na()),o[l]=d(i[l])):o[l]=i[l]}if(r=e.apply(null,o),"string"===t&&(r=la(r)),0!==s){if(a&&a.async)return void EmterpreterAsync.hd.push((function(){n.X(s)}));n.X(s)}return r};var d=/^function\s*\(([^)]*)\)\s*{\s*([^*]*?)[\s;]*(?:return\s*(.*?)[;\s]*)?}$/,f={},h;for(h in b)b.hasOwnProperty(h)&&(f[h]=a(b[h]));ha=function(b,c,d){d=d||[];var h=ga(b);b=d.every((function(e){return"number"===e}));var u="string"!==c;if(u&&b)return h;var q=d.map((function(e,t){return"$"+t}));c="(function("+q.join(",")+") {";var y=d.length;if(!b){c+="var stack = "+f.stackSave.body+";";for(var B=0;B<y;B++){var J=q[B],ea=d[B];"number"!==ea&&(ea=f[ea+"ToC"],c+="var "+ea.arguments+" = "+J+";",c+=ea.body+";",c+=J+"="+ea.returnValue+";")}}return d=a((function(){return h})).returnValue,c+="var ret = "+d+"("+q.join(",")+");",u||(d=a((function(){return la})).returnValue,c+="ret = "+d+"(ret);"),b||(c+=f.stackRestore.body.replace("()","(stack)")+";"),eval(c+"return ret})")}})(),e.ccall=ia,e.cwrap=ha,e.setValue=ma,e.getValue=ta,e.ALLOC_NORMAL=0,e.ALLOC_STACK=1,e.ALLOC_STATIC=2,e.ALLOC_DYNAMIC=3,e.ALLOC_NONE=4,e.allocate=G,e.getMemory=function(e){return va?void 0!==wa&&!wa.C||!xa?n.P(e):ua(e):n.Ia(e)},e.Pointer_stringify=la,e.AsciiToString=function(e){for(var t="";;){var n=D[e++>>0];if(!n)return t;t+=String.fromCharCode(n)}},e.stringToAscii=function(e,t){return ya(e,t,!1)},e.UTF8ArrayToString=za,e.UTF8ToString=function(e){return za(H,e)},e.stringToUTF8Array=Aa,e.stringToUTF8=function(e,t,n){return Aa(e,H,t,n)},e.lengthBytesUTF8=Ba,e.UTF16ToString=function(e){for(var t=0,n="";;){var r=E[e+2*t>>1];if(0==r)return n;++t,n+=String.fromCharCode(r)}},e.stringToUTF16=function(e,t,n){if(void 0===n&&(n=2147483647),2>n)return 0;var r=t;n=(n-=2)<2*e.length?n/2:e.length;for(var i=0;i<n;++i)E[t>>1]=e.charCodeAt(i),t+=2;return E[t>>1]=0,t-r},e.lengthBytesUTF16=function(e){return 2*e.length},e.UTF32ToString=function(e){for(var t=0,n="";;){var r=F[e+4*t>>2];if(0==r)return n;++t,65536<=r?(r-=65536,n+=String.fromCharCode(55296|r>>10,56320|1023&r)):n+=String.fromCharCode(r)}},e.stringToUTF32=function(e,t,n){if(void 0===n&&(n=2147483647),4>n)return 0;var r=t;n=r+n-4;for(var i=0;i<e.length;++i){if(55296<=(a=e.charCodeAt(i))&&57343>=a)var a=65536+((1023&a)<<10)|1023&e.charCodeAt(++i);if(F[t>>2]=a,(t+=4)+4>n)break}return F[t>>2]=0,t-r},e.lengthBytesUTF32=function(e){for(var t=0,n=0;n<e.length;++n){var r=e.charCodeAt(n);55296<=r&&57343>=r&&++n,t+=4}return t},e.stackTrace=function(){return Ea()};for(var D,H,E,Ha,F,Ia,ra,sa,Ja=0,p=0,va=!1,Ka=0,m=0,La=0,Ma=0,v=0,Na=e.TOTAL_STACK||5242880,w=e.TOTAL_MEMORY||16777216,I=65536;I<w||I<2*Na;)I=16777216>I?2*I:I+16777216;function Oa(e){for(;0<e.length;){var t=e.shift();if("function"==typeof t)t();else{var r=t.Qa;"number"==typeof r?void 0===t.T?n.J("v",r):n.J("vi",r,[t.T]):r(void 0===t.T?null:t.T)}}}I!==w&&(w=I),assert("undefined"!=typeof Int32Array&&"undefined"!=typeof Float64Array&&!!new Int32Array(1).subarray&&!!new Int32Array(1).set,"JS engine does not provide full typed array support"),buffer=new ArrayBuffer(w),D=new Int8Array(buffer),E=new Int16Array(buffer),F=new Int32Array(buffer),H=new Uint8Array(buffer),Ha=new Uint16Array(buffer),Ia=new Uint32Array(buffer),ra=new Float32Array(buffer),sa=new Float64Array(buffer),F[0]=255,assert(255===H[0]&&0===H[3],"Typed arrays 2 must be run on a little-endian system"),e.HEAP=void 0,e.buffer=buffer,e.HEAP8=D,e.HEAP16=E,e.HEAP32=F,e.HEAPU8=H,e.HEAPU16=Ha,e.HEAPU32=Ia,e.HEAPF32=ra,e.HEAPF64=sa;var Pa=[],Qa=[],Ra=[],K=[],Sa=[],xa=!1;function Ta(e){Pa.unshift(e)}function Ua(e){Sa.unshift(e)}function Va(e,t,n){return e=Aa(e,n=Array(0<n?n:Ba(e)+1),0,n.length),t&&(n.length=e),n}function ka(e,t,n){for(e=Va(e,n),n=0;n<e.length;)D[t+n>>0]=e[n],n+=1}function ja(e,t){for(var n=0;n<e.length;n++)D[t++>>0]=e[n]}function ya(e,t,n){for(var r=0;r<e.length;++r)D[t++>>0]=e.charCodeAt(r);n||(D[t>>0]=0)}e.addOnPreRun=Ta,e.addOnInit=function(e){Qa.unshift(e)},e.addOnPreMain=function(e){Ra.unshift(e)},e.addOnExit=function(e){K.unshift(e)},e.addOnPostRun=Ua,e.intArrayFromString=Va,e.intArrayToString=function(e){for(var t=[],n=0;n<e.length;n++){var r=e[n];255<r&&(r&=255),t.push(String.fromCharCode(r))}return t.join("")},e.writeStringToMemory=ka,e.writeArrayToMemory=ja,e.writeAsciiToMemory=ya,Math.imul&&-5===Math.imul(4294967295,5)||(Math.imul=function(e,t){var n=65535&e,r=65535&t;return n*r+((e>>>16)*r+n*(t>>>16)<<16)|0}),Math.td=Math.imul,Math.clz32||(Math.clz32=function(e){e>>>=0;for(var t=0;32>t;t++)if(e&1<<31-t)return t;return 32}),Math.kd=Math.clz32;var na=Math.abs,qa=Math.ceil,pa=Math.floor,oa=Math.min,L=0,Wa=null,Xa=null;function Ya(){L++,e.monitorRunDependencies&&e.monitorRunDependencies(L)}function Za(){if(L--,e.monitorRunDependencies&&e.monitorRunDependencies(L),0==L&&(null!==Wa&&(clearInterval(Wa),Wa=null),Xa)){var t=Xa;Xa=null,t()}}e.addRunDependency=Ya,e.removeRunDependency=Za,e.preloadedImages={},e.preloadedAudios={},Ja=8,p=Ja+1696,Qa.push(),G([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,60,0,0,0,0,0,0,0,5,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,2,0,0,0,164,2,0,0,0,4,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,10,255,255,255,255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"i8",4,n.La);var $a=n.ea(G(12,"i8",2),8);function eb(e,t){K.push((function(){n.J("vi",e,[t])})),eb.level=K.length}assert(0==$a%8),e._bitshift64Ashr=ab,e._i64Subtract=bb,e._i64Add=cb,e._memset=db,e._bitshift64Lshr=fb,e._bitshift64Shl=gb;var M={G:1,B:2,Qc:3,Nb:4,F:5,sa:6,gb:7,kc:8,Z:9,ub:10,oa:11,$c:11,Ka:12,Y:13,Gb:14,wc:15,$:16,pa:17,ad:18,ba:19,qa:20,N:21,u:22,fc:23,Ja:24,O:25,Xc:26,Hb:27,sc:28,da:29,Nc:30,Zb:31,Gc:32,Db:33,Kc:34,oc:42,Kb:43,vb:44,Qb:45,Rb:46,Sb:47,Yb:48,Yc:49,ic:50,Pb:51,Ab:35,lc:37,mb:52,pb:53,bd:54,gc:55,qb:56,rb:57,Bb:35,sb:59,uc:60,jc:61,Uc:62,tc:63,pc:64,qc:65,Mc:66,mc:67,jb:68,Rc:69,wb:70,Hc:71,ac:72,Eb:73,ob:74,Bc:76,nb:77,Lc:78,Tb:79,Ub:80,Xb:81,Wb:82,Vb:83,vc:38,ra:39,bc:36,aa:40,Cc:95,Fc:96,zb:104,hc:105,kb:97,Jc:91,zc:88,rc:92,Oc:108,yb:111,hb:98,xb:103,ec:101,cc:100,Vc:110,Ib:112,Jb:113,Mb:115,lb:114,Cb:89,$b:90,Ic:93,Pc:94,ib:99,dc:102,Ob:106,xc:107,Wc:109,Zc:87,Fb:122,Sc:116,Ac:95,nc:123,Lb:84,Dc:75,tb:125,yc:131,Ec:130,Tc:86},hb={0:"Success",1:"Not super-user",2:"No such file or directory",3:"No such process",4:"Interrupted system call",5:"I/O error",6:"No such device or address",7:"Arg list too long",8:"Exec format error",9:"Bad file number",10:"No children",11:"No more processes",12:"Not enough core",13:"Permission denied",14:"Bad address",15:"Block device required",16:"Mount device busy",17:"File exists",18:"Cross-device link",19:"No such device",20:"Not a directory",21:"Is a directory",22:"Invalid argument",23:"Too many open files in system",24:"Too many open files",25:"Not a typewriter",26:"Text file busy",27:"File too large",28:"No space left on device",29:"Illegal seek",30:"Read only file system",31:"Too many links",32:"Broken pipe",33:"Math arg out of domain of func",34:"Math result not representable",35:"File locking deadlock error",36:"File or path name too long",37:"No record locks available",38:"Function not implemented",39:"Directory not empty",40:"Too many symbolic links",42:"No message of desired type",43:"Identifier removed",44:"Channel number out of range",45:"Level 2 not synchronized",46:"Level 3 halted",47:"Level 3 reset",48:"Link number out of range",49:"Protocol driver not attached",50:"No CSI structure available",51:"Level 2 halted",52:"Invalid exchange",53:"Invalid request descriptor",54:"Exchange full",55:"No anode",56:"Invalid request code",57:"Invalid slot",59:"Bad font file fmt",60:"Device not a stream",61:"No data (for no delay io)",62:"Timer expired",63:"Out of streams resources",64:"Machine is not on the network",65:"Package not installed",66:"The object is remote",67:"The link has been severed",68:"Advertise error",69:"Srmount error",70:"Communication error on send",71:"Protocol error",72:"Multihop attempted",73:"Cross mount point (not really error)",74:"Trying to read unreadable message",75:"Value too large for defined data type",76:"Given log. name not unique",77:"f.d. invalid for this operation",78:"Remote address changed",79:"Can   access a needed shared lib",80:"Accessing a corrupted shared lib",81:".lib section in a.out corrupted",82:"Attempting to link in too many libs",83:"Attempting to exec a shared library",84:"Illegal byte sequence",86:"Streams pipe error",87:"Too many users",88:"Socket operation on non-socket",89:"Destination address required",90:"Message too long",91:"Protocol wrong type for socket",92:"Protocol not available",93:"Unknown protocol",94:"Socket type not supported",95:"Not supported",96:"Protocol family not supported",97:"Address family not supported by protocol family",98:"Address already in use",99:"Address not available",100:"Network interface is not configured",101:"Network is unreachable",102:"Connection reset by network",103:"Connection aborted",104:"Connection reset by peer",105:"No buffer space available",106:"Socket is already connected",107:"Socket is not connected",108:"Can't send after socket shutdown",109:"Too many references",110:"Connection timed out",111:"Connection refused",112:"Host is down",113:"Host is unreachable",114:"Socket already connected",115:"Connection already in progress",116:"Stale file handle",122:"Quota exceeded",123:"No medium (in tape drive)",125:"Operation canceled",130:"Previous owner died",131:"State not recoverable"};function ib(t){return e.___errno_location&&(F[e.___errno_location()>>2]=t),t}function jb(e,t){for(var n=0,r=e.length-1;0<=r;r--){var i=e[r];"."===i?e.splice(r,1):".."===i?(e.splice(r,1),n++):n&&(e.splice(r,1),n--)}if(t)for(;n--;n)e.unshift("..");return e}function N(e){var t="/"===e.charAt(0),n="/"===e.substr(-1);return(e=jb(e.split("/").filter((function(e){return!!e})),!t).join("/"))||t||(e="."),e&&n&&(e+="/"),(t?"/":"")+e}function kb(e){var t=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(e).slice(1);return e=t[0],t=t[1],e||t?(t&&(t=t.substr(0,t.length-1)),e+t):"."}function lb(e){if("/"===e)return"/";var t=e.lastIndexOf("/");return-1===t?e:e.substr(t+1)}function mb(){for(var e="",t=!1,n=arguments.length-1;-1<=n&&!t;n--){if("string"!=typeof(t=0<=n?arguments[n]:"/"))throw new TypeError("Arguments to path.resolve must be strings");if(!t)return"";e=t+"/"+e,t="/"===t.charAt(0)}return(t?"/":"")+(e=jb(e.split("/").filter((function(e){return!!e})),!t).join("/"))||"."}var nb=[];function ob(e,t){nb[e]={input:[],output:[],L:t},pb(e,qb)}var qb={open:function(e){var t=nb[e.g.rdev];if(!t)throw new O(M.ba);e.tty=t,e.seekable=!1},close:function(e){e.tty.L.flush(e.tty)},flush:function(e){e.tty.L.flush(e.tty)},read:function(e,t,n,r){if(!e.tty||!e.tty.L.Ba)throw new O(M.sa);for(var i=0,a=0;a<r;a++){var o;try{o=e.tty.L.Ba(e.tty)}catch(e){throw new O(M.F)}if(void 0===o&&0===i)throw new O(M.oa);if(null==o)break;i++,t[n+a]=o}return i&&(e.g.timestamp=Date.now()),i},write:function(e,t,n,r){if(!e.tty||!e.tty.L.ja)throw new O(M.sa);for(var i=0;i<r;i++)try{e.tty.L.ja(e.tty,t[n+i])}catch(e){throw new O(M.F)}return r&&(e.g.timestamp=Date.now()),i}},rb={Ba:function(e){if(!e.input.length){var t=null;if("undefined"!=typeof window&&"function"==typeof window.prompt?null!==(t=window.prompt("Input: "))&&(t+="\n"):"function"==typeof readline&&(null!==(t=readline())&&(t+="\n")),!t)return null;e.input=Va(t,!0)}return e.input.shift()},ja:function(t,n){null===n||10===n?(e.print(za(t.output,0)),t.output=[]):0!=n&&t.output.push(n)},flush:function(t){t.output&&0<t.output.length&&(e.print(za(t.output,0)),t.output=[])}},sb={ja:function(t,n){null===n||10===n?(e.printErr(za(t.output,0)),t.output=[]):0!=n&&t.output.push(n)},flush:function(t){t.output&&0<t.output.length&&(e.printErr(za(t.output,0)),t.output=[])}},P={q:null,A:function(){return P.createNode(null,"/",16895,0)},createNode:function(e,t,n,r){if(24576==(61440&n)||4096==(61440&n))throw new O(M.G);return P.q||(P.q={dir:{g:{D:P.k.D,p:P.k.p,lookup:P.k.lookup,V:P.k.V,rename:P.k.rename,unlink:P.k.unlink,rmdir:P.k.rmdir,readdir:P.k.readdir,symlink:P.k.symlink},stream:{I:P.n.I}},file:{g:{D:P.k.D,p:P.k.p},stream:{I:P.n.I,read:P.n.read,write:P.n.write,ta:P.n.ta,Ea:P.n.Ea,Ga:P.n.Ga}},link:{g:{D:P.k.D,p:P.k.p,readlink:P.k.readlink},stream:{}},va:{g:{D:P.k.D,p:P.k.p},stream:tb}}),16384==(61440&(n=ub(e,t,n,r)).mode)?(n.k=P.q.dir.g,n.n=P.q.dir.stream,n.e={}):32768==(61440&n.mode)?(n.k=P.q.file.g,n.n=P.q.file.stream,n.o=0,n.e=null):40960==(61440&n.mode)?(n.k=P.q.link.g,n.n=P.q.link.stream):8192==(61440&n.mode)&&(n.k=P.q.va.g,n.n=P.q.va.stream),n.timestamp=Date.now(),e&&(e.e[t]=n),n},Sa:function(e){if(e.e&&e.e.subarray){for(var t=[],n=0;n<e.o;++n)t.push(e.e[n]);return t}return e.e},qd:function(e){return e.e?e.e.subarray?e.e.subarray(0,e.o):new Uint8Array(e.e):new Uint8Array},ya:function(e,t){if(e.e&&e.e.subarray&&t>e.e.length&&(e.e=P.Sa(e),e.o=e.e.length),!e.e||e.e.subarray){var n=e.e?e.e.buffer.byteLength:0;n>=t||(t=Math.max(t,n*(1048576>n?2:1.125)|0),0!=n&&(t=Math.max(t,256)),n=e.e,e.e=new Uint8Array(t),0<e.o&&e.e.set(n.subarray(0,e.o),0))}else for(!e.e&&0<t&&(e.e=[]);e.e.length<t;)e.e.push(0)},ab:function(e,t){if(e.o!=t)if(0==t)e.e=null,e.o=0;else{if(!e.e||e.e.subarray){var n=e.e;e.e=new Uint8Array(new ArrayBuffer(t)),n&&e.e.set(n.subarray(0,Math.min(t,e.o)))}else if(e.e||(e.e=[]),e.e.length>t)e.e.length=t;else for(;e.e.length<t;)e.e.push(0);e.o=t}},k:{D:function(e){var t={};return t.dev=8192==(61440&e.mode)?e.id:1,t.ino=e.id,t.mode=e.mode,t.nlink=1,t.uid=0,t.gid=0,t.rdev=e.rdev,16384==(61440&e.mode)?t.size=4096:32768==(61440&e.mode)?t.size=e.o:40960==(61440&e.mode)?t.size=e.link.length:t.size=0,t.atime=new Date(e.timestamp),t.mtime=new Date(e.timestamp),t.ctime=new Date(e.timestamp),t.Pa=4096,t.blocks=Math.ceil(t.size/t.Pa),t},p:function(e,t){void 0!==t.mode&&(e.mode=t.mode),void 0!==t.timestamp&&(e.timestamp=t.timestamp),void 0!==t.size&&P.ab(e,t.size)},lookup:function(){throw vb[M.B]},V:function(e,t,n,r){return P.createNode(e,t,n,r)},rename:function(e,t,n){if(16384==(61440&e.mode)){var r;try{r=wb(t,n)}catch(e){}if(r)for(var i in r.e)throw new O(M.ra)}delete e.parent.e[e.name],e.name=n,t.e[n]=e,e.parent=t},unlink:function(e,t){delete e.e[t]},rmdir:function(e,t){var n,r=wb(e,t);for(n in r.e)throw new O(M.ra);delete e.e[t]},readdir:function(e){var t,n=[".",".."];for(t in e.e)e.e.hasOwnProperty(t)&&n.push(t);return n},symlink:function(e,t,n){return(e=P.createNode(e,t,41471,0)).link=n,e},readlink:function(e){if(40960!=(61440&e.mode))throw new O(M.u);return e.link}},n:{read:function(e,t,n,r,i){var a=e.g.e;if(i>=e.g.o)return 0;if(assert(0<=(e=Math.min(e.g.o-i,r))),8<e&&a.subarray)t.set(a.subarray(i,i+e),n);else for(r=0;r<e;r++)t[n+r]=a[i+r];return e},write:function(e,t,n,r,i,a){if(!r)return 0;if((e=e.g).timestamp=Date.now(),t.subarray&&(!e.e||e.e.subarray)){if(a)return e.e=t.subarray(n,n+r),e.o=r;if(0===e.o&&0===i)return e.e=new Uint8Array(t.subarray(n,n+r)),e.o=r;if(i+r<=e.o)return e.e.set(t.subarray(n,n+r),i),r}if(P.ya(e,i+r),e.e.subarray&&t.subarray)e.e.set(t.subarray(n,n+r),i);else for(a=0;a<r;a++)e.e[i+a]=t[n+a];return e.o=Math.max(e.o,i+r),r},I:function(e,t,n){if(1===n?t+=e.position:2===n&&32768==(61440&e.g.mode)&&(t+=e.g.o),0>t)throw new O(M.u);return t},ta:function(e,t,n){P.ya(e.g,t+n),e.g.o=Math.max(e.g.o,t+n)},Ea:function(e,t,n,r,i,a,o){if(32768!=(61440&e.g.mode))throw new O(M.ba);if(n=e.g.e,2&o||n.buffer!==t&&n.buffer!==t.buffer){if((0<i||i+r<e.g.o)&&(n=n.subarray?n.subarray(i,i+r):Array.prototype.slice.call(n,i,i+r)),e=!0,!(r=ua(r)))throw new O(M.Ka);t.set(n,r)}else e=!1,r=n.byteOffset;return{Cd:r,gd:e}},Ga:function(e,t,n,r,i){if(32768!=(61440&e.g.mode))throw new O(M.ba);return 2&i||P.n.write(e,t,0,r,n,!1),0}}};G(1,"i32*",2),G(1,"i32*",2),G(1,"i32*",2);var xb=null,yb=[null],zb=[],Ab=1,R=null,Cb=!0,S={},O=null,vb={};function T(e,t){if(t=t||{},!(e=mb("/",e)))return{path:"",g:null};var n,r={za:!0,ka:0};for(n in r)void 0===t[n]&&(t[n]=r[n]);if(8<t.ka)throw new O(M.aa);r=jb(e.split("/").filter((function(e){return!!e})),!1);var i=xb;n="/";for(var a=0;a<r.length;a++){var o=a===r.length-1;if(o&&t.parent)break;if(i=wb(i,r[a]),n=N(n+"/"+r[a]),i.R&&(!o||o&&t.za)&&(i=i.R.root),!o||t.ga)for(o=0;40960==(61440&i.mode);)if(i=Db(n),i=T(n=mb(kb(n),i),{ka:t.ka}).g,40<o++)throw new O(M.aa)}return{path:n,g:i}}function U(e){for(var t;;){if(e===e.parent)return e=e.A.Fa,t?"/"!==e[e.length-1]?e+"/"+t:e+t:e;t=t?e.name+"/"+t:e.name,e=e.parent}}function Eb(e,t){for(var n=0,r=0;r<t.length;r++)n=(n<<5)-n+t.charCodeAt(r)|0;return(e+n>>>0)%R.length}function Fb(e){var t=Eb(e.parent.id,e.name);e.K=R[t],R[t]=e}function wb(e,t){var n;if(n=(n=Gb(e,"x"))?n:e.k.lookup?0:M.Y)throw new O(n,e);for(n=R[Eb(e.id,t)];n;n=n.K){var r=n.name;if(n.parent.id===e.id&&r===t)return n}return e.k.lookup(e,t)}function ub(e,t,n,r){return Hb||((Hb=function(e,t,n,r){e||(e=this),this.parent=e,this.A=e.A,this.R=null,this.id=Ab++,this.name=t,this.mode=n,this.k={},this.n={},this.rdev=r}).prototype={},Object.defineProperties(Hb.prototype,{read:{get:function(){return 365==(365&this.mode)},set:function(e){e?this.mode|=365:this.mode&=-366}},write:{get:function(){return 146==(146&this.mode)},set:function(e){e?this.mode|=146:this.mode&=-147}},Xa:{get:function(){return 16384==(61440&this.mode)}},Ca:{get:function(){return 8192==(61440&this.mode)}}})),Fb(e=new Hb(e,t,n,r)),e}var Ib={r:0,rs:1052672,"r+":2,w:577,wx:705,xw:705,"w+":578,"wx+":706,"xw+":706,a:1089,ax:1217,xa:1217,"a+":1090,"ax+":1218,"xa+":1218};function Gb(e,t){return Cb||(-1===t.indexOf("r")||292&e.mode)&&(-1===t.indexOf("w")||146&e.mode)&&(-1===t.indexOf("x")||73&e.mode)?0:M.Y}function Jb(e,t){try{return wb(e,t),M.pa}catch(e){}return Gb(e,"wx")}function Kb(){for(var e=0;e<=4096;e++)if(!zb[e])return e;throw new O(M.Ja)}function Lb(e){Mb||((Mb=function(){}).prototype={},Object.defineProperties(Mb.prototype,{object:{get:function(){return this.g},set:function(e){this.g=e}},vd:{get:function(){return 1!=(2097155&this.flags)}},wd:{get:function(){return 0!=(2097155&this.flags)}},ud:{get:function(){return 1024&this.flags}}}));var t,n=new Mb;for(t in e)n[t]=e[t];return e=n,n=Kb(),e.fd=n,zb[n]=e}var tb={open:function(e){e.n=yb[e.g.rdev].n,e.n.open&&e.n.open(e)},I:function(){throw new O(M.da)}},Zb;function pb(e,t){yb[e]={n:t}}function Nb(e,t){var n,r="/"===t,i=!t;if(r&&xb)throw new O(M.$);if(!r&&!i){if(t=(n=T(t,{za:!1})).path,(n=n.g).R)throw new O(M.$);if(16384!=(61440&n.mode))throw new O(M.qa)}i={type:e,Ad:{},Fa:t,Ya:[]};var a=e.A(i);a.A=i,i.root=a,r?xb=a:n&&(n.R=i,n.A&&n.A.Ya.push(i))}function Ob(e,t,n){var r=T(e,{parent:!0}).g;if(!(e=lb(e))||"."===e||".."===e)throw new O(M.u);var i=Jb(r,e);if(i)throw new O(i);if(!r.k.V)throw new O(M.G);return r.k.V(r,e,t,n)}function Pb(e,t){return t=4095&(void 0!==t?t:438),Ob(e,t|=32768,0)}function V(e,t){return t=1023&(void 0!==t?t:511),Ob(e,t|=16384,0)}function Qb(e,t,n){return void 0===n&&(n=t,t=438),Ob(e,8192|t,n)}function Rb(e,t){if(!mb(e))throw new O(M.B);var n=T(t,{parent:!0}).g;if(!n)throw new O(M.B);var r=lb(t),i=Jb(n,r);if(i)throw new O(i);if(!n.k.symlink)throw new O(M.G);return n.k.symlink(n,r,e)}function Db(e){if(!(e=T(e).g))throw new O(M.B);if(!e.k.readlink)throw new O(M.u);return mb(U(e.parent),e.k.readlink(e))}function Sb(e,t){var n;if(!(n="string"==typeof e?T(e,{ga:!0}).g:e).k.p)throw new O(M.G);n.k.p(n,{mode:4095&t|-4096&n.mode,timestamp:Date.now()})}function Tb(t,n){var r,i,a;if(""===t)throw new O(M.B);if("string"==typeof n){if(void 0===(i=Ib[n]))throw Error("Unknown file open mode: "+n)}else i=n;if(r=64&(n=i)?4095&(void 0===r?438:r)|32768:0,"object"==typeof t)a=t;else{t=N(t);try{a=T(t,{ga:!(131072&n)}).g}catch(e){}}if(i=!1,64&n)if(a){if(128&n)throw new O(M.pa)}else a=Ob(t,r,0),i=!0;if(!a)throw new O(M.B);if(8192==(61440&a.mode)&&(n&=-513),65536&n&&16384!=(61440&a.mode))throw new O(M.qa);if(!i&&(a?40960==(61440&a.mode)?r=M.aa:16384==(61440&a.mode)&&(0!=(2097155&n)||512&n)?r=M.N:(r=["r","w","rw"][3&n],512&n&&(r+="w"),r=Gb(a,r)):r=M.B,r))throw new O(r);if(512&n){var o;if(!(o="string"==typeof(r=a)?T(r,{ga:!0}).g:r).k.p)throw new O(M.G);if(16384==(61440&o.mode))throw new O(M.N);if(32768!=(61440&o.mode))throw new O(M.u);if(r=Gb(o,"w"))throw new O(r);o.k.p(o,{size:0,timestamp:Date.now()})}n&=-641,(a=Lb({g:a,path:U(a),flags:n,seekable:!0,position:0,n:a.n,eb:[],error:!1})).n.open&&a.n.open(a),!e.logReadFiles||1&n||(Ub||(Ub={}),t in Ub||(Ub[t]=1,e.printErr("read file: "+t)));try{S.onOpenFile&&(o=0,1!=(2097155&n)&&(o|=1),0!=(2097155&n)&&(o|=2),S.onOpenFile(t,o))}catch(e){console.log("FS.trackingDelegate['onOpenFile']('"+t+"', flags) threw an exception: "+e.message)}return a}function Vb(e){e.ia&&(e.ia=null);try{e.n.close&&e.n.close(e)}catch(e){throw e}finally{zb[e.fd]=null}}function Wb(e,t,n){if(!e.seekable||!e.n.I)throw new O(M.da);e.position=e.n.I(e,t,n),e.eb=[]}function Xb(e,t,n,r,i,a){if(0>r||0>i)throw new O(M.u);if(0==(2097155&e.flags))throw new O(M.Z);if(16384==(61440&e.g.mode))throw new O(M.N);if(!e.n.write)throw new O(M.u);1024&e.flags&&Wb(e,0,2);var o=!0;if(void 0===i)i=e.position,o=!1;else if(!e.seekable)throw new O(M.da);t=e.n.write(e,t,n,r,i,a),o||(e.position+=t);try{e.path&&S.onWriteToFile&&S.onWriteToFile(e.path)}catch(e){console.log("FS.trackingDelegate['onWriteToFile']('"+path+"') threw an exception: "+e.message)}return t}function Yb(){O||((O=function(e,t){this.g=t,this.bb=function(e){for(var t in this.Q=e,M)if(M[t]===e){this.code=t;break}},this.bb(e),this.message=hb[e]}).prototype=Error(),O.prototype.constructor=O,[M.B].forEach((function(e){vb[e]=new O(e),vb[e].stack="<generic error, no stack>"})))}function $b(e,t){var n=0;return e&&(n|=365),t&&(n|=146),n}function ac(e,t,n,r){return Pb(e=N(("string"==typeof e?e:U(e))+"/"+t),$b(n,r))}function bc(e,t,n,r,i,a){if(i=Pb(e=t?N(("string"==typeof e?e:U(e))+"/"+t):e,r=$b(r,i)),n){if("string"==typeof n){e=Array(n.length),t=0;for(var o=n.length;t<o;++t)e[t]=n.charCodeAt(t);n=e}Sb(i,146|r),Xb(e=Tb(i,"w"),n,0,n.length,0,a),Vb(e),Sb(i,r)}return i}function W(e,t,n,r){e=N(("string"==typeof e?e:U(e))+"/"+t),t=$b(!!n,!!r),W.Da||(W.Da=64);var i=W.Da++<<8|0;return pb(i,{open:function(e){e.seekable=!1},close:function(){r&&r.buffer&&r.buffer.length&&r(10)},read:function(e,t,r,i){for(var a=0,o=0;o<i;o++){var s;try{s=n()}catch(e){throw new O(M.F)}if(void 0===s&&0===a)throw new O(M.oa);if(null==s)break;a++,t[r+o]=s}return a&&(e.g.timestamp=Date.now()),a},write:function(e,t,n,i){for(var a=0;a<i;a++)try{r(t[n+a])}catch(e){throw new O(M.F)}return i&&(e.g.timestamp=Date.now()),a}}),Qb(e,t,i)}function cc(t){if(t.Ca||t.Xa||t.link||t.e)return!0;var n=!0;if("undefined"!=typeof XMLHttpRequest)throw Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");if(!e.read)throw Error("Cannot load without read() or XMLHttpRequest.");try{t.e=Va(e.read(t.url),!0),t.o=t.e.length}catch(e){n=!1}return n||ib(M.F),n}var dc={},Hb,Mb,Ub,ec=0;function X(){return F[(ec+=4)-4>>2]}function fc(){var e;if(e=X(),!(e=zb[e]))throw new O(M.Z);return e}function wa(e){wa.C||(v=Ga(),wa.C=!0,assert(n.P),wa.Ra=n.P,n.P=function(){z("cannot dynamically allocate, sbrk now has control")});var t=v;return 0==e||wa.Ra(e)?t:4294967295}function hc(e,t){if(ic=e,jc=t,!kc)return 1;if(0==e)Y=function(){setTimeout(lc,t)},mc="timeout";else if(1==e)Y=function(){nc(lc)},mc="rAF";else if(2==e){if(!window.setImmediate){var n=[];window.addEventListener("message",(function(e){e.source===window&&"__emcc"===e.data&&(e.stopPropagation(),n.shift()())}),!0),window.setImmediate=function(e){n.push(e),window.postMessage("__emcc","*")}}Y=function(){window.setImmediate(lc)},mc="immediate"}return 0}function oc(t,r,i,a,o){e.noExitRuntime=!0,assert(!kc,"emscripten_set_main_loop: there can only be one main loop function at once: call emscripten_cancel_main_loop to cancel the previous one before setting a new one with different parameters."),kc=t,pc=a;var s=qc;if(lc=function(){if(!A)if(0<rc.length){var r=Date.now(),i=rc.shift();if(i.Qa(i.T),sc){var o=sc,l=0==o%1?o-1:Math.floor(o);sc=i.ld?l:(8*o+(l+.5))/9}console.log('main loop blocker "'+i.name+'" took '+(Date.now()-r)+" ms"),tc(),setTimeout(lc,0)}else s<qc||(uc=uc+1|0,1==ic&&1<jc&&0!=uc%jc?Y():("timeout"===mc&&e.fa&&(e.S("Looks like you are rendering without using requestAnimationFrame for the main loop. You should use 0 for the frame rate in emscripten_set_main_loop in order to use requestAnimationFrame, as that can greatly improve your frame rates!"),mc=""),vc((function(){void 0!==a?n.J("vi",t,[a]):n.J("v",t)})),s<qc||("object"==typeof SDL&&SDL.audio&&SDL.audio.Za&&SDL.audio.Za(),Y())))},o||(r&&0<r?hc(0,1e3/r):hc(1,1),Y()),i)throw"SimulateInfiniteLoop"}e._memcpy=gc;var Y=null,mc="",qc=0,kc=null,pc=0,ic=0,jc=0,uc=0,rc=[];function tc(){if(e.setStatus){var t=e.statusMessage||"Please wait...",n=sc,r=wc.nd;n?n<r?e.setStatus(t+" ("+(r-n)+"/"+r+")"):e.setStatus(t):e.setStatus("")}}function vc(t){if(!(A||e.preMainLoop&&!1===e.preMainLoop())){try{t()}catch(t){if(t instanceof xc)return;throw t&&"object"==typeof t&&t.stack&&e.S("exception thrown: "+[t,t.stack]),t}e.postMainLoop&&e.postMainLoop()}}var wc={},lc,sc,yc=!1,zc=!1,Ac=[];function Bc(){function t(){zc=document.pointerLockElement===r||document.mozPointerLockElement===r||document.webkitPointerLockElement===r||document.msPointerLockElement===r}if(e.preloadPlugins||(e.preloadPlugins=[]),!Cc){Cc=!0;try{Dc=!0}catch(e){Dc=!1,console.log("warning: no blob constructor, cannot create blobs with mimetypes")}Ec="undefined"!=typeof MozBlobBuilder?MozBlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:Dc?null:console.log("warning: no BlobBuilder"),Fc="undefined"!=typeof window?window.URL?window.URL:window.webkitURL:void 0,e.Ha||void 0!==Fc||(console.log("warning: Browser does not support creating object URLs. Built-in browser image decoding will not be available."),e.Ha=!0),e.preloadPlugins.push({canHandle:function(t){return!e.Ha&&/\.(jpg|jpeg|png|bmp)$/i.test(t)},handle:function(t,r,i,a){var o=null;if(Dc)try{(o=new Blob([t],{type:Gc(r)})).size!==t.length&&(o=new Blob([new Uint8Array(t).buffer],{type:Gc(r)}))}catch(e){n.M("Blob constructor present but fails: "+e+"; falling back to blob builder")}o||((o=new Ec).append(new Uint8Array(t).buffer),o=o.getBlob());var s=Fc.createObjectURL(o),l=new Image;l.onload=function(){assert(l.complete,"Image "+r+" could not be decoded");var n=document.createElement("canvas");n.width=l.width,n.height=l.height,n.getContext("2d").drawImage(l,0,0),e.preloadedImages[r]=n,Fc.revokeObjectURL(s),i&&i(t)},l.onerror=function(){console.log("Image "+s+" could not be decoded"),a&&a()},l.src=s}}),e.preloadPlugins.push({canHandle:function(t){return!e.zd&&t.substr(-4)in{".ogg":1,".wav":1,".mp3":1}},handle:function(t,n,r,i){function a(i){s||(s=!0,e.preloadedAudios[n]=i,r&&r(t))}function o(){s||(s=!0,e.preloadedAudios[n]=new Audio,i&&i())}var s=!1;if(!Dc)return o();try{var l=new Blob([t],{type:Gc(n)})}catch(e){return o()}l=Fc.createObjectURL(l);var c=new Audio;c.addEventListener("canplaythrough",(function(){a(c)}),!1),c.onerror=function(){if(!s){console.log("warning: browser could not fully decode audio "+n+", trying slower base64 approach");for(var e="",r=0,i=0,o=0;o<t.length;o++)for(r=r<<8|t[o],i+=8;6<=i;){var l=r>>i-6&63;i=i-6,e=e+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[l]}2==i?(e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(3&r)<<4],e+="=="):4==i&&(e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(15&r)<<2],e+="="),c.src="data:audio/x-"+n.substr(-3)+";base64,"+e,a(c)}},c.src=l,Hc((function(){a(c)}))}});var r=e.canvas;r&&(r.la=r.requestPointerLock||r.mozRequestPointerLock||r.webkitRequestPointerLock||r.msRequestPointerLock||function(){},r.wa=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock||document.msExitPointerLock||function(){},r.wa=r.wa.bind(document),document.addEventListener("pointerlockchange",t,!1),document.addEventListener("mozpointerlockchange",t,!1),document.addEventListener("webkitpointerlockchange",t,!1),document.addEventListener("mspointerlockchange",t,!1),e.elementPointerLock&&r.addEventListener("click",(function(e){!zc&&r.la&&(r.la(),e.preventDefault())}),!1))}}function Ic(t,n,r,i){if(n&&e.fa&&t==e.canvas)return e.fa;var a,o;if(n){if(o={antialias:!1,alpha:!1},i)for(var s in i)o[s]=i[s];(o=GL.createContext(t,o))&&(a=GL.getContext(o).cd),t.style.backgroundColor="black"}else a=t.getContext("2d");return a?(r&&(n||assert("undefined"==typeof GLctx,"cannot set in module if GLctx is used, but we are a non-GL context that would replace it"),e.fa=a,n&&GL.yd(o),e.Dd=n,Ac.forEach((function(e){e()})),Bc()),a):null}var Jc=!1,Kc=void 0,Lc=void 0;function Mc(t,n,r){function i(){yc=!1;var t=a.parentNode;(document.webkitFullScreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.mozFullscreenElement||document.fullScreenElement||document.fullscreenElement||document.msFullScreenElement||document.msFullscreenElement||document.webkitCurrentFullScreenElement)===t?(a.ua=document.cancelFullScreen||document.mozCancelFullScreen||document.webkitCancelFullScreen||document.msExitFullscreen||document.exitFullscreen||function(){},a.ua=a.ua.bind(document),Kc&&a.la(),yc=!0,Lc&&Nc()):(t.parentNode.insertBefore(a,t),t.parentNode.removeChild(t),Lc&&Oc()),e.onFullScreen&&e.onFullScreen(yc),Pc(a)}void 0===(Kc=t)&&(Kc=!0),void 0===(Lc=n)&&(Lc=!1),void 0===(Qc=r)&&(Qc=null);var a=e.canvas;Jc||(Jc=!0,document.addEventListener("fullscreenchange",i,!1),document.addEventListener("mozfullscreenchange",i,!1),document.addEventListener("webkitfullscreenchange",i,!1),document.addEventListener("MSFullscreenChange",i,!1));var o=document.createElement("div");a.parentNode.insertBefore(o,a),o.appendChild(a),o.C=o.requestFullScreen||o.mozRequestFullScreen||o.msRequestFullscreen||(o.webkitRequestFullScreen?function(){o.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT)}:null),r?o.C({Ed:r}):o.C()}var Rc=0;function Sc(e){var t=Date.now();if(0===Rc)Rc=t+1e3/60;else for(;t+2>=Rc;)Rc+=1e3/60;t=Math.max(Rc-t,0),setTimeout(e,t)}function nc(e){"undefined"==typeof window?Sc(e):(window.requestAnimationFrame||(window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||Sc),window.requestAnimationFrame(e))}function Hc(t){e.noExitRuntime=!0,setTimeout((function(){A||t()}),1e4)}function Gc(e){return{jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",bmp:"image/bmp",ogg:"audio/ogg",wav:"audio/wav",mp3:"audio/mpeg"}[e.substr(e.lastIndexOf(".")+1)]}function Tc(e,t,n){var r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="arraybuffer",r.onload=function(){200==r.status||0==r.status&&r.response?t(r.response):n()},r.onerror=n,r.send(null)}function Uc(e,t,n){Tc(e,(function(n){assert(n,'Loading data file "'+e+'" failed (no arrayBuffer).'),t(new Uint8Array(n)),Za()}),(function(){if(!n)throw'Loading data file "'+e+'" failed.';n()})),Ya()}var Vc=[],Cc,Dc,Ec,Fc,Qc;function Wc(){var t=e.canvas;Vc.forEach((function(e){e(t.width,t.height)}))}function Nc(){if("undefined"!=typeof SDL){var e=Ia[SDL.screen+0*n.H>>2];F[SDL.screen+0*n.H>>2]=8388608|e}Wc()}function Oc(){if("undefined"!=typeof SDL){var e=Ia[SDL.screen+0*n.H>>2];F[SDL.screen+0*n.H>>2]=-8388609&e}Wc()}function Pc(t,n,r){n&&r?(t.fb=n,t.Va=r):(n=t.fb,r=t.Va);var i=n,a=r;if(e.forcedAspectRatio&&0<e.forcedAspectRatio&&(i/a<e.forcedAspectRatio?i=Math.round(a*e.forcedAspectRatio):a=Math.round(i/e.forcedAspectRatio)),(document.webkitFullScreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.mozFullscreenElement||document.fullScreenElement||document.fullscreenElement||document.msFullScreenElement||document.msFullscreenElement||document.webkitCurrentFullScreenElement)===t.parentNode&&"undefined"!=typeof screen){var o=Math.min(screen.width/i,screen.height/a);i=Math.round(i*o),a=Math.round(a*o)}Lc?(t.width!=i&&(t.width=i),t.height!=a&&(t.height=a),void 0!==t.style&&(t.style.removeProperty("width"),t.style.removeProperty("height"))):(t.width!=n&&(t.width=n),t.height!=r&&(t.height=r),void 0!==t.style&&(i!=n||a!=r?(t.style.setProperty("width",i+"px","important"),t.style.setProperty("height",a+"px","important")):(t.style.removeProperty("width"),t.style.removeProperty("height"))))}Yb(),R=Array(4096),Nb(P,"/"),V("/tmp"),V("/home"),V("/home/web_user"),function(){var e;if(V("/dev"),pb(259,{read:function(){return 0},write:function(e,t,n,r){return r}}),Qb("/dev/null",259),ob(1280,rb),ob(1536,sb),Qb("/dev/tty",1280),Qb("/dev/tty1",1536),"undefined"!=typeof crypto){var t=new Uint8Array(1);e=function(){return crypto.getRandomValues(t),t[0]}}else e=function(){return 256*Math.random()|0};W("/dev","random",e),W("/dev","urandom",e),V("/dev/shm"),V("/dev/shm/tmp")}(),V("/proc"),V("/proc/self"),V("/proc/self/fd"),Nb({A:function(){var e=ub("/proc/self","fd",16895,73);return e.k={lookup:function(e,t){var n=zb[+t];if(!n)throw new O(M.Z);var r={parent:null,A:{Fa:"fake"},k:{readlink:function(){return n.path}}};return r.parent=r}},e}},"/proc/self/fd"),Qa.unshift((function(){if(!e.noFSInit&&!Zb){assert(!Zb,"FS.init was previously called. If you want to initialize later with custom parameters, remove any earlier calls (note that one is automatically added to the generated code)"),Zb=!0,Yb(),e.stdin=e.stdin,e.stdout=e.stdout,e.stderr=e.stderr,e.stdin?W("/dev","stdin",e.stdin):Rb("/dev/tty","/dev/stdin"),e.stdout?W("/dev","stdout",null,e.stdout):Rb("/dev/tty","/dev/stdout"),e.stderr?W("/dev","stderr",null,e.stderr):Rb("/dev/tty1","/dev/stderr");var t=Tb("/dev/stdin","r");assert(0===t.fd,"invalid handle for stdin ("+t.fd+")"),assert(1===(t=Tb("/dev/stdout","w")).fd,"invalid handle for stdout ("+t.fd+")"),assert(2===(t=Tb("/dev/stderr","w")).fd,"invalid handle for stderr ("+t.fd+")")}})),Ra.push((function(){Cb=!1})),K.push((function(){Zb=!1;var t=e._fflush;for(t&&t(0),t=0;t<zb.length;t++){var n=zb[t];n&&Vb(n)}})),e.FS_createFolder=function(e,t,n,r){return V(e=N(("string"==typeof e?e:U(e))+"/"+t),$b(n,r))},e.FS_createPath=function(e,t){e="string"==typeof e?e:U(e);for(var n=t.split("/").reverse();n.length;){var r=n.pop();if(r){var i=N(e+"/"+r);try{V(i)}catch(e){}e=i}}return i},e.FS_createDataFile=bc,e.FS_createPreloadedFile=function(t,n,r,i,a,o,s,l,c,d){function u(r){function u(e){d&&d(),l||bc(t,n,e,i,a,c),o&&o(),Za()}var f=!1;e.preloadPlugins.forEach((function(e){!f&&e.canHandle(p)&&(e.handle(r,p,u,(function(){s&&s(),Za()})),f=!0)})),f||u(r)}Bc();var p=n?mb(N(t+"/"+n)):t;Ya(),"string"==typeof r?Uc(r,(function(e){u(e)}),s):u(r)},e.FS_createLazyFile=function(e,t,n,r,i){if("undefined"!=typeof XMLHttpRequest)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";n={Ca:!1,url:n};var a=ac(e,t,r,i);n.e?a.e=n.e:n.url&&(a.e=null,a.url=n.url),Object.defineProperty(a,"usedBytes",{get:function(){return this.e.length}});var o={};return Object.keys(a.n).forEach((function(e){var t=a.n[e];o[e]=function(){if(!cc(a))throw new O(M.F);return t.apply(null,arguments)}})),o.read=function(e,t,n,r,i){if(!cc(a))throw new O(M.F);if(i>=(e=e.g.e).length)return 0;if(assert(0<=(r=Math.min(e.length-i,r))),e.slice)for(var o=0;o<r;o++)t[n+o]=e[i+o];else for(o=0;o<r;o++)t[n+o]=e.get(i+o);return r},a.n=o,a},e.FS_createLink=function(e,t,n){return Rb(n,e=N(("string"==typeof e?e:U(e))+"/"+t))},e.FS_createDevice=W,e.FS_unlink=function(e){var t,n=T(e,{parent:!0}).g,r=lb(e),i=wb(n,r);e:{try{t=wb(n,r)}catch(e){t=e.Q;break e}var a=Gb(n,"wx");t=a||(16384==(61440&t.mode)?M.N:0)}if(t)throw t===M.N&&(t=M.G),new O(t);if(!n.k.unlink)throw new O(M.G);if(i.R)throw new O(M.$);try{S.willDeletePath&&S.willDeletePath(e)}catch(t){console.log("FS.trackingDelegate['willDeletePath']('"+e+"') threw an exception: "+t.message)}if(n.k.unlink(n,r),n=Eb(i.parent.id,i.name),R[n]===i)R[n]=i.K;else for(n=R[n];n;){if(n.K===i){n.K=i.K;break}n=n.K}try{S.onDeletePath&&S.onDeletePath(e)}catch(t){console.log("FS.trackingDelegate['onDeletePath']('"+e+"') threw an exception: "+t.message)}},Qa.unshift((function(){})),K.push((function(){})),e.requestFullScreen=function(e,t,n){Mc(e,t,n)},e.requestAnimationFrame=function(e){nc(e)},e.setCanvasSize=function(t,n,r){Pc(e.canvas,t,n),r||Wc()},e.pauseMainLoop=function(){Y=null,qc++},e.resumeMainLoop=function(){qc++;var e=ic,t=jc,n=kc;kc=null,oc(n,0,!1,pc,!0),hc(e,t),Y()},e.getUserMedia=function(){window.C||(window.C=navigator.getUserMedia||navigator.mozGetUserMedia),window.C(void 0)},e.createContext=function(e,t,n,r){return Ic(e,t,n,r)},Ka=m=n.ea(p),va=!0,La=Ka+Na,Ma=v=n.ea(La),assert(Ma<w,"TOTAL_MEMORY not big enough for stack");var Xc=G([8,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,5,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,6,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,5,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,7,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,5,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,6,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,5,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0],"i8",3);e.Na={Math,Int8Array,Int16Array,Int32Array,Uint8Array,Uint16Array,Uint32Array,Float32Array,Float64Array,NaN:NaN,Infinity:1/0},e.Oa={abort:z,assert,invoke_ii:function(t,n){try{return e.dynCall_ii(t,n)}catch(e){if("number"!=typeof e&&"longjmp"!==e)throw e;Z.setThrew(1,0)}},invoke_iiii:function(t,n,r,i){try{return e.dynCall_iiii(t,n,r,i)}catch(e){if("number"!=typeof e&&"longjmp"!==e)throw e;Z.setThrew(1,0)}},invoke_vi:function(t,n){try{e.dynCall_vi(t,n)}catch(e){if("number"!=typeof e&&"longjmp"!==e)throw e;Z.setThrew(1,0)}},_pthread_cleanup_pop:function(){assert(eb.level==K.length,"cannot pop if something else added meanwhile!"),K.pop(),eb.level=K.length},___lock:function(){},_emscripten_set_main_loop:oc,_pthread_self:function(){return 0},___syscall6:function(e,t){ec=t;try{return Vb(fc()),0}catch(e){return void 0!==dc&&e instanceof O||z(e),-e.Q}},_emscripten_set_main_loop_timing:hc,_abort:function(){e.abort()},_sbrk:wa,_time:function(e){var t=Date.now()/1e3|0;return e&&(F[e>>2]=t),t},___setErrNo:ib,_emscripten_memcpy_big:function(e,t,n){return H.set(H.subarray(t,t+n),e),e},___syscall54:function(e,t){ec=t;try{var n=fc(),r=X();switch(r){case 21505:case 21506:return n.tty?0:-M.O;case 21519:if(!n.tty)return-M.O;var i=X();return F[i>>2]=0;case 21520:return n.tty?-M.u:-M.O;case 21531:if(i=X(),!n.n.Wa)throw new O(M.O);return n.n.Wa(n,r,i);default:z("bad ioctl syscall "+r)}}catch(e){return void 0!==dc&&e instanceof O||z(e),-e.Q}},___unlock:function(){},___syscall140:function(e,t){ec=t;try{var n=fc(),r=X(),i=X(),a=X(),o=X();return assert(0===r),Wb(n,i,o),F[a>>2]=n.position,n.ia&&0===i&&0===o&&(n.ia=null),0}catch(e){return void 0!==dc&&e instanceof O||z(e),-e.Q}},_pthread_cleanup_push:eb,_sysconf:function(e){switch(e){case 30:return 4096;case 85:return I/4096;case 132:case 133:case 12:case 137:case 138:case 15:case 235:case 16:case 17:case 18:case 19:case 20:case 149:case 13:case 10:case 236:case 153:case 9:case 21:case 22:case 159:case 154:case 14:case 77:case 78:case 139:case 80:case 81:case 82:case 68:case 67:case 164:case 11:case 29:case 47:case 48:case 95:case 52:case 51:case 46:return 200809;case 79:return 0;case 27:case 246:case 127:case 128:case 23:case 24:case 160:case 161:case 181:case 182:case 242:case 183:case 184:case 243:case 244:case 245:case 165:case 178:case 179:case 49:case 50:case 168:case 169:case 175:case 170:case 171:case 172:case 97:case 76:case 32:case 173:case 35:return-1;case 176:case 177:case 7:case 155:case 8:case 157:case 125:case 126:case 92:case 93:case 129:case 130:case 131:case 94:case 91:return 1;case 74:case 60:case 69:case 70:case 4:return 1024;case 31:case 42:case 72:return 32;case 87:case 26:case 33:return 2147483647;case 34:case 1:return 47839;case 38:case 36:return 99;case 43:case 37:return 2048;case 0:return 2097152;case 3:return 65536;case 28:return 32768;case 44:return 32767;case 75:return 16384;case 39:return 1e3;case 89:return 700;case 71:return 256;case 40:return 255;case 2:return 100;case 180:return 64;case 25:return 20;case 5:return 16;case 6:return 6;case 73:return 4;case 84:return"object"==typeof navigator&&navigator.hardwareConcurrency||1}return ib(M.u),-1},___syscall146:function(e,t){ec=t;try{var n,r=fc(),i=X();e:{for(var a=X(),o=0,s=0;s<a;s++){var l=Xb(r,D,F[i+8*s>>2],F[i+(8*s+4)>>2],void 0);if(0>l){n=-1;break e}o+=l}n=o}return n}catch(e){return void 0!==dc&&e instanceof O||z(e),-e.Q}},STACKTOP:m,STACK_MAX:La,tempDoublePtr:$a,ABORT:A,cttz_i8:Xc};var Z=function(e,t,n){var r=new e.Int8Array(n),i=(new e.Int16Array(n),new e.Int32Array(n)),a=new e.Uint8Array(n),o=(new e.Uint16Array(n),new e.Uint32Array(n),new e.Float32Array(n),new e.Float64Array(n),0|t.STACKTOP),s=(t.STACK_MAX,t.tempDoublePtr,t.ABORT,t.cttz_i8,0),l=(e.NaN,e.Infinity,0),c=(e.Math.floor,e.Math.abs,e.Math.sqrt,e.Math.pow,e.Math.cos,e.Math.sin,e.Math.tan,e.Math.acos,e.Math.asin,e.Math.atan,e.Math.atan2,e.Math.exp,e.Math.log,e.Math.ceil,e.Math.imul),d=(e.Math.min,e.Math.clz32,t.abort),u=(t.assert,t.invoke_ii,t.invoke_iiii,t.invoke_vi,t._pthread_cleanup_pop),p=t.___lock,f=(t._emscripten_set_main_loop,t._pthread_self),h=t.___syscall6,_=(t._emscripten_set_main_loop_timing,t._abort),g=t._sbrk,m=t._time,y=(t.___setErrNo,t._emscripten_memcpy_big),E=t.___syscall54,S=t.___unlock,v=t.___syscall140,T=t._pthread_cleanup_push,b=t._sysconf,C=t.___syscall146;function A(e,t,n){e|=0;var r,a=0,s=0,c=0,d=0,u=0,p=0,f=0,h=0,_=0,g=0,m=0;r=o,o=o+160|0,P(a=r,t|=0,n|=0),t=0|i[(n=a+144|0)>>2],s=0|i[n+4>>2],d=0|i[(c=n=a+64|0)>>2],u=0|i[c+4>>2],c=0|F(0|t,0|s,18,0),p=l,f=0|U(0|d,0|u,0|t,0|s),s=0|U(0|f,0|l,0|c,0|p),i[(p=n)>>2]=s,i[p+4>>2]=l,s=0|i[(p=a+136|0)>>2],n=0|i[p+4>>2],f=0|i[(c=p=a+56|0)>>2],t=0|i[c+4>>2],c=0|F(0|s,0|n,18,0),u=l,d=0|U(0|f,0|t,0|s,0|n),n=0|U(0|d,0|l,0|c,0|u),i[(u=p)>>2]=n,i[u+4>>2]=l,n=0|i[(u=a+128|0)>>2],p=0|i[u+4>>2],d=0|i[(c=u=a+48|0)>>2],s=0|i[c+4>>2],c=0|F(0|n,0|p,18,0),t=l,f=0|U(0|d,0|s,0|n,0|p),p=0|U(0|f,0|l,0|c,0|t),i[(t=u)>>2]=p,i[t+4>>2]=l,p=0|i[(t=a+120|0)>>2],u=0|i[t+4>>2],f=0|i[(c=t=a+40|0)>>2],n=0|i[c+4>>2],c=0|F(0|p,0|u,18,0),s=l,d=0|U(0|f,0|n,0|p,0|u),u=0|U(0|d,0|l,0|c,0|s),i[(s=t)>>2]=u,i[s+4>>2]=l,u=0|i[(s=a+112|0)>>2],t=0|i[s+4>>2],d=0|i[(c=s=a+32|0)>>2],p=0|i[c+4>>2],c=0|F(0|u,0|t,18,0),n=l,f=0|U(0|d,0|p,0|u,0|t),t=0|U(0|f,0|l,0|c,0|n),i[(n=s)>>2]=t,i[n+4>>2]=l,t=0|i[(n=a+104|0)>>2],s=0|i[n+4>>2],f=0|i[(c=n=a+24|0)>>2],u=0|i[c+4>>2],c=0|F(0|t,0|s,18,0),p=l,d=0|U(0|f,0|u,0|t,0|s),s=0|U(0|d,0|l,0|c,0|p),i[(p=n)>>2]=s,i[p+4>>2]=l,s=0|i[(p=a+96|0)>>2],n=0|i[p+4>>2],d=0|i[(c=p=a+16|0)>>2],t=0|i[c+4>>2],c=0|F(0|s,0|n,18,0),u=l,f=0|U(0|d,0|t,0|s,0|n),n=0|U(0|f,0|l,0|c,0|u),i[(u=p)>>2]=n,i[u+4>>2]=l,n=0|i[(u=a+88|0)>>2],p=0|i[u+4>>2],f=0|i[(c=u=a+8|0)>>2],s=0|i[c+4>>2],c=0|F(0|n,0|p,18,0),t=l,d=0|U(0|f,0|s,0|n,0|p),p=0|U(0|d,0|l,0|c,0|t),i[(t=u)>>2]=p,i[t+4>>2]=l,c=0|i[(p=t=a+80|0)>>2],d=0|i[p+4>>2],n=0|i[(p=a)>>2],s=0|i[p+4>>2],p=0|F(0|c,0|d,18,0),f=l,h=0|U(0|n,0|s,0|c,0|d),d=0|U(0|h,0|l,0|p,0|f),f=l,i[(p=a)>>2]=d,i[p+4>>2]=f,i[(p=t)>>2]=0,i[p+4>>2]=0,p=f,f=d,d=0;do{n=0|k(0|f,0|p,0|(s=0|B(0|(c=0|N(0|(h=0|U(p>>31>>>6|0,0,0|f,0|p)),0|l,26)),0|(h=l),26)),0|l),i[(s=a+(d<<3)|0)>>2]=n,i[s+4>>2]=l,m=0|k(0|(_=0|U(0|c,0|h,0|i[(n=s=a+((1|d)<<3)|0)>>2],0|i[n+4>>2])),0|(n=l),0|(g=0|B(0|(c=0|N(0|(h=0|U(n>>31>>>7|0,0,0|_,0|n)),0|l,25)),0|(h=l),25)),0|l),i[(g=s)>>2]=m,i[g+4>>2]=l,f=0|U(0|c,0|h,0|i[(m=g=a+((d=d+2|0)<<3)|0)>>2],0|i[m+4>>2]),p=l,i[(m=g)>>2]=f,i[m+4>>2]=p}while(d>>>0<10);p=0|i[(d=t)>>2],f=0|i[d+4>>2],m=0|i[(d=a)>>2],g=0|i[d+4>>2],d=0|F(0|p,0|f,18,0),h=l,c=0|U(0|m,0|g,0|p,0|f),f=0|U(0|c,0|l,0|d,0|h),h=l,i[(d=t)>>2]=0,i[d+4>>2]=0,p=0|k(0|f,0|h,0|(c=0|B(0|(t=0|N(0|(d=0|U(h>>31>>>6|0,0,0|f,0|h)),0|l,26)),0|(d=l),26)),0|l),i[(c=a)>>2]=p,i[c+4>>2]=l,p=0|U(0|t,0|d,0|i[(c=u)>>2],0|i[c+4>>2]),i[(c=u)>>2]=p,i[c+4>>2]=l,c=e,e=a,a=c+80|0;do{i[c>>2]=i[e>>2],c=c+4|0,e=e+4|0}while((0|c)<(0|a));o=r}function P(e,t,n){e|=0,n|=0;var r=0,a=0,o=0,s=0,c=0,d=0,u=0,p=0,f=0,h=0,_=0,g=0,m=0,y=0,E=0,S=0,v=0,T=0,b=0,C=0,A=0,P=0,M=0;r=0|N(0,0|i[(t|=0)>>2],32),a=l,s=0|F(0|(o=0|N(0,0|i[n>>2],32)),0|l,0|r,0|a),i[(a=e)>>2]=s,i[a+4>>2]=l,a=0|N(0,0|i[t>>2],32),s=l,c=0|F(0|(o=0|N(0,0|i[(r=n+8|0)>>2],32)),0|l,0|a,0|s),s=l,o=0|N(0,0|i[(a=t+8|0)>>2],32),d=l,d=0|U(0|(p=0|F(0|(u=0|N(0,0|i[n>>2],32)),0|l,0|o,0|d)),0|l,0|c,0|s),i[(s=e+8|0)>>2]=d,i[s+4>>2]=l,s=0|N(0,0|i[a>>2],31),d=l,p=0|F(0|(c=0|N(0,0|i[r>>2],32)),0|l,0|s,0|d),d=l,s=0|N(0,0|i[t>>2],32),c=l,c=0|U(0|(f=0|F(0|(u=0|N(0,0|i[(o=n+16|0)>>2],32)),0|l,0|s,0|c)),0|l,0|p,0|d),d=l,f=0|N(0,0|i[(p=t+16|0)>>2],32),s=l,s=0|U(0|c,0|d,0|(h=0|F(0|(u=0|N(0,0|i[n>>2],32)),0|l,0|f,0|s)),0|l),i[(h=e+16|0)>>2]=s,i[h+4>>2]=l,h=0|N(0,0|i[a>>2],32),s=l,c=0|F(0|(d=0|N(0,0|i[o>>2],32)),0|l,0|h,0|s),s=l,h=0|N(0,0|i[p>>2],32),d=l,d=0|U(0|(u=0|F(0|(f=0|N(0,0|i[r>>2],32)),0|l,0|h,0|d)),0|l,0|c,0|s),s=l,c=0|N(0,0|i[t>>2],32),u=l,u=0|U(0|d,0|s,0|(_=0|F(0|(f=0|N(0,0|i[(h=n+24|0)>>2],32)),0|l,0|c,0|u)),0|l),_=l,d=0|N(0,0|i[(s=t+24|0)>>2],32),c=l,c=0|U(0|u,0|_,0|(g=0|F(0|(f=0|N(0,0|i[n>>2],32)),0|l,0|d,0|c)),0|l),i[(g=e+24|0)>>2]=c,i[g+4>>2]=l,g=0|N(0,0|i[p>>2],32),c=l,u=0|F(0|(_=0|N(0,0|i[o>>2],32)),0|l,0|g,0|c),c=l,g=0|N(0,0|i[a>>2],32),_=l,f=0|F(0|(d=0|N(0,0|i[h>>2],32)),0|l,0|g,0|_),_=l,g=0|N(0,0|i[s>>2],32),d=l,d=0|U(0|(y=0|F(0|(m=0|N(0,0|i[r>>2],32)),0|l,0|g,0|d)),0|l,0|f,0|_),d=0|U(0|(_=0|B(0|d,0|l,1)),0|l,0|u,0|c),c=l,u=0|N(0,0|i[t>>2],32),_=l,_=0|U(0|d,0|c,0|(g=0|F(0|(y=0|N(0,0|i[(f=n+32|0)>>2],32)),0|l,0|u,0|_)),0|l),g=l,d=0|N(0,0|i[(c=t+32|0)>>2],32),u=l,u=0|U(0|_,0|g,0|(m=0|F(0|(y=0|N(0,0|i[n>>2],32)),0|l,0|d,0|u)),0|l),i[(m=e+32|0)>>2]=u,i[m+4>>2]=l,m=0|N(0,0|i[p>>2],32),u=l,_=0|F(0|(g=0|N(0,0|i[h>>2],32)),0|l,0|m,0|u),u=l,m=0|N(0,0|i[s>>2],32),g=l,g=0|U(0|(y=0|F(0|(d=0|N(0,0|i[o>>2],32)),0|l,0|m,0|g)),0|l,0|_,0|u),u=l,_=0|N(0,0|i[a>>2],32),y=l,y=0|U(0|g,0|u,0|(d=0|F(0|(m=0|N(0,0|i[f>>2],32)),0|l,0|_,0|y)),0|l),d=l,u=0|N(0,0|i[c>>2],32),g=l,g=0|U(0|y,0|d,0|(m=0|F(0|(_=0|N(0,0|i[r>>2],32)),0|l,0|u,0|g)),0|l),m=l,d=0|N(0,0|i[t>>2],32),y=l,y=0|U(0|g,0|m,0|(E=0|F(0|(_=0|N(0,0|i[(u=n+40|0)>>2],32)),0|l,0|d,0|y)),0|l),E=l,g=0|N(0,0|i[(m=t+40|0)>>2],32),d=l,d=0|U(0|y,0|E,0|(S=0|F(0|(_=0|N(0,0|i[n>>2],32)),0|l,0|g,0|d)),0|l),i[(S=e+40|0)>>2]=d,i[S+4>>2]=l,S=0|N(0,0|i[s>>2],32),d=l,y=0|F(0|(E=0|N(0,0|i[h>>2],32)),0|l,0|S,0|d),d=l,S=0|N(0,0|i[a>>2],32),E=l,E=0|U(0|(_=0|F(0|(g=0|N(0,0|i[u>>2],32)),0|l,0|S,0|E)),0|l,0|y,0|d),d=l,y=0|N(0,0|i[m>>2],32),_=l,g=0|B(0|(_=0|U(0|E,0|d,0|(g=0|F(0|(S=0|N(0,0|i[r>>2],32)),0|l,0|y,0|_)),0|l)),0|l,1),_=l,d=0|N(0,0|i[p>>2],32),E=l,E=0|U(0|g,0|_,0|(S=0|F(0|(y=0|N(0,0|i[f>>2],32)),0|l,0|d,0|E)),0|l),S=l,_=0|N(0,0|i[c>>2],32),g=l,g=0|U(0|E,0|S,0|(y=0|F(0|(d=0|N(0,0|i[o>>2],32)),0|l,0|_,0|g)),0|l),y=l,S=0|N(0,0|i[t>>2],32),E=l,E=0|U(0|g,0|y,0|(v=0|F(0|(d=0|N(0,0|i[(_=n+48|0)>>2],32)),0|l,0|S,0|E)),0|l),v=l,g=0|N(0,0|i[(y=t+48|0)>>2],32),S=l,S=0|U(0|E,0|v,0|(T=0|F(0|(d=0|N(0,0|i[n>>2],32)),0|l,0|g,0|S)),0|l),i[(T=e+48|0)>>2]=S,i[T+4>>2]=l,T=0|N(0,0|i[s>>2],32),S=l,E=0|F(0|(v=0|N(0,0|i[f>>2],32)),0|l,0|T,0|S),S=l,T=0|N(0,0|i[c>>2],32),v=l,v=0|U(0|(d=0|F(0|(g=0|N(0,0|i[h>>2],32)),0|l,0|T,0|v)),0|l,0|E,0|S),S=l,E=0|N(0,0|i[p>>2],32),d=l,d=0|U(0|v,0|S,0|(g=0|F(0|(T=0|N(0,0|i[u>>2],32)),0|l,0|E,0|d)),0|l),g=l,S=0|N(0,0|i[m>>2],32),v=l,v=0|U(0|d,0|g,0|(T=0|F(0|(E=0|N(0,0|i[o>>2],32)),0|l,0|S,0|v)),0|l),T=l,g=0|N(0,0|i[a>>2],32),d=l,d=0|U(0|v,0|T,0|(E=0|F(0|(S=0|N(0,0|i[_>>2],32)),0|l,0|g,0|d)),0|l),E=l,T=0|N(0,0|i[y>>2],32),v=l,v=0|U(0|d,0|E,0|(S=0|F(0|(g=0|N(0,0|i[r>>2],32)),0|l,0|T,0|v)),0|l),S=l,E=0|N(0,0|i[t>>2],32),d=l,d=0|U(0|v,0|S,0|(b=0|F(0|(g=0|N(0,0|i[(T=n+56|0)>>2],32)),0|l,0|E,0|d)),0|l),b=l,v=0|N(0,0|i[(S=t+56|0)>>2],32),E=l,E=0|U(0|d,0|b,0|(C=0|F(0|(g=0|N(0,0|i[n>>2],32)),0|l,0|v,0|E)),0|l),i[(C=e+56|0)>>2]=E,i[C+4>>2]=l,C=0|N(0,0|i[c>>2],32),E=l,d=0|F(0|(b=0|N(0,0|i[f>>2],32)),0|l,0|C,0|E),E=l,C=0|N(0,0|i[s>>2],32),b=l,g=0|F(0|(v=0|N(0,0|i[u>>2],32)),0|l,0|C,0|b),b=l,C=0|N(0,0|i[m>>2],32),v=l,v=0|U(0|(P=0|F(0|(A=0|N(0,0|i[h>>2],32)),0|l,0|C,0|v)),0|l,0|g,0|b),b=l,g=0|N(0,0|i[a>>2],32),P=l,P=0|U(0|v,0|b,0|(A=0|F(0|(C=0|N(0,0|i[T>>2],32)),0|l,0|g,0|P)),0|l),A=l,b=0|N(0,0|i[S>>2],32),v=l,v=0|U(0|P,0|A,0|(C=0|F(0|(g=0|N(0,0|i[r>>2],32)),0|l,0|b,0|v)),0|l),v=0|U(0|(C=0|B(0|v,0|l,1)),0|l,0|d,0|E),E=l,d=0|N(0,0|i[p>>2],32),C=l,C=0|U(0|v,0|E,0|(P=0|F(0|(A=0|N(0,0|i[_>>2],32)),0|l,0|d,0|C)),0|l),P=l,E=0|N(0,0|i[y>>2],32),v=l,v=0|U(0|C,0|P,0|(A=0|F(0|(d=0|N(0,0|i[o>>2],32)),0|l,0|E,0|v)),0|l),A=l,P=0|N(0,0|i[t>>2],32),C=l,C=0|U(0|v,0|A,0|(b=0|F(0|(d=0|N(0,0|i[(E=n+64|0)>>2],32)),0|l,0|P,0|C)),0|l),b=l,v=0|N(0,0|i[(A=t+64|0)>>2],32),P=l,P=0|U(0|C,0|b,0|(g=0|F(0|(d=0|N(0,0|i[n>>2],32)),0|l,0|v,0|P)),0|l),i[(g=e+64|0)>>2]=P,i[g+4>>2]=l,g=0|N(0,0|i[c>>2],32),P=l,C=0|F(0|(b=0|N(0,0|i[u>>2],32)),0|l,0|g,0|P),P=l,g=0|N(0,0|i[m>>2],32),b=l,b=0|U(0|(d=0|F(0|(v=0|N(0,0|i[f>>2],32)),0|l,0|g,0|b)),0|l,0|C,0|P),P=l,C=0|N(0,0|i[s>>2],32),d=l,d=0|U(0|b,0|P,0|(v=0|F(0|(g=0|N(0,0|i[_>>2],32)),0|l,0|C,0|d)),0|l),v=l,P=0|N(0,0|i[y>>2],32),b=l,b=0|U(0|d,0|v,0|(g=0|F(0|(C=0|N(0,0|i[h>>2],32)),0|l,0|P,0|b)),0|l),g=l,v=0|N(0,0|i[p>>2],32),d=l,d=0|U(0|b,0|g,0|(C=0|F(0|(P=0|N(0,0|i[T>>2],32)),0|l,0|v,0|d)),0|l),C=l,g=0|N(0,0|i[S>>2],32),b=l,b=0|U(0|d,0|C,0|(P=0|F(0|(v=0|N(0,0|i[o>>2],32)),0|l,0|g,0|b)),0|l),P=l,C=0|N(0,0|i[a>>2],32),d=l,d=0|U(0|b,0|P,0|(v=0|F(0|(g=0|N(0,0|i[E>>2],32)),0|l,0|C,0|d)),0|l),v=l,P=0|N(0,0|i[A>>2],32),b=l,b=0|U(0|d,0|v,0|(g=0|F(0|(C=0|N(0,0|i[r>>2],32)),0|l,0|P,0|b)),0|l),g=l,v=0|N(0,0|i[t>>2],32),d=l,d=0|U(0|b,0|g,0|(M=0|F(0|(C=0|N(0,0|i[(P=n+72|0)>>2],32)),0|l,0|v,0|d)),0|l),M=l,t=0|N(0,0|i[(g=t+72|0)>>2],32),b=l,b=0|U(0|d,0|M,0|(n=0|F(0|(v=0|N(0,0|i[n>>2],32)),0|l,0|t,0|b)),0|l),i[(n=e+72|0)>>2]=b,i[n+4>>2]=l,n=0|N(0,0|i[m>>2],32),b=l,d=0|F(0|(M=0|N(0,0|i[u>>2],32)),0|l,0|n,0|b),b=l,n=0|N(0,0|i[s>>2],32),M=l,M=0|U(0|(v=0|F(0|(t=0|N(0,0|i[T>>2],32)),0|l,0|n,0|M)),0|l,0|d,0|b),b=l,d=0|N(0,0|i[S>>2],32),v=l,v=0|U(0|M,0|b,0|(t=0|F(0|(n=0|N(0,0|i[h>>2],32)),0|l,0|d,0|v)),0|l),t=l,b=0|N(0,0|i[a>>2],32),a=l,a=0|U(0|v,0|t,0|(d=0|F(0|(M=0|N(0,0|i[P>>2],32)),0|l,0|b,0|a)),0|l),d=l,t=0|N(0,0|i[g>>2],32),v=l,r=0|B(0|(v=0|U(0|a,0|d,0|(r=0|F(0|(b=0|N(0,0|i[r>>2],32)),0|l,0|t,0|v)),0|l)),0|l,1),v=l,d=0|N(0,0|i[c>>2],32),a=l,a=0|U(0|r,0|v,0|(b=0|F(0|(t=0|N(0,0|i[_>>2],32)),0|l,0|d,0|a)),0|l),b=l,v=0|N(0,0|i[y>>2],32),r=l,r=0|U(0|a,0|b,0|(t=0|F(0|(d=0|N(0,0|i[f>>2],32)),0|l,0|v,0|r)),0|l),t=l,b=0|N(0,0|i[p>>2],32),a=l,a=0|U(0|r,0|t,0|(d=0|F(0|(v=0|N(0,0|i[E>>2],32)),0|l,0|b,0|a)),0|l),d=l,t=0|N(0,0|i[A>>2],32),r=l,r=0|U(0|a,0|d,0|(v=0|F(0|(b=0|N(0,0|i[o>>2],32)),0|l,0|t,0|r)),0|l),i[(v=e+80|0)>>2]=r,i[v+4>>2]=l,v=0|N(0,0|i[m>>2],32),r=l,a=0|F(0|(d=0|N(0,0|i[_>>2],32)),0|l,0|v,0|r),r=l,v=0|N(0,0|i[y>>2],32),d=l,d=0|U(0|(b=0|F(0|(t=0|N(0,0|i[u>>2],32)),0|l,0|v,0|d)),0|l,0|a,0|r),r=l,a=0|N(0,0|i[c>>2],32),b=l,b=0|U(0|d,0|r,0|(t=0|F(0|(v=0|N(0,0|i[T>>2],32)),0|l,0|a,0|b)),0|l),t=l,r=0|N(0,0|i[S>>2],32),d=l,d=0|U(0|b,0|t,0|(v=0|F(0|(a=0|N(0,0|i[f>>2],32)),0|l,0|r,0|d)),0|l),v=l,t=0|N(0,0|i[s>>2],32),b=l,b=0|U(0|d,0|v,0|(a=0|F(0|(r=0|N(0,0|i[E>>2],32)),0|l,0|t,0|b)),0|l),a=l,v=0|N(0,0|i[A>>2],32),d=l,d=0|U(0|b,0|a,0|(r=0|F(0|(t=0|N(0,0|i[h>>2],32)),0|l,0|v,0|d)),0|l),r=l,a=0|N(0,0|i[p>>2],32),p=l,p=0|U(0|d,0|r,0|(v=0|F(0|(b=0|N(0,0|i[P>>2],32)),0|l,0|a,0|p)),0|l),v=l,r=0|N(0,0|i[g>>2],32),d=l,d=0|U(0|p,0|v,0|(o=0|F(0|(a=0|N(0,0|i[o>>2],32)),0|l,0|r,0|d)),0|l),i[(o=e+88|0)>>2]=d,i[o+4>>2]=l,o=0|N(0,0|i[y>>2],32),d=l,p=0|F(0|(v=0|N(0,0|i[_>>2],32)),0|l,0|o,0|d),d=l,o=0|N(0,0|i[m>>2],32),v=l,a=0|F(0|(r=0|N(0,0|i[T>>2],32)),0|l,0|o,0|v),v=l,o=0|N(0,0|i[S>>2],32),r=l,r=0|U(0|(t=0|F(0|(b=0|N(0,0|i[u>>2],32)),0|l,0|o,0|r)),0|l,0|a,0|v),v=l,a=0|N(0,0|i[s>>2],32),s=l,s=0|U(0|r,0|v,0|(o=0|F(0|(t=0|N(0,0|i[P>>2],32)),0|l,0|a,0|s)),0|l),o=l,v=0|N(0,0|i[g>>2],32),r=l,r=0|U(0|s,0|o,0|(h=0|F(0|(a=0|N(0,0|i[h>>2],32)),0|l,0|v,0|r)),0|l),r=0|U(0|(h=0|B(0|r,0|l,1)),0|l,0|p,0|d),d=l,p=0|N(0,0|i[c>>2],32),h=l,h=0|U(0|r,0|d,0|(s=0|F(0|(o=0|N(0,0|i[E>>2],32)),0|l,0|p,0|h)),0|l),s=l,d=0|N(0,0|i[A>>2],32),r=l,r=0|U(0|h,0|s,0|(o=0|F(0|(p=0|N(0,0|i[f>>2],32)),0|l,0|d,0|r)),0|l),i[(o=e+96|0)>>2]=r,i[o+4>>2]=l,o=0|N(0,0|i[y>>2],32),r=l,h=0|F(0|(s=0|N(0,0|i[T>>2],32)),0|l,0|o,0|r),r=l,o=0|N(0,0|i[S>>2],32),s=l,s=0|U(0|(p=0|F(0|(d=0|N(0,0|i[_>>2],32)),0|l,0|o,0|s)),0|l,0|h,0|r),r=l,h=0|N(0,0|i[m>>2],32),p=l,p=0|U(0|s,0|r,0|(d=0|F(0|(o=0|N(0,0|i[E>>2],32)),0|l,0|h,0|p)),0|l),d=l,r=0|N(0,0|i[A>>2],32),s=l,s=0|U(0|p,0|d,0|(o=0|F(0|(h=0|N(0,0|i[u>>2],32)),0|l,0|r,0|s)),0|l),o=l,d=0|N(0,0|i[c>>2],32),c=l,c=0|U(0|s,0|o,0|(r=0|F(0|(p=0|N(0,0|i[P>>2],32)),0|l,0|d,0|c)),0|l),r=l,o=0|N(0,0|i[g>>2],32),s=l,s=0|U(0|c,0|r,0|(f=0|F(0|(d=0|N(0,0|i[f>>2],32)),0|l,0|o,0|s)),0|l),i[(f=e+104|0)>>2]=s,i[f+4>>2]=l,f=0|N(0,0|i[S>>2],32),s=l,c=0|F(0|(r=0|N(0,0|i[T>>2],32)),0|l,0|f,0|s),s=l,f=0|N(0,0|i[m>>2],32),m=l,m=0|U(0|(o=0|F(0|(r=0|N(0,0|i[P>>2],32)),0|l,0|f,0|m)),0|l,0|c,0|s),s=l,c=0|N(0,0|i[g>>2],32),o=l,u=0|B(0|(o=0|U(0|m,0|s,0|(u=0|F(0|(f=0|N(0,0|i[u>>2],32)),0|l,0|c,0|o)),0|l)),0|l,1),o=l,s=0|N(0,0|i[y>>2],32),m=l,m=0|U(0|u,0|o,0|(f=0|F(0|(c=0|N(0,0|i[E>>2],32)),0|l,0|s,0|m)),0|l),f=l,o=0|N(0,0|i[A>>2],32),u=l,u=0|U(0|m,0|f,0|(c=0|F(0|(s=0|N(0,0|i[_>>2],32)),0|l,0|o,0|u)),0|l),i[(c=e+112|0)>>2]=u,i[c+4>>2]=l,c=0|N(0,0|i[S>>2],32),u=l,m=0|F(0|(f=0|N(0,0|i[E>>2],32)),0|l,0|c,0|u),u=l,c=0|N(0,0|i[A>>2],32),f=l,f=0|U(0|(s=0|F(0|(o=0|N(0,0|i[T>>2],32)),0|l,0|c,0|f)),0|l,0|m,0|u),u=l,m=0|N(0,0|i[y>>2],32),y=l,y=0|U(0|f,0|u,0|(c=0|F(0|(s=0|N(0,0|i[P>>2],32)),0|l,0|m,0|y)),0|l),c=l,u=0|N(0,0|i[g>>2],32),f=l,f=0|U(0|y,0|c,0|(_=0|F(0|(m=0|N(0,0|i[_>>2],32)),0|l,0|u,0|f)),0|l),i[(_=e+120|0)>>2]=f,i[_+4>>2]=l,_=0|N(0,0|i[A>>2],32),f=l,y=0|F(0|(c=0|N(0,0|i[E>>2],32)),0|l,0|_,0|f),f=l,_=0|N(0,0|i[S>>2],32),S=l,u=0|F(0|(c=0|N(0,0|i[P>>2],32)),0|l,0|_,0|S),S=l,_=0|N(0,0|i[g>>2],32),c=l,c=0|U(0|(T=0|F(0|(m=0|N(0,0|i[T>>2],32)),0|l,0|_,0|c)),0|l,0|u,0|S),c=0|U(0|(S=0|B(0|c,0|l,1)),0|l,0|y,0|f),i[(f=e+128|0)>>2]=c,i[f+4>>2]=l,f=0|N(0,0|i[A>>2],32),A=l,y=0|F(0|(c=0|N(0,0|i[P>>2],32)),0|l,0|f,0|A),A=l,f=0|N(0,0|i[g>>2],32),c=l,c=0|U(0|(E=0|F(0|(S=0|N(0,0|i[E>>2],32)),0|l,0|f,0|c)),0|l,0|y,0|A),i[(A=e+136|0)>>2]=c,i[A+4>>2]=l,A=0|N(0,0|i[g>>2],31),g=l,P=0|F(0|(c=0|N(0,0|i[P>>2],32)),0|l,0|A,0|g),i[(g=e+144|0)>>2]=P,i[g+4>>2]=l}function M(e,t){e|=0;var n,r,a,s=0,c=0,d=0,u=0,p=0,f=0,h=0,_=0,g=0,m=0,y=0,E=0,S=0,v=0,T=0,b=0,C=0,A=0,P=0,M=0,O=0,I=0,w=0,R=0,D=0,L=0,G=0,x=0,j=0,Y=0,K=0,W=0,H=0,V=0,$=0,z=0,q=0;n=o,o=o+160|0,s=n,u=0|F(0|(r=0|N(0,0|(c=0|i[(t|=0)>>2]),32)),0|(d=l),0|r,0|d),i[(p=s)>>2]=u,i[p+4>>2]=l,p=0|N(0,0|c,31),c=l,g=0|F(0|(h=0|N(0,0|(f=0|i[(u=t+8|0)>>2]),32)),0|(_=l),0|p,0|c),i[(m=a=s+8|0)>>2]=g,i[m+4>>2]=l,m=0|F(0|h,0|_,0|h,0|_),g=l,g=0|B(0|(T=0|U(0|(v=0|F(0|(E=0|N(0,0|i[(y=t+16|0)>>2],32)),0|(S=l),0|r,0|d)),0|l,0|m,0|g)),0|l,1),i[(m=T=s+16|0)>>2]=g,i[m+4>>2]=l,m=0|F(0|E,0|S,0|h,0|_),g=l,g=0|B(0|(P=0|U(0|(A=0|F(0|(b=0|N(0,0|i[(v=t+24|0)>>2],32)),0|(C=l),0|r,0|d)),0|l,0|m,0|g)),0|l,1),i[(m=P=s+24|0)>>2]=g,i[m+4>>2]=l,m=0|F(0|E,0|S,0|E,0|S),g=l,A=0|U(0|(M=0|F(0|b,0|C,0|(A=0|N(0,0|f,30)),0|l)),0|l,0|m,0|g),c=0|U(0|A,0|(g=l),0|(I=0|F(0|(M=0|N(0,0|i[(m=t+32|0)>>2],32)),0|(O=l),0|p,0|c)),0|l),i[(g=I=s+32|0)>>2]=c,i[g+4>>2]=l,g=0|F(0|b,0|C,0|E,0|S),c=l,p=0|U(0|(A=0|F(0|M,0|O,0|h,0|_)),0|l,0|g,0|c),R=0|B(0|(D=0|U(0|p,0|(c=l),0|(R=0|F(0|(A=0|N(0,0|i[(g=t+40|0)>>2],32)),0|(w=l),0|r,0|d)),0|l)),0|l,1),i[(c=D=s+40|0)>>2]=R,i[c+4>>2]=l,c=0|F(0|b,0|C,0|b,0|C),R=l,L=0|U(0|(p=0|F(0|M,0|O,0|E,0|S)),0|l,0|c,0|R),j=0|U(0|L,0|(R=l),0|(x=0|F(0|(p=0|N(0,0|i[(c=t+48|0)>>2],32)),0|(G=l),0|r,0|d)),0|l),f=0|B(0|(R=0|U(0|j,0|(x=l),0|(f=0|F(0|A,0|w,0|(R=0|N(0,0|f,31)),0|l)),0|l)),0|l,1),i[(x=R=s+48|0)>>2]=f,i[x+4>>2]=l,x=0|F(0|M,0|O,0|b,0|C),f=l,L=0|U(0|(j=0|F(0|A,0|w,0|E,0|S)),0|l,0|x,0|f),j=0|U(0|L,0|(f=l),0|(x=0|F(0|p,0|G,0|h,0|_)),0|l),K=0|B(0|(W=0|U(0|j,0|(x=l),0|(K=0|F(0|(L=0|N(0,0|i[(f=t+56|0)>>2],32)),0|(Y=l),0|r,0|d)),0|l)),0|l,1),i[(x=W=s+56|0)>>2]=K,i[x+4>>2]=l,x=0|F(0|M,0|O,0|M,0|O),K=l,j=0|F(0|p,0|G,0|E,0|S),H=l,d=0|U(0|(q=0|F(0|($=0|N(0,0|i[(V=t+64|0)>>2],32)),0|(z=l),0|r,0|d)),0|l,0|j,0|H),H=l,j=0|F(0|L,0|Y,0|h,0|_),_=l,q=0|U(0|(h=0|F(0|A,0|w,0|b,0|C)),0|l,0|j,0|_),q=0|U(0|d,0|H,0|(_=0|B(0|q,0|l,1)),0|l),q=0|U(0|(_=0|B(0|q,0|l,1)),0|l,0|x,0|K),i[(x=K=s+64|0)>>2]=q,i[x+4>>2]=l,x=0|F(0|A,0|w,0|M,0|O),q=l,C=0|U(0|(_=0|F(0|p,0|G,0|b,0|C)),0|l,0|x,0|q),S=0|U(0|C,0|(q=l),0|(x=0|F(0|L,0|Y,0|E,0|S)),0|l),E=0|U(0|S,0|(x=l),0|(C=0|F(0|$,0|z,0|(q=0|N(0,0|i[u>>2],32)),0|(u=l))),0|l),C=l,x=0|N(0,0|i[t>>2],32),S=l,H=0|B(0|(S=0|U(0|E,0|C,0|(H=0|F(0|(t=0|N(0,0|(_=0|i[t+72>>2]),32)),0|(b=l),0|x,0|S)),0|l)),0|l,1),i[(S=s+72|0)>>2]=H,i[S+4>>2]=l,S=0|F(0|A,0|w,0|A,0|w),H=l,O=0|U(0|(C=0|F(0|p,0|G,0|M,0|O)),0|l,0|S,0|H),M=0|U(0|O,0|(H=l),0|(C=0|F(0|$,0|z,0|(S=0|N(0,0|i[y>>2],32)),0|(y=l))),0|l),C=l,O=0|F(0|L,0|Y,0|(H=0|N(0,0|i[v>>2],32)),0|(v=l)),E=l,E=0|B(0|(u=0|U(0|(x=0|F(0|t,0|b,0|q,0|u)),0|l,0|O,0|E)),0|l,1),E=0|B(0|(u=0|U(0|M,0|C,0|E,0|l)),0|l,1),i[(C=u=s+80|0)>>2]=E,i[C+4>>2]=l,C=0|F(0|p,0|G,0|A,0|w),w=l,M=0|U(0|(E=0|F(0|L,0|Y,0|(A=0|N(0,0|i[m>>2],32)),0|(m=l))),0|l,0|C,0|w),E=0|U(0|M,0|(w=l),0|(C=0|F(0|$,0|z,0|H,0|v)),0|l),C=0|B(0|(y=0|U(0|E,0|(C=l),0|(w=0|F(0|t,0|b,0|S,0|y)),0|l)),0|(w=l),1),E=l,i[(S=s+88|0)>>2]=C,i[S+4>>2]=E,S=0|F(0|p,0|G,0|p,0|G),G=l,p=0|F(0|$,0|z,0|A,0|m),M=l,q=0|F(0|L,0|Y,0|(g=0|N(0,0|(O=0|i[g>>2]),32)),0|(x=l)),d=l,v=0|U(0|(j=0|F(0|t,0|b,0|H,0|v)),0|l,0|q,0|d),v=0|U(0|(d=0|B(0|v,0|l,1)),0|l,0|p,0|M),v=0|U(0|(M=0|B(0|v,0|l,1)),0|l,0|S,0|G),G=l,i[(S=s+96|0)>>2]=v,i[S+4>>2]=G,M=0|F(0|L,0|Y,0|(S=0|N(0,0|i[c>>2],32)),0|(c=l)),Y=l,x=0|U(0|(L=0|F(0|$,0|z,0|g,0|x)),0|l,0|M,0|Y),Y=0|B(0|(m=0|U(0|x,0|(Y=l),0|(M=0|F(0|t,0|b,0|A,0|m)),0|l)),0|(M=l),1),x=l,i[(A=s+104|0)>>2]=Y,i[A+4>>2]=x,g=0|F(0|(f=0|N(0,0|(A=0|i[f>>2]),32)),0|(L=l),0|f,0|L),p=l,z=0|U(0|(d=0|F(0|$,0|z,0|S,0|c)),0|l,0|g,0|p),p=0|B(0|(g=0|U(0|z,0|(p=l),0|(O=0|F(0|t,0|b,0|(g=0|N(0,0|O,31)),0|l)),0|l)),0|(O=l),1),z=l,i[(d=s+112|0)>>2]=p,i[d+4>>2]=z,q=0|F(0|(V=0|N(0,0|(d=0|i[V>>2]),32)),0|($=l),0|f,0|L),L=l,q=0|B(0|(c=0|U(0|(f=0|F(0|t,0|b,0|S,0|c)),0|l,0|q,0|L)),0|(L=l),1),f=l,i[(S=s+120|0)>>2]=q,i[S+4>>2]=f,S=0|F(0|V,0|$,0|V,0|$),$=l,V=0|U(0|(A=0|F(0|t,0|b,0|(V=0|N(0,0|A,30)),0|l)),0|l,0|S,0|$),$=l,i[(S=s+128|0)>>2]=V,i[S+4>>2]=$,d=0|F(0|t,0|b,0|(S=0|N(0,0|d,31)),0|l),S=l,i[(A=s+136|0)>>2]=d,i[A+4>>2]=S,_=0|F(0|(A=0|N(0,0|_,31)),0|l,0|t,0|b),b=l,i[(t=s+144|0)>>2]=_,i[t+4>>2]=b,A=0|i[(t=K)>>2],j=0|i[t+4>>2],t=0|F(0|_,0|b,18,0),H=l,h=0|U(0|_,0|b,0|A,0|j),j=0|U(0|h,0|l,0|t,0|H),i[(H=K)>>2]=j,i[H+4>>2]=l,j=0|i[(H=W)>>2],K=0|i[H+4>>2],H=0|F(0|d,0|S,18,0),t=l,h=0|U(0|j,0|K,0|d,0|S),S=0|U(0|h,0|l,0|H,0|t),i[(t=W)>>2]=S,i[t+4>>2]=l,S=0|i[(t=R)>>2],W=0|i[t+4>>2],t=0|F(0|V,0|$,18,0),H=l,h=0|U(0|S,0|W,0|V,0|$),$=0|U(0|h,0|l,0|t,0|H),i[(H=R)>>2]=$,i[H+4>>2]=l,$=0|i[(H=D)>>2],R=0|i[H+4>>2],H=0|F(0|c,0|L,36,0),L=l,c=0|U(0|$,0|R,0|q,0|f),f=0|U(0|c,0|l,0|H,0|L),i[(L=D)>>2]=f,i[L+4>>2]=l,f=0|i[(L=I)>>2],D=0|i[L+4>>2],L=0|F(0|g,0|O,36,0),O=l,g=0|U(0|f,0|D,0|p,0|z),z=0|U(0|g,0|l,0|L,0|O),i[(O=I)>>2]=z,i[O+4>>2]=l,z=0|i[(O=P)>>2],I=0|i[O+4>>2],O=0|F(0|m,0|M,36,0),M=l,m=0|U(0|z,0|I,0|Y,0|x),x=0|U(0|m,0|l,0|O,0|M),i[(M=P)>>2]=x,i[M+4>>2]=l,x=0|i[(M=T)>>2],P=0|i[M+4>>2],M=0|F(0|v,0|G,18,0),O=l,m=0|U(0|x,0|P,0|v,0|G),G=0|U(0|m,0|l,0|M,0|O),i[(O=T)>>2]=G,i[O+4>>2]=l,G=0|i[(O=a)>>2],T=0|i[O+4>>2],O=0|F(0|y,0|w,36,0),w=l,y=0|U(0|G,0|T,0|C,0|E),E=0|U(0|y,0|l,0|O,0|w),i[(w=a)>>2]=E,i[w+4>>2]=l,E=0|i[(w=u)>>2],O=0|i[w+4>>2],y=0|i[(w=s)>>2],C=0|i[w+4>>2],w=0|F(0|E,0|O,18,0),T=l,G=0|U(0|y,0|C,0|E,0|O),O=0|U(0|G,0|l,0|w,0|T),T=l,i[(w=s)>>2]=O,i[w+4>>2]=T,i[(w=u)>>2]=0,i[w+4>>2]=0,w=T,T=O,O=0;do{y=0|k(0|T,0|w,0|(C=0|B(0|(E=0|N(0|(G=0|U(w>>31>>>6|0,0,0|T,0|w)),0|l,26)),0|(G=l),26)),0|l),i[(C=s+(O<<3)|0)>>2]=y,i[C+4>>2]=l,v=0|k(0|(M=0|U(0|E,0|G,0|i[(y=C=s+((1|O)<<3)|0)>>2],0|i[y+4>>2])),0|(y=l),0|(m=0|B(0|(E=0|N(0|(G=0|U(y>>31>>>7|0,0,0|M,0|y)),0|l,25)),0|(G=l),25)),0|l),i[(m=C)>>2]=v,i[m+4>>2]=l,T=0|U(0|E,0|G,0|i[(v=m=s+((O=O+2|0)<<3)|0)>>2],0|i[v+4>>2]),w=l,i[(v=m)>>2]=T,i[v+4>>2]=w}while(O>>>0<10);w=0|i[(O=u)>>2],T=0|i[O+4>>2],v=0|i[(O=s)>>2],m=0|i[O+4>>2],O=0|F(0|w,0|T,18,0),G=l,E=0|U(0|v,0|m,0|w,0|T),T=0|U(0|E,0|l,0|O,0|G),G=l,i[(O=u)>>2]=0,i[O+4>>2]=0,w=0|k(0|T,0|G,0|(E=0|B(0|(u=0|N(0|(O=0|U(G>>31>>>6|0,0,0|T,0|G)),0|l,26)),0|(O=l),26)),0|l),i[(E=s)>>2]=w,i[E+4>>2]=l,w=0|U(0|u,0|O,0|i[(E=a)>>2],0|i[E+4>>2]),i[(E=a)>>2]=w,i[E+4>>2]=l,E=e,e=s,s=E+80|0;do{i[E>>2]=i[e>>2],E=E+4|0,e=e+4|0}while((0|E)<(0|s));o=n}function O(){return 0|(0|i[2]?0|i[60+(0|f())>>2]:56)}function I(e){var t=0;return(e|=0)>>>0>4294963200?(i[(0|O())>>2]=0-e,t=-1):t=e,0|t}function w(e){return 0,0}function R(e){0}function D(e,t,n){t|=0,n|=0;var r,a,s,l,c,d=0,p=0,f=0,h=0,_=0,g=0,m=0,y=0,E=0,S=0,v=0,b=0,A=0,P=0,M=0,O=0;for(r=o,o=o+48|0,a=r+16|0,s=r,d=r+32|0,p=0|i[(l=(e|=0)+28|0)>>2],i[d>>2]=p,f=(0|i[(c=e+20|0)>>2])-p|0,i[d+4>>2]=f,i[d+8>>2]=t,i[d+12>>2]=n,t=e+60|0,p=e+44|0,h=d,d=2,_=f+n|0;;){if(0|i[2]?(T(1,0|e),i[s>>2]=i[t>>2],i[s+4>>2]=h,i[s+8>>2]=d,f=0|I(0|C(146,0|s)),u(0),g=f):(i[a>>2]=i[t>>2],i[a+4>>2]=h,i[a+8>>2]=d,g=0|I(0|C(146,0|a))),(0|_)==(0|g)){m=6;break}if((0|g)<0){y=h,E=d,m=8;break}f=_-g|0,g>>>0<=(S=0|i[h+4>>2])>>>0?2==(0|d)?(i[l>>2]=(0|i[l>>2])+g,v=S,b=g,A=h,P=2):(v=S,b=g,A=h,P=d):(M=0|i[p>>2],i[l>>2]=M,i[c>>2]=M,v=0|i[h+12>>2],b=g-S|0,A=h+8|0,P=d+-1|0),i[A>>2]=(0|i[A>>2])+b,i[A+4>>2]=v-b,h=A,d=P,_=f}return 6==(0|m)?(_=0|i[p>>2],i[e+16>>2]=_+(0|i[e+48>>2]),p=_,i[l>>2]=p,i[c>>2]=p,O=n):8==(0|m)&&(i[e+16>>2]=0,i[l>>2]=0,i[c>>2]=0,i[e>>2]=32|i[e>>2],O=2==(0|E)?0:n-(0|i[y+4>>2])|0),o=r,0|O}function L(e){var t,n,r=0,a=0,o=0,s=0,l=0;return n=(e|=0)+28|0,(0|i[(t=e+20|0)>>2])>>>0>(0|i[n>>2])>>>0&&(Y[3&i[e+36>>2]](e,0,0),0==(0|i[t>>2]))?r=-1:((o=0|i[(a=e+4|0)>>2])>>>0<(l=0|i[(s=e+8|0)>>2])>>>0&&Y[3&i[e+40>>2]](e,o-l|0,1),i[e+16>>2]=0,i[n>>2]=0,i[t>>2]=0,i[s>>2]=0,i[a>>2]=0,r=0),0|r}function N(e,t,n){return e|=0,t|=0,(0|(n|=0))<32?(l=t>>n,e>>>n|(t&(1<<n)-1)<<32-n):(l=(0|t)<0?-1:0,t>>n-32|0)}function k(e,t,n,r){return(t|=0)-(r|=0)>>>0,0|(l=t-r-((n|=0)>>>0>(e|=0)>>>0|0)>>>0,e-n>>>0|0)}function U(e,t,n,r){var i;return 0|(l=(t|=0)+(r|=0)+((i=(e|=0)+(n|=0)>>>0)>>>0<e>>>0|0)>>>0,0|i)}function G(e,t,n){t|=0;var a,o=0,s=0,l=0;if(a=(e|=0)+(n|=0)|0,(0|n)>=20){if(s=(t&=255)|t<<8|t<<16|t<<24,l=-4&a,o=3&e)for(o=e+4-o|0;(0|e)<(0|o);)r[e>>0]=t,e=e+1|0;for(;(0|e)<(0|l);)i[e>>2]=s,e=e+4|0}for(;(0|e)<(0|a);)r[e>>0]=t,e=e+1|0;return e-n|0}function x(e,t,n){return e|=0,t|=0,(0|(n|=0))<32?(l=t>>>n,e>>>n|(t&(1<<n)-1)<<32-n):(l=0,t>>>n-32|0)}function B(e,t,n){return e|=0,t|=0,(0|(n|=0))<32?(l=t<<n|(e&(1<<n)-1<<32-n)>>>32-n,e<<n):(l=e<<n-32,0)}function F(e,t,n,r){t|=0,r|=0;var i,a;return n=0|function(e,t){var n,r,i,a=0;return e=((r=0|c(a=65535&(t|=0),n=65535&(e|=0)))>>>16)+(0|c(a,i=e>>>16))|0,t=0|c(a=t>>>16,n),0|(l=(e>>>16)+(0|c(a,i))+(((65535&e)+t|0)>>>16)|0,e+t<<16|65535&r|0)}(i=e|=0,e=n|=0),a=l,0|(l=(0|c(t,e))+(0|c(r,i))+a|0&a,0|n)}var j=[function(e){return 0,d(0),0},function(e){var t,n;return e|=0,t=o,o=o+16|0,i[(n=t)>>2]=i[e+60>>2],e=0|I(0|h(6,0|n)),o=t,0|e}],Y=[function(e,t,n){return 0,0,0,d(1),0},function(e,t,n){t|=0,n|=0;var a,s=0;return a=o,o=o+80|0,s=a,i[(e|=0)+36>>2]=3,0==(64&i[e>>2]|0)&&(i[s>>2]=i[e+60>>2],i[s+4>>2]=21505,i[s+8>>2]=a+12,0!=(0|E(54,0|s)))&&(r[e+75>>0]=-1),s=0|D(e,t,n),o=a,0|s},function(e,t,n){e|=0,t|=0,n|=0;var r,a,s,l=0;return r=o,o=o+32|0,s=r+20|0,i[(a=r)>>2]=i[e+60>>2],i[a+4>>2]=0,i[a+8>>2]=t,i[a+12>>2]=s,i[a+16>>2]=n,(0|I(0|v(140,0|a)))<0?(i[s>>2]=-1,l=-1):l=0|i[s>>2],o=r,0|l},D],K=[function(e){d(2)},function(e){0|i[(e|=0)+68>>2]||R()}];return{_curve25519_donna:function(e,t,n){e|=0,n|=0;var s,d,u,p,f,h,_,g,m,y,E,S,v,T,b,C,O,I,w,R,D,L,j,Y,K,W,H,V,$,z,q,J,Q,X,Z,ee,te,ne,re,ie,ae,oe,se,le,ce,de,ue,pe,fe,he,_e,ge,me,ye,Ee,Se,ve,Te,be,Ce=0,Ae=0,Pe=0,Me=0,Oe=0,Ie=0,we=0,Re=0,De=0,Le=0,Ne=0,ke=0,Ue=0,Ge=0,xe=0,Be=0,Fe=0,je=0,Ye=0,Ke=0,We=0,He=0,Ve=0,$e=0,ze=0,qe=0,Je=0,Qe=0,Xe=0,Ze=0,et=0,tt=0,nt=0,rt=0,it=0,at=0,ot=0,st=0,lt=0,ct=0,dt=0,ut=0,pt=0,ft=0,ht=0,_t=0,gt=0,mt=0,yt=0,Et=0,St=0,vt=0,Tt=0,bt=0,Ct=0,At=0,Pt=0,Mt=0,Ot=0,It=0,wt=0,Rt=0,Dt=0,Lt=0,Nt=0,kt=0,Ut=0,Gt=0,xt=0,Bt=0,Ft=0,jt=0,Yt=0,Kt=0,Wt=0,Ht=0,Vt=0,$t=0,zt=0,qt=0,Jt=0,Qt=0,Xt=0,Zt=0,en=0,tn=0,nn=0,rn=0,an=0,on=0,sn=0,ln=0,cn=0,dn=0,un=0,pn=0,fn=0,hn=0,_n=0,gn=0,mn=0,yn=0,En=0,Sn=0,vn=0,Tn=0,bn=0,Cn=0,An=0,Pn=0,Mn=0,On=0,In=0,wn=0,Rn=0,Dn=0,Ln=0,Nn=0;s=o,o=o+2640|0,Ce=s+2456|0,Ae=s+2304|0,Pe=s+2152|0,Me=s+2e3|0,Oe=s+1848|0,Ie=s+1696|0,we=s+1544|0,Re=s+1392|0,De=s+1240|0,Le=s+1088|0,Ne=s+936|0,ke=s+784|0,Ue=s+632|0,Ge=s+480|0,xe=s+328|0,d=s+248|0,Be=s+168|0,Fe=s+80|0,je=s,Ke=t|=0,t=(Ye=u=s+2608|0)+32|0;do{r[Ye>>0]=0|r[Ke>>0],Ye=Ye+1|0,Ke=Ke+1|0}while((0|Ye)<(0|t));r[u>>0]=248&(0|a[u>>0]),r[(We=u+31|0)>>0]=63&(0|a[We>>0])|64,We=0|a[n>>0],He=0|B(0|a[n+1>>0],0,8),Ve=l,$e=0|B(0|a[n+2>>0],0,16),ze=Ve|l,qe=0|B(0|(Ve=0|a[n+3>>0]),0,24),i[(Je=d)>>2]=He|We|$e|50331648&qe,i[Je+4>>2]=ze,ze=0|B(0|a[n+4>>0],0,8),Je=l,qe=0|B(0|a[n+5>>0],0,16),$e=Je|l,He=0|x(ze|Ve|qe|(We=0|B(0|(Je=0|a[n+6>>0]),0,24))|0,$e|l|0,2),i[($e=d+8|0)>>2]=33554431&He,i[$e+4>>2]=0,$e=0|B(0|a[n+7>>0],0,8),He=l,We=0|B(0|a[n+8>>0],0,16),qe=He|l,ze=0|x($e|Je|We|(Ve=0|B(0|(He=0|a[n+9>>0]),0,24))|0,qe|l|0,3),i[(qe=d+16|0)>>2]=67108863&ze,i[qe+4>>2]=0,qe=0|B(0|a[n+10>>0],0,8),ze=l,Ve=0|B(0|a[n+11>>0],0,16),We=ze|l,$e=0|x(qe|He|Ve|(Je=0|B(0|(ze=0|a[n+12>>0]),0,24))|0,We|l|0,5),i[(We=d+24|0)>>2]=33554431&$e,i[We+4>>2]=0,We=0|B(0|a[n+13>>0],0,8),$e=l,Je=0|B(0|a[n+14>>0],0,16),Ve=$e|l,He=0|x(We|ze|Je|($e=0|B(0|a[n+15>>0],0,24))|0,Ve|l|0,6),i[(Ve=d+32|0)>>2]=67108863&He,i[Ve+4>>2]=0,Ve=0|a[n+16>>0],He=0|B(0|a[n+17>>0],0,8),$e=l,Je=0|B(0|a[n+18>>0],0,16),ze=$e|l,We=0|B(0|($e=0|a[n+19>>0]),0,24),i[(qe=d+40|0)>>2]=He|Ve|Je|16777216&We,i[qe+4>>2]=ze,ze=0|B(0|a[n+20>>0],0,8),qe=l,We=0|B(0|a[n+21>>0],0,16),Je=qe|l,He=0|x(ze|$e|We|(Ve=0|B(0|(qe=0|a[n+22>>0]),0,24))|0,Je|l|0,1),i[(Je=d+48|0)>>2]=67108863&He,i[Je+4>>2]=0,Je=0|B(0|a[n+23>>0],0,8),He=l,Ve=0|B(0|a[n+24>>0],0,16),We=He|l,ze=0|x(Je|qe|Ve|($e=0|B(0|(He=0|a[n+25>>0]),0,24))|0,We|l|0,3),i[(We=d+56|0)>>2]=33554431&ze,i[We+4>>2]=0,We=0|B(0|a[n+26>>0],0,8),ze=l,$e=0|B(0|a[n+27>>0],0,16),Ve=ze|l,Je=0|x(We|He|$e|(qe=0|B(0|(ze=0|a[n+28>>0]),0,24))|0,Ve|l|0,4),i[(Ve=d+64|0)>>2]=67108863&Je,i[Ve+4>>2]=0,Ve=0|B(0|a[n+29>>0],0,8),Je=l,qe=0|B(0|a[n+30>>0],0,16),$e=Je|l,n=0|x(Ve|ze|qe|(Je=0|B(0|a[n+31>>0],0,24))|0,$e|l|0,6),i[($e=d+72|0)>>2]=33554431&n,i[$e+4>>2]=0,G(0|De,0,152),i[($e=De)>>2]=1,i[$e+4>>2]=0,G(0|Le,0,152),i[($e=Le)>>2]=1,i[$e+4>>2]=0,G(0|Ne,0,152),G(0|ke,0,152),G(0|Ue,0,152),i[($e=Ue)>>2]=1,i[$e+4>>2]=0,G(0|Ge,0,152),G(0|xe,0,152),i[($e=xe)>>2]=1,i[$e+4>>2]=0,t=(Ye=Re+80|0)+72|0;do{i[Ye>>2]=0,Ye=Ye+4|0}while((0|Ye)<(0|t));Ke=d,t=(Ye=Re)+80|0;do{i[Ye>>2]=i[Ke>>2],Ye=Ye+4|0,Ke=Ke+4|0}while((0|Ye)<(0|t));for($e=Me+144|0,n=Me+64|0,Je=Me+136|0,qe=Me+56|0,ze=Me+128|0,Ve=Me+48|0,He=Me+120|0,We=Me+40|0,p=Me+112|0,f=Me+32|0,h=Me+104|0,_=Me+24|0,g=Me+96|0,m=Me+16|0,y=Me+88|0,E=Me+8|0,S=Me+80|0,v=Oe+144|0,T=Oe+64|0,b=Oe+136|0,C=Oe+56|0,O=Oe+128|0,I=Oe+48|0,w=Oe+120|0,R=Oe+40|0,D=Oe+112|0,L=Oe+32|0,j=Oe+104|0,Y=Oe+24|0,K=Oe+96|0,W=Oe+16|0,H=Oe+88|0,V=Oe+8|0,$=Oe+80|0,z=Me+72|0,q=Oe+72|0,J=Ae+8|0,Q=Pe+8|0,X=Ae+16|0,Z=Pe+16|0,ee=Ae+24|0,te=Pe+24|0,ne=Ae+32|0,re=Pe+32|0,ie=Ae+40|0,ae=Pe+40|0,oe=Ae+48|0,se=Pe+48|0,le=Ae+56|0,ce=Pe+56|0,de=Ae+64|0,ue=Pe+64|0,pe=Ae+72|0,fe=Pe+72|0,he=Ce+80|0,_e=Ce+8|0,ge=Ce+16|0,me=Ce+24|0,ye=Ce+32|0,Ee=Ce+40|0,Se=Ce+48|0,ve=Ce+56|0,Te=Ce+64|0,be=Ce+72|0,Qe=0,Xe=Re,Ze=ke,ke=De,et=Ue,Ue=Le,tt=Ge,Ge=Ne,Ne=xe;;){for(xe=0|r[u+(31-Qe)>>0],nt=0,rt=Xe,it=Ze,at=ke,ot=et,st=Ue,lt=tt,ct=Ge,dt=Ne;;){pt=0|k(0,0,(ut=255&xe)>>>7|0,0),ft=l,ht=0;do{mt=0|i[(gt=_t=st+(ht<<3)|0)>>2],yt=0|i[gt+4>>2],St=0|i[(Et=gt=rt+(ht<<3)|0)>>2],Tt=((vt=0|i[Et+4>>2])^yt)&ft,yt=0|N(0,(Et=(St^mt)&pt)^mt|0,32),i[(mt=_t)>>2]=yt,i[mt+4>>2]=l,mt=0|N(0,Et^St|0,32),i[(St=gt)>>2]=mt,i[St+4>>2]=l,ht=ht+1|0}while(10!=(0|ht));bt=0;do{mt=0|i[(St=ht=ct+(bt<<3)|0)>>2],gt=0|i[St+4>>2],yt=0|i[(Et=St=at+(bt<<3)|0)>>2],vt=((_t=0|i[Et+4>>2])^gt)&ft,gt=0|N(0,(Et=(yt^mt)&pt)^mt|0,32),i[(mt=ht)>>2]=gt,i[mt+4>>2]=l,mt=0|N(0,Et^yt|0,32),i[(yt=St)>>2]=mt,i[yt+4>>2]=l,bt=bt+1|0}while(10!=(0|bt));mt=0|i[(yt=st)>>2],St=0|i[yt+4>>2],gt=0|i[(Et=yt=st+8|0)>>2],ht=0|i[Et+4>>2],vt=0|i[(_t=Et=st+16|0)>>2],Tt=0|i[_t+4>>2],At=0|i[(Ct=_t=st+24|0)>>2],Pt=0|i[Ct+4>>2],Ot=0|i[(Mt=Ct=st+32|0)>>2],It=0|i[Mt+4>>2],Rt=0|i[(wt=Mt=st+40|0)>>2],Dt=0|i[wt+4>>2],Nt=0|i[(Lt=wt=st+48|0)>>2],kt=0|i[Lt+4>>2],Gt=0|i[(Ut=Lt=st+56|0)>>2],xt=0|i[Ut+4>>2],Ft=0|i[(Bt=Ut=st+64|0)>>2],jt=0|i[Bt+4>>2],Kt=0|i[(Yt=Bt=st+72|0)>>2],Wt=0|i[Yt+4>>2],Yt=0|U(0|(Ht=0|i[(Yt=ct)>>2]),0|(Vt=0|i[Yt+4>>2]),0|mt,0|St),i[($t=st)>>2]=Yt,i[$t+4>>2]=l,Yt=0|U(0|(zt=0|i[(Yt=$t=ct+8|0)>>2]),0|(qt=0|i[Yt+4>>2]),0|gt,0|ht),i[(Jt=yt)>>2]=Yt,i[Jt+4>>2]=l,Yt=0|U(0|(yt=0|i[(Yt=Jt=ct+16|0)>>2]),0|(Qt=0|i[Yt+4>>2]),0|vt,0|Tt),i[(Xt=Et)>>2]=Yt,i[Xt+4>>2]=l,Yt=0|U(0|(Et=0|i[(Yt=Xt=ct+24|0)>>2]),0|(Zt=0|i[Yt+4>>2]),0|At,0|Pt),i[(en=_t)>>2]=Yt,i[en+4>>2]=l,Yt=0|U(0|(_t=0|i[(Yt=en=ct+32|0)>>2]),0|(tn=0|i[Yt+4>>2]),0|Ot,0|It),i[(nn=Ct)>>2]=Yt,i[nn+4>>2]=l,Yt=0|U(0|(Ct=0|i[(Yt=nn=ct+40|0)>>2]),0|(rn=0|i[Yt+4>>2]),0|Rt,0|Dt),i[(an=Mt)>>2]=Yt,i[an+4>>2]=l,Yt=0|U(0|(Mt=0|i[(Yt=an=ct+48|0)>>2]),0|(on=0|i[Yt+4>>2]),0|Nt,0|kt),i[(sn=wt)>>2]=Yt,i[sn+4>>2]=l,Yt=0|U(0|(wt=0|i[(Yt=sn=ct+56|0)>>2]),0|(ln=0|i[Yt+4>>2]),0|Gt,0|xt),i[(cn=Lt)>>2]=Yt,i[cn+4>>2]=l,Yt=0|U(0|(Lt=0|i[(Yt=cn=ct+64|0)>>2]),0|(dn=0|i[Yt+4>>2]),0|Ft,0|jt),i[(un=Ut)>>2]=Yt,i[un+4>>2]=l,Yt=0|U(0|(Ut=0|i[(Yt=un=ct+72|0)>>2]),0|(pn=0|i[Yt+4>>2]),0|Kt,0|Wt),i[(fn=Bt)>>2]=Yt,i[fn+4>>2]=l,fn=0|k(0|mt,0|St,0|Ht,0|Vt),i[(Vt=ct)>>2]=fn,i[Vt+4>>2]=l,Vt=0|k(0|gt,0|ht,0|zt,0|qt),i[(qt=$t)>>2]=Vt,i[qt+4>>2]=l,qt=0|k(0|vt,0|Tt,0|yt,0|Qt),i[(Qt=Jt)>>2]=qt,i[Qt+4>>2]=l,Qt=0|k(0|At,0|Pt,0|Et,0|Zt),i[(Zt=Xt)>>2]=Qt,i[Zt+4>>2]=l,Zt=0|k(0|Ot,0|It,0|_t,0|tn),i[(tn=en)>>2]=Zt,i[tn+4>>2]=l,tn=0|k(0|Rt,0|Dt,0|Ct,0|rn),i[(rn=nn)>>2]=tn,i[rn+4>>2]=l,rn=0|k(0|Nt,0|kt,0|Mt,0|on),i[(on=an)>>2]=rn,i[on+4>>2]=l,on=0|k(0|Gt,0|xt,0|wt,0|ln),i[(ln=sn)>>2]=on,i[ln+4>>2]=l,ln=0|k(0|Ft,0|jt,0|Lt,0|dn),i[(dn=cn)>>2]=ln,i[dn+4>>2]=l,dn=0|k(0|Kt,0|Wt,0|Ut,0|pn),i[(pn=un)>>2]=dn,i[pn+4>>2]=l,dn=0|i[(pn=rt)>>2],un=0|i[pn+4>>2],Wt=0|i[(Ut=pn=rt+8|0)>>2],Kt=0|i[Ut+4>>2],cn=0|i[(ln=Ut=rt+16|0)>>2],Lt=0|i[ln+4>>2],Ft=0|i[(jt=ln=rt+24|0)>>2],on=0|i[jt+4>>2],wt=0|i[(sn=jt=rt+32|0)>>2],xt=0|i[sn+4>>2],rn=0|i[(Gt=sn=rt+40|0)>>2],an=0|i[Gt+4>>2],kt=0|i[(Mt=Gt=rt+48|0)>>2],Nt=0|i[Mt+4>>2],nn=0|i[(tn=Mt=rt+56|0)>>2],Ct=0|i[tn+4>>2],Rt=0|i[(Dt=tn=rt+64|0)>>2],Zt=0|i[Dt+4>>2],_t=0|i[(en=Dt=rt+72|0)>>2],It=0|i[en+4>>2],en=0|U(0|(Ot=0|i[(en=at)>>2]),0|(Qt=0|i[en+4>>2]),0|dn,0|un),i[(Xt=rt)>>2]=en,i[Xt+4>>2]=l,en=0|U(0|(Et=0|i[(en=Xt=at+8|0)>>2]),0|(Pt=0|i[en+4>>2]),0|Wt,0|Kt),i[(At=pn)>>2]=en,i[At+4>>2]=l,en=0|U(0|(pn=0|i[(en=At=at+16|0)>>2]),0|(qt=0|i[en+4>>2]),0|cn,0|Lt),i[(Jt=Ut)>>2]=en,i[Jt+4>>2]=l,en=0|U(0|(Ut=0|i[(en=Jt=at+24|0)>>2]),0|(yt=0|i[en+4>>2]),0|Ft,0|on),i[(Tt=ln)>>2]=en,i[Tt+4>>2]=l,en=0|U(0|(ln=0|i[(en=Tt=at+32|0)>>2]),0|(vt=0|i[en+4>>2]),0|wt,0|xt),i[(Vt=jt)>>2]=en,i[Vt+4>>2]=l,en=0|U(0|(jt=0|i[(en=Vt=at+40|0)>>2]),0|($t=0|i[en+4>>2]),0|rn,0|an),i[(zt=sn)>>2]=en,i[zt+4>>2]=l,en=0|U(0|(sn=0|i[(en=zt=at+48|0)>>2]),0|(ht=0|i[en+4>>2]),0|kt,0|Nt),i[(gt=Gt)>>2]=en,i[gt+4>>2]=l,en=0|U(0|(Gt=0|i[(en=gt=at+56|0)>>2]),0|(fn=0|i[en+4>>2]),0|nn,0|Ct),i[(Ht=Mt)>>2]=en,i[Ht+4>>2]=l,en=0|U(0|(Mt=0|i[(en=Ht=at+64|0)>>2]),0|(St=0|i[en+4>>2]),0|Rt,0|Zt),i[(mt=tn)>>2]=en,i[mt+4>>2]=l,en=0|U(0|(tn=0|i[(en=mt=at+72|0)>>2]),0|(Yt=0|i[en+4>>2]),0|_t,0|It),i[(Bt=Dt)>>2]=en,i[Bt+4>>2]=l,Bt=0|k(0|dn,0|un,0|Ot,0|Qt),i[(Qt=at)>>2]=Bt,i[Qt+4>>2]=l,Qt=0|k(0|Wt,0|Kt,0|Et,0|Pt),i[(Pt=Xt)>>2]=Qt,i[Pt+4>>2]=l,Pt=0|k(0|cn,0|Lt,0|pn,0|qt),i[(qt=At)>>2]=Pt,i[qt+4>>2]=l,qt=0|k(0|Ft,0|on,0|Ut,0|yt),i[(yt=Jt)>>2]=qt,i[yt+4>>2]=l,yt=0|k(0|wt,0|xt,0|ln,0|vt),i[(vt=Tt)>>2]=yt,i[vt+4>>2]=l,vt=0|k(0|rn,0|an,0|jt,0|$t),i[($t=Vt)>>2]=vt,i[$t+4>>2]=l,$t=0|k(0|kt,0|Nt,0|sn,0|ht),i[(ht=zt)>>2]=$t,i[ht+4>>2]=l,ht=0|k(0|nn,0|Ct,0|Gt,0|fn),i[(fn=gt)>>2]=ht,i[fn+4>>2]=l,fn=0|k(0|Rt,0|Zt,0|Mt,0|St),i[(St=Ht)>>2]=fn,i[St+4>>2]=l,St=0|k(0|_t,0|It,0|tn,0|Yt),i[(Yt=mt)>>2]=St,i[Yt+4>>2]=l,P(Me,rt,ct),P(Oe,st,at),St=0|i[(Yt=$e)>>2],mt=0|i[Yt+4>>2],tn=0|i[(Yt=n)>>2],It=0|i[Yt+4>>2],Yt=0|F(0|St,0|mt,18,0),_t=l,fn=0|U(0|tn,0|It,0|St,0|mt),mt=0|U(0|fn,0|l,0|Yt,0|_t),i[(_t=n)>>2]=mt,i[_t+4>>2]=l,mt=0|i[(_t=Je)>>2],Yt=0|i[_t+4>>2],fn=0|i[(_t=qe)>>2],St=0|i[_t+4>>2],_t=0|F(0|mt,0|Yt,18,0),It=l,tn=0|U(0|fn,0|St,0|mt,0|Yt),Yt=0|U(0|tn,0|l,0|_t,0|It),i[(It=qe)>>2]=Yt,i[It+4>>2]=l,Yt=0|i[(It=ze)>>2],_t=0|i[It+4>>2],tn=0|i[(It=Ve)>>2],mt=0|i[It+4>>2],It=0|F(0|Yt,0|_t,18,0),St=l,fn=0|U(0|tn,0|mt,0|Yt,0|_t),_t=0|U(0|fn,0|l,0|It,0|St),i[(St=Ve)>>2]=_t,i[St+4>>2]=l,_t=0|i[(St=He)>>2],It=0|i[St+4>>2],fn=0|i[(St=We)>>2],Yt=0|i[St+4>>2],St=0|F(0|_t,0|It,18,0),mt=l,tn=0|U(0|fn,0|Yt,0|_t,0|It),It=0|U(0|tn,0|l,0|St,0|mt),i[(mt=We)>>2]=It,i[mt+4>>2]=l,It=0|i[(mt=p)>>2],St=0|i[mt+4>>2],tn=0|i[(mt=f)>>2],_t=0|i[mt+4>>2],mt=0|F(0|It,0|St,18,0),Yt=l,fn=0|U(0|tn,0|_t,0|It,0|St),St=0|U(0|fn,0|l,0|mt,0|Yt),i[(Yt=f)>>2]=St,i[Yt+4>>2]=l,St=0|i[(Yt=h)>>2],mt=0|i[Yt+4>>2],fn=0|i[(Yt=_)>>2],It=0|i[Yt+4>>2],Yt=0|F(0|St,0|mt,18,0),_t=l,tn=0|U(0|fn,0|It,0|St,0|mt),mt=0|U(0|tn,0|l,0|Yt,0|_t),i[(_t=_)>>2]=mt,i[_t+4>>2]=l,mt=0|i[(_t=g)>>2],Yt=0|i[_t+4>>2],tn=0|i[(_t=m)>>2],St=0|i[_t+4>>2],_t=0|F(0|mt,0|Yt,18,0),It=l,fn=0|U(0|tn,0|St,0|mt,0|Yt),Yt=0|U(0|fn,0|l,0|_t,0|It),i[(It=m)>>2]=Yt,i[It+4>>2]=l,Yt=0|i[(It=y)>>2],_t=0|i[It+4>>2],fn=0|i[(It=E)>>2],mt=0|i[It+4>>2],It=0|F(0|Yt,0|_t,18,0),St=l,tn=0|U(0|fn,0|mt,0|Yt,0|_t),_t=0|U(0|tn,0|l,0|It,0|St),i[(St=E)>>2]=_t,i[St+4>>2]=l,_t=0|i[(St=S)>>2],It=0|i[St+4>>2],tn=0|i[(St=Me)>>2],Yt=0|i[St+4>>2],St=0|F(0|_t,0|It,18,0),mt=l,fn=0|U(0|tn,0|Yt,0|_t,0|It),It=0|U(0|fn,0|l,0|St,0|mt),mt=l,i[(St=Me)>>2]=It,i[St+4>>2]=mt,i[(St=S)>>2]=0,i[St+4>>2]=0,St=mt,mt=It,It=0;do{tn=0|k(0|mt,0|St,0|(Yt=0|B(0|(_t=0|N(0|(fn=0|U(St>>31>>>6|0,0,0|mt,0|St)),0|l,26)),0|(fn=l),26)),0|l),i[(Yt=Me+(It<<3)|0)>>2]=tn,i[Yt+4>>2]=l,Zt=0|k(0|(Ht=0|U(0|_t,0|fn,0|i[(tn=Yt=Me+((1|It)<<3)|0)>>2],0|i[tn+4>>2])),0|(tn=l),0|(Mt=0|B(0|(_t=0|N(0|(fn=0|U(tn>>31>>>7|0,0,0|Ht,0|tn)),0|l,25)),0|(fn=l),25)),0|l),i[(Mt=Yt)>>2]=Zt,i[Mt+4>>2]=l,mt=0|U(0|_t,0|fn,0|i[(Zt=Mt=Me+((It=It+2|0)<<3)|0)>>2],0|i[Zt+4>>2]),St=l,i[(Zt=Mt)>>2]=mt,i[Zt+4>>2]=St}while(It>>>0<10);St=0|i[(It=S)>>2],mt=0|i[It+4>>2],Zt=0|i[(It=Me)>>2],Mt=0|i[It+4>>2],It=0|F(0|St,0|mt,18,0),fn=l,_t=0|U(0|Zt,0|Mt,0|St,0|mt),mt=0|U(0|_t,0|l,0|It,0|fn),fn=l,i[(It=S)>>2]=0,i[It+4>>2]=0,Mt=0|k(0|mt,0|fn,0|(St=0|B(0|(_t=0|N(0|(It=0|U(fn>>31>>>6|0,0,0|mt,0|fn)),0|l,26)),0|(It=l),26)),0|l),St=l,i[(fn=Me)>>2]=Mt,i[fn+4>>2]=St,mt=0|U(0|_t,0|It,0|i[(fn=E)>>2],0|i[fn+4>>2]),fn=l,i[(It=E)>>2]=mt,i[It+4>>2]=fn,_t=0|i[(It=v)>>2],Zt=0|i[It+4>>2],Yt=0|i[(It=T)>>2],tn=0|i[It+4>>2],It=0|F(0|_t,0|Zt,18,0),Ht=l,Rt=0|U(0|Yt,0|tn,0|_t,0|Zt),Zt=0|U(0|Rt,0|l,0|It,0|Ht),i[(Ht=T)>>2]=Zt,i[Ht+4>>2]=l,Zt=0|i[(Ht=b)>>2],It=0|i[Ht+4>>2],Rt=0|i[(Ht=C)>>2],_t=0|i[Ht+4>>2],Ht=0|F(0|Zt,0|It,18,0),tn=l,Yt=0|U(0|Rt,0|_t,0|Zt,0|It),It=0|U(0|Yt,0|l,0|Ht,0|tn),i[(tn=C)>>2]=It,i[tn+4>>2]=l,It=0|i[(tn=O)>>2],Ht=0|i[tn+4>>2],Yt=0|i[(tn=I)>>2],Zt=0|i[tn+4>>2],tn=0|F(0|It,0|Ht,18,0),_t=l,Rt=0|U(0|Yt,0|Zt,0|It,0|Ht),Ht=0|U(0|Rt,0|l,0|tn,0|_t),i[(_t=I)>>2]=Ht,i[_t+4>>2]=l,Ht=0|i[(_t=w)>>2],tn=0|i[_t+4>>2],Rt=0|i[(_t=R)>>2],It=0|i[_t+4>>2],_t=0|F(0|Ht,0|tn,18,0),Zt=l,Yt=0|U(0|Rt,0|It,0|Ht,0|tn),tn=0|U(0|Yt,0|l,0|_t,0|Zt),i[(Zt=R)>>2]=tn,i[Zt+4>>2]=l,tn=0|i[(Zt=D)>>2],_t=0|i[Zt+4>>2],Yt=0|i[(Zt=L)>>2],Ht=0|i[Zt+4>>2],Zt=0|F(0|tn,0|_t,18,0),It=l,Rt=0|U(0|Yt,0|Ht,0|tn,0|_t),_t=0|U(0|Rt,0|l,0|Zt,0|It),i[(It=L)>>2]=_t,i[It+4>>2]=l,_t=0|i[(It=j)>>2],Zt=0|i[It+4>>2],Rt=0|i[(It=Y)>>2],tn=0|i[It+4>>2],It=0|F(0|_t,0|Zt,18,0),Ht=l,Yt=0|U(0|Rt,0|tn,0|_t,0|Zt),Zt=0|U(0|Yt,0|l,0|It,0|Ht),i[(Ht=Y)>>2]=Zt,i[Ht+4>>2]=l,Zt=0|i[(Ht=K)>>2],It=0|i[Ht+4>>2],Yt=0|i[(Ht=W)>>2],_t=0|i[Ht+4>>2],Ht=0|F(0|Zt,0|It,18,0),tn=l,Rt=0|U(0|Yt,0|_t,0|Zt,0|It),It=0|U(0|Rt,0|l,0|Ht,0|tn),i[(tn=W)>>2]=It,i[tn+4>>2]=l,It=0|i[(tn=H)>>2],Ht=0|i[tn+4>>2],Rt=0|i[(tn=V)>>2],Zt=0|i[tn+4>>2],tn=0|F(0|It,0|Ht,18,0),_t=l,Yt=0|U(0|Rt,0|Zt,0|It,0|Ht),Ht=0|U(0|Yt,0|l,0|tn,0|_t),i[(_t=V)>>2]=Ht,i[_t+4>>2]=l,Ht=0|i[(_t=$)>>2],tn=0|i[_t+4>>2],Yt=0|i[(_t=Oe)>>2],It=0|i[_t+4>>2],_t=0|F(0|Ht,0|tn,18,0),Zt=l,Rt=0|U(0|Yt,0|It,0|Ht,0|tn),tn=0|U(0|Rt,0|l,0|_t,0|Zt),Zt=l,i[(_t=Oe)>>2]=tn,i[_t+4>>2]=Zt,i[(_t=$)>>2]=0,i[_t+4>>2]=0,_t=Zt,Zt=tn,tn=0;do{Yt=0|k(0|Zt,0|_t,0|(It=0|B(0|(Ht=0|N(0|(Rt=0|U(_t>>31>>>6|0,0,0|Zt,0|_t)),0|l,26)),0|(Rt=l),26)),0|l),i[(It=Oe+(tn<<3)|0)>>2]=Yt,i[It+4>>2]=l,Gt=0|k(0|(ht=0|U(0|Ht,0|Rt,0|i[(Yt=It=Oe+((1|tn)<<3)|0)>>2],0|i[Yt+4>>2])),0|(Yt=l),0|(gt=0|B(0|(Ht=0|N(0|(Rt=0|U(Yt>>31>>>7|0,0,0|ht,0|Yt)),0|l,25)),0|(Rt=l),25)),0|l),i[(gt=It)>>2]=Gt,i[gt+4>>2]=l,Zt=0|U(0|Ht,0|Rt,0|i[(Gt=gt=Oe+((tn=tn+2|0)<<3)|0)>>2],0|i[Gt+4>>2]),_t=l,i[(Gt=gt)>>2]=Zt,i[Gt+4>>2]=_t}while(tn>>>0<10);_t=0|i[(tn=$)>>2],Zt=0|i[tn+4>>2],Gt=0|i[(tn=Oe)>>2],gt=0|i[tn+4>>2],tn=0|F(0|_t,0|Zt,18,0),Rt=l,Ht=0|U(0|Gt,0|gt,0|_t,0|Zt),Zt=0|U(0|Ht,0|l,0|tn,0|Rt),Rt=l,i[(tn=$)>>2]=0,i[tn+4>>2]=0,gt=0|k(0|Zt,0|Rt,0|(_t=0|B(0|(Ht=0|N(0|(tn=0|U(Rt>>31>>>6|0,0,0|Zt,0|Rt)),0|l,26)),0|(tn=l),26)),0|l),_t=l,Zt=0|U(0|Ht,0|tn,0|i[(Rt=V)>>2],0|i[Rt+4>>2]),Rt=l,Ht=0|i[(tn=m)>>2],Gt=0|i[tn+4>>2],It=0|i[(tn=_)>>2],Yt=0|i[tn+4>>2],ht=0|i[(tn=f)>>2],Ct=0|i[tn+4>>2],nn=0|i[(tn=We)>>2],$t=0|i[tn+4>>2],zt=0|i[(tn=Ve)>>2],sn=0|i[tn+4>>2],Nt=0|i[(tn=qe)>>2],kt=0|i[tn+4>>2],vt=0|i[(tn=n)>>2],Vt=0|i[tn+4>>2],jt=0|i[(tn=z)>>2],an=0|i[tn+4>>2],tn=0|U(0|gt,0|_t,0|Mt,0|St),i[(rn=Me)>>2]=tn,i[rn+4>>2]=l,rn=0|U(0|Zt,0|Rt,0|mt,0|fn),i[(tn=E)>>2]=rn,i[tn+4>>2]=l,tn=0|U(0|(rn=0|i[(tn=W)>>2]),0|(yt=0|i[tn+4>>2]),0|Ht,0|Gt),i[(Tt=m)>>2]=tn,i[Tt+4>>2]=l,Tt=0|U(0|(tn=0|i[(Tt=Y)>>2]),0|(ln=0|i[Tt+4>>2]),0|It,0|Yt),i[(xt=_)>>2]=Tt,i[xt+4>>2]=l,xt=0|U(0|(Tt=0|i[(xt=L)>>2]),0|(wt=0|i[xt+4>>2]),0|ht,0|Ct),i[(qt=f)>>2]=xt,i[qt+4>>2]=l,qt=0|U(0|(xt=0|i[(qt=R)>>2]),0|(Jt=0|i[qt+4>>2]),0|nn,0|$t),i[(Ut=We)>>2]=qt,i[Ut+4>>2]=l,Ut=0|U(0|(qt=0|i[(Ut=I)>>2]),0|(on=0|i[Ut+4>>2]),0|zt,0|sn),i[(Ft=Ve)>>2]=Ut,i[Ft+4>>2]=l,Ft=0|U(0|(Ut=0|i[(Ft=C)>>2]),0|(Pt=0|i[Ft+4>>2]),0|Nt,0|kt),i[(At=qe)>>2]=Ft,i[At+4>>2]=l,At=0|U(0|(Ft=0|i[(At=T)>>2]),0|(pn=0|i[At+4>>2]),0|vt,0|Vt),i[(Lt=n)>>2]=At,i[Lt+4>>2]=l,Lt=0|U(0|(At=0|i[(Lt=q)>>2]),0|(cn=0|i[Lt+4>>2]),0|jt,0|an),i[(Qt=z)>>2]=Lt,i[Qt+4>>2]=l,Qt=0|k(0|Mt,0|St,0|gt,0|_t),i[(_t=Oe)>>2]=Qt,i[_t+4>>2]=l,_t=0|k(0|mt,0|fn,0|Zt,0|Rt),i[(Rt=V)>>2]=_t,i[Rt+4>>2]=l,Rt=0|k(0|Ht,0|Gt,0|rn,0|yt),i[(yt=W)>>2]=Rt,i[yt+4>>2]=l,yt=0|k(0|It,0|Yt,0|tn,0|ln),i[(ln=Y)>>2]=yt,i[ln+4>>2]=l,ln=0|k(0|ht,0|Ct,0|Tt,0|wt),i[(wt=L)>>2]=ln,i[wt+4>>2]=l,wt=0|k(0|nn,0|$t,0|xt,0|Jt),i[(Jt=R)>>2]=wt,i[Jt+4>>2]=l,Jt=0|k(0|zt,0|sn,0|qt,0|on),i[(on=I)>>2]=Jt,i[on+4>>2]=l,on=0|k(0|Nt,0|kt,0|Ut,0|Pt),i[(Pt=C)>>2]=on,i[Pt+4>>2]=l,Pt=0|k(0|vt,0|Vt,0|Ft,0|pn),i[(pn=T)>>2]=Pt,i[pn+4>>2]=l,pn=0|k(0|jt,0|an,0|At,0|cn),i[(cn=q)>>2]=pn,i[cn+4>>2]=l,M(we,Me),M(Ie,Oe),P(Oe,Ie,d),pn=0|i[(cn=v)>>2],At=0|i[cn+4>>2],an=0|i[(cn=T)>>2],jt=0|i[cn+4>>2],cn=0|F(0|pn,0|At,18,0),Pt=l,Ft=0|U(0|an,0|jt,0|pn,0|At),At=0|U(0|Ft,0|l,0|cn,0|Pt),i[(Pt=T)>>2]=At,i[Pt+4>>2]=l,At=0|i[(Pt=b)>>2],cn=0|i[Pt+4>>2],Ft=0|i[(Pt=C)>>2],pn=0|i[Pt+4>>2],Pt=0|F(0|At,0|cn,18,0),jt=l,an=0|U(0|Ft,0|pn,0|At,0|cn),cn=0|U(0|an,0|l,0|Pt,0|jt),i[(jt=C)>>2]=cn,i[jt+4>>2]=l,cn=0|i[(jt=O)>>2],Pt=0|i[jt+4>>2],an=0|i[(jt=I)>>2],At=0|i[jt+4>>2],jt=0|F(0|cn,0|Pt,18,0),pn=l,Ft=0|U(0|an,0|At,0|cn,0|Pt),Pt=0|U(0|Ft,0|l,0|jt,0|pn),i[(pn=I)>>2]=Pt,i[pn+4>>2]=l,Pt=0|i[(pn=w)>>2],jt=0|i[pn+4>>2],Ft=0|i[(pn=R)>>2],cn=0|i[pn+4>>2],pn=0|F(0|Pt,0|jt,18,0),At=l,an=0|U(0|Ft,0|cn,0|Pt,0|jt),jt=0|U(0|an,0|l,0|pn,0|At),i[(At=R)>>2]=jt,i[At+4>>2]=l,jt=0|i[(At=D)>>2],pn=0|i[At+4>>2],an=0|i[(At=L)>>2],Pt=0|i[At+4>>2],At=0|F(0|jt,0|pn,18,0),cn=l,Ft=0|U(0|an,0|Pt,0|jt,0|pn),pn=0|U(0|Ft,0|l,0|At,0|cn),i[(cn=L)>>2]=pn,i[cn+4>>2]=l,pn=0|i[(cn=j)>>2],At=0|i[cn+4>>2],Ft=0|i[(cn=Y)>>2],jt=0|i[cn+4>>2],cn=0|F(0|pn,0|At,18,0),Pt=l,an=0|U(0|Ft,0|jt,0|pn,0|At),At=0|U(0|an,0|l,0|cn,0|Pt),i[(Pt=Y)>>2]=At,i[Pt+4>>2]=l,At=0|i[(Pt=K)>>2],cn=0|i[Pt+4>>2],an=0|i[(Pt=W)>>2],pn=0|i[Pt+4>>2],Pt=0|F(0|At,0|cn,18,0),jt=l,Ft=0|U(0|an,0|pn,0|At,0|cn),cn=0|U(0|Ft,0|l,0|Pt,0|jt),i[(jt=W)>>2]=cn,i[jt+4>>2]=l,cn=0|i[(jt=H)>>2],Pt=0|i[jt+4>>2],Ft=0|i[(jt=V)>>2],At=0|i[jt+4>>2],jt=0|F(0|cn,0|Pt,18,0),pn=l,an=0|U(0|Ft,0|At,0|cn,0|Pt),Pt=0|U(0|an,0|l,0|jt,0|pn),i[(pn=V)>>2]=Pt,i[pn+4>>2]=l,Pt=0|i[(pn=$)>>2],jt=0|i[pn+4>>2],an=0|i[(pn=Oe)>>2],cn=0|i[pn+4>>2],pn=0|F(0|Pt,0|jt,18,0),At=l,Ft=0|U(0|an,0|cn,0|Pt,0|jt),jt=0|U(0|Ft,0|l,0|pn,0|At),At=l,i[(pn=Oe)>>2]=jt,i[pn+4>>2]=At,i[(pn=$)>>2]=0,i[pn+4>>2]=0,pn=At,At=jt,jt=0;do{an=0|k(0|At,0|pn,0|(cn=0|B(0|(Pt=0|N(0|(Ft=0|U(pn>>31>>>6|0,0,0|At,0|pn)),0|l,26)),0|(Ft=l),26)),0|l),i[(cn=Oe+(jt<<3)|0)>>2]=an,i[cn+4>>2]=l,on=0|k(0|(Vt=0|U(0|Pt,0|Ft,0|i[(an=cn=Oe+((1|jt)<<3)|0)>>2],0|i[an+4>>2])),0|(an=l),0|(vt=0|B(0|(Pt=0|N(0|(Ft=0|U(an>>31>>>7|0,0,0|Vt,0|an)),0|l,25)),0|(Ft=l),25)),0|l),i[(vt=cn)>>2]=on,i[vt+4>>2]=l,At=0|U(0|Pt,0|Ft,0|i[(on=vt=Oe+((jt=jt+2|0)<<3)|0)>>2],0|i[on+4>>2]),pn=l,i[(on=vt)>>2]=At,i[on+4>>2]=pn}while(jt>>>0<10);pn=0|i[(jt=$)>>2],At=0|i[jt+4>>2],fn=0|i[(jt=Oe)>>2],mt=0|i[jt+4>>2],jt=0|F(0|pn,0|At,18,0),St=l,Mt=0|U(0|fn,0|mt,0|pn,0|At),At=0|U(0|Mt,0|l,0|jt,0|St),St=l,i[(jt=$)>>2]=0,i[jt+4>>2]=0,mt=0|k(0|At,0|St,0|(pn=0|B(0|(Mt=0|N(0|(jt=0|U(St>>31>>>6|0,0,0|At,0|St)),0|l,26)),0|(jt=l),26)),0|l),i[(pn=Oe)>>2]=mt,i[pn+4>>2]=l,mt=0|U(0|Mt,0|jt,0|i[(pn=V)>>2],0|i[pn+4>>2]),i[(pn=V)>>2]=mt,i[pn+4>>2]=l,Ke=we,t=(Ye=it)+80|0;do{i[Ye>>2]=i[Ke>>2],Ye=Ye+4|0,Ke=Ke+4|0}while((0|Ye)<(0|t));Ke=Oe,t=(Ye=ot)+80|0;do{i[Ye>>2]=i[Ke>>2],Ye=Ye+4|0,Ke=Ke+4|0}while((0|Ye)<(0|t));M(Ae,st),M(Pe,ct),P(lt,Ae,Pe),mt=0|i[(pn=lt+144|0)>>2],jt=0|i[pn+4>>2],St=0|i[(Mt=pn=lt+64|0)>>2],At=0|i[Mt+4>>2],Mt=0|F(0|mt,0|jt,18,0),fn=l,on=0|U(0|St,0|At,0|mt,0|jt),jt=0|U(0|on,0|l,0|Mt,0|fn),i[(fn=pn)>>2]=jt,i[fn+4>>2]=l,jt=0|i[(fn=lt+136|0)>>2],pn=0|i[fn+4>>2],on=0|i[(Mt=fn=lt+56|0)>>2],mt=0|i[Mt+4>>2],Mt=0|F(0|jt,0|pn,18,0),At=l,St=0|U(0|on,0|mt,0|jt,0|pn),pn=0|U(0|St,0|l,0|Mt,0|At),i[(At=fn)>>2]=pn,i[At+4>>2]=l,pn=0|i[(At=lt+128|0)>>2],fn=0|i[At+4>>2],St=0|i[(Mt=At=lt+48|0)>>2],jt=0|i[Mt+4>>2],Mt=0|F(0|pn,0|fn,18,0),mt=l,on=0|U(0|St,0|jt,0|pn,0|fn),fn=0|U(0|on,0|l,0|Mt,0|mt),i[(mt=At)>>2]=fn,i[mt+4>>2]=l,fn=0|i[(mt=lt+120|0)>>2],At=0|i[mt+4>>2],on=0|i[(Mt=mt=lt+40|0)>>2],pn=0|i[Mt+4>>2],Mt=0|F(0|fn,0|At,18,0),jt=l,St=0|U(0|on,0|pn,0|fn,0|At),At=0|U(0|St,0|l,0|Mt,0|jt),i[(jt=mt)>>2]=At,i[jt+4>>2]=l,At=0|i[(jt=lt+112|0)>>2],mt=0|i[jt+4>>2],St=0|i[(Mt=jt=lt+32|0)>>2],fn=0|i[Mt+4>>2],Mt=0|F(0|At,0|mt,18,0),pn=l,on=0|U(0|St,0|fn,0|At,0|mt),mt=0|U(0|on,0|l,0|Mt,0|pn),i[(pn=jt)>>2]=mt,i[pn+4>>2]=l,mt=0|i[(pn=lt+104|0)>>2],jt=0|i[pn+4>>2],on=0|i[(Mt=pn=lt+24|0)>>2],At=0|i[Mt+4>>2],Mt=0|F(0|mt,0|jt,18,0),fn=l,St=0|U(0|on,0|At,0|mt,0|jt),jt=0|U(0|St,0|l,0|Mt,0|fn),i[(fn=pn)>>2]=jt,i[fn+4>>2]=l,jt=0|i[(fn=lt+96|0)>>2],pn=0|i[fn+4>>2],St=0|i[(Mt=fn=lt+16|0)>>2],mt=0|i[Mt+4>>2],Mt=0|F(0|jt,0|pn,18,0),At=l,on=0|U(0|St,0|mt,0|jt,0|pn),pn=0|U(0|on,0|l,0|Mt,0|At),i[(At=fn)>>2]=pn,i[At+4>>2]=l,pn=0|i[(At=lt+88|0)>>2],fn=0|i[At+4>>2],on=0|i[(Mt=At=lt+8|0)>>2],jt=0|i[Mt+4>>2],Mt=0|F(0|pn,0|fn,18,0),mt=l,St=0|U(0|on,0|jt,0|pn,0|fn),fn=0|U(0|St,0|l,0|Mt,0|mt),i[(mt=At)>>2]=fn,i[mt+4>>2]=l,Mt=0|i[(fn=mt=lt+80|0)>>2],St=0|i[fn+4>>2],pn=0|i[(fn=lt)>>2],jt=0|i[fn+4>>2],fn=0|F(0|Mt,0|St,18,0),on=l,vt=0|U(0|pn,0|jt,0|Mt,0|St),St=0|U(0|vt,0|l,0|fn,0|on),on=l,i[(fn=lt)>>2]=St,i[fn+4>>2]=on,i[(fn=mt)>>2]=0,i[fn+4>>2]=0,fn=on,on=St,St=0;do{pn=0|k(0|on,0|fn,0|(jt=0|B(0|(Mt=0|N(0|(vt=0|U(fn>>31>>>6|0,0,0|on,0|fn)),0|l,26)),0|(vt=l),26)),0|l),i[(jt=lt+(St<<3)|0)>>2]=pn,i[jt+4>>2]=l,cn=0|k(0|(Ft=0|U(0|Mt,0|vt,0|i[(pn=jt=lt+((1|St)<<3)|0)>>2],0|i[pn+4>>2])),0|(pn=l),0|(Pt=0|B(0|(Mt=0|N(0|(vt=0|U(pn>>31>>>7|0,0,0|Ft,0|pn)),0|l,25)),0|(vt=l),25)),0|l),i[(Pt=jt)>>2]=cn,i[Pt+4>>2]=l,on=0|U(0|Mt,0|vt,0|i[(cn=Pt=lt+((St=St+2|0)<<3)|0)>>2],0|i[cn+4>>2]),fn=l,i[(cn=Pt)>>2]=on,i[cn+4>>2]=fn}while(St>>>0<10);fn=0|i[(St=mt)>>2],on=0|i[St+4>>2],cn=0|i[(St=lt)>>2],Pt=0|i[St+4>>2],St=0|F(0|fn,0|on,18,0),vt=l,Mt=0|U(0|cn,0|Pt,0|fn,0|on),on=0|U(0|Mt,0|l,0|St,0|vt),vt=l,i[(St=mt)>>2]=0,i[St+4>>2]=0,Pt=0|k(0|on,0|vt,0|(fn=0|B(0|(Mt=0|N(0|(St=0|U(vt>>31>>>6|0,0,0|on,0|vt)),0|l,26)),0|(St=l),26)),0|l),i[(fn=lt)>>2]=Pt,i[fn+4>>2]=l,Pt=0|U(0|Mt,0|St,0|i[(fn=At)>>2],0|i[fn+4>>2]),i[(fn=At)>>2]=Pt,i[fn+4>>2]=l,Mt=0|k(0|(Pt=0|i[(fn=Ae)>>2]),0|(St=0|i[fn+4>>2]),0|i[(fn=Pe)>>2],0|i[fn+4>>2]),fn=l,i[(vt=Pe)>>2]=Mt,i[vt+4>>2]=fn,jt=0|k(0|(on=0|i[(vt=J)>>2]),0|(cn=0|i[vt+4>>2]),0|i[(vt=Q)>>2],0|i[vt+4>>2]),vt=l,i[(pn=Q)>>2]=jt,i[pn+4>>2]=vt,Vt=0|k(0|(Ft=0|i[(pn=X)>>2]),0|(an=0|i[pn+4>>2]),0|i[(pn=Z)>>2],0|i[pn+4>>2]),pn=l,i[(Ut=Z)>>2]=Vt,i[Ut+4>>2]=pn,Jt=0|k(0|(kt=0|i[(Ut=ee)>>2]),0|(Nt=0|i[Ut+4>>2]),0|i[(Ut=te)>>2],0|i[Ut+4>>2]),Ut=l,i[(qt=te)>>2]=Jt,i[qt+4>>2]=Ut,wt=0|k(0|(sn=0|i[(qt=ne)>>2]),0|(zt=0|i[qt+4>>2]),0|i[(qt=re)>>2],0|i[qt+4>>2]),qt=l,i[(xt=re)>>2]=wt,i[xt+4>>2]=qt,ln=0|k(0|($t=0|i[(xt=ie)>>2]),0|(nn=0|i[xt+4>>2]),0|i[(xt=ae)>>2],0|i[xt+4>>2]),xt=l,i[(Tt=ae)>>2]=ln,i[Tt+4>>2]=xt,yt=0|k(0|(Ct=0|i[(Tt=oe)>>2]),0|(ht=0|i[Tt+4>>2]),0|i[(Tt=se)>>2],0|i[Tt+4>>2]),Tt=l,i[(tn=se)>>2]=yt,i[tn+4>>2]=Tt,Rt=0|k(0|(Yt=0|i[(tn=le)>>2]),0|(It=0|i[tn+4>>2]),0|i[(tn=ce)>>2],0|i[tn+4>>2]),tn=l,i[(rn=ce)>>2]=Rt,i[rn+4>>2]=tn,_t=0|k(0|(Gt=0|i[(rn=de)>>2]),0|(Ht=0|i[rn+4>>2]),0|i[(rn=ue)>>2],0|i[rn+4>>2]),rn=l,i[(Zt=ue)>>2]=_t,i[Zt+4>>2]=rn,Lt=0|k(0|(Qt=0|i[(Zt=pe)>>2]),0|(gt=0|i[Zt+4>>2]),0|i[(Zt=fe)>>2],0|i[Zt+4>>2]),Zt=l,i[(Xt=fe)>>2]=Lt,i[Xt+4>>2]=Zt,t=(Ye=he)+72|0;do{i[Ye>>2]=0,Ye=Ye+4|0}while((0|Ye)<(0|t));At=0|F(0|Mt,0|fn,121665,0),mt=l,i[(Xt=Ce)>>2]=At,i[Xt+4>>2]=mt,Xt=0|F(0|jt,0|vt,121665,0),i[(Et=_e)>>2]=Xt,i[Et+4>>2]=l,Et=0|F(0|Vt,0|pn,121665,0),i[(Xt=ge)>>2]=Et,i[Xt+4>>2]=l,Xt=0|F(0|Jt,0|Ut,121665,0),i[(Et=me)>>2]=Xt,i[Et+4>>2]=l,Et=0|F(0|wt,0|qt,121665,0),i[(Xt=ye)>>2]=Et,i[Xt+4>>2]=l,Xt=0|F(0|ln,0|xt,121665,0),i[(Et=Ee)>>2]=Xt,i[Et+4>>2]=l,Et=0|F(0|yt,0|Tt,121665,0),i[(Xt=Se)>>2]=Et,i[Xt+4>>2]=l,Xt=0|F(0|Rt,0|tn,121665,0),i[(Et=ve)>>2]=Xt,i[Et+4>>2]=l,Et=0|F(0|_t,0|rn,121665,0),i[(Xt=Te)>>2]=Et,i[Xt+4>>2]=l,Xt=0|F(0|Lt,0|Zt,121665,0),i[(Et=be)>>2]=Xt,i[Et+4>>2]=l,i[(Et=he)>>2]=0,i[Et+4>>2]=0,Et=mt,mt=At,At=0;do{Bt=0|k(0|mt,0|Et,0|(Wt=0|B(0|(Kt=0|N(0|(Xt=0|U(Et>>31>>>6|0,0,0|mt,0|Et)),0|l,26)),0|(Xt=l),26)),0|l),i[(Wt=Ce+(At<<3)|0)>>2]=Bt,i[Wt+4>>2]=l,dn=0|k(0|(Ot=0|U(0|Kt,0|Xt,0|i[(Bt=Wt=Ce+((1|At)<<3)|0)>>2],0|i[Bt+4>>2])),0|(Bt=l),0|(un=0|B(0|(Kt=0|N(0|(Xt=0|U(Bt>>31>>>7|0,0,0|Ot,0|Bt)),0|l,25)),0|(Xt=l),25)),0|l),i[(un=Wt)>>2]=dn,i[un+4>>2]=l,mt=0|U(0|Kt,0|Xt,0|i[(dn=un=Ce+((At=At+2|0)<<3)|0)>>2],0|i[dn+4>>2]),Et=l,i[(dn=un)>>2]=mt,i[dn+4>>2]=Et}while(At>>>0<10);Et=0|i[(At=he)>>2],mt=0|i[At+4>>2],Zt=0|i[(At=Ce)>>2],Lt=0|i[At+4>>2],At=0|F(0|Et,0|mt,18,0),rn=l,_t=0|U(0|Zt,0|Lt,0|Et,0|mt),mt=0|U(0|_t,0|l,0|At,0|rn),rn=l,i[(At=he)>>2]=0,i[At+4>>2]=0,Et=0|B(0|(_t=0|N(0|(At=0|U(rn>>31>>>6|0,0,0|mt,0|rn)),0|l,26)),0|(At=l),26),Lt=l,tn=0|i[(Zt=_e)>>2],Rt=0|i[Zt+4>>2],rn=0|k(0|(Zt=0|U(0|mt,0|rn,0|Pt,0|St)),0|l,0|Et,0|Lt),i[(Lt=Ce)>>2]=rn,i[Lt+4>>2]=l,Lt=0|U(0|tn,0|Rt,0|on,0|cn),Rt=0|U(0|Lt,0|l,0|_t,0|At),i[(At=_e)>>2]=Rt,i[At+4>>2]=l,Rt=0|U(0|i[(At=ge)>>2],0|i[At+4>>2],0|Ft,0|an),i[(At=ge)>>2]=Rt,i[At+4>>2]=l,Rt=0|U(0|i[(At=me)>>2],0|i[At+4>>2],0|kt,0|Nt),i[(At=me)>>2]=Rt,i[At+4>>2]=l,Rt=0|U(0|i[(At=ye)>>2],0|i[At+4>>2],0|sn,0|zt),i[(At=ye)>>2]=Rt,i[At+4>>2]=l,Rt=0|U(0|i[(At=Ee)>>2],0|i[At+4>>2],0|$t,0|nn),i[(At=Ee)>>2]=Rt,i[At+4>>2]=l,Rt=0|U(0|i[(At=Se)>>2],0|i[At+4>>2],0|Ct,0|ht),i[(At=Se)>>2]=Rt,i[At+4>>2]=l,Rt=0|U(0|i[(At=ve)>>2],0|i[At+4>>2],0|Yt,0|It),i[(At=ve)>>2]=Rt,i[At+4>>2]=l,Rt=0|U(0|i[(At=Te)>>2],0|i[At+4>>2],0|Gt,0|Ht),i[(At=Te)>>2]=Rt,i[At+4>>2]=l,Rt=0|U(0|i[(At=be)>>2],0|i[At+4>>2],0|Qt,0|gt),i[(At=be)>>2]=Rt,i[At+4>>2]=l,P(dt,Pe,Ce),Rt=0|i[(At=dt+144|0)>>2],_t=0|i[At+4>>2],tn=0|i[(Lt=At=dt+64|0)>>2],rn=0|i[Lt+4>>2],Lt=0|F(0|Rt,0|_t,18,0),Et=l,Zt=0|U(0|tn,0|rn,0|Rt,0|_t),_t=0|U(0|Zt,0|l,0|Lt,0|Et),i[(Et=At)>>2]=_t,i[Et+4>>2]=l,_t=0|i[(Et=dt+136|0)>>2],At=0|i[Et+4>>2],Zt=0|i[(Lt=Et=dt+56|0)>>2],Rt=0|i[Lt+4>>2],Lt=0|F(0|_t,0|At,18,0),rn=l,tn=0|U(0|Zt,0|Rt,0|_t,0|At),At=0|U(0|tn,0|l,0|Lt,0|rn),i[(rn=Et)>>2]=At,i[rn+4>>2]=l,At=0|i[(rn=dt+128|0)>>2],Et=0|i[rn+4>>2],tn=0|i[(Lt=rn=dt+48|0)>>2],_t=0|i[Lt+4>>2],Lt=0|F(0|At,0|Et,18,0),Rt=l,Zt=0|U(0|tn,0|_t,0|At,0|Et),Et=0|U(0|Zt,0|l,0|Lt,0|Rt),i[(Rt=rn)>>2]=Et,i[Rt+4>>2]=l,Et=0|i[(Rt=dt+120|0)>>2],rn=0|i[Rt+4>>2],Zt=0|i[(Lt=Rt=dt+40|0)>>2],At=0|i[Lt+4>>2],Lt=0|F(0|Et,0|rn,18,0),_t=l,tn=0|U(0|Zt,0|At,0|Et,0|rn),rn=0|U(0|tn,0|l,0|Lt,0|_t),i[(_t=Rt)>>2]=rn,i[_t+4>>2]=l,rn=0|i[(_t=dt+112|0)>>2],Rt=0|i[_t+4>>2],tn=0|i[(Lt=_t=dt+32|0)>>2],Et=0|i[Lt+4>>2],Lt=0|F(0|rn,0|Rt,18,0),At=l,Zt=0|U(0|tn,0|Et,0|rn,0|Rt),Rt=0|U(0|Zt,0|l,0|Lt,0|At),i[(At=_t)>>2]=Rt,i[At+4>>2]=l,Rt=0|i[(At=dt+104|0)>>2],_t=0|i[At+4>>2],Zt=0|i[(Lt=At=dt+24|0)>>2],rn=0|i[Lt+4>>2],Lt=0|F(0|Rt,0|_t,18,0),Et=l,tn=0|U(0|Zt,0|rn,0|Rt,0|_t),_t=0|U(0|tn,0|l,0|Lt,0|Et),i[(Et=At)>>2]=_t,i[Et+4>>2]=l,_t=0|i[(Et=dt+96|0)>>2],At=0|i[Et+4>>2],tn=0|i[(Lt=Et=dt+16|0)>>2],Rt=0|i[Lt+4>>2],Lt=0|F(0|_t,0|At,18,0),rn=l,Zt=0|U(0|tn,0|Rt,0|_t,0|At),At=0|U(0|Zt,0|l,0|Lt,0|rn),i[(rn=Et)>>2]=At,i[rn+4>>2]=l,At=0|i[(rn=dt+88|0)>>2],Et=0|i[rn+4>>2],Zt=0|i[(Lt=rn=dt+8|0)>>2],_t=0|i[Lt+4>>2],Lt=0|F(0|At,0|Et,18,0),Rt=l,tn=0|U(0|Zt,0|_t,0|At,0|Et),Et=0|U(0|tn,0|l,0|Lt,0|Rt),i[(Rt=rn)>>2]=Et,i[Rt+4>>2]=l,Lt=0|i[(Et=Rt=dt+80|0)>>2],tn=0|i[Et+4>>2],At=0|i[(Et=dt)>>2],_t=0|i[Et+4>>2],Et=0|F(0|Lt,0|tn,18,0),Zt=l,mt=0|U(0|At,0|_t,0|Lt,0|tn),tn=0|U(0|mt,0|l,0|Et,0|Zt),Zt=l,i[(Et=dt)>>2]=tn,i[Et+4>>2]=Zt,i[(Et=Rt)>>2]=0,i[Et+4>>2]=0,Et=Zt,Zt=tn,tn=0;do{At=0|k(0|Zt,0|Et,0|(_t=0|B(0|(Lt=0|N(0|(mt=0|U(Et>>31>>>6|0,0,0|Zt,0|Et)),0|l,26)),0|(mt=l),26)),0|l),i[(_t=dt+(tn<<3)|0)>>2]=At,i[_t+4>>2]=l,xt=0|k(0|(Tt=0|U(0|Lt,0|mt,0|i[(At=_t=dt+((1|tn)<<3)|0)>>2],0|i[At+4>>2])),0|(At=l),0|(yt=0|B(0|(Lt=0|N(0|(mt=0|U(At>>31>>>7|0,0,0|Tt,0|At)),0|l,25)),0|(mt=l),25)),0|l),i[(yt=_t)>>2]=xt,i[yt+4>>2]=l,Zt=0|U(0|Lt,0|mt,0|i[(xt=yt=dt+((tn=tn+2|0)<<3)|0)>>2],0|i[xt+4>>2]),Et=l,i[(xt=yt)>>2]=Zt,i[xt+4>>2]=Et}while(tn>>>0<10);Et=0|i[(tn=Rt)>>2],Zt=0|i[tn+4>>2],gt=0|i[(tn=dt)>>2],Qt=0|i[tn+4>>2],tn=0|F(0|Et,0|Zt,18,0),Ht=l,Gt=0|U(0|gt,0|Qt,0|Et,0|Zt),Zt=0|U(0|Gt,0|l,0|tn,0|Ht),Ht=l,i[(tn=Rt)>>2]=0,i[tn+4>>2]=0,Qt=0|k(0|Zt,0|Ht,0|(Et=0|B(0|(Gt=0|N(0|(tn=0|U(Ht>>31>>>6|0,0,0|Zt,0|Ht)),0|l,26)),0|(tn=l),26)),0|l),i[(Et=dt)>>2]=Qt,i[Et+4>>2]=l,Qt=0|U(0|Gt,0|tn,0|i[(Et=rn)>>2],0|i[Et+4>>2]),i[(Et=rn)>>2]=Qt,i[Et+4>>2]=l,Et=0;do{Gt=0|i[(tn=Qt=lt+(Et<<3)|0)>>2],Ht=0|i[tn+4>>2],gt=0|i[(Zt=tn=it+(Et<<3)|0)>>2],Yt=((It=0|i[Zt+4>>2])^Ht)&ft,Ht=0|N(0,(Zt=(gt^Gt)&pt)^Gt|0,32),i[(Gt=Qt)>>2]=Ht,i[Gt+4>>2]=l,Gt=0|N(0,Zt^gt|0,32),i[(gt=tn)>>2]=Gt,i[gt+4>>2]=l,Et=Et+1|0}while(10!=(0|Et));hn=0;do{Rt=0|i[(rn=Et=dt+(hn<<3)|0)>>2],gt=0|i[rn+4>>2],tn=0|i[(Gt=rn=ot+(hn<<3)|0)>>2],Ht=((Zt=0|i[Gt+4>>2])^gt)&ft,gt=0|N(0,(Gt=(tn^Rt)&pt)^Rt|0,32),i[(Rt=Et)>>2]=gt,i[Rt+4>>2]=l,Rt=0|N(0,Gt^tn|0,32),i[(tn=rn)>>2]=Rt,i[tn+4>>2]=l,hn=hn+1|0}while(10!=(0|hn));if(8==(0|(nt=nt+1|0))){_n=rt,gn=it,mn=at,yn=ot,En=st,Sn=lt,vn=ct,Tn=dt;break}ft=dt,pt=lt,tn=ot,Rt=it,xe=ut<<1&255,dt=ct,ct=ft,lt=st,st=pt,ot=at,at=tn,it=rt,rt=Rt}if(32==(0|(rt=Qe+1|0))){bn=Sn,Cn=Tn;break}Qe=rt,Xe=gn,Ze=_n,ke=yn,et=mn,Ue=Sn,tt=En,Ge=Tn,Ne=vn}Ke=bn,t=(Ye=Be)+80|0;do{i[Ye>>2]=i[Ke>>2],Ye=Ye+4|0,Ke=Ke+4|0}while((0|Ye)<(0|t));Ke=Cn,t=(Ye=Fe)+80|0;do{i[Ye>>2]=i[Ke>>2],Ye=Ye+4|0,Ke=Ke+4|0}while((0|Ye)<(0|t));M(Ce,Fe),M(Le,Ce),M(De,Le),A(Ae,De,Fe),A(Pe,Ae,Ce),M(De,Pe),A(Me,De,Ae),M(De,Me),M(Le,De),M(De,Le),M(Le,De),M(De,Le),A(Oe,De,Me),M(De,Oe),M(Le,De),M(De,Le),M(Le,De),M(De,Le),M(Le,De),M(De,Le),M(Le,De),M(De,Le),M(Le,De),A(Ie,Le,Oe),M(De,Ie),M(Le,De),M(De,Le),M(Le,De),M(De,Le),M(Le,De),M(De,Le),M(Le,De),M(De,Le),M(Le,De),M(De,Le),M(Le,De),M(De,Le),M(Le,De),M(De,Le),M(Le,De),M(De,Le),M(Le,De),M(De,Le),M(Le,De),A(De,Le,Ie),M(Le,De),M(De,Le),M(Le,De),M(De,Le),M(Le,De),M(De,Le),M(Le,De),M(De,Le),M(Le,De),M(De,Le),A(we,De,Oe),M(De,we),M(Le,De),Oe=2;do{M(De,Le),M(Le,De),Oe=Oe+2|0}while((0|Oe)<50);A(Re,Le,we),M(Le,Re),M(De,Le),Oe=2;do{M(Le,De),M(De,Le),Oe=Oe+2|0}while((0|Oe)<100);A(Le,De,Re),M(De,Le),M(Le,De),Re=2;do{M(De,Le),M(Le,De),Re=Re+2|0}while((0|Re)<50);for(A(De,Le,we),M(Le,De),M(De,Le),M(Le,De),M(De,Le),M(Le,De),A(je,Le,Pe),A(Fe,Be,je),je=0|i[Fe>>2],i[Ce>>2]=je,i[(Be=Ce+4|0)>>2]=i[Fe+8>>2],i[(Pe=Ce+8|0)>>2]=i[Fe+16>>2],i[(Le=Ce+12|0)>>2]=i[Fe+24>>2],i[(De=Ce+16|0)>>2]=i[Fe+32>>2],i[(we=Ce+20|0)>>2]=i[Fe+40>>2],i[(Re=Ce+24|0)>>2]=i[Fe+48>>2],i[(Oe=Ce+28|0)>>2]=i[Fe+56>>2],i[(Ie=Ce+32|0)>>2]=i[Fe+64>>2],i[(Me=Ce+36|0)>>2]=i[Fe+72>>2],Fe=je,je=0;Ae=Ce+(je<<2)|0,Ke=Fe>>31&Fe,1&je?(t=Ke>>25,i[Ae>>2]=(0|c(t,-33554432))+Fe,bn=(0|i[(Ke=Ce+((Ae=je+1|0)<<2)|0)>>2])+t|0,i[Ke>>2]=bn,An=bn,Pn=Ae):(Ye=Ke>>26,i[Ae>>2]=(0|c(Ye,-67108864))+Fe,bn=(0|i[(Cn=Ce+((t=je+1|0)<<2)|0)>>2])+Ye|0,i[Cn>>2]=bn,An=bn,Pn=t),9!=(0|Pn);)Fe=An,je=Pn;for(je=((Pn=0|i[Me>>2])>>31&Pn)>>25,i[Me>>2]=(0|c(je,-33554432))+Pn,Pn=(19*je|0)+(0|i[Ce>>2])|0,i[Ce>>2]=Pn,je=Pn,Pn=0;An=Ce+(Pn<<2)|0,Fe=je>>31&je,1&Pn?(t=Fe>>25,i[An>>2]=(0|c(t,-33554432))+je,bn=(0|i[(Fe=Ce+((An=Pn+1|0)<<2)|0)>>2])+t|0,i[Fe>>2]=bn,Mn=An,On=bn):(Ae=Fe>>26,i[An>>2]=(0|c(Ae,-67108864))+je,t=(0|i[(Ke=Ce+((bn=Pn+1|0)<<2)|0)>>2])+Ae|0,i[Ke>>2]=t,Mn=bn,On=t),9!=(0|Mn);)je=On,Pn=Mn;for(Pn=((Mn=0|i[Me>>2])>>31&Mn)>>25,i[Me>>2]=(0|c(Pn,-33554432))+Mn,Mn=(19*Pn|0)+(0|i[Ce>>2])|0,On=(0|c(Pn=(Mn>>31&Mn)>>26,-67108864))+Mn|0,i[Ce>>2]=On,i[Be>>2]=Pn+(0|i[Be>>2]),Pn=On,On=0;Mn=Ce+(On<<2)|0,1&On?(i[Mn>>2]=33554431&Pn,je=(0|i[(An=Ce+((Mn=On+1|0)<<2)|0)>>2])+(Pn>>25)|0,i[An>>2]=je,In=Mn,wn=je):(i[Mn>>2]=67108863&Pn,An=(0|i[(bn=Ce+((je=On+1|0)<<2)|0)>>2])+(Pn>>26)|0,i[bn>>2]=An,In=je,wn=An),9!=(0|In);)Pn=wn,On=In;for(In=0|i[Me>>2],i[Me>>2]=33554431&In,On=(19*(In>>25)|0)+(0|i[Ce>>2])|0,i[Ce>>2]=On,In=On,On=0;wn=Ce+(On<<2)|0,1&On?(i[wn>>2]=33554431&In,Pn=(0|i[(Mn=Ce+((wn=On+1|0)<<2)|0)>>2])+(In>>25)|0,i[Mn>>2]=Pn,Rn=wn,Dn=Pn):(i[wn>>2]=67108863&In,Mn=(0|i[(je=Ce+((Pn=On+1|0)<<2)|0)>>2])+(In>>26)|0,i[je>>2]=Mn,Rn=Pn,Dn=Mn),9!=(0|Rn);)In=Dn,On=Rn;for(On=33554431&(Rn=0|i[Me>>2]),i[Me>>2]=On,Dn=(19*(Rn>>25)|0)+(0|i[Ce>>2])|0,i[Ce>>2]=Dn,Rn=1,In=~(Dn+-67108845>>31);;){if(Pn=0|i[Ce+(Rn<<2)>>2],Ln=1&Rn?(Pn=(Mn=(Pn=(Mn=Pn<<16&(-33554432^Pn))<<8&Mn)<<4&Pn)<<2&Mn)<<1&Pn:(Mn=(wn=(Mn=(wn=Pn<<16&(-67108864^Pn))<<8&wn)<<4&Mn)<<2&wn)<<1&Mn,Pn=Ln>>31&In,10==(0|(Rn=Rn+1|0))){Nn=Pn;break}In=Pn}return In=Dn-(67108845&Nn)|0,i[Ce>>2]=In,Ce=67108863&Nn,Dn=33554431&Nn,Ln=(Rn=(0|i[Be>>2])-Dn|0)<<2,Mn=(Pn=(0|i[Pe>>2])-Ce|0)<<3,je=(wn=(0|i[Le>>2])-Dn|0)<<5,Nn=(An=(0|i[De>>2])-Nn|0)<<6,bn=(0|i[we>>2])-Dn|0,i[we>>2]=bn,Fe=(we=(0|i[Re>>2])-Ce|0)<<1,Ke=(t=(0|i[Oe>>2])-Dn|0)<<3,Ae=(0|i[Ie>>2])-Ce<<4,i[Be>>2]=Ln,i[Pe>>2]=Mn,i[Le>>2]=je,i[De>>2]=Nn,i[Re>>2]=Fe,i[Oe>>2]=Ke,i[Ie>>2]=Ae,i[Me>>2]=On-Dn<<6,r[e>>0]=In,r[e+1>>0]=In>>>8,r[e+2>>0]=In>>>16,r[e+3>>0]=Ln|In>>>24,r[e+4>>0]=Rn>>>6,r[e+5>>0]=Rn>>>14,r[e+6>>0]=Mn|Rn>>>22,r[e+7>>0]=Pn>>>5,r[e+8>>0]=Pn>>>13,r[e+9>>0]=je|Pn>>>21,r[e+10>>0]=wn>>>3,r[e+11>>0]=wn>>>11,r[e+12>>0]=Nn|wn>>>19,r[e+13>>0]=An>>>2,r[e+14>>0]=An>>>10,r[e+15>>0]=An>>>18,r[e+16>>0]=bn,r[e+17>>0]=bn>>>8,r[e+18>>0]=bn>>>16,r[e+19>>0]=bn>>>24|Fe,r[e+20>>0]=we>>>7,r[e+21>>0]=we>>>15,r[e+22>>0]=we>>>23|Ke,r[e+23>>0]=t>>>5,r[e+24>>0]=t>>>13,Ke=0|i[Ie>>2],r[e+25>>0]=t>>>21|Ke,r[e+26>>0]=Ke>>>8,r[e+27>>0]=Ke>>>16,t=0|i[Me>>2],r[e+28>>0]=Ke>>>24|t,r[e+29>>0]=t>>>8,r[e+30>>0]=t>>>16,r[e+31>>0]=t>>>24,o=s,0},_free:function(e){var t,n,r=0,a=0,o=0,s=0,l=0,c=0,d=0,u=0,p=0,f=0,h=0,g=0,m=0,y=0,E=0,S=0,v=0,T=0,b=0,C=0,A=0,P=0,M=0,O=0,I=0,w=0,R=0,D=0,L=0,N=0,k=0,U=0,G=0,x=0;if(e|=0){(r=e+-8|0)>>>0<(a=0|i[47])>>>0&&_(),1==(0|(e=3&(t=0|i[e+-4>>2])))&&_(),n=r+(o=-8&t)|0;do{if(1&t)p=r,f=o;else{if(s=0|i[r>>2],!e)return;if(c=s+o|0,(l=r+(0-s)|0)>>>0<a>>>0&&_(),(0|l)==(0|i[48])){if(3!=(3&(u=0|i[(d=n+4|0)>>2])|0)){p=l,f=c;break}return i[45]=c,i[d>>2]=-2&u,i[l+4>>2]=1|c,void(i[l+c>>2]=c)}if(u=s>>>3,s>>>0<256){if(s=0|i[l+8>>2],d=0|i[l+12>>2],(0|s)!=(0|(h=212+(u<<1<<2)|0))&&(s>>>0<a>>>0&&_(),(0|i[s+12>>2])!=(0|l)&&_()),(0|d)==(0|s)){i[43]=i[43]&~(1<<u),p=l,f=c;break}(0|d)!=(0|h)?(d>>>0<a>>>0&&_(),(0|i[(h=d+8|0)>>2])==(0|l)?g=h:_()):g=d+8|0,i[s+12>>2]=d,i[g>>2]=s,p=l,f=c;break}s=0|i[l+24>>2],d=0|i[l+12>>2];do{if((0|d)==(0|l)){if(m=0|i[(u=(h=l+16|0)+4|0)>>2])S=m,v=u;else{if(!(y=0|i[h>>2])){E=0;break}S=y,v=h}for(;;)if(m=0|i[(u=S+20|0)>>2])S=m,v=u;else{if(!(m=0|i[(u=S+16|0)>>2])){T=S,b=v;break}S=m,v=u}if(!(b>>>0<a>>>0)){i[b>>2]=0,E=T;break}_()}else{if((u=0|i[l+8>>2])>>>0<a>>>0&&_(),(0|i[(m=u+12|0)>>2])!=(0|l)&&_(),(0|i[(h=d+8|0)>>2])==(0|l)){i[m>>2]=d,i[h>>2]=u,E=d;break}_()}}while(0);if(s){if(d=0|i[l+28>>2],(0|l)==(0|i[(u=476+(d<<2)|0)>>2])){if(i[u>>2]=E,!E){i[44]=i[44]&~(1<<d),p=l,f=c;break}}else if(s>>>0<(0|i[47])>>>0&&_(),(0|i[(d=s+16|0)>>2])==(0|l)?i[d>>2]=E:i[s+20>>2]=E,!E){p=l,f=c;break}E>>>0<(d=0|i[47])>>>0&&_(),i[E+24>>2]=s,h=0|i[(u=l+16|0)>>2];do{if(h){if(!(h>>>0<d>>>0)){i[E+16>>2]=h,i[h+24>>2]=E;break}_()}}while(0);if(h=0|i[u+4>>2]){if(!(h>>>0<(0|i[47])>>>0)){i[E+20>>2]=h,i[h+24>>2]=E,p=l,f=c;break}_()}else p=l,f=c}else p=l,f=c}}while(0);if(p>>>0>=n>>>0&&_(),1&(r=0|i[(o=n+4|0)>>2])||_(),2&r)i[o>>2]=-2&r,i[p+4>>2]=1|f,i[p+f>>2]=f,w=f;else{if((0|n)==(0|i[49])){if(E=(0|i[46])+f|0,i[46]=E,i[49]=p,i[p+4>>2]=1|E,(0|p)!=(0|i[48]))return;return i[48]=0,void(i[45]=0)}if((0|n)==(0|i[48]))return E=(0|i[45])+f|0,i[45]=E,i[48]=p,i[p+4>>2]=1|E,void(i[p+E>>2]=E);E=(-8&r)+f|0,a=r>>>3;do{if(r>>>0>=256){T=0|i[n+24>>2],b=0|i[n+12>>2];do{if((0|b)==(0|n)){if(g=0|i[(S=(v=n+16|0)+4|0)>>2])A=g,P=S;else{if(!(e=0|i[v>>2])){C=0;break}A=e,P=v}for(;;)if(g=0|i[(S=A+20|0)>>2])A=g,P=S;else{if(!(g=0|i[(S=A+16|0)>>2])){M=A,O=P;break}A=g,P=S}if(!(O>>>0<(0|i[47])>>>0)){i[O>>2]=0,C=M;break}_()}else{if((S=0|i[n+8>>2])>>>0<(0|i[47])>>>0&&_(),(0|i[(g=S+12|0)>>2])!=(0|n)&&_(),(0|i[(v=b+8|0)>>2])==(0|n)){i[g>>2]=b,i[v>>2]=S,C=b;break}_()}}while(0);if(T){if(b=0|i[n+28>>2],(0|n)==(0|i[(c=476+(b<<2)|0)>>2])){if(i[c>>2]=C,!C){i[44]=i[44]&~(1<<b);break}}else if(T>>>0<(0|i[47])>>>0&&_(),(0|i[(b=T+16|0)>>2])==(0|n)?i[b>>2]=C:i[T+20>>2]=C,!C)break;C>>>0<(b=0|i[47])>>>0&&_(),i[C+24>>2]=T,l=0|i[(c=n+16|0)>>2];do{if(l){if(!(l>>>0<b>>>0)){i[C+16>>2]=l,i[l+24>>2]=C;break}_()}}while(0);if(l=0|i[c+4>>2]){if(!(l>>>0<(0|i[47])>>>0)){i[C+20>>2]=l,i[l+24>>2]=C;break}_()}}}else{if(l=0|i[n+8>>2],b=0|i[n+12>>2],(0|l)!=(0|(T=212+(a<<1<<2)|0))&&(l>>>0<(0|i[47])>>>0&&_(),(0|i[l+12>>2])!=(0|n)&&_()),(0|b)==(0|l)){i[43]=i[43]&~(1<<a);break}(0|b)!=(0|T)?(b>>>0<(0|i[47])>>>0&&_(),(0|i[(T=b+8|0)>>2])==(0|n)?I=T:_()):I=b+8|0,i[l+12>>2]=b,i[I>>2]=l}}while(0);if(i[p+4>>2]=1|E,i[p+E>>2]=E,(0|p)==(0|i[48]))return void(i[45]=E);w=E}if(f=w>>>3,w>>>0<256)return r=212+(f<<1<<2)|0,(o=0|i[43])&(E=1<<f)?(I=0|i[(f=r+8|0)>>2])>>>0<(0|i[47])>>>0?_():(R=f,D=I):(i[43]=o|E,R=r+8|0,D=r),i[R>>2]=p,i[D+12>>2]=p,i[p+8>>2]=D,void(i[p+12>>2]=r);L=(r=w>>>8)?w>>>0>16777215?31:w>>>((o=14-((r=((R=r<<(D=(r+1048320|0)>>>16&8))+520192|0)>>>16&4)|D|(R=((E=R<<r)+245760|0)>>>16&2))+(E<<R>>>15)|0)+7|0)&1|o<<1:0,o=476+(L<<2)|0,i[p+28>>2]=L,i[p+20>>2]=0,i[p+16>>2]=0,R=0|i[44],E=1<<L;do{if(R&E){for(D=w<<(31==(0|L)?0:25-(L>>>1)|0),r=0|i[o>>2];;){if((-8&i[r+4>>2]|0)==(0|w)){N=r,k=130;break}if(!(f=0|i[(I=r+16+(D>>>31<<2)|0)>>2])){U=I,G=r,k=127;break}D<<=1,r=f}if(127==(0|k)){if(!(U>>>0<(0|i[47])>>>0)){i[U>>2]=p,i[p+24>>2]=G,i[p+12>>2]=p,i[p+8>>2]=p;break}_()}else if(130==(0|k)){if((D=0|i[(r=N+8|0)>>2])>>>0>=(c=0|i[47])>>>0&N>>>0>=c>>>0){i[D+12>>2]=p,i[r>>2]=p,i[p+8>>2]=D,i[p+12>>2]=N,i[p+24>>2]=0;break}_()}}else i[44]=R|E,i[o>>2]=p,i[p+24>>2]=o,i[p+12>>2]=p,i[p+8>>2]=p}while(0);if(p=(0|i[51])-1|0,i[51]=p,!p){for(x=628;p=0|i[x>>2];)x=p+8|0;i[51]=-1}}},_i64Add:U,_bitshift64Ashr:N,_i64Subtract:k,_memset:G,_malloc:function(e){e|=0;var t=0,n=0,r=0,a=0,o=0,s=0,l=0,c=0,d=0,u=0,p=0,f=0,h=0,y=0,E=0,S=0,v=0,T=0,C=0,A=0,P=0,M=0,I=0,w=0,R=0,D=0,L=0,N=0,k=0,U=0,G=0,x=0,B=0,F=0,j=0,Y=0,K=0,W=0,H=0,V=0,$=0,z=0,q=0,J=0,Q=0,X=0,Z=0,ee=0,te=0,ne=0,re=0,ie=0,ae=0,oe=0,se=0,le=0,ce=0,de=0,ue=0,pe=0,fe=0,he=0,_e=0,ge=0,me=0,ye=0,Ee=0,Se=0,ve=0,Te=0,be=0,Ce=0,Ae=0,Pe=0,Me=0,Oe=0,Ie=0,we=0,Re=0,De=0,Le=0,Ne=0,ke=0,Ue=0,Ge=0,xe=0,Be=0,Fe=0,je=0,Ye=0;do{if(e>>>0<245){if(n=(t=e>>>0<11?16:e+11&-8)>>>3,3&(a=(r=0|i[43])>>>n)){c=0|i[(l=(s=212+((o=(1&a^1)+n|0)<<1<<2)|0)+8|0)>>2],u=0|i[(d=c+8|0)>>2];do{if((0|s)!=(0|u)){if(u>>>0<(0|i[47])>>>0&&_(),(0|i[(p=u+12|0)>>2])==(0|c)){i[p>>2]=s,i[l>>2]=u;break}_()}else i[43]=r&~(1<<o)}while(0);return u=o<<3,i[c+4>>2]=3|u,i[(l=c+u+4|0)>>2]=1|i[l>>2],0|d}if(t>>>0>(l=0|i[45])>>>0){if(a){f=0|i[(y=(h=212+((E=((u=(p=(u=((s=a<<n&((u=2<<n)|0-u))&0-s)-1|0)>>>(s=u>>>12&16))>>>5&8)|s|(p=(f=p>>>u)>>>2&4)|(f=(h=f>>>p)>>>1&2)|(h=(y=h>>>f)>>>1&1))+(y>>>h)|0)<<1<<2)|0)+8|0)>>2],s=0|i[(p=f+8|0)>>2];do{if((0|h)!=(0|s)){if(s>>>0<(0|i[47])>>>0&&_(),(0|i[(u=s+12|0)>>2])==(0|f)){i[u>>2]=h,i[y>>2]=s,S=0|i[45];break}_()}else i[43]=r&~(1<<E),S=l}while(0);return l=(E<<3)-t|0,i[f+4>>2]=3|t,i[(r=f+t|0)+4>>2]=1|l,i[r+l>>2]=l,S&&(s=0|i[48],h=212+((y=S>>>3)<<1<<2)|0,(n=0|i[43])&(a=1<<y)?(d=0|i[(y=h+8|0)>>2])>>>0<(0|i[47])>>>0?_():(v=y,T=d):(i[43]=n|a,v=h+8|0,T=h),i[v>>2]=s,i[T+12>>2]=s,i[s+8>>2]=T,i[s+12>>2]=h),i[45]=l,i[48]=r,0|p}if(r=0|i[44]){for(d=0|i[476+(((l=(h=(l=(r&0-r)-1|0)>>>(r=l>>>12&16))>>>5&8)|r|(h=(s=h>>>l)>>>2&4)|(s=(a=s>>>h)>>>1&2)|(a=(n=a>>>s)>>>1&1))+(n>>>a)<<2)>>2],a=(-8&i[d+4>>2])-t|0,n=d,s=d;;){if(d=0|i[n+16>>2])P=d;else{if(!(h=0|i[n+20>>2])){C=a,A=s;break}P=h}a=(h=(d=(-8&i[P+4>>2])-t|0)>>>0<a>>>0)?d:a,n=P,s=h?P:s}A>>>0<(s=0|i[47])>>>0&&_(),A>>>0>=(n=A+t|0)>>>0&&_(),a=0|i[A+24>>2],p=0|i[A+12>>2];do{if((0|p)==(0|A)){if(E=0|i[(f=A+20|0)>>2])I=E,w=f;else{if(!(d=0|i[(h=A+16|0)>>2])){M=0;break}I=d,w=h}for(;;)if(E=0|i[(f=I+20|0)>>2])I=E,w=f;else{if(!(E=0|i[(f=I+16|0)>>2])){R=I,D=w;break}I=E,w=f}if(!(D>>>0<s>>>0)){i[D>>2]=0,M=R;break}_()}else{if((f=0|i[A+8>>2])>>>0<s>>>0&&_(),(0|i[(E=f+12|0)>>2])!=(0|A)&&_(),(0|i[(h=p+8|0)>>2])==(0|A)){i[E>>2]=p,i[h>>2]=f,M=p;break}_()}}while(0);do{if(a){if(p=0|i[A+28>>2],(0|A)==(0|i[(s=476+(p<<2)|0)>>2])){if(i[s>>2]=M,!M){i[44]=i[44]&~(1<<p);break}}else if(a>>>0<(0|i[47])>>>0&&_(),(0|i[(p=a+16|0)>>2])==(0|A)?i[p>>2]=M:i[a+20>>2]=M,!M)break;M>>>0<(p=0|i[47])>>>0&&_(),i[M+24>>2]=a,s=0|i[A+16>>2];do{if(s){if(!(s>>>0<p>>>0)){i[M+16>>2]=s,i[s+24>>2]=M;break}_()}}while(0);if(s=0|i[A+20>>2]){if(!(s>>>0<(0|i[47])>>>0)){i[M+20>>2]=s,i[s+24>>2]=M;break}_()}}}while(0);return C>>>0<16?(a=C+t|0,i[A+4>>2]=3|a,i[(s=A+a+4|0)>>2]=1|i[s>>2]):(i[A+4>>2]=3|t,i[n+4>>2]=1|C,i[n+C>>2]=C,(s=0|i[45])&&(a=0|i[48],s=212+((p=s>>>3)<<1<<2)|0,(f=0|i[43])&(h=1<<p)?(E=0|i[(p=s+8|0)>>2])>>>0<(0|i[47])>>>0?_():(L=p,N=E):(i[43]=f|h,L=s+8|0,N=s),i[L>>2]=a,i[N+12>>2]=a,i[a+8>>2]=N,i[a+12>>2]=s),i[45]=C,i[48]=n),0|(A+8|0)}k=t}else k=t}else if(e>>>0<=4294967231)if(a=-8&(s=e+11|0),h=0|i[44]){f=0-a|0,U=(E=s>>>8)?a>>>0>16777215?31:a>>>((r=14-((E=((p=E<<(s=(E+1048320|0)>>>16&8))+520192|0)>>>16&4)|s|(p=((d=p<<E)+245760|0)>>>16&2))+(d<<p>>>15)|0)+7|0)&1|r<<1:0,r=0|i[476+(U<<2)>>2];e:do{if(r)for(p=f,d=0,s=a<<(31==(0|U)?0:25-(U>>>1)|0),E=r,l=0;;){if((c=(y=-8&i[E+4>>2])-a|0)>>>0<p>>>0){if((0|y)==(0|a)){j=c,Y=E,K=E,F=90;break e}W=c,H=E}else W=p,H=l;if(y=0==(0|(c=0|i[E+20>>2]))|(0|c)==(0|(E=0|i[E+16+(s>>>31<<2)>>2]))?d:c,c=0==(0|E)){G=W,x=y,B=H,F=86;break}p=W,d=y,s<<=1&c^1,l=H}else G=f,x=0,B=0,F=86}while(0);if(86==(0|F)){if(0==(0|x)&0==(0|B)){if(!(f=h&((r=2<<U)|0-r))){k=a;break}V=0|i[476+(((r=(t=(r=(f&0-f)-1|0)>>>(f=r>>>12&16))>>>5&8)|f|(t=(n=t>>>r)>>>2&4)|(n=(l=n>>>t)>>>1&2)|(l=(s=l>>>n)>>>1&1))+(s>>>l)<<2)>>2]}else V=x;V?(j=G,Y=V,K=B,F=90):($=G,z=B)}if(90==(0|F))for(;;)if(F=0,n=(s=(l=(-8&i[Y+4>>2])-a|0)>>>0<j>>>0)?l:j,l=s?Y:K,s=0|i[Y+16>>2])j=n,Y=s,K=l,F=90;else{if(!(Y=0|i[Y+20>>2])){$=n,z=l;break}j=n,K=l,F=90}if(0!=(0|z)&&$>>>0<((0|i[45])-a|0)>>>0){z>>>0<(h=0|i[47])>>>0&&_(),z>>>0>=(l=z+a|0)>>>0&&_(),n=0|i[z+24>>2],s=0|i[z+12>>2];do{if((0|s)==(0|z)){if(f=0|i[(t=z+20|0)>>2])J=f,Q=t;else{if(!(d=0|i[(r=z+16|0)>>2])){q=0;break}J=d,Q=r}for(;;)if(f=0|i[(t=J+20|0)>>2])J=f,Q=t;else{if(!(f=0|i[(t=J+16|0)>>2])){X=J,Z=Q;break}J=f,Q=t}if(!(Z>>>0<h>>>0)){i[Z>>2]=0,q=X;break}_()}else{if((t=0|i[z+8>>2])>>>0<h>>>0&&_(),(0|i[(f=t+12|0)>>2])!=(0|z)&&_(),(0|i[(r=s+8|0)>>2])==(0|z)){i[f>>2]=s,i[r>>2]=t,q=s;break}_()}}while(0);do{if(n){if(s=0|i[z+28>>2],(0|z)==(0|i[(h=476+(s<<2)|0)>>2])){if(i[h>>2]=q,!q){i[44]=i[44]&~(1<<s);break}}else if(n>>>0<(0|i[47])>>>0&&_(),(0|i[(s=n+16|0)>>2])==(0|z)?i[s>>2]=q:i[n+20>>2]=q,!q)break;q>>>0<(s=0|i[47])>>>0&&_(),i[q+24>>2]=n,h=0|i[z+16>>2];do{if(h){if(!(h>>>0<s>>>0)){i[q+16>>2]=h,i[h+24>>2]=q;break}_()}}while(0);if(h=0|i[z+20>>2]){if(!(h>>>0<(0|i[47])>>>0)){i[q+20>>2]=h,i[h+24>>2]=q;break}_()}}}while(0);do{if($>>>0>=16){if(i[z+4>>2]=3|a,i[l+4>>2]=1|$,i[l+$>>2]=$,n=$>>>3,$>>>0<256){h=212+(n<<1<<2)|0,(s=0|i[43])&(t=1<<n)?(r=0|i[(n=h+8|0)>>2])>>>0<(0|i[47])>>>0?_():(ee=n,te=r):(i[43]=s|t,ee=h+8|0,te=h),i[ee>>2]=l,i[te+12>>2]=l,i[l+8>>2]=te,i[l+12>>2]=h;break}if(ne=(h=$>>>8)?$>>>0>16777215?31:$>>>((n=14-((h=((s=h<<(t=(h+1048320|0)>>>16&8))+520192|0)>>>16&4)|t|(s=((r=s<<h)+245760|0)>>>16&2))+(r<<s>>>15)|0)+7|0)&1|n<<1:0,n=476+(ne<<2)|0,i[l+28>>2]=ne,i[(s=l+16|0)+4>>2]=0,i[s>>2]=0,!((s=0|i[44])&(r=1<<ne))){i[44]=s|r,i[n>>2]=l,i[l+24>>2]=n,i[l+12>>2]=l,i[l+8>>2]=l;break}for(r=$<<(31==(0|ne)?0:25-(ne>>>1)|0),s=0|i[n>>2];;){if((-8&i[s+4>>2]|0)==(0|$)){re=s,F=148;break}if(!(t=0|i[(n=s+16+(r>>>31<<2)|0)>>2])){ie=n,ae=s,F=145;break}r<<=1,s=t}if(145==(0|F)){if(!(ie>>>0<(0|i[47])>>>0)){i[ie>>2]=l,i[l+24>>2]=ae,i[l+12>>2]=l,i[l+8>>2]=l;break}_()}else if(148==(0|F)){if((r=0|i[(s=re+8|0)>>2])>>>0>=(t=0|i[47])>>>0&re>>>0>=t>>>0){i[r+12>>2]=l,i[s>>2]=l,i[l+8>>2]=r,i[l+12>>2]=re,i[l+24>>2]=0;break}_()}}else r=$+a|0,i[z+4>>2]=3|r,i[(s=z+r+4|0)>>2]=1|i[s>>2]}while(0);return 0|(z+8|0)}k=a}else k=a;else k=-1}while(0);if((z=0|i[45])>>>0>=k>>>0)return $=z-k|0,re=0|i[48],$>>>0>15?(ae=re+k|0,i[48]=ae,i[45]=$,i[ae+4>>2]=1|$,i[ae+$>>2]=$,i[re+4>>2]=3|k):(i[45]=0,i[48]=0,i[re+4>>2]=3|z,i[($=re+z+4|0)>>2]=1|i[$>>2]),0|(re+8|0);if((re=0|i[46])>>>0>k>>>0)return $=re-k|0,i[46]=$,z=(re=0|i[49])+k|0,i[49]=z,i[z+4>>2]=1|$,i[re+4>>2]=3|k,0|(re+8|0);do{if(!(0|i[161])){if(!((re=0|b(30))+-1&re)){i[163]=re,i[162]=re,i[164]=-1,i[165]=-1,i[166]=0,i[154]=0,i[161]=-16&(0|m(0))^1431655768;break}_()}}while(0);if(re=k+48|0,($=(ae=($=0|i[163])+(z=k+47|0)|0)&(ie=0-$|0))>>>0<=k>>>0)return 0|0;if(0!=(0|(ne=0|i[153]))&&(ee=(te=0|i[151])+$|0)>>>0<=te>>>0|ee>>>0>ne>>>0)return 0|0;e:do{if(4&i[154])F=190;else{ne=0|i[49];t:do{if(ne){for(ee=620;;){if((te=0|i[ee>>2])>>>0<=ne>>>0&&(te+(0|i[(q=ee+4|0)>>2])|0)>>>0>ne>>>0){oe=ee,se=q;break}if(!(ee=0|i[ee+8>>2])){F=173;break t}}if((ee=ae-(0|i[46])&ie)>>>0<2147483647)if((0|(q=0|g(0|ee)))==((0|i[oe>>2])+(0|i[se>>2])|0)){if(-1!=(0|q)){le=q,ce=ee,F=193;break e}}else de=q,ue=ee,F=183}else F=173}while(0);do{if(173==(0|F)&&-1!=(0|(ne=0|g(0)))&&(a=ne,pe=(q=(ee=0|i[162])+-1|0)&a?$-a+(q+a&0-ee)|0:$,a=(ee=0|i[151])+pe|0,pe>>>0>k>>>0&pe>>>0<2147483647)){if(0!=(0|(q=0|i[153]))&&a>>>0<=ee>>>0|a>>>0>q>>>0)break;if((0|(q=0|g(0|pe)))==(0|ne)){le=ne,ce=pe,F=193;break e}de=q,ue=pe,F=183}}while(0);t:do{if(183==(0|F)){q=0-ue|0;do{if(re>>>0>ue>>>0&ue>>>0<2147483647&-1!=(0|de)&&(a=z-ue+(ne=0|i[163])&0-ne)>>>0<2147483647){if(-1==(0|g(0|a))){g(0|q);break t}fe=a+ue|0;break}fe=ue}while(0);if(-1!=(0|de)){le=de,ce=fe,F=193;break e}}}while(0);i[154]=4|i[154],F=190}}while(0);if(190==(0|F)&&$>>>0<2147483647&&(fe=0|g(0|$))>>>0<($=0|g(0))>>>0&-1!=(0|fe)&-1!=(0|$)&&(de=$-fe|0)>>>0>(k+40|0)>>>0&&(le=fe,ce=de,F=193),193==(0|F)){de=(0|i[151])+ce|0,i[151]=de,de>>>0>(0|i[152])>>>0&&(i[152]=de),de=0|i[49];do{if(de){fe=620;do{if((0|le)==(($=0|i[fe>>2])+(z=0|i[(ue=fe+4|0)>>2])|0)){he=$,_e=ue,ge=z,me=fe,F=203;break}fe=0|i[fe+8>>2]}while(0!=(0|fe));if(203==(0|F)&&0==(8&i[me+12>>2]|0)&&de>>>0<le>>>0&de>>>0>=he>>>0){i[_e>>2]=ge+ce,fe=de+(z=0==(7&(fe=de+8|0)|0)?0:0-fe&7)|0,ue=ce-z+(0|i[46])|0,i[49]=fe,i[46]=ue,i[fe+4>>2]=1|ue,i[fe+ue+4>>2]=40,i[50]=i[165];break}for(le>>>0<(ue=0|i[47])>>>0?(i[47]=le,ye=le):ye=ue,ue=le+ce|0,fe=620;;){if((0|i[fe>>2])==(0|ue)){Ee=fe,Se=fe,F=211;break}if(!(fe=0|i[fe+8>>2])){ve=620;break}}if(211==(0|F)){if(!(8&i[Se+12>>2])){i[Ee>>2]=le,i[(fe=Se+4|0)>>2]=(0|i[fe>>2])+ce,z=le+(0==(7&(fe=le+8|0)|0)?0:0-fe&7)|0,$=ue+(0==(7&(fe=ue+8|0)|0)?0:0-fe&7)|0,fe=z+k|0,re=$-z-k|0,i[z+4>>2]=3|k;do{if((0|$)!=(0|de)){if((0|$)==(0|i[48])){pe=(0|i[45])+re|0,i[45]=pe,i[48]=fe,i[fe+4>>2]=1|pe,i[fe+pe>>2]=pe;break}if(1==(3&(pe=0|i[$+4>>2])|0)){se=-8&pe,oe=pe>>>3;e:do{if(pe>>>0>=256){ie=0|i[$+24>>2],ae=0|i[$+12>>2];do{if((0|ae)==(0|$)){if(ne=0|i[(a=(q=$+16|0)+4|0)>>2])be=ne,Ce=a;else{if(!(ee=0|i[q>>2])){Te=0;break}be=ee,Ce=q}for(;;)if(ne=0|i[(a=be+20|0)>>2])be=ne,Ce=a;else{if(!(ne=0|i[(a=be+16|0)>>2])){Ae=be,Pe=Ce;break}be=ne,Ce=a}if(!(Pe>>>0<ye>>>0)){i[Pe>>2]=0,Te=Ae;break}_()}else{if((a=0|i[$+8>>2])>>>0<ye>>>0&&_(),(0|i[(ne=a+12|0)>>2])!=(0|$)&&_(),(0|i[(q=ae+8|0)>>2])==(0|$)){i[ne>>2]=ae,i[q>>2]=a,Te=ae;break}_()}}while(0);if(!ie)break;a=476+((ae=0|i[$+28>>2])<<2)|0;do{if((0|$)==(0|i[a>>2])){if(i[a>>2]=Te,Te)break;i[44]=i[44]&~(1<<ae);break e}if(ie>>>0<(0|i[47])>>>0&&_(),(0|i[(q=ie+16|0)>>2])==(0|$)?i[q>>2]=Te:i[ie+20>>2]=Te,!Te)break e}while(0);Te>>>0<(ae=0|i[47])>>>0&&_(),i[Te+24>>2]=ie,q=0|i[(a=$+16|0)>>2];do{if(q){if(!(q>>>0<ae>>>0)){i[Te+16>>2]=q,i[q+24>>2]=Te;break}_()}}while(0);if(!(q=0|i[a+4>>2]))break;if(!(q>>>0<(0|i[47])>>>0)){i[Te+20>>2]=q,i[q+24>>2]=Te;break}_()}else{q=0|i[$+8>>2],ae=0|i[$+12>>2],ie=212+(oe<<1<<2)|0;do{if((0|q)!=(0|ie)){if(q>>>0<ye>>>0&&_(),(0|i[q+12>>2])==(0|$))break;_()}}while(0);if((0|ae)==(0|q)){i[43]=i[43]&~(1<<oe);break}do{if((0|ae)==(0|ie))Me=ae+8|0;else{if(ae>>>0<ye>>>0&&_(),(0|i[(a=ae+8|0)>>2])==(0|$)){Me=a;break}_()}}while(0);i[q+12>>2]=ae,i[Me>>2]=q}}while(0);Oe=$+se|0,Ie=se+re|0}else Oe=$,Ie=re;if(i[(oe=Oe+4|0)>>2]=-2&i[oe>>2],i[fe+4>>2]=1|Ie,i[fe+Ie>>2]=Ie,oe=Ie>>>3,Ie>>>0<256){pe=212+(oe<<1<<2)|0,ie=0|i[43],a=1<<oe;do{if(ie&a){if((ne=0|i[(oe=pe+8|0)>>2])>>>0>=(0|i[47])>>>0){we=oe,Re=ne;break}_()}else i[43]=ie|a,we=pe+8|0,Re=pe}while(0);i[we>>2]=fe,i[Re+12>>2]=fe,i[fe+8>>2]=Re,i[fe+12>>2]=pe;break}a=Ie>>>8;do{if(a){if(Ie>>>0>16777215){De=31;break}De=Ie>>>((ee=14-((ne=((se=a<<(ie=(a+1048320|0)>>>16&8))+520192|0)>>>16&4)|ie|(se=((oe=se<<ne)+245760|0)>>>16&2))+(oe<<se>>>15)|0)+7|0)&1|ee<<1}else De=0}while(0);if(a=476+(De<<2)|0,i[fe+28>>2]=De,i[(pe=fe+16|0)+4>>2]=0,i[pe>>2]=0,!((pe=0|i[44])&(ee=1<<De))){i[44]=pe|ee,i[a>>2]=fe,i[fe+24>>2]=a,i[fe+12>>2]=fe,i[fe+8>>2]=fe;break}for(ee=Ie<<(31==(0|De)?0:25-(De>>>1)|0),pe=0|i[a>>2];;){if((-8&i[pe+4>>2]|0)==(0|Ie)){Le=pe,F=281;break}if(!(se=0|i[(a=pe+16+(ee>>>31<<2)|0)>>2])){Ne=a,ke=pe,F=278;break}ee<<=1,pe=se}if(278==(0|F)){if(!(Ne>>>0<(0|i[47])>>>0)){i[Ne>>2]=fe,i[fe+24>>2]=ke,i[fe+12>>2]=fe,i[fe+8>>2]=fe;break}_()}else if(281==(0|F)){if((ee=0|i[(pe=Le+8|0)>>2])>>>0>=(se=0|i[47])>>>0&Le>>>0>=se>>>0){i[ee+12>>2]=fe,i[pe>>2]=fe,i[fe+8>>2]=ee,i[fe+12>>2]=Le,i[fe+24>>2]=0;break}_()}}else ee=(0|i[46])+re|0,i[46]=ee,i[49]=fe,i[fe+4>>2]=1|ee}while(0);return 0|(z+8|0)}ve=620}for(;;){if((fe=0|i[ve>>2])>>>0<=de>>>0&&(re=fe+(0|i[ve+4>>2])|0)>>>0>de>>>0){Ue=re;break}ve=0|i[ve+8>>2]}fe=(z=(fe=(z=Ue+-47|0)+(0==(7&(re=z+8|0)|0)?0:0-re&7)|0)>>>0<(re=de+16|0)>>>0?de:fe)+8|0,$=le+(ue=0==(7&($=le+8|0)|0)?0:0-$&7)|0,ee=ce+-40-ue|0,i[49]=$,i[46]=ee,i[$+4>>2]=1|ee,i[$+ee+4>>2]=40,i[50]=i[165],i[(ee=z+4|0)>>2]=27,i[fe>>2]=i[155],i[fe+4>>2]=i[156],i[fe+8>>2]=i[157],i[fe+12>>2]=i[158],i[155]=le,i[156]=ce,i[158]=0,i[157]=fe,fe=z+24|0;do{i[(fe=fe+4|0)>>2]=7}while((fe+4|0)>>>0<Ue>>>0);if((0|z)!=(0|de)){if(fe=z-de|0,i[ee>>2]=-2&i[ee>>2],i[de+4>>2]=1|fe,i[z>>2]=fe,$=fe>>>3,fe>>>0<256){ue=212+($<<1<<2)|0,(pe=0|i[43])&(se=1<<$)?(a=0|i[($=ue+8|0)>>2])>>>0<(0|i[47])>>>0?_():(Ge=$,xe=a):(i[43]=pe|se,Ge=ue+8|0,xe=ue),i[Ge>>2]=de,i[xe+12>>2]=de,i[de+8>>2]=xe,i[de+12>>2]=ue;break}if(Be=(ue=fe>>>8)?fe>>>0>16777215?31:fe>>>(($=14-((ue=((pe=ue<<(se=(ue+1048320|0)>>>16&8))+520192|0)>>>16&4)|se|(pe=((a=pe<<ue)+245760|0)>>>16&2))+(a<<pe>>>15)|0)+7|0)&1|$<<1:0,$=476+(Be<<2)|0,i[de+28>>2]=Be,i[de+20>>2]=0,i[re>>2]=0,!((pe=0|i[44])&(a=1<<Be))){i[44]=pe|a,i[$>>2]=de,i[de+24>>2]=$,i[de+12>>2]=de,i[de+8>>2]=de;break}for(a=fe<<(31==(0|Be)?0:25-(Be>>>1)|0),pe=0|i[$>>2];;){if((-8&i[pe+4>>2]|0)==(0|fe)){Fe=pe,F=307;break}if(!(se=0|i[($=pe+16+(a>>>31<<2)|0)>>2])){je=$,Ye=pe,F=304;break}a<<=1,pe=se}if(304==(0|F)){if(!(je>>>0<(0|i[47])>>>0)){i[je>>2]=de,i[de+24>>2]=Ye,i[de+12>>2]=de,i[de+8>>2]=de;break}_()}else if(307==(0|F)){if((a=0|i[(pe=Fe+8|0)>>2])>>>0>=(fe=0|i[47])>>>0&Fe>>>0>=fe>>>0){i[a+12>>2]=de,i[pe>>2]=de,i[de+8>>2]=a,i[de+12>>2]=Fe,i[de+24>>2]=0;break}_()}}}else{0==(0|(a=0|i[47]))|le>>>0<a>>>0&&(i[47]=le),i[155]=le,i[156]=ce,i[158]=0,i[52]=i[161],i[51]=-1,a=0;do{i[(pe=212+(a<<1<<2)|0)+12>>2]=pe,i[pe+8>>2]=pe,a=a+1|0}while(32!=(0|a));a=le+(pe=0==(7&(a=le+8|0)|0)?0:0-a&7)|0,fe=ce+-40-pe|0,i[49]=a,i[46]=fe,i[a+4>>2]=1|fe,i[a+fe+4>>2]=40,i[50]=i[165]}}while(0);if((ce=0|i[46])>>>0>k>>>0)return le=ce-k|0,i[46]=le,de=(ce=0|i[49])+k|0,i[49]=de,i[de+4>>2]=1|le,i[ce+4>>2]=3|k,0|(ce+8|0)}return i[(0|O())>>2]=12,0|0},_memcpy:function(e,t,n){var a;if(e|=0,t|=0,(0|(n|=0))>=4096)return 0|y(0|e,0|t,0|n);if(a=0|e,(3&e)==(3&t)){for(;3&e;){if(!n)return 0|a;r[e>>0]=0|r[t>>0],e=e+1|0,t=t+1|0,n=n-1|0}for(;(0|n)>=4;)i[e>>2]=i[t>>2],e=e+4|0,t=t+4|0,n=n-4|0}for(;(0|n)>0;)r[e>>0]=0|r[t>>0],e=e+1|0,t=t+1|0,n=n-1|0;return 0|a},_bitshift64Lshr:x,_fflush:function e(t){t|=0;var n=0,r=0,a=0,o=0,s=0,l=0,c=0;do{if(t){if((0|i[t+76>>2])<=-1){n=0|L(t);break}r=0==(0|w()),a=0|L(t),r||R(),n=a}else{if(o=0|i[13]?0|e(0|i[13]):0,p(36),a=0|i[8])for(r=a,a=o;;){if(l=(0|i[r+76>>2])>-1?0|w():0,c=(0|i[r+20>>2])>>>0>(0|i[r+28>>2])>>>0?0|L(r)|a:a,l&&R(),!(r=0|i[r+56>>2])){s=c;break}a=c}else s=o;S(36),n=s}}while(0);return 0|n},___errno_location:O,_bitshift64Shl:B,runPostSets:function(){},stackAlloc:function(e){var t;return t=o,o=(o=o+(e|=0)|0)+15&-16,0|t},stackSave:function(){return 0|o},stackRestore:function(e){o=e|=0},establishStackSpace:function(e,t){o=e|=0,t|=0},setThrew:function(e,t){e|=0,t|=0,s||(s=e,t)},setTempRet0:function(e){l=e|=0},getTempRet0:function(){return 0|l},dynCall_ii:function(e,t){return t|=0,0|j[1&(e|=0)](0|t)},dynCall_iiii:function(e,t,n,r){return t|=0,n|=0,r|=0,0|Y[3&(e|=0)](0|t,0|n,0|r)},dynCall_vi:function(e,t){t|=0,K[1&(e|=0)](0|t)}}}(e.Na,e.Oa,buffer);e._curve25519_donna=Z._curve25519_donna;var Da=e._free=Z._free;e.runPostSets=Z.runPostSets;var cb=e._i64Add=Z._i64Add,ab=e._bitshift64Ashr=Z._bitshift64Ashr,bb=e._i64Subtract=Z._i64Subtract,db=e._memset=Z._memset,ua=e._malloc=Z._malloc,gc=e._memcpy=Z._memcpy,fb=e._bitshift64Lshr=Z._bitshift64Lshr;e._fflush=Z._fflush,e.___errno_location=Z.___errno_location;var gb=e._bitshift64Shl=Z._bitshift64Shl;function xc(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}e.dynCall_ii=Z.dynCall_ii,e.dynCall_iiii=Z.dynCall_iiii,e.dynCall_vi=Z.dynCall_vi,n.W=Z.stackAlloc,n.na=Z.stackSave,n.X=Z.stackRestore,n.md=Z.establishStackSpace,n.cb=Z.setTempRet0,n.Ua=Z.getTempRet0,xc.prototype=Error(),xc.prototype.constructor=xc;var Yc=null,Xa=function t(){e.calledRun||$c(),e.calledRun||(Xa=t)};function $c(t){function n(){if(!e.calledRun&&(e.calledRun=!0,!A)){if(xa||(xa=!0,Oa(Qa)),Oa(Ra),e.onRuntimeInitialized&&e.onRuntimeInitialized(),e._main&&bd&&e.callMain(t),e.postRun)for("function"==typeof e.postRun&&(e.postRun=[e.postRun]);e.postRun.length;)Ua(e.postRun.shift());Oa(Sa)}}if(t=t||e.arguments,null===Yc&&(Yc=Date.now()),!(0<L)){if(e.preRun)for("function"==typeof e.preRun&&(e.preRun=[e.preRun]);e.preRun.length;)Ta(e.preRun.shift());Oa(Pa),0<L||e.calledRun||(e.setStatus?(e.setStatus("Running..."),setTimeout((function(){setTimeout((function(){e.setStatus("")}),1),n()}),1)):n())}}function ad(t,n){if(!n||!e.noExitRuntime)throw!e.noExitRuntime&&(A=!0,m=void 0,Oa(K),e.onExit)&&e.onExit(t),new xc(t)}e.callMain=e.jd=function(t){function n(){for(var e=0;3>e;e++)i.push(0)}assert(0==L,"cannot call main when async dependencies remain! (listen on __ATMAIN__)"),assert(0==Pa.length,"cannot call main when preRun functions remain to be called"),t=t||[],xa||(xa=!0,Oa(Qa));var r=t.length+1,i=[G(Va(e.thisProgram),"i8",0)];n();for(var a=0;a<r-1;a+=1)i.push(G(Va(t[a]),"i8",0)),n();i.push(0),i=G(i,"i32",0);try{ad(e._main(r,i,0),!0)}catch(t){if(!(t instanceof xc)){if("SimulateInfiniteLoop"!=t)throw t&&"object"==typeof t&&t.stack&&e.S("exception thrown: "+[t,t.stack]),t;e.noExitRuntime=!0}}},e.run=e.run=$c,e.exit=e.exit=ad;var cd=[];function z(t){void 0!==t?(e.print(t),e.S(t),t=JSON.stringify(t)):t="",A=!0;var n="abort("+t+") at "+Ea()+"\nIf this abort() is unexpected, build with -s ASSERTIONS=1 which can give more information.";throw cd&&cd.forEach((function(e){n=e(n,t)})),n}if(e.abort=e.abort=z,e.preInit)for("function"==typeof e.preInit&&(e.preInit=[e.preInit]);0<e.preInit.length;)e.preInit.pop()();var bd=!0;e.noInitialRun&&(bd=!1),$c(),module.exports=e},94114:()=>{
/*! modernizr 3.11.8 (Custom Build) | MIT *
 * https://modernizr.com/download/?-adownload-cssanimations-csstransitions-exiforientation-serviceworker-webp-domprefixes-hasevent-prefixed-prefixes-setclasses-testallprops-testprop !*/
!function(e,t,n,r){function i(e,t){return typeof e===t}function a(e){var t=v.className,n=E._config.classPrefix||"";if(T&&(t=t.baseVal),E._config.enableJSClass){var r=new RegExp("(^|\\s)"+n+"no-js(\\s|$)");t=t.replace(r,"$1"+n+"js$2")}E._config.enableClasses&&(e.length>0&&(t+=" "+n+e.join(" "+n)),T?v.className.baseVal=t:v.className=t)}function o(){return"function"!=typeof n.createElement?n.createElement(arguments[0]):T?n.createElementNS.call(n,"http://www.w3.org/2000/svg",arguments[0]):n.createElement.apply(n,arguments)}function s(e,t){return!!~(""+e).indexOf(t)}function l(e,t,r,i){var a,s,l,c,d="modernizr",u=o("div"),p=function(){var e=n.body;return e||((e=o(T?"svg":"body")).fake=!0),e}();if(parseInt(r,10))for(;r--;)(l=o("div")).id=i?i[r]:d+(r+1),u.appendChild(l);return(a=o("style")).type="text/css",a.id="s"+d,(p.fake?p:u).appendChild(a),p.appendChild(u),a.styleSheet?a.styleSheet.cssText=e:a.appendChild(n.createTextNode(e)),u.id=d,p.fake&&(p.style.background="",p.style.overflow="hidden",c=v.style.overflow,v.style.overflow="hidden",v.appendChild(p)),s=t(u,e),p.fake&&p.parentNode?(p.parentNode.removeChild(p),v.style.overflow=c,v.offsetHeight):u.parentNode.removeChild(u),!!s}function c(e){return e.replace(/([A-Z])/g,(function(e,t){return"-"+t.toLowerCase()})).replace(/^ms-/,"-ms-")}function d(e,n){var i=e.length;if("CSS"in t&&"supports"in t.CSS){for(;i--;)if(t.CSS.supports(c(e[i]),n))return!0;return!1}if("CSSSupportsRule"in t){for(var a=[];i--;)a.push("("+c(e[i])+":"+n+")");return l("@supports ("+(a=a.join(" or "))+") { #modernizr { position: absolute; } }",(function(e){return"absolute"===function(e,n,r){var i;if("getComputedStyle"in t){i=getComputedStyle.call(t,e,n);var a=t.console;null!==i?r&&(i=i.getPropertyValue(r)):a&&a[a.error?"error":"log"].call(a,"getComputedStyle returning null, its possible modernizr test results are inaccurate")}else i=!n&&e.currentStyle&&e.currentStyle[r];return i}(e,null,"position")}))}return r}function u(e){return e.replace(/([a-z])-([a-z])/g,(function(e,t,n){return t+n.toUpperCase()})).replace(/^-/,"")}function p(e,t,n,a){function l(){p&&(delete I.style,delete I.modElem)}if(a=!i(a,"undefined")&&a,!i(n,"undefined")){var c=d(e,n);if(!i(c,"undefined"))return c}for(var p,f,h,_,g,m=["modernizr","tspan","samp"];!I.style&&m.length;)p=!0,I.modElem=o(m.shift()),I.style=I.modElem.style;for(h=e.length,f=0;f<h;f++)if(_=e[f],g=I.style[_],s(_,"-")&&(_=u(_)),I.style[_]!==r){if(a||i(n,"undefined"))return l(),"pfx"!==t||_;try{I.style[_]=n}catch(e){}if(I.style[_]!==g)return l(),"pfx"!==t||_}return l(),!1}function f(e,t){return function(){return e.apply(t,arguments)}}function h(e,t,n,r,a){var o=e.charAt(0).toUpperCase()+e.slice(1),s=(e+" "+M.join(o+" ")+o).split(" ");return i(t,"string")||i(t,"undefined")?p(s,t,r,a):function(e,t,n){var r;for(var a in e)if(e[a]in t)return!1===n?e[a]:i(r=t[e[a]],"function")?f(r,n||t):r;return!1}(s=(e+" "+C.join(o+" ")+o).split(" "),t,n)}function _(e,t,n){return h(e,r,r,t,n)}function g(e,t){if("object"==typeof e)for(var n in e)w(e,n)&&g(n,e[n]);else{var r=(e=e.toLowerCase()).split("."),i=E[r[0]];if(2===r.length&&(i=i[r[1]]),void 0!==i)return E;t="function"==typeof t?t():t,1===r.length?E[r[0]]=t:(!E[r[0]]||E[r[0]]instanceof Boolean||(E[r[0]]=new Boolean(E[r[0]])),E[r[0]][r[1]]=t),a([(t&&!1!==t?"":"no-")+r.join("-")]),E._trigger(e,t)}return E}var m=[],y={_version:"3.11.8",_config:{classPrefix:"",enableClasses:!0,enableJSClass:!0,usePrefixes:!0},_q:[],on:function(e,t){var n=this;setTimeout((function(){t(n[e])}),0)},addTest:function(e,t,n){m.push({name:e,fn:t,options:n})},addAsyncTest:function(e){m.push({name:null,fn:e})}},E=function(){};E.prototype=y,E=new E;var S=[],v=n.documentElement,T="svg"===v.nodeName.toLowerCase(),b="Moz O ms Webkit",C=y._config.usePrefixes?b.toLowerCase().split(" "):[];y._domPrefixes=C;var A=y._config.usePrefixes?" -webkit- -moz- -o- -ms- ".split(" "):["",""];y._prefixes=A;var P=function(){var e=!("onblur"in v);return function(t,n){var i;return!!t&&(n&&"string"!=typeof n||(n=o(n||"div")),!(i=(t="on"+t)in n)&&e&&(n.setAttribute||(n=o("div")),n.setAttribute(t,""),i="function"==typeof n[t],n[t]!==r&&(n[t]=r),n.removeAttribute(t)),i)}}();y.hasEvent=P;var M=y._config.usePrefixes?b.split(" "):[];y._cssomPrefixes=M;var O={elem:o("modernizr")};E._q.push((function(){delete O.elem}));var I={style:O.elem.style};E._q.unshift((function(){delete I.style})),y.testAllProps=h;var w,R=function(e){var n,i=A.length,a=t.CSSRule;if(void 0===a)return r;if(!e)return!1;if((n=(e=e.replace(/^@/,"")).replace(/-/g,"_").toUpperCase()+"_RULE")in a)return"@"+e;for(var o=0;o<i;o++){var s=A[o];if(s.toUpperCase()+"_"+n in a)return"@-"+s.toLowerCase()+"-"+e}return!1};y.atRule=R,y.prefixed=function(e,t,n){return 0===e.indexOf("@")?R(e):(-1!==e.indexOf("-")&&(e=u(e)),t?h(e,t,n):h(e,"pfx"))},y.testAllProps=_,y.testProp=function(e,t,n){return p([e],r,t,n)},function(){var e={}.hasOwnProperty;w=i(e,"undefined")||i(e.call,"undefined")?function(e,t){return t in e&&i(e.constructor.prototype[t],"undefined")}:function(t,n){return e.call(t,n)}}(),y._l={},y.on=function(e,t){this._l[e]||(this._l[e]=[]),this._l[e].push(t),E.hasOwnProperty(e)&&setTimeout((function(){E._trigger(e,E[e])}),0)},y._trigger=function(e,t){if(this._l[e]){var n=this._l[e];setTimeout((function(){var e;for(e=0;e<n.length;e++)(0,n[e])(t)}),0),delete this._l[e]}},E._q.push((function(){y.addTest=g})),E.addAsyncTest((function(){function e(e,t,n){function r(t){var r=!(!t||"load"!==t.type)&&1===i.width;g(e,"webp"===e&&r?new Boolean(r):r),n&&n(t)}var i=new Image;i.onerror=r,i.onload=r,i.src=t}var t=[{uri:"data:image/webp;base64,UklGRiQAAABXRUJQVlA4IBgAAAAwAQCdASoBAAEAAwA0JaQAA3AA/vuUAAA=",name:"webp"},{uri:"data:image/webp;base64,UklGRkoAAABXRUJQVlA4WAoAAAAQAAAAAAAAAAAAQUxQSAwAAAABBxAR/Q9ERP8DAABWUDggGAAAADABAJ0BKgEAAQADADQlpAADcAD++/1QAA==",name:"webp.alpha"},{uri:"data:image/webp;base64,UklGRlIAAABXRUJQVlA4WAoAAAASAAAAAAAAAAAAQU5JTQYAAAD/////AABBTk1GJgAAAAAAAAAAAAAAAAAAAGQAAABWUDhMDQAAAC8AAAAQBxAREYiI/gcA",name:"webp.animation"},{uri:"data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA=",name:"webp.lossless"}],n=t.shift();e(n.name,n.uri,(function(n){if(n&&"load"===n.type)for(var r=0;r<t.length;r++)e(t[r].name,t[r].uri)}))})),E.addTest("serviceworker","serviceWorker"in navigator),E.addAsyncTest((function(){var e=new Image;e.onerror=function(){g("exiforientation",!1)},e.onload=function(){g("exiforientation",2!==e.width)},e.src="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QAiRXhpZgAASUkqAAgAAAABABIBAwABAAAABgASAAAAAAD/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wAARCAABAAIDASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwD+/iiiigD/2Q=="})),E.addTest("adownload",!t.externalHost&&"download"in o("a")),E.addTest("cssanimations",_("animationName","a",!0)),E.addTest("csstransitions",_("transition","all",!0)),function(){var e,t,n,r,a,o;for(var s in m)if(m.hasOwnProperty(s)){if(e=[],(t=m[s]).name&&(e.push(t.name.toLowerCase()),t.options&&t.options.aliases&&t.options.aliases.length))for(n=0;n<t.options.aliases.length;n++)e.push(t.options.aliases[n].toLowerCase());for(r=i(t.fn,"function")?t.fn():t.fn,a=0;a<e.length;a++)1===(o=e[a].split(".")).length?E[o[0]]=r:(E[o[0]]&&(!E[o[0]]||E[o[0]]instanceof Boolean)||(E[o[0]]=new Boolean(E[o[0]])),E[o[0]][o[1]]=r),S.push((r?"":"no-")+o.join("-"))}}(),a(S),delete y.addTest,delete y.addAsyncTest;for(var D=0;D<E._q.length;D++)E._q[D]();e.Modernizr=E}(window,window,document)},37360:e=>{var t;!function(){function e(e){if(this.mode=r.MODE_8BIT_BYTE,this.data=e,this.parsedData=[],e instanceof ArrayBuffer)this.parsedData=new Int8Array(e);else{for(var t=0,n=this.data.length;t<n;t++){var i=[],a=this.data.charCodeAt(t);a>65536?(i[0]=240|(1835008&a)>>>18,i[1]=128|(258048&a)>>>12,i[2]=128|(4032&a)>>>6,i[3]=128|63&a):a>2048?(i[0]=224|(61440&a)>>>12,i[1]=128|(4032&a)>>>6,i[2]=128|63&a):a>128?(i[0]=192|(1984&a)>>>6,i[1]=128|63&a):i[0]=a,this.parsedData.push(i)}this.parsedData=Array.prototype.concat.apply([],this.parsedData),this.parsedData.length!=this.data.length&&(this.parsedData.unshift(191),this.parsedData.unshift(187),this.parsedData.unshift(239))}}function n(e,t){this.typeNumber=e,this.errorCorrectLevel=t,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}e.prototype={getLength:function(e){return this.parsedData.length},write:function(e){for(var t=0,n=this.parsedData.length;t<n;t++)e.put(this.parsedData[t],8)}},n.prototype={addData:function(t){var n=new e(t);this.dataList.push(n),this.dataCache=null},isDark:function(e,t){if(e<0||this.moduleCount<=e||t<0||this.moduleCount<=t)throw new Error(e+","+t);return this.modules[e][t]},getModuleCount:function(){return this.moduleCount},make:function(){this.makeImpl(!1,this.getBestMaskPattern())},makeImpl:function(e,t){this.moduleCount=4*this.typeNumber+17,this.modules=new Array(this.moduleCount);for(var r=0;r<this.moduleCount;r++){this.modules[r]=new Array(this.moduleCount);for(var i=0;i<this.moduleCount;i++)this.modules[r][i]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(e,t),this.typeNumber>=7&&this.setupTypeNumber(e),null==this.dataCache&&(this.dataCache=n.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,t)},setupPositionProbePattern:function(e,t){for(var n=-1;n<=7;n++)if(!(e+n<=-1||this.moduleCount<=e+n))for(var r=-1;r<=7;r++)t+r<=-1||this.moduleCount<=t+r||(this.modules[e+n][t+r]=0<=n&&n<=6&&(0==r||6==r)||0<=r&&r<=6&&(0==n||6==n)||2<=n&&n<=4&&2<=r&&r<=4)},getBestMaskPattern:function(){for(var e=0,t=0,n=0;n<8;n++){this.makeImpl(!0,n);var r=f.getLostPoint(this);(0==n||e>r)&&(e=r,t=n)}return t},createMovieClip:function(e,t,n){var r=e.createEmptyMovieClip(t,n);this.make();for(var i=0;i<this.modules.length;i++)for(var a=1*i,o=0;o<this.modules[i].length;o++){var s=1*o;this.modules[i][o]&&(r.beginFill(0,100),r.moveTo(s,a),r.lineTo(s+1,a),r.lineTo(s+1,a+1),r.lineTo(s,a+1),r.endFill())}return r},setupTimingPattern:function(){for(var e=8;e<this.moduleCount-8;e++)null==this.modules[e][6]&&(this.modules[e][6]=e%2==0);for(var t=8;t<this.moduleCount-8;t++)null==this.modules[6][t]&&(this.modules[6][t]=t%2==0)},setupPositionAdjustPattern:function(){for(var e=f.getPatternPosition(this.typeNumber),t=0;t<e.length;t++)for(var n=0;n<e.length;n++){var r=e[t],i=e[n];if(null==this.modules[r][i])for(var a=-2;a<=2;a++)for(var o=-2;o<=2;o++)this.modules[r+a][i+o]=-2==a||2==a||-2==o||2==o||0==a&&0==o}},setupTypeNumber:function(e){for(var t=f.getBCHTypeNumber(this.typeNumber),n=0;n<18;n++){var r=!e&&1==(t>>n&1);this.modules[Math.floor(n/3)][n%3+this.moduleCount-8-3]=r}for(n=0;n<18;n++){r=!e&&1==(t>>n&1);this.modules[n%3+this.moduleCount-8-3][Math.floor(n/3)]=r}},setupTypeInfo:function(e,t){for(var n=this.errorCorrectLevel<<3|t,r=f.getBCHTypeInfo(n),i=0;i<15;i++){var a=!e&&1==(r>>i&1);i<6?this.modules[i][8]=a:i<8?this.modules[i+1][8]=a:this.modules[this.moduleCount-15+i][8]=a}for(i=0;i<15;i++){a=!e&&1==(r>>i&1);i<8?this.modules[8][this.moduleCount-i-1]=a:i<9?this.modules[8][15-i-1+1]=a:this.modules[8][15-i-1]=a}this.modules[this.moduleCount-8][8]=!e},mapData:function(e,t){for(var n=-1,r=this.moduleCount-1,i=7,a=0,o=this.moduleCount-1;o>0;o-=2)for(6==o&&o--;;){for(var s=0;s<2;s++)if(null==this.modules[r][o-s]){var l=!1;a<e.length&&(l=1==(e[a]>>>i&1)),f.getMask(t,r,o-s)&&(l=!l),this.modules[r][o-s]=l,-1==--i&&(a++,i=7)}if((r+=n)<0||this.moduleCount<=r){r-=n,n=-n;break}}}},n.PAD0=236,n.PAD1=17,n.createData=function(e,t,r){for(var i=m.getRSBlocks(e,t),a=new y,o=0;o<r.length;o++){var s=r[o];a.put(s.mode,4),a.put(s.getLength(),f.getLengthInBits(s.mode,e)),s.write(a)}var l=0;for(o=0;o<i.length;o++)l+=i[o].dataCount;if(a.getLengthInBits()>8*l)throw new Error("code length overflow. ("+a.getLengthInBits()+">"+8*l+")");for(a.getLengthInBits()+4<=8*l&&a.put(0,4);a.getLengthInBits()%8!=0;)a.putBit(!1);for(;!(a.getLengthInBits()>=8*l||(a.put(n.PAD0,8),a.getLengthInBits()>=8*l));)a.put(n.PAD1,8);return n.createBytes(a,i)},n.createBytes=function(e,t){for(var n=0,r=0,i=0,a=new Array(t.length),o=new Array(t.length),s=0;s<t.length;s++){var l=t[s].dataCount,c=t[s].totalCount-l;r=Math.max(r,l),i=Math.max(i,c),a[s]=new Array(l);for(var d=0;d<a[s].length;d++)a[s][d]=255&e.buffer[d+n];n+=l;var u=f.getErrorCorrectPolynomial(c),p=new g(a[s],u.getLength()-1).mod(u);o[s]=new Array(u.getLength()-1);for(d=0;d<o[s].length;d++){var h=d+p.getLength()-o[s].length;o[s][d]=h>=0?p.get(h):0}}var _=0;for(d=0;d<t.length;d++)_+=t[d].totalCount;var m=new Array(_),y=0;for(d=0;d<r;d++)for(s=0;s<t.length;s++)d<a[s].length&&(m[y++]=a[s][d]);for(d=0;d<i;d++)for(s=0;s<t.length;s++)d<o[s].length&&(m[y++]=o[s][d]);return m};for(var r={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},i={L:1,M:0,Q:3,H:2},a=0,o=1,s=2,l=3,c=4,d=5,u=6,p=7,f={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(e){for(var t=e<<10;f.getBCHDigit(t)-f.getBCHDigit(f.G15)>=0;)t^=f.G15<<f.getBCHDigit(t)-f.getBCHDigit(f.G15);return(e<<10|t)^f.G15_MASK},getBCHTypeNumber:function(e){for(var t=e<<12;f.getBCHDigit(t)-f.getBCHDigit(f.G18)>=0;)t^=f.G18<<f.getBCHDigit(t)-f.getBCHDigit(f.G18);return e<<12|t},getBCHDigit:function(e){for(var t=0;0!=e;)t++,e>>>=1;return t},getPatternPosition:function(e){return f.PATTERN_POSITION_TABLE[e-1]},getMask:function(e,t,n){switch(e){case a:return(t+n)%2==0;case o:return t%2==0;case s:return n%3==0;case l:return(t+n)%3==0;case c:return(Math.floor(t/2)+Math.floor(n/3))%2==0;case d:return t*n%2+t*n%3==0;case u:return(t*n%2+t*n%3)%2==0;case p:return(t*n%3+(t+n)%2)%2==0;default:throw new Error("bad maskPattern:"+e)}},getErrorCorrectPolynomial:function(e){for(var t=new g([1],0),n=0;n<e;n++)t=t.multiply(new g([1,h.gexp(n)],0));return t},getLengthInBits:function(e,t){if(1<=t&&t<10)switch(e){case r.MODE_NUMBER:return 10;case r.MODE_ALPHA_NUM:return 9;case r.MODE_8BIT_BYTE:case r.MODE_KANJI:return 8;default:throw new Error("mode:"+e)}else if(t<27)switch(e){case r.MODE_NUMBER:return 12;case r.MODE_ALPHA_NUM:return 11;case r.MODE_8BIT_BYTE:return 16;case r.MODE_KANJI:return 10;default:throw new Error("mode:"+e)}else{if(!(t<41))throw new Error("type:"+t);switch(e){case r.MODE_NUMBER:return 14;case r.MODE_ALPHA_NUM:return 13;case r.MODE_8BIT_BYTE:return 16;case r.MODE_KANJI:return 12;default:throw new Error("mode:"+e)}}},getLostPoint:function(e){for(var t=e.getModuleCount(),n=0,r=0;r<t;r++)for(var i=0;i<t;i++){for(var a=0,o=e.isDark(r,i),s=-1;s<=1;s++)if(!(r+s<0||t<=r+s))for(var l=-1;l<=1;l++)i+l<0||t<=i+l||0==s&&0==l||o==e.isDark(r+s,i+l)&&a++;a>5&&(n+=3+a-5)}for(r=0;r<t-1;r++)for(i=0;i<t-1;i++){var c=0;e.isDark(r,i)&&c++,e.isDark(r+1,i)&&c++,e.isDark(r,i+1)&&c++,e.isDark(r+1,i+1)&&c++,0!=c&&4!=c||(n+=3)}for(r=0;r<t;r++)for(i=0;i<t-6;i++)e.isDark(r,i)&&!e.isDark(r,i+1)&&e.isDark(r,i+2)&&e.isDark(r,i+3)&&e.isDark(r,i+4)&&!e.isDark(r,i+5)&&e.isDark(r,i+6)&&(n+=40);for(i=0;i<t;i++)for(r=0;r<t-6;r++)e.isDark(r,i)&&!e.isDark(r+1,i)&&e.isDark(r+2,i)&&e.isDark(r+3,i)&&e.isDark(r+4,i)&&!e.isDark(r+5,i)&&e.isDark(r+6,i)&&(n+=40);var d=0;for(i=0;i<t;i++)for(r=0;r<t;r++)e.isDark(r,i)&&d++;return n+=10*(Math.abs(100*d/t/t-50)/5)}},h={glog:function(e){if(e<1)throw new Error("glog("+e+")");return h.LOG_TABLE[e]},gexp:function(e){for(;e<0;)e+=255;for(;e>=256;)e-=255;return h.EXP_TABLE[e]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)},_=0;_<8;_++)h.EXP_TABLE[_]=1<<_;for(_=8;_<256;_++)h.EXP_TABLE[_]=h.EXP_TABLE[_-4]^h.EXP_TABLE[_-5]^h.EXP_TABLE[_-6]^h.EXP_TABLE[_-8];for(_=0;_<255;_++)h.LOG_TABLE[h.EXP_TABLE[_]]=_;function g(e,t){if(null==e.length)throw new Error(e.length+"/"+t);for(var n=0;n<e.length&&0==e[n];)n++;this.num=new Array(e.length-n+t);for(var r=0;r<e.length-n;r++)this.num[r]=e[r+n]}function m(e,t){this.totalCount=e,this.dataCount=t}function y(){this.buffer=[],this.length=0}g.prototype={get:function(e){return this.num[e]},getLength:function(){return this.num.length},multiply:function(e){for(var t=new Array(this.getLength()+e.getLength()-1),n=0;n<this.getLength();n++)for(var r=0;r<e.getLength();r++)t[n+r]^=h.gexp(h.glog(this.get(n))+h.glog(e.get(r)));return new g(t,0)},mod:function(e){if(this.getLength()-e.getLength()<0)return this;for(var t=h.glog(this.get(0))-h.glog(e.get(0)),n=new Array(this.getLength()),r=0;r<this.getLength();r++)n[r]=this.get(r);for(r=0;r<e.getLength();r++)n[r]^=h.gexp(h.glog(e.get(r))+t);return new g(n,0).mod(e)}},m.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],m.getRSBlocks=function(e,t){var n=m.getRsBlockTable(e,t);if(null==n)throw new Error("bad rs block @ typeNumber:"+e+"/errorCorrectLevel:"+t);for(var r=n.length/3,i=[],a=0;a<r;a++)for(var o=n[3*a+0],s=n[3*a+1],l=n[3*a+2],c=0;c<o;c++)i.push(new m(s,l));return i},m.getRsBlockTable=function(e,t){switch(t){case i.L:return m.RS_BLOCK_TABLE[4*(e-1)+0];case i.M:return m.RS_BLOCK_TABLE[4*(e-1)+1];case i.Q:return m.RS_BLOCK_TABLE[4*(e-1)+2];case i.H:return m.RS_BLOCK_TABLE[4*(e-1)+3];default:return}},y.prototype={get:function(e){var t=Math.floor(e/8);return 1==(this.buffer[t]>>>7-e%8&1)},put:function(e,t){for(var n=0;n<t;n++)this.putBit(1==(e>>>t-n-1&1))},getLengthInBits:function(){return this.length},putBit:function(e){var t=Math.floor(this.length/8);this.buffer.length<=t&&this.buffer.push(0),e&&(this.buffer[t]|=128>>>this.length%8),this.length++}};var E=[[17,14,11,7],[32,26,20,14],[53,42,32,24],[78,62,46,34],[106,84,60,44],[134,106,74,58],[154,122,86,64],[192,152,108,84],[230,180,130,98],[271,213,151,119],[321,251,177,137],[367,287,203,155],[425,331,241,177],[458,362,258,194],[520,412,292,220],[586,450,322,250],[644,504,364,280],[718,560,394,310],[792,624,442,338],[858,666,482,382],[929,711,509,403],[1003,779,565,439],[1091,857,611,461],[1171,911,661,511],[1273,997,715,535],[1367,1059,751,593],[1465,1125,805,625],[1528,1190,868,658],[1628,1264,908,698],[1732,1370,982,742],[1840,1452,1030,790],[1952,1538,1112,842],[2068,1628,1168,898],[2188,1722,1228,958],[2303,1809,1283,983],[2431,1911,1351,1051],[2563,1989,1423,1093],[2699,2099,1499,1139],[2809,2213,1579,1219],[2953,2331,1663,1273]],S=function(e,t){this._bIsPainted=!1,this._htOption=t,this._elCanvas=document.createElement("canvas"),this._elCanvas.width=t.width,this._elCanvas.height=t.height,this._elCanvas.setAttribute("aria-label","Scan me!"),this._elCanvas.setAttribute("role","img"),e.appendChild(this._elCanvas),this._el=e,this._oContext=this._elCanvas.getContext("2d"),this._bIsPainted=!1,this._bSupportDataURI=null};function v(e,t){for(var n=1,r=e instanceof ArrayBuffer?e.byteLength:function(e){var t=encodeURI(e).toString().replace(/\%[0-9a-fA-F]{2}/g,"a");return t.length+(t.length!=e.length?3:0)}(e),a=0,o=E.length;a<=o;a++){var s=0;switch(t){case i.L:s=E[a][0];break;case i.M:s=E[a][1];break;case i.Q:s=E[a][2];break;case i.H:s=E[a][3]}if(r<=s)break;n++}if(n>E.length)throw new Error("Too long data");return n}S.prototype.draw=function(e){var t=this._oContext,n=this._htOption,r=e.getModuleCount(),i=n.width/r,a=n.height/r,o=Math.round(i),s=Math.round(a);this.clear();for(var l=0;l<r;l++)for(var c=0;c<r;c++){var d=e.isDark(l,c),u=c*i,p=l*a;t.strokeStyle=d?n.colorDark:n.colorLight,t.lineWidth=1,t.fillStyle=d?n.colorDark:n.colorLight,t.fillRect(u,p,i,a),t.strokeRect(Math.floor(u)+.5,Math.floor(p)+.5,o,s),t.strokeRect(Math.ceil(u)-.5,Math.ceil(p)-.5,o,s)}this._bIsPainted=!0},S.prototype.isPainted=function(){return this._bIsPainted},S.prototype.clear=function(){this._oContext.clearRect(0,0,this._elCanvas.width,this._elCanvas.height),this._bIsPainted=!1},S.prototype.round=function(e){return e?Math.floor(1e3*e)/1e3:e},(t=function(e,t){if(this._htOption={width:256,height:256,typeNumber:4,colorDark:"#000000",colorLight:"#ffffff",correctLevel:i.H},"string"==typeof t&&(t={text:t}),t)for(var n in t)this._htOption[n]=t[n];"string"==typeof e&&(e=document.getElementById(e)),this._el=e,this._oQRCode=null,this._oDrawing=new S(this._el,this._htOption),this._htOption.text&&this.makeCode(this._htOption.text)}).prototype.makeCode=function(e){this._oQRCode=new n(v(e,this._htOption.correctLevel),this._htOption.correctLevel),this._oQRCode.addData(e),this._oQRCode.make(),this._el.title=e,this._oDrawing.draw(this._oQRCode)},t.prototype.clear=function(){this._oDrawing.clear()},t.CorrectLevel=i}(),e.exports=t},6906:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.styleSheet=t.StyleXSheet=void 0;var r,i=(r=n(41143))&&r.__esModule?r:{default:r};function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const o="__fb-light-mode",s="__fb-dark-mode";function l(e,t){const n=[];n.push("".concat(e," {"));for(const e in t){const r=t[e];n.push("  --".concat(e,": ").concat(r,";"))}return n.push("}"),n.join("\n")}const c=/var\(--(.*?)\)/g;class d{constructor(e){var t;a(this,"rootTheme",void 0),a(this,"rootDarkTheme",void 0),a(this,"supportsVariables",void 0),a(this,"rules",void 0),a(this,"injected",void 0),a(this,"tag",void 0),a(this,"ruleForPriority",void 0),this.tag=null,this.injected=!1,this.ruleForPriority=new Map,this.rules=[],this.rootTheme=e.rootTheme,this.rootDarkTheme=e.rootDarkTheme,this.supportsVariables=null!==(t=e.supportsVariables)&&void 0!==t?t:null!=n.g.CSS&&null!=n.g.CSS.supports&&n.g.CSS.supports("--fake-var:0")}getVariableMatch(){return c}isHeadless(){var e,t;return null==this.tag||null==(null===(e=n.g)||void 0===e||null===(t=e.document)||void 0===t?void 0:t.body)}getTag(){const{tag:e}=this;return(0,i.default)(null!=e,"expected tag"),e}getCSS(){return this.rules.join("\n")}getRulePosition(e){return this.rules.indexOf(e)}getRuleCount(){return this.rules.length}inject(){var e;this.injected||(this.injected=!0,null!=(null===(e=n.g.document)||void 0===e?void 0:e.body)?(this.tag=function(){const e=document.createElement("style");return e.setAttribute("type","text/css"),e.setAttribute("data-styled","true"),(document.head||document.getElementsByTagName("head")[0]).appendChild(e),e}(),this.injectTheme()):this.injectTheme())}injectTheme(){null!=this.rootTheme&&this.insert(l(":root, .".concat(o),this.rootTheme),0),null!=this.rootDarkTheme&&this.insert(l(".".concat(s,":root, .").concat(s),this.rootDarkTheme),0)}__injectCustomThemeForTesting(e,t){null!=t&&this.insert(l(e,t),0)}delete(e){const t=this.rules.indexOf(e);if((0,i.default)(t>=0,"Couldn't find the index for rule %s",e),this.rules.splice(t,1),this.isHeadless())return;const n=this.getTag().sheet;(0,i.default)(n,"expected sheet"),n.deleteRule(t)}normalizeRule(e){const{rootTheme:t}=this;return this.supportsVariables||null==t?e:e.replace(c,((e,n)=>t[n]))}getInsertPositionForPriority(e){const t=this.ruleForPriority.get(e);if(null!=t)return this.rules.indexOf(t)+1;const n=Array.from(this.ruleForPriority.keys()).sort(((e,t)=>t-e)).filter((t=>t>e?1:0));if(0===n.length)return this.getRuleCount();const r=n.pop();return this.rules.indexOf(this.ruleForPriority.get(r))}insert(e,t,n){if(!1===this.injected&&this.inject(),null!=n)return this.insert(u(e,"html:not([dir='rtl'])"),t),void this.insert(u(n,"html[dir='rtl']"),t);const r=e;if(this.rules.includes(r))return;const i=this.normalizeRule(r),a=this.getInsertPositionForPriority(t);if(this.rules.splice(a,0,i),this.ruleForPriority.set(t,i),this.isHeadless())return;const o=this.getTag().sheet;if(null!=o)try{o.insertRule(i,a)}catch(e){}}}function u(e,t){if(!e.startsWith("@"))return"".concat(t," ").concat(e);const n=e.indexOf("{"),r=e.slice(0,n+1),i=e.slice(n+1);return"".concat(r).concat(t," ").concat(i)}t.StyleXSheet=d,a(d,"LIGHT_MODE_CLASS_NAME",o),a(d,"DARK_MODE_CLASS_NAME",s);const p=new d({supportsVariables:!0,rootTheme:{},rootDarkTheme:{}});t.styleSheet=p},56720:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(6906);function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e){for(var t=e.reverse(),n={};t.length;){var r=t.pop();if(Array.isArray(r))for(var i=r.length-1;i>=0;i--)t.push(r[i]);else{var a=r;if(null!=a&&"object"==typeof a)for(var o in a){var s=a[o];if("string"==typeof s)n[o]=s;else if("object"==typeof s){var l;n[o]=null!==(l=n[o])&&void 0!==l?l:{},Object.assign(n[o],s)}}}}return n}function l(...e){var t=s(e),n="";for(var r in t)if(Boolean(t[r]))if("string"==typeof t[r])n+=n?" "+t[r]:t[r];else if("object"==typeof t[r]){var i=t[r];for(var a in i){var o=i[a];n+=n?" "+o:o}}return n}l.compose=function(...e){return s(e)},l.create=function(e){throw new Error("stylex.create should never be called. It should be compiled away.")},l.keyframes=e=>{throw new Error("stylex.keyframes should never be called")},l.inject=(e,t,n=null)=>{r.styleSheet.insert(e,t,n)},l.dedupe=(...e)=>l(...e),l.absoluteFill={bottom:0,boxSizing:"border-box",end:0,position:"absolute",start:0,top:0},l.absoluteCenter={boxSizing:"border-box",left:"50%",position:"absolute",top:"50%",transform:"translate(-50%, -50%)"},l.blockBase={borderStyle:"solid",borderWidth:0,boxSizing:"border-box",display:"block",flexGrow:1,flexShrink:1,margin:0,padding:0,position:"relative",zIndex:0},l.inlineBase=a(a({},l.blockBase),{},{display:"inline"}),l.buttonBase={appearance:"none",backgroundColor:"transparent",borderStyle:"solid",borderWidth:0,boxSizing:"border-box",margin:0,padding:0,position:"relative",textAlign:"inherit",zIndex:0},l.flexBase={alignItems:"stretch",borderStyle:"solid",borderWidth:0,boxSizing:"border-box",display:"flex",flexDirection:"column",flexGrow:1,flexShrink:1,justifyContent:"space-between",margin:0,minHeight:0,minWidth:0,padding:0,position:"relative",zIndex:0},l.flexInlineBase=a(a({},l.flexBase),{},{display:"inline-flex"}),l.linkBase={backgroundColor:"transparent",backgroundImage:"none",boxSizing:"border-box",color:"inherit",cursor:"pointer",position:"relative",textDecoration:"none",zIndex:0},l.listBase={boxSizing:"border-box",listStyle:"none",marginBottom:0,marginTop:0,paddingStart:0},l.visuallyHidden={clip:"rect(0, 0, 0, 0)",clipPath:"inset(50%)",height:1,overflow:"hidden",position:"absolute",width:1};var c=l;t.default=c},29127:(e,t,n)=>{var r={"./af.json":[88789,8288],"./ar.json":[58854,8801],"./az.json":[48758,1967],"./bg.json":[60624,1234],"./bn.json":[93511,677],"./ca.json":[98922,4451],"./cs.json":[40097,3539],"./da.json":[36117,9626],"./de.json":[3313,88],"./el.json":[24689,3004],"./en.json":[90084,7494],"./es.json":[96598,4739],"./et.json":[57633,9599],"./fa.json":[41076,4853],"./fi.json":[51701,9789],"./fil.json":[46387,3565],"./fr.json":[12785,7334],"./gu.json":[50387,1244],"./he.json":[62603,2422],"./hi.json":[27605,8606],"./hr.json":[54047,3853],"./hu.json":[92922,1389],"./id.json":[75608,4132],"./it.json":[54800,5881],"./ja.json":[66189,5608],"./kk.json":[47681,4260],"./kn.json":[78930,6700],"./ko.json":[28076,7020],"./lt.json":[37885,4169],"./lv.json":[22798,7938],"./mk.json":[79265,1592],"./ml.json":[7208,4794],"./mr.json":[30163,2771],"./ms.json":[13390,9911],"./nb.json":[49057,4046],"./nl.json":[23129,7055],"./pa.json":[66384,6032],"./pl.json":[75495,9566],"./pt.json":[8897,1992],"./ro.json":[64267,8945],"./ru.json":[34813,887],"./sk.json":[75785,7163],"./sl.json":[65608,7626],"./sq.json":[55915,6098],"./sr.json":[95742,2967],"./sv.json":[81244,4768],"./sw.json":[78923,6606],"./ta.json":[17574,3721],"./te.json":[96564,4771],"./th.json":[38728,5955],"./tr.json":[38704,8962],"./uk.json":[95304,5282],"./ur.json":[27814,2619],"./uz.json":[18192,7654],"./vi.json":[22521,5315],"./zh-CN.json":[59978,4680],"./zh-HK.json":[17133,7920],"./zh-TW.json":[37439,3421]};function i(e){if(!n.o(r,e))return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=r[e],i=t[0];return n.e(t[1]).then((()=>n.t(i,3)))}i.keys=()=>Object.keys(r),i.id=29127,e.exports=i},26299:(e,t,n)=>{var r={"./af":[50164,6365],"./af.js":[50164,6365],"./ar":[89511,8054],"./ar-XB":[12326,9995],"./ar-XB.js":[12326,9995],"./ar.js":[89511,8054],"./az":[4345,7072],"./az.js":[4345,7072],"./bg":[74774,7102],"./bg.js":[74774,7102],"./bn":[74342,8700],"./bn.js":[74342,8700],"./ca":[654,5632],"./ca.js":[654,5632],"./cs":[64654,165],"./cs.js":[64654,165],"./da":[3435,1628],"./da.js":[3435,1628],"./de":[55170,7216],"./de.js":[55170,7216],"./el":[31977,1204],"./el.js":[31977,1204],"./en":[77407,6933],"./en.js":[77407,6933],"./es":[82834,673],"./es.js":[82834,673],"./et":[65644,792],"./et.js":[65644,792],"./fa":[32949,9999],"./fa.js":[32949,9999],"./fi":[70971,9613],"./fi.js":[70971,9613],"./fil":[94399,907],"./fil.js":[94399,907],"./fr":[61945,6293],"./fr.js":[61945,6293],"./gu":[96432,6038],"./gu.js":[96432,6038],"./he":[44756,5729],"./he.js":[44756,5729],"./hi":[27135,3722],"./hi.js":[27135,3722],"./hr":[66762,5708],"./hr.js":[66762,5708],"./hu":[10728,2556],"./hu.js":[10728,2556],"./id":[18626,5128],"./id.js":[18626,5128],"./it":[47959,2830],"./it.js":[47959,2830],"./ja":[34101,5182],"./ja.js":[34101,5182],"./kk":[85821,9719],"./kk.js":[85821,9719],"./kn":[37038,155],"./kn.js":[37038,155],"./ko":[68736,820],"./ko.js":[68736,820],"./lt":[78935,1529],"./lt.js":[78935,1529],"./lv":[23480,4708],"./lv.js":[23480,4708],"./mk":[32209,6651],"./mk.js":[32209,6651],"./ml":[27102,6655],"./ml.js":[27102,6655],"./mr":[23268,1248],"./mr.js":[23268,1248],"./ms":[84545,5443],"./ms.js":[84545,5443],"./nb":[15070,7749],"./nb.js":[15070,7749],"./nl":[64606,9750],"./nl.js":[64606,9750],"./pa":[31818,9815],"./pa.js":[31818,9815],"./pl":[98120,8628],"./pl.js":[98120,8628],"./pt":[93710,6953],"./pt-BR":[70626,2091],"./pt-BR.js":[70626,2091],"./pt.js":[93710,6953],"./ro":[49526,7162],"./ro.js":[49526,7162],"./ru":[38976,8292],"./ru.js":[38976,8292],"./sk":[24928,1770],"./sk.js":[24928,1770],"./sl":[65516,4259],"./sl.js":[65516,4259],"./sq":[25177,9737],"./sq.js":[25177,9737],"./sr":[24165,6331],"./sr.js":[24165,6331],"./sv":[23012,2944],"./sv.js":[23012,2944],"./sw":[56916,3998],"./sw.js":[56916,3998],"./ta":[11227,2739],"./ta.js":[11227,2739],"./te":[24939,5650],"./te.js":[24939,5650],"./th":[34086,2135],"./th.js":[34086,2135],"./tr":[38953,248],"./tr.js":[38953,248],"./uk":[54945,906],"./uk.js":[54945,906],"./ur":[67882,4361],"./ur.js":[67882,4361],"./uz":[37754,4873],"./uz.js":[37754,4873],"./vi":[79973,8598],"./vi.js":[79973,8598],"./zh-CN":[98537,6483],"./zh-CN.js":[98537,6483],"./zh-HK":[72511,1081],"./zh-HK.js":[72511,1081],"./zh-TW":[70468,7542],"./zh-TW.js":[70468,7542]};function i(e){if(!n.o(r,e))return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=r[e],i=t[0];return n.e(t[1]).then((()=>n(i)))}i.keys=()=>Object.keys(r),i.id=26299,e.exports=i},19922:(e,t,n)=>{var r={"./af":[36249,3748],"./af.js":[36249,3748],"./ar":[96951,1473],"./ar-DZ":[31883,6884],"./ar-DZ.js":[31883,6884],"./ar-KW":[85371,6282],"./ar-KW.js":[85371,6282],"./ar-LY":[25108,5671],"./ar-LY.js":[25108,5671],"./ar-MA":[22992,2966],"./ar-MA.js":[22992,2966],"./ar-SA":[14344,9646],"./ar-SA.js":[14344,9646],"./ar-TN":[60476,9289],"./ar-TN.js":[60476,9289],"./ar-XB":[61547,3934],"./ar-XB.js":[61547,3934],"./ar.js":[96951,1473],"./az":[58317,5740],"./az.js":[58317,5740],"./bn":[79307,7728],"./bn.js":[79307,7728],"./ca":[72669,9817],"./ca.js":[72669,9817],"./cs":[4388,2023],"./cs.js":[4388,2023],"./da":[82098,7315],"./da.js":[82098,7315],"./de":[96264,5862],"./de.js":[96264,5862],"./el":[57882,1055],"./el.js":[57882,1055],"./en-AU":[82248,8678],"./en-AU.js":[82248,8678],"./en-CA":[18526,4616],"./en-CA.js":[18526,4616],"./en-GB":[87123,9227],"./en-GB.js":[87123,9227],"./en-IE":[40296,2979],"./en-IE.js":[40296,2979],"./en-NZ":[66060,3892],"./en-NZ.js":[66060,3892],"./es":[71689,1791],"./es-DO":[68592,2394],"./es-DO.js":[68592,2394],"./es.js":[71689,1791],"./et":[73429,4473],"./et.js":[73429,4473],"./fa":[6940,7662],"./fa.js":[6940,7662],"./fi":[63191,7386],"./fi.js":[63191,7386],"./fr":[81189,2445],"./fr-CA":[7908,9765],"./fr-CA.js":[7908,9765],"./fr-CH":[9925,8799],"./fr-CH.js":[9925,8799],"./fr.js":[81189,2445],"./gu":[62021,4468],"./gu.js":[62021,4468],"./he":[55897,5027],"./he.js":[55897,5027],"./hi":[55467,6709],"./hi.js":[55467,6709],"./hr":[23077,1381],"./hr.js":[23077,1381],"./hu":[85678,4339],"./hu.js":[85678,4339],"./id":[37827,6511],"./id.js":[37827,6511],"./it":[22365,5247],"./it.js":[22365,5247],"./kk":[65897,7074],"./kk.js":[65897,7074],"./kn":[23124,6568],"./kn.js":[23124,6568],"./ko":[77096,4818],"./ko.js":[77096,4818],"./lt":[66191,6920],"./lt.js":[66191,6920],"./mk":[4942,9545],"./mk.js":[4942,9545],"./ml":[28472,3113],"./ml.js":[28472,3113],"./mr":[84561,3422],"./mr.js":[84561,3422],"./ms":[95938,7739],"./ms-MY":[65012,1520],"./ms-MY.js":[65012,1520],"./ms.js":[95938,7739],"./nb":[98457,5959],"./nb.js":[98457,5959],"./nl":[68623,319],"./nl.js":[68623,319],"./pa-IN":[30837,8132],"./pa-IN.js":[30837,8132],"./pl":[40938,4980],"./pl.js":[40938,4980],"./pt":[80432,9116],"./pt-BR":[40725,6547],"./pt-BR.js":[40725,6547],"./pt.js":[80432,9116],"./ro":[65926,3569],"./ro.js":[65926,3569],"./ru":[84381,2957],"./ru.js":[84381,2957],"./sk":[31453,5965],"./sk.js":[31453,5965],"./sl":[96918,3501],"./sl.js":[96918,3501],"./sq":[46987,6496],"./sq.js":[46987,6496],"./sr":[7467,5170],"./sr-CYRL":[5879,5790],"./sr-CYRL.js":[5879,5790],"./sr.js":[7467,5170],"./sv":[38312,1069],"./sv.js":[38312,1069],"./sw":[47638,2017],"./sw.js":[47638,2017],"./ta":[50995,8634],"./ta.js":[50995,8634],"./te":[70008,3370],"./te.js":[70008,3370],"./th":[8448,951],"./th.js":[8448,951],"./tr":[47120,9313],"./tr.js":[47120,9313],"./uk":[75997,9682],"./uk.js":[75997,9682],"./ur":[98563,6163],"./ur.js":[98563,6163],"./uz":[16183,3017],"./uz-LATN":[75,8117],"./uz-LATN.js":[75,8117],"./uz.js":[16183,3017],"./zh-CN":[83718,3047],"./zh-CN.js":[83718,3047],"./zh-TW":[57924,5125],"./zh-TW.js":[57924,5125]};function i(e){if(!n.o(r,e))return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=r[e],i=t[0];return n.e(t[1]).then((()=>n(i)))}i.keys=()=>Object.keys(r),i.id=19922,e.exports=i},47466:e=>{"use strict";e.exports=JSON.parse('{"application/":{"applixware":"aw","atom+xml":"atom","atomcat+xml":"atomcat","atomsvc+xml":"atomsvc","ccxml+xml":"ccxml","cdmi-":{"capability":"cdmia","container":"cdmic","domain":"cdmid","object":"cdmio","queue":"cdmiq"},"davmount+xml":"davmount","docbook+xml":"dbk","dssc+der":"dssc","dssc+xml":"xdssc","ecmascript":"ecma","emma+xml":"emma","epub+zip":"epub","exi":"exi","font-":{"tdpfr":"pfr","woff":"woff"},"gml+xml":"gml","gpx+xml":"gpx","gxf":"gxf","hyperstudio":"stk","inkml+xml":["ink","inkml"],"ipfix":"ipfix","java-":{"archive":"jar","vm":"class","serialized-object":"ser"},"javascript":"js","json":"json","jsonml+json":"jsonml","lost+xml":"lostxml","mac-":{"binhex40":"hqx","compactpro":"cpt"},"mads+xml":"mads","marc":"mrc","marcxml+xml":"mrcx","mathematica":["ma","nb","mb"],"mathml+xml":"mathml","mbox":"mbox","mediaservercontrol+xml":"mscml","metalink+xml":"metalink","metalink4+xml":"meta4","mets+xml":"mets","mods+xml":"mods","mp21":["m21","mp21"],"mp4":"mp4s","msword":["doc","dot"],"mxf":"mxf","oda":"oda","ogg":"ogx","omdoc+xml":"omdoc","onenote":["onetoc","onetoc2","onetmp","onepkg"],"oxps":"oxps","pdf":"pdf","pgp-":{"encrypted":"pgp","signature":["asc","sig"]},"pkcs10":"p10","pkcs7-":{"mime":["p7m","p7c"],"signature":"p7s"},"pkcs8":"p8","pkix-":{"cert":"cer","crl":"crl","pkipath":"pkipath","attr-cert":"ac"},"pkixcmp":"pki","pls+xml":"pls","postscript":["ai","eps","ps"],"pskc+xml":"pskcxml","rdf+xml":"rdf","reginfo+xml":"rif","resource-":{"lists+xml":"rl","lists-diff+xml":"rld"},"rpki-":{"ghostbusters":"gbr","manifest":"mft","roa":"roa"},"rsd+xml":"rsd","rss+xml":"rss","rtf":"rtf","sbml+xml":"sbml","scvp-":{"cv-":{"request":"scq","response":"scs"},"vp-":{"request":"spq","response":"spp"}},"sdp":"sdp","set-":{"payment-initiation":"setpay","registration-initiation":"setreg"},"shf+xml":"shf","smil+xml":["smi","smil"],"sparql-":{"query":"rq","results+xml":"srx"},"srgs":"gram","srgs+xml":"grxml","sru+xml":"sru","ssdl+xml":"ssdl","ssml+xml":"ssml","tei+xml":["tei","teicorpus"],"thraud+xml":"tfi","vnd.":{"acucobol":"acu","acucorp":["atc","acutc"],"adobe.":{"fxp":["fxp","fxpl"],"xdp+xml":"xdp","xfdf":"xfdf","formscentral.fcdt":"fcdt","air-application-installer-package+zip":"air"},"apple.":{"installer+xml":"mpkg","mpegurl":"m3u8"},"audiograph":"aep","bmi":"bmi","businessobjects":"rep","chemdraw+xml":"cdxml","cinderella":"cdy","claymore":"cla","commonspace":"csp","cosmocaller":"cmc","crick.":{"clicker":"clkx","clicker.":{"keyboard":"clkk","palette":"clkp","template":"clkt","wordbank":"clkw"}},"curl.":{"car":"car","pcurl":"pcurl"},"dart":"dart","dece.":{"data":["uvf","uvvf","uvd","uvvd"],"ttml+xml":["uvt","uvvt"],"unspecified":["uvx","uvvx"],"zip":["uvz","uvvz"]},"dna":"dna","dpgraph":"dpg","dreamfactory":"dfac","dvb.":{"ait":"ait","service":"svc"},"dynageo":"geo","enliven":"nml","epson.":{"esf":"esf","msf":"msf","quickanime":"qam","salt":"slt","ssf":"ssf"},"eszigno3+xml":["es3","et3"],"ezpix-":{"album":"ez2","package":"ez3"},"fdf":"fdf","fdsn.":{"mseed":"mseed","seed":["seed","dataless"]},"flographit":"gph","framemaker":["fm","frame","maker","book"],"frogans.":{"fnc":"fnc","ltf":"ltf"},"fujitsu.":{"oasys":"oas","oasys2":"oa2","oasys3":"oa3","oasysgp":"fg5","oasysprs":"bh2"},"fujixerox.":{"ddd":"ddd","docuworks":"xdw","docuworks.binder":"xbd"},"fuzzysheet":"fzs","geogebra.":{"file":"ggb","tool":"ggt"},"geonext":"gxt","geoplan":"g2w","geospace":"g3w","gmx":"gmx","grafeq":["gqf","gqs"],"groove-":{"account":"gac","help":"ghf","injector":"grv","tool-":{"message":"gtm","template":"tpl"},"vcard":"vcg","identity-message":"gim"},"hal+xml":"hal","hbci":"hbci","hp-":{"hpgl":"hpgl","hpid":"hpid","hps":"hps","jlyt":"jlt","pcl":"pcl","pclxl":"pclxl"},"ibm.":{"minipay":"mpy","modcap":["afp","listafp","list3820"],"rights-management":"irm","secure-container":"sc"},"iccprofile":["icc","icm"],"igloader":"igl","immervision-":{"ivp":"ivp","ivu":"ivu"},"intergeo":"i2g","intu.":{"qbo":"qbo","qfx":"qfx"},"jam":"jam","jisp":"jisp","kahootz":["ktz","ktr"],"kde.":{"karbon":"karbon","kchart":"chrt","kformula":"kfo","kivio":"flw","kontour":"kon","kpresenter":["kpr","kpt"],"kspread":"ksp","kword":["kwd","kwt"]},"kenameaapp":"htke","kidspiration":"kia","kinar":["kne","knp"],"koan":["skp","skd","skt","skm"],"lotus-":{"approach":"apr","freelance":"pre","notes":"nsf","organizer":"org","screencam":"scm","wordpro":"lwp","1-2-3":"123"},"mcd":"mcd","medcalcdata":"mc1","mfer":"mwf","mfmp":"mfm","micrografx.":{"flo":"flo","igx":"igx"},"mif":"mif","mobius.":{"daf":"daf","dis":"dis","mbk":"mbk","mqy":"mqy","msl":"msl","plc":"plc","txf":"txf"},"mophun.":{"application":"mpn","certificate":"mpc"},"ms-":{"artgalry":"cil","excel":["xls","xlm","xla","xlc","xlt","xlw"],"excel.":{"sheet.":{"macroenabled.12":"xlsm","binary.macroenabled.12":"xlsb"},"addin.macroenabled.12":"xlam","template.macroenabled.12":"xltm"},"fontobject":"eot","htmlhelp":"chm","ims":"ims","lrm":"lrm","outlook":"msg","officetheme":"thmx","pki.":{"seccat":"cat","stl":"stl"},"powerpoint":["ppt","pps","pot"],"powerpoint.":{"addin.macroenabled.12":"ppam","presentation.macroenabled.12":"pptm","slide.macroenabled.12":"sldm","slideshow.macroenabled.12":"ppsm","template.macroenabled.12":"potm"},"project":["mpp","mpt"],"word.":{"document.macroenabled.12":"docm","template.macroenabled.12":"dotm"},"works":["wps","wks","wcm","wdb"],"wpl":"wpl","xpsdocument":"xps","cab-compressed":"cab"},"mseq":"mseq","musician":"mus","mynfc":"taglet","nitf":["ntf","nitf"],"noblenet-":{"directory":"nnd","sealer":"nns","web":"nnw"},"nokia.":{"radio-":{"preset":"rpst","presets":"rpss"},"n-gage.":{"data":"ngdat","symbian.install":"n-gage"}},"novadigm.":{"edm":"edm","edx":"edx","ext":"ext"},"osgi.":{"dp":"dp","subsystem":"esa"},"palm":["pdb","pqa","oprc"],"pawaafile":"paw","pg.":{"format":"str","osasli":"ei6"},"picsel":"efif","pocketlearn":"plf","powerbuilder6":"pbd","recordare.":{"musicxml":"mxl","musicxml+xml":"musicxml"},"rn-":{"realmedia":"rm","realmedia-vbr":"rmvb"},"seemail":"see","sema":"sema","semd":"semd","semf":"semf","smaf":"mmf","spotfire.":{"dxp":"dxp","sfs":"sfs"},"stardivision.":{"calc":"sdc","draw":"sda","impress":"sdd","math":"smf","writer":["sdw","vor"],"writer-global":"sgl"},"stepmania.":{"package":"smzip","stepchart":"sm"},"svd":"svd","syncml+xml":"xsm","syncml.":{"dm+wbxml":"bdm","dm+xml":"xdm"},"trueapp":"tra","ufdl":["ufd","ufdl"],"umajin":"umj","unity":"unityweb","uoml+xml":"uoml","vcx":"vcx","visio":["vsd","vst","vss","vsw"],"visionary":"vis","vsf":"vsf","Webd.":{"wbxml":"wbxml","wmlc":"wmlc","wmlscriptc":"wmlsc"},"webturbo":"wtb","wordperfect":"wpd","wqd":"wqd","xara":"xar","xfdl":"xfdl","yamaha.":{"hv-":{"dic":"hvd","script":"hvs","voice":"hvp"},"openscoreformat":"osf","smaf-":{"audio":"saf","phrase":"spf"},"openscoreformat.osfpvg+xml":"osfpvg"},"zul":["zir","zirz"],"3gpp2.tcap":"tcap","accpac.simply.":{"aso":"aso","imp":"imp"},"ahead.space":"ahead","airzip.filesecure.":{"azf":"azf","azs":"azs"},"amazon.ebook":"azw","americandynamics.acc":"acc","amiga.ami":"ami","anser-web-":{"certificate-issue-initiation":"cii","funds-transfer-initiation":"fti"},"aristanetworks.swi":"swi","blueice.multipass":"mpm","cloanto.rp9":"rp9","clonk.c4group":["c4g","c4d","c4f","c4p","c4u"],"cluetrust.cartomobile-":{"config":"c11amc","config-pkg":"c11amz"},"contact.cmsg":"cdbcmsg","criticaltools.wbs+xml":"wbs","ctc-posml":"pml","cups-ppd":"ppd","dolby.mlp":"mlp","ds-keypoint":"kpxx","ecowin.chart":"mag","fluxtime.clip":"ftc","fsc.weblaunch":"fsc","genomatix.tuxedo":"txd","geometry-explorer":["gex","gre"],"google-earth.":{"kml+xml":"kml","kmz":"kmz"},"handheld-entertainment+xml":"zmm","insors.igm":"igm","intercon.formnet":["xpw","xpx"],"ipunplugged.rcprofile":"rcprofile","irepository.package+xml":"irp","is-xpr":"xpr","isac.fcs":"fcs","kodak-descriptor":"sse","las.las+xml":"lasxml","macports.portpkg":"portpkg","mediastation.cdkey":"cdkey","mozilla.xul+xml":"xul","muvee.style":"msty","neurolanguage.nlu":"nlu","oasis.opendocument.":{"chart":"odc","database":"odb","formula":"odf","graphics":"odg","image":"odi","presentation":"odp","spreadsheet":"ods","text":"odt","text-":{"master":"odm","template":"ott","web":"oth"},"chart-template":"otc","formula-template":"odft","graphics-template":"otg","image-template":"oti","presentation-template":"otp","spreadsheet-template":"ots"},"olpc-sugar":"xo","oma.dd2+xml":"dd2","openofficeorg.extension":"oxt","openxmlformats-officedocument.":{"presentationml.":{"presentation":"pptx","slide":"sldx","slideshow":"ppsx","template":"potx"},"spreadsheetml.":{"sheet":"xlsx","template":"xltx"},"wordprocessingml.":{"document":"docx","template":"dotx"}},"pmi.widget":"wg","previewsystems.box":"box","proteus.magazine":"mgz","pvi.ptid1":"ptid","quark.quarkxpress":["qxd","qxt","qwd","qwt","qxl","qxb"],"realvnc.bed":"bed","rig.cryptonote":"cryptonote","rim.cod":"cod","route66.link66+xml":"link66","sailingtracker.track":"st","shana.informed.":{"formdata":"ifm","formtemplate":"itp","interchange":"iif","package":"ipk"},"simtech-mindmapper":["twd","twds"],"smart.teacher":"teacher","solent.sdkm+xml":["sdkm","sdkd"],"sun.xml.":{"calc":"sxc","draw":"sxd","impress":"sxi","math":"sxm","writer":"sxw","writer.":{"global":"sxg","template":"stw"},"calc.template":"stc","draw.template":"std","impress.template":"sti"},"sus-calendar":["sus","susp"],"symbian.install":["sis","sisx"],"tcpdump.pcap":["pcap","cap","dmp"],"tmobile-livetv":"tmo","trid.tpt":"tpt","triscape.mxs":"mxs","uiq.theme":"utz","wolfram.player":"nbp","wt.stf":"stf","zzazz.deck+xml":"zaz","3gpp.pic-bw-":{"large":"plb","small":"psb","var":"pvb"},"3m.post-it-notes":"pwn","android.package-archive":"apk","antix.game-component":"atx","astraea-software.iota":"iota","chipnuts.karaoke-mmd":"mmd","data-vision.rdz":"rdz","denovo.fcselayout-link":"fe_launch","hhe.lesson-player":"les","hydrostatix.sof-data":"sfd-hdstx","jcp.javame.midlet-rms":"rms","joost.joda-archive":"joda","llamagraphics.life-balance.":{"desktop":"lbd","exchange+xml":"lbe"},"osgeo.mapguide.package":"mgp","publishare-delta-tree":"qps","tao.intent-module-archive":"tao","yellowriver-custom-menu":"cmp"},"voicexml+xml":"vxml","widget":"wgt","winhlp":"hlp","wsdl+xml":"wsdl","wspolicy+xml":"wspolicy","x-":{"abiword":"abw","authorware-":{"bin":["aab","x32","u32","vox"],"map":"aam","seg":"aas"},"bcpio":"bcpio","bittorrent":"torrent","blorb":["blb","blorb"],"bzip":"bz","bzip2":["bz2","boz"],"cbr":["cbr","cba","cbt","cbz","cb7"],"cdlink":"vcd","chat":"chat","conference":"nsc","cpio":"cpio","csh":"csh","director":["dir","dcr","dxr","cst","cct","cxt","w3d","fgd","swa"],"doom":"wad","dtbncx+xml":"ncx","dtbook+xml":"dtb","dtbresource+xml":"res","dvi":"dvi","envoy":"evy","eva":"eva","font-":{"bdf":"bdf","ghostscript":"gsf","otf":"otf","pcf":"pcf","snf":"snf","ttf":["ttf","ttc"],"type1":["pfa","pfb","pfm","afm"],"linux-psf":"psf"},"freearc":"arc","futuresplash":"spl","glulx":"ulx","gnumeric":"gnumeric","gtar":"gtar","hdf":"hdf","latex":"latex","mie":"mie","ms-":{"application":"application","shortcut":"lnk","wmd":"wmd","wmz":"wmz","xbap":"xbap"},"msaccess":"mdb","msbinder":"obd","mscardfile":"crd","msclip":"clp","msdownload":["exe","dll","com","bat","msi"],"msmediaview":["mvb","m13","m14"],"msmetafile":["wmf","wmz","emf","emz"],"msmoney":"mny","mspublisher":"pub","msschedule":"scd","msterminal":"trm","mswrite":"wri","netcdf":["nc","cdf"],"nzb":"nzb","pkcs12":["p12","pfx"],"pkcs7-":{"certificates":["p7b","spc"],"certreqresp":"p7r"},"sh":"sh","shar":"shar","sql":"sql","stuffit":"sit","stuffitx":"sitx","subrip":"srt","sv4cpio":"sv4cpio","sv4crc":"sv4crc","tads":"gam","tar":"tar","tcl":"tcl","tex":"tex","texinfo":["texinfo","texi"],"tgif":"obj","ustar":"ustar","xfig":"fig","xliff+xml":"xlf","xpinstall":"xpi","xz":"xz","zmachine":["z1","z2","z3","z4","z5","z6","z7","z8"],"7z-compressed":"7z","ace-compressed":"ace","apple-diskimage":"dmg","cfs-compressed":"cfs","chess-pgn":"pgn","debian-package":["deb","udeb"],"dgc-compressed":"dgc","gca-compressed":"gca","gramps-xml":"gramps","install-instructions":"install","iso9660-image":"iso","lzh-compressed":["lzh","lha"],"mobipocket-ebook":["prc","mobi"],"rar-compressed":"rar","shockwave-flash":"swf","silverlight-app":"xap","t3vm-image":"t3","tex-tfm":"tfm","wais-source":"src","java-jnlp-file":"jnlp","research-info-systems":"ris","x509-ca-cert":["der","crt"]},"xaml+xml":"xaml","xenc+xml":"xenc","xhtml+xml":["xhtml","xht"],"xml":["xml","xsl"],"xop+xml":"xop","xproc+xml":"xpl","xslt+xml":"xslt","xspf+xml":"xspf","xv+xml":["mxml","xhvml","xvml","xvm"],"yang":"yang","yin+xml":"yin","zip":"zip","andrew-inset":"ez","cu-seeme":"cu","octet-stream":["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy"],"oebps-package+xml":"opf","pics-rules":"prf","prs.cww":"cww","rls-services+xml":"rs","timestamped-data":"tsd","xcap-diff+xml":"xdf","xml-dtd":"dtd","patch-ops-error+xml":"xer","relax-ng-compact-syntax":"rnc"},"audio/":{"adpcm":"adp","basic":["au","snd"],"midi":["mid","midi","kar","rmi"],"mp4":["m4a","mp4a"],"mpeg":["mpga","mp2","mp2a","mp3","m2a","m3a"],"ogg":["oga","ogg","spx"],"s3m":"s3m","silk":"sil","vnd.":{"dra":"dra","dts":"dts","nuera.":{"ecelp4800":"ecelp4800","ecelp7470":"ecelp7470","ecelp9600":"ecelp9600"},"rip":"rip","dece.audio":["uva","uvva"],"digital-winds":"eol","dts.hd":"dtshd","lucent.voice":"lvp","ms-playready.media.pya":"pya"},"webm":"weba","x-":{"aac":"aac","aiff":["aif","aiff","aifc"],"caf":"caf","flac":"flac","matroska":"mka","mpegurl":"m3u","ms-":{"wax":"wax","wma":"wma"},"pn-":{"realaudio":["ram","ra"],"realaudio-plugin":"rmp"},"wav":"wav"},"xm":"xm"},"image/":{"bmp":"bmp","cgm":"cgm","g3fax":"g3","gif":"gif","ief":"ief","jpeg":["jpeg","jpg","jpe"],"ktx":"ktx","png":"png","sgi":"sgi","svg+xml":["svg","svgz"],"tiff":["tiff","tif"],"vnd.":{"djvu":["djvu","djv"],"dwg":"dwg","dxf":"dxf","fastbidsheet":"fbs","fpx":"fpx","fst":"fst","ms-":{"modi":"mdi","photo":"wdp"},"xiff":"xif","adobe.photoshop":"psd","dece.graphic":["uvi","uvvi","uvg","uvvg"],"dvb.subtitle":"sub","fujixerox.edmics-":{"mmr":"mmr","rlc":"rlc"},"net-fpx":"npx","wap.wbmp":"wbmp"},"webp":"webp","x-":{"3ds":"3ds","cmx":"cmx","freehand":["fh","fhc","fh4","fh5","fh7"],"icon":"ico","pcx":"pcx","pict":["pic","pct"],"portable-":{"anymap":"pnm","bitmap":"pbm","graymap":"pgm","pixmap":"ppm"},"rgb":"rgb","tga":"tga","xbitmap":"xbm","xpixmap":"xpm","xwindowdump":"xwd","cmu-raster":"ras","mrsid-image":"sid"},"prs.btif":"btif"},"model/":{"iges":["igs","iges"],"mesh":["msh","mesh","silo"],"vnd.":{"collada+xml":"dae","dwf":"dwf","gdl":"gdl","gtw":"gtw","mts":"mts","vtu":"vtu"},"vrml":["wrl","vrml"],"x3d+binary":["x3db","x3dbz"],"x3d+vrml":["x3dv","x3dvz"],"x3d+xml":["x3d","x3dz"]},"text/":{"calendar":["ics","ifb"],"css":"css","csv":"csv","html":["html","htm"],"n3":"n3","plain":["txt","text","conf","def","list","log","in"],"richtext":"rtx","sgml":["sgml","sgm"],"troff":["t","tr","roff","man","me","ms"],"turtle":"ttl","vcard":"vcard","vnd.":{"curl":"curl","curl.":{"dcurl":"dcurl","mcurl":"mcurl","scurl":"scurl"},"fly":"fly","graphviz":"gv","in3d.":{"3dml":"3dml","spot":"spot"},"wap.":{"wml":"wml","wmlscript":"wmls"},"dvb.subtitle":"sub","fmi.flexstor":"flx","sun.j2me.app-descriptor":"jad"},"x-":{"asm":["s","asm"],"c":["c","cc","cxx","cpp","h","hh","dic"],"fortran":["f","for","f77","f90"],"nfo":"nfo","opml":"opml","pascal":["p","pas"],"setext":"etx","sfv":"sfv","uuencode":"uu","vcalendar":"vcs","vcard":"vcf","java-source":"java"},"cache-manifest":"appcache","uri-list":["uri","uris","urls"],"prs.lines.tag":"dsc","tab-separated-values":"tsv"},"video/":{"3gpp":"3gp","3gpp2":"3g2","h261":"h261","h263":"h263","h264":"h264","jpeg":"jpgv","jpm":["jpm","jpgm"],"mj2":["mj2","mjp2"],"mp4":["mp4","mp4v","mpg4"],"mpeg":["mpeg","mpg","mpe","m1v","m2v"],"ogg":"ogv","quicktime":["qt","mov"],"vnd.":{"dece.":{"hd":["uvh","uvvh"],"mobile":["uvm","uvvm"],"pd":["uvp","uvvp"],"sd":["uvs","uvvs"],"video":["uvv","uvvv"]},"fvt":"fvt","mpegurl":["mxu","m4u"],"vivo":"viv","dvb.file":"dvb","uvvu.mp4":["uvu","uvvu"],"ms-playready.media.pyv":"pyv"},"webm":"webm","x-":{"f4v":"f4v","fli":"fli","flv":"flv","m4v":"m4v","matroska":["mkv","mk3d","mks"],"mng":"mng","ms-":{"asf":["asf","asx"],"vob":"vob","wm":"wm","wmv":"wmv","wmx":"wmx","wvx":"wvx"},"msvideo":"avi","smv":"smv","sgi-movie":"movie"}},"chemical/x-":{"cdx":"cdx","cif":"cif","cmdf":"cmdf","cml":"cml","csml":"csml","xyz":"xyz"},"message/rfc822":["eml","mime"],"x-conference/x-cooltalk":"ice"}')},30614:e=>{"use strict";e.exports=JSON.parse('{"prefixHash":"ca4d318e0a1519cffe6030ba0fbd2bf1"}')},1429:e=>{"use strict";e.exports=JSON.parse('{"":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""}')},43756:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r=[["","Open the product context menu","Turn off send as sticker","Turn on send as sticker","__count__ @ message","Changing __count__ label","The label could not be updated","__count__ label changed","Couldn't block __participant__","__participant__ blocked","Blocking __participant__","Couldn't delete broadcast list.","Broadcast list deleted","Deleting broadcast list","Couldn't archive chat.","Chat archived","Archiving chat","Couldn't clear chat.","Chat cleared","Clearing chat","Couldn't delete chat.","Chat deleted","Deleting chat","Couldn't mark chat as read.","Couldn't mark chat as unread.","Marked as read","Marked as unread","Marking as read","Marking as unread","Couldn't mute chat.","Chat muted","Muting chat","Couldn't pin chat","You can only pin up to 3 chats.","Chat pinned","Pinning chat","Couldn't unarchive chat.","Chat unarchived","Unarchiving chat","Unmute","Couldn't unmute chat.","Chat unmuted","Unmuting chat","Couldn't unpin chat","Chat unpinned","Unpinning chat","Deleting label: __labelName__","Couldn't create group.","Please enter a shorter subject.","Can't add more than __max__ participants","Created group","Creating group","Couldn't delete group.","Group deleted","Deleting group","Couldn't exit group.","Exited group","Exiting group","Couldn't remove group icon.","Group icon removed","Removing group icon","Group icon set","Couldn't set group icon.","Setting group icon","Couldn't mute group.","Group muted","Muting group","Couldn't rename group.","Group renamed to __subject__","Renaming group","Group subject can't be empty","Couldn't unmute group.","Group unmuted","Unmuting group","Stop sharing live location with __name__?","Stop sharing live location with __name__?","Marking as not spam","Couldn't mark as not spam","Marked as not spam","Couldn't delete message because the message may have expired","Couldn't delete message","__count__ message deleted","Deleting message","Couldn't star message because the message may have expired","Couldn't star message","__count__ message starred","Starring message","Couldn't unstar all messages","Couldn't unstar message because the message may have expired","Couldn't unstar message","__count__ message unstarred","All messages unstarred","Unstarring message","Unstarring all messages","Failed to add label: __labelName__","Label: __labelName__ added successfully","Couldn't add __participantNames__.","You added __participantNames__.","Adding __participantNames__.","Removing __participantNames__ as an admin failed.","You can't dismiss __participant__ as admin because they created this group.","__participantNames__ is no longer a group admin.","Removing __participantNames__ as a group admin.","They are no longer in this group.","You can't add this participant because they left the group recently.","Couldn't make __participantNames__ an admin.","__participantNames__ is now a group admin.","Making __participantNames__ a group admin.","Couldn't remove __participantNames__.","You can't remove __participant__ because they created this group.","You removed __participantNames__.","Removing __participantNames__.","Couldn't remove profile photo.","Profile photo removed","Removing profile photo","Profile photo set","Couldn't set profile photo.","Setting profile photo","Your name can't be empty","Your name changed","Couldn't change your name.","Changing your name","Reporting spam","Couldn't report spam","Reported spam","About can't be empty","About changed","Couldn't change About.","Changing About","Try again.","Couldn't unblock __participant__","__participant__ unblocked","Unblocking __participant__","Undo","Add a caption","Blocked contacts will no longer be able to call you or send you messages","Add blocked contact","Add to a group","Add group icon","Add profile photo","Drag the image to adjust","Only __admins__ can send messages","Archive chat","No archived chats","Archived chats","Document","__count__ Page","Contact","__number__ audio file you tried adding has no content.","Your browser doesnt support audio playback.","__number__ audio you tried adding is larger than the __maxSize__ limit.","Using __deviceName__ as your __deviceType__ for your WhatsApp calls",'"__businessName__" registered as a business account, but WhatsApp hasnt verified their name yet.','This chat is with the official business account of "__businessName__". Click for more info.','WhatsApp has verified that this is the official business account of "__businessName__".','WhatsApp has verified that this is the official business account of "__businessName__". This account is saved with a different name in your address book.','This official business account changed its name to "__businessName__". Click for more info.','WhatsApp has verified that this official business account changed its name and now uses the name "__businessName__".',"__businessName__ used other companies to store and manage this message.","__businessName__ used Facebook and other companies to store and manage this message.","This message was delivered directly from __businessName__.","This message was delivered directly to __businessName__.","__businessName__ used Facebook to store and manage this message.",'"__businessName__" registered as a business account, but WhatsApp hasnt verified their name yet.','This chat is with the official business account of "__businessName__". Click for more info.','WhatsApp has verified that this is the official business account of "__businessName__".','WhatsApp has verified that this is the official business account of "__businessName__". This account is saved with a different name in your address book.','This chat is now with the official business account of "__businessName__". Click for more info.','WhatsApp has verified that this is the official business account of "__businessName__".','This chat is no longer with the official business account of "__businessName__". Click for more info.','WhatsApp is no longer able to verify that this is the official business account of "__businessName__".',"Block","Block __contact__? Blocked contacts will no longer be able to call you or send you messages.","List of contacts that you have blocked","No blocked contacts yet","Blocked contacts","WhatsApp secures messages while they're being delivered to and from the companies that store and manage this chat for __businessName__. Contact __businessName__ for more information on their privacy practices.","WhatsApp secures messages while they're being delivered to and from Facebook, where this chat is stored and managed for __businessName__. Contact __businessName__ for more information on their privacy practices.","WhatsApp secures messages while they're being delivered to and from Facebook, where this chat is stored and managed for __businessName__.","__businessName__ is registered as a business account.","__businessName__ is registered as an official business account.","__businessName__ is registered as an official business account. The business is saved as a different name in your contacts.","This chat is with the official business account of __businessName__.","This chat is with the official business account of __businessName__. The business is saved as a different name in your contacts.","__businessName__ is now registered as a business account, instead of an official business account.","__businessName__ no longer uses Facebook to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ now only uses Facebook to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ no longer uses Facebook or other companies to manage its WhatsApp conversations.","__businessName__ is now registered as an official business account. This business no longer uses Facebook to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is now registered as an official business account, but it's saved as a different name in your contacts. This business no longer uses Facebook to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is now registered as an official business account that only uses Facebook to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is now registered as an official business account, but it's saved as a different name in your contacts. This business only uses Facebook to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is now registered as an official business account. This business no longer uses Facebook or other companies to manage its WhatsApp conversations. Click to learn more.","This chat is with the official business account of __businessName__. This business uses Facebook and other companies to manage its WhatsApp conversations. Click to learn more about privacy in this chat.","This chat is with the official business account of __businessName__, but it's saved as a different name in your contacts. This business uses Facebook and other companies to manage its WhatsApp conversations. Click to learn more about privacy in this chat.","__businessName__ is no longer an official business account and it no longer uses Facebook to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is no longer an official business account and it now only uses Facebook to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is no longer an official business account and it no longer uses Facebook or other companies to manage its WhatsApp conversations. Click to learn more.","__businessName__ no longer uses other companies to manage its WhatsApp conversations.","__businessName__ is now registered as an official business account. This business no longer uses other companies to manage its WhatsApp conversations. Click to learn more.","This chat is with the official business account of __businessName__. This business uses other companies to manage its WhatsApp conversations. Click to learn more about privacy in this chat.","This chat is with the official business account of __businessName__, but it's saved as a different name in your contacts. This business uses other companies to manage its WhatsApp conversations. Click to learn more about privacy in this chat.","__businessName__ is no longer an official business account and it no longer uses other companies to manage its WhatsApp conversations. Click to learn more.","__businessName__ is now registered as a business account that uses Facebook and other companies to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is now registered as a business account that uses other companies to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is now registered as a business account that uses Facebook to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is now registered as a business account. Click to learn more.","__businessName__ now uses other companies instead of Facebook to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ no longer uses Facebook to manage its WhatsApp conversations.","__businessName__ is now registered as an official business account. This business now uses other companies instead of Facebook to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is now registered as an official business account, but it's saved as a different name in your contacts. This business now uses other companies instead of Facebook to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is now registered as an official business account. This business no longer uses Facebook to manage its WhatsApp conversations. Click to learn more.","This chat is with the official business account of __businessName__. This business uses Facebook to manage its WhatsApp conversations. Click to learn more about privacy in this chat.","This chat is with the official business account of __businessName__, but it's saved as a different name in your contacts. This business uses Facebook to manage its WhatsApp conversations. Click to learn more about privacy in this chat.","This chat is with the official account of __businessName__, but it's saved as a different name in your contacts. This account uses Facebook to manage its WhatsApp conversations. Click to learn more about privacy in this chat.","This chat is with the official account of __businessName__. This account uses Facebook to manage its WhatsApp conversations. Click to learn more about privacy in this chat.","__businessName__ is no longer an official business account. This business uses other companies instead of Facebook to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is no longer an official business account and it no longer uses Facebook to manage its WhatsApp conversations. Click to learn more.","__businessName__ now uses other companies to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","This chat is with the official business account of __businessName__. Click to learn more.","__businessName__ now uses Facebook and other companies to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is no longer registered as a business account.","__businessName__ now uses Facebook to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is now registered as an official business account that uses Facebook and other companies to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is now registered as an official business account, but it's saved as a different name in your contacts. This business uses Facebook and other companies to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is now registered as an official business account that uses other companies to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is now registered as an official business account, but it's saved as a different name in your contacts. This business uses other companies to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is now registered as an official business account that uses Facebook to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is now registered as an official business account, but it's saved as a different name in your contacts. This business uses Facebook to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is now registered as an official business account. Click to learn more.","__businessName__ is no longer an official business account. This business now uses Facebook and other companies to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is no longer an official business account and it now uses other companies to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is no longer an official business account and it now uses Facebook to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is no longer registered as an official business account. Click to learn more.","Broadcast list deleted","Browser not supported","__closed__, opens at __time__","End Time","Start Time","__open__ 24 hours","__openTime__ - __closeTime__ and __additionalOpenTime__ - __additionalCloseTime__","__open__ by appointment only","__open__ until __time__","__open__ until __time__, __additionalOpenTime__ - __additionalCloseTime__","This verified business is not in your contact list.","__streetAddress__, __city__","__streetAddress__, __city__ __zipCode__","Confirmed as __businessName__","End Time","This name will be visible to your WhatsApp customers and can be edited from the app on your mobile device.","Something went wrong","An error occurred while saving.  Please try again.","__verified__ as __businessName__","Use Here","__count__ message couldn't be forwarded because __contact__ is on a version of WhatsApp that doesn't support it.","No messages could be forwarded because __contact__ is on a version of WhatsApp that doesn't support them.","__count__ message couldn't be forwarded because the file is missing.","__count__ message couldn't be forwarded because the file is missing or __contact__ is on a version of WhatsApp that doesn't support it.","No messages could be forwarded because the file is missing or __contact__ is on a version of WhatsApp that doesn't support them.","Can't Load WhatsApp","Qty __quantity__","Received cart","__updated__ Item Updated","By using this feature, you're using a __fb_product_link__ and agree that the __fb_commerce_link__ and __wa_commerce_policy_link__ apply.","If you feel this is not correct, you can __request_review_link__.","We reviewed this item again and found it didn't follow product or service guidelines. __learn_more_link__.","This item wasn't approved because it doesn't follow our product or service guidelines. __learn_more_link__.","This item is being reviewed. If its been approved, your customers will be able to see it on your profile. __learn_more_link__.","This item is being reviewed. You hid it, so customers wont see it in your catalog when its approved. __learn_more_link__.","Turn this on to let customers add items to a cart when shopping in your catalog. Turning this off won't affect carts you've already received. __learn_more_link__","View __catalogOwnerName__'s Catalog on WhatsApp","__productName__ from __catalogOwnerName__ on WhatsApp.","View all","Change group icon","__name__ changed their phone number. You're currently chatting with their new number.","__name__ changed their phone number to a new number.","__name__ changed their phone number to a new number. Click to message the new number.","Change profile photo","Charge your phone to keep using WhatsApp","Archived","You are not an admin","Search for messages within __chatName__.","No Internet connection","Clear messages","click here for group info","click here for contact info","Update WhatsApp","Click to reload QR code","Click to save, ESC to cancel","Click to update WhatsApp","Close chat","__count__ item","This collection wasn't approved because its name violates __collections_rejected_policy_adult__","This collection wasn't approved because its name violates __collections_rejected_policy_alcohol__","This collection wasn't approved because its name violates __collections_rejected_policy_animals__","This collection wasn't approved because its name violates __collections_rejected_policy_body_parts_fluids__","This collection wasn't approved because its name violates __collections_rejected_policy_community_standards__","This collection wasn't approved because its name violates __collections_rejected_policy_digital_services_products__","This collection wasn't approved because its name violates __collections_rejected_policy_discrimination__","This collection wasn't approved because its name violates __collections_rejected_policy_drugs__","This collection wasn't approved because its name violates __collections_rejected_policy_gambling__","This collection wasn't approved because its name violates __collections_rejected_policy_hazardous_goods_and_materials__","This collection wasn't approved because its name violates __collections_rejected_policy_healthcare__","This collection wasn't approved because its name violates __collections_rejected_policy_human_exploitation_and_sexual_services__","This collection wasn't approved because its name violates __collections_rejected_policy_illegal_products__","This collection wasn't approved because its name violates __collections_rejected_policy_misleading__","You can __rename_collection_link__ or __request_another_review_link__.","This collection wasn't approved because its name violates __collections_rejected_policy_other_violation__","This collection wasn't approved because its name violates __collections_rejected_policy_overtly_sexualized_positioning__","This collection wasn't approved because its name violates __collections_rejected_policy_real_fake_currency__","This collection wasn't approved because its name violates __collections_rejected_policy_stolen_goods__","This collection wasn't approved because its name violates __collections_rejected_policy_supplements__","This collection wasn't approved because its name violates __collections_rejected_policy_thrid_party_infringements__","This collection wasn't approved because its name violates __collections_rejected_policy_tobacco__","This collection wasn't approved because its name violates __collections_rejected_policy_unauthorized_media__","This collection wasn't approved because its name violates __collections_rejected_policy_weapons__","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_adult__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_alcohol__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_animals__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_body_parts_fluids__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_community_standards__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_digital_services_products__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_discrimination__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_drugs__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_gambling__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_hazardous_goods_and_materials__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_healthcare__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_human_exploitation_and_sexual_services__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_illegal_products__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_misleading__.","You can __rename_collection_link__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_other_violation__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_overtly_sexualized_positioning__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_real_fake_currency__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_stolen_goods__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_supplements__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_thrid_party_infringements__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_tobacco__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_unauthorized_media__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_weapons__.","","Add __participant__ to __subject__ group?","Add __participants__ to __subject__ group?","You are closing WhatsApp.","Some messages cant be forwarded, do you want to forward rest of the messages?","Can't forward all messages","Forward to __chat__?","Log out?","Make __participant__ an admin for __subject__ group?","Remove __participant__ from __subject__ group?","Send __count__ contact to __chat__?","Send __count__ contact to __chat__?","Send __count__ contact to __chat__?","Unblock __chat__ and forward messages?","Unblock __contact__","Unmute this chat?","Unmute this group?","Connecting","Connecting to WhatsApp","Connecting","Block __contact__","__number__ group in common","About and phone number","Unblock __contact__","Loading About","View contact","__number__ contact that you tried to add has no content.","The contact that you tried to add is larger than the __maxSize__ limit.","Older messages may be available","Use WhatsApp on your phone to search messages from before __date__.","Use WhatsApp on your phone to see the complete chat history.","Search for messages with __chatName__.","WhatsApp message","Default","Delete chat","Deleting a label removes it from all messages, contacts, and from the list of labels. Are you sure you want to delete this label?","Delete message","Delete message?","Tell us about your issue","Please Update WhatsApp","New version available","Desktop Settings","Update","To continue using WhatsApp, click Update and install the latest version.","Couldn't Update Automatically","Downloading an update to WhatsApp. This may take several minutes. WhatsApp will automatically update and restart when the download finishes.","Updating WhatsApp","__name__ uses a default timer for disappearing messages in new chats. All new messages will disappear from this chat __number__ day after theyre sent. Click to learn more.","__name__ uses a default timer for disappearing messages in new chats. All new messages will disappear from this chat __number__ hour after theyre sent. Click to learn more.","__name__ uses a default timer for disappearing messages in new chats. All new messages will disappear from this chat __number__ minute after theyre sent. Click to learn more.","__name__ uses a default timer for disappearing messages in new chats. All new messages will disappear from this chat __number__ second after theyre sent. Click to learn more.","You use a default timer for disappearing messages in new chats. All new messages will disappear from this chat __number__ day after theyre sent. Click to learn more.","You use a default timer for disappearing messages in new chats. All new messages will disappear from this chat __number__ hour after theyre sent. Click to learn more.","You use a default timer for disappearing messages in new chats. All new messages will disappear from this chat __number__ minute after theyre sent. Click to learn more.","You use a default timer for disappearing messages in new chats. All new messages will disappear from this chat __number__ second after theyre sent. Click to learn more.","Dismiss","Docs","__count__ Doc","__name__ downloaded.","__number__ document you tried adding has no content.","__number__ document you tried adding is larger than the __maxSize__ limit.","End-to-end encrypted","Edit","Add text to your image","Turn on desktop notifications","& ","  ",", ","Disappearing messages were turned on. All new messages will disappear from this chat __number__ day after they're sent.","Disappearing messages were turned on. All new messages will disappear from this chat __number__ hour after they're sent.","Disappearing messages were turned on. All new messages will disappear from this chat __number__ minute after they're sent.","Disappearing messages were turned on. All new messages will disappear from this chat __number__ second after they're sent.","You turned on disappearing messages. All new messages will disappear from this chat __number__ day after they're sent.","You turned on disappearing messages. All new messages will disappear from this chat __number__ hour after they're sent.","You turned on disappearing messages. All new messages will disappear from this chat __number__ minute after they're sent.","You turned on disappearing messages. All new messages will disappear from this chat __number__ second after they're sent.","__name__ turned off disappearing messages.","__name__ turned on disappearing messages. All new messages will disappear from this chat __number__ day after they're sent.","__name__ turned on disappearing messages. All new messages will disappear from this chat __number__ hour after they're sent.","__name__ turned on disappearing messages. All new messages will disappear from this chat __number__ minute after they're sent.","__name__ turned on disappearing messages. All new messages will disappear from this chat __number__ second after they're sent.","Disappearing messages were turned on. All new messages will disappear from this chat __number__ day after they're sent. Click to change.","Disappearing messages were turned on. All new messages will disappear from this chat __number__ hour after they're sent. Click to change.","Disappearing messages were turned on. All new messages will disappear from this chat __number__ minute after they're sent. Click to change.","Disappearing messages were turned on. All new messages will disappear from this chat __number__ second after they're sent. Click to change.","You turned on disappearing messages. All new messages will disappear from this chat __number__ day after they're sent. Click to change.","You turned on disappearing messages. All new messages will disappear from this chat __number__ hour after they're sent. Click to change.","You turned on disappearing messages. All new messages will disappear from this chat __number__ minute after they're sent. Click to change.","You turned on disappearing messages. All new messages will disappear from this chat __number__ second after they're sent. Click to change.","__name__ turned off disappearing messages. Click to change.","__name__ turned on disappearing messages. All new messages will disappear from this chat __number__ day after they're sent. Click to change.","__name__ turned on disappearing messages. All new messages will disappear from this chat __number__ hour after they're sent. Click to change.","__name__ turned on disappearing messages. All new messages will disappear from this chat __number__ minute after they're sent. Click to change.","__name__ turned on disappearing messages. All new messages will disappear from this chat __number__ second after they're sent. Click to change.","Turning on this setting will make new messages disappear from this chat after 7 days. Recipients can still save these messages elsewhere.","Turning on this setting will make new messages disappear from this chat after a selected amount of time. Recipients can still save these messages elsewhere.","All new messages will disappear from this chat __number__ day after they're sent.","All new messages will disappear from this chat __number__ hour after they're sent.","All new messages will disappear from this chat __number__ minute after they're sent.","All new messages will disappear from this chat __number__ second after they're sent.","Anyone in this chat can change this setting.","Group admins control who can change this setting.","This message will disappear from this chat __number__ day after they're sent.","This message will disappear from this chat __number__ hour after they're sent.","This message will disappear from this chat __number__ minute after they're sent.","This message will disappear from this chat __number__ second after they're sent.","Off","On","__number__ day","__number__ hour","__number__ minute","__number__ second","Wait until the message finishes sending and displays a checkmark before forwarding.","Wait until this message is fully delivered before forwarding.","Unable to forward unsent message.","Cant Forward","__number__ file you tried adding has no content.","__count__ file failed to be downloaded because it's no longer on your phone.","__number__ file could not be added.","__number__ file you tried adding is not supported.","__number__ file you tried adding is larger than the __maxSize__ limit.","B","GB","kB","MB","Forward","You can only share with up to __count__ chat","Forwarded many times. You can only share with up to __count__ chat.","Forward message","Forward message to","Forwarded __count__ time","Found a contact card for this number. View contact card?","Older results may be available","Microsoft Edge","Google Chrome","Mozilla Firefox","Opera","Safari (macOS 11+ Only)","Custom GIF animations are currently not supported. Please use provided GIF selection feature.","Incoming calls off. Click to restore.","Alerts and sounds off. Click to restore.","Notifications enabled","You were added by someone who's not in your contacts","Group deleted","Cancel","Checking invite link","__count__ contact","Join group","Anyone with WhatsApp can follow this link to join this group. Only share it with people you trust.","__count__ participant","You can't view this group's invite link because you're not an admin.","This invite link doesn't match any WhatsApp groups.","Are you sure you want to reset the invite link for __groupName__? If you reset the link, no one will be able to use it to join this group.","Resetting the invite link for __groupName__.","Send link to","Joining group invites from Desktop is not yet available on the multi-device beta. Use your phone instead.","Joining group invites from Web is not yet available on the multi-device beta. Use your phone instead.","Can't join group","Viewing and revoking group invites from Desktop is not yet available on the multi-device beta. Use your phone instead.","Viewing and revoking group invites from Web is not yet available on the multi-device beta. Use your phone instead.","Can't view group invite details",'"__A__"','__A__"__B__" & "__C__"','"__A__," __B__','"__A__" & "__B__"',"Group muted","Type contact name","__count__ other","View all (__more__)","__count__ more","Group Subject","__number__ invited","Couldn't add __participant__. You can invite them privately to join this group.","Reset invite for __participant__? If you reset the invite, __participant__ won't be able to use it to join this group.","You cant take a photo because it looks like your computer doesnt have a camera. Try connecting one or if you have one connected, try restarting your browser.","Camera Not Found","Allow camera","You cant record a Voice Message because it looks like your computer doesnt have a microphone. Try connecting one or if you have one connected, try restarting your browser.","Microphone Not Found","Allow microphone","Help","Message from __author__","__unreadCount__ New Message","You'll be logged out after several minutes of inactivity","__number__ image you tried adding has no content.","__number__ image you tried adding is larger than the __maxSize__ limit.","Check your phone to answer","WhatsApp group video call from __name__","WhatsApp group voice call from __name__","WhatsApp video call from __name__","WhatsApp voice call from __name__","WhatsApp connects to your phone to sync messages. To reduce data usage, connect your phone to Wi-Fi.","With this update, your phone wont need to stay online to use WhatsApp on web, desktop or other devices. Up to 4 linked devices and 1 phone can be used at the same time. __learn_more__","With this update, your phone wont need to stay online to use WhatsApp Business on web, desktop or other devices. Up to 4 linked devices and 1 phone can be used at the same time. __learn_more__","This version expires in __num_days__ day. With the update, your phone wont need to stay online to use WhatsApp on other devices. Up to 4 linked devices and 1 phone can be used at the same time. __learn_more__","This version expires in __num_days__ day. With the update, your phone wont need to stay online to use WhatsApp Business on other devices. Up to 4 linked devices and 1 phone can be used at the same time. __learn_more__","This version will expire today at __time__. With the update, your phone wont need to stay online to use WhatsApp on other devices. Up to 4 linked devices and 1 phone can be used at the same time. __learn_more__","This version will expire today at __time__. With the update, your phone wont need to stay online to use WhatsApp Business on other devices. Up to 4 linked devices and 1 phone can be used at the same time. __learn_more__","WhatsApp is available for Mac. __get_it_here__.","Make calls from desktop with WhatsApp for Mac. __get_it_here__.","WhatsApp is available for Windows. __get_it_here__.","Make calls from desktop with WhatsApp for Windows. __get_it_here__.","Keep your phone connected","Expires at __time__","Expires in __number__ day","__count__ item","Search in __labelName__...","Learn more","Links","__count__ Link","Accurate to __accuracy__ M","__count__ people","Last updated __date__ at __time__","Last updated today at __time__","Last updated __date__ at __time__","Last updated yesterday at __time__","Live until __time__","__hours__h left","__hours__h __minutes__m left","__minutes__m left","__sharers__ is sharing live location","__name__ is sharing live location","__count__ person is sharing live location","You are sharing live location","You and __name__ are sharing live location","You and __count__ other person are sharing live location","__name__ stopped sharing","Updated __hours__h ago","Updated __hours__h __minutes__m ago","Updated __minutes__m ago","load earlier messages","load recent messages","Loading","loading messages","Log in","Menu __android_menu_icon__","Need help to get started?","Settings __iphone_settings_icon__","Tap __android_menu__ or __iphone_settings__ and select __whatsapp_web_menu_item__","Tap on __login_step_3_md_link_device__","WhatsApp Web","More than 1GB storage usage detected. Please be aware that remaining storage is low.","Low storage warning","Make sure your computer has an active Internet connection.","Manage","Mark as read","Mark as unread","Downloading messages: __progress__%","This version will expire today at __time__. Update to use WhatsApp Web without keeping your phone online.","This version will expire today at __time__. Update to use WhatsApp Desktop without keeping your phone online.","Media","Add a caption","This file was changed from original.","Blocked","Help","Keep me signed in","Log out","Make group admin","Notifications","Profile","Profile","Remove","Settings","Attach","Menu","This audio is too large. You can send audio up to __maxSize__.","Message __author__","This document is too large. You can send documents up to __maxSize__.","This file is too large. You can send files up to __maxSize__.","This image is too large. You can send images up to __maxSize__.","Message info","Delivered","Delivered to","Played","Played by","Read","Read by","__count__ remaining","Couldn't find message","The message youre pasting is too long. Try shortening it or sending it in multiple parts.","Message Too Long","This video is too large. You can send videos up to __maxSize__.","Cant play this Voice Message because it's no longer on your phone.","Voice Message Unavailable","Cant download this document because it's no longer on your phone.","Document Unavailable","Cant view this GIF because it's no longer on your phone.","GIF Unavailable","Media Message Unavailable","Cant view this photo because it's no longer on your phone.","Photo Unavailable","Cant play this video because it's no longer on your phone.","Video Unavailable","Phone number shared via url is invalid.","Send message to","__contactName__ and __count__ other contact","__count__ contact","You can only send up to __count__ contact","Mute __name__ for","__A__, __B__","__A__, and __B__","__A__, __B__","__A__ and __B__","Archive Chat","WhatsApp needed to restart because of a problem.","Problem Detected","Delete Chat","Delete Group","Exit Group","Log Out","Mark as Read","Mark as Unread","Chat","Help","Terms and Privacy Policy","Next Chat","Previous Chat","Window","Bring All to Front","Minimize","Zoom","Mute","New Chat","New Group","Profile and About","Unarchive Chat","Cancel Mute","This video is unavailable. Please try again.","New chat","New group","Next","No contacts","No Docs","No groups","No Links","No Media","No result found for '__labelName__'","No starred messages","Not spam","Notifications","__number__ of __totalNumber__","+__number__","OK, got it","Start WhatsApp at Login","Desktop Alerts","Show Previews","Display message text in desktop alerts","Sounds","Order Detail","Your Order","__subtotal__ (estimated)","Qty __quantity__","__total__ (estimated total)","Already blocked","Order #__order__","Update now to use WhatsApp Web on other devices without keeping your phone online.","WhatsApp is open on another computer or browser. Click Use Here to use WhatsApp in this window.","Pin chat","Waiting for this message. This may take a while.","Previous","__count__ contact excluded","__count__ Product","This photo is too small. Please select a photo with height and width of at least __size__ pixel.","Couldn't send this Voice Message.","","This is not your username or pin. This name will be visible to your WhatsApp contacts.","Group  __groupName__","All","__count__ reactions weren't sent","Reconnect","Remove","Remove this group's icon?",'Remove label "__labelName__" from __count__ item',"Remove photo","Remove your profile photo?","Report __contactInfo__","Report spam","Click to resend","Retry Now","Retrying","Retrying in __duration__","Retrying in __number__ second","Save","Scan Database Usage","Search","Search contacts","Search Emoji","Search GIFs via __service__","Search groups","Search Messages","No chats, contacts or messages found","No contacts found","No groups found","No messages found","No results found for '__keyword__'","Search or start new chat","Looking for chats, contacts or messages","Looking for messages","Learn which chats are end to end encrypted","Show security notifications","See __count__ archived chat","__count__ selected","Photo set to send as sticker","Send contact","Send contacts","send","Feedback/Question about WhatsApp","Email address","Confirm email address","Please enter a valid email address","The email addresses do not match","Subject","Feedback sent","Please enter a subject.","Contact us","__count__ Screenshot Maximum","Please add more to your description","To verify, send a message to __name__ and try again.","The sender is not in your contact list","Settings","__days__d","__hours__h","__minutes__m","__seconds__s","Some of your messages are still sending.","Star message","No starred messages","Starred messages","Created by __name__","Subject","This group is no longer available. Please contact __support__ for help.","__count__ suspicious link","Take photo","You'll be able to use WhatsApp again in __duration__","You're temporarily banned from WhatsApp because you sent too many messages to people who dont have __phone__ in their address books.","You're temporarily banned from WhatsApp because you created too many groups with people who dont have __phone__ in their address books.","__time__ left","Maximum number of files uploaded. __number__ file has been ignored.","Trying to reach phone","Turn off all desktop notifications for:","Unarchive chat","Unblock","Unblock __contact__?","Unblock Contact","Unpin chat","__count__ @ message not synced","__count__ unread message","Unstar","Unstar all messages?","Unstar message","Until __date__ at __time__","Until today at __time__","Until tomorrow at __time__","Until __day__ at __time__","Untitled","Download Microsoft Edge","Update Google Chrome","Update Mozilla Firefox","Update Safari","WhatsApp is out of date. Updating now","Updating","Your phone will no longer need to stay online to use WhatsApp on web, desktop or other devices. __learn_more__","Your phone will no longer need to stay online to use WhatsApp Business on web, desktop or other devices. __learn_more__","Upload photo","__participants__ joined using your invite","You invited __participants__","Version __version__","__number__ video you tried adding has no content.","Your browser doesnt support video playback.","__number__ video you tried adding is larger than the __maxSize__ limit.","View Contact Card","This view once photo has expired. Please ask __name__ to re-send it.","This view once video has expired. Please ask __name__ to re-send it.","View photo","Viewed by __count__","Stop screen sharing","Start screen sharing","You can turn on your camera after __callee__ answers","Your call will end in a few seconds because your microphone and sound output device were disconnected.","Your call will end in a few seconds because your microphone was disconnected.","__name__'s camera and mic are off","__name__'s camera is off","__name__'s mic is muted","__name__ is requesting to switch to a video call","Your call will end in a few seconds because your sound output device was disconnected.","You can turn off your camera after __callee__ answers","Please contact us with the make and model of your camera. ","Call cannot be placed for more than __count__ participant","You can only call up to __count__ contact","__callee__ couldn't be added to the call, because they are using an old version of WhatsApp or an incompatible device.","__count__ others","__callee__ is in a country where WhatsApp Calling is unavailable","Couldn't place call: __callee__ is unable to receive WhatsApp calls.","Couldn't place call: __callee__ is unable to receive WhatsApp calls at this time.","Couldn't place call: __callee__ is unable to receive WhatsApp calls.","Couldn't place call: __callee__ is not registered on WhatsApp","Couldn't place call: __callee__ is unable to receive WhatsApp video calls at this time.","WhatsApp will use your computer's camera for video calls and taking photos. You can always change this later in your computer's settings.","WhatsApp will use your computer's microphone for calls and voice messages. You can always change this later in your computer's settings.","__contactName__ - WhatsApp voice call","__contactName__ - WhatsApp video call","Chat wallpaper set","Set Chat Wallpaper","Your security code with __contactName__ changed because there was a login on a new device of theirs.","Your security code with __contactName__ changed because you logged into a new device.","Your security code with __contactName__ changed because there was a login on a new device of yours.","Your security code with __contactName__ changed because there was a login on this device.",'WhatsApp has verified that this is the official business account of "__businessName__".',"WhatsApp has verified that this is the official business account of __businessName__. This account is saved with a different name in your contacts.","Your security code could not be verified with __contactName__. Click to learn more.","Verify your security code with __contactName__ because there was an error with their list of linked devices.","You can't send messages to this group because you're no longer a participant.","Can't send a message to blocked contact __contact__.","Your security code with __contactName__ changed because there was a login or logout from one or more of their devices.","Your security code with __contactName__ changed because there was a login or logout from one or more of your devices.","Muted","Messages to this chat are secured with end-to-end encryption. __businessName__ may use another company to store, read and respond to your messages. Click to learn more.","online","last seen __date__ at __time__","last seen today at __time__","last seen __date__ at __time__","last seen yesterday at __time__","__participant__ is typing","__participant__ is recording audio","Audio","Contact","__count__ page","Document","Photo","Location","Video","Voice message","Delete group","Delete broadcast list","Download __name__","Exit","Frequently Contacted","__name__ changed this group's settings to allow all participants to send messages to this group.","__name__ changed this group's settings to allow only admins to send messages to this group.","__name__ created group __subject__","__name__ created this group","An admin created group __subject__","You created group __subject__","You created this group","Created __date__ at __time__","Created __date__ at __time__","Group created by __name__, on __date__ at __time__","Group created by you, on __date__ at __time__","Created today at __time__","Created today at __time__","Group created by __name__, today at __time__","Group created by you, today at __time__","Created __day__ at __time__","Created __day__ at __time__","Created yesterday at __time__","Created yesterday at __time__","Group created by __name__, yesterday at __time__","Group created by you, yesterday at __time__","__name__ changed the group description. Click to view.","__name__ changed the group description.","__name__ reset this group's invite link. Click to view the new invite link.","__name__ changed this group's settings to allow messages that have been forwarded many times.","__name__ changed this group's settings to not allow messages that have been forwarded many times.","__name__ was added","__name__ changed their phone number to a new number.","__name__ changed to __new_number__","__participants__ is no longer an admin","__name__ joined via an invite link","You joined via an invite link","__name__ left","__participants__ is now an admin","__name__ was removed","__name__ added __participants__","__name__ added you","__name__ removed __participants__","__name__ removed you","A participant added __participants__","A participant removed __participants__","You added __participants__","You removed __participants__","__name__ changed this group's settings to allow all participants to edit this group's info.","__name__ changed this group's settings to allow only admins to edit this group's info.","__name__ changed the subject to __subject__","A participant changed the subject to __subject__","You changed the subject to __subject__","__num__ invite sent","Groups","Groups in common","Messages to this chat and calls are secured with end-to-end encryption, which means that WhatsApp and third parties cant read or listen to them. __businessName__ may use a service to store, read and respond to your messages and calls. Contact __businessName__ for information on their privacy practices.","__name__ added to the list","__name__ removed from the list","__name__ and possibly other group participants are using an old version of WhatsApp that cannot receive messages sent from web/desktop using the multi-device beta. Use your phone to message this group.","__name__ is using an old version of WhatsApp that cannot receive messages sent from web/desktop using the multi-device beta. Use your phone to message them.","This happened likely because __contactName__ or you recently changed which devices you use WhatsApp on. Please verify the security code again.","Your security code with __contactName__ changed","To verify that messages and calls with __contactName__ are end-to-end encrypted, open this screen on your phone, and follow the instructions.","To verify that messages and calls with __contactName__ are end-to-end encrypted, scan or upload this code on their device. You can also compare the number above instead.","About","Messages","Missed group video call at __time__","Missed group voice call at __time__","Missed video call","Missed video call at __time__","Missed voice call","Missed voice call at __time__","The business account for __businessName__ has registered as a standard user account and may no longer belong to the business.","Other contacts","__count__ participant","To receive a payment from __senderName__, set up your payment account on your phone.","__contactName__ canceled their payment request for __currencyAndAmount__","You canceled your payment request to __contactName__ for __currencyAndAmount__","__contactName__ declined your payment request for __currencyAndAmount__.","You declined __contactName__'s payment request for __currencyAndAmount__.","__senderName__'s payment request for __currencyAndAmount__ to you expired.","Your payment request to __receiverName__ for __currencyAndAmount__ expired.","You notified __receiverName__ that you are trying to send a payment.","You can now send __receiverName__ a payment.","__invitee__ has set up payments","You invited __otherUser__ to use payments","__otherUser__ invited you to use payments","Requested from __receiverName__","Requested __amount__ from You","__senderName__ requested __amount__ from You","__senderName__ requested __amount__ from __receiverName__","Sent __amount__ to You","__senderName__ sent __amount__ to You","__senderName__ sent __amount__ to __receiverName__","Sent to __receiverName__","Pending (expires __timeSpan__)","__senderName__ sent you __currencyAndAmount__. Use WhatsApp on your phone to accept this transaction.","__senderName__'s payment __relativeTime__ is complete.","Your payment to __receiverName__ __relativeTime__ couldn't complete.","Your payment to __receiverName__ __relativeTime__ couldn't complete.","Your payment to __receiverName__  was refunded __relativeTime__.","on __date__","__name__ changed this group's icon","You changed this group's icon","__name__ deleted this group's icon","You deleted this group's icon","Preview","OFFICIAL ANNOUNCEMENTS","Recent chats","__count__ recipient","Your security code with __contactName__ changed because there was a logout from one of their devices.","Your security code with __contactName__ changed because there was a logout from one of your devices.","Your security code with __contactName__ changed. Click to learn more.","Your security code with __name__ changed because there was a registration on a new device of theirs.","Your security code with __name__ changed because there was a registration on a new device of yours.","Select messages",'WhatsApp has verified that this is the official business account of "__businessName__". This business uses WhatsApp Business, which allows them to add their opening hours, address, website and catalog of products or services.','This chat is with the verified business account for "__businessName__". Click for more info.','This chat is with the business account for "__businessName__". Click for more info.',"__businessName__ may be a business account, but WhatsApp hasnt verified their name yet.",'The business account youre chatting with is now verified as "__businessName__". Click for more info.','The business account youre chatting with is no longer verified as "__businessName__". Click for more info.','WhatsApp is no longer able to verify that this is the account for "__businessName__".','The business account youre chatting with is no longer verified as "__businessName__". Click for more info.','WhatsApp is no longer able to verify that this is the account for "__businessName__".','The business account youre chatting with is no longer confirmed as "__businessName__". Click for more info.','WhatsApp is no longer able to confirm that this is the account for "__businessName__".','This account has registered as a business account and WhatsApp has confirmed that this is the account for "__businessName__".',"__businessName__ registered as a business account, but WhatsApp hasnt verified their name yet.",'The business account you\'re chatting with belongs to "__businessName__".',"To chat with __contact__, review and accept WhatsApps updated terms and privacy policy on your phone.","__date__ at __time__","today at __time__","The business account you're chatting with may belong to __businessName__. WhatsApp hasn't verified their name yet.","To help you connect with businesses, we have verified that the business account you're chatting with belongs to __businessName__.","The business account you're chatting with may belong to __businessName__. WhatsApp hasn't verified their name yet.","To help you connect with businesses, we have verified that the business account you're chatting with belongs to __businessName__.",'You opened "Verify security code" for the wrong phone number. Open it for the correct number to verify __contact__.','__contact__ opened "Verify security code" for the wrong phone number. Ask __contact__ to open it for your phone number.',"yesterday at __time__","You","You created a broadcast list with __count__ recipient","To use WhatsApp, update __chrome_update__ or use __firefox_homepage__, __safari_homepage__, __edge_homepage__ or __opera_homepage__.","WhatsApp works with Google Chrome __min_version_chrome__+","To use WhatsApp, update __edge_homepage__ or use __chrome_homepage__, __firefox_homepage__ or __opera_homepage__.","WhatsApp works with Microsoft Edge __min_version_edge__+","To use WhatsApp, update __firefox_update__ or use __chrome_homepage__, __safari_homepage__, __edge_homepage__ or __opera_homepage__.","WhatsApp works with Mozilla Firefox __min_version_firefox__+","WhatsApp group invite","WhatsApp","To use WhatsApp, update __safari_update__ or use __chrome_homepage__, __firefox_homepage__ or __opera_homepage__.","To use all of WhatsApp's features like photo capturing and Voice Message recording, we recommend using __chrome_homepage__, __firefox_homepage__ or __opera_homepage__.","Using Safari","WhatsApp works with Safari __min_version_safari__+","WhatsApp","Send and receive WhatsApp messages right from your computer.","WhatsApp is open in another window. Click Use Here to use WhatsApp in this window.","Quickly send and receive WhatsApp messages right from your computer.","We recommend using WhatsApp with one of the following browsers:","WhatsApp also supports:","You can't add more than __count__ labels","Go to Commerce Manager to update your shop."],{4:"__count__ @ messages",5:"Changing __count__ labels",6:"Some labels could not be updated",7:"__count__ labels changed",79:"Couldn't delete __count__ messages because the messages may have expired",80:"Couldn't delete messages",81:"__count__ messages deleted",82:"Deleting messages",83:"Couldn't star messages because the messages may have expired",84:"Couldn't star messages",85:"__count__ messages starred",86:"Starring messages",88:"Couldn't unstar messages because the messages may have expired",89:"Couldn't unstar messages",90:"__count__ messages unstarred",92:"Unstarring messages",96:"Couldn't add __participantNames__.",97:"You added __participantNames__.",98:"Adding __participantNames__.",99:"Removing __participantNames__ as admins failed.",101:"__participantNames__ are no longer group admins.",102:"Removing __participantNames__ as group admins.",103:"They are no longer in this group.",104:"You can't add these participants because they left the group recently.",105:"Couldn't make __participantNames__ admins.",106:"__participantNames__ are now group admins.",107:"Making __participantNames__ group admins.",108:"Couldn't remove __participantNames__.",110:"You removed __participantNames__.",111:"Removing __participantNames__.",146:"__count__ Pages",148:"__number__ audio files you tried adding have no content.",150:"__number__ audio files you tried adding are larger than the __maxSize__ limit.",254:"__count__ messages couldn't be forwarded because __contact__ is on a version of WhatsApp that doesn't support them.",256:"__count__ messages couldn't be forwarded because the file is missing.",257:"__count__ messages couldn't be forwarded because the file is missing or __contact__ is on a version of WhatsApp that doesn't support them.",262:"__updated__ Items Updated",291:"__count__ items",350:"Send __count__ contacts to __chat__?",351:"Send __count__ contacts to __chat__?",352:"Send __count__ contacts to __chat__?",361:"__number__ groups in common",366:"__number__ contacts that you tried to add have no content.",367:"The contacts that you tried to add are larger than the __maxSize__ limit.",375:"Deleting a label removes it from all messages, contacts, and from the list of labels. Are you sure you want to delete these labels?",376:"Delete messages",377:"Delete messages?",387:"__name__ uses a default timer for disappearing messages in new chats. All new messages will disappear from this chat __number__ days after theyre sent. Click to learn more.",388:"__name__ uses a default timer for disappearing messages in new chats. All new messages will disappear from this chat __number__ hours after theyre sent. Click to learn more.",389:"__name__ uses a default timer for disappearing messages in new chats. All new messages will disappear from this chat __number__ minutes after theyre sent. Click to learn more.",390:"__name__ uses a default timer for disappearing messages in new chats. All new messages will disappear from this chat __number__ seconds after theyre sent. Click to learn more.",391:"You use a default timer for disappearing messages in new chats. All new messages will disappear from this chat __number__ days after theyre sent. Click to learn more.",392:"You use a default timer for disappearing messages in new chats. All new messages will disappear from this chat __number__ hours after theyre sent. Click to learn more.",393:"You use a default timer for disappearing messages in new chats. All new messages will disappear from this chat __number__ minutes after theyre sent. Click to learn more.",394:"You use a default timer for disappearing messages in new chats. All new messages will disappear from this chat __number__ seconds after theyre sent. Click to learn more.",397:"__count__ Docs",399:"__number__ documents you tried adding have no content.",400:"__number__ documents you tried adding are larger than the __maxSize__ limit.",408:"Disappearing messages were turned on. All new messages will disappear from this chat __number__ days after they're sent.",409:"Disappearing messages were turned on. All new messages will disappear from this chat __number__ hours after they're sent.",410:"Disappearing messages were turned on. All new messages will disappear from this chat __number__ minutes after they're sent.",411:"Disappearing messages were turned on. All new messages will disappear from this chat __number__ seconds after they're sent.",412:"You turned on disappearing messages. All new messages will disappear from this chat __number__ days after they're sent.",413:"You turned on disappearing messages. All new messages will disappear from this chat __number__ hours after they're sent.",414:"You turned on disappearing messages. All new messages will disappear from this chat __number__ minutes after they're sent.",415:"You turned on disappearing messages. All new messages will disappear from this chat __number__ seconds after they're sent.",417:"__name__ turned on disappearing messages. All new messages will disappear from this chat __number__ days after they're sent.",418:"__name__ turned on disappearing messages. All new messages will disappear from this chat __number__ hours after they're sent.",419:"__name__ turned on disappearing messages. All new messages will disappear from this chat __number__ minutes after they're sent.",420:"__name__ turned on disappearing messages. All new messages will disappear from this chat __number__ seconds after they're sent.",421:"Disappearing messages were turned on. All new messages will disappear from this chat __number__ days after they're sent. Click to change.",422:"Disappearing messages were turned on. All new messages will disappear from this chat __number__ hours after they're sent. Click to change.",423:"Disappearing messages were turned on. All new messages will disappear from this chat __number__ minutes after they're sent. Click to change.",424:"Disappearing messages were turned on. All new messages will disappear from this chat __number__ seconds after they're sent. Click to change.",425:"You turned on disappearing messages. All new messages will disappear from this chat __number__ days after they're sent. Click to change.",426:"You turned on disappearing messages. All new messages will disappear from this chat __number__ hours after they're sent. Click to change.",427:"You turned on disappearing messages. All new messages will disappear from this chat __number__ minutes after they're sent. Click to change.",428:"You turned on disappearing messages. All new messages will disappear from this chat __number__ seconds after they're sent. Click to change.",430:"__name__ turned on disappearing messages. All new messages will disappear from this chat __number__ days after they're sent. Click to change.",431:"__name__ turned on disappearing messages. All new messages will disappear from this chat __number__ hours after they're sent. Click to change.",432:"__name__ turned on disappearing messages. All new messages will disappear from this chat __number__ minutes after they're sent. Click to change.",433:"__name__ turned on disappearing messages. All new messages will disappear from this chat __number__ seconds after they're sent. Click to change.",436:"All new messages will disappear from this chat __number__ days after they're sent.",437:"All new messages will disappear from this chat __number__ hours after they're sent.",438:"All new messages will disappear from this chat __number__ minutes after they're sent.",439:"All new messages will disappear from this chat __number__ seconds after they're sent.",442:"This message will disappear from this chat __number__ days after they're sent.",443:"This message will disappear from this chat __number__ hours after they're sent.",444:"This message will disappear from this chat __number__ minutes after they're sent.",445:"This message will disappear from this chat __number__ seconds after they're sent.",448:"__number__ days",449:"__number__ hours",450:"__number__ minutes",451:"__number__ seconds",452:"Wait until the messages finish sending and displays a checkmark before forwarding.",456:"__number__ files you tried adding have no content.",457:"__count__ files failed to be downloaded because they are no longer on your phone.",458:"__number__ files could not be added.",459:"__number__ files you tried adding are not supported.",460:"__number__ files you tried adding are larger than the __maxSize__ limit.",466:"You can only share with up to __count__ chats",467:"Forwarded many times. You can only share with up to __count__ chats.",468:"Forward messages",469:"Forward messages to",470:"Forwarded __count__ times",471:"Found contact cards for this number. View contact cards?",486:"__count__ contacts",489:"__count__ participants",507:"__count__ others",509:"__count__ more",512:"Couldn't add __participant__. You can invite them privately to join this group.",522:"__unreadCount__ New Messages",524:"__number__ images you tried adding have no content.",525:"__number__ images you tried adding are larger than the __maxSize__ limit.",534:"This version expires in __num_days__ days. With the update, your phone wont need to stay online to use WhatsApp on other devices. Up to 4 linked devices and 1 phone can be used at the same time. __learn_more__",535:"This version expires in __num_days__ days. With the update, your phone wont need to stay online to use WhatsApp Business on other devices. Up to 4 linked devices and 1 phone can be used at the same time. __learn_more__",544:"Expires in __number__ days",545:"__count__ items",549:"__count__ Links",550:"Accurate to __accuracy__ M",551:"__count__ people",556:"Live until __time__",557:"__hours__h left",559:"__minutes__m left",560:"__sharers__ are sharing live location",562:"__count__ people are sharing live location",565:"You and __count__ others are sharing live location",567:"Updated __hours__h ago",569:"Updated __minutes__m ago",617:"__count__ remaining",635:"__contactName__ and __count__ other contacts",636:"__count__ contacts",637:"You can only send up to __count__ contacts",700:"__count__ contacts excluded",701:"__count__ Products",702:"This photo is too small. Please select a photo with height and width of at least __size__ pixels.",707:"All",708:"__count__ reactions weren't sent",712:'Remove label "__labelName__" from __count__ items',721:"Retrying in __number__ seconds",740:"See __count__ archived chats",741:"__count__ selected",755:"__count__ Screenshots Maximum",760:"__days__d",761:"__hours__h",762:"__minutes__m",763:"__seconds__s",765:"Star messages",771:"__count__ suspicious links",776:"__time__ left",777:"Maximum number of files uploaded. __number__ files have been ignored.",785:"__count__ @ messages not synced",786:"__count__ unread messages",789:"Unstar messages",804:"__participants__ joined using your invite",805:"You invited __participants__",807:"__number__ videos you tried adding have no content.",809:"__number__ videos you tried adding are larger than the __maxSize__ limit.",810:"View Contact Cards",827:"Call cannot be placed for more than __count__ participants",828:"You can only call up to __count__ contacts",829:"__callee__ couldn't be added to the call, because they are using an old version of WhatsApp or an incompatible device.",830:"__count__ others",866:"__count__ pages",906:"__participants__ are no longer admins",910:"__participants__ are now admins",925:"__num__ invites sent",929:"__name__ were added to the list",930:"__name__ were removed from the list",939:"Missed group video call at __time__",940:"Missed group voice call at __time__",942:"Missed video call at __time__",944:"Missed voice call at __time__",947:"__count__ participants",949:"__contactName__ canceled their payment request for __currencyAndAmount__",950:"You canceled your payment request to __contactName__ for __currencyAndAmount__",951:"__contactName__ declined your payment request for __currencyAndAmount__.",952:"You declined __contactName__'s payment request for __currencyAndAmount__.",953:"__senderName__'s payment request for __currencyAndAmount__ to you expired.",954:"Your payment request to __receiverName__ for __currencyAndAmount__ expired.",961:"Requested __amount__ from You",962:"__senderName__ requested __amount__ from You",963:"__senderName__ requested __amount__ from __receiverName__",964:"Sent __amount__ to You",965:"__senderName__ sent __amount__ to You",966:"__senderName__ sent __amount__ to __receiverName__",969:"__senderName__ sent you __currencyAndAmount__. Use WhatsApp on your phone to accept this transaction.",982:"__count__ recipients",1014:"You created a broadcast list with __count__ recipients"}]},11609:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Offline=t.Disconnected=void 0;var r=n(40265);const i=(0,r.customError)("Disconnected",!1);t.Disconnected=i;const a=(0,r.customError)("Offline",!1,i);t.Offline=a},48338:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AckParser=void 0,t.ackMatchesTemplate=function(e,t){return e.id===t.id&&(void 0===t.class||e.class===t.class)&&(void 0===t.type||e.type===t.type)&&(void 0===t.from||o(e.from,t.from))&&(void 0===t.participant||e.participant===t.participant)&&(void 0===t.ts||e.ts===t.ts)},t.fromJidsAreEqual=o;var r=n(66543),i=n(52230);const a=new(n(71914).WapParser)("ack",(e=>(e.assertTag("ack"),{id:e.attrString("id"),ts:e.maybeAttrString("t"),class:e.attrString("class"),type:e.maybeAttrString("type"),from:e.attrJidWithType(),participant:e.hasAttr("participant")?e.attrDeviceJid("participant"):null})));function o(e,t){if((0,i.extractFromJid)(e)===t)return!0;const{defaultDeviceJidForUser:n}=(0,r.getJidUtilsApi)();return e.userJid?n(e.userJid)===t:!!e.deviceJid&&(0===(0,i.extractDeviceId)(e.deviceJid)&&(0,i.extractUserJid)(e.deviceJid)===t)}t.AckParser=a},36184:(e,t,n)=>{"use strict";var r=n(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.cancelDeadSocketTimer=function(){h&&h.deadSocketTimer.cancel()},t.castStanza=function(e){const t=C("castStanza");t.socket?t.castStanza(e):__LOG__(2)`Comms has no open socket`},t.closeSocket=function(){const e=C("closeSocket").socket;e&&(__LOG__(2)`closeSocket called`,e.close())},t.forceResetSocketLoop=function(){C("forceResetSocketLoop").socketLoop.reset()},t.isSocketConnected=E,t.maybeResetSocketLoop=function(){E()||C("maybeResetSocketLoop").socketLoop.reset()},t.onStreamErrorReceived=function(){C("onStreamErrorReceived").socketLoop.cancelReset()},t.openSocketLoop=y,t.resetStateForTests=function(){h=null,_=new u.Resolvable,g=1},t.sendIq=function(e,t){return T(e,!1).then((e=>(0,c.parseIqResponse)(e,t)))},t.sendIqErrorParser=function(e,t,n){return T(e,!1).then((e=>(0,c.parseIqResponse)(e,t,n)))},t.sendIqIfConnectedWithin=function(e,t,n){return T(e,!1,n).then((e=>(0,c.parseIqResponse)(e,t)))},t.sendIqIfConnectedWithinErrorParser=function(e,t,n,r){return T(e,!1,n).then((e=>(0,c.parseIqResponse)(e,t,r)))},t.sendIqWithoutRetry=function(e,t){return T(e,!0).then((e=>(0,c.parseIqResponse)(e,t)))},t.sendIqWithoutRetryErrorParser=function(e,t,n){return T(e,!0).then((e=>(0,c.parseIqResponse)(e,t,n)))},t.sendPing=function(){return b.apply(this,arguments)},t.sendSmaxIq=function(e,t){return T(e,!1).then((e=>(0,c.parseIqResponse)(e,t)))},t.sendSmaxIqErrorParser=function(e,t,n){return T(e,!1).then((e=>(0,c.parseIqResponse)(e,t,n)))},t.sendStanzaAndReturnAck=v,t.sendStanzaAndWaitForAck=function(e,t){return v(e,t).then((()=>{}))},t.singletonOrThrowIfUninitialized=C,t.socketLoopIteration=S,t.startComms=function(e,t,n,r){if(h)return;h=new m(e,t,n,r),setTimeout(y,0)},t.startHandlingRequests=function(){return C("startHandlingRequests").startHandlingRequests()},t.stopComms=function(){const e=C("stopComms");e.socketLoop.endWithValue(),e.socket&&e.socket.close()},t.waitForConnection=function(){return C("waitForConnection").sendPing(),_.promise};var i=r(n(11504)),a=n(48338),o=n(47151),s=n(11609),l=n(20221),c=n(37329),d=n(72287),u=n(88156),p=n(57319),f=n(31914);n(71914);let h=null,_=new u.Resolvable,g=1;class m{constructor(e,t,n,r){var i,a;this.nextSocketId=1,this.pendingIqs=new Map,this.ackHandlers=[],this._recvBlocker=new u.Resolvable,this.activePing=null,this._pending=new Set,this.socketId=0,this.socket=null,this.softCloseSocket=null,this.handleStanza=(e,t,n)=>{const r=A(e);if(null!=r){const t=this.pendingIqs.get(r);t?(this.pendingIqs.delete(r),t.resolve(e),this.maybeScheduleHealthCheck()):__LOG__(4,void 0,new Error)`handleIq no handler for iq with id ${r}`}else{if("ack"!==e.tag)return"failure"===e.tag&&this.config.shouldBlockReceivingUntilSuccess?this._handleStanza(e,t,n):this._recvBlocker.promise.then((()=>this._handleStanza(e,t,n)));this.handleAck(e)}return"NO_ACK"},this.healthCheckTimer=new p.ShiftTimer((()=>{__LOG__(2)`Comms: testing socket`,this.socketId&&this.sendPing()})),this.deadSocketTimer=new p.ShiftTimer((e=>{__LOG__(2)`Comms: Socket ${e} expired`,e===this.socketId&&this.softCloseSocket&&this.softCloseSocket()})),this._handleStanza=e,this.sendPing=t,this.onConnectionChange=(0,l.notifyConnectionChangeFactory)(null!==(i=n.handlers.onConnectionChange)&&void 0!==i?i:()=>{},null!==(a=n.handlers.onOptimisticConnectionChange)&&void 0!==a?a:()=>{}),this.gzipInflate=r,this.config=n,this.socketLoop=new d.PromiseRetryLoop({name:"MainSocketLoop",code:S,timer:{jitter:.1,max:n.maxSocketLoopWaitTime,algo:{type:"fibonacci",first:1e4,second:1e4},relativeDelay:!0},resetDelay:3e4})}filterPending(e){const t=[];function n(n){e(n)&&t.push(n)}return this.pendingIqs.forEach(n),this.ackHandlers.forEach(n),t}sendPendingIq(e){const{timeoutId:t}=e;null!=t&&(clearTimeout(t),e.timeoutId=void 0),this.callStanza(e.stanza)}callStanza(e){this.castStanza(e),this.deadSocketTimer.onOrBefore(this.config.deadSocketTime,this.socketId),this.healthCheckTimer.cancel()}castStanza(e){const t=this.socketOrThrow("castStanza");try{var n,r;null===(n=(r=this.config.handlers).onCastStanza)||void 0===n||n.call(r,e),t.sendFrame((0,f.encodeStanza)(e))}catch(e){__LOG__(4,void 0,new Error)`castStanza error ${e}`}}socketOrThrow(e){const t=this.socket;if(t)return t;throw new Error(`Comms.${e} called while no socket`)}startHandlingRequests(){return __LOG__(2)`Comms.startHandlingRequests`,this._recvBlocker.resolve(),this._recvBlocker.promise.then((()=>{}))}parseAndHandleStanza(e,t){e===this.socketId&&(this.deadSocketTimer.cancel(),_.resolveWasCalled()||_.resolve());const n=(0,f.decodeStanza)(t,this.gzipInflate).catch((e=>{throw __LOG__(4,void 0,new Error)`Failure parsing stanza!`,e})).then((n=>{var r,i;null===(r=(i=this.config.handlers).onHandleStanza)||void 0===r||r.call(i,n,e,t.byteLength);const a=this.activePing;return a&&a.socketId===e&&a.stanzaId===A(n)?(this.activePing=null,a.handler.resolve(n),this.maybeScheduleHealthCheck(),"NO_ACK"):this.handleStanza(n,e,t.byteLength)})).then((t=>{if(e===this.socketId){if("CLOSE_SOCKET"===t){__LOG__(2)`Comms: job response is CLOSE_SOCKET`;const e=this.socket;e&&e.close()}else"NO_ACK"===t?__LOG__(2)`Comms: job response is NO_ACK`:this.castStanza(t);return"NO_ACK"}}));this._pending.add(n),n.finally((()=>{this._pending.delete(n)}))}handleAck(e){const t=this.ackHandlers;let n=-1,r=null;for(;!r&&++n<t.length;)r=t[n].parseAndTest(e);if(r){var i,a;const s=t[n];(0,o.removeIndexWithoutPreservingOrder)(t,n),null===(i=(a=this.config.handlers).onHandleAck)||void 0===i||i.call(a,e),s.resolve(r),this.maybeScheduleHealthCheck()}else __LOG__(3)`handleAck: unrecognized ${e}`}removeHandler(e){if("iq"===e.type){const t=e.stanza.attrs.id;if(!t||"string"!=typeof t)return;if(!this.pendingIqs.delete(t))return}else{e.type;const t=this.ackHandlers.indexOf(e);if(-1===t)return;(0,o.removeIndexWithoutPreservingOrder)(this.ackHandlers,t)}e.resolve(Promise.reject(new s.Disconnected))}maybeScheduleHealthCheck(){if(this.healthCheckTimer.isScheduled())return;if(this.activePing||this.ackHandlers.length||this.pendingIqs.size)return;const e=this.config.healthCheckInterval,t=Math.ceil(1e3*e*(1+Math.random()));this.healthCheckTimer.onOrBefore(t)}}function y(){C("openSocketLoop").socketLoop.start()}function E(){var e;return!!(null===(e=h)||void 0===e?void 0:e.socket)}function S(){var e,t;const n=C("socketLoopIteration"),r=n.nextSocketId++;return __LOG__(2)`Comms: Socket ${r} opening`,null===(e=(t=n.config.handlers).onSocketLoopIteration)||void 0===e||e.call(t),n.config.openChatSocket((()=>{n.onConnectionChange("in_handshake")})).then((e=>{var t,i,a,o;null===(t=(i=n.config.handlers).onSocketOpen)||void 0===t||t.call(i);const s=new u.Resolvable;return __LOG__(2)`Comms: Socket ${r} opened`,n.socketId=r,n.socket=e,n.softCloseSocket=()=>{n.softCloseSocket=null,n.socket&&n.config.shouldCloseStaleSocket&&(n.socket.close(),n.socket=null),s.resolve()},n.socketLoop.resetTimeoutAfter(1e4),n.deadSocketTimer.cancel(),n.maybeScheduleHealthCheck(),e.setOnFrame((e=>n.parseAndHandleStanza(r,e))),e.setOnClose((()=>{var e,t;__LOG__(2)`Comms: Socket ${r} closed`,n.activePing&&r===n.activePing.socketId&&(n.activePing.handler.resolve(),n.activePing=null),n.filterPending((e=>e.attachedToSocketId===r)).forEach((e=>{n.removeHandler(e)})),r===n.socketId&&(n.socketId=0,n.socket=null,n.onConnectionChange("disconnected"),null===(e=(t=n.config.handlers).onDisconnect)||void 0===e||e.call(t),s.resolve(),_=new u.Resolvable)})),n.onConnectionChange("connected"),null===(a=(o=n.config.handlers).onConnect)||void 0===a||a.call(o),n.filterPending((e=>!e.attachedToSocketId)).sort(((e,t)=>e.orderedId-t.orderedId)).forEach((e=>{"iq"===e.type?n.sendPendingIq(e):n.callStanza(e.stanza)})),s.promise})).catch((e=>{e instanceof s.Disconnected?__LOG__(2)`socketLoopIteration socket closed while in noise handshake`:__LOG__(4,void 0,new Error)`socketLoopIteration failed ${e}`}))}function v(e,t){return new Promise((n=>{const r=C("sendStanzaAndWaitForAck");r.ackHandlers.push({type:"ack",parseAndTest:e=>{const n=a.AckParser.parse(e);return!n.error&&(0,a.ackMatchesTemplate)(n.success,t)?e:null},resolve:n,stanza:e,attachedToSocketId:0,orderedId:g++}),r.socket?r.callStanza(e):__LOG__(2)`Comms has no open socket, will send stanza when socket opens`}))}function T(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return new Promise((r=>{var i,a;const o=C("sendIq"),l=e.attrs.id;if(!l||"string"!=typeof l)throw new Error(`Comms:sendIq given iq without id: ${String(e)}`);const c=o.socketId;if(t&&!c)return void r(Promise.reject(new s.Offline));let d;n>0&&(d=setTimeout((()=>{const e=o.pendingIqs.get(l);e?o.removeHandler(e):r(Promise.reject(new Error(`Comms:_sendIq unexisting stanza to be cancelled: ${l}`)))}),1e3*n));const u={type:"iq",resolve:r,stanza:e,attachedToSocketId:t?c:0,orderedId:g++,timeoutId:d};o.pendingIqs.set(l,u),null===(i=(a=o.config.handlers).onSendIq)||void 0===i||i.call(a,e),o.socket?o.sendPendingIq(u):__LOG__(2)`Comms has no open socket, will resend iq when socket opens`}))}function b(){return(b=(0,i.default)((function*(e,t){const n=C("sendPing"),r=e.attrs.id;if(!r||"string"!=typeof r)return Promise.reject(new Error(`Comms:sendPing given iq without id: ${String(e)}`));if(!n.socketId)return __LOG__(2)`sendPing when socket dead`,Promise.resolve();if(n.activePing&&n.activePing.socketId===n.socketId)return __LOG__(2)`sendPing ping still pending`,Promise.resolve();n.activePing&&n.activePing.handler.resolve();const i=new u.Resolvable;n.activePing={socketId:n.socketId,stanzaId:r,handler:i},n.callStanza(e);const a=yield i.promise;return a&&(0,c.parseIqResponse)(a,t)}))).apply(this,arguments)}function C(e){if(h)return h;throw new Error(`Comms::${e} called before startComms`)}function A(e){if("iq"===e.tag){const t=e.attrs.type;if("result"===t||"error"===t)return(0,f.decodeAsString)(e.attrs.id)||null}return null}},20221:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.notifyConnectionChangeFactory=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:15e3;const r={timeoutID:null,connectionStatus:"disconnected",optimismLevel:"optimist"},i=()=>{const{optimismLevel:e,connectionStatus:i}=r;"optimist"===e?r.timeoutID=setTimeout((()=>{r.optimismLevel="realist",t(i)}),n):t(i)};return n=>{r.connectionStatus=n,"disconnected"===n||"in_handshake"===n?i():(null!=r.timeoutID&&(clearTimeout(r.timeoutID),r.timeoutID=null),t(n)),e(n)}}},34308:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.XmppParsingFailure=t.ParsableWapNode=void 0;var r=n(66543),i=n(8584),a=n(52230),o=n(8243),s=n(91560),l=n(17793),c=n(92844),d=n(31914),u=n(45506);class p{constructor(e,t){this.parser=e,this.reason=t}toString(){return`XmppParsingFailure: ${this.parser}: ${this.reason}`}}t.XmppParsingFailure=p;class f extends s.ParsableXmlNode{constructor(e,t){super(e,t)}assertFromServer(){const e=this.attrString("from");e!==a.WA_SERVER_DOMAIN&&this.throw(`to have "from"="s.whatsapp.net", but instead has "${e}"`)}attrUserJid(e){const t=this.attrString(e);return(0,a.interpretAndValidateJid)(t).userJid||this.throw(`to have "${e}"={UserJid}, but instead has "${t}"`)}attrPhoneUserJid(e){const t=this.attrString(e),n=(0,a.interpretAndValidateJid)(t);return"phoneUser"===n.jidType?n.userJid:this.throw(`to have "${e}"={PhoneUserJid}, but instead has "${t}"`)}maybeAttrUserJid(e){return this.hasAttr(e)?this.attrUserJid(e):null}maybeAttrPhoneUserJid(e){return this.hasAttr(e)?this.attrPhoneUserJid(e):null}attrGroupJid(e){const t=this.attrString(e);return(0,a.interpretAndValidateJid)(t).groupJid||this.throw(`to have "${e}"={GroupJid}, but instead has "${t}"`)}maybeAttrGroupJid(e){return this.hasAttr(e)?this.attrGroupJid(e):null}attrChatJid(e){const t=this.attrString(e),n=(0,a.interpretAndValidateJid)(t);return n.userJid||n.groupJid||this.throw(`to have "${e}"={ChatJid}, but instead has "${t}"`)}attrPhoneChatJid(e){const t=this.attrString(e),n=(0,a.interpretAndValidateJid)(t);return"phoneUser"===n.jidType?n.userJid:"group"===n.jidType?n.groupJid:this.throw(`to have "${e}"={ChatJid}, but instead has "${t}"`)}attrDeviceJid(e){const{defaultDeviceJidForUser:t}=(0,r.getJidUtilsApi)(),n=this.attrString(e),i=(0,a.interpretAndValidateJid)(n);return i.deviceJid?i.deviceJid:i.userJid?t(i.userJid):this.throw(`to have "${e}"={DeviceJid}, but instead has "${n}"`)}attrPhoneDeviceJid(e){const t=this.attrString(e),n=(0,a.interpretAndValidateJid)(t);return"phoneDevice"===n.jidType?n.deviceJid:"phoneUser"===n.jidType?(0,a.defaultPhoneDeviceJidForUser)(n.userJid):this.throw(`to have "${e}"={DeviceJid}, but instead has "${t}"`)}attrDeviceId(e){const t=this.attrInt(e);return(0,a.interpretAsDeviceId)(t)}attrFromJidChat(){const{defaultDeviceJidForUser:e}=(0,r.getJidUtilsApi)(),t=this.attrJidWithType();switch(t.jidType){case"msgrUser":{const n=t.userJid,r=e(n);return{type:"device",chat:n,deviceJid:r,author:r}}case"phoneUser":{const n=t.userJid,r=e(n);return{type:"device",chat:n,deviceJid:r,author:r}}case"lidUser":{const e=t.userJid,n=(0,a.defaultLidDeviceJidForLidUserJid)(e);return{type:"device",chat:e,deviceJid:n,author:n}}case"phoneDevice":{const e=t.deviceJid;return{type:"device",chat:(0,a.extractUserJid)(e),deviceJid:e,author:e}}case"msgrDevice":{const e=t.deviceJid;return{type:"device",chat:(0,a.extractUserJid)(e),deviceJid:e,author:e}}case"lidDevice":{const e=t.deviceJid;return{type:"device",chat:(0,a.extractUserJid)(e),deviceJid:e,author:e}}case"group":{const e=this.hasAttr("participant")?this.attrDeviceJid("participant"):null;return null==e?this.throw("expected to have participant JID for group"):{type:"group",chat:t.groupJid,groupJid:t.groupJid,author:e}}case"broadcast":{const e=this.hasAttr("participant")?this.attrDeviceJid("participant"):null;return null==e?this.throw("expected to have participant JID for group"):{type:"broadcast",broadcastJid:t.broadcastJid,chat:(0,a.extractUserJid)(e),author:e}}case"call":throw __LOG__(4,void 0,new Error)`ParsableWapNode: attrFromJid() is called with ${t.callJid}`,new Error("ParsableWapNode: attrFromJid() does not support CallJid");default:return t.jidType,this.throw("attrFromJidChat should not be used with a status jid")}}attrFromJidPhoneChat(){const e=this.attrJidWithType();switch(e.jidType){case"phoneUser":{const t=e.userJid,n=(0,a.defaultPhoneDeviceJidForUser)(t);return{type:"device",chat:t,deviceJid:n,author:n}}case"phoneDevice":{const t=e.deviceJid;return{type:"device",chat:(0,a.extractPhoneUserJid)(t),deviceJid:t,author:t}}case"group":{const t=this.hasAttr("participant")?this.attrPhoneDeviceJid("participant"):null;return null==t?this.throw("expected to have participant JID for group"):{type:"group",chat:e.groupJid,groupJid:e.groupJid,author:t}}case"broadcast":{const t=this.hasAttr("participant")?this.attrPhoneDeviceJid("participant"):null;return null==t?this.throw("expected to have participant JID for group"):{type:"broadcast",broadcastJid:e.broadcastJid,chat:(0,a.extractPhoneUserJid)(t),author:t}}case"call":throw __LOG__(4,void 0,new Error)`ParsableWapNode: attrFromJid() is called with ${e.callJid}`,new Error("ParsableWapNode: attrFromJid() does not support CallJid");default:return e.jidType,this.throw(`attrFromJidChat should not be used with jid of type ${e.jidType}`)}}attrFromPhoneJid(){if("status"===this.attrJidWithType().jidType){const e=this.hasAttr("participant")?this.attrPhoneDeviceJid("participant"):null;return e?{type:"status",author:e}:this.throw("to have participant for status msg")}return this.attrFromJidPhoneChat()}attrFromJid(){if("status"===this.attrJidWithType().jidType){const e=this.hasAttr("participant")?this.attrPhoneDeviceJid("participant"):null;return e?{type:"status",author:e}:this.throw("to have participant for status msg")}return this.attrFromJidChat()}attrJidWithType(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"from";const t=this.attrString(e),n=(0,a.interpretAndValidateJid)(t);return"unknown"===n.jidType?this.throw(`to have "${e}"={Jid}, but instead has "${t}"`):n}attrWapJid(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"from";const t=this.attrString(e),n=(0,a.interpretAndValidateJid)(t);return"unknown"===n.jidType?u.WapJid.create(null,t):(0,d.JID)((0,a.extractFromJid)(n))}attrLongInt(e){const t=this.attrString(e);return(0,o.decimalStringToLongInt)(t)}attrTime(e){return(0,c.castToUnixTime)(this.attrInt(e))}attrFutureTime(e){const t=this.attrInt(e);return(0,c.futureUnixTime)(t)}contentString(){if(this.hasChildren())return this.throw("to have string content, but has children instead");if(this.hasContent()){const e=new i.Binary(this.contentBytes());return e.readString(e.size())}return this.throw("to have content")}decodeAsString(e){return(0,d.decodeAsString)(e)}contentSerializedPubKey(){return this.hasContent()?(0,l.serializeIdentity)(this.contentBytes()):this.throw("to have content")}throw(e){throw new p(this.name(),`expected <${this.tag()}> ${e}`)}}t.ParsableWapNode=f},37329:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseIqResponse=function(e,t,n){const o=e.content;if(o&&Array.isArray(o)&&o[0]){const t=o[0];if("error"===t.tag){const o=t.attrs||{};let s;n&&(s=n instanceof i.WapParser?n.parseOrThrow(t):n(e));const l=s;return{success:!1,errorCode:parseInt(o.code,10),errorText:(0,r.decodeAsString)(o.text)||"",errorType:(0,r.decodeAsString)(o.type)||"",errorBackoff:parseInt(o.backoff,10),toString:a,customError:l}}}return t instanceof i.WapParser?{success:!0,result:t.parseOrThrow(e)}:{success:!0,result:t(e)}};var r=n(31914),i=n(71914);function a(){return`IqError ${this.errorCode}: ${this.errorText}`}},31914:(e,t,n)=>{"use strict";var r=n(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.BIG_ENDIAN_CONTENT=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,n=e;const r=new Uint8Array(t);for(let e=t-1;e>=0;e--)r[e]=255&n,n>>>=8;return r},t.BROADCAST_JID=function(e){return W(e)},t.CALL_JID=function(e){return W(e)},t.CUSTOM_STRING=function(e){return e},t.DEVICE_JID=function(e){return W(e)},t.DROP_ATTR=void 0,t.GROUP_JID=function(e){return W(e)},t.G_US=void 0,t.INT=function(e){return e.toString()},t.JID=W,t.LONG_INT=function(e){return(0,o.longIntToDecimalString)(e)},t.MAYBE_CUSTOM_STRING=function(e){if(null==e)return S;return e},t.PARTICIPANT_JID=function(e){return"status"===e.type||"group"===e.type||"broadcast"===e.type?W(e.author):S},t.S_WHATSAPP_NET=t.STATUS_BROADCAST=void 0,t.TO_JID=function(e){return W(K(e))},t.TO_WAP_JID=function(e){return"phoneDevice"===e.jidType||"msgrDevice"===e.jidType||"lidDevice"===e.jidType?W(e.deviceJid):"phoneUser"===e.jidType||"msgrUser"===e.jidType||"lidUser"===e.jidType?W(e.userJid):"group"===e.jidType?W(e.groupJid):"status"===e.jidType?W(e.statusJid):"call"===e.jidType?W(e.callJid):(e.jidType,W(e.broadcastJid))},t.USER_JID=function(e){return W(e)},t.WapNode=void 0,t.decodeAsString=function(e){if(e instanceof l.WapJid)return e.toString();return e},t.decodeStanza=function(e,t){const n=new i.Binary(e);if(2&n.readUint8())return __LOG__(2)`Decoding compressed stanza`,t(n.readByteArray()).then((e=>B(new i.Binary(e))));return Promise.resolve(B(n))},t.encodeStanza=function(e){const t=e instanceof A?e:O(e),n=new i.Binary;I(t,n);const r=n.readByteArray(),a=new Uint8Array(1+r.length);return a[0]=0,a.set(r,1),a},t.extractParticipantJid=function(e){switch(e.type){case"group":case"status":case"broadcast":return e.author;default:return e.type,null}},t.extractToJid=K,t.generateId=function(){if(!y){const e=new Uint16Array(2);self.crypto.getRandomValues(e),y=`${String(e[0])}.${String(e[1])}-`}return`${y}${E++}`},t.makeStanza=O,t.makeWapNode=P,t.wap=void 0;var i=n(8584),a=n(52230),o=n(8243),s=n(27498),l=n(45506),c=(r(n(17890)),n(74277));const d=a.MSGR_USER_DOMAIN.replace("@",""),u=a.WA_USER_DOMAIN.replace("@",""),p=a.LID_DOMAIN.replace("@",""),f=[236,237,238,239],h=248,_=249,g=["0","1","2","3","4","5","6","7","8","9","-",".","","","",""],m=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"];let y="",E=1;const S={sentinel:"DROP_ATTR"};t.DROP_ATTR=S;const v=l.WapJid.create(null,"g.us");t.G_US=v;const T=l.WapJid.create(null,a.WA_SERVER_DOMAIN);t.S_WHATSAPP_NET=T;const b=l.WapJid.create("status","broadcast");t.STATUS_BROADCAST=b;const C={};class A{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:C,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.tag=e,this.attrs=t,this.content=n}toString(){let e="<"+this.tag;e+=(0,c.attrsToString)(this.attrs);const t=this.content;return Array.isArray(t)?e+=`>${t.map(String).join("")}</${this.tag}>`:e+=t?`>${(0,c.uint8ArrayToDebugString)(t)}</${this.tag}>`:" />",e}}function P(e,t,n){let r=null;if(t&&null!=t.children)throw new Error('Children should not be passed via props (see eslint check "react/no-children-props")');if(Array.isArray(n))r=n.filter(Boolean);else if("string"==typeof n)r=i.Binary.build(n).readByteArray();else if(n instanceof ArrayBuffer)r=new Uint8Array(n);else if(n instanceof Uint8Array)r=n;else{const e=[];for(let t=2;t<arguments.length;t++){const n=arguments[t];n&&e.push(n)}r=e}Array.isArray(r)&&0===r.length&&(r=null);const a={};if(t){const n=t;Object.keys(n).forEach((t=>{const r=n[t];if(null==r)throw new Error(`Attr ${t} in <${e}> is null`);r!==S&&(a[t]=r)}))}return new A(e,a,r)}t.WapNode=A;const M=P;function O(e){let t=e.content;return Array.isArray(t)?t=t.map(O):"string"==typeof t&&(t=i.Binary.build(t).readByteArray()),new A(e.tag,e.attrs||C,t)}function I(e,t){if(null==e)t.writeUint8(0);else if(e instanceof A)w(e,t);else if(e instanceof l.WapJid)!function(e,t){const n=e.getInnerJid();if(n.type===l.WAP_JID_SUBTYPE.JID_AD){const{user:e,agent:r,device:i}=n;t.writeUint8(247),t.writeUint8(r),t.writeUint8(i),I(e,t)}else if(n.type===l.WAP_JID_SUBTYPE.JID_FB){const{user:e,device:r}=n;t.writeUint8(246),I(e,t),t.writeUint16(r),I(u,t)}else{const{user:e,server:r}=n;t.writeUint8(250),null!=e?I(e,t):t.writeUint8(0),I(r,t)}}(e,t);else if("string"==typeof e)N(e,t);else{if(!(e instanceof Uint8Array))throw new Error("Invalid payload type "+typeof e);!function(e,t){U(e.length,t),t.writeByteArray(e)}(e,t)}}function w(e,t){if(void 0===e.tag)return t.writeUint8(h),void t.writeUint8(0);let n=1;e.attrs&&(n+=2*Object.keys(e.attrs).length),e.content&&n++,n<256?(t.writeUint8(h),t.writeUint8(n)):n<65536&&(t.writeUint8(_),t.writeUint16(n)),I(e.tag,t),e.attrs&&Object.keys(e.attrs).forEach((n=>{N(n,t),I(e.attrs[n],t)}));const r=e.content;if(Array.isArray(r)){r.length<256?(t.writeUint8(h),t.writeUint8(r.length)):r.length<65536&&(t.writeUint8(_),t.writeUint16(r.length));for(let e=0;e<r.length;e++)w(r[e],t)}else r&&I(r,t)}let R,D;function L(e){const t=new Map;for(let n=0;n<e.length;n++)t.set(e[n],n);return t}function N(e,t){if(""===e)return t.writeUint8(252),void t.writeUint8(0);null==R&&(R=L(s.SINGLE_BYTE_TOKEN));const n=R.get(e);if(null!=n)return void t.writeUint8(n+1);if(null==D){D=[];for(let e=0;e<s.DICTIONARIES.length;++e)D.push(L(s.DICTIONARIES[e]))}for(let n=0;n<D.length;++n){const r=D[n].get(e);if(null!=r)return t.writeUint8(f[n]),void t.writeUint8(r)}const r=(0,i.numUtf8Bytes)(e);if(r<128){if(!/[^0-9.-]+?/.exec(e))return void k(e,255,t);if(!/[^0-9A-F]+?/.exec(e))return void k(e,251,t)}U(r,t),t.writeString(e)}function k(e,t,n){const r=e.length%2==1;n.writeUint8(t);let i=Math.ceil(e.length/2);r&&(i|=128),n.writeUint8(i);let a=0;for(let r=0;r<e.length;r++){const i=e.charCodeAt(r);let o=null;if(48<=i&&i<=57?o=i-48:255===t?45===i?o=10:46===i&&(o=11):251===t&&65<=i&&i<=70&&(o=i-55),null==o)throw new Error(`Cannot nibble encode ${i}`);r%2==0?(a=o<<4,r===e.length-1&&(a|=15,n.writeUint8(a))):(a|=o,n.writeUint8(a))}}function U(e,t){if(e<256)t.writeUint8(252),t.writeUint8(e);else if(e<1048576)t.writeUint8(253),t.writeUint8(e>>>16&255),t.writeUint8(e>>>8&255),t.writeUint8(255&e);else{if(!(e<4294967296))throw new Error(`Binary with length ${e} is too big for WAP protocol`);t.writeUint8(254),t.writeUint32(e)}}function G(e,t){const n=e.readUint8();if(0===n)return null;if(n===h)return x(e,e.readUint8());if(n===_)return x(e,e.readUint16());if(252===n){const n=e.readUint8();return j(e,n,t)}if(253===n){const n=e.readUint8(),r=e.readUint8(),i=e.readUint8();return j(e,((15&n)<<16)+(r<<8)+i,t)}if(254===n){const n=e.readUint32();return j(e,n,t)}if(250===n)return function(e){const t=function(e){const t=G(e,!0);if(null!=t&&"string"!=typeof t)throw new Error(`Decode string got invalid value ${String(t)}, string expected`);return t}(e),n=F(e);return l.WapJid.create(t,n)}(e);if(246===n)return function(e){const t=F(e),n=e.readUint16();return F(e),l.WapJid.createFbJid(t,n)}(e);if(247===n)return function(e){const t=e.readUint8(),n=e.readUint8(),r=F(e);return l.WapJid.createAD(r,t,n)}(e);if(255===n){const t=e.readUint8();return Y(e,g,t>>>7,127&t)}if(251===n){const t=e.readUint8();return Y(e,m,t>>>7,127&t)}if(n<=0||n>=240)throw new Error("Unable to decode WAP buffer");if(n>=236&&n<=239){const t=n-236,r=s.DICTIONARIES[t];if(void 0===r)throw new Error(`Missing WAP dictionary ${t}`);const i=e.readUint8(),a=r[i];if(void 0===a)throw new Error(`Invalid value index ${i} in dict ${t}`);return a}const r=s.SINGLE_BYTE_TOKEN[n-1];if(void 0===r)throw new Error(`Undefined token with index ${n}`);return r}function x(e,t){const n=[];for(let r=0;r<t;r++)n.push(B(e));return n}function B(e){const t=e.readUint8();let n,r;if(t===h)n=e.readUint8();else{if(t!==_)throw new Error(`Failed to decode node since type byte ${String(t)} is invalid`);n=e.readUint16()}let i=null;if(0===n)throw new Error("Failed to decode node, list cannot be empty");const a=F(e);for(n-=1;n>1;){r||(r={});const t=F(e),i=G(e,!0);r[t]=i,n-=2}return 1===n&&(i=G(e,!1),i instanceof l.WapJid&&(i=String(i))),new A(a,r,i)}function F(e){const t=G(e,!0);if("string"!=typeof t)throw new Error(`Decode string got invalid value ${String(t)}, string expected`);return t}function j(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return n?e.readString(t):e.readByteArray(t)}function Y(e,t,n,r){const i=new Array(2*r-n);for(let n=0;n<i.length-1;n+=2){const r=e.readUint8();i[n]=t[r>>>4],i[n+1]=t[15&r]}if(n){const n=e.readUint8();i[i.length-1]=t[n>>>4]}return i.join("")}function K(e){switch(e.type){case"group":return e.groupJid;case"status":return a.STATUS_JID;case"device":return e.deviceJid;default:return e.type,e.broadcastJid}}function W(e){let[t,n]=e.split("@"),r=null,i=null;return n!==u&&n!==d&&n!==p||(-1!==t.indexOf(":")&&([t,i]=t.split(":"),i=parseInt(i,10)),-1!==t.indexOf(".")&&([t,r]=t.split("."),r=parseInt(r,10))),n===d?l.WapJid.createFbJid(t,i):null!=i&&0!==i||null!=r&&0!==r?l.WapJid.createAD(t,r,i):l.WapJid.create(t,n)}t.wap=M},27498:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SINGLE_BYTE_TOKEN=t.DICT_VERSION=t.DICTIONARY_3_TOKEN=t.DICTIONARY_2_TOKEN=t.DICTIONARY_1_TOKEN=t.DICTIONARY_0_TOKEN=t.DICTIONARIES=void 0;t.DICT_VERSION=2;t.SINGLE_BYTE_TOKEN=["xmlstreamstart","xmlstreamend","s.whatsapp.net","type","participant","from","receipt","id","broadcast","status","message","notification","notify","to","jid","user","class","offline","g.us","result","mediatype","enc","skmsg","off_cnt","xmlns","presence","participants","ack","t","iq","device_hash","read","value","media","picture","chatstate","unavailable","text","urn:xmpp:whatsapp:push","devices","verified_name","contact","composing","edge_routing","routing_info","item","image","verified_level","get","fallback_hostname","2","media_conn","1","v","handshake","fallback_class","count","config","offline_preview","download_buckets","w:profile:picture","set","creation","location","fallback_ip4","msg","urn:xmpp:ping","fallback_ip6","call-creator","relaylatency","success","subscribe","video","business_hours_config","platform","hostname","version","unknown","0","ping","hash","edit","subject","max_buckets","download","delivery","props","sticker","name","last","contacts","business","primary","preview","w:p","pkmsg","call-id","retry","prop","call","auth_ttl","available","relay_id","last_id","day_of_week","w","host","seen","bits","list","atn","upload","is_new","w:stats","key","paused","specific_hours","multicast","stream:error","mmg.whatsapp.net","code","deny","played","profile","fna","device-list","close_time","latency","gcm","pop","audio","26","w:web","open_time","error","auth","ip4","update","profile_options","config_value","category","catalog_not_created","00","config_code","mode","catalog_status","ip6","blocklist","registration","7","web","fail","w:m","cart_enabled","ttl","gif","300","device_orientation","identity","query","401","media-gig2-1.cdn.whatsapp.net","in","3","te2","add","fallback","categories","ptt","encrypt","notice","thumbnail-document","item-not-found","12","thumbnail-image","stage","thumbnail-link","usync","out","thumbnail-video","8","01","context","sidelist","thumbnail-gif","terminate","not-authorized","orientation","dhash","capability","side_list","md-app-state","description","serial","readreceipts","te","business_hours","md-msg-hist","tag","attribute_padding","document","open_24h","delete","expiration","active","prev_v_id","true","passive","index","4","conflict","remove","w:gp2","config_expo_key","screen_height","replaced","02","screen_width","uploadfieldstat","2:47DEQpj8","media-bog1-1.cdn.whatsapp.net","encopt","url","catalog_exists","keygen","rate","offer","opus","media-mia3-1.cdn.whatsapp.net","privacy","media-mia3-2.cdn.whatsapp.net","signature","preaccept","token_id","media-eze1-1.cdn.whatsapp.net"];const n=["media-for1-1.cdn.whatsapp.net","relay","media-gru2-2.cdn.whatsapp.net","uncompressed","medium","voip_settings","device","reason","media-lim1-1.cdn.whatsapp.net","media-qro1-2.cdn.whatsapp.net","media-gru1-2.cdn.whatsapp.net","action","features","media-gru2-1.cdn.whatsapp.net","media-gru1-1.cdn.whatsapp.net","media-otp1-1.cdn.whatsapp.net","kyc-id","priority","phash","mute","token","100","media-qro1-1.cdn.whatsapp.net","none","media-mrs2-2.cdn.whatsapp.net","sign_credential","03","media-mrs2-1.cdn.whatsapp.net","protocol","timezone","transport","eph_setting","1080","original_dimensions","media-frx5-1.cdn.whatsapp.net","background","disable","original_image_url","5","transaction-id","direct_path","103","appointment_only","request_image_url","peer_pid","address","105","104","102","media-cdt1-1.cdn.whatsapp.net","101","109","110","106","background_location","v_id","sync","status-old","111","107","ppic","media-scl2-1.cdn.whatsapp.net","business_profile","108","invite","04","audio_duration","media-mct1-1.cdn.whatsapp.net","media-cdg2-1.cdn.whatsapp.net","media-los2-1.cdn.whatsapp.net","invis","net","voip_payload_type","status-revoke-delay","404","state","use_correct_order_for_hmac_sha1","ver","media-mad1-1.cdn.whatsapp.net","order","540","skey","blinded_credential","android","contact_remove","enable_downlink_relay_latency_only","duration","enable_vid_one_way_codec_nego","6","media-sof1-1.cdn.whatsapp.net","accept","all","signed_credential","media-atl3-1.cdn.whatsapp.net","media-lhr8-1.cdn.whatsapp.net","website","05","latitude","media-dfw5-1.cdn.whatsapp.net","forbidden","enable_audio_piggyback_network_mtu_fix","media-dfw5-2.cdn.whatsapp.net","note.m4r","media-atl3-2.cdn.whatsapp.net","jb_nack_discard_count_fix","longitude","Opening.m4r","media-arn2-1.cdn.whatsapp.net","email","timestamp","admin","media-pmo1-1.cdn.whatsapp.net","America/Sao_Paulo","contact_add","media-sin6-1.cdn.whatsapp.net","interactive","8000","acs_public_key","sigquit_anr_detector_release_rollover_percent","media.fmed1-2.fna.whatsapp.net","groupadd","enabled_for_video_upgrade","latency_update_threshold","media-frt3-2.cdn.whatsapp.net","calls_row_constraint_layout","media.fgbb2-1.fna.whatsapp.net","mms4_media_retry_notification_encryption_enabled","timeout","media-sin6-3.cdn.whatsapp.net","audio_nack_jitter_multiplier","jb_discard_count_adjust_pct_rc","audio_reserve_bps","delta","account_sync","default","media.fjed4-6.fna.whatsapp.net","06","lock_video_orientation","media-frt3-1.cdn.whatsapp.net","w:g2","media-sin6-2.cdn.whatsapp.net","audio_nack_algo_mask","media.fgbb2-2.fna.whatsapp.net","media.fmed1-1.fna.whatsapp.net","cond_range_target_bitrate","mms4_server_error_receipt_encryption_enabled","vid_rc_dyn","fri","cart_v1_1_order_message_changes_enabled","reg_push","jb_hist_deposit_value","privatestats","media.fist7-2.fna.whatsapp.net","thu","jb_discard_count_adjust_pct","mon","group_call_video_maximization_enabled","mms_cat_v1_forward_hot_override_enabled","audio_nack_new_rtt","media.fsub2-3.fna.whatsapp.net","media_upload_aggressive_retry_exponential_backoff_enabled","tue","wed","media.fruh4-2.fna.whatsapp.net","audio_nack_max_seq_req","max_rtp_audio_packet_resends","jb_hist_max_cdf_value","07","audio_nack_max_jb_delay","mms_forward_partially_downloaded_video","media-lcy1-1.cdn.whatsapp.net","resume","jb_inband_fec_aware","new_commerce_entry_point_enabled","480","payments_upi_generate_qr_amount_limit","sigquit_anr_detector_rollover_percent","media.fsdu2-1.fna.whatsapp.net","fbns","aud_pkt_reorder_pct","dec","stop_probing_before_accept_send","media_upload_max_aggressive_retries","edit_business_profile_new_mode_enabled","media.fhex4-1.fna.whatsapp.net","media.fjed4-3.fna.whatsapp.net","sigquit_anr_detector_64bit_rollover_percent","cond_range_ema_jb_last_delay","watls_enable_early_data_http_get","media.fsdu2-2.fna.whatsapp.net","message_qr_disambiguation_enabled","media-mxp1-1.cdn.whatsapp.net","sat","vertical","media.fruh4-5.fna.whatsapp.net","200","media-sof1-2.cdn.whatsapp.net","-1","height","product_catalog_hide_show_items_enabled","deep_copy_frm_last","tsoffline","vp8/h.264","media.fgye5-3.fna.whatsapp.net","media.ftuc1-2.fna.whatsapp.net","smb_upsell_chat_banner_enabled","canonical","08","9",".","media.fgyd4-4.fna.whatsapp.net","media.fsti4-1.fna.whatsapp.net","mms_vcache_aggregation_enabled","mms_hot_content_timespan_in_seconds","nse_ver","rte","third_party_sticker_web_sync","cond_range_target_total_bitrate","media_upload_aggressive_retry_enabled","instrument_spam_report_enabled","disable_reconnect_tone","move_media_folder_from_sister_app","one_tap_calling_in_group_chat_size","10","storage_mgmt_banner_threshold_mb","enable_backup_passive_mode","sharechat_inline_player_enabled","media.fcnq2-1.fna.whatsapp.net","media.fhex4-2.fna.whatsapp.net","media.fist6-3.fna.whatsapp.net","ephemeral_drop_column_stage","reconnecting_after_network_change_threshold_ms","media-lhr8-2.cdn.whatsapp.net","cond_jb_last_delay_ema_alpha","entry_point_block_logging_enabled","critical_event_upload_log_config","respect_initial_bitrate_estimate","smaller_image_thumbs_status_enabled","media.fbtz1-4.fna.whatsapp.net","media.fjed4-1.fna.whatsapp.net","width","720","enable_frame_dropper","enable_one_side_mode","urn:xmpp:whatsapp:dirty","new_sticker_animation_behavior_v2","media.flim3-2.fna.whatsapp.net","media.fuio6-2.fna.whatsapp.net","skip_forced_signaling","dleq_proof","status_video_max_bitrate","lazy_send_probing_req","enhanced_storage_management","android_privatestats_endpoint_dit_enabled","media.fscl13-2.fna.whatsapp.net","video_duration"];t.DICTIONARY_0_TOKEN=n;const r=["group_call_discoverability_enabled","media.faep9-2.fna.whatsapp.net","msgr","bloks_loggedin_access_app_id","db_status_migration_step","watls_prefer_ip6","jabber:iq:privacy","68","media.fsaw1-11.fna.whatsapp.net","mms4_media_conn_persist_enabled","animated_stickers_thread_clean_up","media.fcgk3-2.fna.whatsapp.net","media.fcgk4-6.fna.whatsapp.net","media.fgye5-2.fna.whatsapp.net","media.flpb1-1.fna.whatsapp.net","media.fsub2-1.fna.whatsapp.net","media.fuio6-3.fna.whatsapp.net","not-allowed","partial_pjpeg_bw_threshold","cap_estimated_bitrate","mms_chatd_resume_check_over_thrift","smb_upsell_business_profile_enabled","product_catalog_webclient","groups","sigquit_anr_detector_release_updated_rollout","syncd_key_rotation_enabled","media.fdmm2-1.fna.whatsapp.net","media-hou1-1.cdn.whatsapp.net","remove_old_chat_notifications","smb_biztools_deeplink_enabled","use_downloadable_filters_int","group_qr_codes_enabled","max_receipt_processing_time","optimistic_image_processing_enabled","smaller_video_thumbs_status_enabled","watls_early_data","reconnecting_before_relay_failover_threshold_ms","cond_range_packet_loss_pct","groups_privacy_blacklist","status-revoke-drop","stickers_animated_thumbnail_download","dedupe_transcode_shared_images","dedupe_transcode_shared_videos","media.fcnq2-2.fna.whatsapp.net","media.fgyd4-1.fna.whatsapp.net","media.fist7-1.fna.whatsapp.net","media.flim3-3.fna.whatsapp.net","add_contact_by_qr_enabled","https://faq.whatsapp.com/payments","multicast_limit_global","sticker_notification_preview","smb_better_catalog_list_adapters_enabled","bloks_use_minscript_android","pen_smoothing_enabled","media.fcgk4-5.fna.whatsapp.net","media.fevn1-3.fna.whatsapp.net","media.fpoj7-1.fna.whatsapp.net","media-arn2-2.cdn.whatsapp.net","reconnecting_before_network_change_threshold_ms","android_media_use_fresco_for_gifs","cond_in_congestion","status_image_max_edge","sticker_search_enabled","starred_stickers_web_sync","db_blank_me_jid_migration_step","media.fist6-2.fna.whatsapp.net","media.ftuc1-1.fna.whatsapp.net","09","anr_fast_logs_upload_rollout","camera_core_integration_enabled","11","third_party_sticker_caching","thread_dump_contact_support","wam_privatestats_enabled","vcard_as_document_size_kb","maxfpp","fbip","ephemeral_allow_group_members","media-bom1-2.cdn.whatsapp.net","media-xsp1-1.cdn.whatsapp.net","disable_prewarm","frequently_forwarded_max","media.fbtz1-5.fna.whatsapp.net","media.fevn7-1.fna.whatsapp.net","media.fgyd4-2.fna.whatsapp.net","sticker_tray_animation_fully_visible_items","green_alert_banner_duration","reconnecting_after_p2p_failover_threshold_ms","connected","share_biz_vcard_enabled","stickers_animation","0a","1200","WhatsApp","group_description_length","p_v_id","payments_upi_intent_transaction_limit","frequently_forwarded_messages","media-xsp1-2.cdn.whatsapp.net","media.faep8-1.fna.whatsapp.net","media.faep8-2.fna.whatsapp.net","media.faep9-1.fna.whatsapp.net","media.fdmm2-2.fna.whatsapp.net","media.fgzt3-1.fna.whatsapp.net","media.flim4-2.fna.whatsapp.net","media.frao1-1.fna.whatsapp.net","media.fscl9-2.fna.whatsapp.net","media.fsub2-2.fna.whatsapp.net","superadmin","media.fbog10-1.fna.whatsapp.net","media.fcgh28-1.fna.whatsapp.net","media.fjdo10-1.fna.whatsapp.net","third_party_animated_sticker_import","delay_fec","attachment_picker_refresh","android_linked_devices_re_auth_enabled","rc_dyn","green_alert_block_jitter","add_contact_logging_enabled","biz_message_logging_enabled","conversation_media_preview_v2","media-jnb1-1.cdn.whatsapp.net","ab_key","media.fcgk4-2.fna.whatsapp.net","media.fevn1-1.fna.whatsapp.net","media.fist6-1.fna.whatsapp.net","media.fruh4-4.fna.whatsapp.net","media.fsti4-2.fna.whatsapp.net","mms_vcard_autodownload_size_kb","watls_enabled","notif_ch_override_off","media.fsaw1-14.fna.whatsapp.net","media.fscl13-1.fna.whatsapp.net","db_group_participant_migration_step","1020","cond_range_sterm_rtt","invites_logging_enabled","triggered_block_enabled","group_call_max_participants","media-iad3-1.cdn.whatsapp.net","product_catalog_open_deeplink","shops_required_tos_version","image_max_kbytes","cond_low_quality_vid_mode","db_receipt_migration_step","jb_early_prob_hist_shrink","media.fdmm2-3.fna.whatsapp.net","media.fdmm2-4.fna.whatsapp.net","media.fruh4-1.fna.whatsapp.net","media.fsaw2-2.fna.whatsapp.net","remove_geolocation_videos","new_animation_behavior","fieldstats_beacon_chance","403","authkey_reset_on_ban","continuous_ptt_playback","reconnecting_after_relay_failover_threshold_ms","false","group","sun","conversation_swipe_to_reply","ephemeral_messages_setting","smaller_video_thumbs_enabled","md_device_sync_enabled","bloks_shops_pdp_url_regex","lasso_integration_enabled","media-bom1-1.cdn.whatsapp.net","new_backup_format_enabled","256","media.faep6-1.fna.whatsapp.net","media.fasr1-1.fna.whatsapp.net","media.fbtz1-7.fna.whatsapp.net","media.fesb4-1.fna.whatsapp.net","media.fjdo1-2.fna.whatsapp.net","media.frba2-1.fna.whatsapp.net","watls_no_dns","600","db_broadcast_me_jid_migration_step","new_wam_runtime_enabled","group_update","enhanced_block_enabled","sync_wifi_threshold_kb","mms_download_nc_cat","bloks_minification_enabled","ephemeral_messages_enabled","reject","voip_outgoing_xml_signaling","creator","dl_bw","payments_request_messages","target_bitrate","bloks_rendercore_enabled","media-hbe1-1.cdn.whatsapp.net","media-hel3-1.cdn.whatsapp.net","media-kut2-2.cdn.whatsapp.net","media-lax3-1.cdn.whatsapp.net","media-lax3-2.cdn.whatsapp.net","sticker_pack_deeplink_enabled","hq_image_bw_threshold","status_info","voip","dedupe_transcode_videos","grp_uii_cleanup","linked_device_max_count","media.flim1-1.fna.whatsapp.net","media.fsaw2-1.fna.whatsapp.net","reconnecting_after_call_active_threshold_ms","1140","catalog_pdp_new_design","media.fbtz1-10.fna.whatsapp.net","media.fsaw1-15.fna.whatsapp.net","0b","consumer_rc_provider","mms_async_fast_forward_ttl","jb_eff_size_fix","voip_incoming_xml_signaling","media_provider_share_by_uuid","suspicious_links","dedupe_transcode_images","green_alert_modal_start","media-cgk1-1.cdn.whatsapp.net","media-lga3-1.cdn.whatsapp.net","template_doc_mime_types","important_messages","user_add","vcard_max_size_kb","media.fada2-1.fna.whatsapp.net","media.fbog2-5.fna.whatsapp.net","media.fbtz1-3.fna.whatsapp.net","media.fcgk3-1.fna.whatsapp.net","media.fcgk7-1.fna.whatsapp.net","media.flim1-3.fna.whatsapp.net","media.fscl9-1.fna.whatsapp.net","ctwa_context_enterprise_enabled","media.fsaw1-13.fna.whatsapp.net","media.fuio11-2.fna.whatsapp.net","status_collapse_muted","db_migration_level_force","recent_stickers_web_sync","bloks_session_state","bloks_shops_enabled","green_alert_setting_deep_links_enabled","restrict_groups","battery","green_alert_block_start","refresh","ctwa_context_enabled","md_messaging_enabled","status_image_quality","md_blocklist_v2_server","media-del1-1.cdn.whatsapp.net","13","userrate","a_v_id","cond_rtt_ema_alpha","invalid"];t.DICTIONARY_1_TOKEN=r;const i=["media.fada1-1.fna.whatsapp.net","media.fadb3-2.fna.whatsapp.net","media.fbhz2-1.fna.whatsapp.net","media.fcor2-1.fna.whatsapp.net","media.fjed4-2.fna.whatsapp.net","media.flhe4-1.fna.whatsapp.net","media.frak1-2.fna.whatsapp.net","media.fsub6-3.fna.whatsapp.net","media.fsub6-7.fna.whatsapp.net","media.fvvi1-1.fna.whatsapp.net","search_v5_eligible","wam_real_time_enabled","report_disk_event","max_tx_rott_based_bitrate","product","media.fjdo10-2.fna.whatsapp.net","video_frame_crc_sample_interval","media_max_autodownload","15","h.264","wam_privatestats_buffer_count","md_phash_v2_enabled","account_transfer_enabled","business_product_catalog","enable_non_dyn_codec_param_fix","is_user_under_epd_jurisdiction","media.fbog2-4.fna.whatsapp.net","media.fbtz1-2.fna.whatsapp.net","media.fcfc1-1.fna.whatsapp.net","media.fjed4-5.fna.whatsapp.net","media.flhe4-2.fna.whatsapp.net","media.flim1-2.fna.whatsapp.net","media.flos5-1.fna.whatsapp.net","android_key_store_auth_ver","010","anr_process_monitor","delete_old_auth_key","media.fcor10-3.fna.whatsapp.net","storage_usage_enabled","android_camera2_support_level","dirty","consumer_content_provider","status_video_max_duration","0c","bloks_cache_enabled","media.fadb2-2.fna.whatsapp.net","media.fbko1-1.fna.whatsapp.net","media.fbtz1-9.fna.whatsapp.net","media.fcgk4-4.fna.whatsapp.net","media.fesb4-2.fna.whatsapp.net","media.fevn1-2.fna.whatsapp.net","media.fist2-4.fna.whatsapp.net","media.fjdo1-1.fna.whatsapp.net","media.fruh4-6.fna.whatsapp.net","media.fsrg5-1.fna.whatsapp.net","media.fsub6-6.fna.whatsapp.net","minfpp","5000","locales","video_max_bitrate","use_new_auth_key","bloks_http_enabled","heartbeat_interval","media.fbog11-1.fna.whatsapp.net","ephemeral_group_query_ts","fec_nack","search_in_storage_usage","c","media-amt2-1.cdn.whatsapp.net","linked_devices_ui_enabled","14","async_data_load_on_startup","voip_incoming_xml_ack","16","db_migration_step","init_bwe","max_participants","wam_buffer_count","media.fada2-2.fna.whatsapp.net","media.fadb3-1.fna.whatsapp.net","media.fcor2-2.fna.whatsapp.net","media.fdiy1-2.fna.whatsapp.net","media.frba3-2.fna.whatsapp.net","media.fsaw2-3.fna.whatsapp.net","1280","status_grid_enabled","w:biz","product_catalog_deeplink","media.fgye10-2.fna.whatsapp.net","media.fuio11-1.fna.whatsapp.net","optimistic_upload","work_manager_init","lc","catalog_message","cond_net_medium","enable_periodical_aud_rr_processing","cond_range_ema_rtt","media-tir2-1.cdn.whatsapp.net","frame_ms","group_invite_sending","payments_web_enabled","wallpapers_v2","0d","browser","hq_image_max_edge","image_edit_zoom","linked_devices_re_auth_enabled","media.faly3-2.fna.whatsapp.net","media.fdoh5-3.fna.whatsapp.net","media.fesb3-1.fna.whatsapp.net","media.fknu1-1.fna.whatsapp.net","media.fmex3-1.fna.whatsapp.net","media.fruh4-3.fna.whatsapp.net","255","web_upgrade_to_md_modal","audio_piggyback_timeout_msec","enable_audio_oob_fec_feature","from_ip","image_max_edge","message_qr_enabled","powersave","receipt_pre_acking","video_max_edge","full","011","012","enable_audio_oob_fec_for_sender","md_voip_enabled","enable_privatestats","max_fec_ratio","payments_cs_faq_url","media-xsp1-3.cdn.whatsapp.net","hq_image_quality","media.fasr1-2.fna.whatsapp.net","media.fbog3-1.fna.whatsapp.net","media.ffjr1-6.fna.whatsapp.net","media.fist2-3.fna.whatsapp.net","media.flim4-3.fna.whatsapp.net","media.fpbc2-4.fna.whatsapp.net","media.fpku1-1.fna.whatsapp.net","media.frba1-1.fna.whatsapp.net","media.fudi1-1.fna.whatsapp.net","media.fvvi1-2.fna.whatsapp.net","gcm_fg_service","enable_dec_ltr_size_check","clear","lg","media.fgru11-1.fna.whatsapp.net","18","media-lga3-2.cdn.whatsapp.net","pkey","0e","max_subject","cond_range_lterm_rtt","announcement_groups","biz_profile_options","s_t","media.fabv2-1.fna.whatsapp.net","media.fcai3-1.fna.whatsapp.net","media.fcgh1-1.fna.whatsapp.net","media.fctg1-4.fna.whatsapp.net","media.fdiy1-1.fna.whatsapp.net","media.fisb4-1.fna.whatsapp.net","media.fpku1-2.fna.whatsapp.net","media.fros9-1.fna.whatsapp.net","status_v3_text","usync_sidelist","17","announcement","...","md_group_notification","0f","animated_pack_in_store","013","America/Mexico_City","1260","media-ams4-1.cdn.whatsapp.net","media-cgk1-2.cdn.whatsapp.net","media-cpt1-1.cdn.whatsapp.net","media-maa2-1.cdn.whatsapp.net","media.fgye10-1.fna.whatsapp.net","e","catalog_cart","hfm_string_changes","init_bitrate","packless_hsm","group_info","America/Belem","50","960","cond_range_bwe","decode","encode","media.fada1-8.fna.whatsapp.net","media.fadb1-2.fna.whatsapp.net","media.fasu6-1.fna.whatsapp.net","media.fbog4-1.fna.whatsapp.net","media.fcgk9-2.fna.whatsapp.net","media.fdoh5-2.fna.whatsapp.net","media.ffjr1-2.fna.whatsapp.net","media.fgua1-1.fna.whatsapp.net","media.fgye1-1.fna.whatsapp.net","media.fist1-4.fna.whatsapp.net","media.fpbc2-2.fna.whatsapp.net","media.fres2-1.fna.whatsapp.net","media.fsdq1-2.fna.whatsapp.net","media.fsub6-5.fna.whatsapp.net","profilo_enabled","template_hsm","use_disorder_prefetching_timer","video_codec_priority","vpx_max_qp","ptt_reduce_recording_delay","25","iphone","Windows","s_o","Africa/Lagos","abt","media-kut2-1.cdn.whatsapp.net","media-mba1-1.cdn.whatsapp.net","media-mxp1-2.cdn.whatsapp.net","md_blocklist_v2","url_text","enable_short_offset","group_join_permissions","enable_audio_piggyback_feature","image_quality","media.fcgk7-2.fna.whatsapp.net","media.fcgk8-2.fna.whatsapp.net","media.fclo7-1.fna.whatsapp.net","media.fcmn1-1.fna.whatsapp.net","media.feoh1-1.fna.whatsapp.net","media.fgyd4-3.fna.whatsapp.net","media.fjed4-4.fna.whatsapp.net","media.flim1-4.fna.whatsapp.net","media.flim2-4.fna.whatsapp.net","media.fplu6-1.fna.whatsapp.net","media.frak1-1.fna.whatsapp.net","media.fsdq1-1.fna.whatsapp.net","to_ip","015","vp8","19","21","1320","auth_key_ver","message_processing_dedup","server-error","wap4_enabled","420","014","cond_range_rtt","ptt_fast_lock_enabled","media-ort2-1.cdn.whatsapp.net","fwd_ui_start_ts"];t.DICTIONARY_2_TOKEN=i;const a=["contact_blacklist","Asia/Jakarta","media.fepa10-1.fna.whatsapp.net","media.fmex10-3.fna.whatsapp.net","disorder_prefetching_start_when_empty","America/Bogota","use_local_probing_rx_bitrate","America/Argentina/Buenos_Aires","cross_post","media.fabb1-1.fna.whatsapp.net","media.fbog4-2.fna.whatsapp.net","media.fcgk9-1.fna.whatsapp.net","media.fcmn2-1.fna.whatsapp.net","media.fdel3-1.fna.whatsapp.net","media.ffjr1-1.fna.whatsapp.net","media.fgdl5-1.fna.whatsapp.net","media.flpb1-2.fna.whatsapp.net","media.fmex2-1.fna.whatsapp.net","media.frba2-2.fna.whatsapp.net","media.fros2-2.fna.whatsapp.net","media.fruh2-1.fna.whatsapp.net","media.fybz2-2.fna.whatsapp.net","options","20","a","017","018","mute_always","user_notice","Asia/Kolkata","gif_provider","locked","media-gua1-1.cdn.whatsapp.net","piggyback_exclude_force_flush","24","media.frec39-1.fna.whatsapp.net","user_remove","file_max_size","cond_packet_loss_pct_ema_alpha","media.facc1-1.fna.whatsapp.net","media.fadb2-1.fna.whatsapp.net","media.faly3-1.fna.whatsapp.net","media.fbdo6-2.fna.whatsapp.net","media.fcmn2-2.fna.whatsapp.net","media.fctg1-3.fna.whatsapp.net","media.ffez1-2.fna.whatsapp.net","media.fist1-3.fna.whatsapp.net","media.fist2-2.fna.whatsapp.net","media.flim2-2.fna.whatsapp.net","media.fmct2-3.fna.whatsapp.net","media.fpei3-1.fna.whatsapp.net","media.frba3-1.fna.whatsapp.net","media.fsdu8-2.fna.whatsapp.net","media.fstu2-1.fna.whatsapp.net","media_type","receipt_agg","016","enable_pli_for_crc_mismatch","live","enc_rekey","frskmsg","d","media.fdel11-2.fna.whatsapp.net","proto","2250","audio_piggyback_enable_cache","skip_nack_if_ltrp_sent","mark_dtx_jb_frames","web_service_delay","7282","catalog_send_all","outgoing","360","30","LIMITED","019","audio_picker","bpv2_phase","media.fada1-7.fna.whatsapp.net","media.faep7-1.fna.whatsapp.net","media.fbko1-2.fna.whatsapp.net","media.fbni1-2.fna.whatsapp.net","media.fbtz1-1.fna.whatsapp.net","media.fbtz1-8.fna.whatsapp.net","media.fcjs3-1.fna.whatsapp.net","media.fesb3-2.fna.whatsapp.net","media.fgdl5-4.fna.whatsapp.net","media.fist2-1.fna.whatsapp.net","media.flhe2-2.fna.whatsapp.net","media.flim2-1.fna.whatsapp.net","media.fmex1-1.fna.whatsapp.net","media.fpat3-2.fna.whatsapp.net","media.fpat3-3.fna.whatsapp.net","media.fros2-1.fna.whatsapp.net","media.fsdu8-1.fna.whatsapp.net","media.fsub3-2.fna.whatsapp.net","payments_chat_plugin","cond_congestion_no_rtcp_thr","green_alert","not-a-biz","..","shops_pdp_urls_config","source","media-dus1-1.cdn.whatsapp.net","mute_video","01b","currency","max_keys","resume_check","contact_array","qr_scanning","23","b","media.fbfh15-1.fna.whatsapp.net","media.flim22-1.fna.whatsapp.net","media.fsdu11-1.fna.whatsapp.net","media.fsdu15-1.fna.whatsapp.net","Chrome","fts_version","60","media.fada1-6.fna.whatsapp.net","media.faep4-2.fna.whatsapp.net","media.fbaq5-1.fna.whatsapp.net","media.fbni1-1.fna.whatsapp.net","media.fcai3-2.fna.whatsapp.net","media.fdel3-2.fna.whatsapp.net","media.fdmm3-2.fna.whatsapp.net","media.fhex3-1.fna.whatsapp.net","media.fisb4-2.fna.whatsapp.net","media.fkhi5-2.fna.whatsapp.net","media.flos2-1.fna.whatsapp.net","media.fmct2-1.fna.whatsapp.net","media.fntr7-1.fna.whatsapp.net","media.frak3-1.fna.whatsapp.net","media.fruh5-2.fna.whatsapp.net","media.fsub6-1.fna.whatsapp.net","media.fuab1-2.fna.whatsapp.net","media.fuio1-1.fna.whatsapp.net","media.fver1-1.fna.whatsapp.net","media.fymy1-1.fna.whatsapp.net","product_catalog","1380","audio_oob_fec_max_pkts","22","254","media-ort2-2.cdn.whatsapp.net","media-sjc3-1.cdn.whatsapp.net","1600","01a","01c","405","key_frame_interval","body","media.fcgh20-1.fna.whatsapp.net","media.fesb10-2.fna.whatsapp.net","125","2000","media.fbsb1-1.fna.whatsapp.net","media.fcmn3-2.fna.whatsapp.net","media.fcpq1-1.fna.whatsapp.net","media.fdel1-2.fna.whatsapp.net","media.ffor2-1.fna.whatsapp.net","media.fgdl1-4.fna.whatsapp.net","media.fhex2-1.fna.whatsapp.net","media.fist1-2.fna.whatsapp.net","media.fjed5-2.fna.whatsapp.net","media.flim6-4.fna.whatsapp.net","media.flos2-2.fna.whatsapp.net","media.fntr6-2.fna.whatsapp.net","media.fpku3-2.fna.whatsapp.net","media.fros8-1.fna.whatsapp.net","media.fymy1-2.fna.whatsapp.net","ul_bw","ltrp_qp_offset","request","nack","dtx_delay_state_reset","timeoffline","28","01f","32","enable_ltr_pool","wa_msys_crypto","01d","58","dtx_freeze_hg_update","nack_if_rpsi_throttled","253","840","media.famd15-1.fna.whatsapp.net","media.fbog17-2.fna.whatsapp.net","media.fcai19-2.fna.whatsapp.net","media.fcai21-4.fna.whatsapp.net","media.fesb10-4.fna.whatsapp.net","media.fesb10-5.fna.whatsapp.net","media.fmaa12-1.fna.whatsapp.net","media.fmex11-3.fna.whatsapp.net","media.fpoa33-1.fna.whatsapp.net","1050","021","clean","cond_range_ema_packet_loss_pct","media.fadb6-5.fna.whatsapp.net","media.faqp4-1.fna.whatsapp.net","media.fbaq3-1.fna.whatsapp.net","media.fbel2-1.fna.whatsapp.net","media.fblr4-2.fna.whatsapp.net","media.fclo8-1.fna.whatsapp.net","media.fcoo1-2.fna.whatsapp.net","media.ffjr1-4.fna.whatsapp.net","media.ffor9-1.fna.whatsapp.net","media.fisb3-1.fna.whatsapp.net","media.fkhi2-2.fna.whatsapp.net","media.fkhi4-1.fna.whatsapp.net","media.fpbc1-2.fna.whatsapp.net","media.fruh2-2.fna.whatsapp.net","media.fruh5-1.fna.whatsapp.net","media.fsub3-1.fna.whatsapp.net","payments_transaction_limit","252","27","29","tintagel","01e","237","780","callee_updated_payload","020","257","price","025","239","payments_cs_phone_number","mediaretry","w:auth:backup:token","Glass.caf","max_bitrate","240","251","660","media.fbog16-1.fna.whatsapp.net","media.fcgh21-1.fna.whatsapp.net","media.fkul19-2.fna.whatsapp.net","media.flim21-2.fna.whatsapp.net","media.fmex10-4.fna.whatsapp.net","64","33","34","35","interruption","media.fabv3-1.fna.whatsapp.net","media.fadb6-1.fna.whatsapp.net","media.fagr1-1.fna.whatsapp.net","media.famd1-1.fna.whatsapp.net","media.famm6-1.fna.whatsapp.net","media.faqp2-3.fna.whatsapp.net"];t.DICTIONARY_3_TOKEN=a;const o=[n,r,i,a];t.DICTIONARIES=o},45506:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WapJid=t.WAP_JID_SUBTYPE=void 0;var r=n(52230);const i={JID:0,JID_AD:1,JID_FB:3};t.WAP_JID_SUBTYPE=i;class a{constructor(e){this._jid=e}static createAD(e,t,n){return new a({type:i.JID_AD,user:e,device:null==n?0:n,agent:null==t?0:t})}static createFbJid(e,t){return new a({type:i.JID_FB,user:e,device:null==t?0:t})}static create(e,t){return new a({type:i.JID,user:e,server:t})}toString(){if(this._jid.type===i.JID_AD){const{user:e,agent:t,device:n}=this._jid,i=r.WA_USER_JID_SUFFIX;return 0===t&&0===n?`${e}@${i}`:0!==t&&0===n?`${e}.${t}@${i}`:0===t&&0!==n?`${e}:${n}@${i}`:`${e}.${t}:${n}@${i}`}if(this._jid.type===i.JID_FB){const{user:e,device:t}=this._jid;return`${e}:${t}@${r.MSGR_USER_JID_SUFFIX}`}{this._jid.type;const{user:e,server:t}=this._jid;return null!=e?`${e}@${t}`:t}}getInnerJid(){return this._jid}}t.WapJid=a},71914:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WapParser=void 0;var r=n(34308);t.WapParser=class{constructor(e,t){this._name=e,this._parser=t}parse(e){const t=new r.ParsableWapNode(this._name,e);try{return{success:this._parser(t)}}catch(e){if(e instanceof r.XmppParsingFailure)return{error:e};throw e}}parseOrThrow(e){const t=this.parse(e);if(t.error)throw new Error(String(t.error));return t.success}}},61070:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MMS_MEDIA_KEY_TTL=void 0,t.isMediaKeyReusable=function(e){const t=Math.floor(Math.random()*i);return null!=e&&(0,r.happenedWithin)(e,a+t)};var r=n(92844);const i=r.DAY_SECONDS,a=2*r.DAY_SECONDS;t.MMS_MEDIA_KEY_TTL=a},2555:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SERVER_MEDIA=void 0,t.castToServerMediaType=function(e){switch(e){case"image":case"sticker":case"ptt":case"audio":case"document":case"video":case"gif":case"ppic":case"md-app-state":case"md-msg-hist":case"kyc-id":case"thumbnail-image":case"thumbnail-video":case"thumbnail-gif":case"thumbnail-document":case"thumbnail-link":case"payment-bg-image":case"novi-video":case"novi-image":case"template":case"product":case"product-catalog-image":return e;default:return null}};t.SERVER_MEDIA=["image","sticker","ptt","audio","document","video","gif","ppic","md-app-state","md-msg-hist","kyc-id","template","thumbnail-image","thumbnail-video","thumbnail-gif","thumbnail-document","thumbnail-link","payment-bg-image","novi-video","novi-image","product","product-catalog-image"]},71610:(e,t)=>{"use strict";function n(e){return 16*parseInt((e+15)/16,10)}Object.defineProperty(t,"__esModule",{value:!0}),t.alignChunkLengthsToMultipleOfAesBlockSize=function(e,t){const r=[];let i=0,a=0,o=0;for(let s=0;s<e.length;++s){if(i+=e[s],s===e.length-1&&null!=t){i>a?r.push(t-a):(r.pop(),r.push(t-o));break}if(i>a){const e=n(i-a);o=a,r.push(e),a+=e}}return r},t.alignChunkSizeToMultipleAesBlockSize=n},17525:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SocketClosed=t.FrameSocket=void 0;var r=n(8584);class i extends Error{constructor(e){const t="SocketClosed";super(null!=e?e:t),this.name=t}}t.SocketClosed=i;function a(e){if(e.size()<3)return!1;return o(e)<=e.size()}function o(e){return e.readUint8()<<16|e.readUint16()}t.FrameSocket=class{constructor(e,t){this._incoming=new r.Binary,this.closed=!1,this._draining=!1,this.onFrame=null,this.onClose=null,this._handleData=e=>{this._incoming.writeByteArray(e),this.convertBufferedToFrames()},this._handleClose=()=>{if(this._incoming.peek(a))return __LOG__(2)`FrameSocket closed, waiting for pending processing`,void(this._draining=!0);this._doClose()},this._doClose=()=>{if(this.closed)return;__LOG__(2)`FrameSocket closed`,this._draining=!1,this.closed=!0;const e=this.onClose;e&&e()},this._handleError=e=>{__LOG__(4,void 0,new Error)`FrameSocket error ${e}`},this._introToSend=t,this._socket=e,e.onData=this._handleData,e.onClose=this._handleClose,e.onError=this._handleError}sendFrame(e){if(this._draining)return;this.throwIfClosed();const t=this._introToSend,n=e.byteLength,r=this._socket.dataToSend;t?(this._introToSend=null,r.ensureAdditionalCapacity(t.length+3+n),r.writeByteArray(t)):r.ensureAdditionalCapacity(3+n),r.writeUint8(n>>16),r.writeUint16(65535&n),r.write(e),this._socket.requestSend()}convertBufferedToFrames(){const e=this._incoming;let t=this.onFrame;for(;t&&e.peek(a);){const n=o(e);__LOG__(2)`FrameSocket.onFrame(${n} bytes)`;t(e.readByteArray(n)),t=this.onFrame}this._draining&&!e.peek(a)&&this._doClose(),t&&e.size()&&__LOG__(2)`FrameSocket: queueing partial frame of ${e.size()} bytes`}throwIfClosed(){if(this.closed)throw new i}close(){this._socket.close()}}},10095:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NoiseHandshake=void 0;var r=n(8584),i=n(81576),a=n(73045),o=n(11609),s=n(43891),l=n(88156);const c=Promise.reject("UNINITIALIZED HANDSHAKE"),d=new Uint8Array(0);c.catch((()=>{}));function u(e){const t=new ArrayBuffer(12);return new DataView(t).setUint32(8,e),new Uint8Array(t)}function p(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["encrypt","decrypt"];return self.crypto.subtle.importKey("raw",new Uint8Array(e),"AES-GCM",!1,t)}function f(e,t){return(0,i.extractWithSaltAndExpand)(t,new Uint8Array(e),"",64).then((e=>[e.slice(0,32),e.slice(32)]))}function h(e){e.catch((()=>{}))}t.NoiseHandshake=class{constructor(e){this._hash=c,this._salt=c,this._cryptoKey=c,this._counter=0,this._socket=e,this._rejectOnClose=new l.Resolvable,e.onClose=()=>{this._rejectOnClose.reject(new o.Disconnected("NoiseHandshake: SocketClosed"))},h(this._rejectOnClose.promise)}start(e,t){const n=r.Binary.build(e).readBuffer(),i=32===n.byteLength?Promise.resolve(n):(0,a.sha256)(n);this._hash=i,this._salt=i,this._cryptoKey=i.then(p),this.authenticate(t)}sendAndReceive(e){const t=this._socket,n=new Promise((n=>{t.onFrame=e=>{t.onFrame=null,n(e)},t.sendFrame(e)}));return this._orRejectOnClose(n)}send(e){this._socket.sendFrame(e)}authenticate(e){this._hash=Promise.all([this._hash,e]).then((e=>{let[t,n]=e;const i=r.Binary.build(t,n).readByteArray();return(0,a.sha256)(i)}))}encrypt(e){const t=this._counter++,n=Promise.all([this._cryptoKey,this._hash,e]).then((e=>{let[n,r,i]=e;return function(e,t,n,r){return self.crypto.subtle.encrypt({name:"AES-GCM",iv:u(t),additionalData:n?new Uint8Array(n):d},e,r)}(n,t,r,i)}));return this.authenticate(n),this._orRejectOnClose(n)}decrypt(e){const t=this._counter++,n=Promise.all([this._cryptoKey,this._hash]).then((n=>{let[r,i]=n;return function(e,t,n,r){return self.crypto.subtle.decrypt({name:"AES-GCM",iv:u(t),additionalData:n?new Uint8Array(n):d},e,r)}(r,t,i,e)}));return this.authenticate(e),this._orRejectOnClose(n)}finish(){const e=this._salt.then((e=>f(e,new Uint8Array(0)))).then((e=>{let[t,n]=e;return Promise.all([p(t,["encrypt"]),p(n,["decrypt"])])})).then((e=>{let[t,n]=e;return new s.NoiseSocket(this._socket,t,n)}));return this._orRejectOnClose(e)}mixIntoKey(e){this._counter=0;const t=Promise.all([this._salt,e]).then((e=>{let[t,n]=e;return f(t,new Uint8Array(n))}));this._salt=t.then((e=>e[0])),this._cryptoKey=t.then((e=>p(e[1]))),h(this._salt),h(this._cryptoKey)}_orRejectOnClose(e){return Promise.race([e,this._rejectOnClose.promise]).then((e=>this._rejectOnClose.resolveWasCalled()?this._rejectOnClose.promise:e))}}},43891:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NoiseSocket=void 0;var r=n(27870);const i=Promise.reject("UNINITIALIZED HANDSHAKE"),a=new Uint8Array(0);i.catch((()=>{}));function o(e){const t=new ArrayBuffer(12);return new DataView(t).setUint32(8,e),new Uint8Array(t)}t.NoiseSocket=class{constructor(e,t,n){this._incoming=[],this._readQueue=new r.PromiseQueue,this._sendQueue=new r.PromiseQueue,this._readCounter=0,this._writeCounter=0,this._draining=!1,this._sendCiphertextFrame=e=>{this._socket.closed?__LOG__(2)`NoiseSocket socket closed while encrypting frame`:this._socket.sendFrame(e)},this._handleCiphertext=e=>{const t=this._readCounter++;this._readQueue.enqueueHandlers(function(e,t,n,r){return self.crypto.subtle.decrypt({name:"AES-GCM",iv:o(t),additionalData:n?new Uint8Array(n):a},e,r)}(this._readKey,t,void 0,e),this._handlePlaintext)},this._handleOnClose=()=>{this._draining=!0,this._readQueue.wait().then((()=>{this._draining=!1;const e=this._onClose;e&&e()}))},this._handlePlaintext=e=>{this._onFrame?this._onFrame(e):this._incoming.push(e)},this._socket=e,this._writeKey=t,this._readKey=n,e.onFrame=this._handleCiphertext,this._socket.onClose=this._handleOnClose,e.convertBufferedToFrames()}sendFrame(e){if(this._draining)return;this._socket.throwIfClosed();const t=this._writeCounter++;var n,r,i,s;this._sendQueue.enqueueHandlers((n=this._writeKey,r=t,i=void 0,s=e,self.crypto.subtle.encrypt({name:"AES-GCM",iv:o(r),additionalData:i?new Uint8Array(i):a},n,s)),this._sendCiphertextFrame)}setOnFrame(e){this._onFrame=e}setOnClose(e){this._onClose=e}close(){this._socket.close()}}},44396:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.handleError=function(e){return a.parse(e),"NO_ACK"};var r=n(71914);const i=479,a=new r.WapParser("errorParser",(e=>{e.assertTag("error");const t=e.attrInt("code");switch(t){case i:return __LOG__(4,void 0,new Error,!0)`Invalid stanza sent (smax-invalid)`,void SEND_LOGS("smax-invalid");default:return function(e){__LOG__(4,void 0,new Error,!0)`Unknown error code: ${e}`,SEND_LOGS("unknown-error-code")}(t)}}))},48095:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mediaConnParser=void 0;var r=n(2555);const i=new(n(71914).WapParser)("mediaConnParser",(e=>{var t,n;const r=e.child("media_conn");return{hosts:r.mapChildrenWithTag("host",o),authToken:r.attrString("auth"),authTTL:r.hasAttr("auth_ttl")?r.attrFutureTime("auth_ttl"):null,authExpires:r.attrFutureTime("ttl"),maxBuckets:r.hasAttr("max_buckets")?r.attrInt("max_buckets"):null,maxManualRetry:null!==(t=r.maybeAttrInt("max_manual_retry",0,4))&&void 0!==t?t:3,maxAutoDownloadRetry:null!==(n=r.maybeAttrInt("max_auto_download_retry",0,4))&&void 0!==n?n:3}}));function a(e){var t,n;if(e.hasAttr("fallback_hostname"))return{domain:e.attrString("fallback_hostname"),class:e.maybeAttrString("fallback_class"),ip4:null!==(t=e.maybeAttrString("fallback_ip4"))&&void 0!==t?t:void 0,ip6:null!==(n=e.maybeAttrString("fallback_ip6"))&&void 0!==n?n:void 0}}function o(e){var t,n,r,i;return{domain:e.attrString("hostname"),fallback:a(e),uploadable:s(e,"upload"),downloadable:s(e,"download"),isFallback:"fallback"===e.maybeAttrString("type"),downloadBuckets:null!==(t=null===(n=e.maybeChild("download_buckets"))||void 0===n?void 0:n.mapChildren((e=>parseInt(e.tag(),10))))&&void 0!==t?t:[],class:e.maybeAttrString("class"),ip4:null!==(r=e.maybeAttrString("ip4"))&&void 0!==r?r:void 0,ip6:null!==(i=e.maybeAttrString("ip6"))&&void 0!==i?i:void 0}}function s(e,t){return e.hasChild(t)?e.child(t).mapChildren((e=>{const t=e.tag();return(0,r.castToServerMediaType)(t)})).filter(Boolean):r.SERVER_MEDIA}t.mediaConnParser=i},70910:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MessageKeySpec=void 0;var r=n(1390);const i={};t.MessageKeySpec=i,i.internalSpec={remoteJid:[1,r.TYPES.STRING],fromMe:[2,r.TYPES.BOOL],id:[3,r.TYPES.STRING],participant:[4,r.TYPES.STRING]}},50073:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SyncdVersionSpec=t.SyncdValueSpec=t.SyncdSnapshotSpec=t.SyncdRecordSpec=t.SyncdPatchSpec=t.SyncdMutationsSpec=t.SyncdMutationSyncdOperation=t.SyncdMutationSpec=t.SyncdIndexSpec=t.KeyIdSpec=t.ExternalBlobReferenceSpec=t.ExitCodeSpec=void 0;var r=n(1390);const i=n(54302)({SET:0,REMOVE:1});t.SyncdMutationSyncdOperation=i;const a={};t.SyncdVersionSpec=a;const o={};t.ExitCodeSpec=o;const s={};t.SyncdIndexSpec=s;const l={};t.SyncdValueSpec=l;const c={};t.KeyIdSpec=c;const d={};t.SyncdRecordSpec=d;const u={};t.ExternalBlobReferenceSpec=u;const p={};t.SyncdSnapshotSpec=p;const f={};t.SyncdMutationsSpec=f;const h={};t.SyncdMutationSpec=h;const _={};t.SyncdPatchSpec=_,a.internalSpec={version:[1,r.TYPES.UINT64]},o.internalSpec={code:[1,r.TYPES.UINT64],text:[2,r.TYPES.STRING]},s.internalSpec={blob:[1,r.TYPES.BYTES]},l.internalSpec={blob:[1,r.TYPES.BYTES]},c.internalSpec={id:[1,r.TYPES.BYTES]},d.internalSpec={index:[1,r.TYPES.MESSAGE,s],value:[2,r.TYPES.MESSAGE,l],keyId:[3,r.TYPES.MESSAGE,c]},u.internalSpec={mediaKey:[1,r.TYPES.BYTES],directPath:[2,r.TYPES.STRING],handle:[3,r.TYPES.STRING],fileSizeBytes:[4,r.TYPES.UINT64],fileSha256:[5,r.TYPES.BYTES],fileEncSha256:[6,r.TYPES.BYTES]},p.internalSpec={version:[1,r.TYPES.MESSAGE,a],records:[2,r.FLAGS.REPEATED|r.TYPES.MESSAGE,d],mac:[3,r.TYPES.BYTES],keyId:[4,r.TYPES.MESSAGE,c]},f.internalSpec={mutations:[1,r.FLAGS.REPEATED|r.TYPES.MESSAGE,h]},h.internalSpec={operation:[1,r.TYPES.ENUM,i],record:[2,r.TYPES.MESSAGE,d]},_.internalSpec={version:[1,r.TYPES.MESSAGE,a],mutations:[2,r.FLAGS.REPEATED|r.TYPES.MESSAGE,h],externalMutations:[3,r.TYPES.MESSAGE,u],snapshotMac:[4,r.TYPES.BYTES],patchMac:[5,r.TYPES.BYTES],keyId:[6,r.TYPES.MESSAGE,c],exitCode:[7,r.TYPES.MESSAGE,o],deviceIndex:[8,r.TYPES.UINT32]}},381:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SyncActionValueSpec=t.SyncActionValue$UnarchiveChatsSettingSpec=t.SyncActionValue$SyncActionMessageSpec=t.SyncActionValue$SyncActionMessageRangeSpec=t.SyncActionValue$StarActionSpec=t.SyncActionValue$SecurityNotificationSettingSpec=t.SyncActionValue$RecentStickerWeightsActionSpec=t.SyncActionValue$RecentStickerMetadataSpec=t.SyncActionValue$RecentEmojiWeightsActionSpec=t.SyncActionValue$QuickReplyActionSpec=t.SyncActionValue$PushNameSettingSpec=t.SyncActionValue$PrimaryFeatureSpec=t.SyncActionValue$PinActionSpec=t.SyncActionValue$MuteActionSpec=t.SyncActionValue$MarkChatAsReadActionSpec=t.SyncActionValue$LocaleSettingSpec=t.SyncActionValue$LabelEditActionSpec=t.SyncActionValue$LabelAssociationActionSpec=t.SyncActionValue$KeyExpirationSpec=t.SyncActionValue$FavoriteStickerActionSpec=t.SyncActionValue$DeleteMessageForMeActionSpec=t.SyncActionValue$DeleteChatActionSpec=t.SyncActionValue$ContactActionSpec=t.SyncActionValue$ClearChatActionSpec=t.SyncActionValue$ArchiveChatActionSpec=t.SyncActionValue$AndroidUnsupportedActionsSpec=t.SyncActionDataSpec=t.RecentStickerWeightSpec=t.RecentEmojiWeightSpec=void 0;var r=n(1390),i=n(70910);const a={};t.RecentStickerWeightSpec=a;const o={};t.RecentEmojiWeightSpec=o;const s={};t.SyncActionValueSpec=s;const l={};t.SyncActionValue$AndroidUnsupportedActionsSpec=l;const c={};t.SyncActionValue$PrimaryFeatureSpec=c;const d={};t.SyncActionValue$KeyExpirationSpec=d;const u={};t.SyncActionValue$SyncActionMessageSpec=u;const p={};t.SyncActionValue$SyncActionMessageRangeSpec=p;const f={};t.SyncActionValue$UnarchiveChatsSettingSpec=f;const h={};t.SyncActionValue$DeleteChatActionSpec=h;const _={};t.SyncActionValue$ClearChatActionSpec=_;const g={};t.SyncActionValue$MarkChatAsReadActionSpec=g;const m={};t.SyncActionValue$DeleteMessageForMeActionSpec=m;const y={};t.SyncActionValue$ArchiveChatActionSpec=y;const E={};t.SyncActionValue$FavoriteStickerActionSpec=E;const S={};t.SyncActionValue$RecentEmojiWeightsActionSpec=S;const v={};t.SyncActionValue$RecentStickerMetadataSpec=v;const T={};t.SyncActionValue$RecentStickerWeightsActionSpec=T;const b={};t.SyncActionValue$LabelEditActionSpec=b;const C={};t.SyncActionValue$LabelAssociationActionSpec=C;const A={};t.SyncActionValue$QuickReplyActionSpec=A;const P={};t.SyncActionValue$LocaleSettingSpec=P;const M={};t.SyncActionValue$PushNameSettingSpec=M;const O={};t.SyncActionValue$SecurityNotificationSettingSpec=O;const I={};t.SyncActionValue$PinActionSpec=I;const w={};t.SyncActionValue$MuteActionSpec=w;const R={};t.SyncActionValue$ContactActionSpec=R;const D={};t.SyncActionValue$StarActionSpec=D;const L={};t.SyncActionDataSpec=L,a.internalSpec={filehash:[1,r.TYPES.STRING],weight:[2,r.TYPES.FLOAT]},o.internalSpec={emoji:[1,r.TYPES.STRING],weight:[2,r.TYPES.FLOAT]},s.internalSpec={timestamp:[1,r.TYPES.INT64],starAction:[2,r.TYPES.MESSAGE,D],contactAction:[3,r.TYPES.MESSAGE,R],muteAction:[4,r.TYPES.MESSAGE,w],pinAction:[5,r.TYPES.MESSAGE,I],securityNotificationSetting:[6,r.TYPES.MESSAGE,O],pushNameSetting:[7,r.TYPES.MESSAGE,M],quickReplyAction:[8,r.TYPES.MESSAGE,A],recentStickerWeightsAction:[9,r.TYPES.MESSAGE,T],recentStickerMetadata:[10,r.TYPES.MESSAGE,v],recentEmojiWeightsAction:[11,r.TYPES.MESSAGE,S],labelEditAction:[14,r.TYPES.MESSAGE,b],labelAssociationAction:[15,r.TYPES.MESSAGE,C],localeSetting:[16,r.TYPES.MESSAGE,P],archiveChatAction:[17,r.TYPES.MESSAGE,y],deleteMessageForMeAction:[18,r.TYPES.MESSAGE,m],keyExpiration:[19,r.TYPES.MESSAGE,d],markChatAsReadAction:[20,r.TYPES.MESSAGE,g],clearChatAction:[21,r.TYPES.MESSAGE,_],deleteChatAction:[22,r.TYPES.MESSAGE,h],unarchiveChatsSetting:[23,r.TYPES.MESSAGE,f],primaryFeature:[24,r.TYPES.MESSAGE,c],favoriteStickerAction:[25,r.TYPES.MESSAGE,E],androidUnsupportedActions:[26,r.TYPES.MESSAGE,l]},l.internalSpec={allowed:[1,r.TYPES.BOOL]},c.internalSpec={flags:[1,r.FLAGS.REPEATED|r.TYPES.STRING]},d.internalSpec={expiredKeyEpoch:[1,r.TYPES.INT32]},u.internalSpec={key:[1,r.TYPES.MESSAGE,i.MessageKeySpec],timestamp:[2,r.TYPES.INT64]},p.internalSpec={lastMessageTimestamp:[1,r.TYPES.INT64],lastSystemMessageTimestamp:[2,r.TYPES.INT64],messages:[3,r.FLAGS.REPEATED|r.TYPES.MESSAGE,u]},f.internalSpec={unarchiveChats:[1,r.TYPES.BOOL]},h.internalSpec={messageRange:[1,r.TYPES.MESSAGE,p]},_.internalSpec={messageRange:[1,r.TYPES.MESSAGE,p]},g.internalSpec={read:[1,r.TYPES.BOOL],messageRange:[2,r.TYPES.MESSAGE,p]},m.internalSpec={deleteMedia:[1,r.TYPES.BOOL],messageTimestamp:[2,r.TYPES.INT64]},y.internalSpec={archived:[1,r.TYPES.BOOL],messageRange:[2,r.TYPES.MESSAGE,p]},E.internalSpec={directPath:[1,r.TYPES.STRING],lastUploadTimestamp:[2,r.TYPES.STRING],handle:[3,r.TYPES.STRING],encFilehash:[4,r.TYPES.STRING],stickerHashWithoutMeta:[5,r.TYPES.STRING],mediaKey:[6,r.TYPES.STRING],mediaKeyTimestamp:[7,r.TYPES.INT64],isFavorite:[8,r.TYPES.BOOL]},S.internalSpec={weights:[1,r.FLAGS.REPEATED|r.TYPES.MESSAGE,o]},v.internalSpec={directPath:[1,r.TYPES.STRING],encFilehash:[2,r.TYPES.STRING],mediaKey:[3,r.TYPES.STRING],stanzaId:[4,r.TYPES.STRING],chatJid:[5,r.TYPES.STRING],participant:[6,r.TYPES.STRING],isSentByMe:[7,r.TYPES.BOOL]},T.internalSpec={weights:[1,r.FLAGS.REPEATED|r.TYPES.MESSAGE,a]},b.internalSpec={name:[1,r.TYPES.STRING],color:[2,r.TYPES.INT32],predefinedId:[3,r.TYPES.INT32],deleted:[4,r.TYPES.BOOL]},C.internalSpec={labeled:[1,r.TYPES.BOOL]},A.internalSpec={shortcut:[1,r.TYPES.STRING],message:[2,r.TYPES.STRING],keywords:[3,r.FLAGS.REPEATED|r.TYPES.STRING],count:[4,r.TYPES.INT32],deleted:[5,r.TYPES.BOOL]},P.internalSpec={locale:[1,r.TYPES.STRING]},M.internalSpec={name:[1,r.TYPES.STRING]},O.internalSpec={showNotification:[1,r.TYPES.BOOL]},I.internalSpec={pinned:[1,r.TYPES.BOOL]},w.internalSpec={muted:[1,r.TYPES.BOOL],muteEndTimestamp:[2,r.TYPES.INT64]},R.internalSpec={fullName:[1,r.TYPES.STRING],firstName:[2,r.TYPES.STRING]},D.internalSpec={starred:[1,r.TYPES.BOOL]},L.internalSpec={index:[1,r.TYPES.BYTES],value:[2,r.TYPES.MESSAGE,s],padding:[3,r.TYPES.BYTES],version:[4,r.TYPES.INT32]}},62109:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.decryptCipherText=function(e,t,n){return(0,i.aesCbcDecrypt)(t,e,n)},t.generateAssociatedData=function(e,t){let n;switch(e){case s.SyncdMutationSyncdOperation.SET:n=l.OPERATION_SET_HEX;break;case s.SyncdMutationSyncdOperation.REMOVE:n=l.OPERATION_REMOVE_HEX}if(n){n=new Uint8Array([parseInt(n,16)]).buffer;const e=n,r=new Uint8Array(n.byteLength+t.byteLength);return r.set(new Uint8Array(e)),r.set(new Uint8Array(t),e.byteLength),r.buffer}throw new Error("invalid mutation operation value")},t.generateCipherText=function(e,t,n){return(0,i.aesCbcEncrypt)(t,n,e)},t.generateEncryptionKeys=void 0,t.generateIndexMac=function(e,t){return(0,a.hmacSha256)(new Uint8Array(e),new Uint8Array(t))},t.generateMac=function(e,t,n){const r=new Uint8Array(l.OCTET_LENGTH);r.set([e.byteLength],r.byteLength-1);const i=(0,d.combine)([e,t,r.buffer]);return(0,a.hmacSha512)(n,i,l.MAC_LENGTH)},t.generatePadding=function(e,t){const n=Math.max(0,l.MAX_OF_MIN_DATA_LENGTH-e-t),r=new Uint8Array(n);return self.crypto.getRandomValues(r),r.buffer},t.generatePatchMac=function(e,t,n,r,i){return(0,a.hmacSha256)(e,(0,d.combine)([t,...n,r,i]))},t.generateSnapshotMac=function(e,t,n,r){return(0,a.hmacSha256)(e,(0,d.combine)([t,n,r]))},t.valueMacFromIndexAndValueCipherText=function(e){const t=e.byteLength;return new Uint8Array(e).slice(t-l.MAC_LENGTH).buffer};var r=n(15688),i=n(81484),a=n(11141),o=n(14950),s=n(50073),l=n(32458),c=n(40184),d=n(63109);const u=(0,o.memoizeWithArgs)(c.generateEncryptionKeysUnmemoized,r.encodeB64);t.generateEncryptionKeys=u},32458:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VALUE_MAC_KEY_LENGTH=t.VALUE_MAC_KEY_END=t.VALUE_ENCRYPTION_KEY_LENGTH=t.VALUE_ENCRYPTION_KEY_END=t.SNAPSHOT_MAC_KEY_LENGTH=t.SNAPSHOT_MAC_KEY_END=t.PATCH_MAC_KEY_LENGTH=t.PATCH_MAC_KEY_END=t.OPERATION_SET_HEX=t.OPERATION_REMOVE_HEX=t.OCTET_LENGTH=t.MAX_OF_MIN_DATA_LENGTH=t.MAC_LENGTH=t.IV_LENGTH=t.INDEX_KEY_LENGTH=t.INDEX_KEY_END=t.HKDF_INFO=t.EMPTY_MUTATION_MAC=t.DERIVED_KEY_LENGTH=void 0;t.HKDF_INFO="WhatsApp Mutation Keys";t.DERIVED_KEY_LENGTH=160;t.INDEX_KEY_LENGTH=32;t.VALUE_ENCRYPTION_KEY_LENGTH=32;t.VALUE_MAC_KEY_LENGTH=32;t.SNAPSHOT_MAC_KEY_LENGTH=32;t.PATCH_MAC_KEY_LENGTH=32;t.INDEX_KEY_END=32;t.VALUE_ENCRYPTION_KEY_END=64;t.VALUE_MAC_KEY_END=96;t.SNAPSHOT_MAC_KEY_END=128;t.PATCH_MAC_KEY_END=160;t.OPERATION_SET_HEX="0x01";t.OPERATION_REMOVE_HEX="0x02";t.MAX_OF_MIN_DATA_LENGTH=0;t.MAC_LENGTH=32;t.OCTET_LENGTH=8;t.IV_LENGTH=16;const n=new ArrayBuffer(32);t.EMPTY_MUTATION_MAC=n},40184:(e,t,n)=>{"use strict";var r=n(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.generateEncryptionKeysUnmemoized=function(){return s.apply(this,arguments)};var i=r(n(11504)),a=n(81576),o=n(32458);function s(){return(s=(0,i.default)((function*(e){const t=yield l(e);return{indexKey:t.slice(0,o.INDEX_KEY_END),valueEncryptionKey:t.slice(o.INDEX_KEY_END,o.VALUE_ENCRYPTION_KEY_END),valueMacKey:t.slice(o.VALUE_ENCRYPTION_KEY_END,o.VALUE_MAC_KEY_END),snapshotMacKey:t.slice(o.VALUE_MAC_KEY_END,o.SNAPSHOT_MAC_KEY_END),patchMacKey:t.slice(o.SNAPSHOT_MAC_KEY_END,o.PATCH_MAC_KEY_END)}}))).apply(this,arguments)}function l(e){return(0,a.extractAndExpand)(e,o.HKDF_INFO,o.DERIVED_KEY_LENGTH)}},63109:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.arrayBufferToHex=function(e){return Array.from(new Uint8Array(e)).map((e=>e.toString(16))).toString().replace(/,/g," ")},t.arrayBufferToHexPadded=function(e){return Array.from(new Uint8Array(e)).map((e=>e.toString(16).padStart(2,"0"))).join("")},t.combine=function(e){if(0===e.length)throw new Error("buffers length is zero");if(1===e.length)return e[0];const t=e.map((e=>e.byteLength)).reduce(((e,t)=>e+t)),n=new Uint8Array(t);let r,i=0;for(r=0;r<e.length;r++)n.set(new Uint8Array(e[r]),i),i+=e[r].byteLength;return n.buffer},t.hexToUint8Array=function(e){return Uint8Array.from(e.split(" ").map((e=>parseInt(e,16))))},t.split=function(e,t,n){if(t<0||n<0)throw new Error("buffers length is zero");const r=new Array(3),i=new Uint8Array(e);return r[0]=i.slice(0,t).buffer,r[1]=i.slice(t,t+n).buffer,r[2]=i.slice(t+n).buffer,r},t.to64BitNetworkOrder=function(e){const t=new ArrayBuffer(8);return new DataView(t).setUint32(4,e,!1),t},t.toUtf8=function(e){return n.encode(e)};const n=new TextEncoder},97245:(e,t,n)=>{"use strict";var r=n(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.getToken=function(e){return(0,p.redeemPrivateStatsToken)().then((t=>t?{result:t}:g(e).then((e=>{const t=(0,i.default)({},e),{result:n}=e;return n?(0,p.savePrivateStatsToken)(n).then((()=>t)):t}))))},t.issuePrivateStatsToken=g;var i=r(n(73982)),a=n(8584),o=n(36184),s=n(11609),l=n(72287),c=n(92844),d=n(13059),u=n(47957),p=n(11562),f=n(31914),h=n(71914);const _=new h.WapParser("issuePrivateStatsToken",(e=>{const t=e.child("sign_credential");return{signedCredential:t.child("signed_credential").contentBytes(),acsPublicKey:t.child("acs_public_key").contentBytes()}}));function g(e){const t=(0,c.monotonicTime)(),n={overallStartTime:t,retryStartTime:t,retryAttemptsLeft:3},r=new Uint8Array(32);self.crypto.getRandomValues(r);const p=new Uint8Array(32);self.crypto.getRandomValues(p);const h=(0,u.blindToken)(r,p),g=new l.PromiseRetryLoop({name:"issuePrivateStatsToken",timer:{algo:{type:"exponential",first:250},max:1e3},code:t=>{n.retryAttemptsLeft<3&&(n.retryStartTime=(0,c.monotonicTime)());const l=(0,f.wap)("iq",{xmlns:"privatestats",id:(0,f.generateId)(),type:"get",to:f.S_WHATSAPP_NET},(0,f.wap)("sign_credential",{version:"1"},(0,f.wap)("blinded_credential",null,h)));return(e||o.sendIqWithoutRetry)(l,_).then((e=>{if(!e.success){const r=function(e){switch(e.errorCode){case 400:return"bad-request";case 500:return"internal-server-error";case 501:return"feature-not-implemented";case 503:return"service-unavailable";default:return"unknown"}}(e);return __LOG__(3)`issuePrivateStatsToken: failed ${r}`,void("internal-server-error"!==r||n.retryAttemptsLeft<=0?t({result:null,metric:(0,i.default)((0,i.default)({},n),{},{result:r})}):n.retryAttemptsLeft--)}const{signedCredential:o,acsPublicKey:s}=e.result,l=(0,u.unblindToken)(o,p,s);if(null==l)return __LOG__(3)`issuePrivateStatsToken: failed to unblind the signed token`,void t({result:null,metric:(0,i.default)((0,i.default)({},n),{},{result:"decryption-error"})});const c=a.Binary.build(r,l),f=(0,d.hash)(c.readByteArray());t({result:{token:r,sharedSecret:f},metric:(0,i.default)((0,i.default)({},n),{},{result:"success"})})})).catch((e=>{if(!(e instanceof s.Disconnected))return Promise.reject(e);__LOG__(3)`issuePrivateStatsToken: Disconnected`,n.retryAttemptsLeft<=0?t({result:null,metric:(0,i.default)((0,i.default)({},n),{},{result:"disconnected"})}):n.retryAttemptsLeft--}))}});return g.start(),g.promise()}},14604:(e,t,n)=>{"use strict";var r=n(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.uploadFinishedPrivateStatsBuffers=function(e){return(0,c.getFinishedStreamBuffers)("private").then((t=>v(t,e)))},t.upload_UNSAFE_INTERNAL_DO_NOT_USE=v;var i=r(n(11504)),a=n(15688),o=n(11141),s=n(72287),l=n(92844),c=n(11562);const d="https://dit.whatsapp.net/deidentified_telemetry",u="245118376424571|3e7d275052f1522bf3200afcf53841a7",p="WAMEventBuffer.dat",f=111e3,h=3067002,_=3067003,g=3067004;function m(e){return{result:e.result,httpResponseCode:e.httpResponseCode,uploadTime:(0,l.monotonicTimeSince)(e.uploadStartTime)}}function y(){return(y=(0,i.default)((function*(e,t,n,r){if((yield(0,c.privateStatsKillSwitchGetBlockedToken)())===u)return __LOG__(2)`Removing private stats buffer without submitting it (kill switch)`,(0,c.removeBufferByKey)(n.key).then((()=>{e()}));const i=(0,l.monotonicTime)(),s=yield r();if(null==s)return __LOG__(4,void 0,new Error)`Couldn't get token to submit a private stats buffer`,void e();const f=new FormData;f.append("access_token",u);const h=yield(0,o.hmacSha256)(s.sharedSecret,n.content),_=(0,a.encodeB64UrlSafe)(s.token,!0),g=(0,a.encodeB64UrlSafe)(h,!0);let m;f.append("credential",`${_}+${g}`),f.append("message",new Blob([n.content],{type:"application/octet-stream"}),p),f.append("meta_data",JSON.stringify({t:(0,l.unixTime)(),p:0}));try{m=yield fetch(d,{method:"POST",body:f,"Content-Type":"multipart/form-data"})}catch(e){return __LOG__(3)`Upload of a private stats buffer failed: ${e}`,void t({uploadStartTime:i,result:"error-other"})}const y=m.status,S=t=>{e({uploadStartTime:i,httpResponseCode:y,result:t})},v=e=>{t({uploadStartTime:i,httpResponseCode:y,result:e})};switch(y){case 200:return(0,c.removeBufferByKey)(n.key).then((()=>{S("success")}));case 429:return void S("error-server-other");case 401:return Promise.all([(0,c.privateStatsKillSwitchSet)(u),(0,c.removeBufferByKey)(n.key)]).then((()=>{S("error-access-token")}));case 400:{const{result:n,shouldRetry:r}=yield E(m),a={uploadStartTime:i,httpResponseCode:y,result:n};return void("retry"===r?t(a):e(a))}case 500:return void v("error-server-other")}__LOG__(3)`Unsupported response status code from PrivateStats upload request: ${y}`,v("error-other")}))).apply(this,arguments)}function E(){return S.apply(this,arguments)}function S(){return(S=(0,i.default)((function*(e){const t=yield e.json().catch((()=>{}));if("object"!=typeof t)return __LOG__(3)`Unable to parse error response 400 from PrivateStats upload request or parsed response is not an object`,{result:"error-other",shouldRetry:"retry"};const{error:n}=t;if("object"!=typeof n)return __LOG__(3)`Incorrect or missing error entry in the error response 400 from PrivateStats upload request`,{result:"error-other",shouldRetry:"retry"};const{code:r,error_subcode:i}=n;if("number"!=typeof r||"number"!=typeof i)return __LOG__(3)`Incorrect code or subcode in the error response 400 from PrivateStats upload request`,{result:"error-other",shouldRetry:"retry"};switch(r){case 9:return{result:"error-server-other",shouldRetry:"no-retry"};case f:switch(i){case h:return{result:"error-parsing",shouldRetry:"retry"};case _:return{result:"error-decoding",shouldRetry:"retry"};case g:return{result:"error-credential",shouldRetry:"retry"};default:return __LOG__(3)`Unsupported subcode value in the error response 400 from PrivateStats upload request: ${i}`,{result:"error-other",shouldRetry:"retry"}}default:return __LOG__(3)`Unsupported code value in the error response 400 from PrivateStats upload request: ${r}`,{result:"error-other",shouldRetry:"retry"}}}))).apply(this,arguments)}function v(e,t){const n=e.map((e=>{let n=3;const r=[],i=new s.PromiseRetryLoop({name:"uploadPrivateStatsBuffer",timer:{algo:{type:"exponential",first:250},max:1e3},code:i=>function(){return y.apply(this,arguments)}(i,(e=>{const t=m(e);r.push(t),n<=0?i():n--}),e,t)});return i.start(),i.promise().then((t=>{if(null!=t){const e=m(t);r.push(e)}return{uploadedBufferKey:"success"===(null==t?void 0:t.result)?e.key:null,metrics:r}}))}));return Promise.all(n).then((e=>{const t=e.reduce(((e,t)=>(e.push(...t.metrics),e)),[]);return{uploadedBufferKeys:e.reduce(((e,t)=>(null!=t.uploadedBufferKey&&e.push(t.uploadedBufferKey),e)),[]),metrics:t}}))}},2486:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NOT_HANDLED=t.DynamicRouter=void 0;const n={sentinel:"RESPONSE_NAMESPACE"},r={sentinel:"NOT_HANDLED"};t.NOT_HANDLED=r;function i(e,t){const r=t.namespace;return r===n?a:e.get(r)}function a(e,t,n){n(t)}function o(e){if(null!=e&&("object"==typeof e||"function"==typeof e)){const t=e.then;return"function"==typeof t?t:null}return null}t.DynamicRouter=class{constructor(){var e=this;this._basePromise=Promise.resolve(),this._handlers=new Map,this._handlerChangeCount=0,this._firstRoute=null,this._nextRoute=null,this._lastRoute=null,this.fireAndForget=function(t,n,r){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];e._schedule(t,n,r,null,i)},this.sendAndReceive=function(t,r,i){let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return new Promise(((s,l)=>{e._schedule(t,r,i,(t=>{try{const r=o(t);r?r.call(t,(t=>{e._schedule(n,"",t,s,a)}),(t=>{e._schedule(n,"",t,l,!1)})):e._schedule(n,"",t,s,a)}catch(t){e._schedule(n,"",t,l,!1)}}),a)}))},this._run=()=>{let e=this._nextRoute;if(!e)return;const t=this._handlers;let n;for(;e&&!(n=i(t,e));)this._nextRoute=e=e.nextRoute;if(!e||!n)return;const a=this._runHandler(n,e);let o=!0;if(a!==r){const t=e.prevRoute,n=e.nextRoute;this._nextRoute===e&&(this._nextRoute=n),t?t.nextRoute=n:this._firstRoute=n,n?n.prevRoute=t:(o=!1,this._lastRoute=t)}return o&&this._basePromise.then(this._run),a}}hasHandlerForNamespace(e){return this._handlers.has(e)}getHandledNamespaces(){return Array.from(this._handlers.keys())}setNamespaceHandler(e,t){const n=this._handlers,r=n.get(e);if(r!==t&&(++this._handlerChangeCount,n.set(e,t),!r)){const e=this._firstRoute;e&&(this._nextRoute||this._basePromise.then(this._run),this._nextRoute=e)}}setHandlers(e,t){this.setNamespaceHandler(e,(function(e,n,r){const i=t[e](n);r&&r(i)}))}_schedule(e,t,n,r,a){const o=this._lastRoute,s={namespace:e,route:t,arg:n,resolver:r,prevRoute:o,nextRoute:null,silentLog:a};this._lastRoute=s;let l=!0;o?(o.nextRoute=s,l=!this._nextRoute):this._firstRoute=s,l&&i(this._handlers,s)&&(this._nextRoute=s,this._basePromise.then(this._run))}_runHandler(e,t){const{route:n,arg:i,resolver:a,silentLog:o}=t,s=this._handlerChangeCount;let l=null,c=null;try{l=e(n,i,a,o)}catch(e){c=Promise.reject(e)}if(l===r){if(s!==this._handlerChangeCount)return r;c=Promise.reject(new Error("DynamicRouter: NOT_HANDLED can only be used when updating handlers"))}if(!a)return c;c&&a(c)}}},81484:(e,t,n)=>{"use strict";var r=n(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.AesCbcStream=void 0,t.aesCbcDecrypt=h,t.aesCbcDecryptSplit=function(e,t){return Promise.resolve().then((()=>{const n=t.slice(0,16),r=t.slice(16);return h(e,n,r)}))},t.aesCbcEncrypt=function(e,t,n){return Promise.resolve().then((()=>{const r=p(n),i=d(r);return Promise.resolve(u(e)).then((e=>self.crypto.subtle.encrypt(i,e,t))).then((e=>(0,s.concatTypedArrays)(Uint8Array,[r,new Uint8Array(e)]).buffer))}))},t.aesCbcEncryptWithChunking=function(){return _.apply(this,arguments)};var i=r(n(11504)),a=n(8584),o=n(46269),s=n(60977);const l=16,c=16777216;function d(e){return{name:"AES-CBC",iv:(0,o.castTypedArrays)(Uint8Array,e)}}function u(e){return self.crypto.subtle.importKey("raw",(0,o.castTypedArrays)(Uint8Array,e),"AES-CBC",!1,["encrypt"])}function p(e){if(e)return(0,o.castTypedArrays)(Uint8Array,e);const t=new Uint8Array(16);return self.crypto.getRandomValues(t),t}function f(e){const t=e.byteLength,n=l-t%l;return Number.isNaN(n)?t:t+n}function h(e,t,n){const r=d(t);return Promise.resolve(self.crypto.subtle.importKey("raw",(0,o.castTypedArrays)(Uint8Array,e),"AES-CBC",!1,["decrypt"])).then((e=>self.crypto.subtle.decrypt(r,e,n)))}function _(){return(_=(0,i.default)((function*(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:c;if(r%l!=0)throw new Error(`chunkSize must be a multiple of 16, ${r} received`);const i=yield u(e),a=new Uint8Array(t),o=Math.ceil(a.byteLength/r),s=p(n),h=new Uint8Array(f(a)+s.byteLength);h.set(s);for(let e,t,n=0,l=s;n<o;n++){const c=n===o-1,u=n*r;e=a.subarray(u,u+r),t=yield self.crypto.subtle.encrypt(d(l),i,e).then((e=>c?new Uint8Array(e):new Uint8Array(e).subarray(0,-16))),h.set(t,s.byteLength+n*r),l=t.slice(-16)}return h.buffer}))).apply(this,arguments)}t.AesCbcStream=class{constructor(e,t,n,r){this._input=null,this._finished=!1,this._output=e,this._type=t,this._rawKey=n;const i={name:"AES-CBC",iv:r};this._promise=self.crypto.subtle.importKey("raw",n,"AES-CBC",!1,[t]).then((e=>({algo:i,key:e})))}append(e){let t;this._throwIfFinished("append");const n=this._input;if(n)if(n.writeByteArray(e),n.size()>1024){const e=n.size()%l;t=n.readByteArray(n.size()-e),n.size()||(this._input=null)}else t=null;else if(e.length>1024){const n=e.length%l;n?(this._input=new a.Binary(e),t=this._input.readByteArray(e.length-n)):t=e}else this._input=new a.Binary(e),t=null;const r=t;return r&&(this._promise=this._promise.then((e=>{let{key:t,algo:n}=e;if("encrypt"===this._type)return self.crypto.subtle.encrypt(n,t,r).then((e=>(this._output.writeByteArray(new Uint8Array(e,0,e.byteLength-l)),new Uint8Array(e,e.byteLength-32,l))));{const e=r.slice(-16);return self.crypto.subtle.decrypt(n,t,r).then((t=>(this._output.writeBuffer(t),e)))}})).then((e=>{const t={name:"AES-CBC",iv:e};return self.crypto.subtle.importKey("raw",this._rawKey,"AES-CBC",!1,[this._type]).then((e=>({algo:t,key:e})))}))),this._promise.then((()=>{}))}finalize(e){let t;if(this._throwIfFinished("finalize"),this._input?(e&&this._input.writeByteArray(e),t=this._input.readByteArray(),this._input=null):e&&(t=e),t){const e=t;return this._promise.then((t=>{let{algo:n,key:r}=t;return"encrypt"===this._type?self.crypto.subtle.encrypt(n,r,e):self.crypto.subtle.decrypt(n,r,e)})).then((e=>{this._output.writeBuffer(e)}))}return this._promise.then((()=>{}))}_throwIfFinished(e){if(this._finished)throw new Error(`AesCbcStream.${e} called after finalize`)}}},30141:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.allocate=o,t.elligator=b,t.fieldElement=s,t.hashSha512=function(e,t,n){r.lowlevel.crypto_hash(e,t,n)},t.hashToPoint=function(e){return a((()=>function(e){const{unpack25519:t}=r.lowlevel,n=(0,r.hash)(e),i=(128&n[31])>>7;n[31]&=127;const a=s();t(a,n);const l=s();b(l,a);const c=u();!function(e,t,n){const{unpack25519:i,M:a}=r.lowlevel,l=s();i(l,v);const c=s();!function(e,t){const{Z:n,A:i,M:a}=r.lowlevel,o=d(),l=s(),c=s(),u=s();n(l,t,o),i(c,t,o),A(u,c),a(e,l,u)}(c,t);const u=s();_(u,t);const p=s();!function(e,t){const{unpack25519:n,pow2523:i,M:a,S:o}=r.lowlevel,l=s();n(l,m);const c=s();i(c,t);const d=s();a(d,t,c);const u=s();o(u,d);const p=s();a(p,d,l),g(d,p,1^(f=u,h=t,P(f,h)?0:1)),e.set(d);var f,h}(p,u);const f=s();a(f,t,l);const h=s();A(h,p);const E=s();a(E,f,h);const S=s();y(S,E),g(E,S,function(e){const{pack25519:t}=r.lowlevel,n=o(Uint8Array,32);return t(n,e),1&n[0]}(E)^n),e[0].set(E),e[1].set(c),e[2].set(d()),a(e[3],e[0],e[1])}(c,l,i);const f=u();return function(e,t){const n=[s(),s(),s(),s()],i=p();(function(e,t){const n=p();(function(e,t){e[0].set(t[0]),e[1].set(t[1]),e[2].set(t[2])})(n,t),S(e,n)})(n,t),E(i,n),S(n,i),E(i,n),S(n,i),function(e,t){const{M:n}=r.lowlevel;n(e[0],t[0],t[3]),n(e[1],t[1],t[2]),n(e[2],t[2],t[3]),n(e[3],t[0],t[1])}(e,n)}(f,c),f}(e)))},t.inv25519=A,t.modL=l,t.p3Element=u,t.pack=C,t.reduce=function(e,t){for(let n=0;n<64;++n)t[n]=e[n],e[n]=0;l(e,t),t.fill(0)},t.runInAllocationScope=a,t.scalarmultBase=function(e,t){const n=[s(),s(),s(),s()];r.lowlevel.scalarbase(n,t),C(e,n)},t.unpack=function(e,t){const n=u();if(0!==M(n,t))return-1;return function(e,t){y(e[0],t[0]),e[1].set(t[1]),e[2].set(t[2]),y(e[3],t[3])}(e,n),0},t.unpackneg=M;var r=n(13059);let i=null;function a(e){const t=i;i=[];try{return e()}finally{var n;(null!==(n=i)&&void 0!==n?n:[]).forEach((e=>{e.fill(0)})),i=t}}function o(e,t){if(null==i)throw new Error("allocate called outside of active scope");return new e(t)}function s(e){const t=o(Float64Array,16);if(e){if(e.length>16)throw new Error("Incorrect initialiser array provided to the fieldElement");for(let n=0;n<e.length;n++)t[n]=e[n]}return t}function l(e,t){r.lowlevel.modL(e,t)}const c=()=>s([0]),d=()=>s([1]);function u(){return[s(),s(),s(),s()]}function p(){return[s(),s(),s()]}function f(e,t){let n=0,r=t;for(;r>0;){const t=r%65536;e[n]=t,r=(r-t)/65536,n++}}function h(e,t){const{S:n,M:i}=r.lowlevel,a=s([2]),o=s();n(o,t),i(e,a,o)}function _(e,t){const{S:n,M:i,A:a}=r.lowlevel,o=c(),l=d(),u=s(),p=s(),h=s(),_=s();f(o,486662),n(u,t),i(p,o,t),a(h,u,p),a(_,h,l),i(e,t,_)}function g(e,t,n){1===n&&e.set(t)}const m=new Uint8Array([176,160,14,74,39,27,238,196,120,228,47,173,6,24,67,47,167,215,251,61,153,0,77,43,11,223,193,79,128,36,131,43]);function y(e,t){const{Z:n}=r.lowlevel;n(e,c(),t)}function E(e,t){const{M:n}=r.lowlevel;n(e[0],t[0],t[3]),n(e[1],t[1],t[2]),n(e[2],t[2],t[3])}function S(e,t){const{S:n,A:i,Z:a}=r.lowlevel;n(e[0],t[0]),n(e[2],t[1]),h(e[3],t[2]),i(e[1],t[0],t[1]);const o=s();n(o,e[1]),i(e[1],e[2],e[0]),a(e[2],e[2],e[0]),a(e[0],o,e[1]),a(e[3],e[3],e[2])}const v=new Uint8Array([6,126,69,255,170,4,110,204,130,26,125,75,209,211,161,197,126,79,252,3,220,8,123,210,187,6,160,96,244,237,38,15]);function T(e,t){const{M:n,A:i}=r.lowlevel,a=d(),o=c();f(o,486662);const l=s();h(l,t);const u=s();i(u,l,a);const p=s();A(p,u);const m=s();n(m,p,o);const E=s();y(E,m);const S=s();_(S,E);const v=function(e){const{S:t,M:n,pow2523:i,pack25519:a}=r.lowlevel,o=s(),l=s(),c=s(),d=s(),u=s();i(o,e),t(l,o),t(c,l),n(d,c,e),n(u,d,e);const p=new Uint8Array(32);return a(p,u),1&p[31]}(S),T=s([0]);g(T,o,v);const b=s();i(b,E,T);const C=s();y(C,b),g(b,C,v),e.set(b)}function b(e,t){return a((()=>T(e,t)))}function C(e,t){const n=s(),i=s(),a=s(),{M:o,pack25519:l}=r.lowlevel;A(a,t[2]),o(n,t[0],a),o(i,t[1],a),l(e,i);const c=new Uint8Array(32);l(c,n),e[31]^=(1&c[0])<<7}function A(e,t){const n=s();n.set(t);const{M:i,S:a}=r.lowlevel;for(let e=253;e>=0;--e)a(n,n),2!==e&&4!==e&&i(n,n,t);e.set(n)}function P(e,t){const{pack25519:n,crypto_verify_32:i}=r.lowlevel,a=new Uint8Array(32),o=new Uint8Array(32);return n(a,e),n(o,t),i(a,0,o,0)}function M(e,t){const{set25519:n,S:i,M:a,Z:o,A:l,D:u,unpack25519:p,pow2523:f}=r.lowlevel,h=s(),_=s(),g=s(),m=s(),y=s(),E=s(),S=s();return n(e[2],d()),p(e[1],t),i(g,e[1]),a(m,g,u),o(g,g,e[2]),l(m,e[2],m),i(y,m),i(E,y),a(S,E,y),a(h,S,g),a(h,h,m),f(h,h),a(h,h,g),a(h,h,m),a(h,h,m),a(e[0],h,m),i(_,e[0]),a(_,_,m),P(_,g)&&a(e[0],e[0],s([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139])),i(_,e[0]),a(_,_,m),P(_,g)?-1:(function(e){const{pack25519:t}=r.lowlevel,n=new Uint8Array(32);return t(n,e),1&n[0]}(e[0])===t[31]>>7&&o(e[0],c(),e[0]),a(e[3],e[0],e[1]),0)}},81576:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.expand=o,t.extractAndExpand=function(e,t,n){return(0,i.extractSha256)(null,e).then((e=>o(new Uint8Array(e),t,n)))},t.extractWithSaltAndExpand=function(e,t,n,r){return(0,i.extractSha256)(t,e).then((e=>o(new Uint8Array(e),n,r)))};var r=n(8584),i=n(11141);const a=255*i.SHA256_BYTE_LENGTH;function o(e,t,n){if(n<0||n>a)return Promise.reject(new Error(`HKDF::expand given bad length ${n}`));let o;const s=Math.ceil(n/i.SHA256_BYTE_LENGTH),l=r.Binary.build(t).readByteArray(),c=new r.Binary;let d=(0,i.encodeKeySha256)(e).then((e=>(o=e,new Uint8Array(0))));for(let e=1;e<=s;e++)d=d.then((t=>(0,i.sign)(o,r.Binary.build(t,l,e).readByteArray()))).then((e=>{const t=new Uint8Array(e);return c.writeByteArray(t),t}));return d.then((()=>c.readBuffer(n)))}},11141:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SHA256_BYTE_LENGTH=t.DEFAULT_SALT=void 0,t.encodeKeySha256=function(e){return l(a,e)},t.extractSha256=function(e,t){return l(a,null!=e?e:i).then((e=>c(e,t)))},t.hmacSha1=function(e,t,n){return l(s,e).then((e=>c(e,t,n)))},t.hmacSha256=function(e,t,n){return l(a,e).then((e=>c(e,t,n)))},t.hmacSha512=function(e,t,n){return l(o,e).then((e=>c(e,t,n)))},t.sign=c;var r=n(46269);t.SHA256_BYTE_LENGTH=32;const i=new Uint8Array(32);t.DEFAULT_SALT=i;const a={name:"HMAC",hash:"SHA-256"},o={name:"HMAC",hash:"SHA-512"},s={name:"HMAC",hash:"SHA-1"};function l(e,t){const n=(0,r.castTypedArrays)(Uint8Array,t);return self.crypto.subtle.importKey("raw",n,e,!1,["sign"]).then((t=>({key:t,algo:e})))}function c(e,t,n){let{key:r,algo:i}=e;return self.crypto.subtle.sign(i,r,t).then((e=>null!=n&&0!==n?e.slice(0,n):e))}},899:(e,t,n)=>{"use strict";var r=n(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.LtHash16=t.LT_HASH_ANTI_TAMPERING=t.KEY_LENGTH_BYTES=t.EMPTY_LT_HASH=void 0;var i=r(n(11504)),a=n(81576);const o=128;t.KEY_LENGTH_BYTES=o;const s=new ArrayBuffer(o);t.EMPTY_LT_HASH=s;class l{constructor(e){this.salt=e}add(e,t){var n=this;return t.reduce(function(){var e=(0,i.default)((function*(e,t){return n._addSingle(yield e,t)}));return function(){return e.apply(this,arguments)}}(),Promise.resolve(e))}subtract(e,t){var n=this;return t.reduce(function(){var e=(0,i.default)((function*(e,t){return n._subtractSingle(yield e,t)}));return function(){return e.apply(this,arguments)}}(),Promise.resolve(e))}subtractThenAdd(e,t,n){var r=this;return(0,i.default)((function*(){return r.add(yield r.subtract(e,n),t)}))()}_addSingle(e,t){var n=this;return(0,i.default)((function*(){const r=yield(0,a.extractAndExpand)(t,n.salt,o);return n.performPointwiseWithOverflow(e,r,((e,t)=>e+t))}))()}_subtractSingle(e,t){var n=this;return(0,i.default)((function*(){const r=yield(0,a.extractAndExpand)(t,n.salt,o);return n.performPointwiseWithOverflow(e,r,((e,t)=>e-t))}))()}performPointwiseWithOverflow(e,t,n){const r=new DataView(e),i=new DataView(t),a=new ArrayBuffer(r.byteLength),o=new DataView(a);for(let e=0;e<r.byteLength;e+=2)o.setUint16(e,n(r.getUint16(e,!0),i.getUint16(e,!0)),!0);return a}}t.LtHash16=l;const c=new l("WhatsApp Patch Integrity");t.LT_HASH_ANTI_TAMPERING=c},73045:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sha256=i,t.sha256Base64=function(e){return Promise.resolve(i(e).then(r.encodeB64))};var r=n(15688);function i(e){return Promise.resolve(self.crypto.subtle.digest({name:"SHA-256"},e))}},7589:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.areBuffersEqual=function(e,t){return i(new Uint8Array(e),new Uint8Array(t))},t.areBytesEqual=i,t.randomNumberLessThan=function(e){if(e!==(0|e))throw new Error("bound must be int32");if(e<=0)throw new Error("bound must not be positive");const t=new Int32Array(1),n=e*Math.floor((-1>>>1)/e);let r=-1;for(;-1===r;){self.crypto.getRandomValues(t);const i=t[0]>>>1;i<n&&(r=i%e)}return r};var r=n(13059);function i(e,t){return 0===e.length&&0===t.length||(0,r.verify)(e,t)}},13059:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"box",{enumerable:!0,get:function(){return r.box}}),Object.defineProperty(t,"hash",{enumerable:!0,get:function(){return r.hash}}),Object.defineProperty(t,"lowlevel",{enumerable:!0,get:function(){return r.lowlevel}}),Object.defineProperty(t,"scalarMult",{enumerable:!0,get:function(){return r.scalarMult}}),Object.defineProperty(t,"setPRNG",{enumerable:!0,get:function(){return r.setPRNG}}),Object.defineProperty(t,"sign",{enumerable:!0,get:function(){return r.sign}}),Object.defineProperty(t,"verify",{enumerable:!0,get:function(){return r.verify}});var r=n(14462)},96573:(e,t,n)=>{"use strict";var r=n(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.addMessageIds=function(e,t){if(null!=t){const n=new Set;[e.ids,t].forEach((e=>e.forEach((e=>{n.has(e)||n.add(e)})))),e.ids=Array.from(n.values())}},t.buildEntry=function(e,t){if(!e||0===e.length)throw new Error("FtsIndexEntry: Expected non-empty blindIndices in constructor");return{ids:(0,i.default)(t,"ids"),prefixes:e,token:e[e.length-1]}};var i=r(n(45095))},44152:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.buildEntry=function(e,t,n,r){return{id:e,chatId:t,token:n,timestamp:r}}},14056:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.buildDBEntry=function(e,t,n,r,i){return{ftsRowId:e,id:t,chatId:n,timestamp:r,prefixes:i}},t.buildEntry=function(e,t,n,r){return{id:e,chatId:t,timestamp:n,prefixes:r}}},66543:(e,t,n)=>{"use strict";var r=n(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.getConfig=function(){return o().config},t.getJidUtilsApi=function(){return o().jidUtils},t.getMyDeviceJid=function(){var e;const t=null===(e=o().myJids)||void 0===e?void 0:e.deviceJid;if(null==t)throw(0,i.default)("Trying to access myDeviceJid, but it's not set");return t},t.getMyUserJid=function(){var e;const t=null===(e=o().myJids)||void 0===e?void 0:e.userJid;if(null==t)throw(0,i.default)("Trying to access myUserJid, but it's not set");return t},t.setGlobals=function(e){a=e},t.setMyJids=function(e,t){const n=o();if(null!=n.myJids)throw(0,i.default)("Trying to set UserJid and DeviceJid but they are already set");n.myJids={userJid:e,deviceJid:t}};var i=r(n(24935));let a=null;function o(){if(null==a)throw(0,i.default)("Trying to access WAGlobals before being set");return a}},24935:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=new Error(e);if(void 0===t.stack)try{throw t}catch(e){}return t}},18269:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UnsatisfiableJobRequirement=t.JobRequirement=void 0,t.joinRequirements=function(e,t){const n=e.filter((e=>!e.isSatisfiable()));if(n.length>0){const e=n.map((e=>e.name));return r=>(null==t||t("unsatisfiable",e,r),n[0].waitUntilSatisfied())}let r=e.map((()=>Promise.resolve())),i=Promise.resolve(),a=null;const o=()=>{if(r.every(((t,n)=>t===e[n].waitUntilSatisfied())))return void(a=null);const t=[],n=e.map((e=>{const n=e.waitUntilSatisfied();return e.isSatisfied()||(t.push(e.name),n.then((()=>{const n=t.indexOf(e.name);t.splice(n,1)}))),n}));return r=n,a=t,Promise.all(n).then(o)};return e=>{if(null==a){const e=o();null!=e&&(i=i.then((()=>e)))}return null==t||t(null==a?"satisfied":"unsatisfied",a,e),i}};class n{constructor(e){this._waitingOn=Promise.resolve(),this._satisfied=!0,this._newBlockers=null,this._blockersFinished=()=>{const e=this._newBlockers;if(null!=e)return this._newBlockers=null,Promise.all(e).then(this._blockersFinished);this._satisfied=!0},this.name=e}addBlocker(e){const t=e.catch((e=>{__LOG__(4,void 0,new Error,!0)`JobRequirement[${this.name}] blocker errored ${e}`,SEND_LOGS("job-blocker-rejected")}));if(this._satisfied)this._satisfied=!1,this._waitingOn=Promise.all([this._waitingOn,t]).then(this._blockersFinished);else{const e=this._newBlockers;null!=e?e.push(t):this._newBlockers=[t]}}waitUntilSatisfied(){return this._waitingOn}isSatisfied(){return this._satisfied}isSatisfiable(){return!0}}t.JobRequirement=n;t.UnsatisfiableJobRequirement=class extends n{constructor(e){super(e),super.addBlocker(new Promise((()=>{})))}addBlocker(){}isSatisfiable(){return!1}}},47901:(e,t,n)=>{"use strict";var r=n(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.UNSTARTED_JOB=t.RetryOnBackoff=t.RequiresPage=t.PersistedJobManager=t.InterruptJob=t.FINISHED_JOB=void 0;var i=r(n(11504)),a=n(18269),o=n(37178),s=n(92844);class l{constructor(e){this.feature=e}toString(){return`RequiresPage: ${this.feature}`}}t.RequiresPage=l;class c{constructor(e){this.backoffOptions=e}toString(){return"RetryOnBackoff"}}t.RetryOnBackoff=c;class d{constructor(e){this.result=e}}t.InterruptJob=d;const u="$unstarted";t.UNSTARTED_JOB=u;const p="$finished";t.FINISHED_JOB=p;function f(e){return`Job[${e.jobId}] (${e.type})`}function h(e){return`Job[${e.jobId}] (${e.type}.${e.step})`}function _(e,t,n){"unsatisfiable"===e?__LOG__(2)`${h(n)} halting because of ${t}`:"unsatisfied"===e&&__LOG__(2)`${h(n)} waiting on ${t}`}function g(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return{jobStartTime:e.startTime,afterCrash:t,interruptJob:m}}function m(e){return new d(e)}t.PersistedJobManager=class{constructor(e){const{isRestartAfterCrash:t,accessors:n,unfinishedJobEntries:r}=e,i=new Map,a=r.then((e=>{const r=[],a=[];return e.forEach((e=>{e.stepHardStartCountAfterTimeout>=5?r.push(e):a.push(e)})),Promise.all(r.map((e=>{var t;return __LOG__(4,void 0,new Error,!0)`${t=e,`[Job ${t.type}] `}: stuck on the step ${e.step}, aborting the job`,SEND_LOGS(`job-stuck-${e.type}`),n.deletePersistedJob(e.jobId)}))).then((()=>{a.forEach((e=>{i.has(e.jobId)||(__LOG__(2)`${f(e)}: restarting`,i.set(e.jobId,this._runJob(e,t)))}))}))}));this.implementationLoaders=new Map,this.implementations=new Map,this.stepBlockers=new WeakMap,this.accessors=n,this.activeJobs=i,this.initialJobsPromise=a,this.listeners=e.listeners,this.deprecatedJobs=e.deprecatedJobs}loadAndRunJobFromId(e){const t=this.activeJobs.get(e);if(null!=t)return t;const n=this._loadAndRunJobFromId(e);return this.activeJobs.set(e,n),n}_loadAndRunJobFromId(e){var t=this;return(0,i.default)((function*(){const{initialJobsPromise:n,accessors:r}=t;yield n;const i=yield r.readPersistedJob(e);return i?t._runJob(i,!1):(__LOG__(4,void 0,new Error,!0)`No entry for job ${e}`,SEND_LOGS("missing-job-entry"),null)}))()}_getJobImplementation(e){const{implementations:t,implementationLoaders:n}=this,r=t.get(e);if(r)return r;const i=n.get(e);if(!i)return null;const a=i();return t.set(e,a),a}_waitForBlockers(e,t){if(null==t||0===t.length)return Promise.resolve();const{stepBlockers:n}=this;let r=n.get(t);return null==r&&(r=(0,a.joinRequirements)(t.map((e=>e())),_),n.set(t,r)),r(e)}_runRemainingSteps(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0;const{step:i}=e,a=t.findIndex((e=>e.stepName===i)),{requirements:o,code:l}=t[a].info(e.current,e.original,g(e,n));let c=this._waitForBlockers(e,o);return r&&(c=c.then(r)),c.then((()=>(__LOG__(2)`${h(e)}: running step`,l(e.current,e.original,g(e,n))))).then((r=>{if(r instanceof d)return __LOG__(2)`${h(e)}: InterruptJob`,r.result;const i=a+1;if(i>=t.length)return r;const o=t[i];return e.step=o.stepName,e.current=r,e.stepHardStartCountAfterTimeout=0,e.stepFirstStartTime=(0,s.unixTime)(),e.stepUnexpectedErrorCount=0,e.waitUntil=null,e.backedOffCount=0,this.accessors.updatePersistedJob(e).then((()=>this._runRemainingSteps(e,t,n)))}))}_runJob(e,t){var n=this;return(0,i.default)((function*(){var r;const{accessors:a,activeJobs:d,deprecatedJobs:_,listeners:{onJobFinished:m,onJobStarted:y}}=n;let E=yield n._getJobImplementation(e.type);const S=_[e.type];if(!E){if(!S)return __LOG__(4,void 0,new Error,!0)`No implementation for ${e.type}. Maybe it should have been put to the deprecated list?`,SEND_LOGS("missing-job-implementation"),yield a.deletePersistedJob(e.jobId),null;if("NOOP"===S)return __LOG__(3)`No implementation for deprecated ${e.type}, job deleted`,yield a.deletePersistedJob(e.jobId),null;E=yield S()}const v=E;S&&__LOG__(2)`Running deprecated job ${e.type}`;const T=null!==(r=e.stepFirstStartTime)&&void 0!==r?r:(0,s.unixTime)();if(e.stepFirstStartTime=T,e.stepUnexpectedErrorCount=e.stepUnexpectedErrorCount||0,e.backedOffCount=e.backedOffCount||0,e.step===p){let t=e.waitUntil;const r=(0,s.secondsUntil)(T);return null!=t&&(0,s.isInFuture)(t)&&r>0&&(__LOG__(2)`${f(e)}: skew detected, adjusting accordingly`,t=(0,s.castToUnixTime)(t-r),(0,s.isInFuture)(t)&&(e.stepFirstStartTime=(0,s.castToUnixTime)(T-r),e.waitUntil=t,yield n.accessors.updatePersistedJob(e))),null!=t&&(0,s.isInFuture)(t)||(__LOG__(2)`${f(e)}: removing completed, expired job from db`,yield a.deletePersistedJob(e.jobId)),d.delete(e.jobId),e.current}const b=e.step!==u?E.find((t=>t.stepName===e.step)):E[0];if(!b)return __LOG__(4,void 0,new Error,!0)`No implementation for ${e.type}.${e.step}`,SEND_LOGS("missing-job-step"),yield a.deletePersistedJob(e.jobId),null;e.step=b.stepName;const C=()=>{const r=e.waitUntil;let i=Promise.resolve();if(null!=r){const t=(0,s.futureUnixTime)(s.DAY_SECONDS);r>t?(__LOG__(2)`${h(e)}: trim wait from ${r} to ${t}`,e.waitUntil=t,i=n.accessors.updatePersistedJob(e).then((()=>(0,s.delayUntil)(t)))):(__LOG__(2)`${h(e)}: delaying until ${r}`,i=(0,s.delayUntil)(r))}return i.then((()=>n._runRemainingSteps(e,v,t,(()=>(e.waitUntil=null,(0,s.happenedWithin)(T,s.DAY_SECONDS)||e.stepHardStartCountAfterTimeout++,n.accessors.updatePersistedJob(e)))).catch((t=>{if(t instanceof l)return __LOG__(2)`${h(e)}: requires page`,e.stepHardStartCountAfterTimeout>0&&(--e.stepHardStartCountAfterTimeout,n.accessors.updatePersistedJob(e)),new Promise((()=>{}));if(t instanceof c){__LOG__(2)`${h(e)}: RetryOnBackoff`;const r=(0,o.getDelay)(++e.backedOffCount,t.backoffOptions);return e.waitUntil=(0,s.futureUnixTime)(Math.ceil(r/1e3)),e.stepHardStartCountAfterTimeout>0&&--e.stepHardStartCountAfterTimeout,n.accessors.updatePersistedJob(e).then(C)}if(e.stepUnexpectedErrorCount<1)return __LOG__(3)`${h(e)}: Unhandled exception. Tried ${e.stepUnexpectedErrorCount} times`,e.stepUnexpectedErrorCount++,n.accessors.updatePersistedJob(e).then(C);throw t}))))},A=C(),P=A.then(function(){var t=(0,i.default)((function*(t){__LOG__(2)`${h(e)}: finished job`;let r=null;try{r=m(e.jobId,e.type,e.original,t)}catch(t){__LOG__(4,void 0,new Error,!0)`onJobFinished for ${e.type} threw exception ${t}`,SEND_LOGS("onJobFinished-threw")}null!=r&&r>0?(e.waitUntil=(0,s.futureUnixTime)(Math.ceil(r/1e3)),e.step=p,e.current=t,e.stepFirstStartTime=(0,s.unixTime)(),yield n.accessors.updatePersistedJob(e)):(yield a.deletePersistedJob(e.jobId),d.delete(e.jobId))}));return function(){return t.apply(this,arguments)}}(),function(){var n=(0,i.default)((function*(n){__LOG__(4,void 0,new Error,!0)`${e.type} failed with error ${n}`,SEND_LOGS(`job-threw-exception-${e.type}`);const r=v.find((t=>t.stepName===e.step));if(r){const n=r.info(e.current,e.original,g(e,t));null!=n.stopRetryIf&&(yield n.stopRetryIf.onStopRetry(e.current,e.original,g(e,t)))}else __LOG__(4,void 0,new Error)`${e.type}: ${e.step} step not found`;yield a.deletePersistedJob(e.jobId),d.delete(e.jobId)}));return function(){return n.apply(this,arguments)}}());try{y(e.jobId,e.type,e.original)}catch(t){__LOG__(4,void 0,new Error,!0)`onJobStarted for ${e.type} threw exception ${t}`,SEND_LOGS("onJobStarted-threw")}return P.then((()=>A))}))()}addPersistedJobImplementation(e,t){const{implementationLoaders:n,deprecatedJobs:r}=this;if(n.has(e))return __LOG__(4,void 0,new Error,!0)`addPersistedJobImplementation called twice for ${e}`,void SEND_LOGS("repeat-job-loader");r&&r[e],n.set(e,t)}fireAndForget(e){this.accessors.maybeCreateJob(e).then((e=>{let{id:t}=e;return this.loadAndRunJobFromId(t)}))}waitUntilPersisted(e){return this.accessors.maybeCreateJob(e).then((e=>{let{id:t}=e;this.loadAndRunJobFromId(t)}))}waitUntilCompleted(e){return this.accessors.maybeCreateJob(e).then((e=>{let{id:t}=e;return this.loadAndRunJobFromId(t)}))}}},89385:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AbortError=t.ABORT_ERROR=void 0,t.catchAbort=function(e){return t=>{if(t.name===a)return e(t);throw t}};var r=n(40265);class i extends((0,r.customError)("AbortError")){}t.AbortError=i;const a="AbortError";t.ABORT_ERROR=a},52613:(e,t,n)=>{"use strict";var r=n(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.asyncSleep=o,t.asyncSleepAfterGivenLoopIteration=function(){return a.apply(this,arguments)};var i=r(n(11504));function a(){return(a=(0,i.default)((function*(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:200;e>0&&e%t==0&&(yield o(n))}))).apply(this,arguments)}function o(e){return new Promise((t=>setTimeout(t,e)))}},30844:(e,t,n)=>{"use strict";var r=n(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(11504)),a=r(n(73982)),o=r(n(45095)),s=r(n(9006));t.default=class{constructor(e,t){this._concurrency=e,this._groupLimits=t,this._runningTasksByGroup=new Map,this._enqueuedTasksByGroup=new Map}clearQueue(){this._enqueuedTasksByGroup.clear(),this._runningTasksByGroup.clear()}enqueue(e,t){let n,r;const o=new Promise(((e,t)=>{n=e,r=t}));var s;return this._doEnqueue((0,a.default)((0,a.default)({},t),{},{run:(s=(0,i.default)((function*(){try{const t=yield e();n(t)}catch(e){r(e)}})),function(){return s.apply(this,arguments)})})),this._runTasks(),o}_doEnqueue(e){this._getOrCreatePriorityQueueForGroup(e.group).push(e)}_doDequeue(){return this._getHighestPriorityAmongGroups()}_runTasks(){for(;this._getRunningTasksCount()<this._concurrency;){const e=this._doDequeue();if(null==e)break;this._runTask(e)}}_runTask(e){var t=this;return(0,i.default)((function*(){const{run:n,signal:r,group:i}=e,a=t._getRunningTasksForGroup(i);if(null==r?void 0:r.aborted)setTimeout((()=>t._runTasks()),0);else{a.add(e);try{yield n()}finally{a.delete(e),setTimeout((()=>t._runTasks()),0)}}}))()}_getHighestPriorityAmongGroups(){var e;let t;for(const e of this._enqueuedTasksByGroup.values()){const n=e.peek();n&&(this._isFullOfGroup(n.group)||(!t||t.priority<n.priority)&&(t=e))}return null===(e=t)||void 0===e?void 0:e.pull()}_getRunningTasksCount(){let e=0;for(const t of this._runningTasksByGroup.values())e+=t.size;return e}getEnqueuedTasksCount(){let e=0;for(const t of this._enqueuedTasksByGroup.values())e+=t.size();return e}_getRunningTasksForGroup(e){if(!this._runningTasksByGroup.has(e)){const t=new Set;return this._runningTasksByGroup.set(e,t),t}return(0,o.default)(this._runningTasksByGroup.get(e),"this._runningTasksByGroup.get(group)")}_isFullOfGroup(e){const t=this._runningTasksByGroup.get(e);return null!=t&&t.size>=this._getLimitForGroup(e)}_getOrCreatePriorityQueueForGroup(e){if(!this._enqueuedTasksByGroup.has(e)){const t=new s.default((e=>e.priority));this._enqueuedTasksByGroup.set(e,t)}return(0,o.default)(this._enqueuedTasksByGroup.get(e),"this._enqueuedTasksByGroup.get(group)")}_getLimitForGroup(e){const t=this._groupLimits[e];return null==t?1/0:t}}},50796:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.filteredCatch=function(e,t){return n=>{if(Array.isArray(e)?e.some((e=>n instanceof e)):n instanceof e)return t(n);throw n}}},27722:(e,t,n)=>{"use strict";var r=n(59182).default,i=n(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(89385),o=i(n(47259));t.default=class{constructor(){this._lastPromise=Promise.resolve(),this._controller=new r,this._pending=[]}enqueue(e){e.catch((()=>{}));const t=()=>e,n=this._controller.signal;this._lastPromise=this._lastPromise.then(t,t);const r=(0,o.default)(this._lastPromise,n).catch((0,a.catchAbort)((e=>{var t;throw null!==(t=this._cancellationError)&&void 0!==t?t:e})));return this._pending.push(r),r.finally((()=>{this._pending.length>0&&this._pending[0]===r&&this._pending.shift()}))}cancelAll(e){this._cancellationError=e,this._pending=[],this._controller.abort(),this._controller=new r}}},856:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.promiseAny=function(e){if(0===e.length)return Promise.reject(new r.AggregateError([]));return Promise.all(e.map(i)).then((e=>{throw new r.AggregateError(e)}),(e=>e))};var r=n(40265);function i(e){return new Promise(((t,n)=>Promise.resolve(e).then(n,t)))}},37178:(e,t)=>{"use strict";function n(e){const{relativeDelay:t=!1}=e;let n=null;const a=i(e.algo);return function(){if(null==n)return n=t?Date.now():0,0;let i=r(e,a());if(t){const e=Date.now(),t=e-n;t>0&&(i=Math.max(0,i-t)),n=e}return i}}function r(e,t){let{max:n,min:r,jitter:i=.1}=e,a=t;return null!=n&&a>n&&(a=n),null!=r&&a<r&&(a=r),0!==i&&(a=Math.ceil(a*(1+i*Math.random()))),a}function i(e){switch(e.type){case"fibonacci":return function(e){let t=e.second-e.first,n=e.first-t;return function(){const e=t+n;return n=t,t=e,e}}(e);case"exponential":return function(e){const{base:t=2}=e;let n=e.first;return function(){const e=n;return n*=t,e}}(e);case"constant":return function(e){const t=e.delay;return function(){return t}}(e);case"adjust":return function(e){const{toMs:t,backoff:n}=e,r=i(n);return function(){return t(r())}}(e);default:throw new Error(`makeTimeFunc unrecognized backoff ${e.type}`)}}Object.defineProperty(t,"__esModule",{value:!0}),t.createPromiseTimer=function(e){const t=n(e);return function(e){return new Promise((n=>{const r=t();r>0?setTimeout(n,r,e):n(e)}))}},t.createTimer=n,t.getDelay=function(e,t){if(0===e)return 0;const n=i(t.algo);for(let t=1;t<e;t++)n();return r(t,n())}},18569:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;class n{constructor(e){this.promise=e,this.lastUsedTime=this.createdTime=+Date.now()}}t.default=class{constructor(e,t){let{maxCached:n=10,maxAge:r=1/0,shouldCache:i}=t;this._cache={},this._maxCached=n,this._maxAge=r,this._createPromiseFunc=e,this._shouldCacheFunc=i}getOrRun(e){const t=this._cache;if(this._maxAge!==1/0){const e=Date.now()-this._maxAge,n=Object.keys(t);for(let r=0;r<n.length;r++){const i=n[r];t[i].createdTime<e&&delete t[i]}}const r=t[e];if(r)return r.lastUsedTime=+Date.now(),r.promise;const i=Object.keys(t);if(i.length>=this._maxCached){let e,n;for(let r=0;r<i.length;r++){const a=i[r],o=t[a];(null==n||o.lastUsedTime<n)&&(n=o.lastUsedTime,e=a)}e&&delete t[e]}for(var a=arguments.length,o=new Array(a>1?a-1:0),s=1;s<a;s++)o[s-1]=arguments[s];const l=this._createPromiseFunc.apply(void 0,[e,...o]);return t[e]=new n(l),l.then((t=>{const n=this._shouldCacheFunc;n&&this._cache[e]===l&&!n(t)&&delete this._cache[e]})).catch((()=>{this._cache[e]===l&&delete this._cache[e]})),l}isCached(e){const t=this._cache[e];if(t){let e=!0;if(this._maxAge!==1/0){const n=Date.now()-this._maxAge;e=t.createdTime>=n}return e&&Boolean(t)}return!1}}},18412:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.promiseCallSync=function(e,t){try{for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return Promise.resolve(e.apply(t,r))}catch(e){return Promise.reject(e)}}},13959:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.delayMs=function(e,t){return new Promise(((n,i)=>{if(null==t?void 0:t.aborted)throw new r.AbortError;const a=setTimeout((function(){null==t||t.removeEventListener("abort",o),n()}),e);function o(){null==t||t.removeEventListener("abort",o),clearTimeout(a),i(new r.AbortError)}null==t||t.addEventListener("abort",o)}))},t.withTimeout=function(e,t,n){return new Promise(((r,i)=>{const a=setTimeout((()=>{try{r(n())}catch(e){i(e)}}),t);e.then((e=>{clearTimeout(a),r(e)}),(e=>{clearTimeout(a),i(e)}))}))};var r=n(89385)},69719:(e,t,n)=>{"use strict";var r=n(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.promiseEach=void 0;var i=r(n(11504));const a=function(){var e=(0,i.default)((function*(e,t){const n=[];for(let r=0;r<e.length;r++)n.push(yield t(e[r]));return n}));return function(){return e.apply(this,arguments)}}();t.promiseEach=a},4352:(e,t,n)=>{"use strict";var r=n(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.promiseLoop=function(){return a.apply(this,arguments)};var i=r(n(11504));function a(){return(a=(0,i.default)((function*(e,t){let n,r=!1;const i=e=>{r=!0,n=e};let a=0,o=t;for(;!r;)o=yield e(i,o,a),a++;return n}))).apply(this,arguments)}},67602:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.promiseProps=function(e){const t=Object.keys(e);return Promise.all(t.map((t=>e[t]))).then((function(e){const n={};for(let r=0;r<e.length;r++)n[t[r]]=e[r];return n}))}},27870:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PromiseQueueMap=t.PromiseQueue=void 0;t.PromiseQueue=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;this._promise=Promise.resolve(),this._maxDelay=e}wait(){return this._promise}enqueueHandlers(e,t,r){const i=this._promise.then((()=>e)).then(t,r),a=i.then();return this._promise=n(i,this._maxDelay),a}enqueue(e){const t=this._promise.then(e),r=t.then();return this._promise=n(t,this._maxDelay),r}};function n(e,t){return t>=0?new Promise((n=>{const r=()=>{n()};e.then(r,r),setTimeout(r,t)})):e.then(r,r)}function r(){}t.PromiseQueueMap=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;this._map=new Map,this._maxDelay=e}waitIfPending(e){return this._map.get(e)}wait(e){return this._map.get(e)||Promise.resolve()}enqueueHandlers(e,t,n,r){const i=this.wait(e).then((()=>t)).then(n,r);return this._addToMap(e,i)}enqueue(e,t){const n=this.wait(e).then(t);return this._addToMap(e,n)}_addToMap(e,t){const r=t.then();let i;const a=()=>{this._map.get(e)===i&&this._map.delete(e)};return i=n(t,this._maxDelay).then(a,a),this._map.set(e,i),r}}},47259:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(null==t)return e;let n;const i=t.aborted?Promise.reject(new r.AbortError):new Promise(((e,i)=>{const a=()=>{i(new r.AbortError)};t.addEventListener("abort",a),n=()=>{t.removeEventListener("abort",a)}}));return Promise.race([i,e]).finally((()=>{var e;null===(e=n)||void 0===e||e(),n=null}))};var r=n(89385)},66751:(e,t,n)=>{"use strict";var r=n(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.promiseReduce=void 0;var i=r(n(11504));const a=function(){var e=(0,i.default)((function*(e,t,n){let r=n;const i=e.length;for(let n=0;n<i;n++)r=yield t(r,e[n],n);return r}));return function(){return e.apply(this,arguments)}}();t.promiseReduce=a},72287:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PromiseRetryLoop=void 0;var r=n(37178),i=n(13959),a=n(88156);t.PromiseRetryLoop=class{constructor(e){this._resolvable=new a.Resolvable,this._promise=null,this._resetTime=null,this._currentLoopIdentificator=0,this.endWithValue=e=>{this._currentLoopIdentificator++,this._resolvable.resolve(e)},this._options=e}resetTimeoutAfter(e){this._resetTime=Date.now()+e}cancelReset(){this._resetTime=null}reset(){this._resolvable.resolveWasCalled()||(__LOG__(2)`PromiseRetryLoop: resetting ${this._options.name}`,this._currentLoopIdentificator++,this._runLoop())}start(){this._resolvable.resolveWasCalled()||(__LOG__(2)`PromiseRetryLoop: starting ${this._options.name}`,0!==this._currentLoopIdentificator&&__LOG__(4,void 0,new Error)`PromiseRetryLoop was called several times. You may have race conditions`,this._currentLoopIdentificator++,this._runLoop())}_runLoop(){const e=this._options,t=this._currentLoopIdentificator;let n=(0,r.createTimer)(this._options.timer);n();const a=()=>{if(this._resolvable.resolveWasCalled())return;if(t!==this._currentLoopIdentificator)return;const o=Date.now();return this._promise=(0,e.code)(this.endWithValue).then((()=>{if(this._resolvable.resolveWasCalled())return;const{resetDelay:t}=e;(void 0!==t&&Date.now()>=o+t||null!=this._resetTime&&this._resetTime<=Date.now())&&(__LOG__(2)`PromiseRetryLoop: resetting ${e.name}`,n=(0,r.createTimer)(this._options.timer)),this._resetTime=null;const s=n();return __LOG__(2)`PromiseRetryLoop: retrying ${e.name} in ${s}ms`,(0,i.delayMs)(s).then(a)})),this._promise};this._promise=Promise.resolve().then(a)}promise(){return this._resolvable.resolveWasCalled()?this._resolvable.promise:this._promise?Promise.race([this._resolvable.promise,this._promise.then((()=>this._resolvable.promise))]):Promise.reject(new Error(`PromiseRetryLoop ${this._options.name} had promise() called before start()`))}}},38284:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.promiseTimeout=void 0;var r=n(40265);t.promiseTimeout=(e,t,n)=>{let i=null,a=null;const o=new Promise(((e,o)=>{a=o,i=setTimeout((()=>{o(new r.TimeoutError(n)),clearTimeout(i)}),t)}));return Promise.race([e,o]).finally((()=>{a&&a(new Error),clearTimeout(i)}))}},20461:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.promiseWrapSync=function(e){return function(){try{return Promise.resolve(e.apply(this,arguments))}catch(e){return Promise.reject(e)}}}},88156:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Resolvable=void 0;t.Resolvable=class{constructor(){this._isResolved=!1,this.promise=new Promise((e=>{this._resolve=e}))}resolve(e){this._isResolved=!0,this._resolve(e)}reject(e){this.resolve(Promise.reject(e))}resolveWasCalled(){return this._isResolved}}},97197:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Semaphore=void 0;t.Semaphore=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this._count=0,this._queue=[],this._size=e}acquire(){return new Promise(((e,t)=>{this._performAcquisition(e,t)}))}availablePermits(){return this._size-this._count}_performRelease(){this._count--,this._dequeue()}_performAcquisition(e,t){if(this._count<this._size){this._count++;let t=!1;e({release:()=>{if(t)throw new Error("Permit has already been released");t=!0,this._performRelease()}})}else this._enqueue(e,t)}_enqueue(e,t){this._queue.push([e,t])}_dequeue(){if(0===this._queue.length)return;const[e,t]=this._queue.shift();this._performAcquisition(e,t)}}},74121:(e,t)=>{"use strict";t.Z=y;const n="undefined"!=typeof Promise?Promise:null,r="function"==typeof setImmediate?setImmediate:null;let i=0;const a=[],o=[],s=[],l={sentinel:"CONTINUE_AS_IF_NO_HANDLER"},c={sentinel:"RETRY_ASYNCHRONOUSLY"},d={sentinel:"TO_STRING"},u={sentinel:"DID_ERROR"};let p=null;const f=[],h=64,_=128,g=512,m="undefined"==typeof self?void 0:self;function y(e,t){this._flags=0,this._value=void 0,this._onFulfilled=void 0,this._onRejected=void 0,this._context=void 0,this._resolveLevel=0,this._control=void 0,this.x=void 0,this._thenableParent=null,this._parent=void 0,this._child=void 0,this._children=void 0,this.control=void 0,t&&(this._context=t.this),"function"==typeof e&&(this._onFulfilled=e,this._flags|=4,this._flags|=256,Y(e,this._context,(e=>R(this,0,!0,!1,e)),(e=>R(this,0,!1,!1,e))))}let E,S;function v(e){if(void 0===e)return E;if(I(e))return e;{const t=new y;return R(t,0,!0,!1,e),H(t,g),t}}function T(e){const t=new y;return t._value=e,H(t,514),f.push(t),t}function b(e){let t="";if(e._flags&_){t=(e._onFulfilled||e._onRejected).call(e._context,d)}else if(e._control)t=`.addRawControl(${e._control.name}, ${e._control.foo})`;else if(16&e._flags)t=`.endWithControls(${Object.keys(e.control)})`;else if(e._flags&g)t=1&e._flags?`Promise.resolve(${void 0===e._value?"":e._value})`:`Promise.reject(${void 0===e._value?"":e._value})`;else if(256&e._flags)switch(3&e._flags){case 2:case 0:case 1:t=`new Promise(${e._onFulfilled})`}else e._onFulfilled&&e._onRejected?t=`.then(${e._onFulfilled}, ${e._onRejected})`:e._onFulfilled?t=`.then(${e._onFulfilled})`:e._onRejected&&(t=`.catch(${e._onRejected})`);return t}function C(e){this.message=e,this.stack=new Error(e||this.name).stack}function A(){0===i&&(o.length||f.length)&&(i=1,S||(S=function(){let e,t,i=0;return"undefined"==typeof MutationObserver||m&&m.navigator&&m.navigator.standalone?n?function(){n.resolve().then(B)}:"function"==typeof r?function(){r(B)}:function(){setTimeout(B,0)}:(e=document.createTextNode(""),t=new MutationObserver(B),t.observe(e,{characterData:!0}),function(){e.data=i=1-i})}()),S())}function P(e,t){H(e,8),t._parent=e,e._children?e._children.push(t):e._child?(e._children=[e._child,t],e._child=void 0):e._child=t}function M(e){if(e&&("object"==typeof e||"function"==typeof e)){let t;try{t=e.then}catch(e){return p=e,u}if("function"==typeof t)return t}}function O(e){if(!e||I(e))return e;const t=M(e);if(t===u)return T(p);if(t){const n=new y((function(n,r){t.call(e,n,r)}));return n._thenableParent=e,n}return e}function I(e){return e instanceof y}function w(e,t,n){const r=I(e=O(e));let i,a,o,s,d=!1;if(r){if(!(3&e._flags))return H(e.then(t,n),32);H(e,8),d=!!(e._flags&h),o=e._context,i=1&e._flags?t:n,a=e._value}else i=t,a=e;if(!i)return v(e).then();if(a=W(i,o,a,!0),a===u)s=T(p);else{if(a===c)return v(e).then(t,n);if(a===l)return r?e.then():v(e);s=v(a)}return d&&(s=s.cancellable()),void 0!==o&&(s=s.then(),s._context=o),s}function R(e,t,n,r,i){if(t!==e._resolveLevel)return;const a=++e._resolveLevel;if(H(e,4),e._thenableParent=null,n)if(i===e)e._parent=void 0,U(e,!1,r,new TypeError("promise resolved to itself"));else if(I(i)){const t=3&i._flags;0===t?P(i,e):(e._parent=i,H(e,1024),H(i,8),U(e,1===t,r,i._value))}else{const t=M(i);t===u?(e._parent=void 0,U(e,!1,r,p)):t?(e._parent=void 0,e._thenableParent=i,Y(t,i,(t=>R(e,a,!0,!1,t)),(t=>R(e,a,!1,!1,t)))):U(e,!0,r,i)}else U(e,!1,r,i)}function D(e,t,n,r,i){t===e._resolveLevel&&(L(e),R(e,t,n,r,i))}function L(e){if(e._parent){const t=e._parent;if(e._parent=void 0,t._child===e)t._child=void 0;else if(t._children){const n=t._children;for(let t=0;t<n.length;t++)if(n[t]===e){n.splice(t,1);break}0===n.length&&(t._children=void 0)}}}function N(e){if(null==e)throw new Error(`Invalid .catch guard ${e}`);if("function"==typeof e)return e;if("object"==typeof e)throw new Error("Object guards in .catch are currently unsupported");return function(t){return t===e}}function k(e,t){return function(n,r){return n===d?`.catch(..., ${t})`:e&&!function(e,t){for(let n=0;n<e.length;n++){const r=e[n];if(r===Error||r.prototype instanceof Error){if(t instanceof r)return!0}else if(r(t))return!0}return!1}(e,n)?l:r?c:t.call(this,n)}}function U(e,t,n,r){if(H(e,4|(t?1:2)),e._value=r,e._child)G(e._child,t,n,r),e._child=void 0;else if(e._children){const i=e._children;e._children=void 0;for(let e=0;e<i.length;e++)G(i[e],t,n,r)}else t||8&e._flags||f.push(e)}function G(e,t,n,r){e._resolveLevel++;const i=K(e,t);if(i&&32&e._flags){H(e,4);const a=W(i,e._context,r,!0);if(a!==c)return void(a===u?(e._parent=void 0,U(e,!1,n,p)):a===l?U(e,t,n,r):(e._parent=void 0,R(e,e._resolveLevel,!0,n,a)));e._flags&=-5}i?((n?s:o).push(e),A()):U(e,t,n,r)}function x(e,t){for(;0!==e.length;)t.push(e.pop())}function B(){for(;0!==a.length||0!==o.length;){0===a.length&&x(o,a);const e=a.pop(),t=e._parent;let n=!!(t&&1&t._flags),r=t&&t._value;const i=K(e,n);if(H(e,4),i){let t;do{t=W(i,e._context,r,!1)}while(t===c);t===u?(r=p,n=!1,e._parent=void 0):t!==l&&(r=t,n=!0,e._parent=void 0)}3&e._flags||(R(e,e._resolveLevel,n,!0,r),x(s,a))}for(i--;0!==f.length;){const e=f.pop();8&e._flags||j(e,e._value)}}y.resolve=v,y.reject=T,y.prototype.then=function(e,t){"function"!=typeof e&&(e=void 0),"function"!=typeof t&&(t=void 0);const n=new y;n._onFulfilled=e,n._onRejected=t,n._context=this._context,this._flags&h&&H(n,h);const r=3&this._flags;return 0===r?P(this,n):(H(this,8),(1===r?e:t)?(n._parent=this,o.push(n),A()):(n._parent=this,H(n,r),n._value=this._value,2===r&&f.push(n))),n},y.prototype.catch=function(e){const t=arguments.length-1;if(0===t)return this.then(void 0,e);const n=new Array(t);for(let e=0;e<t;e++)n[e]=N(arguments[e]);const r=k(n,arguments[t]),i=w(this,void 0,r);return i._onRejected&&H(i,_),i},y.all=function(e){return new y((function(t,n){let r=e.length;if(0===r)return void t([]);const i=new Array(e.length);function a(e){if(0==--r){const n=[];for(let t=0;t<i.length;t++){const r=i[t];n.push(r&&3&r._flags?r._value:e)}t(n)}return e}for(let t=0;t<e.length;t++)i[t]=w(e[t],a,n)}))},y.allSettled=function(e){return new y((function(t){const n=Array.from(e);let r=n.length;if(0===r)return void t([]);const i=new Array(n.length);function a(e){return function(n){const a=e?{status:"rejected",reason:n}:{status:"fulfilled",value:n};if(0==--r){const e=[];for(let t=0;t<i.length;t++){const n=i[t];e.push(n&&3&n._flags?n._value:a)}t(e)}return a}}const o=a(!1),s=a(!0);for(let e=0;e<n.length;e++)i[e]=w(n[e],o,s)}))},y.race=function(e){const t=O(e);if(I(t)){const e=t.then((e=>y.race(e)));return e._context=void 0,e._flags&=-65,e}return new y((function(e,n){for(let r=0;r<t.length;r++){const i=O(t[r]);if(!I(i)||3&i._flags)for(e(i),r++;r<t.length;r++){const e=t[r];I(e)&&H(e,8)}else i.then(e,n)}}))},y.prototype.toString=function(){const e=[];let t;for(let n=this,r=!1;n;n=n._parent){t=n,!r&&3&n._flags&&(r=!0,n._flags&g||(1&n._flags?e.push(`[resolved value: ${n._value}]`):e.push(`[rejected reason: ${n._value}]`)));let i=b(n);1024&n._flags&&(i=`~${i}`),e.push(i)}return e.reverse(),768&t._flags||(e[0]=`[Promise]${e[0]}`),e.join("\n")},y.prototype.finally=function(e){function t(t){return t===d?`.finally(${e})`:(e.call(this),l)}return H(this.then(t,t),_)},C.prototype=Object.create(Error.prototype,{name:{value:"AbortError"}}),y.CancellationError=C,y.prototype.cancellable=function(){return H(this.then(),h)},y.prototype.cancel=function(e){let t;for(let e=this;e&&!(3&e._flags);e=e._parent)e._flags&h&&(t=e);if(t)if(void 0===e&&(e=new C),K(t,!1)){const n=new y;L(t),P(n,t),D(n,0,!1,!1,e)}else D(t,t._resolveLevel,!1,!1,e)};const F=null==(null==m?void 0:m.dispatchEvent)?null:class extends Event{constructor(e,t){super(e,{cancelable:!0}),Object.defineProperties(this,{promise:{value:t.promise,enumerable:!0},reason:{value:t.reason,enumerable:!0}})}};function j(e,t){if(null!=(null==m?void 0:m.dispatchEvent)){const n=new F("unhandledrejection",{promise:e,reason:t});if(m.dispatchEvent(n),!m.PromiseRejectionEvent&&m.onunhandledrejection)try{m.onunhandledrejection(n)}catch(e){}}else"undefined"!=typeof process&&null!=process.emit?process.emit("unhandledRejection",t,e):console.error(`StackPromise did not catch ${t}`,e,t)}function Y(e,t,n,r){try{e.call(t,n,r)}catch(e){r(e)}}function K(e,t){if(!(4&e._flags))return t?e._onFulfilled:e._onRejected}function W(e,t,n,r){try{return r?e.call(t,n,!0):e.call(t,n)}catch(e){return p=e,u}}function H(e,t){return e._flags|=t,e}E=new y,R(E,0,!0,!1,void 0)},8243:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.decimalStringToLongInt=function(e){if(!/^-?\d+$/.test(e))throw __LOG__(2)`"${e}" is not a valid decimal string`,new Error("decimalStringToLongInt is given an invalid decimal string");const t="-"===e[0],n=e.replace(/^-?0*/,""),i=n.length;if(i<16||16===i&&n<="9007199254740991")return t?-Number(n):Number(n);if(i>20||20===i&&n>"18446744073709551615"||t&&(i>19||19===i&&n>"9223372036854775807"))throw __LOG__(2)`"${e}" is over 64 bits`,new Error("decimalStringToHexLong is given value over 64 bits");let a=0,o=0;for(let e=0;e<i;e++)a=10*a+Number(n[e]),o=10*o+Math.floor(a/4294967296),a%=4294967296;return(0,r.createHexLongFrom32Bits)(o,a,t)},t.isBiggerLongInt=function(e,t){if("number"==typeof e&&"number"==typeof t)return e>t;const n="number"==typeof e?(0,r.hexLongFromNumber)(e):e,i="number"==typeof t?(0,r.hexLongFromNumber)(t):t;return(0,r.isBiggerHexLong)(n,i)},t.longIntToDecimalString=function(e){if("number"==typeof e)return e.toString(10);const t=(0,r.hexLongToHex)(e),n=[0];let i=0;for(let e=0;e<t.length;e++){i=(0,r.hexAt)(t,e);for(let e=0;e<n.length;e++)n[e]=16*n[e]+i,i=n[e]/10|0,n[e]%=10;for(;i>0;)n.push(i%10),i=i/10|0}const a=n.reverse().join("");return(0,r.hexLongIsNegative)(e)?"-"+a:a},t.maybeNumberOrThrowIfTooLarge=void 0,t.numberOrThrowIfTooLarge=i;var r=n(87614);function i(e){if("number"!=typeof e)throw __LOG__(2)`${e} is not a safe integer`,new Error("numberOrThrowIfTooLarge is given a non-safe integer");return e}t.maybeNumberOrThrowIfTooLarge=e=>null==e?e:i(e)},42098:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Spec=void 0,t.compileSpec=function(e){if(e.internalCompiledSpec)return e.internalCompiledSpec;const t=e.internalSpec;if(!t)throw new Error(`Message Class ${String(e)} does not have internalSpec`);const n=e.internalDefaults||{},o=Object.keys(t).filter((e=>e!==r.KEYS.ONEOF)),s=new Array(o.length),l=[],c=[],d=new Array(o.length),u=t[r.KEYS.ONEOF]||{};o.sort(((e,n)=>{const r=a(t,e),i=a(t,n);return r[0]-i[0]}));for(let e=0;e<o.length;e++){const i=o[e],u=a(t,i);d[e]=n[i];const p=u[1],f=u[0];if(l.push(f),c.push(p),(p&r.TYPE_MASK)===r.TYPES.MESSAGE)s[e]=u[2];else if((p&r.TYPE_MASK)===r.TYPES.ENUM){const t=u[2];if("function"==typeof t.cast)s[e]=t;else{let n,r=!0,i=0;for(const e in t)r&&e!==i++&&(r=!1);if(r){n=[];for(let e=0;e<i;e++)n.push(!0)}else{n={};for(const e in t)n[t[e]]=!0}s[e]=n}}else s[e]=null}const p={};for(const e in u)u[e].forEach((t=>{p[t]||(p[t]=[]),p[t].push(e)}));const f=t[r.KEYS.RESERVED]&&t[r.KEYS.RESERVED][r.KEYS.RESERVED_TAGS],h=t[r.KEYS.RESERVED]&&t[r.KEYS.RESERVED][r.KEYS.RESERVED_FIELDS],_=new i(o,l,c,d,s,u,p,f,h);return e.internalCompiledSpec=_,_};var r=n(1390);class i{constructor(e,t,n,r,i,a,o,s,l){this.names=e,this.fields=t,this.types=n,this.defaults=r,this.meta=i,this.oneofToFields=a,this.fieldToOneof=o,this.reservedTags=s?s.reduce(((e,t)=>(e[t]=!0,e)),{}):{},this.reservedFields=l?l.reduce(((e,t)=>(e[t]=!0,e)),{}):{}}}function a(e,t){const n=e[t];if(null==n)throw new Error(`fieldData of ${t} is missing`);return n}t.Spec=i},1390:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TYPE_MASK=t.TYPES=t.KEYS=t.FLAGS=t.ENC=void 0;t.FLAGS={REPEATED:64,PACKED:128,REQUIRED:256};t.TYPE_MASK=31;t.TYPES={INT32:1,INT64:2,UINT32:3,UINT64:4,SINT32:5,SINT64:6,BOOL:7,ENUM:8,FIXED64:9,SFIXED64:10,DOUBLE:11,STRING:12,BYTES:13,MESSAGE:14,FIXED32:15,SFIXED32:16,FLOAT:17};t.ENC={VARINT:0,BIT64:1,BINARY:2,BIT32:5};t.KEYS={ONEOF:"__oneofs__",RESERVED:"__reserved__",RESERVED_TAGS:"tags",RESERVED_FIELDS:"fields"}},72058:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.typeToEncType=function(e){if(e&a.PACKED)return l.BINARY;const t=e&s;return t<=o.ENUM?l.VARINT:t<=o.DOUBLE?l.BIT64:t<=o.MESSAGE?l.BINARY:l.BIT32};var r=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=i(t);if(n&&n.has(e))return n.get(e);var r={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=a?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(r,o,s):r[o]=e[o]}r.default=e,n&&n.set(e,r);return r}(n(1390));function i(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(i=function(e){return e?n:t})(e)}const{FLAGS:a,TYPES:o,TYPE_MASK:s,ENC:l}=r},49259:(e,t,n)=>{"use strict";var r=n(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.checkRequirements=l,t.checkValid=function(e,t){l(e,t);const n=_(t,e);if(n)throw n.path.reverse(),new TypeError(`Invalid value at ${n.path.join(".")}: ${n.error}`)};var i=r(n(33344)),a=n(42098),o=n(1390);const s=Number.MAX_SAFE_INTEGER;function l(e,t){const n=c(e,t);if(n)throw n.reverse(),new TypeError(`Message missing required value ${n.join(".")}`)}function c(e,t){const{names:n,types:r,meta:s}=(0,a.compileSpec)(e);let l;for(let e=0;e<r.length&&!l;e++){const a=r[e],d=n[e],u=(0,i.default)(t,d)?t[d]:void 0;if(a&o.FLAGS.REQUIRED&&null==u)l=[d];else if((a&o.TYPE_MASK)===o.TYPES.MESSAGE&&a&o.FLAGS.REPEATED&&null!=u){const t=s[e];let n;for(n=0;n<u.length&&!l;n++)l=c(t,u[n]);l&&l.push(`${d}[${n}]`)}else(a&o.TYPE_MASK)===o.TYPES.MESSAGE&&null!=u&&(l=c(s[e],u),l&&l.push(d))}return l}function d(e,t,n){return"string"==typeof e?!/^-?0x[0-9a-f]{16}$/i.test(e)&&(__LOG__(2)`"${f(e)}" is not a valid long`,{path:[],error:"value must be a hex string of the form '0x123...' or '-0x123...' where the tail is always 16 characters long"}):u(e,t,n)}function u(e,t,n){return"number"!=typeof e||e!=e||Math.floor(e)!==e?(__LOG__(2)`"${f(e)}" is not a valid int`,{path:[],error:"value must be an int"}):(e<t||e>=n)&&(__LOG__(2)`"${f(e)}" is out of range`,{path:[],error:"value is out of range"})}function p(e,t,n){return e?void 0:(__LOG__(2)`"${f(n)}" is not ${t}`,{path:[],error:"value is invalid"})}function f(e){return"string"==typeof e?`"${e}"`:Array.isArray(e)?`[${e.join(", ")}]`:`${e}`}const h=[void 0,e=>u(e,-2147483648,2147483648),e=>d(e,-s,s+1),e=>u(e,0,4294967296),e=>d(e,0,s+1),e=>u(e,-2147483648,2147483648),e=>d(e,-s,s+1),e=>p("boolean"==typeof e,"boolean",e),(e,t)=>p("number"==typeof e&&(t[e]||void 0!==t.cast(e)),"in enum",e),e=>d(e,0,s+1),e=>d(e,-s,s+1),e=>p("number"==typeof e,"number",e),e=>p("string"==typeof e,"string",e),e=>p(e instanceof ArrayBuffer||e instanceof Uint8Array,"ArrayBuffer or Uint8Array",e),_,e=>u(e,0,4294967296),e=>u(e,-2147483648,2147483648),e=>p("number"==typeof e,"number",e)];function _(e,t){const{names:n,fields:r,types:i,meta:s,oneofToFields:l,fieldToOneof:c,reservedTags:d,reservedFields:u}=(0,a.compileSpec)(t);let p;for(let t=0;t<n.length&&!p;t++){const a=n[t],_=i[t],g=e[a],m=_&o.TYPE_MASK,y=h[m];if(void 0===y)throw new Error(`Can not find the validator for type ${m}`);if(_&(o.FLAGS.PACKED|o.FLAGS.REPEATED)&&null!=g)if(Array.isArray(g)){const e=s[t];for(let t=0;t<g.length&&!p;t++)p=y(g[t],e),p&&p.path.push(`${a}[${t}]`)}else __LOG__(2)`"${f(g)}" is not an array`,p={path:[a],error:"repeated field must be array"};else if(null!=g){p=y(g,s[t]),p&&p.path.push(a);const n=c[a];n&&n.forEach((t=>{l[t].filter((e=>e!==a)).forEach((n=>{void 0!==e[n]&&(p={path:[t],error:`oneof has fields '${a}' and '${n}' set`})}))})),d[r[t]]&&(p={path:[a],error:`tag ${r[t]} is reserved`}),u[a]&&(p={path:[a],error:"field name is reserved"})}}return p}},84902:(e,t,n)=>{"use strict";var r=n(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.decodeProtobuf=function(e,t){const n=new a.Binary(t),r=y(e,n,void 0,!1);return(0,u.checkRequirements)(e,r),r},t.decodeProtobufWithUnknowns=function(e,t){const n=new a.Binary(t),r=y(e,n,void 0,!0);return(0,u.checkRequirements)(e,r),r},t.getUnknownFields=function(e){return(0,o.default)(e,"unsafeUnknownFields")?e.unsafeUnknownFields:null};var i=r(n(73982)),a=n(8584),o=r(n(33344)),s=n(87614),l=n(42098),c=n(1390),d=n(72058),u=n(49259);function p(e,t,n){if(e!==(0,d.typeToEncType)(t))throw new Error(`FormatError: ${n} encoded with wire type ${e}`)}function f(e,t,n){switch(t){case c.TYPES.INT32:return h(n,-2147483648,2147483648,e,a.parseInt64OrThrow);case c.TYPES.INT64:return n.readVarInt(_);case c.TYPES.UINT32:return h(n,0,4294967296,e,a.parseUint64OrThrow);case c.TYPES.UINT64:return n.readVarInt(g);case c.TYPES.SINT32:{const t=h(n,0,4294967296,e,a.parseInt64OrThrow);return 1&t?~(t>>>1):t>>>1}case c.TYPES.SINT64:return n.readVarInt(m);case c.TYPES.BOOL:return!!h(n,0,2,e,a.parseUint64OrThrow);case c.TYPES.ENUM:return n.readVarInt(a.parseInt64OrThrow);case c.TYPES.FIXED64:return n.readLong(g,!0);case c.TYPES.SFIXED64:return n.readLong(_,!0);case c.TYPES.DOUBLE:return n.readFloat64(!0);case c.TYPES.STRING:return n.readString(n.readVarInt(a.parseUint64OrThrow));case c.TYPES.BYTES:return n.readBuffer(n.readVarInt(a.parseUint64OrThrow));case c.TYPES.FIXED32:return n.readUint32(!0);case c.TYPES.SFIXED32:return n.readInt32(!0);case c.TYPES.FLOAT:return n.readFloat32(!0)}}function h(e,t,n,r,i){const a=e.readVarInt(i);if(a<t||a>=n)throw new Error(`FormatError: ${r} encoded with out-of-range value ${a}`);return a}function _(e,t){if((0,a.longFitsInDouble)(!0,e,t)){return 4294967296*e+E(t)}{const n=e<0;let r;r=n?0===t?-e:~e:e;const i=n?-t:t;return(0,s.createHexLongFrom32Bits)(r,i,n)}}function g(e,t){if((0,a.longFitsInDouble)(!1,e,t)){return 4294967296*E(e)+E(t)}return(0,s.createHexLongFrom32Bits)(e,t)}function m(e,t){let n=e>>>1,r=e<<31|t>>>1;return 1&t&&(n=~n,r=~r),_(n,r)}function y(e,t,n,r){const{names:o,fields:s,types:d,meta:u,oneofToFields:_,fieldToOneof:g,reservedTags:m,reservedFields:E}=(0,l.compileSpec)(e),{internalDefaults:S}=e,v=n||(0,i.default)({},S)||{};for(let e=0;e<o.length;e++)d[e]&c.FLAGS.REPEATED&&(v[o[e]]=[]);let T=0,b=s[0];for(;t.size();){const e=h(t,0,4294967296,"field and enc type",a.parseInt64OrThrow),n=7&e,i=e>>>3;if(i!==b){const e=T;do{++T===s.length&&(T=0),b=s[T]}while(i!==b&&T!==e)}if(i===b){const e=o[T],s=d[T];p(n,s,e);const l=s&c.TYPE_MASK,h=u[T];if(s&c.FLAGS.PACKED){const n=t.readVarInt(a.parseUint64OrThrow),r=t.readBinary(n);for(;r.size();){const t=f(e,l,r);(l!==c.TYPES.ENUM||h[t]||void 0!==h.cast(t))&&v[e].push(t)}}else if(l===c.TYPES.MESSAGE){const n=t.readVarInt(a.parseUint64OrThrow),i=t.readBinary(n);if(s&c.FLAGS.REPEATED)v[e].push(y(h,i,void 0,r));else{const t=v[e];v[e]=y(h,i,t,r)}}else{const n=f(e,l,t);(l!==c.TYPES.ENUM||h[n]||void 0!==h.cast(n))&&(s&c.FLAGS.REPEATED?v[e].push(n):v[e]=n)}const S=g[e];S&&void 0!==v[e]&&S.forEach((t=>{_[t].filter((t=>t!==e)).forEach((e=>{delete v[e]}))})),(m[i]||E[e])&&delete v[e]}else if(r){let e;switch(v.unsafeUnknownFields||(v.unsafeUnknownFields={}),n){case c.ENC.VARINT:e=t.readVarInt(a.parseInt64OrThrow);break;case c.ENC.BIT64:e=t.readBinary(8);break;case c.ENC.BINARY:e=t.readBinary(t.readVarInt(a.parseUint64OrThrow));break;case c.ENC.BIT32:e=t.readBinary(4)}v.unsafeUnknownFields[i]=e}else n===c.ENC.VARINT?t.readVarInt(a.parseInt64OrThrow):n===c.ENC.BIT64?t.advance(8):n===c.ENC.BINARY?t.advance(t.readVarInt(a.parseUint64OrThrow)):n===c.ENC.BIT32&&t.advance(4)}return v}function E(e){return e>=0?e:4294967296+e}},60980:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.encodeErrorInfo=function(){return void 0!==c?`Last encoded value for ${c}`:"No information known"},t.encodeProtobuf=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new r.Binary;return(0,l.checkValid)(e,t),_(n,t,e),c=void 0,n};var r=n(8584),i=n(87614),a=n(42098),o=n(1390),s=n(72058),l=n(49259);let c;function d(e,t){e.writeVarInt(t)}function u(e,t){if("number"==typeof t&&t<4503599627370496&&t>=-4503599627370496)e.writeVarInt(t>=0?2*t:2*-t-1);else{const n=new r.Binary;let a;"number"==typeof t?(a=t<0,n.writeVarInt(a?-t:t)):(a=(0,i.hexLongIsNegative)(t),n.writeVarIntFromHexLong(a?(0,i.negateHexLong)(t):t));const o=n.peek((()=>n.readByteArray())),s=o.byteLength;if(a){let e,t=0;do{e=o[t],o[t]=128&e|(127&e)-1&127,t++}while(255===o[t-1])}let l=a?1:0;for(let e=0;e<s;e++){const t=o[e],n=128&t|(63&t)<<1|l;l=(64&t)>>6,o[e]=n}1===l&&(o[s-1]|=128,n.writeInt8(1)),e.writeBinary(n)}}function p(e,t){"number"==typeof t?e.writeVarInt(t):e.writeVarIntFromHexLong(t)}const f=[void 0,d,p,d,p,u,u,(e,t)=>{e.writeVarInt(t?1:0)},d,(e,t)=>{"number"==typeof t?e.writeUint64(t,!0):e.writeHexLong(t,!0)},(e,t)=>{"number"==typeof t?e.writeInt64(t,!0):e.writeHexLong(t,!0)},(e,t)=>{e.writeFloat64(t,!0)},function(e,t){e.writeVarInt((0,r.numUtf8Bytes)(t)),e.writeString(t)},function(e,t){e.writeVarInt(t.byteLength),e.writeBuffer(t)},function(e,t,n){e.writeWithVarIntLength(((e,t)=>_(e,t,n)),t)},(e,t)=>{e.writeUint32(t,!0)},(e,t)=>{e.writeInt32(t,!0)},(e,t)=>{e.writeFloat32(t,!0)}],h=f.map((e=>{if(null!=e)return(e,n)=>{e.writeWithVarIntLength(t,n)};function t(t,n){for(let r=0;r<n.length;r++)e(t,n[r])}}));function _(e,t,n){const{names:r,fields:i,types:l,meta:d}=(0,a.compileSpec)(n),{internalDefaults:u}=n;for(let n=0;n<r.length;n++){const a=r[n];let p=t[a];if(null==p&&u&&(p=u[a]),null!=p){c=a;const t=i[n],r=l[n],u=r&o.TYPE_MASK,_=d[n],g=8*t|(0,s.typeToEncType)(r);if(r&o.FLAGS.PACKED){if(p.length>0){e.writeVarInt(g);(0,h[u])(e,p,_)}}else if(r&o.FLAGS.REPEATED)for(let t=0;t<p.length;t++){e.writeVarInt(g);(0,f[u])(e,p[t],_)}else{e.writeVarInt(g);(0,f[u])(e,p,_)}}}}},17793:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.KEY_TYPE=void 0,t.castToPreKeyId=f,t.castToSerializedPubKey=h,t.deserializePreKey=function(e){try{const{id:t,publicKey:n,privateKey:a}=(0,o.decodeProtobuf)(r.PreKeyRecordStructureSpec,e);return null==t||null==n||null==a?null:{id:f(t),keyPair:d((0,i.toBytes)(a,32),h(new Uint8Array(n)))}}catch(e){return null}},t.ecdh=function(e,t){return(0,a.scalarMult)(e,t.subarray(1)).buffer},t.makeKeyPair=c,t.makeKeyPairFrom=function(e){const{publicKey:t,secretKey:n}=a.box.keyPair.fromSecretKey(e);return l((0,i.ensureSize)(t,32),(0,i.ensureSize)(n,32))},t.makeKeyPairFromArrayBuffers=function(e,t){return{publicKey:(0,i.toBytes)(e,32),privateKey:(0,i.toBytes)(t,32)}},t.makeKeyPairFromSerialized=d,t.makePreKeys=function(e,t){let n=(e-1)%s;n<=0&&(n+=s);const a=[];for(let e=0;e<t;e++){const e=n===s?1:n+1,t=c(),o=(0,i.encodeSignalProto)(r.PreKeyRecordStructureSpec,{id:e,publicKey:p(t),privateKey:t.privateKey});a.push({plainObject:{id:e,keyPair:t},record:o}),n=e}return a},t.makeRawSenderKey=function(){const e=(0,i.makeBytes)(32);return self.crypto.getRandomValues(e),e},t.makeSerializedKeyPair=function(){const e=c();return u(e.privateKey,p(e))},t.makeSerializedKeyPairFrom=u,t.serializeIdentity=function(e){const t=(0,i.makeBytes)(33);return t[0]=5,t.set((0,i.ensureSize)(e,32),1),t},t.serializePubKey=p,t.toSerializedKeyPair=function(e){return u(e.privateKey,p(e))};var r=n(93638),i=n(27764),a=n(13059),o=n(84902);t.KEY_TYPE=5;const s=16777215;function l(e,t){return{publicKey:e,privateKey:t}}function c(){const{publicKey:e,secretKey:t}=a.box.keyPair();return t[0]&=248,t[31]=64|63&t[31],l((0,i.ensureSize)(e,32),(0,i.ensureSize)(t,32))}function d(e,t){return l((0,i.sliceBytes)(t,1,32),e)}function u(e,t){return{serializedPubKey:t,privateKey:e}}function p(e){const t=(0,i.makeBytes)(33);return t[0]=5,t.set(e.publicKey,1),t}function f(e){return(0,i.ensureIntInRange)(e,1,s)}function h(e){if(0===e.length||5!==e[0])throw new Error("Unrecognized public key type");return(0,i.ensureSize)(e,33)}},27764:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HMAC_SHA256=t.AES_CBC=void 0,t.castRegistrationId=function(e){return d(e)},t.castSenderKeyId=function(e){return d(e)},t.castToByteEncoded=function(e){return e},t.decodeSignalProto=function(e,t,n){return n((0,a.decodeProtobuf)(e,t))},t.encodeSignalProto=function(e,t){return(0,o.encodeProtobuf)(e,t).readByteArray()},t.ensureIntInRange=d,t.ensureSize=c,t.hkdf=function(e,t,n,i){return(0,r.extractWithSaltAndExpand)(e,t,n,i).then((e=>new Uint8Array(e)))},t.makeBytes=function(e){return new Uint8Array(e)},t.makeCryptoKey=function(e,t){let n,r;"hmac-sha256"===t?(n=l,r=["sign"]):(n=s,r=["encrypt","decrypt"]);return self.crypto.subtle.importKey("raw",e,n,!1,r)},t.makeRegistrationId=function(e){const t="extendedRange"===e?2147483646:16380;return(0,i.randomNumberLessThan)(t)+1},t.makeSenderKeyId=function(){return(0,i.randomNumberLessThan)(-1>>>1)+1},t.readBytes=function(e,t){return e.readByteArray(t)},t.sliceBytes=function(e,t,n){if(e.length-t<n)throw new Error(`Can not split off ${n} bytes from index ${t} of ${e.length} bytes`);return e.slice(t,t+n)},t.toBuffer=function(e){const t=e.buffer,n=e.byteOffset,r=e.length;return 0===n&&r===t.byteLength?t:t.slice(n,n+r)},t.toBytes=function(e,t){return c(new Uint8Array(e),t)};var r=n(81576),i=n(7589),a=n(84902),o=n(60980);const s={name:"AES-CBC"};t.AES_CBC=s;const l={name:"HMAC",hash:"SHA-256"};function c(e,t){if(e.length!==t)throw new Error(`Signal expected ${t} bytes, given ${e.length}`);return e}function d(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4294967296;if("number"==typeof e&&t<=e&&e<n&&Math.floor(e)===e)return e;throw new Error(`Expected integer in range [${t}, ${n}), given ${String(e)}`)}t.HMAC_SHA256=l},93638:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SignedPreKeyRecordStructureSpec=t.SessionStructureSpec=t.SenderSigningKeySpec=t.SenderMessageKeySpec=t.SenderKeyStateStructureSpec=t.SenderKeyRecordStructureSpec=t.SenderChainKeySpec=t.RecordStructureSpec=t.PreKeyRecordStructureSpec=t.PendingPreKeySpec=t.PendingKeyExchangeSpec=t.MessageKeySpec=t.IdentityKeyPairStructureSpec=t.ChainSpec=t.ChainKeySpec=void 0;var r=n(1390);const i={};t.SessionStructureSpec=i;const a={};t.PendingPreKeySpec=a;const o={};t.PendingKeyExchangeSpec=o;const s={};t.ChainSpec=s;const l={};t.MessageKeySpec=l;const c={};t.ChainKeySpec=c;const d={};t.RecordStructureSpec=d;const u={};t.PreKeyRecordStructureSpec=u;const p={};t.SignedPreKeyRecordStructureSpec=p;const f={};t.IdentityKeyPairStructureSpec=f;const h={};t.SenderKeyStateStructureSpec=h;const _={};t.SenderSigningKeySpec=_;const g={};t.SenderMessageKeySpec=g;const m={};t.SenderChainKeySpec=m;const y={};t.SenderKeyRecordStructureSpec=y,i.internalSpec={sessionVersion:[1,r.TYPES.UINT32],localIdentityPublic:[2,r.TYPES.BYTES],remoteIdentityPublic:[3,r.TYPES.BYTES],rootKey:[4,r.TYPES.BYTES],previousCounter:[5,r.TYPES.UINT32],senderChain:[6,r.TYPES.MESSAGE,s],receiverChains:[7,r.FLAGS.REPEATED|r.TYPES.MESSAGE,s],pendingKeyExchange:[8,r.TYPES.MESSAGE,o],pendingPreKey:[9,r.TYPES.MESSAGE,a],remoteRegistrationId:[10,r.TYPES.UINT32],localRegistrationId:[11,r.TYPES.UINT32],needsRefresh:[12,r.TYPES.BOOL],aliceBaseKey:[13,r.TYPES.BYTES]},a.internalSpec={preKeyId:[1,r.TYPES.UINT32],signedPreKeyId:[3,r.TYPES.INT32],baseKey:[2,r.TYPES.BYTES]},o.internalSpec={sequence:[1,r.TYPES.UINT32],localBaseKey:[2,r.TYPES.BYTES],localBaseKeyPrivate:[3,r.TYPES.BYTES],localRatchetKey:[4,r.TYPES.BYTES],localRatchetKeyPrivate:[5,r.TYPES.BYTES],localIdentityKey:[7,r.TYPES.BYTES],localIdentityKeyPrivate:[8,r.TYPES.BYTES]},s.internalSpec={senderRatchetKey:[1,r.TYPES.BYTES],senderRatchetKeyPrivate:[2,r.TYPES.BYTES],chainKey:[3,r.TYPES.MESSAGE,c],messageKeys:[4,r.FLAGS.REPEATED|r.TYPES.MESSAGE,l]},l.internalSpec={index:[1,r.TYPES.UINT32],cipherKey:[2,r.TYPES.BYTES],macKey:[3,r.TYPES.BYTES],iv:[4,r.TYPES.BYTES]},c.internalSpec={index:[1,r.TYPES.UINT32],key:[2,r.TYPES.BYTES]},d.internalSpec={currentSession:[1,r.TYPES.MESSAGE,i],previousSessions:[2,r.FLAGS.REPEATED|r.TYPES.MESSAGE,i]},u.internalSpec={id:[1,r.TYPES.UINT32],publicKey:[2,r.TYPES.BYTES],privateKey:[3,r.TYPES.BYTES]},p.internalSpec={id:[1,r.TYPES.UINT32],publicKey:[2,r.TYPES.BYTES],privateKey:[3,r.TYPES.BYTES],signature:[4,r.TYPES.BYTES],timestamp:[5,r.TYPES.FIXED64]},f.internalSpec={publicKey:[1,r.TYPES.BYTES],privateKey:[2,r.TYPES.BYTES]},h.internalSpec={senderKeyId:[1,r.TYPES.UINT32],senderChainKey:[2,r.TYPES.MESSAGE,m],senderSigningKey:[3,r.TYPES.MESSAGE,_],senderMessageKeys:[4,r.FLAGS.REPEATED|r.TYPES.MESSAGE,g]},_.internalSpec={public:[1,r.TYPES.BYTES],private:[2,r.TYPES.BYTES]},g.internalSpec={iteration:[1,r.TYPES.UINT32],seed:[2,r.TYPES.BYTES]},m.internalSpec={iteration:[1,r.TYPES.UINT32],seed:[2,r.TYPES.BYTES]},y.internalSpec={senderKeyStates:[1,r.FLAGS.REPEATED|r.TYPES.MESSAGE,h]}},4276:(e,t,n)=>{"use strict";var r=n(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.parseGetExperimentConfigResponseSuccess=function(e){const t=(0,s.assertTag)(e,"iq");if(!t.success)return t;const n=(0,o.parseIQResultResponse)(e);if(!n.success)return n;const r=(0,s.flattenedChildWithTag)(e,"props");if(!r.success)return r;const c=(0,s.assertAttr)(r.value,"protocol","1");if(!c.success)return c;const d=(0,s.optional)(s.attrString,r.value,"ab_key");if(!d.success)return d;const u=(0,s.optional)(s.attrString,r.value,"hash");if(!u.success)return u;const p=(0,s.optional)(s.attrIntRange,r.value,"refresh",0,void 0);if(!p.success)return p;const f=(0,s.optional)(s.attrIntRange,r.value,"refresh_id",0,void 0);if(!f.success)return f;const h=(0,s.mapChildrenWithTag)(r.value,"prop",0,1/0,l);return h.success?(0,a.makeSuccess)((0,i.default)((0,i.default)({},n.value),{},{propsAbKey:d.value,propsHash:u.value,propsRefresh:p.value,propsRefreshId:f.value,propsProp:h.value})):h},t.parseGetExperimentConfigResponseSuccessPropsProp=l;var i=r(n(73982)),a=n(87040),o=n(65363),s=n(8790);function l(e){const t=(0,s.assertTag)(e,"prop");if(!t.success)return t;const n=(0,s.mixinOr)(e,o.parseExperimentConfig,o.parseSamplingConfig,"ExperimentConfig","SamplingConfig");return n.success,n}},65363:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseExperimentConfig=function(e){const t=(0,i.assertTag)(e,"prop");if(!t.success)return t;const n=(0,i.attrIntRange)(e,"config_code",1,void 0);if(!n.success)return n;const a=(0,i.attrString)(e,"config_value");if(!a.success)return a;const o=(0,i.optional)(i.attrIntRange,e,"config_expo_key",0,void 0);return o.success?(0,r.makeSuccess)({configCode:n.value,configValue:a.value,configExpoKey:o.value}):o},t.parseIQErrorBadRequest=function(e){const t=(0,i.assertTag)(e,"error");if(!t.success)return t;const n=(0,i.assertAttr)(e,"text","bad-request");if(!n.success)return n;const r=(0,i.assertAttr)(e,"code","400");return r.success?i.voidSuccess:r},t.parseIQErrorFeatureNotImplemented=function(e){const t=(0,i.assertTag)(e,"error");if(!t.success)return t;const n=(0,i.assertAttr)(e,"text","feature-not-implemented");if(!n.success)return n;const r=(0,i.assertAttr)(e,"code","501");return r.success?i.voidSuccess:r},t.parseIQErrorInternalServerError=function(e){const t=(0,i.assertTag)(e,"error");if(!t.success)return t;const n=(0,i.assertAttr)(e,"text","internal-server-error");if(!n.success)return n;const r=(0,i.assertAttr)(e,"code","500");return r.success?i.voidSuccess:r},t.parseIQErrorResponse=function(e){const t=(0,i.assertTag)(e,"iq");if(!t.success)return t;const n=(0,i.assertAttr)(e,"type","error");return n.success?i.voidSuccess:n},t.parseIQResultResponse=function(e){const t=(0,i.assertTag)(e,"iq");if(!t.success)return t;const n=(0,i.assertAttr)(e,"type","result");return n.success?i.voidSuccess:n},t.parseSamplingConfig=function(e){const t=(0,i.assertTag)(e,"prop");if(!t.success)return t;const n=(0,i.attrIntRange)(e,"event_code",1,void 0);if(!n.success)return n;const a=(0,i.attrIntRange)(e,"sampling_weight",-1e4,1e4);return a.success?(0,r.makeSuccess)({eventCode:n.value,samplingWeight:a.value}):a},t.parseServerNotification=function(e){const t=(0,i.assertTag)(e,"notification");if(!t.success)return t;const n=(0,i.attrIntRange)(e,"t",0,void 0);if(!n.success)return n;const a=(0,i.optional)(i.attrIntRange,e,"offline",0,1024);return a.success?(0,r.makeSuccess)({t:n.value,offline:a.value}):a};var r=n(87040),i=n(8790)},8790:(e,t,n)=>{"use strict";var r=n(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.SmaxParsingFailure=void 0,t.assertAttr=function(e,t,n){const r=c(e,t);if(!r.success)return r;if(r.value!==n)return _(e,`to have "${t}"="${n}", but instead has "${r.value}"`);return s},t.assertTag=function(e,t){if(e.tag!==t)return _(e,`to be <${t}>`);return s},t.attrInt=d,t.attrIntRange=function(e,t,n,r){const i=d(e,t);if(!i.success)return i;const a=i.value;if(void 0!==n&&a<n)return _(e,`to have "${t}"={at least ${n}} but has value ${a}`);if(void 0!==r&&a>=r)return _(e,`to have "${t}"={below ${r}} but has value ${a}`);return(0,o.makeSuccess)(a)},t.attrString=c,t.childWithTag=function(e,t,n){const r=p(e,t,n);if(!r.success)return r;const i=r.value;if(null==i)return _(e,`to have 1 child <${t}>, but found 0`);return(0,o.makeSuccess)(i)},t.countChildrenWithTag=function(e,t,n,r,i){const a=m(e,t,n,r);if(!a.success)return a;const s=a.value.length;for(let e=0;e<s;e++){const t=i(a.value[e]);if(!t.success)return t}return(0,o.makeSuccess)(s)},t.emptyObject=void 0,t.errorMixinDisjunction=function(e,t,n){const r=t.map(((e,t)=>`${e}: ${n[t].error}`));return _(e,[`to match any of following mixins: ${t.join(", ")}, but all mixins failed.`,...r].join(" "))},t.flattenedChildWithTag=function(e,t){const n=u(e,t);if(!n.success)return n;if(null==n.value)return _(e,`to have 1 child <${t}>, but found 0`);return(0,o.makeSuccess)(n.value)},t.hasLiteralAttr=function(e,t,n){const r=c(e,t);return r.success&&r.value===n},t.identity=function(e){return e},t.literal=function(e,t,n,r){const i=e(t,n);if(!i.success)return i;if(i.value===r)return(0,o.makeSuccess)(r);return _(t,`to have "${n}"={${r}}, but instead has "${i.value}"`)},t.mapChildrenWithTag=function(e,t,n,r,i){const a=m(e,t,n,r);if(!a.success)return a;const s=[];for(let e=0;e<a.value.length;e++){const t=i(a.value[e]);if(!t.success)return t;s.push(t.value)}return(0,o.makeSuccess)(s)},t.mixinOr=function(e,t,n,r,a){const s=t(e);if(s.success)return(0,o.makeSuccess)((0,i.default)((0,i.default)({},s.value),{},{mixinName:r}));const l=n(e);if(l.success)return(0,o.makeSuccess)((0,i.default)((0,i.default)({},l.value),{},{mixinName:a}));return _(e,[`to match either ${r} or ${a}, but both mixins failed.`,`${r}: ${s.error}`,`${a}: ${l.error}`].join(" "))},t.optional=f,t.optionalChild=u,t.optionalLiteral=function(e,t,n,r){const i=f(e,t,n);if(!i.success)return i;if(i.value===r)return(0,o.makeSuccess)(r);if(null==i.value)return s;return _(t,`to have "${n}"={${r}}, but instead has "${i.value}"`)},t.optionallChildWithTag=p,t.voidSuccess=void 0;var i=r(n(73982)),a=r(n(33344)),o=n(87040);const s=(0,o.makeSuccess)();t.voidSuccess=s;class l extends Error{constructor(){super(...arguments),this.name="SmaxParsingFailure"}}function c(e,t){return h(e,t)?function(e,t){if("string"!=typeof t)return _(e,`decodeAsString: attribute is ${typeof t} not a string: ${String(t)}`);return(0,o.makeSuccess)(t)}(e,e.attrs[t]):_(e,`to have attribute "${t}"`)}function d(e,t){const n=c(e,t);if(!n.success)return n;const r=parseInt(n.value,10);return Number.isNaN(r)?_(e,`to have "${t}"={integer} but has value "${n.value}"`):(0,o.makeSuccess)(r)}function u(e,t){const n=g(e);if(!n.success)return n;const r=n.value;if(null==r)return s;let i=null;for(let n=0;n<r.length;n++){const a=r[n];if(a.tag===t){if(null!=i)return _(e,`to have 1 child <${t}>, but found more than 1`);i=a}}return(0,o.makeSuccess)(i)}function p(e,t,n){const r=u(e,t);return r.success?null==r.value?s:n(r.value):r}function f(e,t,n,r,i){return h(t,n)?e(t,n,r,i):s}function h(e,t){return(0,a.default)(e.attrs,t)}function _(e,t){return(0,o.makeError)(`expected <${e.tag}>: ${t}`)}function g(e){const t=e.content;return t instanceof Uint8Array?_(e,"to have children"):(0,o.makeSuccess)(t)}function m(e,t,n,r){const i=g(e);if(!i.success)return i;const a=i.value;if(null==a)return 0!==n?_(e,`to have at least ${n} <${t}> children, but found 0`):(0,o.makeSuccess)([]);const s=[];for(let e=0;e<a.length;e++){const n=a[e];n.tag===t&&s.push(n)}const l=s.length;return l<n?_(e,`to have at least ${n} <${t}> children, but found ${l}`):l>r?_(e,`to have at most ${r} <${t}> children, but found ${l}`):(0,o.makeSuccess)(s)}t.SmaxParsingFailure=l;t.emptyObject={}},76100:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.arrayBufferMod=function(e,t){const n=new Uint8Array(e);if(t>8388607)throw new Error("Divisor is too big");let r=0;for(let e=0;e<n.length;++e)r=((r<<8)+n[e])%t;return r},t.arrayBufferToString=function(e){return String.fromCharCode.apply(null,new Uint8Array(e))},t.arrayBuffersEqualUNSAFE=function(e,t){const r=new Uint8Array(e),i=new Uint8Array(t);return n(r,i)},t.concatBuffers=function(e){const t=e.map((e=>new Uint8Array(e))),n=t.reduce(((e,t)=>e+t.byteLength),0),r=new Uint8Array(n);return t.reduce(((e,t)=>(r.set(t,e),e+t.byteLength)),0),r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength)},t.largeStringToArrayBuffer=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e5;return new Promise((n=>{const r=e.length,i=new ArrayBuffer(r),a=new Uint8Array(i);let o=0;requestAnimationFrame((function s(){const l=Math.min(o+t,r);for(;o<l;)a[o]=e.charCodeAt(o),o++;if(o===r)return void n(i);requestAnimationFrame(s)}))}))},t.stringToArrayBuffer=function(e){const t=new ArrayBuffer(e.length),n=new Uint8Array(t);let r,i;for(r=0,i=e.length;r<i;r++)n[r]=e.charCodeAt(r);return n.buffer},t.uint8ArraysEqualUNSAFE=n;function n(e,t){if(e.byteLength!==t.byteLength)return!1;for(let n=0;n!==e.byteLength;n++)if(e[n]!==t[n])return!1;return!0}},47151:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.removeIndexWithoutPreservingOrder=function(e,t){const n=e.pop();t<e.length&&(e[t]=n)}},84973:e=>{e.exports=function(e){throw new Error(`Impossible value, the default statement should never be reached for value: ${e}`)}},15688:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BASE64_DATA_URL_SCHEME=void 0,t.decodeB64=function(e){const t=a(e,43,47,61);if(t)return t.buffer;throw new Error("Base64.decode given invalid string")},t.decodeB64ToJsArray=function(e){const t=e instanceof ArrayBuffer?new Uint8Array(e):a(e,43,47,61);return t&&Array.from(t)},t.decodeB64UrlSafe=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=a(e,45,95,t?61:-1);if(n)return n.buffer;throw new Error("Base64.decode given invalid string")},t.encodeB64=function(e){return r(e,43,47,!0)},t.encodeB64UrlSafe=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return r(e,45,95,t)},t.sizeWhenB64Decoded=function(e){return Math.floor(3*e.length/4)};const n=3e3;function r(e,t,r,a){const o=Array.isArray(e)||e instanceof ArrayBuffer?new Uint8Array(e):e;if(o.length<=n)return i(o,t,r,a);{const e=[];for(let s=0;s<o.length;s+=n)e.push(i(o.subarray(s,s+n),t,r,a));return e.join("")}}function i(e,t,n,r){const i=Math.ceil(4*e.length/3),a=4*Math.ceil(e.length/3),o=new Array(a);for(let t=0,n=0;t<a;t+=4,n+=3){const r=e[n]<<16|e[n+1]<<8|e[n+2];o[t]=r>>18,o[t+1]=r>>12&63,o[t+2]=r>>6&63,o[t+3]=63&r}for(let e=0;e<i;e++){const r=o[e];o[e]=r<26?65+r:r<52?71+r:r<62?r-4:62===r?t:n}for(let e=i;e<a;e++)o[e]=61;const s=String.fromCharCode.apply(String,o);return r?s:s.substring(0,i)}function a(e,t,n,r){let i=e.length;const a=new Int32Array(i+i%4);for(let o=0;o<i;o++){const s=e.charCodeAt(o);if(65<=s&&s<=90)a[o]=s-65;else if(97<=s&&s<=122)a[o]=s-71;else if(48<=s&&s<=57)a[o]=s+4;else if(s===t)a[o]=62;else{if(s!==n){if(s===r){i=o;break}return null!=self.ERROR&&__LOG__(4,void 0,new Error)`Found unexpected character code while decoding B64 at index ${o}, length ${i}: ${s}`,null}a[o]=63}}const o=a.length/4;for(let e=0,t=0;e<o;e++,t+=4)a[e]=a[t]<<18|a[t+1]<<12|a[t+2]<<6|a[t+3];const s=Math.floor(3*i/4),l=new Uint8Array(s);let c=0,d=0;for(;d+3<=s;c++,d+=3){const e=a[c];l[d]=e>>16,l[d+1]=e>>8&255,l[d+2]=255&e}switch(s-d){case 2:l[d]=a[c]>>16,l[d+1]=a[c]>>8&255;break;case 1:l[d]=a[c]>>16}return l}t.BASE64_DATA_URL_SCHEME="data:image/jpeg;base64,"},8584:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Binary=void 0,t.longFitsInDouble=u,t.numUtf8Bytes=d,t.parseInt64OrThrow=K,t.parseUint64OrThrow=W;var r=n(87614);const i=65533,a=new Uint8Array(10),o=new Uint8Array(0);class s{constructor(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.write=function(){for(let t=0;t<arguments.length;t++){const n=t<0||arguments.length<=t?void 0:arguments[t];"string"==typeof n?e.writeString(n):"number"==typeof n?e.writeUint8(n):n instanceof s?e.writeBinary(n):n instanceof ArrayBuffer?e.writeBuffer(n):n instanceof Uint8Array&&e.writeByteArray(n)}},t instanceof ArrayBuffer?(this._buffer=new Uint8Array(t),this._readEndIndex=this._writeIndex=t.byteLength):t instanceof Uint8Array&&(this._buffer=t,this._readEndIndex=this._writeIndex=t.length),this._bytesTrashed=0,this._earliestIndex=this._readIndex=0,this._view=null,this._littleEndian=n,this._hiddenReads=0,this._hiddenWrites=0}size(){return this._readEndIndex-this._readIndex}peek(e,t){this._hiddenReads++;const n=this._readIndex,r=this._bytesTrashed;try{return e(this,t)}finally{this._hiddenReads--,this._readIndex=n-(this._bytesTrashed-r)}}advance(e){this._shiftReadOrThrow(e)}readWithViewParser(e,t,n,r){return t(this._getView(),this._shiftReadOrThrow(e),e,n,r)}readWithBytesParser(e,t,n,r){return t(this._buffer,this._shiftReadOrThrow(e),e,n,r)}readUint8(){return p(this,1,h,!1)}readInt8(){return p(this,1,h,!0)}readUint16(){return p(this,2,_,arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._littleEndian)}readInt32(){return p(this,4,g,arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._littleEndian)}readUint32(){return p(this,4,m,arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._littleEndian)}readInt64(){return p(this,8,y,K,arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._littleEndian)}readUint64(){return p(this,8,y,W,arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._littleEndian)}readLong(e){return p(this,8,y,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._littleEndian)}readFloat32(){return p(this,4,E,arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._littleEndian)}readFloat64(){return p(this,8,S,arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._littleEndian)}readVarInt(e){const t=f(this,0,v,this.size());return f(this,t,T,e)}readBuffer(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.size();return 0===e?new ArrayBuffer(0):f(this,e,b)}readByteArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.size();return 0===e?new Uint8Array(0):f(this,e,C)}readBinary(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.size(),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._littleEndian;if(0===e)return new s(void 0,t);const n=f(this,e,C);return new s(n,t)}indexOf(e){if(0===e.length)return 0;const t=this._buffer,n=this._readEndIndex,r=this._readIndex;let i=0,a=r;for(let o=r;o<n;o++)if(t[o]===e[i]){if(0===i&&(a=o),i++,i===e.byteLength)return o-r-e.byteLength+1}else i>0&&(i=0,o=a);return-1}readString(e){return f(this,e,A)}ensureCapacity(e){this._maybeReallocate(this._readIndex+e)}ensureAdditionalCapacity(e){this._maybeReallocate(this._writeIndex+e)}writeToView(e,t,n,r){const i=this._shiftWriteMaybeReallocate(e);return t(this._getView(),i,e,n,r)}writeToBytes(e,t,n,r){const i=this._shiftWriteMaybeReallocate(e);return t(this._buffer,i,e,n,r)}writeUint8(e){j(e,0,256,"uint8"),M(this,1,O,e,!1)}writeInt8(e){j(e,-128,128,"signed int8"),M(this,1,O,e,!0)}writeUint16(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._littleEndian;j(e,0,65536,"uint16"),P(this,2,I,e,t)}writeInt16(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._littleEndian;j(e,-32768,32768,"signed int16"),P(this,2,w,e,t)}writeUint32(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._littleEndian;j(e,0,4294967296,"uint32"),P(this,4,R,e,t)}writeInt32(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._littleEndian;j(e,-2147483648,2147483648,"signed int32"),P(this,4,D,e,t)}writeUint64(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._littleEndian;j(e,0,0x10000000000000000,"uint64"),P(this,8,L,e,t)}writeInt64(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._littleEndian;j(e,-0x8000000000000000,0x8000000000000000,"signed int64"),P(this,8,L,e,t)}writeFloat32(e){P(this,4,N,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._littleEndian)}writeFloat64(e){P(this,8,k,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._littleEndian)}writeVarInt(e){j(e,-0x8000000000000000,0x8000000000000000,"varint (signed int64)");const t=e<0,n=t?-e:e;let r=Math.floor(n/4294967296),i=n-4294967296*r;t&&(r=~r,0===i?r++:i=-i);M(this,F(r,i),U,r,i)}writeVarIntFromHexLong(e){const t=(0,r.hexLongIsNegative)(e),n=t?(0,r.negateHexLong)(e):e,i=(0,r.hexLongToHex)(n);let a=0,o=0;for(let e=0;e<r.NUM_HEX_IN_LONG;e++)a=a<<4|o>>>28,o=o<<4|(0,r.hexAt)(i,e);t&&(a=~a,0===o?a++:o=-o);M(this,F(a,o),U,a,o)}writeBinary(e){const t=e.peek((e=>e.readByteArray()));if(t.length){const e=this._shiftWriteMaybeReallocate(t.length);this._buffer.set(t,e)}}writeBuffer(e){this.writeByteArray(new Uint8Array(e))}writeByteArray(e){const t=this._shiftWriteMaybeReallocate(e.length);this._buffer.set(e,t)}writeBufferView(e){this.writeByteArray(new Uint8Array(e.buffer,e.byteOffset,e.byteLength))}writeString(e){M(this,d(e),G,e)}writeHexLong(e){P(this,8,x,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._littleEndian)}writeBytes(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(let e=0;e<t.length;e++)j(t[e],0,256,"byte");M(this,t.length,B,t)}writeAtomically(e,t){this._hiddenWrites++;let n=this._writeIndex,r=this._bytesTrashed;try{const i=e(this,t);return n=this._writeIndex,r=this._bytesTrashed,i}finally{this._hiddenWrites--,this._writeIndex=n-(this._bytesTrashed-r)}}writeWithVarIntLength(e,t){const n=this._writeIndex,r=this.writeAtomically(e,t),i=this._writeIndex;this.writeVarInt(i-n);const o=this._writeIndex-i,s=this._buffer;for(let e=0;e<o;e++)a[e]=s[i+e];for(let e=i-1;e>=n;e--)s[e+o]=s[e];for(let e=0;e<o;e++)s[n+e]=a[e];return r}static build(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];let r=0;for(let e=0;e<t.length;e++){const n=t[e];"string"==typeof n?r+=d(n):"number"==typeof n?r++:n instanceof s?r+=n.size():n instanceof ArrayBuffer?r+=n.byteLength:n instanceof Uint8Array&&(r+=n.length)}const i=new s;return i.ensureCapacity(r),i.write.apply(i,arguments),i}_getView(){return this._view||(this._view=new DataView(this._buffer.buffer,this._buffer.byteOffset))}_shiftReadOrThrow(e){if(e<0)throw new Error("ReadError: given negative number of bytes to read");const t=this._readIndex,n=t+e;if(n>this._readEndIndex)throw new Error(t===this._readEndIndex?"ReadError: tried to read from depleted binary":"ReadError: tried to read beyond end of binary");return this._readIndex=n,this._hiddenReads||(this._earliestIndex=n),t}_maybeReallocate(e){const t=this._buffer;if(e<=t.length)return e;{const n=this._earliestIndex,r=e-n,i=Math.max(r,2*(t.length-n),64),a=new Uint8Array(i);return n?(a.set(t.subarray(n)),this._bytesTrashed+=n,this._readIndex-=n,this._readEndIndex-=n,this._writeIndex-=n,this._earliestIndex=0):a.set(t),this._buffer=a,this._view=null,r}}_shiftWriteMaybeReallocate(e){const t=this._maybeReallocate(this._writeIndex+e),n=this._writeIndex;return this._writeIndex=t,this._hiddenWrites||(this._readEndIndex=t),n}}t.Binary=s;let l="",c=0;function d(e){if(e===l)return c;const t=e.length;let n=0;for(let r=0;r<t;r++){const i=e.charCodeAt(r);if(i<128)n++;else if(i<2048)n+=2;else if(i<55296||57344<=i&&i<=65535)n+=3;else if(55296<=i&&i<56320&&r+1!==t){const t=e.charCodeAt(r+1);56320<=t&&t<57344?(r++,n+=4):n+=3}else n+=3}return l=e,c=n}function u(e,t,n){const r=t>>21;if(e){const e=Boolean(2097151&t||n);return 0===r||-1===r&&e}return 0===r}function p(e,t,n,r,i){return e.readWithViewParser(t,n,r,i)}function f(e,t,n,r,i){return e.readWithBytesParser(t,n,r,i)}function h(e,t,n,r){return r?e.getInt8(t):e.getUint8(t)}function _(e,t,n,r){return e.getUint16(t,r)}function g(e,t,n,r){return e.getInt32(t,r)}function m(e,t,n,r){return e.getUint32(t,r)}function y(e,t,n,r,i){return r(e.getInt32(i?t+4:t,i),e.getInt32(i?t:t+4,i))}function E(e,t,n,r){return e.getFloat32(t,r)}function S(e,t,n,r){return e.getFloat64(t,r)}function v(e,t,n,r){const i=Math.min(r,10);let a=0,o=128;for(;a<i&&128&o;)o=e[t+a++];if(10===a&&o>1)throw new Error("ParseError: varint exceeds 64 bits");return 128&o?a+1:a}function T(e,t,n,r){let i=0,a=0,o=n;10===n&&(o--,a=1&e[t+o]);for(let n=o-1;n>=0;n--)i=i<<7|a>>>25,a=a<<7|127&e[t+n];return r(i,a)}function b(e,t,n){const r=t+e.byteOffset,i=e.buffer;return 0===r&&n===i.byteLength?i:i.slice(r,r+n)}function C(e,t,n){return e.subarray(t,t+n)}function A(e,t,n){const r=t+n;let a=[],o=null;for(let n=t;n<r;n++){a.length>5e3&&(o||(o=[]),o.push(String.fromCharCode.apply(String,a)),a=[]);const t=0|e[n];if(0==(128&t))a.push(t);else if(192==(224&t)){const o=H(e,n+1,r);if(o){n++;const e=(31&t)<<6|63&o;e>=128?a.push(e):a.push(i)}else a.push(i)}else if(224==(240&t)){const o=H(e,n+1,r),s=H(e,n+2,r);if(o&&s){n+=2;const e=(15&t)<<12|(63&o)<<6|63&s;e>=2048&&!(55296<=e&&e<57344)?a.push(e):a.push(i)}else o?(n++,a.push(i)):a.push(i)}else if(240==(248&t)){const o=H(e,n+1,r),s=H(e,n+2,r),l=H(e,n+3,r);if(o&&s&&l){n+=3;const e=(7&t)<<18|(63&o)<<12|(63&s)<<6|63&l;if(e>=65536&&e<=1114111){const t=e-65536;a.push(55296|t>>10,56320|1023&t)}else a.push(i)}else o&&s?(n+=2,a.push(i)):o?(n++,a.push(i)):a.push(i)}else a.push(i)}const s=String.fromCharCode.apply(String,a);return o?(o.push(s),o.join("")):s}function P(e,t,n,r,i){return e.writeToView(t,n,r,i)}function M(e,t,n,r,i){return e.writeToBytes(t,n,r,i)}function O(e,t,n,r){e[t]=r}function I(e,t,n,r,i){e.setUint16(t,r,i)}function w(e,t,n,r,i){e.setInt16(t,r,i)}function R(e,t,n,r,i){e.setUint32(t,r,i)}function D(e,t,n,r,i){e.setInt32(t,r,i)}function L(e,t,n,r,i){const a=r<0,o=a?-r:r;let s=Math.floor(o/4294967296),l=o-4294967296*s;a&&(s=~s,0===l?s++:l=-l),e.setUint32(i?t+4:t,s,i),e.setUint32(i?t:t+4,l,i)}function N(e,t,n,r,i){e.setFloat32(t,r,i)}function k(e,t,n,r,i){e.setFloat64(t,r,i)}function U(e,t,n,r,i){let a=r,o=i;const s=t+n-1;for(let n=t;n<s;n++)e[n]=128|127&o,o=a<<25|o>>>7,a>>>=7;e[s]=o}function G(e,t,n,r){let i=t;const a=r.length;for(let t=0;t<a;t++){const n=r.charCodeAt(t);if(n<128)e[i++]=n;else if(n<2048)e[i++]=192|n>>6,e[i++]=128|63&n;else if(n<55296||57344<=n)e[i++]=224|n>>12,e[i++]=128|n>>6&63,e[i++]=128|63&n;else if(55296<=n&&n<56320&&t+1!==a){const a=r.charCodeAt(t+1);if(56320<=a&&a<57344){t++;const r=65536+((1023&n)<<10|1023&a);e[i++]=240|r>>18,e[i++]=128|r>>12&63,e[i++]=128|r>>6&63,e[i++]=128|63&r}else e[i++]=239,e[i++]=191,e[i++]=189}else e[i++]=239,e[i++]=191,e[i++]=189}}function x(e,t,n,i,a){const o=(0,r.hexLongIsNegative)(i),s=(0,r.hexLongToHex)(i);let l=0,c=0;for(let e=0;e<16;e++)l=l<<4|c>>>28,c=c<<4|(0,r.hexAt)(s,e);o&&(l=~l,0===c?l++:c=-c),e.setUint32(a?t+4:t,l,a),e.setUint32(a?t:t+4,c,a)}function B(e,t,n,r){for(let i=0;i<n;i++)e[t+i]=r[i]}function F(e,t){let n,r;for(e?(n=5,r=e>>>3):(n=1,r=t>>>7);r;)n++,r>>>=7;return n}function j(e,t,n,r){if("number"!=typeof e||e!=e||Math.floor(e)!==e||e<t||e>=n)throw new TypeError("string"==typeof e?`WriteError: string "${e}" is not a valid ${r}`:`WriteError: ${String(e)} is not a valid ${r}`)}function Y(e,t,n){let r;r=t>=0||e?t:4294967296+t;const i=4294967296*r+(n>=0?n:4294967296+n);if(!u(e,t,n))throw new Error(`ReadError: integer exceeded 53 bits (${i})`);return i}function K(e,t){return Y(!0,e,t)}function W(e,t){return Y(!1,e,t)}function H(e,t,n){if(t>=n)return 0;const r=0|e[t];return 128==(192&r)?r:0}},51239:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.intToBytes=function(e,t){let n=t;const r=new Uint8Array(e);for(let t=e-1;t>=0;t--)r[t]=255&n,n>>>=8;return r},t.uint8ArrayToBuffer=function(e){return e.buffer.slice(e.byteOffset,e.byteLength+e.byteOffset)}},42341:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;const n=[];n[34]="ES",n[49]="DE",n[52]="MX",n[44]="GB",n[966]="SA",n[39]="IT",n[93]="AF",n[355]="AL",n[213]="DZ",n[376]="AD",n[244]="AO",n[54]="AR",n[374]="AM",n[297]="AW",n[61]="AU",n[43]="AT",n[994]="AZ",n[973]="BH",n[880]="BD",n[375]="BY",n[32]="BE",n[501]="BZ",n[229]="BJ",n[975]="BT",n[591]="BO",n[387]="BA",n[267]="BW",n[55]="BR",n[246]="IO",n[673]="BN",n[359]="BG",n[226]="BF",n[257]="BI",n[225]="CI",n[855]="KH",n[237]="CM",n[238]="CV",n[236]="CF",n[235]="TD",n[56]="CL",n[86]="CN",n[57]="CO",n[269]="KM",n[242]="CG",n[243]="CD",n[682]="CK",n[506]="CR",n[385]="HR",n[53]="CU",n[599]="CW",n[357]="CY",n[420]="CZ",n[45]="DK",n[253]="DJ",n[593]="EC",n[20]="EG",n[503]="SV",n[240]="GQ",n[291]="ER",n[372]="EE",n[251]="ET",n[298]="FO",n[679]="FJ",n[358]="FI",n[33]="FR",n[594]="GF",n[689]="PF",n[241]="GA",n[220]="GM",n[995]="GE",n[233]="GH",n[350]="GI",n[30]="GR",n[299]="GL",n[590]="GP",n[502]="GT",n[224]="GN",n[245]="GW",n[592]="GY",n[509]="HT",n[504]="HN",n[852]="HK",n[36]="HU",n[354]="IS",n[91]="IN",n[62]="ID",n[98]="IR",n[964]="IQ",n[353]="IE",n[972]="IL",n[81]="JP",n[962]="JO",n[254]="KE",n[965]="KW",n[996]="KG",n[856]="LA",n[371]="LV",n[961]="LB",n[266]="LS",n[231]="LR",n[218]="LY",n[423]="LI",n[370]="LT",n[352]="LU",n[853]="MO",n[389]="MK",n[261]="MG",n[265]="MW",n[60]="MY",n[960]="MV",n[223]="ML",n[356]="MT",n[692]="MH",n[596]="MQ",n[222]="MR",n[230]="MU",n[691]="FM",n[373]="MD",n[377]="MC",n[976]="MN",n[382]="ME",n[212]="MA",n[258]="MZ",n[95]="MM",n[264]="NA",n[674]="NR",n[977]="NP",n[31]="NL",n[687]="NC",n[64]="NZ",n[505]="NI",n[227]="NE",n[234]="NG",n[672]="NF",n[850]="KP",n[47]="NO",n[968]="OM",n[92]="PK",n[680]="PW",n[970]="PS",n[507]="PA",n[675]="PG",n[595]="PY",n[51]="PE",n[63]="PH",n[48]="PL",n[351]="PT",n[974]="QA",n[40]="RO",n[7]="RU",n[250]="RW",n[262]="RE",n[508]="PM",n[685]="WS",n[378]="SM",n[221]="SN",n[381]="RS",n[248]="SC",n[232]="SL",n[65]="SG",n[421]="SK",n[386]="SI",n[677]="SB",n[252]="SO",n[27]="ZA",n[82]="KR",n[211]="SS",n[94]="LK",n[249]="SD",n[597]="SR",n[268]="SZ",n[46]="SE",n[41]="CH",n[963]="SY",n[239]="ST",n[886]="TW",n[992]="TJ",n[255]="TZ",n[66]="TH",n[670]="TL",n[228]="TG",n[676]="TO",n[216]="TN",n[90]="TR",n[993]="TM",n[256]="UG",n[380]="UA",n[971]="AE",n[1]="US",n[598]="UY",n[998]="UZ",n[678]="VU",n[58]="VE",n[84]="VN",n[681]="WF",n[967]="YE",n[260]="ZM",n[263]="ZW",n[383]="XK";var r=n;t.default=r},81574:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default={1:'[334,-1,"($1) $2-$3"],10',20:'["Ah","[23]"],[334,"1[0125]|[89]00"],["Bg","1[35]|[4-6]|[89][2-9]"],[9,10]',211:"333,9",212:'["[5-7]BF","5(2[015-7]|3[0-4])|[67]",1],["[58]CE",["5(2[2-489]|3[5-9]|92)|892","5(2([2-48]|9[0-7])|3([5-79]|8[0-7])|924)|892"],1],["5DD",["5(29|38)","5(29|38)[89]"],1],["[5]BBBB","5(4[067]|5[03])"],["8[09];G","8(0|9[013-9])",1],9',213:'["[5-8]BBBB","[5-8]"],["9ACBB",9],9',216:"233,8",218:'[27,"[25-79]",1],9',220:"34,7",221:'[2322,"[379]"],[3222,8],9',222:'"[2-48]ABBB",8',223:'[2222,"[246-9]"],8',224:'[2222,3],[3222,"[67]"],[8,9]',225:"2222,8",226:'[2222,"[025-7]"],8',227:'[233,"08"],[2222,"[0289]"],8',228:'[2222,"[279]"],8',229:"2222,8",230:'[34,"[2-46]|8[013]"],[44,5],[7,8]',231:'[133,"[45]"],[233,2],[234,"[23578]"],[7,8,9]',232:"26,8",233:'[234,"[235]"],9',234:'["CCd","[7-9]"],["CDe","[78]"],["CEf","[78]"],10',235:"2222,8",236:"2222,8",237:'[2222,88],[12222,"[26]"],[8,9]',238:"322,7",239:"34,7",240:'[333,"[235]"],[36,"[89]"],9',241:"[2222,0],8",242:'[234,"[02]"],[144,8],9',243:'[234,1],[333,"[89]"],9',244:'[333,"[29]"],9',245:'[333,"44|9[567]"],[34,40],[7,9]',246:"[34,3],7",247:"5",248:'[133,"[246]"],7',249:'[234,"[19]"],9',250:'["2BCC",2],["[7-9]BCC","[7-9]"],9',251:'"[1-59]ACD",9',252:'[17,"24|[67]"],["BA{5,7}","15|28|6[1-35-9]|799|9[2-9]"],[333,"3[59]|4[89]|6[24-6]|79|8[08]|90"],[8,9]',253:"2222,8",254:'["BA{5,7}","[24-6]"],[36,7],["CCd","[89]"],9',255:'["[24]ACD","[24]"],["[67]BCC","[67]"],["[89]BBD","[89]"],9',256:'[45,[202,2024]],[36,"[27-9]|4(6[45]|[7-9])"],[27,"[34]"],9',257:"2222,8",258:'["[28]ACd","2|8[2-7]"],["80ACC",80],9',260:'["[29]AG","[29]"],["800;CC",8],9',261:'[2232,"[23]"],9',262:'"[268]BBBB",9',263:'["7ACd",7],["86BCC","86[24]"],["CCd","2(1[39]|2[0157]|6[14]|7[35]|84)|329"],["[235]ACd","[23]9|54"],["[25]CA{3,5}",["(25|54)8","258[23]|5483"]],["8CF",86],["80ACD",80],[9,10]',264:'["8ACD","8[1235]"],["6ACd",6],["870;CC",870],9',265:'["2BCC",2],[3222,"[1789]"],9',266:"44,8",267:'["7ACC",7],8',268:'[44,"[027]"],8',269:"322,7",27:'[333,860],[234,"[1-9]"],9',290:"[4,5]",291:"133,7",297:"34,7",298:"6,6",299:"222,6",30:'[244,"21|7"],[46,"2(2|3[2-57-9]|4[2-469]|5[2-59]|6[2-9]|7[2-69]|8[2-49])"],[334,"[2689]"],10',31:'["[1-578]ACD","1[035]|2[0346]|3[03568]|4[0356]|5[0358]|7|8[4578]"],["[1-5]BCC","1[16-8]|2[259]|3[124]|4[17-9]|5[124679]"],["6;H","6[0-57-9]"],["66;G",66],["[89]0AA{4,7}","80|9"],[9,11]',32:"[3222,4],9",33:'[3222,8],[12222,"[1-79]"],9',34:'["[89]00;CC","[89]00"],["[5-9]BBBB","[568]|[79][0-8]"],9',350:"[35,2],8",351:'["2ACD","2[12]"],["[2-46-9]BCC","2[3-9]|[346-9]"],9',352:'[2223,20],[333,6],["BBBBb","2([0367]|4[3-8])"],["BBBA{1,5}","[3-57]|8[13-9]|9(0[89]|[2-579])|(2|80)[2-9]"],9',353:'["AdD",1],["BCd","[2569]|4[1-69]|7[14]"],[333,70],[333,81],[234,"[78]"],[433,1],[2134,8],[244,4],9',354:'[34,"[4-9]"],["3BCC",3],[7,8,9]',355:'["6[6-9];CD",6],9',356:'[44,"[2357-9]"],8',357:"26,8",358:'["CA{3,7}","([1-3]00|[6-8]0)"],["116C",116],["BA{4,10}","[14]|2[09]|50|7[135]"],["AA{4,11}","[25689][1-8]|3"],[6,7,8,9,10,11]',359:'[333,999],["BCd","48|8[7-9]|9[08]"],9',36:'["BCd","[2-9]"],9',370:'[134,"52[0-79]"],[323,"[7-9]"],[26,"37|4([15]|6[1-8])"],[35,"[3-6]"],8',371:'[233,"[269]|8[01]"],8',372:'["[3-79]BD",["[369]|4[3-8]|5([0-2]|5[0-478]|6[45])|7[1-9]","[369]|4[3-8]|5([02]|1([0-8]|95)|5[0-478]|6(4[0-4]|5[1-589]))|7[1-9]"]],["70;BD",70],["8000;CC",[800,8000]],["[458]Cd",["40|5|8(00|[1-5])","40|5|8(00[1-9]|[1-5])"]],[7,8]',373:'[233,"22|3"],["[25-7]BBC","2[13-9]|[5-7]"],["[89]BE","[89]"],8',374:'[26,"1|47"],[26,"4[1349]|[5-7]|9[1-9]"],[35,"[23]"],[323,"8|90"],8',375:'[2322,["17[0-3589]|2[4-9]|[34]","17([02358]|1[0-2]|9[0189])|2[4-9]|[34]"],"$1 $2-$3-$4"],[3222,["1(5[24]|6[235]|7[467])|2(1[246]|2[25]|3[26])","1(5[24]|6(2|3[04-9]|5[0346-9])|7([46]|7[37-9]))|2(1[246]|2[25]|3[26])"],"$1 $2-$3-$4"],[423,["1(5[169]|6[3-5]|7[179])|2(1[35]|2[34]|3[3-5])","1(5[169]|6(3[1-3]|4|5[125])|7(1[3-9]|7[0-24-6]|9[2-7]))|2(1[35]|2[34]|3[3-5])"],"$1 $2-$3"],["[89]BCD","8[01]|9"],["82ADD",82],["800;BA{2,4}",800],9',376:'[33,"[135-9]"],[44,1],[333,6],[6,9]',377:'[2222,"[39]"],[233,4],["6;BBBB",6],[332,8],[8,9]',378:'[2222,"[5-7]"],["0549;F",0,"($1) $2"],8',379:"10",380:'[333,["6[12][29]|(3[1-8]|4[136-8]|5[12457]|6[49])2|(56|65)[24]","6[12][29]|(35|4[1378]|5[12457]|6[49])2|(56|65)[24]|(3[1-46-8]|46)2[013-9]"]],[234,["4[45][0-5]|5(0|6[37])|6([12][018]|[36-8])|7|89|9[1-9]|(48|57)[0137-9]","4[45][0-5]|5(0|6(3[14-7]|7))|6([12][018]|[36-8])|7|89|9[1-9]|(48|57)[0137-9]"]],[45,"[3-6]"],["CCd","[89]"],9',381:'["[23]BA{4,9}","(2[389]|39)0"],["[1-3]AA{5,10}","1|2([0-24-7]|[389][1-9])|3([0-8]|9[1-9])"],["6AA{6,8}",6],["[89]BA{3,9}","[89]"],["7[26];A{4,9}","7[26]"],["7[08]AA{4,9}","7[08]"],[8,9,10]',382:'[233,"[2-57-9]|6[036-9]"],[8,9]',383:'[233,"[23][89]|4[3-79]"],[35,"[89]00"],333,8',385:'["1;DC",1],["[2-5]ACd","[2-5]"],["9ACd",9],["[67]ACd","[67]"],["80[01];Bc",8],["80[01];CC",8],[8,9]',386:'[1322,"[12]|3[24-8]|4[24-8]|5[2-8]|7[3-8]"],["[3-7]ACC","[37][01]|4[0139]|51|6"],["[89][09];A{3,6}","[89][09]"],["[58]BE","59|8[1-3]"],8',387:'[233,"6[1-356]|[7-9]"],[233,"[3-5]","$1 $2-$3"],[2223,6],[8,9]',389:'["2;CD",2],["[347]ACC","[347]"],["[58]BABB","[58]"],8',39:'["BdD","0[26]|55"],["0[26];DE","0[26]"],["0BdD","0[13-57-9][0159]"],["CA{3,6}",["0[13-57-9][0159]|8(03|4[17]|9[245])","0[13-57-9][0159]|8(03|4[17]|9(2|[45][0-4]))"]],["0CCD","0[13-57-9][2-46-8]"],["0CA{2,6}","0[13-57-9][2-46-8]"],["CCd",["[13]|8(00|4[08]|9[59])","[13]|8(00|4[08]|9(5[5-9]|9))"]],[344,3],[9,10]',40:'[234,"[23]1"],[333,"[23][3-7]|[7-9]"],9',41:'["[2-9]ACBB","[2-7]|[89]1"],["[89]BCC","8[047]|90"],[32322,860],9',420:'["[2-9]BCC","[2-8]|9[015-7]"],["96ACCC",96],["9ACCC","9[36]"],9',421:'["2;CCB",2,"$1/$2 $3 $4"],["[3-5]ACBB","[3-5]","$1/$2 $3 $4"],["[689]BCC","[689]"],9',423:'[322,"[237-9]"],[234,69],[333,6],7',43:'["1;A{3,12}",1],["5ADA{4,7}","5[079]"],["CA{3,10}","316|46|51|732|6(5[0-3579]|[6-9])|7([28]0)|[89]"],["DA{3,9}","2|3(1[1-578]|[3-8])|4[2378]|5[2-6]|6([12]|4[1-9]|5[468])|7(2[1-8]|35|4[1-8]|[5-79])"],[10,11,12,13]',44:'["Ee",["1(38|5[23]|69|76|94)","1((38|69)7|5(24|39)|768|946)","1(3873|5(242|39[4-6])|(697|768)[347]|9467)"]],["Df","1([2-69][02-9]|[78])"],[244,["[25]|7(0|6[024-9])","[25]|7(0|6([04-9]|2[356]))"]],[46,7],[334,"[1389]"],10',45:"2222,8",46:'["8;ccB",8],["[1-69]AcBB","1[013689]|2[0136]|3[1356]|4[0246]|54|6[03]|90"],[3222,"1[2457]|2([247-9]|5[0138])|3[0247-9]|4[1357-9]|5[0-35-9]|6([124-689]|7[0-2])|9([125-8]|3[0-5]|4[0-3])"],["7ACBB",7],["9[034]ABBC","9[034]"],[32322,"25[245]|67[3-6]"],9',47:'["[489]BBC","[489]"],["[235-7]ABBB","[235-7]"],8',48:'[2322,"[14]|2[0-57-9]|3[2-4]|5[24-689]|6[1-3578]|7[14-7]|8[1-79]|9[145]"],[333,"26|39|5[0137]|6[0469]|7[02389]|8[08]"],9',49:'["BA{3,13}","3[02]|40|[68]9"],["CA{3,12}",["2(0[1-389]|1[124]|2[18]|3[14])|3([35-9][15]|4[015])|906|(2[4-9]|4[2-9]|[579][1-9]|[68][1-8])1","2(0[1-389]|12[0-8])|3([35-9][15]|4[015])|906|2([13][14]|2[18])|(2[4-9]|4[2-9]|[579][1-9]|[68][1-8])1"]],["DA{2,11}",["[24-6]|3([3569][02-46-9]|4[2-4679]|7[2-467]|8[2-46-8])|70[2-8]|8(0[2-9]|[1-8])|90[7-9]|[79][1-9]","[24-6]|3(3(0[1-467]|2[127-9]|3[124578]|7[1257-9]|8[1256]|9[145])|4(2[135]|4[13578]|9[1346])|5(0[14]|2[1-3589]|6[1-4]|7[13468]|8[13568])|6(2[1-489]|3[124-6]|6[13]|7[12579]|8[1-356]|9[135])|7(2[1-7]|4[145]|6[1-5]|7[1-4])|8(21|3[1468]|6|7[1467]|8[136])|9(0[12479]|2[1358]|4[134679]|6[1-9]|7[136]|8[147]|9[1468]))|70[2-8]|8(0[2-9]|[1-8])|90[7-9]|[79][1-9]|3[68]4[1347]|3(47|60)[1356]|3(3[46]|46|5[49])[1246]|3[4579]3[1357]"]],[34,138],["EA{2,10}",3],["CA{5,11}",181],["CAA{4,10}","1(3|80)|9"],["Ch","1[67]"],["CA{7,12}",8],[56,[185,1850,18500]],[344,7],[47,"18[68]"],[56,"15[0568]"],[47,"15[1279]"],[38,18],["CBh","1(6[023]|7)"],[427,"15[279]"],[328,15],[7,8,9,10,11,12]',500:"5",501:'[34,"[2-8]",1],["0;800;DC",0,1],7',502:'[44,"[2-7]"],[434,1],8',503:'[44,"[267]"],[344,"[89]"],8',504:'[44,"[237-9]",1],8',505:"44,8",506:'[44,"[24-7]|8[3-9]"],[334,"[89]0",1],8',507:"[44,6,1],8",508:'"[45]ABB",6',509:"224,8",51:"[333,9],9",52:'[244,"33|5[56]|81"],[334,"[2-9]"],[1244,"1(33|5[56]|81)"],[1334,1],[10,11]',53:'["Ag",7],["BA{4,6}","[2-4]"],[17,5],8',54:'[424,["2(2[024-9]|3[0-59]|47|6[245]|9[02-8])|3(3[28]|4[03-9]|5[2-46-8]|7[1-578]|8[2-9])","2([23]02|6([25]|4[6-8])|9([02356]|4[02568]|72|8[23]))|3(3[28]|4([04679]|3[5-8]|5[4-68]|8[2379])|5([2467]|3[237]|8[2-5])|7[1-578]|8([2469]|3[2578]|5[4-8]|7[36-8]|8[5-8]))|2(2[24-9]|3[1-59]|47)","2([23]02|6([25]|4(64|[78]))|9([02356]|4([0268]|5[2-6])|72|8[23]))|3(3[28]|4([04679]|3[78]|5(4[46]|8)|8[2379])|5([2467]|3[237]|8[23])|7[1-578]|8([2469]|3[278]|5[56][46]|86[3-6]))|2(2[24-9]|3[1-59]|47)|38([58][78]|7[378])|3(4[35][56]|58[45]|8([38]5|54|76))[4-6]","2([23]02|6([25]|4(64|[78]))|9([02356]|4([0268]|5([24-6]|3[2-5]))|72|8[23]))|3(3[28]|4([04679]|3(5(4[0-25689]|[56])|[78])|58|8[2379])|5([2467]|3[237]|8([23]|4([45]|60)|5(4[0-39]|5|64)))|7[1-578]|8([2469]|3[278]|54(4|5[13-7]|6[89])|86[3-6]))|2(2[24-9]|3[1-59]|47)|38([58][78]|7[378])|3(454|85[56])[46]|3(4(36|5[56])|8([38]5|76))[4-6]"],"$1 $2-$3"],[244,1,"$1 $2-$3"],[334,"[23]","$1 $2-$3"],[334,"[68]",1],[1424,["9(2[2-469]|3[3-578])","9(2(2[024-9]|3[0-59]|47|6[245]|9[02-8])|3(3[28]|4[03-9]|5[2-46-8]|7[1-578]|8[2-9]))","9(2([23]02|6([25]|4[6-8])|9([02356]|4[02568]|72|8[23]))|3(3[28]|4([04679]|3[5-8]|5[4-68]|8[2379])|5([2467]|3[237]|8[2-5])|7[1-578]|8([2469]|3[2578]|5[4-8]|7[36-8]|8[5-8])))|92(2[24-9]|3[1-59]|47)","9(2([23]02|6([25]|4(64|[78]))|9([02356]|4([0268]|5[2-6])|72|8[23]))|3(3[28]|4([04679]|3[78]|5(4[46]|8)|8[2379])|5([2467]|3[237]|8[23])|7[1-578]|8([2469]|3[278]|5([56][46]|[78])|7[378]|8(6[3-6]|[78]))))|92(2[24-9]|3[1-59]|47)|93(4[35][56]|58[45]|8([38]5|54|76))[4-6]","9(2([23]02|6([25]|4(64|[78]))|9([02356]|4([0268]|5([24-6]|3[2-5]))|72|8[23]))|3(3[28]|4([04679]|3(5(4[0-25689]|[56])|[78])|5(4[46]|8)|8[2379])|5([2467]|3[237]|8([23]|4([45]|60)|5(4[0-39]|5|64)))|7[1-578]|8([2469]|3[278]|5(4(4|5[13-7]|6[89])|[56][46]|[78])|7[378]|8(6[3-6]|[78]))))|92(2[24-9]|3[1-59]|47)|93(4(36|5[56])|8([38]5|76))[4-6]"],"$1 $2 $3-$4"],[1244,91,"$1 $2 $3-$4"],[1334,9,"$1 $2 $3-$4"],[10,11]',55:'[244,"[1-9][1-9]","$1 $2-$3"],[254,"([14689][1-9]|2[12478]|3[1-578]|5[1-5]|7[13-579])9","$1 $2-$3"],["[3589]00;cD","[3589]00"],[10,11]',56:'[144,"2[23]"],[234,"[357]|4[1-35]|6[13-57]"],["9;DD",9],["44;CD",44],["[68]00;Cd","60|8"],["600;CBC",60],["1230;CD",1],[54,219],9',57:'[17,["1(8[2-9]|9[0-3]|[2-7])|[24-8]","1(8[2-9]|9(09|[1-3])|[2-7])|[24-8]"]],[37,3],["1;CG",["1(80|9[04])","1(800|9(0[01]|4[78]))"]],[8,10]',58:"[37,-1,1],10",590:'["[56]90;BD",-1,"$1 $2-$3"],9',591:'[17,"[23]|4[46]"],[8,"[67]"],[324,8],8',592:"34,7",593:'[134,"[247]|[356][2-8]",1],[234,9],["1800;Cd",1],[8,9]',594:"3222,9",595:'["BCd","([26]1|3[289]|4[124678]|7[123]|8[1236])"],["CA{3,6}","[2-9]0"],[36,"9[1-9]"],[234,8700],[333,"[2-8][1-9]"],9',596:"3222,9",597:'[34,"[6-8]",1],7',598:'[233,9],[44,"[24]"],8',599:'[34,"[13-7]"],["9;CD",9],[7,8]',60:'["3;DD",3,"$1-$2 $3"],["[18]ACd","1[02-46-9][1-9]|8","$1-$2 $3"],["1;[36-8]00;BD","1[36-8]0",1],["11;DD",11,"$1-$2 $3"],["15[49];CD",15,"$1-$2 $3"],[9,10]',61:'["BCA{2,4}",16],[333,"14|[45]"],[144,"[2378]"],[433,"1(30|[89])"],9',62:'["BA{5,9}","2[124]|[36]1"],["CA{5,7}",800],["CA{5,8}","[2-79]"],["CdC","8[1-35-9]",1],["CA{6,8}",1],[334,804],[3133,80],["CDe",8,1],[2434,0],[9,10,11,12]',63:'["DA{4,6}",["3(23|39|46)|4(2[3-6]|[35]9|4[26]|76)|544|88[245]|(52|64|86)2","3(230|397|461)|4(2(35|[46]4|51)|396|4(22|63)|59[347]|76[15])|5(221|446)|642[23]|8(622|8([24]2|5[13]))"]],[334,"[89]"],[434,1],["DbCD",1],10',64:'[323,"[89]0"],[134,"24|[346]|7[2-57-9]|9[2-9]","$1-$2 $3"],["CCd","2(10|74)|[59]|80"],["BdD","2[028]"],["BCA{3,5}","2([169]|7[0-35-9])|7|86"],[8,9,10]',65:'["[3689]CD","[369]|8[1-9]"],["1[89]00;CD","1[89]"],["7000;DC",70],["800;CD",80],8',66:'["BCd","14|[3-9]"],[433,1],9',670:"[44,7],8",672:"[24,1],[15,3],[5,6]",673:'"[2-578]BD",7',674:"34,7",675:'[34,"[13-689]|27"],[44,"20|7"],[7,8]',676:'[34,"7[5-9]|8[47-9]"],[43,0],7',677:'[25,"[7-9]"],7',678:'[34,"[579]"],7',679:'[34,"[35-9]"],[434,0],7',680:"34,7",681:"222,6",682:"23,5",683:"4",685:'["8Bd",8],["7AE",7],[6,7]',686:"8",687:'[222,"[2-46-9]|5[0-4]","$1.$2.$3"],6',688:"[6,7]",689:'[2222,"4[09]|8[79]"],[222,44],[6,8]',690:"[4,5,6,7]",691:"34,7",692:"[34,-1,1],7",7:'[4222,["7(1[0-8]|2[1-9])","7(1([0-6]2|7|8[27])|2(1[23]|[2-9]2))","7(1([0-6]2|7|8[27])|2(13[03-69]|62[013-9]))|72[1-57-9]2"]],[5122,["7(1[0-68]|2[1-9])","7(1([06][3-6]|[18]|2[35]|[3-5][3-5])|2([13][3-5]|[24-689]|7[457]))","7(1(0([356]|4[023])|[18]|2(3[013-9]|5)|3[45]|43[013-79]|5(3[1-8]|4[1-7]|5)|6(3[0-35-9]|[4-6]))|2(1(3[178]|[45])|[24-689]|3[35]|7[457]))|7(14|23)4[0-8]|71(33|45)[1-79]"]],[334,7],[3322,"[3489]","$1 $2-$3-$4"],10',81:'[334,800,1],["DBd","0077",1],[424,"0088",1],["DCd","00(37|66)",1],["DDe","00(37|66)",1],["DEf","00(37|66)",1],["DFg","00(37|66)",1],[244,"[2579]0|80[1-9]",1],10',82:'["AdD",2,1],[234,"60|8",1],["BdD","[1346]|5[1-5]",1],[244,"[57]",1],[533,["003","0030"]],[254,5,1],["EdD",0],[5234,0],[9,10]',84:'[244,"2[48]"],[343,"2[0-35-79]"],["[89]ACBB","8(8|9[89])|9"],["1[2689]ACD","1([26]|8[68]|99)"],["[3578]ACD","[357]|8[1-5]"],["86[89];CC","86[89]"],["1[89]00;A{4,6}",["1[89]0","1[89]00"]],[9,10]',850:"[334,1],10",852:'[44,"[235-7]|[89](0[1-9]|[1-9])"],["800;CC",800],["900;BCC",900],["900;A{2,5}",900],8',853:'"[268]CD",8',855:'["BCd","[1-9]"],[433,1],[8,9]',856:"[2233,2],10",86:'["21;DA{4,6}",21],[344,"3(11|7[179])|4([15]1|3[1-35])|5(1|2[37]|3[12]|51|7[13-79]|9[15])|7(31|5[457]|6[09]|91)|8([57]1|98)"],[434,[807,8078]],[344,"1[3-578]"],["10800;CD",[108,1080,10800]],["Ch",950],11',880:'["CA{3,7}","3([67]|8[013-9])|4(6[168]|7|[89][18])|5(6[128]|9)|6(28|4[14]|5)|7[2-589]|8(0[014-9]|[12])|9[358]|(3[2-5]|4[235]|5[2-578]|6[0389]|76|8[3-7]|9[24])1|(44|66)[01346-9]",1],["DA{3,6}","[13-9]",1],10',886:'["AdD","[25][2-8]|[346]|7[1-9]|8[237-9]"],[234,"[258]"],[333,9],[244,7],9',90:'[334,"512|8[0589]|90"],[3322,["5([0-59]|61)","5([0-59]|616)","5([0-59]|6161)"]],[3322,"[24][1-8]|3[1-9]"],10',91:'[55,["600|7([02-8]|19|9[037-9])|8(0[015-9]|[1-9]|20)|9","600|7([078]|19[0-5]|2([02356-9]|[14][017-9]|9[389])|3([025-9]|1[07-9]|[34][017-9])|4([0-35689]|[47][017-9])|5([02346-9]|1[017-9]|5[017-9])|6([02-9]|1[0-257-9])|9([089]|31|7[02-9]))|8(0([01589]|6[67]|7[02-9])|1([0-57-9]|6[07-9])|2(0[078]|[14][07-9]|[235-9])|3([0357-9]|[126][07-9]|4[1-9])|[45]|6([02457-9]|[136][07-9])|7([078][07-9]|[1-69])|8([0-25-9]|3[07-9]|4[047-9])|9([02-9]|1[027-9]))|9","600|7(0|19[0-5]|2([0235679]|[14][017-9]|8([0-569]|[78][089])|9[389])|3([05-8]|1([089]|7[5-9])|2([5-8]|[0-49][089])|3[017-9]|4([07-9]|11)|9([01689]|[2345][089]|40|7[0189]))|4([056]|1([0135-9]|[23][089]|2[089]|4[089])|2(0[089]|[1-7][089]|[89])|3([0-8][089]|9)|4([089]|11|7[02-8])|7([089]|11|7[02-8])|8([0-24-7][089]|[389])|9([0-7][089]|[89]))|5([0346-9]|1[017-9]|2([03-9]|[12][089])|5[017-9])|6([0346-9]|1[0-257-9]|2([0-4].|[5-9][089])|5([0-367][089]|[4589]))|7(0([02-9]|1[089])|[1-9])|8([0-79]|8(0[0189]|11|8[013-9]|9))|9([089]|313|7([02-8]|9[07-9])))|8(0([01589]|6[67]|7([02-8]|9[05-9]))|1([02-57-9]|1([0-35-9]|4[0-46-9])|6([089]|7[02-8]))|2(0([08]|7[02])|[14]([089]|7[02-8])|[235-9])|3([0357-9]|1([089]|7[02-6])|2([09]|77|8[0-689])|4[1-9]|6([089]|7[02-7]))|[45]|6([02457-9]|1([089]|7[02-8])|3([089]|7[02358])|6([08]|7[02-8]|9[01]))|7(0[07-9]|[1-69]|7([089]|7[02-8])|8([089]|7[02-8]))|8([0-25-9]|3([089]|7[02-8])|4([0489]|7[02-68]))|9([02-9]|1([0289]|7[2-6])))|9"]],[244,"11|2[02]|33|4[04]|79[1-9]|80[2-46]"],[334,"1(2[0-249]|3[0-25]|4[145]|[569][14]|7[1257]|8[1346]|[68][1-9])|2(1[257]|3[013]|4[01]|5[0137]|6[0158]|78|8[1568]|9[14])|3(26|4[1-3]|5[34]|6[01489]|7[02-46]|8[159])|4(1[36]|2[1-47]|3[15]|5[12]|6[0-26-9]|7[0-24-9]|8[013-57]|9[014-7])|5(1[025]|[36][25]|22|4[28]|5[12]|[78]1|9[15])|6(12|[2345]1|57|6[13]|7[14]|80)|7(12|2[14]|3[134]|4[47]|5[15]|[67]1|88)|8(16|2[014]|3[126]|6[136]|7[078]|8[34]|91)"],[433,"1([23579]|[468][1-9])|[2-8]"],[2343,"008"],[334,140],[424,[160,1600]],["DA{2,4};D",[180,1800]],["DdD",[186,1860]],[4333,"18[06]"],10',92:'["Bh","(2[125]|4[0-246-9]|5[1-35-7]|6[1-8]|7[14]|8[16]|91)[2-9]"],["Cg",["2(3[2358]|4[2-4]|9[2-8])|45[3479]|54[2-467]|60[468]|72[236]|8(2[2-689]|3[23578]|4[3478]|5[2356])|9(2[2-8]|3[27-9]|4[2-6]|6[3569]|9[25-8])","9(2[3-8]|98)|(2(3[2358]|4[2-4]|9[2-8])|45[3479]|54[2-467]|60[468]|72[236]|8(2[2-689]|3[23578]|4[3478]|5[2356])|9(22|3[27-9]|4[2-6]|6[3569]|9[25-7]))[2-9]"]],[55,58],[37,3],[2333,"2[125]|4[0-246-9]|5[1-35-7]|6[1-8]|7[14]|8[16]|91"],[3333,"[24-9]"],10',93:'["[2-7]ACD","[2-7]"],9',94:'[234,7],[333,"[1-689]"],9',95:'["ACd","[12]"],["BCd","[4-7]|8[1-35]"],["ACA{4,6}","9(2[0-4]|[35-9]|4[137-9])"],[144,2],[334,8],[1333,92],[154,9],[8,9,10]',960:'[34,"[3467]|9([1-9]|0[1-9])",1],[334,"[89]00"],7',961:'[133,"[13-69]|7([2-57]|62|8[0-7]|9[04-9])|8[02-9]"],[233,"[7-9]"],[7,8]',962:'["7;DD","7[457-9]"],["Cf","70|8[0158]|9"],9',963:'["BCd","[1-5]"],["9BCC",9],9',964:'["BCd","[2-6]"],[334,7],[9,10]',965:'["Dd","[169]|2([235]|4[1-35-9])|52"],[35,"[25]"],8',966:'[45,9],[234,1],[234,5],["CCd",81],[334,8],9',967:'["7BCC","7[0137]"],9',968:'["CA{4,6}","[58]"],[26,2],[44,"[79]"],8',970:'["5[69]ACC",5],["1[78]00;CC","1[78]"],9',971:'["CA{2,9}","60|8"],[315,"[479]"],[234,5],9',972:'[234,"[57]",1],[433,12,1],[46,159,1],[1333,"1[7-9]",1],["CbCD",15,"$1-$2 $3-$4"],9',973:"44,8",974:'["[3-7]CD","[3-7]"],8',975:'[2222,"1|77"],8',976:'["[12]ABD","[12]1"],["[12]2Af","[12]2[1-3]"],["[12]CE",["[12](27|[3-5])","[12](27|[3-5].)2"]],[44,"[57-9]"],["[12]De",["[12](27|[3-5])","[12](27|[3-5].)[4-9]"]],8',977:'["9BG","9(6[013]|7[245]|8)",1],10',98:'[244,"[1-8]"],["CCd",9],10',992:'[612,[331,3317]],[324,"[34]7|91[78]"],[414,3],[234,"[457-9]"],9',993:'[2222,12,"$1 $2-$3-$4"],[26,6],[3122,"13|[2-5]","$1 $2-$3-$4"],8',994:'[3222,9],[2322,["[12]|365","[12]|365","[12]|365([0-46-9]|5[0-35-9])"]],[2322,"[3-8]"],9',995:'[3222,"[348]"],[333,7],[3222,5],9',996:'[45,"3(1[346]|[24-79])"],[333,"[235-79]"],["CCAc",8],9',998:'[2322,"[679]"],[7,8,9]'}},40265:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WrappedError=t.UnimplementedMethod=t.TimeoutError=t.HttpError=t.AggregateError=void 0,t.customError=r,t.hasSupressedQuotaExceededError=function(){return l},t.obtainErrorSummary=function(e){return JSON.stringify(e,Object.getOwnPropertyNames(e))},t.supressQuotaExceededError=function(e){if(null==e||"QuotaExceededError"!==e.name)throw e;l=!0};const n=Object.create(Error.prototype,{constructor:{value:void 0,writable:!0,configurable:!0}});function r(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2?arguments[2]:void 0;function i(n){const r=Error.call(this,n);this.message=n,r.name=e,this.name=e,t&&(this.stack=r.stack)}return i.prototype=Object.create(r?r.prototype:n),i.prototype.constructor=i,i}class i extends(r("AggregateError",!0)){constructor(e,t){super(null!=t&&t.length>0?t:function(e){return 0===e.length?"No errors":1===e.length?e[0].message:e.map((e=>"- "+e.message)).join("\n")}(e)),this.errors=e}}t.AggregateError=i;class a extends(r("TimeoutError",!1)){}t.TimeoutError=a;class o extends(r("HttpError",!1)){constructor(e,t){super(e),this.code=t}}t.HttpError=o;class s extends(r("UnimplementedMethod")){}t.UnimplementedMethod=s;let l=!1;class c extends Error{constructor(e,t){super(e),this.inner=t}}t.WrappedError=c},72651:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GzipWrapper=void 0,t.createDeflate=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new i(e)},t.inflate=function(e){return(0,r.decompressSync)(e)};var r=n(56856);class i extends r.Gzip{constructor(e){super(e),this._chunks=[],this.ondata=(e,t)=>{if(this._chunks.push(e),!t)return;let n=0;this._chunks.forEach((e=>{n+=e.length}));const r=new Uint8Array(n);let i=0;this._chunks.forEach((e=>{r.set(e,i),i+=e.length})),this._result=r}}push(e,t){if(null!=this._result)throw new Error("Tried to push chunk to compressor after final block");e instanceof Uint8Array?super.push(e,t):e instanceof ArrayBuffer?super.push(new Uint8Array(e),t):super.push((0,r.strToU8)(e),t)}result(){if(null==this._result)throw new Error("Tried to access result before adding final block");return this._result}}t.GzipWrapper=i},33344:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}},92226:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(null===e)return"null";switch(typeof e){case"undefined":return"undefined";case"number":return`n:${e}`;case"string":return`s:${e}`;case"boolean":return`b:${e.toString()}`;case"object":{let t=n.get(e);return null==t&&(t=r++,n.set(e,t)),`o:${t}`}default:throw new Error("Unsupported type")}};const n=new WeakMap;let r=0},87614:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NUM_HEX_IN_LONG=t.HEX_LOWER=void 0,t.bytesToBuffer=function(e){const t=e.buffer;return 0===e.byteOffset&&e.length===t.byteLength?t:t.slice(e.byteOffset,e.byteOffset+e.length)},t.bytesToDebugString=function(e){let t=!0,n=e.length;for(;t&&n;){const r=e[--n];t=32<=r&&r<127}return t?JSON.stringify(String.fromCharCode.apply(String,e)):i(e)},t.createHexLong=s,t.createHexLongFrom32Bits=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=p(e),i=p(t);return`${n?"-":""}0x${r}${i}`},t.hexAt=a,t.hexLongFromNumber=function(e){const t=e<0;return s(t?(-e).toString(16):e.toString(16),t)},t.hexLongIsNegative=d,t.hexLongToHex=c,t.hexOrThrow=o,t.isBiggerHexLong=function(e,t){const n=d(e),r=d(t);if(n!==r)return!n;const i=c(e)>c(t);return n?!i:i},t.negateHexLong=function(e){return d(e)?e.slice(1):"-"+e},t.parseHex=function(e){const t=o(e);if(t.length%2!=0)throw new Error(`parseHex given hex "${t}" which is not a multiple of 8-bits.`);const n=new Uint8Array(t.length>>1);for(let e=0,r=0;e<t.length;e+=2,r++)n[r]=a(t,e)<<4|a(t,e+1);return n.buffer},t.randomHex=function(e){const t=new Uint8Array(e);return self.crypto.getRandomValues(t),i(t)},t.toHex=i,t.toLowerCaseHex=function(e){const t=[];for(let n=0;n<e.length;n++){const i=e[n];t.push(r[i>>4],r[15&i])}return String.fromCharCode.apply(String,t)};t.NUM_HEX_IN_LONG=16;const n=[48,49,50,51,52,53,54,55,56,57,65,66,67,68,69,70],r=[48,49,50,51,52,53,54,55,56,57,97,98,99,100,101,102];function i(e){const t=[];for(let r=0;r<e.length;r++){const i=e[r];t.push(n[i>>4],n[15&i])}return String.fromCharCode.apply(String,t)}function a(e,t){const n=e.charCodeAt(t);return n<=57?n-48:n<=70?10+n-65:10+n-97}function o(e){if(/[^0-9a-fA-F]/.test(e))throw new Error(`"${e}" is not a valid hex`);return e}function s(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=o(e);return u(n,16),`${t?"-":""}0x${l(n,16)}`}function l(e,t){const n=t-e.length;let r=e;for(let e=0;e<n;e++)r="0"+r;return r}function c(e){return e.substring(e.indexOf("0x")+2)}function d(e){return"-"===e[0]}function u(e,t){if(e.length>t)throw new Error(`"${e}" is longer than ${4*t} bits.`)}function p(e){if(e>4294967295||e<-4294967296)throw new Error("uint32ToLowerCaseHex given number over 32 bits");return l((e>=0?e:4294967296+e).toString(16),8)}t.HEX_LOWER=r},89181:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.inflatePhoneRegex=function(e){let t;t="number"==typeof e?String(e).split("").map((e=>".".repeat(Number(e)))).join(")("):e.replace(/;|[a-zA-Z]+/g,(e=>";"===e?")(":e.split("").map((e=>{const t=e.charCodeAt(0);return t>=97?".".repeat(t-96)+"?":".".repeat(t-64)})).join(")(")));return`(${t})`}},52230:(e,t,n)=>{"use strict";var r=n(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.WA_USER_JID_SUFFIX=t.WA_USER_DOMAIN=t.WA_SERVER_DOMAIN=t.SURVEY_USER_JID=t.STATUS_JID=t.MSGR_USER_JID_SUFFIX=t.MSGR_USER_DOMAIN=t.LID_DOMAIN=t.DEFAULT_DEVICE_ID=t.AUTHOR_SYSTEM=t.AUTHOR_ME=void 0,t.asChatJid=function(e){return e===s?null:e},t.asMulticastJid=function(e){return null==w(e)?e:null},t.asPhoneChatJid=function(e){return e===s?null:e},t.asStatusJid=function(e){return e===s?s:null},t.authorAsPhoneUserJid=function(e){if(e===a||e===o)return null;if(!e.endsWith(_))return null;return e},t.authorAsUserJid=function(e){if(e===a||e===o)return null;return e},t.authorToUserId=function(e,t){return e===a||e===o?t:M(e)},t.createJidUtils=function(e){let{platform:t}=e;const n="msgr"===t?d:_;return{toUserJid:function(e){return`${e}${n}`},toDeviceJid:function(e,t){return`${A(e)}:${t}${n}`},getUserDomain:function(){return n},getGroupCallDomain:function(){return"@call"},defaultDeviceJidForUser:function(e){return`${A(e)}:0${n}`}}},t.defaultLidDeviceJidForLidUserJid=function(e){return P(e,0)},t.defaultMsgrDeviceJidForUser=function(e){return`${A(e)}:0@msgr`},t.defaultPhoneDeviceJidForUser=function(e){return`${A(e)}:0@s.whatsapp.net`},t.extractDeviceIDParts=O,t.extractDeviceId=I,t.extractFromJid=N,t.extractJidFromJidWithType=function(e){return"phoneDevice"===e.jidType||"lidDevice"===e.jidType||"msgrDevice"===e.jidType?e.deviceJid:"lidUser"===e.jidType||"msgrUser"===e.jidType||"phoneUser"===e.jidType?e.userJid:"group"===e.jidType?e.groupJid:"status"===e.jidType?e.statusJid:"call"===e.jidType?e.callJid:(e.jidType,e.broadcastJid)},t.extractPhoneUserJid=function(e){return D(e)},t.extractUserId=M,t.extractUserJid=D,t.fullFormDeviceJidString=function(e){const{user:t,agent:n="0",device:r="0",server:i}=L(e);return`${t}.${n}:${r}@${i}`},t.getGroupDomain=function(){return l},t.getMsgrUserDomain=function(){return d},t.getServerDomain=function(){return"@s.whatsapp.net"},t.getWhatsappUserDomain=function(){return _},t.groupIdFromJid=function(e){if(e.endsWith(l))return e.slice(0,-l.length);throw new Error(`groupId called with non-group jid "${e}"`)},t.interpretAndValidateJid=k,t.interpretAsDeviceId=function(e){return e},t.interpretAsGroupJid=G,t.interpretAsNumber=function(e){return e},t.interpretAsPhoneUserJid=function(e){return e.endsWith(_)?e:null},t.interpretAsUserJid=w,t.isAuthorMe=function(e){return"@me"===e},t.isAuthorSystem=function(e){return"@system"===e},t.isPrimaryDevice=function(e){return 0===I(e)},t.lidFromLidUserJid=R,t.maybeSanitizeLogLineText=function(e){if(!e.includes("@"))return e;return e.replace(b,U)},t.parseJidParts=L,t.phoneNumberFromJid=function(e){if(!e.endsWith(_))throw new Error(`phoneNumberFromJid called with non-user jid "${e}"`);return e.slice(0,-_.length)},t.sanitizeJidForLogging=U,t.stripAgentIdFromPhoneDeviceJid=function(e){const{user:t,device:n="0",server:r}=L(e);return`${t}:${n}@${r}`},t.switchOnChatJidType=x,t.switchOnJidType=function(e,t){if(e===s)return t.status();return x(e,{phoneUser:t.phoneUser,msgrUser:t.msgrUser,lidUser:t.lidUser,group:t.group})},t.switchOnMsgrChatJidType=function(e,t){if(e.endsWith(d))return t.user(e);if(null!=G(e))return t.group(e);throw new Error(`Can not switch on chat jid ${e}`)},t.switchOnMulticastJidType=function(e,t){if(e===s)return t.multicast(s);return B(e,{user:t.user,group:t.multicast})},t.switchOnPhoneChatJidType=B,t.switchOnPhoneJidType=function(e,t){if(e===s)return t.status();return B(e,{user:t.user,group:t.group})},t.toBroadcastJid=function(e){return`${e}@broadcast`},t.toGroupJid=function(e){if(e.endsWith(l))return e;return`${e}@g.us`},t.toLidDeviceJid=P,t.toMsgrDeviceJid=function(e,t){return`${A(e)}:${t}@msgr`},t.toMsgrUserJid=C,t.toPhoneDeviceJid=function(e,t){return`${A(e)}:${t}@s.whatsapp.net`},t.toPhoneUserJid=function(e){return`${e}@s.whatsapp.net`},t.unsafeCoerceToDeviceId=z,t.unsafeCoerceToDeviceJid=F,t.unsafeCoerceToGroupJid=$,t.unsafeCoerceToLidDeviceJid=K,t.unsafeCoerceToMsgrDeviceJid=Y,t.unsafeCoerceToMsgrUserJid=V,t.unsafeCoerceToPhoneDeviceJid=j,t.unsafeCoerceToPhoneUserJid=H,t.unsafeCoerceToUserJid=W,t.userIdFromJid=A;var i=r(n(84973));t.DEFAULT_DEVICE_ID=0;const a="@me";t.AUTHOR_ME=a;const o="@system";t.AUTHOR_SYSTEM=o;const s="status@broadcast";t.STATUS_JID=s;const l="@g.us",c=/^([1-9][0-9]{0,19}|(?!10)[1-9][0-9]{4,19}-[1-9][0-9]{9})@g.us$/,d="@msgr";t.MSGR_USER_DOMAIN=d;t.MSGR_USER_JID_SUFFIX="msgr";const u=/^([1-9][0-9]{0,19}(:[1-9][0-9]{0,2})?)@msgr$/,p=/^([1-9][0-9]{0,19})@msgr$/,f=/^([1-9][0-9]{0,19}):0?@msgr$/,h="s.whatsapp.net";t.WA_SERVER_DOMAIN=h;const _="@s.whatsapp.net";t.WA_USER_DOMAIN=_;t.WA_USER_JID_SUFFIX="s.whatsapp.net";const g=/^(0|((?!10)[1-9][0-9]{4,19}(\.[0-9]{1,2})?(:[0-9]{1,2})))@s.whatsapp.net$/,m=/^(0|((?!10)[1-9][0-9]{4,19})(\.[0-9]{1,2})?)@s.whatsapp.net$/,y="@lid";t.LID_DOMAIN=y;const E=/^([1-9][0-9]{0,14})@lid$/,S=/^([1-9][0-9]{0,14}(:[0-9]{1,2})?)@lid$/,v=/^(status|location|[1-9][0-9]{0,19})@broadcast$/,T=/^([0-9a-fA-F]{18,32})@call$/;t.SURVEY_USER_JID="16505361212@s.whatsapp.net";const b=/([0-9a-zA-Z-:]+)@(g\.us|call|s\.whatsapp\.net|broadcast|msgr|lid)/g;function C(e){return`${e}@msgr`}function A(e){if(e.endsWith(_))return e.slice(0,-_.length);if(e.endsWith(d))return e.slice(0,-d.length);if(e.endsWith(y))return e.slice(0,-y.length);throw new Error(`userIdFromJid called with non-user jid "${e}"`)}function P(e,t){return`${R(e)}:${t}@lid`}function M(e){return e.split("@")[0]}function O(e){const t=e.split("@")[0].split(":"),n=t[0],r=t[1];return{userId:n,deviceID:parseInt(r,10)}}function I(e){return O(e).deviceID}function w(e){return e.endsWith(_)||e.endsWith(d)||e.endsWith(y)?e:null}function R(e){if(!e.endsWith(y))throw new Error(`lidFromLidUserJid called with non-LidUserJid "${e}"`);return e.slice(0,-y.length)}function D(e){const t=e.split("@");let n=t[0];const r=t[1];return n=n.split(":")[0],n=n.split(".")[0],`${n}@${r}`}function L(e){const[t,n]=e.split("@"),[r,i]=t.split(":"),[a,o]=r.split(".");return{user:a,device:i,agent:o,server:n}}function N(e){switch(e.jidType){case"lidUser":case"msgrUser":case"phoneUser":return e.userJid;case"group":return e.groupJid;case"status":return e.statusJid;case"lidDevice":case"msgrDevice":case"phoneDevice":return e.deviceJid;case"broadcast":return e.broadcastJid;case"call":return e.callJid;default:return(0,i.default)(e.jidType)}}function k(e){if(e===s)return{jidType:"status",statusJid:s};if(m.test(e))return{jidType:"phoneUser",userJid:e};if(p.test(e))return{jidType:"msgrUser",userJid:e};if(f.test(e)){return{jidType:"msgrUser",userJid:C(e.substr(0,e.indexOf(":")))}}return g.test(e)?{jidType:"phoneDevice",deviceJid:e}:u.test(e)?{jidType:"msgrDevice",deviceJid:e}:c.test(e)?{jidType:"group",groupJid:e.endsWith(l)?e:`${e}@g.us`}:v.test(e)?{jidType:"broadcast",broadcastJid:e}:T.test(e)?{jidType:"call",callJid:e}:E.test(e)?{jidType:"lidUser",userJid:e}:S.test(e)?{jidType:"lidDevice",deviceJid:e}:{jidType:"unknown"}}function U(e){const t=k(e);return"unknown"===t.jidType?e:"status"===t.jidType?t.statusJid:(t.jidType,N(t).replace(/^([^@]*)([^@][^@][^@][^@])@(.*)$/,"...$2@$3"))}function G(e){return e.endsWith(l)?e:null}function x(e,t){if(e.endsWith(_))return t.phoneUser(e);if(e.endsWith(d))return t.msgrUser(e);if(e.endsWith(y))return t.lidUser(e);if(null!=G(e))return t.group(e);throw new Error(`Can not switch on chat jid ${e}`)}function B(e,t){if(e.endsWith(_))return t.user(e);if(null!=G(e))return t.group(e);throw new Error(`Can not switch on chat jid ${e}`)}function F(e){return e}function j(e){return e}function Y(e){return e}function K(e){return e}function W(e){return e}function H(e){return e}function V(e){return e}function $(e){return e}function z(e){return e}},11782:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(15688),i=(0,n(14950).memoizeWithArgs)((function(e){return(0,r.encodeB64)(function(e,t){let n,r,i,o;e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;let u=1732584193,p=-271733879,f=-1732584194,h=271733878;for(let t=0;t<e.length;t+=16)n=u,r=p,i=f,o=h,u=s(u,p,f,h,e[t],7,-680876936),h=s(h,u,p,f,e[t+1],12,-389564586),f=s(f,h,u,p,e[t+2],17,606105819),p=s(p,f,h,u,e[t+3],22,-1044525330),u=s(u,p,f,h,e[t+4],7,-176418897),h=s(h,u,p,f,e[t+5],12,1200080426),f=s(f,h,u,p,e[t+6],17,-1473231341),p=s(p,f,h,u,e[t+7],22,-45705983),u=s(u,p,f,h,e[t+8],7,1770035416),h=s(h,u,p,f,e[t+9],12,-1958414417),f=s(f,h,u,p,e[t+10],17,-42063),p=s(p,f,h,u,e[t+11],22,-1990404162),u=s(u,p,f,h,e[t+12],7,1804603682),h=s(h,u,p,f,e[t+13],12,-40341101),f=s(f,h,u,p,e[t+14],17,-1502002290),p=s(p,f,h,u,e[t+15],22,1236535329),u=l(u,p,f,h,e[t+1],5,-165796510),h=l(h,u,p,f,e[t+6],9,-1069501632),f=l(f,h,u,p,e[t+11],14,643717713),p=l(p,f,h,u,e[t],20,-373897302),u=l(u,p,f,h,e[t+5],5,-701558691),h=l(h,u,p,f,e[t+10],9,38016083),f=l(f,h,u,p,e[t+15],14,-660478335),p=l(p,f,h,u,e[t+4],20,-405537848),u=l(u,p,f,h,e[t+9],5,568446438),h=l(h,u,p,f,e[t+14],9,-1019803690),f=l(f,h,u,p,e[t+3],14,-187363961),p=l(p,f,h,u,e[t+8],20,1163531501),u=l(u,p,f,h,e[t+13],5,-1444681467),h=l(h,u,p,f,e[t+2],9,-51403784),f=l(f,h,u,p,e[t+7],14,1735328473),p=l(p,f,h,u,e[t+12],20,-1926607734),u=c(u,p,f,h,e[t+5],4,-378558),h=c(h,u,p,f,e[t+8],11,-2022574463),f=c(f,h,u,p,e[t+11],16,1839030562),p=c(p,f,h,u,e[t+14],23,-35309556),u=c(u,p,f,h,e[t+1],4,-1530992060),h=c(h,u,p,f,e[t+4],11,1272893353),f=c(f,h,u,p,e[t+7],16,-155497632),p=c(p,f,h,u,e[t+10],23,-1094730640),u=c(u,p,f,h,e[t+13],4,681279174),h=c(h,u,p,f,e[t],11,-358537222),f=c(f,h,u,p,e[t+3],16,-722521979),p=c(p,f,h,u,e[t+6],23,76029189),u=c(u,p,f,h,e[t+9],4,-640364487),h=c(h,u,p,f,e[t+12],11,-421815835),f=c(f,h,u,p,e[t+15],16,530742520),p=c(p,f,h,u,e[t+2],23,-995338651),u=d(u,p,f,h,e[t],6,-198630844),h=d(h,u,p,f,e[t+7],10,1126891415),f=d(f,h,u,p,e[t+14],15,-1416354905),p=d(p,f,h,u,e[t+5],21,-57434055),u=d(u,p,f,h,e[t+12],6,1700485571),h=d(h,u,p,f,e[t+3],10,-1894986606),f=d(f,h,u,p,e[t+10],15,-1051523),p=d(p,f,h,u,e[t+1],21,-2054922799),u=d(u,p,f,h,e[t+8],6,1873313359),h=d(h,u,p,f,e[t+15],10,-30611744),f=d(f,h,u,p,e[t+6],15,-1560198380),p=d(p,f,h,u,e[t+13],21,1309151649),u=d(u,p,f,h,e[t+4],6,-145523070),h=d(h,u,p,f,e[t+11],10,-1120210379),f=d(f,h,u,p,e[t+2],15,718787259),p=d(p,f,h,u,e[t+9],21,-343485551),u=a(u,n),p=a(p,r),f=a(f,i),h=a(h,o);return new Uint8Array([255&u,u>>>8&255,u>>>16&255,u>>>24&255,255&p,p>>>8&255,p>>>16&255,p>>>24&255,255&f,f>>>8&255,f>>>16&255,f>>>24&255,255&h,h>>>8&255,h>>>16&255,h>>>24&255])}(function(e){let t;const n=[];for(n[(e.length>>2)-1]=0,t=0;t<n.length;t+=1)n[t]=0;const r=8*e.length;for(t=0;t<r;t+=8)n[t>>5]|=(255&e.charCodeAt(t/8))<<t%32;return n}(e),8*e.length))}),(e=>e));function a(e,t){const n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function o(e,t,n,r,i,o){return a((s=a(a(t,e),a(r,o)))<<(l=i)|s>>>32-l,n);var s,l}function s(e,t,n,r,i,a,s){return o(t&n|~t&r,e,t,i,a,s)}function l(e,t,n,r,i,a,s){return o(t&r|n&~r,e,t,i,a,s)}function c(e,t,n,r,i,a,s){return o(t^n^r,e,t,i,a,s)}function d(e,t,n,r,i,a,s){return o(n^(t|~r),e,t,i,a,s)}t.default=i},14950:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MemoizeCache=void 0,t.clearAllMemoizeCache=function(){n.forEach((e=>e.clear()))},t.memoizeWithArgs=function(e,t){let n;return function(){n||(n=new r);const i=t(...arguments);let a=n.get(i);return null==a&&(a=e(...arguments),n.set(i,a)),a}};const n=[];class r extends Map{constructor(){super(),n.push(this)}}t.MemoizeCache=r},45095:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"?";if(null==e)throw new Error(`Unexpected null or undefined: ${t}`);return e}},5298:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let t=n;const r=function(){if(t===n){for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];t=e.call(this,...i)}return t};return r.reset=()=>{t=n},r};const n={}},40277:(e,t,n)=>{"use strict";var r=n(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.extractDigits=function(e){const t=e.match(/\d+/g);return null!=t?t.join(""):""},t.findCC=p,t.formatPhone=f,t.formattedPhoneNumber=function(e){return f((0,o.phoneNumberFromJid)(e))},t.isPotentiallyPhoneNumber=function(e){return h.test(e)},t.isPotentiallyValid=function(e,t){if(!/^\d+$/.test(t))return!1;const n=d[e]||u(e);if(!n)return!1;return"number"==typeof n.lengths?n.lengths===t.length:n.lengths.includes(t.length)},t.phoneCC=function(e){return p(e)};var i=r(n(81574)),a=n(89181),o=n(52230);const s=/^(1|2[07]|3[0-469]|4[013-9]|5[1-8]|6[0-6]|7|8[1246]|9[0-58])/,l=new Map;class c{constructor(e){let t;if(Array.isArray(e)){t=e[0];let n=e[1];null!=n&&-1!==n&&(Array.isArray(n)||(n=[n]),this._leadins=n.map((function(e){return new RegExp("^("+e+")")}))),this._formatString=e[2]}else t=e;this._regex=new RegExp(`^${(0,a.inflatePhoneRegex)(t)}$`)}_testAndFormat(e){if(!this._regex.test(e)||!this._checkLeadins(e))return!1;if("string"==typeof this._formatString)return e.replace(this._regex,this._formatString);const t=this._regex.exec(e);return null!=t?t.slice(1).join(null!=this._formatString?"-":" "):void 0}_checkLeadins(e){return!this._leadins||this._leadins.some((function(t){return t.test(e)}))}}const d={};function u(e){const t=null!=i.default[e]?JSON.parse(`[${i.default[e]}]`):null;if(null==t)return null;const n=t.pop();return d[e]={lengths:n,formats:t.map((function(e){return new c(e)}))}}function p(e){const t=e.match(s);return t?t[0]:e.length>=3?e.substring(0,3):e}function f(e){let t=l.get(e);return null==t&&(t=function(e){const t=e.length>0&&"+"===e[0]?e.substring(1):e,n=p(t);if(!n)return t;const r=t.substring(n.length),i=d[n]||u(n);if(!i)return"+"+n+" "+r;const a=i.formats;for(let e=0;e<a.length;e++){const t=a[e]._testAndFormat(r);if(null!=t&&!1!==t&&""!==t)return"+"+n+" "+t}return"+"+n+" "+r}(e),l.set(e,t)),t}const h=/^\+*[\d ()]+$/},87040:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.makeError=function(e){return{success:!1,error:e}},t.makeSuccess=function(e){return{success:!0,value:e}}},57319:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ShiftTimer=void 0;function n(e){if(!(e>=0))throw new Error("ShiftTimer must be given delay >= 0")}t.ShiftTimer=class{constructor(e){this._timer=0,this._rafId=0,this.ts=0,this._timerTs=0,this._upperBound=0,this._lowerBound=0,this._arg=void 0,this._run=()=>{const e=this._arg,t=this._foo;this._rafId=0,this._timer=0,this.ts=0,this._timerTs=0,this._upperBound=0,this._lowerBound=0,this._arg=void 0,t(e)},this.onOrBefore=(e,t)=>{n(e);const r=Date.now()+e,i=this._upperBound;if(0!==i&&i<r)return;const a=this._lowerBound;0!==a&&r<a||(this._upperBound=r,this._rafId||this._timer&&!(r<this.ts)||this._setDelay(r,e,t))},this.forceRunNow=e=>{this._timer&&clearTimeout(this._timer),this._rafId&&cancelAnimationFrame(this._rafId),this._arg=e,this._run()},this.cancel=()=>{this._timer&&clearTimeout(this._timer),this._rafId&&cancelAnimationFrame(this._rafId),this._timer=0,this._rafId=0,this.ts=0,this._timerTs=0,this._upperBound=0,this._lowerBound=0,this._arg=void 0},this._foo=e}onOrBeforeRepaint(e){if(this._rafId)return;const t=Date.now(),n=this._lowerBound;if(0!==n&&t<n)return;const r=this._upperBound;(0===r||t<r)&&(this._upperBound=t),this._timer&&(clearTimeout(this._timer),this._timer=0),(!this.ts||this.ts>t)&&(this.ts=t),this._arg=e,this._rafId=requestAnimationFrame(this._run)}onOrAfter(e,t){n(e);const r=Date.now()+e,i=this._lowerBound;if(0!==i&&r<i)return;const a=this._upperBound;0!==a&&a<r||(this._lowerBound=r,(!this._timer||this.ts<r)&&this._setDelay(r,e,t))}debounce(e,t){n(e),this._debounce(Date.now(),e,t)}debounceAndCap(e,t,r){n(e),n(t);const i=Date.now(),a=i+t,o=this._lowerBound,s=this._upperBound;(0===o||o<=a)&&(0===s||a<s)&&(this._upperBound=a),this._debounce(i,e,r)}forceRunNowIfScheduled(){this._timer?(clearTimeout(this._timer),this._run()):this._rafId&&(cancelAnimationFrame(this._rafId),this._run())}isScheduled(){return 0!==this._timer||0!==this._rafId}_debounce(e,t,n){const r=e+t,i=this._lowerBound;if(0!==i&&r<i)return;const a=this.ts,o=this._upperBound;0!==o&&o<r?a<o&&this._setDelay(o,o-e,n):a<r&&this._setDelay(r,t,n)}_setDelay(e,t,n){if(this._rafId&&(cancelAnimationFrame(this._rafId),this._rafId=0),this._arg=n,this.ts=e,this._timer){const t=e-this._timerTs;if(-16<t&&t<16)return;clearTimeout(this._timer)}this._timer=setTimeout(this._run,t),this._timerTs=e}}},2821:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DO_NOT_RESCHEDULE=void 0,t.awaitTaskPromise=function(e){return l("awaitTaskPromise").awaitTaskPromise(e)},t.deactivate=function(e){s(e,i.DUMMY_UNIXTIME)},t.getScheduledTime=function(e){return l("getScheduledTime").getScheduledTime(e)},t.registerTask=function(e,t){l("registerTask").registerTask(e,t)},t.reschedule=s,t.rescheduleNow=function(e){s(e,(0,i.unixTime)())},t.startScheduler=function(e){__LOG__(2)`startScheduler invoked`,o||(o=new a(e))};var r=n(37178),i=n(92844);t.DO_NOT_RESCHEDULE="no_reschedule";class a{constructor(e){this._started=!1,this._resolvers={},this._timers={},this._timeoutIDs={},this._taskImplementations=new Map,this._scheduledTimeResolver=e.scheduledTimeResolver}_startTask(e){const t=this._taskImplementations.get(e);null!=t?this._scheduledTimeResolver.get(e).then((n=>{const r=null==n;if(!r&&n===i.DUMMY_UNIXTIME)return void __LOG__(2)`Task ${e} deactivated`;let a=null==n?0:1e3*n-(0,i.unixTimeMs)();a=Math.max(0,a),a=Math.min(a,~(1<<31)),__LOG__(2)`Scheduling task ${e} in ${a}ms`,this._timeoutIDs[e]=setTimeout((()=>{delete this._timeoutIDs[e],__LOG__(2)`Firing task ${e}`,t(r).then((t=>{if("no_reschedule"===t)return new Promise((()=>{}));let n;return t===i.DUMMY_UNIXTIME?(__LOG__(2)`Task ${e} complete, deactivating`,delete this._timers[e],n=i.DUMMY_UNIXTIME):t>=0?(__LOG__(2)`Task ${e} complete, waiting ${t}`,delete this._timers[e],n=(0,i.futureUnixTime)(t)):(__LOG__(2)`Task ${e} will try again later`,n=this._getNextRun(e)),this._scheduledTimeResolver.set(e,n)})).then((()=>{this._startTask(e),this._resolvers[e]&&(this._resolvers[e].forEach((e=>e())),delete this._resolvers[e])})).catch((t=>(__LOG__(2)`Task ${e} failed, try again later: ${t}`,this._scheduledTimeResolver.set(e,this._getNextRun(e)).then((()=>{this._startTask(e)})))))}),a)})):__LOG__(4,void 0,new Error)`Tried to start task ${e} before registering its implementation`}_getNextRun(e){return this._timers[e]||(this._timers[e]=(0,r.createTimer)({jitter:.1,max:1e3*i.HOUR_SECONDS,algo:{type:"fibonacci",first:1e3,second:2e3}})),(0,i.futureUnixTime)(Math.round(this._timers[e]()/1e3))}_registerResolver(e,t){this._resolvers[e]||(this._resolvers[e]=[]),this._resolvers[e].push(t)}awaitTaskPromise(e){return new Promise((t=>{this._registerResolver(e,t)}))}reschedule(e,t){this._started?(this._scheduledTimeResolver.set(e,t),null!=this._timeoutIDs[e]&&clearTimeout(this._timeoutIDs[e]),this._startTask(e)):this._scheduledTimeResolver.set(e,t)}registerTask(e,t){this._started||(this._started=!0),this._taskImplementations.set(e,t),this._startTask(e)}getScheduledTime(e){return this._scheduledTimeResolver.get(e)}}let o=null;function s(e,t){l("reschedule").reschedule(e,t)}function l(e){if(o)return o;throw new Error(`TaskScheduler::${e} called before startScheduler`)}},92844:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.YEAR_SECONDS=t.WEEK_SECONDS=t.WEEK_MILLISECONDS=t.MonotonicTimer=t.MINUTE_MILLISECONDS=t.MAX_INT=t.HOUR_SECONDS=t.HOUR_MILLISECONDS=t.DUMMY_UNIXTIME=t.DAY_SECONDS=t.DAY_MILLISECONDS=void 0,t.cappedMillisecondsUntil=h,t.castLongIntToUnixTime=function(e){return"number"!=typeof e?(0,r.hexLongIsNegative)(e)?d:c:f(e)},t.castToUnixTime=f,t.delayUntil=function(e){const t=h(e);return new Promise((e=>{setTimeout(e,t)}))},t.futureUnixTime=function(e,t){const n=null!=t?t:_();return f(Math.ceil(n+Math.max(e,0)))},t.getClockSkew=function(){return p},t.happenedWithin=function(e,t){return E(_(),e,t)},t.happenedWithinAt=E,t.isInFuture=function(e){return g(e)>0},t.isOverflowTime=function(e){return e<d||e>c},t.isWithinNext24h=function(e){return e-_()<=a},t.midnight=function(){return f((new Date).setHours(0,0,0,0)/1e3-p)},t.midnightOn=function(e){return f(S(e).setHours(0,0,0,0)/1e3-p)},t.monotonicTime=m,t.monotonicTimeSince=y,t.oldest=function(e,t){return e<t?e:t},t.pastUnixTime=function(e,t){const n=null!=t?t:_();return f(Math.ceil(n-Math.max(e,0)))},t.performanceAbsoluteNow=function(){return Date.now()},t.sameDay=function(e,t){if(Math.abs(e-t)>a)return!1;const n=u.time===e?u.day:S(e+p).getDay(),r=u.time===t?u.day:S(t+p).getDay();return u.time=t,u.day=r,n===r},t.secondsUntil=g,t.setClockSkew=function(e){p=e},t.timeSince_USE_ONLY_IF_APPROVED=function(e){return Math.max(_()-e,0)},t.timeoutFor=function(e,t){const n=_(),r=Math.max(e+t-n,0);return Math.min(1e3*r,~(1<<31))},t.toDate=S,t.toHttpHeaderDate=function(e){return S(e).toUTCString()},t.unixTime=_,t.unixTimeMs=function(){return Date.now()-1e3*p},t.unskewedDate_USE_ONLY_IF_APPROVED=function(){return new Date};var r=n(87614);const i=3600;t.HOUR_SECONDS=i;const a=86400;t.DAY_SECONDS=a;t.WEEK_SECONDS=604800;t.YEAR_SECONDS=31536e3;t.MINUTE_MILLISECONDS=6e4;const o=36e5;t.HOUR_MILLISECONDS=o;const s=864e5;t.DAY_MILLISECONDS=s;t.WEEK_MILLISECONDS=6048e5;const l=1<<31;t.DUMMY_UNIXTIME=l;const c=2147483647;t.MAX_INT=c;const d=-2147483647,u={time:0,day:-4};let p=0;function f(e){return Math.max(d,Math.min(0|e,c))}function h(e){const t=Math.max(e-_(),0);return Math.min(1e3*t,~(1<<31))}function _(){return f(Date.now()/1e3-p)}function g(e){return Math.max(e-_(),0)}function m(){return performance.now()}function y(e){return Math.floor(performance.now()-e)}function E(e,t,n){return Math.abs(e-t)<=n}function S(e){return new Date(1e3*e)}t.MonotonicTimer=class{constructor(){const e=m();this._initTime=e,this._startTime=e}reset(){this._startTime=m()}elapsed(){return y(this._startTime)}cumulative(){return y(this._initTime)}}},51737:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isBoolean=function(e){return"boolean"==typeof e},t.isFunction=function(e){return"function"==typeof e},t.isNumber=function(e){return"number"==typeof e},t.isString=function(e){return"string"==typeof e}},32428:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.concatArrayBuffers=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=t.reduce(((e,t)=>e+t.byteLength),0),i=new Uint8Array(r);let a=0;return t.forEach((e=>{i.set(new Uint8Array(e),a),a+=e.byteLength})),i.buffer}},95024:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.arrayBuffersDeepEqual=function(e,t){if(e.byteLength!==t.byteLength)return!1;const n=new DataView(e),r=new DataView(t);for(let e=0;e<n.byteLength;e++)if(n.getUint8(e)!==r.getUint8(e))return!1;return!0}},30138:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){const n=[],r=e.length,i=t.length,a=Math.max(r,i);for(let o=0;o<a;o++)o<r&&n.push(e[o]),o<i&&n.push(t[o]);return n}},48206:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.arrayMoveMutate=t.arrayMove=void 0;const n=function(e,t,n){const r=n<0?e.length+n:n,i=e.splice(t,1)[0];e.splice(r,0,i)};t.arrayMoveMutate=n;t.arrayMove=function(e,t,r){const i=e.slice();return n(i,t,r),i}},20177:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.b64Equal=function(e,t){const n=e.length,r=t.length;switch(n-r){case-2:return 61===t.charCodeAt(n)&&61===t.charCodeAt(n+1)&&t.substr(0,n)===e;case-1:return 61===t.charCodeAt(n)&&t.substr(0,n)===e;case 0:return e===t;case 1:return 61===e.charCodeAt(r)&&e.substr(0,r)===t;case 2:return 61===e.charCodeAt(r)&&61===e.charCodeAt(r+1)&&e.substr(0,r)===t;default:return!1}}},13353:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){const n=atob(e);let r=0;for(let e=0;e<n.length;e++){const i=n.charCodeAt(e);r=((r<<4)+(i>>4))%t,r=((r<<4)+(15&i))%t}return r}},78403:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(null==e)return null;const t=e.replace(/\s+$/,"");e!==t&&Math.random()<1e-5&&(__LOG__(3,void 0,void 0,!0)`base64 sanitized due to extra whitespace`,SEND_LOGS("media-key-sanitize"));return t}},27194:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return e.replace(/\//g,"_").replace(/\+/g,"-")}},93131:(e,t,n)=>{"use strict";let r,i;Object.defineProperty(t,"__esModule",{value:!0}),t.dir=function(e){!function(){if(r)return;const e=n(12182).D,t=e.length/2;r=new Int32Array(t),i=new Int32Array(t);for(let n=0,a=0;n<t;n++,a+=2)r[n]=e[a]+(0===n?0:r[n-1]),i[n]=e[a+1]}();for(let t=0;t<e.length;t++){let n=0|e.charCodeAt(t);if(55296<=n&&n<56320){if(++t===e.length)break;const r=e.charCodeAt(t);if(!(56320<=r&&r<57344))continue;n=65536+((1023&n)<<10|1023&r)}else if(56320<=n&&n<57344)continue;if(n<r[0])continue;const a=0|r.length;let o=0,s=a-1|0;for(;o<s;){const e=s+o>>1;if(r[e]>n)s=e-1|0;else{if(r[e+1]>n){s=e;break}o=e+1|0}}const l=i[s],c=r[s]+Math.abs(l)|0;if(n<c)return l<0?"rtl":"ltr"}return}},12182:(e,t)=>{"use strict";t.D=void 0;t.D=[65,26,32,26,73,1,11,1,5,1,6,23,24,31,32,449,451,7,21,2,16,5,14,1,130,4,6,2,4,4,5,1,7,1,2,3,4,1,2,20,21,83,84,140,147,166,167,38,40,49,55,-1,46,-1,2,-1,3,-1,3,-1,2,-56,64,-1,3,-1,2,-1,14,-48,82,-3,4,-101,116,-2,9,-2,12,-23,24,-30,57,-91,102,-58,67,-2,6,-3,4,-24,28,-1,10,-1,4,-1,6,-43,46,-119,167,55,56,1,2,4,12,4,5,3,10,10,12,29,30,2,3,8,10,2,4,22,23,7,8,1,4,4,7,4,10,2,4,2,3,1,9,1,5,2,3,3,7,12,14,7,8,2,7,1,2,6,10,2,4,22,23,7,8,2,3,2,3,2,6,3,27,4,5,1,8,10,12,3,4,1,13,1,2,9,10,3,4,22,23,7,8,2,3,5,8,4,12,1,2,2,5,1,16,2,6,11,19,1,9,2,3,8,10,2,4,22,23,7,8,2,3,5,8,2,3,1,7,2,4,2,12,1,5,2,3,3,7,18,29,1,2,6,9,3,4,4,7,2,3,1,2,2,5,2,5,3,6,12,16,2,3,2,5,3,4,3,6,1,7,1,15,13,27,3,4,8,9,3,4,23,24,16,19,1,4,4,23,3,8,2,6,10,17,1,8,2,3,11,12,3,4,23,24,10,11,5,8,8,9,3,4,2,11,2,9,1,2,2,6,10,11,2,17,11,12,3,4,41,43,4,9,3,4,3,4,2,6,14,18,26,28,2,3,18,21,24,25,9,10,1,3,7,15,3,9,8,14,10,12,3,15,48,49,2,14,7,15,13,50,2,3,1,2,5,6,24,25,1,2,10,11,2,11,1,3,5,6,1,10,10,12,4,36,24,26,27,28,1,2,1,6,10,11,36,54,1,6,1,3,5,54,8,9,6,7,13,50,45,49,1,7,1,3,2,4,25,27,4,7,16,20,13,14,2,4,6,7,15,16,40,41,1,6,1,3,377,378,4,6,7,8,1,2,4,6,41,42,4,6,33,34,4,6,7,8,1,2,4,6,15,16,57,58,4,6,67,72,29,32,16,32,86,88,6,9,639,640,26,31,89,96,13,14,4,18,18,21,2,11,18,32,13,14,3,18,52,54,1,8,8,9,2,13,7,8,1,4,10,48,10,16,89,96,5,7,34,35,1,6,70,80,31,35,4,6,3,7,2,3,6,19,40,42,5,16,44,48,26,32,11,48,23,25,2,5,56,57,1,10,1,2,2,10,6,19,10,16,10,16,14,100,48,49,1,6,1,2,5,6,9,13,27,36,9,14,32,36,2,4,1,4,56,57,1,3,3,4,1,4,2,10,48,56,2,7,15,18,60,67,43,45,11,22,1,14,1,8,4,5,6,7,3,5,1,6,192,256,278,280,6,8,38,40,6,8,8,9,1,2,1,2,1,2,31,33,53,54,7,8,1,4,3,4,7,10,4,6,6,10,13,18,3,4,7,24,1,1,-1,98,1,14,1,17,13,114,1,5,1,3,10,11,1,4,5,11,1,2,1,2,1,2,4,5,11,13,4,9,5,9,2,18,41,470,69,95,1,263,78,528,1,340,256,1024,47,48,47,48,133,139,4,7,2,14,38,39,1,6,1,3,56,63,2,17,23,32,7,8,7,8,7,8,7,8,7,8,7,8,7,8,7,557,3,28,9,13,2,3,5,7,5,9,86,92,3,4,90,91,4,9,43,44,94,95,48,96,45,48,48,64,28,31,50,65,12,16,167,171,99,101,31,32,6592,6656,20989,20992,1165,1232,317,320,28,48,47,64,30,32,80,82,6,48,102,103,55,57,9,51,13,14,3,4,4,5,25,27,1,9,8,16,52,64,68,78,12,36,13,14,38,46,25,36,2,13,30,36,48,49,2,6,2,4,16,17,11,15,7,8,25,26,41,47,2,4,2,13,3,4,8,9,1,3,10,12,32,33,51,52,1,4,2,4,5,7,1,2,1,25,17,19,8,19,6,8,6,8,6,15,7,8,7,8,58,64,117,118,2,3,4,7,10,16,11172,11184,23,27,49,2101,6766,6768,106,144,7,19,5,10,-1,2,-10,11,-532,534,-144,176,-13,14,-2,114,-143,177,26,32,26,37,89,92,6,8,6,8,6,8,3,38,12,13,26,27,19,20,2,3,15,17,14,48,123,128,1,2,1,5,45,48,9,86,2,67,45,176,29,32,49,96,36,45,30,35,38,48,30,31,37,41,14,56,158,160,10,16,36,40,36,40,40,48,52,63,1,145,311,320,22,32,8,160,-287,288,-225,228,-1,3,-5,9,-40,43,-4,5,-165,167,-82,89,-484,488,-8,18,-294,325,-44,46,-153,164,-175,175,1,2,54,69,7,31,10,28,49,53,2,4,7,18,1,3,25,32,10,19,36,41,1,10,18,26,35,36,3,14,52,61,10,14,2,3,16,17,20,31,18,19,28,31,2,3,1,3,6,72,7,8,1,2,4,5,15,16,11,17,47,48,3,16,10,18,2,3,8,10,2,4,22,23,7,8,2,3,5,8,3,4,4,6,2,4,3,5,1,7,1,6,7,163,56,64,2,5,1,2,21,22,1,2,3,33,51,57,1,2,4,6,1,3,4,12,10,176,50,56,4,6,1,3,27,63,51,59,2,3,1,3,4,15,10,48,43,44,1,2,2,8,1,2,1,8,10,64,27,32,2,6,1,10,16,208,47,56,1,3,1,101,83,95,8,10,1,3,8,9,2,3,30,31,2,6,1,2,4,5,3,12,10,80,8,10,42,50,4,5,4,31,1,7,2,4,40,46,2,6,8,17,1,7,2,5,46,59,1,3,9,38,57,320,9,10,38,52,8,18,29,32,32,57,1,8,1,3,1,76,7,8,2,3,38,59,1,10,10,16,6,7,2,3,37,41,2,3,1,2,1,8,10,320,19,21,4,187,1,16,21,63,923,1025,111,112,5,16,196,2944,1071,1072,9,4048,583,9216,569,576,31,32,10,14,2,98,30,37,1,11,48,55,15,25,10,11,7,8,21,26,19,707,91,192,75,80,56,67,13,77,2,3,1,13,2,16,6136,6144,1238,1280,9,8960,287,336,3,20,4,12,396,2704,107,112,13,16,9,16,10,12,1,3,1,4961,246,256,39,41,62,65,9,25,2,9,30,34,59,306,20,128,25,160,85,86,71,72,2,4,1,3,2,4,4,5,12,13,1,2,7,8,65,66,4,6,8,9,7,8,28,29,4,5,5,6,1,4,7,8,340,342,51,52,57,58,57,58,57,58,57,58,8,60,512,567,4,54,8,9,14,15,7,1659,45,55,7,9,10,14,2,370,44,48,10,1296,-208,215,-109,116,-1445,1447,-270,542,31,32,58,64,61,118,29,42,44,48,9,16,2,3504,42718,42752,4149,4160,222,224,5762,5776,7473,10576,542,2048,4939,786432,65534,65536,65534]},48447:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default=class{constructor(e){if(e<=0)throw new RangeError("BitArray:numBits should be positive");this._numBits=e,this._array=new Uint8Array(Math.ceil(this._numBits/8))}get(e){const[t,n]=this._getArrayIndexOffset(e);return Boolean(this._array[t]>>n&1)}set(e){const[t,n]=this._getArrayIndexOffset(e);this._array[t]|=1<<n}unset(e){const[t,n]=this._getArrayIndexOffset(e);this._array[t]&=~(1<<n)}toggle(e){const[t,n]=this._getArrayIndexOffset(e);this._array[t]^=1<<n}clear(){this._array=new Uint8Array(Math.ceil(this._numBits/8))}toArray(){const e=[];for(let t=0;t<this._numBits;t++)e.push(this.get(t));return e}toString(){return this.toArray().map((e=>e?"1":"0")).join("")}get length(){return this._numBits}_getArrayIndexOffset(e){if(e<0||e>=this._numBits)throw new RangeError("BitArray:index out of bounds");const t=Math.floor(e/8);return[t,e-8*t]}}},29690:(e,t,n)=>{"use strict";var r=n(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(45095));class a{constructor(e,t,n){this.key=e,this.value=t,this.timestamp=null!=n?n:Date.now(),this.prev=void 0,this.next=void 0}}class o{constructor(){this.start=new a(null,null),this.end=new a(null,null),this.start.next=this.end,this.end.prev=this.start}append(e,t){const n=new a(e,t),r=this.end,o=(0,i.default)(this.end.prev,"this.end.prev");return n.next=r,n.prev=o,r.prev=n,o.next=n,n}prepend(e,t){const n=new a(e,t),r=this.start,o=(0,i.default)(this.start.next,"this.start.next");return n.prev=r,n.next=o,r.next=n,o.prev=n,n}popEnd(){const e=(0,i.default)(this.end.prev,"this.end.prev");if(e===this.start)return;const t=(0,i.default)(e.prev,"entry.prev"),n=(0,i.default)(e.next,"entry.next");return t.next=n,n.prev=t,e.next=void 0,e.prev=void 0,e}popFront(){const e=(0,i.default)(this.start.next,"this.start.next");if(e===this.end)return;const t=(0,i.default)(e.prev,"entry.prev"),n=(0,i.default)(e.next,"entry.next");return t.next=n,n.prev=t,e.next=void 0,e.prev=void 0,e}peekFront(){const e=(0,i.default)(this.start.next,"this.start.next");if(e!==this.end)return e}peekEnd(){const e=(0,i.default)(this.end.prev,"this.end.prev");if(e!==this.start)return e}remove(e){const t=(0,i.default)(e.prev,"entry.prev"),n=(0,i.default)(e.next,"entry.next");return t.next=n,n.prev=t,e.next=void 0,e.prev=void 0,e}stats(){let e=this.start,t=0;for(;e!==this.end;)e=(0,i.default)(e.next,"entry.next"),t+=1;return t-1}}t.default=class{constructor(){this.keyMap=new Map,this.entryList=new o}lookup(e){const t=this.keyMap.get(e);if(t){this.entryList.remove(t);const e=this.entryList.append(t.key,t.value);return this.keyMap.set(e.key,e),t.value}}add(e,t){let n=this.keyMap.get(e);return n?n.value=t:(n=this.entryList.append(e,t),this.keyMap.set(e,n)),t}expireKeys(e){let t=this.entryList.peekFront();for(;t&&t.timestamp<e;)this.entryList.popFront(),this.keyMap.delete(t.key),t=this.entryList.peekFront()}printStats(){console.log("========================== STATS ============================="),console.log("entry list: ",this.entryList.stats()),console.log("map keys: ",this.keyMap.size)}}},42430:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LruCache=void 0;var r=n(57319);class i{constructor(e,t){this.key=e,this.value=t,this.prev=null,this.next=null}}t.LruCache=class{constructor(e){var t;this._keyToNode=new Map,this.purgeNow=()=>{for(let e=this._dummyTail.prev;this._currentSize>this._sizeLimit&&e!==this._dummyHead;e=e?e.prev:null){if(null==e)throw new Error("The linked list is not constructed properly.");const{key:t,value:n}=e;this._shouldEvict(t,n)&&(this.delete(t),this._onEvict&&this._onEvict(t,n))}this._onPurge&&this._onPurge(this._keyToNode)},this._sizeLimit=e.sizeLimit,this._getSize=e.getSize,this._onPurge=e.onPurge,this._shouldEvict=null!==(t=e.shouldEvict)&&void 0!==t?t:()=>!0,this._onEvict=e.onEvict,this._onAdd=e.onAdd,this._onDelete=e.onDelete,this._currentSize=0,this._dummyHead=new i("dummy-head",null),this._dummyTail=new i("dummy-tail",null),this._dummyHead.next=this._dummyTail,this._dummyTail.prev=this._dummyHead,this._purgeTimer=new r.ShiftTimer((()=>this.purgeNow()))}get(e){if(!this._keyToNode.has(e))return null;const t=this._keyToNode.get(e);if(null==t)return null;const n=t.prev,r=t.next;n&&(n.next=r),r&&(r.prev=n);const i=this._dummyHead.next;if(null==i)throw new Error("The linked list is not constructed properly.");return this._dummyHead.next=t,i.prev=t,t.prev=this._dummyHead,t.next=i,t.value}has(e){return this._keyToNode.has(e)}touch(e){this.get(e)}put(e,t){0!==this._sizeLimit&&(this._getSize(t)>this._sizeLimit?__LOG__(3)`Blob size is larger than the limit of the whole store.`:(this.delete(e),this._add(e,t),this.schedulePurge()))}_add(e,t){const n=new i(e,t);this._keyToNode.set(e,n);const r=this._dummyHead.next;if(null==r)throw new Error("The linked list is not constructed properly.");this._dummyHead.next=n,r.prev=n,n.prev=this._dummyHead,n.next=r,this._currentSize+=this._getSize(t),this._onAdd&&this._onAdd(e,t)}delete(e){if(!this._keyToNode.has(e))return;const t=this._keyToNode.get(e);if(null==t)return;this._currentSize-=this._getSize(t.value);const n=t.prev,r=t.next;n&&(n.next=r),r&&(r.prev=n),this._keyToNode.delete(e),this._onDelete&&this._onDelete(e,t.value)}clear(){this._keyToNode.clear(),this._currentSize=0,this._dummyHead.next=this._dummyTail,this._dummyTail.prev=this._dummyHead,this._onClear&&this._onClear()}schedulePurge(){this._purgeTimer.onOrBefore(1e3)}}},9006:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default=class{constructor(e,t){this._valueFn=e,this._heap=[],this._load(t)}size(){return this._heap.length}_load(e){(null==e?void 0:e.length)&&e.forEach((e=>{this.push(e)}))}_swap(e,t){const n=this._heap[t];this._heap[t]=this._heap[e],this._heap[e]=n}_siftUp(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(0===e)return;const t=this._getParent(e),n=2*t+1,r=2*t+2,i=this._heap.length;if(e>=i)return;let a=this._getVal(t),o=t;if(n<i){const e=this._getVal(n);a>e&&(o=n,a=e)}if(r<i){a>this._getVal(r)&&(o=r)}o!==t&&(this._swap(o,t),this._siftUp(t))}_doHeapify(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;const t=2*e+1,n=2*e+2,r=this._heap.length;if(e>=r)return;let i=this._getVal(e),a=e;if(t<r){const e=this._getVal(t);i>e&&(a=t,i=e)}if(n<r){i>this._getVal(n)&&(a=n)}a!==e&&this._swap(a,e),t<r&&this._doHeapify(t),n<r&&this._doHeapify(n)}_getVal(e){return this._valueFn(this._heap[e])}_getParent(e){return e%2==0?(e-2)/2:(e-1)/2}push(e){this._heap.push(e);const t=this._heap.length-1;this._siftUp(t)}pull(){const e=this._heap.shift();return this.heapify(),e}heapify(){this._doHeapify(0)}peek(){return this._heap[0]}}},55205:(e,t,n)=>{"use strict";var r=n(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(45095));class a{constructor(e){this._children={},this._indices=[],e&&(this._data=e)}static fromBackwardsStrings(e,t){return e.reduce(((e,t,n)=>e.addBackwardsString(t,n)),new a(t))._optimize()}addBackwardsString(e,t){let n=e.length-1,r=this;for(;n>=0;){const i=e.charAt(n);r._addIndex(t),r=r.get(i)||r.set(i,new a),n--}return r._addIndex(t),this}static fromForwardsStrings(e,t){return e.reduce(((e,t,n)=>e.addForwardsString(t,n)),new a(t))._optimize()}addForwardsString(e,t){let n=0,r=this;for(;n<e.length;){const i=e.charAt(n);r._addIndex(t),r=r.get(i)||r.set(i,new a),n++}return r._addIndex(t),this}set(e,t){return this._children[e]=t,t}get(e){return this._children[e]}getChildren(){return Object.keys(this._children).map((e=>({prefix:e,node:(0,i.default)(this.get(e),"this.get(prefix)")})))}hasChildren(){return!function(e){for(const t in e)return!1;return!0}(this._children)}search(e){const t=this._data;if(!t)return[];let n=this;for(let t=0;t<e.length&&n;t++){const r=e[t];n=n.get(r)}if(!n)return[];return n.getIndices().map((e=>t[e]))}_addIndex(e){this._indices.push(e)}getIndices(){const e=this._indices,t=Object.keys(this._children);return 1===t.length&&0===this._indices.length?this._children[t[0]].getIndices():e}_optimize(){if(!this.hasChildren())return this;const e=Object.keys(this._children),t=this._children[e[0]]._indices;return e.forEach((e=>{this._children[e]._optimize()})),1===e.length&&this._indices.length===t.length&&(this._indices=[]),this}testOnlyGetChildrenProperty(){return this._children}testOnlyGetIndicesProperty(){return this._indices}}t.default=a},63438:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(e===t)return!0;if(e.length!==t.length)return!1;return e.every(((e,n)=>e===t[n]))}},62971:(e,t,n)=>{"use strict";var r=n(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.defaults=void 0,t.exponentialBackoffIterator=function*(e){const{factor:t,jitter:n,maxTimeout:r,minTimeout:s,retries:l}=(0,i.default)((0,i.default)({},o),e);let c=0;for(const e of(0,a.default)(t)){if(c++,c>l)return;const t=Math.random()*n*2-n+1;yield Math.min(s*e*t,r)}};var i=r(n(73982)),a=r(n(3691));const o={factor:2,jitter:0,maxTimeout:1/0};t.defaults=o},3691:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function*(e){let t=1;for(;;)yield t,t*=e}},85396:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.filterIterator=function*(e,t){let n=0;for(const r of e)t(r,n)&&(yield r),n++},t.first=function(e){for(const t of e)return t;return},t.iteratorFromArray=function*(e){for(const t of e)yield t},t.mapIterator=function*(e,t){let n=0;for(const r of e)yield t(r,n),n++},t.rangeIterator=function*(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(0===n)throw new TypeError("Step can't be zero.");if(n>0){if(e>t)return;for(let r=e;r<t;r+=n)yield r}else{if(e<t)return;for(let r=e;r>t;r+=n)yield r}},t.takeIterator=function*(e,t){if(t<0)throw new TypeError("Count must be a positive integer");let n=0;for(const r of e){if(n>=t)return;yield r,n++}}},29984:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isNonZeroNumber=function(e){return null!=e&&0!==e&&!isNaN(e)}},65345:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function e(t,n,r){n(t).forEach((t=>e(t,n,r))),r(t)}},65023:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.astralRange=void 0,t.length=function(e){const t=e.match(n);return t?t.length:0},t.substring=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0;const i=e.match(n);if(!i)return"";return i.slice(Math.max(0,t),Math.max(0,r)).join("")},t.toArray=function(e){return e.match(n)||[]};const n=/\ud83c[\udffb-\udfff](?=\ud83c[\udffb-\udfff])|(?:[^\ud800-\udfff][\u0300-\u036f\ufe20-\ufe23\u20d0-\u20f0]?|[\u0300-\u036f\ufe20-\ufe23\u20d0-\u20f0]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff])[\ufe0e\ufe0f]?(?:[\u0300-\u036f\ufe20-\ufe23\u20d0-\u20f0]|\ud83c[\udffb-\udfff])?(?:\u200d(?:[^\ud800-\udfff]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff])[\ufe0e\ufe0f]?(?:[\u0300-\u036f\ufe20-\ufe23\u20d0-\u20f0]|\ud83c[\udffb-\udfff])?)*/g;t.astralRange=n},64331:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.codePointAt=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(e.codePointAt)return e.codePointAt(t);let n=e.charCodeAt(t);if(n>=55296&&n<=56319){const r=e.charCodeAt(t+1);r>=56320&&r<=57343&&(n=65536+(n-55296<<10)+(r-56320))}return n},t.firstNCodepoints=function(e,t){return i(e||"",0,t)},t.firstNEncodedBytes=function(e,t){if(null==t)return e;if(encodeURI(e).length<=t)return e;let n=0;const r=a(e),o=r.length;for(let a=0;a<o;a++){const o=r[a],s=encodeURI(o).length;if(n+s>t)return i(e,0,a);n+=s}return e},t.numCodepoints=function(e){return(0,r.length)(e||"")},t.substring=i,t.toArray=a;var r=n(65023);function i(e,t,n){if(null==e||""===e)return"";const i=t||0,a=null==n?1/0:n;return e.length,0===i&&a===1/0?e:e.length>=5e3&&a/e.length<=.5?function(e,t,n){const i=new RegExp(r.astralRange);let a,o="",s=0;do{a=i.exec(e),a&&(o+=a[0]),s++}while(a&&s<n);return o}(e,0,a):(0,r.substring)(e,i,a)}function a(e,t,n){const i=e||"",a=t||0,o=null==n?1/0:n;return i.length>=5e3&&o/i.length<=.5?function(e,t,n){const i=new RegExp(r.astralRange),a=[];let o;do{o=i.exec(e),o&&a.push(o[0])}while(o&&a.length<n);return a}(i,0,o):(0,r.toArray)(i).slice(a,o)}},82572:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.findSuspiciousCharacters=function(e,t,n,s){const l=e.split(".");let p,f=!1;if(l.forEach((e=>{if(f=!e.match(u),f){if(p)return null;p=e}})),null==p||f)return null;const h=[];let _=!0;const g=(0,i.toArray)(p);for(let e=0;e<g.length;e++){const t=g[e];if(_=_&&d(t),!_&&a[t]){if(h.length>=2)return null;h.push(t)}}if(_)return c(n)||c(t)||s.some((e=>function(e){return o.has(e)}(e)))?null:new Set(g);if(!h.length)return null;const m=h.filter((e=>{const i=a[e];if(null==i)return!1;if(s.some((e=>i.includes(e))))return!1;const o=new Set;for(let e=0;e<i.length;e++){const t=r.LANGUAGE_TO_REGIONS[i[e]];if(null!=t)for(let e=0;e<t.length;e++)o.add(t[e])}return!o.has(n)&&!o.has(t)}));return m.length?new Set(m):null};var r=n(36349),i=n(65023);const a={:["ast","ksf","bas","ca","cs","dua","nl","ee","ewo","fo","fr","gl","kl","hu","is","ga","dyo","kea","kkj","nmg","lkt","lag","ln","lu","mas","nnh","jgo","pt","qu","seh","sk","es","to","vai","vi","wae","cy","fy","yav","yo"],:["af","agq","bss","bfd","bas","bkv","btt","nl","igb","ewo","fr","fur","gaj","gby","kl","jab","atg","jbu","kkj","naq","ksh","ku","nmb","lmp","ln","mda","mg","mas","mzm","jgo","nin","ann","ro","sg","scn","srn","yer","tr","wa","cy","yav","yle"],:["agg","ast","az","br","ca","co","cs","nl","etr","et","fr","gl","de","tof","god","hu","tbd","geb","ksh","kup","nds","lb","arn","oc","sg","sk","es","gsw","dts","tr","tk","vo","wa","wae","fy","yll"],:["mt"],:["agq","bss","bfd","bas","bkv","btt","ddn","igb","kjy","ich","gux","haw","jab","iby","idu","jbu","kub","nmg","lv","mda","mi","mas","mql","nin","prg","gd","to","yba","yav"],:["az","crh","tr"],:["lv"],:["dsb","nv","pl","hsb"],:["bs","hr","cs","dzg","et","fi","smn","geb","khq","ses","kun","lkt","lv","lt","dsb","se","nso","prg","sr","sh","sms","sk","sl","taq","twq","tuq","hsb","wqe","dje"],:["ckl","ank","ha","ikx","kai","hia","mbu","anc","nin","pip","tal","tan","wja","wji"],:["naq"],:["naq"],:["liv"],:["fmp","dud","tmh"],:["fub","yay","bkc","bjt","bcn","bas","bsq","bmq","fue","bys","bwr","cky","fuq","ckl","asg","dbq","dnj","dgh","dow","dua","enn","ff","gby","gba","gmm","ank","gde","gkp","jgk","ha","hbb","ikx","kkj","hig","kzr","kai","kpe","nmg","hia","ffm","mbo","mbu","mif","mzm","mua","sur","anc","fuv","nin","dgi","pbi","pip","fuf","cla","sav","srr","sld","sok","tal","tan","yer","ttr","tik","kdl","tsw","vai","vut","wja","wji","fuh","gnd"],:["tzm","kab","okr","shi","tmh","taq"],:["tzm","kab","shi"],:["tzm","kab","shi","tmh","taq"],:[],:["izi","yaz","blt","vi"],:["yay","bom","bin","mfn","dzg","igb","enn","gkn","iby","ikk","ikw","izi","okr","yaz","blt","tan","tuq","vi","yo"],:["avu","mfn","igb","enn","iby","ig","ige","ikk","ikw","izi","okr","blt","tan","vi"]},o=new Set(["abq","ab","ady","av","az","ba","be","bs","bg","bua","ce","ckt","cu","cv","crh","dar","dng","myv","evn","gag","inh","kbd","xal","krc","kaa","kk","kjh","kca","ky","kv","koi","kpy","kum","lbe","lez","mk","mns","chm","mdf","mn","ttt","gld","yrk","nog","os","ru","rue","sr","sh","cjs","alt","tab","tg","tt","tkr","tk","tyv","ude","udm","uk","uz","mrj","sah"]),s=new Set(["374","994","375","387","359","995","7","383","996","389","373","976","382","381","992","993","380","998"]),l="";function c(e){return s.has(e)}function d(e){return l.includes(e)}const u=new RegExp("^[a-z0-9-]+$")},36349:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LANGUAGE_TO_REGIONS=void 0;t.LANGUAGE_TO_REGIONS={fub:["237","235","234"],af:["237","27"],agq:["237"],yay:["234"],bss:["237"],agg:["675"],ast:["34"],avu:["243","211"],az:["994"],bkc:["237","241"],ksf:["237"],bfd:["237"],bjt:["221"],bcn:["234"],bas:["237"],bsq:["231"],bkv:["234"],bom:["234"],btt:["234"],bin:["234"],bmq:["226","223"],bs:["387","385","383","382","381"],fue:["229","228"],br:["33"],bys:["234"],bwr:["234"],cky:["234"],ca:["376","33","39","34"],tzm:["212"],fuq:["234"],ckl:["234"],asg:["234"],co:["33","39"],crh:["7"],hr:["387","385","383","382","381"],mfn:["234"],cs:["420","421"],dbq:["237","234"],dnj:["225","231"],dzg:["235","227"],ddn:["229"],dgh:["234"],dow:["237"],dua:["229"],nl:["297","32","599","31","1","597"],igb:["234"],etr:["675"],enn:["234"],kgy:["675"],et:["372"],ich:["234"],ee:["229","233","228"],ewo:["237"],fo:["298"],fmp:["237"],fi:["358","46"],fr:["32","229","226","257","237","1","236","242","243","235","269","253","240","33","241","509","225","352","261","223","377","227","250","221","248","41","228","678"],fur:["39"],ff:["237","224","222","221"],gaj:["675"],gl:["34"],gby:["234"],gba:["236"],gmm:["237"],de:["43","32","49","423","352","41"],tof:["675"],god:["225"],ank:["234"],gkn:["234"],gux:["229","226","227","228"],gde:["237","234"],gkp:["224"],kl:["299"],jgk:["234"],ha:["229","237","235","233","225","227","234","249","228"],haw:["1"],hbb:["234"],hu:["36"],dud:["234"],jab:["234"],iby:["234"],is:["354"],idu:["234"],ig:["240"],ige:["234"],ikx:["256"],ikk:["234"],ikq:["234"],smn:["358"],ga:["353","44"],atg:["234"],izi:["234"],dyo:["220","221"],jbu:["237","234"],kab:["213"],kea:["238"],tbd:["675"],hig:["234"],kai:["234"],kkj:["237","236","242"],kzr:["237","235"],naq:["264"],geb:["675"],okr:["234"],ksh:["49"],ses:["223"],khq:["223"],kun:["291","251"],kup:["675"],kub:["237","234"],kpe:["224","231"],nmg:["237","240"],ku:["963","90"],lkt:["1"],hia:["234"],lag:["255"],lv:["371"],lmp:["237"],ln:["242","243"],liv:[],lt:["370"],yaz:["234"],nds:["55","49","31"],dsb:["49"],lu:["243"],lb:["32","33","49","352"],mda:["234"],mb:["261"],mt:["356"],mi:["64"],arn:["56"],mas:["254","255"],ffm:["223"],mql:["229","228"],mbo:["237"],mbu:["234"],mif:["237"],mzm:["234"],mua:["237","235"],sur:["234"],nv:["1"],anc:["234"],nnh:["237"],jgo:["237"],fuv:["237","234"],nin:["234"],dgi:["226"],se:["358","46","47"],nso:["27"],ann:["234"],oc:["33","39","377","34"],pbi:["237"],pip:["234"],pl:["48"],pt:["244","55","238","240","245","853","258","351","239","670"],prg:[],fuf:["224","223","221","232"],qu:["54","591","57","593","51"],ro:["373","40"],cla:["234"],sav:["221"],sg:["236","235","243"],gd:["44"],seh:["258"],sr:["387","385","383","382","381"],sh:["387","385","383","382","381"],srr:["220","221"],sch:["39"],sld:["226"],sms:["358"],sk:["420","421"],sl:["386"],sok:["235"],es:["54","501","591","56","57","506","53","593","503","240","502","504","52","505","507","595","51","34","1","598","58"],srn:["597"],gsw:["43","33","49","423","41"],shi:["212"],tal:["234"],tmh:["223"],taq:["226","223"],tan:["234"],twq:["227"],blt:["856","84"],yer:["234"],tuq:["235","218","227","234"],ttr:["234"],tik:["237"],to:["676"],dts:["223"],kdl:["234"],tsw:["234"],tr:["90"],tk:["993"],hsb:["49"],vai:["231","232"],vi:["855","84"],vo:[],vut:["237","234"],wja:["234"],wa:["32"],wae:["43","39","423","41"],wji:["234"],cy:["44"],fy:["31"],fuh:["229","226","227"],yba:["234"],yav:["237"],yle:["675"],yll:["675"],yo:["229","234"],dje:["227"],gnd:["237"]}},53659:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.findSuspiciousCharacters=function(e,t,n,o){const s=e.match(a),l=s&&s[1];if(null==l)return null;const c=(0,i.phoneCC)(n),d="whatsapp"===t?"":(0,i.phoneCC)(t),u=o.map((e=>e.toLowerCase()));return(0,r.findSuspiciousCharacters)(l,d,c,u)};var r=n(82572),i=n(40277);const a=/^(?:https?:\/\/)?([^/?#]+)(?:[/?#]|$)/i},46269:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.castTypedArrays=function(e,t){if(t instanceof e)return t;if("string"==typeof t)return new e((0,r.decodeB64)(t));return new e(t)};var r=n(15688)},60977:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.concatTypedArrays=function(e,t){const n=t.reduce(((e,t)=>e+t.length),0),r=new e(n);let i=0;return t.forEach((e=>{r.set(e,i),i+=e.length})),r}},91560:(e,t,n)=>{"use strict";var r=n(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.ParsableXmlNode=void 0,t.convertBytesToUint=o;var i=r(n(33344)),a=n(56225);function o(e,t){let n=0;for(let r=0;r<t;r++)n=256*n+e[r];return n}t.ParsableXmlNode=class{constructor(e,t){this._name=e,this._node=t,this._children=Array.isArray(t.content)?t.content.map((t=>new this.constructor(e,t))):null}name(){return this._name}node(){return this._node}hasAttr(e){return(0,i.default)(this._node.attrs,e)}assertTag(e){this._node.tag!==e&&this.throw(`to be <${e}>`)}tag(){return this._node.tag}maybeChild(e){const t=this._children;if(!t)return null;for(let n=0;n<t.length;n++)if(t[n].tag()===e)return t[n];return null}hasChild(e){return!!this.maybeChild(e)}child(e){const t=this.maybeChild(e);return t||this.throw(`to have child <${e}>`)}assertAttr(e,t){const n=this.attrString(e);n!==t&&this.throw(`to have "${e}"="${t}", but instead has "${n}"`)}attrString(e){return(0,i.default)(this._node.attrs,e)?this.decodeAsString(this._node.attrs[e]):this.throw(`to have attribute "${e}"`)}forEachAttributeKey(e){const t=this._node.attrs;Object.keys(t).forEach((t=>e(t)))}maybeAttrString(e){return this.hasAttr(e)?this.decodeAsString(this._node.attrs[e]):null}maybeAttrInt(e,t,n){return this.hasAttr(e)?this.attrInt(e,t,n):null}attrEnumValues(e,t,n){const r=new Set(t),i=this.attrString(e);if(!r.has(i)){if(null!=n)return n;const t=Array.from(r).join("|");return this.throw(`to have "${e}"={${t}} but has value "${i}"`)}return i}attrEnum(e,t){const n=this.attrString(e);if(!(0,i.default)(t,n)){const r=Object.keys(t).join("|");return this.throw(`to have "${e}"={${r}} but has value "${n}"`)}return t[n]}attrEnumOrNullIfUnknown(e,t){const n=this.attrString(e);return(0,i.default)(t,n)?t[n]:null}attrEnumOrDefault(e,t,n){return this.hasAttr(e)?this.attrEnum(e,t):n}attrInt(e,t,n){const r=this.attrString(e);return this._parseInt(r,e,t,n)}_parseInt(e,t,n,r){const i=parseInt(e,10);return Number.isNaN(i)?this.throw(`to have "${t}"={integer} but has value "${e}"`):void 0!==n&&i<n?this.throw(`to have "${t}"={at least ${n}} but has value ${i}`):void 0!==r&&i>=r?this.throw(`to have "${t}"={below ${r}} but has value ${i}`):i}forEachChild(e){const t=this._children;if(t)t.forEach((t=>e(t)));else if(null!=this._node.content)return this.throw("to have children")}forEachChildWithTag(e,t){this.forEachChild((n=>{n.tag()===e&&t(n)}))}mapChildren(e){const t=this._children;return t||null==this._node.content?t?t.map((t=>e(t))):[]:this.throw("to have children")}mapChildrenWithTag(e,t){const n=this._children;return n||null==this._node.content?n?n.filter((t=>t.tag()===e)).map((e=>t(e))):[]:this.throw("to have children")}mapFirstChild(e){const t=this._children;return t&&0!==t.length?e(t[0]):this.throw("to have children")}hasContent(){return!this._children&&!!this._node.content}hasChildren(){return null!=this._children}getChildren(){return this._children}getNode(){return this._node}unsafeSetChildren(e){this._children=e}unsafeSetNodeContent(e){this._node.content=e}contentUint(e){return o(this.contentBytes(e),e)}contentBytes(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;if(this._children)return this.throw("to have binary content, but has children instead");if(null!=this._node.content){const t=this._node.content;return-1!==e&&t.length!==e?this.throw(`to be ${e} bytes, but got ${t.length} instead`):t}return this.throw("to have content")}contentString(){return this._children?this.throw("to have string content, but has children instead"):null!=this._node.content?this._node.content:this.throw("to have content")}contentInt(e,t){const n=this.contentString();return this._parseInt(n,"content",e,t)}contentEnum(e){const t=this.contentString();if(!(0,i.default)(e,t)){const n=Object.keys(e).join("|");return this.throw(`to have content {${n}} but has value "${t}"`)}return e[t]}decodeAsString(e){if("string"!=typeof e)throw new Error(`decodeAsString: attribute is ${typeof e} not a string: ${e}`);return e}throw(e){throw new a.XmlParsingFailure(this._name,`expected <${this._node.tag}> ${e}`)}toString(){return this._node.toString()}}},17890:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=e.replace(/>\s{0,}</g,"><").replace(/</g,"~::~<").replace(/\s*xmlns:/g,"~::~xmlns:").replace(/\s*xmlns=/g,"~::~xmlns=").split("~::~"),n=t.length;let r=!1,i=0,a="",o=0;const s=["\n"];for(o=0;o<100;o++)s.push(s[o]+"    ");const l=function(e,t){const n=/^<[\w:\-.,]+/.exec(e[t-1]),r=/^<\/[\w:\-.,]+/.exec(e[t]);return null!=n&&null!=r&&n[0]===r[0]};for(o=0;o<n;o++)t[o].search(/<!/)>-1?(a+=s[i]+t[o],r=!0,(t[o].search(/-->/)>-1||t[o].search(/\]>/)>-1||t[o].search(/!DOCTYPE/)>-1)&&(r=!1)):t[o].search(/-->/)>-1||t[o].search(/\]>/)>-1?(a+=t[o],r=!1):l(t,o)?(a+=t[o],r||i--):t[o].search(/<\w/)>-1&&-1===t[o].search(/<\//)&&-1===t[o].search(/\/>/)?a=a+=r?t[o]:s[i++]+t[o]:t[o].search(/<\w/)>-1&&t[o].search(/<\//)>-1?a=a+=r?t[o]:s[i]+t[o]:t[o].search(/<\//)>-1?a=a+=r?t[o]:s[--i]+t[o]:t[o].search(/\/>/)>-1?a=a+=r?t[o]:s[i]+t[o]:t[o].search(/<\?/)>-1||t[o].search(/xmlns:/)>-1||t[o].search(/xmlns=/)>-1?a+=s[i]+t[o]:a+=t[o];return"\n"===a[0]?a.slice(1):a}},74277:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.XmlNode=void 0,t.attrsToString=a,t.uint8ArrayToDebugString=o;var r=n(87614);const i={};function a(e){const t=Object.keys(e);let n="";for(let r=0;r<t.length;r++){const i=t[r];n+=` ${i}="${e[i].toString()}"`}return n}function o(e){let t="";return t=0===e.length?"\x3c!-- empty binary --\x3e":e.length<50?(0,r.bytesToDebugString)(e):`\x3c!-- ${e.length} bytes --\x3e`,t}t.XmlNode=class{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.tag=e,this.attrs=t,this.content=n}toString(){let e="<"+this.tag;e+=a(this.attrs);const t=this.content;return Array.isArray(t)?e+=`>${t.map(String).join("")}</${this.tag}>`:t instanceof Uint8Array?e+=`>${o(t)}</${this.tag}>`:e+=null!=t?`>${String(t)}</${this.tag}>`:" />",e}}},56225:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.XmlParsingFailure=void 0;t.XmlParsingFailure=class{constructor(e,t){this.parser=e,this.reason=t}toString(){return`XmlParsingFailure: ${this.parser}: ${this.reason}`}}},28970:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Wam=t.PRIVATE_STATS_DEFAULT_PS_ID_KEY_HASH_INT=void 0;var r=n(69719),i=n(57319),a=n(21282);t.PRIVATE_STATS_DEFAULT_PS_ID_KEY_HASH_INT=113760892;const o={putBuffer:()=>Promise.resolve()};t.Wam=class{constructor(e){this._pending=[],this._globals=new Map,this._initialized=!1,this._buffers=new Map,this._streamId=-1,this._sink=o,this._getNextSequenceNumber=null,this.deinitialize=()=>{this._initialized=!1,this._pending=[],this._globals.clear(),this._buffers=new Map,this._streamId=-1,this._sink=o,this.serializePending.cancel(),this.finalizeBuffers.cancel()},this.enqueueEvent=(e,t,n,r,i,a)=>{this._pending.push({type:1,id:e,commitTime:t,psIdIntValue:n,weight:i,fields:r,resolve:a}),this._initialized&&this.serializePending.onOrBefore(3e3)},this.enqueueAttributesUpdate=e=>{const t={type:2,delta:[]};e.forEach(((e,n)=>{void 0!==e&&t.delta.push([n,e])})),t.delta.length>0&&(__LOG__(2)`WAM: Enqueued ${t.delta.length} attribute keys for update`,this._pending.push(t))},this.finalizeBuffers=new i.ShiftTimer((()=>{this._finalizeBuffers()})),this.serializePending=new i.ShiftTimer((()=>{this._serializePending()})),this.forceSerializePending=()=>{this._initialized&&this._hasPendingEvents()&&this.serializePending.forceRunNow()},this._channel=e}initialize(e,t,n,r){if(this._initialized)return __LOG__(4,void 0,new Error,!0)`WAM: Failed to initialize already initialized WAM`,void SEND_LOGS("wam-initialize");this._options=r,this._streamId=e,this._sink=n,this._getNextSequenceNumber=t,this._hasPendingEvents()&&this.serializePending.forceRunNow(),this._initialized=!0,__LOG__(2)`WAM: Initialized with stream id ${this._streamId}`}_finalizeBuffers(){this._buffers.forEach((e=>{e.finalize()})),this._buffers.size>0&&this.serializePending.onOrBefore(3e3)}_getKeyHashIntForSequence(e){var t;return(null===(t=this._options)||void 0===t?void 0:t.multipleSequences)?0===e?"null-psid":e:"regular"}_maybeCreateNewBuffer(e){let t=this._buffers.get(e);if(t)return t;const n=this._getKeyHashIntForSequence(e);if(null==this._getNextSequenceNumber)return __LOG__(4,void 0,new Error,!0)`WAM: Sequence number generator not initialised for channel ${this._channel}`,void SEND_LOGS("wam-serializePending");const r=this._getNextSequenceNumber(n);if(t=new a.WamBuffer(this._channel,this._streamId,r,this._globals),this._buffers.set(e,t),"regular"!==e)if(null==this._privateStatsIds)__LOG__(4,void 0,new Error,!0)`WAM: Tried to create a private buffer without setting private stats ids`,SEND_LOGS("wam-serializePending");else{const n=0===e?"none":this._privateStatsIds.get(e);null==n?(__LOG__(4,void 0,new Error,!0)`WAM: Tried to create a private buffer without setting private stats id`,SEND_LOGS("wam-serializePending")):t.writeGlobal(6005,n)}return t}_serializePending(){const e=[];this.finalizeBuffers.onOrBefore(3e5);const t=new Map;let n=-1;this._pending.forEach(((r,i)=>{if(1===r.type){let o=!0;t.forEach((e=>{(0,a.canWriteGlobal)(e)||(o=!1)}));const s=(0,a.canWriteEvent)(r.fields);if(s&&o){let e;"regular"===this._channel?e=this._maybeCreateNewBuffer("regular"):(this._channel,null==r.psIdIntValue?(__LOG__(4,void 0,new Error,!0)`A WAM event in channel private was dropped before serialization. Reason: missing psIdIntValue in the event payload`,SEND_LOGS("wam-serializePending")):e=this._maybeCreateNewBuffer(r.psIdIntValue)),null!=e&&(t.forEach(((e,t)=>{const n=this._globals.get(t);void 0!==n&&n===e||(this._buffers.forEach((n=>n.writeGlobal(t,e))),this._globals.set(t,e))})),t.clear(),e.writeEvent(r.commitTime,r.id,r.fields,r.weight))}else __LOG__(3)`A WAM event in channel ${this._channel} was dropped before serialization. Event correct: ${s}, pending attributes correct: ${o}`;null!=r.resolve&&e.push(r.resolve),n=i}else{r.type;for(let e=0;e<r.delta.length;++e){const[n,i]=r.delta[e];t.set(n,i)}}}));let i=!1;this._buffers.forEach((e=>{(e.isFinalized()||e.getSize()>65536)&&(i=!0)}));const o=[];this._buffers.forEach(((e,t)=>{e.hasEvents()?o.push([e.getKey(),e.peek(),this._getKeyHashIntForSequence(t)]):__LOG__(3)`Skipping putting buffer to sink, as it does not contain any events`}));const s=(0,r.promiseEach)(o,(e=>{let[t,n,r]=e;return this._sink.putBuffer(t,n,i,r)})).then((()=>{e.forEach((e=>{e()}))}));return this._pending=this._pending.slice(n+1),i&&(this._buffers=new Map,this.finalizeBuffers.cancel()),s}_hasPendingEvents(){return this._pending.length>0&&this._pending.some((e=>1===e.type))}isInitialized(){return this._initialized}updatePrivateStatsIds(e){if("private"!==this._channel)return __LOG__(4,void 0,new Error,!0)`WAM: Tried to set private stats ids on a non-private channel`,void SEND_LOGS("wam-updatePrivateStatsIds");this._privateStatsIds=e}}},21282:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WamBuffer=void 0,t.canWriteEvent=function(e){const t=c(e);for(let n=0;n<=t;n+=3){const t=e[n+2];if(null!=t){if(e[n+1]===i.TYPES.INT&&isNaN(t))return!1}}return!0},t.canWriteGlobal=function(e){if("number"==typeof e)return!isNaN(e);return!0};var r=n(8584),i=n(68518);function a(e,t,n,r){0===r?l(e,t,16|n):1===r?l(e,t,32|n):-128<=r&&r<128?(l(e,t,48|n),e.writeInt8(r)):-32768<=r&&r<32768?(l(e,t,64|n),e.writeInt16(r)):-2147483648<=r&&r<2147483648?(l(e,t,80|n),e.writeInt32(r)):(l(e,t,96|n),e.writeInt64(r))}function o(e,t,n,r){l(e,t,112|n),e.writeFloat64(r)}function s(e,t,n,i){const a=(0,r.numUtf8Bytes)(i);a<256?(l(e,t,128|n),e.writeUint8(a)):a<65536?(l(e,t,144|n),e.writeUint16(a)):(l(e,t,160|n),e.writeUint32(a)),e.writeString(i)}function l(e,t,n){t<256?(e.writeUint8(n),e.writeUint8(t)):(e.writeUint8(8|n),e.writeUint16(t))}function c(e){let t=-1;for(let n=0;n<e.length;n+=3)null!=e[n+2]&&(t=n);return t}t.WamBuffer=class{constructor(e,t,n,i){this._finalized=!1,this._hasEvents=!1;const a=new r.Binary(void 0,!0);switch(a.writeString("WAM"),a.writeUint8(5),a.writeUint8(t),a.writeUint16(n),e){case"regular":a.writeUint8(0);break;default:a.writeUint8(2)}this._channel=e,this._buffer=a,this._sequenceNumber=n,this._streamId=t,i.forEach(((e,t)=>{this.writeGlobal(t,e)}))}writeGlobal(e,t){if(null!=t)if("string"==typeof t)s(this._buffer,e,0,t);else if("number"==typeof t)a(this._buffer,e,0,t);else{if("boolean"!=typeof t)throw new Error("Incorrect value type "+typeof t);a(this._buffer,e,0,t?1:0)}else l(this._buffer,e,0)}writeEvent(e,t,n,r){const l=this._buffer;a(l,47,0,Math.floor(e/1e3));const d=c(n);a(l,t,-1===d?5:1,r);for(let e=0;e<=d;e+=3){const t=n[e+2];if(null!=t){const r=n[e],c=n[e+1],u=e===d?6:2;c===i.TYPES.INT?a(l,r,u,t):c===i.TYPES.BOOL?a(l,r,u,t?1:0):c===i.TYPES.STRING?s(l,r,u,t):o(l,r,u,t)}}this._hasEvents=!0}getKey(){return{streamId:this._streamId,sequenceNumber:this._sequenceNumber,channel:this._channel}}getSize(){return this._buffer.size()}peek(){return this._buffer.peek((e=>e.readByteArray()))}isFinalized(){return this._finalized}finalize(){this._finalized=!0}hasEvents(){return this._hasEvents}}},42114:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.closeChannelManager=function(){null!=r&&r.close()},t.getChannelManager=function(){null==r&&(r=new n);return r};class n{constructor(){this._sinkIsBusy=new Map,this._initializedChannel=new Map}getChannelInitialized(e){return this._initializedChannel.get(e)||!1}setChannelInitialized(e){this._initializedChannel.set(e,!0)}isSinkBusy(e){return this._sinkIsBusy.get(e)||!1}setSinkBusy(e,t){this._sinkIsBusy.set(e,t)}close(){this._sinkIsBusy.forEach(((e,t)=>{this._sinkIsBusy.set(t,!1)})),this._initializedChannel.forEach(((e,t)=>{this._initializedChannel.set(t,!1)}))}}let r},7879:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.deinitializeWAM=function(){s().deinitialize()},t.enableDebugMode=function(){a=!0},t.forceFlushBuffers=function(){s().forceFlushBuffers()},t.initializeWAM=function(e,t,n,r,i){s().initialize(n,e,t,r,i)},t.log=function(e,t,n,r,a){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;const l=Date.now();s().enqueueEvent(e,t,l,n,(0,i.appendRawFields)(r,a),o)},t.logAsync=function(e,t,n,r,a){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;const l=Date.now();return new Promise((c=>{s().enqueueEvent(e,t,l,n,(0,i.appendRawFields)(r,a),o,c)}))},t.logAttributes=function(e,t){const n=(0,i.getDeltaFromAttributes)(e);if(null==n)return;const{deltaRegular:r,deltaPrivate:a}=n;r.size>0&&s().enqueueAttributesUpdate("regular",r);a.size>0&&s().enqueueAttributesUpdate("private",a)},t.rotateBuffers=function(){s().rotateBuffers()},t.updatePrivateStatsIds=function(e){s().updatePrivateStatsIds(e)};var r=n(26305),i=n(56521);let a=!1,o=null;function s(){return o||(o=new r.WamManager),o}},26305:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WamManager=void 0;var r=n(28970);class i{constructor(e){this._sequenceNumbers=new Map,this._options=e}_setSequenceNumber(e,t){null==t||0===t||t<0?this._sequenceNumbers.set(e,"uninitialized"):this._sequenceNumbers.set(e,t)}initializeForChannel(e,t){t.forEach(((t,n)=>{var r;if("regular"===e&&"regular"===n)this._setSequenceNumber(n,t);else if("private"===e&&"regular"!==n)this._setSequenceNumber(n,t);else if("private"!==e||(null===(r=this._options)||void 0===r?void 0:r.multipleSequences)){var i;__LOG__(4,void 0,new Error)`SequenceNumberGenerator::initializeForChannel: Incorrect combination of parameters: ${e} ${n} ${null===(i=this._options)||void 0===i?void 0:i.multipleSequences}`}else this._setSequenceNumber(n,t)}))}next(e){const t=this._sequenceNumbers.get(e);let n;return null==t||"uninitialized"===t?n=1:(n=t+1,n>65535&&(n=1)),this._sequenceNumbers.set(e,n),n}}t.WamManager=class{constructor(){this._wamInstances=new Map,this._sequenceNumberGenerator=null}getWamInstance(e){let t=this._wamInstances.get(e);return t||(t=new r.Wam(e),this._wamInstances.set(e,t)),t}initialize(e,t,n,r,a){const o=this.getWamInstance(e);if(o.isInitialized())return void __LOG__(3)`WAM instance for channel ${e} has already been initialized`;null==this._sequenceNumberGenerator&&(this._sequenceNumberGenerator=new i(a));const s=this._sequenceNumberGenerator;this._sequenceNumberGenerator.initializeForChannel(e,n),o.initialize(t,(e=>s.next(e)),r,a)}deinitialize(){this._wamInstances.forEach(((e,t)=>{e.isInitialized()&&(__LOG__(2)`WamManager: Deinitializing WAM Channel ${t}`,e.deinitialize())})),this._sequenceNumberGenerator=null}enqueueEvent(e,t,n,r,i,a,o){this.getWamInstance(e).enqueueEvent(t,n,r,i,a,o)}enqueueAttributesUpdate(e,t){this.getWamInstance(e).enqueueAttributesUpdate(t)}updatePrivateStatsIds(e){this.getWamInstance("private").updatePrivateStatsIds(e)}forceFlushBuffers(){this._wamInstances.forEach((e=>{e.forceSerializePending()}))}rotateBuffers(){this._wamInstances.forEach((e=>{e.finalizeBuffers.forceRunNow()}))}}},47957:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.blindToken=function(e,t){return(0,r.runInAllocationScope)((()=>{const n=(0,r.p3Element)(),o=(0,r.allocate)(Uint8Array,32);o.set(t),a(o),i.lowlevel.scalarbase(n,o);const s=(0,r.hashToPoint)(e);(0,i.lowlevel.add)(s,n);const l=new Uint8Array(32);return(0,r.pack)(l,s),l}))},t.unblindToken=function(e,t,n){return(0,r.runInAllocationScope)((()=>{const o=(0,r.p3Element)();if((0,r.unpack)(o,e))return null;const s=(0,r.p3Element)();if(0!==(0,r.unpackneg)(s,n))return null;const l=(0,r.allocate)(Uint8Array,32);l.set(t),a(l);const c=(0,r.p3Element)();i.lowlevel.scalarmult(c,s,l);(0,i.lowlevel.add)(o,c);const d=new Uint8Array(32);return(0,r.pack)(d,o),d}))};var r=n(30141),i=n(13059);function a(e){e[0]&=248,e[31]&=127,e[31]|=64}},11562:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.closeWamStorage=function(){(0,a.deinitializeWAM)(),(0,i.closeChannelManager)(),l=null,s=null},t.getFinishedStreamBuffers=function(e){return c("getFinishedStreamBuffers").getBuffers().then((t=>(0,o.getFinishedBuffers)(e,t)))},t.initializeWAMSink=function(e,t,n,r){const l=c("initializeWAMSink"),d=(0,i.getChannelManager)();if(d.getChannelInitialized(t))return Promise.resolve();d.setChannelInitialized(t);const u=l.getStreamId(e),p={putBuffer(e,r,i,a){if(d.isSinkBusy(t))return __LOG__(3)`WamStorage: Sink flush did not happen within timeout, buffer is not saved`,Promise.resolve();d.setSinkBusy(t,!0);const{bufferKey:s,meta:c,bufferRow:p}=(0,o.asBufferEntry)(e,t,u,r,i);return l.saveBuffer(c,p,a).then((()=>{const t=[e.streamId,e.sequenceNumber];__LOG__(2)`WamStorage: Successfully put buffer ${t} to sink`,i&&(n(),__LOG__(2)`WamStorage: Buffer ${s} is scheduled for send`)})).finally((()=>{d.setSinkBusy(t,!1)}))}};null==s&&(s=l.finishBuffer(u));return s.then((()=>{if(l.getStartingSequenceNumbers)return l.getStartingSequenceRow,l.getStartingSequenceNumbers(t,u);if(l.getStartingSequenceRow,null==r?void 0:r.multipleSequences)throw new Error("getStartingSequenceRow must not used when enabling support for multiple sequences");return l.getStartingSequenceRow(u).then((e=>{const t=(0,o.getSequenceNumber)(e),n=new Map;return n.set("regular",t),n}))})).then((e=>{(0,a.initializeWAM)(u,e,t,p,r),"private"===t&&l.updatePrivateStatsIds&&l.updatePrivateStatsIds().then(a.updatePrivateStatsIds)}))},t.nukeMetrics=function(){return c("nukeMetrics").nukeMetrics()},t.privateStatsKillSwitchGetBlockedToken=function(){const e=c("privateStatsKillSwitchGetBlockedToken");if(!e.privateStatsKillSwitchGetBlockedToken)throw new Error("privateStatsKillSwitchGetBlockedToken not implemented for WAM DB");return e.privateStatsKillSwitchGetBlockedToken()},t.privateStatsKillSwitchSet=function(e){const t=c("privateStatsKillSwitchSet");if(!t.privateStatsKillSwitchSet)throw new Error("privateStatsKillSwitchSet not implemented for WAM DB");return t.privateStatsKillSwitchSet(e)},t.redeemPrivateStatsToken=function(){const e=c("getPrivateStatsToken");if(!e.redeemPrivateStatsToken)throw new Error("redeemPrivateStatsToken not implemented for WAM DB");return e.redeemPrivateStatsToken(u)},t.removeBufferByKey=function(e){return c("removeBufferByKey").removeBufferByKey(e)},t.savePrivateStatsToken=function(e){const t=c("savePrivateStatsToken");if(!t.savePrivateStatsToken)throw new Error("savePrivateStatsToken not implemented for WAM DB");return t.savePrivateStatsToken(e)},t.startWamStorage=function(e){null==l?l=e:(__LOG__(3,void 0,void 0,!0)`startWamStorage: called again`,SEND_LOGS("startWamStorage"))};var r=n(92844),i=n(42114),a=n(7879),o=n(56521);let s=null,l=null;function c(e){if(l)return l;throw new Error(`WamStorage::${e} called before startWamStorage`)}const d=r.DAY_SECONDS,u=(e,t)=>{const n={maxRedeemCount:(null==t?void 0:t.maxRedeemCount)||64,maxExpirySeconds:(null==t?void 0:t.maxExpirySeconds)||d};return(0,r.happenedWithin)(e.creationTs,n.maxExpirySeconds)?!(e.redeemCount>=n.maxRedeemCount)||(__LOG__(2)`The private stats token was redeemed maximum number of time. The client shall re-issue a new one`,!1):(__LOG__(2)`The private stats token expired. The client shall re-issue a new one`,!1)}},68518:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TYPES=void 0;t.TYPES={INT:0,BOOL:1,STRING:2,FLOAT:3}},56521:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.appendRawFields=function(e,t){if(null==t||0===t.length)return e;const n=new Map;for(let t=0;t<e.length;t+=3){const r=e[t];n.set(r,t)}for(let r=0;r<t.length;++r){const[i,o,s]=t[r];if(null==s)continue;const l=n.get(i);if(null!=l){if(void 0!==e[l+2])continue}a[o]===typeof s&&(null==l?(n.set(i,e.length),e.push(i,o,s)):e[l+2]=s)}return e},t.asBufferEntry=function(e,t,n,i,a){const o=function(e){return JSON.stringify([e.streamId,e.sequenceNumber,e.channel])}(e);return{bufferKey:o,meta:{streamId:e.streamId,sequenceNumber:e.sequenceNumber},bufferRow:{key:o,channel:t,streamId:n,buffer:(0,r.encodeB64)(i),finished:a}}},t.getDeltaFromAttributes=function(e){const t=new Map,n=new Map;for(let r=0;r<e.length;r+=4){const a=e[r],o=e[r+1],s=e[r+2],l=e[r+3];if(s===i.TYPES.FLOAT)throw new Error("Float attributes are currently not supported in runtime");if(!Array.isArray(a))return __LOG__(4,void 0,new Error,!0)`logAttributes WAM channel is not an array`,void SEND_LOGS("wam-log-attributes");a.includes("regular")&&t.set(o,l),a.includes("private")&&n.set(o,l)}return{deltaRegular:t,deltaPrivate:n}},t.getFinishedBuffers=function(e,t){const n=[];return t.forEach((t=>{const{channel:i}=t;if(null==i){if("regular"!==e)return}else if(i!==e)return;if(t.finished){const e=new Uint8Array((0,r.decodeB64)(t.buffer)),i=t.key;n.push({key:i,content:e})}})),n},t.getSequenceNumber=function(e){let t=null;e&&(t=e.sequenceNumber);return t};var r=n(15688),i=n(68518);const a={[i.TYPES.INT]:"number",[i.TYPES.FLOAT]:"number",[i.TYPES.STRING]:"string",[i.TYPES.BOOL]:"boolean"}},51631:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(8584),a=n(65885),o=r(n(89350));let s,l=0;t.default=class{constructor(e){this.oggBlob=e}generateBlob(){return this.oggBlobToWAVBlob(this.oggBlob,1)}oggBlobToWAVBlob(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return new Promise((n=>{const r=new o.default,i=[],c=[],d=(l++,s||new window.AudioContext),u={outputBufferSampleRate:d.sampleRate,bufferLength:4096};r.onmessage=e=>{if(null==e.data){for(let e=0;e<t;e++)i.forEach((t=>{const n=t[e]||t[0];for(let e=0;e<n.length;e++)c.push(n[e])}));const e=this.encodeWAV(c,d,t),r=new Blob([e.readByteArray()],{type:"audio/wav"});l--,0===l&&s&&(s.close&&s.close(),s=void 0),n(r)}else i.push(e.data),t=i[0].length},r.postMessage({command:"decode-init",config:u}),(0,a.blobToArrayBuffer)(e).then((e=>{r.postMessage({command:"decode",pages:new Uint8Array(e)}),r.postMessage({command:"decode-done"})})).catch((e=>{__LOG__(3)`Player::oggBlobToWAVBlob error: ${e}`}))}))}encodeWAV(e,t,n){const r=new i.Binary(void 0,!0);r.ensureCapacity(44+2*e.length),r.writeString("RIFF"),r.writeUint32(36+2*e.length),r.writeString("WAVE"),r.writeString("fmt "),r.writeUint32(16),r.writeUint16(1),r.writeUint16(n),r.writeUint32(t.sampleRate),r.writeUint32(t.sampleRate*n*2),r.writeUint16(2*n),r.writeUint16(16),r.writeString("data"),r.writeUint32(2*e.length);for(let t=0;t<e.length;t++){let n=Math.max(-1,Math.min(e[t],1));n*=n>0?32767:32768,r.writeInt16(Math.floor(n))}return r}}},46977:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.queryBusinessCategories=function(e){if(e===a.BUSINESS_CATEGORY_EMPTY_STR_ID)return(0,s.queryBusinessCategories)("");return(0,s.queryBusinessCategories)(e)},t.queryBusinessProfile=function(e,t){return(0,o.queryBusinessProfile)(e,t)},t.queryBusinessPublicKey=function(e){return(0,o.queryBusinessPublicKey)(e)},t.querySignedUserInfo=function(){return d.apply(this,arguments)},t.updateCartEnabled=function(){return c.apply(this,arguments)};var i=r(n(48926)),a=n(32742),o=n(79235),s=n(40346),l=n(99234);function c(){return(c=(0,i.default)((function*(e){const t=n(93581).BusinessProfileCollection,r=yield(0,o.updateCartEnabled)(e),i=t.getValid((0,l.getMeUser)()),a=null==i?void 0:i.profileOptions;i&&a&&(a.cartEnabled=r,t.add(i,{merge:!0}))}))).apply(this,arguments)}function d(){return(d=(0,i.default)((function*(e){const{phoneNumber:t,phoneNumberSignature:n,phoneNumberSignatureExpiration:r,businessDomain:i}=yield(0,o.querySignedUserInfo)(e);if(null==t||null==r||null==n||null==i)throw new Error("Unexpected null or undefined");return{phoneNumber:t,phoneNumberSignature:n,phoneNumberSignatureExpiration:r,businessDomain:i}}))).apply(this,arguments)}},9762:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return c.apply(this,arguments)};var i=r(n(48926)),a=n(10635),o=n(8197),s=n(99234),l=n(5819);function c(){return(c=(0,i.default)((function*(e,t,n){const r=p(t),i=p(n),a=[u(e,r,i),d(e,r,i)];yield Promise.all(a.map((t=>t?(0,l.handleSingleMsgMD)(e,t):null)))}))).apply(this,arguments)}function d(e,t,n){if(!0===(0,s.getGlobalSecurityNotifications)())return t===o.ReducedPrivacyMode.E2EE&&n!==o.ReducedPrivacyMode.E2EE?(0,a.genEncryptNotificationMsg)(e,"e2e_identity_unavailable"):void 0}function u(e,t,n){if(t!==n)switch(n){case o.ReducedPrivacyMode.E2EE:return(0,a.genEncryptNotificationMsg)(e,"encrypt_now");case o.ReducedPrivacyMode.BSP:return(0,a.genTealNotificationTemplateMsg)(e,"biz_privacy_mode_to_bsp");case o.ReducedPrivacyMode.FB:return(0,a.genTealNotificationTemplateMsg)(e,"biz_privacy_mode_to_fb")}}function p(e){return(0,o.getReducedPrivacyMode)(e.isBusiness&&e.isEnterprise?e.privacyMode:null)}},96519:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addProduct=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100;return(0,s.addProduct)(e,t,n)},t.appealProduct=function(e,t){return(0,s.appealProduct)(e,t)},t.createBusinessCatalog=function(){return(0,s.createCatalog)()},t.deleteProducts=function(e){return(0,s.deleteProducts)(e)},t.editProduct=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100;return(0,s.editProduct)(e,t,n)},t.queryCatalog=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:100,a=arguments.length>5?arguments[5]:void 0,o=arguments.length>6&&void 0!==arguments[6]&&arguments[6];return(0,s.queryCatalog)(e,t,n,r,i,a,o)},t.queryProduct=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100,i=arguments.length>4?arguments[4]:void 0,a=arguments.length>5?arguments[5]:void 0;return(0,s.queryProduct)(e,t,n,r,i,a)},t.queryProductList=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100,i=arguments.length>4?arguments[4]:void 0;return(0,s.queryProductList)(e,t,n,r,i)},t.reportProduct=function(e,t,n){return(0,s.reportProduct)(e,t,n)},t.sendProductToChat=function(e,t,n){const{catalogWid:s}=e;if(!t)return;const c=t.productCollection.get(e.id),d=c?(0,l.unproxy)(c):(0,l.unproxy)(e);if(!d)return;const u=d.getProductImageCollectionHead(),p=null==u?void 0:u.mediaData;if(!p)return;(0,a.findChat)(s).then((function(e){i.Cmd.openChatFromUnread(e).then((t=>{if(t){const t=(0,l.unproxy)((0,o.createProductInquiry)(d,s,p,null==n?void 0:n.session.toString()));e.composeQuotedMsg=t,i.Cmd.focusChatTextInput(e),window.innerWidth<=r.LAYOUT_2COLUMNS_MAX_WIDTH&&i.Cmd.closeDrawerRight()}}))}))};var r=n(41906),i=n(88102),a=n(50101),o=n(17304),s=n(21374),l=(n(27798),n(31019))},92002:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.updateProductListHeaderImageRejected=function(e,t){var n,i,a;const o=r.MsgCollection.get(t),s=null==o||null===(n=o.list)||void 0===n||null===(i=n.productListInfo)||void 0===i||null===(a=i.headerImage)||void 0===a?void 0:a.productId;e.id===s&&null!=o&&(o.productHeaderImageRejected=!0)};var r=n(59871)},31452:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.applyContactBusinessProps=void 0,t.updateContactsWithVerifiedNames=p;var i=r(n(48926)),a=r(n(45095)),o=n(88555),s=n(45454),l=n(93170),c=n(19380),d=n(49714),u=n(68708);function p(e,t){const n={};for(const t of e){const{id:e}=t;n[e.user]=t}for(const e of t){const{id:t}=e,r=n[t.user],i=Boolean(r),{level:a,name:o,isApi:s,privacyMode:l}=r||{},c={isBusiness:i,isEnterprise:Boolean(s),verifiedLevel:h(a),verifiedName:o,privacyMode:l};e.set(c)}}const f=function(){var e=(0,i.default)((function*(){if((0,o.isLegacyWebdBackend)())return;p((yield(0,u.getAllVerifiedNames)()).map((e=>{let{id:t,name:n,level:r,isApi:i,privacyMode:o}=e;return{id:(0,s.createUserWid)(t),name:n,level:r,isApi:i,privacyMode:o?{actualActors:(0,a.default)(d.ActualActorsEnumType.cast(o.actualActors),"ActualActorsEnumType.cast(privacyMode.actualActors)"),hostStorage:(0,a.default)(d.HostStorageEnumType.cast(o.hostStorage),"HostStorageEnumType.cast(privacyMode.hostStorage)"),privacyModeTs:o.privacyModeTs}:null}})),c.ContactCollection.toArray())}));return function(){return e.apply(this,arguments)}}();function h(e){if(null!=e){switch(e){case"unknown":return l.VERIFIED_LEVEL.UNKNOWN;case"low":return l.VERIFIED_LEVEL.LOW;case"high":return l.VERIFIED_LEVEL.HIGH}return l.VERIFIED_LEVEL.UNKNOWN}}t.applyContactBusinessProps=f},66167:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.queryAndUpdateContactPropertiesOnNewChat=function(){return f.apply(this,arguments)},t.updateVerifiedInfo=u;var i=r(n(48926)),a=n(88555),o=n(19380),s=n(39354),l=n(57547),c=n(31452),d=n(68708);function u(){return p.apply(this,arguments)}function p(){return(p=(0,i.default)((function*(e,t){const n=e.id,{name:r,level:i,isApi:o,serial:l}=t,u=t.privacyMode;(0,a.isMDBackend)()&&null!=u&&(yield(0,s.handlePrivacyModeTransition)(n,u,null,!0)),(0,c.updateContactsWithVerifiedNames)([{id:n,name:r,level:i,isApi:o,privacyMode:u}],[e]),yield(0,d.createOrUpdateVerifiedBusinessName)({id:n.user,level:i,serial:l,name:r,isApi:o,privacyMode:u?{actualActors:u.actualActors,hostStorage:u.hostStorage,privacyModeTs:u.privacyModeTs}:null})}))).apply(this,arguments)}function f(){return(f=(0,i.default)((function*(e){if((0,a.isMDBackend)()){const t=yield(0,l.queryExists)(e);if(null==t)return;const{bizInfo:n}=t;if(n){const t=o.ContactCollection.get(e);if(null==t)return __LOG__(4,void 0,new Error,!0)`queryAndUpdateContactPropertiesOnNewChat contact does not exist ${""}`,void SEND_LOGS("queryAndUpdateContactPropertiesOnNewChat contact does not exist");yield u(t,n.verifiedName)}}}))).apply(this,arguments)}},92027:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleVerifiedNameSync=function(){return c.apply(this,arguments)};var i=r(n(48926)),a=n(88555),o=n(39354),s=n(31452),l=n(85808);function c(){return(c=(0,i.default)((function*(e){if((0,a.isLegacyWebdBackend)()||0===e.length)return;yield e.map((e=>{let{id:t,verifiedName:{privacyMode:r}}=e;if(null==r)return;const i=n(69951).ChatCollection.get(t);return null!=i&&!0!==i.shouldAppearInList?(0,o.handlePrivacyModeTransition)(t,r,i,!0):void 0}));const t=e.map((e=>{let{id:t,verifiedName:{level:n,serial:r,name:i,isApi:a,privacyMode:o}}=e;return{id:t.user,level:n,serial:r,name:i,isApi:a,privacyMode:o?{actualActors:o.actualActors,hostStorage:o.hostStorage,privacyModeTs:o.privacyModeTs}:null}}));yield(0,l.getTable)().bulkCreateOrReplace(t),yield(0,s.applyContactBusinessProps)()}))).apply(this,arguments)}},48504:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.shouldEnableArchiveV2=function(){if((0,i.isMDBackend)())return!1;const e=n(69951).ChatCollection.filter((e=>e.archive));return(0,a.archiveV2Supported)()&&!s.default.archive.enabled&&1===e.length},t.shouldUnarchiveChat=function(e){if((0,a.archiveV2Supported)()){if(s.default.showArchiveV2)return!1;if((0,i.isLegacyWebdBackend)()&&!s.default.archive.enabled&&!e)return(0,o.setArchiveEnabledSetting)(!0),!1}return!0},t.shouldUnarchiveChatOnReaction=function(e,t,n){if(e&&!t&&""!==n)return!(0,a.archiveV2Supported)()||!s.default.showArchiveV2;return!1};var i=n(88555),a=n(57701),o=n(92052),s=r(n(68132))},26878:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return d.apply(this,arguments)};var i=r(n(48926)),a=n(24606),o=n(24175),s=n(14777),l=n(76290),c=n(58871);function d(){return(d=(0,i.default)((function*(e,t,n){var r,i;let d=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(e.isGroup)return __LOG__(4,void 0,new Error,!0)`chat.maybeUpdateEphemeralSetting should not be called for group ${e.id.toString()}`,SEND_LOGS("handle-ephemeral-sync-response"),!1;if(!(0,s.isEphemeralDurationAllowed)(t))return __LOG__(2)`chat.maybeUpdateEphemeralSetting called with invalid setting ${t} seconds for chat ${e.id.toString()}`,!1;const u=null!==(r=e.ephemeralSettingTimestamp)&&void 0!==r?r:0,p=null!==(i=e.ephemeralDuration)&&void 0!==i?i:0,f=e.id,h=(0,l.shouldUpdateEphemeralSetting)({oldDuration:p,oldSettingTimestamp:u,newDuration:t,newSettingTimestamp:n,chatId:f});return h&&(yield(0,c.updateLocal)(e.id,{ephemeralDuration:t,ephemeralSettingTimestamp:n,disappearingModeInitiator:a.DisappearingModeInitiator.ChangedInChat}),p!==t&&d&&(yield(0,o.generateEphemeralSystemMessage)(e,t)),e.ephemeralDuration=t,e.ephemeralSettingTimestamp=n,e.disappearingModeInitiator=a.DisappearingModeInitiator.ChangedInChat,__LOG__(2)`chat.maybeUpdateEphemeralSetting updated chatId=${e.id.toString()} ephemeralDuration=${t} ephemeralSettingTimestamp=${n}`),h}))).apply(this,arguments)}},50039:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(e.isGroup)return __LOG__(4,void 0,new Error,!0)`chat.updateEphemeralSettingTimestamp should not be called for group ${e.id.toString()}`,void SEND_LOGS("update-ephemeral-setting-timestamp");(0,r.updateLocal)(e.id,{ephemeralSettingTimestamp:t}).then((()=>{e.ephemeralSettingTimestamp=t,__LOG__(2)`chat.updateEphemeralSettingTimestamp chatId=${e.id.toString()} ephemeralSettingTimestamp=${t}`}))};var r=n(58871)},50101:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.findChat=function(){return l.apply(this,arguments)};var i=r(n(48926)),a=n(89385),o=n(91829),s=n(9025);function l(){return(l=(0,i.default)((function*(e,t,n){if(null==n?void 0:n.aborted)throw new a.AbortError;const r=yield(0,s.getExisting)(e);if(r)return r;if(null==n?void 0:n.aborted)throw new a.AbortError;return yield(0,o.create)(e,{createdLocally:!0},{forceUsync:t})}))).apply(this,arguments)}},41220:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let{chat:t,undelivered:n,canForward:r,cannotForward:o}=e;const s=r.length-n.length,l=o.length+n.length;if(s>0)return n.length?o.length?t.isUser?a.default.t(257,{count:l,_plural:l,contact:t.formattedTitle}):a.default.t(257,{count:l,_plural:l}):a.default.t(256,{count:l,_plural:l}):a.default.t(254,{count:l,_plural:l,contact:t.formattedTitle});if(n.length)return o.length?t.isUser?a.default.t(258,{contact:t.formattedTitle}):a.default.t(258):i.fbt._("No messages could be forwarded because the file is missing.",null,{hk:"1dn9Vk"});if(!t.isUser)return a.default.t(255);return a.default.t(255,{contact:t.formattedTitle})};var i=n(48360),a=r(n(14296))},82058:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(40265);class i extends((0,r.customError)("ForwardError")){constructor(e){super(),this.reasons=e}}t.default=i},60629:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.createChatOnNewMsg=function(){return l.apply(this,arguments)};var i=r(n(48926)),a=n(8197),o=n(19380),s=n(91829);function l(){return(l=(0,i.default)((function*(e,t,n){if(!e.isUserNotPSA())return;const r=o.ContactCollection.gadd(e);(0,a.comparePrivacyMode)(n,r.privacyMode)>0&&(r.privacyMode=n),yield(0,s.create)(e,{createdLocally:!1},{firstIncomingMsg:t,nextPrivacyMode:r.privacyMode})}))).apply(this,arguments)}},371:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.clearPresence=function(e){e.presenceResendTimerId&&(clearTimeout(e.presenceResendTimerId),e.unset("presenceResendTimerId"));e.pausedTimerId&&(clearTimeout(e.pausedTimerId),e.unset("pausedTimerId"));e.typing=!1},t.markComposing=function(e){return function(e){if((e.presence.isOnline||e.isGroup||e.isPresenceUnknown())&&!e.typing){const t=e.id;(0,a.sendChatStateComposing)(t).catch((0,r.filteredCatch)(i.ServerStatusCodeError,(e=>{e.status>=400&&__LOG__(3)`models:chat send presence composing error ${t.toString()}`}))).catch((0,r.filteredCatch)([i.WebdDrop,o.ProtoVersionUndefined],(()=>{}))),e.presenceResendTimerId=setTimeout((()=>p(e)),d)}e.typing=!0,e.pausedTimerId&&clearTimeout(e.pausedTimerId);e.pausedTimerId=setTimeout((()=>u(e)),2500)}((0,l.unproxy)(e))},t.markPaused=function(e){return u((0,l.unproxy)(e))},t.markRecording=function(e){return function(e){if((e.presence.isOnline||e.isGroup||e.isPresenceUnknown())&&!e.recording){const t=e.id;(0,a.sendChatStateRecording)(t).catch((0,r.filteredCatch)(i.ServerStatusCodeError,(e=>{e.status>=400&&__LOG__(3)`models:chat send presence recording error ${t.toString()}`}))).catch((0,r.filteredCatch)([i.WebdDrop,o.ProtoVersionUndefined],(()=>{}))),e.presenceResendTimerId=setTimeout((()=>p(e)),d)}e.pausedTimerId&&(clearTimeout(e.pausedTimerId),e.unset("pausedTimerId"));e.recording=!0,e.typing=!1}((0,l.unproxy)(e))},t.presenceOnlineChanged=function(e){e.presence.isOnline?p(e):e.presenceResendTimerId&&(clearTimeout(e.presenceResendTimerId),e.unset("presenceResendTimerId"))},t.sendPresenceAvailable=function(){(0,s.setPresenceAvailable)()},t.sendPresenceUnavailable=function(){(0,s.setPresenceUnavailable)()};var r=n(50796),i=n(92574),a=n(76931),o=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=c(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(35232)),s=n(2253),l=n(31019);function c(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(c=function(e){return e?n:t})(e)}const d=1e4;function u(e){if((e.presence.isOnline||e.isGroup||e.isPresenceUnknown())&&(e.typing||e.recording)){const t=e.id;(0,a.sendChatStatePaused)(t).catch((0,r.filteredCatch)(i.ServerStatusCodeError,(e=>{e.status>=400&&__LOG__(3)`models:chat send presence paused error ${t.toString()}`}))).catch((0,r.filteredCatch)([i.WebdDrop,o.ProtoVersionUndefined],(()=>{})))}e.presenceResendTimerId&&(clearTimeout(e.presenceResendTimerId),e.unset("presenceResendTimerId")),e.pausedTimerId&&(clearTimeout(e.pausedTimerId),e.unset("pausedTimerId")),e.typing=e.recording=!1}function p(e){const t=e.id;if(e.recording)(0,a.sendChatStateRecording)(t).catch((0,r.filteredCatch)(i.ServerStatusCodeError,(e=>{e.status>=400&&__LOG__(3)`models:chat send presence resend recording error ${t.toString()}`}))).catch((0,r.filteredCatch)([i.WebdDrop,o.ProtoVersionUndefined],(()=>{})));else{if(!e.typing)return void e.unset("presenceResendTimerId");(0,a.sendChatStateComposing)(t).catch((0,r.filteredCatch)(i.ServerStatusCodeError,(e=>{e.status>=400&&__LOG__(3)`models:chat send presence resend composing error ${t.toString()}`}))).catch((0,r.filteredCatch)([i.WebdDrop,o.ProtoVersionUndefined],(()=>{})))}e.presenceResendTimerId=setTimeout((()=>p(e)),d)}},83802:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.clearChat=E,t.clearMessagesInChatModel=S,t.createEncryptionSystemMessage=function(e,t){if((0,s.isLegacyWebdBackend)())return Promise.resolve();if(t)return Promise.resolve();const{handleSingleMsgMD:r}=n(5819),i=(0,l.default)(e.id,e.contact.privacyMode);return r(i.from,i)},t.sendClear=function(e,t){return y((0,_.unproxy)(e),t)};var i=r(n(48926)),a=n(50796),o=n(92574),s=n(88555),l=r(n(29224)),c=n(48360),d=n(46331),u=n(91177),p=n(88102),f=n(57701),h=r(n(14296)),_=n(31019),g=n(58871),m=n(85893);function y(e,t){const{promises:r}=e;if(r.sendClear)return r.sendClear;const _=e.getLastMsgKeyForAction(),v=r.sendClear=(0,u.sendClear)(e,_,t),T=new d.ActionType(h.default.t(19)),b=v.then(function(){var t=(0,i.default)((function*(){const t=n(63183).ConversationEndOfHistoryTransferModelPropType;return e.endOfHistoryTransferType=t.COMPLETE_AND_NO_MORE_MESSAGE_REMAIN_ON_PRIMARY,yield(0,g.updateLocal)(e.id,{endOfHistoryTransferType:t.COMPLETE_AND_NO_MORE_MESSAGE_REMAIN_ON_PRIMARY}),(0,s.isMDBackend)()&&!(0,f.clearOrDeleteChatSyncEnabled)()?new d.ActionType(c.fbt._("Chat cleared from this device",null,{hk:"1XIeYe"})):new d.ActionType(h.default.t(18))}));return function(){return t.apply(this,arguments)}}()).catch((0,a.filteredCatch)(o.ServerStatusCodeError,(e=>{if(e.status>=400)return new d.ActionType(h.default.t(17))}))).catch((()=>(__LOG__(3)`models:chat:sendClear dropped`,new d.ActionType(h.default.t(17),{actionText:h.default.t(129),actionHandler:()=>y(e,t)}))));return p.Cmd.openToast((0,m.jsx)(d.ActionToast,{id:(0,d.genId)(),initialAction:T,pendingAction:b})),v.then((r=>{if(!r._duplicate)if((0,s.isMDBackend)()){if(!(0,f.clearOrDeleteChatSyncEnabled)()){E(e,t);const{handleSingleMsgMD:r}=n(5819),i=(0,l.default)(e.id,e.contact.privacyMode);return r(i.from,i)}r.result&&S(e,r.result)}else E(e,t)})).catch((0,a.filteredCatch)(o.ServerStatusCodeError,(()=>{}))).finally((()=>{r.sendClear=null}))}function E(e,t){if(e){const n=e.getLastMsgKeyForAction(),r=n?e.msgs.get(n):void 0;e.deleteMsgsBeforeMsgInclusive(r,t)}}function S(e,t){e&&t&&e.deleteMessages(t)}},75887:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addAndSendMsgToChat=function(e,t,r){return function(e,t){let r,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;const p=Promise.resolve(t).then((t=>{const i=n(59871).MsgCollection,p=(0,a.default)({},t),g=(0,u.getContactPrivacyMode)(e.id);null!=g&&(p.privacyModeWhenSent=g);const m=i.add(p)[0];if(m){var y;(0,o.isMDBackend)()&&(m.wamMessageSendPerfReporter=new _.MessageSendPerfReporter(m.to,m.getWamMediaType(),m.getWamMessageType())),r=(0,l.default)(m,e);const t=r?[r,p]:[p];return null===(y=m.wamMessageSendPerfReporter)||void 0===y||y.startSavedStage(),(0,h.storeMessages)(t,e.id).then((()=>{var e;if(null===(e=m.wamMessageSendPerfReporter)||void 0===e||e.postSavedStage(),m.type===d.MSG_TYPE.GROUPS_V4_INVITE)return(0,f.persistGroupInviteV4Msg)(m.id.toString(),{id:m.id.toString(),from:m.from.toString(),to:m.to.toString(),groupId:m.inviteGrp,expiration:parseInt(m.inviteCodeExp,10),expired:s.Clock.globalUnixTime()>=parseInt(m.inviteCodeExp,10)})})).then((()=>m.waitForPrep().then((()=>m))))}throw new c.ModelCreateError("Msg",p)})),g=e.addQueue.enqueue(p).then((t=>{var n;return null===(n=t.wamMessageSendPerfReporter)||void 0===n||n.startRenderedStage(),r&&e.msgs.add(r),e.msgs.add(t)[0]})).then((e=>{var t;return null===(t=e.wamMessageSendPerfReporter)||void 0===t||t.postRenderedStage(),e})),m=i?g.then(i).then((()=>g)):g,y=S(e,m);return[g,y]}((0,y.unproxy)(e),t,r)},t.resendMsgToChat=function(e,t){return S((0,y.unproxy)(e),t)};var i=r(n(48926)),a=r(n(81109)),o=n(88555),s=n(40234),l=r(n(26947)),c=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=E(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(35232)),d=n(15461),u=n(8197),p=n(1973),f=n(62415),h=n(84886),_=n(30097),g=n(29731),m=n(19708),y=(n(13705),n(31019));function E(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(E=function(e){return e?n:t})(e)}function S(){return v.apply(this,arguments)}function v(){return(v=(0,i.default)((function*(e,t){if((0,o.isMDBackend)()&&e.isGroup){const t=n(63928).default;yield t.find(e.id)}return new g.NonPersistJob("sendMessage",(0,i.default)((function*(){const n=yield e.sendQueue.enqueue(t);return(0,m.sendMsgRecord)(n)})),{priority:p.JOB_PRIORITY.UI_ACTION}).waitUntilCompleted()}))).apply(this,arguments)}},19569:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendNotSpam=function(e,t){return E((0,h.unproxy)(e),t)},t.sendSpamBlockClear=function(e,t){return function(e,t){const{promises:n,isGroup:r,contact:i}=e;if(n.reportSpamBlockClear)return n.reportSpamBlockClear;if(r)return Promise.reject(new c.ActionError);const a=y(e,t);return n.reportSpamBlockClear=a.then((()=>(0,s.blockContact)(i))).then((()=>(0,p.sendClear)(e,!1))).catch((()=>{})).finally((()=>{n.reportSpamBlockClear=null})),n.reportSpamBlockClear}((0,h.unproxy)(e),t)},t.sendSpamExitClear=function(e,t){return function(e,t){const{promises:n,isGroup:r,isReadOnly:i,msgs:a}=e;if(n.reportSpamExitClear)return n.reportSpamExitClear;if(!r)return Promise.reject(new c.ActionError);let o;const s=y(e,t);if(i)o=s;else{const t=(0,d.sendExitGroup)(e),n=(0,_.default)(a,"change:last",(e=>e.isGroupLeave()));o=Promise.all([s,t,n])}return n.reportSpamExitClear=o.then((()=>(0,p.sendClear)(e,!1))).catch((()=>{})).finally((()=>{n.reportSpamExitClear=null})),n.reportSpamExitClear}((0,h.unproxy)(e),t)},t.sendSpamReport=function(e,t){return y((0,h.unproxy)(e),t)};var i=n(50796),a=n(92574),o=n(46331),s=n(80140),l=n(88102),c=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=m(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(35232)),d=n(5501),u=r(n(14296)),p=n(83802),f=n(26707),h=(n(38839),n(31019)),_=r(n(35609)),g=n(85893);function m(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(m=function(e){return e?n:t})(e)}function y(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(0,o.genId)();const{promises:r}=e;if(r.sendSpamReport)return r.sendSpamReport;const s=r.sendSpamReport=(0,f.sendSpamReport)(e,t),c=new o.ActionType(u.default.t(122)),d=s.then((()=>new o.ActionType(u.default.t(124)))).catch((0,i.filteredCatch)(a.ServerStatusCodeError,(()=>new o.ActionType(u.default.t(123))))).catch((()=>(__LOG__(3)`models:chat:sendSpamReport dropped`,new o.ActionType(u.default.t(123),{actionText:u.default.t(129),actionHandler:()=>y(e,t,n)}))));return l.Cmd.openToast((0,g.jsx)(o.ActionToast,{id:n,initialAction:c,pendingAction:d})),s.finally((()=>{r.sendSpamReport=null}))}function E(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(0,o.genId)();const{promises:r,notSpam:s}=e;if(s)return Promise.resolve();if(r.sendNotSpam)return r.sendNotSpam;const c=r.sendNotSpam=(0,f.sendNotSpam)(e);if(t){const r=new o.ActionType(u.default.t(76)),s=c.then((()=>new o.ActionType(u.default.t(78)))).catch((0,i.filteredCatch)(a.ServerStatusCodeError,(()=>new o.ActionType(u.default.t(77))))).catch((()=>(__LOG__(3)`models:chat:sendNotSpam dropped`,new o.ActionType(u.default.t(77),{actionText:u.default.t(129),actionHandler:()=>E(e,t,n)}))));l.Cmd.openToast((0,g.jsx)(o.ActionToast,{id:n,initialAction:r,pendingAction:s}))}return c.then((()=>{e.set({notSpam:!0})})).finally((()=>{e.isTrusted(),r.sendNotSpam=null}))}},41088:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendTcToken=function(){return u.apply(this,arguments)},t.sendTcTokenWhenDeviceIdentityChange=function(){return p.apply(this,arguments)};var i=r(n(48926)),a=n(92844),o=n(40234),s=n(64603),l=n(69951),c=n(76214),d=n(80079);function u(){return(u=(0,i.default)((function*(e){if(!e.isUserNotPSA())return;const t=l.ChatCollection.get(e);if(null!=t&&(0,s.shouldSendNewToken)(t.tcTokenSenderTimestamp))try{const n=(0,a.castToUnixTime)(o.Clock.globalUnixTime());yield(0,d.setPrivacyTokens)(e,[d.TokenType.TrustedContact],n);const r={tcTokenSenderTimestamp:n};t.set(r),yield(0,c.getChatTable)().merge(e.toString(),r)}catch(e){__LOG__(3,!0,void 0,!0)`sendTcToken failed - ${e}`,SEND_LOGS("send-tc-token-failed")}}))).apply(this,arguments)}function p(){return(p=(0,i.default)((function*(e){const t=l.ChatCollection.get(e);if(null==t)return;const n=t.tcTokenSenderTimestamp;if(null!=n&&!(0,s.isTokenExpired)(n,s.TcTokenMode.Sender))try{yield(0,d.setPrivacyTokens)(e,[d.TokenType.TrustedContact],(0,a.castToUnixTime)(n))}catch(e){__LOG__(3,!0,void 0,!0)`sendTcTokenWhenDeviceIdentityChange failed - ${e}`,SEND_LOGS("send-tc-token-device-identity-change-failed")}}))).apply(this,arguments)}},3553:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.unstarAllMessages=function(e,t){return h(e,t?(0,p.unproxy)(t):t)};var i=n(50796),a=n(92574),o=n(46331),s=n(88102),l=r(n(14296)),c=n(69694),d=r(n(11810)),u=n(19011),p=n(31019),f=n(85893);function h(e,t){const r=n(69951).ChatCollection,p=t?t.promises:r.promises,_=t?t.id:void 0;if(p.sendUnstarAll)return p.sendUnstarAll;const g=p.sendUnstarAll=(0,c.sendUnstarAll)(e,_),m=new o.ActionType(l.default.t(93)),y=g.then((()=>new o.ActionType(l.default.t(91)))).catch((0,i.filteredCatch)(a.ServerStatusCodeError,(e=>{if(e.statusCode>=400)return new o.ActionType(l.default.t(87))}))).catch((()=>(__LOG__(3)`models:chat:sendUnstarAll dropped`,new o.ActionType(l.default.t(87),{actionText:l.default.t(129),actionHandler:()=>h(e,t)}))));return s.Cmd.openToast((0,f.jsx)(o.ActionToast,{id:(0,o.genId)(),initialAction:m,pendingAction:y})),g.then((()=>{e.forEach((e=>{e.set("star",!1)})),t?(0,u.removeStarredMsgs)(e):(u.AllStarredMsgsCollection.reset(),d.default.reset(),r.forEach((e=>{e.starredMsgs&&e.starredMsgs.reset()})))})).finally((()=>{p.sendUnstarAll=null}))}},59201:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.setTcToken=function(){return c.apply(this,arguments)};var i=r(n(48926)),a=n(95024),o=n(91829),s=n(9025),l=n(76214);function c(){return(c=(0,i.default)((function*(e,t,n){if(null==n)return;if(!e.isUserNotPSA())return;let r=yield(0,s.getExisting)(e);if(null==r)return void(r=yield(0,o.create)(e,{tcToken:n,tcTokenTimestamp:t,pendingInitialLoading:!1,createdLocally:!0}));if(null!=r.tcToken&&(0,a.arrayBuffersDeepEqual)(r.tcToken,n)||null!=r.tcTokenTimestamp&&r.tcTokenTimestamp>t)return;const i={tcToken:n,tcTokenTimestamp:t};r.set(i),yield(0,l.getChatTable)().merge(e.toString(),i)}))).apply(this,arguments)}},9609:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.clearUnreadMentions=function(e){var t;(0,h.isGroupCatchUpEnabled)()&&e.isGroup&&(null===(t=e.groupMetadata)||void 0===t||t.unreadMentionMetadata.reset())},t.markSeen=v,t.markUnread=function(e,t){return b((0,g.unproxy)(e),t)},t.markUnseen=T,t.sendSeen=S,t.updateUnreadCountMD=O;var i=r(n(48926)),a=n(50796),o=n(92574),s=n(88555),l=r(n(64369)),c=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=E(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(35232)),d=n(46331),u=n(48285),p=n(88102),f=r(n(14296)),h=n(41566),_=n(97848),g=n(31019),m=n(8080),y=n(85893);function E(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(E=function(e){return e?n:t})(e)}function S(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return C((0,g.unproxy)(e),t).catch((0,a.filteredCatch)(o.ServerStatusCodeError,(e=>{__LOG__(3)`sendSeen: got status ${e.status}`})))}function v(e,t,n){return function(){return M.apply(this,arguments)}((0,g.unproxy)(e),t,n)}function T(e){!function(e){0!==e.unreadCount&&e.unreadCount!==l.default.MARKED_AS_UNREAD||(e.active&&(e.markedUnread=!0),(0,_.markConversationUnseen)(e.id).then((()=>{e.unreadCount=l.default.MARKED_AS_UNREAD})))}((0,g.unproxy)(e))}function b(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(0,d.genId)();t?e.active&&(e.markedUnread=!0):e.markedUnread=!1;const{promises:r}=e;if(r.markUnread)return r.markUnread;const i=r.markUnread=t?A(e):C(e),s=t?new d.ActionType(f.default.t(28)):new d.ActionType(f.default.t(27)),l=i.then((()=>{const r=t?f.default.t(26):f.default.t(25);return new d.ActionType(r,{actionText:f.default.t(133),actionHandler:()=>b(e,!t,n)})})).catch((0,a.filteredCatch)(o.ServerStatusCodeError,(e=>{if(e.status>=400)return t?new d.ActionType(f.default.t(24)):new d.ActionType(f.default.t(23));throw new Error("invalid response status")}))).catch((()=>{const r=t?f.default.t(24):f.default.t(23);return new d.ActionType(r,{actionText:f.default.t(129),actionHandler:()=>b(e,t,n)})}));return p.Cmd.openToast((0,y.jsx)(d.ActionToast,{id:n,initialAction:s,pendingAction:l})),i.then((()=>{})).catch((0,a.filteredCatch)(o.ServerStatusCodeError,(e=>{__LOG__(3)`markUnread: got status ${e.status}`}))).finally((()=>{r.markUnread=null}))}function C(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e.markedUnread||0===e.unreadCount)return String(e.markedUnread),e.unreadCount,Promise.resolve();if(!m.Stream.available&&t)return e.listenToOnce(m.Stream,"change:available",(()=>S(e))),Promise.resolve();e.unreadCount,e.pendingSeenCount;const n=e.unreadCount-e.pendingSeenCount,r=-1===e.unreadCount&&-1===n;if(n<=0&&!r)return Promise.resolve();e.disableUnreadAnchor=!0,e.pendingSeenCount=e.unreadCount,e.pendingSeenCount;const i=()=>{e.pendingSeenCount=e.pendingSeenCount-n,e.pendingSeenCount,e.pendingSeenCount<0&&(__LOG__(3)`models:chat:sendSeen unread ${e.unreadCount} pending: ${e.pendingSeenCount} delta: ${n}`,e.pendingSeenCount=0)},l=e.getLastMsgKeyForAction();return(0,_.sendConversationSeen)(e,l,n).then((t=>{(0,s.isMDBackend)()?O(e,n):t._duplicate?i():v(e,n,!0)})).catch((0,a.filteredCatch)(o.ServerStatusCodeError,(e=>(i(),Promise.reject(e))))).catch((0,a.filteredCatch)([o.WebdDrop,c.ProtoVersionUndefined],(()=>{i(),__LOG__(3)`models:chat:sendConversationSeen dropped`})))}function A(){return P.apply(this,arguments)}function P(){return(P=(0,i.default)((function*(e){const t=e.getLastMsgKeyForAction();try{yield(0,_.sendConversationUnseen)(e.id,t),T(e)}catch(t){return(0,a.filteredCatch)(o.ServerStatusCodeError,(t=>(e.markedUnread=!1,Promise.reject(t))))(t)}}))).apply(this,arguments)}function M(){return(M=(0,i.default)((function*(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];String(t);let r=null;null!=t?t>0&&t<=e.unreadCount?(r=e.unreadCount-t,String(r)):-1===t&&e.unreadCount<=0&&(r=0,String(r)):(r=0,String(r));const i=null==r?Promise.resolve():(0,_.markConversationSeen)(e.id,r);if(yield i,null!=t&&n){const n=e.pendingSeenCount-t;e.pendingSeenCount=Math.max(0,n)}null!=r&&(e.unreadCount=r),e.unreadMsgAnchor=void 0,e.markedUnread=!1}))).apply(this,arguments)}function O(){return I.apply(this,arguments)}function I(){return(I=(0,i.default)((function*(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const{unreadCount:r}=yield(0,u.getChatMeta)(e.id);if(e.unreadCount,e.unreadCount=r,e.unreadMsgAnchor=void 0,e.markedUnread=!1,n){const n=e.pendingSeenCount-t;e.pendingSeenCount=Math.max(0,n)}}))).apply(this,arguments)}},67087:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.upgradeToCommunity=function(){return c.apply(this,arguments)};var i=r(n(48926)),a=n(40234),o=n(57849),s=n(58052),l=n(74028);function c(){return(c=(0,i.default)((function*(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t=(0,o.getABPropConfigValue)("parent_group_query_ts");if(!e&&-1===t)return yield d(),void __LOG__(2)`upgradeToCommunity: parentGroupQueryTs (${t}), force-fetched groups and set isCommunityDiscovered to true`;const n=(0,s.getIsCommunityDiscovered)();if(n)return;if(e)return(0,s.setIsCommunityDiscovered)(!0),void __LOG__(2)`upgradeToCommunity: isInitialBootstrap is true, set isCommunityDiscovered to true`;const r=a.Clock.globalUnixTime();if(0===t||r<t)(0,s.setIsCommunityDiscovered)(!0),__LOG__(2)`upgradeToCommunity: currentTs (${r}), parentGroupQueryTs (${t}), set isCommunityDiscovered to true`;else try{yield d(),__LOG__(2)`upgradeToCommunity: currentTs (${r}), parentGroupQueryTs (${t}), fetched groups and set isCommunityDiscovered to true`}catch(e){__LOG__(2)`upgradeToCommunity: currentTs (${r}), parentGroupQueryTs (${t}), fetched groups and failed, kept isCommunityDiscovered at false`}}))).apply(this,arguments)}function d(){return u.apply(this,arguments)}function u(){return(u=(0,i.default)((function*(){yield(0,l.queryAndUpdateAllGroupMetadata)(),(0,s.setIsCommunityDiscovered)(!0)}))).apply(this,arguments)}},97270:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addJoinedSubgroup=function(e,t){e.joinedSubgroups=[...e.joinedSubgroups,t],e.unjoinedSubgroups=e.unjoinedSubgroups.filter((e=>e!==t)),(0,r.removeUnjoinedSubgroupMetadataFromStorage)(t),i=t,n(73213).default.remove(i.toString());var i},t.removeJoinedSubgroup=function(e,t){e.joinedSubgroups=e.joinedSubgroups.filter((e=>e!==t)),e.unjoinedSubgroups=[...e.unjoinedSubgroups,t];const i=n(69951).ChatCollection.get(t.toString()),a=null==i?void 0:i.groupMetadata;if(null==i||null==a)return;(0,r.addUnjoinedSubgroupMetadataToStorage)(t,i.formattedTitle),o=t,s=i.formattedTitle,l=e.id,n(73213).default.add({id:o,subject:s,parentGroupId:l},{merge:!0});var o,s,l},t.updateJoinedSubgroups=function(e){const t=n(63928).default.filter((t=>{var n;return(null===(n=t.parentGroup)||void 0===n?void 0:n.equals(e.id))&&t.participants.iAmMember()})).map((e=>e.id));e.joinedSubgroups=t};var r=n(95716)},53006:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setPushnameLocally=function(e){r.Conn.pushname=e,(0,i.setPushname)(e)};var r=n(17239),i=n(99234)},67146:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addMeToContacts=function(){return c.apply(this,arguments)};var i=r(n(48926)),a=n(72441),o=n(4233),s=n(99234),l=n(46582);function c(){return(c=(0,i.default)((function*(){const e=yield(0,l.requireContactCollection)(),t=(0,s.getMaybeMeUser)(),n=(0,a.toPhoneUserJid)(t.user);yield(0,o.getTable)().createOrMerge(n,{id:n}),e.gadd(t)}))).apply(this,arguments)}},66308:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.bulkGenerateDeviceNotifications=function(){return _.apply(this,arguments)},t.createAndStoreDeviceNotifications=function(){return h.apply(this,arguments)},t.generateDeviceNotifications=p;var i=r(n(48926)),a=n(52230),o=n(10635),s=n(45454),l=n(57849),c=n(99234),d=n(76214),u=n(90641);function p(){return f.apply(this,arguments)}function f(){return(f=(0,i.default)((function*(e,t,n){const r={notifications:[],chatIds:[]};if(!(0,c.getGlobalSecurityNotifications)())return r;if((0,l.getABPropConfigValue)("adv_v2_m6"))return r;if(!(t.length>0||n.length>0))return r;let i=[];if(e.equals((0,c.getMeUser)()))try{(yield(0,d.getChatTable)().all()).forEach((e=>{e.id!==a.STATUS_JID&&i.push((0,s.createWid)(e.id))}))}catch(e){throw __LOG__(4,!0,new Error,!0)`get all from chat table failed`,SEND_LOGS("get all from chat table failed when creating device notification"),new Error("get all from chat table failed")}else try{const t=yield(0,d.getChatTable)().get(String(e)),n=yield(0,d.getParticipantTable)().equals(["participants"],String(e));i=n.map((e=>(0,s.createWid)(e.groupId))),t&&i.push((0,s.createWid)(t.id))}catch(e){throw __LOG__(4,!0,new Error,!0)`get chats failed`,SEND_LOGS("get chats failed when creating device notification"),new Error("get chays failed")}const u=i.map((r=>(0,o.genDeviceNotificationMsg)(r,e,t,n)));return r.notifications=u,r.chatIds=i.map(String),r}))).apply(this,arguments)}function h(){return(h=(0,i.default)((function*(e,t,n){const{notifications:r}=yield p(e,t,n);yield Promise.all(r.map((e=>(0,u.storeMessageInTransaction)([e]))))}))).apply(this,arguments)}function _(){return(_=(0,i.default)((function*(e){let t=[];const n=new Set;if((0,c.getGlobalSecurityNotifications)()){(yield Promise.all(e.map((e=>{let{wid:t,added:n,removed:r,isNewRecord:i}=e;return i?Promise.resolve(null):p(t,n,r)})))).forEach((e=>{e&&(t=t.concat(e.notifications),e.chatIds.forEach((e=>n.add(e))))}))}return t.length>0?{notifications:t,chatIds:Array.from(n)}:{notifications:[],chatIds:[]}}))).apply(this,arguments)}},54181:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleADVDeviceNotification=function(e){let{wid:t,devices:n,type:r}=e;if((0,a.isLegacyWebdBackend)())return Promise.reject(new Error("This call is only supported in MD mode"));if(null==r)return Promise.reject(new Error("handleADVDeviceNotification: notification without type"));return function(){return _.apply(this,arguments)}(t,n,r)},t.handleADVDeviceSyncResult=function(e){if((0,a.isLegacyWebdBackend)())return Promise.reject(new Error("This call is only supported in MD mode"));return function(){return g.apply(this,arguments)}(e)},t.handleADVDeviceUpdateForMessage=function(){return h.apply(this,arguments)};var i=r(n(48926)),a=n(88555),o=n(57849),s=n(68268),l=n(53614),c=n(9108),d=n(54678),u=r(n(76128)),p=n(17041),f=n(93832);function h(){return(h=(0,i.default)((function*(e,t,n,r,i){let l,c=arguments.length>5&&void 0!==arguments[5]&&arguments[5];return(0,a.isLegacyWebdBackend)()?Promise.reject(new Error("This call is only supported in MD mode")):((0,o.getABPropConfigValue)("adv_v2_m4_m5")&&(l=yield(0,s.getLastADVDeviceInfoCheckTime)()),(0,d.handleADVDeviceUpdateForMessage)(e,t,n,r,i,c,l))}))).apply(this,arguments)}function _(){return(_=(0,i.default)((function*(e,t,r){let i=null;if("add"===r){const t=yield u.default.loadIdentityKey((0,f.createSignalAddress)(e).toString());i=t?(0,l.toCurveKeyPubKey)((0,f.strToBuffer)(t)):null}const a=yield(0,c.getDeviceRecord)(e.user);let d;(0,o.getABPropConfigValue)("adv_v2_m4_m5")&&(d=yield(0,s.getLastADVDeviceInfoCheckTime)());const h=(0,n(81864).handleDeviceNotification)(e,r,t,i,a,d);if(h)return h.clearRecord&&(yield(0,p.clearDeviceRecord)(e,(null==a?void 0:a.devices)||[])),(0,p.bulkApplyDeviceUpdate)([{wid:e,update:h.update,currentRecord:a}])}))).apply(this,arguments)}function g(){return(g=(0,i.default)((function*(e){__LOG__(2)`_handleADVDeviceSyncResult: start to handling ${e.length} updates`;const t=e.map((e=>e.wid)),r=e.filter((e=>{var t;return null===(t=e.devices.keyIndex)||void 0===t?void 0:t.signedKeyIndexBytes})),i=yield u.default.bulkLoadIdentityKey(r.map((e=>(0,f.createSignalAddress)(e.wid).toString()))),a=new Map;r.forEach(((e,t)=>{a.set(e.wid.user,i[t])}));const o=yield(0,c.bulkGetDeviceRecord)(t.map((e=>e.user))),s=[],d=[],h=n(81864).handleADVSyncResult;e.forEach(((e,t)=>{const n=a.get(e.wid.user),r=n?(0,l.toCurveKeyPubKey)((0,f.strToBuffer)(n)):null,i=o[t],c=h(e.wid,e.devices,r,i);null!=c&&(c.clearRecord?(s.push({wid:e.wid,currentList:(null==i?void 0:i.devices)||[]}),d.push({wid:e.wid,currentRecord:{id:e.wid.user,deleted:!0},update:c.update})):d.push({wid:e.wid,currentRecord:i,update:c.update}))})),yield Promise.all(s.map((e=>{let{wid:t,currentList:n}=e;return(0,p.clearDeviceRecord)(t,n)}))),yield(0,p.bulkApplyDeviceUpdate)(d)}))).apply(this,arguments)}},17041:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.bulkApplyDeviceUpdate=function(){return y.apply(this,arguments)},t.clearDeviceRecord=function(){return m.apply(this,arguments)};var i=r(n(48926)),a=r(n(91966)),o=n(52230),s=n(45454),l=n(66308),c=n(9108),d=n(99234),u=n(41796),p=n(14748),f=r(n(29783)),h=n(90641),_=n(93932),g=n(58928);function m(){return(m=(0,i.default)((function*(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];yield Promise.all(t.filter((e=>e.id!==o.DEFAULT_DEVICE_ID)).map((t=>v((0,s.createDeviceWidFromUserAndDevice)(e.user,t.id)))));const r=[],a=t.map((e=>e.id)).filter((e=>e!==o.DEFAULT_DEVICE_ID)),{encryptedNotifications:l,chatIds:d}=yield E([{wid:e,added:r,removed:a,isNewRecord:!1}],n);yield(0,p.getDeviceUpdateLock)((0,i.default)((function*(){const t=l.length>0?(0,h.storeEncryptedMessage)(l,d,!1):Promise.resolve(),n=(0,g.updateGroupParticipantsInTransaction)(e,r,a),i=(0,c.createOrReplaceDeviceRecord)({id:e.user,deleted:!0}).catch((()=>{throw __LOG__(4,!0,new Error,!0)`remove from device list table failed`,SEND_LOGS("remove from device list table failed when clearing device record"),new Error("remove from device list table failed")}));yield Promise.all([t,n,i])})),l.length>0)}))).apply(this,arguments)}function y(){return(y=(0,i.default)((function*(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=[],r=[];let l=!1;e.forEach((e=>{let{wid:t,update:i,currentRecord:c}=e;const{devices:u}=i,p=u.map((e=>e.id)),f=c&&!c.deleted?c.devices.map((e=>e.id)):[],h=(0,a.default)(p,f).filter((e=>e!==o.DEFAULT_DEVICE_ID)),_=(0,a.default)(f,p).filter((e=>e!==o.DEFAULT_DEVICE_ID));n.push({wid:t,added:h,removed:_,isNewRecord:null==c}),_.forEach((e=>{r.push((0,s.createDeviceWidFromUserAndDevice)(t.user,e))})),t.user===(0,d.getMeUser)().user&&_.length>0&&(l=!0)}));const{encryptedNotifications:u,chatIds:f}=yield E(n,t);Promise.all(r.map((e=>v(e)))),yield(0,p.getDeviceUpdateLock)((0,i.default)((function*(){const t=u.length>0?(0,h.storeEncryptedMessage)(u,f,!1):Promise.resolve(),r=(0,g.bulkUpdateGroupParticipantsInTransaction)(n),i=(0,c.bulkCreateOrReplaceDeviceRecord)(e.map((e=>e.update))).catch((()=>{throw __LOG__(4,!0,new Error,!0)`bulkCreateOrReplace into device list table failed`,SEND_LOGS("bulkCreateOrReplace into device list table failed when applying device update"),new Error("bulkCreateOrReplace into device list table failed")})),a=l?i.then((()=>(0,_.updateMissingKeyDevices)().catch((e=>{__LOG__(3)`syncd: updateMissingKeyDevices failed with error:
${e}`})))):Promise.resolve();yield Promise.all([t,r,i,a])})),u.length>0,l)}))).apply(this,arguments)}function E(){return S.apply(this,arguments)}function S(){return(S=(0,i.default)((function*(e,t){const{notifications:n,chatIds:r}=yield(0,l.bulkGenerateDeviceNotifications)(e);if(!t){const e=yield(0,h.encryptMultipleMsgs)(n);return b(n),{chatIds:r,encryptedNotifications:e}}return f.default.addOfflineMessage(n.map((e=>({msg:e})))),{chatIds:[],encryptedNotifications:[]}}))).apply(this,arguments)}function v(){return T.apply(this,arguments)}function T(){return(T=(0,i.default)((function*(e){const{deleteDeviceSenderKey:t,deleteRemoteInfo:r}=n(54084);try{yield Promise.all([r(e),t(e)])}catch(t){__LOG__(2)`handleDevicesNotification: failed to clean the signal info for ${e.user}`}}))).apply(this,arguments)}function b(e){return Promise.all(e.map((e=>{e.recvFresh=!0,e.isNewMsg=!0;return(0,u.getBridge)().sendAndReceive("msg_collection","processMultipleMessages",{chatId:e.from,msgObjs:[e],meta:{add:"after",isHistory:!1}})})))}},58928:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.bulkUpdateGroupParticipantsInTransaction=function(){return f.apply(this,arguments)},t.updateGroupParticipantsInTransaction=function(){return p.apply(this,arguments)};var i=r(n(81109)),a=r(n(48926)),o=n(52230),s=n(45454),l=n(57701),c=r(n(11339)),d=n(76214),u=n(99039);function p(){return(p=(0,a.default)((function*(e,t,n){const r=(yield(0,d.getParticipantTable)().equals(["participants"],String(e))).map((r=>{let a=r.rotateKey;const o=new Map(r.senderKey);return(0,l.rotateSenderKeyIfSentEnabled)()?(n.forEach((t=>{var n;const r=String((0,s.createDeviceWidFromUserAndDevice)(e.user,t));a=a||null!==(n=o.get(r))&&void 0!==n&&n,o.delete(r)})),a&&o.forEach(((e,t)=>o.set(t,!1)))):(n.forEach((t=>{o.delete(String((0,s.createDeviceWidFromUserAndDevice)(e.user,t)))})),n.length>0&&(a=!0)),t.forEach((t=>{o.set(String((0,s.createDeviceWidFromUserAndDevice)(e.user,t)),!1)})),h(a,r,t,n),(0,i.default)((0,i.default)({},r),{},{senderKey:o,rotateKey:a})}));return(0,d.getParticipantTable)().bulkCreateOrReplace(r)}))).apply(this,arguments)}function f(){return(f=(0,a.default)((function*(e){if(0===e.length)return;const t=yield(0,d.getParticipantTable)().anyOf(["participants"],e.map((e=>String(e.wid))));if(0===t.length)return;const n=new Map;e.forEach((e=>{n.set(String(e.wid),e)}));const r=t.map((e=>{let t=e.rotateKey;const r=new Map(e.senderKey);return e.participants.forEach((i=>{const a=n.get(i);if(!a)return;const{added:o,removed:c}=a;(0,l.rotateSenderKeyIfSentEnabled)()?(c.forEach((e=>{var n;const i=String((0,s.createDeviceWidFromUserAndDevice)(a.wid.user,e));t=t||null!==(n=r.get(i))&&void 0!==n&&n,r.delete(i)})),t&&r.forEach(((e,t)=>r.set(t,!1)))):(c.forEach((e=>{r.delete(String((0,s.createDeviceWidFromUserAndDevice)(a.wid.user,e)))})),c.length>0&&(t=!0)),o.forEach((e=>{r.set(String((0,s.createDeviceWidFromUserAndDevice)(a.wid.user,e)),!1)})),h(t,e,o,c)})),(0,i.default)((0,i.default)({},e),{},{senderKey:r,rotateKey:t})}));return(0,d.getParticipantTable)().bulkCreateOrReplace(r)}))).apply(this,arguments)}function h(e,t,n,r){e&&!t.rotateKey&&(0,u.postSenderKeyExpiredMetric)({chatId:t.groupId,deviceCount:t.senderKey.size,expiryReason:r.includes(o.DEFAULT_DEVICE_ID)&&n.includes(o.DEFAULT_DEVICE_ID)?c.default.EXPIRY_REASON.IDENTITY_CHANGE:c.default.EXPIRY_REASON.DEVICE_UNPAIR})}},89333:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.computeExpectedTsForDeviceRecord=function(e,t,n){const r=null==t?void 0:t.timestamp;if(null==r)return{expectedTs:void 0,expectedTsLastDeviceJobTs:void 0,expectedTsUpdateTs:void 0};let i,o,s;null==t||t.deleted||(i=t.expectedTs,o=t.expectedTsLastDeviceJobTs,s=t.expectedTsUpdateTs);return a(e,r,n,i,o,s)},t.computeNewExpectedTs=a,t.shouldClearExpectedTs=function(e,t,n,r){if(!(0,i.getABPropConfigValue)("adv_v2_m4_m5"))return!1;if(null==n||n.deleted)return!1;if(null==n.expectedTs)return!1;if(e>=n.expectedTs)return!0;if(e<n.expectedTs&&t===n.expectedTs&&null!=r&&(null==n.expectedTsLastDeviceJobTs||r>n.expectedTsLastDeviceJobTs))return!0;return!1};var r=n(40234),i=n(57849);function a(e,t,n,a,o,s){if(!(0,i.getABPropConfigValue)("adv_v2_m4_m5"))return{expectedTs:void 0,expectedTsLastDeviceJobTs:void 0,expectedTsUpdateTs:void 0};const l={expectedTs:a,expectedTsLastDeviceJobTs:o,expectedTsUpdateTs:s};return t>=e||null!=a&&a>=e||(l.expectedTs=e,l.expectedTsLastDeviceJobTs=n,(null==a||t>=a)&&(l.expectedTsUpdateTs=r.Clock.localUnixTime())),l}},65414:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleICDCData=function(e,t,n){if((0,d.isLegacyWebdBackend)())return Promise.reject(new Error("handleICDCData: not supported for non md"));if(null==n||!(0,u.getABPropConfigValue)("adv_v2_m4_m5"))return Promise.resolve();return m.enqueue((()=>function(){return y.apply(this,arguments)}(e,t,n)))};var i=r(n(81109)),a=r(n(48926)),o=n(52230),s=n(8243),l=n(27870),c=n(92844),d=n(88555),u=n(57849),p=n(68268),f=n(9108),h=n(89333),_=n(99234),g=n(81864);const m=new l.PromiseQueue;function y(){return(y=(0,a.default)((function*(e,t,n){const{deviceListMetadata:r}=n;if(null==r)return void __LOG__(2,void 0,void 0,void 0,["handleICDCData"])`get empty device list metadata`;if((null==e.device||e.device===o.DEFAULT_DEVICE_ID)&&null!=r.senderTimestamp&&null==r.senderKeyHash){const t=(0,s.numberOrThrowIfTooLarge)(r.senderTimestamp)+1;return void(0,g.handleADVSyncResult)(e,{deviceList:[{id:o.DEFAULT_DEVICE_ID,keyIndex:0}],keyIndex:{ts:(0,c.castToUnixTime)(t),signedKeyIndexBytes:null}},null,null)}const a=[],l=e.user===(0,_.getMeUser)().user;a.push({id:e.user,ts:r.senderTimestamp}),l&&null!=t&&a.push({id:t.user,ts:r.recipientTimestamp});const d=yield(0,p.getLastADVDeviceInfoCheckTime)(),u=yield(0,f.bulkGetDeviceRecord)(a.map((e=>e.id))),m=[];return u.forEach(((e,t)=>{const n=a[t].ts;if(null==e||e.deleted||null==n)return;const r=(0,h.computeExpectedTsForDeviceRecord)((0,s.numberOrThrowIfTooLarge)(n),e,d);r.expectedTs===e.expectedTs&&r.expectedTsLastDeviceJobTs===e.expectedTsLastDeviceJobTs&&e.expectedTsUpdateTs==e.expectedTsUpdateTs||(__LOG__(2)`handleICDCData: update expectd timestamp for ${e.id}`,m.push((0,i.default)((0,i.default)({},e),r)))})),m.length>0?(0,f.bulkCreateOrReplaceDeviceRecord)(m):void 0}))).apply(this,arguments)}},84135:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleListReset=function(){return g.apply(this,arguments)};var i=r(n(48926)),a=n(52230),o=n(8243),s=n(92844),l=n(45454),c=r(n(41143)),d=n(57849),u=n(53614),p=n(89333),f=n(52083),h=n(17041),_=n(93832);function g(){return(g=(0,i.default)((function*(e,t,n,r,i){let g=arguments.length>5&&void 0!==arguments[5]&&arguments[5],m=arguments.length>6?arguments[6]:void 0;const{rawId:y,timestamp:E,keyIndex:S}=t,v=(0,o.numberOrThrowIfTooLarge)(E),T=(0,d.getABPropConfigValue)("adv_v2_m4_m5"),b=e.device;(0,c.default)(null!=b&&b!==a.DEFAULT_DEVICE_ID,"handleADVDeviceIdentity: called for primary device");const C=(0,l.toUserWid)(e);let A=0;if(T&&(A=(null==i?void 0:i.timestamp)||(0,s.pastUnixTime)(((0,d.getABPropConfigValue)("num_days_key_index_list_expiration")-1)*s.DAY_SECONDS)),null!=i&&!i.deleted){if(i.timestamp>v)throw new Error("handleADVDeviceIdentity: out-of-order timestamp detected");yield(0,h.clearDeviceRecord)(C,i.devices,g)}n&&(yield(0,f.getSignalProtocolStore)().saveIdentity((0,_.createSignalAddress)(C).toString(),(0,u.toSignalCurvePubKey)(n)));const P={id:e.user,rawId:y,timestamp:A,devices:[{id:b,keyIndex:S},{id:a.DEFAULT_DEVICE_ID,keyIndex:0}],validIndexes:null,currentIndex:null,deleted:!1};if(T){const e=(0,p.computeExpectedTsForDeviceRecord)(v,P,m);P.expectedTs=e.expectedTs,P.expectedTsLastDeviceJobTs=e.expectedTsLastDeviceJobTs,P.expectedTsUpdateTs=e.expectedTsUpdateTs}yield(0,h.bulkApplyDeviceUpdate)([{wid:C,update:P,currentRecord:null}],g),yield(0,f.getSignalProtocolStore)().saveIdentity((0,_.createSignalAddress)(e).toString(),(0,u.toSignalCurvePubKey)(r))}))).apply(this,arguments)}},80405:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleNoListReset=function(){return g.apply(this,arguments)};var i=r(n(81109)),a=r(n(48926)),o=n(52230),s=n(8243),l=n(45454),c=r(n(41143)),d=n(57849),u=n(53614),p=n(89333),f=n(52083),h=n(17041),_=n(93832);function g(){return(g=(0,a.default)((function*(e,t,n,r){let a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],g=arguments.length>5?arguments[5]:void 0;const{timestamp:m,keyIndex:y}=t,E=(0,s.numberOrThrowIfTooLarge)(m),S=e.device;if((0,c.default)(null!=S&&S!==o.DEFAULT_DEVICE_ID,"handleADVDeviceIdentity: called for primary device"),r.timestamp>=E&&r.validIndexes&&!r.validIndexes.includes(y))throw new Error("handleADVDeviceIdentity: out-of-order timestamp detected");const v=new Map(r.devices.map((e=>[e.id,e.keyIndex])));if(!v.has(S)||v.get(S)!==y){v.set(S,y);const t=Array.from(v.entries()).map((e=>{let[t,n]=e;return{id:t,keyIndex:n}})),o=(0,i.default)((0,i.default)({},r),{},{devices:t,deleted:!1});if((0,d.getABPropConfigValue)("adv_v2_m4_m5")){const e=(0,p.computeExpectedTsForDeviceRecord)(E,o,g);o.expectedTs=e.expectedTs,o.expectedTsLastDeviceJobTs=e.expectedTsLastDeviceJobTs,o.expectedTsUpdateTs=e.expectedTsUpdateTs}yield(0,h.bulkApplyDeviceUpdate)([{wid:(0,l.toUserWid)(e),update:o,currentRecord:r}],a),yield(0,f.getSignalProtocolStore)().saveIdentity((0,_.createSignalAddress)(e).toString(),(0,u.toSignalCurvePubKey)(n))}}))).apply(this,arguments)}},54678:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleADVDeviceUpdateForMessage=function(){return p.apply(this,arguments)};var i=r(n(48926)),a=n(52230),o=n(45454),s=r(n(41143)),l=n(9108),c=n(84135),d=n(80405),u=n(93832);function p(){return(p=(0,i.default)((function*(e,t,n,r,i){let p=arguments.length>5&&void 0!==arguments[5]&&arguments[5],f=arguments.length>6?arguments[6]:void 0;const{rawId:h,timestamp:_,keyIndex:g}=t;(0,s.default)(null!=h,"handleADVDeviceIdentity: rawId of deviceIdentity should not be null"),(0,s.default)(null!=_,"handleADVDeviceIdentity: timestamp of deviceIdentity should not be null"),(0,s.default)(null!=g,"handleADVDeviceIdentity: keyIndex of deviceIdentity should not be null");const m={rawId:h,timestamp:_,keyIndex:g},y=e.device;(0,s.default)(null!=y&&y!==a.DEFAULT_DEVICE_ID,"handleADVDeviceIdentity: called for primary device");const E=(0,o.toUserWid)(e),S=yield(0,l.getDeviceRecord)(E.user),v=null==n||null!=r&&!(0,u.bufferEqual)(n,r);return!S||S.deleted||S.rawId!==h||v?(0,c.handleListReset)(e,m,v?r:null,i,S,p,f):(0,d.handleNoListReset)(e,m,i,S,p,f)}))).apply(this,arguments)}},79156:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleDeviceAddNotification=function(e,t,n,r,i,d,u){if(!d||d.deleted)return null;if(n<d.timestamp)return null;if(null==i)return null;const p=(0,c.decodeSignedKeyIndexBytes)(i,r);if(!p)return null;const f=p.rawId,h=(0,o.numberOrThrowIfTooLarge)(p.timestamp);if(h!==n)return null;let _=!1,g=null;const m=d.timestamp;d.rawId!==f?_=!0:g=d.devices;const y=new Set(p.validIndexes),E=p.currentIndex||0,S=null==g?[]:g.filter((e=>e.id!==a.DEFAULT_DEVICE_ID&&(y.has(e.keyIndex)||e.keyIndex>E)));t.forEach((e=>{const{id:t,keyIndex:n}=e;t!==a.DEFAULT_DEVICE_ID&&null!=n&&y.has(n)&&S.push({id:t,keyIndex:n})})),S.push({id:a.DEFAULT_DEVICE_ID,keyIndex:0});const v={id:e.user,rawId:f,timestamp:m,validIndexes:Array.from(y),devices:S,currentIndex:p.currentIndex,deleted:!1};if((0,s.getABPropConfigValue)("adv_v2_m4_m5")){const e=(0,l.computeExpectedTsForDeviceRecord)(h,v,u);v.expectedTs=e.expectedTs,v.expectedTsLastDeviceJobTs=e.expectedTsLastDeviceJobTs,v.expectedTsUpdateTs=e.expectedTsUpdateTs}return{update:v,clearRecord:_}},t.handleDeviceRemoveNotification=function(e,t,n){if(null==n||n.deleted)return null;if(t<n.timestamp)return null;const r=new Map(e.map((e=>[e.id,e.keyIndex]))),o=n.devices.filter((e=>{if(e.id!==a.DEFAULT_DEVICE_ID){const t=r.get(e.id);return null==t||t!==e.keyIndex}return!1}));return o.push({id:a.DEFAULT_DEVICE_ID,keyIndex:0}),{update:(0,i.default)((0,i.default)({},n),{},{devices:o}),clearRecord:!1}};var i=r(n(81109)),a=n(52230),o=n(8243),s=n(57849),l=n(89333),c=n(87622)},38906:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.handleKeyIndexResult=function(e,t,n,s,l,c,d,u){if(null!=(null==c?void 0:c.timestamp)&&n<c.timestamp)return null;if(null==l)return null;const p=(0,o.decodeSignedKeyIndexBytes)(l,s);if(!p)return null;const f=p.rawId,h=(0,i.numberOrThrowIfTooLarge)(p.timestamp);if(h!==n)return null;let _=!1,g=null,m=t;c&&!c.deleted&&(null==m&&(m=c.devices),c.rawId!==f?_=!0:g=c.devices);const y=new Map,E=new Set(p.validIndexes),S=p.currentIndex||0;m&&m.forEach((e=>{null!=e.keyIndex&&E.has(e.keyIndex)&&y.set(e.id,e.keyIndex)}));null!=g&&g.forEach((e=>{e.keyIndex>S&&y.set(e.id,e.keyIndex)}));y.set(r.DEFAULT_DEVICE_ID,0);const v=Array.from(y.entries()).map((e=>{let[t,n]=e;return{id:t,keyIndex:n}})),T={id:e.user,rawId:f,timestamp:h,validIndexes:Array.from(E),devices:v,currentIndex:p.currentIndex,deleted:!1};_||(0,a.shouldClearExpectedTs)(h,u,c,d)||c&&!c.deleted&&(T.expectedTs=c.expectedTs,T.expectedTsLastDeviceJobTs=c.expectedTsLastDeviceJobTs,T.expectedTsUpdateTs=c.expectedTsUpdateTs);return{update:T,clearRecord:_}};var r=n(52230),i=n(8243),a=n(89333),o=n(87622)},49884:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleOmittedResult=function(e,t,n,r){if(!t||t.deleted)return null;if(null!=e&&e<t.timestamp)return null;const s=(0,i.default)({},t);null!=e&&(s.timestamp=e,(0,o.shouldClearExpectedTs)(e,n,t,r)&&(s.expectedTs=void 0,s.expectedTsLastDeviceJobTs=void 0,s.expectedTsUpdateTs=void 0));return s.devices=[{id:a.DEFAULT_DEVICE_ID,keyIndex:0}],{update:s,clearRecord:!1}};var i=r(n(81109)),a=n(52230),o=n(89333)},81864:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleADVSyncResult=function(e,t,n,r,a){const{deviceList:o,keyIndex:c}=t;if(null==c||null==c.signedKeyIndexBytes)return null!=o&&o.some((e=>e.id!==i.DEFAULT_DEVICE_ID))?void __LOG__(2)`processADVSyncResult: drop response with companion device but no keyIndexbytes`:(0,l.handleOmittedResult)(null==c?void 0:c.ts,r,null==c?void 0:c.expectedTs,a);const{ts:d,expectedTs:u,signedKeyIndexBytes:p}=c;return(0,s.handleKeyIndexResult)(e,o,d,p,n,r,a,u)},t.handleDeviceNotification=function(e,t,n,r,i,s){const{deviceList:l,keyIndex:c}=n;(0,a.default)(null!=l,`handleDeviceNotification: device list should not be none for device ${t} notification`),(0,a.default)(null!=c,`handleDeviceNotification: keyIndex should not be none for device ${t} notification`);const{ts:d,signedKeyIndexBytes:u}=c;if("add"===t)return(0,a.default)(null!=u,`handleDeviceNotification: signedKeyIndexBytes should not be none for device ${t} notification`),(0,o.handleDeviceAddNotification)(e,l,d,u,r,i,s);if("remove"===t)return(0,o.handleDeviceRemoveNotification)(l,c.ts,i)};var i=n(52230),a=r(n(41143)),o=n(79156),s=n(38906),l=n(49884)},87622:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.decodeSignedKeyIndexBytes=function(e,t){let n,o;try{n=(0,r.decodeProtobuf)(i.ADVSignedKeyIndexListSpec,t)}catch(e){return null}if(!(0,a.verifyKeyIndexListAccountSignature)(n,e))return null;try{o=(0,r.decodeProtobuf)(i.ADVKeyIndexListSpec,n.details)}catch(e){return null}const{timestamp:s,rawId:l,validIndexes:c,currentIndex:d}=o;if(null==s)return null;if(null==l)return null;return{timestamp:s,rawId:l,validIndexes:c,currentIndex:d}};var r=n(84902),i=n(61438),a=n(46308)},80140:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.blockContact=function(e){return p((0,d.unproxy)(e),!0)},t.unblockContact=function(e){return p((0,d.unproxy)(e),!1)};var i=n(92574),a=n(46331),o=n(30312),s=n(32826),l=n(88102),c=r(n(14296)),d=n(31019),u=n(85893);function p(e,t,n){const{id:r}=e,d=e.isBlocked();if(t&&d||!t&&!d)return Promise.resolve();const f=(0,o.sendSetBlock)(t,r).then((e=>{e&&(t?s.BlocklistCollection.add({id:r}):s.BlocklistCollection.remove(r))}));return function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:(0,a.genId)();const o={participant:e.formattedName},s=n?new a.ActionType(c.default.t(10,o)):new a.ActionType(c.default.t(132,o)),d=t.then((()=>{const t=n?c.default.t(9,o):c.default.t(131,o);return new a.ActionType(t,{actionText:c.default.t(133),actionHandler:()=>p(e,!n,r)})})).catch((t=>{if(!(t instanceof i.ServerStatusCodeError)){__LOG__(3)`action:setBlock dropped`;const t=n?c.default.t(8,o):c.default.t(130,o);throw new a.ActionType(t,{actionText:c.default.t(129),actionHandler:()=>p(e,n,r)})}if(t.statusCode>=400)throw n?new a.ActionType(c.default.t(8,o)):new a.ActionType(c.default.t(130,o))}));l.Cmd.openToast((0,u.jsx)(a.ActionToast,{id:r,initialAction:s,pendingAction:d}))}(e,f,t,n),f}},352:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.onIsBusinessChange=function(e){const t=(0,i.unproxy)(e),{businessProfile:a,id:o}=t,s=t.isBusiness||t.isMe&&r.Conn.isSMB;s&&!a?t.addChild("businessProfile",n(93581).BusinessProfileCollection.gadd(o)):!s&&a&&(t.stopListening(a),t.businessProfile=void 0,a.delete())};var r=n(17239),i=n(31019)},96563:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(40265);class i extends((0,r.customError)("ContactBlocked")){constructor(e,t){super(e),this.contact=t}}t.default=i},43024:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.contactFindQuery=function(){return d.apply(this,arguments)};var i=r(n(48926)),a=n(88555),o=n(13042),s=n(1255),l=n(76285),c=r(n(56891));function d(){return(d=(0,i.default)((function*(e){if((0,a.isLegacyWebdBackend)()){const t=performance.now(),r={},i=yield c.default.contactFindQuery(e.retry,(e=>{r.binarySize=e.binarySize}));if("preempted"===i.data)return Promise.reject(new s.CollectionSilentQueryError("contacts preempted"));r.count=i.data.length,r.timing=Math.ceil(performance.now()-t);const a=n(19380).ContactCollection;return a.trigger(o.COLLECTION_HAS_SYNCED,r),(0,l.mungePSAContact)(i.data),i.checksum&&(a.setChecksum(i.checksum),__LOG__(2)`Store:Contact:query update checksum ${i.checksum}`),Promise.resolve(i.data)}return Promise.reject(new Error("This call is only supported in non-MD mode"))}))).apply(this,arguments)}},75888:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getOrQueryUsyncInfo=function(){return h.apply(this,arguments)},t.usyncContactCached=function(){return new a.default(u.queryPhoneExists,{maxCached:100,maxAge:36e4,shouldCache:e=>!!e})};var i=r(n(48926)),a=r(n(18569)),o=n(69951),s=n(91036),l=n(19380),c=n(7293),d=n(41566),u=n(57547),p=r(n(72639)),f=r(n(50974));function h(){return(h=(0,i.default)((function*(e){const t=l.ContactCollection.get(e);var n,r;if(null!=t&&(null!=t.name||null!=o.ChatCollection.get(e)))return Promise.resolve({wid:e,biz:t.isBusiness,bizInfo:t.isBusiness?{verifiedName:{level:(0,f.default)(t.verifiedLevel),serial:null,name:t.verifiedName,isApi:Boolean(t.isEnterprise),privacyMode:t.privacyMode}}:null,disappearingMode:(0,d.isDisappearingModeEnabled)()?{duration:null!==(n=t.disappearingModeDuration)&&void 0!==n?n:0,settingTimestamp:null!==(r=t.disappearingModeSettingTimestamp)&&void 0!==r?r:0}:null});const i=yield(0,u.queryExists)(e);if(i){const{biz:n,bizInfo:r,disappearingMode:a}=i;return c.GK.supportsFeature(c.GK.F.QUERY_VNAME)&&n&&(0,p.default)(e,r),(0,d.isDisappearingModeEnabled)()&&a&&null!=t&&(0,s.updateDisappearingMode)(e,a.duration,a.settingTimestamp),i}return Promise.reject(new Error("Invalid number"))}))).apply(this,arguments)}},84765:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.queryIdentity=function(e){const t=(0,a.unproxy)(e),{verificationBinary:n,verificationString:r,id:l}=t;if(n&&r)return Promise.resolve();if(t.promises.queryIdentity)return t.promises.queryIdentity;if((0,i.isLegacyWebdBackend)())return void(t.promises.queryIdentity=o.default.queryIdentity(l).then((t=>{s(e,t)})).catch((e=>{__LOG__(3)`models:contact:queryIdentity error: ${String(e)}`})).finally((()=>{t.promises.queryIdentity=null})));return Promise.reject(new Error("This call is only supported in non-MD mode"))},t.updateIdentity=s;var i=n(88555),a=n(31019),o=r(n(56891));function s(e,t){const n=(0,a.unproxy)(e);null!=t.status&&t.status>=400?(n.unset("verificationBinary"),n.unset("verificationString")):(n.verificationBinary=t.binary,n.verificationString=t.string)}},1291:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.clearDeviceRecordForIdentityChange=g,t.handleNewIdentity=function(){return _.apply(this,arguments)},t.handleSelfPrimaryIdentityChange=function(){if((0,o.isLegacyWebdBackend)())return;__LOG__(4,void 0,new Error,!0)`handleNewIdentity: ignore identity change for your own primary device`,SEND_LOGS("self-identity-change");const e=n(65044).Socket,t=n(83578).LogoutReason;e.logout(!1,t.PrimaryIdentityKeyChange)};var i=r(n(48926)),a=n(52230),o=n(88555),s=n(72441),l=n(45454),c=n(66308),d=n(9108),u=r(n(69153)),p=n(99069),f=n(58928),h=n(84356);function _(){return(_=(0,i.default)((function*(e){var t;if((0,o.isLegacyWebdBackend)())return Promise.reject(new Error("This call is only supported in MD mode"));const r=window.libsignal.SignalProtocolAddress.fromString(e).getName(),i=(0,l.createWid)((0,s.toPhoneUserJid)(r)),d=null!==(t=i.device)&&void 0!==t?t:a.DEFAULT_DEVICE_ID,u=(0,l.toUserWid)(i);if(d===a.DEFAULT_DEVICE_ID){h.Voip.notifyDeviceIdentityChangedOrDeleted(i,!0);const e=n(9701).addSecurityCodeChangedNotifications;yield g(u),yield e(u)}else yield(0,c.createAndStoreDeviceNotifications)(u,[d],[d])}))).apply(this,arguments)}function g(){return m.apply(this,arguments)}function m(){return(m=(0,i.default)((function*(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if((0,o.isLegacyWebdBackend)())return Promise.reject(new Error("clearDeviceRecordForIdentityChange: This call is only supported in MD mode"));const r=[a.DEFAULT_DEVICE_ID],i=[a.DEFAULT_DEVICE_ID];if(t)u.default.addOfflinePendingDevice(String(e),null),yield(0,p.getStorage)().lock(["participant"],(()=>(0,f.updateGroupParticipantsInTransaction)(e,i,r)));else{const t=yield(0,d.getDeviceRecord)(e.user);t&&!t.deleted&&t.devices.forEach((e=>{e.id!==a.DEFAULT_DEVICE_ID&&r.push(e.id)}));const o=n(77605).Session;Promise.all(r.map((t=>t===a.DEFAULT_DEVICE_ID?Promise.resolve():o.deleteRemoteInfo((0,l.createDeviceWidFromUserAndDevice)(e.user,t))))),yield Promise.all([(0,p.getStorage)().lock(["participant"],(()=>(0,f.updateGroupParticipantsInTransaction)(e,i,r))),(0,d.createOrReplaceDeviceRecord)({id:e.user,deleted:!0})])}}))).apply(this,arguments)}},3879:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addLiveLocation=function(e,t){const n=(0,r.unproxy)(e);n.liveLocations||(n.liveLocations=[]);const{liveLocations:i}=n;i.push(t)},t.removeLiveLocation=function(e,t){const n=(0,r.unproxy)(e),{liveLocations:i}=n;if(!i)return;for(let e=i.length-1;e>=0;e--)if(i[e]===t){i.splice(e,1);break}0===i.length&&(n.liveLocations=null)};var r=n(31019)},71517:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.deleteProfilePic=function(e){return g((0,p.unproxy)(e))},t.setProfilePic=function(e,t,n){return _((0,p.unproxy)(e),t,n)};var i=n(50796),a=n(92574),o=n(46331),s=n(88102),l=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=h(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(35232)),c=n(99234),d=r(n(14296)),u=n(78426),p=n(31019),f=n(85893);function h(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(h=function(e){return e?n:t})(e)}function _(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:(0,o.genId)();const{id:p}=e;if(!e.canSet())return Promise.reject(new l.ActionError);const h=(0,u.sendSetPicture)(p,t,n);e.pendingPic=t;const g=(0,c.getMaybeMeUser)(),m=p.equals(g)?new o.ActionType(d.default.t(117)):new o.ActionType(d.default.t(63)),y=h.catch((()=>{throw __LOG__(3)`models:ProfilePicThumb:setPicture dropped`,p.equals(g)?new o.ActionType(d.default.t(116)):new o.ActionType(d.default.t(62))})).catch((0,i.filteredCatch)(a.ServerStatusCodeError,(i=>{if(i.status>=400){const i=p.equals(g)?d.default.t(116):d.default.t(62);return new o.ActionType(i,{actionText:d.default.t(129),actionHandler:()=>_(e,t,n,r)})}}))).then((()=>p.equals(g)?new o.ActionType(d.default.t(115)):new o.ActionType(d.default.t(61))));return s.Cmd.openToast((0,f.jsx)(o.ActionToast,{id:r,initialAction:m,pendingAction:y})),h.then((t=>{t._duplicate||e.set({tag:t.tag,eurl:t.eurl,token:t.token})})).finally((()=>{e.pendingPic=void 0}))}function g(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,o.genId)();const{id:n}=e;if(!e.canDelete())return Promise.reject(new l.ActionError);const r=(0,u.requestDeletePicture)(n);e.pendingPic=e.fallbackType;const p=(0,c.getMaybeMeUser)(),h=n.equals(p)?new o.ActionType(d.default.t(114)):new o.ActionType(d.default.t(60)),_=r.catch((()=>{throw __LOG__(3)`models:ProfilePicThumb:deletePicture dropped`,n.equals(p)?new o.ActionType(d.default.t(112)):new o.ActionType(d.default.t(58))})).catch((0,i.filteredCatch)(a.ServerStatusCodeError,(r=>{if(r.status>=400){const r=n.equals(p)?d.default.t(112):d.default.t(58);return new o.ActionType(r,{actionText:d.default.t(129),actionHandler:()=>g(e,t)})}}))).then((()=>n.equals(p)?new o.ActionType(d.default.t(113)):new o.ActionType(d.default.t(59))));return s.Cmd.openToast((0,f.jsx)(o.ActionToast,{id:t,initialAction:h,pendingAction:_})),r.then((t=>{t._duplicate||e.set({tag:void 0,eurl:void 0})})).finally((()=>{e.pendingPic=void 0}))}},16150:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.updatePushname=function(e,t){const n=(0,i.toUserWid)(e);return s.enqueue((()=>{(0,a.getBridge)().sendAndReceive("contact_collection","updatePushname",{contactId:n,pushname:t}).then((e=>{if(e||void 0===e)return __LOG__(2)`updatePushName: set pushname for ${String(n)}`,(0,o.updateLocal)(n,{pushname:t})}))}))};var r=n(27870),i=n(45454),a=n(41796),o=n(27211);const s=new r.PromiseQueue},32613:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.resyncContacts=function(e){void 0!==o.ContactCollection.checksum&&void 0!==e&&(o.ContactCollection.checksum!==e?o.ContactCollection.findQuery({retry:!0}).then((e=>{if(Array.isArray(e)){(0,c.mungePSAContact)(e),__LOG__(2)`Store:Contact:resync success`;const t=(0,l.getContactsToRemove)(e);let n=Promise.resolve();if((0,a.isMDBackend)()&&t.length){const e=t.map((e=>e.id.toString()));n=(0,s.getContactTable)().bulkRemove(e).catch((()=>{throw __LOG__(4,!0,new Error,!0)`bulkRemove from contact table failed`,SEND_LOGS("bulkRemove from contact table failed when resyncing contacts"),new Error("bulkRemove from contact table failed")}))}n.then((()=>{t.forEach((e=>{e.unset("name"),e.unset("shortName")}))}))}else __LOG__(3)`Store:Contact.resync error ${JSON.stringify(e)}`})).catch((0,r.filteredCatch)(i.WebdDrop,(()=>{}))):__LOG__(2)`Store:Contact:resync checksum match`)};var r=n(50796),i=n(92574),a=n(88555),o=n(19380),s=n(76214),l=n(88129),c=n(76285)},9701:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addSecurityCodeChangedNotifications=function(){return f.apply(this,arguments)};var i=r(n(48926)),a=n(88555),o=n(10635),s=n(45454),l=n(99234),c=n(41796),d=n(76214),u=r(n(29783)),p=n(90641);function f(){return(f=(0,i.default)((function*(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if((0,a.isLegacyWebdBackend)())return;const{notifications:n,chatIds:r}=yield h(e);if(0!==n.length){if(!t){Promise.all(n.map((e=>{e.recvFresh=!0,e.isNewMsg=!0;return(0,c.getBridge)().sendAndReceive("msg_collection","processMultipleMessages",{chatId:e.from,msgObjs:[e],meta:{add:"after",isHistory:!1}})})));const e=yield(0,p.encryptMultipleMsgs)(n);return(0,p.storeEncryptedMessage)(e,r,!1)}u.default.addOfflineMessage(n.map((e=>({msg:e}))))}}))).apply(this,arguments)}function h(){return _.apply(this,arguments)}function _(){return(_=(0,i.default)((function*(e){const t={notifications:[],chatIds:[]};if(!(0,l.getGlobalSecurityNotifications)())return t;let n=[];try{const t=yield(0,d.getChatTable)().get(String(e));n=(yield(0,d.getParticipantTable)().equals(["participants"],String(e))).map((e=>(0,s.createWid)(e.groupId))),t&&n.push((0,s.createWid)(t.id))}catch(e){throw __LOG__(4,!0,new Error,!0)`get chats failed`,SEND_LOGS("get chats failed when creating device notification"),new Error("get chats failed")}const r=n.map((t=>(0,o.genSecurityCodeNotificationMsg)(t,e)));return t.notifications=r,t.chatIds=n.map(String),t}))).apply(this,arguments)}},44334:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getStatus=function(){return h.apply(this,arguments)},t.setMyStatus=_;var i=r(n(48926)),a=n(51737),o=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=f(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(35232)),s=n(46331),l=n(88102),c=n(99234),d=r(n(14296)),u=n(46898),p=n(85893);function f(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(f=function(e){return e?n:t})(e)}function h(){return(h=(0,i.default)((function*(e){const t=yield(0,u.getStatus)(e),r={id:e};if((0,a.isNumber)(t.status))switch(t.status){case 429:case 401:case 403:case 404:case 304:r.stale=!0;const t=n(46133).StatusCollection.get(e);t&&!(0,a.isString)(t.status)&&(r.status="");break;default:r.status=""}else{let i=t.status;if(t.stale){const t=n(46133).StatusCollection.get(e);t&&(i=t.status)}r.status=i}return r}))).apply(this,arguments)}function _(){return g.apply(this,arguments)}function g(){return(g=(0,i.default)((function*(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,s.genId)(),r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=e.trim();if(!i)return Promise.reject(new o.ActionError);const a=(0,u.setMyStatus)(i),f=new s.ActionType(d.default.t(128)),h=(0,c.getMaybeMeUser)(),g=n(46133).StatusCollection,m=g.assertGet(h).status,y=a.then((e=>{if(200===e.status){const e=r?void 0:{actionText:d.default.t(133),actionHandler:()=>_(m,t,!0)};return new s.ActionType(d.default.t(126),e)}if(e.status>=400)return new s.ActionType(d.default.t(127))})).catch((()=>{throw __LOG__(3)`models:statusCollection:setMyStatus dropped`,new s.ActionType(d.default.t(127),{actionText:d.default.t(129),actionHandler:()=>_(e,t)})}));l.Cmd.openToast((0,p.jsx)(s.ActionToast,{id:t,initialAction:f,pendingAction:y}));const E=yield a;200!==E.status||E._duplicate||(g.assertGet(h).status=e)}))).apply(this,arguments)}},76285:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.mungePSAContact=function(e){if(Array.isArray(e)){const t=e.findIndex((e=>e&&i.default.isPSA(e.id))),n=e[t];t>-1&&n&&(n.name=a.default.t(1022),n.shortName=a.default.t(1022))}};var i=r(n(89867)),a=r(n(14296))},42822:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addUnjoinedSubgroupsToCollection=function(e,t){e.forEach((e=>{var n;null!=e&&l.default.add({id:e.id,subject:e.subject,parentGroupId:t,defaultSubgroup:null!==(n=e.defaultSubgroup)&&void 0!==n&&n},{merge:!0})}))},t.changesForParentGroupLink=function(e,t){var n;const r=o.ChatCollection.get(e.toString()),{parentGroupChanges:a,subgroupChanges:s}=d(r,t);return{parentGroupChanges:(0,i.default)((0,i.default)({},a),{},{unjoinedSubgroups:a.unjoinedSubgroups.map((e=>e.toString()))}),subgroupChanges:(0,i.default)((0,i.default)({},s),{},{parentGroup:null===(n=s.parentGroup)||void 0===n?void 0:n.toString(),unjoinedSubgroups:s.unjoinedSubgroups.map((e=>e.toString()))})}},t.changesForSubgroupLink=function(e,t){const n=c(o.ChatCollection.gadd(e),t);return(0,i.default)((0,i.default)({},n),{},{unjoinedSubgroups:n.unjoinedSubgroups.map((e=>e.toString()))})},t.forceFetchProfilePics=function(e){e.forEach((e=>{const t=s.ProfilePicThumbCollection.get(e.toString());null!=t&&t.markStale({eurl:!0}),s.ProfilePicThumbCollection.find(e)}))},t.getUnjoinedGroupIds=u,t.updateModelsForParentGroupLink=function(e,t){const n=o.ChatCollection.get(e.toString()),{parentGroupChanges:r,subgroupChanges:i}=d(n,t);(null==n?void 0:n.groupMetadata)&&Object.assign(n.groupMetadata,r);t.groupMetadata&&Object.assign(t.groupMetadata,i)},t.updateModelsForSubgroupLink=function(e,t){const n=e.groupMetadata,r=c(e,t);null!=n&&Object.assign(n,r)};var i=r(n(81109)),a=r(n(2883)),o=(n(63183),n(69951)),s=n(82039),l=r(n(73213));function c(e,t){const n=e.groupMetadata,r=u(t);return{unjoinedSubgroups:(i=null==n?void 0:n.unjoinedSubgroups,o=r,(0,a.default)(null!=i?i:[],null!=o?o:[],((e,t)=>e.equals(t)))),isParentGroup:!0,parentGroup:void 0};var i,o}function d(e,t){var n;const r={parentGroup:null==e?void 0:e.id,isParentGroup:!1,unjoinedSubgroups:[]},i={};return null!=(null==e||null===(n=e.groupMetadata)||void 0===n?void 0:n.unjoinedSubgroups)&&(i.unjoinedSubgroups=e.groupMetadata.unjoinedSubgroups.filter((e=>e!==t))),{parentGroupChanges:i,subgroupChanges:r}}function u(e){return e.filter((e=>{var t;const n=o.ChatCollection.get(e.toString());return null==n||!(null===(t=n.groupMetadata)||void 0===t?void 0:t.participants.iAmMember())}))}},56489:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.createGroup=function(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5?arguments[5]:void 0;return E(e,t,n,r,void 0,i,a)},t.sendForNeededAddRequest=S;var i=r(n(81109)),a=n(50796),o=n(87614),s=n(92574),l=n(45454),c=n(48360),d=n(46331),u=n(88102),p=n(19380),f=n(79583),h=n(50101),_=r(n(14296)),g=n(71517),m=n(82039),y=n(85893);function E(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:(0,d.genId)(),l=arguments.length>5?arguments[5]:void 0,p=arguments.length>6?arguments[6]:void 0;const v=r.map((e=>e.id)),T=void 0,b=(0,f.sendCreateGroup)(e,v,T,(0,o.randomHex)(8),!1,!1,l,p),C=new d.ActionType(_.default.t(51)),A=b.then((t=>(S(t,e,T),new d.ActionType(_.default.t(50))))).catch((0,a.filteredCatch)(s.ServerStatusCodeError,(e=>406===e.status?new d.ActionType(_.default.t(47)+" "+_.default.t(48)):429===e.status?new d.ActionType(_.default.t(47)+" "+c.fbt._("You've created too many groups too quickly. Try again later.",null,{hk:"2fN2Us"}).toString()):void 0))).catch((()=>(__LOG__(3)`models:chatCollection:createGroup dropped`,new d.ActionType(_.default.t(47),{actionText:_.default.t(129),actionHandler:()=>E(e,t,n,r,i,l)}))));return u.Cmd.openToast((0,y.jsx)(d.ActionToast,{id:i,initialAction:C,pendingAction:A})),b.then((e=>{if(null==p&&e.gid&&(0,h.findChat)(e.gid).then((e=>{u.Cmd.openChatBottom(e).then((t=>{t&&u.Cmd.focusChatTextInput(e)}))})),!e._duplicate&&t&&n){const r=m.ProfilePicThumbCollection.gadd(e.gid);return(0,g.setProfilePic)(r,t,n).then((()=>e.gid))}return e._duplicate&&__LOG__(3)`createGroup failed to set picture.`,e.gid})).catch((0,a.filteredCatch)(s.ServerStatusCodeError,(()=>{})))}function S(e,t,n,r){if(!e.participants)return;const a=r||e.gid;a||(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("Group add request was provided with undefined gid"));const o=e.participants.reduce(((e,t)=>{const n=Object.keys(t)[0];if("403"!==t[n].code)return e;const r=(0,l.createWid)(n),a=p.ContactCollection.gadd(r,{silent:!0});return[...e,(0,i.default)((0,i.default)({},t[n]),{},{contact:a})]}),[]);o.length>0&&a&&u.Cmd.openGroupV4InviteRequestFlow(o,a,t,n)}},5501:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.localExitGroup=g,t.sendExitGroup=function(e){return _((0,p.unproxy)(e))};var i=n(50796),a=n(92574),o=n(46331),s=n(88102),l=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=h(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(35232)),c=n(90447),d=n(99234),u=r(n(14296)),p=n(31019),f=n(85893);function h(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(h=function(e){return e?n:t})(e)}function _(e){const{isGroup:t,promises:n}=e;if(!t)return Promise.reject(new l.ActionError);if(n.sendExit)return n.sendExit;const r=n.sendExit=(0,c.sendExitGroup)(e.id),d=new o.ActionType(u.default.t(57)),p=r.then((function(){return new o.ActionType(u.default.t(56))})).catch((0,i.filteredCatch)(a.ServerStatusCodeError,(e=>{if(e.status>=400)return new o.ActionType(u.default.t(55))}))).catch((function(){return __LOG__(3)`actions:chat:sendExit dropped`,new o.ActionType(u.default.t(55),{actionText:u.default.t(129),actionHandler:()=>_(e)})}));return s.Cmd.openToast((0,f.jsx)(o.ActionToast,{id:(0,o.genId)(),initialAction:d,pendingAction:p})),r.then((t=>{t._duplicate||g(e)})).finally((()=>{n.sendExit=null})).catch((0,i.filteredCatch)(a.ServerStatusCodeError,(()=>{})))}function g(e){var t;e.isGroup&&(null===(t=e.groupMetadata)||void 0===t||t.participants.remove((0,d.getMaybeMeUser)()),(0,c.markExited)(e.id).then((()=>{e.isReadOnly=!0})).catch((e=>{throw __LOG__(4,!0,new Error,!0)`failed to merge chat table`,SEND_LOGS("failed to merge chat table when exiting group: "+e),new Error("failed to merge chat table")})))}},36098:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GROUP_ACTIONS=void 0;const n=Object.freeze({SUBJECT:"subject",ADD:"add",PROMOTE:"promote",DEMOTE:"demote",DELETE:"delete",REMOVE:"remove",MODIFY:"modify",INVITE_CODE:"invite",DESC_ADD:"desc_add",DESC_REMOVE:"desc_remove",RESTRICT:"restrict",ANNOUNCE:"announce",NO_FORWARD:"no_frequently_forwarded",EPHEMERAL:"ephemeral",REVOKE_INVITE:"revoke_invite",SUSPEND:"suspend",GROWTH_LOCKED:"growth_locked",GROWTH_UNLOCKED:"growth_unlocked",SUB_GROUP_LINK:"sub_group_link",PARENT_GROUP_LINK:"parent_group_link",SIBLING_GROUP_LINK:"sibling_group_link"});t.GROUP_ACTIONS=n},42952:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleGroupAction=function(e,t,n){return function(e,t,n){const r=(0,i.default)(e.groupMetadata,"chat.groupMetadata"),{action:c}=n;switch(n.action){case s.GROUP_ACTIONS.SUBJECT:const i={name:n.subject};e.contact.set(i);break;case s.GROUP_ACTIONS.ADD:case s.GROUP_ACTIONS.PROMOTE:case s.GROUP_ACTIONS.DEMOTE:const d=n.participants.map((e=>({id:e,isAdmin:"promote"===c})));r.participants.add(d,{merge:!0}),"add"===c&&(n.participants.forEach((t=>{l.default.trigger(`group_participant_change_${t.toString()}`,e.id)})),t&&!o.ContactCollection.get(t)&&r.set({notAddedByContact:!0,addedBy:t}));break;case s.GROUP_ACTIONS.REMOVE:n.participants.forEach((e=>{r.participants.remove(e)})),n.participants.forEach((t=>{l.default.trigger(`group_participant_change_${t.toString()}`,e.id)}));break;case s.GROUP_ACTIONS.MODIFY:if(t&&n.participants&&n.participants.length>0){const e=n.participants[0],i=r.participants.remove(t);let a=!1,o=!1;i.length&&i[0]&&(a=i[0].isAdmin,o=i[0].isSuperAdmin);const s={id:e,isAdmin:a,isSuperAdmin:o};r.participants.add(s)}break;case s.GROUP_ACTIONS.INVITE_CODE:n.code?r.inviteCode=n.code:__LOG__(3)`model:chat:handleGroupAction:invalid invite code: ${n.code} for ${e.id.toString()}`;break;case s.GROUP_ACTIONS.DESC_ADD:r.set({desc:n.desc,descId:n.descId,descTime:n.descTime,descOwner:null==t?void 0:t.toString()});break;case s.GROUP_ACTIONS.DESC_REMOVE:if(r.descId===n.descId){r.set({desc:void 0,descId:void 0,descTime:void 0,descOwner:void 0});break}break;case s.GROUP_ACTIONS.RESTRICT:r.restrict=!!n.value;break;case s.GROUP_ACTIONS.SUSPEND:r.suspended=!!n.value;break;case s.GROUP_ACTIONS.ANNOUNCE:r.announce=!!n.value;break;case s.GROUP_ACTIONS.NO_FORWARD:r.noFrequentlyForwarded=!!n.value;break;case s.GROUP_ACTIONS.EPHEMERAL:r.ephemeralDuration=n.duration;break;case s.GROUP_ACTIONS.REVOKE_INVITE:break;case s.GROUP_ACTIONS.DELETE:r.terminated=!0;break;case s.GROUP_ACTIONS.GROWTH_UNLOCKED:r.growthLockExpiration=void 0,r.growthLockType=void 0;break;case s.GROUP_ACTIONS.GROWTH_LOCKED:"invite"===n.type&&(r.growthLockExpiration=n.expiration,r.growthLockType=n.type);break;case s.GROUP_ACTIONS.PARENT_GROUP_LINK:(0,a.updateModelsForParentGroupLink)(n.groups[0],e);break;case s.GROUP_ACTIONS.SUB_GROUP_LINK:(0,a.updateModelsForSubgroupLink)(e,n.groups);break;case s.GROUP_ACTIONS.SIBLING_GROUP_LINK:break;default:__LOG__(4,void 0,new Error,void 0,["groups"])`unhandled group notif action in handleGroupAction`}return Promise.resolve()}((0,c.unproxy)(e),t,n)};var i=r(n(45095)),a=n(42822),o=n(19380),s=n(36098),l=r(n(63928)),c=n(31019)},34648:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleGroupActionMD=function(e,t,n){if((0,s.isLegacyWebdBackend)())return Promise.reject(new Error("handleGroupActionMD: only supported on MD"));return function(){return I.apply(this,arguments)}(e,t,n)},t.handleGroupActionWap=function(e,t){const{chatId:r,author:i}=e,a=n(69951).ChatCollection.get(r);if(!a)return void __LOG__(3)`model:chat: unknown chat for ${r.toString()}, action ${JSON.stringify(t)}`;(0,y.handleGroupAction)(a,i,t)},t.handleGroupCreation=function(e,t,n){if((0,s.isLegacyWebdBackend)())return Promise.reject(new Error("handleGroupCreation: should not be called in wap mode"));return function(){return M.apply(this,arguments)}(e,t,n)};var i=r(n(48926)),a=n(50796),o=r(n(45095)),s=n(88555),l=n(19380),c=n(91829),d=n(57062),u=n(76581),p=n(99234),f=n(9025),h=n(57701),_=n(62415),g=n(90101),m=n(36098),y=n(42952),E=n(84886),S=r(n(11339)),v=n(59871),T=n(70405),b=n(80474),C=n(16150),A=n(10790),P=n(92188);function M(){return(M=(0,i.default)((function*(e,t,n){var r,i,a;__LOG__(2,void 0,void 0,void 0,["groups"])`inside handleGroupCreationMD`;const{chatId:o,author:s,pushname:u}=e;null!=e.author&&e.author.equals((0,p.getMaybeMeUser)())||new S.default.GroupJoinC({}).commit(),s&&u&&(0,C.updatePushname)(s,u),yield Promise.all([(0,b.updateParticipantsJob)(t.id,t.participants,t.pvId,n),(0,d.updateGroupMetadataTableJob)([t])]),__LOG__(2,void 0,void 0,void 0,["groups"])`updated GroupMetadata and participants tables`;let _=yield(0,f.getExisting)(o);if(_){var g;(0,A.updateSubject)(o,t.subject),null===(g=_.groupMetadata)||void 0===g||g.set(t)}else{var m;_=yield(0,c.create)(o,{t:t.creation,pendingInitialLoading:!1,createdLocally:!1}),null===(m=_.groupMetadata)||void 0===m||m.set(t),__LOG__(2,void 0,void 0,void 0,["groups"])`updated chat model and table`;l.ContactCollection.gadd(t.id).set({name:t.subject}),__LOG__(2,void 0,void 0,void 0,["groups"])`updated contact name`}const y=(null!==(r=null===(i=_.groupMetadata)||void 0===i?void 0:i.participants)&&void 0!==r?r:[]).length,E=null===(a=_.groupMetadata)||void 0===a?void 0:a.announce;!n&&!E&&y&&(0,h.sendKeyDistributionMsgToNewGroups)()&&y>=(0,h.sendKeyDistributionMsgMinGroupSize)()&&(__LOG__(2,void 0,void 0,void 0,["groups"])`handleGroupCreationMD sending key distribution message`,(0,P.sendKeyDistributionMsg)(_).then((()=>{__LOG__(2,void 0,void 0,void 0,["groups"])`handleGroupCreationMD sending key distribution message: done`})).catch((e=>{__LOG__(3,void 0,void 0,void 0,["groups"])`handleGroupCreationMD sending key distribution message failed: ${e}`})))}))).apply(this,arguments)}function O(e,t){return t?(0,d.markGroupAsDirtyJob)(e):(0,A.sendQueryGroup)(e)}function I(){return(I=(0,i.default)((function*(e,t,r){var i,s,c;__LOG__(2,void 0,void 0,void 0,["groups"])`inside _handleGroupActionMD`;const{chatId:f,author:h,pushname:S}=e;h&&S&&(0,C.updatePushname)(h,S);const A=[],P=n(69951).ChatCollection.get(f);switch(t.action){case m.GROUP_ACTIONS.ADD:h&&!l.ContactCollection.get(h)&&A.push((0,g.persistGroupMetadata)(f,{notAddedByContact:!0,addedBy:h.toString()})),A.push((0,b.addParticipantsJob)(f,t.participants,t.version,t.prevVersion,r).catch((0,a.filteredCatch)(T.GroupUnSyncedError,(()=>{__LOG__(3)`addParticipants: out-of-sync group notification`,O(f,r)}))));break;case m.GROUP_ACTIONS.REMOVE:A.push((0,b.removeParticipantsJob)(f,t.participants,t.version,t.prevVersion).catch((0,a.filteredCatch)(T.GroupUnSyncedError,(()=>{__LOG__(3)`removeParticipants: out-of-sync group notification`,O(f,r)}))));const e=(0,p.getMaybeMeUser)();e&&t.participants.find((t=>t.equals(e)))&&(0,p.removeUserSentMessageToChat)(f);break;case m.GROUP_ACTIONS.DEMOTE:A.push((0,b.demoteParticipantsJob)(f,t.participants,t.version,t.prevVersion).catch((0,a.filteredCatch)(T.GroupUnSyncedError,(()=>{__LOG__(3)`removeParticipants: out-of-sync group notification`,O(f,r)}))));break;case m.GROUP_ACTIONS.PROMOTE:A.push((0,b.promoteParticipantsJob)(f,t.participants,t.version,t.prevVersion).catch((0,a.filteredCatch)(T.GroupUnSyncedError,(()=>{__LOG__(3)`removeParticipants: out-of-sync group notification`,O(f,r)}))));break;case m.GROUP_ACTIONS.REVOKE_INVITE:const y=null===(i=(0,p.getMaybeMeUser)())||void 0===i?void 0:i.toString();if(!y)return void __LOG__(3)`getMaybeMeUser returned null, can't process action ${t}`;const S=null==h?void 0:h.toString();let C=[];if(null==S)return void __LOG__(3)`Received revoke without an admin jid ${t}`;if(S===y)C=t.participants.map((e=>({from:y,to:e.id.toString(),groupId:f.toString(),expiration:e.expiration})));else{const e=t.participants.find((e=>e.id.toString()===y));if(!e)return __LOG__(4,void 0,new Error,!0)`Received group invite revokation from ${S}, but user not in participants list`,void SEND_LOGS("bad-revoke");C=[{from:S,to:y,groupId:f.toString(),expiration:e.expiration}]}const P=yield Promise.all(C.map((e=>(0,_.revokeGroupInvites)(e.from,e.to,e.groupId,e.expiration)))),M=[];P.flat().map((e=>{(null==e?void 0:e.id)&&M.push(e.id)})),(yield(0,u.msgFindByIds)(M)).map((e=>{var t;null===(t=v.MsgCollection.get(e.id))||void 0===t||t.set({inviteCodeExp:"0"}),e.inviteCodeExp="0",(0,E.updateExistingMessages)([e],e.id.remote)}));break;case m.GROUP_ACTIONS.MODIFY:if(1!==t.participants.length){__LOG__(3)`_handleGroupActionMD: participants length should be 1, but is ${t.participants.length}`;break}A.push((0,d.modifyGroupParticipantJob)(f,(0,o.default)(h,"author"),t.participants[0],null!==(s=t.prevVersion)&&void 0!==s?s:-1,null!==(c=t.version)&&void 0!==c?c:-1));break;case m.GROUP_ACTIONS.SUBJECT:A.push((0,g.persistGroupMetadata)(f,{subject:t.subject}));break;case m.GROUP_ACTIONS.DESC_ADD:A.push((0,g.persistGroupMetadata)(f,{desc:t.desc,descId:t.descId,descTime:t.descTime,descOwner:null==h?void 0:h.toString()}));break;case m.GROUP_ACTIONS.DESC_REMOVE:A.push((0,g.persistGroupMetadata)(f,{desc:void 0,descId:void 0,descTime:void 0,descOwner:void 0}));break;case m.GROUP_ACTIONS.RESTRICT:A.push((0,g.persistGroupMetadata)(f,{restrict:!!t.value}));break;case m.GROUP_ACTIONS.SUSPEND:A.push((0,g.persistGroupMetadata)(f,{suspended:!!t.value}));break;case m.GROUP_ACTIONS.ANNOUNCE:A.push((0,g.persistGroupMetadata)(f,{announce:!!t.value}));break;case m.GROUP_ACTIONS.NO_FORWARD:A.push((0,g.persistGroupMetadata)(f,{noFrequentlyForwarded:!!t.value}));break;case m.GROUP_ACTIONS.EPHEMERAL:A.push((0,g.persistGroupMetadata)(f,{ephemeralDuration:t.duration}));break;case m.GROUP_ACTIONS.INVITE_CODE:break;case m.GROUP_ACTIONS.DELETE:A.push((0,g.persistGroupMetadata)(f,{terminated:!0}));break;case m.GROUP_ACTIONS.GROWTH_UNLOCKED:A.push((0,g.persistGroupMetadata)(f,{growthLockExpiration:void 0,growthLockType:void 0}));break;case m.GROUP_ACTIONS.GROWTH_LOCKED:"invite"===t.type&&A.push((0,g.persistGroupMetadata)(f,{growthLockExpiration:t.expiration,growthLockType:t.type}));break;case m.GROUP_ACTIONS.PARENT_GROUP_LINK:const I=t.groups[0],{parentGroupChanges:w,subgroupChanges:R}=n(42822).changesForParentGroupLink(I,f);A.push((0,g.persistGroupMetadata)(f,R)),A.push((0,g.persistGroupMetadata)(I,w));break;case m.GROUP_ACTIONS.SUB_GROUP_LINK:A.push((0,g.persistGroupMetadata)(f,n(42822).changesForSubgroupLink(f,t.groups)));break;case m.GROUP_ACTIONS.SIBLING_GROUP_LINK:break;default:__LOG__(4,void 0,new Error,void 0,["groups"])`unhandled group notif action in handleGroupActionMD for action ${JSON.stringify(t)}`}yield Promise.all(A),__LOG__(2,void 0,void 0,void 0,["groups"])`finished all storageTasks`,P&&(0,y.handleGroupAction)(P,h,t)}))).apply(this,arguments)}},48537:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.joinGroupViaInviteV4=function(e,t,n,r){return(0,c.sendJoinGroupViaInviteV4)(e,t,n,r)},t.queryGroupInviteV4Info=function(){return d.apply(this,arguments)},t.revokeGroupInviteV4=function(e,t){return(0,c.sendRevokeGroupInviteV4)(e,t)};var i=r(n(48926)),a=n(69315),o=n(45454),s=n(69951),l=n(19380),c=n(64808);function d(){return(d=(0,i.default)((function*(e,t,r,i){let d=null;const u=n(63928).default.get(r);return u&&(d=yield(0,a.phashV1)(u.participants.map((e=>e.id)))),(0,c.sendQueryGroupInviteV4)(e,t,r,i,d).then((e=>{if(null!=e.status&&e.status>0)return e;if(null!=e.id)return l.ContactCollection.gadd(e.id),e;const t=n(63928).default.assertGet((0,o.createWidFromWidLike)(r)),i=s.ChatCollection.assertGet(t.id).contact.name;return{id:t.id,owner:t.owner,creation:t.creation,desc:t.desc,descId:t.descId,descOwner:t.descOwner,descTime:t.descTime,restrict:t.restrict,announce:t.announce,ephemeralDuration:t.ephemeralDuration,growthLockExpiration:t.growthLockExpiration,growthLockType:t.growthLockType,noFrequentlyForwarded:t.noFrequentlyForwarded,subject:i,participants:t.participants.map((e=>({id:e.id,isAdmin:e.isAdmin,isSuperAdmin:e.isSuperAdmin})))}}))}))).apply(this,arguments)}},96269:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.queryGroupFromPhone=function(){return u.apply(this,arguments)},t.queryGroupInviteInfo=function(){return p.apply(this,arguments)};var i=r(n(6479)),a=r(n(48926)),o=r(n(81629)),s=n(19380),l=r(n(14423)),c=n(10790);const d=["status","subject"];function u(){return(u=(0,a.default)((function*(e){const t=yield(0,c.groupMetadataFindFromPhone)(e);return"ok"===t.status?t.data:"missing"!==t.status?"error"===t.status?(__LOG__(3)`model:GroupMetadata:find error ${t.info}`,Promise.reject(new Error("model:GroupMetadata:find error"))):void 0:void(0,o.default)((()=>{n(69951).ChatCollection.assertGet(e).delete()}))}))).apply(this,arguments)}function p(){return(p=(0,a.default)((function*(e){const t=yield(0,c.sendQueryGroupInvite)(e),{status:r,subject:a}=t,o=(0,i.default)(t,d),u=new l.default(o);s.ContactCollection.gadd(u.id);const p=n(69951).ChatCollection.get(u.id);return{status:r,subject:a,groupMetadata:u,inGroup:!!p&&!p.isReadOnly}}))).apply(this,arguments)}},74028:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.createOrUpdateGroupMetadataModel=T,t.queryAndUpdateAllGroupMetadata=function(){return m.apply(this,arguments)},t.queryAndUpdateGroupMetadataById=function(e){if((0,a.isLegacyWebdBackend)())return Promise.resolve();return(0,g.queryGroupJob)(e).then(function(){var e=(0,i.default)((function*(e){yield(0,d.updateGroupParticipantTableWithoutDeviceSyncJob)([e]),T(e)}));return function(){return e.apply(this,arguments)}}())};var i=r(n(48926)),a=n(88555),o=n(40234),s=n(77345),l=n(69315),c=n(68638),d=n(57062),u=r(n(63928)),p=n(50313),f=n(5819),h=n(85057),_=n(10790),g=n(61051);function m(){return(m=(0,i.default)((function*(){if((0,a.isLegacyWebdBackend)())return Promise.resolve();const e=yield(0,h.queryAllGroups)();e&&(e.forEach((e=>{T(e),S(e)})),yield(0,d.updateGroupMetadataTableJob)(e),yield(0,d.updateGroupParticipantTableWithoutDeviceSyncJob)(e),yield y(e))}))).apply(this,arguments)}function y(){return E.apply(this,arguments)}function E(){return(E=(0,i.default)((function*(e){__LOG__(2,void 0,void 0,void 0,["GroupUpdateGroupEndOfHistorySyncFlag"])`Start updateGroupEndOfHistorySyncFlag`;const t=n(63183).ConversationEndOfHistoryTransferModelPropType,r=(0,p.getInitialGroupPhashMap)(),i=n(69951).ChatCollection,a=[];e.forEach((e=>{if(i.get(e.id.toString()))return;null==(null==r?void 0:r[e.id.toString()])&&a.push({unreadCount:0,muteExpiration:0,id:e.id,endOfHistoryTransferType:t.NOT_INCLUDED_IN_HIST_SYNC})})),i.add(a,{merge:!0}),yield(0,c.getTable)().bulkCreate(a.map((e=>{let{endOfHistoryTransferType:t,id:n}=e;return{endOfHistoryTransferType:t,id:n.toString(),unreadCount:0,muteExpiration:0}}))).catch((e=>{__LOG__(2,void 0,void 0,void 0,["GroupUpdateGroupEndOfHistorySyncFlag"])`One ore more chat create failed for group not synced in initial sync with error: ${e.message} `})),__LOG__(2,void 0,void 0,void 0,["GroupUpdateGroupEndOfHistorySyncFlag"])`Completed updateGroupEndOfHistorySyncFlag`}))).apply(this,arguments)}function S(){return v.apply(this,arguments)}function v(){return(v=(0,i.default)((function*(e){const t=(0,p.getInitialGroupPhash)(e.id.toString());if(null==t)return;const n=yield(0,l.phashV1)(e.participants.map((e=>e.id))),r=n.substring(2);null!=t&&t!==n&&t!==r&&(0,f.handleSingleMsgMD)(e.id,(0,s.genIntialPhashMismatchMsg)(e.id,o.Clock.globalUnixTime()))}))).apply(this,arguments)}function T(e){var t,n,r,i,a,o;(0,_.updateSubject)(e.id,e.subject),u.default.gadd({id:e.id,owner:e.owner,creation:e.creation,desc:e.desc,descId:e.descId,descOwner:e.descOwner,descTime:e.descTime,restrict:e.restrict||!1,announce:e.announce||!1,noFrequentlyForwarded:e.noFrequentlyForwarded||!1,ephemeralDuration:e.ephemeralDuration||0,growthLockExpiration:e.growthLockExpiration,growthLockType:e.growthLockType,participants:e.participants,support:null!==(t=e.support)&&void 0!==t&&t,unjoinedSubgroups:null!==(n=e.unjoinedSubgroups)&&void 0!==n?n:[],suspended:null!==(r=e.suspended)&&void 0!==r&&r,terminated:null!==(i=e.terminated)&&void 0!==i&&i,isParentGroup:null!==(a=e.isParentGroup)&&void 0!==a&&a,parentGroup:e.parentGroup,defaultSubgroup:null!==(o=e.defaultSubgroup)&&void 0!==o&&o})}},54248:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!(0,r.getMaybeMeUser)().equals(e.id)){const n=i.PresenceCollection.get(e.id);n&&("unsubscribe"===e.type?n.set({isSubscribed:!1,stale:!0}):(a(n,e),t&&n.set({stale:!1})))}return Promise.resolve()};var r=n(99234),i=n(68315);function a(e,t){let n,r=!1;if(void 0===t.type?t.type=e.chatstate.type||"unavailable":"paused"===t.type&&(r=!0,t.type="available"),e.isGroup&&"available"!==t.type&&(t.updateTime=Date.now()),e.isGroup){if(!t.participant)return;t.id=t.participant,t.participant=void 0,n=e.chatstates.gadd(t.id)}else n=e.chatstate;r&&"composing"!==n.type&&"recording"!==n.type||n.set(t),n.expireTimerId&&clearTimeout(n.expireTimerId),"composing"===n.type||"recording"===n.type?n.expireTimerId=setTimeout((()=>function(e){const t=e.type;"composing"!==t&&"recording"!==t||(e.type="available")}(n)),25e3):n.expireTimerId=void 0;const i=e.forceDisplay||e.isOnline||e.isUser&&!e.chatstate.deny;e.set({hasData:!0,isSubscribed:!0,forceDisplay:i})}},37638:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.changeProfilePicThumb=function(e,t){return r.ProfilePicThumbCollection.imageChanged(e,t),Promise.resolve()};var r=n(82039)},56018:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.queryServerProps=function(){return s||(s=(0,a.queryServerProps)().then((e=>{o.ServerProps.updateProps(e),__LOG__(2,void 0,void 0,void 0,["serverprops"])`--- Print ServerProps Start ---`,Object.keys(o.ServerProps.attributes).forEach((e=>{__LOG__(2,void 0,void 0,void 0,["serverprops"])`key: ${e}, value: ${o.ServerProps.attributes[e]}, type: ${typeof o.ServerProps.attributes[e]}`})),__LOG__(2,void 0,void 0,void 0,["serverprops"])`--- Print ServerProps End ---`})).catch((0,r.filteredCatch)(i.ServerStatusCodeError,(()=>{}))).catch((0,r.filteredCatch)(i.WebdDrop,(()=>{}))).finally((()=>{s=null})),s)};var r=n(50796),i=n(92574),a=n(4121),o=n(64551);let s},78027:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.processOrphanAck=function(){return g.apply(this,arguments)},t.updateMsgAck=h;var i=r(n(48926)),a=n(35470),o=n(88555),s=r(n(89867)),l=n(45454),c=n(25680),d=n(41796),u=n(39354),p=n(59871),f=r(n(83147));function h(){return _.apply(this,arguments)}function _(){return(_=(0,i.default)((function*(e,t,n){const{ack:r,t:i,from:c,to:p}=n,{remote:h,id:_}=e.id;if(e.updateAck(r,i),(0,o.isMDBackend)()){const{deliveryPrivacyMode:t}=n;r===a.ACK.RECEIVED&&null!=t&&e.isSentByMe&&(yield(0,u.handlePrivacyModeTransition)(h,t).catch((()=>{__LOG__(4,void 0,new Error,!0)`msg ack: handlePrivacyModeTransition failed`,SEND_LOGS("msg ack: handlePrivacyModeTransition failed")})),yield(0,f.default)(e,t))}const g=(0,d.getBridge)();if(yield g.sendAndReceive("msg_collection","updateLastReceipt",{wid:h,t:i}),s.default.isUser(h)){if(yield g.sendAndReceive("msg_info_collection","updateInfo",{id:_,from:c,to:p,ack:r,participant:h,t:i}),t&&s.default.isBroadcast(t)){const e=t instanceof s.default?t:(0,l.createWid)(t);yield g.sendAndReceive("msg_info_collection","updateInfo",{id:_,from:c,to:e,ack:r,participant:h,t:i})}}else s.default.isStatusV3(h)&&(yield g.sendAndReceive("msg_info_collection","updateInfo",{id:_,from:c,to:h,ack:r,participant:p,t:i}))}))).apply(this,arguments)}function g(){return(g=(0,i.default)((function*(e,t){const n=p.MsgCollection.get(e);if(!n)return Promise.reject(new Error(`processOrphanAck: no msg found for id ${e.toString()}`));try{const e=yield(0,c.getHighestAck)(n);if(!e||e.ack===n.ack)return;return h(n,t,e)}catch(e){__LOG__(4,void 0,new Error)`Assertion failed: processOrphanAck failed!`}}))).apply(this,arguments)}},8765:(e,t,n)=>{"use strict";var r=n(95318);t.o0=function(){return T.apply(this,arguments)};var i=r(n(48926)),a=r(n(81109)),o=n(92844),s=n(15461),l=r(n(89867)),c=n(84902),d=n(24808),u=n(99234),p=n(57701),f=n(49714),h=n(45033),_=n(76332),g=n(99069),m=n(93832),y=n(12896);function E(e){let t;const n=e.id.remote,r={externalId:e.id.id,ts:(0,o.castToUnixTime)(e.t),edit:-1,isHsm:!1,count:null,chat:n,pushname:null};var i;l.default.isGroup(n)?t=(0,a.default)((0,a.default)({},r),{},{type:f.MESSAGE_TYPE.GROUP,author:null!==(i=e.author)&&void 0!==i?i:(0,u.getMeUser)(),isDirect:!1}):t=(0,a.default)((0,a.default)({},r),{},{author:e.from,type:f.MESSAGE_TYPE.CHAT});return{msgInfo:t,e2eInfoType:h.CiphertextType.Msg,paymentInfo:null,bizInfo:{nativeFlowName:null,verifiedNameSerial:null,verifiedLevel:null,verifiedNameCert:null,privacyMode:null}}}function S(){return v.apply(this,arguments)}function v(){return(v=(0,i.default)((function*(e){try{const t=(0,y.hydrateMessage)(e),r=t.id.remote;if(!(0,p.receiveReactionsEnabled)())return null;if(!l.default.isGroup(r)&&!l.default.isUser(r))return __LOG__(4,void 0,new Error)`reparseReactionFutureProof: Reaction FutureProof msg.chat is an unexpected type`,null;const{msgInfo:i,e2eInfoType:a,paymentInfo:o,bizInfo:u}=E(t);if(null==t.futureproofBuffer)return null;const f=(0,m.unpad)(t.futureproofBuffer),h=(0,c.decodeProtobuf)(d.MessageSpec,f);if(null==h.reactionMessage)return __LOG__(3)`reparseReactionFutureProof: Reaction failed validation due to missing ReactionMessage in proto`,null;const _=n(27286).parseMessage,g=yield _(i,a,h,o,u,t.futureproofBuffer);if(null==g.renderableMsgs||null==g.renderableMsgs[0]||g.renderableMsgs[0].type!==s.MSG_TYPE.REACTION)return __LOG__(4,void 0,new Error)`reparseReactionFutureProof: unexpected renderableMsgs`,null;const S=n(53348).createReactionsRow;return yield S(g.renderableMsgs[0],i)}catch(e){return __LOG__(4,void 0,new Error)`reparseReactionFutureProof: reparse error`,null}}))).apply(this,arguments)}function T(){return(T=(0,i.default)((function*(e){try{let t=[];const r=e.filter((e=>e.type===s.MSG_TYPE.UNKNOWN&&e.subtype===s.MSG_TYPE.REACTION)),a=(yield Promise.all(r.map((e=>S(e))))).filter(Boolean);if(0===a.length)return;const o=a.map((e=>e.msgKey));yield(0,g.getStorage)().lock(["message","reactions"],function(){var e=(0,i.default)((function*(e){let[n,r]=e;t=yield(0,_.addOrUpdateReactionsDBBulk)(a),yield n.bulkRemove(o)}));return function(){return e.apply(this,arguments)}}()),t.forEach((e=>{(0,_.addOrUpdateReactionsModelCollection)(e,!1)})),o.forEach((e=>{const t=n(59871).MsgCollection.get(e);null==t||t.delete()}))}catch(e){__LOG__(4,void 0,new Error)`reparseReactionFutureProof: storeReactionsAndDeleteFP error`}}))).apply(this,arguments)}},39354:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handlePrivacyModeTransition=function(){return l.apply(this,arguments)};var i=r(n(48926)),a=n(93170),o=r(n(9762)),s=n(68708);function l(){return(l=(0,i.default)((function*(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!e.isUserNotPSA())return;let l=r;if(null==l){const t=n(9025).getExisting;l=yield t(e)}if(null==l)return;const c=l.contact;if(null!=c.privacyMode&&c.privacyMode.privacyModeTs>=t.privacyModeTs)return;const d={verifiedName:c.verifiedName,isVerifiedHigh:c.verifiedLevel===a.VERIFIED_LEVEL.HIGH,isBusiness:c.isBusiness,isEnterprise:c.isEnterprise,privacyMode:c.privacyMode},u={verifiedName:c.verifiedName,isVerifiedHigh:c.verifiedLevel===a.VERIFIED_LEVEL.HIGH,isBusiness:!0,isEnterprise:!0,privacyMode:t};c.set({isBusiness:!0,isEnterprise:!0,privacyMode:t}),yield Promise.all([i?null:(0,s.createOrUpdateVerifiedBusinessName)({id:c.id.user,isApi:!0,privacyMode:{actualActors:t.actualActors,hostStorage:t.hostStorage,privacyModeTs:t.privacyModeTs}},s.VerifiedBusinessNameUpdateType.Merge),(0,o.default)(c.id,d,u)])}))).apply(this,arguments)}},92144:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RangeContain=void 0,t.checkAndRemoveActiveMessageRanges=function(e,t){(0,i.getActiveMessageRanges)(e.remote.toString()).then((n=>{n.forEach((n=>{if([a.ActiveRangeAction.Archive,a.ActiveRangeAction.MarkChatAsRead].includes(n.action)&&s(n.actionValue.messageRange,{id:e,t})===o.DOES_NOT_CONTAIN)return(0,i.removeActiveMessageRange)(e.remote.toString(),n.action)}))}))},t.rangeContainsMessage=s;var r=n(8243),i=n(38342),a=n(69702);const o=n(76672).Mirrored(["DOES_NOT_CONTAIN","CONTAINS_BY_TIMESTAMP","CONTAINS_BY_ADDITIONAL"]);function s(e,t){if(null==e)return __LOG__(3)`syncd: missing message range from row.`,o.DOES_NOT_CONTAIN;const{messages:n,lastMessageTimestamp:i}=e;if(null!=t.t&&null!=i&&t.t<(0,r.numberOrThrowIfTooLarge)(i))return o.CONTAINS_BY_TIMESTAMP;const a=t.id;for(const{key:e}of n)if(null!=e&&null!=a&&e.id===a.id)return o.CONTAINS_BY_ADDITIONAL;return o.DOES_NOT_CONTAIN}t.RangeContain=o},35288:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ActiveRangeHandlerAction=void 0;const r=n(76672).Mirrored(["DropMessage","SkipUI"]);t.ActiveRangeHandlerAction=r},91525:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleForActiveMessageRange=T,t.handleOfflineForMessageRange=function(){return C.apply(this,arguments)};var i=r(n(48926)),a=n(381),o=n(15461),s=n(45454),l=n(84902),c=n(69702),d=n(38342),u=n(92144),p=r(n(73407)),f=(n(35288),function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=_(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(13332))),h=n(93824);function _(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(_=function(e){return e?n:t})(e)}const g=new Set,m=e=>e.reduce(((e,t)=>new Set([...Array.from(e),...Array.from(t)])),new Set);function y(){return E.apply(this,arguments)}function E(){return(E=(0,i.default)((function*(e,t,n){let r=null;switch(e.action){case c.ActiveRangeAction.Archive:return e.actionValue.archived?yield f.handleForArchive(e,n):yield f.handleForUnarchive(e,n),g;case c.ActiveRangeAction.MarkChatAsRead:return yield f.handleForMarkAsReadUnread(e,n,!!e.actionValue.read),g;case c.ActiveRangeAction.ClearChatDeleteStarredDeleteMedia:case c.ActiveRangeAction.ClearChatDeleteStarredKeepMedia:return r=f.handleForClearChat(e,n),r?new Set([r]):g;case c.ActiveRangeAction.ClearChatKeepStarredDeleteMedia:case c.ActiveRangeAction.ClearChatKeepStarredKeepMedia:return(yield S(t.id))?g:(r=f.handleForClearChat(e,n),r?new Set([r]):g);case c.ActiveRangeAction.DeleteChatDeleteMedia:case c.ActiveRangeAction.DeleteChatKeepMedia:return r=f.handleForDeleteChat(e,n),r?new Set([r]):g}return __LOG__(3)`handleMessageContainment called with unknwon message range action action: ${e.action}`,g}))).apply(this,arguments)}function S(){return v.apply(this,arguments)}function v(){return(v=(0,i.default)((function*(e){const t=(0,h.constructStarMsgKeyFromMsgKey)(e),n=yield p.default.getSyncAction(t);if(n){var r;return(null===(r=(0,l.decodeProtobuf)(a.SyncActionValueSpec,n.binarySyncAction).starAction)||void 0===r?void 0:r.starred)||!1}return!1}))).apply(this,arguments)}function T(){return b.apply(this,arguments)}function b(){return(b=(0,i.default)((function*(e,t){if(o.SYSTEM_MESSAGE_TYPES.includes(t.type))return g;const n=(yield(0,d.getActiveMessageRanges)(e.toString())).map((e=>[e,(0,u.rangeContainsMessage)(e.actionValue.messageRange,t)])),r=n.filter((e=>{let[,t]=e;return t===u.RangeContain.CONTAINS_BY_ADDITIONAL})).map((e=>{let[t]=e;return t}));r.forEach((e=>{e.remainingMessages--})),yield(0,d.bulkUpdateActiveMessageRanges)(r);const i=n.map((e=>{let[n,r]=e;return y(n,t,r)})),a=yield Promise.all(i);return m(a)}))).apply(this,arguments)}function C(){return(C=(0,i.default)((function*(e){const t=new Map;e.forEach((e=>{if(o.SYSTEM_MESSAGE_TYPES.includes(e.type))return;const n=t.get(e.id.remote.toString());(null==n||n.t<e.t)&&t.set(e.id.remote.toString(),e)})),yield Promise.all(Array.from(t.entries()).map((e=>{let[t,n]=e;return T((0,s.createWid)(t),n)})))}))).apply(this,arguments)}},13332:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleForArchive=function(){return u.apply(this,arguments)},t.handleForClearChat=function(e,t){switch(t){case s.RangeContain.CONTAINS_BY_TIMESTAMP:case s.RangeContain.CONTAINS_BY_ADDITIONAL:return l.ActiveRangeHandlerAction.DropMessage;case s.RangeContain.DOES_NOT_CONTAIN:}},t.handleForDeleteChat=function(e,t){switch(t){case s.RangeContain.CONTAINS_BY_TIMESTAMP:case s.RangeContain.CONTAINS_BY_ADDITIONAL:return l.ActiveRangeHandlerAction.DropMessage;case s.RangeContain.DOES_NOT_CONTAIN:}},t.handleForMarkAsReadUnread=function(){return f.apply(this,arguments)},t.handleForUnarchive=function(){return p.apply(this,arguments)};var i=r(n(48926)),a=n(45454),o=n(38342),s=n(92144),l=n(35288),c=n(57701),d=r(n(68132));function u(){return(u=(0,i.default)((function*(e,t){if(t===s.RangeContain.DOES_NOT_CONTAIN){const t=n(74362).default;(0,c.archiveV2Supported)()&&d.default.showArchiveV2||t.setArchive([{id:e.chatId,archive:!1}]),yield(0,o.removeActiveMessageRange)(e.chatId,e.action)}}))).apply(this,arguments)}function p(){return(p=(0,i.default)((function*(e,t){t!==s.RangeContain.DOES_NOT_CONTAIN&&0!==e.remainingMessages||(yield(0,o.removeActiveMessageRange)(e.chatId,e.action))}))).apply(this,arguments)}function f(){return(f=(0,i.default)((function*(e,t,r){if(t===s.RangeContain.DOES_NOT_CONTAIN)yield(0,o.removeActiveMessageRange)(e.chatId,e.action);else if(0===e.remainingMessages){const t=n(69951).ChatCollection.get((0,a.createWid)(e.chatId));if(t){const e=n(9609);r?e.markSeen(t):e.markUnseen(t)}yield(0,o.removeActiveMessageRange)(e.chatId,e.action)}}))).apply(this,arguments)}},5819:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleInitialSyncMsgs=function(e){const t={add:"last",isHistory:!0},r=Object.keys(e).map((n=>(0,_.getBridge)().sendAndReceive("msg_collection","processMultipleMessages",{chatId:(0,p.createWid)(n),msgObjs:e[n].msgs,meta:t,chatMsgsCollection:null})));return Promise.all([...r,(0,y.storeInitialSyncMessages)(e)]).then((()=>{const t=Array.prototype.concat(...Object.keys(e).map((t=>e[t].msgs.map((e=>e.id.toString())))));return(0,S.checkOrphanMutations)(t,Object.keys(e))})).then((()=>{if((0,h.parseWMIReaction)()){const t=Array.prototype.concat(...Object.keys(e).map((t=>e[t].reactionMessages)));return(0,n(53348).storeReactionMsgBulk)(t)}})).then((()=>{})).catch((0,a.filteredCatch)(l.LogoutDrop,(()=>{}))).catch((e=>{__LOG__(4,void 0,new Error,!0)`Error: ${e.name}, message: ${e.message}, stack: ${e.stack}`,SEND_LOGS("msg_handler for MD: error storing/processing multiple messages")}))},t.handleMsgsMD=function(e,t){const n=t.length;if(!n)return Promise.resolve();if(!(e instanceof u.default))return Promise.resolve();const r={add:"before",isHistory:!0};for(let e=0;e<n;e++){t[e].invis=!0}const i=(0,_.getBridge)();return i.fireAndForget("msg_collection","trigger",{name:"handle:msg_history",args:{count:t.length}}),(0,y.storeMessages)(t,e,!0).then((()=>{const n=t.map((e=>e.id.toString()));(0,S.checkOrphanMutations)(n,[e.toString()]),(0,h.receiveReactionsEnabled)()&&(0,C.checkUpdateForOrphanReactions)(n)})).then((()=>i.sendAndReceive("msg_collection","processMultipleMessages",{chatId:e,msgObjs:t,meta:r,chatMsgsCollection:null}))).catch((0,a.filteredCatch)(l.LogoutDrop,(()=>{}))).catch((t=>{__LOG__(4,void 0,new Error,!0)`Msgs count: ${n} Chat: ${String(e)} Error: ${t.name}, message: ${t.message}, stack: ${t.stack}`,SEND_LOGS("msg_handler for MD: error storing/processing multiple messages")}))},t.handleProgressiveHistorySyncMsgs=function(){return O.apply(this,arguments)},t.handleSingleMsgMD=function(){return M.apply(this,arguments)};var i=r(n(48926)),a=n(50796),o=n(13959),s=n(4352),l=n(92574),c=n(40234),d=n(15461),u=r(n(89867)),p=n(45454),f=n(35288),h=n(57701),_=n(41796),g=n(62415),m=n(91525),y=n(84886),E=n(63728),S=n(12600),v=n(49831),T=n(6684),b=n(90641),C=n(76332),A=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=P(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(47272));function P(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(P=function(e){return e?n:t})(e)}function M(){return(M=(0,i.default)((function*(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const p={add:"after",update:r,isHistory:!1},P=(0,_.getBridge)(),M=t.type===d.MSG_TYPE.PROTOCOL&&["sender_revoke","admin_revoke"].includes(t.subtype);let O=t;if(!M){const e=yield(0,v.applyOrphanRevoke)([O]);if(0===e.length)return;O=e[0]}const I=yield(0,m.handleForActiveMessageRange)(e,O);if(I.has(f.ActiveRangeHandlerAction.DropMessage))return;const w=I.has(f.ActiveRangeHandlerAction.SkipUI);try{u.default.isStatusV3(e)&&(yield P.sendAndReceive("status_v3_collection","handleUpdate",{rawMsg:O,checksum:null,isMsgUpdate:!1})),yield(0,s.promiseLoop)(function(){var t=(0,i.default)((function*(t,i,a){const s=(0,o.delayMs)(A.expBackoff(a,12e4,1e3,.1));try{if(r)yield(0,y.updateMessage)(O),__LOG__(2,void 0,void 0,void 0,["handleSingleMsgMD"])`placeholder populate successful`;else if(M){if(yield(0,y.processRevokeMsgs)([{revokeMsgKey:O.protocolMessageKey,newMsgKey:O.id,timestamp:O.t,subtype:O.subtype,sender:O.author}]),(0,h.receiveReactionsEnabled)()){const t=n(68819).getJobManager;yield t().waitUntilPersisted(T.jobSerializers.deleteReactions(e.toString(),[O.protocolMessageKey.toString()]))}}else try{yield(0,y.storeMessages)([O],e),O.type===d.MSG_TYPE.CIPHERTEXT&&(0,E.addPlaceHolderAction)(O)}catch(e){if(!(e instanceof y.DuplicateMessageError))throw e;O.type===d.MSG_TYPE.CIPHERTEXT?__LOG__(2)`processPlaceholderMsg: skip creating duplicate placeholder`:(__LOG__(2)`storeMessages loop: detect resend message`,yield(0,y.updateMessage)(O),p.update=!0)}if(O.type===d.MSG_TYPE.GROUPS_V4_INVITE){const e=O.id.toString();yield(0,g.persistGroupInviteV4Msg)(e,{id:e,from:O.from.toString(),to:O.to.toString(),groupId:O.inviteGrp,expiration:parseInt(O.inviteCodeExp,10),expired:c.Clock.globalUnixTime()>=parseInt(O.inviteCodeExp,10)})}__LOG__(2,void 0,void 0,void 0,["handleSingleMsgMD"])`storeMessages loop`,t()}catch(e){return __LOG__(2,void 0,void 0,void 0,["handleSingleMsgMD"])`storeMessages loop: failed with error ${e}.`,a>3?(__LOG__(3)`storeMessages loop: Gave up after ${a} tries`,Promise.reject(e)):s}}));return function(){return t.apply(this,arguments)}}()),__LOG__(2,void 0,void 0,void 0,["messaging"])`handleSingleMsgMD: msgId::${O.id.id}, write message to db done, overwrite: ${r}, skipUI: ${w}`;try{yield(0,S.checkOrphanMutations)([O.id.toString()],[e.toString()]),(0,h.receiveReactionsEnabled)()&&(yield(0,C.checkUpdateForOrphanReactions)([O.id.toString()]))}catch(t){__LOG__(4,void 0,new Error)`handleSingleMsgMD: checkOrphanMutations failed during handleSingleMsgMD for: ${String(O.id)} chat: ${String(e)} Error: ${t.name}, message: ${t.message}, stack: ${t.stack}`}w||(O.recvFresh=!0,O.isNewMsg=!0,yield P.sendAndReceive("msg_collection","processMultipleMessages",{chatId:e,msgObjs:[O],meta:p,chatMsgsCollection:null,preserveOrder:a}))}catch(t){if(t instanceof l.LogoutDrop)return;if(t instanceof b.PreviousMsgNotPlaceholderError)return __LOG__(2,void 0,void 0,!0)`Msg: ${String(O.id)} chat: ${String(e)} Error: PreviousMsgNotPlaceholderError`,void SEND_LOGS("msg_handler for MD: error storing/processing single message");__LOG__(4,void 0,new Error,!0,["messaging"])`Msg: ${String(O.id)} chat: ${String(e)} Error: ${t.name}, message: ${t.message}, stack: ${t.stack}`,SEND_LOGS("msg_handler for MD: error storing/processing single message")}}))).apply(this,arguments)}function O(){return(O=(0,i.default)((function*(e,t,r,i){return yield Promise.resolve(),(0,y.storeRecentAndFullHistSyncMessages)(e,t,!0,!0).then((()=>{const n=t.map((e=>e)),r=e.map((e=>e.id.toString()));return(0,S.checkOrphanMutations)(r,n)})).then((()=>{if((0,h.parseWMIReaction)()){return(0,n(53348).storeReactionMsgBulk)(r)}})).then((()=>{const e=(0,_.getBridge)(),t=n(69951).ChatCollection;i.forEach((n=>{if(!n||!n.id||!n.id.remote)return;const r=n.id.remote,i=t.get(r);i&&0===i.msgs.length&&!i.pendingInitialLoading&&e.fireAndForget("msg_collection","processMultipleMessages",{chatId:r,msgObjs:[n],meta:{add:"last",isHistory:!0},chatMsgsCollection:null})}))})).catch((0,a.filteredCatch)(l.LogoutDrop,(()=>{}))).catch((e=>{__LOG__(4,void 0,new Error,!0)`Error: ${e.name}, message: ${e.message}, stack: ${e.stack}`,SEND_LOGS("handleProgressiveHistorySyncMsgs: error storing/processing multiple messages")}))}))).apply(this,arguments)}},52821:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.updateMsgInfo=function(e,t,n,r){if((0,a.isLegacyWebdBackend)())return function(e,t,n,r){const a=e.id;if(!o.default.isUser(a.remote)){if(t!==i.ACK.RECEIVED){const t=e.delivery.get(n);t&&e.delivery.remove(t)}if(t!==i.ACK.READ){const t=e.read.get(n);t&&e.read.remove(t)}if(t!==i.ACK.PLAYED){const t=e.played.get(n);t&&e.played.remove(t)}}t===i.ACK.PLAYED?(e.played.get(n)||(e.playedRemaining-=1),e.played.add({id:n,t:r})):t===i.ACK.READ?(e.read.get(n)||(e.readRemaining-=1),e.read.add({id:n,t:r})):t===i.ACK.RECEIVED&&(e.delivery.get(n)||(e.deliveryRemaining-=1),e.delivery.add({id:n,t:r}))}((0,s.unproxy)(e),t,n,r);return function(e,t,n,r){const a=e.id;o.default.isUser(a.remote)?function(e,t,n,r){t===i.ACK.PLAYED?(e.played.get(n)||(e.playedRemaining-=1),e.played.add({id:n,t:r})):t===i.ACK.READ?(e.read.get(n)||(e.readRemaining-=1),e.read.add({id:n,t:r})):t===i.ACK.RECEIVED&&(e.delivery.get(n)||(e.deliveryRemaining-=1),e.delivery.add({id:n,t:r}))}(e,t,n,r):function(e,t,n,r){let a=i.ACK.CLOCK;e.played.get(n)?a=i.ACK.PLAYED:e.read.get(n)?a=i.ACK.READ:e.delivery.get(n)&&(a=i.ACK.RECEIVED);if(t<=a)return;if(t>i.ACK.RECEIVED){const t=e.delivery.get(n);t?e.delivery.remove(t):e.deliveryRemaining-=1}if(t>i.ACK.READ){const t=e.read.get(n);t?e.read.remove(t):e.readRemaining-=1}t===i.ACK.PLAYED?(e.played.get(n)||(e.playedRemaining-=1),e.played.add({id:n,t:r})):t===i.ACK.READ?(e.read.get(n)||(e.readRemaining-=1),e.read.add({id:n,t:r})):t===i.ACK.RECEIVED&&(e.delivery.get(n)||(e.deliveryRemaining-=1),e.delivery.add({id:n,t:r}))}(e,t,n,r)}((0,s.unproxy)(e),t,n,r)};var i=n(35470),a=n(88555),o=r(n(89867)),s=n(31019)},4280:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.cancelOrDeclinePaymentRequest=function(){return s.apply(this,arguments)},t.fulfillPaymentRequest=function(){return l.apply(this,arguments)};var i=r(n(48926)),a=n(90641),o=n(12896);function s(){return(s=(0,i.default)((function*(e){const t=n(59871).MsgCollection,r=new t.constructor.model(e),i=yield(0,a.processPaymentMessages)([r]);i&&i.forEach((n=>{const r=t.get(n.id);r?r.set((0,o.hydrateMessage)(n),{merge:!0}):n.id===e.id.toString()&&(e.type=n.type,e.templateParams=n.templateParams)}))}))).apply(this,arguments)}function l(){return(l=(0,i.default)((function*(e){const t=n(59871).MsgCollection,r=new t.constructor.model(e),i=yield(0,a.processPaymentMessages)([r]);i&&i.forEach((e=>{const n=t.get(e.id);n&&n.set((0,o.hydrateMessage)(e),{merge:!0})}))}))).apply(this,arguments)}},17780:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t._processMultipleMessages=function(){return C.apply(this,arguments)};var i=r(n(48926)),a=n(88555),o=n(40234),s=n(15461),l=r(n(89867)),c=r(n(47545)),d=n(71473),u=r(n(61516)),p=n(99234),f=r(n(46931)),h=n(7293),_=n(57701),g=n(32554),m=n(78986),y=n(58668),E=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=b(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(54676)),S=n(92671),v=n(91692),T=n(64551);function b(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(b=function(e){return e?n:t})(e)}function C(){return(C=(0,i.default)((function*(e,t,r,i){const{filteredRecs:b,reorderRecs:C,updates:P}=(0,f.default)(e,t,r,i);yield Promise.all(P);const M=n(69951).ChatCollection,O=n(50101).findChat,I=n(59871).MsgCollection;if(0===b.length&&0===C.length){if(e&&r.pendingMsgsDone){const t=M.get(e);t&&(t.pendingMsgs=!1)}return t.map((e=>I.get(e.id))).filter((e=>e))}if(!e)return A(b).then((()=>t.map((e=>I.get(e.id))).filter((e=>e&&!!e.chat))));let w;const R=t[0];if(l.default.isStatusV3(e)){const e=R.id.fromMe?(0,p.getMaybeMeUser)():R.author;w=n(59387).StatusV3Collection.find(e)}else w=O(e);const D=yield w,L=yield A(b),N="after"===r.add||"last"===r.add,k=!r.isHistory;let U,G,x=!1;if("unread"===r.add?(U=i,D.msgChunks.push(U),G=r.firstUnreadKey):"last"===r.add&&r.resume?(U=i,x=!0):U="function"==typeof i?i():i,(0,c.default)(t,L,C,D,N,U||D.msgs,G,x),r.pendingMsgsDone&&(D.pendingMsgs=!1),k&&l.default.isBroadcast(e)&&!l.default.isStatusV3(e)&&L.forEach((function(e){e&&e.recvFresh&&!e.isNotification&&E.broadcastFanout(e)})),h.GK.supportsFeature(h.GK.F.RECENT_EMOJI_SYNC))for(let e=0;e<L.length;e++){const t=L[e];if(t.isNewMsg&&t.isSentByMe&&t.containsEmoji){S.RecentEmojiCollection.throttledSync();break}}if((0,a.isMDBackend)()&&T.ServerProps.webServerStickerPanel){const e=L.map((e=>{if(!(e.isSentByMe&&e.type===s.MSG_TYPE.STICKER))return;const{mediaData:t,mediaObject:n}=e,r=e.id.toString(),i=null==n?void 0:n.entries.entries[0];return[{id:t.filehash,directPath:t.directPath,filehash:t.filehash,encFilehash:(null==i?void 0:i.encFilehash)||t.encFilehash,mediaKey:(null==i?void 0:i.mediaKey)||t.mediaKey,mediaKeyTimestamp:null!=t.mediaKeyTimestamp?t.mediaKeyTimestamp:o.Clock.globalUnixTime(),width:t.fullWidth,height:t.fullHeight,size:t.size,mimetype:t.mimetype,type:y.OUTWARD_TYPES.STICKER,index:0},e.t,r]})).filter(Boolean);n(49264).RecentStickerCollectionMd.enqueue(e)}if((0,_.isRecentStickersEnabled)()){const e=L.map((e=>{if(!(e.isNewMsg&&e.isSentByMe&&e.type===s.MSG_TYPE.STICKER))return;const{mediaData:t}=e;return{id:t.filehash,directPath:t.directPath,filehash:t.filehash,encFilehash:t.encFilehash,mediaKey:t.mediaKey,mediaKeyTimestamp:null!=t.mediaKeyTimestamp?t.mediaKeyTimestamp:o.Clock.globalUnixTime(),width:t.fullWidth,height:t.fullHeight,size:t.size,mimetype:t.mimetype,type:y.OUTWARD_TYPES.STICKER,index:0}})).filter(Boolean);v.RecentStickerCollection.enqueue(e)}if((0,_.webMediaAutoDownloadEnabled)()&&!l.default.isStatusV3(e)&&L.map((e=>e.asAutoDownloadableMedia)).filter(Boolean).forEach((e=>{d.AutoDownloadQueue.enqueue(e,d.AUTO_DOWNLOAD_TYPES.MEDIA)})),T.ServerProps.webDownloadDocumentThumbMmsEnabled&&L.map((e=>e.asDoc)).filter(Boolean).forEach((e=>{(0,_.webMediaAutoDownloadEnabled)()?d.AutoDownloadQueue.enqueue(e,d.AUTO_DOWNLOAD_TYPES.MMS_THUMBNAIL):(0,u.default)({msg:e,isPreload:!0})})),L.map((e=>e.asUrl)).filter(Boolean).forEach((e=>{(0,g.hqLinkPreviewExpired)(e.t)||((0,_.webMediaAutoDownloadEnabled)()?d.AutoDownloadQueue.enqueue(e,d.AUTO_DOWNLOAD_TYPES.MMS_THUMBNAIL):(0,u.default)({msg:e,isPreload:!0}))})),h.GK.supportsFeature(h.GK.F.DOWNLOAD_STATUS_THUMB_MMS)&&l.default.isStatusV3(e)){const e=(0,p.getLastStatusUsage)();(null==e||Date.now()-e<12096e5)&&L.map((e=>e.asImage||e.asVideo)).filter(Boolean).forEach((e=>{(0,_.webMediaAutoDownloadEnabled)()?d.AutoDownloadQueue.enqueue(e,d.AUTO_DOWNLOAD_TYPES.MMS_THUMBNAIL):(0,m.downloadStatusV3Thumbnail)({msg:e,isPreload:!0})}))}return t.map((e=>I.get(e.id))).filter((e=>e))}))).apply(this,arguments)}function A(){return P.apply(this,arguments)}function P(){return(P=(0,i.default)((function*(e){let t=n(59871).MsgCollection.add(e,{merge:!0});return(0,a.isMDBackend)()&&(t=t.filter(((t,n)=>(null==t&&(__LOG__(4,void 0,new Error,!0)`Get empty message with id ${e[n].id}.`,SEND_LOGS("msgPrepWork-empty-message")),null!=t)))),yield Promise.all(t.map((e=>e.waitForPrep().catch((e=>{__LOG__(4,void 0,new Error,!0)`Assertion failed! ${String(e)}`,SEND_LOGS("bad-msg-prep")}))))),t}))).apply(this,arguments)}},47545:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,i,a,o,s,l){const c=function(e,t,n,r,i){const a={},o={};let s,l,c,d=n.length,u=i;if(0===d)return{msgs:t,collection:u};for(s=0;s<d;s++)l=n[s],o[l.id]=l;for(d=t.length,s=0;s<d;s++)l=t[s],l&&(a[l.id]=l);const p=[];for(d=e.length,s=0;s<d;s++)if(l=e[s],l&&(c=a[l.id],c&&p.push(c),c=o[l.id],c))if(c.recvFresh)p.push(c),r.removeMsg(c),c.unset("recvFresh");else{const e=r.getAllCMCs().find((function(e){return e.get(c.id)}));i&&e===i||(e?(e.forEach((function(e){p.push(e),delete o[e.id]})),e===r.msgs?(r.replaceMsgsCollection(i),u=r.msgs):(r.notifyMsgCollectionMerge(i,e,i),r.removeMsgsCollection(e))):(__LOG__(3)`models:Msg:reorder trying to merge CMC of orphaned message ${l.id}`,p.push(o[l.id])))}return{msgs:p,collection:u}}(e,t,n,i,o);r.addRecordsToChat(c.msgs,i,a,c.collection,s,l)};var r=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=i(t);if(n&&n.has(e))return n.get(e);var r={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=a?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(r,o,s):r[o]=e[o]}r.default=e,n&&n.set(e,r);return r}(n(54676));function i(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(i=function(e){return e?n:t})(e)}},46931:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r,i){const w=[],D=[],L=[],N=n(69951).ChatCollection,k=n(59871).MsgCollection;return t.forEach((function(t){var U;t.id instanceof u.default||(__LOG__(4,void 0,new Error,!0)`_processMultipleMessages: el.id is not a MsgKey`,SEND_LOGS("forgot-to-create-msgkey"),t.id=new u.default({from:t.from,to:t.to,id:t.id,participant:t.participant,selfDir:t.self})),(0,s.isString)(e)&&f.default.isBroadcast(e)&&delete t.broadcast,"ptt"===t.type&&!t.id.fromMe&&t.ack<l.ACK.CLOCK&&(t.ack=l.ACK.CLOCK),null!=t.hydratedButtons&&((U=t).buttons=new M.TemplateButtonCollection,U.buttons.add(U.hydratedButtons.map(((e,t)=>{var n,r;const i=`${null!=e.index?e.index:t}`;return e.quickReplyButton?new P.default({id:i,displayText:e.quickReplyButton.displayText,selectionId:e.quickReplyButton.id,subtype:"quick_reply"}):e.callButton?new P.default({id:i,displayText:e.callButton.displayText,phoneNumber:e.callButton.phoneNumber,subtype:"call"}):new P.default({id:i,displayText:null===(n=e.urlButton)||void 0===n?void 0:n.displayText,url:null===(r=e.urlButton)||void 0===r?void 0:r.url,subtype:"url"})})))),null!=t.dynamicReplyButtons&&function(e){e.replyButtons=new _.ButtonCollection,e.replyButtons.add(e.dynamicReplyButtons.map((e=>{let{buttonId:t,buttonText:n}=e;return new h.default({id:t,displayText:null==n?void 0:n.displayText})})))}(t);let G=k.get(t.id);if(t.type===p.MSG_TYPE.PROTOCOL&&"ephemeral_setting"!==t.subtype)switch(t.subtype){case"admin_revoke":if(G=k.get(t.protocolMessageKey),G)if(G.isGroupMsg)if(f.default.equals(G.id.remote,t.id.remote)){__LOG__(2)`getMsgUpdates: admin revoked ${G.id.toString()}`;const e=new S.Msg(t);if((0,m.adminRevokeReceiverEnabled)()){const t=(0,o.default)(G.chat.groupMetadata,"m.chat.groupMetadata"),n=t.participants.get(e.sender);if(!n||!n.isAdmin){if(t.participants.add({id:e.sender,isAdmin:!0},{merge:!0}),!n){const t={action:y.GROUP_ACTIONS.ADD,participants:[e.sender]},n=(0,d.genGroupNotificationMsg)({author:void 0,chatId:G.chat.id,ts:e.t},t);(0,v.handleSingleMsgMD)(n.from,n)}(0,b.markGroupAsDirty)({group:G.chat.id})}}(0,A.revoke)(G,{msgKey:e.id,subtype:e.subtype,sender:e.sender})}else __LOG__(2)`getMsgUpdates: ${G.id.toString()} has not been revoked`,__LOG__(4,void 0,new Error)`getMsgUpdates: admin revoke came for the different group than the original message was in`;else __LOG__(2)`getMsgUpdates: ${G.id.toString()} has not been revoked`,__LOG__(4,void 0,new Error)`getMsgUpdates: admin revoke was sent to a non-group chat`;break;case"sender_revoke":if(G=k.get(t.protocolMessageKey),G){const r=new S.Msg(t);f.default.equals(G.sender,r.sender)?(__LOG__(2)`getMsgUpdates: sender revoked ${G.id.toString()}`,f.default.isStatusV3(e)&&G.msgChunk&&G.msgChunk.remove(G),(0,A.revoke)(G,{msgKey:r.id,subtype:r.subtype,sender:r.sender}),f.default.isStatusV3(e)&&n(59387).StatusV3Collection.find(G.sender).then((e=>{var t,n;if(g.GK.supportsFeature(g.GK.F.QUERY_STATUS_V_3_THUMBNAIL)&&(null===(t=G)||void 0===t||null===(n=t.msgChunk)||void 0===n?void 0:n.length)!==e.totalCount){if((0,c.isMDBackend)())throw new Error("Webd.statusQueryThumbnail is only supported in non-MD mode");I.default.statusQueryThumbnail(e.id)}}))):__LOG__(3)`getMsgUpdates: sender revoke: sender mismatch: ${r.id.toString()} <> ${G.id.toString()}`}break;case"ephemeral_sync_response":const r=N.get(t.id.remote);r&&(0,E.default)(r,t.ephemeralDuration,t.ephemeralSettingTimestamp);break;default:__LOG__(2)`unknown protocolMessage ${t.id.toString()}`}else if(G&&!G.asRevoked){t.ack<G.ack&&delete t.ack;for(const e in t)t.hasOwnProperty(e)&&void 0===t[e]&&delete t[e];t.id.fromMe&&!G.deprecatedMms3Url&&t.deprecatedMms3Url&&(t.phoneUploading=!1),r.isHistory&&(t.isNewMsg=!1);const e=G.t?(0,a.default)(t,["t","id","from","to"]):t,n=G.applyUpdate(e).then((()=>G));if(L.push(n),f.default.isBroadcast(G.id.remote)){const t=T.getBroadcastFanoutKeys(G);t&&t.forEach((t=>{const n=k.get(t);n&&L.push(n.applyUpdate(e).then((()=>G)))}))}r.isHistory&&(G.recvFresh||i)&&!G.search?(__LOG__(3)`model:Msg:handle:processMM:${G.recvFresh?"dup:":"overlap:"}${String(G.id)}`,D.push(G)):r.isHistory&&G.search?(G.search=!1,__LOG__(3)`model:Msg:handle:processMM load search as history ${String(G.id)}`,w.push({id:G.id})):"search"===r.add&&w.push({id:G.id})}else{"payment_action_request_declined"===t.subtype||"payment_transaction_request_cancelled"===t.subtype?L.push((0,C.cancelOrDeclinePaymentRequest)(t)):t.type===p.MSG_TYPE.PAYMENT&&"send"===t.subtype&&L.push((0,C.fulfillPaymentRequest)(t)),T.typeIsMms(t)&&!t.deprecatedMms3Url&&(t.phoneUploading=t.id.fromMe&&t.ack===l.ACK.CLOCK);const e=N.get(t.id.remote);"search"===r.add&&(t.search=!0),(0,O.isUnreadTypeMsg)(t)&&t.id.fromMe&&t.ack===l.ACK.CLOCK&&(t.isSendFailure=!0),r.update||w.push(t),!r.isHistory&&"search"!==r.add&&e&&L.push(function(){return R.apply(this,arguments)}(t,e)),t.ephemeralOutOfSync&&__LOG__(2)`ephemeralOutOfSync msgId=${t.id.toString()} chatId=${null==e?void 0:e.id.toString()}`}})),{filteredRecs:w,reorderRecs:D,updates:L}};var i=r(n(48926)),a=r(n(57557)),o=r(n(45095)),s=n(51737),l=n(35470),c=n(88555),d=n(77345),u=r(n(65212)),p=n(15461),f=r(n(89867)),h=r(n(15871)),_=n(47688),g=n(7293),m=n(57701),y=n(36098),E=r(n(26878)),S=n(17304),v=n(5819),T=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=w(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(54676)),b=n(51727),C=n(4280),A=n(81027),P=r(n(11897)),M=n(82988),O=n(12896),I=r(n(56891));function w(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(w=function(e){return e?n:t})(e)}function R(){return(R=(0,i.default)((function*(e,t){if(!e.isNewMsg||!e.recvFresh)return __LOG__(3,void 0,void 0,!0)`processLiveMessage should not be called with history message id ${e.id.toString()}`,SEND_LOGS("bad-process-live-message-call"),Promise.resolve();if(e.type===p.MSG_TYPE.GP2&&"delete"===e.subtype&&(t.isReadOnly=!0),t.isUser){var n;const a=null!==(n=e.ephemeralDuration)&&void 0!==n?n:0;let o,s=!1;e.type===p.MSG_TYPE.PROTOCOL&&"ephemeral_setting"===e.subtype?o=e.t:e.ephemeralSettingTimestamp&&(o=e.ephemeralSettingTimestamp,s=!0);let l=!1;if(null!=o&&(l=yield(0,E.default)(t,a,o,s)),(0,c.isMDBackend)()&&!T.isNotification(e.type,e.subtype)){var r,i;const n=null!==(r=e.ephemeralDuration)&&void 0!==r?r:0,a=null!==(i=t.getEphemeralSetting())&&void 0!==i?i:0;e.ephemeralOutOfSync=n!==a&&!l}}}))).apply(this,arguments)}},76332:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addOrUpdateReactions=function(){return A.apply(this,arguments)},t.addOrUpdateReactionsDB=T,t.addOrUpdateReactionsDBBulk=function(e){return(0,y.createOrUpdateReactions)(e)},t.addOrUpdateReactionsModelCollection=b,t.checkUpdateForOrphanReactions=function(){return B.apply(this,arguments)},t.deleteAllReactionsOfMsg=function(){return P.apply(this,arguments)},t.markReactionsAsRead=function(){return O.apply(this,arguments)},t.markReactionsAsReadByMessageKeys=function(){return k.apply(this,arguments)},t.resendUpdateFailedPropsForSentReactionsDBAndModel=function(){return I.apply(this,arguments)},t.updateFailedPropsForSentReactionsCollection=N,t.updateFailedPropsForSentReactionsDB=D,t.updateFailedPropsForSentReactionsDBAndModel=w,t.updateHasReactionFromParent=function(){return M.apply(this,arguments)};var i=r(n(6479)),a=r(n(48926)),o=r(n(91747)),s=n(35470),l=r(n(65212)),c=n(67811),d=n(48504),u=n(88102),p=n(1973),f=n(99234),h=n(46641),_=n(76214),g=n(29731),m=n(15665),y=n(63374),E=n(31464),S=n(35099);const v=["senderUserJid"];function T(e){return(0,y.createOrUpdateReactions)([e])}function b(){return C.apply(this,arguments)}function C(){return(C=(0,a.default)((function*(e,t){const{parentMsgKey:r}=e,i=t&&(0,h.shouldNotifyReaction)(e);let a;if(a=i?yield E.ReactionsCollection.find(r):E.ReactionsCollection.get(r),a){E.ReactionsCollection.addOrUpdateReaction(e);const t=a.reactions.length>0;yield(0,m.updateHasReactionInParent)(r,t)}else e.reactionText!==c.REVOKED_REACTION_TEXT&&(yield(0,m.updateHasReactionInParent)(r,!0));i&&u.Cmd.alertNewReactionMsg(e);const o=(0,c.isReactionByMe)(e.senderUserJid),s=l.default.fromString(r),p=s.fromMe;if((0,d.shouldUnarchiveChatOnReaction)(p,o,e.reactionText)){const e=n(69951).ChatCollection.get(s.remote.toString());e&&u.Cmd.archiveChat(e,!1,!1)}}))).apply(this,arguments)}function A(){return(A=(0,a.default)((function*(e,t){const[n]=yield T(e);n&&b(n,t)}))).apply(this,arguments)}function P(){return(P=(0,a.default)((function*(e){yield(0,y.deleteReactionsByParentMessageKey)(e.toString());E.ReactionsCollection.get(e)&&E.ReactionsCollection.deleteReactionsByParentMessageKey(e)}))).apply(this,arguments)}function M(){return(M=(0,a.default)((function*(e){const t=[],n=[];e.forEach((e=>{const r=e.parentMsgKey;e.reactionText!==c.REVOKED_REACTION_TEXT?n.push({id:r,hasReaction:!0}):t.push(e.parentMsgKey)}));const r=yield(0,y.getReactionsFromParentMsg)(t);return t.forEach((e=>{const t=r.get(e),i=t&&t.length>0||!1;n.push({id:e,hasReaction:i})})),(0,_.getMessageTable)().bulkCreateOrMerge(n)}))).apply(this,arguments)}function O(){return(O=(0,a.default)((function*(e){yield(0,S.sendReactionReadReceipts)(e),yield(0,y.markReactionRowsAsRead)(G(e)),E.ReactionsCollection.markReactionsAsRead(x(e))}))).apply(this,arguments)}function I(){return(I=(0,a.default)((function*(e){const{senderUserJid:t}=e,r=(0,i.default)(e,v),a=E.ReactionsCollection.getExistingSenderModelFromReactionDetails(r);if(null==a)return void __LOG__(4,void 0,new Error)`WAWebReactionsUtils:resendUpdateFailedPropsForSentReactionsDBAndModel Reactions model not found for this message id`;const l=(0,f.getMaybeMeUser)(),c=e.parentMsgKey.remote,d=a.timestamp,u=(0,o.default)({id:e.msgKey,reactionParentKey:e.parentMsgKey,type:"reaction",t:Math.floor(d/1e3),from:l,to:c,self:"out",local:!0,ack:s.ACK.CLOCK,reactionText:e.reactionText,reactionTimestamp:d}),{Msg:h}=n(17304),_=new h(u),m={ack:s.ACK.CLOCK,isSendFailure:!1};yield w(e,m.ack,m.isSendFailure);const{sendMsgRecord:y}=n(19708);return new g.NonPersistJob("sendMessage",(()=>y(_)),{priority:p.JOB_PRIORITY.UI_ACTION}).waitUntilCompleted()}))).apply(this,arguments)}function w(){return R.apply(this,arguments)}function R(){return(R=(0,a.default)((function*(e,t,n){yield D(e,t,n),N(e,t,n)}))).apply(this,arguments)}function D(){return L.apply(this,arguments)}function L(){return(L=(0,a.default)((function*(e,t,n){const r=G([e])[0];yield(0,y.updateFailedPropsForSentReactions)({reaction:r,ack:t,isSendFailure:n})}))).apply(this,arguments)}function N(e,t,n){const r=x([e])[0];E.ReactionsCollection.updateFailedPropsForExistingSentReaction(r,t,n)}function k(){return(k=(0,a.default)((function*(e){const t=yield(0,y.markReactionsAsReadByMessageKeysInStore)(e);t&&E.ReactionsCollection.markReactionsAsRead(U(t))}))).apply(this,arguments)}function U(e){return e.map((e=>{let{parentMsgKey:t,msgKey:n,reactionText:r}=e;return{parentMsgKey:l.default.fromString(t),msgKey:l.default.fromString(n),reactionText:r}}))}function G(e){return e.map((e=>{let{parentMsgKey:t,senderUserJid:n}=e;return{parentMsgKey:t.toString(),senderUserJid:n}}))}function x(e){return e.map((e=>{let{parentMsgKey:t,msgKey:n,reactionText:r}=e;return{parentMsgKey:t,msgKey:n,reactionText:r}}))}function B(){return(B=(0,a.default)((function*(e){try{(yield(0,y.changeOrphanStateReactions)(e)).forEach((e=>{E.ReactionsCollection.get(e.parentMsgKey)&&E.ReactionsCollection.addOrUpdateReaction(e)}))}catch(e){__LOG__(3)`checkUpdateForOrphanReactions: error ${e}`}}))).apply(this,arguments)}},81027:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.revoke=D,t.sendRevoke=function(e,t,r){return function(e,t,r){if(t===p.Revoke.Sender&&!e.id.fromMe)return Promise.reject(new Error("revoking received message"));let a;(0,o.isMDBackend)()&&e.id.remote.isGroup()&&(a=(0,h.getMeUser)());const c=new s.default({id:s.default.newId(),remote:e.id.remote,fromMe:!0,participant:a}),d=function(e){switch(e){case p.Revoke.Sender:return"sender_revoke";case p.Revoke.Admin:return"admin_revoke"}}(t),u=Math.trunc(Date.now()/1e3),g={id:c,to:e.id.remote,t:u,type:l.MSG_TYPE.PROTOCOL,subtype:d,protocolMessageKey:e.id,clearMedia:!!r,local:!0,revokeDuration:u-e.t},m=new T.Msg(g);(0,o.isMDBackend)()&&(m.wamMessageSendPerfReporter=new S.MessageSendPerfReporter(m.to,m.getWamMediaType(),m.getWamMessageType()),m.wamMessageSendPerfReporter.setIsRevokeMessage(!0));return new C.NonPersistJob("sendMessage",(0,i.default)((function*(){try{var t,r;null===(t=m.wamMessageSendPerfReporter)||void 0===t||t.startSavedStage(),yield(0,E.storeMessages)([g],e.chat.id),null===(r=m.wamMessageSendPerfReporter)||void 0===r||r.postSavedStage()}catch(e){throw __LOG__(4,!0,new Error,!0)`_sendRevoke: failed to storeMessages into storage`,SEND_LOGS("storeMessages failed"),e}return(yield(0,M.sendMsgRecord)(m))===O.SendMsgResult.OK?(new v.default.SendRevokeMessage({messageType:e.getWamMessageType(),messageMediaType:e.getWamMediaType(),revokeSendDelay:m.revokeDuration}).commit(),(0,E.processRevokeMsgs)([{revokeMsgKey:e.id,newMsgKey:c,timestamp:e.t,subtype:d,sender:(0,h.getMeUser)()}]).then((0,i.default)((function*(){if((0,_.receiveReactionsEnabled)()){const t=n(68819).getJobManager;yield t().waitUntilPersisted(A.jobSerializers.deleteReactions(e.chat.id.toString(),[e.id.toString()]))}return D(e,{msgKey:c,subtype:d,sender:(0,h.getMeUser)()}),O.SendMsgResult.OK})))):Promise.resolve(O.SendMsgResult.ERROR_UNKNOWN)})),{priority:f.JOB_PRIORITY.UI_ACTION}).waitUntilCompleted()}((0,I.unproxy)(e),t,r)};var i=r(n(48926)),a=r(n(4788)),o=n(88555),s=r(n(65212)),l=n(15461),c=r(n(89867)),d=n(48285),u=r(n(69048)),p=n(88102),f=n(1973),h=n(99234),_=n(57701),g=n(11902),m=n(41566),y=R(n(78986)),E=n(84886),S=n(30097),v=r(n(11339)),T=n(17304),b=R(n(54676)),C=n(29731),A=n(6684),P=n(4136),M=n(19708),O=n(13705),I=n(31019);function w(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(w=function(e){return e?n:t})(e)}function R(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=w(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}return r.default=e,n&&n.set(e,r),r}function D(e,t){return function(e,t){var r;const i="admin_revoke"===t.subtype;if(i&&!(0,_.adminRevokeReceiverEnabled)())return void __LOG__(2)`revoke: admin revoke feature is disabled, ${e.id.toString()} has not been revoked`;if(i||(0,m.isSenderRevokeWindowReceiverEnabled)()){if(!(Math.trunc(Date.now()/1e3)-e.t<=P.REVOKE_WINDOW_V2+P.REVOKE_WINDOW_V2_RECEIVER_MARGIN))return void __LOG__(2)`revoke: outside of revoke window, ${e.id.toString()} has not been revoked`}n(16770).LabelCollection.removeAllLabelsMD(e),b.typeIsMms(e)&&y.deregisterMsg(e);e.chat&&e.chat.removeFromCollection(e);e.trigger("revoked");const s=e.getCollection(),p=e.id;e.msgChunk&&e.msgChunk.replaceId(p,t.msgKey);s.replaceId(p,t.msgKey);const f=null===(r=e.chat)||void 0===r?void 0:r.isUnreadMsg(e),h={id:t.msgKey,type:l.MSG_TYPE.REVOKED,subtype:"admin_revoke"===t.subtype?"admin":"sender",revokeSender:t.sender,body:void 0,caption:void 0,clientUrl:void 0,deprecatedMms3Url:void 0,loc:void 0,lat:void 0,lng:void 0,isLive:void 0,accuracy:void 0,speed:void 0,degrees:void 0,comment:void 0,sequence:void 0,shareDuration:void 0,finalLat:void 0,finalLng:void 0,finalAccuracy:void 0,finalThumbnail:void 0,finalSpeed:void 0,finalDegrees:void 0,finalTimeOffset:void 0,title:void 0,description:void 0,canonicalUrl:void 0,matchedText:void 0,thumbnail:void 0,richPreviewType:void 0,doNotPlayInline:void 0,quotedMsg:void 0,quotedStanzaID:void 0,quotedRemoteJid:void 0,quotedParticipant:void 0,mediaData:void 0,mentionedJidList:void 0,vcardList:void 0,star:!1};e.set(h),e.trigger("change:msgKey",{newKey:t.msgKey,oldKey:p}),e.chat&&(e.chat.updateMediasCountOnMsg(e,!0),p.equals(e.chat.lastReceivedKey)&&(0,g.setLastReceivedKey)(e.chat.id,t.msgKey).then((()=>{e.chat.lastReceivedKey=t.msgKey})),e.chat.composeQuotedMsg===e&&(e.chat.composeQuotedMsg=null),(0,m.isSenderRevokeUiEnabled)()&&f&&(e.chat.unreadCount=Math.max(e.chat.unreadCount-1,0),(0,d.reduceChatUnreadCount)(e.chat.id.toString())));e.isLive&&n(85865).LiveLocationCollection.removeMsg(e);if(c.default.isBroadcast(p.remote)){const r=b.getBroadcastFanoutKeys(p),i=b.getBroadcastFanoutKeys(t.msgKey);if(!r||!i||r.length!==i.length)return void __LOG__(2)`cannot fanout revoke: ${String(r)} ${String(i)}`;if((0,a.default)(r,i).forEach((e=>{const n=s.get(e[0]);n&&D(n,{msgKey:e[1],subtype:t.subtype,sender:t.sender})})),(0,o.isLegacyWebdBackend)())return;if(u.default.purge([String(e.rowId)]),(0,_.receiveReactionsEnabled)()){const t=n(68819).getJobManager,r=e.chat?e.chat.id.toString():e.id.remote.toString();t().fireAndForget(A.jobSerializers.deleteReactions(r.toString(),[p.toString()]))}}}((0,I.unproxy)(e),t)}},4136:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.REVOKE_WINDOW_V2_RECEIVER_MARGIN=t.REVOKE_WINDOW_V2=t.REVOKE_WINDOW=void 0;t.REVOKE_WINDOW=4096;t.REVOKE_WINDOW_V2=216e3;t.REVOKE_WINDOW_V2_RECEIVER_MARGIN=43200},40256:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.revokeAllStatusPSA=function(){const e=o.StatusV3Collection.getPSAStatus();if(!e)return Promise.resolve();const t=e.msgs.map((e=>e.id.toString()));return s(e,t)},t.revokeStatusPSA=function(e){const t=o.StatusV3Collection.getPSAStatus();if(!t)return Promise.resolve();const n=t.msgs.filter((t=>t.campaignId===e)).map((e=>e.id.toString()));return s(t,n)};var i=r(n(48926)),a=n(84886),o=n(59387);function s(){return l.apply(this,arguments)}function l(){return(l=(0,i.default)((function*(e,t){t.length>0&&(e.revokeMsgs(t),yield(0,a.removeMessagesFromHistory)(t),__LOG__(2,void 0,void 0,void 0,["revoke-status-psa"])`revokeStatusPSA completed`)}))).apply(this,arguments)}},92188:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendKeyDistributionMsg=function(){return c.apply(this,arguments)};var i=r(n(48926)),a=r(n(65212)),o=n(45454),s=n(99234),l=r(n(63928));function c(){return(c=(0,i.default)((function*(e){if(!e.isGroup)return Promise.reject(new Error("[messaging] sendKeyDistributionMsg: only group chats are supported`"));const t=e.id,r=(0,s.getMaybeMeUser)(),i=new a.default({from:r,to:t,id:a.default.newId(),participant:(0,o.toUserWid)(r),selfDir:"out"});yield l.default.find(e.id);const{encryptAndSendKeyDistributionMsg:c}=n(95547);return c(i)}))).apply(this,arguments)}},19708:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendMsgRecord=function(e){return(0,o.promiseCallSync)((()=>{const t=e.id,r=n(50101).findChat;let o;r(t.remote).then((e=>{e.isTrusted()||(0,M.sendNotSpam)(e).catch((()=>{}))})),_.default.isBroadcast(e.to)&&(o=(0,T.broadcastFanout)(e)),e.isNewMsg=!0;const w=e.type===f.MSG_TYPE.PROTOCOL&&["sender_revoke","admin_revoke"].includes(e.subtype),R=e.type===f.MSG_TYPE.REACTION&&e.reactionText===h.REVOKED_REACTION_TEXT;if(!e.isGroupMsg&&!w&&!R&&g.BlocklistCollection.get(e.to))return Promise.reject(new m.default("Contact is blocked",y.ContactCollection.assertGet(e.to)));let D;w||R||(D=new v.default.WebcMessageSend({messageType:e.getWamMessageType(),messageMediaType:e.getWamMediaType(),messageIsForward:Boolean(e.isForwarded)}));const L=n(59871).MsgCollection;return r(e.id.remote).then((t=>((0,O.sendSeen)(t),e.type===f.MSG_TYPE.REACTION||w||L.trigger(u.default.NEW_MSG_SENT),(0,s.promiseProps)({reply:(0,A.sendMsgRecord)(e),chat:t})))).then((n=>{var a;let{reply:s,chat:c}=n;const d=t.remote,u=(0,E.getMaybeMeUser)(),h=t.fromMe&&_.default.equals(t.remote,u)?3:s.data?s.data.ack:1;if(e.updateAck(h,s.t),e.type===f.MSG_TYPE.REACTION){const t={parentMsgKey:e.reactionParentKey,msgKey:e.id,reactionText:e.reactionText,senderUserJid:e.from.toString()},{senderUserJid:n}=t,r=(0,i.default)(t,I);C.ReactionsCollection.shouldUpdateAck(r,h)&&(0,b.updateFailedPropsForSentReactionsDBAndModel)(t,h)}return D&&(D.markMessageSendT(),D.commit()),null===(a=e.wamMessageSendPerfReporter)||void 0===a||a.postWrittenWireStage(),[f.MSG_TYPE.PROTOCOL,f.MSG_TYPE.REACTION].includes(e.type)||(0,S.setLastReceivedKey)(c.id,t).then((()=>{c.lastReceivedKey=t})),L.updateLastReceipt(d,s.t),_.default.isBroadcast(d)&&(o?o.forEach((e=>{const n=new p.default({from:u,to:e,id:t.id}),i=L.get(n);i&&(i.ack=l.ACK.SENT,L.updateLastReceipt(e,i.t),null==i.ephemeralStartTimestamp&&i.updateEphemeralStartTimestamp(i.t),r(e).then((e=>{(0,S.setLastReceivedKey)(e.id,n).then((()=>{e.lastReceivedKey=n}))})))})):__LOG__(2)`model:msg:createRecord bclist server ack, no recipients`),P.SendMsgResult.OK})).catch((0,a.filteredCatch)(c.ServerStatusCodeError,(t=>{if(408!==t.status&&(__LOG__(4,void 0,new Error,!0)`Phone responded ${t.status}`,SEND_LOGS("send-not-200")),(0,d.isMDBackend)()){const t=(0,A.createMessageSendMetric)(e);t.messageSendResultIsTerminal=!1,t.messageSendResult=v.default.MESSAGE_SEND_RESULT_TYPE.ERROR_NETWORK,t.commit()}return P.SendMsgResult.ERROR_NETWORK}))).catch((t=>{if(__LOG__(3)`model:msg:createRecord dropped msg: ${e.id.toString()}`,__LOG__(4,void 0,new Error,!0)`Got error ${String(t)}`,SEND_LOGS("send-msg-error"),(0,d.isMDBackend)()){const t=(0,A.createMessageSendMetric)(e);t.messageSendResultIsTerminal=!0,t.messageSendResult=v.default.MESSAGE_SEND_RESULT_TYPE.ERROR_UNKNOWN,t.commit()}return P.SendMsgResult.ERROR_UNKNOWN}))})).finally((()=>{e.sendDeferred&&e.sendDeferred.resolve(),e.wamMessageSendPerfReporter=null}))};var i=r(n(6479)),a=n(50796),o=n(18412),s=n(67602),l=n(35470),c=n(92574),d=n(88555),u=r(n(64369)),p=r(n(65212)),f=n(15461),h=n(67811),_=r(n(89867)),g=n(32826),m=r(n(96563)),y=n(19380),E=n(99234),S=n(11902),v=r(n(11339)),T=n(54676),b=n(76332),C=n(31464),A=n(90298),P=n(13705),M=n(19569),O=n(9609);const I=["senderUserJid"]},13705:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SendMsgResult=void 0;const r=n(76672).Mirrored(["OK","ERROR_NETWORK","ERROR_EXPIRED","ERROR_CANCELLED","ERROR_UPLOAD","ERROR_UNKNOWN"]);t.SendMsgResult=r},83147:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return c.apply(this,arguments)};var i=r(n(48926)),a=n(8197),o=r(n(89867)),s=n(90981),l=n(21224);function c(){return(c=(0,i.default)((function*(e,t){if(!o.default.isUser(e.id.remote))return;const n=e.privacyModeWhenSent;if(null!=n&&n.privacyModeTs>t.privacyModeTs)return;const r=(0,a.getReducedPrivacyMode)(t);if(r===(0,a.getReducedPrivacyMode)(n))return;if(null!=e.bizPrivacyStatus)return void __LOG__(3)`msg.bizPrivacyStatus exist already, we can not assign a new value anymore`;const i=d(r);e.bizPrivacyStatus=i,yield(0,s.getTable)().merge(e.id.toString(),{bizPrivacyStatus:i})}))).apply(this,arguments)}function d(e){switch(e){case a.ReducedPrivacyMode.E2EE:return l.WebMessageInfoBizPrivacyStatus.E2EE;case a.ReducedPrivacyMode.BSP:return l.WebMessageInfoBizPrivacyStatus.BSP;case a.ReducedPrivacyMode.FB:return l.WebMessageInfoBizPrivacyStatus.FB}}},14810:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.syncPrivacyDisallowedLists=s,t.syncSinglePrivacyDisallowedList=function(){return c.apply(this,arguments)};var i=r(n(48926)),a=n(61319),o=n(25338);function s(){return l.apply(this,arguments)}function l(){return(l=(0,i.default)((function*(e){const t=yield Promise.all(e.map(function(){var e=(0,i.default)((function*(e){return{type:e,response:yield(0,o.queryPrivacyDisallowedList)(e)}}));return function(){return e.apply(this,arguments)}}())),n=[];return t.forEach((e=>{const{status:t,users:r,dhash:i}=e.response;"mismatch"===t&&null!=r&&null!=i&&n.push({id:e.type,disallowedList:r.map((e=>e.toString())),dhash:i})})),yield(0,a.getTable)().bulkCreateOrReplace(n),n}))).apply(this,arguments)}function c(){return(c=(0,i.default)((function*(e){yield s([e])}))).apply(this,arguments)}},92052:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.setArchiveClassicSetting=function(e){if((0,l.isLegacyWebdBackend)())return m(e);return __LOG__(4,void 0,new Error)`Settings:setArchiveClassicSetting is not supported on MD Companion device.`,Promise.resolve()},t.setArchiveEnabledSetting=function(e){if((0,l.isLegacyWebdBackend)())return __LOG__(2)`Settings:setArchiveEnabledSetting value to ${e}`,void(h.default.archive.enabled!==e&&(h.default.archive=(0,a.default)((0,a.default)({},h.default.archive),{},{enabled:e})));__LOG__(4,void 0,new Error)`Settings:setArchiveEnabledSetting is not supported on MD Companion device.`};var i=r(n(48926)),a=r(n(81109)),o=n(50796),s=n(92574),l=n(88555),c=n(48360),d=n(46331),u=n(88102),p=r(n(14296)),f=r(n(11339)),h=r(n(68132)),_=r(n(56891)),g=n(85893);function m(){return y.apply(this,arguments)}function y(){return(y=(0,i.default)((function*(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,d.genId)();__LOG__(2)`Settings:setArchiveClassicSetting value to ${e}`;const n=_.default.setArchiveSetting(e).then((e=>{if(e.status&&200!==e.status)throw new s.ServerStatusCodeError(e.status)})),r=new d.ActionType(c.fbt._("Changing archive setting",null,{hk:"4s5LmI"})),i=Boolean(h.default.archive.classic),l=n.then((()=>{__LOG__(2)`Settings:setArchiveClassicSetting:success value sucessfully set to ${e}`;const n=e?c.fbt._("Archived chats will unarchive when you receive a new message.",null,{hk:"2VniT0"}):c.fbt._("Archived chats will remain archived when you receive a new message.",null,{hk:"4C3WnP"});return new d.ActionType(n,{actionText:p.default.t(133),actionHandler:()=>m(i,t)})})).catch((0,o.filteredCatch)(s.ServerStatusCodeError,(e=>{if(__LOG__(3)`models:settings:setArchiveClassicSetting failed with server error`,e.status>=400)return new d.ActionType(c.fbt._("Couldn't change archive setting.",null,{hk:"qovF4"}))}))).catch((()=>{throw __LOG__(3)`models:settings:setArchiveClassicSetting dropped`,new d.ActionType(c.fbt._("Couldn't change archive setting.",null,{hk:"qovF4"}),{actionText:p.default.t(129),actionHandler:()=>m(e,t)})}));u.Cmd.openToast((0,g.jsx)(d.ActionToast,{id:t,initialAction:r,pendingAction:l})),yield n,h.default.archive.classic!==e&&(new f.default.ArchiveSettings({keepChatsArchived:e}).commit(),h.default.archive=(0,a.default)((0,a.default)({},h.default.archive),{},{classic:e}))}))).apply(this,arguments)}},77905:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.fetchFirstPartyStickers=function(){return f.apply(this,arguments)};var i=r(n(48926)),a=r(n(76139)),o=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=u(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(35232)),s=r(n(26847)),l=r(n(14296)),c=r(n(11339)),d=r(n(53565));function u(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(u=function(e){return e?n:t})(e)}const p="https://static.whatsapp.net/sticker";function f(){return(f=(0,i.default)((function*(e,t){const n={cat:"sticker_pack_data",id:e,lg:l.default.getLocale()},r=a.default.build(p,n),i=yield(0,s.default)(r,{signal:null==t?void 0:t.signal}),u=new c.default.StickerCommonQueryToStaticServer;if(u.set({httpResponseCode:i.status,params:new d.default(n).toString(),queryType:c.default.QUERY_TYPE.STICKER_PACK_DATA}),u.commit(),!i.ok)throw new o.InvalidServerResponseError(r,i.status.toString(),"Invalid response from WhatsApp stickers endpoint");const f=yield i.json();if(null==f||0===f.length)throw new o.InvalidServerResponseError(r,i.status.toString(),`Invalid response from WhatsApp stickers endpoint: ${JSON.stringify(f)}`);return f[0].stickers.map(((e,t)=>({mimetype:e.mimetype,width:e.width,height:e.height,index:t,filehash:e["file-hash"],directPath:e["direct-path"],mediaKey:e["media-key"],id:e["file-hash"],deprecatedMms3Url:e.url,encFilehash:e["enc-file-hash"],mediaKeyTimestamp:0})))}))).apply(this,arguments)}},76046:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleIncomingCallOffer=function(e,t){if(o.CallCollection.processIncomingCall(e.call_id,e.peer_jid,{isVideo:e.isVideoCall,canHandleLocally:e.isVideoCall?(0,u.isVideoCallEnabled)():(0,u.isVoiceCallEnabled)(),offerTime:e.t}),!function(e){return e?(0,u.isVideoCallEnabled)():(0,u.isVoiceCallEnabled)()}(e.isVideoCall))return void d.Voip.handleIncomingSignalingMessage(e,t);const n=e.call_id;o.CallCollection.pendingOffers[n]=new a.Resolvable,o.CallCollection.pendingOffers[n].resolve(Promise.all([(0,c.default)(e,t),d.Voip.getNumParticipantsFromCallOffer(t)]).then((r=>{let[{result:i,retryCount:a},l]=r,c=!0;switch(l>0&&(__LOG__(4,void 0,new Error)`voip:incoming: Ignoring call offer since group calling is disabled`,c=!1),c=e.isVideoCall?c&&(0,u.isVideoCallEnabled)():c&&(0,u.isVoiceCallEnabled)(),i){case s.E2EProcessResult.SUCCESS:!function(e,t,n){const r=e.call_id;o.CallCollection.processIncomingCall(r,e.peer_jid,{isVideo:e.isVideoCall,canHandleLocally:null!=n&&n,offerTime:e.t}),!1===n&&o.CallCollection.cleanupPendingOffer(r);d.Voip.handleIncomingSignalingMessage(e,t)}(e,t,c);break;case s.E2EProcessResult.RETRY:__LOG__(2)`voip:handleIncomingCallOffer reject call because of enc retry`,function(){f.apply(this,arguments)}(e,a);break;case s.E2EProcessResult.PARSE_ERROR:__LOG__(2)`voip:handleIncomingCallOffer ending call because of enc parse error`,d.Voip.endCall(n);break;default:throw new Error("invalid e2e result type")}})).finally((()=>{delete o.CallCollection.pendingOffers[n]})))},t.handleIncomingEncRekey=function(e,t){d.Voip.handleIncomingSignalingMessage(e,t)},t.handleIncomingSignalingMsg=function(e,t){d.Voip.handleIncomingSignalingMessage(e,t)};var i=r(n(48926)),a=n(88156),o=n(60868),s=n(49714),l=n(11849),c=r(n(84590)),d=n(84356),u=n(69594),p=n(45473);function f(){return(f=(0,i.default)((function*(e){var t,n;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const i=yield l.waSignalStore.getRegistrationInfo();if(!i)throw Error("No registration info found");const{registrationId:a}=i,o=r+1;d.Voip.rejectCallWithoutCallCtx(e.call_id,null===(t=e.peer_jid)||void 0===t?void 0:t.toString({legacy:!0}),null===(n=e.call_creator)||void 0===n?void 0:n.toString({legacy:!0}),p.ENC_RETRY_RECEIPT_ATTRS.SINGLE_PARTICIPANT,o,a),5===o&&(__LOG__(2)`voip:rejectCallWithReasonEnc max retry reached, uploading fieldstats`,d.Voip.processMissedIncomingCallMaxRetry(e))}))).apply(this,arguments)}},42285:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,s,l){if(__LOG__(2)`voip:handleIncomingCallOfferNotice: callId ${t}`,r.Clock.globalUnixTime()-n>45)return void __LOG__(2)`voip:handleIncomingCallOfferNotice: Ignoring stale offer_notice`;a.CallCollection.add({id:t,isVideo:s,isGroup:l,offerTime:n,canHandleLocally:!1,peerJid:e},{merge:!0}),o.Cmd.alertCall((0,i.toUserWid)(e),t,s,l,!1),setTimeout((()=>{o.Cmd.cancelCall(e);const n=a.CallCollection.get(t);n&&a.CallCollection.remove(n)}),45e3)};var r=n(40234),i=n(45454),a=n(60868),o=n(88102)},56981:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.prepareRetryReceipt=function(e){return(0,r.prepareRetryReceiptBridge)(e)},t.queryCall=function(e,t){return(0,r.sendQueryCallBridge)(e,t)},t.sendCallEnd=function(e,t){return(0,r.sendCallEndBridge)(e,t)},t.sendCallOffer=function(e){return(0,r.sendCallOfferBridge)(e)},t.sendCallSignalingMsg=function(e,t){return(0,r.sendCallSignalingMsgBridge)(e,t)},t.sendEncRekey=function(e){return(0,r.sendEncRekeyBridge)(e)};var r=n(70308)},54003:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.logoutAfterValidationFail=function(){new a.ShiftTimer((()=>{m()})).onOrAfter(1e3)},t.resetCompanionReg=function(){h=!1,_=!1},t.startInitialHistorySyncTimeout=function(){if(null==E){E=setTimeout(g,18e4);(new o.default).listenTo(l.Cmd,"on_initial_chat_synced",(()=>{clearTimeout(E)}))}},t.startLogin=function(){if(h||_)return;(0,c.setDeviceLinkPairStage)(p.default.MD_LINK_DEVICE_COMPANION_STAGE.FIRST_CONNECT),h=!0,(0,s.clearADVSecretKey)(),(0,d.setIsConnectedAsRegistered)(!0),l.Cmd.restartBackend()},t.startLogout=m,t.triggerCriticalSyncLogout=g;var i=r(n(48926)),a=n(57319),o=r(n(76521)),s=n(46308),l=n(88102),c=n(91214),d=n(9530),u=n(83578),p=r(n(11339)),f=n(65044);let h=!1,_=!1;function g(){__LOG__(4,void 0,new Error)`logout due to no critical data`,f.Socket.logout(!1,u.LogoutReason.CriticalSyncTimeout)}function m(){return y.apply(this,arguments)}function y(){return(y=(0,i.default)((function*(){h||_||(_=!0,yield f.Socket.clearCredentialsAndStoredData(),(0,s.clearADVSecretKey)(),l.Cmd.restartBackend())}))).apply(this,arguments)}let E},52771:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.startBackend=X;var i=r(n(48926)),a=n(72651),o=n(38284),s=n(54602),l=r(n(95023)),c=n(55062),d=n(93714),u=n(57849),p=n(72126),f=n(89981),h=n(68268),_=n(16116),g=n(98972),m=r(n(69048)),y=n(88102),E=n(24747),S=n(92059),v=n(93771),T=n(12669),b=n(91214),C=n(99234),A=n(7293),P=r(n(18438)),M=n(36163),O=n(37726),I=n(68819),w=n(83578),R=n(46582),D=r(n(11339)),L=n(76214),N=n(58052),k=n(85417),U=n(67087),G=n(47587),x=n(34771),B=n(48694),F=n(56018),j=n(29100),Y=n(64551),K=n(11849),W=n(66837),H=n(38804),V=n(42862),$=n(70768),z=n(31452),q=n(46669),J=(n(52622),n(77959)),Q=n(65044);function X(){return Z.apply(this,arguments)}function Z(){return(Z=(0,i.default)((function*(){if(!K.waSignalStore.getRegistrationInfo())return void __LOG__(2)`startBackendRegistered: chatd user not registered`;__LOG__(2)`[startBackend]: connected as ${(0,C.assertGetMe)()}`;try{yield(0,o.promiseTimeout)(Promise.all([(0,L.initialize)()]),2e4),yield(0,o.promiseTimeout)((0,k.initialize)(),2e4)}catch(e){y.Cmd.storageInitializationError()}(0,p.isABPropsAfterFirstSync)()&&(yield(0,u.updateABPropsFromStorage)());const e=yield(0,v.getTable)().count(),t=yield K.waSignalStore.getServerHasPreKeys(),n=(0,c.getCommsConfig)({passive:e>0||!t});yield ie(),yield(0,E.startComms)(P.default,j.sendPing,n,(e=>Promise.resolve((0,a.inflate)(e))),(()=>{}),(()=>{})),yield(0,E.waitForConnection)();{const n=[];e>0&&n.push((0,g.sendAndClearDanglingReceipts)()),t||((0,b.setDeviceLinkPairStage)(D.default.MD_LINK_DEVICE_COMPANION_STAGE.UPLOAD_PREKEYS),n.push((0,q.uploadPreKeys)().catch((e=>{__LOG__(4,!0,new Error,!0)`error while uploading prekeys, ${e}`,SEND_LOGS("error while uploading prekeys"),(0,b.commitDeviceLinkEvent)(-1)})))),yield Promise.all(n),(0,b.setDeviceLinkPairStage)(D.default.MD_LINK_DEVICE_COMPANION_STAGE.COMPLETE),(0,b.commitDeviceLinkEvent)(),yield(0,G.sendPassiveIq)(!1)}x.PrimaryFeatures.initializeFromLocalStorage(),(0,p.isABPropsAfterFirstSync)()||(yield(0,f.syncABPropsTask)()),yield te(),ee(),yield(0,H.initialize)(),B.PrimaryForceUpgrade.setup(),yield(0,_.initChatThreadLogging)(),yield(0,I.startWebPersistedJobManager)(),yield(0,E.startHandlingRequests)();const r=!l.default.isCriticalDataSynced();r?yield l.default.syncCriticalData():__LOG__(2)`[bootstrap] need to sync critical data: false`,yield T.DbEncKeyStore.waitForFinalDbMsgEncKey(),null==Y.ServerProps.serverPropsVersion&&(yield(0,F.queryServerProps)()),(0,d.compareServerPropsAndABProps)(),re(),$.TosManager.run(),(0,O.startQPL)(),(0,U.upgradeToCommunity)(r)}))).apply(this,arguments)}function ee(){var e;const t=null===(e=(0,C.getMaybeMeUser)())||void 0===e?void 0:e.user;t&&J.Wam.set(D.default.METRICS.getGlobal("psCountryCode"),(0,S.getCountryShortcodeByPhone)(t))}function te(){return ne.apply(this,arguments)}function ne(){return(ne=(0,i.default)((function*(){(0,u.getABPropConfigValue)("web_wam_v5_enabled")&&(yield J.Wam.upgradeWamRuntime())}))).apply(this,arguments)}function re(){(0,z.applyContactBusinessProps)(),(0,M.restoreLabels)(),(0,M.restoreQuickReplies)(),(0,M.restoreLabelAssociations)(),(0,M.restoreCarts)(),(0,M.restoreArchiveV2Settings)(),(0,M.restoreAgents)()}function ie(){return ae.apply(this,arguments)}function ae(){return(ae=(0,i.default)((function*(){const e=n(99234),t=n(56891).default,{loadProtoVersions:r}=n(77113),i=e.getVersion(),a=(null==i?void 0:i.protoVersion)||[0,17];yield r(),A.GK.setVersion(a),t.setVersion(a,10,"EAEYASACKAEwAjgBQAFIAVgBYAFoAXgBmAEBoAEBqAEBsAECuAEBwAEByAEB0AEA2AEB4AEC8AED+AEDgAIDkAIDmAIAqAIDsAIAuAIDwAIB"),Y.ServerProps.updateSelectiveProps({groupDescLength:512,multicastLimitGlobal:5,frequentlyForwardedMax:5,stickers:1,mdBlocklistV2:1})}))).apply(this,arguments)}y.Cmd.on("main_stream_mode_ready",(()=>{try{l.default.continueProgressiveHistorySyncProcessing(),m.default.startIndexer(),(0,R.requireStatusV3Collection)().then((e=>{e.sync()})),(0,V.registerTasks)(),(0,W.runSyncDirtyContactsJob)(),(0,M.restoreRecentStickers)(),(0,M.restoreFavoriteStickers)(),(0,h.scheduleAdvDeviceInfoCheck)()}catch(e){__LOG__(2)`debug setup failed:`}})),y.Cmd.on("md_restart_backend",(()=>{(0,E.stopComms)(),X()})),y.Cmd.on("storage_initialization_error",(0,i.default)((function*(){((0,N.isRegistered)()||(0,s.getPrevLogoutReasonCode)()!==w.LOGOUT_REASON_CODE.CLIENT_FATAL)&&(__LOG__(2)`storage initialization error, logging out`,yield Q.Socket.clearCredentialsAndStoredData(w.LogoutReason.ClientFatalError),y.Cmd.logout())}))),A.GK.on(A.FEATURE_CHANGE_EVENT,(()=>{(0,M.updateGKFeatures)()}))},95023:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(48926)),a=r(n(81109)),o=n(13959),s=n(92844),l=n(54003),c=r(n(79264)),d=n(41075),u=n(10823),p=n(88102),f=n(45606),h=n(10058),_=r(n(73407)),g=n(12669),m=r(n(52991)),y=n(40126),E=n(41037),S=n(83578),v=n(88432),T=r(n(11339)),b=n(58052),C=n(24872),A=n(74028),P=n(38804),M=n(89751),O=n(15772),I=n(65044);const w=n(76672).Mirrored(["NotStarted","InProcess","Completed"]),R={initialChatHistory:!1,readReceipts:!1,syncdCritical:!1},D={initialChatHistoryTotalMsg:-1,initialChatHistoryTotalChats:-1};const L=new class{constructor(){this._criticalState={},this._debugOnlyState={},this._progressiveHistorySyncRemainingIteration=25,this._progressiveHistorySyncInFlight=!1,this._allCriticalDataSynced=!1,this._syncDCriticalDataTimeout=null,this.initState()}initState(){this._criticalState=(0,a.default)({},R),this._debugOnlyState=(0,a.default)({},D),this._syncDCritcalDataState=w.NotStarted}_isCriticalSyncDoneThisSession(){for(const e in this._criticalState)if(!this._criticalState[e])return!1;return!0}_setSynced(e){__LOG__(2)`[bootstrap] completed sync for ${e}`,this._criticalState[e]=!0,this._isCriticalSyncDoneThisSession()&&(__LOG__(2)`[bootstrap] critical sync done`,(0,b.setAllCriticalDataSynced)(),p.Cmd.criticalSyncDone(),m.default.initOrUpdateTracking(T.default.WEBC_SCENARIO_TYPE.INITIAL_PAIRING),this.syncNonCriticalData())}_syncContactsInChunks(e,t){return(0,i.default)((function*(){__LOG__(2,void 0,void 0,void 0,["contact-sync"])`start contact sync for ${e?t.length+1:0} chunks of contacts during the inital sync`,null!=e&&(yield(0,h.syncContactListJob)(Array.from(e),!1));for(let e=0;e<t.length;e++){const n=Array.from(t[e]);yield(0,o.delayMs)(2e4),yield(0,h.syncContactListJob)(n)}__LOG__(2,void 0,void 0,void 0,["contact-sync"])`inital contact sync completes`}))()}_syncDeviceList(e){if(null==e)return __LOG__(2,void 0,void 0,void 0,["contact-sync"])`syncMostRecentDevices has no contact to sync during bootstrap`,Promise.resolve();__LOG__(2,void 0,void 0,void 0,["contact-sync"])`sync ${e.size} contacts for device info during the initial sync`;const t=Array.from(e);return(0,u.syncDeviceListJob)(t,null,null).catch((e=>{__LOG__(4,!0,new Error,!0)`Sync device failed`,SEND_LOGS("Sync device failed: "+e)}))}setReadReceiptsSynced(){this._setSynced("readReceipts")}setInitialChatHistorySynced(){this._setSynced("initialChatHistory")}setSyncDCriticalSynced(){this._syncDCritcalDataState=w.Completed,this._criticalState.syncdCritical||this._setSynced("syncdCritical")}syncNonCriticalData(){let e=[];(0,A.queryAndUpdateAllGroupMetadata)().then((()=>{e=(0,C.getAllContactsFromChatCollectionIntoChunks)(),this._syncDeviceList(e[0]),(0,C.getAndUpdateNonAddressBookContacts)()})).then((()=>{setTimeout(function(){this._syncContactsInChunks(e[0],e.slice(1,e.length))}.bind(this),4e4)})),(0,y.getAndUpdateStatus)(),(0,d.getAndUpdateProfilePicture)(),(0,d.updateBlocklist)(),(0,P.markCollectionsForSync)([f.CollectionName.Regular,f.CollectionName.RegularLow,f.CollectionName.RegularHigh])}markInitialHistorySyncCountDebugStats(e,t){this._debugOnlyState={initialChatHistoryTotalMsg:e,initialChatHistoryTotalChats:t}}isSyncDCriticalDataSyncInProcess(){return this._syncDCritcalDataState===w.InProcess}_initCriticalDataTimeoutIfNeeded(){var e=this;null==this._syncDCriticalDataTimeout&&(__LOG__(2)`[bootstrap] setting critical data syncd timeout (${180})`,this._syncDCriticalDataTimeout=setTimeout((0,i.default)((function*(){(yield e._isSyncDCriticalDataComplete())||(__LOG__(2)`[bootstrap] syncd critical data timeout exceeded, logging out`,yield(0,O.forceFlushAllWamBuffers)(),(0,l.triggerCriticalSyncLogout)()),(0,b.getInitialHistorySyncComplete)()||(__LOG__(2)`[bootstrap] history sync critical data timeout exceeded, logging out`,yield(0,O.forceFlushAllWamBuffers)(),(0,l.triggerCriticalSyncLogout)()),__LOG__(2)`[bootstrap] all critical data synced within timeout period`})),18e4))}_isSyncDCriticalDataComplete(){return(0,i.default)((function*(){const e=yield _.default.getSyncActionsRows(["action"],[f.Actions.SettingPushName]);return e.length>0&&null!=e.find((e=>e.actionState===f.SyncActionState.Success))}))()}setSyncDCriticalDataSyncCompleted(){var e=this;return(0,i.default)((function*(){null!=e._syncDCriticalDataTimeout&&(yield new T.default.MdBootstrapDataApplied({mdBootstrapPayloadType:T.default.MD_BOOTSTRAP_PAYLOAD_TYPE.CRITICAL,mdBootstrapSource:T.default.MD_BOOTSTRAP_SOURCE.APP_STATE,mdSessionId:yield v.MdSyncFieldStatsMeta.getMdSessionId(),mdTimestamp:(0,s.unixTimeMs)()}).commit(!0))}))()}getCriticialSyncDebugSummary(){return this.isCriticalDataSynced()?"-------\nAll critical data synced\n-------\n\n":`-------\n Initial history sync complete: ${(0,b.getHistorySyncStatus)()?"true":this._criticalState.initialChatHistory.toString()}\n Initial msgs: ${this._debugOnlyState.initialChatHistoryTotalMsg}, initial chats: ${this._debugOnlyState.initialChatHistoryTotalChats}\n Receipt sync complete: ${this._criticalState.readReceipts.toString()} \n Critical collection sync complete: ${this._criticalState.syncdCritical.toString()} \n-------\n`}isCriticalDataSynced(){return this._allCriticalDataSynced=this._allCriticalDataSynced||(0,b.getAllCriticalDataSynced)(),this._allCriticalDataSynced}syncCriticalData(){var e=this;return(0,i.default)((function*(){m.default.initOrUpdateTracking(T.default.WEBC_SCENARIO_TYPE.INITIAL_PAIRING),__LOG__(2)`[bootstrap] need to sync critical data: true`,__LOG__(2)`[bootstrap] ${e.getCriticialSyncDebugSummary()}`,__LOG__(2)`[bootstrap] syncing my device list`;const t=(0,u.syncMyDeviceListJob)(),n=(0,d.updatePrivacySettings)().then((()=>{e.setReadReceiptsSynced()})).catch((e=>{__LOG__(4,!0,new Error,!0)`failed to sync privacy settings ${e.stack}`,SEND_LOGS("failed to update privacy settings from privacy request to webd"),I.Socket.logout(!1,S.LogoutReason.AccountSyncError)}));(0,M.updateSyncdDisabledDueToFatalFlag)(!1),e._initCriticalDataTimeoutIfNeeded(),e._syncDCritcalDataState=w.InProcess;const r=t.then((()=>(0,P.markCollectionsForSync)([f.CollectionName.CriticalBlock,f.CollectionName.CriticalUnblockLow]))).then((0,i.default)((function*(){e._criticalState.syncdCritical||(yield e._isSyncDCriticalDataComplete())&&(e.setSyncDCriticalSynced(),yield e.setSyncDCriticalDataSyncCompleted())})));(0,b.getInitialHistorySyncComplete)()&&e.setInitialChatHistorySynced();const a=(0,d.updateDefaultDisappearingMode)().catch((e=>{__LOG__(4,!0,new Error,!0)`failed to sync default disappearing mode ${e.stack}`,SEND_LOGS("failed initial sync of default disappearing mode")}));yield Promise.all([n,r,a])}))()}continueProgressiveHistorySyncProcessing(){__LOG__(2)`[history sync] continueProgressiveHistorySyncProcessing`;const e="Safari"!==c.default.info().name;this._initNextProgressiveHistorySyncRunLoop(e)}_progressiveHistorySyncRun(){var e=this;return(0,i.default)((function*(){if(!e._allCriticalDataSynced&&!0!==e._criticalState.initialChatHistory)return __LOG__(2)`[history sync] Skip processLoop, until initial sync is complete`,void e._progressiveHistorySyncRemainingIteration++;if(!p.Cmd.isMainStreamReadyMd)return __LOG__(2,void 0,void 0,void 0,["History sync"])`Skip processLoop, until main is loaded`,void e._progressiveHistorySyncRemainingIteration++;const t=yield(0,E.fetchNextHitorySyncChunkForProcessing)();if(!t)return;__LOG__(2)`[history sync] processLoop picked up chunk`,e._progressiveHistorySyncRemainingIteration++;const r=n(19655).handleHistorySyncChunk;yield r(t)}))()}_initNextProgressiveHistorySyncRunLoop(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(0,i.default)((function*(){if(t&&e._progressiveHistorySyncRemainingIteration++,!e._progressiveHistorySyncInFlight&&e._progressiveHistorySyncRemainingIteration>0){e._progressiveHistorySyncRemainingIteration--,e._progressiveHistorySyncInFlight=!0;try{yield g.DbEncKeyStore.waitForFinalDbMsgEncKey(),yield e._progressiveHistorySyncRun()}catch(e){__LOG__(4,void 0,new Error)`[History sync] _progressiveHistorySyncRun failed with ${null==e?void 0:e.message}, stack: ${null==e?void 0:e.stack}`}e._progressiveHistorySyncInFlight=!1,yield new Promise((e=>setTimeout(e,2e4))),e._initNextProgressiveHistorySyncRunLoop()}}))()}};p.Cmd.on("on_initial_chat_synced",(()=>{L.setInitialChatHistorySynced()})),p.Cmd.on("logout",(()=>{L.initState()}));var N=L;t.default=N},55062:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getCommsConfig=function(e){const t=e||{passive:!1};return{openChatSocket:e=>(0,o.default)(t).then((n=>(e(),t.passive=!1,n))),healthCheckInterval:15,deadSocketTime:2e4,maxSocketLoopWaitTime:9e5,shouldCloseStaleSocket:!0,shouldBlockReceivingUntilSuccess:!0,handlers:{onConnect:()=>{(0,a.isRegistered)()&&(i.Cmd.setSocketState(l.SOCKET_STATE.CONNECTED),i.Cmd.openSocketStream())},onDisconnect:()=>{i.Cmd.socketStreamDisconnected()},onSocketOpen:()=>{i.Cmd.setSocketState(l.SOCKET_STATE.PAIRING)},onSocketLoopIteration:()=>{i.Cmd.setSocketState(l.SOCKET_STATE.OPENING)},onConnectionChange:()=>{},onOptimisticConnectionChange:()=>{},onCastStanza:()=>{},onHandleAck:e=>{(0,s.default)(e)},onHandleStanza:()=>{},onSendIq:()=>{}}}};var i=n(88102),a=(n(41796),n(58052)),o=r(n(85726)),s=r(n(23368)),l=n(62583);n(85893)},18438:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return B.apply(this,arguments)};var i=r(n(48926)),a=n(44396),o=n(31914),s=n(45823),l=n(40126),c=n(96429),d=r(n(2634)),u=r(n(83558)),p=r(n(69277)),f=n(27514),h=r(n(81367)),_=r(n(58626)),g=r(n(71419)),m=r(n(64054)),y=n(92419),E=n(46462),S=r(n(86741)),v=r(n(70605)),T=r(n(70569)),b=r(n(17234)),C=r(n(50404)),A=r(n(58645)),P=r(n(27258)),M=r(n(65347)),O=r(n(46007)),I=r(n(26445)),w=r(n(2276)),R=r(n(54341)),D=n(79711),L=n(56545),N=n(25773),k=r(n(87183)),U=r(n(95681)),G=n(28237);function x(e,t,n){const{attrs:r}=e;if(r.offline){const e=parseInt(r.t,10);G.OfflineMessageHandler.newOfflineStanza(e,n)}switch(e.tag){case"iq":return function(e){const{attrs:t,content:n}=e;if("urn:xmpp:ping"===t.xmlns)return(0,o.wap)("iq",{type:"result",to:t.from});if("md"!==t.xmlns)throw new Error(`handleIq unrecognized ${e.toString()}`);if(!Array.isArray(n)||!n.length)return;switch(n[0].tag){case"pair-device":return(0,C.default)(e);case"pair-success":return(0,A.default)(e)}}(e);case"receipt":return"retry"===r.type?(0,D.handleMessageRetryRequest)(e):"enc_rekey_retry"===r.type?(0,g.default)(e):(0,b.default)(e);case"notification":switch(r.type){case"server_sync":return(0,N.handleServerSyncNotification)(e);case"w:gp2":return(0,y.handleGroupNotification)(e);case"picture":return(0,w.default)(e);case"business":return(0,c.handleBusinessNotification)(e);case"contacts":return(0,p.default)(e);case"devices":return(0,f.handleDevicesNotification)(e);case"disappearing_mode":return(0,_.default)(e);case"mediaretry":return(0,v.default)(e);case"encrypt":{const n=e.content;if(!Array.isArray(n)||!n.length)break;switch(n[0].tag){case"count":return(0,M.default)(e,t);case"identity":return(0,E.handleE2eIdentityChange)(e);case"digest":return(0,h.default)(e)}break}case"server":return(0,L.handleServerNotification)(e);case"status":return(0,s.handleAboutNotification)(e);case"account_sync":return(0,l.handleAccountSyncNotification)(e);case"pay":return(0,P.default)(e);case"psa":return(0,R.default)(e);case"privacy_token":return(0,I.default)(e)}if(__LOG__(3)`Comms.handleStanza unrecognized notification stanza ${e.toString()}`,r.hasOwnProperty("id"))return(0,o.wap)("ack",{id:r.id,class:"notification",from:r.to||o.DROP_ATTR,to:r.from||o.DROP_ATTR,type:r.type||o.DROP_ATTR,participant:r.participant||o.DROP_ATTR});break;case"chatstate":return(0,u.default)(e);case"presence":return(0,O.default)(e);case"message":return(0,T.default)(e);case"ib":return(0,S.default)(e);case"stream:error":return(0,k.default)(e);case"failure":return(0,m.default)(e);case"success":return(0,U.default)(e);case"call":return(0,d.default)(e);case"error":return(0,a.handleError)(e)}__LOG__(3)`Comms.handleStanza unrecognized stanza ${e.toString()}`}function B(){return(B=(0,i.default)((function*(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const r=yield Promise.resolve(x(e,t,n));return null==r?"NO_ACK":r}))).apply(this,arguments)}},24747:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.cancelDeadSocketTimer=function(){A&&A.deadSocketTimer.cancel()},t.castStanza=function(e){const t=L("castStanza");t.socket?t.castStanza(e):__LOG__(2)`Comms has no open socket`},t.closeSocket=function(){const e=L("closeSocket").socket;e&&(__LOG__(2)`closeSocket called`,e.close())},t.getComms=function(){return A},t.onStreamErrorReceived=function(){L("onStreamErrorReceived").socketLoop.cancelReset()},t.openSocketLoop=P,t.resetStateForTests=function(){A=null,T=new p.Resolvable,b=1},t.sendIq=function(e,t){return w(e,t,!1)},t.sendIqErrorParser=function(e,t,n){return w(e,t,!1,n)},t.sendIqIfConnectedWithin=function(e,t,n){const r=L("sendIq"),i=e.attrs.id;if(!i||"string"!=typeof i)throw new Error(`Comms:sendIq given iq without id: ${String(e)}`);return new Promise(((t,a)=>{const o=setTimeout((()=>{const e=r.pendingIqs.get(i);if(!e)throw new Error(`Unexisting stanza to be cancelled ${i}`);r.removeHandler(e),a(new g.Offline)}),1e3*n),s={type:"iq",resolve:t,stanza:e,attachedToSocketId:0,orderedId:b++,timeoutId:o};r.pendingIqs.set(i,s),r.socket?r.sendPendingIq(s):__LOG__(2)`Comms has no open socket, will resend iq when socket opens`})).then((e=>(0,d.parseIqResponse)(e,t)))},t.sendIqWithoutRetry=function(e,t){return w(e,t,!0)},t.sendPing=function(){return D.apply(this,arguments)},t.sendSmaxIq=function(e,t){return w(e,t,!1)},t.sendStanzaAndReturnAck=I,t.sendStanzaAndWaitForAck=function(){return O.apply(this,arguments)},t.singletonOrThrowIfUninitialized=L,t.socketLoopIteration=M,t.startComms=function(e,t,n,r,i,a){if(A)return;A=new C(e,t,n,r,i,a),setTimeout(P,0)},t.startHandlingRequests=function(){return L("startHandlingRequests").startHandlingRequests()},t.stopComms=function(e){e&&y.Cmd.onStartingLogout();const t=L("stopComms");t.socketLoop.endWithValue(),t.socket&&t.socket.close();A=null},t.waitForConnection=function(){L("waitForConnection").sendPing(),T||(T=new p.Resolvable);return T.promise};var i=r(n(81109)),a=r(n(48926)),o=n(48338),s=n(47151),l=n(50796),c=n(20221),d=n(37329),u=n(72287),p=n(88156),f=n(57319),h=n(31914),_=n(72441),g=n(35232),m=n(79196),y=n(88102),E=(n(41796),n(58052)),S=r(n(23368)),v=n(62583);n(85893);let T=null,b=1;class C{constructor(e,t,n,r,i,a){this.nextSocketId=1,this.pendingIqs=new Map,this.ackHandlers=[],this._recvBlocker=new p.Resolvable,this.activePing=null,this._pending=new Set,this.socketId=0,this.socket=null,this.softCloseSocket=null,this.parseAndHandleStanza=(e,t)=>{e===this.socketId&&(this.deadSocketTimer.cancel(),T&&(T.resolve(),T=null));const n=(0,h.decodeStanza)(t,this.gzipInflate).then((n=>{if(!n)return void __LOG__(3)`Failure parsing stanza!`;const r=this.activePing;return r&&r.socketId===e&&r.stanzaId===N(n)?(this.activePing=null,r.handler.resolve(n),this.maybeScheduleHealthCheck(),"NO_ACK"):this.handleStanza(n,e,t.byteLength)})).then((t=>{if(e===this.socketId)if("CLOSE_SOCKET"===t){__LOG__(2)`Comms: job response is CLOSE_SOCKET`;const e=this.socket;e&&e.close()}else"NO_ACK"===t?__LOG__(2)`Comms: job response is NO_ACK`:t&&this.castStanza(t)}));this._pending.add(n),n.finally((()=>{this._pending.delete(n)}))},this.handleStanza=(e,t,n)=>{const r=N(e);if(null!=r){const t=this.pendingIqs.get(r);t?(this.pendingIqs.delete(r),t.resolve(e),this.maybeScheduleHealthCheck()):__LOG__(4,void 0,new Error)`handleIq no handler for iq with id ${r}`}else{if("ack"!==e.tag)return"failure"===e.tag?this._handleStanza(e,t,n):this._recvBlocker.promise.then((()=>this._handleStanza(e,t,n)));this.handleAck(e)}return"NO_ACK"},this.healthCheckTimer=new f.ShiftTimer((()=>{__LOG__(2)`Comms: testing socket`,this.socketId&&this.sendPing()})),this.deadSocketTimer=new f.ShiftTimer((e=>{__LOG__(2)`Comms: Socket ${e} expired`,e===this.socketId&&this.softCloseSocket&&this.softCloseSocket()})),this._handleStanza=e,this.sendPing=t,this.config=n,this.onConnectionChange=(0,c.notifyConnectionChangeFactory)(i,a),this.gzipInflate=r,this.socketLoop=new u.PromiseRetryLoop({name:"MainSocketLoop",code:M,timer:{jitter:.1,max:n.maxSocketLoopWaitTime,algo:{type:"fibonacci",first:1e4,second:1e4},relativeDelay:!0},resetDelay:3e4})}filterPending(e){const t=[];function n(n){e(n)&&t.push(n)}return this.pendingIqs.forEach(n),this.ackHandlers.forEach(n),t}sendPendingIq(e){const{timeoutId:t}=e;null!=t&&(clearTimeout(t),e.timeoutId=void 0),this.callStanza(e.stanza)}callStanza(e){this.castStanza(e),this.deadSocketTimer.onOrBefore(this.config.deadSocketTime,this.socketId),this.healthCheckTimer.cancel()}castStanza(e){const t=this.socketOrThrow("castStanza");try{t.sendFrame((0,h.encodeStanza)(e))}catch(e){__LOG__(3)`castStanza error ${e}`}}socketOrThrow(e){const t=this.socket;if(t)return t;throw new Error(`Comms.${e} called while no socket`)}startHandlingRequests(){var e=this;return(0,a.default)((function*(){__LOG__(2)`Comms.startHandlingRequests`,e._recvBlocker.resolve(),yield e._recvBlocker.promise}))()}handleAck(e){const t=this.ackHandlers;let n=-1,r=null;for(;!r&&++n<t.length;)r=t[n].parseAndTest(e);if(r){const i=t[n];(0,s.removeIndexWithoutPreservingOrder)(t,n),(0,S.default)(e),i.resolve(r),this.maybeScheduleHealthCheck()}else __LOG__(3)`handleAck: unrecognized ${e}`}removeHandler(e){if("iq"===e.type){const t=e.stanza.attrs.id;if(!t||"string"!=typeof t)return;if(!this.pendingIqs.delete(t))return}else{e.type;const t=this.ackHandlers.indexOf(e);if(-1===t)return;(0,s.removeIndexWithoutPreservingOrder)(this.ackHandlers,t)}e.resolve(Promise.reject(new g.Disconnected))}maybeScheduleHealthCheck(){if(this.healthCheckTimer.isScheduled())return;if(this.activePing||this.ackHandlers.length||this.pendingIqs.size)return;const e=this.config.healthCheckInterval,t=Math.ceil(1e3*e*(1+Math.random()));this.healthCheckTimer.onOrBefore(t)}}let A=null;function P(){L("openSocketLoop").socketLoop.start()}function M(){const e=L("socketLoopIteration"),t=e.nextSocketId++;__LOG__(2)`Comms: Socket ${t} opening}`;const n=()=>{e.onConnectionChange("in_handshake")};return y.Cmd.setSocketState(v.SOCKET_STATE.OPENING),e.config.openChatSocket(n).then((r=>{Promise.resolve().then(n),y.Cmd.setSocketState(v.SOCKET_STATE.PAIRING);const i=new p.Resolvable;return __LOG__(2)`Comms: Socket ${t} opened`,e.socketId=t,e.socket=r,e.softCloseSocket=()=>{e.softCloseSocket=null,e.socket&&(e.socket.close(),e.socket=null),i.resolve()},e.socketLoop.resetTimeoutAfter(1e4),e.deadSocketTimer.cancel(),e.maybeScheduleHealthCheck(),r.setOnFrame((n=>e.parseAndHandleStanza(t,n))),r.setOnClose((()=>{__LOG__(2)`Comms: Socket ${t} closed`,e.activePing&&t===e.activePing.socketId&&(e.activePing.handler.resolve(),e.activePing=null),e.filterPending((e=>e.attachedToSocketId===t)).forEach((t=>{e.removeHandler(t)})),t===e.socketId&&(e.socketId=0,e.socket=null,e.onConnectionChange("disconnected"),y.Cmd.socketStreamDisconnected(),i.resolve())})),e.onConnectionChange("connected"),(0,E.isRegistered)()&&(y.Cmd.setSocketState(v.SOCKET_STATE.CONNECTED),y.Cmd.openSocketStream()),e.filterPending((e=>!e.attachedToSocketId)).sort(((e,t)=>e.orderedId-t.orderedId)).forEach((t=>{"iq"===t.type?e.sendPendingIq(t):e.callStanza(t.stanza)})),i.promise})).catch((0,l.filteredCatch)(g.Disconnected,(()=>{__LOG__(2)`socketLoopIteration socket closed while in noise handshake`}))).catch((e=>{__LOG__(3)`socketLoopIteration failed ${e}`}))}function O(){return(O=(0,a.default)((function*(e,t){yield I(e,t)}))).apply(this,arguments)}function I(e,t){return new Promise((n=>{const r=L("sendStanzaAndWaitForAck");r.ackHandlers.push({type:"ack",parseAndTest:e=>{const n=o.AckParser.parse(e),r=(0,_.extractJidFromJidWithType)((0,m.widToJidWithType)(t.from)),a=null==t.participant?null:(0,m.widToDeviceJid)(t.participant);return!n.error&&(0,o.ackMatchesTemplate)(n.success,(0,i.default)((0,i.default)({},t),{},{from:r,participant:a}))?e:null},resolve:n,stanza:e,attachedToSocketId:0,orderedId:b++}),r.socket?r.callStanza(e):__LOG__(2)`Comms has no open socket, will send stanza when socket opens`}))}function w(){return R.apply(this,arguments)}function R(){return(R=(0,a.default)((function*(e,t,n,r){const i=yield new Promise((t=>{const r=L("sendIq"),i=e.attrs.id;if(!i||"string"!=typeof i)throw new Error(`Comms:sendIq given iq without id: ${String(e)}`);const a=r.socketId;if(n&&!a)return void t(Promise.reject(new g.Offline));const o={type:"iq",resolve:t,stanza:e,attachedToSocketId:n?a:0,orderedId:b++};r.pendingIqs.set(i,o),r.socket?r.sendPendingIq(o):__LOG__(2)`Comms has no open socket, will resend iq when socket opens`}));return(0,d.parseIqResponse)(i,t,r)}))).apply(this,arguments)}function D(){return(D=(0,a.default)((function*(e,t){const n=L("sendPing"),r=e.attrs.id;if(!r||"string"!=typeof r)return Promise.reject(new Error(`Comms:sendPing given iq without id: ${String(e)}`));if(!n.socketId)return __LOG__(2)`sendPing when socket dead`,Promise.resolve();if(n.activePing&&n.activePing.socketId===n.socketId)return __LOG__(2)`sendPing ping still pending`,Promise.resolve();n.activePing&&n.activePing.handler.resolve();const i=new p.Resolvable;n.activePing={socketId:n.socketId,stanzaId:r,handler:i},n.callStanza(e);const a=yield i.promise;return a&&(0,d.parseIqResponse)(a,t)}))).apply(this,arguments)}function L(e){if(A)return A;throw new Error(`Comms::${e} called before startComms`)}function N(e){if("iq"===e.tag){const t=e.attrs.type;if("result"===t||"error"===t)return(0,h.decodeAsString)(e.attrs.id)||null}return null}},23368:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{id:t,from:n,t:r}=e.attrs;"message"===e.attrs.class&&function(e,t,n){const r=new i.default({fromMe:!0,remote:t,id:e}),a=String(r);(0,s.getTable)().get(a).then((e=>l.MessagePropertyType.cast(null==e?void 0:e.messageRangeIndex.split("_")[1]))).then((e=>(0,s.getTable)().merge(a,{messageRangeIndex:(0,l.craftMessageRangeIndex)(t.toString(),!1,e===l.MessagePropertyType.SystemMessage,n)}))).catch((e=>{throw __LOG__(4,!0,new Error,!0)`processAckForOutgoingMessage: failed to update in storage`,SEND_LOGS("message processAckForOutgoingMessage failed"),e})),(0,o.checkAndRemoveActiveMessageRanges)(r,n)}(String(t),(0,a.createWid)(String(n)),parseInt(r,10))};var i=r(n(65212)),a=n(45454),o=n(92144),s=n(90981),l=n(12896)},29100:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.blockSendPing=function(){return d.apply(this,arguments)},t.sendPing=function(){const e=(0,o.wap)("iq",{to:o.S_WHATSAPP_NET,xmlns:"w:p",type:"get",id:(0,o.generateId)()},(0,o.wap)("ping",null));(0,l.sendPing)(e,c).then((e=>{(null==e?void 0:e.success)&&u(e.result)}))};var i=r(n(48926)),a=n(92844),o=n(31914),s=n(71914),l=n(24747);const c=new s.WapParser("ping",(e=>e.attrTime("t")));function d(){return(d=(0,i.default)((function*(){const e=(0,o.wap)("iq",{to:o.S_WHATSAPP_NET,xmlns:"w:p",type:"get",id:(0,o.generateId)()},(0,o.wap)("ping",null)),t=yield(0,l.sendPing)(e,c);(null==t?void 0:t.success)&&u(t.result)}))).apply(this,arguments)}function u(e){const t=Math.round(Date.now()/1e3-e);(0,a.setClockSkew)(t)}},39410:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.CHAT_JID=function(e){if(!(e instanceof o.default&&(e.isUser()||e.isGroup()||e.isBroadcast())))throw Error(`CHAT_JID: invalid jid type: ${e instanceof o.default?e.toString():"Not an instance of WID"}`);return a.WapJid.create(e.user,e.getJidServer())},t.DEVICE_JID=function(e){if(!(e instanceof o.default&&e.isUser()))throw Error(`DEVICE_JID: invalid jid type: ${e instanceof o.default?e.toString():"Not an instance of WID"}`);return a.WapJid.createAD(e.user,e.agent,e.device)},t.GROUP_CALL_JID=function(e){if(!(e instanceof o.default&&e.isGroupCall()))throw Error(`GROUP_CALL_JID: invalid jid type: ${e instanceof o.default?e.toString():"Not an instance of WID"}`);return a.WapJid.create(e.user,e.server)},t.GROUP_JID=function(e){if(!(e instanceof o.default&&e.isGroup()))throw Error(`GROUP_JID: invalid jid type: ${e instanceof o.default?e.toString():"Not an instance of WID"}`);return a.WapJid.create(e.user,e.server)},t.JID=function(e){if(!(e instanceof o.default))throw Error(`JID: invalid jid type: ${e instanceof o.default?e.toString():"Not an instance of WID"}`);if(null!=e.device&&0!==e.device||null!=e.agent&&0!==e.agent)return a.WapJid.createAD(e.user,e.agent,e.device);return a.WapJid.create(e.user,e.server)},t.USER_JID=function(e){if(!(e instanceof o.default&&e.isUser()))throw Error(`USER_JID: invalid jid type: ${e instanceof o.default?e.toString():"Not an instance of WID"}`);return a.WapJid.create(e.user,e.getJidServer())},t.wapNodeToVoipXml=t.voipXmlToWapNode=void 0;var i=n(31914),a=n(45506),o=r(n(89867));t.voipXmlToWapNode=e=>{if(!e||!Array.isArray(e)||3!==e.length)throw Error("Invalid VOIP xml node");return function e(t){if(!t)return null;if(Array.isArray(t)){const n=t[0],r=t[1];let o;r&&Object.keys(r).map((e=>{o||(o={});let t=r[e];if(!t)throw Error("Attribute value is null");if("object"==typeof t){if(t.type!==a.WAP_JID_SUBTYPE.JID&&!a.WAP_JID_SUBTYPE.JID_AD)throw Error("Invalid attribute value type");t=new a.WapJid(t)}o[e]=t}));const s=t[2];let l=null;Array.isArray(s)&&s.length>0&&(l="number"==typeof s[0]?new Uint8Array(s):s.map(e).filter((e=>e)));const c=l;return new i.WapNode(n,o,c)}return t}(e)};t.wapNodeToVoipXml=e=>function e(t){const n=[];return n.push(t.tag),n.push(t.attrs||{}),Array.isArray(t.content)&&0===t.content.filter((e=>!Array.isArray(e)))?n.push(t.content):Array.isArray(t.content)?n.push(t.content.map((t=>e(t)))):null!=t.content?t.content instanceof Uint8Array?n.push(Array.from(t.content)):n.push(t.content):n.push(null),n}(e)},53614:(e,t,n)=>{"use strict";let r;Object.defineProperty(t,"__esModule",{value:!0}),t.keyPair=function(e){let t;void 0===e?(t=new Uint8Array(32),self.crypto.getRandomValues(t)):t=new Uint8Array(e);return t[0]&=248,t[31]&=127,t[31]|=64,l({pubKey:32,privKey:t,basepoint:i},(function(e){const n=r._curve25519_donna(e.pubKey,e.privKey,e.basepoint);if(n)throw new Error(`Curve25519:keyPair Error Code ${n}`);return{pubKey:s(e.pubKey,32),privKey:t.buffer}}))},t.sharedSecret=function(e,t){return Promise.resolve().then((()=>l({sharedKey:32,pubKey:e,privKey:t},(function(e){const t=r._curve25519_donna(e.sharedKey,e.privKey,e.pubKey);if(t)throw new Error(`Curve25519:sharedSecret Error Code ${t}`);return s(e.sharedKey,32)}))))},t.toCurveKeyPair=function(e){if(33!==e.pubKey.byteLength||32!==e.privKey.byteLength)throw new Error("Invalid key pair type");const t=new Uint8Array(32),n=new Uint8Array(32);return t.set(new Uint8Array(e.pubKey).subarray(1)),n.set(new Uint8Array(e.privKey)),{pubKey:t.buffer,privKey:n.buffer}},t.toCurveKeyPubKey=function(e){if(33!==e.byteLength)throw new Error("Invalid key type");const t=new Uint8Array(32);return t.set(new Uint8Array(e).subarray(1)),t.buffer},t.toSignalCurveKeyPair=function(e){if(32!==e.pubKey.byteLength||32!==e.privKey.byteLength)throw new Error("Invalid key pair type");const t=a(e.pubKey),n=new Uint8Array(32);return n.set(new Uint8Array(e.privKey)),{pubKey:t,privKey:n.buffer}},t.toSignalCurvePubKey=a,t.verifySignature=function(e,t,n){if(32!==e.byteLength)throw new Error(`Invalid public key length: ${e.byteLength}`);const r=new Uint8Array(33);r[0]=5,r.set(e,1);return!1===window.libsignal.Curve.verifySignature(r,t,n)};const i=new Uint8Array(32);i[0]=9;function a(e){if(32!==e.byteLength)throw new Error("Invalid key type");const t=new Uint8Array(33);return t[0]=5,t.set(new Uint8Array(e),1),t.buffer}function o(e){if("number"==typeof e)return r._malloc(e);const t=new Uint8Array(e.buffer||e),n=r._malloc(t.length);return r.HEAPU8.set(t,n),n}function s(e,t){const n=new Uint8Array(t);return n.set(r.HEAPU8.subarray(e,e+t)),n.buffer}function l(e,t){r||(r=n(23098));const i={};try{for(const t in e)i[t]=o(e[t]);return t(i)}finally{for(const e in i)r._free(i[e])}}},64319:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.deleteEncKeysAndCache=function(){return u.apply(this,arguments)},t.generateFinalDbEncryptionAndFtsKeyForInvoker=function(e){return(0,o.get)().generateFinalDbEncryptionAndFtsKey(e)},t.initEncSalt=function(){return c.apply(this,arguments)},t.initEncSaltForInvoker=function(){return d.apply(this,arguments)};var i=r(n(48926)),a=n(88102),o=n(77303);let s=null;s=n(12669).DbEncKeyStore;let l=null;function c(){return(c=(0,i.default)((function*(){var e;if(null==l){const e=n(52927).nx;l=e()}const t=yield l;if(t&&t.constructor===Uint8Array)return null===(e=s)||void 0===e?void 0:e.init(t)}))).apply(this,arguments)}function d(){return(d=(0,i.default)((function*(){if(null==l){const e=n(52927).nx;l=e()}const e=yield l;e&&e.constructor===Uint8Array&&(0,o.get)().initDatabaseEncnKey(e)}))).apply(this,arguments)}function u(){return(u=(0,i.default)((function*(){var e;yield Promise.all([null===(e=s)||void 0===e?void 0:e.deleteKeys(),(0,o.get)().deleteDbEncKeyCache()])}))).apply(this,arguments)}a.Cmd.on("logout",(()=>{l=Promise.resolve(null)}))},52927:(e,t,n)=>{"use strict";t.cn=function(){(0,a.setWebEncSalt)(null)},t.nx=function(){const e=!!(0,r.getMaybeMeUser)();let t=null;e||(t=new Uint8Array(128),self.crypto.getRandomValues(t),t=btoa(String.fromCharCode(...Array.from(new Uint8Array(t)))),(0,a.setWebEncSalt)(t));t=(0,a.getWebEncSalt)(),null==t&&(__LOG__(4,void 0,new Error)`[DB ENC CRITICAL ERROR] null returned for local enc salt`,o.Socket.logout(!1,i.LogoutReason.ClientFatalError));return t=Uint8Array.from(atob(t),(e=>e.charCodeAt(0))),Promise.resolve(t)};var r=n(99234),i=n(83578),a=n(58052),o=n(65044)},98969:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ENC_IV_SIZE=void 0,t.decryptMediaRetryNotification=function(){return d.apply(this,arguments)},t.encryptServerErrorReceipt=function(e,t,n){return function(){return u.apply(this,arguments)}(e,t,function(e){__LOG__(2)`encodeServerErrorReceipt`;const t=new a.Binary;return(0,l.encodeProtobuf)(c.ServerErrorReceiptSpec,e,t),t.readByteArray()}({stanzaId:t}),n)};var i=r(n(48926)),a=n(8584),o=n(81576),s=n(84902),l=n(60980),c=n(16258);function d(){return(d=(0,i.default)((function*(e,t,n,r){const i=yield p(e,t,n,r);return(0,s.decodeProtobuf)(c.MediaRetryNotificationSpec,i)}))).apply(this,arguments)}function u(){return(u=(0,i.default)((function*(e,t,n,r){const i=(null==r?void 0:r.slice())||m(),{key:a,params:o}=yield _(e,t,i);return{ciphertext:yield self.crypto.subtle.encrypt(o,a,n),iv:i}}))).apply(this,arguments)}function p(){return f.apply(this,arguments)}function f(){return(f=(0,i.default)((function*(e,t,n,r){const{key:i,params:a}=yield _(e,t,n);return self.crypto.subtle.decrypt(a,i,r)}))).apply(this,arguments)}const h="WhatsApp Media Retry Notification";function _(){return g.apply(this,arguments)}function g(){return(g=(0,i.default)((function*(e,t,n){const r=yield(0,o.extractAndExpand)(e,h,32),i=new a.Binary;i.write(t);const s=i.readByteArray();return{key:yield self.crypto.subtle.importKey("raw",new Uint8Array(r),"AES-GCM",!1,["encrypt","decrypt"]),params:{name:"AES-GCM",iv:n,additionalData:s}}}))).apply(this,arguments)}function m(){const e=new Uint8Array(12);return self.crypto.getRandomValues(e),e}t.ENC_IV_SIZE=12},16104:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getFanOutList=function(){return l.apply(this,arguments)};var i=r(n(48926)),a=n(45454),o=n(9108),s=n(99234);function l(){return(l=(0,i.default)((function*(e){let{wids:t}=e;const n=yield(0,o.getDeviceIds)(t.map((e=>e.user))),r=[],i=(0,s.assertGetMe)();return n.forEach(((e,n)=>{if(e){const{devices:t,id:n}=e;t.forEach((e=>{const t=(0,a.createDeviceWidFromUserAndDevice)(n,e);t.equals(i)||r.push(t)}))}else{__LOG__(2,void 0,void 0,void 0,["messaging"])`getFanOutList: no device is found, just send to the primary device`;const e=(0,a.toUserWid)(t[n]);e.equals(i)||r.push(e)}})),r}))).apply(this,arguments)}},86791:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.updateGroupMetadataTable=function(){return s.apply(this,arguments)};var i=r(n(81109)),a=r(n(48926)),o=n(99069);function s(){return(s=(0,a.default)((function*(e){let{groupInfos:t}=e,n=[];yield(0,o.getStorage)().lock(["group-metadata"],function(){var e=(0,a.default)((function*(e){let[r]=e;const a=yield r.bulkGet(t.map((e=>e.id.toString())));return n=t.map(((e,t)=>{var n,r,o,s,l,c;const d=a[t];let u={subject:e.subject,subjectTime:e.subjectTime||0},p={announce:e.announce,a_v_id:e.a_v_id||0},f={desc:e.desc,descId:e.descId,descOwner:null===(n=e.descOwner)||void 0===n?void 0:n.toString(),descTime:e.descTime||0},h=[];if(d){const e=d.subjectTime||0,t=d.a_v_id||0,n=d.descTime||0;e>u.subjectTime&&(u={subject:d.subject,subjectTime:e}),t>p.a_v_id&&(p={announce:d.announce,a_v_id:t}),n>f.descTime&&(f={desc:d.desc,descId:d.descId,descOwner:d.descOwner,descTime:n}),h=d.unjoinedSubgroups}return(0,i.default)((0,i.default)((0,i.default)({id:e.id.toString(),creation:e.creation,owner:null===(r=e.owner)||void 0===r?void 0:r.toString(),restrict:e.restrict,noFrequentlyForwarded:e.noFrequentlyForwarded,ephemeralDuration:e.ephemeralDuration||0,growthLockExpiration:e.growthLockExpiration,growthLockType:e.growthLockType,size:e.size||0,support:null!==(o=e.support)&&void 0!==o&&o,suspended:null!==(s=e.suspended)&&void 0!==s&&s,terminated:null!==(l=e.terminated)&&void 0!==l&&l,parentGroup:null===(c=e.parentGroup)||void 0===c?void 0:c.toString(),isParentGroup:e.isParentGroup,defaultSubgroup:e.defaultSubgroup,unjoinedSubgroups:h},u),f),p)})),r.bulkCreateOrMerge(n)}));return function(){return e.apply(this,arguments)}}())}))).apply(this,arguments)}},51727:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.markGroupAsDirty=function(e){let{group:t}=e;return(0,f.getStorage)().lock(["participant"],(e=>{let[n]=e;return n.merge(String(t),{deviceSyncComplete:!1})}))},t.modifyGroupParticipant=function(e){let{group:t,oldId:n,newId:r,prevVersion:s,newVersion:l}=e;const c=String(t);return(0,f.getStorage)().lock(["participant"],function(){var e=(0,a.default)((function*(e){let[t]=e;const a=yield t.get(c);if(!a)throw new u.GroupUnSyncedError(`modifyGroupParticipant: group participant info missing for group ${c}`);if(a.version&&(null==s||s!==a.version))throw new u.GroupUnSyncedError(`modifyGroupParticipant: prev version info missing for group ${c}`);return t.createOrReplace(function(e,t,n,r){const a=String(t),s=String(n),l=new Map(e.senderKey),c=e.participants.filter((e=>e!==a)).concat(s);Array.from(l.keys()).forEach((e=>{const n=(0,o.createWid)(e).user;t.user===n?l.delete(e):l.set(e,!1)})),l.set(s,!1);const d=e.admins.map((e=>e===a?s:e));return(0,i.default)((0,i.default)({},e),{},{participants:c,senderKey:l,admins:d,version:r,rotateKey:!0})}(a,n,r,l))}));return function(){return e.apply(this,arguments)}}())},t.removeParticipantInfo=_,t.replaceParticipants=function(e){let{group:t,participants:n,admins:r,deviceIds:i,version:a}=e;const o=t.toString();return(0,f.getStorage)().lock(["participant"],(e=>{let[t]=e;return t.get(o).then((e=>e?t.createOrReplace(function(e,t,n,r,i){let a=e.rotateKey;const o=e.senderKey,l=new Map;r.forEach((e=>{if(e.equals((0,s.assertGetMe)()))return;const t=String(e),n=o.get(t);null==n?l.set(t,!1):(l.set(t,n),o.delete(t))})),0!==o.size&&(a=!0);return{groupId:e.groupId,senderKey:l,participants:t.map(String),admins:n.map(String),rotateKey:a,version:i,deviceSyncComplete:!0}}(e,n,r,i,a)):t.create(function(e,t,n,r,i){const a=new Map;return r.forEach((e=>{if(e.equals((0,s.assertGetMe)()))return;const t=String(e);a.has(t)||a.set(t,!1)})),{groupId:e,senderKey:a,participants:t.map(String),admins:n.map(String),rotateKey:!1,version:i,deviceSyncComplete:!0}}(o,n,r,i,a))))}))},t.updateGroupParticipantTableWithoutDeviceSync=function(){return h.apply(this,arguments)},t.updateParticipants=function(e,t){const{participants:n,version:r,prevVersion:i}=t,o=e.toString();return(0,f.getStorage)().lock(["participant"],function(){var e=(0,a.default)((function*(e){let[a]=e;const l=yield a.get(o);if(!l)throw new u.GroupUnSyncedError(`updateParticipants: group participant info missing for group ${o}, action ${t.action}`);if(l.version&&(null==i||i!==l.version))throw new u.GroupUnSyncedError(`updateParticipants: prevVersion info missing for group ${o}, action ${t.action}`);switch(t.action){case u.PARTICIPANT_OPERATION.ADD:return a.createOrReplace(function(e,t,n,r){const i=new Map(e.senderKey);return n.forEach((e=>{if(e.equals((0,s.assertGetMe)()))return;const t=String(e);i.set(t,!1)})),{groupId:e.groupId,senderKey:i,participants:e.participants.concat(t.map(String)),admins:e.admins,rotateKey:e.rotateKey,version:r,deviceSyncComplete:e.deviceSyncComplete}}(l,n,t.deviceIds,r));case u.PARTICIPANT_OPERATION.REMOVE:return a.createOrReplace(_(l,n,r));case u.PARTICIPANT_OPERATION.DEMOTE:return a.createOrReplace(g(l,n,r,u.PARTICIPANT_OPERATION.DEMOTE));case u.PARTICIPANT_OPERATION.PROMOTE:return a.createOrReplace(g(l,n,r,u.PARTICIPANT_OPERATION.PROMOTE));default:throw new Error(`updateParticipants: failed with unknown action ${t.action}`)}}));return function(){return e.apply(this,arguments)}}())};var i=r(n(81109)),a=r(n(48926)),o=n(45454),s=n(99234),l=n(57701),c=r(n(11339)),d=n(76214),u=n(70405),p=n(99039),f=n(99069);function h(){return(h=(0,a.default)((function*(e){let{groupInfos:t}=e;const n=yield(0,d.getParticipantTable)().bulkGet(t.map((e=>e.id.toString()))),r=new Map;n.forEach((e=>e&&r.set(e.groupId,e.senderKey)));const i=t.map((e=>{var t;const n=[],i=[],a=e.id.toString(),o=r.get(a)||new Map;return null===(t=e.participants)||void 0===t||t.forEach((e=>{e.isAdmin&&i.push(e.id),n.push(e.id),o.set(String(e.id),!1)})),{groupId:a,participants:n.map(String),admins:i.map(String),senderKey:o,rotateKey:!1,deviceSyncComplete:!1}}));return(0,d.getParticipantTable)().bulkCreateOrReplace(i)}))).apply(this,arguments)}function _(e,t,n){const r=new Map(e.senderKey);let i=!(0,l.rotateSenderKeyIfSentEnabled)()||e.rotateKey;r.forEach(((e,n)=>{const a=(0,o.createWid)(n).user;t.some((e=>e.user===a))&&(i=i||e,r.delete(n))})),i&&r.forEach(((e,t)=>r.set(t,!1)));const a=t.map(String);return!e.rotateKey&&i&&(0,p.postSenderKeyExpiredMetric)({chatId:e.groupId,deviceCount:e.senderKey.size,expiryReason:c.default.EXPIRY_REASON.USER_LEAVE}),{groupId:e.groupId,senderKey:r,participants:e.participants.filter((e=>!a.includes(e))),admins:e.admins.filter((e=>!a.includes(e))),rotateKey:i,version:n,deviceSyncComplete:e.deviceSyncComplete}}function g(e,t,n,r){let i=e.admins;const a=t.map(String);return r===u.PARTICIPANT_OPERATION.DEMOTE?i=e.admins.filter((e=>!a.includes(e))):r===u.PARTICIPANT_OPERATION.PROMOTE&&(i=e.admins.concat(a)),{groupId:e.groupId,senderKey:e.senderKey,participants:e.participants,admins:i,rotateKey:e.rotateKey,version:n,deviceSyncComplete:e.deviceSyncComplete}}},70405:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PARTICIPANT_OPERATION=t.GroupUnSyncedError=void 0;const n=Object.freeze({ADD:"add",REMOVE:"remove",DEMOTE:"demote",PROMOTE:"promote"});t.PARTICIPANT_OPERATION=n;class r extends Error{constructor(){super(...arguments),this.name="GroupUnSyncedError"}}t.GroupUnSyncedError=r},73184:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WHATSAPP_GRAPHQL_ENDPOINT=t.WHATSAPP_GRAPHQL_ACCESS_TOKEN=void 0;t.WHATSAPP_GRAPHQL_ENDPOINT="https://graph.whatsapp.com/graphql";t.WHATSAPP_GRAPHQL_ACCESS_TOKEN="WA|438455091201276|159a64e893c734301a4db315bba22e04"},7312:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PersistedQueries=void 0;t.PersistedQueries={queryCatalogProductQuery:"4859472260800606",queryCatalogQuery:"7084293094978569",queryProductListCatalogQuery:"4751485608268572",queryProductSingleCollectionQuery:"5205906642772966"}},48089:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GraphQLServerError=void 0;class n extends Error{constructor(e){super(),this.name="GraphQLServerError",this.source=e}}t.GraphQLServerError=n},1321:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.fetchQuery=function(){return c.apply(this,arguments)},t.graphql=function(){throw new Error("Invariant Violation")};var i=r(n(6479)),a=r(n(48926)),o=n(48089),s=n(52148);const l=["eventLogger"];function c(){return(c=(0,a.default)((function*(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{eventLogger:r}=n,a=(0,i.default)(n,l);const{fetchQuery:c}=yield(0,s.requireRelayRuntime)();try{const n=yield c(yield(0,s.getEnvironment)(),e,t,a).toPromise();return null==r||r.success(),n}catch(e){throw e instanceof o.GraphQLServerError&&(null==r||r.failure(e.source.errors)),e}}))).apply(this,arguments)}},52148:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getEnvironment=function(){return u.apply(this,arguments)},t.requireRelayRuntime=c;var i=r(n(48926)),a=r(n(40682)),o=n(73184),s=n(7312),l=n(48089);function c(){return n.e(4815).then(n.t.bind(n,44311,23)).then((e=>e.default))}let d;function u(){return(u=(0,i.default)((function*(){if(null!=d)return d;const{Environment:e,Network:t,RecordSource:n,Store:r}=yield c(),u={Accept:"application/json","Content-Type":"application/json"},p=function(){var e=(0,i.default)((function*(e,t){const n={access_token:o.WHATSAPP_GRAPHQL_ACCESS_TOKEN,doc_id:s.PersistedQueries[e.name],variables:t,locale:a.default.get()},r=yield fetch(o.WHATSAPP_GRAPHQL_ENDPOINT,{method:"POST",headers:u,body:JSON.stringify(n)}),i=yield r.json();if(null!=(null==i?void 0:i.errors))throw new l.GraphQLServerError({errors:i.errors});return i}));return function(){return e.apply(this,arguments)}}();return d=new e({network:t.create(p),store:new r(new n)}),d}))).apply(this,arguments)}},99805:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){throw new Error("Invariant Violation")}},79341:e=>{"use strict";const t={fragment:{argumentDefinitions:n=[{defaultValue:null,kind:"LocalArgument",name:"request"}],kind:"Fragment",metadata:null,name:"queryCatalogProductQuery",selections:a=[{alias:null,args:[{kind:"Variable",name:"request",variableName:"request"}],concreteType:"XWAProductCatalogGetProductResponseSuccess",kind:"LinkedField",name:"xwa_product_catalog_get_product",plural:!1,selections:[{alias:null,args:null,concreteType:"XWAProductCatalogGetProductResponseSuccessProductCatalog",kind:"LinkedField",name:"product_catalog",plural:!1,selections:[{alias:null,args:null,concreteType:"XWAProductCatalogGetProductResponseSuccessProductCatalogProduct",kind:"LinkedField",name:"product",plural:!1,selections:[{kind:"InlineFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"__typename",storageKey:null},r={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"retailer_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"is_hidden",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"availability",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"description",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"url",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"currency",storageKey:null},i={alias:null,args:null,kind:"ScalarField",name:"price",storageKey:null},{alias:null,args:null,concreteType:"XWAProductCatalogProductStatusInfo",kind:"LinkedField",name:"status_info",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"can_appeal",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XWAProductCatalogProductSalePrice",kind:"LinkedField",name:"sale_price",plural:!1,selections:[i,{alias:null,args:null,kind:"ScalarField",name:"start_date",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"end_date",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XWAProductCatalogProductMedia",kind:"LinkedField",name:"media",plural:!1,selections:[{alias:null,args:null,concreteType:"XWAProductCatalogProductMediaImage",kind:"LinkedField",name:"images",plural:!0,selections:[r,{alias:null,args:null,kind:"ScalarField",name:"original_image_url",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"request_image_url",storageKey:null}],storageKey:null}],storageKey:null},{kind:"InlineFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"belongs_to",storageKey:null}],type:"XWAProductCatalogGetResponseSuccessProductCatalogProduct",abstractKey:null},{kind:"InlineFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"compliance_category",storageKey:null},{alias:null,args:null,concreteType:"XWAProductCatalogGetProductResponseSuccessProductCatalogProductComplianceInfo",kind:"LinkedField",name:"compliance_info",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"country_code_origin",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"importer_name",storageKey:null},{alias:null,args:null,concreteType:"XWAProductCatalogGetProductResponseSuccessProductCatalogProductComplianceInfoImporterAddress",kind:"LinkedField",name:"importer_address",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"street1",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"street2",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"postal_code",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"city",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"region",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"country_code",storageKey:null}],storageKey:null}],storageKey:null}],type:"XWAProductCatalogGetProductResponseSuccessProductCatalogProduct",abstractKey:null}],type:"XWAICatalogProduct",abstractKey:"__isXWAICatalogProduct"}],storageKey:null}],storageKey:null}],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:n,kind:"Operation",name:"queryCatalogProductQuery",selections:a},params:{id:"queryCatalogProductQuery",metadata:{},name:"queryCatalogProductQuery",operationKind:"query",text:null}};var n,r,i,a;t.hash="789bf89862b4e217474bfb7e30300896",e.exports=t},25173:e=>{"use strict";const t={fragment:{argumentDefinitions:n=[{defaultValue:null,kind:"LocalArgument",name:"request"}],kind:"Fragment",metadata:null,name:"queryCatalogQuery",selections:o=[{alias:null,args:[{kind:"Variable",name:"request",variableName:"request"}],concreteType:"XWAProductCatalogGetResponseSuccess",kind:"LinkedField",name:"xwa_product_catalog_get_product_catalog",plural:!1,selections:[r={alias:null,args:null,kind:"ScalarField",name:"__typename",storageKey:null},{alias:null,args:null,concreteType:"XWAProductCatalogGetResponseSuccessProductCatalog",kind:"LinkedField",name:"product_catalog",plural:!1,selections:[{alias:null,args:null,concreteType:"XWAProductCatalogGetResponseSuccessProductCatalogProduct",kind:"LinkedField",name:"products",plural:!0,selections:[{kind:"InlineFragment",selections:[r,i={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"retailer_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"is_hidden",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"availability",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"description",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"url",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"currency",storageKey:null},a={alias:null,args:null,kind:"ScalarField",name:"price",storageKey:null},{alias:null,args:null,concreteType:"XWAProductCatalogProductStatusInfo",kind:"LinkedField",name:"status_info",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"can_appeal",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XWAProductCatalogProductSalePrice",kind:"LinkedField",name:"sale_price",plural:!1,selections:[a,{alias:null,args:null,kind:"ScalarField",name:"start_date",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"end_date",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XWAProductCatalogProductMedia",kind:"LinkedField",name:"media",plural:!1,selections:[{alias:null,args:null,concreteType:"XWAProductCatalogProductMediaImage",kind:"LinkedField",name:"images",plural:!0,selections:[i,{alias:null,args:null,kind:"ScalarField",name:"original_image_url",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"request_image_url",storageKey:null}],storageKey:null}],storageKey:null},{kind:"InlineFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"belongs_to",storageKey:null}],type:"XWAProductCatalogGetResponseSuccessProductCatalogProduct",abstractKey:null},{kind:"InlineFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"compliance_category",storageKey:null},{alias:null,args:null,concreteType:"XWAProductCatalogGetProductResponseSuccessProductCatalogProductComplianceInfo",kind:"LinkedField",name:"compliance_info",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"country_code_origin",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"importer_name",storageKey:null},{alias:null,args:null,concreteType:"XWAProductCatalogGetProductResponseSuccessProductCatalogProductComplianceInfoImporterAddress",kind:"LinkedField",name:"importer_address",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"street1",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"street2",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"postal_code",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"city",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"region",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"country_code",storageKey:null}],storageKey:null}],storageKey:null}],type:"XWAProductCatalogGetProductResponseSuccessProductCatalogProduct",abstractKey:null}],type:"XWAICatalogProduct",abstractKey:"__isXWAICatalogProduct"}],storageKey:null},{alias:null,args:null,concreteType:"XWAProductCatalogGetResponseSuccessProductCatalogPaging",kind:"LinkedField",name:"paging",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"before",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"after",storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:n,kind:"Operation",name:"queryCatalogQuery",selections:o},params:{id:"queryCatalogQuery",metadata:{},name:"queryCatalogQuery",operationKind:"query",text:null}};var n,r,i,a,o;t.hash="1fc0bd8ed5b61085c7f309bf1755d75d",e.exports=t},6262:e=>{"use strict";const t={fragment:{argumentDefinitions:n=[{defaultValue:null,kind:"LocalArgument",name:"request"}],kind:"Fragment",metadata:null,name:"queryProductSingleCollectionQuery",selections:l=[{alias:null,args:[{kind:"Variable",name:"request",variableName:"request"}],concreteType:"XWAProductCatalogGetSingleCollectionResponseSuccess",kind:"LinkedField",name:"xwa_product_catalog_get_single_collection",plural:!1,selections:[{alias:null,args:null,concreteType:"XWAProductCatalogGetSingleCollectionResponseSuccessCollection",kind:"LinkedField",name:"collection",plural:!1,selections:[r={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},i={alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},{alias:null,args:null,concreteType:"XWAProductCatalogCollectionStatusInfo",kind:"LinkedField",name:"status_info",plural:!1,selections:[a={alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null},o={alias:null,args:null,kind:"ScalarField",name:"can_appeal",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"reject_reason",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"commerce_url",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XWAProductCatalogGetSingleCollectionResponseSuccessCollectionProduct",kind:"LinkedField",name:"products",plural:!0,selections:[{kind:"InlineFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"__typename",storageKey:null},r,{alias:null,args:null,kind:"ScalarField",name:"retailer_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"is_hidden",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"availability",storageKey:null},i,{alias:null,args:null,kind:"ScalarField",name:"description",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"url",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"currency",storageKey:null},s={alias:null,args:null,kind:"ScalarField",name:"price",storageKey:null},{alias:null,args:null,concreteType:"XWAProductCatalogProductStatusInfo",kind:"LinkedField",name:"status_info",plural:!1,selections:[o,a],storageKey:null},{alias:null,args:null,concreteType:"XWAProductCatalogProductSalePrice",kind:"LinkedField",name:"sale_price",plural:!1,selections:[s,{alias:null,args:null,kind:"ScalarField",name:"start_date",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"end_date",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XWAProductCatalogProductMedia",kind:"LinkedField",name:"media",plural:!1,selections:[{alias:null,args:null,concreteType:"XWAProductCatalogProductMediaImage",kind:"LinkedField",name:"images",plural:!0,selections:[r,{alias:null,args:null,kind:"ScalarField",name:"original_image_url",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"request_image_url",storageKey:null}],storageKey:null}],storageKey:null},{kind:"InlineFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"belongs_to",storageKey:null}],type:"XWAProductCatalogGetResponseSuccessProductCatalogProduct",abstractKey:null},{kind:"InlineFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"compliance_category",storageKey:null},{alias:null,args:null,concreteType:"XWAProductCatalogGetProductResponseSuccessProductCatalogProductComplianceInfo",kind:"LinkedField",name:"compliance_info",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"country_code_origin",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"importer_name",storageKey:null},{alias:null,args:null,concreteType:"XWAProductCatalogGetProductResponseSuccessProductCatalogProductComplianceInfoImporterAddress",kind:"LinkedField",name:"importer_address",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"street1",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"street2",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"postal_code",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"city",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"region",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"country_code",storageKey:null}],storageKey:null}],storageKey:null}],type:"XWAProductCatalogGetProductResponseSuccessProductCatalogProduct",abstractKey:null}],type:"XWAICatalogProduct",abstractKey:"__isXWAICatalogProduct"}],storageKey:null},{alias:null,args:null,concreteType:"XWAProductCatalogGetSingleCollectionResponseSuccessCollectionPaging",kind:"LinkedField",name:"paging",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"after",storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:n,kind:"Operation",name:"queryProductSingleCollectionQuery",selections:l},params:{id:"queryProductSingleCollectionQuery",metadata:{},name:"queryProductSingleCollectionQuery",operationKind:"query",text:null}};var n,r,i,a,o,s,l;t.hash="8a60e9f9e29f853fa63cd8d9141dbe6f",e.exports=t},69808:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseABProps=function(e){const t=new Map;e.forEach((e=>{if("ExperimentConfig"===e.mixinName){const{configCode:n,configValue:r,configExpoKey:i}=e;t.set(n,{configValue:r,configExpoKey:i})}}));const n=new Map;return Object.keys(r.ABPropConfigs).map((e=>{const i=r.ABPropConfigs[e][0],a=t.get(i),o=null==a?void 0:a.configValue,s=null==a?void 0:a.configExpoKey;n.set(i,{configValue:o,configExpoKey:null==s?null:s.toString()})})),n};var r=n(64388)},89981:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.syncABProps=_,t.syncABPropsTask=function(){return m.apply(this,arguments)};var i=r(n(48926)),a=n(13959),o=n(4276),s=n(31914),l=n(34541),c=n(57849),d=n(72126),u=n(69808),p=n(88102),f=n(24747),h=n(92182);function _(){return g.apply(this,arguments)}function g(){return(g=(0,i.default)((function*(){var e;let t,n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];n&&(t=(0,d.getHash)());const r=(0,s.wap)("iq",{xmlns:"abt",id:(0,s.generateId)(),type:"get",to:s.S_WHATSAPP_NET},(0,s.wap)("props",{protocol:"1",hash:n&&null!=t?(0,s.CUSTOM_STRING)(t):s.DROP_ATTR})),i=yield(0,f.sendSmaxIq)(r,o.parseGetExperimentConfigResponseSuccess);if(!i.success||null==i.result||!i.result.success)return!1;const a=i.result.value,c=Date.now();if((0,h.updateGlobalABKey)(null!==(e=a.propsAbKey)&&void 0!==e?e:""),(0,d.updateAttributesLocalStorage)(a.propsAbKey,a.propsHash,a.propsRefresh,c),null==a.propsHash)return!1;try{return yield(0,l.updateABPropConfigs)((0,u.parseABProps)(a.propsProp)),!0}catch(e){__LOG__(4,!0,new Error,!0)`update ABProps config table failed`,SEND_LOGS("update ABProps config table failed when syncing ABProps")}return!1}))).apply(this,arguments)}function m(){return(m=(0,i.default)((function*(){const e=(0,d.isABPropsAfterFirstSync)();let t=3;for(;t-- >0;)try{if(yield _(e))return yield(0,c.updateABPropsFromStorage)(),void p.Cmd.onAbPropsUpdate()}catch(e){0===t&&(__LOG__(4,!0,new Error,!0)`failed to sync ABProps`,SEND_LOGS("failed to sync ABProps")),yield(0,a.delayMs)(1e4*Math.random())}}))).apply(this,arguments)}},41075:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ACCOUNT_SYNC_TYPE=void 0,t.getAndUpdateProfilePicture=function(){const e=(0,a.default)(p.ProfilePicThumbCollection.get((0,d.getMeUser)()),"ProfilePicThumbCollection.get(getMeUser())");return p.ProfilePicThumbCollection.resyncPictures([e])},t.getDevices=function(e){return(0,s.syncDeviceListJob)([(0,d.assertGetMe)()],e,null)},t.updateBlocklist=function(){return v.apply(this,arguments)},t.updateDefaultDisappearingMode=function(){return T.apply(this,arguments)},t.updatePrivacySettings=function(){return S.apply(this,arguments)},t.updateTosState=function(e){return e.forEach((e=>{m.TosManager.setState(e.id,e.state?"ACCEPTED":"NOT_ACCEPTED")})),Promise.resolve()};var i=r(n(48926)),a=r(n(45095)),o=n(68387),s=n(10823),l=n(32826),c=n(91036),d=n(99234),u=n(61319),p=n(82039),f=n(92913),h=n(99192),_=n(4831),g=n(14810),m=n(70768);const y=n(76672)({BLOCKLIST:"blocklist",DEVICES:"devices",DISAPPEARING_MODE:"disappearing_mode",PICTURE:"picture",PRIVACY:"privacy",STATUS:"status",TOS:"tos"});function E(e,t){switch(t){case u.PrivacyDisallowedListType.About:return e.about===o.VISIBILITY.contact_blacklist;case u.PrivacyDisallowedListType.GroupAdd:return e.groupAdd===o.VISIBILITY.contact_blacklist;case u.PrivacyDisallowedListType.LastSeen:return e.lastSeen===o.VISIBILITY.contact_blacklist;case u.PrivacyDisallowedListType.ProfilePicture:return e.profilePicture===o.VISIBILITY.contact_blacklist}}function S(){return(S=(0,i.default)((function*(){const e=yield(0,_.getPrivacy)();(0,d.setUserPrivacySettings)(e);const t=[u.PrivacyDisallowedListType.About,u.PrivacyDisallowedListType.GroupAdd,u.PrivacyDisallowedListType.LastSeen,u.PrivacyDisallowedListType.ProfilePicture].filter((t=>E(e,t))),n=yield(0,g.syncPrivacyDisallowedLists)(t);return{privacySettings:e,privacyDisallowedRows:n}}))).apply(this,arguments)}function v(){return(v=(0,i.default)((function*(){const e=yield(0,f.fetchAndUpdateBlocklist)();e.dhash&&(l.BlocklistCollection.toArray().forEach((e=>l.BlocklistCollection.remove(e))),e.wids&&e.wids.forEach((e=>{l.BlocklistCollection.gadd(e)})))}))).apply(this,arguments)}function T(){return(T=(0,i.default)((function*(){const e=yield(0,h.queryDisappearingMode)();yield(0,c.updateDisappearingMode)((0,d.getMaybeMeUser)(),e.duration,e.t)}))).apply(this,arguments)}t.ACCOUNT_SYNC_TYPE=y},68268:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.AdvToSystemBridgeImpl=void 0,t.getLastADVDeviceInfoCheckTime=v,t.runAdvDeviceInfoCheck=I,t.scheduleAdvDeviceInfoCheck=M;var i=r(n(48926)),a=n(52230),o=n(92844),s=n(40234),l=n(45454),c=n(57849),d=n(9108),u=n(99234),p=r(n(11339)),f=n(97153),h=n(60998),_=n(17041),g=n(65044);const m=25*o.HOUR_SECONDS;class y{constructor(e){this.advToSystemBridge=e}run(e){var t=this;return(0,i.default)((function*(){const n=t.advToSystemBridge,r=yield n.getUsersForExpiration(e),{usersExpired:i,usersCloseToExpiration:a}=r;n.removeCompanions(i),n.sendADVStoredTimestampExpiredEvents(i,e);const o=Array.from(i.keys()).concat(Array.from(a.keys())).filter((e=>!n.canRemoveUserDevices(e)));return n.sendOrQueueDeviceUsyncQuery(o).catch((()=>{})),n.recordLocalTimestamp()}))()}}class E{getNumDaysKeyIndexListExpiration(){return(0,c.getABPropConfigValue)("num_days_key_index_list_expiration")}getNumDaysBeforeDeviceExpiryCheck(){return(0,c.getABPropConfigValue)("num_days_before_device_expiry_check")}getUsersForExpiration(e){var t=this;return(0,i.default)((function*(){const n=yield(0,d.getAllDeviceLists)(),r=yield v(),i=t.getNumDaysKeyIndexListExpiration()*o.DAY_SECONDS,s=new Map,c=new Map;return n.forEach((n=>{n.deleted||function(e){return 1===e.devices.length&&e.devices[0].id===a.DEFAULT_DEVICE_ID}(n)||(!function(e,t,n,r){if(e-n.timestamp>=t)return!0;if(null!=n.expectedTsUpdateTs)return e-n.expectedTsUpdateTs>=m&&n.expectedTsLastDeviceJobTs!==r;return!1}(e,i,n,r)?function(e,t,n){if(e-n.timestamp>=t)return!0;if(null!=n.expectedTs)return n.expectedTs>n.timestamp;return!1}(e,i-t.getNumDaysBeforeDeviceExpiryCheck()*o.DAY_SECONDS,n)&&c.set((0,l.createUserWid)(n.id),n):s.set((0,l.createUserWid)(n.id),n))})),{usersExpired:s,usersCloseToExpiration:c}}))()}sendADVStoredTimestampExpiredEvents(e,t){e.forEach((e=>{const n=t-(e.timestamp+this.getNumDaysKeyIndexListExpiration()*o.DAY_SECONDS);if(n<0)return;const r=Math.round(n/o.HOUR_SECONDS);new p.default.AdvStoredTimestampExpired({advExpireTimeInHours:r}).commit()}))}sendOrQueueDeviceUsyncQuery(e){return(0,i.default)((function*(){return yield(0,f.addUserToPendingDeviceSync)(e.map((e=>e.toString()))),(0,f.doPendingDeviceSync)()}))()}canRemoveUserDevices(){return!1}removeCompanions(e){return Array.from(e.entries()).some((e=>{let[t,n]=e;t.user,(0,u.getMeUser)().user}))?(g.Socket.logout(),Promise.resolve()):Promise.all(Array.from(e.entries()).map((e=>{let[t,n]=e;return(0,_.clearDeviceRecord)(t,n.devices)})))}recordLocalTimestamp(){return Promise.resolve()}}let S;function v(){return T.apply(this,arguments)}function T(){return(T=(0,i.default)((function*(){if(null==S){yield(0,h.getTaskScheduledTime)("advDeviceInfoCheck")}return S}))).apply(this,arguments)}t.AdvToSystemBridgeImpl=E;const b=o.DAY_SECONDS,C="advDeviceInfoCheck";let A,P;function M(){return O.apply(this,arguments)}function O(){return(O=(0,i.default)((function*(){null!=A&&(clearTimeout(A),A=null);const e=s.Clock.localUnixTime(),t=yield v();let n=0,r=()=>Promise.resolve();null!=t&&(n=Math.max(b-(e-t),0),r=()=>(0,c.getABPropConfigValue)("adv_v2_m4_m5")?I():Promise.resolve()),A=setTimeout((0,i.default)((function*(){try{yield r()}catch(e){__LOG__(4,void 0,new Error,void 0,["adv_device_info_check"])`error running the adv device check job`}A=null,S=s.Clock.localUnixTime(),(0,h.updateTaskScheduledTime)(C,(0,o.castToUnixTime)(S)),M()})),1e3*n)}))).apply(this,arguments)}function I(){return null==P&&(P=new y(new E)),P.run(s.Clock.localUnixTime())}},56375:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.blockUser=function(e){if(f.ServerProps.mdBlocklistV2)return function(e){return E(e,!0)}(e);return function(e){const t=c.BlocklistCollection.map((e=>e.id));return t.push(e),g((0,a.default)(t))}(e)},t.unblockUser=function(e){if(f.ServerProps.mdBlocklistV2)return function(e){return E(e,!1)}(e);return function(e){const t=c.BlocklistCollection.map((e=>e.id));return t.splice(t.indexOf(e),1),g((0,a.default)(t))}(e)};var i=r(n(48926)),a=r(n(44908)),o=n(31914),s=n(71914),l=n(81663),c=n(32826),d=n(24747),u=n(99234),p=n(58052),f=n(64551),h=n(39410);const _=new s.WapParser("blockUser",(e=>{if(!e.hasChild("error"))return void __LOG__(2)`sendBlocklist: success`;const t=e.child("error"),n=t.attrInt("code"),r=t.attrString("text");return __LOG__(3)`sendBlocklist: sever response with ${n}, ${r}`,{errorCode:n,errorText:r}}));function g(){return m.apply(this,arguments)}function m(){return(m=(0,i.default)((function*(e){const t=0===e.length?(0,o.wap)("list",{name:"default"}):(0,o.wap)("list",{name:"default"},e.map((e=>(0,o.wap)("item",{action:"deny",type:"jid",value:(0,h.JID)(e),order:"1"})))),n=(0,o.wap)("iq",{xmlns:"jabber:iq:privacy",from:(0,h.JID)((0,u.assertGetMe)()),type:"set",id:(0,o.generateId)()},(0,o.wap)("query",null,t)),r=yield(0,d.sendIq)(n,_);if(!r.success){const{errorCode:e,errorText:t}=r;return __LOG__(3)`sendBlocklist: server response with ${e}, ${t}`,{errorCode:e,errorText:t}}return r.result}))).apply(this,arguments)}const y=new s.WapParser("blockUserV2ResponseParser",(e=>{var t;if(e.hasChild("error")){const t=e.child("error"),n=t.attrInt("code"),r=t.attrString("text");return __LOG__(3)`blockUserV2ResponseParser: server response with ${n}, ${r}`,{errorCode:n,errorText:r}}__LOG__(2)`block/unblock user: success`;return{blockedUsers:null===(t=e.child("list"))||void 0===t?void 0:t.mapChildrenWithTag("item",(e=>(0,l.userJidToUserWid)(e.attrPhoneUserJid("jid"))))}}));function E(){return S.apply(this,arguments)}function S(){return(S=(0,i.default)((function*(e,t){const n=(0,p.getBlocklistHash)(),r=(0,o.wap)("iq",{xmlns:"blocklist",to:o.S_WHATSAPP_NET,type:"set",id:(0,o.generateId)()},(0,o.wap)("item",{dhash:null!=n?(0,o.CUSTOM_STRING)(n):o.DROP_ATTR,action:(0,o.CUSTOM_STRING)(t?"block":"unblock"),jid:(0,h.JID)(e)})),i=yield(0,d.sendIq)(r,y);if(!i.success){const{errorCode:e,errorText:t}=i;return __LOG__(3)`blockUnblockUserV2: server response with ${e}, ${t}`,{errorCode:e,errorText:t}}}))).apply(this,arguments)}},8021:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.editBusinessProfile=function(){return f.apply(this,arguments)},t.updateCartEnabled=function(){return p.apply(this,arguments)};var i=r(n(48926)),a=n(31914),o=n(71914),s=n(92574),l=n(24747);const c=new o.WapParser("businessProfileResponse",(e=>{e.assertTag("iq"),e.assertFromServer()})),d=new o.WapParser("commerceSettingsResponse",(e=>{e.assertTag("iq"),e.assertFromServer();return"true"===e.child("commerce_settings").child("cart").attrString("enabled")}));function u(e){let{note:t,timezone:n,config:r}=e;const i=[];for(const e in r){const t=r[e],{mode:n,hours:a}=t;if(a)for(const[t,r]of a)i.push({day_of_week:e,mode:n,open_time:t,close_time:r});else i.push({day_of_week:e,mode:n})}const o=[];return t&&o.push((0,a.wap)("business_hours_note",null,t)),o.push(...i.map((e=>(0,a.wap)("business_hours_config",{day_of_week:(0,a.CUSTOM_STRING)(e.day_of_week),mode:e.mode,open_time:e.open_time?(0,a.CUSTOM_STRING)(e.open_time.toString()):a.DROP_ATTR,close_time:e.close_time?(0,a.CUSTOM_STRING)(e.close_time.toString()):a.DROP_ATTR})))),(0,a.wap)("business_hours",{timezone:n?(0,a.CUSTOM_STRING)(n):a.DROP_ATTR},o)}function p(){return(p=(0,i.default)((function*(e){const t=(0,a.wap)("iq",{to:a.S_WHATSAPP_NET,smax_id:"25",xmlns:"fb:thrift_iq",id:(0,a.generateId)(),type:"set"},(0,a.wap)("commerce_settings",null,(0,a.wap)("cart",{enabled:(0,a.CUSTOM_STRING)(e.toString())}))),n=yield(0,l.sendIq)(t,d);if(n.success)return n.result;throw new s.ServerStatusCodeError(n.errorCode)}))).apply(this,arguments)}function f(){return(f=(0,i.default)((function*(e){let{address:t,description:n,categories:r,email:i,website:o,businessHours:d}=e;const p=(0,a.wap)("iq",{to:a.S_WHATSAPP_NET,xmlns:"w:biz",id:(0,a.generateId)(),type:"set"},(0,a.wap)("business_profile",{v:"3",mutation_type:"delta"},void 0!==t?(0,a.wap)("address",null,t):null,void 0!==n?(0,a.wap)("description",null,n):null,void 0!==i?(0,a.wap)("email",null,i):null,o&&0===o.length?(0,a.wap)("website",null):null,o&&o.length>0?(0,a.wap)("website",null,o[0]):null,o&&o.length>1?(0,a.wap)("website",null,o[1]):null,r?(0,a.wap)("categories",null,r.map((e=>(0,a.wap)("category",{id:(0,a.CUSTOM_STRING)(e.id)})))):null,d?u(d):null)),f=yield(0,l.sendIq)(p,c);if(!f.success)throw new s.ServerStatusCodeError(f.errorCode)}))).apply(this,arguments)}},16116:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getChatThreadLoggingStateDebug=function(){},t.handleActivitiesForChatThreadLogging=function(e){var t,n;return __LOG__(2)`chat_thread_logging: handling ${e.length} message(s)`,null!==(t=null===(n=u())||void 0===n?void 0:n.eventStore.handleMessages(e))&&void 0!==t?t:Promise.resolve()},t.initChatThreadLogging=function(){return p.apply(this,arguments)},t.setThreadDsTimeframeOffset=function(){return f.apply(this,arguments)},t.setThreadIdUserSecret=function(e){var t,n;return __LOG__(2)`chat_thread_logging: setting thread_id_user_secret`,null!==(t=null===(n=u())||void 0===n?void 0:n.metadataStore.setSecret(e))&&void 0!==t?t:Promise.resolve(!1)},t.uploadChatThreadLoggingEvents=function(){return h.apply(this,arguments)};var i=r(n(48926)),a=n(92844),o=n(57849),s=n(36112),l=n(7217),c=n(65120);let d=null;function u(){return null==d&&__LOG__(4,void 0,new Error)`getChatThreadLoggingState: init incomplete!`,d}function p(){return(p=(0,i.default)((function*(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const t=e&&(yield(0,o.getABPropConfigValue)("message_count_logging_md_enabled")),n=new c.ChatThreadLoggingMetadataLocalStorage,r=t?new s.ChatThreadLoggingEventStoreImpl(n):{handleMessages:()=>Promise.resolve(),getEvent:()=>Promise.resolve(),getBeforeInclusive:()=>Promise.resolve([]),deleteBeforeInclusive:()=>Promise.resolve(0)},i=t?new l.ChatThreadLoggingEventUploaderImpl(n,r):{uploadEvents:()=>Promise.resolve(0)},a=yield n.getOffset();return null!=a&&_(a),d={metadataStore:n,eventStore:r,eventUploader:i},Promise.resolve(d)}))).apply(this,arguments)}function f(){return(f=(0,i.default)((function*(e){var t,n;__LOG__(2)`chat_thread_logging: setting offset`;const r=null!==(t=yield null===(n=u())||void 0===n?void 0:n.metadataStore.setOffset(e))&&void 0!==t&&t;return r&&_(e),r}))).apply(this,arguments)}function h(){return(h=(0,i.default)((function*(e){var t,n,r;if(null==(yield null===(t=u())||void 0===t?void 0:t.metadataStore.getOffset()))return void __LOG__(2)`chat_thread_logging: attempting to upload but offset is unset.`;null!=(yield null===(n=u())||void 0===n?void 0:n.metadataStore.getSecret())?yield null===(r=u())||void 0===r?void 0:r.eventUploader.uploadEvents(e):__LOG__(2)`chat_thread_logging: attempting to upload but secret is unset.`}))).apply(this,arguments)}function _(e){const t=(0,a.unixTime)();let n=t-t%86400+e-t;n<0&&(n+=a.DAY_SECONDS),setTimeout((0,i.default)((function*(){var t;yield null===(t=u())||void 0===t?void 0:t.eventUploader.uploadEvents(),_(e)})),1e3*n)}},61840:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.COUNT_FIELD_NAMES=t.COUNT_FIELDS=void 0,t.toMaybeCountActionType=function(e){if(!r.hasOwnProperty(e))return null;return e};const n={profileViews:0,statusViews:0,statusReplies:0,groupMembershipReplies:0,groupPrivateReplies:0,profileReplies:0,chatOverflowClicks:0,pdpViews:0,ordersSent:0},r=Object.freeze(n);t.COUNT_FIELDS=r;const i=Object.freeze(Object.keys(n));t.COUNT_FIELD_NAMES=i},85033:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.computeStartTs=u,t.generateThreadID=function(){return d.apply(this,arguments)},t.getThreadDs=function(e){return(0,s.toDate)((0,s.castToUnixTime)(e-8*s.HOUR_SECONDS)).toISOString().split("T")[0].replace(/-/g,"/")},t.shouldUpdateChatEvent=function(e,t,n){return u(e,t)>n};var i=r(n(48926)),a=n(15688),o=n(11141),s=n(92844);const l=new TextEncoder,c=e=>l.encode(e).buffer;function d(){return(d=(0,i.default)((function*(e,t,n){const r=c(t+n),i=yield(0,o.hmacSha256)(e,r);return(0,a.encodeB64)(i)}))).apply(this,arguments)}function u(e,t){const n=t%s.DAY_SECONDS,r=t-n;return n>=e?r+e:r-s.DAY_SECONDS+e}},36112:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ChatThreadLoggingEventStoreImpl=void 0,t._computeStartTs=function(e,t){const n=t%s.DAY_SECONDS,r=t-n;if(n>e)return r+e;return r-s.DAY_SECONDS+e};var i=r(n(81109)),a=r(n(48926)),o=n(57319),s=n(92844),l=r(n(89867)),c=n(45454),d=n(61840),u=n(60112),p=n(85033),f=n(35673);t.ChatThreadLoggingEventStoreImpl=class{constructor(e,t){this.metadataStore=e,this._getExistingChat=n(9025).getExisting,this._cachedChanges=new Map,this._updateIntervalSeconds=null!=t?t:5,this._shiftTimer=new o.ShiftTimer((()=>{this._flush()}))}handleMessages(e){var t=this;return(0,a.default)((function*(){const n=yield t.metadataStore.getOffset();if(null==n)return void __LOG__(2)`ChatThreadLoggingEventStoreImpl: handleMessages: offset unset.`;const r=yield t.metadataStore.getLastUploadedStartTs();__LOG__(2)`ChatThreadLoggingEventStoreImpl: lastUploadedStartTs=${r}`,e.forEach((e=>{if(!(0,p.shouldUpdateChatEvent)(n,e.ts,r))return;const a=(0,p.computeStartTs)(n,e.ts),o=e.chatId.toString({legacy:!0}),s=o+"_"+String(a),l=t._cachedChanges.get(s),c=null!=l?l:(0,i.default)((0,i.default)({},d.COUNT_FIELDS),{},{startTs:a,chatId:o,addMsgsSent:0,addMsgsReceived:0,addViewOnceMsgsSent:0,addViewOnceMsgsReceived:0,addViewOnceMsgsOpened:0,addCallOffersSent:0,addCallOffersReceived:0,addTotalCallDuration:0});null==l&&t._cachedChanges.set(s,c);const u=(0,d.toMaybeCountActionType)(e.activityType);if(null!=u)c[u]+=1;else switch(e.activityType){case"msgSend":c.addMsgsSent+=1,e.isViewOnce&&(c.addViewOnceMsgsSent+=1);break;case"msgReceive":c.addMsgsReceived+=1,e.isViewOnce&&(c.addViewOnceMsgsReceived+=1);break;case"viewOnceOpen":c.addViewOnceMsgsOpened+=1;break;case"voipCall":e.outgoing?c.addCallOffersSent+=1:c.addCallOffersReceived+=1,c.addTotalCallDuration+=e.durationInSeconds;break;default:__LOG__(3)`Passed event store info type not valid: ${e.activityType}`}})),yield t._setFlushIfNecessary()}))()}_setFlushIfNecessary(){this._shiftTimer.onOrBefore(1e3*this._updateIntervalSeconds)}_flush(){var e=this;return(0,a.default)((function*(){const t=Array.from(e._cachedChanges.values());e._cachedChanges.clear(),yield(0,u.createOrUpdateChatEvents)(t)}))()}_populateEvents(e){var t=this;return(0,a.default)((function*(){const n=yield Promise.all(e.map(function(){var e=(0,a.default)((function*(e){return[e,yield t._getExistingChat((0,c.createWid)(e.chatId))]}));return function(){return e.apply(this,arguments)}}()));return Promise.all(n.map(function(){var e=(0,a.default)((function*(e){var t,n,r,a,o,s,c;let[d,u]=e;const p=l.default.isGroup(d.chatId),h=p?{isAGroup:p,groupSize:null!==(t=null==u||null===(n=u.groupMetadata)||void 0===n?void 0:n.participants.length)&&void 0!==t?t:1}:{isAGroup:p,isAContact:yield(0,f.isAddressBookContact)(d.chatId)},_=(null!==(r=null==u?void 0:u.pin)&&void 0!==r?r:0)>0,g=null!==(a=null==u?void 0:u.archive)&&void 0!==a&&a,m=null!==(o=null==u?void 0:u.getStarredMsgs().length)&&void 0!==o?o:0,y=null!==(s=null==u?void 0:u.unreadCount)&&void 0!==s?s:0,E=0!==(null!==(c=null==u?void 0:u.muteExpiration)&&void 0!==c?c:0);return(0,i.default)((0,i.default)({},d),{},{isPinned:_,isArchived:g,contactInfo:h,messagesStarred:m,messagesUnread:y,isMuted:E})}));return function(){return e.apply(this,arguments)}}()))}))()}getEvent(e,t){var n=this;return(0,a.default)((function*(){n._cachedChanges.size>0&&(yield n._flush());const r=yield(0,u.getChatEvent)(e,t);return null==r?null:(yield n._populateEvents([r]))[0]}))()}getBeforeInclusive(e){var t=this;return(0,a.default)((function*(){return t._cachedChanges.size>0&&(yield t._flush()),t._populateEvents(yield(0,u.getBeforeInclusive)(e))}))()}deleteBeforeInclusive(e){var t=this;return(0,a.default)((function*(){return t._cachedChanges.size>0&&(yield t._flush()),(0,u.deleteBeforeInclusive)(e)}))()}}},7217:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ChatThreadLoggingEventUploaderImpl=void 0;var i=r(n(81109)),a=r(n(48926)),o=r(n(45095)),s=n(92844),l=n(61840),c=n(85033),d=r(n(11339));t.ChatThreadLoggingEventUploaderImpl=class{constructor(e,t){this.eventStore=t,this.metadataStore=e}uploadEvents(e){var t=this;return(0,a.default)((function*(){var n,r;const u=null===(n=null==e?void 0:e.purgeAfter)||void 0===n||n,p=yield t.metadataStore.getOffset();if(null==p)return __LOG__(3)`ChatThreadLoggingBatchEventUploader: offset not in store!`,-1;const f=null!==(r=null==e?void 0:e.lastStartTs)&&void 0!==r?r:(0,c.computeStartTs)(p,(0,s.unixTime)()-s.DAY_SECONDS);if(null==t.secret){const e=yield t.metadataStore.getSecret();if(null==e)return __LOG__(3)`ChatThreadLoggingBatchEventUploader: secret not in store!`,-1;t.secret=e}const h=yield t.eventStore.getBeforeInclusive(f);try{yield Promise.all(h.map(function(){var e=(0,a.default)((function*(e){const n=(0,c.getThreadDs)(e.startTs),r=e.contactInfo;new d.default.ChatMessageCounts((0,i.default)((0,i.default)({},l.COUNT_FIELD_NAMES.reduce(((t,n)=>(t[n]=e[n],t)),{})),{},{messagesSent:e.msgsSent,messagesReceived:e.msgsReceived,viewOnceMessagesSent:e.viewOnceMsgsSent,viewOnceMessagesReceived:e.viewOnceMsgsReceived,viewOnceMessagesOpened:e.viewOnceMessagesOpened,threadDs:n,threadId:yield(0,c.generateThreadID)((0,o.default)(t.secret,"_this.secret"),e.chatId,n),isAGroup:e.contactInfo.isAGroup,groupSize:r.isAGroup?r.groupSize:void 0,isAContact:r.isAGroup?void 0:r.isAContact,isArchived:e.isArchived,isPinned:e.isPinned,messagesStarred:e.messagesStarred,messagesUnread:e.messagesUnread,chatMuted:e.isMuted?d.default.CHAT_MUTED_TYPE.MUTED_NO_NOTIFICATIONS:d.default.CHAT_MUTED_TYPE.NOT_MUTED,callOffersSent:e.callOffersSent,callOffersReceived:e.callOffersReceived,totalCallDuration:e.totalCallDuration})).commit()}));return function(){return e.apply(this,arguments)}}()))}catch(e){__LOG__(4,void 0,new Error,!0)`chat_thread_logging: error uploading events: ${e.toString()}`,SEND_LOGS("thread-logging-upload-failure")}if(u){const e=yield t.eventStore.deleteBeforeInclusive(f);e!==h.length&&__LOG__(4,void 0,new Error)`uploadEvents: uploaded ${h.length} events but only deleted ${e} (they should be the same!)`}return yield t.metadataStore.setLastUploadedStartTs(f),h.length}))()}}},65120:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChatThreadLoggingMetadataLocalStorage=void 0;var r=n(15688),i=n(58052);t.ChatThreadLoggingMetadataLocalStorage=class{constructor(){null==(0,i.getChatThreadLoggingLastUploadedStartTs)()&&(0,i.setChatThreadLoggingLastUploadedStartTs)(0)}setOffset(e){return(0,i.setChatThreadLoggingOffset)(e),Promise.resolve(!0)}getOffset(){return Promise.resolve((0,i.getChatThreadLoggingOffset)())}setSecret(e){return(0,i.setChatThreadLoggingSecretB64)((0,r.encodeB64)(e)),Promise.resolve(!0)}getSecret(){const e=(0,i.getChatThreadLoggingSecretB64)();return null==e?Promise.resolve():Promise.resolve((0,r.decodeB64)(e))}setLastUploadedStartTs(e){return(0,i.setChatThreadLoggingLastUploadedStartTs)(e),Promise.resolve(!0)}getLastUploadedStartTs(){var e;return Promise.resolve(null!==(e=(0,i.getChatThreadLoggingLastUploadedStartTs)())&&void 0!==e?e:0)}}},99609:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.clearDirtyBits=function(){return c.apply(this,arguments)};var i=r(n(48926)),a=n(31914),o=n(71914),s=n(24747);const l=new o.WapParser("cleanDirtyReplyParser",(e=>(e.assertAttr("type","result"),{})));function c(){return(c=(0,i.default)((function*(e){if(0===e.length)return;const t=e.map((e=>(0,a.wap)("clean",{type:(0,a.CUSTOM_STRING)(e.type),timestamp:(0,a.INT)(e.timestamp)}))),n=(0,a.wap)("iq",{to:a.S_WHATSAPP_NET,type:"set",xmlns:"urn:xmpp:whatsapp:dirty",id:(0,a.generateId)()},t);try{yield(0,s.sendIq)(n,l),__LOG__(2)`clearDirtyBits: success for type: ${e.map((e=>e.type)).join(",")}`}catch(e){__LOG__(3)`clearDirtyBits: failed with error`}}))).apply(this,arguments)}},58853:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.encodeMaybeMediaType=t.encodeMaybeDecryptFail=t.CIPHERTEXT_VERSION=void 0,t.encodeMediaType=s,t.maybeEncoder=l,t.mediaTypeFromProtobuf=function e(t){if(t.deviceSentMessage){const{message:n}=t.deviceSentMessage;return n?e(n):null}if(t.ephemeralMessage){const{message:n}=t.ephemeralMessage;return n?e(n):null}if(t.viewOnceMessage){const{message:n}=t.viewOnceMessage;return n?e(n):null}if(t.imageMessage)return a.MediaType.Photo;if(t.stickerMessage)return a.MediaType.Sticker;if(t.locationMessage)return a.MediaType.LiveLocation;if(t.contactMessage)return a.MediaType.Contact;if(t.contactsArrayMessage)return a.MediaType.ContactArray;if(t.documentMessage)return a.MediaType.Document;if(t.audioMessage)return t.audioMessage.ptt?a.MediaType.Ptt:a.MediaType.Audio;if(t.videoMessage)return t.videoMessage.gifPlayback?a.MediaType.Gif:a.MediaType.Video;if(t.buttonsMessage)return a.MediaType.Button;if(t.buttonsResponseMessage)return a.MediaType.ButtonResponse;if(t.listMessage)return a.MediaType.List;if(t.listResponseMessage)return a.MediaType.ListResponse;if(t.orderMessage)return a.MediaType.Order;if(t.productMessage)return a.MediaType.Product;if(t.groupInviteMessage)return a.MediaType.Url;return null},t.metricsCiphertextType=function(e){switch(e){case a.CiphertextType.Skmsg:return o.default.E2E_CIPHERTEXT_TYPE.SENDER_KEY_MESSAGE;case a.CiphertextType.Pkmsg:return o.default.E2E_CIPHERTEXT_TYPE.PREKEY_MESSAGE;case a.CiphertextType.Msg:return o.default.E2E_CIPHERTEXT_TYPE.MESSAGE}},t.metricsDestinationType=function(e){if(e.isUser())return o.default.E2E_DESTINATION.INDIVIDUAL;if(e.isGroup())return o.default.E2E_DESTINATION.GROUP;if(e.isStatusV3())return o.default.E2E_DESTINATION.STATUS;if(e.isBroadcast())return o.default.E2E_DESTINATION.LIST;throw new Error},t.metricsMediaType=function(e){switch(e){case a.MediaType.Photo:return o.default.MEDIA_TYPE.PHOTO;case a.MediaType.Video:return o.default.MEDIA_TYPE.VIDEO;case a.MediaType.Audio:return o.default.MEDIA_TYPE.AUDIO;case a.MediaType.Ptt:return o.default.MEDIA_TYPE.PTT;case a.MediaType.Location:return o.default.MEDIA_TYPE.LOCATION;case a.MediaType.Contact:return o.default.MEDIA_TYPE.CONTACT;case a.MediaType.Document:return o.default.MEDIA_TYPE.DOCUMENT;case a.MediaType.Url:return o.default.MEDIA_TYPE.URL;case a.MediaType.Call:return o.default.MEDIA_TYPE.CALL;case a.MediaType.Gif:return o.default.MEDIA_TYPE.GIF;case a.MediaType.Future:return o.default.MEDIA_TYPE.FUTURE;case a.MediaType.ContactArray:return o.default.MEDIA_TYPE.CONTACT_ARRAY;case a.MediaType.LiveLocation:return o.default.MEDIA_TYPE.LIVE_LOCATION;case a.MediaType.ProfilePic:return o.default.MEDIA_TYPE.PROFILE_PIC;case a.MediaType.Sticker:return o.default.MEDIA_TYPE.STICKER;case a.MediaType.Hsm:return o.default.MEDIA_TYPE.HSM;case a.MediaType.ProductImage:return o.default.MEDIA_TYPE.PRODUCT_IMAGE;case a.MediaType.Template:return o.default.MEDIA_TYPE.TEMPLATE;case a.MediaType.MdAppState:return o.default.MEDIA_TYPE.MD_APP_STATE;case a.MediaType.MdHistorySync:return o.default.MEDIA_TYPE.MD_HISTORY_SYNC;case a.MediaType.List:return o.default.MEDIA_TYPE.LIST;case a.MediaType.ListResponse:return o.default.MEDIA_TYPE.LIST_REPLY;case a.MediaType.Button:return o.default.MEDIA_TYPE.BUTTON_MESSAGE;case a.MediaType.ButtonResponse:return o.default.MEDIA_TYPE.BUTTON_RESPONSE_MESSAGE;case a.MediaType.Order:return o.default.MEDIA_TYPE.ORDER;case a.MediaType.Product:return o.default.MEDIA_TYPE.PRODUCT_IMAGE}};var i=n(31914),a=n(45033),o=r(n(11339));function s(e){const t=(()=>{switch(e){case a.MediaType.Photo:return"image";case a.MediaType.Video:return"video";case a.MediaType.Audio:return"audio";case a.MediaType.Ptt:return"ptt";case a.MediaType.Contact:return"vcard";case a.MediaType.Document:return"document";case a.MediaType.Gif:return"gif";case a.MediaType.ContactArray:return"contact_array";case a.MediaType.LiveLocation:return"livelocation";case a.MediaType.Sticker:return"sticker";case a.MediaType.List:return"list";case a.MediaType.ListResponse:return"list_response";case a.MediaType.ButtonResponse:return"buttons_response";case a.MediaType.Order:return"order";case a.MediaType.Product:return"product";case a.MediaType.Url:return"url";default:return null}})();if(t)return(0,i.CUSTOM_STRING)(t);throw new Error("Unsupported type")}function l(e){return t=>null==t?i.DROP_ATTR:e(t)}t.CIPHERTEXT_VERSION=2;const c=l(s);t.encodeMaybeMediaType=c;const d=l((()=>(0,i.CUSTOM_STRING)("hide")));t.encodeMaybeDecryptFail=d},65508:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseErrorFields=void 0;const r=new(n(71914).WapParser)("parseErrorFields",(e=>{const t=[];return e.forEachChildWithTag("field",(e=>{const n=e.hasAttr("detail")?e.maybeAttrString("detail"):null;t.push({name:e.attrString("name"),reason:e.attrString("reason"),detail:n})})),t}));t.parseErrorFields=r},76199:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=e.maybeChild("address"),n=t?t.contentString():void 0,r=e.maybeChild("description"),o=r?r.contentString():void 0,s=e.maybeChild("email"),l=s?s.contentString():void 0,c=e.maybeChild("latitude"),d=c?parseFloat(c.contentString()):void 0,u=e.maybeChild("longitude"),p=u?parseFloat(u.contentString()):void 0,f=e.maybeChild("vertical");let h;if(f){const e=f.maybeAttrString("canonical"),t=f.hasContent()?f.contentString():void 0;h={name:t,canonical:e}}const _=[];e.forEachChildWithTag("website",(e=>{_.push(e.contentString())}));const g=[],m=e.maybeChild("categories");m&&m.forEachChildWithTag("category",(e=>{const t=e.attrString("id");g.push({id:t,localized_display_name:e.contentString()})}));let y;const E=e.maybeChild("business_hours");if(E){const e=E.maybeAttrString("timezone"),t=[];E.forEachChildWithTag("business_hours_config",(e=>{t.push({day_of_week:e.attrString("day_of_week"),mode:e.attrString("mode"),open_time:e.hasAttr("open_time")?parseInt(e.attrString("open_time"),10):0,close_time:e.hasAttr("close_time")?parseInt(e.attrString("close_time"),10):0})})),y={config:t,timezone:e}}let S;const v=e.maybeChild("profile_options");if(v){S={};const e=v.maybeChild("commerce_experience");var T;if(e)S.commerce_experience=null!==(T=a.COMMERCE_EXPERIENCE_TYPES.cast(e.contentString()))&&void 0!==T?T:a.COMMERCE_EXPERIENCE_TYPES.NONE;const t=v.maybeChild("cart_enabled");t&&(S.cart_enabled="true"===t.contentString());const n=v.maybeChild("shop_url");n&&(S.shop_url=n.contentString());const r=v.maybeChild("commerce_manager_url");r&&(S.commerce_manager_url=r.contentString());const i=v.maybeChild("is_banned");i&&(S.is_banned="true"===i.contentString());const o=v.maybeChild("direct_connection");o&&(S.direct_connection="true"===o.contentString())}const b=e.maybeChild("direct_connection");let C;if(b){const e=b.maybeChild("default_postcode");C={enabled:"true"===b.maybeAttrString("enabled"),defaultPostcode:e?{code:e.attrString("code"),locationName:e.attrString("location_name")}:void 0}}const A=e.maybeChild("catalog_status"),P=A?A.attrString("status"):void 0;let M,O,I;const w=e.maybeChild("linked_accounts");if(w){I=!0;const e=w.maybeChild("fb_page");if(e){const t=e.maybeChild("display_name"),n=e.maybeChild("likes");M={displayName:null==t?void 0:t.contentString(),likes:null==n?void 0:n.contentString(),id:e.maybeAttrString("id")}}const t=w.maybeChild("ig_professional");if(t){const e=t.maybeChild("ig_handle"),n=t.maybeChild("followers");O={handle:null==e?void 0:e.contentString(),followers:null==n?void 0:n.contentString()}}}const R={address:n,description:o,email:l,latitude:d,longitude:p,vertical:h,website:_,categories:g,business_hours:y,catalog_status:P,profile_options:S,fbPage:M,igProfessional:O,isProfileLinked:I,directConnection:C};return(0,i.default)(R)};var i=r(n(70740)),a=n(93170)},27874:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=e.attrEnum("verified_level",i.MSG_VERIFIED_LEVEL),n=e.hasContent()?e.contentBytes():null,o=e.maybeAttrString("serial"),{serial:s,name:l,isApi:c}=n&&function(e){const t=(0,a.getParsedProtoObjects)(e);if(null==t?void 0:t.details){const{name:e,serial:n,isApi:r}=(0,a.extractCertificateDetailsParams)(t.details);return{name:e,serial:String(n),isApi:r}}}(n)||{},d=r.ActualActorsEnumType.cast(e.maybeAttrInt("actual_actors")),u=r.HostStorageEnumType.cast(e.maybeAttrInt("host_storage")),p=e.maybeAttrInt("privacy_mode_ts");return{level:t,serial:o||s,name:l,isApi:!0===c,privacyMode:null!=d&&null!=u&&null!=p?{actualActors:d,hostStorage:u,privacyModeTs:p}:null}};var r=n(49714),i=n(12037),a=n(51836)},40376:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.digestKey=function(){return p.apply(this,arguments)};var i=r(n(48926)),a=n(15688),o=n(31914),s=n(71914),l=n(24747),c=n(11849),d=n(46669);const u=new s.WapParser("digestResponseParser",(e=>{const t=e.child("digest"),n=t.child("skey");return{regId:t.child("registration").contentUint(4),type:t.child("type").contentUint(1),identity:t.child("identity").contentBytes(32),skey:{id:n.child("id").contentUint(3),pubkey:n.child("value").contentBytes(32),signature:n.child("signature").contentBytes(64)},keys:t.child("list").mapChildren((e=>e.contentUint(3))),hash:t.child("hash").contentBytes(20)}}));function p(){return(p=(0,i.default)((function*(){const e=(0,o.wap)("iq",{xmlns:"encrypt",type:"get",to:o.S_WHATSAPP_NET,id:(0,o.generateId)()},(0,o.wap)("digest",null)),t=yield(0,l.sendIq)(e,u);let n=null;if(t.success)try{yield f(t.result),n=!1}catch(e){n=!1}else{const e=t.errorCode;404===e?(__LOG__(3)`digestKey: no record found for current user`,n=!0):406===e?(__LOG__(3)`digestKey: malformed request`,n=!1):503===e?(__LOG__(3)`digestKey: service unavailable`,n=!1):(__LOG__(3)`digestKey: server error ${e}`,n=!1)}if(null!=n&&n)return __LOG__(2)`digestKey: validate key bundle failed, upload prekeys again`,(0,d.uploadPreKeys)()}))).apply(this,arguments)}function f(){return h.apply(this,arguments)}function h(){return(h=(0,i.default)((function*(e){const[t,n]=yield Promise.all([c.waSignalStore.getRegistrationInfo(),c.waSignalStore.getSignedPreKey()]);if(!t||!n)throw new Error("validateLocalKeyBundle: No registration info is available");if(e.regId!==t.registrationId)throw new Error("validateLocalKeyBundle: registation id mismatch");const r=t.identityKeyPair.pubKey,o=n.keyPair.pubKey,s=r.byteLength+o.byteLength+n.signature.byteLength+32*e.keys.length,l=new Uint8Array(s);let d=0;[r,o,n.signature].forEach((e=>{l.set(new Uint8Array(e),d),d+=e.byteLength}));const u=e.keys.map(function(){var e=(0,i.default)((function*(e){const t=yield c.waSignalStore.getPreKeyById(e);if(!t)throw Error(`validateLocalKeyBundle: missing prekey record for id ${e}`);return t.keyPair.pubKey}));return function(){return e.apply(this,arguments)}}());(yield Promise.all(u)).forEach((e=>{l.set(new Uint8Array(e),d),d+=e.byteLength}));const p=yield self.crypto.subtle.digest("SHA-1",l),f=(0,a.encodeB64)(p),h=(0,a.encodeB64)(e.hash);if(f!==h)throw Error(`validateLocalKeyBundle: hash mismatch remote:${h} local:${f}`);__LOG__(2)`validateLocalKeyBundle: success`}))).apply(this,arguments)}},66457:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return l.apply(this,arguments)};var i=r(n(48926)),a=r(n(89867)),o=n(79942),s=n(52284);function l(){return(l=(0,i.default)((function*(e){if(!a.default.isWid(e)||!e.isUser())return __LOG__(3)`getAbout: this method should only take user wid, instead it received: ${e}`,Promise.resolve({id:e});const t=(new s.USyncQuery).withContext("interactive").withMode("query").withStatusProtocol().withUser((new o.USyncUser).withId(e)),n=yield t.execute();if(n.error.all||n.error.status){const t=n.error.all||n.error.status;return __LOG__(3)`getAbout: failed ${t.errorCode} : ${t.errorText}`,{id:e,error:t}}const r=n.list;return r.length||Promise.reject(new Error("no status data returned for user")),{id:e,status:r[0].status}}))).apply(this,arguments)}},37790:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getBlocklist=function(){return f.apply(this,arguments)};var i=r(n(48926)),a=n(31914),o=n(71914),s=n(81663),l=n(24747),c=n(99234),d=n(39410);const u=new o.WapParser("getBlocklistParser",(e=>e.hasChild("error")&&404===e.child("error").attrInt("code")?{wids:[]}:{wids:p(e)}));function p(e){return e.child("query").child("list").mapChildrenWithTag("item",(e=>(0,s.userJidToUserWid)(e.attrPhoneUserJid("value"))))}function f(){return(f=(0,i.default)((function*(){const e=yield(0,l.sendIq)((0,a.wap)("iq",{xmlns:"jabber:iq:privacy",from:(0,d.JID)((0,c.assertGetMe)()),type:"get",id:(0,a.generateId)()},(0,a.wap)("query",null,(0,a.wap)("list",{name:"default"}))),u);if(e.success)return __LOG__(2)`getBlocklist from server`,e.result;const{errorCode:t,errorText:n}=e;return __LOG__(3)`getBlocklist: failed ${t}, ${n}`,{errorCode:t,errorText:n}}))).apply(this,arguments)}},88445:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getDisappearingMode=function(){return l.apply(this,arguments)};var i=r(n(48926)),a=r(n(89867)),o=n(79942),s=n(52284);function l(){return(l=(0,i.default)((function*(e){if(!a.default.isWid(e)||!e.isUser())return __LOG__(3)`getDisappearingMode: this method should only take user wid, instead it received: ${e}`,Promise.resolve({id:e});const t=(new s.USyncQuery).withContext("interactive").withMode("query").withDisappearingModeProtocol().withUser((new o.USyncUser).withId(e)),n=yield t.execute();if(n.error.all||n.error.status){const t=n.error.all||n.error.status;return __LOG__(3)`getDisappearingMode: failed ${t.errorCode} : ${t.errorText}`,{id:e,error:t}}const r=n.list;0!==r.length&&null!=r[0].disappearing_mode||Promise.reject(new Error("no disappearing_mode data returned for user"));const{duration:i,t:l}=r[0].disappearing_mode;return{id:e,disappearingModeDuration:i,disappearingModeSettingTimestamp:l}}))).apply(this,arguments)}},53379:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getAndStoreIdentityKeys=function(){return h.apply(this,arguments)},t.getIdentityKeys=_;var i=r(n(48926)),a=n(31914),o=n(71914),s=n(81663),l=n(24747),c=n(53614),d=r(n(76128)),u=n(93832),p=n(39410);const f=new o.WapParser("identityKeysParser",(e=>e.child("list").mapChildren((e=>{if(e.hasChild("error")){const t=e.child("error"),n=t.attrInt("code"),r=t.attrString("text");throw new Error(`identityKeysParser bad response: ${n} ${r}`)}return{type:e.child("type").contentBytes(1),identity:e.child("identity").contentBytes(32),user:(0,s.deviceJidToDeviceWid)(e.attrPhoneDeviceJid("jid"))}}))));function h(){return(h=(0,i.default)((function*(e){const t=yield d.default.bulkLoadIdentityKey(e.map((e=>String((0,u.createSignalAddress)(e))))),n=e.filter(((e,n)=>null==t[n]));if(0===n.length)return void __LOG__(2)`getAndStoreIdentityKeys: got 0 missing keys`;__LOG__(2)`getAndStoreIdentityKeys: query ${n.length} missing keys for ${e.length} contacts`;const r=(yield _(n)).map((e=>{const t=e.identity,n=(0,c.toSignalCurvePubKey)(t.buffer.slice(t.byteOffset,t.byteLength+t.byteOffset));return{identityKey:(0,u.bufferToStr)(n),identifier:(0,u.createSignalAddress)(e.user).toString()}}));return d.default.bulkCreateIdentity(r)}))).apply(this,arguments)}function _(){return g.apply(this,arguments)}function g(){return(g=(0,i.default)((function*(e){const t=e.map((e=>(0,a.wap)("user",{jid:(0,p.DEVICE_JID)(e)}))),n=(0,a.wap)("iq",{xmlns:"encrypt",type:"get",to:a.S_WHATSAPP_NET,id:(0,a.generateId)()},(0,a.wap)("identity",null,t)),r=yield(0,l.sendIq)(n,f);if(!r.success)throw new Error(`getIdentityKeys bad response ${String(r)}`);return r.result}))).apply(this,arguments)}},94943:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getProfilePic=function(){return p.apply(this,arguments)};var i=r(n(48926)),a=n(31914),o=n(71914),s=n(92574),l=n(24747),c=n(39410);const d={preview:"preview",image:"image"},u=new o.WapParser("profilePicParser",(e=>{const t=e.child("picture");return{id:t.attrInt("id"),type:t.attrEnum("type",d),url:t.attrString("url")}}));function p(){return(p=(0,i.default)((function*(e,t){e.isBroadcast()&&(__LOG__(4,!0,new Error,!0)`getProfilePic failed with a broadcast WID type target}`,SEND_LOGS("getProfilePic failed with a broadcast WID type target"));const{preview:n,invite:r,photoId:i,parentGroupId:o}=t;let d,p,f,h=null;null!=o?(d=(0,c.CHAT_JID)(o),p=a.DROP_ATTR,f="w:g2",h=(0,a.wap)("query_linked",{type:e===o?"parent_group":"sub_group",jid:(0,c.CHAT_JID)(e)})):(d=a.S_WHATSAPP_NET,p=(0,c.CHAT_JID)(e),f="w:profile:picture");const _=(0,a.wap)("iq",{to:d,target:p,type:"get",xmlns:f,id:(0,a.generateId)()},(0,a.wap)("picture",{invite:(0,a.MAYBE_CUSTOM_STRING)(r),type:n?"preview":a.DROP_ATTR,id:null!=i?(0,a.INT)(i):a.DROP_ATTR,query:"url"},h)),g=yield(0,l.sendIq)(_,u);if(!g.success)return Promise.reject(new s.ServerStatusCodeError(g.errorCode,g.errorText));const{id:m,url:y,type:E}=g.result;return __LOG__(2)`getProfilePic: ${e.toString()} ${m}, ${E}, ${y}`,{tag:m.toString(),eurl:y,type:E}}))).apply(this,arguments)}},26539:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.createGroup=function(){return g.apply(this,arguments)};var i=r(n(48926)),a=n(87614),o=n(31914),s=n(71914),l=n(92574),c=n(81663),d=n(45454),u=n(24747),p=n(46920),f=r(n(11339)),h=n(39410);const _=new s.WapParser("createGroupReplyParser",(e=>{var t;const n=e.child("group");let r;try{r=(0,d.createWid)(`${n.attrString("id")}@g.us`)}catch(e){}if(!(null===(t=r)||void 0===t?void 0:t.isGroup))throw Error("createGroupReplyParser: invalid group id");return{wid:r,subject:n.attrString("subject"),creator:(0,c.userJidToUserWid)(n.attrPhoneUserJid("creator")),ts:n.attrTime("creation"),participants:n.mapChildrenWithTag("participant",(e=>{const t=e.maybeChild("add_request");return{wid:(0,c.userJidToUserWid)(e.attrPhoneUserJid("jid")),error:e.hasAttr("error")?e.attrInt("error"):null,invite_code:t&&t.attrString("code"),invite_code_exp:t&&t.attrString("expiration"),type:e.attrEnumOrDefault("type",p.GROUP_PARTICIPANT_TYPES,"participant")}}))}}));function g(){return(g=(0,i.default)((function*(e,t,n,r){const i=(0,a.randomHex)(8),s=t.map((e=>(0,o.wap)("participant",{jid:(0,h.USER_JID)(e)})));null!=n&&0!==n&&s.unshift((0,o.wap)("ephemeral",{expiration:(0,o.INT)(n)})),null!=r&&s.unshift((0,o.wap)("linked_parent",{jid:(0,h.GROUP_JID)(r)}));const c=(0,o.wap)("iq",{to:o.G_US,type:"set",xmlns:"w:g2",id:(0,o.generateId)()},(0,o.wap)("create",{subject:(0,o.CUSTOM_STRING)(e),key:(0,o.CUSTOM_STRING)(i)},s)),d=yield(0,u.sendIq)(c,_);return d.success?(new f.default.GroupCreateC({}).commit(),d.result):Promise.reject(new l.ServerStatusCodeError(d.errorCode,d.errorText))}))).apply(this,arguments)}},12594:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.leaveGroups=function(){return p.apply(this,arguments)};var i=r(n(48926)),a=n(31914),o=n(71914),s=n(92574),l=n(81663),c=n(24747),d=n(39410);const u=new o.WapParser("leaveGroupResultParser",(e=>{e.assertAttr("type","result");return{groups:e.child("leave").mapChildren((e=>(0,l.groupJidToWid)(e.attrGroupJid("id"))))}}));function p(){return(p=(0,i.default)((function*(e){const t=e.map((e=>(0,a.wap)("group",{id:(0,d.GROUP_JID)(e)}))),n=(0,a.wap)("iq",{to:a.G_US,type:"set",xmlns:"w:g2",id:(0,a.generateId)()},(0,a.wap)("leave",null,t)),r=yield(0,c.sendIq)(n,u);return r.success?r.result:Promise.reject(new s.ServerStatusCodeError(r.errorCode,r.errorText))}))).apply(this,arguments)}},82394:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.joinGroupViaInviteV4=function(){return _.apply(this,arguments)},t.queryGroupInviteV4=function(){return p.apply(this,arguments)},t.revokeGroupInviteV4=function(){return g.apply(this,arguments)};var i=r(n(81109)),a=r(n(48926)),o=n(31914),s=n(71914),l=n(81663),c=n(24747),d=n(2182);const u=new s.WapParser("queryGroupInviteV4Parser",(e=>{if(e.hasChild("error")){const t=e.child("error");return{errorCode:t.attrInt("code"),errorText:t.attrString("text")}}return e.hasChild("group")?{groupMetadata:(0,d.parseGroupNode)(e.child("group"))}:{phashMatch:!0}}));function p(){return(p=(0,a.default)((function*(e,t,n,r,a){const s=(0,o.wap)("iq",{to:(0,o.CUSTOM_STRING)(n),type:"get",xmlns:"w:g2",id:(0,o.generateId)()},(0,o.wap)("query",{phash:(0,o.MAYBE_CUSTOM_STRING)(a)},(0,o.wap)("add_request",{code:(0,o.CUSTOM_STRING)(e),expiration:(0,o.CUSTOM_STRING)(t),admin:(0,o.CUSTOM_STRING)(r)}))),l=yield(0,c.sendIq)(s,u);if(!l.success)return __LOG__(2)`parsing failed for queryGroupInviteV4: ${JSON.stringify(l)}`,{status:500};const d=l.result,p={status:null!=d.errorCode&&d.errorCode>0?d.errorCode:200};return d.groupMetadata?(0,i.default)((0,i.default)({},p),{},{groupMetadata:d.groupMetadata}):p}))).apply(this,arguments)}const f=new s.WapParser("joinGroupViaInviteV4Parser",(e=>{if(e.hasChild("error")){const t=e.child("error");return{errorCode:t.attrInt("code"),errorText:t.attrString("text"),groupId:(0,l.groupJidToWid)(t.attrGroupJid("from"))}}return{groupId:(0,l.groupJidToWid)(e.attrGroupJid("from"))}})),h=new s.WapParser("revokeGroupV4Parser",(e=>{if(e.hasChild("error")){const t=e.child("error");return{errorCode:t.attrInt("code"),errorText:t.attrString("text")}}const t=e.child("revoke"),n=[];return t.mapChildrenWithTag("participant",(e=>{e.hasAttr("error")||n.push((0,l.userJidToUserWid)(e.attrPhoneUserJid("jid")))})),{revokedUsers:n}}));function _(){return(_=(0,a.default)((function*(e,t,n,r){const i=(0,o.wap)("iq",{to:(0,o.CUSTOM_STRING)(n),type:"set",xmlns:"w:g2",id:(0,o.generateId)()},(0,o.wap)("accept",{code:(0,o.CUSTOM_STRING)(e),expiration:(0,o.CUSTOM_STRING)(t),admin:(0,o.CUSTOM_STRING)(r)})),a=yield(0,c.sendIq)(i,f);if(!a.success)return __LOG__(2)`joinGroupV4Parser: parsing failed ${a.errorCode}:${a.errorType}`,{status:500};const s=a.result;return{status:null!=s.errorCode&&s.errorCode>0?s.errorCode:200,gid:s.groupId}}))).apply(this,arguments)}function g(){return(g=(0,a.default)((function*(e,t){const n=(0,o.wap)("iq",{to:(0,o.CUSTOM_STRING)(t),type:"set",xmlns:"w:g2",id:(0,o.generateId)()},(0,o.wap)("revoke",null,e.map((e=>(0,o.wap)("participant",{jid:(0,o.CUSTOM_STRING)(e)}))))),r=yield(0,c.sendIq)(n,h);if(!r.success)return __LOG__(2)`revokeGroupV4Parser: parsing failed ${r.errorCode}:${r.errorType}`,{status:500};const i=r.result;return{status:null!=i.errorCode&&i.errorCode>0?i.errorCode:200}}))).apply(this,arguments)}},85057:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.queryAllGroups=function(){return p.apply(this,arguments)},t.queryGroupInvite=function(){return f.apply(this,arguments)};var i=r(n(48926)),a=n(31914),o=n(71914),s=n(92574),l=n(24747),c=n(2182);const d=new o.WapParser("queryGroupParser",(e=>e.hasChild("group")?(0,c.parseGroupNode)(e.child("group")):{phashMatch:!0})),u=new o.WapParser("queryAllGroupParser",(e=>e.child("groups").mapChildren(c.parseGroupNode)));function p(){return(p=(0,i.default)((function*(){const e=(0,a.wap)("iq",{to:a.G_US,type:"get",xmlns:"w:g2",id:(0,a.generateId)()},(0,a.wap)("participating",null,(0,a.wap)("participants",null),(0,a.wap)("description",null))),t=yield(0,l.sendIq)(e,u);return t.success?t.result:(__LOG__(2)`queryAllGroups failed: ${t.errorCode}:${t.errorType}`,Promise.reject(new s.ServerStatusCodeError(t.errorCode,t.errorText)))}))).apply(this,arguments)}function f(){return(f=(0,i.default)((function*(e){const t=(0,a.wap)("iq",{to:a.G_US,type:"get",xmlns:"w:g2",id:(0,a.generateId)()},(0,a.wap)("invite",{code:(0,a.CUSTOM_STRING)(e)})),n=yield(0,l.sendIq)(t,d);return n.success?n.result:(__LOG__(2)`queryGroupInvite failed: ${n.errorCode}:${n.errorType}`,Promise.reject(new s.ServerStatusCodeError(n.errorCode,n.errorText)))}))).apply(this,arguments)}},45823:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.NOTIFICATION_TYPE=void 0,t.handleAboutNotification=function(e){const t=u.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.reject(t.error);return function(e){switch(__LOG__(2)`handleAboutNotification: received ${e.type}
for ${e.from.toString()}`,e.type){case d.SIDE_LIST_CHANGE:break;case d.CHANGE:const t=l.StatusCollection.get(e.from);t?t.status=e.content:__LOG__(3)`handleAboutNotification: get status update for unknown contact ${e.from}`;break;default:__LOG__(3)`handleAboutNotification: unhandled notification of
type ${e.type}`}return(0,a.wap)("ack",{id:(0,a.CUSTOM_STRING)(e.stanzaId),to:"change"===e.type?(0,c.JID)(e.from):(0,a.CUSTOM_STRING)(e.from),class:"notification",type:"status"})}(t.success)};var i=r(n(81109)),a=n(31914),o=n(71914),s=n(81663),l=n(46133),c=n(39410);const d=Object.freeze({CHANGE:"change",SIDE_LIST_CHANGE:"sideListChange",UNKNOWN:"unknown"});t.NOTIFICATION_TYPE=d;const u=new o.WapParser("incomingAboutNotification",(e=>{e.assertTag("notification");const t={stanzaId:e.attrString("id")},n=e.hasChild("set")&&e.child("set");if(n&&!n.hasAttr("hash"))return(0,i.default)({type:d.CHANGE,from:(0,s.userJidToUserWid)(e.attrPhoneUserJid("from")),pushname:e.attrString("notify"),content:n.contentString(),ts:e.attrTime("t")},t);let r=d.UNKNOWN;return n&&n.hasAttr("hash")&&(r=d.SIDE_LIST_CHANGE),(0,i.default)({type:r,from:e.attrString("from")},t)}))},40126:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getAndUpdateStatus=M,t.handleAccountSyncNotification=function(){return I.apply(this,arguments)};var i=r(n(48926)),a=r(n(81109)),o=n(52230),s=n(31914),l=n(71914),c=n(88555),d=n(81663),u=n(45454),p=n(41075),f=n(88102),h=n(91036),_=r(n(69153)),g=n(99234),m=r(n(66457)),y=n(88445),E=n(54181),S=n(28237),v=n(41566),T=n(97153),b=n(46133),C=n(39410);const A=e=>{const t=e.maybeChild("key-index-list"),n=null==t?null:{ts:t.attrTime("ts"),signedKeyIndexBytes:t.hasContent()?t.contentBytes():null,expectedTs:t.hasAttr("expected_ts")?t.attrTime("expected_ts"):void 0},r=e.mapChildrenWithTag("device",(e=>({id:(0,u.createWid)(e.attrDeviceJid("jid")).device||o.DEFAULT_DEVICE_ID,keyIndex:e.hasAttr("key-index")?e.attrInt("key-index"):null})));return 0===r.length?null:{deviceList:r,keyIndex:n}},P=new l.WapParser("incomingAccountSyncNotification",(e=>{e.assertTag("notification");const t={stanzaId:e.attrString("id"),ts:e.attrTime("t"),from:(0,d.deviceJidToDeviceWid)(e.attrPhoneDeviceJid("from"))};if(e.hasChild("status")){const n=e.child("status"),r=n.hasAttr("action")?n.attrString("action"):void 0;return(0,a.default)({type:p.ACCOUNT_SYNC_TYPE.STATUS,action:r},t)}if(e.hasChild("privacy"))return(0,a.default)({type:p.ACCOUNT_SYNC_TYPE.PRIVACY},t);if(e.hasChild("devices"))return(0,a.default)({type:p.ACCOUNT_SYNC_TYPE.DEVICES,devices:A(e.child("devices"))},t);if(e.hasChild("blocklist"))return(0,a.default)({type:p.ACCOUNT_SYNC_TYPE.BLOCKLIST},t);if(e.hasChild("picture"))return(0,a.default)({type:p.ACCOUNT_SYNC_TYPE.PICTURE},t);if(e.hasChild("tos")){const n=e.child("tos"),r=[];return n.forEachChildWithTag("notice",(e=>{const t="false"!==e.maybeAttrString("state"),n=e.attrString("id");r.push({id:n,state:t})})),(0,a.default)({type:p.ACCOUNT_SYNC_TYPE.TOS,notices:r},t)}if(e.hasChild("disappearing_mode")){const n=e.child("disappearing_mode");let r,i,o;return n.hasAttr("action")?r=n.attrString("action"):(i=n.attrInt("duration"),o=n.attrInt("t")),(0,a.default)((0,a.default)({},t),{},{type:p.ACCOUNT_SYNC_TYPE.DISAPPEARING_MODE,action:r,disappearingModeDuration:i,disappearingModeSettingTimestamp:o})}throw new Error("notification type not supported")}));function M(){return O.apply(this,arguments)}function O(){return(O=(0,i.default)((function*(){const e=(0,g.assertGetMe)(),t=yield(0,m.default)(e);if(t.error)return __LOG__(3)`getStatus failed for ${e}: failed ${t.error.errorCode} : ${t.error.errorText}`,Promise.reject(t.error.errorText);const n=t.status;n&&(b.StatusCollection.assertGet((0,g.getMaybeMeUser)()).status=n)}))).apply(this,arguments)}function I(){return(I=(0,i.default)((function*(e){const t=P.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.reject(t.error);const n=t.success,r=(0,s.wap)("ack",{id:(0,s.CUSTOM_STRING)(n.stanzaId),to:(0,C.JID)(n.from),class:"notification",type:"account_sync"});switch(n.type){case p.ACCOUNT_SYNC_TYPE.STATUS:yield M();break;case p.ACCOUNT_SYNC_TYPE.DEVICES:if((0,c.isMDBackend)()){if(!S.OfflineMessageHandler.isResumeFromRestartComplete())return _.default.addOfflinePendingDevice(n.from.toString(),r),"NO_ACK";if(S.OfflineMessageHandler.isResumeOnSocketDisconnectInProgress())return yield(0,T.addUserToPendingDeviceSync)([n.from.toString()]),r}n.devices?yield(0,E.handleADVDeviceSyncResult)([{devices:n.devices,wid:(0,u.toUserWid)(n.from)}]):yield(0,p.getDevices)("notification");break;case p.ACCOUNT_SYNC_TYPE.PICTURE:yield(0,p.getAndUpdateProfilePicture)();break;case p.ACCOUNT_SYNC_TYPE.PRIVACY:f.Cmd.onAccountSyncForPrivacy(yield(0,p.updatePrivacySettings)());break;case p.ACCOUNT_SYNC_TYPE.BLOCKLIST:(0,p.updateBlocklist)();break;case p.ACCOUNT_SYNC_TYPE.TOS:n.notices&&(0,p.updateTosState)(n.notices);break;case p.ACCOUNT_SYNC_TYPE.DISAPPEARING_MODE:if((0,v.isDisappearingModeEnabled)()){const{action:e,from:t}=n;let r=n.disappearingModeDuration,i=n.disappearingModeSettingTimestamp;if("modify"===e){const e=yield(0,y.getDisappearingMode)(t);null==e.error&&null!=e.disappearingModeDuration&&null!=e.disappearingModeSettingTimestamp&&(r=e.disappearingModeDuration,i=e.disappearingModeSettingTimestamp)}null!=r&&null!=i&&(yield(0,h.updateDisappearingMode)(t,r,i));break}default:__LOG__(2)`account sync notification of type ${n.type} not supported`}return r}))).apply(this,arguments)}},97760:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleVerifiedBusinessNameNotificationContact=function(){return C.apply(this,arguments)},t.handleVerifiedBusinessNameNotificationHash=function(){return b.apply(this,arguments)};var i=r(n(48926)),a=n(31914),o=n(71914),s=n(93170),l=n(24747),c=n(19380),d=r(n(9762)),u=n(9961),p=n(99069),f=n(31452),h=n(68708),_=r(n(27874)),g=n(39410);function m(e,t,n,r,i){const a=c.ContactCollection.get(e);return null!=a&&(0,f.updateContactsWithVerifiedNames)([{id:e,name:n,level:t,isApi:r,privacyMode:i}],[a]),Promise.resolve()}function y(){return E.apply(this,arguments)}function E(){return(E=(0,i.default)((function*(e){yield(0,p.getStorage)().lock(["verified-business-name"],(()=>(0,h.createOrUpdateVerifiedBusinessName)({id:e.wid.user,level:e.level,serial:parseInt(e.serial||"0",10),name:e.verifiedName,isApi:e.isApi,privacyMode:e.privacyMode?{actualActors:e.privacyMode.actualActors,hostStorage:e.privacyMode.hostStorage,privacyModeTs:e.privacyMode.privacyModeTs}:null})));const t=[],n=c.ContactCollection.get(e.wid);null!=n&&t.push((0,d.default)(e.wid,{verifiedName:n.verifiedName,isVerifiedHigh:n.verifiedLevel===s.VERIFIED_LEVEL.HIGH,isBusiness:n.isBusiness,isEnterprise:n.isEnterprise,privacyMode:n.privacyMode},{verifiedName:e.verifiedName,isVerifiedHigh:"high"===e.level,isBusiness:!0,isEnterprise:e.isApi,privacyMode:e.privacyMode})),t.push(m(e.wid,e.level,e.verifiedName,e.isApi,e.privacyMode)),yield Promise.all(t)}))).apply(this,arguments)}const S=new o.WapParser("verifiedNameParser",(e=>(0,_.default)(e.child("verified_name"))));function v(){return T.apply(this,arguments)}function T(){return(T=(0,i.default)((function*(e){const t=(0,a.wap)("iq",{to:a.S_WHATSAPP_NET,type:"get",xmlns:"w:biz",id:(0,a.generateId)()},(0,a.wap)("verified_name",{jid:(0,g.DEVICE_JID)(e)})),n=yield(0,l.sendIq)(t,S);if(!n.success){if(404===n.errorCode)return void __LOG__(3)`verified name notification not found`;throw new Error("Could not send IQ in retrieveBusinessDetails")}return n.result}))).apply(this,arguments)}function b(){return(b=(0,i.default)((function*(e){if("verified_name_hash"!==e.type)throw Error("Invalid notification type");const t=c.ContactCollection.resolveWidsFromHash(e.hash);if(!t)return!1;const n=yield Promise.all(t.map(function(){var e=(0,i.default)((function*(e){return{wid:e,verifiedName:yield v(e)}}));return function(){return e.apply(this,arguments)}}()));return n.length&&(yield Promise.all(n.map((t=>{let{wid:n,verifiedName:r}=t;if(r){const{name:t,level:i,serial:a,isApi:o,privacyMode:s}=r;return y({wid:n,verifiedName:t,level:i,stanzaId:e.stanzaId,ts:e.ts,serial:a,isApi:o,privacyMode:s})}if(void 0===r)return(0,u.handleBusinessRemoval)(n,e.stanzaId,e.ts)})))),!0}))).apply(this,arguments)}function C(){return(C=(0,i.default)((function*(e){let{jid:t,stanzaId:n,ts:r,verifiedName:i}=e;const{serial:a="",level:o,isApi:s,privacyMode:l}=i;let d=i.name;var u;if(!d)if(null!=(null===(u=c.ContactCollection.get(t))||void 0===u?void 0:u.verifiedName)){var p;d=(null===(p=c.ContactCollection.get(t))||void 0===p?void 0:p.verifiedName)||""}else{const e=yield v(t);if(!e)return;d=e.name}return y({verifiedName:d,level:o,stanzaId:n,ts:r,wid:t,serial:a,isApi:s,privacyMode:l})}))).apply(this,arguments)}},96429:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleBusinessNotification=function(){return m.apply(this,arguments)};var i=r(n(48926)),a=r(n(81109)),o=n(31914),s=n(71914),l=n(81663),c=n(97760),d=n(91337),u=n(9961),p=n(80537),f=r(n(76199)),h=r(n(27874));const _=new s.WapParser("businessNotificationParser",(e=>{e.assertTag("notification");const t={stanzaId:e.attrString("id"),from:e.attrWapJid("from"),ts:e.attrTime("t")};let n;if(e.hasChild("remove"))return n=e.child("remove"),n.hasAttr("jid")?(0,a.default)({type:"remove_jid",jid:(0,l.chatJidToChatWid)(n.attrChatJid("jid"))},t):(0,a.default)({type:"remove_hash",hash:n.attrString("hash")},t);if(e.hasChild("verified_name"))return n=e.child("verified_name"),n.hasAttr("jid")?(0,a.default)({type:"verified_name_jid",jid:(0,l.chatJidToChatWid)(n.attrChatJid("jid")),verifiedName:(0,h.default)(n)},t):(0,a.default)({type:"verified_name_hash",hash:n.attrString("hash")},t);if(e.hasChild("profile")){const n=e.child("profile"),r=n.maybeAttrString("hash");if(r)return(0,a.default)({type:"profile_hash",hash:r},t);const i=(0,f.default)(n);return(0,a.default)({type:"profile",profile:i},t)}if(e.hasChild("product_catalog")){const n=e.child("product_catalog");if(n.hasChild("product")){const e=[];return n.forEachChildWithTag("product",(t=>{const n=t.child("id").contentString();e.push(n)})),(0,a.default)({type:"product",productsIds:e},t)}if(n.hasChild("collection")){const e=[],r=[];return n.forEachChildWithTag("collection",(t=>{if(t.hasChild("status_info")){var n,i;const a={reviewStatus:t.child("status_info").child("status").contentString(),rejectReason:null===(n=t.child("status_info").maybeChild("reject_reason"))||void 0===n?void 0:n.contentString(),commerceUrl:null===(i=t.child("status_info").maybeChild("commerce_url"))||void 0===i?void 0:i.contentString()};e.push(t.attrString("id")),r.push(a)}})),(0,a.default)({type:"collection",collectionIds:e,reviewStatuses:r},t)}}return(0,a.default)({type:"unknown"},t)}));function g(e,t,n){return n?(0,o.wap)("ack",{id:(0,o.CUSTOM_STRING)(e),to:t,class:"notification",type:"business"},(0,o.wap)("user",{side_list:"out"})):(0,o.wap)("ack",{id:(0,o.CUSTOM_STRING)(e),to:t,class:"notification",type:"business"})}function m(){return(m=(0,i.default)((function*(e){const t=_.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,"NO_ACK";const n=t.success;switch(n.type){case"verified_name_hash":const e=yield(0,c.handleVerifiedBusinessNameNotificationHash)(n);return g(n.stanzaId,n.from,!e);case"verified_name_jid":return yield(0,c.handleVerifiedBusinessNameNotificationContact)(n),g(n.stanzaId,n.from,!1);case"remove_hash":const t=yield(0,u.handleBusinessRemovalNotificationHash)(n);return g(n.stanzaId,n.from,!t);case"remove_jid":return yield(0,u.handleBusinessRemovalNotificationContact)(n),g(n.stanzaId,n.from,!1);case"profile":return(0,d.handleBusinessProfile)(n),g(n.stanzaId,n.from,!1);case"profile_hash":const r=yield(0,d.handleBusinessProfileHash)(n);return g(n.stanzaId,n.from,!r);case"product":return yield(0,p.handleProductNotification)(n.productsIds),g(n.stanzaId,n.from,!1);case"collection":return yield(0,p.handleCollectionNotification)(n),g(n.stanzaId,n.from,!1);default:return g(n.stanzaId,n.from,!1)}}))).apply(this,arguments)}},91337:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleBusinessProfileHash=t.handleBusinessProfile=void 0;var i=r(n(48926)),a=n(45454),o=n(93581),s=n(94010),l=n(19380),c=n(99234);t.handleBusinessProfile=e=>{let{from:t,profile:n}=e;const r=(0,a.createWidFromWidLike)(t.toString()),i=Boolean(o.BusinessProfileCollection.getValid(r)),l=(0,s.parseBusinessProfile)({id:r,profile:n,queryCatalog:!1}),d=o.BusinessProfileCollection.gaddUp(l);if(!i)return void(d.stale=!0);const u=(0,c.getMaybeMeUser)();r.equals(u)&&o.BusinessProfileCollection.fetchBizProfile(r)};const d=function(){var e=(0,i.default)((function*(e){let{hash:t}=e;const n=l.ContactCollection.resolveWidsFromHash(t);return!!n&&(yield Promise.all(n.map(function(){var e=(0,i.default)((function*(e){const t=Boolean(o.BusinessProfileCollection.getValid(e)),n=yield o.BusinessProfileCollection.update(e),r=Array.isArray(n)?n:[n];for(const e of r)t||(e.stale=!0)}));return function(){return e.apply(this,arguments)}}())),!0)}));return function(){return e.apply(this,arguments)}}();t.handleBusinessProfileHash=d},9961:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleBusinessRemoval=f,t.handleBusinessRemovalNotificationContact=function(){return g.apply(this,arguments)},t.handleBusinessRemovalNotificationHash=function(){return _.apply(this,arguments)};var i=r(n(48926)),a=n(93170),o=n(19380),s=r(n(9762)),l=n(99069);function c(){return d.apply(this,arguments)}function d(){return(d=(0,i.default)((function*(e,t){const n=yield e.get(t.user);if(null!=n)return n.isBusiness=!1,n.verifiedLevel=0,n.verifiedName="",e.merge(t.user,n)}))).apply(this,arguments)}function u(e,t){return e.remove(t.user)}const p={isVerifiedHigh:!1,isBusiness:!1,isEnterprise:!1};function f(){return h.apply(this,arguments)}function h(){return(h=(0,i.default)((function*(e){const t=o.ContactCollection.get(e),n=t?{verifiedName:t.verifiedName,isVerifiedHigh:t.verifiedLevel===a.VERIFIED_LEVEL.HIGH,isBusiness:t.isBusiness,isEnterprise:t.isEnterprise,privacyMode:t.privacyMode}:p;yield(0,l.getStorage)().lock(["contact","verified-business-name"],(t=>{let[n,r]=t;return Promise.all([c(n,e),u(r,e)])}));const r=o.ContactCollection.get(e);return null!=r&&r.set({isBusiness:!1,verifiedLevel:null,verifiedName:null}),(0,s.default)(e,n,p)}))).apply(this,arguments)}function _(){return(_=(0,i.default)((function*(e){if("remove_hash"!==e.type)throw Error("Invalid notification type");const t=o.ContactCollection.resolveWidsFromHash(e.hash);return!!t&&(yield Promise.all(t.map((t=>f(t,e.stanzaId,e.ts)))),!0)}))).apply(this,arguments)}function g(){return(g=(0,i.default)((function*(e){if("remove_jid"!==e.type)throw Error("Invalid notification type");yield f(e.jid,e.stanzaId,e.ts)}))).apply(this,arguments)}},80537:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleCollectionNotification=function(e){const t=a.CatalogCollection.get((0,o.getMeUser)().toString());if(null==t?void 0:t.collections)for(let n=0;n<e.collectionIds.length;n++){const r=t.collections.get(e.collectionIds[n]);r&&r.set(e.reviewStatuses[n])}return Promise.resolve()},t.handleProductNotification=function(){return s.apply(this,arguments)};var i=r(n(48926)),a=n(99989),o=n(99234);function s(){return(s=(0,i.default)((function*(e){const t=a.CatalogCollection.get((0,o.getMeUser)().toString());if(t){const n=[];e.forEach((e=>{n.push(t.refreshProduct(e))})),yield Promise.all(n)}}))).apply(this,arguments)}},83558:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=s.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.reject(t.error);return(0,o.default)(t.success)};var i=n(71914),a=n(81663),o=r(n(54248));const s=new i.WapParser("incomingChatStateParser",(e=>{let t;if(e.assertTag("chatstate"),e.hasChild("paused"))t="paused";else{if(!e.hasChild("composing"))return e.throw("Expected child of type paused or composing");t=e.child("composing").hasAttr("media")?"recording":"composing"}return{id:(0,a.chatJidToChatWid)(e.attrChatJid("from")),type:t,participant:e.hasAttr("participant")?(0,a.userJidToUserWid)(e.attrPhoneUserJid("participant")):void 0}}))},69277:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return P.apply(this,arguments)};var i=r(n(48926)),a=r(n(81109)),o=r(n(45095)),s=n(31914),l=(n(45506),n(71914)),c=n(81663),d=r(n(65212)),u=n(45454),p=n(68638),f=n(69951),h=n(189),_=n(99234),g=n(5819),m=n(68315),y=n(41601),E=n(37638),S=n(44334),v=n(46133);const T=new l.WapParser("incomingContactsNotification",(e=>{e.assertTag("notification");const t=e.attrString("id"),n={from:e.attrWapJid("from"),ts:e.attrTime("t"),rawTs:e.attrString("t"),stanzaId:t};if(e.hasChild("update")){const t=e.child("update");return t.hasAttr("jid")?(0,a.default)({type:"update",jid:(0,c.userJidToUserWid)(t.attrPhoneUserJid("jid"))},n):(0,a.default)({type:"empty",jid:null},n)}if(e.hasChild("add")){const t=e.child("add");return(0,a.default)({type:"add",hash:t.hasContent()?t.contentBytes():null,jid:null},n)}if(e.hasChild("remove")){const t=e.child("remove");return(0,a.default)({type:"remove",jid:(0,c.userJidToUserWid)(t.attrPhoneUserJid("jid"))},n)}if(e.hasChild("modify")){const t=e.child("modify");return(0,a.default)({type:"modify",jid:(0,c.userJidToUserWid)(t.attrPhoneUserJid("new")),oldJid:(0,c.userJidToUserWid)(t.attrPhoneUserJid("old"))},n)}if(e.hasChild("sync")){const t=e.child("sync");return(0,a.default)({type:"sync",after:t.attrTime("after"),jid:null},n)}return __LOG__(3)`Unexpected "contacts" notification`,(0,a.default)({type:"empty",jid:null},n)}));function b(e,t){const n=function(e,t){if("modify"!==t.type)throw new Error("Error: genContactChangeNotificationMsg invalid type");{const n=(0,_.getMeUser)(),r=(0,o.default)(t.oldJid,"notification.oldJid"),i=(0,o.default)(t.jid,"notification.jid");return{id:new d.default({remote:e,fromMe:!1,id:d.default.newId()}),from:e,subtype:"change_number",t:t.ts,to:n,type:"notification_template",templateParams:[r,i]}}}(e,t);return(0,g.handleSingleMsgMD)(e,n)}function C(){return A.apply(this,arguments)}function A(){return(A=(0,i.default)((function*(e){if(e.oldJid){const t=e.oldJid,n=e.jid,r=[];f.ChatCollection.get(t)&&r.push({id:t.toString(),changeNumberNewJid:n.toString(),changeNumberOldJid:void 0});f.ChatCollection.get(n)&&r.push({id:n.toString(),changeNumberNewJid:void 0,changeNumberOldJid:t.toString()}),(0,p.getTable)().bulkCreateOrMerge(r).then((()=>{r.forEach((e=>{const t=f.ChatCollection.get(e.id);t&&(t.changeNumberNewJid=e.changeNumberNewJid?(0,u.createWid)(e.changeNumberNewJid):void 0,t.changeNumberOldJid=e.changeNumberOldJid?(0,u.createWid)(e.changeNumberOldJid):void 0)}))})),yield Promise.all([b(t,e),b(n,e)])}else __LOG__(2)`notification.oldJid is null`;return Promise.resolve()}))).apply(this,arguments)}function P(){return(P=(0,i.default)((function*(e){const t=T.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.reject(t.error);const n=t.success,r=n.jid;switch(n.type){case"update":{if(!r)return __LOG__(3)`handleContactsNotification: an update command does not include jid`,i(n);const e=m.PresenceCollection.get(r);e&&e.reset();let t=Promise.resolve();const a=v.StatusCollection.get(r);a&&(a.set({status:""}),t=(0,S.getStatus)(r).then((e=>{a.set({status:e.status})})));const o=(0,E.changeProfilePicThumb)(n.jid,y.PROFILE_PIC_COMMAND.REMOVE);return Promise.all([o,t]).then((()=>i(n)))}case"modify":return yield C(n),i(n);case"sync":return __LOG__(2,void 0,void 0,void 0,["contact-sync"])`received contact sync notification`,yield(0,h.contactSync)(),i(n);default:return __LOG__(2)`handleContactsNotification: unhandled notification of type ${n.type}`,i(n)}function i(e,t){return(0,s.wap)("ack",{id:(0,s.CUSTOM_STRING)(e.stanzaId),to:e.from,class:"notification",type:"contacts"},t)}}))).apply(this,arguments)}},27514:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.DEVICE_NOTIFICATION_TYPES=void 0,t.handleDevicesNotification=function(){return S.apply(this,arguments)};var i=r(n(48926)),a=n(31914),o=n(71914),s=n(88555),l=n(81663),c=n(72441),d=n(45454),u=n(10823),p=r(n(69153)),f=n(54181),h=n(28237),_=n(97153),g=n(84356),m=n(39410);const y={add:"add",remove:"remove",update:"update"};t.DEVICE_NOTIFICATION_TYPES=y;const E=new o.WapParser("incomingDevicesNotification",(e=>{e.assertTag("notification"),e.assertTag("notification"),e.assertAttr("type","devices");let t,n,r,i=[];if(e.hasChild("remove"))n=y.remove,t=e.child("remove");else if(e.hasChild("add"))n=y.add,t=e.child("add");else{if(!e.hasChild("update"))throw __LOG__(3)`Unknown Devices Notification: Devices notification without "remove" and "add" nodes`,new Error("Failed to parse devices notification");n=y.update,t=e.child("update")}if(n===y.add||n===y.remove){const e=t.maybeChild("key-index-list");if(!e)throw new Error("key index node is required to handle device add or remove notification");const a=e.attrTime("ts");if(n===y.remove&&!a)throw new Error("timestamp is required to handle device remove notification");r={ts:a,signedKeyIndexBytes:n===y.add?e.contentBytes():null};const o=t.child("device");i=[{id:(0,c.extractDeviceId)(o.attrPhoneDeviceJid("jid")),keyIndex:o.hasAttr("key-index")?o.attrInt("key-index"):null}]}return{type:n,stanzaId:e.attrString("id"),hash:t.attrString(n===y.update?"hash":"device_hash"),user:(0,l.deviceJidToUserWid)(e.attrPhoneDeviceJid("from")),deviceList:i,keyIndex:r}}));function S(){return(S=(0,i.default)((function*(e){const t=E.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.reject(t.error);const n=t.success,r=n.user,i=(0,a.wap)("ack",{to:(0,m.USER_JID)(n.user),id:(0,a.CUSTOM_STRING)(n.stanzaId),class:"notification"});if((0,s.isMDBackend)()){if(!h.OfflineMessageHandler.isResumeFromRestartComplete())return p.default.addOfflinePendingDevice(r.toString(),i),"NO_ACK";if(h.OfflineMessageHandler.isResumeOnSocketDisconnectInProgress())return yield(0,_.addUserToPendingDeviceSync)([r.toString()]),i}const o={wid:r,devices:{deviceList:n.deviceList,keyIndex:n.keyIndex},type:n.type};if(n.type===y.add){try{yield(0,f.handleADVDeviceNotification)(o)}catch(e){__LOG__(3)`handleDevicesNotification - add error: ${e}`}return i}if(n.type===y.remove){try{var l;yield(0,f.handleADVDeviceNotification)(o);const e=(null===(l=n.deviceList)||void 0===l?void 0:l.map((e=>e.id)))||[];yield Promise.all(e.map((e=>{const t=(0,d.createDeviceWidFromUserAndDevice)(r.user,e);g.Voip.notifyDeviceIdentityChangedOrDeleted(t,!0)})))}catch(e){__LOG__(3)`handleDevicesNotification - remove error: ${e}`}return i}try{yield(0,u.syncDeviceListJob)([r],"notification",n.hash)}catch(e){__LOG__(3)`handleDevicesNotification - update error: ${e}`}return i}))).apply(this,arguments)}},81367:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=o.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,"NO_ACK";const n=t.success,i=(0,r.wap)("ack",{to:r.S_WHATSAPP_NET,id:(0,r.CUSTOM_STRING)(n.stanzaId),class:"notification"});return(0,a.digestKey)().then((()=>i))};var r=n(31914),i=n(71914),a=n(40376);const o=new i.WapParser("digestKeyParser",(e=>(e.assertTag("notification"),e.assertAttr("type","encrypt"),e.assertFromServer(),e.child("digest").assertTag("digest"),{stanzaId:e.attrString("id")})))},58626:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=u.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.reject(t.error);return function(){return p.apply(this,arguments)}(t.success)};var i=r(n(48926)),a=n(31914),o=n(71914),s=n(81663),l=n(91036),c=n(41566),d=n(39410);const u=new o.WapParser("disappearingModeNotification",(e=>{e.assertTag("notification");const t=e.child("disappearing_mode");return{stanzaId:e.attrString("id"),from:(0,s.deviceJidToDeviceWid)(e.attrPhoneDeviceJid("from")),duration:t.attrInt("duration",0),ts:t.attrTime("t")}}));function p(){return(p=(0,i.default)((function*(e){let{duration:t,from:n,stanzaId:r,ts:i}=e;return __LOG__(2)`handleDisappearingModeNotification: received d=${t}:t=${i}
for ${n.toString()}`,(0,c.isDisappearingModeEnabled)()&&(yield(0,l.updateDisappearingMode)(n,t,i)),(0,a.wap)("ack",{id:(0,a.CUSTOM_STRING)(r),to:(0,d.JID)(n),class:"notification",type:"disappearing_mode"})}))).apply(this,arguments)}},64054:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return h.apply(this,arguments)};var i=r(n(48926)),a=n(71914),o=n(88102),s=n(24747),l=n(48440),c=n(83023),d=n(52622),u=n(42448),p=n(65044);const f=new a.WapParser("failureParser",(e=>(e.assertTag("failure"),{reason:e.attrInt("reason",400,599),location:e.attrString("location"),code:e.hasAttr("code")?e.attrInt("code"):null,expire:e.hasAttr("expire")?e.attrInt("expire"):null})));function h(){return(h=(0,i.default)((function*(e){const t=f.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`${t.error.toString()} parsing ${e.toString()}`,Promise.reject(t.error);switch(t.success.reason){case 401:case 403:case 406:__LOG__(2)`received failure stanza, reason: ${t.success.reason}, logging out`,yield p.Socket.clearCredentialsAndStoredData(),o.Cmd.logout();break;case 405:case 409:__LOG__(2)`Client too old or bad user agent, attempting to update the app`;"web"===l.PLATFORMS[u.WAM_PLATFORM]?c.Updater.update(d.SANITIZED_VERSION_STR,!1,0):c.Updater.update(void 0,!1,0,!1),(0,s.stopComms)();break;case 402:const{code:e,expire:n}=t.success;if(null==e||null==n)throw __LOG__(4,void 0,new Error)`Incorrect temporary ban data ${e} ${n}`,new Error("handleFailure: wrong temp ban data");o.Cmd.onTemporaryBan({banned:!0,code:e,expire:n});break;case 400:case 500:case 501:__LOG__(3)`handleFailure: got failure code ${t.success.reason}`;break;default:return __LOG__(3)`failure reason ${t.success.reason} not implemented yet`,Promise.reject(new Error(`failure reason ${t.success.reason} not implemented yet`))}}))).apply(this,arguments)}},92419:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleGroupNotification=function(e){const t=I.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.reject(t.error);const n=t.success,{chatId:r,author:s,ts:l,pushname:c,externalId:d,actions:u,offline:p}=n,f=!!p&&!v.OfflineMessageHandler.isResumeFromRestartComplete(),h=(0,a.default)({chatId:r,author:s,ts:l,externalId:d},c?{pushname:c}:null);return(0,T.handleMessage)(r.toString(),f,(0,i.default)((function*(){return yield Promise.all(u.map((e=>function(){return G.apply(this,arguments)}(h,e,f)))),(0,o.wap)("ack",{to:(0,M.GROUP_JID)(n.chatId),id:(0,o.CUSTOM_STRING)(n.externalId),class:"notification",participant:s?(0,M.JID)(s):o.DROP_ATTR})})))};var i=r(n(48926)),a=r(n(81109)),o=n(31914),s=n(71914),l=n(88555),c=n(40234),d=n(77345),u=n(81663),p=n(57849),f=n(68638),h=n(69951),_=n(46920),g=n(99234),m=n(57701),y=n(64632),E=n(36098),S=n(34648),v=n(28237),T=n(15746),b=n(76214),C=r(n(29783)),A=n(5819),P=n(2182),M=n(39410);const O=Object.freeze({REMOVE:"remove",ADD:"add",DEMOTE:"demote",DELETE:"delete",PROMOTE:"promote",MODIFY:"modify",CREATE:"create",SUBJECT:"subject",DESC:"description",LOCKED:"locked",UNLOCKED:"unlocked",ANNOUNCE:"announcement",NOT_ANNOUNCE:"not_announcement",NO_FREQUENTLY_FORWARDED:"no_frequently_forwarded",FREQUENTLY_FORWARDED_OK:"frequently_forwarded_ok",INVITE:"invite",EPHEMERAL:"ephemeral",NOT_EPHEMERAL:"not_ephemeral",REVOKE_INVITE:"revoke",SUSPENDED:"suspended",UNSUSPENDED:"unsuspended",GROWTH_LOCKED:"growth_locked",GROWTH_UNLOCKED:"growth_unlocked",LINK:"link"});const I=new s.WapParser("groupNotificationParser",(e=>{e.assertTag("notification"),e.hasAttr("to")&&e.assertAttr("to",(0,g.assertGetMe)().toJid());const t=(0,u.groupJidToWid)(e.attrGroupJid("from")),n=e.hasAttr("participant")?(0,u.userJidToUserWid)(e.attrPhoneUserJid("participant")):null,r=e.attrTime("t");function i(e){return{participants:e.mapChildrenWithTag("participant",(e=>(0,u.userJidToUserWid)(e.attrPhoneUserJid("jid")))),prevVersion:e.hasAttr("prev_v_id")?e.attrInt("prev_v_id"):void 0,version:e.hasAttr("v_id")?e.attrInt("v_id"):void 0}}const o=e.mapChildren((e=>{const t=e.tag();switch(t){case O.CREATE:return function(e){const t=e.child("group"),n=t.mapChildrenWithTag("participant",(e=>{const t=e.attrEnumOrDefault("type",_.GROUP_PARTICIPANT_TYPES,"participant");return{id:(0,u.userJidToUserWid)(e.attrPhoneUserJid("jid")),isSuperAdmin:t===_.GROUP_PARTICIPANT_TYPES.superadmin,isAdmin:t===_.GROUP_PARTICIPANT_TYPES.admin||t===_.GROUP_PARTICIPANT_TYPES.superadmin}})),r=function(e){if(e.hasChild("description")){const t=e.child("description");if(t.hasChild("body")){const e=t.child("body");if(e.hasContent())return{content:e.contentString(),id:t.attrString("id")}}}return null}(t),i=function(e){if(e.hasChild("ephemeral")){const t=e.child("ephemeral");if(t.hasAttr("expiration"))return{ephemeralDuration:t.attrInt("expiration")}}return null}(t),a=(0,P.extractLinkedParent)(t),o={subject:t.attrString("subject"),restrict:t.hasChild("locked"),announce:t.hasChild("announcement"),noFrequentlyForwarded:t.hasChild("no_frequently_forwarded"),ephemeralDuration:i?i.ephemeralDuration:void 0,owner:t.hasAttr("creator")?(0,u.userJidToUserWid)(t.attrPhoneUserJid("creator")):void 0,creation:t.attrTime("creation"),participants:n,desc:r?r.content:void 0,descId:r?r.id:void 0,subjectOwner:t.hasAttr("s_o")?(0,u.userJidToUserWid)(t.attrPhoneUserJid("s_o")):void 0,subjectTime:t.hasAttr("s_t")?t.attrTime("s_t"):void 0,support:t.hasChild("support"),pvId:t.attrInt("p_v_id"),isParentGroup:t.hasChild("parent"),parentGroup:a?a.parentGroup:void 0,defaultSubgroup:t.hasChild("default_sub_group")};return{action:O.CREATE,isInvite:e.hasAttr("reason")&&"invite"===e.attrString("reason"),groupInfo:o}}(e);case O.ADD:return(0,a.default)((0,a.default)({action:E.GROUP_ACTIONS.ADD},i(e)),{},{isInvite:e.hasAttr("reason")&&"invite"===e.attrString("reason")});case O.DELETE:return{action:E.GROUP_ACTIONS.DELETE};case O.REMOVE:return(0,a.default)({action:O.REMOVE},i(e));case O.PROMOTE:return(0,a.default)({action:O.PROMOTE},i(e));case O.DEMOTE:return(0,a.default)({action:O.DEMOTE},i(e));case O.MODIFY:return(0,a.default)({action:E.GROUP_ACTIONS.MODIFY},i(e));case O.SUBJECT:return{action:E.GROUP_ACTIONS.SUBJECT,subject:e.attrString("subject"),s_o:e.hasAttr("s_o")?(0,u.userJidToUserWid)(e.attrPhoneUserJid("s_o")):null,s_t:e.hasAttr("s_t")?e.attrTime("s_t"):null};case O.DESC:return e.hasChild("delete")?{action:E.GROUP_ACTIONS.DESC_REMOVE,descId:e.attrString("id")}:{action:E.GROUP_ACTIONS.DESC_ADD,descId:e.attrString("id"),desc:e.hasChild("body")?e.child("body").contentString():null,descTime:r};case O.SUSPENDED:return{action:E.GROUP_ACTIONS.SUSPEND,value:!0};case O.UNSUSPENDED:return{action:E.GROUP_ACTIONS.SUSPEND,value:!1};case O.LOCKED:return{action:E.GROUP_ACTIONS.RESTRICT,value:!0};case O.UNLOCKED:return{action:E.GROUP_ACTIONS.RESTRICT,value:!1};case O.ANNOUNCE:return{action:E.GROUP_ACTIONS.ANNOUNCE,value:!0};case O.NOT_ANNOUNCE:return{action:E.GROUP_ACTIONS.ANNOUNCE,value:!1};case O.NO_FREQUENTLY_FORWARDED:return{action:E.GROUP_ACTIONS.NO_FORWARD,value:!0};case O.FREQUENTLY_FORWARDED_OK:return{action:E.GROUP_ACTIONS.NO_FORWARD,value:!1};case O.INVITE:return{action:E.GROUP_ACTIONS.INVITE_CODE,code:e.attrString("code")};case O.EPHEMERAL:return{action:E.GROUP_ACTIONS.EPHEMERAL,duration:e.attrInt("expiration")};case O.NOT_EPHEMERAL:return{action:E.GROUP_ACTIONS.EPHEMERAL,duration:0};case O.REVOKE_INVITE:return{action:E.GROUP_ACTIONS.REVOKE_INVITE,participants:e.mapChildrenWithTag("participant",(e=>({id:(0,u.userJidToUserWid)(e.attrPhoneUserJid("jid")),expiration:e.attrInt("expiration")})))};case O.GROWTH_UNLOCKED:return{action:E.GROUP_ACTIONS.GROWTH_UNLOCKED};case O.GROWTH_LOCKED:return{action:E.GROUP_ACTIONS.GROWTH_LOCKED,expiration:e.attrInt("expiration"),type:e.attrString("type")};case O.LINK:const n=e.attrString("link_type");return{action:{sub_group:E.GROUP_ACTIONS.SUB_GROUP_LINK,parent_group:E.GROUP_ACTIONS.PARENT_GROUP_LINK,sibling_group:E.GROUP_ACTIONS.SIBLING_GROUP_LINK}[n],groups:e.mapChildrenWithTag("group",(e=>(0,u.groupJidToWid)(e.attrGroupJid("jid"))))};default:throw new Error(`Unrecognized group action ${t}`)}}));return{externalId:e.attrString("id"),chatId:t,author:n,ts:e.attrTime("t"),pushname:e.hasAttr("notify")?e.attrString("notify"):null,offline:e.hasAttr("offline")?e.attrString("offline"):null,actions:o}}));function w(){return R.apply(this,arguments)}function R(){return(R=(0,i.default)((function*(e){const[t,n]=yield Promise.all([(0,y.getTable)().get(e.toString()),(0,f.getTable)().get(e.toString())]);return!!t||!!n&&!!n.t}))).apply(this,arguments)}function D(){return L.apply(this,arguments)}function L(){return(L=(0,i.default)((function*(e,t){const n=yield(0,b.getParticipantTable)().get(e);return!!n&&n.admins.includes(t)}))).apply(this,arguments)}function N(){return k.apply(this,arguments)}function k(){return(k=(0,i.default)((function*(e,t){var n;const r=yield(0,y.getTable)().get(e);return!!r&&r.growthLockType===t&&(null!==(n=r.growthLockExpiration)&&void 0!==n?n:0)>c.Clock.globalUnixTime()}))).apply(this,arguments)}function U(e,t){var n;const r=null===(n=h.ChatCollection.get(e))||void 0===n?void 0:n.groupMetadata;if(!r)return t;const i=r.participants;return t.filter((e=>!i.get(e)))}function G(){return(G=(0,i.default)((function*(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!t)return;__LOG__(2,void 0,void 0,void 0,["groups"])`handle action ${t.action}`;const r=[];try{if(t.action===O.CREATE){const i=(0,a.default)((0,a.default)({},t.groupInfo),{},{id:e.chatId}),o=yield w(i.id);__LOG__(2,void 0,void 0,void 0,["groups"])`group id ${i.id} exists in storage = ${o}`,yield(0,S.handleGroupCreation)(e,i,n);const s=(0,g.getMaybeMeUser)();if(__LOG__(2,void 0,void 0,void 0,["groups"])`handleGroupCreation done for group id ${i.id}`,o||r.push((0,d.genGroupCreationMsg)(e,i)),!s.equals(e.author)){const a={action:E.GROUP_ACTIONS.ADD,version:i.pvId,participants:[s],isInvite:t.isInvite};yield(0,S.handleGroupActionMD)(e,a,n),r.push((0,d.genGroupNotificationMsg)(e,a))}const{ephemeralDuration:l}=i;e.author&&null!=e.ts&&null!=l&&l>0&&r.push((0,d.genGroupEphemeralSettingMsg)(e.chatId,e.ts,e.author,l));const{parentGroup:c,defaultSubgroup:u}=i;if((0,m.communitiesEnabled)()&&null!=c&&!0!==u){const t={action:E.GROUP_ACTIONS.PARENT_GROUP_LINK,groups:[c]};r.push((0,d.genGroupNotificationMsg)(e,t))}}else if(t.action===E.GROUP_ACTIONS.ADD){const i=U(e.chatId,t.participants);yield(0,S.handleGroupActionMD)(e,t,n),__LOG__(2,void 0,void 0,void 0,["groups"])`handleGroupActionMD done for ${t}`,i.length&&r.push((0,d.genGroupNotificationMsg)(e,(0,a.default)((0,a.default)({},t),{},{participants:i})))}else{const i=yield x(t,e.chatId);yield(0,S.handleGroupActionMD)(e,t,n),__LOG__(2,void 0,void 0,void 0,["groups"])`handleGroupActionMD done for ${t}`,i||r.push((0,d.genGroupNotificationMsg)(e,t))}n?C.default.addOfflineMessage(r.map((e=>({msg:e})))):yield Promise.all(r.map((e=>(0,A.handleSingleMsgMD)(e.from,e))))}catch(e){__LOG__(2)`handleGroupNotification: failed with ${e}`}}))).apply(this,arguments)}function x(){return B.apply(this,arguments)}function B(){return(B=(0,i.default)((function*(e,t){if(e.action===E.GROUP_ACTIONS.REVOKE_INVITE||e.action===E.GROUP_ACTIONS.SUSPEND)return!0;if(e.action===E.GROUP_ACTIONS.GROWTH_LOCKED||e.action===E.GROUP_ACTIONS.GROWTH_UNLOCKED){if(!((0,l.isMDBackend)()&&(0,p.getABPropConfigValue)("growth_lock_v0_enabled")))return!0;if(e.action===E.GROUP_ACTIONS.GROWTH_LOCKED){if("invite"!==e.type)return!0;if(yield N(t.toString(),e.type))return!0}const n=(0,g.getMaybeMeUser)();return!(yield D(t.toString(),n.toString()))}return!(e.action!==E.GROUP_ACTIONS.SUB_GROUP_LINK&&e.action!==E.GROUP_ACTIONS.PARENT_GROUP_LINK&&e.action!==E.GROUP_ACTIONS.SIBLING_GROUP_LINK||(0,m.communitiesEnabled)())}))).apply(this,arguments)}},19655:(e,t,n)=>{"use strict";var r=n(59182).default,i=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleHistorySyncChunk=ne,t.handleHistorySyncNotification=function(){return te.apply(this,arguments)},t.updateEndOfHistorySync=ie;var a=i(n(81109)),o=i(n(48926)),s=n(52613),l=n(8584),c=n(72651),d=n(52230),u=n(8243),p=i(n(45095)),f=n(92844),h=n(10635),_=n(23082),g=i(n(65212)),m=i(n(81602)),y=i(n(95023)),E=i(n(89867)),S=n(45454),v=n(84902),T=n(57849),b=n(68638),C=n(63183),A=i(n(70257)),P=n(16116),M=n(88102),O=n(19380),I=n(53614),w=n(24606),R=n(26384),D=n(24808),L=n(99234),N=n(57701),k=n(41796),U=i(n(63928)),G=n(49714),x=n(41037),B=n(73027),F=n(88432),j=i(n(11339)),Y=i(n(39436)),K=n(76214),W=n(50313),H=n(5819),V=n(58052),$=n(13493),z=i(n(76128)),q=n(74727),J=i(n(61426)),Q=n(64551),X=n(27286),Z=n(93832),ee=i(n(56891));function te(){return(te=(0,o.default)((function*(e,t,n){if(!e)return;const{downloadOptions:r}=e;if(!r)return;const i=!!e.historySyncNotification.originalMessageId,o=i?e.historySyncNotification.originalMessageId:n,s={msgKey:new g.default({remote:t,fromMe:!0,id:o}).toString(),processed:0,downloadOptions:r,isReupload:1,historySyncStepStartedTs:(0,f.unixTimeMs)(),reuploadPending:!1,historySyncPayloadSize:e.historySyncNotification.fileLength};i&&e.historySyncNotification.syncType!==B.HistorySyncHistorySyncType.INITIAL_BOOTSTRAP||(s.syncType=e.historySyncNotification.syncType,s.chunkOrder=e.historySyncNotification.chunkOrder||0,s.isReupload=0);const l=s;switch(new j.default.MdBootstrapHistoryDataReceived({mdBootstrapPayloadType:l.syncType===B.HistorySyncHistorySyncType.INITIAL_BOOTSTRAP?j.default.MD_BOOTSTRAP_PAYLOAD_TYPE.CRITICAL:j.default.MD_BOOTSTRAP_PAYLOAD_TYPE.NON_CRITICAL,mdBootstrapHistoryPayloadType:de(l.syncType),mdTimestamp:(0,f.unixTimeMs)(),mdSessionId:yield F.MdSyncFieldStatsMeta.getMdSessionId()}).commit(),l.syncType){case B.HistorySyncHistorySyncType.INITIAL_BOOTSTRAP:case B.HistorySyncHistorySyncType.INITIAL_STATUS_V3:__LOG__(2)`[History sync initial sync received] ${oe(l)}`,ne(l);break;case B.HistorySyncHistorySyncType.PUSH_NAME:return __LOG__(2)`[History sync initial pushname received] ${oe(l)}`,yield(0,x.enqueueNotification)((0,a.default)((0,a.default)({},l),{},{downloadOptions:(0,a.default)({},l.downloadOptions)}),!0),void ne(l);default:__LOG__(2)`[History sync recent or full chunk received] adding chunk info to db: ${oe(l)}`,yield(0,x.enqueueNotification)(l)}y.default.continueProgressiveHistorySyncProcessing()}))).apply(this,arguments)}function ne(){return re.apply(this,arguments)}function re(){return(re=(0,o.default)((function*(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;if(__LOG__(2,void 0,void 0,void 0,["History sync"])`handleHistorySyncChunk started for ${oe(e)}`,e.syncType===B.HistorySyncHistorySyncType.INITIAL_STATUS_V3)try{const t=g.default.fromString(e.msgKey);(0,q.sendAggregateReceipts)(t.remote,q.RECEIPT_TYPE.HISTORY_SYNC_COMPLETION,void 0,(new Map).set(t.remote,[t.id]))}catch(e){__LOG__(3,void 0,void 0,void 0,["History sync"])`history_sync_notification_handler: sending Status v3 receipt failed`}const i=e.syncType===B.HistorySyncHistorySyncType.INITIAL_BOOTSTRAP?j.default.MD_BOOTSTRAP_PAYLOAD_TYPE.CRITICAL:j.default.MD_BOOTSTRAP_PAYLOAD_TYPE.NON_CRITICAL,b=new j.default.MdBootstrapHistoryDataDownloaded({mdBootstrapPayloadType:i,mdBootstrapPayloadSize:e.historySyncPayloadSize}),P=e.syncType!==B.HistorySyncHistorySyncType.PUSH_NAME&&!i;b.mdSessionId=yield F.MdSyncFieldStatsMeta.getMdSessionId();const N=yield F.MdSyncFieldStatsMeta.getStorageEstimation();N.mdStorageQuotaBytes!==F.STORAGE_QUOTA_UNAVAILABLE&&(b.mdStorageQuotaUsedBytes=N.mdStorageQuotaUsedBytes,b.mdStorageQuotaBytes=N.mdStorageQuotaBytes);let k=null;try{k=yield R.downloadManager.downloadAndDecrypt((0,a.default)({signal:(new r).signal},e.downloadOptions))}catch(n){if(__LOG__(3)`history sync download failed`,n instanceof _.HttpNetworkError)return e.syncType===B.HistorySyncHistorySyncType.INITIAL_BOOTSTRAP&&t>0?(yield m.default.waitIfOffline({signal:(new r).signal}),__LOG__(3,void 0,void 0,void 0,["History sync"])`Initial sync download failed due to network error retry download`,ne(e,t-1)):void(0,x.removeLocalFailureFromInFlightChunk)(e.msgKey);const i=g.default.fromString(e.msgKey);return se(b,e.historySyncStepStartedTs,!1),(0,J.default)(i.remote,i.id,e.downloadOptions.mediaKey),void(yield(0,x.markChunkForReuploadPending)(e.msgKey))}e.downloadOptions.mediaKey="",P&&(yield new Promise((e=>setTimeout(e,1e3)))),b.mdBootstrapStepResult=j.default.MD_BOOTSTRAP_STEP_RESULT.SUCCESS;const $=new l.Binary(k),ee=yield(0,c.inflate)($.readByteArray());P&&(yield new Promise((e=>setTimeout(e,1e3))));const te=(0,v.decodeProtobuf)(B.HistorySyncSpec,ee);__LOG__(2)`[History sync chunk downloaded], ${oe(e)}`,P&&(yield new Promise((e=>setTimeout(e,1e3))));const re=new j.default.MdBootstrapDataApplied({mdBootstrapPayloadType:i,mdBootstrapSource:j.default.MD_BOOTSTRAP_SOURCE.HISTORY});if(re.mdSessionId=yield F.MdSyncFieldStatsMeta.getMdSessionId(),e.syncType===B.HistorySyncHistorySyncType.INITIAL_STATUS_V3&&te.statusV3Messages&&te.statusV3Messages.length>0?(b.mdBootstrapMessagesCount=te.statusV3Messages.length,se(b,e.historySyncStepStartedTs,!0),te.statusV3Messages.sort(((e,t)=>{let{messageTimestamp:n}=e,{messageTimestamp:r}=t;return(0,f.castToUnixTime)(parseInt(n,10))-(0,f.castToUnixTime)(parseInt(r,10))})),yield Promise.all(te.statusV3Messages.map(function(){var e=(0,o.default)((function*(e){const t={type:G.MESSAGE_TYPE.OTHER_STATUS,externalId:(0,p.default)(e.key.id,"msg.key.id"),ts:(0,f.castToUnixTime)(parseInt(e.messageTimestamp,10)),edit:-1,isHsm:!1,count:null,chat:(0,S.createWid)(d.STATUS_JID),author:!0===e.key.fromMe?(0,L.getMeUser)():(0,S.createWid)((0,p.default)(e.participant,"msg.participant")),pushname:null,isDirect:!1},n=yield(0,X.parseMessage)(t,"skmsg",(0,p.default)(e.message,"msg.message"),void 0),r=n.renderableMsgs&&n.renderableMsgs;if(!r||1!==r.length)return Promise.resolve();const i=r[0];return"0@s.whatsapp.net"!==e.participant||(0,T.getABPropConfigValue)("web_status_psa_history_sync")&&null!=i.staticUrl?(0,H.handleSingleMsgMD)(i.id.remote,i,!1):Promise.resolve()}));return function(){return e.apply(this,arguments)}}())),yield(0,x.updateCurrentlyProcessed)(e.msgKey),re.mdTimestamp=(0,f.unixTimeMs)(),re.commit(),__LOG__(2)`[History sync storing Status V3 complete], ${oe(e,te.statusV3Messages.length)}`):e.syncType!==B.HistorySyncHistorySyncType.PUSH_NAME&&(te.conversations=te.conversations.reduce(((e,t)=>{let n=null;try{n=(0,S.createWid)(t.id)}catch(e){__LOG__(3,void 0,void 0,void 0,["History sync"])`history_sync_notification_handler: invalid wid`}return n?e.concat(t):e}),[])),e.syncType===B.HistorySyncHistorySyncType.INITIAL_BOOTSTRAP){const t={},n=(0,L.assertGetMe)(),r=(0,S.toUserWid)(n),i=n.getDeviceId(),a={},o={},s=[];let l=0;const c=[];te.conversations.forEach((n=>{var d,p,f;let _=[];l+=n.messages.length;let g=[];0===n.messages.length&&(t[n.id]=-1),n.pHash&&(o[n.id]=n.pHash),n.messages.forEach(((r,i)=>{i===n.messages.length-1&&(t[n.id]=r.msgOrderId);const a=le(e,r.message);g.push(a),_=_.concat(ce(a))})),g=g.filter(Boolean).reverse();const m=(0,S.createWid)(n.id),y=n.contactPrimaryIdentityKey;if(y&&E.default.isUser(m)){const e=(0,Z.createSignalAddress)((0,S.toUserWid)(m)).toString(),t=(0,Z.bufferToStr)((0,I.toSignalCurvePubKey)(y));m.equals((0,L.getMeUser)())?ue(e,t):c.push({identifier:e,identityKey:t})}const v=(0,L.getGlobalSecurityNotifications)()&&!(0,T.getABPropConfigValue)("adv_v2_m6");if(!m.isStatusV3()&&v){const e=(0,h.genDeviceNotificationMsg)((0,S.createWid)(n.id),r,[i],[]);g.push(e)}let b;if(null!=(null===(d=n.disappearingMode)||void 0===d?void 0:d.initiator))switch(n.disappearingMode.initiator){case D.DisappearingModeInitiator.CHANGED_IN_CHAT:b=w.DisappearingModeInitiator.ChangedInChat;break;case D.DisappearingModeInitiator.INITIATED_BY_ME:b=w.DisappearingModeInitiator.InitiatedByMe;break;case D.DisappearingModeInitiator.INITIATED_BY_OTHER:b=w.DisappearingModeInitiator.InitiatedByOther}const A=null!=n.tcToken&&null!=n.tcTokenTimestamp,P={t:(0,u.maybeNumberOrThrowIfTooLarge)(null!==(p=n.conversationTimestamp)&&void 0!==p?p:n.lastMsgTimestamp),id:(0,S.createWid)(n.id),unreadCount:n.unreadCount,ephemeralDuration:n.ephemeralExpiration,ephemeralSettingTimestamp:n.ephemeralSettingTimestamp,disappearingModeInitiator:b,endOfHistoryTransferType:null!==(f=n.endOfHistoryTransferType)&&void 0!==f?f:C.ConversationEndOfHistoryTransferModelPropType.INCOMPLETE,name:n.name,notSpam:n.notSpam,pendingInitialLoading:!1,unreadMentionCount:n.unreadMentionCount,tcToken:A?n.tcToken:null,tcTokenTimestamp:A?n.tcTokenTimestamp:null};n.suspended&&U.default.add({id:P.id,suspended:!0},{merge:!1}),s.push(P),a[n.id]={chatInfo:P,msgs:g,reactionMessages:_}})),b.mdBootstrapMessagesCount=l,b.mdBootstrapChatsCount=te.conversations.length,se(b,e.historySyncStepStartedTs,!0),y.default.markInitialHistorySyncCountDebugStats(l,s.length);const d=te.conversations.some((e=>void 0!==e.unreadMentionCount));(0,L.setUnreadMentionCountEnabled)(d),yield z.default.bulkCreateIdentity(c),yield(0,A.default)([{cmd:"preempt",response:s,binarySize:10}])||Promise.resolve(),yield(0,H.handleInitialSyncMsgs)(a),yield(0,x.updateCurrentlyProcessed)(e.msgKey),re.mdTimestamp=(0,f.unixTimeMs)(),re.commit(!0),__LOG__(2)`[History sync storing initial sync complete] ${oe(e,l,s.length)}`,yield fe(te),(0,W.setHistoryInitialSyncBoundry)(t),(0,W.setInitialGroupPhash)(o)}else if(e.syncType===B.HistorySyncHistorySyncType.PUSH_NAME){se(b,e.historySyncStepStartedTs,!0);const t=te.pushnames.map((e=>({id:e.id||"",pushname:e.pushname||""})));yield(0,K.getContactTable)().bulkCreateOrMerge(t),yield(0,x.updateCurrentlyProcessed)(e.msgKey);const n=te.pushnames.map((e=>{const t=(0,S.createWid)(e.id||""),n=O.ContactCollection.get(t);return{id:t,pushname:e.pushname||"",type:(null==n?void 0:n.type)||"out",name:null==n?void 0:n.name}}));O.ContactCollection.add(n,{merge:!0}),re.mdTimestamp=(0,f.unixTimeMs)(),re.commit(),__LOG__(2)`[History sync storing initial pushname complete] with ${te.pushnames.length} records`}else if(e.syncType!==B.HistorySyncHistorySyncType.INITIAL_STATUS_V3){yield new Promise((e=>setTimeout(e,0)));const t=[];let r=[];const i=new Set,a=[],o=(0,W.getHistoryInitialSyncBoundry)();let l=0,c=0;for(let d=0;d<te.conversations.length;d++){const p=te.conversations[d],f=null==o?void 0:o[p.id];if(null!=f)for(let o=0;o<p.messages.length;o++){const d=n(69951).ChatCollection.get((0,S.createWid)(p.id)),h=(null==d?void 0:d.endOfHistoryTransferType)===C.ConversationEndOfHistoryTransferModelPropType.COMPLETE_AND_NO_MORE_MESSAGE_REMAIN_ON_PRIMARY;if(!d&&null!=f||d&&null==d.endOfHistoryTransferType||h){__LOG__(2,void 0,void 0,void 0,["History sync"])`One chat in sync payload ${oe(e)} is already marked as complete locally`;break}l++;const _=p.messages[o],g=(0,u.maybeNumberOrThrowIfTooLarge)(_.msgOrderId);if(null!=f&&-1!==f&&null!=g&&g>=f)continue;i.add(p.id);const m=le(e,_.message);0===o&&m&&d&&0===d.msgs.length&&a.push(m),r=r.concat(ce(m)),m&&t.push(m),yield(0,s.asyncSleepAfterGivenLoopIteration)(c++,100)}}b.mdBootstrapMessagesCount=l,b.mdBootstrapChatsCount=te.conversations.length,se(b,e.historySyncStepStartedTs,!0),0!==t.length&&(yield(0,H.handleProgressiveHistorySyncMsgs)(t,Array.from(i),r,a)),(0,V.setLastHistorySycnedChunk)(e.syncType,e.chunkOrder),yield(0,x.updateCurrentlyProcessed)(e.msgKey);const d=new Set;te.conversations.forEach((e=>{d.add((0,S.createWid)(e.id).toString());let t=null;if(null!=(null==o?void 0:o[e.id])&&(t=e.endOfHistoryTransferType),null!=t)return ie((0,S.createWid)(e.id),t)})),M.Cmd.onHistorySyncChunkProcessed(d),re.mdTimestamp=(0,f.unixTimeMs)(),re.commit(),__LOG__(2)`[History sync chunk storing recent or full chunk complete,  ${oe(e,l)}`}const ae=g.default.fromString(e.msgKey),de=new Map;var pe;de.set(ae.remote,[ae.id]),e.syncType!==B.HistorySyncHistorySyncType.INITIAL_STATUS_V3&&(0,q.sendAggregateReceipts)(ae.remote,q.RECEIPT_TYPE.HISTORY_SYNC_COMPLETION,void 0,de),yield(0,x.updateCurrentlyProcessed)(e.msgKey),Q.ServerProps.webMdMmsSyncDeletionRequest&&null!=e.downloadOptions.encFilehash&&Y.default.deleteMdHistorySyncBlob({directPath:e.downloadOptions.directPath,encFilehash:e.downloadOptions.encFilehash,signal:(new r).signal}).catch((()=>{__LOG__(3)`MMS client delete error`})),pe=te.progress,e.syncType===B.HistorySyncHistorySyncType.INITIAL_BOOTSTRAP?((0,V.setInitialHistorySyncComplete)(),(0,V.setHistorySyncStatus)({initialCompleted:!0}),M.Cmd.onInitialChatHistorySynced()):e.syncType===B.HistorySyncHistorySyncType.RECENT&&100===pe?(__LOG__(2,void 0,void 0,void 0,["History sync"])`Recent history sync complete`,(0,W.setHistoryInitialSyncBoundry)({}),(0,V.setHistorySyncStatus)({recentCompleted:!0}),M.Cmd.onRecentChatHistorySynced()):e.syncType===B.HistorySyncHistorySyncType.FULL&&100===pe&&(__LOG__(2,void 0,void 0,void 0,["History sync"])`Full history sync complete`,(0,W.setHistoryInitialSyncBoundry)({}),(0,V.setHistorySyncStatus)({fullCompleted:!0}),M.Cmd.onFullChatHistorySynced())}))).apply(this,arguments)}function ie(){return ae.apply(this,arguments)}function ae(){return(ae=(0,o.default)((function*(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=t,i=(0,k.getBridge)(),a={id:e,endOfHistoryTransferType:r};n&&(a.t=0),yield i.sendAndReceive("chat_collection","add",{things:[a],options:{merge:!0}}),yield(0,b.getTable)().merge(e.toString(),{endOfHistoryTransferType:r})}))).apply(this,arguments)}function oe(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const r=(e.msgKey||"").split("_")[2];return` type_${e.syncType}_order_${null!=e.chunkOrder?e.chunkOrder:"none"}_isReupload_${e.isReupload||0}}, id: ${r} ## msgCount: ${t}, chatCount: ${n}`}function se(e,t,n){e.mdTimestamp=(0,f.unixTimeMs)(),e.mdBootstrapStepDuration=(0,f.unixTimeMs)()-t,e.mdBootstrapStepResult=n?j.default.MD_BOOTSTRAP_STEP_RESULT.SUCCESS:j.default.MD_BOOTSTRAP_STEP_RESULT.FAILURE,e.commit()}function le(e,t){let n=null;try{n=ee.default.parseWebMessageInfo(t,"after")}catch(e){__LOG__(4,void 0,new Error)`[history sync] parseWebMessageInfo failed with error ${null==e?void 0:e.name} and stack ${null==e?void 0:e.stack}`}return n}function ce(e){const t=[];try{(0,N.parseWMIReaction)()&&null!=e&&e.reactions.forEach((n=>{const{key:r,senderTimestampMs:i,text:a,unread:o}=n,s=(0,$.convertToTextWithoutSpecialEmojis)(null!=a?a:""),l=!!r.fromMe,c=(0,$.decodeJid)(r.remoteJid);let d;r.fromMe?c.isUser()||(d=(0,L.getMeUser)()):d=(0,$.decodeJid)(r.participant);const u=new g.default({id:r.id,fromMe:l,remote:c,participant:d}),p=(0,L.getMeUser)(),f=!0===l?p:d||c;null!=f&&f instanceof E.default?null==s?__LOG__(4,void 0,new Error)`parseWebMsgInfoReaction:convertToTextWithoutSpecialEmojis reaction text is null.`:t.push({id:u,reactionTimestamp:i,reactionText:s,reactionParentKey:e.id,sender:f,unread:Boolean(o)}):__LOG__(4,void 0,new Error)`parseWebMsgInfoReaction: reaction sender should be a wid.`}))}catch(e){__LOG__(4,void 0,new Error)`[history sync] parseWebMsgInfoReaction failed with error ${null==e?void 0:e.name} and stack ${null==e?void 0:e.stack}`}return t}function de(e){switch(e){case 0:return j.default.MD_BOOTSTRAP_HISTORY_PAYLOAD_TYPE.INITIAL;case 1:return j.default.MD_BOOTSTRAP_HISTORY_PAYLOAD_TYPE.STATUS_V3;case 2:return j.default.MD_BOOTSTRAP_HISTORY_PAYLOAD_TYPE.FULL_HISTORY;case 3:return j.default.MD_BOOTSTRAP_HISTORY_PAYLOAD_TYPE.RECENT_HISTORY;default:return j.default.MD_BOOTSTRAP_HISTORY_PAYLOAD_TYPE.PUSHNAME}}function ue(){return pe.apply(this,arguments)}function pe(){return(pe=(0,o.default)((function*(e,t){const n=yield z.default.loadIdentityKey(e);n&&n!==t&&(__LOG__(4,void 0,new Error,!0,["history-sync"])`get changed self identity key from history sync,
exisiting length: ${n.length}, new length: ${t.length}`,SEND_LOGS("self-identity-change-from-history-sync"))}))).apply(this,arguments)}function fe(e){let t=Promise.resolve(),n=Promise.resolve();return null!=e.threadIdUserSecret&&(t=(0,P.setThreadIdUserSecret)(e.threadIdUserSecret)),null!=e.threadDsTimeframeOffset&&(n=(0,P.setThreadDsTimeframeOffset)(e.threadDsTimeframeOffset)),Promise.all([t,n])}},46462:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleE2eIdentityChange=function(e){const t=S.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.reject(t.error);const{wid:n,stanzaId:r,delay:s,offline:l}=t.success,v=(0,o.wap)("ack",{to:(0,E.DEVICE_JID)(n),id:(0,o.CUSTOM_STRING)(r),class:"notification"});if(null!=n.device&&n.device!==a.DEFAULT_DEVICE_ID)return __LOG__(2)`handleNewIdentity: ignore identity change from companion device`,Promise.resolve(v);if(n.equals((0,c.getMeUser)()))return(0,u.handleSelfPrimaryIdentityChange)(),Promise.resolve(v);const T=!!l&&!d.OfflineMessageHandler.isResumeFromRestartComplete();return(0,f.handleMessage)(String(n),T,(0,i.default)((function*(){yield(0,u.clearDeviceRecordForIdentityChange)(n,T);return(yield(0,h.getSignalProtocolStore)().loadIdentityKey((0,y.createSignalAddress)(n).toString()))&&(__LOG__(2)`handleE2eIdentityChange: ${n.toString()} has old identity, establishing new session`,yield m.Session.deleteRemoteInfo(n),(0,_.addSecurityCodeChangedNotifications)(n,T),(0,g.sendTcTokenWhenDeviceIdentityChange)(n),T||(null!=s?(0,p.ensureE2ESessionsWithDelay)([n],s):(0,p.ensureE2ESessions)([n]))),v})))};var i=r(n(48926)),a=n(52230),o=n(31914),s=n(71914),l=n(81663),c=n(99234),d=n(28237),u=n(1291),p=n(97398),f=n(15746),h=n(52083),_=n(9701),g=n(41088),m=n(77605),y=n(93832),E=n(39410);const S=new s.WapParser("identityChange",(e=>{e.assertTag("notification"),e.assertAttr("type","encrypt"),e.child("identity");const t=parseInt(e.maybeAttrString("delay"),10);return{wid:(0,l.deviceJidToDeviceWid)(e.attrPhoneDeviceJid("from")),stanzaId:e.attrString("id"),delay:isFinite(t)&&t>0?t:null,offline:e.hasAttr("offline")?e.attrString("offline"):null}}))},65341:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.SUPPORTED_DIRTY_TYPE=t.SUPPORTED_DIRTY_PROTOCOLS=void 0,t.handleDirtyBits=function(){return v.apply(this,arguments)};var i=r(n(48926)),a=n(41075),o=n(99609),s=n(88102),l=n(45606),c=r(n(69153)),d=n(99234),u=n(28237),p=r(n(11339)),f=n(97153),h=n(74028),_=n(38804);const g={groups:"groups",account_sync:"account_sync",syncd_app_state:"syncd_app_state"};t.SUPPORTED_DIRTY_TYPE=g;function m(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=e.map((e=>a.ACCOUNT_SYNC_TYPE.cast(e))).filter(Boolean);return 0===t.length&&(t=Array.from(a.ACCOUNT_SYNC_TYPE.members())),Promise.all(t.map((e=>e===a.ACCOUNT_SYNC_TYPE.DEVICES?S():e===a.ACCOUNT_SYNC_TYPE.PICTURE?(0,a.getAndUpdateProfilePicture)():void(e===a.ACCOUNT_SYNC_TYPE.PRIVACY?(0,a.updatePrivacySettings)():e===a.ACCOUNT_SYNC_TYPE.BLOCKLIST&&(0,a.updateBlocklist)()))))}function y(e){return null!=e.patches&&e.patches.length>0||null!=e.snapshot}function E(){return s.Cmd.once(s.APP_STATE_SYNC_COMPLETED,(e=>{const t=e.some(y);new p.default.MdAppStateDirtyBits({dirtyBitsFalsePositive:!t}).commit()})),(0,_.markCollectionsForSync)(Array.from(l.CollectionName.members()))}function S(){const e=String((0,d.getMeUser)());return u.OfflineMessageHandler.isResumeFromRestartComplete()?u.OfflineMessageHandler.isResumeOnSocketDisconnectInProgress()?(0,f.addUserToPendingDeviceSync)([e]):(0,a.getDevices)("notification"):(c.default.addOfflinePendingDevice(e,null),Promise.resolve())}function v(){return(v=(0,i.default)((function*(e){const{supported:t,unsupported:n,protocols:r}=e;__LOG__(2)`handleDirtyBits: handle dirty bits, supported: ${t.map((e=>e.type)).join(",")}, unsupported: ${n.map((e=>e.type)).join(",")}`;const i=[...n,...t];return yield Promise.all(t.map((e=>{const t=e.type;return t===g.groups?(0,h.queryAndUpdateAllGroupMetadata)():t===g.account_sync?m(r):t===g.syncd_app_state?E():void 0}))),(0,o.clearDirtyBits)(i)}))).apply(this,arguments)}t.SUPPORTED_DIRTY_PROTOCOLS={devices:"devices",picture:"picture",privacy:"privacy",blocklist:"blocklist"}},86741:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return h.apply(this,arguments)};var i=r(n(48926)),a=n(71914),o=n(88102),s=n(65341),l=n(89816),c=n(25773),d=n(28237),u=n(70768),p=n(37222);const f=new a.WapParser("infoBulletinParser",(e=>{if(e.assertTag("ib"),e.assertFromServer(),e.hasChild(p.INFO_TYPE.DIRTY)){const t=[],n=[],r=[];return e.forEachChildWithTag(p.INFO_TYPE.DIRTY,(e=>{const i={type:e.attrString("type"),timestamp:e.attrInt("timestamp")};if("account_sync"===i.type){e.mapChildren((e=>e.tag())).forEach((e=>{s.SUPPORTED_DIRTY_PROTOCOLS.hasOwnProperty(e)&&r.push(e)})),n.push(i)}else s.SUPPORTED_DIRTY_TYPE.hasOwnProperty(i.type)?n.push(i):t.push(i)})),{type:p.INFO_TYPE.DIRTY,supported:n,unsupported:t,protocols:r}}if(e.hasChild(p.INFO_TYPE.ROUTING)){const t=e.child(p.INFO_TYPE.ROUTING);return{type:p.INFO_TYPE.ROUTING,edgeRouting:t.child("routing_info").contentBytes(),domain:t.hasChild("dns_domain")?t.child("dns_domain").contentEnum(l.DOMAINS):null}}if(e.hasChild(p.INFO_TYPE.DOWNGRADE))return{type:p.INFO_TYPE.DOWNGRADE};if(e.hasChild(p.INFO_TYPE.OFFLINE))return{count:e.child(p.INFO_TYPE.OFFLINE).attrInt("count"),type:p.INFO_TYPE.OFFLINE};if(e.hasChild(p.INFO_TYPE.OFFLINE_PREVIEW))return{count:{message:e.child(p.INFO_TYPE.OFFLINE_PREVIEW).attrInt("message"),receipt:e.child(p.INFO_TYPE.OFFLINE_PREVIEW).attrInt("receipt"),notification:e.child(p.INFO_TYPE.OFFLINE_PREVIEW).attrInt("notification")},type:p.INFO_TYPE.OFFLINE_PREVIEW};if(e.hasChild(p.INFO_TYPE.TOS)){const t=[];return e.child("tos").forEachChildWithTag("notice",(e=>{t.push(e.attrString("id"))})),{type:p.INFO_TYPE.TOS,noticeIds:t}}return null}));function h(){return(h=(0,i.default)((function*(e){const t=f.parse(e);if(t.error)throw __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,t.error;const n=t.success;if(n)switch(n.type){case p.INFO_TYPE.DIRTY:return yield(0,s.handleDirtyBits)(n),"NO_ACK";case p.INFO_TYPE.ROUTING:return(0,l.handleRoutingInfo)(n),"NO_ACK";case p.INFO_TYPE.DOWNGRADE:return o.Cmd.downgradeWebclient(),"NO_ACK";case p.INFO_TYPE.OFFLINE:return d.OfflineMessageHandler.setOfflineSessionComplete(n.count),(0,c.reportOfflineNotifications)(),"NO_ACK";case p.INFO_TYPE.OFFLINE_PREVIEW:return yield d.OfflineMessageHandler.setOfflineMessagePreviewCounter(n.count),"NO_ACK";case p.INFO_TYPE.TOS:return u.TosManager.maybeUpdateServer(n.noticeIds),"NO_ACK"}else __LOG__(3)`handleInfoBulletin unrecognized info bulletin`}))).apply(this,arguments)}},89816:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DOMAINS=void 0,t.handleRoutingInfo=function(e){let t=e.domain;if(!t){const e=(0,i.getRoutingInfo)();t=e?e.domain:a.fb}const n=(0,r.bytesToBuffer)(e.edgeRouting);(0,i.setRoutingInfo)({domain:t,edgeRouting:n}),__LOG__(2)`handleInfoBulletin setting and domain: ${t} and edgeRouting:`};var r=n(87614),i=n(58052);const a={fb:"fb",sl:"sl"};t.DOMAINS=a},37222:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.INFO_TYPE=void 0;const n=Object.freeze({DIRTY:"dirty",DOWNGRADE:"downgrade_webclient",ROUTING:"edge_routing",OFFLINE:"offline",OFFLINE_PREVIEW:"offline_preview",TOS:"tos"});t.INFO_TYPE=n},70605:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return _.apply(this,arguments)};var i=r(n(48926)),a=n(15688),o=r(n(45095)),s=n(31914),l=n(71914),c=n(99234),d=n(98969),u=n(16258),p=n(3151),f=n(39410);const h=new l.WapParser("mediaRetryNotification",(e=>{e.assertTag("notification");const t=e.maybeChild("error");if(t)return{msgId:e.attrString("id"),ciphertext:null,iv:null,errorCode:u.MediaRetryNotificationResultType.cast(t.attrInt("code"))};const n=e.child("encrypt");return{msgId:e.attrString("id"),ciphertext:n.child("enc_p").contentBytes(),iv:n.child("enc_iv").contentBytes(d.ENC_IV_SIZE),errorCode:null}}));function _(){return(_=(0,i.default)((function*(e){const t=h.parse(e);if(t.error)throw __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,t.error;const{msgId:n,errorCode:r}=t.success,i=(0,s.wap)("ack",{id:(0,s.CUSTOM_STRING)(n),class:"notification",type:"mediaretry",to:(0,f.USER_JID)((0,c.getMeUser)())});if(null!=r)return p.RequestMediaReuploadManager.resolveMediaReupload({msgId:n,result:r}),i;const{ciphertext:l,iv:u}=t.success,_=p.RequestMediaReuploadManager.getMediaKey(n);if(!_)return __LOG__(3)`handleMediaRetryNotification: mediaKey is not found for msgId ${n}`,i;const{stanzaId:g,directPath:m,result:y}=yield(0,d.decryptMediaRetryNotification)((0,a.decodeB64)(_),n,(0,o.default)(u,"iv"),(0,o.default)(l,"ciphertext"));if(g!==n)throw new Error("handleMediaRetryNotification: msg id does not match");return p.RequestMediaReuploadManager.resolveMediaReupload({msgId:n,result:y,directPath:m}),i}))).apply(this,arguments)}},80278:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.decryptE2EPayload=function(){return b.apply(this,arguments)};var i=r(n(48926)),a=n(50796),o=n(66751),s=n(15461),l=n(46308),c=n(58853),d=n(6303),u=n(8001),p=n(49714),f=n(12037),h=n(45033),_=n(84886),g=r(n(11339)),m=n(53348),y=n(52083),E=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=v(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(77605)),S=n(27286);function v(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(v=function(e){return e?n:t})(e)}function T(e,t,n){const{e2eType:r,ciphertext:i}=e;switch(r){case h.CiphertextType.Skmsg:return t.isGroup()||t.isBroadcast()?n?E.Cipher.decryptGroupSignalProto(t,n,i):Promise.reject(new Error(`['messaging'] decryptEnc: receive msg from ${t.toString()} without participant`)):Promise.reject(new Error(`['messaging'] decryptEnc: Can not do skmsg for non group ${t.toString()}`));case h.CiphertextType.Pkmsg:case h.CiphertextType.Msg:const e=t.isUser()?t:n;return e?E.Cipher.decryptSignalProto(e,r,i):Promise.reject(new Error(`['messaging'] decryptEnc: receive msg from ${t.toString()} without participant`))}}function b(){return(b=(0,i.default)((function*(e){const{bizInfo:t,msgInfo:n,paymentInfo:r,deviceIdentity:h,encs:E,msgMeta:v}=e;if(null!=n.author.device&&0!==n.author.device){if(!(yield(0,l.validateADVwithEncs)(n.author,h,E,!!n.offline)))return __LOG__(3,void 0,void 0,void 0,["messaging"])`decryptE2EPayload: msgId::${n.externalId}, validateADVIdentity failed`,{result:p.E2EProcessResult.RETRY,retryCount:E[0].retryCount}}const b=yield(0,o.promiseReduce)(e.encs,((e,o)=>{if(e.result!==p.E2EProcessResult.SUCCESS)return Promise.resolve(e);const l=(0,S.getFrom)(n),h=new g.default.E2eMessageRecv({e2eCiphertextType:(0,c.metricsCiphertextType)(o.e2eType),e2eCiphertextVersion:c.CIPHERTEXT_VERSION,e2eDestination:(0,c.metricsDestinationType)(l),e2eSuccessful:!1,messageMediaType:o.mediaType?(0,c.metricsMediaType)(o.mediaType):g.default.MEDIA_TYPE.NONE,retryCount:o.retryCount});return T(o,l,n.author).then(function(){var e=(0,i.default)((function*(e){h.e2eSuccessful=!0,h.weight=1e3,h.commit();const i={retryCount:o.retryCount,e2eType:o.e2eType,mediaType:o.mediaType,hideFail:o.hideFail};return __LOG__(2,void 0,void 0,void 0,["messaging"])`decryptE2EPayload: msgId::${n.externalId} done`,yield(0,m.processDecryptedProto)(e,n,r,i,t,void 0,v),__LOG__(2,void 0,void 0,void 0,["messaging"])`processDecryptedProto: msgId::${n.externalId} done`,{result:p.E2EProcessResult.SUCCESS}}));return function(){return e.apply(this,arguments)}}()).catch((0,a.filteredCatch)([u.SignalDecryptionError,d.UnknownMessageError],function(){var e=(0,i.default)((function*(e){return __LOG__(3,void 0,void 0,void 0,["messaging"])`decryptE2EPayload: msgId::${n.externalId}, ${e.toString()}`,h.weight=1,h.commit(),o.hideFail||(yield(0,m.processPlaceholderMsg)(n,p.PlaceholderType.E2E)),{result:p.E2EProcessResult.RETRY,retryCount:o.retryCount}}));return function(){return e.apply(this,arguments)}}())).catch((0,a.filteredCatch)(u.SignalMessageCounterError,function(){var e=(0,i.default)((function*(e){if(__LOG__(3,void 0,void 0,void 0,["messaging"])`decryptE2EPayload: msgId::${n.externalId}, signal counter error: ${e}`,null!=n.offline&&"peer"!==n.category){const e=(0,S.messageInfoToKey)(n),t=yield(0,_.getMsgByMsgKey)(e);if(null==t&&(__LOG__(4,void 0,new Error,!0,["messaging"])`decryptE2EPayload: msgId::${n.externalId}, creating placeholder (upload logs for debugging)`,SEND_LOGS("handleMsg: decryption counter error creating placeholder"),o.hideFail||(yield(0,m.processPlaceholderMsg)(n,p.PlaceholderType.E2E))),null==t||t.type===s.MSG_TYPE.CIPHERTEXT)return __LOG__(2,void 0,void 0,void 0,["messaging"])`decryptE2EPayload: msgId::${n.externalId}, missing message for repeated signal counter`,{result:p.E2EProcessResult.RETRY,retryCount:o.retryCount}}return __LOG__(2,void 0,void 0,void 0,["messaging"])`decryptE2EPayload: msgId::${n.externalId}, ignore repeated signal counter`,{result:p.E2EProcessResult.SUCCESS}}));return function(){return e.apply(this,arguments)}}())).catch((0,a.filteredCatch)(f.HsmMismatchError,(e=>(__LOG__(3,void 0,void 0,!0,["messaging"])`decryptE2EPayload: msgId::${n.externalId}, error: ${null==e?void 0:e.name}, stack: ${null==e?void 0:e.stack}`,SEND_LOGS("handleMsg: hsm mismatch error"),h.weight=1,h.commit(),{result:p.E2EProcessResult.HSM_MISMATCH})))).catch((0,a.filteredCatch)(d.ReactionValidationError,(e=>(__LOG__(3,void 0,void 0,!0,["messaging"])`decryptE2EPayload: msgId::${n.externalId}, error: ${null==e?void 0:e.name}, stack: ${null==e?void 0:e.stack}`,SEND_LOGS("handleMsg: ReactionValidationError"),{result:p.E2EProcessResult.PARSE_VALIDATION_ERROR})))).catch((e=>(__LOG__(3,void 0,void 0,!0,["messaging"])`decryptE2EPayload: msgId::${n.externalId}, error: ${null==e?void 0:e.name}, stack: ${null==e?void 0:e.stack}`,SEND_LOGS("handleMsg: parse decrypted message error"),h.weight=1,h.commit(),{result:p.E2EProcessResult.PARSE_ERROR})))}),{result:p.E2EProcessResult.SUCCESS});return yield(0,y.getSignalProtocolStore)().flushBufferToDiskIfNotMemOnlyMode(),b}))).apply(this,arguments)}},6303:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.UnknownMessageError=t.ReactionValidationError=t.DeviceSentMessageError=void 0;var i=n(40265),a=r(n(11339));class o extends((0,i.customError)("DeviceSentMessageError")){constructor(e,t){t===a.default.DSM_ERROR.MISSING_DSM?super("parseMessage: message should be deviceSentMessage"):t===a.default.DSM_ERROR.INVALID_SENDER?super("parseMessage: message should not be deviceSentMessage"):t===a.default.DSM_ERROR.INVALID_DSM?super("parseMessage: invalid deviceSentMessage"):super("parseMessage: unknown deviceSentMessage error"),new a.default.MdBadDeviceSentMessage({peerType:e,dsmError:t}).commit(),this.peerType=e,this.dsmError=t}}t.DeviceSentMessageError=o;class s extends((0,i.customError)("UnknownMessageError")){}t.UnknownMessageError=s;class l extends((0,i.customError)("ReactionValidationError")){}t.ReactionValidationError=l},49714:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PlaceholderType=t.MESSAGE_TYPE=t.HostStorageEnumType=t.E2EProcessResult=t.ActualActorsEnumType=void 0;const r=n(76672)({Self:1,Bsp:2});t.ActualActorsEnumType=r;const i=n(76672)({OnPremise:1,Facebook:2});t.HostStorageEnumType=i;const a=n(76672).Mirrored(["SUCCESS","RETRY","HSM_MISMATCH","BACKFILL","PARSE_ERROR","PARSE_VALIDATION_ERROR"]);t.E2EProcessResult=a;const o=n(76672).Mirrored(["E2E","FANOUT"]);t.PlaceholderType=o;const s=Object.freeze({CHAT:"chat",GROUP:"group",PEER_BROADCAST:"peer_broadcast",OTHER_BROADCAST:"other_broadcast",DIRECT_PEER_STATUS:"direct_peer_status",OTHER_STATUS:"other_status"});t.MESSAGE_TYPE=s},70569:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=p.incomingMsgParser.parse(e);if(t.error){const n=p.incomingMsgParserForAckOnly.parse(e);if(n.error)return Promise.reject(t.error);const{externalId:r,from:i,type:a}=n.success;return(0,h.sendAck)(r,i,a)}const n=t.success,{msgMeta:r,msgInfo:_}=n;_.clientReceivedTsMillis=(0,a.unixTimeMs)(),null!=_.offline&&(c.OfflineMessageHandler.addOfflinePendingMessage(),c.OfflineMessageHandler.offlineStanzaReceivedAfterCompelete());c.OfflineMessageHandler.isResumeFromRestartComplete()&&delete n.msgInfo.offline;return(0,d.handleMessage)(_.chat.toString(),!!n.msgInfo.offline,(0,i.default)((function*(){if(_.msgProcessStartTsMillis=(0,a.unixTimeMs)(),r.isUnavailable&&(__LOG__(2,void 0,void 0,void 0,["messaging"])`handleMessage: msgId::${_.externalId}, get fanout placeholder`,yield(0,f.processPlaceholderMsg)(_,s.PlaceholderType.FANOUT),(0,h.sendReceipt)(_,r,{result:s.E2EProcessResult.BACKFILL})),null!=_.offline){const e=yield c.OfflineMessageHandler.decryptOfflineMessage(n);e.result!==s.E2EProcessResult.SUCCESS||_.category===l.CATEGORY_PEER?(0,h.sendReceipt)(_,r,e):u.default.addOfflineMessage([{receiptInfo:{externalId:_.externalId,from:(0,h.getFrom)(_),author:_.author}}])}else{__LOG__(2,void 0,void 0,void 0,["messaging"])`handleMessage: msgId::${_.externalId}, start processing inline message`;const e=yield(0,o.decryptE2EPayload)(n);(0,h.sendReceipt)(_,r,e)}})))};var i=r(n(48926)),a=n(92844),o=n(80278),s=n(49714),l=n(12037),c=n(28237),d=n(15746),u=r(n(29783)),p=n(20365),f=n(53348),h=n(27286)},12037:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PAY_NODE_TYPES=t.MSG_VERIFIED_LEVEL=t.MSG_TYPES=t.HsmMismatchError=t.CATEGORY_PEER=void 0;var r=n(40265);t.MSG_TYPES={text:"text",media:"media",pay:"pay",reaction:"reaction"};t.MSG_VERIFIED_LEVEL={high:"high",low:"low",unknown:"unknown"};t.CATEGORY_PEER="peer";class i extends((0,r.customError)("HSMMismatchError")){}t.HsmMismatchError=i;t.PAY_NODE_TYPES={send:"send",request:"request",futureproof:"futureproof","request-decline":"request-decline","request-cancel":"request-cancel",invite:"invite"}},48616:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.logReceivedMessagesInWAM=function(e,t,n,r,_){(function(e,t,n,r,o){const _=(0,a.unixTimeMs)();e.forEach((e=>{const a=new f.Msg(e),g=new p.default.MessageReceive((0,i.default)({messageType:a.getWamMessageType(),messageMediaType:a.getWamMediaType(),messageIsInternational:a.isInternational,messageIsOffline:t,isViewOnce:Boolean(a.isViewOnce)},(0,u.getGroupMetricsFromChatWid)(a.from)));if(a.from.isGroup()){var m;const e=null===(m=d.default.get(a.from))||void 0===m?void 0:m.cachedDeviceSizeBucket;null!=e&&(g.deviceSizeBucket=e)}else{const e=(0,c.getDisappearingModeSettingForUser)(a.from);null!=e&&(g.senderDefaultDisappearingDuration=e.duration);const t=(0,l.getMaybeMeUser)(),n=(0,c.getDisappearingModeSettingForUser)(t);null!=n&&(g.receiverDefaultDisappearingDuration=n.duration)}null!=r&&(g.messageReceiveT0=r-n,g.messageReceiveT1=_-r,null!=o&&(g.messageQueueTime=o-r)),null!=a.ephemeralDuration&&a.ephemeralDuration>0&&(g.ephemeralityDuration=a.ephemeralDuration);const y=a.getWamDisappearingModeInitiator();if(null!=y&&(g.disappearingChatInitiator=y),g.commit(),a.chat&&!a.isSentByMe)if((0,s.shouldBlockByCountry)(a.chat.contact)){new p.default.GatedMessageReceived({chatGatedReason:p.default.CHAT_GATED_REASON.COUNTRY}).commit()}else if((0,h.shouldBlockByTos)(a.chat.contact)){new p.default.GatedMessageReceived({chatGatedReason:p.default.CHAT_GATED_REASON.TOS3}).commit()}}))})(e,t,n,r,_),function(e){(0,o.handleActivitiesForChatThreadLogging)(e.map((e=>({activityType:e.id.fromMe?"msgSend":"msgReceive",ts:e.t,chatId:e.id.remote,isViewOnce:e.isViewOnce}))))}(e)};var i=r(n(81109)),a=n(92844),o=n(16116),s=n(47473),l=n(99234),c=n(28307),d=r(n(63928)),u=n(42515),p=r(n(11339)),f=n(17304),h=n(37894)},20365:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.incomingMsgParserForAckOnly=t.incomingMsgParser=void 0;var i=r(n(81109)),a=n(71914),o=n(81663),s=n(45454),l=n(2599),c=n(99234),d=n(49714),u=n(12037),p=n(45033),f=n(75295),h=n(52586),_=n(27286),g=n(21224);const m=new a.WapParser("incomingMsgParser",(e=>{e.assertTag("message"),e.hasAttr("to")&&e.assertAttr("to",(0,c.assertGetMe)().toJid());const t=e.mapChildrenWithTag("enc",(e=>({e2eType:e.attrEnumValues("type",p.CiphertextType.members()),mediaType:p.MediaType.cast(e.maybeAttrString("mediatype")),ciphertext:e.contentBytes(),retryCount:e.hasAttr("count")?e.attrInt("count"):0,hideFail:"hide"===e.maybeAttrString("decrypt-fail")}))),n=e.maybeChild("device-identity"),r=n?n.contentBytes():null,a=function(e,t){const n={externalId:e.attrString("id"),ts:e.attrTime("t"),edit:e.hasAttr("edit")?e.attrInt("edit"):-1,isHsm:e.hasChild("hsm"),count:e.hasAttr("count")?e.attrInt("count"):null,pushname:e.hasAttr("notify")?e.attrString("notify"):null,category:e.hasAttr("category")?e.attrString("category"):null,offline:e.hasAttr("offline")?e.attrString("offline"):null},r=(0,o.jidWithTypeToWid)(e.attrJidWithType("from")),a=e.hasAttr("participant")?(0,o.deviceJidToDeviceWid)(e.attrPhoneDeviceJid("participant")):null,l=e.hasAttr("recipient")?(0,o.userJidToUserWid)(e.attrPhoneUserJid("recipient")):null,c=t.every((e=>e.e2eType!==p.CiphertextType.Skmsg)),u=t.some((e=>e.retryCount>0));let f;const h={},g=e.maybeChild("participants");if(g){const e=[];g.forEachChildWithTag("to",(t=>{const n=(0,o.deviceJidToDeviceWid)(t.attrPhoneDeviceJid("jid")),r=t.maybeAttrString("eph_setting");e.push(n),null!=r&&(h[n.toString()]=r)})),f=e}if(r.isUser())return null!=l?(0,_.isPeer)(r)?(0,i.default)((0,i.default)({type:d.MESSAGE_TYPE.CHAT},n),{},{chat:(0,s.toUserWid)(l),author:r}):e.throw("recipient on non peer chat message"):(0,i.default)((0,i.default)({type:d.MESSAGE_TYPE.CHAT},n),{},{chat:(0,s.toUserWid)(r),author:r});if(r.isGroup())return null==a?e.throw("group message with no participant"):(0,i.default)((0,i.default)({type:d.MESSAGE_TYPE.GROUP},n),{},{chat:r,author:a,isDirect:c});if(r.isBroadcast()&&!r.isStatusV3()){if(null==a)return e.throw("broadcast message with no participant");if((0,_.isPeer)(a)){if(null==f){if(!u)return e.throw("peer broadcast message with no participants node");f=[]}return(0,i.default)((0,i.default)({type:d.MESSAGE_TYPE.PEER_BROADCAST},n),{},{chat:r,author:a,isDirect:c,bclParticipants:f,bclHashValidated:!1,bclEphSettings:h})}return(0,i.default)((0,i.default)({type:d.MESSAGE_TYPE.OTHER_BROADCAST},n),{},{chat:r,author:a,isDirect:c,ephSetting:e.maybeAttrString("eph_setting")})}if(r.isBroadcast()&&r.isStatusV3())return null==a?e.throw("status message with no participant"):(0,_.isPeer)(a)&&c?null==f?(0,i.default)((0,i.default)({type:d.MESSAGE_TYPE.DIRECT_PEER_STATUS},n),{},{chat:r,author:a,isDirect:c}):(0,i.default)((0,i.default)({type:d.MESSAGE_TYPE.DIRECT_PEER_STATUS},n),{},{chat:r,author:a,bclParticipants:f,bclHashValidated:!1}):(0,i.default)((0,i.default)({type:d.MESSAGE_TYPE.OTHER_STATUS},n),{},{chat:r,author:a,isDirect:c});return e.throw("Unrecognized message type")}(e,t);return{encs:t,msgInfo:a,msgMeta:function(e,t){const n=e.hasChild("unavailable");n||0!==t.length||e.throw("incomingMsgParser: to have enc node children");return{isUnavailable:n,type:e.attrEnum("type",u.MSG_TYPES),rawTs:e.attrString("t"),urlNumber:e.hasChild("url_number"),urlText:e.hasChild("url_text")}}(e,t),bizInfo:function(e){const t=e.hasChild("verified_name")?e.child("verified_name").contentBytes():null,n=e.attrEnumOrDefault("verified_level",u.MSG_VERIFIED_LEVEL,null),r=e.hasAttr("verified_name")?e.attrInt("verified_name"):-1,i=e.maybeChild("biz");let a=null;if(null!=i){const e=d.ActualActorsEnumType.cast(i.maybeAttrInt("actual_actors")),t=d.HostStorageEnumType.cast(i.maybeAttrInt("host_storage")),n=i.maybeAttrInt("privacy_mode_ts");null!=e&&null!=t&&null!=n&&(a={actualActors:e,hostStorage:t,privacyModeTs:n})}const o=null==i?void 0:i.maybeAttrString("native_flow_name");return{verifiedNameCert:t,verifiedLevel:n,verifiedNameSerial:r,privacyMode:a,nativeFlowName:o}}(e),paymentInfo:function(e){let t=null;const n=e.hasChild("pay")?e.child("pay"):null,r=e.hasChild("transaction")?e.child("transaction"):null,i=(0,o.jidWithTypeToWid)(e.attrJidWithType("from")).isGroup(),a=e.hasAttr("participant")?(0,o.jidWithTypeToWid)(e.attrJidWithType("participant")):null;if((0,f.isNoviTransaction)(n)||(0,f.isNoviTransaction)(r))t={futureproofed:!0};else if(r){const e=(0,f.parseTransactionNode)(r);e&&(t=y(i,a,(0,s.createWid)(e.receiver.toString()))?{receiverJid:e.receiver.toString(),currency:e.currency,amount1000:e.amount1000,transactionTimestamp:e.ts,txnStatus:(0,h.getPaymentTxnWebStatus)(e.status)}:{receiverJid:e.receiver.toString(),currency:e.currency,amount1000:e.amount1000,transactionTimestamp:e.ts})}else if(n){switch(n.attrEnum("type",u.PAY_NODE_TYPES)){case u.PAY_NODE_TYPES.send:const{amount1000:r,currency:o}=(0,l.getAmount1000AndCurrency)(n),c=n.hasAttr("receiver")?n.attrString("receiver"):e.attrString("recipient");t=y(i,a,(0,s.createWid)(c))?{receiverJid:c,currency:o,amount1000:r,transactionTimestamp:e.attrInt("t"),txnStatus:g.PaymentInfoTxnStatus.INIT}:{receiverJid:c,currency:o,amount1000:r,transactionTimestamp:e.attrInt("t")};break;case u.PAY_NODE_TYPES.request:case u.PAY_NODE_TYPES.invite:}}return t}(e),deviceIdentity:r}}));function y(e,t,n){if(e&&null!=t&&null!=n){const e=(0,c.getMeUser)();if(!e.equals(t)&&!e.equals(n))return!1}return!0}t.incomingMsgParser=m;const E=new a.WapParser("incomingMsgParserForAckOnly",(e=>(e.assertTag("message"),{externalId:e.attrString("id"),from:(0,o.jidWithTypeToWid)(e.attrJidWithType("from")),type:e.attrEnum("type",u.MSG_TYPES)})));t.incomingMsgParserForAckOnly=E},53348:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.createReactionsRow=Q,t.processDecryptedProto=function(){return H.apply(this,arguments)},t.processPlaceholderMsg=function(){return z.apply(this,arguments)},t.processReactionMsg=q,t.processRenderableMsg=V,t.storeReactionMsgBulk=function(e){const t=e.map((e=>(0,l.webMsgInfoReactionTypeToReactionsRow)(e)));return t.map((e=>`${e.msgKey.toString()} to ${e.parentMsgKey}`)).toString(),(0,U.addOrUpdateReactionsDBBulk)(t)};var i=r(n(81109)),a=r(n(48926)),o=n(15461),s=n(8197),l=n(67811),c=r(n(89867)),d=n(45454),u=n(84902),p=n(78027),f=n(10823),h=r(n(69153)),_=n(24808),g=n(6303),m=n(99234),y=n(9025),E=r(n(39505)),S=n(57701),v=n(19655),T=n(65582),b=n(82568),C=n(49714),A=n(12037),P=n(39354),M=n(65414),O=n(48616),I=n(84886),w=r(n(11339)),R=(n(17304),r(n(29783))),D=n(5819),L=n(60629),N=n(55552),k=n(16150),U=n(76332),G=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=W(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(77605)),x=n(26704),B=r(n(83147)),F=n(66167),j=n(93832),Y=n(27286),K=n(22695);function W(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(W=function(e){return e?n:t})(e)}function H(){return(H=(0,a.default)((function*(e,t,n,r,i){let a=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],s=arguments.length>6?arguments[6]:void 0;const l=a?(0,j.unpad)(e):new Uint8Array(e),c=(0,u.decodeProtobuf)(_.MessageSpec,l);if(null==t.offline&&__LOG__(2,void 0,void 0,void 0,["messaging"])`processDecryptedProto: msgId::${t.externalId}, message decrypted: `,!t.isHsm&&c.highlyStructuredMessage)throw new A.HsmMismatchError;const p=(0,Y.getFrom)(t);if(!(yield(0,K.isFromKnownDevice)(t.author))){const e=(0,d.toUserWid)(t.author);throw null==t.offline?(0,f.syncDeviceListJob)([e],null,null):h.default.addOfflinePendingDevice(String(e),null),new g.UnknownMessageError(`[messaging] msgId::${t.externalId}, processDecryptedProto: reject message from unknown device`)}if(t.type===C.MESSAGE_TYPE.PEER_BROADCAST&&r.retryCount>0){const e=yield(0,I.getMsgByMsgKey)((0,Y.messageInfoToKey)(t));null!=(null==e?void 0:e.broadcastParticipants)&&(t.bclParticipants=e.broadcastParticipants,null!=e.broadcastEphSettings&&(t.bclEphSettings=e.broadcastEphSettings))}c.messageContextInfo&&(0,M.handleICDCData)(t.author,t.chat.isUser()?t.chat:null,c.messageContextInfo);const y=yield(0,Y.parseMessage)(t,r.e2eType,c,n,i,e),E=[];if(y.history)(0,v.handleHistorySyncNotification)(y.history,p,t.externalId);else if(y.securityNotificationEnabled)(0,m.setGlobalSecurityNotifications)(y.securityNotificationEnabled.isEnabled);else if(y.appStateSyncKeyShare)(0,b.handleAppStateSyncKeyShare)(y.appStateSyncKeyShare,p);else if(y.appStateSyncKeyRequest)(0,T.handleAppStateSyncKeyRequest)(y.appStateSyncKeyRequest,p);else{var P;let e=!1;if(null==y.deviceSent?e=!0:y.deviceSent.phash?e=yield(0,K.validateBclHash)(y.deviceSent.phash,y.deviceSent.info):y.deviceSent.destination&&(e=yield(0,K.validateMsgDestination)(y.deviceSent.destination,t)),!e)throw new g.DeviceSentMessageError((0,Y.getDeviceType)(t.author),w.default.DSM_ERROR.INVALID_DSM);if((0,S.receiveReactionsEnabled)()&&(null==s?void 0:s.type)===A.MSG_TYPES.reaction&&y.renderableMsgs.length>0&&(1!==y.renderableMsgs.length||y.renderableMsgs[0].type!==o.MSG_TYPE.REACTION))throw new g.ReactionValidationError("[messaging] Reaction failed validation due to missing ReactionMessage in proto");if((0,S.receiveReactionsEnabled)()&&(null===(P=y.renderableMsgs[0])||void 0===P?void 0:P.type)===o.MSG_TYPE.REACTION)E.push(q(y.renderableMsgs[0],t));else{const e=r.retryCount>0&&(0,Y.placeholderCheck)(t);E.push(V(y.renderableMsgs,t,n,i,e)),null!=y.storeMsg&&(0,I.storeMessages)([y.storeMsg],y.storeMsg.id.remote)}null!=y.senderKey&&E.push(G.Session.createGroupSignalSession(t.author,y.senderKey.groupId,y.senderKey.key)),t.pushname&&(0,k.updatePushname)(t.author,t.pushname),yield Promise.all(E),(0,O.logReceivedMessagesInWAM)(y.renderableMsgs,null!=t.offline,1e3*t.ts,t.clientReceivedTsMillis,t.msgProcessStartTsMillis)}}))).apply(this,arguments)}function V(){return $.apply(this,arguments)}function $(){return($=(0,a.default)((function*(e,t,r,l,d){try{const r=(0,E.default)(t,l),u=null==r?e:e.map((e=>(0,i.default)((0,i.default)({},e),{},{privacyModeWhenSent:r})));if(t.offline)return void R.default.addOfflineMessage(u.map((e=>({msg:e}))));const f=t.chat,h=n(69951).ChatCollection,_=f.isUserNotPSA(),g=_&&null==h.get(f),S=(0,s.getLatestPrivacyMode)(l.privacyMode,(0,s.getContactPrivacyMode)(f));try{if(_){const t=yield(0,y.getExisting)(f);if(null==t){const t=e[0];yield(0,L.createChatOnNewMsg)(f,t,S)}else null!=S&&(yield(0,P.handlePrivacyModeTransition)(f,S,t))}}catch(e){const t="";__LOG__(4,void 0,new Error,!0,["messaging"])`createChatOnNewMsg or handlePrivacyModeTransition ${t} failed with error: ${e}`,SEND_LOGS("createChatOnNewMsg or handlePrivacyModeTransition failed")}if(yield Promise.all(u.map(function(){var e=(0,a.default)((function*(e){yield(0,D.handleSingleMsgMD)(e.id.remote,e,d),(0,p.processOrphanAck)(e.id).catch((e=>{__LOG__(2)`processOrphanAck: msgId::${t.externalId}, failed with error: ${e}`,__LOG__(3,void 0,void 0,void 0,["messaging"])`processOrphanAck: failed`})),e.type===o.MSG_TYPE.PAYMENT&&"send"===e.subtype&&(0,N.processOrphanPaymentNotifications)([e])}));return function(){return e.apply(this,arguments)}}())),g&&(0,F.queryAndUpdateContactPropertiesOnNewChat)(f),_&&!c.default.equals((0,m.getMaybeMeUser)(),t.author)&&null!=S){const e=n(59871).MsgCollection;Promise.all(u.map((t=>{const n=e.get(t.id);if(n)return(0,B.default)(n,S)})))}}catch(e){__LOG__(4,void 0,new Error,!0,["messaging"])`processRenderableMsg: msgId::${t.externalId}, failed with error: ${e}`,SEND_LOGS("handle_msg: error storing/processing single message")}}))).apply(this,arguments)}function z(){return(z=(0,a.default)((function*(e,t){if(e.category!==A.CATEGORY_PEER)try{const n=yield(0,Y.genPlaceholderMsg)(e,t);e.offline?R.default.addOfflineMessage(n.map((e=>({msg:e})))):yield Promise.all(n.map(function(){var e=(0,a.default)((function*(e){const t=e.id.remote;yield(0,D.handleSingleMsgMD)(t,e)}));return function(){return e.apply(this,arguments)}}()))}catch(t){__LOG__(4,void 0,new Error,!0,["messaging"])`processPlaceholderMsg: msgId::${e.externalId}, failed with error: ${t}`,SEND_LOGS("handle_msg: error storing/processing single message")}else __LOG__(2,void 0,void 0,void 0,["messaging"])`processPlaceholderMsg: msgId::${e.externalId}, skip placeholder for peer message ${e.externalId}`}))).apply(this,arguments)}function q(){return J.apply(this,arguments)}function J(){return(J=(0,a.default)((function*(e,t){if(t.offline){const n={msg:e,receiptInfo:{from:e.from,author:t.author}};return void R.default.addOfflineMessage([n])}const n=yield Q(e,t);if(n)return String(e.id),String(e.reactionParentKey),(0,U.addOrUpdateReactions)(n,!0)}))).apply(this,arguments)}function Q(){return X.apply(this,arguments)}function X(){return(X=(0,a.default)((function*(e,t){var n;const r=yield(0,I.getMsgByMsgKey)(e.reactionParentKey);let i,a=0;r||(a=1,i=x.OrphanReactionsReasonType.ParentMsgMissing),(null==r?void 0:r.type)===o.MSG_TYPE.CIPHERTEXT&&(a=1,i=x.OrphanReactionsReasonType.ParentMsgPlaceholder);const s=t.author;if(r&&r.type!==o.MSG_TYPE.CIPHERTEXT&&!(0,l.canHaveReactions)(r.type))return __LOG__(3)`createReactionsRow: reactions not allowed for this message type ${r.type}`,Promise.resolve();const c=(0,d.toUserWid)(s);return{msgKey:e.id.toString(),parentMsgKey:e.reactionParentKey.toString(),senderUserJid:c.toString(),reactionText:null!==(n=e.reactionText)&&void 0!==n?n:l.REVOKED_REACTION_TEXT,timestamp:e.reactionTimestamp,orphan:a,orphanReason:i,read:!1}}))).apply(this,arguments)}},27286:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.genPlaceholderMsg=function(){return x.apply(this,arguments)},t.generateBaseMsg=B,t.getDeviceType=W,t.getFrom=H,t.isPeer=Y,t.messageInfoToKey=K,t.parseMessage=function(){return M.apply(this,arguments)},t.placeholderCheck=G,t.sendAck=function(e,t,n){return Promise.resolve((0,f.castStanza)((0,s.wap)("ack",{id:(0,s.CUSTOM_STRING)(e),class:"message",from:(0,P.DEVICE_JID)((0,m.assertGetMe)()),to:t?(0,P.JID)(t):s.DROP_ATTR,type:n})))},t.sendReceipt=function(e,t,n){const{externalId:r}=e,{rawTs:i,type:a}=t,o=H(e),l=e.type===y.MESSAGE_TYPE.CHAT&&Y(e.author)?e.chat:null,c=e.type===y.MESSAGE_TYPE.CHAT?null:e.author,d=e.category===E.CATEGORY_PEER;switch(n.result){case y.E2EProcessResult.SUCCESS:return(0,C.sendDeliveryReceiptsAfterDecryption)(r,o,l,c,d,a);case y.E2EProcessResult.HSM_MISMATCH:return Promise.resolve();case y.E2EProcessResult.RETRY:const e=null==n.retryCount?1:n.retryCount+1;return(0,A.sendRetryReceipt)(e,o,c,l,r,i,d);case y.E2EProcessResult.PARSE_VALIDATION_ERROR:return(0,C.sendDeliveryReceiptsAfterDecryption)(r,o,l,c,d,a),Promise.resolve((0,f.castStanza)((0,s.wap)("ack",{id:(0,s.CUSTOM_STRING)(r),class:"message",from:(0,P.DEVICE_JID)((0,m.assertGetMe)()),to:o?(0,P.JID)(o):s.DROP_ATTR,type:t.type,participant:c?(0,P.USER_JID)(c):s.DROP_ATTR})));default:return Promise.resolve((0,f.castStanza)((0,s.wap)("ack",{id:(0,s.CUSTOM_STRING)(r),class:"message",from:(0,P.DEVICE_JID)((0,m.assertGetMe)()),to:o?(0,P.JID)(o):s.DROP_ATTR,type:t.type,participant:c?(0,P.USER_JID)(c):s.DROP_ATTR})))}};var i=r(n(81109)),a=r(n(48926)),o=n(52230),s=n(31914),l=n(35470),c=r(n(65212)),d=n(15461),u=r(n(89867)),p=n(45454),f=n(24747),h=n(47343),_=n(6303),g=n(90915),m=n(99234),y=n(49714),E=n(12037),S=n(45033),v=n(84886),T=r(n(11339)),b=n(13493),C=n(16927),A=n(55253),P=n(39410);function M(){return(M=(0,a.default)((function*(e,t,n,r,i){var a,o,s,l;let c,d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;if(null!=(null===(a=n.protocolMessage)||void 0===a?void 0:a.historySyncNotification)){c={history:(0,b.parseMsgProto)(n,B(e),"relay",r,void 0,void 0,i).historySyncMetaData}}else if(null!=(null===(o=n.protocolMessage)||void 0===o?void 0:o.initialSecurityNotificationSettingSync)){var u;c={securityNotificationEnabled:{isEnabled:null===(u=n.protocolMessage.initialSecurityNotificationSettingSync.securityNotificationEnabled)||void 0===u||u}}}else if(null!=(null===(s=n.protocolMessage)||void 0===s?void 0:s.appStateSyncKeyShare))c={appStateSyncKeyShare:n.protocolMessage.appStateSyncKeyShare};else if(null!=(null===(l=n.protocolMessage)||void 0===l?void 0:l.appStateSyncKeyRequest))c={appStateSyncKeyRequest:n.protocolMessage.appStateSyncKeyRequest};else switch(e.type){case y.MESSAGE_TYPE.CHAT:c=Y(e.author)?yield O(e,n,r,i,d):yield D(e,n,r,i,d);break;case y.MESSAGE_TYPE.GROUP:c=Y(e.author)&&e.isDirect?yield O(e,n,r,i,d):yield D(e,n,r,i,d);break;case y.MESSAGE_TYPE.PEER_BROADCAST:if(t===S.CiphertextType.Skmsg){if(!e.bclHashValidated)throw new Error("parseMessage: participants for peer broadcast message is not validated");c=yield D(e,n,r,i,d)}else c=yield w(e,n,r,i,d);break;case y.MESSAGE_TYPE.OTHER_BROADCAST:c=yield D(e,n,r,i,d);break;case y.MESSAGE_TYPE.DIRECT_PEER_STATUS:c=e.isDirect?yield O(e,n,r,i,d):yield w(e,n,r,i,d);break;case y.MESSAGE_TYPE.OTHER_STATUS:c=yield D(e,n,r,i,d);break;default:throw new Error("Unrecognized MESSAGE_TYPE")}return c}))).apply(this,arguments)}function O(){return I.apply(this,arguments)}function I(){return(I=(0,a.default)((function*(e,t,n,r,a){const{deviceSentMessage:o}=t;if(null==o)throw new _.DeviceSentMessageError(W(e.author),T.default.DSM_ERROR.MISSING_DSM);if(null==o.destinationJid)throw new _.DeviceSentMessageError(W(e.author),T.default.DSM_ERROR.INVALID_DSM);const{destinationJid:s}=o,l=yield N(e,o.message,n,r,a);return(0,i.default)({deviceSent:{destination:(0,p.createWid)(s)}},l)}))).apply(this,arguments)}function w(){return R.apply(this,arguments)}function R(){return(R=(0,a.default)((function*(e,t,n,r,a){const{deviceSentMessage:o}=t;if(null==o)throw new _.DeviceSentMessageError(W(e.author),T.default.DSM_ERROR.MISSING_DSM);if(null==o.phash)throw new _.DeviceSentMessageError(W(e.author),T.default.DSM_ERROR.INVALID_DSM);const{phash:s}=o,l=yield N(e,o.message,n,r,a);return(0,i.default)({deviceSent:{phash:s,info:e}},l)}))).apply(this,arguments)}function D(){return L.apply(this,arguments)}function L(){return(L=(0,a.default)((function*(e,t,n,r,a){if(null!=t.deviceSentMessage)throw new _.DeviceSentMessageError(W(e.author),T.default.DSM_ERROR.INVALID_SENDER);const o=yield N(e,t,n,r,a);return(0,i.default)({deviceSent:null},o)}))).apply(this,arguments)}function N(){return k.apply(this,arguments)}function k(){return(k=(0,a.default)((function*(e,t,n,r,a){var o;if(null==t)return{senderKey:null,storeMsg:null,renderableMsgs:[]};let s=(0,b.parseMsgProto)(t,B(e),"relay",n,void 0,void 0,r,e.edit);s=(0,i.default)((0,i.default)({},s),yield(0,g.genDirectConnectionMessageModifiers)(s.type,null===(o=s.list)||void 0===o?void 0:o.listType,s.businessOwnerJid));const l=null!=t.senderKeyDistributionMessage?U(e,t.senderKeyDistributionMessage):null,c=s.type===d.MSG_TYPE.UNKNOWN&&null==l,u=s.type===d.MSG_TYPE.UNKNOWN&&null!=l;let p=null;if(c&&(s.futureproofBuffer=a),e.type===y.MESSAGE_TYPE.OTHER_STATUS&&(s.campaignId=e.campaignId,s.campaignDuration=e.campaignDuration),e.type===y.MESSAGE_TYPE.PEER_BROADCAST&&(s.broadcastId=e.chat,s.broadcastParticipants=e.bclParticipants,s.broadcastEphSettings=e.bclEphSettings,p=s),e.type===y.MESSAGE_TYPE.OTHER_BROADCAST){s.broadcastId=e.chat;const t=e.ephSetting,n=s.ephemeralSharedSecret;if(null!=t&&null!=n){const{ephemeralDuration:r,ephemeralSettingTimestamp:i}=yield(0,h.decodeBroadcastEphemeralSetting)(e.chat,(0,m.getMeUser)(),e.author,t,n);s.ephemeralDuration=r,s.ephemeralSettingTimestamp=i}}let f=[];return u||(e.type===y.MESSAGE_TYPE.PEER_BROADCAST?f=yield F(s,e.bclParticipants,e.bclEphSettings):("payment_transaction_request_cancelled"!==s.subtype&&"payment_action_request_declined"!==s.subtype||null!=s.paymentRequestMessageKey)&&"non_renderable"!==s.subtype&&(f=[s])),{senderKey:l,storeMsg:p,renderableMsgs:f}}))).apply(this,arguments)}function U(e,t){if(!e.chat.isGroup()&&!e.chat.isBroadcast())throw new Error("should not have senderkey");const{groupId:n,axolotlSenderKeyDistributionMessage:r}=t;if(null==n||e.chat.toString({legacy:!0})!==n)throw new Error(`senderKeyDistributionMessage: from ${e.chat.toString()} mismatched to ${n||"null"}`);if(!r)throw new Error(`senderKeyDistributionMessage: from ${e.author.toString()} has no content`);return{groupId:n,key:r}}function G(e){return e.edit!==l.EDIT_ATTR.SENDER_REVOKE||e.type===y.MESSAGE_TYPE.PEER_BROADCAST}function x(){return(x=(0,a.default)((function*(e,t){if(!G(e))return[];const n=B(e);if(t===y.PlaceholderType.E2E?n.type=d.MSG_TYPE.CIPHERTEXT:(n.type=d.MSG_TYPE.CIPHERTEXT,n.subtype="fanout"),e.type===y.MESSAGE_TYPE.PEER_BROADCAST){if(n.broadcastParticipants=e.bclParticipants,n.broadcastEphSettings=e.bclEphSettings,(0,v.storeMessages)([n],n.id.remote),e.edit===l.EDIT_ATTR.SENDER_REVOKE)return[];return yield F(n,e.bclParticipants)}return[n]}))).apply(this,arguments)}function B(e){const t=K(e),n=(0,m.getMeUser)(),r={id:t,from:t.fromMe?n:t.remote,to:t.fromMe?t.remote:n,type:d.MSG_TYPE.UNKNOWN,t:e.ts||0,ack:l.ACK.SENT,author:!t.fromMe&&u.default.isGroup(t.remote)||u.default.isStatusV3(t.remote)?t.participant:void 0,broadcast:!1,notifyName:e.pushname||""};return null!=e.count&&(r.count=e.count),r}function F(){return j.apply(this,arguments)}function j(){return(j=(0,a.default)((function*(e,t,n){return(yield Promise.all(t.map(function(){var t=(0,a.default)((function*(t){let r,a,o;try{r=new c.default({remote:t,fromMe:!0,id:e.id.id})}catch(e){return __LOG__(3)`drop: cannot create MsgKey: ${e.stack}`,null}const s=n?n[t.toString()]:null,l=e.ephemeralSharedSecret,d=e.broadcastId;null!=d&&null!=s&&null!=l&&({ephemeralDuration:a,ephemeralSettingTimestamp:o}=yield(0,h.decodeBroadcastEphemeralSetting)(d,t,(0,m.getMeUser)(),s,l));const u=(0,i.default)((0,i.default)({},e),{},{id:r,from:(0,m.getMeUser)(),to:t,broadcast:!0,ephemeralDuration:a,ephemeralSettingTimestamp:o});return e.protocolMessageKey&&(u.protocolMessageKey=new c.default({remote:t,fromMe:!0,id:e.protocolMessageKey.id})),u}));return function(){return t.apply(this,arguments)}}()))).filter(Boolean)}))).apply(this,arguments)}function Y(e){return(0,p.toUserWid)(e).equals((0,m.getMeUser)())}function K(e){return e.type===y.MESSAGE_TYPE.OTHER_BROADCAST?new c.default({remote:(0,p.toUserWid)(e.author),fromMe:!1,id:e.externalId}):e.type===y.MESSAGE_TYPE.CHAT?new c.default({remote:e.chat,fromMe:Y(e.author),id:e.externalId}):new c.default({remote:e.chat,fromMe:Y(e.author),participant:(0,p.toUserWid)(e.author),id:e.externalId})}function W(e){return null==e.device||e.device===o.DEFAULT_DEVICE_ID?T.default.DEVICE_TYPE.PRIMARY:T.default.DEVICE_TYPE.COMPANION}function H(e){return e.type===y.MESSAGE_TYPE.CHAT?e.author:e.chat}},39505:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(e.type!==s.MESSAGE_TYPE.CHAT)return;if(!a.default.equals((0,o.getMaybeMeUser)(),e.author))return t.privacyMode;const n=t.privacyMode,r=(0,i.getContactPrivacyMode)(e.chat);return(0,i.getLatestPrivacyMode)(r,n)};var i=n(8197),a=r(n(89867)),o=n(99234),s=n(49714)},22695:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.isFromKnownDevice=function(){return p.apply(this,arguments)},t.validateBclHash=function(){return u.apply(this,arguments)},t.validateMsgDestination=function(){return d.apply(this,arguments)};var i=r(n(48926)),a=n(52230),o=n(69315),s=n(45454),l=n(9108),c=n(99234);function d(){return(d=(0,i.default)((function*(e,t){const n=t.author,r=t.chat;if(!e.equals(r))return __LOG__(4,void 0,new Error,!0)`encDestination: ${String(e)}, destination: ${r.toString()}`,SEND_LOGS("validateMsgDestination: drop due to the deviceSentMessage meta mismatch."),Promise.resolve(!1);const i=(0,s.toUserWid)(n),a=n.device||0;if(!i.equals((0,c.getMeUser)()))return __LOG__(4,void 0,new Error,!0)`sender: ${n.toString()}`,SEND_LOGS("validateMsgDestination: drop due to msg is not sent from your own device."),Promise.resolve(!1);const o=yield(0,l.hasDevice)(i,a);return o||(__LOG__(4,void 0,new Error,!0)`no record found for sender: ${n.toString()}`,SEND_LOGS("validateMsgDestination:drop due to invalid device")),o}))).apply(this,arguments)}function u(){return(u=(0,i.default)((function*(e,t){var n;const r=null!==(n=t.bclParticipants)&&void 0!==n?n:[],i=yield(0,o.phashV2)(r);return i!==e?(__LOG__(4,void 0,new Error,!0)`expected: ${e}, got: ${i}`,SEND_LOGS("validateBclHash: drop due to invalid hash."),!1):(t.bclHashValidated=!0,!0)}))).apply(this,arguments)}function p(){return(p=(0,i.default)((function*(e){const t=null==e.device?a.DEFAULT_DEVICE_ID:e.device;if(t===a.DEFAULT_DEVICE_ID)return!0;const[n]=yield(0,l.getDeviceIds)([e.user]);return null!=n&&n.devices.includes(t)}))).apply(this,arguments)}},48309:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleChatSimpleAck=function(){return h.apply(this,arguments)};var i=r(n(48926)),a=n(35470),o=r(n(65212)),s=n(45454),l=n(57849),c=n(99234),d=n(29331),u=n(28237),p=n(47124),f=r(n(66545));function h(){return(h=(0,i.default)((function*(e){const{from:t,externalIds:n,ts:r,recipient:i,ackString:h,offline:g,biz:m}=e;let{ack:y}=e;const E=h===a.ACK_STRING.SENDER,S=!E&&(0,s.toUserWid)(t).equals((0,c.getMeUser)());let v;if(S||E){if(!i)throw __LOG__(4,void 0,new Error,!0)`error: invalid sender/peer receipt without recipient`,SEND_LOGS("handleChatSimpleAck: failed"),new Error("handleChatSimpleAck: invalid sender/peer receipt without recipient");v=i}else{v=(0,s.toUserWid)(t);"none"===(0,c.getUserPrivacySettings)().readReceipts&&(y===a.ACK.READ||y===a.ACK.PLAYED&&(0,l.getABPropConfigValue)("played_self_enabled"))&&(y=a.ACK.RECEIVED)}const T=n.map((e=>new o.default({id:e,remote:v,fromMe:!S})));S&&y===a.ACK.PLAYED&&(0,d.handleViewOnceOpenedIfNecessary)(T);const b=T.map((e=>e.toString()));if(null!=g&&u.OfflineMessageHandler.offlineStanzaReceivedAfterCompelete(),null==g||u.OfflineMessageHandler.isResumeFromRestartComplete()){const e=[];e.push(_(S,E,T,v,y,r,m)),S||e.push((0,p.updateReceiptRecords)(y,r,t,b,m?{actualActors:m.actualActors,hostStorage:m.hostStorage,privacyModeTs:m.privacyModeTs}:null).catch((e=>{__LOG__(4,void 0,new Error,!0)`error: ${e}`,SEND_LOGS("handleChatSimpleAck: failed")}))),yield Promise.all(e)}else{if(!S)return f.default.addOfflineReceipt(y,r,t,b);if(null!=i&&(h===a.ACK_STRING.READ||h===a.ACK_STRING.READ_SELF||h===a.ACK_STRING.PLAYED||h===a.ACK_STRING.PLAYED_SELF)&&n.length>0)return f.default.addOfflinePeerReceipt(r,b,y)}}))).apply(this,arguments)}function _(e,t,n,r,i,o,s){return i<a.ACK.RECEIVED?Promise.resolve():t?(__LOG__(2)`handleChatSimpleAck: sender receipt from peer device ${r.toString()}`,Promise.resolve()):e?(__LOG__(2)`handleChatSimpleAck: peer receipt from peer device ${r.toString()}`,i===a.ACK.READ?(0,d.updateChatPeerRead)(r,n):i===a.ACK.PLAYED?(0,d.updateMsgAcks)(n,i,o):Promise.resolve()):(0,d.updateMsgAcks)(n,i,o,s)}},84947:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleGroupSimpleAck=function(){return y.apply(this,arguments)};var i=r(n(48926)),a=n(35470),o=r(n(65212)),s=n(45454),l=n(78027),c=n(99234),d=n(29331),u=n(28237),p=n(47124),f=n(59871),h=n(52821),_=n(17972),g=n(29731),m=r(n(66545));function y(){return(y=(0,i.default)((function*(e){const{ack:t,from:n,externalIds:r,ts:l,ackString:f,participant:h,recipient:_,offline:y}=e;if(!h)throw __LOG__(4,void 0,new Error,!0)`error: got group ack without participant.`,SEND_LOGS("handleGroupSimpleAck: failed"),new Error("handleGroupSimpleAck: got group ack without participant.");const S=(0,c.getMeUser)(),v=(0,s.toUserWid)(h),T=f===a.ACK_STRING.SENDER,b=!T&&v.equals(S);let C;if(b){if(!_)throw __LOG__(4,void 0,new Error,!0)`error: invalid sender/peer receipt without recipient`,SEND_LOGS("handleGroupSimpleAck: failed"),new Error("handleGroupSimpleAck: invalid sender/peer receipt without recipient");C=_}else C=S;const A=r.map((e=>new o.default({id:e,remote:n,fromMe:!b,participant:C})));b&&t===a.ACK.PLAYED&&(0,d.handleViewOnceOpenedIfNecessary)(A);const P=A.map((e=>e.toString()));if(null!=y&&u.OfflineMessageHandler.offlineStanzaReceivedAfterCompelete(),null==y||u.OfflineMessageHandler.isResumeFromRestartComplete()){const e=[];e.push(E(b,T,A,n,t,v,l)),b||e.push(new g.NonPersistJob("updateGroupReceiptRecords",(0,i.default)((function*(){try{yield(0,p.updateReceiptRecords)(t,l,h,P)}catch(e){__LOG__(4,void 0,new Error,!0)`error: ${e}`,SEND_LOGS("handleGroupSimpleAck: failed")}}))).waitUntilCompleted()),yield Promise.all(e)}else{if(!b)return m.default.addOfflineReceipt(t,l,h,P);if(null!=_&&(f===a.ACK_STRING.READ||f===a.ACK_STRING.READ_SELF||f===a.ACK_STRING.PLAYED||f===a.ACK_STRING.PLAYED_SELF)&&r.length>0)return m.default.addOfflinePeerReceipt(l,P,t)}}))).apply(this,arguments)}function E(){return S.apply(this,arguments)}function S(){return(S=(0,i.default)((function*(e,t,n,r,o,s,u){return o<a.ACK.RECEIVED?Promise.resolve():t?(__LOG__(2)`handleGroupSimpleAck: sender receipt from peer device ${r.toString()}`,Promise.resolve()):e?(__LOG__(2)`handleGroupSimpleAck: peer receipt from peer device ${r.toString()}`,o===a.ACK.READ&&(0,d.updateChatPeerRead)(r,n),o===a.ACK.PLAYED?(0,d.updateMsgAcks)(n,o,u):Promise.resolve()):void(yield Promise.all(n.map(function(){var e=(0,i.default)((function*(e){const t=f.MsgCollection.get(e);if(!t)return void __LOG__(2)`handleGroupSimpleAck: no message found for incoming ack, with msgKey:`;const n=yield _.MsgInfoCollection.find(e);return n||(__LOG__(3,void 0,void 0,!0)`Assertion failed! ${e.toString()}`,SEND_LOGS("handleGroupSimpleAck: no msgInfo found for msg:")),(0,h.updateMsgInfo)(n,o,s,u),o===a.ACK.RECEIVED&&0===n.deliveryRemaining||o===a.ACK.READ&&0===n.readRemaining||o===a.ACK.PLAYED&&0===n.playedRemaining?(0,l.updateMsgAck)(t,null,{from:(0,c.assertGetMe)(),to:r,ack:o,t:u}):void 0}));return function(){return e.apply(this,arguments)}}())))}))).apply(this,arguments)}},17234:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return E.apply(this,arguments)};var i=r(n(81109)),a=r(n(48926)),o=n(31914),s=n(35470),l=r(n(65212)),c=r(n(89867)),d=n(48309),u=n(99234),p=n(84947),f=n(78428),h=n(28237),_=r(n(66545)),g=n(90756),m=n(97563),y=n(39410);function E(){return(E=(0,a.default)((function*(e){const t=f.msgReceiptParser.parse(e);if(t.error)throw __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,new Error(t.error);{const e=t.success,{ack:n,ackString:r,from:i,stanzaId:a}=e;if(e.type===f.RECEIPT_TYPE.SIMPLE){if(n===s.ACK.CONTENT_GONE)return T(i,a,r,null);let t=null;null==e.offline||h.OfflineMessageHandler.isResumeFromRestartComplete()?t=T(i,a,r,e.participant):_.default.addOfflineReceiptAck(i,a,r,e.participant);try{__LOG__(2)`handleSimpleAck: got receipt ${e.ack} for msg ${e.stanzaId}`,yield S(e)}catch(e){}return t}if(e.type===f.RECEIPT_TYPE.AGGREGATE){const t=T(i,a,r,null);try{__LOG__(2)`handleAggregateAck: got ${e.receipts.length} receipts of ack type ${e.ack} for msg ${e.externalId}`,yield v(e)}catch(e){}return t}return __LOG__(4,void 0,new Error,!0)`type: ${e.type}`,SEND_LOGS("handleMsgReceipt: Invalid receipt type"),T(i,a,r,null)}}))).apply(this,arguments)}function S(e){const{from:t,ack:n,stanzaId:r,participant:a}=e;if(n===s.ACK.MD_DOWNGRADE){const e=new l.default({id:r,remote:t,fromMe:!0,participant:t.isUser()?void 0:(0,u.getMeUser)()});return(0,m.updateLocalAndModel)(e,{mdDowngrade:!(a&&c.default.isWid(a)&&a.isUser())||a.toString()})}if(n===s.ACK.PEER)return Promise.resolve();if(t.isStatusV3())return(0,g.handleStatusSimpleAck)(e);if(t.isUser())return(0,d.handleChatSimpleAck)(e);if(t.isGroup())return(0,p.handleGroupSimpleAck)(e);if(t.isBroadcast()){if(!e.participant)return __LOG__(4,void 0,new Error,!0)`error: missing participant for broadcast receipt ${t.toString()}`,SEND_LOGS("handleSimpleAck: failed"),Promise.reject(new Error(`handleSimpleAck: missing participant for broadcast receipt ${t.toString()}`));const n=(0,i.default)((0,i.default)({},e),{},{from:e.participant,participant:null});return(0,d.handleChatSimpleAck)(n)}return __LOG__(4,void 0,new Error,!0)`error: unsupported type for ${t.toString()}`,SEND_LOGS("handleSimpleAck: failed"),Promise.reject(new Error(`handleSimpleAck: unsupported type for ${t.toString()}`))}function v(e){const{ack:t,from:n}=e;if(t===s.ACK.CONTENT_GONE)return __LOG__(4,void 0,new Error,!0)`error: reupload receipts cannot be aggregated`,SEND_LOGS("handleAggregateAck: failed"),Promise.reject(new Error("handleAggregateAck: reupload receipts cannot be aggregated"));if(!n.isGroup())return __LOG__(4,void 0,new Error,!0)`error: aggregate receipts should come only from group JIDs`,SEND_LOGS("handleAggregateAck: failed"),Promise.reject(new Error("handleAggregateAck: aggregate receipts should come only from group JIDs"));const r=e.receipts.map((t=>S({type:f.RECEIPT_TYPE.SIMPLE,stanzaId:e.externalId,externalIds:[e.externalId],from:e.from,participant:t.participant,recipient:null,ts:t.ts,ack:e.ack,ackString:e.ackString,offline:e.offline,biz:null})));return Promise.all(r)}function T(e,t,n,r){return(0,o.wap)("ack",{to:(0,y.JID)(e),id:(0,o.CUSTOM_STRING)(t),class:"receipt",type:(0,o.MAYBE_CUSTOM_STRING)(n),participant:r&&r!==e?(0,y.DEVICE_JID)(r):o.DROP_ATTR})}},29331:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleViewOnceOpenedIfNecessary=function(e){e.forEach((e=>{const t=h.MsgCollection.get(e);(null==t?void 0:t.isViewOnce)&&(0,u.handleActivitiesForChatThreadLogging)([{activityType:"viewOnceOpen",ts:t.t,chatId:t.id.remote}])}))},t.processOrphanPeerReceipt=function(e){return E.enqueue((0,i.default)((function*(){const t=yield(0,_.getOrphanReceipt)(String(e));t?(null!=t[o.ACK_STRING.PLAYED]&&(__LOG__(2)`processOrphanPeerReceipt: orphan played ack found for incoming ${e}`,yield C([e],o.ACK.PLAYED,t[o.ACK_STRING.PLAYED])),null!=t[o.ACK_STRING.READ]&&(__LOG__(2)`processOrphanPeerReceipt: orphan read ack found for incoming ${e}`,T(e.remote,[e])),yield(0,_.removeOrphanReceipt)(String(e))):__LOG__(2)`processOrphanPeerReceipt: no orphan ack found for incoming ${e}`})))},t.updateChatPeerRead=T,t.updateMsgAcks=C;var i=r(n(48926)),a=n(27870),o=n(35470),s=r(n(65212)),l=n(38342),c=n(92144),d=n(48285),u=n(16116),p=n(57701),f=n(90981),h=n(59871),_=n(40221),g=n(72821),m=n(76332),y=n(9609);const E=new a.PromiseQueue;function S(){return v.apply(this,arguments)}function v(){return(v=(0,i.default)((function*(e,t){const n=(yield(0,l.getActiveMessageRanges)(e)).filter((e=>"markChatAsRead"===e.action&&!1===e.actionValue.read&&null!=e.actionValue.messageRange));if(0===n.length)return!0;const r=n[0];return t.some((e=>!(0,c.rangeContainsMessage)(r.actionValue.messageRange,{id:s.default.fromString(e.id),t:e.t})))}))).apply(this,arguments)}function T(){return b.apply(this,arguments)}function b(){return(b=(0,i.default)((function*(e,t){const r=t.map(String),i=[];let a=[],l=null;const c=yield(0,f.getTable)().bulkGet(r,!1),u=[];if(c.forEach(((e,t)=>{e?null==e.pendingReadReceipt||null!=e.rowId&&(null==l||e.rowId>l)&&(l=e.rowId):u.push(r[t])})),u.length>0&&((0,p.receiveReactionsEnabled)()&&(a=(yield(0,g.getTable)().anyOf(["msgKey"],u)).map((e=>e.msgKey)),__LOG__(2)`updateChatPeerRead: maybeOrphans ${u.length}`),u.forEach((e=>{a.includes(e)||i.push(e)}))),E.enqueue((()=>(__LOG__(2)`updateChatPeerRead: storing ${i.length} orphan acks`,(0,_.createOrUpdateOrphanReceipt)(o.ACK_STRING.READ,0,i)))),yield(0,d.markMessageAndChatAsRead)(l,String(e),!(yield S(e.toString(),c.filter(Boolean)))),(0,p.receiveReactionsEnabled)()&&a.length>0){const e=a.map((e=>s.default.fromString(e)));yield(0,m.markReactionsAsReadByMessageKeys)(e)}const h=n(69951).ChatCollection.get(e);h&&((0,y.updateUnreadCountMD)(h,0,!1),(0,y.clearUnreadMentions)(h))}))).apply(this,arguments)}function C(){return A.apply(this,arguments)}function A(){return(A=(0,i.default)((function*(e,t,r,i){const a=[],s=[],l=n(78027).updateMsgAck;e.forEach((e=>{const n=h.MsgCollection.get(e);n?s.push(l(n,null,{from:n.from,to:n.to,ack:t,t:r,deliveryPrivacyMode:o.ACK.RECEIVED===t?i:null})):(__LOG__(2)`updateMsgAcks: no message found for incoming ack, with msgKey: ${e}`,e.fromMe||a.push(e))})),a.length>0&&E.enqueue((()=>{__LOG__(2)`updateMsgAcks: store ${a.length} orphan acks`;let e=null;if(t===o.ACK.PLAYED?e=o.ACK_STRING.PLAYED:t===o.ACK.READ&&(e=o.ACK_STRING.READ),e)return(0,_.createOrUpdateOrphanReceipt)(e,r,a.map(String))})),yield Promise.all(s)}))).apply(this,arguments)}},78428:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.msgReceiptParser=t.RECEIPT_TYPE=void 0;var i=r(n(81109)),a=n(71914),o=n(35470),s=n(81663),l=n(99234),c=n(49714);const d={read:o.ACK.READ,played:o.ACK.PLAYED,inactive:o.ACK.INACTIVE,"server-error":o.ACK.CONTENT_GONE,"md-downgrade":o.ACK.MD_DOWNGRADE,sender:o.ACK.RECEIVED,"read-self":o.ACK.READ,"played-self":o.ACK.PLAYED,peer_msg:o.ACK.PEER},u={SIMPLE:"simple",AGGREGATE:"aggregate"};t.RECEIPT_TYPE=u;const p=new a.WapParser("incomingMsgReceiptParser",(e=>{e.assertTag("receipt"),e.hasAttr("to")&&e.assertAttr("to",(0,l.assertGetMe)().toJid());const t={ack:e.attrEnumOrDefault("type",d,o.ACK.RECEIVED),stanzaId:e.attrString("id"),from:(0,s.jidWithTypeToWid)(e.attrJidWithType("from")),ackString:e.hasAttr("type")?e.attrString("type"):null,offline:e.hasAttr("offline")?e.attrString("offline"):null},n=e.maybeChild("participants");return n?function(e,t){const n=t.mapChildrenWithTag("user",(e=>{try{const t=(0,s.deviceJidToDeviceWid)(e.attrPhoneDeviceJid("jid"));return{participant:t,ts:e.attrTime("t")}}catch(e){return null}})).filter((e=>null!=e));return(0,i.default)((0,i.default)({},e),{},{type:u.AGGREGATE,externalId:t.attrString("key"),receipts:n})}(t,n):function(e,t){const n=t.hasAttr("participant")?(0,s.deviceJidToDeviceWid)(t.attrPhoneDeviceJid("participant")):null,r=t.hasAttr("recipient")?(0,s.userJidToUserWid)(t.attrPhoneUserJid("recipient")):null;let a,o;a=t.hasChild("list")?t.child("list").mapChildrenWithTag("item",(e=>e.attrString("id"))):[];if(t.hasChild("biz")){const e=t.child("biz"),n=c.ActualActorsEnumType.cast(e.maybeAttrInt("actual_actors")),r=c.HostStorageEnumType.cast(e.maybeAttrInt("host_storage")),i=e.maybeAttrInt("privacy_mode_ts");null!=n&&null!=r&&null!=i&&(o={actualActors:n,hostStorage:r,privacyModeTs:i})}return a.push(e.stanzaId),(0,i.default)((0,i.default)({},e),{},{type:"simple",externalIds:a,participant:n,recipient:r,ts:t.attrTime("t"),biz:o})}(t,e)}));t.msgReceiptParser=p},90756:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleStatusSimpleAck=function(){return _.apply(this,arguments)};var i=r(n(48926)),a=n(52230),o=n(35470),s=r(n(65212)),l=n(45454),c=n(99234),d=n(29331),u=n(47124),p=n(52821),f=n(17972),h=n(59387);function _(){return(_=(0,i.default)((function*(e){const{externalIds:t,ts:n,ackString:r,ack:i,participant:d,recipient:p}=e;if(!d)return __LOG__(4,void 0,new Error,!0)`error: got status ack without participant`,void SEND_LOGS("handleStatusSimpleAck: failed");const f=(0,c.getMeUser)(),h=(0,l.toUserWid)(d),_=h.equals(f),m="none"===(0,c.getUserPrivacySettings)().readReceipts;if(!_&&(m||r!==o.ACK_STRING.READ))return;const y=new s.default({id:t[0],remote:(0,l.createWid)(a.STATUS_JID),fromMe:!_,participant:null!=p?p:f}),E=[y.toString()];if(!_)try{yield(0,u.updateReceiptRecords)(i,n,d,E)}catch(e){__LOG__(4,void 0,new Error,!0)`error: ${e}`,SEND_LOGS("handleStatusSimpleAck: failed")}yield g(_,y,h,n)}))).apply(this,arguments)}function g(){return m.apply(this,arguments)}function m(){return(m=(0,i.default)((function*(e,t,n,r){if(e){const e=h.StatusV3Collection.get(t.participant);e&&e.handleReadStatus(t)}else{const e=yield f.MsgInfoCollection.find(t);(0,p.updateMsgInfo)(e,o.ACK.READ,n,r)}yield(0,d.updateMsgAcks)([t],o.ACK.READ,r)}))).apply(this,arguments)}},58464:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isAdaptiveOfflineEnabled=function(){return(0,r.getABPropConfigValue)("web_adaptive_offline_resume_enabled")};var r=n(57849)},98972:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.clearDanglingReceipts=u,t.sendAndClearDanglingReceipts=function(){return d.apply(this,arguments)};var i=r(n(48926)),a=n(92844),o=n(45454),s=n(93771),l=n(74727),c=n(29100);function d(){return(d=(0,i.default)((function*(){const e=yield(0,s.getTable)().all(),t=new Map;e.forEach((e=>{const{receipts:n}=e;n.forEach((e=>{const n=(0,o.createWid)(e.from),r=(0,o.createWid)(e.author);let i=t.get(n);i||(i=new Map,t.set(n,i));let a=i.get(r);a||(a=[],i.set(r,a)),a.push(e.externalId)}))}));const n=String((0,a.unixTime)());yield Promise.all(Array.from(t.keys()).map((e=>{const r=t.get(e);if(r)return(0,l.sendAggregateReceipts)(e,l.RECEIPT_TYPE.DELIVERY,n,r)}))),yield u()}))).apply(this,arguments)}function u(){return p.apply(this,arguments)}function p(){return(p=(0,i.default)((function*(){yield(0,c.blockSendPing)(),yield(0,s.getTable)().clear()}))).apply(this,arguments)}},69153:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(48926)),a=n(27870),o=n(57319),s=n(24747),l=n(97153);var c=new class{constructor(){this.pendingDeviceCache=new Set,this.pendingAcks=[],this.snapshotTimer=new o.ShiftTimer((()=>{this.createSnapshot()})),this.checkpointQueue=new a.PromiseQueue}addOfflinePendingDevice(e,t){this.pendingDeviceCache.add(e),t&&this.pendingAcks.push(t),this.snapshotTimer.isScheduled()||(__LOG__(2)`[offline-resume][device-cache]: creating snapshot: schedule in ${3e3} ms`,this.snapshotTimer.onOrAfter(3e3))}createSnapshot(){this.snapshotTimer.isScheduled()&&this.snapshotTimer.cancel();const e=Array.from(this.pendingDeviceCache),t=this.pendingAcks;__LOG__(2)`[offline-resume][device-cache]: creating snapshot for pending devices ${e.join(",")}`,this.checkpointQueue.enqueue((0,i.default)((function*(){yield(0,l.addUserToPendingDeviceSync)(e),t.forEach(s.castStanza),(0,s.cancelDeadSocketTimer)()}))),this.pendingDeviceCache=new Set,this.pendingAcks=[]}};t.default=c},28237:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.waitForMainStream=t.OfflineMessageHandlerImpl=t.OfflineMessageHandler=void 0;var i=r(n(48926)),a=n(13959),o=n(4352),s=n(98972),l=n(88102),c=n(80278),d=n(36163),u=n(15746),p=r(n(29783)),f=n(52083),h=r(n(66545)),_=n(49714),g=n(65044),m=n(97153),y=r(n(69153)),E=n(57319),S=n(83578),v=n(58464),T=n(45607),b=n(57701),C=n(6684),A=r(n(65212)),P=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=D(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(47272)),M=n(85553),O=n(97480),I=n(60324),w=n(55552),R=n(16116);function D(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(D=function(e){return e?n:t})(e)}const L=20,N=50,k=200,U=n(76672)({INIT:"INIT",RESUME_ON_RESTART:"RESUME_ON_RESTART",RESUME_WITH_OPEN_TAB:"RESUME_WITH_OPEN_TAB",COMPLETE:"COMPLETE"}),G=new Promise((e=>{l.Cmd.isMainStreamReadyMd&&e(),l.Cmd.on("main_stream_mode_ready",(()=>{e()}))}));t.waitForMainStream=G;class x{constructor(){this._offlineCompleteTimer=null,this.initState(),l.Cmd.on("logout",(()=>{this.initState()})),l.Cmd.on("open_socket_stream",(()=>{O.OfflineResumeReporter.logSocketConnectT()}))}initState(){this._offlineMessagePreviewCounter=-1,this._decryptedMessageCount=0,this._decryptionErrorCount=0,this._finishedDownloading=!1,this._hasMessagesToDownload=null,this._status=U.INIT,this._pendingMessageCount=0,this._isPendingPrevBatch=!1}setStatus(e){e===U.RESUME_WITH_OPEN_TAB?__LOG__(2)`[resume-resume] begin RESUME_WITH_OPEN_TAB`:e===U.RESUME_ON_RESTART?__LOG__(2)`[offline-resume][handler] begin RESUME_ON_RESTART`:e===U.COMPLETE&&(this._status===U.RESUME_WITH_OPEN_TAB?__LOG__(2)`[resume-resume] finished RESUME_WITH_OPEN_TAB`:__LOG__(2)`[offline-resume][handler] finished RESUME_ON_RESTART`),this._status=e}setOfflineMessagePreviewCounter(e){var t=this;return(0,i.default)((function*(){if(O.OfflineResumeReporter.logOfflinePreviewT(),t.isResumeFromRestartComplete()){__LOG__(2)`[offline-resume][handler] Offline session is complete when receiving offline preview ib.`,t._exceedResumeWithOpenTabLimit(e.message,e.receipt)&&(__LOG__(2)`[offline-resume][handler] restart client due to exceed the LIMIT, message: ${e.message}, receipt: ${e.receipt}`,j()),M.jsHaltDetector.restartDetection(),t.setStatus(U.RESUME_WITH_OPEN_TAB);const r=n(69951).ChatCollection;r.disableSortListener(),setTimeout((()=>{r.enableSortListener(!0)}),7e3)}else if(t._status===U.INIT)O.OfflineResumeReporter.logOfflineCount(e),t._hasMessagesToDownload=e.message>0,t._finishedDownloading=0===e.message,t._offlineMessagePreviewCounter=e.message,t._decryptedMessageCount=0,t._firstPreviewReceivedT=Date.now(),l.Cmd.handleOfflineProgressUpdate(),M.jsHaltDetector.restartDetection(),t.setStatus(U.RESUME_ON_RESTART),yield(0,f.enableMemSignalStore)(),t._startOfflineCompleteTimer(e.message,e.receipt);else{const n=t._firstPreviewReceivedT;if(null!=n){const r=Date.now()-n;r<1e3?(__LOG__(2)`[offline-resume][handler] Accept multiple offline preview ibs during offline resume, delay ${r}.`,t._offlineMessagePreviewCounter+=e.message,t._hasMessagesToDownload=t._offlineMessagePreviewCounter>0,t._finishedDownloading=0===t._offlineMessagePreviewCounter,O.OfflineResumeReporter.logOfflineCount(e),l.Cmd.handleOfflineProgressUpdate()):__LOG__(2)`[offline-resume][handler] Reject multiple offline preview ib during offline resume, delay ${r}.`}t.refreshOfflineCompleteTimer()}}))()}getOfflineDeliveryProgress(){return this._finishedDownloading?100:-1===this._offlineMessagePreviewCounter?0:0===this._offlineMessagePreviewCounter?100:Math.min(Math.ceil(100*this._decryptedMessageCount/this._offlineMessagePreviewCounter),100)}isResumeOnSocketDisconnectInProgress(){return this._status===U.RESUME_WITH_OPEN_TAB}isResumeFromRestartComplete(){return this._status!==U.RESUME_ON_RESTART&&this._status!==U.INIT}getHasMessagesToDownload(){return this._hasMessagesToDownload}getFinishedDownloading(){return 100===this.getOfflineDeliveryProgress()}setOfflineSessionComplete(e){var t=this;return(0,i.default)((function*(){var r;return setTimeout((()=>{n(69951).ChatCollection.enableSortListener(!0)}),3e3),null===(r=t._offlineCompleteTimer)||void 0===r||r.cancel(),t._offlineCompleteTimer=null,t._status===U.COMPLETE?Promise.resolve():t._status===U.RESUME_WITH_OPEN_TAB?(yield(0,u.waitForOnlineMsgThread)(),yield(0,m.doPendingDeviceSync)(),t.setStatus(U.COMPLETE),Promise.resolve()):(t._hasMessagesToDownload=e>0,t._finishedDownloading=0===e,t.setStatus(U.COMPLETE),t._offlineStanzaCountAfterOfflineMarker=0,setTimeout((()=>{t._offlineStanzaCountAfterOfflineMarker>100&&(__LOG__(3)`[offline-resume][handler] ${t._offlineStanzaCountAfterOfflineMarker} received after offline completion marker. Refreshing window due to potential server issue.`,j())}),2e4),l.Cmd.handleOfflineProgressUpdate(),t._onOfflineComplete())}))()}shouldUseOfflineResumeScreen(){return this._offlineMessagePreviewCounter>this._decryptedMessageCount}decryptOfflineMessage(e){var t=this;return(0,i.default)((function*(){const n=yield(0,c.decryptE2EPayload)(e);return t._decryptedMessageCount=t._decryptedMessageCount+1,n.result===_.E2EProcessResult.RETRY&&(t._decryptionErrorCount=t._decryptionErrorCount+1),(0,v.isAdaptiveOfflineEnabled)()&&(t._pendingMessageCount-=1,t.maybeRequestMoreStanza()),n}))()}offlineStanzaReceivedAfterCompelete(){this.isResumeFromRestartComplete()&&(this._offlineStanzaCountAfterOfflineMarker=this._offlineStanzaCountAfterOfflineMarker+1)}addOfflinePendingMessage(){(0,v.isAdaptiveOfflineEnabled)()&&!this.isResumeFromRestartComplete()&&(this._pendingMessageCount+=1)}maybeRequestMoreStanza(){this.isResumeFromRestartComplete()||this._isPendingPrevBatch||this._pendingMessageCount<=200&&((0,T.sendBatchRequestIb)(200),this._isPendingPrevBatch=!0,__LOG__(2)`[offline-resume][adaptive] maybeRequestMoreStanza: request next batch, pending message ${this._pendingMessageCount}`)}newOfflineStanza(e,t){(0,v.isAdaptiveOfflineEnabled)()&&(this._isPendingPrevBatch=!1,null==this._endBatchCheck&&(this._endBatchCheck=setTimeout((()=>{this.maybeRequestMoreStanza(),this._endBatchCheck=null,__LOG__(2)`[offline-resume][adaptive] _endBatchCheck: done`}),0))),this.refreshOfflineCompleteTimer(),O.OfflineResumeReporter.logAddOfflineSizeBytes(t),O.OfflineResumeReporter.logOldestStanzaTime(e)}refreshOfflineCompleteTimer(){this._offlineCompleteTimer&&this._offlineCompleteTimer.onOrAfter(6e4)}_startOfflineCompleteTimer(e,t){var n;null===(n=this._offlineCompleteTimer)||void 0===n||n.cancel(),this._offlineCompleteTimer=new E.ShiftTimer((()=>{this._status!==U.COMPLETE&&(__LOG__(2)`[offline-resume][handler]: offline session completed by timeout`,this.setOfflineSessionComplete(e+t),this._offlineCompleteTimer=null,O.OfflineResumeReporter.logMissedOfflineComplete())})),this._offlineCompleteTimer.onOrAfter(6e4)}_onOfflineComplete(){var e=this;return(0,i.default)((function*(){yield(0,u.waitForOfflineMsgThread)(),e._finishedDownloading=!0,l.Cmd.handleOfflineProgressUpdate(),O.OfflineResumeReporter.logOfflineDecryptionErrorCount(e._decryptionErrorCount),__LOG__(2)`[offline-resume][handler] _onOfflineComplete: waitForOfflineMsgThread done, total decryption error: ${e._decryptionErrorCount}`,e._decryptionErrorCount=0,yield function(){return F.apply(this,arguments)}(),__LOG__(2)`[offline-resume][handler] _onOfflineComplete: clearOfflineSnapShot done.`,(0,f.enablePersistSignalStore)(),(0,o.promiseLoop)(function(){var e=(0,i.default)((function*(e,t,n){const r=(0,a.delayMs)(P.expBackoff(n,12e4,1e3,.1));try{return yield(0,s.clearDanglingReceipts)(),__LOG__(2)`[offline-resume][handler] runReceiptCleanUpLoop: done.`,e()}catch(t){return __LOG__(2)`[offline-resume][handler] runReceiptCleanUpLoop: failed with error ${t}.`,n>3?(__LOG__(3)`[offline-resume][handler] runReceiptCleanUpLoop: Gave up clean up receipts ${n} tries`,e()):r}}));return function(){return e.apply(this,arguments)}}());try{const e=yield(0,I.pruneExpiredMessages)(),t=e.length;if((0,b.receiveReactionsEnabled)()&&t>0){const t=n(68819).getJobManager,r=[],i=new Set;e.forEach((e=>{const t=e.id.toString();i.add(A.default.fromString(t).remote.toString()),r.push(t)}));const a=Array.from(i.values()).join(",").toString();yield t().waitUntilPersisted(C.jobSerializers.deleteReactions(a,r))}__LOG__(2)`[offline-resume][handler] setOfflineSessionComplete: pruneExpiredMessages pruned ${t} msg(s)`}catch(e){throw __LOG__(4,void 0,new Error)`[offline-resume][handler] _onOfflineComplete: pruneExpiredMessages message failed with error: ${e}`,e}O.OfflineResumeReporter.logLastStanzaT();try{__LOG__(2)`[offline-resume][handler] _onOfflineComplete: restoreChatsAndMessages.`,yield Promise.all([(0,d.restoreChatsAndMessages)(),(0,d.restoreGroupsContactsAndProfilePics)()])}catch(e){__LOG__(4,!0,new Error,!0)`[offline-resume][handler] _onOfflineComplete: restoreChatsAndMessages failed with error ${e}.`,SEND_LOGS("offline-resume-fatal-error"),g.Socket.logout(!1,S.LogoutReason.ClientFatalError)}l.Cmd.readyForMainStreamMode(),O.OfflineResumeReporter.logMainScreenLoadT(),O.OfflineResumeReporter.commit(),(0,w.processAllOrphanPaymentNotifications)(),(0,R.uploadChatThreadLoggingEvents)(),setTimeout((()=>{(0,m.doPendingDeviceSync)()}),2e3)}))()}_exceedResumeWithOpenTabLimit(e,t){return e+t>k||e>L&&e+t>N}}t.OfflineMessageHandlerImpl=x;const B=new x;function F(){return(F=(0,i.default)((function*(){p.default.createSnapshot(),h.default.createSnapshot(),y.default.createSnapshot(),yield Promise.all([p.default.checkpointQueue.wait(),h.default.checkpointQueue.wait(),y.default.checkpointQueue.wait()])}))).apply(this,arguments)}function j(){var e;(null===(e=window.location)||void 0===e?void 0:e.reload)&&window.location.reload()}t.OfflineMessageHandler=B},29783:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(48926)),a=n(27870),o=n(57319),s=n(92844),l=n(15461),c=n(67811),d=n(58464),u=n(88102),p=n(24747),f=n(93771),h=n(57701),_=r(n(54624)),g=n(76332),m=n(74727),y=n(11849),E=n(77246),S=n(71251);var v=new class{constructor(){this.cache=[],this.checkpointQueue=new a.PromiseQueue,this.lastCheckpointIndex=0,this.snapshotTimer=new o.ShiftTimer((()=>{this.createSnapshot()}))}addOfflineMessage(e){this.cache.push(...e),(0,d.isAdaptiveOfflineEnabled)()&&this.cache.length-this.lastCheckpointIndex>=200?this.createSnapshot():this.snapshotTimer.isScheduled()||(__LOG__(2)`[offline-resume][msg-cache]: snapshot schedule in ${1e3} ms`,this.snapshotTimer.onOrAfter(1e3))}_addToMessageTable(e,t){var n=this;return(0,i.default)((function*(){const r=[],i=[];for(let a=e;a<t;a++){const e=n.cache[a].msg;null!=e&&((0,h.receiveReactionsEnabled)()&&e.type===l.MSG_TYPE.REACTION?i.push(n.cache[a]):r.push(e))}if(yield(0,S.storeOfflineMsgs)(r),i.length>0){const e=yield(0,c.createReactionsRowFromOffline)(i),t=yield(0,g.addOrUpdateReactionsDBBulk)(e);(0,g.updateHasReactionFromParent)(t)}}))()}_sendAggregateReceipts(e,t){var n=this;return(0,i.default)((function*(){const r=new Map,i=[];for(let a=e;a<t;a++){const e=n.cache[a].msg,t=n.cache[a].receiptInfo;if(!t)continue;const o=t.externalId||(null==e?void 0:e.id.id);if(!o)continue;const{from:s,author:l}=t;let c=r.get(s);c||(c=new Map,r.set(s,c));let d=c.get(l);d||(d=[],c.set(l,d)),d.push(o),i.push({from:String(s),author:String(l),externalId:o})}const a=String((0,s.unixTime)());Promise.all(Array.from(r.keys()).map((e=>{const t=r.get(e);if(t)return(0,m.sendAggregateReceipts)(e,m.RECEIPT_TYPE.DELIVERY,a,t)}))),(0,p.cancelDeadSocketTimer)(),yield(0,f.getTable)().createOrReplace({receipts:i})}))()}createSnapshot(){var e=this;this.snapshotTimer.isScheduled()&&this.snapshotTimer.cancel();const t=this.lastCheckpointIndex,n=this.cache.length;if(this.lastCheckpointIndex=n,__LOG__(2)`[offline-resume][msg-cache]: creating snapshot for offline ${t} to ${n}`,t===n)return;const r=_.default.generateSnapshot();this.checkpointQueue.enqueue((0,i.default)((function*(){yield e._addToMessageTable(t,n),__LOG__(2)`[offline-resume][msg-cache]: creating snapshot: messages done for ${t} - ${n}`,yield(0,E.getStorage)().lock(["session-store","identity-store","prekey-store","senderkey-store"],(0,i.default)((function*(){yield Promise.all([y.waSignalStore.bulkPutSession(r.sessionUpdate),y.waSignalStore.bulkPutIdentityKeyWithRowId(r.identityUpdate),y.waSignalStore.bulkPutSenderKey(r.senderKeyUpdate),y.waSignalStore.bulkRemovePreKey(r.preKeyRemove),y.waSignalStore.bulkRemoveSession(r.sessionRemove),y.waSignalStore.bulkRemoveIdentity(r.identityRemove)])}))),__LOG__(2)`[offline-resume][msg-cache]: creating snapshot: signal done for ${t} - ${n}`,yield e._sendAggregateReceipts(t,n),__LOG__(2)`[offline-resume][msg-cache]: creating snapshot: sending receipt done for ${t} - ${n}`,u.Cmd.handleOfflineProgressUpdate()})))}};t.default=v},66545:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(48926)),a=n(52230),o=n(27870),s=n(57319),l=n(31914),c=n(35470),d=n(45454),u=n(24747),p=n(78956),f=n(99069),h=n(39410);const _=Object.freeze({[c.ACK.RECEIVED]:c.ACK_STRING.DELIVERY,[c.ACK.READ]:c.ACK_STRING.READ,[c.ACK.PLAYED]:c.ACK_STRING.PLAYED,[c.ACK.INACTIVE]:c.ACK_STRING.INACTIVE}),g=1e3;function m(e){return(0,p.getTable)().bulkCreate(e)}function y(e,t){if(null!=e&&null!=t)return Math.min(e,t);const n=null!=e?e:t;return null!=n?n:void 0}var E=new class{constructor(){this.peerReadCache=[],this.otherReceiptCache=new Map,this.receiptAckCache=[],this.snapshotTimer=new s.ShiftTimer((()=>{this.createSnapshot()})),this.checkpointQueue=new o.PromiseQueue}addOfflinePeerReceipt(e,t,n){this.peerReadCache.push({ts:e,msgKeys:t,ack:n}),this.snapshotTimer.isScheduled()||(__LOG__(2)`[offline-resume][receipt-cache]: creating snapshot: schedule in ${g} ms`,this.snapshotTimer.onOrAfter(g))}addOfflineReceipt(e,t,n,r){var i;const o=(0,d.toUserWid)(n).toString(),s=null!==(i=n.device)&&void 0!==i?i:a.DEFAULT_DEVICE_ID;r.forEach((n=>{const r=_[e];if(!r)return void __LOG__(3)`[offline-resume][receipt-cache]: not supported ack type ${e}`;const i=`${n},${o}`,a=this.otherReceiptCache.get(i);a?(r!==_[c.ACK.INACTIVE]&&(a[r]=y(a[r],t)),a.deviceDelivered.add(s)):this.otherReceiptCache.set(i,{[r]:t,deviceDelivered:new Set([s])})})),this.snapshotTimer.isScheduled()||(__LOG__(2)`[offline-resume][receipt-cache]: creating snapshot: schedule in ${g} ms`,this.snapshotTimer.onOrAfter(g))}addOfflineReceiptAck(e,t,n,r){this.receiptAckCache.push({from:e,stanzaId:t,ackString:n,participant:r}),this.snapshotTimer.isScheduled()||(__LOG__(2)`[offline-resume][receipt-cache]: creating snapshot: schedule in ${g} ms`,this.snapshotTimer.onOrAfter(g))}createSnapshot(){this.snapshotTimer.isScheduled()&&this.snapshotTimer.cancel();const e=Array.from(this.otherReceiptCache),t=this.peerReadCache,n=this.receiptAckCache;__LOG__(2)`[offline-resume][receipt-cache]: creating snapshot for ${e.length} other, ${t.length} peer`,this.checkpointQueue.enqueue((0,i.default)((function*(){var r;yield Promise.all([(r=e,(0,f.getStorage)().lock(["message-info"],function(){var e=(0,i.default)((function*(e){let[t]=e;const n=yield t.bulkGet(r.map((e=>e[0].split(",")))),i=n.map(((e,t)=>{const[n,i]=r[t];if(!i)return null;if(!e){const[e,t]=n.split(",");return{delivery:i.delivery,read:i.read,played:i.played,msgKey:e,receiverUserJid:t,deviceDelivered:Array.from(i.deviceDelivered),deviceNotDelivered:[]}}const a=i.deviceDelivered;return e.deviceDelivered.forEach((e=>a.add(e))),{delivery:y(e.delivery,i.delivery),read:y(e.read,i.read),played:y(e.played,i.played),msgKey:e.msgKey,receiverUserJid:e.receiverUserJid,deviceDelivered:Array.from(a),deviceNotDelivered:e.deviceNotDelivered.filter((e=>!a.has(e)))}}));return t.bulkCreateOrReplace(i)}));return function(){return e.apply(this,arguments)}}())),m(t)]),function(e){e.forEach((e=>{let{from:t,stanzaId:n,ackString:r,participant:i}=e;const a=(0,l.wap)("ack",{to:(0,h.JID)(t),id:(0,l.CUSTOM_STRING)(n),class:"receipt",type:(0,l.MAYBE_CUSTOM_STRING)(r),participant:i&&i!==t?(0,h.DEVICE_JID)(i):l.DROP_ATTR});(0,u.castStanza)(a),(0,u.cancelDeadSocketTimer)()})),__LOG__(2)`[offline-resume][receipt-cache] finish sending ${e.length} acks`}(n),__LOG__(2)`[offline-resume][receipt-cache]: creating snapshot done`}))),this.otherReceiptCache=new Map,this.peerReadCache=[],this.receiptAckCache=[]}};t.default=E},45607:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sendBatchRequestIb=function(e){if(!(0,i.isAdaptiveOfflineEnabled)())return;const t=(0,r.wap)("ib",null,(0,r.wap)("offline_batch",{count:(0,r.CUSTOM_STRING)(String(e))}));(0,a.castStanza)(t)};var r=n(31914),i=n(58464),a=n(24747)},71251:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.storeOfflineMsgs=function(){return b.apply(this,arguments)};var i=r(n(48926)),a=n(52230),o=n(88555),s=n(15461),l=n(68638),c=n(57701),d=n(91525),u=n(41566),p=n(90981),f=n(63728),h=n(17304),_=n(54676),g=n(12600),m=n(49831),y=n(6684),E=n(90641),S=n(76332),v=n(99069),T=n(12896);function b(){return(b=(0,i.default)((function*(e){if(!(0,o.isLegacyWebdBackend)())try{const{newMsgs:t,replaceMsgs:n,revokeMsgs:r,paymentMessages:a,chatsWithNewOfflineMsg:o}=yield M(e);__LOG__(2)`[offline-resume][msg-cache] storeOfflineMsgs: newMsgs: ${t.length}, replaceMsgs: ${n.length}, revokeMsgs: ${r.length}, paymentMessages: ${a.length}`;const s=yield(0,m.applyOrphanRevoke)(t),[l,u]=yield Promise.all([C(s),(0,E.encryptMultipleMsgs)(s,!1)]);yield(0,p.getTable)().bulkCreateOrReplace(n),yield(0,v.getStorage)().lock(["chat","message","fts-indexing-queue"],function(){var e=(0,i.default)((function*(e){let[t,n,r]=e;yield t.bulkCreateOrMerge(l),yield(0,E.storeEncryptedMessage)(u,o,!1)}));return function(){return e.apply(this,arguments)}}()),yield P(r),yield(0,E.processPaymentMessages)(a),yield(0,d.handleOfflineForMessageRange)(e);const h=e.map((e=>e.id.toString()));yield(0,g.checkOrphanMutations)(h,o),(0,c.receiveReactionsEnabled)()&&(yield(0,S.checkUpdateForOrphanReactions)(h)),t.forEach((e=>{I(e)&&(0,f.addPlaceHolderAction)(e)}))}catch(e){__LOG__(4,void 0,new Error,!0)`[offline-resume] Error: ${e.name}, message: ${e.message}, stack: ${e.stack}`,SEND_LOGS("storeOfflineMsgs-error")}}))).apply(this,arguments)}function C(){return A.apply(this,arguments)}function A(){return(A=(0,i.default)((function*(e){const t=new Map;e.forEach((e=>{const n=e.id,r=n.remote.toString();if(r!==a.STATUS_JID&&(0,T.isUnreadTypeMsg)(e)){const i=t.get(r)||{unread:0,t:0,unreadMentionsOfMe:[]};if(!n.fromMe&&(i.unread+=1,(0,u.isGroupCatchUpEnabled)()&&(0,_.isImportantMessage)(e))){const t={id:e.id.toString(),timestamp:e.t};i.unreadMentionsOfMe?i.unreadMentionsOfMe.push(t):i.unreadMentionsOfMe=[t]}e.t>i.t&&(i.t=Math.max(e.t,i.t)),t.set(r,i)}}));const n=Array.from(t.keys()),r=(yield(0,l.getTable)().bulkGet(n)).map(((e,r)=>{var i;const a=n[r],o=t.get(a),s=(null==o?void 0:o.unread)||0,l=Math.max(0,e?e.unreadCount:0);let c=(null==o?void 0:o.t)||void 0;e&&null!=e.t&&(null==c||e.t>c)&&(c=e.t);let d=[],p=null!==(i=null==e?void 0:e.archiveAtMentionViewedInDrawer)&&void 0!==i&&i;if((0,u.isGroupCatchUpEnabled)()){var f,h;const t=null!==(f=null==o?void 0:o.unreadMentionsOfMe)&&void 0!==f?f:[],n=null!==(h=null==e?void 0:e.unreadMentionsOfMe)&&void 0!==h?h:[];t.length>0&&(p=!1),d=t.concat(n)}return{id:a,unreadCount:l+s,t:c,unreadMentionsOfMe:d,archiveAtMentionViewedInDrawer:p}}));return __LOG__(2)`[offline-resume][msg-cache]: storing chat updates: ${JSON.stringify(r)}`,r}))).apply(this,arguments)}function P(e){const t=[];return e.forEach((e=>{const n=new h.Msg(e);n.protocolMessageKey&&t.push({revokeMsgKey:n.protocolMessageKey,newMsgKey:n.id,timestamp:n.t,subtype:n.subtype,sender:n.sender})})),(0,E.processRevokeMsgs)(t).then(function(){var e=(0,i.default)((function*(e){if((0,c.receiveReactionsEnabled)()&&t.length>0){const e=[],r=new Set;t.forEach((t=>{e.push(t.revokeMsgKey.toString());const n=t.revokeMsgKey.remote.toString();r.add(n)}));const i=n(68819).getJobManager;yield i().waitUntilPersisted(y.jobSerializers.deleteReactions(Array.from(r.values()).join(","),e))}return e}));return function(){return e.apply(this,arguments)}}())}function M(){return O.apply(this,arguments)}function O(){return(O=(0,i.default)((function*(e){const t=yield(0,p.getTable)().bulkGet(e.map((e=>String(e.id))),!1),n=[],r=[],i=[],a=[],o=new Set,l=new Map;return e.forEach(((e,c)=>{const d=String(e.id),u=t[c];if(u)if(I(u)){const t=(0,T.convertToMessageRowType)(e);t.t=u.t,t.internalId=u.internalId,t.rowId=u.rowId,r.push(t),(0,f.populatePlaceHolderAction)(u)}else n.push(e.id.id);else{const t=l.get(d);t&&!I(t)?n.push(e.id.id):["sender_revoke","admin_revoke"].includes(e.subtype)?i.push(e):e.type===s.MSG_TYPE.PAYMENT&&"send"===e.subtype||"payment_action_request_declined"===e.subtype||"payment_transaction_request_cancelled"===e.subtype?(a.push(e),l.set(d,e),o.add(String(e.id.remote))):(l.set(d,e),o.add(String(e.id.remote)))}})),n.length>0&&__LOG__(2)`[offline-resume] classifyOfflineMsgs: skip for ${n.length} duplicate messages, with id ${n}`,{newMsgs:Array.from(l.values()),chatsWithNewOfflineMsg:Array.from(o),replaceMsgs:r,revokeMsgs:i,paymentMessages:a}}))).apply(this,arguments)}function I(e){return e.type===s.MSG_TYPE.UNKNOWN&&"fanout"===e.subtype||e.type===s.MSG_TYPE.CIPHERTEXT}},50404:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=m.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.reject(t.error);const n=t.success;if(n&&n.refs&&Array.isArray(n.refs)&&6===n.refs.length){const{refs:e,id:t}=n;(0,d.castStanza)((0,a.wap)("iq",{to:a.S_WHATSAPP_NET,type:"result",id:(0,a.CUSTOM_STRING)(t)})),(0,c.generateADVSecretKey)(),_=e,g||(g=new i.ShiftTimer((()=>{if((0,p.isRegistered)()||!l.default.online||(0,s.isLegacyWebdBackend)())g&&g.cancel(),g=null;else if(_&&_.length){const e=6===_.length?6e4:2e4,t=_.shift();u.Conn.set({ref:t,refTTL:e}),h.Socket.state=f.SOCKET_STATE.UNPAIRED,g&&g.onOrAfter(e)}else g&&g.cancel(),g=null,h.Socket.state=f.SOCKET_STATE.UNPAIRED_IDLE}))),g.forceRunNow()}else __LOG__(3)`handlePairDevice: wrong pair device result received from server`};var i=n(57319),a=n(31914),o=n(71914),s=n(88555),l=r(n(81602)),c=n(46308),d=n(24747),u=n(17239),p=n(58052),f=n(62583),h=n(65044);let _=[],g=null;const m=new o.WapParser("pairDeviceParser",(e=>{e.assertTag("iq"),e.assertFromServer();const t=[];return e.child("pair-device").forEachChild((e=>{e.assertTag("ref"),t.push(e.contentString())})),{refs:t,id:e.attrString("id")}}))},58645:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return D.apply(this,arguments)};var i=r(n(48926)),a=n(15688),o=n(11141),s=n(92844),l=n(31914),c=n(71914),d=n(54003),u=n(81663),p=n(45454),f=n(84902),h=n(60980),_=r(n(41143)),g=n(61438),m=n(46308),y=n(24747),E=n(17239),S=n(53614),v=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=I(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(91214)),T=n(99234),b=n(83578),C=r(n(11339)),A=n(58052),P=n(11849),M=n(93832),O=n(65044);function I(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(I=function(e){return e?n:t})(e)}let w=!1;const R=new c.WapParser("pairSuccessParser",(e=>{var t;e.assertTag("iq"),e.assertFromServer();const n=e.attrString("id"),r=e.child("pair-success"),i=null===(t=r.maybeChild("platform"))||void 0===t?void 0:t.maybeAttrString("name"),a=r.child("device"),o=r.child("device-identity").contentBytes(),s=r.maybeChild("biz"),l=s?s.attrString("name"):"";return{wid:(0,u.deviceJidToDeviceWid)(a.attrPhoneDeviceJid("jid")),id:n,deviceIdentityBytes:o,businessName:l,platform:i}}));function D(){return(D=(0,i.default)((function*(e){if(w||(0,A.isRegistered)())return;(0,T.getShowMdUpgradeCompleteMsg)()&&((0,T.setShowMdUpgradeCompleteMsg)(!1),(0,T.setForcedMdUpgradeComplete)(!1)),w=!0;const t=(0,s.unixTime)(),n=R.parse(e);if(n.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${n.error.toString()}`,w=!1,Promise.reject(n.error);try{(0,d.resetCompanionReg)(),(0,T.setHistorySyncEarliestDate)(t),(0,A.setPairingTimestamp)(t);const e=n.success,{id:r,wid:i,deviceIdentityBytes:s,platform:c}=e;E.Conn.blockStoreAdds=!1,c&&(E.Conn.platform=c);const u=(0,f.decodeProtobuf)(g.ADVSignedDeviceIdentityHMACSpec,s),b=u.details,O=u.hmac;(0,_.default)(null!=b&&null!=O,"ADVSignedDeviceIdentityHMAC should not have empty details or hmac");const I=(0,m.getADVSecretKey)(),R=yield(0,o.hmacSha256)(I,b),D=(0,a.encodeB64)(R);if(D!==(0,a.encodeB64)(O))return(0,y.castStanza)((0,l.wap)("iq",{to:l.S_WHATSAPP_NET,type:"error",id:(0,l.CUSTOM_STRING)(r)},(0,l.wap)("error",{code:"401",text:"not-authorized"}))),(0,d.logoutAfterValidationFail)(),void(w=!1);const L=(0,f.decodeProtobuf)(g.ADVSignedDeviceIdentitySpec,b),N=L.accountSignatureKey;(0,_.default)(null!=N,"accountSignatreKey should not be null");const k=L.accountSignature;(0,_.default)(null!=k,"accountSignature should not be null");const U=yield P.waSignalStore.getRegistrationInfo();(0,_.default)(null!=U,"Empty regInfo"),yield v.initDeviceLinkEvent(N,U.identityKeyPair.pubKey,t),v.setDeviceLinkPairStage(C.default.MD_LINK_DEVICE_COMPANION_STAGE.PAIR_SUCCESS_RECEIVED);if(!(0,m.verifyDeviceIdentityAccountSignature)(L,U.identityKeyPair.pubKey))return(0,y.castStanza)((0,l.wap)("iq",{to:l.S_WHATSAPP_NET,type:"error",id:(0,l.CUSTOM_STRING)(r)},(0,l.wap)("error",{code:"401",text:"not-authorized"}))),v.commitDeviceLinkEvent(401),(0,d.logoutAfterValidationFail)(),void(w=!1);L.deviceSignature=(0,m.generateDeviceSignature)(L,U.identityKeyPair,N),yield P.waSignalStore.putIdentity((0,M.createSignalAddress)((0,p.toUserWid)(i)).toString(),(0,M.bufferToStr)((0,S.toSignalCurvePubKey)(N))),yield(0,m.setADVSignedIdentity)(L);const G=(0,f.decodeProtobuf)(g.ADVDeviceIdentitySpec,L.details).keyIndex;(0,_.default)(null!=G,"keyIndex should not be null"),L.accountSignatureKey=void 0;const x=(0,h.encodeProtobuf)(g.ADVSignedDeviceIdentitySpec,L).readByteArray();(0,y.castStanza)((0,l.wap)("iq",{to:l.S_WHATSAPP_NET,type:"result",id:(0,l.CUSTOM_STRING)(r)},(0,l.wap)("pair-device-sign",null,(0,l.wap)("device-identity",{"key-index":(0,l.INT)(G)},x)))),v.setDeviceLinkPairStage(C.default.MD_LINK_DEVICE_COMPANION_STAGE.PAIR_DEVICE_SIGN_SENT),(0,T.setMdOptedIn)(!0),(0,T.setMe)(i),(0,A.getInitialHistorySyncComplete)()||(0,d.startInitialHistorySyncTimeout)(),w=!1}catch(e){__LOG__(4,!0,new Error,!0)`error in handlePairSuccess, ${e}`,SEND_LOGS("error in handlePairSuccess"),(0,v.commitDeviceLinkEvent)(-1),O.Socket.logout(!1,b.LogoutReason.UnknownCompanion)}}))).apply(this,arguments)}},2599:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getAmount1000AndCurrency=function(e){return function(e){if(e.hasChild("amount")){return function(e){e.assertTag("money");const t=parseFloat(e.attrString("value")),r=e.attrString("currency"),i=e.maybeAttrInt("offset");return{currency:r,amount1000:t*n/(null!=i&&0!==i?i:n)}}(e.child("amount").child("money"))}if(e.hasAttr("amount")){return{amount1000:parseFloat(e.attrString("amount"))*n,currency:e.attrString("currency")}}throw __LOG__(3)`Amount missing in pay or transaction node`,new Error("Amount missing in pay or transaction node")}(e)};const n=1e3},27258:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(55552).handlePaymentNotification;t.default=r},55552:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handlePaymentNotification=function(){return y.apply(this,arguments)},t.parseNotificationPaymentInfo=T,t.processAllOrphanPaymentNotifications=function(){return C.apply(this,arguments)},t.processOrphanPaymentNotifications=function(){return b.apply(this,arguments)},t.updateReceivedPaymentInfo=S;var i=r(n(81109)),a=r(n(48926)),o=r(n(45095)),s=r(n(65212)),l=n(1559),c=n(35588),d=n(84886),u=n(17304),p=n(59871),f=n(5819),h=n(45377),_=n(75295),g=n(31019),m=n(52586);function y(){return(y=(0,a.default)((function*(e){if(e.content&&"invite"===e.content[0].tag)return E(e);const t=_.paymentNotificationParser.parse(e);if(t.error)return __LOG__(2)`${t.error.toString()} parsing ${e.toString()}`,Promise.reject(t.error);if(!t.success)return Promise.resolve();const n=t.success,r=(0,o.default)(n.msgKey,"info.msgKey"),a=p.MsgCollection.get(r),s=a?(0,g.unproxy)(a):yield(0,c.getMsgByMsgKey)(r);if(!s){__LOG__(3)`handlePaymentNotification: no msg found for id ${r.toString()}`;const e=(0,i.default)((0,i.default)({},n),{},{msgKey:r.toString()});return(0,h.getTable)().createOrReplace(e)}return S(s,n)}))).apply(this,arguments)}function E(e){const t=_.paymentInviteNotificationParser.parse(e);if(t.error)return __LOG__(2)`${t.error.toString()} parsing ${e.toString()}`,Promise.reject(t.error);if(!t.success)return Promise.resolve();const n=t.success;if("account-set-up"===n.type){const e=(0,l.genPaymentInviteAccoutSetupMsg)(n.from,n.timestamp);return(0,f.handleSingleMsgMD)(e.from,e)}return Promise.resolve()}function S(){return v.apply(this,arguments)}function v(){return(v=(0,a.default)((function*(e,t){const n=[];T(e,t),n.push(e.id.toString());const r=[e instanceof u.Msg?e.toJSON():e];if(null!=e.paymentRequestMessageKey){const t=p.MsgCollection.get(e.paymentRequestMessageKey),n=t?(0,g.unproxy)(t):yield(0,c.getMsgByMsgKey)(e.paymentRequestMessageKey||"");n&&(n.paymentStatus=e.paymentStatus,n.paymentTxnStatus=(0,m.determinePaymentRequestFulfilledStatus)(e.paymentTxnStatus),r.push(n instanceof u.Msg?n.toJSON():n))}return(0,h.getTable)().bulkRemove(n).catch((()=>{__LOG__(4,void 0,new Error)`getOrphanPaymentNotificationTable bulkremove of ${n} failed. {e}`})),(0,d.updateExistingMessages)(r)}))).apply(this,arguments)}function T(e,t){t&&(null!=t.status&&(e.paymentStatus=(0,m.getPaymentWebStatus)(t.status,t.type),e.paymentTxnStatus=(0,m.getPaymentTxnWebStatus)(t.status)),e.paymentCurrency=t.currency||"",e.paymentAmount1000=(0,o.default)(t.amount1000,"mdPaymentInfo.amount1000"),e.paymentMessageReceiverJid=t.receiver,e.paymentTransactionTimestamp=(0,o.default)(t.ts,"mdPaymentInfo.ts"))}function b(){return(b=(0,a.default)((function*(e){const t=e.map((e=>e.id.toString())),n=yield(0,h.getTable)().bulkGet(t),r=new Map;e.forEach((e=>{r.set(e.id.toString(),e)})),n.forEach((e=>{if(e){const t=r.get(e.msgKey);if(!t)return;S(t,{receiver:e.receiver,currency:e.currency,amount1000:e.amount1000,type:e.type,status:e.status,ts:e.ts,msgKey:s.default.fromString(e.msgKey)})}}))}))).apply(this,arguments)}function C(){return(C=(0,a.default)((function*(){const e=yield(0,h.getTable)().all(),t=new Map,n=[];if(e.forEach((e=>{const r=p.MsgCollection.get(e.msgKey);r?S(r,{receiver:e.receiver,currency:e.currency,amount1000:e.amount1000,type:e.type,status:e.status,ts:e.ts,msgKey:s.default.fromString(e.msgKey)}):(t.set(e.msgKey,e),n.push(e.msgKey))})),n.length>0){const e=yield(0,c.getMsgsByMsgKey)(n);return e.forEach((e=>{const n=t.get(e.id.toString());n&&(e.paymentTxnStatus=(0,m.getPaymentTxnWebStatus)(n.status),e.paymentCurrency=n.currency||"",e.paymentAmount1000=(0,o.default)(n.amount1000,"notification.amount1000"),e.paymentMessageReceiverJid=n.receiver,e.paymentTransactionTimestamp=(0,o.default)(n.ts,"notification.ts"))})),(0,d.updateExistingMessages)(e)}}))).apply(this,arguments)}},75295:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.isNoviTransaction=d,t.parseTransactionNode=f,t.paymentNotificationParser=t.paymentInviteNotificationParser=void 0;var i=n(71914),a=n(81663),o=r(n(65212)),s=n(2599),l=n(99234),c=n(52586);function d(e){return!(!e||!e.hasAttr("service")||"NOVI"!==e.attrString("service").toUpperCase())}const u=new i.WapParser("paymentNotificationParser",(e=>{if(e.hasChild("transaction")){return f(e.child("transaction"))}return __LOG__(2)`No transaction node in the payment notification`,null}));t.paymentNotificationParser=u;const p=new i.WapParser("paymentInviteNotificationParser",(e=>{if(e.hasChild("invite")){const t=e.child("invite");return{type:t.maybeAttrString("type"),service:t.maybeAttrString("service"),inviteUsed:t.hasAttr("invite-used")?"1"===t.attrString("invite-used"):null,from:(0,a.chatJidToChatWid)(e.attrChatJid("from")),timestamp:e.attrTime("t")}}return __LOG__(2)`No invite node in the payment invite notification`,null}));function f(e){if(d(e))return __LOG__(2)`Payment notification from Novi not supported`,null;let t,n;const r=(0,l.getMeUser)(),i=(0,a.jidWithTypeToWid)(e.attrJidWithType("sender")),u=(0,a.jidWithTypeToWid)(e.attrJidWithType("receiver")),p=r.equals(i);e.hasAttr("group")?(t=(0,a.jidWithTypeToWid)(e.attrJidWithType("group")),n=(0,a.jidWithTypeToWid)(e.attrJidWithType("sender"))):t=p?u:i;const f=new o.default({id:e.attrString("message-id"),fromMe:p,remote:t,participant:n}),h=(0,c.getPaymentTransactionType)(e.attrString("transaction-type"),f.fromMe),{amount1000:_,currency:g}=(0,s.getAmount1000AndCurrency)(e);return{receiver:u,currency:g,amount1000:_,status:(0,c.getNotificationTransactionStatus)(h,e.attrString("status")),ts:e.attrInt("ts"),type:h,msgKey:f}}t.paymentInviteNotificationParser=p},52586:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PaymentTransactionTypeServerString=t.PaymentTransactionType=t.PaymentTransactionStatusServerString=t.NotificationTransactionStatus=void 0,t.determinePaymentRequestFulfilledStatus=function(e){if(function(e){return e===r.PaymentInfoTxnStatus.COMPLETED||e===r.PaymentInfoTxnStatus.SUCCESS}(e))return e;return r.PaymentInfoTxnStatus.COLLECT_INIT},t.getNotificationTransactionStatus=function(e,t){if(!t)return a.STATUS_UNSET;const n=t.toUpperCase();switch(e){case i.TYPE_P2P_SENT:case i.TYPE_P2M_SENT:case i.TYPE_DEPOSIT:switch(n){case s.PENDING_RECEIVER_SETUP:return a.SEND_PAY_PENDING_RECEIVER;case s.FAILED_DA:return a.SEND_PAY_PENDING;case s.REFUND_FAILED_DA:return a.SEND_PAY_REFUND_PENDING;case s.FAILED_RISK:return a.SEND_PAY_FAILURE_RISK;case s.INITIAL:return a.SEND_PAY_INIT;case s.SUCCESS:case s.COMPLETED:return a.SEND_PAY_SUCCESS;case s.FAILURE:case s.FAILED:return a.SEND_PAY_FAILURE;case s.REFUNDED:return a.SEND_PAY_REFUNDED;case s.REFUND_FAILED:return a.SEND_PAY_REFUND_FAILED;case s.FAILED_RECEIVER_PROCESSING:return a.SEND_PAY_FAILURE_RECEIVER;case s.REFUND_FAILED_PROCESSING:return a.SEND_PAY_REFUND_FAILED_PROCESSING;case s.FAILED_DA_FINAL:return a.SEND_PAY_PENDING_REFUND;case s.AUTH_CANCEL_FAILED_PROCESSING:return a.SEND_PAY_AUTH_CANCEL_FAILED_PROCESSING;case s.AUTH_CANCEL_FAILED:return a.SEND_PAY_AUTH_CANCEL_FAILED;case s.AUTH_CANCELED:return a.SEND_PAY_AUTH_CANCELED;case s.EXPIRED:return a.SEND_PAY_EXPIRED;case s.IN_REVIEW:return a.SEND_PAY_IN_REVIEW;case s.PENDING:return a.SEND_PAY_PENDING_PROCESSING;case s.CANCELED:return a.SEND_PAY_USER_CANCELED}break;case i.TYPE_P2P_RCVD:case i.TYPE_P2M_RCVD:switch(n){case s.PENDING_SETUP:return a.RECV_PAY_PENDING_SETUP;case s.FAILED_DA:return a.RECV_PAY_PENDING;case s.FAILED_PROCESSING:return a.RECV_PAY_RETRY_ON_FAILURE;case s.SUCCESS:case s.COMPLETED:return a.RECV_PAY_SUCCESS;case s.FAILURE:case s.FAILED:return a.RECV_PAY_FAILURE;case s.EXPIRED:return a.RECV_PAY_EXPIRED;case s.FAILED_RISK:return a.RECV_PAY_FAILURE_RISK;case s.WITHDRAWAL_PROCESSING:return a.RECV_PAY_WITHDRAWAL_PROCESSING;case s.WITHDRAWAL_FAILURE:return a.RECV_PAY_WITHDRAWAL_FAILURE;case s.WITHDRAWAL_PERMANENT_FAILED:return a.RECV_PAY_WITHDRAWAL_PERMANENT_FAILED;case s.CANCELED:return a.RECV_PAY_SENDER_CANCELED}break;case i.TYPE_P2P_REQ_SENT:case i.TYPE_P2P_REQ_RCVD:switch(n){case s.COLLECT_SUCCESS:return a.REQUEST_PAY_SUCCESS;case s.COLLECT_FAILED:return a.REQUEST_PAY_FAILED;case s.COLLECT_FAILED_RISK:return a.REQUEST_PAY_FAILED_RISK;case s.COLLECT_REJECTED:return a.REQUEST_PAY_REJECTED;case s.COLLECT_EXPIRED:return a.REQUEST_PAY_EXPIRED;case s.COLLECT_CANCELED:return a.REQUEST_PAY_CANCELLED}break;case i.TYPE_P2P_REQ_SCHEDULED_PAYMENT_RCVD:switch(n){case s.COLLECT_SUCCESS:return a.REQUEST_PAY_SCHEDULED_PAYMENT_SUCCESS;case s.AUTH_SUCCESS:return a.SEND_PAY_AUTH_SUCCESS}break;case i.TYPE_REFUND:switch(n){case s.SUCCESS:case s.COMPLETED:return a.RECV_PAY_SUCCESS}break;case i.TYPE_WITHDRAWAL:switch(n){case s.PENDING:return a.WITHDRAWAL_PENDING;case s.IN_REVIEW:return a.WITHDRAWAL_IN_REVIEW;case s.SUCCESS:case s.COMPLETED:return a.WITHDRAWAL_SUCCESS;case s.FAILED:case s.DECLINED:return a.WITHDRAWAL_FAILED;case s.CANCELED:return a.WITHDRAWAL_USER_CANCELED;case s.EXPIRED:return a.WITHDRAWAL_EXPIRED;case s.WITHDRAWAL_ACTIVE:return a.WITHDRAWAL_ACTIVE}break;default:return a.STATUS_UNSET}return a.STATUS_UNSET},t.getPaymentTransactionType=function(e,t){if(e){const n=e.toLowerCase();switch(n){case o.TYPE_P2P:return t?i.TYPE_P2P_SENT:i.TYPE_P2P_RCVD;case o.TYPE_P2M:return t?i.TYPE_P2M_SENT:i.TYPE_P2M_RCVD;case o.TYPE_P2M_PAYOUT:return i.TYPE_P2M_PAYOUT;case o.TYPE_DEPOSIT:return i.TYPE_DEPOSIT;case o.TYPE_REFUND:return i.TYPE_REFUND;case o.TYPE_WITHDRAWAL:return i.TYPE_WITHDRAWAL;default:__LOG__(2)`parsePaymentTransactionType payment transaction string=${n}`}}return t?i.TYPE_P2P_SENT:i.TYPE_P2P_RCVD},t.getPaymentTxnWebStatus=function(e){if(null==e)return r.PaymentInfoTxnStatus.UNKNOWN;switch(e){case a.RECV_PAY_EXPIRED:case a.SEND_PAY_EXPIRED:return r.PaymentInfoTxnStatus.EXPIRED_TXN;case a.RECV_PAY_FAILURE:case a.SEND_PAY_FAILURE:return r.PaymentInfoTxnStatus.FAILED;case a.RECV_PAY_INIT:case a.SEND_PAY_INIT:return r.PaymentInfoTxnStatus.INIT;case a.RECV_PAY_PENDING_SETUP:return r.PaymentInfoTxnStatus.PENDING_SETUP;case a.RECV_PAY_PENDING:case a.SEND_PAY_PENDING:return r.PaymentInfoTxnStatus.FAILED_DA;case a.RECV_PAY_RETRY_ON_FAILURE:return r.PaymentInfoTxnStatus.FAILED_PROCESSING;case a.RECV_PAY_SUCCESS:case a.SEND_PAY_SUCCESS:case a.REQUEST_PAY_FULFILLED:return r.PaymentInfoTxnStatus.SUCCESS;case a.REQUEST_PAY_CANCELLED:return r.PaymentInfoTxnStatus.COLLECT_CANCELED;case a.REQUEST_PAY_CANCELLING:return r.PaymentInfoTxnStatus.COLLECT_CANCELLING;case a.REQUEST_PAY_EXPIRED:return r.PaymentInfoTxnStatus.COLLECT_EXPIRED;case a.REQUEST_PAY_FAILED_RISK:return r.PaymentInfoTxnStatus.COLLECT_FAILED_RISK;case a.REQUEST_PAY_FAILED:return r.PaymentInfoTxnStatus.COLLECT_FAILED;case a.REQUEST_PAY_INIT:return r.PaymentInfoTxnStatus.COLLECT_INIT;case a.REQUEST_PAY_REJECTED:return r.PaymentInfoTxnStatus.COLLECT_REJECTED;case a.REQUEST_PAY_SUCCESS:return r.PaymentInfoTxnStatus.COLLECT_SUCCESS;case a.SEND_PAY_AUTH_CANCELED:return r.PaymentInfoTxnStatus.AUTH_CANCELED;case a.SEND_PAY_AUTH_CANCEL_FAILED_PROCESSING:return r.PaymentInfoTxnStatus.AUTH_CANCEL_FAILED_PROCESSING;case a.SEND_PAY_AUTH_CANCEL_FAILED:return r.PaymentInfoTxnStatus.AUTH_CANCEL_FAILED;case a.SEND_PAY_FAILURE_RECEIVER:return r.PaymentInfoTxnStatus.FAILED_RECEIVER_PROCESSING;case a.SEND_PAY_FAILURE_RISK:case a.RECV_PAY_FAILURE_RISK:return r.PaymentInfoTxnStatus.FAILED_RISK;case a.SEND_PAY_PENDING_RECEIVER:return r.PaymentInfoTxnStatus.PENDING_RECEIVER_SETUP;case a.SEND_PAY_PENDING_REFUND:return r.PaymentInfoTxnStatus.FAILED_DA_FINAL;case a.SEND_PAY_REFUNDED:return r.PaymentInfoTxnStatus.REFUNDED_TXN;case a.SEND_PAY_REFUND_FAILED_PROCESSING:return r.PaymentInfoTxnStatus.REFUND_FAILED_PROCESSING;case a.SEND_PAY_REFUND_FAILED:return r.PaymentInfoTxnStatus.REFUND_FAILED;case a.SEND_PAY_REFUND_PENDING:return r.PaymentInfoTxnStatus.REFUND_FAILED_DA;case a.SEND_PAY_IN_REVIEW:return r.PaymentInfoTxnStatus.IN_REVIEW;case a.STATUS_UNSET:default:return r.PaymentInfoTxnStatus.UNKNOWN}},t.getPaymentWebStatus=function(e,t){if(null==e)return r.PaymentInfoStatus.UNKNOWN_STATUS;switch(e){case a.SEND_PAY_INIT:case a.SEND_PAY_PENDING:case a.RECV_PAY_INIT:case a.RECV_PAY_PENDING:case a.RECV_PAY_RETRY_ON_FAILURE:case a.REQUEST_PAY_INIT:return r.PaymentInfoStatus.PROCESSING;case a.SEND_PAY_PENDING_RECEIVER:case a.SEND_PAY_FAILURE_RECEIVER:return r.PaymentInfoStatus.SENT;case a.REQUEST_PAY_SUCCESS:return t===i.TYPE_P2P_REQ_SENT?r.PaymentInfoStatus.WAITING_FOR_PAYER:r.PaymentInfoStatus.WAITING;case a.RECV_PAY_PENDING_SETUP:return r.PaymentInfoStatus.NEED_TO_ACCEPT;case a.SEND_PAY_SUCCESS:case a.RECV_PAY_SUCCESS:case a.REQUEST_PAY_FULFILLED:return r.PaymentInfoStatus.COMPLETE;case a.SEND_PAY_FAILURE:case a.SEND_PAY_FAILURE_RISK:case a.SEND_PAY_PENDING_REFUND:case a.SEND_PAY_REFUND_PENDING:case a.SEND_PAY_REFUND_FAILED:case a.SEND_PAY_REFUND_FAILED_PROCESSING:case a.RECV_PAY_FAILURE:case a.REQUEST_PAY_FAILED:case a.REQUEST_PAY_FAILED_RISK:return r.PaymentInfoStatus.COULD_NOT_COMPLETE;case a.SEND_PAY_REFUNDED:return r.PaymentInfoStatus.REFUNDED;case a.RECV_PAY_EXPIRED:case a.REQUEST_PAY_EXPIRED:case a.SEND_PAY_AUTH_CANCELED:case a.SEND_PAY_AUTH_CANCEL_FAILED:case a.SEND_PAY_AUTH_CANCEL_FAILED_PROCESSING:return r.PaymentInfoStatus.EXPIRED;case a.REQUEST_PAY_REJECTED:return r.PaymentInfoStatus.REJECTED;case a.REQUEST_PAY_CANCELLED:return r.PaymentInfoStatus.CANCELLED;case a.STATUS_UNSET:case a.REQUEST_PAY_CANCELLING:default:return r.PaymentInfoStatus.UNKNOWN_STATUS}};var r=n(21224);const i=n(76672)({TYPE_UNSET:0,TYPE_P2P_SENT:1,TYPE_P2P_RCVD:2,TYPE_P2P_GRP:3,TYPE_P2P_NO_INFO:4,TYPE_FUTURE:5,TYPE_P2P_REQ_SENT:10,TYPE_P2P_REQ_RCVD:20,TYPE_P2P_REQ_SCHEDULED_PAYMENT_RCVD:21,TYPE_P2P_REQ_GRP:30,TYPE_P2M_SENT:100,TYPE_P2M_RCVD:200,TYPE_P2M_PAYOUT:300,TYPE_MISSING_DETAILS:400,TYPE_DEPOSIT:500,TYPE_REFUND:600,TYPE_WITHDRAWAL:700});t.PaymentTransactionType=i;const a=n(76672)({STATUS_UNSET:0,REQUEST_PAY_INIT:11,REQUEST_PAY_SUCCESS:12,REQUEST_PAY_FAILED:13,REQUEST_PAY_FAILED_RISK:14,REQUEST_PAY_REJECTED:15,REQUEST_PAY_EXPIRED:16,REQUEST_PAY_FULFILLED:17,REQUEST_PAY_CANCELLED:18,REQUEST_PAY_CANCELLING:19,REQUEST_PAY_SCHEDULED_PAYMENT_SUCCESS:20,RECV_PAY_INIT:101,RECV_PAY_PENDING_SETUP:102,RECV_PAY_PENDING:103,RECV_PAY_RETRY_ON_FAILURE:104,RECV_PAY_FAILURE:105,RECV_PAY_SUCCESS:106,RECV_PAY_EXPIRED:107,RECV_PAY_FAILURE_RISK:108,RECV_PAY_WITHDRAWAL_PROCESSING:109,RECV_PAY_WITHDRAWAL_FAILURE:110,RECV_PAY_WITHDRAWAL_PERMANENT_FAILED:111,RECV_PAY_SENDER_CANCELED:112,SEND_PAY_INIT:401,SEND_PAY_PENDING_RECEIVER:402,SEND_PAY_PENDING:403,SEND_PAY_REFUND_PENDING:404,SEND_PAY_SUCCESS:405,SEND_PAY_FAILURE:406,SEND_PAY_FAILURE_RISK:407,SEND_PAY_REFUNDED:408,SEND_PAY_REFUND_FAILED:409,SEND_PAY_FAILURE_RECEIVER:410,SEND_PAY_REFUND_FAILED_PROCESSING:411,SEND_PAY_PENDING_REFUND:412,SEND_PAY_AUTH_CANCEL_FAILED_PROCESSING:413,SEND_PAY_AUTH_CANCEL_FAILED:414,SEND_PAY_AUTH_CANCELED:415,SEND_PAY_EXPIRED:416,SEND_PAY_AUTH_SUCCESS:417,SEND_PAY_AUTH_SUCCESS_CANCELING:418,SEND_PAY_IN_REVIEW:419,SEND_PAY_PENDING_PROCESSING:420,SEND_PAY_USER_CANCELED:421,WITHDRAWAL_INIT:601,WITHDRAWAL_PENDING:602,WITHDRAWAL_IN_REVIEW:603,WITHDRAWAL_SUCCESS:604,WITHDRAWAL_FAILED:605,WITHDRAWAL_USER_CANCELED:606,WITHDRAWAL_EXPIRED:607,WITHDRAWAL_ACTIVE:608});t.NotificationTransactionStatus=a;const o={TYPE_P2P:"p2p",TYPE_P2M:"p2m",TYPE_P2M_PAYOUT:"payout",TYPE_WITHDRAWAL:"withdrawal",TYPE_DEPOSIT:"deposit",TYPE_REFUND:"refund"};t.PaymentTransactionTypeServerString=o;const s={PENDING_RECEIVER_SETUP:"PENDING_RECEIVER_SETUP",PENDING_SETUP:"PENDING_SETUP",PENDING:"PENDING",INITIAL:"INITIAL",SUCCESS:"SUCCESS",COMPLETED:"COMPLETED",IN_REVIEW:"IN_REVIEW",FAILED:"FAILED",DECLINED:"DECLINED",FAILURE:"FAILURE",FAILED_RISK:"FAILED_RISK",FAILED_PROCESSING:"FAILED_PROCESSING",FAILED_RECEIVER_PROCESSING:"FAILED_RECEIVER_PROCESSING",REFUND_FAILED_PROCESSING:"REFUND_FAILED_PROCESSING",REFUNDED:"REFUNDED",REFUND_FAILED:"REFUND_FAILED",EXPIRED:"EXPIRED",CANCELED:"CANCELLED",AUTH_SUCCESS:"AUTH_SUCCESS",AUTH_CANCELED:"AUTH_CANCELED",AUTH_CANCEL_FAILED_PROCESSING:"AUTH_CANCEL_FAILED_PROCESSING",AUTH_CANCEL_FAILED:"AUTH_CANCEL_FAILED",COLLECT_SUCCESS:"COLLECT_SUCCESS",COLLECT_FAILED:"COLLECT_FAILED",COLLECT_REJECTED:"COLLECT_REJECTED",COLLECT_EXPIRED:"COLLECT_EXPIRED",COLLECT_CANCELED:"COLLECT_CANCELED",FAILED_DA:"FAILED_DA",FAILED_DA_FINAL:"FAILED_DA_FINAL",REFUND_FAILED_DA:"REFUND_FAILED_DA",COLLECT_FAILED_RISK:"COLLECT_FAILED_RISK",WITHDRAWAL_PROCESSING:"WITHDRAWAL_PROCESSING",WITHDRAWAL_FAILURE:"WITHDRAWAL_FAILURE",WITHDRAWAL_PERMANENT_FAILED:"WITHDRAWAL_PERMANENT_FAILED",WITHDRAWAL_ACTIVE:"WITHDRAWAL_ACTIVE"};t.PaymentTransactionStatusServerString=s},65347:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return u.apply(this,arguments)};var i=r(n(48926)),a=n(31914),o=n(71914),s=n(11849),l=n(46669);const c=new Set,d=new o.WapParser("lowKeyParser",(e=>(e.assertTag("notification"),e.assertAttr("type","encrypt"),e.assertFromServer(),{stanzaId:e.attrString("id"),numRemaining:e.child("count").attrInt("value")})));function u(){return(u=(0,i.default)((function*(e,t){const r=d.parse(e);if(r.error)throw __LOG__(4,void 0,new Error)`Parsing Error: ${r.error.toString()}`,new Error(r.error);{const e=r.success,i=(0,a.wap)("ack",{to:a.S_WHATSAPP_NET,id:(0,a.CUSTOM_STRING)(e.stanzaId),class:"notification"});return c.has(t)?i:(c.add(t),s.waSignalStore.setServerHasPreKeys(!1),yield n(28237).waitForMainStream,(0,l.uploadPreKeys)().then((()=>i)).finally((()=>{c.delete(t)})))}}))).apply(this,arguments)}},46007:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=s.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.reject(t.error);return(0,o.default)(t.success)};var i=n(71914),a=n(81663),o=r(n(54248));const s=new i.WapParser("incomingPresenceParser",(e=>{e.assertTag("presence");const t=e.attrEnumOrDefault("type",{available:"available",unavailable:"unavailable",unsubscribe:"unsubscribe"},"available"),n="deny"===e.maybeAttrString("last")||void 0;let r;return"unavailable"===t&&(e.hasAttr("last")?["deny","none","error"].includes(e.attrString("last"))||(r=e.attrTime("last")):r=Date.now()),{id:(0,a.chatJidToChatWid)(e.attrChatJid("from")),type:t,t:r,deny:n}}))},26445:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return _.apply(this,arguments)};var i=r(n(48926)),a=n(51239),o=n(31914),s=n(71914),l=n(81663),c=n(57849),d=n(68315),u=n(59201);const p=new s.WapParser("incomingPrivacyTokensParser",(e=>{e.assertTag("notification");return{id:e.attrString("id"),from:e.attrPhoneUserJid("from"),privacyTokens:e.child("tokens").mapChildrenWithTag("token",(e=>({type:e.attrString("type"),content:(0,a.uint8ArrayToBuffer)(e.contentBytes()),ts:e.attrTime("t")})))}}));function f(){return h.apply(this,arguments)}function h(){return(h=(0,i.default)((function*(e,t){const{type:n,content:r,ts:i}=t;if("trusted_contact"!==n)return;const a=(0,l.userJidToUserWid)(e.from);yield(0,u.setTcToken)(a,i,r),yield d.PresenceCollection.reSubscribeWhenActive(a)}))).apply(this,arguments)}function _(){return(_=(0,i.default)((function*(e){const t=p.parse(e);if(t.error)throw __LOG__(2)`error while parsing: ${e.toString()}`,__LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,t.error;const{success:n}=t,r=(0,o.wap)("ack",{id:(0,o.CUSTOM_STRING)(n.id),class:"notification",to:(0,o.JID)(n.from),type:"privacy_token"});return(0,c.getABPropConfigValue)("trusted_contacts")?(yield Promise.all(n.privacyTokens.map((e=>f(n,e)))),r):r}))).apply(this,arguments)}},2276:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=p.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.reject(t.error);const n=t.success;let i=Promise.resolve();if(n.jid){const e=n.jid;switch(n.type){case"delete":case"set":const t="delete"===n.type?c.PROFILE_PIC_COMMAND.REMOVE:c.PROFILE_PIC_COMMAND.SET;i=(0,d.changeProfilePicThumb)(e,t).then((()=>{if(!e.isGroup())return;const r=(0,a.genGroupPicChangeNotificationMsg)(n.jid,t,n.ts,n.author||(0,s.getMeUser)());return(0,l.handleSingleMsgMD)(n.jid,r)}));break;case"request":break;default:__LOG__(3)`Invalid type received`}}return i.then((()=>(0,r.wap)("ack",{id:(0,r.CUSTOM_STRING)(n.stanzaId),to:(0,u.JID)(n.from),class:"notification",type:"picture"})))};var r=n(31914),i=n(71914),a=n(77345),o=n(81663),s=n(99234),l=n(5819),c=n(41601),d=n(37638),u=n(39410);const p=new i.WapParser("incomingProfilePicNotificationParser",(e=>{let t,n;if(e.assertTag("notification"),e.hasChild("delete"))t="delete",n=e.child("delete");else if(e.hasChild("set"))t="set",n=e.child("set");else{if(!e.hasChild("request"))return e.throw("Expected child type to be one of: set, delete, request");t="request",n=e.child("request"),n.assertAttr("jid",(0,s.assertGetMe)().toJid())}const r=e.attrString("id");return n.hasAttr("jid")?{type:t,from:(0,o.chatJidToChatWid)(e.attrChatJid("from")),jid:(0,o.chatJidToChatWid)(n.attrChatJid("jid")),author:n.hasAttr("author")?(0,o.userJidToUserWid)(n.attrPhoneUserJid("author")):null,ts:e.attrTime("t"),rawTs:e.attrString("t"),stanzaId:r,picId:"set"===t?n.attrInt("id",1):0}:{from:(0,o.userJidToUserWid)(e.attrPhoneUserJid("from")),jid:null,type:t,hash:n.attrString("hash"),stanzaId:r}}))},54341:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return v.apply(this,arguments)};var i=r(n(48926)),a=n(51239),o=n(52230),s=n(31914),l=n(71914),c=n(81663),d=n(45454),u=n(57849),p=n(49714),f=n(45033),h=n(53348),_=n(40256),g=n(39410);const m=n(76672)({Image:"image",Video:"video",Text:"text"}),y=new l.WapParser("incomingCampaignParser",(e=>{e.assertTag("notification"),e.assertAttr("from",o.STATUS_JID);const t=e.attrString("id"),n=(0,c.userJidToUserWid)(e.attrPhoneUserJid("participant")),r=e.attrTime("t"),i=e.child("campaign"),s=i.hasChild("revoke"),l=i.attrString("id"),d=i.maybeAttrInt("duration"),u=i.mapChildrenWithTag("message",(e=>{const t=e.child("media");t.attrEnumValues("mediatype",m.members());return{id:e.attrString("id"),ts:r,body:(0,a.uint8ArrayToBuffer)(t.contentBytes())}}));return{participant:n,stanzaId:t,campaignId:l,campaignDuration:d,revoke:s,ts:r,messages:u}}));function E(){return S.apply(this,arguments)}function S(){return(S=(0,i.default)((function*(e,t){const{participant:n,campaignId:r,campaignDuration:i}=e,{id:a,ts:s,body:l}=t,c={type:p.MESSAGE_TYPE.OTHER_STATUS,externalId:a,ts:s,edit:-1,isHsm:!1,count:null,chat:(0,d.createWid)(o.STATUS_JID),author:n,pushname:null,isDirect:!1,campaignId:r,campaignDuration:i},u={retryCount:0,e2eType:f.CiphertextType.Msg,mediaType:f.MediaType.Photo,hideFail:!1};yield(0,h.processDecryptedProto)(l,c,null,u,{nativeFlowName:null,verifiedNameSerial:null,verifiedLevel:null,verifiedNameCert:null,privacyMode:null},!1)}))).apply(this,arguments)}function v(){return(v=(0,i.default)((function*(e){const t=y.parse(e);if(t.error)throw __LOG__(2)`error while parsing: ${e.toString()}`,__LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,t.error;const{success:n}=t,r=(0,s.wap)("ack",{id:(0,s.CUSTOM_STRING)(n.stanzaId),participant:(0,g.USER_JID)(n.participant),class:"notification",type:"psa",to:(0,g.JID)((0,d.createWid)(o.STATUS_JID))});return(0,u.getABPropConfigValue)("web_status_psa")?(n.revoke?yield(0,_.revokeStatusPSA)(n.campaignId):yield Promise.all(n.messages.map((e=>E(n,e)))),r):r}))).apply(this,arguments)}},79711:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.MAX_RETRY=void 0,t.handleMessageRetryRequest=function(e){const t=g.default.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.reject(new Error(t.error));const n=t.success,{from:r,participant:a,recipient:s,retryCount:l,stanzaId:c}=n;if(null==c)return __LOG__(3)`Received null stanzaID when handling message retry request`,Promise.reject(new Error("Received null stanzaID when handling message retry request"));const d=(0,o.wap)("ack",{id:(0,o.CUSTOM_STRING)(c),to:(0,y.JID)(r),participant:a?(0,y.DEVICE_JID)(a):o.DROP_ATTR,class:"receipt",type:"retry"}),p=T(r,s);if(!p)return Promise.resolve(d);return(0,u.handleMessage)(String(p),!1,(0,i.default)((function*(){const e=yield S(n);if(null==e)return d;const{originalMsgId:t,chat:i,requester:o,identityRowId:c}=e;try{const e=yield(0,h.getMsgIfAuthorized)(t,i,o,l,c);if(!e)return __LOG__(3)`handleMessageRetryRequest msg retry not authorized`,d;yield(0,_.sendRetry)(r,a,s,e,l)}catch(e){__LOG__(3)`handleMessageRetryRequest error: ${e}`}return d})))},t.handleVoipRetryRequest=function(){return E.apply(this,arguments)};var i=r(n(48926)),a=n(52230),o=n(31914),s=n(45454),l=n(9108),c=n(99234),d=n(97398),u=n(15746),p=r(n(11339)),f=r(n(76128)),h=n(28870),_=n(24659),g=r(n(87423)),m=n(93832),y=n(39410);function E(){return(E=(0,i.default)((function*(e){return null!=(yield S(e))}))).apply(this,arguments)}function S(){return v.apply(this,arguments)}function v(){return(v=(0,i.default)((function*(e){const{originalMsgId:t,from:n,participant:r,recipient:i,retryCount:o,offline:s}=e;if(o>=5)return void __LOG__(2)`handleRetryRequest refusing retry attempt #${o}`;const c=T(n,i);if(!c)return void __LOG__(3)`handleRetryRequest: no chat found for incoming retry request.`;const u=c.isUser()?n:r;if(!u)return void __LOG__(3)`handleRetryRequest: no requester found for incoming retry request.`;const _=u.device||0;try{if(!(yield(0,l.hasDevice)(u,_)))return __LOG__(3)`handleRetryRequest: no device ${_} found for ${u.user} for incoming retry request .`,void new p.default.MdRetryFromUnknownDevice({offline:s,senderType:_===a.DEFAULT_DEVICE_ID?p.default.DEVICE_TYPE.PRIMARY:p.default.DEVICE_TYPE.COMPANION}).commit();yield(0,h.updateLocalSession)(c,e),yield(0,d.ensureE2ESessions)([u]);return{originalMsgId:t,chat:c,requester:u,identityRowId:yield f.default.getIdentityRowId((0,m.createSignalAddress)(u).toString())}}catch(e){__LOG__(3)`handleRetryRequest error: ${e}`}}))).apply(this,arguments)}function T(e,t){return e.isUser()?(0,s.toUserWid)(e).equals((0,c.getMeUser)())?t||(__LOG__(3)`getActualChatId: from is a peer device, but without recipient`,null):(0,s.toUserWid)(e):e}t.MAX_RETRY=5},28870:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getMsgIfAuthorized=function(){return m.apply(this,arguments)},t.processKeyBundle=y,t.updateLocalSession=function(){return S.apply(this,arguments)};var i=r(n(81109)),a=r(n(48926)),o=r(n(65212)),s=n(15461),l=n(45454),c=n(99234),d=n(90981),u=n(47124),p=r(n(11339)),f=n(17304),h=n(43201),_=n(77605),g=n(12896);function m(){return(m=(0,a.default)((function*(e,t,n,r,i){const a=new o.default({id:e,remote:t,fromMe:!0,participant:t.isUser()?void 0:(0,c.getMeUser)()}),l=yield(0,d.getTable)().get(String(a));if(!l)return __LOG__(3)`getMsgIfAuthorized: can not find msg ${a.toString()}.`,null;const h=l.type===s.MSG_TYPE.REVOKED?l.protocolMessageRowId:l.rowId;if(null==h)return __LOG__(3)`getMsgIfAuthorized: msg missing rowId ${a.toString()}.`,null;const _=yield(0,u.isRetryEligible)(a,n,i,h);__LOG__(2,void 0,void 0,void 0,["messaging"])`getMsgIfAuthorized: ${e}, ${String(n)} retry eligibility ${_}`;const m=new f.Msg((0,g.hydrateMessage)(l));yield m.waitForPrep();let y=!1;switch(m.type===s.MSG_TYPE.REVOKED&&(y=!0,m.type="protocol",m.subtype="admin"===m.subtype?"admin_revoke":"sender_revoke"),_){case u.RetryEligibilityResult.ELIGIBLE:return m;case u.RetryEligibilityResult.INELIGIBLE_ALREADY_DELIVERED:new p.default.E2eRetryAfterDelivery({deviceType:n.isCompanion()?p.default.DEVICE_TYPE.COMPANION:p.default.DEVICE_TYPE.PRIMARY,messageType:m.getWamMessageType(),msgRetryCount:r,retryRevoke:y}).commit()}return null}))).apply(this,arguments)}function y(){return E.apply(this,arguments)}function E(){return(E=(0,a.default)((function*(e,t,n,r,a){return null!=n&&e&&e.key?a?null==r?(__LOG__(2)`processKeyBundle: missing session for retry`,yield _.Session.deleteRemoteInfo(t),!1):r!==n?(__LOG__(2)`processKeyBundle: delete session because reg does not match, saved: ${r}, received: ${n}`,yield _.Session.deleteRemoteInfo(t),!1):(__LOG__(2)`processKeyBundle: update local session with the retry key bundle`,yield _.Session.createSignalSession((0,i.default)({wid:t,regId:n},e)),!0):(__LOG__(2)`processKeyBundle: update local session with the retry key bundle`,yield _.Session.createSignalSession((0,i.default)({wid:t,regId:n},e)),!0):(__LOG__(2)`processKeyBundle: skip due to missing key bundle`,!1)}))).apply(this,arguments)}function S(){return(S=(0,a.default)((function*(e,t){const{from:r,keyBundle:i,offline:a,originalMsgId:o,participant:s,regId:d,retryCount:u}=t,p=s||r;if(__LOG__(2)`updateLocalSession: retryCount: ${u}, offline: ${a.toString()}, has keyBundle: ${(!!i).toString()}`,e.isGroup()){const t=n(69951).ChatCollection.get(e);t&&p&&(0,h.markForgetSenderKey)(t.id,[p])}const f=yield _.Session.getRemoteRegId(p);if((0,l.toUserWid)(p).equals((0,c.getMeUser)())&&f!==d)throw new Error(`updateLocalSession: detect registration Id change remote: ${d}, local: ${f} for peer device`);(yield y(i,p,d,f,a))||null!=f&&f!==d&&(__LOG__(2)`updateLocalSession: delete session because reg does not match, saved: ${f}, received: ${f}`,yield _.Session.deleteRemoteInfo(p));if(2===u)return _.Session.saveSessionBaseKey(p,o);if(u>2){if(yield _.Session.hasSameBaseKey(p,o))return __LOG__(2)`updateLocalSession: delete local session due to same base key`,_.Session.deleteRemoteInfo(p)}}))).apply(this,arguments)}},87423:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(71914),i=n(81663),a=n(99234);var o=new r.WapParser("retryRequestParser",(e=>{e.assertTag("receipt"),e.assertAttr("type","retry"),e.hasAttr("to")&&e.assertAttr("to",(0,a.assertGetMe)().toJid());const t=(0,i.jidWithTypeToWid)(e.attrJidWithType("from")),n=e.hasAttr("participant")?(0,i.deviceJidToDeviceWid)(e.attrPhoneDeviceJid("participant")):null,r=e.hasAttr("recipient")?(0,i.deviceJidToUserWid)(e.attrPhoneDeviceJid("recipient")):null,o=e.child("retry"),s=e.maybeChild("keys");let l=null;if(null!=s){var c;const e=s.child("skey"),t=s.child("key");l={identity:s.child("identity").contentBytes(32),deviceIdentity:null===(c=s.maybeChild("device-identity"))||void 0===c?void 0:c.contentBytes(),skey:{id:e.child("id").contentUint(3),pubkey:e.child("value").contentBytes(32),signature:e.child("signature").contentBytes(64)},key:{id:t.child("id").contentUint(3),pubkey:t.child("value").contentBytes(32)}}}return{stanzaId:e.attrString("id"),originalMsgId:o.attrString("id"),ts:e.attrTime("t"),retryCount:o.hasAttr("count")?o.attrInt("count"):0,regId:e.child("registration").contentUint(4),offline:e.hasAttr("offline"),from:t,participant:n,recipient:r,keyBundle:l}}));t.default=o},56545:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NOTIFICATION_TYPE=void 0,t.handleServerNotification=function(e){const t=d.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.reject(t.error);return function(e){const t=(0,r.wap)("ack",{id:(0,r.CUSTOM_STRING)(e.stanzaId),class:"notification",type:"server",to:e.from});switch(e.type){case c.LOG:return o.upload({reason:"Server request",immediate:!0,force:!0,skipSampling:!1}),Promise.resolve(t);case c.PROPS:return(0,s.queryServerProps)().then((()=>t));case c.ABPROPS:return(0,a.syncABProps)(!1).then((()=>t));default:return __LOG__(3)`Unsupported notification with type "server",
blindly ack-ing it and doing nothing`,Promise.resolve(t)}}(t.success)};var r=n(31914),i=n(71914),a=n(89981),o=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=l(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(86374)),s=n(56018);function l(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(l=function(e){return e?n:t})(e)}const c=Object.freeze({LOG:"log",PROPS:"props",ABPROPS:"abprops"});t.NOTIFICATION_TYPE=c;const d=new i.WapParser("incomingServerNotificationParser",(e=>{e.assertTag("notification");const t=e.attrString("id"),n=e.attrWapJid("from");return e.hasChild(c.LOG)?{type:c.LOG,stanzaId:t,from:n}:e.hasChild(c.PROPS)?{type:c.PROPS,stanzaId:t,from:n}:e.hasChild(c.ABPROPS)?{type:c.ABPROPS,stanzaId:t,from:n}:{type:null,stanzaId:t,from:n}}))},25773:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleServerSyncNotification=function(e){const t=p.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.reject(t.error);return function(e){if(e.changedCollections){const t=new Map;for(const[n,r]of e.changedCollections){const e=s.CollectionName.cast(n);null!=e?t.set(e,r):__LOG__(3)`syncd: unknown collection name in notification: ${n}`}let n=Array.from(t.keys());e.offline&&n.forEach((e=>{const t=u.get(e);null!=t?u.set(e,t+1):u.set(e,1)})),__LOG__(2)`syncd: incoming sync notification for collections
${Array.from(t.entries()).map((e=>{let[t,n]=e;return`${t} v${n}`})).join("\n")}`,o.default.isSyncDCriticalDataSyncInProcess()&&(n=n.filter((e=>(0,d.isCriticalCollection)(e))),__LOG__(2)`syncd: filtered non critical collections during bootstrap. new collections: ${n}`),(0,c.markCollectionsForSync)(n,t)}return Promise.resolve((0,i.wap)("ack",{id:(0,i.CUSTOM_STRING)(e.stanzaId),class:"notification",type:"server_sync",to:i.S_WHATSAPP_NET}))}(t.success)},t.reportOfflineNotifications=function(){if(u.size<1)return;let e=0;Array.from(u.entries()).forEach((t=>{let[,n]=t;e+=n-1})),new l.default.MdAppStateOfflineNotifications({redundantCount:e}).commit(),u.clear()};var i=n(31914),a=n(71914),o=r(n(95023)),s=n(45606),l=r(n(11339)),c=n(38804),d=n(93824);const u=new Map,p=new a.WapParser("serverSyncNotification",(e=>{if(e.assertTag("notification"),!e.hasChild("collection"))throw new Error("Server sync notifcation does not contain any collections");const t=e.attrString("id"),n=new Map(e.mapChildrenWithTag("collection",(e=>[e.attrString("name"),e.attrInt("version")]))),r=e.hasAttr("offline");return e.attrString("from")!==i.S_WHATSAPP_NET.toString()&&__LOG__(4,void 0,new Error)`handleServerSyncNotification: "from" is not domain jid "s.whatsapp.net"`,{changedCollections:n,stanzaId:t,offline:r}}))},87183:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return p.apply(this,arguments)};var i=r(n(48926)),a=n(71914),o=n(54003),s=n(88102),l=n(24747),c=n(91214),d=n(65044);const u=new a.WapParser("streamErrorParser",(e=>{if(e.assertTag("stream:error"),!e.hasChild("conflict"))return e.hasAttr("code")?{type:"code",code:e.attrInt("code")}:e.hasChild("ack")?{type:"ack",id:e.child("ack").hasAttr("id")?e.child("ack").attrString("id"):null}:(__LOG__(3)`Unrecognized stream:error: ${e.toString()}`,{type:"other"});switch(e.child("conflict").attrString("type")){case"replaced":return{type:"replaced"};case"device_removed":default:return{type:"device_removed"}}}));function p(){return(p=(0,i.default)((function*(e){const t=u.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.reject(t.error);const n=t.success;if("code"===n.type&&n.code>=500&&n.code<600){if(515===n.code)return(0,o.startLogin)(),Promise.resolve("NO_ACK");if(516===n.code)return(0,c.commitDeviceLinkEvent)(516),(0,o.startLogout)(),Promise.resolve("NO_ACK");(0,l.onStreamErrorReceived)()}else{if("device_removed"===n.type)return(0,l.stopComms)(!0),yield d.Socket.clearCredentialsAndStoredData(),__LOG__(2)`stream error due to device removed, logging out`,s.Cmd.logout(),Promise.resolve("NO_ACK");if("replaced"===n.type)return(0,l.stopComms)(),Promise.resolve("NO_ACK")}return Promise.resolve("CLOSE_SOCKET")}))).apply(this,arguments)}},95681:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=h.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`handleSuccess: failed to parse ${t.error}`,Promise.reject(t.error);const n=t.success;(function(e){const t=Date.now()/1e3,n=Math.round(t-e),r=Math.round(n/3600);0!==r&&(0,s.getABPropConfigValue)("log_clock_skew")&&new u.default.ClockSkewDifferenceT({clockSkewHourly:-1*r}).commit();(0,i.setClockSkew)(n),o.Clock.setSkew(n)})(n.ts),l.Cmd.onTemporaryBan({banned:!1});const r=n.companionEncStatic;if(c.DbEncKeyStore.generateFinalDbEncryptionAndFtsKey(r),(0,d.generateFinalDbEncryptionAndFtsKeyForInvoker)(r),null==f.ServerProps.serverPropsVersion||f.ServerProps.serverPropsVersion<n.propsVersion)return(0,p.queryServerProps)()};var i=n(92844),a=n(71914),o=n(40234),s=n(57849),l=n(88102),c=n(12669),d=n(64319),u=r(n(11339)),p=n(56018),f=n(64551);const h=new a.WapParser("successParser",(e=>(e.assertTag("success"),{ts:e.attrTime("t"),propsVersion:e.attrInt("props"),companionEncStatic:e.maybeAttrString("companion_enc_static")||"NULL"})))},2634:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=m.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.resolve("NO_ACK");const{callCreator:n,from:r,message:a,payloadTag:o,stanzaId:s}=t.success,l=(0,_.wapNodeToVoipXml)(e),g={elapsed_msec:a.elapsed_msec,epoch_msec:a.epoch_msec,is_offline:a.is_offline,payload:l[2][0],peer_app_version:a.peer_app_version,peer_platform:a.peer_platform,peer_jid:a.peer_jid?a.peer_jid.toString({legacy:!0}):void 0},E=a.call_id;switch(a.type){case h.TYPE.OFFER:return y(r,s,E,n,a.type),(0,p.getDoNotDisturb)()&&!u.default.isFocused?__LOG__(2)`handleCall: ignoring incoming call offer because do not disturb mode is enabled or screen is locked`:(0,d.handleIncomingCallOffer)(a,g),Promise.resolve("NO_ACK");case h.TYPE.ENC_REKEY:return(0,d.handleIncomingEncRekey)(a,g).then((e=>{let{shouldRetry:t,retryCount:i}=e;t?(0,f.default)(s,a,i):y(r,s,E,n,h.TYPE.ENC_REKEY)})),Promise.resolve("NO_ACK");case h.TYPE.ACCEPT:case h.TYPE.REJECT:return y(r,s,E,n,a.type),(0,d.handleIncomingSignalingMsg)(a,g),Promise.resolve("NO_ACK");case h.TYPE.OFFER_NOTICE:return(0,c.default)(e);default:return(0,d.handleIncomingSignalingMsg)(a,g),Promise.resolve(function(e,t,n){return(0,i.wap)("ack",{to:(0,_.JID)(e),id:(0,i.CUSTOM_STRING)(t),class:"call",type:(0,i.MAYBE_CUSTOM_STRING)(n)})}(r,s,o))}};var i=n(31914),a=n(71914),o=(r(n(64369)),n(81663)),s=n(24747),l=n(99234),c=r(n(66337)),d=n(76046),u=r(n(29861)),p=n(30351),f=r(n(64254)),h=n(45473),_=n(39410);function g(e){return h.TYPE[e.tag().toUpperCase()]||h.TYPE.NONE}const m=new a.WapParser("callParser",(e=>{e.assertTag("call");const t=(0,o.jidWithTypeToWid)(e.attrJidWithType("from")),n=e.mapFirstChild((e=>e));if(n){const r=n.attrString("call-id"),i=(0,o.jidWithTypeToWid)(n.attrJidWithType("call-creator")),a={call_id:r,call_creator:i,peer_jid:t,peer_platform:e.hasAttr("platform")?e.attrString("platform"):void 0,peer_app_version:e.hasAttr("version")?e.attrString("version"):void 0,epoch_msec:e.hasAttr("t")?String(1e3*e.attrInt("t")):void 0,elapsed_msec:e.hasAttr("e")?String(1e3*e.attrInt("e")):void 0,type:g(n),common:{call_id:r,peer_jid:t.toString(),type:String(g(n))},isVideoCall:n.hasChild("video"),t:e.attrTime("t")};return{from:(0,o.jidWithTypeToWid)(e.attrJidWithType("from")),stanzaId:e.attrString("id"),payloadTag:n.tag(),message:a,callCreator:i}}throw new Error("Unrecognized call stanza")}));function y(e,t,n,r,a){let o;switch(a){case h.TYPE.OFFER:o=(0,i.wap)("offer",{"call-id":(0,i.CUSTOM_STRING)(n),"call-creator":(0,_.JID)(r)});break;case h.TYPE.ENC_REKEY:o=(0,i.wap)("enc_rekey",{"call-id":(0,i.CUSTOM_STRING)(n),"call-creator":(0,_.JID)(r)});break;case h.TYPE.ACCEPT:o=(0,i.wap)("accept",{"call-id":(0,i.CUSTOM_STRING)(n),"call-creator":(0,_.JID)(r)});break;case h.TYPE.REJECT:o=(0,i.wap)("reject",{"call-id":(0,i.CUSTOM_STRING)(n),"call-creator":(0,_.JID)(r)})}(0,s.castStanza)((0,i.wap)("receipt",{to:(0,_.JID)(e),id:(0,i.CUSTOM_STRING)(t),from:(0,_.JID)((0,l.getMaybeMeUser)())},o))}},71419:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return f.apply(this,arguments)};var i=r(n(48926)),a=r(n(45095)),o=n(31914),s=n(71914),l=n(81663),c=n(79711),d=n(84356),u=n(39410);const p=new s.WapParser("rekeyRetryReceiptParser",(e=>{e.assertTag("receipt"),e.assertAttr("type","enc_rekey_retry");const t=e.child("enc_rekey");return{from:(0,l.jidWithTypeToWid)(e.attrJidWithType("from")),originalMsgId:t.attrString("call-id"),stanzaId:e.attrString("id"),retryCount:t.hasAttr("count")?t.attrInt("count"):0,regId:e.child("registration").contentUint(4),ts:null,participant:null,recipient:null,keyBundle:null,offline:!1}}));function f(){return(f=(0,i.default)((function*(e){const t=p.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.resolve();const n=t.success,r=(0,o.wap)("ack",{id:(0,o.CUSTOM_STRING)((0,a.default)(n.stanzaId,"retryInfo.stanzaId")),to:(0,u.JID)(n.from),class:"receipt",type:"enc_rekey_retry"});try{return(yield(0,c.handleVoipRetryRequest)(n))?d.Voip.resendEncRekeyRetry(n.from.toString({legacy:!0,formatFull:!0}),n.retryCount):(__LOG__(3)`voip:handle_enc_rekey_retry_receipt: not sending enc_rekey retry`,d.Voip.endCall(n.originalMsgId)),r}catch(e){return __LOG__(3)`voip:handle_enc_rekey_retry_receipt: error while attempting to send enc_rekey retry`,r}}))).apply(this,arguments)}},66337:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=c.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.resolve("NO_ACK");const{stanzaId:n,fromWid:r,callCreator:a,callId:o,isGroup:d,isVideo:u,t:p}=t.success;return(0,s.default)(a,o,p,u,d),Promise.resolve((0,i.wap)("ack",{to:(0,l.JID)(r),id:(0,i.CUSTOM_STRING)(n),class:"call",type:(0,i.CUSTOM_STRING)("offer_notice")}))};var i=n(31914),a=n(71914),o=n(81663),s=r(n(42285)),l=n(39410);const c=new a.WapParser("callOfferNoticeParser",(e=>{e.assertTag("call");const t=e.attrString("id"),n=(0,o.jidWithTypeToWid)(e.attrJidWithType("from")),r=e.child("offer_notice");return{stanzaId:t,fromWid:n,callCreator:(0,o.deviceJidToDeviceWid)(r.attrPhoneDeviceJid("call-creator")),callId:r.attrString("call-id"),isGroup:"group"===r.attrString("type"),isVideo:"video"===r.attrString("media"),t:e.attrTime("t")}}))},51836:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.extractCertificateDetailsParams=function(e){return{serial:e.serial,name:e.verifiedName,isApi:"ent:wa"===e.issuer}},t.getParsedProtoObjects=function(e){if(!e)return null;const t=(0,r.decodeProtobuf)(i.VerifiedNameCertificateSpec,e);if(!t.details)throw new Error("verifyCertificate cert missing details");if(!t.signature)throw new Error("verifyCertificate cert missing signature");const n=(0,r.decodeProtobuf)(i.VerifiedNameCertificate$DetailsSpec,t.details);return{cert:t,details:n}};var r=n(84902),i=n(91344)},45033:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MediaType=t.CiphertextType=void 0;const r=n(76672)({Skmsg:"skmsg",Pkmsg:"pkmsg",Msg:"msg"});t.CiphertextType=r;const i=n(76672)({Photo:"photo",Video:"video",Audio:"audio",Ptt:"ptt",Location:"location",Contact:"contact",Document:"document",Url:"url",Call:"call",Gif:"gif",Future:"future",ContactArray:"contact_array",LiveLocation:"live_location",ProfilePic:"profile_pic",Sticker:"sticker",Hsm:"hsm",ProductImage:"product_image",Template:"template",MdAppState:"md_app_state",MdHistorySync:"md_history_sync",List:"list",ListResponse:"list_response",Button:"button",ButtonResponse:"button_response",Order:"order",Product:"product"});t.MediaType=i},68819:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getJobManager=function(){if(null==u)throw new Error("jobs manager has not been initialized");return u},t.maybeCreateJob=h,t.startWebPersistedJobManager=function(){return p.apply(this,arguments)};var i=r(n(48926)),a=n(87614),o=n(47901),s=n(92844),l=n(57267),c=n(16703),d=r(n(56816));let u=null;function p(){return(p=(0,i.default)((function*(){yield(0,c.initialize)();const e=(0,l.getTable)();u=new o.PersistedJobManager({accessors:f(),unfinishedJobEntries:e.all(),isRestartAfterCrash:!1,listeners:{onJobStarted:()=>{},onJobFinished:()=>null},deprecatedJobs:{}}),(0,d.default)(u)}))).apply(this,arguments)}function f(){return{deletePersistedJob:e=>(0,l.getTable)().remove(e),updatePersistedJob:e=>(0,l.getTable)().createOrReplace(e),readPersistedJob:e=>(0,l.getTable)().get(e),maybeCreateJob:h}}function h(){return _.apply(this,arguments)}function _(){return(_=(0,i.default)((function*(e){var t,n;const r=(0,l.getTable)(),i=JSON.stringify([e.type,null!==(t=e.uniqKey)&&void 0!==t?t:(0,a.randomHex)(32)]),c={type:e.type,uniqKey:i,startTime:(0,s.unixTime)(),version:null!==(n=e.version)&&void 0!==n?n:1,original:e.args,current:e.args,step:o.UNSTARTED_JOB,waitUntil:null,stepFirstStartTime:null,stepHardStartCountAfterTimeout:0,stepUnexpectedErrorCount:0,backedOffCount:0};if(null==e.uniqKey)return r.createOrReplace(c).then((e=>({id:e,newlyCreated:!0})));const d=yield r.equals(["uniqKey"],[e.uniqKey]);if(0===d.length)return r.createOrReplace(c).then((e=>({id:e,newlyCreated:!0})));const u=[];let p=null;for(const e of d)e.step!==o.FINISHED_JOB?p=e:u.push(r.remove(e.jobId));return yield Promise.all(u),null!=p?{id:p.jobId,newlyCreated:!1}:r.createOrReplace(c).then((e=>({id:e,newlyCreated:!0})))}))).apply(this,arguments)}},97398:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ensureE2ESessions=m,t.ensureE2ESessionsWithDelay=function(e,t){const n=new s.ShiftTimer((()=>{m(e)}));e.forEach((e=>{_.set(String(e),n)})),n.onOrAfter(1e3*t)},t.splitWidsIntoChunks=S;var i=r(n(48926)),a=n(52230),o=n(27870),s=n(57319),l=n(31914),c=n(71914),d=n(81663),u=n(57849),p=n(24747),f=n(77605),h=n(39410);const _=new Map,g=new o.PromiseQueueMap;function m(e){const t=e.map((e=>e.toString())).join();e.forEach((e=>{const t=_.get(e.toString());t&&(t.cancel(),_.delete(e.toString()))})),__LOG__(2)`ensureE2ESession ${t}`;const n=g.waitIfPending(t);if(n)return __LOG__(2)`ensureE2ESession deduped ${t}`,n;const r=f.Session.hasSignalSessions(e).then(function(){var t=(0,i.default)((function*(t){const n=e.filter(((e,n)=>!t[n]));if(n.length>0){const{depletedPrekeyCount:e}=yield function(){return E.apply(this,arguments)}(n);return{missedPrekeyCount:n.length,depletedPrekeyCount:e}}return{missedPrekeyCount:0,depletedPrekeyCount:0}}));return function(){return t.apply(this,arguments)}}());return g.enqueueHandlers(t,r)}const y=new c.WapParser("e2eSessionParser",(e=>e.child("list").mapChildren((e=>{if(e.hasChild("error")){const t=e.child("error"),n=t.attrInt("code"),r=t.attrString("text");throw new Error(`establishE2ESessionParser bad response: ${n} ${r}`)}{const t=e.child("skey"),n=e.hasChild("key")?e.child("key"):null,r=e.hasChild("device-identity")?e.child("device-identity").contentBytes():null;return{wid:(0,d.deviceJidToDeviceWid)(e.attrPhoneDeviceJid("jid")),regId:e.child("registration").contentUint(4),identity:e.child("identity").contentBytes(32),deviceIdentity:r,skey:{id:t.child("id").contentUint(3),pubkey:t.child("value").contentBytes(32),signature:t.child("signature").contentBytes(64)},key:n&&{id:n.child("id").contentUint(3),pubkey:n.child("value").contentBytes(32)}}}}))));function E(){return(E=(0,i.default)((function*(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=new o.PromiseQueue,r=new o.PromiseQueue;let s=0;return S(e,(0,u.getABPropConfigValue)("web_prekeys_fetch_first_batch_size")).forEach((e=>{n.enqueue((0,i.default)((function*(){const n=e.map((e=>(0,l.wap)("user",{jid:(0,h.DEVICE_JID)(e),reason:t?"identity":l.DROP_ATTR}))),o=(0,l.wap)("iq",{id:(0,l.generateId)(),xmlns:"encrypt",type:"get",to:l.S_WHATSAPP_NET},(0,l.wap)("key",null,n)),c=yield(0,p.sendIq)(o,y);if(!c.success)throw new Error(`establishE2ESession bad response ${String(c)}`);const d=c.result;if(!d||d.length<=0)throw new Error("establishE2ESession: empty keyInfo");r.enqueue((0,i.default)((function*(){const e=[],t=[];d.forEach((n=>{null!=n.wid.device&&n.wid.device!==a.DEFAULT_DEVICE_ID?t.push(n):e.push(n),n.key||s++}));const n=e=>f.Session.createSignalSession(e).catch((t=>{__LOG__(4,void 0,new Error,!0)`createSignalSession: failed for device ${e.wid} with error ${t}`,SEND_LOGS("createSignalSession-fail")}));yield Promise.all(e.map((e=>n(e)))),yield Promise.all(t.map((e=>n(e))))})))})))})),__LOG__(2)`establishE2ESession: successfully established E2E sessions`,yield n.wait(),yield r.wait(),{depletedPrekeyCount:s}}))).apply(this,arguments)}function S(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(e.length<500)return[e];const n=Math.max(Math.min(t,1),0),r=Math.ceil(n*e.length);return[e.slice(0,r),e.slice(r)].filter((e=>e.length>0))}},63442:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getMerchantCompliance=function(){return f.apply(this,arguments)},t.setMerchantCompliance=function(){return h.apply(this,arguments)};var i=r(n(48926)),a=r(n(81109)),o=n(31914),s=n(71914),l=n(92574),c=n(24747),d=n(39410);const u=e=>{var t,n,r;return{email:(null==e||null===(t=e.maybeChild("email"))||void 0===t?void 0:t.contentString())||"",landline_number:(null==e||null===(n=e.maybeChild("landline_number"))||void 0===n?void 0:n.contentString())||"",mobile_number:(null==e||null===(r=e.maybeChild("mobile_number"))||void 0===r?void 0:r.contentString())||""}},p=new s.WapParser("merchantComplianceResponse",(e=>{e.assertTag("iq"),e.assertFromServer();const t=[];return e.forEachChildWithTag("merchant_info",(e=>{var n,r,i,o;const s=(null===(n=e.maybeChild("entity_name"))||void 0===n?void 0:n.contentString())||"",l=(null===(r=e.maybeChild("entity_type"))||void 0===r?void 0:r.contentString())||"",c=null===(i=e.maybeChild("entity_type_custom"))||void 0===i?void 0:i.contentString(),d="true"===e.attrString("is_registered"),p=e.maybeChild("customer_care_details"),f=e.maybeChild("grievance_officer_details"),h=(0,a.default)({},u(p)),_=(0,a.default)({name:(null==f||null===(o=f.maybeChild("name"))||void 0===o?void 0:o.contentString())||""},u(f));t.push({entity_name:s,entity_type:l,is_registered:d,entity_type_custom:c,customer_care_details:h,grievance_officer_details:_})})),t}));function f(){return(f=(0,i.default)((function*(e){const t=(0,o.wap)("iq",{to:o.S_WHATSAPP_NET,xmlns:"w:biz:merchant_info",id:(0,o.generateId)(),type:"get",smax_id:"53"},e.map((e=>(0,o.wap)("merchant_info",{jid:(0,d.USER_JID)(e.wid)})))),n=yield(0,c.sendIq)(t,p);if(n.success)return n.result;throw new l.ServerStatusCodeError(n.errorCode)}))).apply(this,arguments)}function h(){return(h=(0,i.default)((function*(){let{entityName:e,entityType:t,isRegistered:n,entityTypeCustom:r,customerCareDetails:i,grievanceOfficerDetails:a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const s=(0,o.wap)("iq",{to:o.S_WHATSAPP_NET,xmlns:"w:biz:merchant_info",id:(0,o.generateId)(),type:"set",smax_id:"54"},(0,o.wap)("merchant_info",{is_registered:n?"true":"false"},void 0!==e?(0,o.wap)("entity_name",null,e):null,void 0!==t?(0,o.wap)("entity_type",null,t):null,void 0!==r?(0,o.wap)("entity_type_custom",null,r):null,i?(0,o.wap)("customer_care_details",null,void 0!==i.email?(0,o.wap)("email",null,i.email):null,void 0!==i.landlineNumber?(0,o.wap)("landline_number",null,i.landlineNumber):null,void 0!==i.mobileNumber?(0,o.wap)("mobile_number",null,i.mobileNumber):null):null,a?(0,o.wap)("grievance_officer_details",null,void 0!==a.name?(0,o.wap)("name",null,a.name):null,void 0!==a.email?(0,o.wap)("email",null,a.email):null,void 0!==a.landlineNumber?(0,o.wap)("landline_number",null,a.landlineNumber):null,void 0!==a.mobileNumber?(0,o.wap)("mobile_number",null,a.mobileNumber):null):null)),d=yield(0,c.sendIq)(s,p);if(d.success)return d.result;throw new l.ServerStatusCodeError(d.errorCode)}))).apply(this,arguments)}},63728:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addPlaceHolderAction=function(e){d(e,{placeholderActionInd:l.default.PLACEHOLDER_ACTION.ADD}).commit()},t.populatePlaceHolderAction=function(e){d((0,c.hydrateMessage)(e),{placeholderActionInd:l.default.PLACEHOLDER_ACTION.POPULATE}).commit()},t.viewPlaceHolderAction=function(e){d((0,c.hydrateMessage)(e),{placeholderActionInd:l.default.PLACEHOLDER_ACTION.VIEW}).commit()};var i=r(n(81109)),a=n(92844),o=r(n(89867)),s=n(45454),l=r(n(11339)),c=n(12896);function d(e,t){const r=new(n(17304).Msg)(e),c=new l.default.PlaceholderActivity((0,i.default)({placeholderChatTypeInd:o.default.isGroup(r.from)||o.default.isGroup(r.to)?l.default.PLACEHOLDER_CHAT_TYPE.GROUP:l.default.PLACEHOLDER_CHAT_TYPE.INDIVIDUAL,placeholderTimePeriod:Math.max((0,a.unixTime)()-r.t,0),placeholderTypeInd:"fanout"===r.subtype?l.default.PLACEHOLDER_TYPE.FANOUT:l.default.PLACEHOLDER_TYPE.CIPHERTEXT,messageIsRevoke:Boolean(r.asRevoked),messageMediaType:r.getWamMediaType(),messageType:r.getWamMessageType()},t));return function(e,t){let r;o.default.isGroup(e.from)?r=e.from instanceof o.default?e.from:(0,s.createWidFromWidLike)(e.from):o.default.isGroup(e.to)&&(r=e.to);if(null!=r&&r.isGroup()){var i;const e=null===(i=n(63928).default.get(r))||void 0===i?void 0:i.cachedDeviceSizeBucket;null!=e&&(t.deviceSizeBucket=e)}}(r,c),c}},24872:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getAllContactsFromChatCollectionIntoChunks=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:500;const t=[],n=[],r=new Set;let i=new Set;for(const a of l.ChatCollection.toArray())i.size===e&&(t.push(i),i=new Set),a.isBroadcast||(a.isGroup?n.push(a.id):r.has(a.id)||(i.add(a.id),r.add(a.id)));for(const s of n){var a,o;const n=l.ChatCollection.get(s)||{},c=null!==(a=null===(o=n.groupMetadata)||void 0===o?void 0:o.participants.toArray())&&void 0!==a?a:[];for(const n of c)i.size===e&&(t.push(i),i=new Set),r.has(n.id)||(i.add(n.id),r.add(n.id))}0!==i.size&&t.push(i);return __LOG__(2,void 0,void 0,void 0,["contact-sync"])`get ${t.length} chunks of contacts from chat collection, chunk size: ${e}`,t},t.getAndUpdateNonAddressBookContacts=function(){return g.apply(this,arguments)},t.getNonAddressBookContactsAndMarkAllContactsDirty=function(){return _.apply(this,arguments)};var i=r(n(48926)),a=n(72441),o=r(n(89867)),s=n(45454),l=n(69951),c=n(76214),d=n(99069);function u(){return p.apply(this,arguments)}function p(){return(p=(0,i.default)((function*(){const e=new Set;return yield(0,c.getParticipantTable)().forEach((t=>{t.participants.forEach((t=>{e.add((0,a.toPhoneUserJid)((0,s.createWid)(t).user))}))})),yield(0,c.getChatTable)().forEach((t=>{o.default.isUser(t.id)&&e.add((0,a.toPhoneUserJid)((0,s.createWid)(t.id).user))})),__LOG__(2,void 0,void 0,void 0,["contact-sync"])`found ${e.size} contacts from chat and group participant tables`,Array.from(e)}))).apply(this,arguments)}function f(){return h.apply(this,arguments)}function h(){return(h=(0,i.default)((function*(e){const t=yield e.anyOf(["isAddressBookContact"],[1,0]),n=new Set(t.map((e=>e.id)));return __LOG__(2,void 0,void 0,void 0,["contact-sync"])`found ${n.size} contacts with set isAddressBookContact value from contact table`,n}))).apply(this,arguments)}function _(){return(_=(0,i.default)((function*(){const e=yield u();return(0,d.getStorage)().lock(["contact"],function(){var t=(0,i.default)((function*(t){let[n]=t;const r=yield f(n),i=Array.from(e).map((e=>r.has(e)?{id:e,isContactSyncCompleted:0}:{id:e,isAddressBookContact:0,isContactSyncCompleted:0}));return __LOG__(2,void 0,void 0,void 0,["contact-sync"])`mark ${i.length} contacts dirty during the regular sync`,n.bulkCreateOrMerge(i)}));return function(){return t.apply(this,arguments)}}())}))).apply(this,arguments)}function g(){return(g=(0,i.default)((function*(){const e=yield u();return(0,d.getStorage)().lock(["contact"],function(){var t=(0,i.default)((function*(t){let[n]=t;const r=yield f(n),i=e.filter((e=>!r.has(e))).map((e=>({id:e,isAddressBookContact:0,isContactSyncCompleted:0})));return __LOG__(2,void 0,void 0,void 0,["contact-sync"])`get ${i.length} non-address book contacts, mark dirty, and update the contact table during the inital sync`,n.bulkCreateOrMerge(i)}));return function(){return t.apply(this,arguments)}}())}))).apply(this,arguments)}},10058:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.syncContactListInChunksJob=function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return(0,a.NonPersistJob)("syncContactListInChunks",(e=>(0,r.syncContactListInChunks)(e)),{priority:i.JOB_PRIORITY.SKIP}).waitUntilCompleted({contactIds:e,shouldDelayBetweenChunks:t})},t.syncContactListJob=function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return(0,a.NonPersistJob)("syncContactList",(e=>(0,r.syncContactList)(e)),{priority:i.JOB_PRIORITY.SKIP}).waitUntilCompleted({contactIds:e,shouldSyncDevice:t})};var r=n(33192),i=n(1973),a=n(29731)},57062:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.markGroupAsDirtyJob=function(e){return(0,a.NonPersistJob)("markGroupAsDirty",(e=>(0,o.markGroupAsDirty)(e)),{priority:r.JOB_PRIORITY.SKIP}).waitUntilCompleted({group:e})},t.modifyGroupParticipantJob=function(e,t,n,i,s){return(0,a.NonPersistJob)("modifyGroupParticipant",(e=>(0,o.modifyGroupParticipant)(e)),{priority:r.JOB_PRIORITY.SKIP}).waitUntilCompleted({group:e,oldId:t,newId:n,prevVersion:i,newVersion:s})},t.replaceParticipantsJob=function(e,t,n,i,s){return(0,a.NonPersistJob)("replaceParticipants",(e=>(0,o.replaceParticipants)(e)),{priority:r.JOB_PRIORITY.SKIP}).waitUntilCompleted({group:e,participants:t,admins:n,deviceIds:i,version:s})},t.updateGroupMetadataTableJob=function(e){return(0,a.NonPersistJob)("updateGroupMetadataTable",(e=>(0,i.updateGroupMetadataTable)(e)),{priority:r.JOB_PRIORITY.SKIP}).waitUntilCompleted({groupInfos:e})},t.updateGroupParticipantTableWithoutDeviceSyncJob=function(e){return(0,a.NonPersistJob)("updateGroupParticipantTableWithoutDeviceSync",(e=>(0,o.updateGroupParticipantTableWithoutDeviceSync)(e)),{priority:r.JOB_PRIORITY.SKIP}).waitUntilCompleted({groupInfos:e})};var r=n(1973),i=n(86791),a=n(29731),o=n(51727)},80474:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addParticipantsJob=function(e,t,n,o,s){return(0,i.NonPersistJob)("addParticipants",(e=>(0,a.addParticipants)(e)),{priority:r.JOB_PRIORITY.SKIP}).waitUntilCompleted({group:e,participants:t,version:n,prevVersion:o,isOffline:s})},t.demoteParticipantsJob=function(e,t,n,o){return(0,i.NonPersistJob)("demoteParticipants",(e=>(0,a.demoteParticipants)(e)),{priority:r.JOB_PRIORITY.SKIP}).waitUntilCompleted({group:e,participants:t,version:n,prevVersion:o})},t.promoteParticipantsJob=function(e,t,n,o){return(0,i.NonPersistJob)("promoteParticipants",(e=>(0,a.promoteParticipants)(e)),{priority:r.JOB_PRIORITY.SKIP}).waitUntilCompleted({group:e,participants:t,version:n,prevVersion:o})},t.removeParticipantsJob=function(e,t,n,o){return(0,i.NonPersistJob)("removeParticipants",(e=>(0,a.removeParticipants)(e)),{priority:r.JOB_PRIORITY.SKIP}).waitUntilCompleted({group:e,participants:t,version:n,prevVersion:o})},t.updateParticipantsJob=function(e,t,n,o){return(0,i.NonPersistJob)("updateParticipants",(e=>(0,a.updateParticipants)(e)),{priority:r.JOB_PRIORITY.SKIP}).waitUntilCompleted({group:e,participants:t,version:n,isOffline:o})};var r=n(1973),i=n(29731),a=n(18615)},61051:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.queryGroupJob=function(e,t,n){return(0,o.NonPersistJob)("queryGroup",function(){var e=(0,i.default)((function*(e){const t=yield(0,l.queryGroup)(e);return t.id&&(yield Promise.all([(0,a.updateGroupMetadataTable)({groupInfos:[t]}),(0,s.updateParticipants)({group:t.id,participants:t.participants,version:t.pvId,isOffline:null})])),t}));return function(){return e.apply(this,arguments)}}()).waitUntilCompleted({groupWid:e,request:t,phash:n})};var i=r(n(48926)),a=n(86791),o=n(29731),s=n(18615),l=n(2182)},10823:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.syncDeviceListJob=function(e,t,n){return(0,a.NonPersistJob)("syncDeviceList",(e=>(0,r.syncDeviceList)(e))).waitUntilCompleted({wids:e,context:t,phash:n})},t.syncMyDeviceListJob=function(){return(0,a.NonPersistJob)("syncMyDeviceList",(()=>(0,r.syncMyDeviceList)()),{priority:i.JOB_PRIORITY.SKIP}).waitUntilCompleted()};var r=n(64114),i=n(1973),a=n(29731)},66101:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.reportSyncdStatsJob=function(){return d.apply(this,arguments)};var i=r(n(48926)),a=n(57849),o=n(1973),s=r(n(11339)),l=n(29731),c=n(35047);function d(){return(d=(0,i.default)((function*(){if(yield(0,a.getABPropConfigValue)("md_app_state_report_md_sync_mutation_stats"))return new l.NonPersistJob("reportSyncdStats",(0,i.default)((function*(){const e=yield(0,c.generateActionStatCounts)();for(const t of e.values())new s.default.MdAppStateSyncMutationStats({syncdAction:t.action,applied:(0,c.convertToBucket)(t.applied),invalid:(0,c.convertToBucket)(t.invalid),orphan:(0,c.convertToBucket)(t.orphan),unsupported:(0,c.convertToBucket)(t.unsupported),failed:(0,c.convertToBucket)(t.failed)}).commit()})),{priority:o.JOB_PRIORITY.LOW}).waitUntilCompleted()}))).apply(this,arguments)}},4454:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.requestAllSyncdMissingKeysJob=function(){return new s.NonPersistJob("requestAllSyncdMissingKeys",(0,i.default)((function*(){yield(0,o.requestAllMissingKeys)(),setTimeout(l.setMissingKeyTimeout,2e4)})),{priority:a.JOB_PRIORITY.LOW}).waitUntilCompleted()};var i=r(n(48926)),a=n(1973),o=n(84051),s=n(29731),l=n(93932)},5474:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.syncdSyncAllCollectionsJob=function(){return new s.NonPersistJob("syncdSyncAllCollections",(0,i.default)((function*(){__LOG__(2)`syncd: periodic sync for all collection`,yield(0,l.markCollectionsForSync)([a.CollectionName.CriticalBlock,a.CollectionName.CriticalUnblockLow,a.CollectionName.Regular,a.CollectionName.RegularLow,a.CollectionName.RegularHigh])})),{priority:o.JOB_PRIORITY.LOW}).waitUntilCompleted()};var i=r(n(48926)),a=n(45606),o=n(1973),s=n(29731),l=n(38804)},1973:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.JOB_PRIORITY=void 0;const r=n(76672)({SKIP:"SKIP_PRIORITIZATION",UI_ACTION:"UI_ACTION",LOW:"LOW",HIGH:"HIGH"});t.JOB_PRIORITY=r},26681:(e,t,n)=>{"use strict";var r=n(95318);t.eE=void 0;var i=r(n(48926)),a=r(n(81109)),o=n(40265),s=n(87614),l=n(38284),c=n(1973);const d=c.JOB_PRIORITY.LOW;class u{constructor(){this._isInitialized=!1,this._tasks=[],this._pendingTasks=[]}init(e,t){var n;if(this._isInitialized)throw new Error("ConcurrentPreemptiveQueue has already initialized");this._maxThreadsCount=e.maxConcurrency,this._availableThreadsCount=e.maxConcurrency,this._jobMaxConcurrency=null!==(n=e.maxConcurrencyPerJob)&&void 0!==n?n:{},this._jobLogger=t,this._isInitialized=!0}isInitialized(){return this._isInitialized}clearQueue(){if(!this._isInitialized)throw new Error("ConcurrentPreemptiveQueue not initialized");this._tasks=[],this._pendingTasks=[]}enqueue(e,t,n){var r=this;if(!this._isInitialized)return Promise.reject(new Error("ConcurrentPreemptiveQueue not initialized"));let l,u;const p=new Promise(((e,t)=>{l=e,u=t})),f=(0,a.default)({priority:d},n),h=(0,s.randomHex)(8).substr(0,64),_=this._addJobTask(e,f,h,(0,i.default)((function*(){try{r._jobLogger.logJobStarted(h);const e=yield r._promiseTimeoutWrapper(t(),null==n?void 0:n.maxTimeoutMs);r._jobLogger.logJobCompleted(h),l(e)}catch(e){e instanceof o.TimeoutError?r._jobLogger.logJobTimeout(h):r._jobLogger.logJobError(h),u(e)}})));return n&&n.priority===c.JOB_PRIORITY.UI_ACTION&&this._runJobTask(_),this._runJobTasks(),p}_runJobTasks(){for(;this._availableThreadsCount>0;){const e=this._getNextJobTask();if(null==e)break;this._runJobTask(e)}}_promiseTimeoutWrapper(e,t){return void 0!==t?(0,l.promiseTimeout)(e,t):e}_runJobTask(e){var t=this;return(0,i.default)((function*(){t._availableThreadsCount--,t._markJobTaskPending(e);const{run:n,jobId:r,jobName:i}=e;try{var a;yield t._promiseTimeoutWrapper(n(),void 0===(null===(a=e.jobInfo)||void 0===a?void 0:a.maxTimeoutMs)?1e4:void 0)}catch(e){if(!(e instanceof o.TimeoutError))throw e;t._jobLogger.logJobTimeout(r),__LOG__(2)`[job-orchestator]: ${i} exceeding the timeout, release the thread.`}finally{t._availableThreadsCount++,t._markJobTaskDone(r),setTimeout((()=>t._runJobTasks()),0)}}))()}_addJobTask(e,t,n,r){const i={jobId:n,jobInfo:t,jobName:e,run:r};return this._jobLogger.logJobCreated({jobId:n,jobName:e,jobPriority:t.priority,pendingJobsCount:this._tasks.length}),this._tasks.push(i),i}_markJobTaskPending(e){this._pendingTasks.includes((t=>t.jobId===e.jobId))&&(__LOG__(4,void 0,new Error,!0)`Assertion failed::markJobTaskPending found jobId: ${e.jobId} in pending tasks`,SEND_LOGS("JobOrchestrator::markJobTaskPending")),this._pendingTasks.push(e),this._tasks=this._tasks.filter((t=>t.jobId!==e.jobId))}_markJobTaskDone(e){this._pendingTasks=this._pendingTasks.filter((t=>t.jobId!==e)),this._tasks.includes((t=>t.jobId===e))&&(__LOG__(4,void 0,new Error,!0)`Assertion failed::markJobTaskDone found jobId: ${e} in scheduled tasks`,SEND_LOGS("JobOrchestrator::markJobTaskDone"))}_getNextJobTask(){if(0===this._tasks.length)return null;const e=this._pendingTasks.reduce(((e,t)=>{var n;const r=null!==(n=e.get(t.jobName))&&void 0!==n?n:0;return e.set(t.jobName,r+1),e}),new Map);return this._tasks.filter((t=>{var n,r;return(null!==(n=e.get(t.jobName))&&void 0!==n?n:0)<(null!==(r=this._jobMaxConcurrency[t.jobName])&&void 0!==r?r:1)}))[0]}}const p=new u;t.eE=p},5215:(e,t,n)=>{"use strict";var r=n(95318);t.e=void 0;var i=r(n(48926)),a=n(87614),o=n(1973);const s=new class{constructor(){this._isInitialized=!1}init(e,t){if(this._isInitialized)throw new Error("DefaultNoQueue has already initialized");this._jobLogger=t,this._isInitialized=!0}isInitialized(){return this._isInitialized}clearQueue(){}enqueue(e,t,n){var r=this;return(0,i.default)((function*(){var i;let s;const l=(0,a.randomHex)(8).substr(0,64);r._jobLogger.logJobCreated({jobId:l,jobName:e,jobPriority:null!==(i=null==n?void 0:n.priority)&&void 0!==i?i:o.JOB_PRIORITY.LOW,pendingJobsCount:0});try{r._jobLogger.logJobStarted(l),s=yield t(),r._jobLogger.logJobCompleted(l)}catch(e){throw r._jobLogger.logJobError(l),e}return s}))()}};t.e=s},26558:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.JobInfoEvent=void 0;n(1973),r(n(11339));t.JobInfoEvent=class{constructor(e,t,n,r){this.jobName=e,this.scenario=r,this.pendingJobsCount=n,this.jobPriority=t}logJobAdded(){this.webcJobAddedT=Date.now()}logJobStarted(){this.webcJobStartedT=Date.now()}logJobCompleted(e){this.webcJobCompletedT=Date.now(),this.jobResultType=e}}},69221:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getInstance=function(e){let t;if(e)t=n(5215).e;else{switch(function(){if((0,r.isLegacyWebdBackend)())return s;return(0,i.getABPropConfigValue)("web_orchestrator_enabled_version")}()){case"preemptive":t=n(26681).eE;break;case"v2":case"v1":default:t=n(5215).e}}if(!t.isInitialized()){const e=function(){l||(l=new a.JobStatsLogger);return l}();t.init(o,e)}return t};var r=n(88555),i=n(57849),a=n(95236);const o={maxConcurrency:1},s="default";let l},95236:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.JobStatsLogger=void 0;r(n(81109)),r(n(52991)),n(26558);var i=r(n(11339));t.JobStatsLogger=class{constructor(){this._jobEventMap=new Map}logJobCreated(e){}logJobStarted(e){}logJobCompleted(e){this._logJobFinished(e,i.default.WEBC_JOB_RESULT_TYPE_CODE.COMPLETED)}logJobError(e){this._logJobFinished(e,i.default.WEBC_JOB_RESULT_TYPE_CODE.ERROR)}logJobTimeout(e){this._logJobFinished(e,i.default.WEBC_JOB_RESULT_TYPE_CODE.TIMEOUT)}logJobAborted(e){this._logJobFinished(e,i.default.WEBC_JOB_RESULT_TYPE_CODE.ABORTED)}_logJobFinished(e,t){}_maybeCommitJobEvent(e){}}},29731:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NonPersistJob=function(e,t,n){if("function"!=typeof t)throw new Error("NonPersistJob got invalid function param");const a=(0,i.getInstance)((null==n?void 0:n.priority)===r.JOB_PRIORITY.SKIP);return{fireAndForget(){a.enqueue(e,(()=>t.apply(null,arguments)),n)},waitUntilCompleted(){return a.enqueue(e,(()=>t.apply(null,arguments)),n)}}};var r=n(1973),i=n(69221)},47587:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendPassiveIb=function(e){const t=(0,a.wap)("ib",null,(0,a.wap)("passive",{value:(0,a.CUSTOM_STRING)(String(e))}));(0,s.castStanza)(t)},t.sendPassiveIq=function(){return c.apply(this,arguments)};var i=r(n(48926)),a=n(31914),o=n(71914),s=n(24747);const l=new o.WapParser("passiveIqParser",(e=>{e.assertAttr("type","result")}));function c(){return(c=(0,i.default)((function*(e){const t=e?(0,a.wap)("passive",null):(0,a.wap)("active",null),n=(0,a.wap)("iq",{to:a.S_WHATSAPP_NET,xmlns:"passive",type:"set",id:(0,a.generateId)()},t),r=yield(0,s.sendIq)(n,l);if(!r.success){const{errorCode:e,errorText:t}=r;return __LOG__(3)`sendPassiveIq: sever response with ${e}, ${t}`,{errorCode:e,errorText:t}}__LOG__(2)`sendPassiveIq: passive mode set to ${String(e)}`}))).apply(this,arguments)}},56816:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){!function(e,t){Object.keys(t).forEach((n=>{t.hasOwnProperty(n)&&e.addPersistedJobImplementation(n,t[n])}))}(e,{rotateKey:()=>n.e(5179).then(n.bind(n,95179)).then((e=>e.default)),setAbout:()=>n.e(2776).then(n.bind(n,62776)).then((e=>e.default)),queryProductList:()=>n.e(1505).then(n.bind(n,71505)).then((e=>e.QueryProductListCatalog)),getPublicKey:()=>n.e(8578).then(n.bind(n,58578)).then((e=>e.QueryGetPublicKey)),getSignedUserInfo:()=>n.e(6801).then(n.bind(n,6801)).then((e=>e.QueryGetSignedUserInfo)),deleteReactions:()=>n.e(5377).then(n.bind(n,55377)).then((e=>e.default))})}},6684:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.jobSerializers=void 0;var r=n(92574),i=n(57701);const a={rotateKey:()=>({type:"rotateKey",args:{},uniqKey:"rotateKey"}),setAbout:e=>({type:"setAbout",args:{content:e},uniqKey:"setAbout"}),queryProductList(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0;if((0,i.commerceFeaturesDisabledBySanctions)())throw new r.E451;return{type:"queryProductList",args:{catalogWid:e.toString(),productIds:t,width:a,height:o,directConnectionEncryptedInfo:n},uniqKey:`queryProductList:${t.slice().sort().join(",")}:${a}:${o}`}},getPublicKey:e=>({type:"getPublicKey",args:{businessJid:e.toString()},uniqKey:`getPublicKey:${e.toString()}`}),getSignedUserInfo:e=>({type:"getSignedUserInfo",args:{businessJid:e.toString()},uniqKey:`getSignedUserInfo:${e.toString()}`}),deleteReactions:(e,t)=>({type:"deleteReactions",args:{chatId:e,parentMsgKeys:t},uniqKey:`deleteReactions:${e}`})};t.jobSerializers=a},93306:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addProductMD=function(){return f.apply(this,arguments)},t.addProductResponse=void 0;var i=r(n(48926)),a=n(31914),o=n(71914),s=n(92574),l=n(24747),c=n(65508),d=n(57701),u=n(90667);const p=new o.WapParser("addProductResponse",(e=>{e.assertTag("iq"),e.assertFromServer();const t=e.child("product_catalog_add").child("product");return(0,u.parseProductNode)(t)}));function f(){return(f=(0,i.default)((function*(e,t,n){if((0,d.commerceFeaturesDisabledBySanctions)())throw new s.E451;const r=(0,a.wap)("iq",{id:(0,a.generateId)(),to:a.S_WHATSAPP_NET,type:"set",xmlns:"w:biz:catalog"},(0,a.wap)("product_catalog_add",{v:"1"},(0,u.productModelToNode)(e),(0,a.wap)("width",null,t.toString()),(0,a.wap)("height",null,n.toString()))),i=yield(0,l.sendIqErrorParser)(r,p,c.parseErrorFields);if(i.success)return i.result;if(451===i.errorCode)throw new s.E451;throw null!=i.customError?new s.CatalogEditServerError(i.errorCode,i.customError):new s.ServerStatusCodeError(i.errorCode)}))).apply(this,arguments)}t.addProductResponse=p},27534:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.appealProductMD=function(){return u.apply(this,arguments)},t.appealProductResponse=void 0;var i=r(n(48926)),a=n(31914),o=n(71914),s=n(92574),l=n(24747),c=n(57701);const d=new o.WapParser("appealProductResponse",(e=>{e.assertTag("iq"),e.assertFromServer();return"true"===e.child("response").child("success").contentString()}));function u(){return(u=(0,i.default)((function*(e,t){if((0,c.commerceFeaturesDisabledBySanctions)())throw new s.E451;const n=(0,a.wap)("iq",{id:(0,a.generateId)(),to:a.S_WHATSAPP_NET,type:"set",xmlns:"fb:thrift_iq"},(0,a.wap)("request",{type:"appeal_product"},(0,a.wap)("reason",null,t),(0,a.wap)("id",null,e))),r=yield(0,l.sendIq)(n,d);if(r.success)return r.result;if(451===r.errorCode)throw new s.E451;throw new s.ServerStatusCodeError(r.errorCode)}))).apply(this,arguments)}t.appealProductResponse=d},23216:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.createCatalogEventLogger=t.GRAPHQL_CATALOG_ENDPOINT=void 0;var i=r(n(11339));const a=i.default.GRAPHQL_CATALOG_ENDPOINT;t.GRAPHQL_CATALOG_ENDPOINT=a;t.createCatalogEventLogger=e=>{const t=new i.default.GraphqlCatalogRequest({graphqlCatalogEndpoint:e});return{success:()=>{t.set({graphqlErrorCode:-1,graphqlRequestResult:i.default.GRAPHQL_REQUEST_RESULT.SUCCESS}),t.commit()},failure:e=>{let[n]=e;t.set({graphqlErrorCode:n.code,graphqlRequestResult:i.default.GRAPHQL_REQUEST_RESULT.FAILURE}),t.commit()}}}},90880:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.createProductCatalog=function(){return u.apply(this,arguments)},t.productCatalogCreateResponse=void 0;var i=r(n(48926)),a=n(31914),o=n(71914),s=n(92574),l=n(24747),c=n(57701);const d=new o.WapParser("productCatalogCreateResponse",(e=>{e.assertTag("iq"),e.assertFromServer(),e.child("product_catalog_create")}));function u(){return(u=(0,i.default)((function*(){if((0,c.commerceFeaturesDisabledBySanctions)())throw new s.E451;const e=(0,a.wap)("iq",{id:(0,a.generateId)(),to:a.S_WHATSAPP_NET,type:"set",xmlns:"w:biz:catalog"},(0,a.wap)("product_catalog_create",{version:"1"})),t=yield(0,l.sendIq)(e,d);if(t.success)return t.result;if(451===t.errorCode)throw new s.E451;throw new s.ServerStatusCodeError(t.errorCode)}))).apply(this,arguments)}t.productCatalogCreateResponse=d},15814:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.deleteProductsMD=function(){return u.apply(this,arguments)},t.productDeleteResponse=void 0;var i=r(n(48926)),a=n(31914),o=n(71914),s=n(92574),l=n(24747),c=n(57701);const d=new o.WapParser("productDeleteResponse",(e=>{e.assertTag("iq"),e.assertFromServer();return{deletedCount:e.child("product_catalog_delete").attrInt("deleted_count")}}));function u(){return(u=(0,i.default)((function*(e){if((0,c.commerceFeaturesDisabledBySanctions)())throw new s.E451;const t=(0,a.wap)("iq",{id:(0,a.generateId)(),to:a.S_WHATSAPP_NET,type:"set",xmlns:"w:biz:catalog"},(0,a.wap)("product_catalog_delete",{v:"1"},e.map((e=>(0,a.wap)("product",null,(0,a.wap)("id",null,e)))))),n=yield(0,l.sendIq)(t,d);if(n.success)return n.result;if(451===n.errorCode)throw new s.E451;throw new s.ServerStatusCodeError(n.errorCode)}))).apply(this,arguments)}t.productDeleteResponse=d},21013:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return f.apply(this,arguments)};var i=r(n(48926)),a=n(31914),o=n(71914),s=n(92574),l=n(24747),c=n(65508),d=n(57701),u=n(90667);const p=new o.WapParser("editProductResponse",(e=>{e.assertTag("iq"),e.assertFromServer();const t=e.child("product_catalog_edit").child("product");return(0,u.parseProductNode)(t)}));function f(){return(f=(0,i.default)((function*(e,t,n){if((0,d.commerceFeaturesDisabledBySanctions)())throw new s.E451;const r=(0,a.wap)("iq",{id:(0,a.generateId)(),to:a.S_WHATSAPP_NET,type:"set",xmlns:"w:biz:catalog"},(0,a.wap)("product_catalog_edit",{v:"1"},(0,u.productModelToNode)(e),(0,a.wap)("width",null,t.toString()),(0,a.wap)("height",null,n.toString()))),i=yield(0,l.sendIqErrorParser)(r,p,c.parseErrorFields);if(i.success)return i.result;if(451===i.errorCode)throw new s.E451;throw i.customError?new s.CatalogEditServerError(i.errorCode,i.customError):new s.ServerStatusCodeError(i.errorCode)}))).apply(this,arguments)}},90667:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.parseLegacyProductErrorReason=function(e){if(null!=e){const t=Object.keys(e)[0];return[{name:t,reason:e[t]||"",detail:e.detail}]}return[]},t.parseProductNode=void 0,t.productModelToNode=function(e){var t,n;const r=e.id?(0,a.wap)("id",null,e.id.toString()):void 0,c=e.description?(0,a.wap)("description",null,e.description):void 0,d=e.url?(0,a.wap)("url",null,e.url):void 0,u=e.retailerId?(0,a.wap)("retailer_id",null,e.retailerId):void 0,p=null!=e.priceAmount1000?(0,a.wap)("currency",null,e.currency):void 0,f=null!=e.priceAmount1000?(0,a.wap)("price",null,e.priceAmount1000.toString()):void 0,h=[(0,a.wap)("image",null,(0,a.wap)("url",null,e.imageCdnUrl))].concat(null===(t=e.additionalImageCdnUrl)||void 0===t?void 0:t.map((e=>(0,a.wap)("image",null,(0,a.wap)("url",null,e))))),_=function(e){var t,n,r,i,s,l;const{isExempt:c,hasCountryCodeOrigin:d,hasImporterName:u,hasImporterAddress:p}=(0,o.scanComplianceInfoForMissingData)(e);return!c&&(d||u||p)?(0,a.wap)("compliance_info",null,d?(0,a.wap)("country_code_origin",null,null==e?void 0:e.countryCodeOrigin):void 0,u?(0,a.wap)("importer_name",null,null==e?void 0:e.importerName):void 0,p?(0,a.wap)("importer_address",null,(null==e||null===(t=e.importerAddress)||void 0===t?void 0:t.street1)?(0,a.wap)("street1",null,e.importerAddress.street1):void 0,(null==e||null===(n=e.importerAddress)||void 0===n?void 0:n.street2)?(0,a.wap)("street2",null,e.importerAddress.street2):void 0,(null==e||null===(r=e.importerAddress)||void 0===r?void 0:r.city)?(0,a.wap)("city",null,e.importerAddress.city):void 0,(null==e||null===(i=e.importerAddress)||void 0===i?void 0:i.region)?(0,a.wap)("region",null,e.importerAddress.region):void 0,(null==e||null===(s=e.importerAddress)||void 0===s?void 0:s.postalCode)?(0,a.wap)("postal_code",null,e.importerAddress.postalCode):void 0,(null==e||null===(l=e.importerAddress)||void 0===l?void 0:l.countryCode)?(0,a.wap)("country_code",null,e.importerAddress.countryCode):void 0):void 0):void 0}(e.complianceInfo),g=(0,i.default)({is_hidden:e.isHidden?"true":"false"},(null===(n=e.complianceInfo)||void 0===n?void 0:n.countryCodeOrigin)===String(s.SyntheticCountryCode.NotApplicable)?{compliance_category:l.ProductComplianceCategory.CountryOriginExempt}:void 0);return(0,a.wap)("product",g,r,(0,a.wap)("name",null,e.name),c,d,u,(0,a.wap)("media",null,h),f,p,_)};var i=r(n(81109)),a=n(31914),o=n(83657),s=n(9978),l=n(6822);t.parseProductNode=e=>{var t,n,r;const a=e.child("id").contentString(),o=e.maybeChild("url");let c="";o&&o.hasContent()&&(c=o.contentString());const d=e.child("name").contentString(),u=null!==(t=e.maybeAttrString("availability"))&&void 0!==t?t:l.ProductAvailability.UNKNOWN,p=e.maybeChild("description"),f=p?p.contentString():"",h=e.maybeChild("belongs_to"),_="true"===(null==h?void 0:h.contentString())||!1,g=[],m=[],y=[],E=e.child("media");let S=!0;E.forEachChildWithTag("image",(e=>{if(S)S=!1,g.push({key:"requested",value:e.child("request_image_url").contentString()}),g.push({key:"full",value:e.child("original_image_url").contentString()}),y.push(e.child("id").contentString());else{const t=[];t.push({key:"requested",value:e.child("request_image_url").contentString()}),t.push({key:"full",value:e.child("original_image_url").contentString()}),m.push(t),y.push(e.child("id").contentString())}}));const v=e.maybeChild("status_info"),T=(null==v?void 0:v.child("status").contentString())||"APPROVED",b=null==v||null===(n=v.maybeChild("can_appeal"))||void 0===n?void 0:n.contentString(),C=e.maybeChild("currency"),A=C?C.contentString():void 0,P=e.maybeChild("price"),M=null==P?void 0:P.contentString(),O=e.maybeChild("retailer_id"),I=O?O.contentString():"",w=!!e.hasAttr("is_hidden")&&"true"===e.attrString("is_hidden"),R=e.hasAttr("compliance_category")?l.ProductComplianceCategory.cast(e.attrString("compliance_category")):l.ProductComplianceCategory.Default,D=e.maybeChild("sale_price"),L=D?(0,i.default)({sale_price:null===(r=D.maybeChild("price"))||void 0===r?void 0:r.contentString()},D.hasChild("start_date")&&D.hasChild("end_date")?{sale_start_date:D.child("start_date").contentString(),sale_end_date:D.child("end_date").contentString()}:null):null,N=(0,i.default)({id:a,is_hidden:w,url:c,name:d,description:f,availability:u,additional_image_cdn_urls:m,image_cdn_urls:g,capability_to_review_status:[{key:"WHATSAPP",value:T}],whatsapp_product_can_appeal:"true"===b,image_hashes_for_whatsapp:y,currency:A,price:M,retailer_id:I,checkmark:_},L),k=e.maybeChild("compliance_info");return R===l.ProductComplianceCategory.CountryOriginExempt?N.compliance_info={country_code_origin:String(s.SyntheticCountryCode.NotApplicable)}:k&&(N.compliance_info=function(e){var t;const n=e.child("country_code_origin").contentString(),r=null===(t=e.maybeChild("importer_name"))||void 0===t?void 0:t.contentString(),i=e.maybeChild("importer_address"),a={country_code_origin:n,importer_name:r};var o,s,l;i&&(a.importer_address={street1:i.child("street1").contentString(),street2:null===(o=i.maybeChild("street2"))||void 0===o?void 0:o.contentString(),postal_code:null===(s=i.maybeChild("postal_code"))||void 0===s?void 0:s.contentString(),city:i.child("city").contentString(),region:null===(l=i.maybeChild("region"))||void 0===l?void 0:l.contentString(),country_code:i.child("country_code").contentString()});return a}(k)),N}},53069:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.parseProductGraphQL=function(e){var t,n,r,u,p,f,h,_;let{status_info:g,sale_price:m,availability:y,compliance_info:E}=e,S=(0,a.default)(e,c);const[v,...T]=null!==(t=null===(n=S.media)||void 0===n?void 0:n.images)&&void 0!==t?t:[],b=(0,i.default)((0,i.default)({id:(0,o.default)(S.id,"product.id"),retailer_id:null!==(r=S.retailer_id)&&void 0!==r?r:"",name:(0,o.default)(S.name,"product.name"),description:null!==(u=S.description)&&void 0!==u?u:"",url:null!==(p=S.url)&&void 0!==p?p:"",currency:S.currency,price:S.price,is_hidden:"ISHIDDEN_TRUE"===S.is_hidden,availability:y&&y in d?d[y]:l.ProductAvailability.UNKNOWN},null!=(null==m?void 0:m.price)?(0,i.default)({sale_price:m.price},null!=m.start_date&&null!=m.end_date?{sale_start_date:m.start_date,sale_end_date:m.end_date}:null):null),{},{checkmark:"true"===S.belongs_to,image_hashes_for_whatsapp:(null!==(f=null===(h=S.media)||void 0===h?void 0:h.images)&&void 0!==f?f:[]).map((e=>(0,o.default)(e.id,"img.id"))),image_cdn_urls:v?[{key:"requested",value:(0,o.default)(v.request_image_url,"firstImage.request_image_url")},{key:"full",value:(0,o.default)(v.original_image_url,"firstImage.original_image_url")}]:[],additional_image_cdn_urls:T.map((e=>[{key:"requested",value:(0,o.default)(e.request_image_url,"img.request_image_url")},{key:"full",value:(0,o.default)(e.original_image_url,"img.original_image_url")}])),whatsapp_product_can_appeal:"true"===(null==g?void 0:g.can_appeal),capability_to_review_status:[{key:"WHATSAPP",value:null!==(_=null==g?void 0:g.status)&&void 0!==_?_:"APPROVED"}]});if(null!=E){var C,A,P,M,O;const{importer_address:e}=E;b.compliance_info="COMPLIANCECATEGORY_COUNTRYORIGINEXEMPT"===S.compliance_category?{country_code_origin:s.SyntheticCountryCode.NotApplicable}:{country_code_origin:null!==(C=E.country_code_origin)&&void 0!==C?C:void 0,importer_name:null!==(A=E.importer_name)&&void 0!==A?A:void 0,importer_address:{street1:(0,o.default)(null==e?void 0:e.street1,"importerAddress?.street1"),street2:null!==(P=null==e?void 0:e.street2)&&void 0!==P?P:void 0,postal_code:null!==(M=null==e?void 0:e.postal_code)&&void 0!==M?M:void 0,city:(0,o.default)(null==e?void 0:e.city,"importerAddress?.city"),region:null!==(O=null==e?void 0:e.region)&&void 0!==O?O:void 0,country_code:(0,o.default)(null==e?void 0:e.country_code,"importerAddress?.country_code")}}}return b};var i=r(n(81109)),a=r(n(6479)),o=r(n(45095)),s=(n(1321),n(9978)),l=n(6822);const c=["status_info","sale_price","availability","compliance_info"];const d={AVAILABILITY_INSTOCK:l.ProductAvailability.IN_STOCK,AVAILABILITY_OUTOFSTOCK:l.ProductAvailability.OUT_OF_STOCK}},17728:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return u.apply(this,arguments)};var i=r(n(48926)),a=n(31914),o=n(71914),s=n(92574),l=n(24747),c=n(57701);const d=new o.WapParser("visibilitySetResponse",(e=>{e.assertTag("iq"),e.assertFromServer()}));function u(){return(u=(0,i.default)((function*(e){if((0,c.commerceFeaturesDisabledBySanctions)())throw new s.E451;const t=(0,a.wap)("iq",{to:a.S_WHATSAPP_NET,type:"set",xmlns:"w:biz:catalog",smax_id:"23",id:(0,a.generateId)()},(0,a.wap)("product_visibility_update",{v:"1"},e.map((e=>(0,a.wap)("product",{is_hidden:e.isHidden?"true":"false"},(0,a.wap)("id",null,e.productId)))))),n=yield(0,l.sendIq)(t,d);if(n.success)return n.result;if(451===n.errorCode)throw new s.E451;throw new s.ServerStatusCodeError(n.errorCode)}))).apply(this,arguments)}},60323:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.appealCollection=function(){return A.apply(this,arguments)},t.createCollection=function(){return S.apply(this,arguments)},t.deleteCollection=function(){return T.apply(this,arguments)},t.editCollection=function(){return b.apply(this,arguments)},t.parseCollectionStatusInfoNode=void 0,t.queryCollections=function(){return _.apply(this,arguments)},t.querySingleCollectionIQ=void 0;var i=r(n(48926)),a=n(31914),o=n(71914),s=n(92574),l=n(24747),c=n(57701),d=n(90667),u=n(39410);const p=e=>{var t,n,r;return{status:e.child("status").contentString(),canAppeal:"true"===(null===(t=e.maybeChild("can_appeal"))||void 0===t?void 0:t.contentString().toLowerCase()),rejectReason:null===(n=e.maybeChild("reject_reason"))||void 0===n?void 0:n.contentString(),commerceUrl:null===(r=e.maybeChild("commerce_url"))||void 0===r?void 0:r.contentString()}};t.parseCollectionStatusInfoNode=p;const f=e=>{var t;const n=e.maybeChild("status_info"),r=n?p(n):void 0,i=(null==r?void 0:r.status)||"APPROVED",a=!!r&&r.canAppeal,o={id:e.child("id").contentString(),name:e.child("name").contentString(),isHidden:"TRUE"===(null===(t=e.maybeChild("is_hidden"))||void 0===t?void 0:t.contentString()),rejectReason:null==r?void 0:r.rejectReason,commerceUrl:null==r?void 0:r.commerceUrl,totalItemsCount:0,products:[],reviewStatus:i,canAppeal:a};return e.forEachChildWithTag("product",(e=>{o.products.push((0,d.parseProductNode)(e))})),o},h=new o.WapParser("collectionsResponse",(e=>{e.assertTag("iq"),e.assertFromServer();const t=e.child("collections"),n=[];t.forEachChildWithTag("collection",(e=>{n.push(f(e))}));const r=t.child("paging").child("after"),i=r.hasContent()?r.contentString():"";return{collections:n,afterCursor:i}}));function _(){return(_=(0,i.default)((function*(e,t,n,r,i,o){let d=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;if((0,c.commerceFeaturesDisabledBySanctions)())throw new s.E451;const p=t?(0,a.wap)("after",null,t):void 0,f=(0,a.wap)("iq",{to:a.S_WHATSAPP_NET,type:"get",xmlns:"w:biz:catalog",id:(0,a.generateId)(),smax_id:"35"},(0,a.wap)("collections",{biz_jid:(0,u.DEVICE_JID)(e)},(0,a.wap)("collection_limit",null,n.toString()),(0,a.wap)("item_limit",null,r.toString()),(0,a.wap)("width",null,i.toString()),(0,a.wap)("height",null,o.toString()),p,d?(0,a.wap)("direct_connection_encrypted_info",null,d):null)),_=yield(0,l.sendIq)(f,h);if(_.success)return _.result;if(404===_.errorCode)return{collections:[],afterCursor:""};if(451===_.errorCode)throw new s.E451;throw new s.ServerStatusCodeError(_.errorCode)}))).apply(this,arguments)}const g=new o.WapParser("singleCollectionResponse",(e=>{e.assertTag("iq"),e.assertFromServer();const t=e.child("collection"),n=f(t),r=t.child("paging").child("after");return{collections:[n],afterCursor:r.hasContent()?r.contentString():""}})),m=function(){var e=(0,i.default)((function*(e){let{catalogWid:t,collectionId:n,afterCursor:r,limit:i,width:o,height:d,directConnectionEncryptedInfo:p=null}=e;if((0,c.commerceFeaturesDisabledBySanctions)())throw new s.E451;const f=r?(0,a.wap)("after",null,r):void 0,h=(0,a.wap)("iq",{to:a.S_WHATSAPP_NET,type:"get",xmlns:"w:biz:catalog",id:(0,a.generateId)(),smax_id:"30"},(0,a.wap)("collection",{biz_jid:(0,u.DEVICE_JID)(t),id:(0,a.CUSTOM_STRING)(n)},(0,a.wap)("limit",null,i.toString()),(0,a.wap)("width",null,o.toString()),(0,a.wap)("height",null,d.toString()),f,p?(0,a.wap)("direct_connection_encrypted_info",null,p):null)),_=yield(0,l.sendIq)(h,g);if(_.success)return _.result;if(451===_.errorCode)throw new s.E451;throw new s.ServerStatusCodeError(_.errorCode)}));return function(){return e.apply(this,arguments)}}();t.querySingleCollectionIQ=m;const y=new o.WapParser("createOrEditCollectionResponse",(e=>{e.assertTag("iq"),e.assertFromServer();const t=e.child("collection"),n=t.child("id").contentString(),r=t.maybeChild("status_info");return{id:n,reviewStatus:r?p(r).status:"APPROVED"}})),E=new o.WapParser("createOrEditCollectionResponseErrorParser",(e=>{const t=e.attrString("code"),n=e.attrString("text"),r=e.maybeChild("field");return{code:t,text:n,fieldName:null==r?void 0:r.attrString("name"),fieldReason:null==r?void 0:r.attrString("reason")}}));function S(){return(S=(0,i.default)((function*(e,t,n){if((0,c.commerceFeaturesDisabledBySanctions)())throw new s.E451;const r=[];r.push((0,a.wap)("name",null,e)),r.push(...t.map((e=>(0,a.wap)("product",null,(0,a.wap)("id",null,e))))),r.push((0,a.wap)("catalog_session_id",null,n));const i=(0,a.wap)("iq",{to:a.S_WHATSAPP_NET,type:"set",xmlns:"w:biz:catalog",id:(0,a.generateId)(),smax_id:"36"},(0,a.wap)("collection",{op:"create"},r)),o=yield(0,l.sendIqErrorParser)(i,y,E);if(o.success)return o.result;if(451===o.errorCode)throw new s.E451;throw o.customError}))).apply(this,arguments)}const v=new o.WapParser("deleteCollectionResponse",(e=>{e.assertTag("iq");const t=e.maybeChild("response");return null!=(null==t?void 0:t.maybeChild("success"))}));function T(){return(T=(0,i.default)((function*(e,t){if((0,c.commerceFeaturesDisabledBySanctions)())throw new s.E451;const n=(0,a.wap)("iq",{to:a.S_WHATSAPP_NET,type:"set",xmlns:"w:biz:catalog",id:(0,a.generateId)(),smax_id:"43"},(0,a.wap)("collections",{op:"delete"},(0,a.wap)("id",null,e),(0,a.wap)("catalog_session_id",null,t))),r=yield(0,l.sendIq)(n,v);if(!r.success){if(451===r.errorCode)throw new s.E451;throw new s.ServerStatusCodeError(r.errorCode)}if(!r.result)throw new s.ServerStatusCodeError(500)}))).apply(this,arguments)}function b(){return(b=(0,i.default)((function*(e,t,n,r,i,o){if((0,c.commerceFeaturesDisabledBySanctions)())throw new s.E451;const d=(0,a.wap)("iq",{to:a.S_WHATSAPP_NET,type:"set",xmlns:"w:biz:catalog",id:(0,a.generateId)(),smax_id:"40"},(0,a.wap)("collection",{op:"update"},(0,a.wap)("id",null,e),t?(0,a.wap)("name",null,t):void 0,r.length>0?(0,a.wap)("add",null,r.map((e=>(0,a.wap)("id",null,e)))):void 0,i.length>0?(0,a.wap)("remove",null,i.map((e=>(0,a.wap)("id",null,e)))):void 0,(0,a.wap)("catalog_session_id",null,o))),u=yield(0,l.sendIqErrorParser)(d,y,E);if(u.success)return u.result;if(451===u.errorCode)throw new s.E451;throw u.customError}))).apply(this,arguments)}const C=new o.WapParser("appealCollectionResponse",(e=>{e.assertTag("iq"),e.assertFromServer();const t=e.maybeChild("response");return null!=(null==t?void 0:t.maybeChild("success"))}));function A(){return(A=(0,i.default)((function*(e,t){if((0,c.commerceFeaturesDisabledBySanctions)())throw new s.E451;const n=t?(0,a.wap)("reason",null,t):void 0,r=(0,a.wap)("iq",{id:(0,a.generateId)(),to:a.S_WHATSAPP_NET,xmlns:"w:biz:catalog",type:"set",smax_id:"48"},(0,a.wap)("collection",{op:"appeal",id:(0,a.CUSTOM_STRING)(e)},n)),i=yield(0,l.sendIq)(r,C);if(i.success)return i.result;if(451===i.errorCode)throw new s.E451;throw new s.ServerStatusCodeError(i.errorCode)}))).apply(this,arguments)}},92913:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.fetchAndUpdateBlocklist=function(){return g.apply(this,arguments)};var i=r(n(48926)),a=n(31914),o=n(71914),s=n(81663),l=n(73382),c=n(24747),d=n(37790),u=n(58052),p=n(64551);const f=new o.WapParser("blocklistParser",(e=>{const t={wids:[]};if(e.hasChild("error"))return function(e){const t=e&&e.maybeAttrString("code"),n=e&&e.maybeAttrString("text");__LOG__(3,void 0,void 0,!0)`getBlocklist error: code ${t} text ${n}`,SEND_LOGS("getBlocklist")}(e.child("error")),t;e.assertAttr("type","result");const n=e.maybeChild("list");if(n){const e=n.maybeAttrString("dhash");e&&(t.dhash=e),n.hasChild("item")&&(t.wids=n.mapChildrenWithTag("item",(e=>(0,s.deviceJidToUserWid)(e.attrPhoneDeviceJid("jid"))))||[])}return t}));function h(){return _.apply(this,arguments)}function _(){return(_=(0,i.default)((function*(){const e=(0,u.getBlocklistHash)(),t=(0,a.wap)("iq",{xmlns:"blocklist",to:a.S_WHATSAPP_NET,type:"get",id:(0,a.generateId)()},e?(0,a.wap)("item",{dhash:(0,a.CUSTOM_STRING)(e)}):null),n=yield(0,c.sendIq)(t,f);if(!n.success){const{errorCode:e,errorText:t}=n;return __LOG__(3)`fetchBlocklist: failed ${e}, ${t}`,{errorCode:e,errorText:t}}return n.result?n.result:Promise.reject(new Error("response does not have blocked list"))}))).apply(this,arguments)}function g(){return(g=(0,i.default)((function*(){const e=p.ServerProps.mdBlocklistV2?h:d.getBlocklist;__LOG__(2)`[blocklist] fetch blocklist using blocklist ${p.ServerProps.mdBlocklistV2?"v2":"v1"}`;const t=yield e();return null!=t.errorCode||(t.dhash?(__LOG__(2)`[blocklist] updating blocklist with ${t.wids.length||0} contact(s)`,(0,u.setBlocklistHash)(t.dhash),yield(0,l.updateBlocklist)(t.wids)):__LOG__(2)`[blocklist] no change in blocklist, skip update`),t}))).apply(this,arguments)}},87117:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.queryBusinessCategories=function(){return d.apply(this,arguments)};var i=r(n(48926)),a=n(31914),o=n(71914),s=n(92574),l=n(24747);const c=new o.WapParser("businessCategoriesResponse",(e=>{e.assertTag("iq"),e.assertFromServer();const t=e.child("response"),n=[];let r="";try{const e=t.maybeChild("not_a_biz");null==e||e.forEachChildWithTag("category",(e=>{r=e.attrString("id")}));t.child("categories").forEachChildWithTag("category",(e=>{const t=e.attrString("id"),i=e.contentString();n.push({id:t,localized_display_name:i,not_a_biz:!!r.length&&t===r})}))}catch(e){}return{categories:n,notABizId:r}}));function d(){return(d=(0,i.default)((function*(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=t?"profile_typeahead":"typeahead",r=(0,a.wap)("iq",{to:a.S_WHATSAPP_NET,xmlns:"fb:thrift_iq",id:(0,a.generateId)(),type:"get"},(0,a.wap)("request",{op:(0,a.CUSTOM_STRING)(n),type:"catkit",v:"1"},(0,a.wap)("query",null,e))),i=yield(0,l.sendIq)(r,c);if(i.success)return i.result;throw new s.ServerStatusCodeError(i.errorCode)}))).apply(this,arguments)}},63638:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return f.apply(this,arguments)};var i=r(n(48926)),a=n(31914),o=n(71914),s=n(92574),l=n(81663),c=n(24747),d=r(n(76199)),u=n(39410);const p=new o.WapParser("businessProfileResponse",(e=>{e.assertTag("iq"),e.assertFromServer();const t=e.child("business_profile"),n=[];return t.forEachChildWithTag("profile",(e=>{const t=(0,l.jidWithTypeToWid)(e.attrJidWithType("jid")),r=e.attrString("tag"),i=(0,d.default)(e);Object.keys(i).length?n.push({wid:t,tag:r,profile:i}):n.push({wid:t,tag:r})})),n}));function f(){return(f=(0,i.default)((function*(e,t){const n=(0,a.wap)("iq",{to:a.S_WHATSAPP_NET,xmlns:"w:biz",id:(0,a.generateId)(),type:"get"},(0,a.wap)("business_profile",{v:(0,a.INT)(t)},e.map((e=>(0,a.wap)("profile",{jid:(0,u.USER_JID)(e.wid),tag:null!=e.tag?(0,a.INT)(e.tag):a.DROP_ATTR}))))),r=yield(0,c.sendIq)(n,p);if(r.success)return r.result;throw new s.ServerStatusCodeError(r.errorCode)}))).apply(this,arguments)}},43077:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i,a=r(n(48926)),o=r(n(58819)),s=n(31914),l=n(71914),c=n(92574),d=n(48089),u=n(1321),p=n(23216),f=n(24747),h=n(57701),_=n(90667),g=n(53069),m=n(39410);const y=new l.WapParser("catalogResponse",(e=>{e.assertTag("iq"),e.assertFromServer();const t=e.child("product_catalog"),n=[];t.forEachChildWithTag("product",(e=>{e.maybeChild("id")&&n.push((0,_.parseProductNode)(e))}));const r=t.child("paging"),i=r.child("before"),a=i.hasContent()?i.contentString():"",o=r.child("after"),s=o.hasContent()?o.contentString():"";return{data:n,paging:{cursors:{after:s,before:a}}}}));const E=function(){var e=(0,a.default)((function*(e){let{catalogWid:t,afterCursor:n,limit:r,width:i,height:a,checkmarkCollectionId:o,allowShopSource:l,directConnectionEncryptedInfo:d=null}=e;if((0,h.commerceFeaturesDisabledBySanctions)())throw new c.E451;const u=n?(0,s.wap)("after",null,n):void 0,p=o?(0,s.wap)("belongs_to",null,(0,s.wap)("collection_id",null,o)):void 0,_=(0,s.wap)("iq",{to:s.S_WHATSAPP_NET,type:"get",xmlns:"w:biz:catalog",id:(0,s.generateId)()},(0,s.wap)("product_catalog",{jid:(0,m.DEVICE_JID)(t),allow_shop_source:(g=l,g?"true":"false")},(0,s.wap)("limit",null,r.toString()),(0,s.wap)("width",null,i.toString()),(0,s.wap)("height",null,a.toString()),u,p,d?(0,s.wap)("direct_connection_encrypted_info",null,d):null));var g;const E=yield(0,f.sendIq)(_,y);if(E.success)return E.result;if(451===E.errorCode)throw new c.E451;throw new c.ServerStatusCodeError(E.errorCode)}));return function(){return e.apply(this,arguments)}}(),S=function(){var e=(0,a.default)((function*(e){if((0,h.commerceFeaturesDisabledBySanctions)())throw new c.E451;try{var t,r,a;const{catalogWid:o,afterCursor:s,limit:l,width:c,height:d,checkmarkCollectionId:f,allowShopSource:h,directConnectionEncryptedInfo:_}=e,m=yield(0,u.fetchQuery)(void 0!==i?i:i=n(25173),{request:{product_catalog:{jid:o.toString(),allow_shop_source:h?"ALLOWSHOPSOURCE_TRUE":"ALLOWSHOPSOURCE_FALSE",width:String(c),height:String(d),direct_connection_encrypted_info:_,limit:String(l),after:s,catalog_session_id:f}}},{eventLogger:(0,p.createCatalogEventLogger)(p.GRAPHQL_CATALOG_ENDPOINT.GET_CATALOG)}),{paging:y,products:E}=(null==m||null===(t=m.xwa_product_catalog_get_product_catalog)||void 0===t?void 0:t.product_catalog)||{};return{data:E.map(g.parseProductGraphQL),paging:{cursors:{before:null!==(r=null==y?void 0:y.before)&&void 0!==r?r:"",after:null!==(a=null==y?void 0:y.after)&&void 0!==a?a:""}}}}catch(t){return t instanceof d.GraphQLServerError?(0,o.default)(t,(()=>E(e)),"xwa_product_catalog_get_product_catalog"):E(e)}}));return function(){return e.apply(this,arguments)}}();var v=e=>((0,h.graphQLForCatalogM1Enabled)()?S:E)(e);t.default=v},27678:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i,a=r(n(48926)),o=r(n(58819)),s=r(n(45095)),l=n(31914),c=n(71914),d=n(92574),u=n(48089),p=n(1321),f=(r(n(99805)),n(23216)),h=n(24747),_=n(57701),g=n(90667),m=n(53069),y=n(39410);const E=new c.WapParser("productResponse",(e=>{e.assertTag("iq"),e.assertFromServer();const t=e.child("product_catalog").child("product");return(0,g.parseProductNode)(t)})),S=function(){var e=(0,a.default)((function*(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;if((0,_.commerceFeaturesDisabledBySanctions)())throw new d.E451;const o=(0,l.wap)("iq",{to:l.S_WHATSAPP_NET,type:"get",xmlns:"w:biz:catalog",id:(0,l.generateId)()},(0,l.wap)("product",{jid:(0,y.DEVICE_JID)(e)},(0,l.wap)("product_id",null,t),(0,l.wap)("width",null,n.toString()),(0,l.wap)("height",null,r.toString()),i?(0,l.wap)("fetch_compliance_info",null,i.toString()):void 0,a?(0,l.wap)("direct_connection_encrypted_info",null,a):null)),s=yield(0,h.sendIq)(o,E);if(s.success)return{data:s.result};if(404===s.errorCode)return{error:"NOT_FOUND"};throw 451===s.errorCode?new d.E451:new d.ServerStatusCodeError(s.errorCode)}));return function(){return e.apply(this,arguments)}}(),v=function(){var e=(0,a.default)((function*(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];if((0,_.commerceFeaturesDisabledBySanctions)())throw new d.E451;const[a,l,c,h,g=!1,y=null]=t;try{var E,v;const e=yield(0,p.fetchQuery)(void 0!==i?i:i=n(79341),{request:{product:{jid:a.toString(),product_id:l,width:String(c),height:String(h),fetch_compliance_info:String(g),direct_connection_encrypted_info:y}}},{eventLogger:(0,f.createCatalogEventLogger)(f.GRAPHQL_CATALOG_ENDPOINT.GET_PRODUCT)}),t=(0,s.default)(null==e||null===(E=e.xwa_product_catalog_get_product)||void 0===E||null===(v=E.product_catalog)||void 0===v?void 0:v.product,"data?.xwa_product_catalog_get_product?.product_catalog?.product");return{data:(0,m.parseProductGraphQL)(t)}}catch(e){if(e instanceof u.GraphQLServerError){var T;const[n]=(null===(T=e.source)||void 0===T?void 0:T.errors)||[];return 2498052===(null==n?void 0:n.code)?{error:"NOT_FOUND"}:(0,o.default)(e,(()=>S(...t)),"xwa_product_catalog_get_product")}return S(...t)}}));return function(){return e.apply(this,arguments)}}();var T=function(){return((0,_.graphQLForCatalogM1Enabled)()?v:S)(...arguments)};t.default=T},99192:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.queryDisappearingMode=function(){return d.apply(this,arguments)};var i=r(n(48926)),a=n(31914),o=n(71914),s=n(92574),l=n(24747);const c=new o.WapParser("dmParser",(e=>{const t=e.child("disappearing_mode");return{duration:t.attrInt("duration"),t:t.attrInt("t")}}));function d(){return(d=(0,i.default)((function*(){const e=(0,a.wap)("iq",{xmlns:"disappearing_mode",to:a.S_WHATSAPP_NET,type:"get",id:(0,a.generateId)()}),t=yield(0,l.sendIq)(e,c);if(!t.success)throw new s.ServerStatusCodeError(t.errorCode);return t.result}))).apply(this,arguments)}},71820:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.queryExist=function(){return c.apply(this,arguments)};var i=r(n(48926)),a=n(92574),o=n(41566),s=n(79942),l=n(52284);function c(){return(c=(0,i.default)((function*(e){const t=(new l.USyncQuery).withContactProtocol();t.withUser((new s.USyncUser).withPhone(e)),t.withBusinessProtocol(),(0,o.isDisappearingModeEnabled)()&&t.withDisappearingModeProtocol();const n=yield t.execute(),r=n.error.all||n.error.contact;if(r)return Promise.reject(new a.ServerStatusCodeError(r.errorCode,r.errorText));const{list:i}=n;if(1===i.length){const{id:e,contact:t,business:n,disappearing_mode:r}=i[0];if(t&&"in"===t.type){const t={wid:e,biz:!!n,bizInfo:n};return r&&(t.disappearingMode={duration:r.duration,settingTimestamp:r.t}),t}}return null}))).apply(this,arguments)}},78518:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.mapParsedMediaConn=f,t.queryMediaConn=function(e){const t=new Date,n=(0,s.unixTime)(),r=(0,l.wap)("iq",{to:l.S_WHATSAPP_NET,xmlns:"w:m",type:"set",id:(0,l.generateId)()},(0,l.wap)("media_conn",null)),u=(0,d.sendIq)(r,a.mediaConnParser).then((e=>{if(e.success){__LOG__(2)`backend:queryMediaConn: got ${e.result.hosts.length} hosts`;const{auth:r,authTTL:a,ttl:o,hosts:s,maxBuckets:l}=f(e.result);if(!r||null==o||!s||0===s.length)throw __LOG__(2)`backend:queryMediaConnections: auth exists ${String(!!r)}`,__LOG__(2)`backend:queryMediaConnections: ttl exists ${String(!!o)}`,__LOG__(2)`backend:queryMediaConnections: hosts exists ${String(!!s)}`,s&&__LOG__(2)`backend:queryMediaConnections: hosts.length ${s.length}`,__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("backend:queryMediaConnections unexpected mediaConn"),new Error("Invalid mediaConn");return(0,i.default)({queryStartTime:t,auth:r,hosts:s,ttl:o-n,maxBuckets:l},null!=a?{authTTL:a-n}:null)}if(__LOG__(4,void 0,new Error,!0)`response: ${e.errorCode} ${e.errorText}`,SEND_LOGS("backend:queryMediaConn: fail"),507===e.errorCode)throw new c.E507(e.errorText,e.errorBackoff);throw new c.ServerStatusCodeError(e.errorCode,e.errorText)}));return(0,o.default)(u,e)};var i=r(n(81109)),a=n(48095),o=r(n(47259)),s=n(92844),l=n(31914),c=n(92574),d=n(24747);function u(e){switch(e){case"kyc-id":case"novi-image":case"novi-video":case"thumbnail-gif":case"ppic":return null;default:return e}}function p(e){return{hostname:e.domain,class:e.class,ips:[{ip4:e.ip4,ip6:e.ip6}]}}function f(e){var t,n;const r=e=>{const t=[],n=e.downloadable.map(u).filter(Boolean);n.length>0&&t.push({download:n});const r=e.uploadable.map(u).filter(Boolean);r.length>0&&t.push({upload:r});const i=e.downloadBuckets.map((e=>e.toString()));return null!=i&&i.length>0&&t.push({downloadBuckets:i}),t};return{hosts:e.hosts.map((e=>(0,i.default)((0,i.default)({},p(e)),{},{fallback:null!=e.fallback?p(e.fallback):void 0,type:e.isFallback?"fallback":"primary",rules:r(e)}))),auth:e.authToken,authTTL:null!==(t=e.authTTL)&&void 0!==t?t:void 0,ttl:e.authExpires,maxBuckets:null!==(n=e.maxBuckets)&&void 0!==n?n:void 0}}},25338:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.queryPrivacyDisallowedList=function(){return d.apply(this,arguments)};var i=r(n(48926)),a=n(31914),o=n(71914),s=n(81663),l=n(24747);n(61319);const c=new o.WapParser("getPrivacyDisallowedListParser",(e=>{const t=e.child("privacy").maybeChild("list");if(null==t)return{status:"match"};return{status:"mismatch",users:t.mapChildren((e=>(0,s.deviceJidToUserWid)(e.attrPhoneDeviceJid("jid")))),dhash:t.attrString("dhash")}}));function d(){return(d=(0,i.default)((function*(e){const t=(0,a.wap)("iq",{to:a.S_WHATSAPP_NET,type:"get",id:(0,a.generateId)(),xmlns:"privacy"},(0,a.wap)("privacy",null,(0,a.wap)("list",{name:(0,a.CUSTOM_STRING)(e),value:(0,a.CUSTOM_STRING)("contact_blacklist")}))),n=yield(0,l.sendIq)(t,c);if(n.success)return n.result;throw new Error("invalid response")}))).apply(this,arguments)}},4831:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getPrivacy=function(){return u.apply(this,arguments)};var i=r(n(48926)),a=n(31914),o=n(71914),s=n(68387),l=n(24747);function c(e,t){const n=t.maybeChild("error"),r=n&&n.maybeAttrString("code"),i=n&&n.maybeAttrString("text");__LOG__(3,void 0,void 0,!0)`getPrivacy error: ${e} code ${r} text ${i}`,SEND_LOGS("getPrivacy")}const d=new o.WapParser("privacyParser",(e=>{e.assertAttr("type","result");const t={};return e.child("privacy").forEachChildWithTag("category",(e=>{switch(e.attrString("name")){case"readreceipts":{const n=e.attrEnum("value",s.ALL_NONE_WITH_ERROR);"error"!==n?t.readReceipts=n:c("readreceipts",e);break}case"last":{const n=e.attrEnum("value",s.VISIBILITY_WITH_ERROR);"error"!==n?t.lastSeen=n:c("last",e);break}case"profile":{const n=e.attrEnum("value",s.VISIBILITY_WITH_ERROR);"error"!==n?t.profilePicture=n:c("profile",e);break}case"status":{const n=e.attrEnum("value",s.VISIBILITY_WITH_ERROR);"error"!==n?t.about=n:c("status",e);break}case"groupadd":{const n=e.attrEnum("value",s.VISIBILITY_WITH_ERROR);"error"!==n?t.groupAdd=n:c("groupadd",e);break}default:c("unknown type",e)}})),t}));function u(){return(u=(0,i.default)((function*(){const e=(0,a.wap)("iq",{xmlns:"privacy",to:a.S_WHATSAPP_NET,type:"get",id:(0,a.generateId)()},(0,a.wap)("privacy",null)),t=yield(0,l.sendIq)(e,d);if(t.success)return t.result;throw new Error("invalid response")}))).apply(this,arguments)}},89636:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i,a=r(n(48926)),o=n(92574),s=n(1321),l=n(60323),c=n(57701),d=n(53069);const u=function(){var e=(0,a.default)((function*(e){if((0,c.commerceFeaturesDisabledBySanctions)())throw new o.E451;try{var t;const{catalogWid:r,collectionId:a,afterCursor:o,limit:l,width:c,height:u,directConnectionEncryptedInfo:p}=e,f=yield(0,s.fetchQuery)(void 0!==i?i:i=n(6262),{request:{collection:{biz_jid:r.toString(),id:a,limit:String(l),after:o,width:String(c),height:String(u),direct_connection_encrypted_info:p}}}),{id:h,name:_,status_info:g,products:m,paging:y}=(null==f||null===(t=f.xwa_product_catalog_get_single_collection)||void 0===t?void 0:t.collection)||{};return{afterCursor:(null==y?void 0:y.after)||"",collections:[{id:h||"",name:_||"",canAppeal:"true"===(null==g?void 0:g.can_appeal),isHidden:!1,reviewStatus:(null==g?void 0:g.status)||"APPROVED",totalItemsCount:0,products:m.map(d.parseProductGraphQL),rejectReason:null==g?void 0:g.reject_reason,commerceUrl:null==g?void 0:g.commerce_url}]}}catch(t){return(0,l.querySingleCollectionIQ)(e)}}));return function(){return e.apply(this,arguments)}}();var p=function(){return((0,c.graphQLForCollectionM2Enabled)()?u:l.querySingleCollectionIQ)(...arguments)};t.default=p},66501:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){const e=(0,r.wap)("iq",{xmlns:"w",id:(0,r.generateId)(),type:"get",to:r.S_WHATSAPP_NET},(0,r.wap)("props",null));return(0,a.sendIq)(e,o)};var r=n(31914),i=n(71914),a=n(24747);const o=new i.WapParser("serverProps",(e=>{e.assertTag("iq"),e.assertAttr("from","s.whatsapp.net");const t=e.child("props"),n={serverPropsVersion:t.attrInt("version")};return t.forEachChildWithTag("prop",(e=>{switch(e.attrString("name")){case"web_ctwa_context_compose_enabled":n.ctwaContextCompose=1===e.attrInt("value");break;case"ctwa_context_enabled":n.ctwaContextRender=1===e.attrInt("value")?1:0;break;case"ephemeral_messages_allowed_values":n.ephemeralMessagesAllowedValues=e.attrString("value");break;case"frequently_forwarded_max":n.frequentlyForwardedMax=e.attrInt("value");break;case"frequently_forwarded_threshold":n.frequentlyForwardedThreshold=e.attrInt("value");break;case"web_gif_search":n.gifSearch=e.attrString("value");break;case"group_call_max_participants":n.groupCallMaxParticipants=e.attrInt("value",0);break;case"group_description_length":n.groupDescLength=e.attrInt("value");break;case"hfm_string_changes":n.hfmStringChanges=e.attrInt("value");break;case"image_max_edge":n.imageMaxEdge=e.attrInt("value");break;case"image_max_kbytes":n.imageMaxKBytes=e.attrInt("value");break;case"image_quality":n.imageQuality=e.attrInt("value")/100;break;case"max_participants":n.maxParticipants=e.attrInt("value");break;case"max_subject":n.maxSubject=e.attrInt("value");break;case"max_keys":n.maxKeys=e.attrInt("value");break;case"media":n.media=e.attrInt("value");break;case"multicast_limit_global":n.multicastLimitGlobal=e.attrInt("value");break;case"mute_always":n.muteAlways=e.attrInt("value");break;case"mms_media_key_ttl":n.mmsMediaKeyTTL=e.attrInt("value");break;case"wallpapers_v2":n.wallpapersV2=e.attrInt("value");break;case"web_shops_chat_header_button_enabled":n.webShopsChatHeaderButtonEnabled=1===e.attrInt("value",0);break;case"shops_hide_catalog_attachment_entrypoint":n.shopsHideCatalogAttachmentEntrypoint=1===e.attrInt("value",0);break;case"shops_header_dropdown_menu_item":n.shopsHeaderDropdownMenuItem=1===e.attrInt("value",0);break;case"shops_product_grid":n.shopsProductGrid=e.attrInt("value",0);break;case"mms_hot_content_timespan_in_seconds":n.mmsHotContentTimespan=e.attrInt("value");break;case"mms_vcache_aggregation_enabled":n.mmsVCacheAggregationEnabled=1===e.attrInt("value");break;case"mms_vcard_autodownload_size_kb":n.mmsVcardAutodownloadSizeKb=e.attrInt("value");break;case"product_media_attachments":n.productMediaAttachments=e.attrInt("value");break;case"status_video_max_duration":n.statusVideoMaxDuration=e.attrInt("value");break;case"syncd_inline_mutations_max_count":n.syncdInlineMutationsMaxCount=e.attrInt("value");break;case"syncd_patch_protobuf_max_size":n.syncdPatchProtobufMaxSize=e.attrInt("value");break;case"syncd_key_max_use_days":n.syncdKeyMaxUseDays=e.attrInt("value");break;case"syncd_wait_for_key_timeout_days":n.syncdWaitForKeyTimeoutDays=e.attrInt("value");break;case"syncd_additional_mutations":n.syncdAdditionalMutations=e.attrInt("value");break;case"syncd_sentinel_timeout_seconds":n.syncdSentinelTimeoutSeconds=e.attrInt("value");break;case"syncd_patch_device_index_included":n.syncdPatchDeviceIndexIncluded=1===e.attrInt("value");break;case"syncd_clear_chat_delete_chat_enabled":n.syncdClearChatDeleteChatEnabled=1===e.attrInt("value");break;case"md_pin_chat_enabled":n.syncdPinChatEnabled=1===e.attrInt("value");break;case"template_doc_mime_types":n.templateDocMimeTypes=e.attrInt("value");break;case"web_biz_profile_options":n.webBizProfileOptions=e.attrInt("value");break;case"web_biz_profile_v3":n.webBizProfileV3=1===e.attrInt("value");break;case"view_once_read":n.viewOnceRead=e.attrInt("value");break;case"view_once_write":n.viewOnceWrite=e.attrInt("value");break;case"vcard_as_document_size_kb":n.vcardAsDocumentSizeKb=e.attrInt("value");break;case"vcard_max_size_kb":n.vcardMaxSizeKb=e.attrInt("value");break;case"md_blocklist_v2":n.mdBlocklistV2=1===e.attrInt("value");break;case"web_download_document_thumb_mms_enabled":n.webDownloadDocumentThumbMmsEnabled=1===e.attrInt("value");break;case"web_download_status_thumb_mms_enabled":n.webDownloadStatusThumbMmsEnabled=1===e.attrInt("value");break;case"web_send_document_thumb_in_message_disabled":n.webSendDocumentThumbInMessageDisabled=1===e.attrInt("value");break;case"web_upload_document_thumb_mms_enabled":n.webUploadDocumentThumbMmsEnabled=1===e.attrInt("value");break;case"web_list_message":n.webListMessage=1===e.attrInt("value");break;case"web_voip_mac_os_min_version":n.webVoipMacOsMinVersion=e.attrString("value");break;case"web_voip_windows_os_min_version":n.webVoipWindowsOsMinVersion=e.attrString("value");break;case"web_cart_v1_1_order_message_changes_enabled":n.webCartV11OrderMessageChanges=1===e.attrInt("value");break;case"mms_cat_v1_forward_hot_override_enabled":n.mmsCatV1ForwardHotOverrideEnabled=1===e.attrInt("value");break;case"web_buttons_message_enabled":n.webButtonsMessage=1===e.attrInt("value");break;case"web_product_list_message_fallback":n.webProductListMessageFallback=1===e.attrInt("value");break;case"web_product_list_message_render_kill_switch":n.webProductListMessageRenderKillSwitch=1===e.attrInt("value");break;case"web_smb_upsell_in_biz_profile_enabled":n.webSMBUpsellInBizProfile=1===e.attrInt("value");break;case"ptt_conversation_waveform":n.pttConversationWaveform=1===e.attrInt("value");break;case"ptt_oot_playback":n.pttOotPlayback=1===e.attrInt("value");break;case"ptt_forwarded_features_enabled":n.pttForwardedFeaturesEnabled=1===e.attrInt("value");break;case"ptt_pausable_enabled":n.pttPausableEnabled=1===e.attrInt("value");break;case"ptt_playback_speed_enabled":n.pttPlaybackSpeedEnabled=1===e.attrInt("value");break;case"ptt_playback_speed_hide_delay":n.pttPlaybackSpeedHideDelay=e.attrInt("value");break;case"web_product_list_message_page_size":n.webProductListMessagePageSize=e.attrInt("value");break;case"ptt_remember_play_position":n.pttRememberPlayPosition=1===e.attrInt("value");break;case"ptt_waveform_send":n.pttWaveformSend=1===e.attrInt("value");break;case"web_youtube_player_enhancements":n.webYouTubePlayerEnhancements=1===e.attrInt("value");break;case"web_server_sticker_panel":n.webServerStickerPanel=e.attrInt("value");break;case"web_collections_display_enabled":n.webCollectionsDisplay=1===e.attrInt("value");break;case"web_cart_on_off":n.webCartOnOffToggle=1===e.attrInt("value");break;case"web_product_list_message_enabled":n.webProductListMessage=1===e.attrInt("value");break;case"web_media_auto_download_enabled":n.webMediaAutoDownloadEnabled=1===e.attrInt("value");break;case"download_host_switching_enabled":n.downloadHostSwitchingEnabled=1===e.attrInt("value");break;case"upload_host_switching_enabled":n.uploadHostSwitchingEnabled=1===e.attrInt("value");break;case"web_is_direct_connection_for_plm_transparent":n.isDirectConnectionForPLMTransparent=1===e.attrInt("value");break;case"web_pip_redesign":n.webPipRedesign=1===e.attrInt("value");break;case"max_electron_file_size":n.maxElectronFileSize=e.attrInt("value");break;case"max_file_size":n.maxFileSize=e.attrInt("value");break;case"web_sticker_maker":n.stickerMaker=1===e.attrInt("value");break;case"web_md_migration_experience":n.webMdMigrationExperience=1===e.attrInt("value");break;case"web_log_upload_download_crashes":n.webLogUploadDownloadCrashes=1===e.attrInt("value");break;case"web_large_files_ui":n.webLargeFilesUi=1===e.attrInt("value");break;case"web_graphql_for_catalog_m1":n.webGraphQLForCatalogM1=1===e.attrInt("value");break;case"web_md_mms_sync_deletion_request":n.webMdMmsSyncDeletionRequest=1===e.attrInt("value");break;case"web_payment_background_enabled":n.webPaymentBackgroundEnabled=1===e.attrInt("value");break;case"web_forwarding_limit_to_groups":n.webForwardingLimitToGroups=1===e.attrInt("value");break;case"streaming_upload_chunk_size":n.streamingUploadChunkSize=e.attrInt("value")}})),n}))},74727:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.RECEIPT_TYPE=t.RECEIPT_MSG_TYPE=void 0,t.sendAggregateReceipts=function(){return _.apply(this,arguments)};var i=r(n(81109)),a=r(n(48926)),o=n(31914),s=n(71914),l=n(68387),c=n(24747),d=n(99234),u=n(39410);const p=Object.freeze({INACTIVE:"inactive",SENDER:"sender",DELIVERY:"delivery",READ:"read",READ_SELF:"read-self",PLAYED:"played",PLAYED_SELF:"played-self",HISTORY_SYNC_COMPLETION:"hist_sync",SERVER_ERROR:"server-error",PEER_MSG:"peer_msg"});t.RECEIPT_TYPE=p;const f=Object.freeze({PEER:"peer"});t.RECEIPT_MSG_TYPE=f;const h=new s.WapParser("readReceiptAckParser",(e=>(e.assertTag("ack"),{readReceipts:e.hasAttr("readreceipts")?e.attrEnum("readreceipts",l.ALL_NONE):null})));function _(){return(_=(0,a.default)((function*(e,t,n,r,s,l){const f=t===p.READ||t===p.PLAYED||t===p.READ_SELF||t===p.PLAYED_SELF||t===p.HISTORY_SYNC_COMPLETION;yield Promise.all(Array.from(r.keys()).map((_=>{const g=r.get(_);if(!g||0===g.length)return;const m=e.isUser()?null:_,y=[];for(;g.length>0;){const r=g.splice(0,256);let _=null;r.length>1&&(_=(0,o.wap)("list",null,r.slice(1).map((e=>(0,o.wap)("item",{id:(0,o.CUSTOM_STRING)(e)})))));const E=(0,o.wap)("receipt",{to:(0,u.JID)(e),type:t===p.DELIVERY?o.DROP_ATTR:(0,o.CUSTOM_STRING)(t),msgtype:l?(0,o.CUSTOM_STRING)(l):o.DROP_ATTR,id:(0,o.CUSTOM_STRING)(r[0]),t:null!=n?(0,o.CUSTOM_STRING)(n):o.DROP_ATTR,participant:m?(0,u.DEVICE_JID)(m):o.DROP_ATTR,recipient:s?(0,u.USER_JID)(s):o.DROP_ATTR},_);if(f){const n=function(){var n=(0,a.default)((function*(){const n={id:r[0],from:e,class:"receipt",type:t,participant:m};if(t!==p.READ&&t!==p.READ_SELF)return(0,c.sendStanzaAndWaitForAck)(E,n);{const e=yield(0,c.sendStanzaAndReturnAck)(E,n),t=h.parse(e);if(t.error)__LOG__(4,void 0,new Error,!0)`[messaging] sendAggregateReceipts: Invalid ack from server`,SEND_LOGS("Invalid-Receipt-Ack");else{const{readReceipts:e}=t.success;null!=e&&(0,d.setUserPrivacySettings)((0,i.default)((0,i.default)({},(0,d.getUserPrivacySettings)()),{},{readReceipts:e}))}}}));return function(){return n.apply(this,arguments)}}();y.push(n())}else y.push((0,c.castStanza)(E))}return Promise.all(y)})))}))).apply(this,arguments)}},16927:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendDeliveryReceiptsAfterDecryption=function(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5?arguments[5]:void 0;if((0,o.isLegacyWebdBackend)())return Promise.resolve();const s=y(),c=(0,u.assertGetMe)(),d=!c.getDeviceId(),p=t.isUser()&&(0,l.toUserWid)(c).equals((0,l.toUserWid)(t))||null!=r&&(0,l.toUserWid)(c).equals((0,l.toUserWid)(r)),_=a===f.MSG_TYPES.reaction,g=!_&&(p||s||d);let E=Promise.resolve();if(!g){const n={msgId:e,chatId:t.toString(),participantId:r?r.toString():null};E=(0,h.getInactiveReceiptTable)().createOrReplace(n)}return E.then((()=>{if(m(e,t,n,r,g,p,i),g)return(0,h.getInactiveReceiptTable)().remove(e)}))},t.sendDeliveryReceiptsAfterPresence=function(){if((0,o.isLegacyWebdBackend)())return Promise.resolve();return(0,h.getInactiveReceiptTable)().all().then(function(){var e=(0,i.default)((function*(e){const t=new Map,n=Date.now().toString();return e.forEach((e=>{const{msgId:n,chatId:r,participantId:i}=e,a=(0,l.createWid)(r),o=(i?(0,l.createWid)(i):null)||a;let s=t.get(a);s||(s=new Map,t.set(a,s));let c=s.get(o);c||(c=[],s.set(o,c)),c.push(n)})),yield Promise.all(Array.from(t.keys()).map((e=>{const r=t.get(e);if(r)return(0,_.sendAggregateReceipts)(e,_.RECEIPT_TYPE.DELIVERY,n,r)}))),(0,h.getInactiveReceiptTable)().bulkRemove(e.map((e=>e.msgId)))}));return function(){return e.apply(this,arguments)}}())};var i=r(n(48926)),a=n(31914),o=n(88555),s=n(72441),l=n(45454),c=n(79196),d=n(24747),u=n(99234),p=n(41796),f=n(12037),h=n(76214),_=n(74727),g=n(39410);function m(e,t,n,r,i,o,l){let u=a.DROP_ATTR;l?u=(0,a.CUSTOM_STRING)(_.RECEIPT_TYPE.PEER_MSG):o?u=(0,a.CUSTOM_STRING)(_.RECEIPT_TYPE.SENDER):i||(u=(0,a.CUSTOM_STRING)(_.RECEIPT_TYPE.INACTIVE));const p=(0,s.extractJidFromJidWithType)((0,c.widToJidWithType)(t)),f=(0,a.wap)("receipt",{id:(0,a.CUSTOM_STRING)(e),to:(0,a.JID)(p),participant:(t.isGroup()||t.isBroadcast())&&r?(0,g.DEVICE_JID)(r):a.DROP_ATTR,recipient:!l&&o&&n?(0,g.USER_JID)(n):a.DROP_ATTR,type:u});(0,d.castStanza)(f)}function y(){if((0,p.isConnectedToPage)()){return n(8080).Stream.available}return!1}},61426:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return d.apply(this,arguments)};var i=r(n(48926)),a=n(15688),o=n(31914),s=n(24747),l=n(98969),c=n(39410);function d(){return(d=(0,i.default)((function*(e,t,n){const r=(0,a.decodeB64)(n),{ciphertext:i,iv:d}=yield(0,l.encryptServerErrorReceipt)(r,t),u=(0,o.wap)("receipt",{type:"server-error",to:(0,c.USER_JID)(e),id:(0,o.CUSTOM_STRING)(t),category:"peer"},(0,o.wap)("encrypt",null,(0,o.wap)("enc_p",null,i),(0,o.wap)("enc_iv",null,d)));return(0,s.sendStanzaAndWaitForAck)(u,{id:t,class:"receipt",type:"server-error",from:e,participant:null})}))).apply(this,arguments)}},35099:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getReadReceiptType=S,t.markChatRead=function(){return v.apply(this,arguments)},t.markStatusRead=function(){return T.apply(this,arguments)},t.sendReactionReadReceipts=function(){return b.apply(this,arguments)};var i=r(n(48926)),a=n(52230),o=r(n(45095)),s=n(92844),l=n(35470),c=r(n(65212)),d=n(15461),u=n(68387),p=n(67811),f=n(45454),h=n(48285),_=n(99234),g=n(90981),m=n(63728),y=n(74727);const E=(0,f.createWid)(a.STATUS_JID);function S(e,t){return e.isStatusV3()&&null!=t&&t.isPSA()?y.RECEIPT_TYPE.READ_SELF:e.isGroup()?y.RECEIPT_TYPE.READ:(0,_.getUserPrivacySettings)().readReceipts===u.ALL_NONE.none?y.RECEIPT_TYPE.READ_SELF:y.RECEIPT_TYPE.READ}function v(){return(v=(0,i.default)((function*(e,t){const n=Date.now().toString(),r=String(e.id),i=yield(0,g.getTable)().equals(["from","pendingReadReceipt"],[r,1],{shouldDecrypt:!1});i.sort(((e,t)=>(e.rowId||0)-(t.rowId||0)));const a=t?String(t):null;let o=i.length-1;if(a){for(;o>=0&&i[o].id!==a;o--);o<0&&(o=i.length-1)}let s=null;const l=[];for(;o>=0;o--){const e=i[o];null!=e.rowId&&(null==s||e.rowId>s)&&(s=e.rowId);const t=c.default.fromString(e.id);if(e.type===d.MSG_TYPE.CIPHERTEXT){(0,m.viewPlaceHolderAction)(e);continue}e.type===d.MSG_TYPE.UNKNOWN&&"fanout"===e.subtype&&(0,m.viewPlaceHolderAction)(e);const n=e.broadcastId||e.from,r=e.author||e.from;l.push({id:t.id,sender:(0,f.createWidFromWidLike)(r),chat:(0,f.createWidFromWidLike)(n)})}const u=C(l);return yield Promise.all(Array.from(u.keys()).map((t=>{const r=u.get(t);if(!r)return;const i=S(e.id);return(0,y.sendAggregateReceipts)(t,i,n,r)}))),(0,h.markMessageAndChatAsRead)(s,r,!1)}))).apply(this,arguments)}function T(){return(T=(0,i.default)((function*(e,t){if("status"!==e.remote.user)return void __LOG__(3)`markStatusRead: message is not a status.`;if(e.fromMe)return;yield(0,y.sendAggregateReceipts)(E,S(E,(0,o.default)(e.participant,"msgKey.participant")),String(t),new Map([[(0,o.default)(e.participant,"msgKey.participant"),[e.id]]]));const n={ack:l.ACK.READ};e.participant&&e.participant.isPSA()&&(n.statusPSAReadTimestamp=t),yield(0,g.getTable)().merge(e.toString(),n)}))).apply(this,arguments)}function b(){return(b=(0,i.default)((function*(e){const t=String((0,s.unixTime)()),n=C(e.filter((e=>!(0,p.isReactionByMe)(e.senderUserJid))).map((e=>({chat:e.msgKey.remote,sender:(0,f.createWidFromWidLike)(e.senderUserJid),id:e.msgKey.id}))));yield Promise.all(Array.from(n.keys()).map((e=>{const r=n.get(e);if(r)return(0,y.sendAggregateReceipts)(e,y.RECEIPT_TYPE.READ_SELF,t,r)})))}))).apply(this,arguments)}function C(e){const t=new Map;return e.forEach((e=>{var n,r;let{chat:i,sender:a,id:o}=e;const s=null!==(n=t.get(i))&&void 0!==n?n:new Map,l=null!==(r=s.get(a))&&void 0!==r?r:[];l.push(o),s.set(a,l),t.set(i,s)})),t}},55253:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.prepareKeysForRetry=y,t.sendRetryReceipt=function(){return m.apply(this,arguments)};var i=r(n(48926)),a=n(31914),o=r(n(64369)),s=n(45454),l=n(46308),c=n(24747),d=n(53614),u=n(99234),p=n(58425),f=n(52083),h=n(11849),_=n(91335),g=n(39410);function m(){return(m=(0,i.default)((function*(e,t,n,r,i,o){let l=arguments.length>6&&void 0!==arguments[6]&&arguments[6];try{const p=(0,f.getSignalProtocolStore)(),[h,_]=yield Promise.all([p.getLocalRegistrationId(),p.getIdentityKeyPair()]);if(null==h||null==_)throw new Error("No registration info found");const m=yield y(e,(0,d.toCurveKeyPair)(_));let E,S,v=a.DROP_ATTR,T=a.DROP_ATTR;if(t.isUser()){if(S=a.DROP_ATTR,E=(0,g.DEVICE_JID)(t),(0,u.getMeUser)().equals((0,s.toUserWid)(t)))if(l)v=(0,a.CUSTOM_STRING)("peer"),T=a.DROP_ATTR;else{if(!r)return Promise.reject(new Error("sendRetryReceipt: send retry to peer device without receipient"));T=(0,g.USER_JID)(r)}}else E=(0,g.CHAT_JID)(t),S=n?(0,g.DEVICE_JID)(n):a.DROP_ATTR;const b=(0,a.wap)("receipt",{id:(0,a.CUSTOM_STRING)(i),to:E,participant:S,recipient:T,type:"retry",category:v},(0,a.wap)("retry",{v:"1",count:(0,a.INT)(e),id:(0,a.CUSTOM_STRING)(i),t:(0,a.CUSTOM_STRING)(o)}),(0,a.wap)("registration",null,(0,a.BIG_ENDIAN_CONTENT)(h)),m);return(0,c.sendStanzaAndWaitForAck)(b,{id:i,class:"receipt",from:t,participant:n,type:"retry"})}catch(e){__LOG__(4,void 0,new Error,!0)`error: ${e}`,SEND_LOGS("sendRetryReceipt: error while creating or sending the retry message")}}))).apply(this,arguments)}function y(){return E.apply(this,arguments)}function E(){return(E=(0,i.default)((function*(e,t){const[n,r]=yield S(e,t);return r&&(yield h.waSignalStore.markKeyAsUploaded(r.keyId),yield h.waSignalStore.markPreKeyAsDirectDistribution(r.keyId)),n}))).apply(this,arguments)}function S(){return v.apply(this,arguments)}function v(){return(v=(0,i.default)((function*(e,t){if(e<2)return Promise.resolve([null,null]);try{const[e,n,r]=yield Promise.all([h.waSignalStore.getSignedPreKey(),h.waSignalStore.getOrGenSinglePreKey(p.generatePreKeyPair),(0,l.getADVEncodedIdentity)().then((e=>(0,a.wap)("device-identity",null,e)))]);if(!e)throw new Error("Signed pre key is not available");return[(0,a.wap)("keys",null,(0,a.wap)("type",null,o.default.KEY_BUNDLE_TYPE),(0,a.wap)("identity",null,t.pubKey),(0,_.xmppPreKey)(n),(0,_.xmppSignedPreKey)(e),r),n]}catch(e){throw Error("Could not create keys section for retry")}}))).apply(this,arguments)}},27184:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return u.apply(this,arguments)};var i=r(n(48926)),a=n(15688),o=n(31914),s=n(24747),l=n(99234),c=n(98969),d=n(39410);function u(){return(u=(0,i.default)((function*(e){const t=e.id.id,n=(0,a.decodeB64)(e.mediaKey),{ciphertext:r,iv:i}=yield(0,c.encryptServerErrorReceipt)(n,t),{chat:u}=e,p=(0,o.CUSTOM_STRING)(u.id.toString({legacy:!0})),f=u.isGroup||u.isBroadcast?(0,o.CUSTOM_STRING)(e.sender.toString({legacy:!0})):o.DROP_ATTR,h=(0,l.getMeUser)(),_=(0,o.wap)("receipt",{type:"server-error",to:(0,d.USER_JID)(h),id:(0,o.CUSTOM_STRING)(t)},(0,o.wap)("encrypt",null,(0,o.wap)("enc_p",null,r),(0,o.wap)("enc_iv",null,i)),(0,o.wap)("rmr",{jid:p,from_me:(0,o.CUSTOM_STRING)(String(e.isSentByMe)),participant:f}));return(0,s.sendStanzaAndWaitForAck)(_,{id:t,class:"receipt",type:"server-error",from:h,participant:null})}))).apply(this,arguments)}},93374:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return p.apply(this,arguments)};var i=r(n(48926)),a=n(31914),o=n(71914),s=n(92574),l=n(24747),c=n(57701),d=n(39410);const u=new o.WapParser("reportProductResponse",(e=>{e.assertTag("iq"),e.assertAttr("type","result")}));function p(){return(p=(0,i.default)((function*(e,t,n){if((0,c.commerceFeaturesDisabledBySanctions)())throw new s.E451;const r=(0,a.wap)("iq",{to:a.S_WHATSAPP_NET,xmlns:"fb:thrift_iq",type:"set",id:(0,a.generateId)()},(0,a.wap)("request",{type:"report_product",biz_jid:(0,d.USER_JID)(e)},n?(0,a.wap)("reason",null,n):void 0,(0,a.wap)("id",null,t))),i=yield(0,l.sendIq)(r,u);if(!i.success){if(451===i.errorCode)throw new s.E451;throw new s.ServerStatusCodeError(i.errorCode)}}))).apply(this,arguments)}},18701:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getSpamMessageProtobuf=S,t.reportSpam=function(){return b.apply(this,arguments)};var i=r(n(48926)),a=r(n(67154)),o=r(n(81109)),s=n(31914),l=n(71914),c=n(15461),d=n(60980),u=n(58853),p=n(24747),f=n(24808),h=n(99234),_=n(6565),g=n(93650),m=n(84728),y=n(39410);const E=new Set([c.MSG_TYPE.CHAT,c.MSG_TYPE.AUDIO,c.MSG_TYPE.IMAGE,c.MSG_TYPE.PTT,c.MSG_TYPE.VIDEO,c.MSG_TYPE.VCARD,c.MSG_TYPE.UNKNOWN,c.MSG_TYPE.CIPHERTEXT,c.MSG_TYPE.LIST,c.MSG_TYPE.LIST_RESPONSE,c.MSG_TYPE.BUTTONS_RESPONSE,c.MSG_TYPE.NATIVE_FLOW]);function S(e){return null==e.buttonsMessage||null!=e.buttonsMessage.buttons&&(e.buttonsMessage=(0,o.default)((0,o.default)({},e.buttonsMessage),{},{buttons:e.buttonsMessage.buttons.map((e=>{if(e.nativeFlowInfo){var t;const n=JSON.parse(null!==(t=e.nativeFlowInfo.paramsJson)&&void 0!==t?t:"{}");return delete n.reference_id,delete n.total_amount,(0,o.default)((0,o.default)({},e),{},{nativeFlowInfo:(0,o.default)((0,o.default)({},e.nativeFlowInfo),{},{paramsJson:JSON.stringify(n)})})}return e}))})),e}function v(e){const t=[],n=e.isGroup?null:e.id;return function(e,t,n){const r=[],i=e.msgs.toArray().reverse();for(let a=0;a<i.length&&!(r.length>=t);a++){const t=i[a];if(E.has(t.type)&&!t.from.equals((0,h.getMaybeMeUser)())){if(n){if(e.isGroup&&!n.equals(t.author))continue;if(e.isUser&&!n.equals(t.from))continue}r.push(t)}}return r}(e,5,n).forEach((n=>{let r,i,o,l;const p=n.t.toString(),h=n.isViewOnce&&!(0,m.isUnviewed)(n.safe());switch(n.type){case c.MSG_TYPE.UNKNOWN:l=null,r=s.DROP_ATTR,o=s.DROP_ATTR,i=(0,s.CUSTOM_STRING)(u.CIPHERTEXT_VERSION.toString());break;case c.MSG_TYPE.CIPHERTEXT:l=null,r=s.DROP_ATTR,o=s.DROP_ATTR,i=s.DROP_ATTR;break;default:let e={};if(n.asMms){e=n.isUnsentPhoneMsg()||h||!n.mediaObject?{type:n.type}:n.avParams()}const t=S((0,_.createMsgProtobuf)(n,e)),a=(0,u.mediaTypeFromProtobuf)(t);l=h?null:(0,d.encodeProtobuf)(f.MessageSpec,t).readByteArray(),r=(0,g.typeAttributeFromProtobuf)(t),o=a?(0,s.CUSTOM_STRING)(a):s.DROP_ATTR,i=(0,s.CUSTOM_STRING)(u.CIPHERTEXT_VERSION.toString())}let E;const v={};if(h&&(v.deleted_reason=(0,m.isViewed)(n.safe())?"view_once_opened":"view_once_expired"),e.isGroup){let t=s.DROP_ATTR;n.author?t=(0,y.USER_JID)(n.author):n.from.isUser()&&(t=(0,y.USER_JID)(n.from)),E=(0,s.wap)("message",(0,a.default)({},v,{t:(0,s.CUSTOM_STRING)(p),from:(0,y.CHAT_JID)(e.id),participant:t,id:(0,s.CUSTOM_STRING)(n.id.id),type:r}),(0,s.wap)("raw",{v:i,mediatype:o},l))}else E=(0,s.wap)("message",(0,a.default)({},v,{t:(0,s.CUSTOM_STRING)(p),from:(0,y.USER_JID)(n.from),to:(0,y.USER_JID)(n.to),type:r,id:(0,s.CUSTOM_STRING)(n.id.id)}),n.multicast?(0,s.wap)("multicast",null):null,n.urlNumber?(0,s.wap)("url_number",null):null,n.urlText?(0,s.wap)("url_text",null):null,(0,s.wap)("raw",{v:i,mediatype:o},l));t.push(E)})),t}const T=new l.WapParser("reportUserSpam",(e=>{if(!e.hasChild("error"))return void __LOG__(2)`reportSpam: success`;const t=e.child("error"),n=t.attrInt("code"),r=t.attrString("text");return __LOG__(3)`reportSpam: sever response with ${n}, ${r}`,{errorCode:n,errorText:r}}));function b(){return(b=(0,i.default)((function*(e,t){const n=v(e);let r;if(e.isGroup){var i;const a=(null===(i=e.groupMetadata)||void 0===i?void 0:i.owner)&&(0,y.USER_JID)(e.groupMetadata.owner);r=(0,s.wap)("iq",{to:s.S_WHATSAPP_NET,type:"set",xmlns:"spam",id:(0,s.generateId)()},(0,s.wap)("spam_list",{creator:a||s.DROP_ATTR,subject:(0,s.CUSTOM_STRING)(e.name),jid:(0,y.CHAT_JID)(e.id),spam_flow:(0,s.CUSTOM_STRING)(String(t))},n))}else r=(0,s.wap)("iq",{to:s.S_WHATSAPP_NET,type:"set",xmlns:"spam",id:(0,s.generateId)()},(0,s.wap)("spam_list",{jid:(0,y.CHAT_JID)(e.id),spam_flow:(0,s.CUSTOM_STRING)(String(t))},n));const a=yield(0,p.sendIq)(r,T);if(!a.success){const{errorCode:e,errorText:t}=a;return __LOG__(3)`reportSpam: sever response with ${e}, ${t}`,{errorCode:e,errorText:t}}return a.result}))).apply(this,arguments)}},88795:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){let n;switch(t){case"paused":n=(0,r.wap)("paused",null);break;case"composing":n=(0,r.wap)("composing",null);break;case"recording":n=(0,r.wap)("composing",{media:"audio"});break;default:throw new Error(`Impossible value, the default statement should never be reached for value: ${t}`)}return(0,i.castStanza)((0,r.wap)("chatstate",{to:(0,o.CHAT_JID)(e),from:(0,o.JID)((0,a.assertGetMe)())},n))};var r=n(31914),i=n(24747),a=n(99234),o=n(39410)},52407:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.encryptAndSendKeyMsg=function(){return l.apply(this,arguments)};var i=r(n(48926)),a=n(24747),o=n(99094),s=n(6565);function l(){return(l=(0,i.default)((function*(e){yield n(28237).waitForMainStream,__LOG__(2,void 0,void 0,void 0,["messaging"])`encryptAndSendKeyMsg: sending ${e.id.toString()}`;const t=e.to,r=(0,s.createMsgProtobuf)(e),i=yield(0,o.createUserDeviceMsgStanza)(t,null,e,r,{type:o.MsgType.AppStateSync});return(0,a.sendStanzaAndWaitForAck)(i,{id:e.id.id,class:"message",from:t,participant:null})}))).apply(this,arguments)}},99094:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.MsgType=void 0,t.createGroupDeviceMsgStanza=function(){return v.apply(this,arguments)},t.createUserDeviceMsgStanza=function(){return S.apply(this,arguments)};var i=r(n(48926)),a=n(31914),o=n(45454),s=r(n(41143)),l=n(46308),c=n(58853),d=n(40316),u=n(99234),p=n(6565),f=n(45033),h=n(97398),_=n(76802),g=n(52083),m=n(93650),y=n(39410);const E=n(76672).Mirrored(["Retry","AppStateSync"]);function S(){return(S=(0,i.default)((function*(e,t,n,r,i){let a=r;return yield(0,h.ensureE2ESessions)([e]),(0,o.toUserWid)(e).equals((0,u.getMeUser)())&&i.type!==E.AppStateSync?((0,s.default)(null!=t,"[messaging] createDeviceMsgStanza: no recipient for peer device message"),a=(0,p.createDeviceSentMessage)(r,t),yield(0,_.populateICDCMeta)((0,o.toUserWid)(t),a)):yield(0,_.populateICDCMeta)((0,o.toUserWid)(e),a),T(e,null,t,n,a,i)}))).apply(this,arguments)}function v(){return(v=(0,i.default)((function*(e,t,n,r,i){if(yield(0,h.ensureE2ESessions)([t]),i.type===E.AppStateSync)return Promise.reject(new Error("[messaging] createGroupDeviceMsgStanza: not expect for App State Sync message"));const a=(0,o.toUserWid)(t).equals((0,u.getMeUser)())?(0,p.createDeviceSentMessage)(r,e):r;return yield(0,_.populateICDCMeta)((0,o.toUserWid)(t),a),T(e,t,null,n,a,i)}))).apply(this,arguments)}function T(){return b.apply(this,arguments)}function b(){return(b=(0,i.default)((function*(e,t,n,r,i,o){var s;const u=t||e,p=null!==(s=o.retryCount)&&void 0!==s?s:0,h=(0,c.mediaTypeFromProtobuf)(i),S=r.id,{type:v,ciphertext:T}=yield(0,d.encryptMsgProtobuf)(u,p,i);let b=null;if(v===f.CiphertextType.Pkmsg){const e=yield(0,l.getADVEncodedIdentity)();b=(0,a.wap)("device-identity",null,e)}return o.type!==E.Retry&&(yield(0,_.updateIdentityRange)(S,[u])),yield(0,g.getSignalProtocolStore)().flushBufferToDiskIfNotMemOnlyMode(),(0,a.wap)("message",{id:(0,a.CUSTOM_STRING)(S.id),to:(0,y.JID)(e),participant:t?(0,y.DEVICE_JID)(t):a.DROP_ATTR,recipient:n?(0,y.USER_JID)(n):a.DROP_ATTR,type:(0,m.typeAttributeFromProtobuf)(i),edit:(0,_.editAttribute)(i,r.subtype),category:o.type===E.AppStateSync?(0,a.CUSTOM_STRING)("peer"):a.DROP_ATTR,push_priority:o.type===E.AppStateSync?(0,a.CUSTOM_STRING)("high"):a.DROP_ATTR},(0,a.wap)("enc",{v:(0,a.CUSTOM_STRING)(c.CIPHERTEXT_VERSION.toString()),type:(0,a.CUSTOM_STRING)(v),count:0===p?a.DROP_ATTR:(0,a.INT)(p),mediatype:(0,c.encodeMaybeMediaType)(h),"decrypt-fail":(0,c.encodeMaybeDecryptFail)(i.reactionMessage)},T),b)}))).apply(this,arguments)}t.MsgType=E},40316:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.encryptMsgProtobuf=function(){return u.apply(this,arguments)},t.encryptMsgSenderKey=function(){return p.apply(this,arguments)};var i=r(n(48926)),a=n(58853),o=n(45033),s=r(n(11339)),l=n(76802),c=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=d(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(77605));function d(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(d=function(e){return e?n:t})(e)}function u(){return(u=(0,i.default)((function*(e,t,n){const r=(0,a.mediaTypeFromProtobuf)(n),i=new s.default.E2eMessageSend({e2eCiphertextVersion:a.CIPHERTEXT_VERSION,e2eDestination:(0,a.metricsDestinationType)(e),messageMediaType:r?(0,a.metricsMediaType)(r):s.default.MEDIA_TYPE.NONE,retryCount:t});try{const{type:t,ciphertext:r}=yield c.Cipher.encryptSignalProto(e,(0,l.encodeAndPad)(n));return i.e2eCiphertextType=(0,a.metricsCiphertextType)(t),i.e2eSuccessful=!0,i.commit(),{type:t,ciphertext:r}}catch(t){return i.e2eSuccessful=!1,i.weight=1,i.commit(),__LOG__(3,void 0,void 0,void 0,["messaging"])`encryptMsgProtobuf: encryption fail for ${e.toString()}, ${t}`,Promise.reject(new Error(`[messaging] encryptMsgProtobuf: encryption fail for ${e.toString()}, ${t}`))}}))).apply(this,arguments)}function p(){return(p=(0,i.default)((function*(e,t){const n=new s.default.E2eMessageSend({e2eCiphertextType:(0,a.metricsCiphertextType)(o.CiphertextType.Skmsg),e2eCiphertextVersion:a.CIPHERTEXT_VERSION,e2eDestination:s.default.E2E_DESTINATION.GROUP,messageMediaType:s.default.MEDIA_TYPE.NONE,retryCount:0});try{const r=yield c.Cipher.encryptSenderKeyMsgSignalProto(e,t);return n.e2eSuccessful=!0,n.commit(),r}catch(t){return n.e2eSuccessful=!1,n.weight=1,n.commit(),__LOG__(3,void 0,void 0,void 0,["messaging"])`encryptMsgSenderKey: encryption fail for ${e.toString()}, ${t}`,Promise.reject(new Error(`[messaging] encryptMsgSenderKey: encryption fail for ${e.toString()}, ${t}`))}}))).apply(this,arguments)}},45325:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.FANOUT_TYPE=void 0,t.createFanoutMsgStanza=function(){return A.apply(this,arguments)};var i=r(n(48926)),a=n(31914),o=n(45454),s=n(46308),l=n(58853),c=n(19380),d=n(40316),u=n(99234),p=n(6565),f=n(45033),h=n(97398),_=n(47124),g=r(n(11339)),m=n(76802),y=n(16860),E=n(52083),S=n(93650),v=n(39410);const T=Object.freeze({CHAT:"chat",GROUP_DIRECT:"groupDirect"});function b(){return C.apply(this,arguments)}function C(){return(C=(0,i.default)((function*(e,t,n,r,s){const c=(0,l.mediaTypeFromProtobuf)(n),h=(0,u.getMeUser)();if(r.fanoutType===T.CHAT&&1===t.length&&(0,m.isPrimaryDevice)(t[0])){null==s||s.startClientEncryptStage();const{type:e,ciphertext:r}=yield(0,d.encryptMsgProtobuf)(t[0],0,n);return null==s||s.postClientEncryptStage(),{shouldHaveIdentity:e===f.CiphertextType.Pkmsg,body:(0,a.wap)("enc",{v:(0,a.CUSTOM_STRING)(l.CIPHERTEXT_VERSION.toString()),type:(0,a.CUSTOM_STRING)(e),mediatype:(0,l.encodeMaybeMediaType)(c),"decrypt-fail":(0,l.encodeMaybeDecryptFail)(n.reactionMessage)},r)}}let _=!1;null==s||s.startClientEncryptStage();const g=t.map(function(){var t=(0,i.default)((function*(t){const i=(0,o.toUserWid)(t).equals(h)?(0,p.createDeviceSentMessage)(n,e):n,s=r.fanoutType===T.GROUP_DIRECT?(0,o.toUserWid)(t):(0,o.toUserWid)(e);yield(0,m.populateICDCMeta)(s,i);try{const{type:e,ciphertext:r}=yield(0,d.encryptMsgProtobuf)(t,0,i);return e===f.CiphertextType.Pkmsg&&(_=!0),(0,a.wap)("to",{jid:(0,v.DEVICE_JID)(t)},(0,a.wap)("enc",{v:(0,a.CUSTOM_STRING)(l.CIPHERTEXT_VERSION.toString()),type:(0,a.CUSTOM_STRING)(e),mediatype:(0,l.encodeMaybeMediaType)(c),"decrypt-fail":(0,l.encodeMaybeDecryptFail)(n.reactionMessage)},r))}catch(e){return(0,m.isPrimaryDevice)(t)&&(__LOG__(4,void 0,new Error,!0,["messaging"])`encryptAndSendUserMsg: encryption fail for primary device ${String(t)}`,SEND_LOGS("encryption-fail-for-primary-device")),null}}));return function(){return t.apply(this,arguments)}}()),y=yield Promise.all(g);null==s||s.postClientEncryptStage();const E=y.filter((e=>null!=e));return E.length>0?{body:(0,a.wap)("participants",null,E),shouldHaveIdentity:_}:Promise.reject(new Error("[messaging] encryptAndSendUserMsg: encryption fail for all devices"))}))).apply(this,arguments)}function A(){return(A=(0,i.default)((function*(e,t,n,r){const i=e.to;try{const e=yield(0,h.ensureE2ESessions)(n);(0,y.postPrekeysDepletionMetric)({count:null==e?void 0:e.depletedPrekeyCount,prekeysFetchReason:g.default.PREKEYS_FETCH_CONTEXT.SEND_MESSAGE,messageType:r.fanoutType===T.CHAT?g.default.MESSAGE_TYPE.INDIVIDUAL:g.default.MESSAGE_TYPE.GROUP,chatId:i})}catch(e){__LOG__(4,void 0,new Error,void 0,["messaging"])`ensureE2ESessions with error`}const o=e.id;let d=n;r.isResendingMsg&&(d=yield(0,m.filterDeviceWithChangedIdentity)(o,n));const u=d.map((e=>({msgKey:o,receiverId:e})));yield(0,_.createOrMergeReceiptRecords)(u);const p=yield b(i,d,t,r,e.wamMessageSendPerfReporter),C=r.fanoutType===T.GROUP_DIRECT?(0,a.wap)("enc",{v:(0,a.CUSTOM_STRING)(l.CIPHERTEXT_VERSION.toString()),type:(0,a.CUSTOM_STRING)(f.CiphertextType.Skmsg)}):null;let A=null;if(p.shouldHaveIdentity){const e=yield(0,s.getADVEncodedIdentity)();A=(0,a.wap)("device-identity",null,e)}const P=(0,S.getBizNativeFlowName)(t);let M;const O=c.ContactCollection.get(i),I=null==O?void 0:O.privacyMode;null!=I&&(M=(0,a.wap)("biz",{host_storage:(0,a.INT)(I.hostStorage),actual_actors:(0,a.INT)(I.actualActors),privacy_mode_ts:(0,a.INT)(I.privacyModeTs),native_flow_name:(0,a.MAYBE_CUSTOM_STRING)(P)})),null==M&&null!=P&&(M=(0,a.wap)("biz",{native_flow_name:(0,a.CUSTOM_STRING)(P)})),r.isResendingMsg||(yield(0,m.updateIdentityRange)(o,d)),yield(0,E.getSignalProtocolStore)().flushBufferToDiskIfNotMemOnlyMode();const{id:w}=o;return(0,a.wap)("message",{id:(0,a.CUSTOM_STRING)(w),to:(0,v.CHAT_JID)(i),type:(0,S.typeAttributeFromProtobuf)(t),edit:(0,m.editAttribute)(t,e.subtype),device_fanout:r.isResendingMsg?(0,a.CUSTOM_STRING)("false"):a.DROP_ATTR},p.body,C,A,M)}))).apply(this,arguments)}t.FANOUT_TYPE=T},5087:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.encryptAndSendGroupDirectMsg=function(){return g.apply(this,arguments)},t.resendGroupMsg=m;var i=r(n(48926)),a=r(n(70735)),o=n(40234),s=n(45454),l=n(10823),c=n(24747),d=n(45325),u=n(16104),p=r(n(11339)),f=n(76802),h=n(52083),_=n(90298);function g(){return(g=(0,i.default)((function*(e,t,n){const r=e.to;__LOG__(2,void 0,void 0,void 0,["messaging"])`encryptAndSendGroupDirectMsg: sending ${e.id} with group ${r.toString()}`;const i=yield E(e,t,n,{fanoutType:d.FANOUT_TYPE.GROUP_DIRECT}),{phash:a}=i;if(a){__LOG__(2,void 0,void 0,void 0,["messaging"])`encryptAndSendGroupDirectMsg: phash mismatch, got server phash ${a}`;const r=o.Clock.globalUnixTime();new p.default.MdDeviceSyncAck({chatType:p.default.MESSAGE_CHAT_TYPE.GROUP,revoke:(0,f.isRevokeMsg)(t)}).commit(),(0,l.syncDeviceListJob)(n,"message",a).then((()=>m(e,t,n,r)))}return i}))).apply(this,arguments)}function m(){return y.apply(this,arguments)}function y(){return(y=(0,i.default)((function*(e,t,n,r){__LOG__(2,void 0,void 0,void 0,["messaging"])`resendGroupMsg: to ${e.to.toString()}`;const i=(0,f.createResendAbortMetric)((0,f.isRevokeMsg)(t),Boolean(e.isViewOnce),e.to);if(o.Clock.globalUnixTime()-r>f.RESEND_TIMEOUT_IN_SECONDS)return __LOG__(2,void 0,void 0,void 0,["messaging"])`resendUserMsg: skip group resending due to 5 min timeout`,i.messageSendResult=p.default.MESSAGE_SEND_RESULT_TYPE.ERROR_EXPIRED,void i.commit();try{const r=Array.from(new Set(n.map((e=>e.user)))).map((e=>(0,s.createUserWid)(e))),o=yield(0,u.getFanOutList)({wids:r}),l=(0,a.default)(o,n,String);if(0===l.length)return __LOG__(2,void 0,void 0,void 0,["messaging"])`resendGroupMsg: skip sending to the empty list`,i.messageSendResult=p.default.MESSAGE_SEND_RESULT_TYPE.ERROR_UNKNOWN,void i.commit();__LOG__(2,void 0,void 0,void 0,["messaging"])`resendGroupMsg: resending to devices ${l.join(",")}`,yield E(e,t,l,{fanoutType:d.FANOUT_TYPE.GROUP_DIRECT,isResendingMsg:!0})}catch(e){throw __LOG__(2,void 0,void 0,void 0,["messaging"])`resendGroupMsg: resend got error ${e} `,i.messageSendResult=p.default.MESSAGE_SEND_RESULT_TYPE.ERROR_UNKNOWN,i.commit(),e}(0,_.logSuccessfulMessageSend)(i,e)}))).apply(this,arguments)}function E(){return S.apply(this,arguments)}function S(){return(S=(0,i.default)((function*(e,t,n,r){var i;const{id:a,to:o}=e,s=yield(0,d.createFanoutMsgStanza)(e,t,n,r);yield(0,h.getSignalProtocolStore)().flushBufferToDiskIfNotMemOnlyMode(),null===(i=e.wamMessageSendPerfReporter)||void 0===i||i.postReadyToSendStage();const l=yield(0,c.sendStanzaAndReturnAck)(s,{id:a.id,class:"message",from:o,participant:null}),u=f.sendMsgAckSyncParser.parse(l);return u.error?Promise.reject(new Error("[messaging] encryptAndSendGroupDirectMsg: Invalid ack from server")):u.success}))).apply(this,arguments)}},23712:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getKeyDistributionMsg=function(){return f.apply(this,arguments)};var i=r(n(48926)),a=n(45454),o=n(40316),s=(n(45033),n(97398)),l=r(n(11339)),c=n(76802),d=n(16860),u=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=p(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(77605));function p(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(p=function(e){return e?n:t})(e)}function f(){return(f=(0,i.default)((function*(e,t,n){var r,p,f,h;if(null==e||null===(r=e.wamMessageSendPerfReporter)||void 0===r||r.startPrekeysFetchStage(),null==e||null===(p=e.wamMessageSendPerfReporter)||void 0===p||p.setFetchedPrekeyCount(0),null==e||null===(f=e.wamMessageSendPerfReporter)||void 0===f||f.setSenderKeyDistributionCount(n.length),0===n.length)return null==e||null===(h=e.wamMessageSendPerfReporter)||void 0===h||h.postPrekeysFetchStage(),null;try{var _;const r=yield(0,s.ensureE2ESessions)(n),i=null==r?void 0:r.missedPrekeyCount;var g;if(null!=i)null==e||null===(g=e.wamMessageSendPerfReporter)||void 0===g||g.setFetchedPrekeyCount(i);null==e||null===(_=e.wamMessageSendPerfReporter)||void 0===_||_.postPrekeysFetchStage(),(0,d.postPrekeysDepletionMetric)({count:null==r?void 0:r.depletedPrekeyCount,prekeysFetchReason:l.default.PREKEYS_FETCH_CONTEXT.SEND_MESSAGE,messageType:l.default.MESSAGE_TYPE.GROUP,chatId:t})}catch(e){__LOG__(4,void 0,new Error,void 0,["messaging"])`ensureE2ESessions with error`}const m=yield u.Session.getGroupSenderKeyInfo(t),y={senderKeyDistributionMessage:{groupId:t.toString({legacy:!0}),axolotlSenderKeyDistributionMessage:m}},E=n.map(function(){var e=(0,i.default)((function*(e){try{yield(0,c.populateICDCMeta)((0,a.toUserWid)(e),y);const t=yield(0,o.encryptMsgProtobuf)(e,0,y);return{type:t.type,ciphertext:t.ciphertext,participant:e}}catch(t){if(__LOG__(2,void 0,void 0,void 0,["messaging"])`encryptAndSendUserMsg: encryption fail for ${e.toString()}, ${t}`,(0,c.isPrimaryDevice)(e))return Promise.reject(new Error(`[messaging] encryptAndSendUserMsg: encryption fail for primary device ${String(e)}`))}}));return function(){return e.apply(this,arguments)}}());return(yield Promise.all(E)).filter(Boolean)}))).apply(this,arguments)}},51974:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.encryptAndSendGroupMsg=function(e,t){var n;const{id:r,to:o}=e;__LOG__(2,void 0,void 0,void 0,["messaging"])`encryptAndSendGroupMsg: sending ${r}`;const{protocolMessage:u}=t;let p=null;if((null==u?void 0:u.type)===d.Message$ProtocolMessageType.REVOKE&&(null==u?void 0:u.key)){const{remoteJid:e,id:t,participant:n}=u.key;e&&t&&n&&(p=new s.default({remote:(0,l.createWid)(e),fromMe:!0,id:t,participant:(0,l.createWid)(n)}))}return null===(n=e.wamMessageSendPerfReporter)||void 0===n||n.startWaitingToEncryptStage(),h.senderKeyQueueMap.enqueue(o.toString(),(0,a.default)((function*(){var n;null===(n=e.wamMessageSendPerfReporter)||void 0===n||n.postWaitingToEncryptStage();const r=yield function(){return m.apply(this,arguments)}(o,p);if(r.type===g.DIRECT){var a;const{deviceList:n}=r;null===(a=e.wamMessageSendPerfReporter)||void 0===a||a.setIsDirectedMessage(!0);const o=yield(0,c.encryptAndSendGroupDirectMsg)(e,t,n);return(0,i.default)((0,i.default)({},o),{},{deviceCount:n.length})}const{senderKeyList:s}=r,l=yield(0,_.encryptAndSendSenderKeyMsg)(e,t,s);return(0,i.default)((0,i.default)({},l),{},{deviceCount:s.skList.length+s.skDistribList.length})})))};var i=r(n(81109)),a=r(n(48926)),o=n(88555),s=r(n(65212)),l=n(45454),c=n(5087),d=n(24808),u=n(16104),p=n(76214),f=n(43201),h=n(92657),_=n(3922);const g=Object.freeze({SKMSG:"skmsg",DIRECT:"direct"});function m(){return(m=(0,a.default)((function*(e,t){const n=yield(0,f.getGroupSenderKeyList)(e),r={senderKeyList:n,type:g.SKMSG};if(t&&(0,o.isMDBackend)()){const e=yield(0,p.getMsgInfoTable)().equals(["msgKey"],String(t));if(0===e.length)return r;const{skDistribList:i,skList:a}=n,o=new Set(i.concat(a).map((e=>String((0,l.toUserWid)(e))))),s=e.filter((e=>!o.has(e.receiverUserJid))).map((e=>(0,l.createWid)(e.receiverUserJid)));if(0===s.length)return r;const c=[...yield(0,u.getFanOutList)({wids:s}),...a,...i];return{type:g.DIRECT,deviceList:c}}return r}))).apply(this,arguments)}},95216:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.encryptAndSendGroupKeyDistributionMsg=function(e){__LOG__(2,void 0,void 0,void 0,["messaging"])`encryptAndSendGroupKeyDistributionMsg: sending ${e}`;const t=e.remote;return m.senderKeyQueueMap.enqueue(t.toString(),(()=>function(){return v.apply(this,arguments)}(e)))};var i=r(n(48926)),a=n(31914),o=n(69315),s=n(46308),l=n(58853),c=n(24747),d=n(99234),u=n(23712),p=n(45033),f=n(47124),h=n(76802),_=n(43201),g=n(52083),m=n(92657),y=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=S(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(77605)),E=n(39410);function S(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(S=function(e){return e?n:t})(e)}function v(){return(v=(0,i.default)((function*(e){const{id:t}=e,n=e.remote,{skDistribList:r,skList:i,rotateKey:s}=yield(0,_.getGroupSenderKeyList)(n),[u,m]=yield T(n,r,s),y=i.concat(r);yield(0,h.updateIdentityRange)(e,y),yield(0,f.createOrMergeReceiptRecords)(y.map((t=>({msgKey:e,receiverId:t})))),yield(0,g.getSignalProtocolStore)().flushBufferToDiskIfNotMemOnlyMode();const S=yield(0,o.phashV2)([...y,(0,d.assertGetMe)()]),v=(0,a.wap)("message",{id:(0,a.CUSTOM_STRING)(t),to:(0,E.CHAT_JID)(n),phash:(0,a.CUSTOM_STRING)(S),type:"text",device_fanout:(0,a.CUSTOM_STRING)("false")},(0,a.wap)("enc",{v:(0,a.CUSTOM_STRING)(l.CIPHERTEXT_VERSION.toString()),type:(0,a.CUSTOM_STRING)(p.CiphertextType.Skmsg),"decrypt-fail":(0,a.CUSTOM_STRING)("hide")}),u,m),b=yield(0,c.sendStanzaAndReturnAck)(v,{id:t,class:"message",from:n,participant:null}),C=h.sendMsgAckSyncParser.parse(b);return C.error?(__LOG__(3,void 0,void 0,void 0,["messaging"])`encryptAndSendSenderKeyMsg: Invalid ack from server`,Promise.reject(new Error("[messaging] encryptAndSendSenderKeyMsg: Invalid ack from server"))):(yield(0,_.markHasSenderKey)(n,r),C.success)}))).apply(this,arguments)}function T(){return b.apply(this,arguments)}function b(){return(b=(0,i.default)((function*(e,t,n){n&&(yield y.Session.deleteGroupSenderKeyInfo(e));const r=yield(0,u.getKeyDistributionMsg)(null,e,t);let i=null,o=!1;r&&r.length>0&&(i=(0,a.wap)("participants",null,r.map((e=>{let{type:t,ciphertext:n,participant:r}=e;return t===p.CiphertextType.Pkmsg&&(o=!0),(0,a.wap)("to",{jid:(0,E.DEVICE_JID)(r)},(0,a.wap)("enc",{v:(0,a.CUSTOM_STRING)(l.CIPHERTEXT_VERSION.toString()),"decrypt-fail":(0,a.CUSTOM_STRING)("hide"),type:(0,a.CUSTOM_STRING)(t)},n))}))));let c=null;if(o){const e=yield(0,s.getADVEncodedIdentity)();c=(0,a.wap)("device-identity",null,e)}return[i,c]}))).apply(this,arguments)}},92657:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.senderKeyQueueMap=void 0;const r=new(n(27870).PromiseQueueMap);t.senderKeyQueueMap=r},3922:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.encryptAndSendSenderKeyMsg=function(){return I.apply(this,arguments)};var i=r(n(48926)),a=n(31914),o=n(40234),s=n(69315),l=n(46308),c=n(58853),d=n(24747),u=n(5087),p=n(40316),f=n(99234),h=n(23712),_=n(45033),g=n(90981),m=n(47124),y=r(n(11339)),E=n(76802),S=n(43201),v=n(52083),T=n(10790),b=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=P(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(77605)),C=n(93650),A=n(39410);function P(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(P=function(e){return e?n:t})(e)}function M(){return O.apply(this,arguments)}function O(){return(O=(0,i.default)((function*(e,t,n,r){var i,o;const s=(0,E.encodeAndPad)(r),d=(0,c.mediaTypeFromProtobuf)(r),u=yield(0,h.getKeyDistributionMsg)(e,t,n);null===(i=e.wamMessageSendPerfReporter)||void 0===i||i.startClientEncryptStage();const f=yield(0,p.encryptMsgSenderKey)(t,s);null===(o=e.wamMessageSendPerfReporter)||void 0===o||o.postClientEncryptStage();let g=null,m=!1;u&&u.length>0&&(g=(0,a.wap)("participants",null,u.map((e=>{let{type:t,ciphertext:n,participant:i}=e;return t===_.CiphertextType.Pkmsg&&(m=!0),(0,a.wap)("to",{jid:(0,A.DEVICE_JID)(i)},(0,a.wap)("enc",{v:(0,a.CUSTOM_STRING)(c.CIPHERTEXT_VERSION.toString()),type:(0,a.CUSTOM_STRING)(t),"decrypt-fail":(0,c.encodeMaybeDecryptFail)(r.reactionMessage)},n))}))));const y=(0,a.wap)("enc",{v:(0,a.CUSTOM_STRING)(c.CIPHERTEXT_VERSION.toString()),type:(0,a.CUSTOM_STRING)(_.CiphertextType.Skmsg),mediatype:(0,c.encodeMaybeMediaType)(d),"decrypt-fail":(0,c.encodeMaybeDecryptFail)(r.reactionMessage)},f.ciphertext);let S=null;if(m){const e=yield(0,l.getADVEncodedIdentity)();S=(0,a.wap)("device-identity",null,e)}return[g,y,S]}))).apply(this,arguments)}function I(){return(I=(0,i.default)((function*(e,t,n){var r;const{id:i,to:l}=e;__LOG__(2,void 0,void 0,void 0,["messaging"])`encryptAndSendSenderKeyMsg: sending ${i}`;const{id:c}=i,{skDistribList:p,skList:h,rotateKey:_}=n;w(e);const P=h.concat(p),O=yield(0,s.phashV2)([...P,(0,f.assertGetMe)()]);yield(0,m.createOrMergeReceiptRecords)(P.map((e=>({msgKey:i,receiverId:e})))),_&&(yield b.Session.deleteGroupSenderKeyInfo(l));const[I,R,D]=yield M(e,l,p,t),L=(0,a.wap)("message",{id:(0,a.CUSTOM_STRING)(c),to:(0,A.CHAT_JID)(l),phash:(0,a.CUSTOM_STRING)(O),type:(0,C.typeAttributeFromProtobuf)(t),edit:(0,E.editAttribute)(t,e.subtype)},I,R,D);yield(0,E.updateIdentityRange)(i,P),yield(0,v.getSignalProtocolStore)().flushBufferToDiskIfNotMemOnlyMode(),null===(r=e.wamMessageSendPerfReporter)||void 0===r||r.postReadyToSendStage();const N=yield(0,d.sendStanzaAndReturnAck)(L,{id:c,class:"message",from:l,participant:null}),k=E.sendMsgAckSyncParser.parse(N);if(k.error)return __LOG__(3,void 0,void 0,void 0,["messaging"])`encryptAndSendSenderKeyMsg: Invalid ack from server`,Promise.reject(new Error("[messaging] encryptAndSendSenderKeyMsg: Invalid ack from server"));yield(0,S.markHasSenderKey)(l,p);const{phash:U,count:G}=k.success;if(U&&U!==O){__LOG__(2,void 0,void 0,void 0,["messaging"])`encryptAndSendSenderKeyMsg: phash mismatch, got server phash ${U}`;const n=o.Clock.globalUnixTime();new y.default.MdDeviceSyncAck({chatType:y.default.MESSAGE_CHAT_TYPE.GROUP,revoke:(0,E.isRevokeMsg)(t)}).commit(),(0,T.sendQueryGroup)(l).then((()=>{(0,u.resendGroupMsg)(e,t,P,n)}))}return null!=G&&(0,g.getTable)().merge(String(i),{count:G}),k.success}))).apply(this,arguments)}function w(e){var t;(0,f.markUserSentMessageToChat)(e.chat.id)&&(null===(t=e.wamMessageSendPerfReporter)||void 0===t||t.setMessageIsFirstUserMessage(!0))}},24659:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendRetry=function(){return c.apply(this,arguments)};var i=r(n(48926)),a=r(n(41143)),o=n(24747),s=n(99094),l=n(6565);function c(){return(c=(0,i.default)((function*(e,t,n,r,i){const c=r.id.id;let d;__LOG__(2,void 0,void 0,void 0,["messaging"])`sendRetry: id ${c} to ${e.toString()}, requester: ${(t||e).toString()}, count: ${i}`,r.asMms&&(d=r.isUnsentPhoneMsg()?{type:r.type}:r.avParams());const u=(0,l.createMsgProtobuf)(r,d||{}),p={type:s.MsgType.Retry,retryCount:i};let f;return e.isUser()?f=yield(0,s.createUserDeviceMsgStanza)(e,n,r,u,p):((0,a.default)(null!=t,"[messaging] sendRetry: no participant for group retry message"),f=yield(0,s.createGroupDeviceMsgStanza)(e,t,r,u,p)),__LOG__(2,void 0,void 0,void 0,["messaging"])`sendRetry: sending ${c} to ${e.toString()}`,(0,o.sendStanzaAndWaitForAck)(f,{id:c,class:"message",from:e,participant:t})}))).apply(this,arguments)}},95547:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.encryptAndSendKeyDistributionMsg=function(e){if(!e.id)return Promise.reject(new Error("[messaging] sending message without an id"));if(!e.remote)return Promise.reject(new Error("[messaging] sending message without an remote id"));if(e.remote.isGroup()){const t=new l.MessageSendPerfReporter(e.remote,c.default.MEDIA_TYPE.NONE,c.default.MESSAGE_TYPE.GROUP);return(0,u.encryptAndSendGroupKeyDistributionMsg)(e).then((()=>{t.setMessageIsInvisible(!0),t.postWrittenWireStage()}))}return Promise.reject(new Error("[messaging] unsupported remote jid type"))},t.encryptAndSendMsg=function(e){var t,n;const r=e.id,l=e.to;if(!r||!r.id)return Promise.reject(new Error("[messaging] sending message without an id"));if(!l)return Promise.reject(new Error("[messaging] sending message without an remote id"));(0,i.isMDBackend)()&&e.type===a.MSG_TYPE.STICKER&&null==e.deprecatedMms3Url&&(e.deprecatedMms3Url=h);let c;if(e.asMms){const t=e.isUnsentPhoneMsg();c=t?{type:e.type}:e.avParams(),(0,i.isMDBackend)()&&e.type===a.MSG_TYPE.STICKER&&!t&&null==c.url&&(c.url=h)}const u=(0,s.createMsgProtobuf)(e,c||{});if(null===(t=e.wamMessageSendPerfReporter)||void 0===t||t.startWrittenWireStage(),null===(n=e.wamMessageSendPerfReporter)||void 0===n||n.startReadyToSendStage(),l.isUser()){const t=(0,f.encryptAndSendUserMsg)(e,u);return(0,i.isMDBackend)()&&(0,o.getABPropConfigValue)("trusted_contacts_sender")&&(0,p.sendTcToken)(l),t}if(l.isGroup())return(0,d.encryptAndSendGroupMsg)(e,u);return Promise.reject(new Error("[messaging] unsupported remote jid type"))};var i=n(88555),a=n(15461),o=n(57849),s=n(6565),l=n(30097),c=r(n(11339)),d=n(51974),u=n(95216),p=n(41088),f=n(68264);const h="https://web.whatsapp.net"},68264:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.encryptAndSendUserMsg=function(){return _.apply(this,arguments)};var i=r(n(48926)),a=r(n(70735)),o=n(40234),s=n(10823),l=n(24747),c=n(45325),d=n(16104),u=n(99234),p=r(n(11339)),f=n(76802),h=n(90298);function _(){return(_=(0,i.default)((function*(e,t){const{id:n,to:r}=e;__LOG__(2,void 0,void 0,void 0,["messaging"])`encryptAndSendUserMsg: sending ${n}`;const i=(0,u.assertGetMe)(),a=yield(0,d.getFanOutList)({wids:[r,i]}),l=yield y(e,t,a,{fanoutType:c.FANOUT_TYPE.CHAT}),{phash:h}=l;if(h){__LOG__(2,void 0,void 0,void 0,["messaging"])`encryptAndSendUserMsg: phash mismatch, got server phash ${h}`;const n=o.Clock.globalUnixTime();new p.default.MdDeviceSyncAck({chatType:p.default.MESSAGE_CHAT_TYPE.INDIVIDUAL,revoke:(0,f.isRevokeMsg)(t)}).commit(),(0,s.syncDeviceListJob)([r,i],"message",h).then((()=>g(e,t,a,n)))}return l}))).apply(this,arguments)}function g(){return m.apply(this,arguments)}function m(){return(m=(0,i.default)((function*(e,t,n,r){const{id:i,to:l}=e;__LOG__(2,void 0,void 0,void 0,["messaging"])`resendUserMsg: resending ${i.id}`;const _=(0,f.createResendAbortMetric)((0,f.isRevokeMsg)(t),Boolean(e.isViewOnce),e.to);if(o.Clock.globalUnixTime()-r>f.RESEND_TIMEOUT_IN_SECONDS)return __LOG__(2,void 0,void 0,void 0,["messaging"])`resendUserMsg: skip sending due to 5 min timeout`,_.messageSendResult=p.default.MESSAGE_SEND_RESULT_TYPE.ERROR_EXPIRED,void _.commit();try{const r=(0,u.assertGetMe)(),i=yield(0,d.getFanOutList)({wids:[l,r]}),o=(0,a.default)(i,n,String);if(0===o.length)return __LOG__(2,void 0,void 0,void 0,["messaging"])`resendUserMsg: skip sending to the empty list`,_.messageSendResult=p.default.MESSAGE_SEND_RESULT_TYPE.ERROR_UNKNOWN,void _.commit();__LOG__(2,void 0,void 0,void 0,["messaging"])`resendUserMsg: resending to devices ${o.join(",")}`;const{phash:f}=yield y(e,t,o,{fanoutType:c.FANOUT_TYPE.CHAT,isResendingMsg:!0});f&&(0,s.syncDeviceListJob)([l,r],"message",f)}catch(e){throw __LOG__(2,void 0,void 0,void 0,["messaging"])`resendUserMsg: resend got error ${e} `,_.messageSendResult=p.default.MESSAGE_SEND_RESULT_TYPE.ERROR_UNKNOWN,_.commit(),e}(0,h.logSuccessfulMessageSend)(_,e)}))).apply(this,arguments)}function y(){return E.apply(this,arguments)}function E(){return(E=(0,i.default)((function*(e,t,n,r){var i;const{id:a,to:o}=e,s=yield(0,c.createFanoutMsgStanza)(e,t,n,r);null===(i=e.wamMessageSendPerfReporter)||void 0===i||i.postReadyToSendStage();const d=yield(0,l.sendStanzaAndReturnAck)(s,{id:a.id,class:"message",from:o,participant:null}),u=f.sendMsgAckSyncParser.parse(d);if(u.error)throw new Error("[messaging] sendMsgToDeviceList: Invalid ack from server");return u.success}))).apply(this,arguments)}},93167:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return(0,i.castStanza)((0,r.wap)("presence",{type:e,name:(0,r.MAYBE_CUSTOM_STRING)(a.Conn.pushname)}))};var r=n(31914),i=n(24747),a=n(17239)},34083:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){const n=e.isUser()&&null!=t&&(0,i.getABPropConfigValue)("trusted_contacts");return(0,a.castStanza)((0,r.wap)("presence",{id:(0,r.generateId)(),to:(0,o.CHAT_JID)(e),type:"subscribe"},n?(0,r.wap)("tctoken",null,t):null))};var r=n(31914),i=n(57849),a=n(24747),o=n(39410)},66612:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return p.apply(this,arguments)};var i=r(n(48926)),a=n(31914),o=n(71914),s=n(92574),l=r(n(89867)),c=n(24747),d=n(39410);const u=new o.WapParser("photoResponseParser",(e=>{if(e.assertAttr("type","result"),e.hasChild("picture")){return{id:e.child("picture").attrInt("id")}}return{id:null}}));function p(){return(p=(0,i.default)((function*(e,t){const n=yield(0,c.sendIq)((0,a.wap)("iq",{to:a.S_WHATSAPP_NET,target:l.default.isGroup(e)?(0,d.CHAT_JID)(e):a.DROP_ATTR,type:"set",xmlns:"w:profile:picture",id:(0,a.generateId)()},t?(0,a.wap)("picture",{type:"image"},t):null),u);return n.success?{id:n.result.id}:Promise.reject(new s.ServerStatusCodeError(n.errorCode,n.errorText))}))).apply(this,arguments)}},80079:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.TokenType=void 0,t.setPrivacyTokens=function(){return p.apply(this,arguments)};var i=r(n(48926)),a=n(31914),o=n(71914),s=n(92574),l=n(24747),c=n(39410);const d=new o.WapParser("setPrivacyTokensParser",(e=>({stanzaId:e.attrString("id")}))),u=n(76672)({TrustedContact:"trusted_contact"});function p(){return(p=(0,i.default)((function*(e,t,n){const r=t.map((t=>(0,a.wap)("token",{jid:(0,c.USER_JID)(e),t:(0,a.CUSTOM_STRING)(String(n)),type:(0,a.CUSTOM_STRING)(t)}))),i=yield(0,l.sendIq)((0,a.wap)("iq",{to:a.S_WHATSAPP_NET,type:"set",xmlns:"privacy",id:(0,a.generateId)()},(0,a.wap)("tokens",null,r)),d);if(!i.success)throw new s.ServerStatusCodeError(i.errorCode,i.errorText)}))).apply(this,arguments)}t.TokenType=u},45723:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return(0,i.castStanza)((0,r.wap)("presence",{name:(0,r.MAYBE_CUSTOM_STRING)(e)}))};var r=n(31914),i=n(24747)},35065:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getToken=function(){return p.apply(this,arguments)};var i=r(n(48926)),a=n(97197),o=n(92844),s=n(97245),l=n(24747),c=r(n(11339));function d(e){const{result:t,overallStartTime:n,retryStartTime:r,retryAttemptsLeft:i}=e,a=function(e){switch(e){case"success":return c.default.SIGN_CREDENTIAL_RESULT.SUCCESS;case"bad-request":return c.default.SIGN_CREDENTIAL_RESULT.ERROR_BAD_REQUEST;case"internal-server-error":return c.default.SIGN_CREDENTIAL_RESULT.ERROR_SERVER;case"disconnected":return c.default.SIGN_CREDENTIAL_RESULT.ERROR_CLIENT_NETWORK;default:return c.default.SIGN_CREDENTIAL_RESULT.ERROR_OTHER}}(t);new c.default.SignCredential({signCredentialResult:a,overallT:(0,o.monotonicTimeSince)(n),signCredentialT:(0,o.monotonicTimeSince)(r),retryCount:3-i,waConnectedToChatd:"disconnected"!==t,applicationState:"visible"===document.visibilityState?c.default.APPLICATION_STATE.FOREGROUND:c.default.APPLICATION_STATE.BACKGROUND}).commit()}const u=new a.Semaphore(1);function p(){return(p=(0,i.default)((function*(){const e=yield u.acquire();try{const{result:t,metric:n}=yield(0,s.getToken)(l.sendIqWithoutRetry);return null!=n&&d(n),t||__LOG__(3)`Couldn't get a private stats token`,t}finally{e.release()}}))).apply(this,arguments)}},13176:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return c.apply(this,arguments)};var i=r(n(48926)),a=n(31914),o=n(71914),s=n(24747);const l=new o.WapParser("uploadStats",(e=>{if(!e.hasChild("error"))return void __LOG__(2)`fieldStatsUpload: success`;const t=e.child("error"),n=t.attrInt("code"),r=t.attrString("text");return __LOG__(3)`fieldStatsUpload: sever response with ${n}, ${r}`,{errorCode:n,errorText:r}}));function c(){return(c=(0,i.default)((function*(e,t){const n=(0,a.wap)("iq",{to:a.S_WHATSAPP_NET,type:"set",xmlns:"w:stats",id:(0,a.generateId)()},(0,a.wap)("add",{t:(0,a.INT)(t)},e));__LOG__(2)`fieldStatsUpload:sendIq start`;const r=yield(0,s.sendIq)(n,l);if(__LOG__(2)`fieldStatsUpload:sendIq end`,!r.success){const{errorCode:e,errorText:t}=r;return __LOG__(3)`fieldStatsUpload: sever response with ${e}, ${t}`,{errorCode:e,errorText:t}}}))).apply(this,arguments)}},66837:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getContactSyncRefreshSeconds=function(){var e;const t=null!==(e=(0,a.default)(s.default,"localStorage").getItem(p.KEYS.CONTACT_SYNC_REFRESH))&&void 0!==e?e:86400;return parseInt(t,10)},t.runSyncDirtyContactsJob=function(){(0,u.getShouldCheckContactSyncStatus)()&&setTimeout((function(){!function(){_.apply(this,arguments)}()}),6e4);(0,u.setShouldCheckContactSyncStatus)()},t.syncNewContact=function(e){h.push(e),f?f.debounce(1e3):(f=new o.ShiftTimer((()=>{if(!(0,u.isRegistered)())return;const e=h;h=[],f=null,__LOG__(2,void 0,void 0,void 0,["contact-sync"])`start new contact sync for ${e.length} contacts`,(0,c.syncContactListInChunks)({contactIds:e,shouldDelayBetweenChunks:!0}).catch((e=>{__LOG__(4,!0,new Error,!0)`contact sync failed`,SEND_LOGS("contact sync failed: "+e)}))})),f.onOrBefore(2e4))};var i=r(n(48926)),a=r(n(45095)),o=n(57319),s=r(n(4285)),l=n(45454),c=n(33192),d=n(76214),u=n(58052),p=n(72407);let f=null,h=[];function _(){return(_=(0,i.default)((function*(){const e=(yield(0,d.getContactTable)().equals(["isContactSyncCompleted"],0)).map((e=>(0,l.createWid)(e.id)));return __LOG__(2,void 0,void 0,void 0,["contact-sync"])`sync dirty contacts, found ${e.length} contacts to sync`,(0,c.syncContactListInChunks)({contactIds:e,shouldDelayBetweenChunks:!0})}))).apply(this,arguments)}},99684:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.queryTosState=function(){return d.apply(this,arguments)},t.resetTosState=function(){return u.apply(this,arguments)},t.updateTosState=function(){return p.apply(this,arguments)};var i=r(n(48926)),a=n(31914),o=n(71914),s=n(92574),l=n(24747);const c=new o.WapParser("tosNotices",(e=>{e.assertTag("iq"),e.assertFromServer();const t=e.child("tos"),n={refresh:t.attrInt("refresh"),notice:[]};return t.forEachChildWithTag("notice",(e=>{const t="false"!==e.maybeAttrString("state"),r=e.attrString("id");n.notice.push({id:r,state:t})})),(n.refresh>259200||n.refresh<7200)&&(n.refresh=86400),n}));function d(){return(d=(0,i.default)((function*(e){const t=(0,a.wap)("iq",{xmlns:"tos",id:(0,a.generateId)(),type:"get",to:a.S_WHATSAPP_NET},(0,a.wap)("request",null,e.map((e=>(0,a.wap)("notice",{id:(0,a.CUSTOM_STRING)(e)}))))),n=yield(0,l.sendIq)(t,c);if(n.success)return n.result;throw new s.ServerStatusCodeError(n.errorCode,n.errorText)}))).apply(this,arguments)}function u(){return(u=(0,i.default)((function*(){}))).apply(this,arguments)}function p(){return(p=(0,i.default)((function*(e){const t=new o.WapParser("tosNoticesSet",(()=>{})),n=(0,a.wap)("iq",{xmlns:"tos",id:(0,a.generateId)(),type:"set",to:a.S_WHATSAPP_NET},(0,a.wap)("request",{type:"session_update"},e.map((e=>(0,a.wap)("notice",{id:(0,a.CUSTOM_STRING)(e)})))));yield(0,l.sendIq)(n,t)}))).apply(this,arguments)}},14892:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.unpairDevice=function(){return u.apply(this,arguments)};var i=r(n(48926)),a=n(31914),o=n(71914),s=n(24747),l=n(99234),c=n(39410);const d=new o.WapParser("unpairResponse",(e=>{e.assertTag("iq"),e.assertFromServer();let t=200;return"error"===e.attrString("type")&&(t=e.child("error").attrInt("code")),{status:t}}));function u(){return(u=(0,i.default)((function*(e){const t=(0,a.wap)("iq",{to:a.S_WHATSAPP_NET,type:"set",id:(0,a.generateId)(),xmlns:"md"},(0,a.wap)("remove-companion-device",{jid:(0,c.DEVICE_JID)((0,l.assertGetMe)()),reason:(0,a.CUSTOM_STRING)(e)})),n=yield(0,s.sendIq)(t,d);return n.success?{status:n.result.status}:{status:n.errorCode}}))).apply(this,arguments)}},46669:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.uploadPreKeys=function(){const e=new a.PromiseRetryLoop({name:"uploadPreKeys",timer:g,code:e=>(0,i.default)((function*(){__LOG__(2)`uploadPreKeys: running`;!0===(yield function(){return _.apply(this,arguments)}()).success?e():__LOG__(2)`uploadPreKeys: retrying (after delay)`}))()});return e.start(),e.promise()};var i=r(n(48926)),a=n(72287),o=n(31914),s=n(71914),l=r(n(64369)),c=n(24747),d=n(58425),u=n(11849),p=n(91335);const f={error:!1,result:!0},h=new s.WapParser("uploadPreKeyResParser",(e=>{e.assertTag("iq"),e.assertFromServer();if(e.attrEnum("type",f))return{success:!0};const t=e.child("error");return{errorCode:t.attrInt("code"),errorText:t.hasAttr("text")?t.attrString("text"):""}}));function _(){return(_=(0,i.default)((function*(){const[e,t]=yield Promise.all([u.waSignalStore.getRegistrationInfo(),u.waSignalStore.getSignedPreKey()]);if(!e||!t)throw new Error("No signal info is available");const{registrationId:n,identityKeyPair:r}=e,[i,a]=yield u.waSignalStore.getOrGenPreKeys(30,d.generatePreKeyPair).then((e=>{if(0===e.length)throw new Error("No preKey is available");return[(0,o.wap)("iq",{id:(0,o.generateId)(),xmlns:"encrypt",type:"set",to:o.S_WHATSAPP_NET},(0,o.wap)("registration",null,(0,o.BIG_ENDIAN_CONTENT)(n)),(0,o.wap)("type",null,l.default.KEY_BUNDLE_TYPE),(0,o.wap)("identity",null,r.pubKey),(0,o.wap)("list",null,e.map(p.xmppPreKey)),(0,p.xmppSignedPreKey)(t)),e[e.length-1].keyId]}));try{const e=yield(0,c.waitForConnection)().then((()=>u.waSignalStore.markKeyAsUploaded(a))).then((()=>(0,c.sendIqWithoutRetry)(i,h)));if(e.success)return u.waSignalStore.setServerHasPreKeys(!0),{success:!0};const t=e.errorCode;return t>=500?__LOG__(3)`_uploadPreKeys: server requested backoff ${t}`:406===t?__LOG__(3)`_uploadPreKeys: uploaded invalid keys`:__LOG__(3)`_uploadPreKeys: unrecognized error ${t}`,{errorCode:e.errorCode,errorText:e.errorText}}catch(e){return void __LOG__(3)`_uploadPreKeys: disconnected, unclear if on server`}}))).apply(this,arguments)}const g={algo:{type:"fibonacci",first:1e3,second:2e3},max:61e4}},15746:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t._waitForMainStream=t._online=void 0,t.handleMessage=function(){return f.apply(this,arguments)},t.waitForOfflineMsgThread=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;if(e)return p.chatQueue.wait(e);return p.allChatQueue.wait()},t.waitForOnlineMsgThread=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;if(e)return u.chatQueue.wait(e);return u.allChatQueue.wait()};var i=r(n(48926)),a=n(27870),o=n(38284),s=n(88102),l=n(28237);const c=2e4,d=new Promise((e=>{s.Cmd.on("main_stream_mode_ready",(()=>{e()}))}));t._waitForMainStream=d;const u={allChatQueue:new a.PromiseQueue,chatQueue:new a.PromiseQueueMap};t._online=u;const p={allChatQueue:new a.PromiseQueue,chatQueue:new a.PromiseQueueMap};function f(){return(f=(0,i.default)((function*(e,t,n){return t&&!l.OfflineMessageHandler.isResumeFromRestartComplete()?p.allChatQueue.enqueue((()=>p.chatQueue.enqueue(e,(()=>(0,o.promiseTimeout)(n(),c))))):(yield d,u.allChatQueue.enqueue((()=>u.chatQueue.enqueue(e,(()=>(0,o.promiseTimeout)(n(),c))))))}))).apply(this,arguments)}},26775:(e,t,n)=>{"use strict";var r=n(95318);t.Z=function(){return b.apply(this,arguments)};var i=r(n(48926)),a=n(52230),o=n(31914),s=r(n(64369)),l=r(n(89867)),c=n(45454),d=n(46308),u=n(58853),p=n(24747),f=n(45033),h=n(97398),_=n(76802),g=n(52083),m=v(n(77605)),y=v(n(45473)),E=n(39410);function S(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(S=function(e){return e?n:t})(e)}function v(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=S(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}return r.default=e,n&&n.set(e,r),r}const{VOIP_LOG_COLOR:T}=s.default;function b(){return(b=(0,i.default)((function*(e,t){const n=e.common,r=(0,c.createWid)(n.peer_jid);if(l.default.isGroupCall(r))return C((0,o.CUSTOM_STRING)(n.peer_jid),r,e);try{return C(yield P(e,r,t),r,e)}catch(e){__LOG__(3)`voip:encryptAndSendSignalingMsg: Failed to encrypt and send msg`}}))).apply(this,arguments)}function C(){return A.apply(this,arguments)}function A(){return(A=(0,i.default)((function*(e,t,n){const r=(0,E.voipXmlToWapNode)(n.payload),i=(0,o.generateId)(),a=(0,o.wap)("call",{to:e,id:i},r);yield(0,g.getSignalProtocolStore)().flushBufferToDiskIfNotMemOnlyMode();const s=yield(0,p.sendStanzaAndReturnAck)(a,{id:String(i),class:"call",from:t,participant:null});return{payload:(0,E.wapNodeToVoipXml)(s),status:200}}))).apply(this,arguments)}function P(){return M.apply(this,arguments)}function M(){return(M=(0,i.default)((function*(e,t,n){const r=e.payload[2].findIndex((e=>"destination"===e[0])),o=e.payload[2][r];if(o){e.payload[0]!==y.TYPE_STR.OFFER&&(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("call offer check"));const n=o[2].map((e=>(0,c.createDeviceWidFromUserAndDevice)(e[1].jid.user,e[1].jid.device)));try{yield(0,h.ensureE2ESessions)(n)}catch(e){__LOG__(3)`voip:encryptMsgCallKey: Could not establish E2E session with all deviceWids`}let r=!1,a=!1;return yield Promise.all(o[2].map(function(){var t=(0,i.default)((function*(t,i){if(O(t[2])){const o=D(t[2]),s=n[i];try{const{encNode:n,shouldHaveIdentity:r}=yield L(o,s,R(e.payload[2]));a=a||r,w(t[2],n)}catch(e){__LOG__(3)`voip:encryptMsgCallKey: Signal encryption failed for ${s.toString()}, ${e}`,r=!0}}}));return function(){return t.apply(this,arguments)}}())),r?(__LOG__(3)`voip:encryptMsgCallKey: Removing all enc nodes due to encryption failure`,o[2].forEach((e=>I(e)))):a&&(yield k(e.payload[2])),(0,E.USER_JID)(t)}if(!O(e.payload[2]))return(0,E.DEVICE_JID)(t);try{const e=[t];if(t.isCompanion()){const n=(0,c.createDeviceWidFromUserAndDevice)(t.user,a.DEFAULT_DEVICE_ID);e.unshift(n)}yield(0,h.ensureE2ESessions)(e)}catch(e){__LOG__(3)`voip:encryptAndSendSignalingMsg: Could not establish E2E session with deviceWid`}const s=D(e.payload[2]);let l,d;try{const n=yield L(s,t,R(e.payload[2]));l=n.encNode,d=n.shouldHaveIdentity}catch(e){if(n!==y.TYPE.OFFER)throw e;l=null,d=!1,__LOG__(3)`voip:encryptAndSendSignalingMsg: Sending offer without enc`}return w(e.payload[2],l),d&&(yield k(e.payload[2])),(0,E.DEVICE_JID)(t)}))).apply(this,arguments)}function O(e){if(null==e)return!1;return e.findIndex((e=>"enc"===e[0]))>=0}function I(e){if(null==e)return;const t=e.findIndex((e=>"enc"===e[0]));e.splice(t,1)}function w(e,t){const n=e.findIndex((e=>"enc"===e[0]));n>=0&&(e[n]=t)}function R(e){var t;const n=e.find((e=>"enc"===e[0])),r=null==n||null===(t=n[1])||void 0===t?void 0:t.count;return null!=r?r:0}function D(e){const t=e.find((e=>"enc"===e[0])),n=null==t?void 0:t[2];return{call:{callKey:new Uint8Array(n)}}}function L(){return N.apply(this,arguments)}function N(){return(N=(0,i.default)((function*(e,t,n){const{type:r,ciphertext:i}=yield m.Cipher.encryptSignalProto(t,(0,_.encodeAndPad)(e));return{encNode:(0,o.wap)("enc",{v:(0,o.CUSTOM_STRING)(u.CIPHERTEXT_VERSION.toString()),type:(0,o.CUSTOM_STRING)(r),count:(0,o.INT)(n)},i),shouldHaveIdentity:r===f.CiphertextType.Pkmsg}}))).apply(this,arguments)}function k(){return U.apply(this,arguments)}function U(){return(U=(0,i.default)((function*(e){const t=yield(0,d.getADVEncodedIdentity)();e.push((0,o.wap)("device-identity",null,t))}))).apply(this,arguments)}},77723:(e,t,n)=>{"use strict";var r=n(95318);t.Z=function(){return s.apply(this,arguments)};var i=r(n(48926)),a=n(55253),o=n(11849);function s(){return(s=(0,i.default)((function*(e){var t;const n=yield o.waSignalStore.getRegistrationInfo();if(!n)throw Error("No registration info found");const{identityKeyPair:r}=n,i=null!==(t=e[1]&&parseInt(e[1].count,10))&&void 0!==t?t:0,s=yield(0,a.prepareKeysForRetry)(i,r);return s&&e[2]&&Array.isArray(e[2])&&e[2].push(s),e}))).apply(this,arguments)}},25662:(e,t,n)=>{"use strict";var r=n(95318);t.Z=function(){return d.apply(this,arguments)};var i=r(n(48926)),a=n(31914),o=n(45454),s=n(24747),l=n(97398),c=n(39410);function d(){return(d=(0,i.default)((function*(e){const t=e.common,n=(0,o.createWid)(t.peer_jid);let r,i;n.isGroupCall()?(r=(0,c.GROUP_CALL_JID)(n),i=Promise.resolve()):(r=(0,c.DEVICE_JID)(n),i=(0,l.ensureE2ESessions)([n])),yield i;const d=(0,c.voipXmlToWapNode)(e.payload),u=(0,a.generateId)(),p=(0,a.wap)("call",{to:r,id:u},d),f=yield(0,s.sendStanzaAndReturnAck)(p,{id:String(u),class:"call",from:n,participant:null});return{payload:(0,c.wapNodeToVoipXml)(f),status:200}}))).apply(this,arguments)}},64254:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return d.apply(this,arguments)};var i=r(n(48926)),a=n(31914),o=n(24747),s=n(11849),l=n(45473),c=n(39410);function d(){return(d=(0,i.default)((function*(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const r=yield s.waSignalStore.getRegistrationInfo();if(!r)throw Error("No registration info found");const i=(0,a.wap)("receipt",{to:(0,c.DEVICE_JID)(t.peer_jid),id:(0,a.CUSTOM_STRING)(e),type:(0,a.CUSTOM_STRING)(l.ENC_RETRY_RECEIPT_ATTRS.GROUP_CALL)},(0,a.wap)("enc_rekey",{"call-creator":(0,c.DEVICE_JID)(t.call_creator),"call-id":(0,a.CUSTOM_STRING)(t.call_id),count:(0,a.INT)(n+1)}),(0,a.wap)("registration",null,(0,a.BIG_ENDIAN_CONTENT)(r.registrationId)));(0,o.castStanza)(i)}))).apply(this,arguments)}},84590:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return y.apply(this,arguments)};var i=r(n(48926)),a=n(50796),o=n(52230),s=r(n(45095)),l=n(84902),c=r(n(41143)),d=n(46308),u=n(24808),p=n(8001),f=n(49714),h=n(45033),_=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=m(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(77605)),g=n(93832);function m(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(m=function(e){return e?n:t})(e)}function y(){return(y=(0,i.default)((function*(e,t){var n;const r=t.payload[2]&&t.payload[2].find((e=>"enc"===e[0])),i=e.peer_jid;if(!r||!i)return{result:f.E2EProcessResult.SUCCESS};let a=0;(null===(n=r[1])||void 0===n?void 0:n.count)&&(a=parseInt(r[1].count,10)||0);const l={e2eType:r[1].type,mediaType:null,ciphertext:new Uint8Array(r[2]),retryCount:a,hideFail:!1};try{const e=t.payload[2].find((e=>"device-identity"===e[0]));if(null!=i.device&&i.device!==o.DEFAULT_DEVICE_ID&&l.e2eType===h.CiphertextType.Pkmsg&&!e)return __LOG__(2)`voip:validateAndDecryptEnc: expected device-identity with pkmsg enc`,{result:f.E2EProcessResult.PARSE_ERROR};if(e){const t=new Uint8Array(e[2]);if(!(yield(0,d.validateADVwithEncs)(i,t,[l])))return{result:f.E2EProcessResult.PARSE_ERROR};__LOG__(2)`voip:validateAndDecryptEnc: successfully validated ADV device-identity`}const{result:n,decrypted:c}=yield E(l,i);return n===f.E2EProcessResult.SUCCESS&&(r[2]=Array.prototype.slice.call(new Uint8Array((0,s.default)(c,"decrypted")))),{result:n,retryCount:a}}catch(e){return __LOG__(3)`voip:validateAndDecryptEnc error`,{result:f.E2EProcessResult.PARSE_ERROR}}}))).apply(this,arguments)}function E(e,t){return(0,c.default)(e.e2eType!==h.CiphertextType.Skmsg,"VoIP enc type should not be skmsg"),_.Cipher.decryptSignalProto(t,e.e2eType,e.ciphertext).then((e=>{var t;const n=(0,g.unpad)(e),r=(0,l.decodeProtobuf)(u.MessageSpec,n);return(null===(t=r.call)||void 0===t?void 0:t.callKey)?{result:f.E2EProcessResult.SUCCESS,decrypted:r.call.callKey}:{result:f.E2EProcessResult.PARSE_ERROR}})).catch((0,a.filteredCatch)(p.SignalDecryptionError,(e=>(__LOG__(3)`voip:decryptSignalProto failed with decryption error; ${e}`,{result:f.E2EProcessResult.RETRY})))).catch((e=>(__LOG__(3)`voip:decryptSignalProto failed with unexpected error; ${e}`,{result:f.E2EProcessResult.PARSE_ERROR})))}},4182:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SYNC_CONTACT_CHUNK_INTERVAL_SECONDS=t.CONTACT_SYNC_CHUNK_SIZE=void 0;t.CONTACT_SYNC_CHUNK_SIZE=500;t.SYNC_CONTACT_CHUNK_INTERVAL_SECONDS=20},33192:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.syncContactList=A,t.syncContactListInChunks=function(){return C.apply(this,arguments)};var i=r(n(48926)),a=r(n(45095)),o=n(13959),s=n(92844),l=n(72441),c=r(n(4285)),d=n(69315),u=n(45454),p=n(4182),f=n(91036),h=n(9108),_=n(53379),g=n(54181),m=n(41566),y=n(76214),E=n(72407),S=n(46133),v=n(79942),T=n(52284),b=n(92027);function C(){return(C=(0,i.default)((function*(e){let{contactIds:t,shouldDelayBetweenChunks:n}=e;const r=p.CONTACT_SYNC_CHUNK_SIZE;__LOG__(2,void 0,void 0,void 0,["contact-sync"])`start contact sync for ${t.length} contacts in ${Math.ceil(t.length/r)} chunks, each chunk size: ${r}`;for(let e=0;e<t.length;e+=r){const i=t.slice(e,e+r);n&&(yield(0,o.delayMs)(1e3*p.SYNC_CONTACT_CHUNK_INTERVAL_SECONDS)),yield A({contactIds:i,shouldSyncDevice:!0})}}))).apply(this,arguments)}function A(){return P.apply(this,arguments)}function P(){return(P=(0,i.default)((function*(e){let{contactIds:t,shouldSyncDevice:n}=e;if(0===t.length)return;const r=yield U(t),i=(new T.USyncQuery).withContext("background").withMode("full").withBusinessProtocol().withStatusProtocol().withPictureProtocol();n&&i.withDeviceProtocol(),(0,m.isDisappearingModeEnabled)()&&i.withDisappearingModeProtocol(),r.forEach((e=>{i.withUser((new v.USyncUser).withId(e.id).withDeviceHash(String(e.hash)))}));let a=null,s=3,l=10*Math.random();for(;s-- >0;)try{a=yield i.execute();const e=a.error.all;var c;if(e)throw l=null!==(c=e.errorBackoff)&&void 0!==c?c:10*Math.random(),new Error(`syncContactList: error ${e.errorCode}: ${e.errorText}`);s=0}catch(e){0===s&&(__LOG__(4,!0,new Error,!0)`failed to execute usync query`,SEND_LOGS("failed to execute usync query: "+e)),yield(0,o.delayMs)(1e3*l)}if(null==a||a.error.all)return;const d=a.refresh,u=[];for(const e of Object.keys(d))u.push(d[e]);if(u.length>0){x(Math.min(...u))}yield Promise.all([n?N(a):Promise.resolve(),(0,m.isDisappearingModeEnabled)()?O(a):Promise.resolve(),M(a),w(a),D(a)]),yield L(t)}))).apply(this,arguments)}function M(e){const t=e.error.status;t?__LOG__(3)`handleSyncStatus: failed ${t.errorCode} : ${t.errorText}`:e.list.map((e=>{const t=S.StatusCollection.get(e.id);t&&e.status&&t.set({status:e.status})}))}function O(){return I.apply(this,arguments)}function I(){return(I=(0,i.default)((function*(e){const t=e.error.status;t?__LOG__(3)`handleDisappearingMode: failed ${t.errorCode} : ${t.errorText}`:yield Promise.all(e.list.map(function(){var e=(0,i.default)((function*(e){e.disappearing_mode&&(yield(0,f.updateDisappearingMode)(e.id,e.disappearing_mode.duration,e.disappearing_mode.t))}));return function(){return e.apply(this,arguments)}}()))}))).apply(this,arguments)}function w(){return R.apply(this,arguments)}function R(){return(R=(0,i.default)((function*(e){const t=e.list.filter((e=>{let{business:t}=e;return Boolean(t)}));yield(0,b.handleVerifiedNameSync)(t.map((e=>{let{id:t,business:{verifiedName:n}}=e;return{id:t,verifiedName:n}})))}))).apply(this,arguments)}function D(e){const t=e.error.pictures;t&&__LOG__(3)`handleSyncProfilePictures: failed ${t.errorCode} : ${t.errorText}`}function L(e){const t=e.map((e=>({id:(0,l.toPhoneUserJid)(e.user),isContactSyncCompleted:1})));return __LOG__(2,void 0,void 0,void 0,["contact-sync"])`mark ${t.length} contacts completed for contact sync`,(0,y.getContactTable)().bulkCreateOrMerge(t)}function N(){return k.apply(this,arguments)}function k(){return(k=(0,i.default)((function*(e){const t=e.error.devices;t&&__LOG__(3)`handleSyncDevice: error ${t.errorCode}: ${t.errorText}`;const n=e.list.filter((e=>e.devices&&null!=e.devices.deviceList&&null!=e.devices.keyIndex&&!("errorCode"in e.devices))).map((e=>({wid:e.id,devices:e.devices})));return __LOG__(2)`handleSyncDevice: skipping ${e.list.length-n.length} out of ${e.list.length} records`,yield(0,_.getAndStoreIdentityKeys)(n.map((e=>e.wid))),(0,g.handleADVDeviceSyncResult)(n)}))).apply(this,arguments)}function U(){return G.apply(this,arguments)}function G(){return(G=(0,i.default)((function*(e){const t=e.map((e=>e.user)),n=(yield(0,h.getDeviceIds)(t)).map((e=>e?e.devices.map((t=>(0,u.createDeviceWidFromUserAndDevice)(e.id,t))):[])),r=yield Promise.all(n.map((e=>0===e.length?"":(0,d.phashV2)(e))));return e.map(((e,t)=>({id:e,hash:r[t]})))}))).apply(this,arguments)}function x(e){Number.isNaN(e)||e<=s.HOUR_SECONDS?__LOG__(3,void 0,void 0,void 0,["contact-sync"])`invalid contact sync refresh period: ${e}`:(__LOG__(2,void 0,void 0,void 0,["contact-sync"])`set contact sync refresh period: ${e}`,(0,a.default)(c.default,"localStorage").setItem(E.KEYS.CONTACT_SYNC_REFRESH,String(e)))}},60764:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.STORAGE_ALERT_TYPE=void 0;const r=n(76672)({LOW_QUOTA_EXCEEDED:"low_quota_exceed",HIGH_QUOTA_EXCEEDED:"high_quota_exceed",NO_ALERT:"no_alert"});t.STORAGE_ALERT_TYPE=r},63236:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return a.apply(this,arguments)};var i=r(n(48926));function a(){return(a=(0,i.default)((function*(){const e=navigator.storage;if(null==(null==e?void 0:e.estimate))return null;const t=yield e.estimate();let{usage:n,quota:r,usageDetails:i}=t;Number.isFinite(n)||(n=0),Number.isFinite(r)||(r=0);return{usage:n,quota:r,available:r-n,caches:null==i?void 0:i.caches}}))).apply(this,arguments)}},46920:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GROUP_PARTICIPANT_TYPES=void 0;t.GROUP_PARTICIPANT_TYPES={superadmin:"superadmin",admin:"admin",participant:"participant"}},18615:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addParticipants=function(){return u.apply(this,arguments)},t.demoteParticipants=function(e){let{group:t,participants:n,version:r,prevVersion:i}=e;return p(l.PARTICIPANT_OPERATION.DEMOTE,t,n,r,i)},t.participantsAction=p,t.promoteParticipants=function(e){let{group:t,participants:n,version:r,prevVersion:i}=e;return p(l.PARTICIPANT_OPERATION.PROMOTE,t,n,r,i)},t.removeParticipants=function(e){let{group:t,participants:n,version:r,prevVersion:i}=e;return p(l.PARTICIPANT_OPERATION.REMOVE,t,n,r,i)},t.updateParticipants=function(){return d.apply(this,arguments)};var i=r(n(48926)),a=n(45454),o=n(64114),s=n(51727),l=n(70405),c=n(97153);function d(){return(d=(0,i.default)((function*(e){let{group:t,participants:n,version:r,isOffline:i}=e;const a=[],o=[];n.forEach((e=>{e.isAdmin&&o.push(e.id),a.push(e.id)}));const l=yield f(a,i);return(0,s.replaceParticipants)({group:t,participants:a,admins:o,deviceIds:l,version:r})}))).apply(this,arguments)}function u(){return(u=(0,i.default)((function*(e){let{group:t,participants:n,version:r,prevVersion:i,isOffline:a}=e;if(null==r)throw new Error("addParticipants: incoming change missing version id");const o=yield f(n,a);return(0,s.updateParticipants)(t,{action:l.PARTICIPANT_OPERATION.ADD,participants:n,deviceIds:o,version:r,prevVersion:i})}))).apply(this,arguments)}function p(e,t,n,r,i){return null==r?Promise.reject(new Error(`participantsAction with action = ${e}: incoming change missing version id`)):(0,s.updateParticipants)(t,{action:e,participants:n,version:r,prevVersion:i})}function f(){return h.apply(this,arguments)}function h(){return(h=(0,i.default)((function*(e,t){let n=[];if(t)return yield(0,c.addUserToPendingDeviceSync)(e.map((e=>String(e)))),e;n=yield(0,o.syncAndGetDeviceList)(e);let r=[];return n.forEach(((t,n)=>{if(t){const{devices:e,id:n}=t;r=r.concat(e.map((e=>(0,a.createDeviceWidFromUserAndDevice)(n,e))))}else r.push(e[n])})),r}))).apply(this,arguments)}},2182:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.extractDescription=h,t.extractLinkedParent=_,t.parseGroupNode=g,t.queryGroup=function(){return y.apply(this,arguments)};var i=r(n(48926)),a=r(n(81109)),o=n(31914),s=n(71914),l=n(92574),c=n(81663),d=n(45454),u=n(24747),p=n(46920),f=n(39410);function h(e){if(e.hasChild("description")){const t=e.child("description");if(t.hasChild("body")){const e=t.child("body");if(e.hasContent()){const n={desc:e.contentString(),descId:t.attrString("id")};return t.hasAttr("participant")&&(n.descOwner=(0,c.userJidToUserWid)(t.attrPhoneUserJid("participant"))),t.hasAttr("t")&&(n.descTime=t.attrTime("t")),n}}}return null}function _(e){const t=e.maybeChild("linked_parent"),n=null==t?void 0:t.maybeAttrGroupJid("jid");return null==n?null:{parentGroup:(0,c.groupJidToWid)(n)}}function g(e){var t,n,r;const i=h(e),o=function(e){const t={subject:e.attrString("subject")};return e.hasAttr("s_o")&&(t.subjectOwner=(0,c.userJidToUserWid)(e.attrPhoneUserJid("s_o"))),e.hasAttr("s_t")&&(t.subjectTime=e.attrTime("s_t")),t}(e),s=function(e){if(e.hasChild("ephemeral")){const t=e.child("ephemeral");if(t.hasAttr("expiration"))return{ephemeralDuration:t.attrInt("expiration")}}return null}(e),l=function(e){const t=e.maybeChild("growth_locked"),n=null==t?void 0:t.maybeAttrInt("expiration"),r=null==t?void 0:t.maybeAttrString("type");return null==n||null==r?null:{growthLockExpiration:n,growthLockType:r}}(e),u=_(e);let f;try{f=(0,d.createWid)(`${e.attrString("id")}@g.us`)}catch(e){}if(!(null===(t=f)||void 0===t?void 0:t.isGroup))throw Error("createGroupReplyParser: invalid group id");const g=e.mapChildrenWithTag("participant",(e=>{const t=e.attrEnumOrDefault("type",p.GROUP_PARTICIPANT_TYPES,p.GROUP_PARTICIPANT_TYPES.participant);return{id:(0,c.userJidToUserWid)(e.attrPhoneUserJid("jid")),isSuperAdmin:t===p.GROUP_PARTICIPANT_TYPES.superadmin,isAdmin:t===p.GROUP_PARTICIPANT_TYPES.admin||t===p.GROUP_PARTICIPANT_TYPES.superadmin}})),m={id:f,owner:e.hasAttr("creator")?(0,c.userJidToUserWid)(e.attrPhoneUserJid("creator")):void 0,creation:e.attrTime("creation"),restrict:e.hasChild("locked"),announce:e.hasChild("announcement"),noFrequentlyForwarded:e.hasChild("no_frequently_forwarded"),participants:g,pvId:e.hasAttr("p_v_id")?e.attrInt("p_v_id"):void 0,support:e.hasChild("support"),size:e.hasAttr("size")?e.attrInt("size"):void 0,suspended:e.hasChild("suspended"),isParentGroup:null!==(n=e.hasChild("parent"))&&void 0!==n?n:void 0,defaultSubgroup:null!==(r=e.hasChild("default_sub_group"))&&void 0!==r?r:void 0};return(0,a.default)((0,a.default)((0,a.default)((0,a.default)((0,a.default)((0,a.default)({},m),i),s),l),o),u)}const m=new s.WapParser("queryGroupParser",(e=>e.hasChild("group")?g(e.child("group")):{phashMatch:!0}));function y(){return(y=(0,i.default)((function*(e){const{groupWid:t,request:n,phash:r}=e,i=(0,o.wap)("iq",{to:(0,f.GROUP_JID)(t),type:"get",xmlns:"w:g2",id:(0,o.generateId)()},(0,o.wap)("query",{request:n||o.DROP_ATTR,phash:(0,o.MAYBE_CUSTOM_STRING)(r)})),a=yield(0,u.sendIq)(i,m);if(!a.success)return __LOG__(2)`queryGroup failed: ${a.errorCode}:${a.errorType}`,Promise.reject(new l.ServerStatusCodeError(a.errorCode,a.errorText));const{result:s}=a;return s.phashMatch?Promise.reject(new Error("queryGroup: phash match case is not implemented!")):s}))).apply(this,arguments)}},46308:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.clearADVSecretKey=function(){(0,m.setADVSecretKey)(void 0)},t.generateADVSecretKey=function(){const e=new Uint8Array(32);self.crypto.getRandomValues(e);const t=(0,a.encodeB64)(e);return(0,m.setADVSecretKey)(t),t},t.generateDeviceSignature=function(e,t,n){const r=e.details,i=o.Binary.build(M,r,t.pubKey,n).readByteArray().buffer;return window.libsignal.Curve.calculateSignature(t.privKey,i)},t.getADVEncodedIdentity=function(){return I.apply(this,arguments)},t.getADVSecretKey=function(){const e=(0,m.getADVSecretKey)();if(null==e)throw new Error("MD secretKey is null or undefined");return e},t.setADVSignedIdentity=function(e){if(null==e)return Promise.reject(new Error("MD advSignedDeviceIdentity is null or undefined"));if(null==e.deviceSignature)return Promise.reject(new Error("MD advSignedDeviceIdentity is missing deviceSignature"));return S.waSignalStore.putADVSignedIdentity(e)},t.validateADVwithEncs=function(){return A.apply(this,arguments)},t.validateADVwithIdentityKey=b,t.verifyDeviceIdentityAccountSignature=w,t.verifyDeviceSignature=R,t.verifyKeyIndexListAccountSignature=function(e,t){const n=e.details,r=e.accountSignature;(0,u.default)(null!=r,"accountSignature should not be null");const i=o.Binary.build(O,n).readByteArray();return(0,f.verifySignature)(new Uint8Array(t),i,new Uint8Array(r))};var i=r(n(48926)),a=n(15688),o=n(8584),s=n(51239),l=n(45454),c=n(84902),d=n(60980),u=r(n(41143)),p=n(61438),f=n(53614),h=n(57701),_=n(54181),g=n(45033),m=n(58052),y=r(n(76128)),E=n(52083),S=n(11849),v=n(91335),T=n(93832);function b(){return C.apply(this,arguments)}function C(){return(C=(0,i.default)((function*(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];try{const i=(0,s.uint8ArrayToBuffer)(n),a=yield(0,E.getSignalProtocolStore)().loadIdentityKey((0,T.createSignalAddress)(e).toString());if(a){const e=(0,f.toCurveKeyPubKey)((0,T.strToBuffer)(a));if((0,T.bufferEqual)(e,i))return!0}const o=(0,c.decodeProtobuf)(p.ADVSignedDeviceIdentitySpec,t);(0,u.default)(null!=o,"advSignedDeviceIdentity should not be null");const d=yield y.default.loadIdentityKey((0,T.createSignalAddress)((0,l.toUserWid)(e)).toString()),h=d?(0,f.toCurveKeyPubKey)((0,T.strToBuffer)(d)):null;if(!w(o,i,h))return __LOG__(3)`validateADVIdentity: invalid account signature`,!1;if(!R(o,i,h))return __LOG__(3)`validateADVIdentity: invalid device signature`,!1;const g=(0,c.decodeProtobuf)(p.ADVDeviceIdentitySpec,o.details);(0,u.default)(null!=g,"advDeviceIdentity should not be null");try{yield(0,_.handleADVDeviceUpdateForMessage)(e,g,h,o.accountSignatureKey,i,r)}catch(e){return __LOG__(3)`validateADVIdentity: process adv device identity failed`,!1}return __LOG__(2)`validateADVIdentity: successfully verified accountSignature and deviceSignature`,!0}catch(e){return __LOG__(3)`validateADVIdentity: failed`,!1}}))).apply(this,arguments)}function A(){return(A=(0,i.default)((function*(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const i=n.find((e=>e.e2eType===g.CiphertextType.Pkmsg));if(!i)return!0;__LOG__(2)`validateADVwithEncs: start validate prekey msg `;try{(0,u.default)(null!=e,"author should not be null");const n=(0,v.extractIdentityKey)(i.ciphertext);(0,u.default)(null!=n,"identityKey should not be null");const a=yield b(e,t,new Uint8Array(n),r);return(0,h.identityStoreCacheEnabled)()&&(yield(0,E.getSignalProtocolStore)().flushBufferToDiskIfNotMemOnlyMode()),a}catch(e){return __LOG__(3)`validateADVwithEncs: failed ${e}`,!1}}))).apply(this,arguments)}const P=new Uint8Array([6,0]),M=new Uint8Array([6,1]),O=new Uint8Array([6,2]);function I(){return(I=(0,i.default)((function*(){const e=yield S.waSignalStore.getADVSignedIdentity();if(null==e)throw new Error("MD advSignedDeviceIdentity is null or undefined");if(null==e.deviceSignature)throw new Error("MD advSignedDeviceIdentity is missing deviceSignature");return(0,d.encodeProtobuf)(p.ADVSignedDeviceIdentitySpec,e).readByteArray()}))).apply(this,arguments)}function w(e,t,n){const r=e.details,i=e.accountSignatureKey||n;(0,u.default)(null!=i,"accountSignatureKey should not be null");const a=e.accountSignature;(0,u.default)(null!=a,"accountSignature should not be null");const s=o.Binary.build(P,r,t).readByteArray();return(0,f.verifySignature)(new Uint8Array(i),s,new Uint8Array(a))}function R(e,t,n){const r=e.details,i=e.deviceSignature;(0,u.default)(null!=i,"deviceSignature should not be null");const a=e.accountSignatureKey||n;(0,u.default)(null!=a,"accountSignatureKey should not be null");const s=o.Binary.build(M,r,t,a).readByteArray();return(0,f.verifySignature)(new Uint8Array(t),s,new Uint8Array(i))}},18634:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.computeIdentityHash=y,t.getICDCMeta=function(){return m.apply(this,arguments)};var i=r(n(48926)),a=n(73045),o=n(52230),s=r(n(45095)),l=n(27764),c=n(92844),d=n(45454),u=n(57849),p=n(53614),f=n(9108),h=n(99234),_=r(n(76128)),g=n(56592);function m(){return(m=(0,i.default)((function*(e){if(!1===(0,u.getABPropConfigValue)("md_icdc_enabled"))return null;const t=yield(0,f.getDeviceRecord)(e.user);if(!t||t.deleted)return null;const n={keyHash:void 0,timestamp:void 0},{timestamp:r,devices:i}=t,a=i.some((e=>e.id!==o.DEFAULT_DEVICE_ID));if(a){const r=i.map((e=>[e.keyIndex,(0,d.createDeviceWidFromUserAndDevice)(t.id,e.id)])),a=[],o=(0,h.assertGetMe)();let l=null;r.forEach((e=>{let[t,n]=e;n.equals(o)?l=t:a.push([t,n])}));const c=yield(0,g.getAllIdentityKeysBytes)(a.map((e=>{let[,t]=e;return t}))),u=[],f=[];if(c.forEach(((e,t)=>{null!=e&&(u.push(e),f.push(a[t][0]))})),o.user===e.user){const e=yield _.default.getIdentityKeyPair();if(!e)return null;u.push(new Uint8Array(e.pubKey)),f.push((0,s.default)(l,"myKeyIndex"))}const m=S();n.keyHash=yield y(u.map((e=>new Uint8Array((0,p.toCurveKeyPubKey)(e.buffer)))),m),f.length!==i.length&&(n.keyIndexes=f)}return(a||v(r))&&(n.timestamp=r),n}))).apply(this,arguments)}function y(){return E.apply(this,arguments)}function E(){return(E=(0,i.default)((function*(e,t){const n=(0,g.identityKeysToBinary)(e),r=yield(0,a.sha256)(n),i=new Uint8Array(r);return(0,l.sliceBytes)(i,0,t)}))).apply(this,arguments)}function S(){const e=(0,u.getABPropConfigValue)("md_icdc_hash_length");return Math.max(e,8)}function v(e){return(0,c.unixTime)()-e<2592e3}},56592:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getAllIdentityKeysBytes=d,t.getAllIdentityKeysBytesOrThrow=function(){return c.apply(this,arguments)},t.identityKeysToBinary=function(e){const t=new a.Binary;return e.sort(l).forEach((e=>{t.writeByteArray(e)})),t.readByteArray()};var i=r(n(48926)),a=n(8584),o=r(n(76128)),s=n(93832);function l(e,t){for(let n=0;n<e.length&&n<t.length;++n)if(e[n]!==t[n])return e[n]-t[n];return e.length-t.length}function c(){return(c=(0,i.default)((function*(e){return(yield d(e)).map(((t,n)=>{if(null==t)throw new Error(`getAllIdentityKeys: missing identity key for device ${String(e[n])}`);return t}))}))).apply(this,arguments)}function d(){return u.apply(this,arguments)}function u(){return(u=(0,i.default)((function*(e){return(yield o.default.bulkLoadIdentityKey(e.map((e=>(0,s.createSignalAddress)(e).toString())))).map((e=>null==e?null:new Uint8Array((0,s.strToBuffer)(e))))}))).apply(this,arguments)}},76802:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.RESEND_TIMEOUT_IN_SECONDS=void 0,t.createResendAbortMetric=function(e,t,n){const r=(0,i.default)({e2eBackfill:!0,messageIsRevoke:e,messageSendResultIsTerminal:!1,isViewOnce:t},(0,g.getGroupMetricsFromChatWid)(n));return new E.default.MessageSend(r)},t.editAttribute=function(e,t){if(T(e)){const e="admin_revoke"===t?c.EDIT_ATTR.ADMIN_REVOKE:c.EDIT_ATTR.SENDER_REVOKE;return(0,s.CUSTOM_STRING)(String(e))}if(b(e))return(0,s.CUSTOM_STRING)(String(c.EDIT_ATTR.SENDER_REVOKE));return s.DROP_ATTR},t.encodeAndPad=function(e){const t=(0,p.encodeProtobuf)(f.MessageSpec,e);return(0,v.writeRandomPadMax16)(t),t.readByteArray()},t.filterDeviceWithChangedIdentity=function(){return M.apply(this,arguments)},t.isPrimaryDevice=function(e){return null==e.device||e.device===o.DEFAULT_DEVICE_ID},t.isRevokeMsg=T,t.isRevokeReactionMsg=b,t.populateICDCMeta=function(){return A.apply(this,arguments)},t.sendMsgAckSyncParser=void 0,t.updateIdentityRange=function(){return P.apply(this,arguments)};var i=r(n(81109)),a=r(n(48926)),o=n(52230),s=n(31914),l=n(71914),c=n(35470),d=n(67811),u=n(45454),p=n(60980),f=n(24808),h=n(99234),_=n(6565),g=n(42515),m=n(18634),y=n(90981),E=r(n(11339)),S=r(n(76128)),v=n(93832);function T(e){return null!=e.protocolMessage&&e.protocolMessage.type===f.Message$ProtocolMessageType.REVOKE}function b(e){return null!=e.reactionMessage&&e.reactionMessage.text===d.REVOKED_REACTION_TEXT}t.RESEND_TIMEOUT_IN_SECONDS=300;const C=new l.WapParser("sendMsgAckSyncParser",(e=>(e.assertTag("ack"),{t:e.attrTime("t"),sync:e.hasAttr("sync")?e.attrString("sync"):null,phash:e.hasAttr("phash")?e.attrString("phash"):null,count:e.hasAttr("count")?e.attrInt("count"):null})));function A(){return(A=(0,a.default)((function*(e,t){const n=(0,h.getMeUser)();let r,i;try{r=yield(0,m.getICDCMeta)(n)}catch(e){throw new E.default.AdvMetadataCreationFailure({advMetadataIsMe:!0}).commit(),e}try{i=e.equals(n)?null:yield(0,m.getICDCMeta)(e)}catch(e){throw new E.default.AdvMetadataCreationFailure({advMetadataIsMe:!1}).commit(),e}(0,_.populateMessageContextInfo)(t,r,i)}))).apply(this,arguments)}function P(){return(P=(0,a.default)((function*(e,t){const n=yield(0,y.getTable)().get(String(e),!1);null!=(null==n?void 0:n.rowId)&&(yield S.default.updateIdentityRangeAfterEncryption(n.rowId,t.map((e=>(0,v.createSignalAddress)(e).toString()))))}))).apply(this,arguments)}function M(){return(M=(0,a.default)((function*(e,t){const n=yield(0,y.getTable)().get(String(e),!1),r=null==n?void 0:n.rowId;if(null==r)return __LOG__(2)`filterDeviceWithChangedIdentity: get message with empty rowId`,[];const i=new Set;t.forEach((e=>{i.add(e.user)}));const a=Array.from(i).map((e=>(0,u.createDeviceWidFromUserAndDevice)(e,o.DEFAULT_DEVICE_ID))),s=yield S.default.bulkGetIdentityRowId(a.map((e=>(0,v.createSignalAddress)(e).toString()))),l=new Set;return s.forEach(((e,t)=>{const n=a[t];(null==e||e>r)&&l.add(n.user)})),t.filter((e=>!l.has(e.user)))}))).apply(this,arguments)}t.sendMsgAckSyncParser=C},64114:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.syncAndGetDeviceList=function(){return S.apply(this,arguments)},t.syncDeviceList=_,t.syncMyDeviceList=function(){return E.apply(this,arguments)};var i=r(n(48926)),a=r(n(94654)),o=n(69315),s=n(45454),l=n(9108),c=n(99234),d=n(53379),u=n(54181),p=n(79942),f=n(52284);const h=new Map;function _(){return g.apply(this,arguments)}function g(){return(g=(0,i.default)((function*(e){let{wids:t,context:n,phash:r}=e;if(null!=r){const e=t.map((e=>e.user)),n=(yield(0,l.getDeviceIds)(e)).map((e=>e?e.devices.map((t=>(0,s.createDeviceWidFromUserAndDevice)(e.id,t))):[])),i=(0,a.default)(n,(e=>e));if(r===(yield(0,o.phashV2)(i)))return}const i=new Set,c=[];if(t.forEach((e=>{const t=h.get(e.user);t?i.add(t):c.push(e)})),0===c.length)return void(yield Promise.all(Array.from(i)));const d=m(c.map((e=>e.user)),c,n);c.map((e=>{h.set(e.user,d)})),yield Promise.all([d,...Array.from(i)])}))).apply(this,arguments)}function m(){return y.apply(this,arguments)}function y(){return(y=(0,i.default)((function*(e,t,n){try{const r=yield(0,l.getDeviceInfoForSync)(e),i=r.map((e=>e?e.devices.map((t=>(0,s.createDeviceWidFromUserAndDevice)(e.id,t))):[])),a=yield Promise.all(i.map((e=>0===e.length?"":(0,o.phashV2)(e))));return v(t.map(((e,t)=>{var n,i;return{id:e,hash:a[t],ts:null===(n=r[t])||void 0===n?void 0:n.timestamp,expectedTs:null===(i=r[t])||void 0===i?void 0:i.expectedTs}})),n)}catch(e){__LOG__(4,void 0,new Error)`Failed to sync device list with error: ${e}`}finally{t.map((e=>{h.delete(e.user)}))}}))).apply(this,arguments)}function E(){return(E=(0,i.default)((function*(){yield _({wids:[(0,c.getMeUser)()],context:null,phash:null})}))).apply(this,arguments)}function S(){return(S=(0,i.default)((function*(e){const t=e.map((e=>e.user));return yield _({wids:e,context:null,phash:null}),(0,l.getDeviceIds)(t)}))).apply(this,arguments)}function v(){return T.apply(this,arguments)}function T(){return(T=(0,i.default)((function*(e,t){if(0===e.length)return;const n=(new f.USyncQuery).withContext(t||"interactive").withDeviceProtocol();e.forEach((e=>{0!==e.id.user&&n.withUser((new p.USyncUser).withId(e.id).withDeviceHash(String(e.hash)).withTs(e.ts).withExpectedTs(e.expectedTs))}));const r=yield n.execute();if(r.error.all)throw new Error(`syncDeviceList: error ${r.error.all.errorCode}: ${r.error.all.errorText}`);r.error.devices&&__LOG__(3)`syncDeviceList: error ${r.error.devices.errorCode}: ${r.error.devices.errorText}`;let i=r.list.filter((e=>!("errorCode"in e.devices)));i=i.map((e=>({wid:e.id,devices:e.devices})));const a=i.filter((e=>{var t;return null===(t=e.devices.keyIndex)||void 0===t?void 0:t.signedKeyIndexBytes})).map((e=>e.wid));return __LOG__(2)`syncDeviceList: skipping ${r.list.length-a.length} out of ${r.list.length} records`,yield(0,d.getAndStoreIdentityKeys)(a),(0,u.handleADVDeviceSyncResult)(i)}))).apply(this,arguments)}},37039:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getBuildHash=g,t.getClientPayloadForLogin=function(e){const t=(0,u.assertGetMe)(),n=(0,i.default)((0,i.default)({},_(e)),{},{username:parseInt(t.user,10),device:null!=t.device?t.device:0});return(0,c.encodeProtobuf)(f.ClientPayloadSpec,n).readByteArray()},t.getClientPayloadForRegistration=function(e,t,n){const r=g(),a=m(),s=(0,i.default)((0,i.default)({},_(n)),{},{regData:{buildHash:r,companionProps:a,eRegid:(0,o.intToBytes)(4,e.registrationId),eKeytype:(0,o.intToBytes)(1,5),eIdent:e.identityKeyPair.pubKey,eSkeyId:(0,o.intToBytes)(3,t.keyId),eSkeyVal:t.keyPair.pubKey,eSkeySig:t.signature}});return(0,c.encodeProtobuf)(f.ClientPayloadSpec,s).readByteArray()},t.getCompanionProps=m,t.getPlatformTypeFromName=E,t.getUserAgent=y,t.getWebSubPlatform=S;var i=r(n(81109)),a=n(15688),o=n(51239),s=r(n(11782)),l=r(n(79264)),c=n(60980),d=n(98263),u=n(99234),p=n(15875),f=n(84331),h=n(42448);function _(e){return{passive:!!e&&e.passive,connectType:f.ClientPayloadConnectType.WIFI_UNKNOWN,connectReason:f.ClientPayloadConnectReason.USER_ACTIVATED,userAgent:y(),webInfo:{webSubPlatform:S()}}}function g(){const e=(0,a.decodeB64)((0,s.default)("2.2210.9"));return new Uint8Array(e)}function m(){const e=l.default.info();let t;if(e.version&&""!==e.version){const n=e.version.split(".");n.length>0&&e.version&&/^[0-9\.]+$/.test(e.version)&&(t={primary:parseInt(n[0],10),secondary:n.length>1?parseInt(n[1],10):void 0,tertiary:n.length>2?parseInt(n[2],10):void 0})}const n={os:e.os,version:t,platformType:E(e.name),requireFullSync:!1};return(0,c.encodeProtobuf)(d.CompanionPropsSpec,n).readByteArray()}function y(){const e=p.deviceInfo.get(),t=f.ClientPayload$UserAgentReleaseChannel.RELEASE;return{appVersion:{primary:Number("2"),secondary:Number("2210"),tertiary:Number("9")},platform:f.ClientPayload$UserAgentPlatform.WEB,releaseChannel:t,mcc:e.mcc,mnc:e.mnc,osVersion:e.osVersion,manufacturer:e.manufacturer,device:e.device,osBuildNumber:e.osBuild,localeLanguageIso6391:e.lg,localeCountryIso31661Alpha2:e.lc}}function E(e){switch(e){case"Chrome":return d.CompanionPropsPlatformType.CHROME;case"Firefox":return d.CompanionPropsPlatformType.FIREFOX;case"IE":return d.CompanionPropsPlatformType.IE;case"Opera":return d.CompanionPropsPlatformType.OPERA;case"Safari":return d.CompanionPropsPlatformType.SAFARI;case"Edge":return d.CompanionPropsPlatformType.EDGE;case"electron":case"Desktop":return d.CompanionPropsPlatformType.DESKTOP;case"ipad":case"iPad":return d.CompanionPropsPlatformType.IPAD;case"tablet":case"Android tablet":return d.CompanionPropsPlatformType.ANDROID_TABLET;case"Ohana":return d.CompanionPropsPlatformType.OHANA;case"Aloha":return d.CompanionPropsPlatformType.ALOHA;case"Catalina":return d.CompanionPropsPlatformType.CATALINA;default:return d.CompanionPropsPlatformType.UNKNOWN}}function S(){switch(h.WAM_PLATFORM){case"WEB":return f.ClientPayload$WebInfoWebSubPlatform.WEB_BROWSER;case"DARWIN":case"DARWIN_BETA":return f.ClientPayload$WebInfoWebSubPlatform.DARWIN;case"WIN32":case"WIN32_BETA":return f.ClientPayload$WebInfoWebSubPlatform.WIN32;case"MACSTORE":return f.ClientPayload$WebInfoWebSubPlatform.APP_STORE;case"WINSTORE":return f.ClientPayload$WebInfoWebSubPlatform.WIN_STORE;default:return}}},71520:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;const n={ROOT:1,THENABLE:2,FINALLY:3,META:4},r={PENDING:1,FULFILLED:2,REJECTED:3};function i(){let e,t;switch(this._parent=null,this._subs=[],this._catchTypes=null,this._onResolve=null,this._onReject=null,this.type=n.ROOT,this.state=r.PENDING,this.value=void 0,this._forceable=!1,this._cancellable=!1,arguments.length){case 0:break;case 1:e=arguments[0];break;case 2:t=arguments[0],e=arguments[1];break;default:throw new Error("TightPromise constructor with "+arguments.length+" arguments")}if(this.context=t,arguments.length>0)try{e.call(t,o.bind(this),s.bind(this))}catch(e){s.call(this,e)}}function a(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const a=new i;return a.type=n.THENABLE,a._onReject=arguments[arguments.length-1],arguments.length>1&&(a._catchTypes=Array.prototype.slice.call(arguments,0,arguments.length-1),a._catchTypes.forEach((function(e){if("function"!=typeof e)throw new Error("expected type, got "+e)}))),this._addChild(a),a}function o(e){var t;this.state===r.PENDING&&("object"!=typeof(t=e)&&"function"!=typeof t||"function"!=typeof t.then?(this.value=e,this.state=r.FULFILLED,this._notifySubs()):e.then(o.bind(this),s.bind(this)))}function s(e){this.state===r.PENDING&&(this.value=e,this.state=r.REJECTED,this._notifySubs())}i.STATE=r,i.TYPE=n,i.prototype={isPending:function(){return this.state===r.PENDING},then:function(e,t){if(!e&&!t)return this;const r=new i;return r.type=n.THENABLE,r._onResolve=e||null,r._onReject=t||null,this._addChild(r),r},catch:a,catchType:a,catchTypes:a,catchTypes3:a,catchEqualTo:a,finally:function(e){const t=new i;return t.type=n.FINALLY,t._onResolve=e,this._addChild(t),t},bind:function(e){const t=new i;return t.type=n.META,this._addChild(t),t.context=e,t},spread:function(e){return this.then((function(t){e.apply(this,t)}))},get:function(e){return this.then((function(t){return t[e]}))},forceable:function(){const e=new i;return e.context=this.context,e.type=n.META,this._addChild(e),e._forceable=!0,e},cancellable:function(){const e=new i;return e.context=this.context,e.type=n.META,this._addChild(e),e._cancellable=!0,e},force:function(e){if(this._forceable){let t=this;for(;t.type===n.META;){const e=t._parent;if(!(null==e?void 0:e._forceable)||e.state!==r.PENDING)break;t=e}o.call(this,e)}},cancel:function(e){let t=e;if(this._cancellable){t=t||new Promise.CancellationError;let e=this,n=!1;do{const t=e._parent;(null==t?void 0:t._cancellable)&&t.state===r.PENDING?e=t:n=!0}while(!n);s.call(e,t)}},loosen:function(){return Promise.resolve(this)},_run:function(e,t){let n;try{n=e.call(this.context,t)}catch(e){return void s.call(this,e)}o.call(this,n)},_handle:function(){if(this.state!==r.PENDING)return;const e=this._parent;switch(this.type){case n.THENABLE:if(e.state===r.FULFILLED){const t=this._onResolve;t?this._run(t,e.value):o.call(this,e.value)}else if(this._onReject){const t=this._catchTypes,n=t?t.length:0,r=e.value;if(0===n)return void this._run(this._onReject,r);for(let e=0;e<n;e++)if(r instanceof t[e])return void this._run(this._onReject,r);s.call(this,r)}else s.call(this,e.value);return;case n.FINALLY:try{this._onResolve.call(this.context)}catch(e){!function(e){setTimeout((function(e){throw e}),0,e)}(e)}default:e.state===r.FULFILLED?o.call(this,e.value):s.call(this,e.value)}},_addChild:function(e){e._parent=this,e.context=this.context,e._cancellable=this._cancellable,e.type===n.META&&(e._forceable=this._forceable),this.state===r.PENDING?this._subs.push(e):e._handle()},_notifySubs:function(){this._subs.forEach((function(e){e._handle()}))}},i.delay=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];let r,a;switch(arguments.length){case 0:r=0;break;case 1:r=arguments[0];break;default:r=arguments[1],a=arguments[0]}return new i((function(e){setTimeout(e.bind(null,a),r)}))},i.resolve=function(e){const t=new i;return o.call(t,e),t},i.reject=function(e){const t=new i;return s.call(t,e),t};var l=i;t.default=l},10151:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=D;var i=r(n(48926)),a=(n(39948),n(65044)),o=n(7293),s=n(79736),l=n(41796),c=n(46582),d=n(88555),u=n(72651),p=n(99234),f=n(58052),h=n(36163),_=n(97480),g=n(64319),m=n(76214),y=n(318),E=n(52771),S=r(n(18438)),v=n(29100),T=n(24747),b=n(83254),C=n(88102),A=r(n(67938)),P=r(n(52991)),M=n(62583),O=n(55062),I=n(9530);function w(){return R.apply(this,arguments)}function R(){return(R=(0,i.default)((function*(){const e=(0,O.getCommsConfig)(void 0);return(0,T.startComms)(S.default,v.sendPing,e,(e=>Promise.resolve((0,u.inflate)(e))),(()=>{}),(()=>{})),yield(0,T.waitForConnection)(),(0,T.startHandlingRequests)()}))).apply(this,arguments)}function D(e){const t=(0,s.makeBridge)();return(0,l.setBridge)(t),(0,c.requireSetHandlers)().then((e=>e(t))),(0,d.isLegacyWebdBackend)()?(a.Socket.launch(e),Promise.resolve()):(0,g.initEncSalt)().then((()=>(0,g.initEncSaltForInvoker)())).then((()=>(0,y.initialize)())).catch((e=>{__LOG__(4,void 0,new Error,void 0,["launch_socket"])`storageInitializationError triggered logout: ${(null==e?void 0:e.message)||(null==e?void 0:e.name)}.`,C.Cmd.storageInitializationError()})).then((()=>{if(P.default.isLogoutInProgress)throw new Error("aborting launchSocket due to logout");return(0,f.isRegistered)()?(__LOG__(2)`[launch socket] launch socket for loggin`,(0,I.setIsConnectedAsRegistered)(!0),C.Cmd.initialLoadReady(),(0,m.initialize)().catch((()=>C.Cmd.storageInitializationError())).then((()=>{C.Cmd.incrementProgress(),(0,h.restoreImportantMetaData)()})).then((()=>(0,h.restoreBlocklist)())).then((()=>{C.Cmd.incrementProgress(),(0,E.startBackend)()}))):(__LOG__(2)`[launch socket] launch socket for registration`,C.Cmd.incrementProgress(),_.OfflineResumeReporter.setIsInitialSync(),Promise.all([(0,b.refreshNoiseCredentials)(),(0,b.refreshSignalCredentials)()]).then((()=>{C.Cmd.incrementProgress(),w()})))}))}C.Cmd.on("md_downgrade_webclient",(0,i.default)((function*(){(0,T.stopComms)(),yield(0,g.deleteEncKeysAndCache)(),a.Socket.set({launched:!1,stream:M.SOCKET_STREAM.DISCONNECTED,mustExitLoop:!1,shouldUpgradeToMD:!1}),(0,p.setMdOptedIn)(!1),o.GK.setFeature(o.GK.F.MD_BACKEND,!1),a.Socket.initialize(),a.Socket.handler||a.Socket.registerHandler(A.default),D(!0)}))),C.Cmd.on("upgrade_to_md",(()=>{o.GK.setFeature(o.GK.F.MD_BACKEND,!0),D(!0),(0,f.setUpgradeMdWamFlag)(!0)})),C.Cmd.on("upgrade_to_md_prod",(()=>{o.GK.setFeature(o.GK.F.MD_BACKEND,!0),D(!0),(0,f.setUpgradeMdWamFlag)(!0)})),C.Cmd.on("md_refresh_qr",(()=>{(0,T.stopComms)(),w()})),C.Cmd.on("logout",(()=>{(0,d.isLegacyWebdBackend)()||D(!0)}))},85726:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(!(0,m.isRegistered)())return function(){return R.apply(this,arguments)}(e);return function(){return w.apply(this,arguments)}(e)};var i=r(n(48926)),a=n(15688),o=n(8584),s=n(17525),l=(n(87614),n(10095)),c=r(n(45095)),d=n(27498),u=n(84902),p=n(60980),f=n(37039),h=n(88102),_=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=b(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(53614)),g=n(15875),m=n(58052),y=n(11849),E=r(n(33815)),S=n(24774),v=n(78155),T=r(n(35609));function b(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(b=function(e){return e?n:t})(e)}const C=new Uint8Array([87,65,6,d.DICT_VERSION]),A="Noise_XX_25519_AESGCM_SHA256\0\0\0\0";let P;function M(){return O.apply(this,arguments)}function O(){return(O=(0,i.default)((function*(){const e=(0,m.getRoutingInfo)(),t=e?e.edgeRouting:null;let n=t?(0,a.encodeB64UrlSafe)(t):null;const r=new E.default({routingToken:n}),i=_.keyPair(),[c,d,u]=yield(0,T.default)(r,"change:socket").cancellable().then((()=>r.socket)).finally((()=>{r.deactivate()})).then((e=>{let n;if(t){const e=new o.Binary;e.write("ED",0,1),e.writeUint8(t.byteLength>>16),e.writeUint16(65535&t.byteLength),e.writeBuffer(t),n=e.readByteArray()}const r=n?o.Binary.build(n,C).readByteArray():C,a=new s.FrameSocket(e,r);P=new l.NoiseHandshake(a),P.start(A,C),__LOG__(2)`openChatSocket send hello`,P.authenticate(i.pubKey);const c={clientHello:{ephemeral:i.pubKey}};return P.sendAndReceive((0,p.encodeProtobuf)(v.HandshakeMessageSpec,c).readByteArray())})).then((e=>I(P,e,i)));return __LOG__(2)`verifying certificate`,(0,S.verifyChainCertificateWA6)(d,c),u}))).apply(this,arguments)}function I(e,t,n){__LOG__(2)`openChatSocket rcv hello`;const{serverHello:r}=(0,u.decodeProtobuf)(v.HandshakeMessageSpec,t);if(!r)throw new Error("ServerHello payload error");const{ephemeral:i,static:a,payload:o}=r;if(null==i||null==a||null==o)throw new Error("Missing server Ephemeral");e.authenticate(i),e.mixIntoKey(_.sharedSecret(i,n.privKey));const s=e.decrypt(a),l=s.then((e=>_.sharedSecret(e,n.privKey)));return e.mixIntoKey(l),Promise.all([s,e.decrypt(o),i])}function w(){return(w=(0,i.default)((function*(e){try{const t=yield M().then(function(){var t=(0,i.default)((function*(t){h.Cmd.incrementProgress();const n=(0,c.default)(yield g.waNoiseInfo.get(),"yield waNoiseInfo.get()").staticKeyPair,r=(0,f.getClientPayloadForLogin)(e);return Promise.all([D(n,P,t),P.encrypt(Promise.resolve(r))])}));return function(){return t.apply(this,arguments)}}()).then((e=>{let[t,n]=e;return h.Cmd.incrementProgress(),P.send((0,p.encodeProtobuf)(v.HandshakeMessageSpec,{clientFinish:{static:t,payload:n}}).readByteArray()),P.finish()}));return h.Cmd.incrementProgress(),__LOG__(2)`openChatSocketForLogin success, resetting round`,t}catch(e){__LOG__(3)`openChatSocketForLogin error ${e}`}}))).apply(this,arguments)}function R(){return(R=(0,i.default)((function*(e){try{const t=yield M().then((e=>Promise.all([y.waSignalStore.getRegistrationInfo(),y.waSignalStore.getSignedPreKey(),e]))).then(function(){var t=(0,i.default)((function*(t){let[n,r,i]=t;if(!r||!n)throw new Error("Invalid signal credentials");const a=(0,f.getClientPayloadForRegistration)(n,r,e),o=(0,c.default)(yield g.waNoiseInfo.get(),"yield waNoiseInfo.get()").staticKeyPair;return Promise.all([D(o,P,i),P.encrypt(Promise.resolve(a))])}));return function(){return t.apply(this,arguments)}}()).then((e=>{let[t,n]=e;return P.send((0,p.encodeProtobuf)(v.HandshakeMessageSpec,{clientFinish:{static:t,payload:n}}).readByteArray()),P.finish()}));return __LOG__(2)`openChatSocketForRegistration success, resetting round`,t}catch(e){__LOG__(3)`openChatSocketForRegistration error ${e}`}}))).apply(this,arguments)}function D(e,t,n){const r=Promise.resolve(e.pubKey),i=t.encrypt(r);if(!n)return Promise.reject(new Error("staticAgreement called before serverKeys"));const a=_.sharedSecret(n,e.privKey);return t.mixIntoKey(a),i}},72006:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.openSocket=function(e){return new WebSocket(e)};r(n(45095)),n(57932),r(n(4285))},83254:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.buildUrl=function(e,t,n){if(!/^https:\/\/[-\w.]+\.\w+$/.test(e))throw new Error(`buildUrl given invalid host "${e}"`);if(!t.startsWith("/"))throw new Error(`buildUrl given invalid path "${t}"`);const r=n,i=`${e}${t}`;if(!r)return i;const a=Object.keys(r).map((e=>{let t=r[e];t instanceof ArrayBuffer&&(t=new Uint8Array(t));const n=t instanceof Uint8Array?Array.prototype.slice.call(t).map((e=>`%${e.toString(16)}`)).join(""):encodeURIComponent(t);return`${encodeURIComponent(e)}=${n}`}));if(a.length>0){const e=a.join("&");return i.includes("?")?`${i}&${e}`:`${i}?${e}`}return i},t.refreshNoiseCredentials=function(){const e=(0,o.keyPair)(),t=new Uint8Array(24);return self.crypto.getRandomValues(t),Promise.resolve(s.waNoiseInfo.set({recoveryToken:t.buffer,staticKeyPair:e}))},t.refreshSignalCredentials=function(){return u.apply(this,arguments)},t.setRoutingInfo=function(e,t){const n={domain:e,edgeRouting:t?(0,a.decodeB64)(t):null};return __LOG__(2)`set routingInfo:`,Promise.resolve((0,c.setRoutingInfo)(n))};var i=r(n(48926)),a=n(15688),o=n(53614),s=n(15875),l=n(58425),c=n(58052),d=n(11849);function u(){return(u=(0,i.default)((function*(){const e=window.libsignal.KeyHelper.generateRegistrationId();yield d.waSignalStore.clearCredential();const t=yield(0,l.generateIdentityKeyPair)();yield Promise.all([d.waSignalStore.setRegistrationInfo({registrationId:e,identityKeyPair:t}),d.waSignalStore.rotateSignedPreKey((0,o.toSignalCurveKeyPair)(t),l.generateSignedKeyPair)])}))).apply(this,arguments)}},62583:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WATCHED_SOCKET_STATE=t.SOCKET_STREAM=t.SOCKET_STATE=void 0;t.SOCKET_STATE={OPENING:"OPENING",PAIRING:"PAIRING",UNPAIRED:"UNPAIRED",UNPAIRED_IDLE:"UNPAIRED_IDLE",CONNECTED:"CONNECTED",TIMEOUT:"TIMEOUT",CONFLICT:"CONFLICT",UNLAUNCHED:"UNLAUNCHED",PROXYBLOCK:"PROXYBLOCK",TOS_BLOCK:"TOS_BLOCK",SMB_TOS_BLOCK:"SMB_TOS_BLOCK",DEPRECATED_VERSION:"DEPRECATED_VERSION"};t.SOCKET_STREAM={DISCONNECTED:"DISCONNECTED",SYNCING:"SYNCING",RESUMING:"RESUMING",CONNECTED:"CONNECTED"};t.WATCHED_SOCKET_STATE={OPEN:"OPEN",CLOSED:"CLOSED"}},94030:(e,t,n)=>{"use strict";var r=n(59182).default,i=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(89385),o=n(8584),s=n(856),l=n(13959),c=n(67924),d=n(85553),u=i(n(81602)),p=n(11290),f=i(n(78144)),h=i(n(35609)),_=n(59338),g=n(66567),m=n(12099);const y=3e5,E=18e4,S=(0,g.fibonacci)(8e3,4e3,3e5);class v extends p.BaseModel{constructor(){super(...arguments),this.active=(0,p.prop)(!0),this.socket=(0,p.prop)(),this.sockets=(0,p.prop)(),this.pendingSocketPromiseCount=(0,p.prop)(0),this.attempts=(0,p.prop)(0),this.startId=(0,p.prop)(0),this.controller=(0,p.prop)(),this.retryTimestamp=(0,p.prop)(),this.tsListener=(0,p.prop)(),this.onerror=(0,p.prop)()}initialize(){this.sockets=[],new Promise(((e,t)=>{this._resolve=e,this._reject=t})).then((e=>{__LOG__(2)`SocketOpener set to socket ${e.id}`,this.set({active:!1,socket:e}),u.default.online=!0})).finally((()=>{this.stopListening(),__LOG__(2)`SocketOpener closing socket opener`,this.active=!1,this.sockets.forEach((e=>{e.cancel()}));const e=this.controller;e&&(e.deactivate(),this.controller=null)})).catch((0,a.catchAbort)((()=>{}))).catch((e=>{if(__LOG__(3)`SocketOpener deadly error! ${String(e)}`,!this.onerror)throw e;this.onerror(e)})),this.tsListener=e=>{this.retryTimestamp=e.ts},this.listenTo(u.default,"change:online",this.onOnlineChange),this.listenTo(d.jsHaltDetector,c.JS_HALT_EVENT,this.onJsHalt),this.onOnlineChange()}attemptOpen(){if(!this.active)return __LOG__(2,void 0,void 0,!0)`attemptOpen called while not active!`,void SEND_LOGS("rogue-opener");const e=(0,m.open)({url:"wss://web.whatsapp.com/ws",msgParser:b});this.attempts=this.sockets.push(e),this.pendingSocketPromiseCount++;let t=!1;const n=function(){if(t)return Promise.resolve();t=!0;const e=(new r).signal;return u.default.checkOnline({signal:e})},i=new r;(0,l.delayMs)(6e3,i.signal).then((()=>n())).catch((()=>{})),e.then(this._resolve).finally((()=>{this.pendingSocketPromiseCount--,i.abort()})).catch((0,a.catchAbort)((()=>{}))).catch((()=>n()))}poke(){this.controller&&this.controller.forceTimeout()}onOnlineChange(){if(!this.active)return;const e=this.controller,t=u.default.online?this.onlineController():this.offlineController();e&&(e.off("change:ts",this.tsListener),e.deactivate()),t.on("change:ts",this.tsListener),t.activate(),this.controller=t}onlineController(){return __LOG__(2)`SocketOpener:onlineController activating`,new g.Watchdog({waitAlgorithm:S,jitter:.2,onActivated:()=>{this.attemptOpen()},onTimeout:()=>(this.attemptOpen(),!0)})}offlineController(){__LOG__(2)`SocketOpener:offlineController activating`;let e,t=0;return new g.Watchdog({waitAlgorithm:r=>(e&&e.cancel(),navigator.onLine?t++<2?(__LOG__(2)`SocketOpener:offline... quick poll`,e=null,6e3):(__LOG__(2)`SocketOpener:offline... heuristic poll`,e=T(r,[(0,_.waitForOnlineNaive)(),(0,h.default)(d.jsHaltDetector,c.JS_HALT_EVENT),(0,h.default)(n(8080).Stream,"change:available")]),y):(__LOG__(2)`SocketOpener:offline... wait for navigator`,t=0,e=T(r,[(0,_.waitForOnlineNaive)()]),y)),jitter:.2,onActivated:()=>{0===this.pendingAttempts()&&this.attemptOpen()},onDeactivated:()=>{e&&e.cancel()},onTimeout:()=>(this.attemptOpen(),!0)})}deactivate(){this._reject(new a.AbortError)}pendingAttempts(){return this.pendingSocketPromiseCount}onJsHalt(e){const t=this.controller;t&&e>E&&(__LOG__(2)`js halt longer than ${E} ms detected, resetting watchdog fail generation`,t.resetGeneration())}}function T(e,t){return(0,s.promiseAny)(t).cancellable().then((()=>{e.forceTimeout()})).finally((()=>{t.forEach((e=>{e.cancel()}))})).catch((0,a.catchAbort)((()=>{})))}function b(e){const t=e.data;let n,r,i;if(t instanceof ArrayBuffer){let e;const a=[],s=new o.Binary(t);for(;44!==(e=s.readUint8());)a.push(e);n=String.fromCharCode.apply(String,a),r=s.readBuffer(),i=t.byteLength}else{if("string"!=typeof t)throw new Error("Unexpected message event type");{const e=t.indexOf(",");n=t.slice(0,e),r=t.slice(e+1),r=r?JSON.parse(r,f.default):void 0,i=new Blob([t]).size}}return{tag:n,data:r,binarySize:i}}var C=(0,p.defineModel)(v);t.default=C},33815:(e,t,n)=>{"use strict";var r=n(59182).default,i=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(89385),o=n(856),s=n(13959),l=n(67924),c=n(85553),d=i(n(81602)),u=n(11290),p=i(n(35609)),f=n(59338),h=n(66567),_=n(14350);const g="wss://web.whatsapp.com/ws/chat",m=3e5,y=18e4,E=(0,h.fibonacci)(8e3,4e3,3e5);class S extends u.BaseModel{constructor(){super(...arguments),this.active=(0,u.prop)(!0),this.socket=(0,u.prop)(),this.sockets=(0,u.prop)(),this.pendingSocketPromiseCount=(0,u.prop)(0),this.attempts=(0,u.prop)(0),this.controller=(0,u.prop)(),this.retryTimestamp=(0,u.prop)(),this.tsListener=(0,u.prop)(),this.onerror=(0,u.prop)()}initialize(){this.sockets=[],new Promise(((e,t)=>{this._resolve=e,this._reject=t})).then((e=>{__LOG__(2)`SocketOpenerMD set to socket ${e.id}`,this.set({active:!1,socket:e}),d.default.online=!0})).finally((()=>{this.stopListening(),__LOG__(2)`SocketOpenerMD closing socket opener`,this.active=!1,this.sockets.forEach((e=>{e.cancel()}));const e=this.controller;e&&(e.deactivate(),this.controller=null)})).catch((0,a.catchAbort)((()=>{}))).catch((e=>{if(__LOG__(3)`SocketOpenerMD deadly error! ${String(e)}`,!this.onerror)throw e;this.onerror(e)})),this.tsListener=e=>{this.retryTimestamp=e.ts},this.listenTo(d.default,"change:online",this.onOnlineChange),this.listenTo(c.jsHaltDetector,l.JS_HALT_EVENT,this.onJsHalt),this.onOnlineChange()}attemptOpen(){if(!this.active)return void __LOG__(2)`attemptOpen called while not active!`;const e=(0,_.open)(this.routingToken?`${g}?ED=${this.routingToken}`:g);this.attempts=this.sockets.push(e),this.pendingSocketPromiseCount++;let t=!1;const n=function(){if(t)return Promise.resolve();t=!0;const e=(new r).signal;return d.default.checkOnline({signal:e})},i=new r;(0,s.delayMs)(6e3,i.signal).then((()=>n())).catch((()=>{})),e.then(this._resolve).finally((()=>{this.pendingSocketPromiseCount--,i.abort()})).catch((0,a.catchAbort)((()=>{}))).catch((()=>n()))}poke(){this.controller&&this.controller.forceTimeout()}onOnlineChange(){if(!this.active)return;const e=this.controller,t=d.default.online?this.onlineController():this.offlineController();e&&(e.off("change:ts",this.tsListener),e.deactivate()),t.on("change:ts",this.tsListener),t.activate(),this.controller=t}onlineController(){return __LOG__(2)`SocketOpenerMD:onlineController activating`,new h.Watchdog({waitAlgorithm:E,jitter:.2,onActivated:()=>{this.attemptOpen()},onTimeout:()=>(this.attemptOpen(),!0)})}offlineController(){__LOG__(2)`SocketOpenerMD:offlineController activating`;let e,t=0;return new h.Watchdog({waitAlgorithm:r=>(e&&e.cancel(),navigator.onLine?t++<2?(__LOG__(2)`SocketOpenerMD:offline... quick poll`,e=null,6e3):(__LOG__(2)`SocketOpenerMD:offline... heuristic poll`,e=v(r,[(0,f.waitForOnlineNaive)(),(0,p.default)(c.jsHaltDetector,l.JS_HALT_EVENT),(0,p.default)(n(8080).Stream,"change:available")]),m):(__LOG__(2)`SocketOpenerMD:offline... wait for navigator`,t=0,e=v(r,[(0,f.waitForOnlineNaive)()]),m)),jitter:.2,onActivated:()=>{0===this.pendingAttempts()&&this.attemptOpen()},onDeactivated:()=>{e&&e.cancel()},onTimeout:()=>(this.attemptOpen(),!0)})}deactivate(){this._reject(new a.AbortError)}pendingAttempts(){return this.pendingSocketPromiseCount}onJsHalt(e){const t=this.controller;t&&e>y&&(__LOG__(2)`js halt longer than ${y} ms detected, resetting watchdog fail generation`,t.resetGeneration())}}function v(e,t){return(0,o.promiseAny)(t).cancellable().then((()=>{e.forceTimeout()})).finally((()=>{t.forEach((e=>{e.cancel()}))})).catch((0,a.catchAbort)((()=>{})))}var T=(0,u.defineModel)(S);t.default=T},24774:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseCertificateWA6=d,t.verifyCertificateWA6=u,t.verifyChainCertificateWA6=function(e,t){const n=(0,a.decodeProtobuf)(s.CertChainSpec,e);if(!n)throw new Error("verifyCertificateWA6 - Missing Certificate");const i=n.intermediate,o=n.leaf;if(null==i||null==o)throw new Error("verifyCertificateWA6 - Missing Leaf and/or Intermediate Certificate");__LOG__(2)`verifying intermediate certificate`;const l=d(i);if(u(l,c.PUBLIC_KEY),l.issuerSerial!==c.SERIAL)throw new Error("verifyChainCertificateWA6 intermediateCert was not issued by RootCA");__LOG__(2)`verifying leaf certificate`;const p=d(o);if(u(p,l.key),p.issuerSerial!==l.serial)throw new Error("verifyChainCertificateWA6 leafCert was not issued by IntermediateCert");if(!(0,r.areBuffersEqual)(p.key,t))throw new Error("verifyChainCertificateWA6 leafCert.key does not match handshake server.hello.static")};var r=n(7589),i=n(87614),a=n(84902),o=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=l(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(53614)),s=n(78155);function l(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(l=function(e){return e?n:t})(e)}const c={SERIAL:0,ISSUER:"WhatsAppLongTerm1",PUBLIC_KEY:(0,i.parseHex)("142375574d0a587166aae71ebe516437c4a28b73e3695c6ce1f7f9545da8ee6b")};function d(e){const t=e.details,n=e.signature;if(!t)throw new Error('parseCertificateWA6 certificate is missing "details"');if(!n)throw new Error('parseCertificateWA6 certificate is missing "signature"');const r=(0,a.decodeProtobuf)(s.CertChain$NoiseCertificate$DetailsSpec,t),{issuerSerial:i,serial:o,key:l,notAfter:c,notBefore:d}=r;if(null==i)throw new Error('parseCertificateWA6 certificate is missing "issuer_serial"');if(null==o)throw new Error('parseCertificateWA6 certificate is missing "serial"');if(null==l)throw new Error('parseCertificateWA6 certificate is missing "key"');return{serial:o,issuerSerial:i,key:l,notBefore:d,notAfter:c,details:t,signature:n}}function u(e,t){if(!o.verifySignature(new Uint8Array(t),new Uint8Array(e.details),new Uint8Array(e.signature)))throw new Error("verifyCertificateWA6 certificate is poorly signed!")}},66567:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Watchdog=void 0,t.fibonacci=function(e,t,n){if("number"==typeof n){const r=n;return function(n){switch(n.failGeneration){case 0:return Math.min(r,t);case 1:return Math.min(r,e+t);default:return Math.min(r,n.waitDuration+n.prevWaitDuration)}}}return function(n){switch(n.failGeneration){case 0:return t;case 1:return e+t;default:return n.waitDuration+n.prevWaitDuration}}};var r=n(57319),i=n(11290);class a extends i.BaseModel{constructor(){super(...arguments),this.failGeneration=(0,i.session)(0),this.ts=(0,i.session)(),this.waitDuration=(0,i.session)(0),this.prevWaitDuration=(0,i.session)(0),this.jitter=(0,i.session)(0),this.shiftTimer=(0,i.session)(),this.waitAlgorithm=(0,i.session)(),this.onActivated=(0,i.session)(),this.onDeactivated=(0,i.session)(),this.onFed=(0,i.session)(),this.onTimeout=(0,i.session)()}initialize(){this.shiftTimer=new r.ShiftTimer((()=>s.call(this)))}activate(){this.shiftTimer.isScheduled()||(this._run(!0),this.onActivated&&this.onActivated(this))}deactivate(){this.shiftTimer.isScheduled()&&(this.shiftTimer.cancel(),this.onDeactivated&&this.onDeactivated(this))}feed(){this.shiftTimer.isScheduled()&&(this._run(!0),this.onFed&&this.onFed(this))}forceTimeout(e){this.shiftTimer.isScheduled()?null!=e&&0!==e?(this.shiftTimer.onOrBefore(e),this.ts=this.shiftTimer.ts):this.shiftTimer.forceRunNow():__LOG__(3)`forced non-running watchdog!`}poke(){this.forceTimeout.apply(this,arguments)}resetGeneration(){this.failGeneration=0}_run(e){e&&this.resetGeneration();const t=this.waitAlgorithm(this),n=this.jitter*Math.random()*t;this.shiftTimer.debounce(t+n),this.set({ts:this.shiftTimer.ts,waitDuration:t,prevWaitDuration:this.waitDuration})}}const o=(0,i.defineModel)(a);function s(){const e=this.onTimeout;if(!e)return __LOG__(3,void 0,void 0,!0)`Watchdog timed-out without handler!`,void SEND_LOGS("watchdog-no-handler");this.failGeneration++,e(this)&&this._run(!1)}t.Watchdog=o},12099:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.WatchedSocketModel=void 0,t.open=function(e){let t;try{t=new v(e)}catch(e){return __LOG__(3)`WatchedSocket error constructing: ${e}`,f.default.reject(e)}return new f.default(t,(function(e,t){this.id=(v.numSocketsAttempted++).toString(),__LOG__(2)`WatchedSocket opening socket ${this.id}`;const n=(0,h.openSocket)(this.url);n.binaryType="arraybuffer",n.onopen=e,n.onclose=n.onerror=function(e){t(new d.SocketError(e))},this.socket=n})).cancellable().catch((function(e){if(__LOG__(2)`WatchedSocket error on open of ${this.id}: ${e}`,this.socket){const e=this.socket;switch(e.readyState){case WebSocket.CONNECTING:e.onopen=null;case WebSocket.OPEN:e.onerror=null,e.onclose=null,e.close();break;case WebSocket.CLOSING:case WebSocket.CLOSED:e.onerror=null,e.onclose=null}}throw e})).then((function(){__LOG__(2)`WatchedSocket opened socket ${this.id}`;const e=this.socket;return e.onmessage=this._onMessage.bind(this),e.onerror=this._onCloseOrError.bind(this,!0),e.onclose=this._onCloseOrError.bind(this,!1),this._offlineListener=(0,g.default)().then(this.close.bind(this,!1,"offline")).catch((0,a.catchAbort)((()=>{}))),this._pingTimer.onOrAfter(T()),this.state=_.WATCHED_SOCKET_STATE.OPEN,this}))};var i=r(n(82569)),a=n(89385),o=n(38284),s=n(57319),l=n(67924),c=n(85553),d=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=m(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(35232)),u=n(11290),p=r(n(33163)),f=r(n(71520)),h=n(72006),_=n(62583),g=r(n(21244));function m(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(m=function(e){return e?n:t})(e)}const y=18e4;function E(e,t){let n=-1;const r=e.find((e=>(n++,t(e))));return void 0===r?void 0:{index:n,value:r}}class S extends u.BaseModel{constructor(){super(...arguments),this.id=(0,u.session)(),this.url=(0,u.session)(),this.onmessage=(0,u.session)(),this.onactivity=(0,u.session)(),this.timeSkew=(0,u.session)(),this.msgParser=(0,u.session)(),this.state=(0,u.session)(),this.error=(0,u.session)(),this.socket=(0,u.session)(),this.isQueueing=(0,u.session)(!0),this.maxQueueSize=(0,u.session)(),this.messageQueue=(0,u.session)(),this._offlineListener=(0,u.session)(),this._msgListeners=(0,u.session)(),this._pingTimer=(0,u.session)(),this._killTimer=(0,u.session)()}initialize(){this._msgListeners=[],this.messageQueue=[],this._pingTimer=new s.ShiftTimer((()=>this._ping())),this._killTimer=new s.ShiftTimer((()=>this._killSocket())),c.jsHaltDetector.on(l.JS_HALT_EVENT,this._onJsHalt,this)}_onJsHalt(e){e>y&&(__LOG__(2)`js halt longer than ${y} ms detected, killing socket`,this._killTimer.cancel(),this._killTimer.onOrBefore(0))}_ping(){this.send("?,,"),this._killTimer.onOrAfter(b())}_killSocket(){__LOG__(3)`WatchedSocket ${this.id} Timeout!`,this.close(!0,"stale")}detachCallbacks(){this.set({onactivity:void 0,onmessage:void 0})}send(e){this.cast(e),this._pingTimer.cancel(),this._killTimer.onOrAfter(b())}cast(e){if(this.state!==_.WATCHED_SOCKET_STATE.OPEN)throw new d.SocketNotOpen(this.state);if("string"==typeof e&&/\[object ArrayBuffer\]/.test(e))throw new TypeError("converted ArrayBuffer to string prematurely");try{this.socket.send(e)}catch(e){__LOG__(3,void 0,void 0,!0)`exception sending: ${e}\n${e.stack}`,SEND_LOGS("send-exception"),this.close(!0,e)}}partingSend(e,t,n){const r=this,i=this.socket,a=new Promise((function(a){function o(){a(void 0)}i.onclose=o,i.onerror=o,i.onmessage=function(e){const t=e.data;n&&!n(t)||a(t)},r.send(t),r._onCloseOrError(!1,e)}));return(0,o.promiseTimeout)(a,2e4,"paringSendTimeout").catch((()=>{})).finally((function(){i.onclose=void 0,i.onerror=void 0,i.onmessage=void 0,i.readyState===WebSocket.OPEN&&i.close()}))}close(e,t){const n=this.socket;let r;if(this._onCloseOrError(e,t||"unspecified"),n&&(r=n.readyState,r===WebSocket.CONNECTING||r===WebSocket.OPEN))try{n.close()}catch(e){__LOG__(3)`WatchedSocket:exception closing: ${e}\n${e.stack}`}}_onMessage(e){this._pingTimer.onOrAfter(T()),this._killTimer.cancel();const t=e.data;if("string"==typeof t&&"!"===t.charAt(0)){const e=parseInt(t.slice(1),10);return e==e&&(this.timeSkew=Date.now()-e),void(this.onactivity&&this.onactivity())}const n=this.msgParser(e);this.onactivity&&this.onactivity(n),this._onParsedMsg(n)}_onParsedMsg(e){const t=E(this._msgListeners,(function(t){return!t.filter||t.filter(e)}));t?(this._msgListeners.splice(t.index,1),t.value.removed=!0,t.value.promise.force(e)):this.isQueueing?(__LOG__(3)`watchedSocket:enqueued`,this.messageQueue.push(e),void 0!==this.maxQueueSize&&this.messageQueue.length>this.maxQueueSize&&this.close(!0,"Queue Overflow")):this.onmessage?this.onmessage(e):__LOG__(3)`watchedSocket:dropped!`}_onCloseOrError(e,t){if(this.state===_.WATCHED_SOCKET_STATE.CLOSED)return;this.socket&&(this.socket.onclose=void 0,this.socket.onerror=void 0,this.socket.onmessage=void 0),this._offlineListener&&this._offlineListener.cancel(),__LOG__(3)`Socket ${this.id} closing: ${t.toString()}`,c.jsHaltDetector.off(l.JS_HALT_EVENT,this._onJsHalt,this),this._pingTimer.cancel(),this._killTimer.cancel(),this.set({state:_.WATCHED_SOCKET_STATE.CLOSED,error:e?t:void 0});const n=this._msgListeners,r=e?new d.SocketError(t):new d.SocketClosed(t);this._msgListeners=[],n.forEach((function(e){e.removed=!0,e.promise.cancel(r)}))}holdMessages(e){const t=this.isQueueing&&void 0!==e&&this.messageQueue>e;this.set({isQueueing:!0,messageQueue:this.messageQueue||[],maxQueueSize:e}),t&&this.close(!0,"Queue Overflow")}releaseMessages(e){if(!this.isQueueing)return void __LOG__(3)`WatchedSocket:releaseMessages not queued!`;const t=this.messageQueue;this.set({isQueueing:!1,messageQueue:[]}),e?t.length>0&&__LOG__(3)`WatchedSocket:releaseMessages dropping ${t.length} messages.`:t.forEach((e=>{this._onParsedMsg(e)}))}nextMessage(e){if(this.state!==_.WATCHED_SOCKET_STATE.OPEN)return f.default.reject(new d.SocketNotOpen(this.state)).cancellable();let t;if(t=e instanceof p.default?e.test.bind(e):e,this.isQueueing){let e;if(t){const n=E(this.messageQueue,t);n&&(e=n.value,this.messageQueue.splice(n.index,1))}else this.messageQueue.length>0&&(e=this.messageQueue.shift());if(e)return f.default.resolve(e).cancellable()}const n=(new f.default).cancellable().forceable(),r={removed:!1,filter:t,promise:n};return this._msgListeners.push(r),n.catch((()=>{r.removed||(this._msgListeners=(0,i.default)(this._msgListeners,r))})),n}}const v=(0,u.defineModel)(S);function T(){return 2e4*Math.random()+1e4}function b(){return 7e4*Math.random()+2e4}t.WatchedSocketModel=v,v.numSocketsAttempted=0},14350:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.WatchedSocketMD=void 0,t.open=function(e){let t;try{t=new g(e)}catch(e){return __LOG__(3)`WatchedSocketMD error constructing: ${e}`,d.default.reject(e)}return new d.default(t,(function(e,t){g.numSocketsAttempted++,this.id=g.numSocketsAttempted,__LOG__(2)`WatchedSocketMD opening socket ${this.id}`;const n=(0,u.openSocket)(this.url);n.binaryType="arraybuffer",n.onopen=e,n.onclose=n.onerror=function(e){t(new c.SocketError(e))},this.socket=n})).cancellable().catch((function(e){if(__LOG__(2)`WatchedSocketMD error on open of ${this.id}: ${e}`,this.socket){const e=this.socket;switch(e.readyState){case WebSocket.CONNECTING:e.onopen=null;case WebSocket.OPEN:e.onerror=null,e.onclose=null,e.close();break;case WebSocket.CLOSING:case WebSocket.CLOSED:e.onerror=null,e.onclose=null}}throw e})).then((function(){__LOG__(2)`WatchedSocketMD opened socket ${this.id}`;const e=this.socket;return e.onmessage=this._onMessage.bind(this),e.onerror=this._onCloseOrError.bind(this,!0),e.onclose=this._onCloseOrError.bind(this,!1),this._offlineListener=(0,f.default)().then(this.close.bind(this,!1,"offline")).catch((0,i.catchAbort)((()=>{}))),this.state=p.WATCHED_SOCKET_STATE.OPEN,this}))};var i=n(89385),a=n(8584),o=n(57319),s=n(67924),l=n(85553),c=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=h(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(35232)),d=r(n(71520)),u=n(72006),p=n(62583),f=r(n(21244));function h(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(h=function(e){return e?n:t})(e)}const _=18e4;class g{constructor(e){this.onError=null,this.dataToSend=new a.Binary,this.url=e,this._killTimer=new o.ShiftTimer((()=>this._killSocket())),l.jsHaltDetector.on(s.JS_HALT_EVENT,this._onJsHalt,this)}_onJsHalt(e){e>_&&(__LOG__(2)`js halt longer than ${_} ms detected, killing socket`,this._killTimer.cancel(),this._killTimer.onOrBefore(0))}_killSocket(){__LOG__(3)`WatchedSocketMD ${this.id} Timeout!`,this.close(!0,"stale")}detachCallbacks(){this.socket.onmessage=m}close(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;const n=this.socket;let r;if(this._onCloseOrError(e,t||"unspecified"),n&&(r=n.readyState,r===WebSocket.CONNECTING||r===WebSocket.OPEN))try{n.close()}catch(e){__LOG__(3)`WatchedSocketMD:exception closing: ${e}\n${e.stack}`}}requestSend(){if(this.state!==p.WATCHED_SOCKET_STATE.OPEN)throw new c.SocketNotOpen(this.state);if(this.dataToSend.size())try{this.socket.send(this.dataToSend.readByteArray())}catch(e){__LOG__(3)`exception sending: ${e}\n${e.stack}`,this.close(!0,e)}}_onMessage(e){if(!(e.data instanceof ArrayBuffer))throw new TypeError("expected ArrayBuffer from the socket");if(this.onData){(0,this.onData)(new Uint8Array(e.data))}}_onCloseOrError(e,t){this.state!==p.WATCHED_SOCKET_STATE.CLOSED&&(this.socket&&(this.socket.onclose=m,this.socket.onerror=m,this.socket.onmessage=m),this._offlineListener&&this._offlineListener.cancel(),__LOG__(3)`Socket ${this.id} closing: ${t.toString()}`,l.jsHaltDetector.off(s.JS_HALT_EVENT,this._onJsHalt,this),this._killTimer.cancel(),this.state=p.WATCHED_SOCKET_STATE.CLOSED,this.error=e?t:void 0,null!=this.onClose&&this.onClose())}}function m(){}t.WatchedSocketMD=g,g.numSocketsAttempted=0},6565:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.createDeviceSentMessage=function(e,t){return{deviceSentMessage:{destinationJid:t.toString({legacy:!0}),message:e}}},t.createDisappearingMode=y,t.createMessageKey=function(e){const t=A(e.to),n={fromMe:!0,id:e.id.id};(0,o.isString)(t)&&(n.remoteJid=t);return n},t.createMsgProtobuf=function(e,t){const n=function(e){const t=e.id,n=e.toJSON();delete n.status,delete n.mimetype,delete n.height,delete n.width,delete n.recipients,delete n.chat,delete n.broadcast,delete n.ack,delete n.invis,delete n.filehash,delete n.recvFresh,delete n.mediaData,l.default.isHttp(e.clientUrl)||delete n.clientUrl;l.default.isHttp(e.deprecatedMms3Url)||delete n.deprecatedMms3Url;for(const e in n)null==n[e]&&delete n[e];const r=d.default.get(t.remote);r&&(n.conversionTuple=r.serialize());return n}(e),r={};if(n.quotedMsg){const e=n.quotedMsg.mentionedJidList,t=Array.isArray(e)&&e.length>0?{mentionedJid:e.map(A)}:void 0;r.stanzaId=n.quotedStanzaID,r.remoteJid=A(n.quotedRemoteJid),r.participant=A(n.quotedParticipant),r.quotedMessage=b(n.quotedMsg,{duration:n.quotedMsg.duration,directPath:n.quotedMsg.directPath,encFilehash:n.quotedMsg.encFilehash,filehash:n.quotedMsg.filehash,height:n.quotedMsg.height,mediaKey:n.quotedMsg.mediaKey,mediaKeyTimestamp:(0,o.isNumber)(n.quotedMsg.mediaKeyTimestamp)?n.quotedMsg.mediaKeyTimestamp:void 0,mimetype:n.quotedMsg.mimetype,url:n.quotedMsg.clientUrl||n.quotedMsg.deprecatedMms3Url,width:n.quotedMsg.width},t)}else n.quotedRemoteJid&&n.quotedGroupSubject&&n.quotedParentGroupJid?(r.remoteJid=A(n.quotedRemoteJid),r.groupSubject=n.quotedGroupSubject,r.parentGroupJid=A(n.quotedParentGroupJid)):n.quotedRemoteJid&&(r.remoteJid=A(n.quotedRemoteJid));if(n.mentionedJidList&&n.mentionedJidList.length>0){const e=n.mentionedJidList;r.mentionedJid=e.map(A)}n.conversionTuple&&Object.assign(r,n.conversionTuple);n.isForwarded&&(r.isForwarded=n.isForwarded);n.forwardingScore&&(r.forwardingScore=n.forwardingScore);n.ephemeralDuration&&(r.expiration=n.ephemeralDuration);n.ephemeralSettingTimestamp&&(r.ephemeralSettingTimestamp=n.ephemeralSettingTimestamp);n.disappearingModeInitiator&&(r.disappearingMode=y(n.disappearingModeInitiator));n.ctwaContext&&(r.externalAdReply={sourceUrl:n.ctwaContext.sourceUrl,sourceId:n.ctwaContext.sourceId,sourceType:n.ctwaContext.sourceType,body:n.ctwaContext.description,title:n.ctwaContext.title,thumbnailUrl:n.ctwaContext.thumbnailUrl,thumbnail:n.ctwaContext.thumbnail?P(n.ctwaContext.thumbnail):void 0,mediaType:n.ctwaContext.mediaType,mediaUrl:n.ctwaContext.mediaUrl});return b(n,t,Object.keys(r).length>0?r:void 0)},t.createViewOnceFutureProofMessage=m,t.encodeJid=A,t.populateMessageContextInfo=function(e,t,n){if(!t&&!n)return;e.messageContextInfo={deviceListMetadata:{senderKeyHash:null==t?void 0:t.keyHash,senderTimestamp:null==t?void 0:t.timestamp,senderKeyIndexes:null==t?void 0:t.keyIndexes,recipientKeyHash:null==n?void 0:n.keyHash,recipientTimestamp:null==n?void 0:n.timestamp,recipientKeyIndexes:null==n?void 0:n.keyIndexes},deviceListMetadataVersion:2}};var i=r(n(81109)),a=n(15688),o=n(51737),s=n(15461),l=r(n(76139)),c=r(n(89867)),d=r(n(35667)),u=n(24606),p=n(24808),f=n(34535),h=r(n(5165)),_=n(64551),g=n(93650);function m(e){return{viewOnceMessage:{message:e}}}function y(e){let t;switch(e){case u.DisappearingModeInitiator.ChangedInChat:t=p.DisappearingModeInitiator.CHANGED_IN_CHAT;break;case u.DisappearingModeInitiator.InitiatedByMe:t=p.DisappearingModeInitiator.INITIATED_BY_ME;break;case u.DisappearingModeInitiator.InitiatedByOther:t=p.DisappearingModeInitiator.INITIATED_BY_OTHER}return{initiator:t}}function E(e,t,n){const{documentMessage:r,imageMessage:i,locationMessage:a,videoMessage:o}=e;if(t.isForwarded&&(r||i||a||o))return e;const s={buttons:!0===t.isForwarded?void 0:t.dynamicReplyButtons,footerText:t.footer,contextInfo:n};return r?(s.documentMessage=r,s.headerType=p.Message$ButtonsMessageHeaderType.DOCUMENT,s.contentText=t.caption):i?(s.imageMessage=i,s.headerType=p.Message$ButtonsMessageHeaderType.IMAGE,s.contentText=t.caption):a?(s.locationMessage=a,s.headerType=p.Message$ButtonsMessageHeaderType.LOCATION,s.contentText=t.caption):o?(s.videoMessage=o,s.headerType=p.Message$ButtonsMessageHeaderType.VIDEO,s.contentText=t.caption):t.title?(s.text=t.title,s.headerType=p.Message$ButtonsMessageHeaderType.TEXT,s.contentText=t.body):(s.contentText=t.body,s.headerType=p.Message$ButtonsMessageHeaderType.EMPTY),{buttonsMessage:s}}function S(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;const i={url:t.url,mimetype:r,caption:e.caption,directPath:t.directPath||void 0,fileSha256:P(t.filehash),fileEncSha256:P(t.encFilehash),height:t.height,width:t.width,fileLength:(0,o.isNumber)(e.size)?e.size:void 0,mediaKey:P(t.mediaKey),mediaKeyTimestamp:(0,o.isNumber)(t.mediaKeyTimestamp)?t.mediaKeyTimestamp:void 0,jpegThumbnail:e.isViewOnce?void 0:P(e.body),contextInfo:n,viewOnce:e.isViewOnce};return M(e.type,i),i}function v(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,i=t.duration;i=(0,o.isString)(i)?parseInt(i,10):i;const a=e.type===s.MSG_TYPE.INTERACTIVE?void 0:e.caption,l={url:t.url,mimetype:r,directPath:t.directPath||void 0,fileSha256:P(t.filehash),fileEncSha256:P(t.encFilehash),height:t.height,width:t.width,seconds:i,caption:a,fileLength:(0,o.isNumber)(e.size)?e.size:void 0,mediaKey:P(t.mediaKey),mediaKeyTimestamp:(0,o.isNumber)(t.mediaKeyTimestamp)?t.mediaKeyTimestamp:void 0,jpegThumbnail:e.isViewOnce?void 0:P(e.body),gifPlayback:e.isGif,gifAttribution:e.gifAttribution,contextInfo:n,streamingSidecar:e.streamingSidecar,viewOnce:e.isViewOnce};return M(e.type,l),l}function T(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;const i=e.type===s.MSG_TYPE.INTERACTIVE?void 0:e.caption,a={url:t.url,mimetype:r,title:i,directPath:t.directPath||void 0,fileSha256:P(t.filehash),fileEncSha256:P(t.encFilehash),fileName:t.filename,fileLength:(0,o.isNumber)(e.size)?e.size:void 0,mediaKey:P(t.mediaKey),mediaKeyTimestamp:(0,o.isNumber)(t.mediaKeyTimestamp)?t.mediaKeyTimestamp:void 0,jpegThumbnail:P(e.body),contextInfo:n,contactVcard:e.isVcardOverMmsDocument,thumbnailDirectPath:t.thumbnailDirectPath,thumbnailSha256:P(t.thumbnailSha256),thumbnailEncSha256:P(t.thumbnailEncSha256),thumbnailHeight:t.thumbnailHeight,thumbnailWidth:t.thumbnailWidth};return Number.isFinite(e.pageCount)&&!Number.isNaN(e.pageCount)&&(a.pageCount=e.pageCount),M(e.type,a),a}function b(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,a=r||{};const l=e.mimetype||t.mimetype||void 0;let c=t.duration;switch(e.type){case s.MSG_TYPE.CHAT:"url"===e.subtype||e.quotedMsg||e.quotedRemoteJid||Array.isArray(e.mentionedJidList)&&e.mentionedJidList.length>0||e.conversionTuple||e.isForwarded||e.forwardingScore||e._isPaymentNoteMsg||e.ephemeralDuration||e.ephemeralSettingTimestamp||e.ctwaContext?a.extendedTextMessage={text:e.body,matchedText:e.matchedText,canonicalUrl:e.canonicalUrl,description:e.description,title:e.title,jpegThumbnail:P(e.thumbnail),previewType:e.richPreviewType,contextInfo:n,mediaKey:P(e.mediaKey),mediaKeyTimestamp:(0,o.isNumber)(e.mediaKeyTimestamp)?e.mediaKeyTimestamp:void 0,thumbnailDirectPath:e.thumbnailDirectPath,thumbnailSha256:P(e.thumbnailSha256),thumbnailEncSha256:P(e.thumbnailEncSha256),thumbnailHeight:e.thumbnailHeight,thumbnailWidth:e.thumbnailWidth}:a.conversation=e.body;break;case s.MSG_TYPE.GROUPS_V4_INVITE:a.groupInviteMessage={inviteCode:e.inviteCode,inviteExpiration:parseInt(e.inviteCodeExp,10),groupJid:e.inviteGrp,groupName:e.inviteGrpName,caption:e.comment,jpegThumbnail:P(e.inviteGrpJpegThum)};break;case s.MSG_TYPE.STICKER:if("image/webp"!==t.mimetype)throw __LOG__(3)`invalid sticker mimetype: ${t.mimetype}`,new Error("invalid sticker mimetype");a.stickerMessage={url:t.url,mimetype:t.mimetype,directPath:t.directPath||void 0,fileSha256:P(t.filehash),fileEncSha256:P(t.encFilehash),mediaKey:P(t.mediaKey),mediaKeyTimestamp:(0,o.isNumber)(t.mediaKeyTimestamp)?t.mediaKeyTimestamp:void 0,fileLength:(0,o.isNumber)(e.size)?e.size:void 0,height:e.height,width:e.width,firstFrameLength:t.firstFrameLength||void 0,firstFrameSidecar:e.firstFrameSidecar||void 0,isAnimated:t.isAnimated,contextInfo:n},M(e.type,a.stickerMessage);break;case s.MSG_TYPE.LOCATION:const r={degreesLatitude:parseFloat(e.lat)||void 0,degreesLongitude:parseFloat(e.lng)||void 0,jpegThumbnail:P(e.body),contextInfo:n};if(e.loc&&(0,o.isString)(e.loc)){const t=e.loc.split("\n");r.name=t[0],r.address=t[1],r.url=e.clientUrl}a.locationMessage=r;break;case s.MSG_TYPE.VCARD:a.contactMessage={displayName:e.vcardFormattedName,vcard:e.body,contextInfo:n};break;case s.MSG_TYPE.MULTI_VCARD:a.contactsArrayMessage={displayName:e.subtype,contacts:e.vcardList.map((e=>e)),contextInfo:n};break;case s.MSG_TYPE.IMAGE:a.imageMessage=S(e,t,n,l);break;case s.MSG_TYPE.PRODUCT:a.productMessage={product:{productImage:{url:t.url,mimetype:l,caption:e.caption,directPath:t.directPath||void 0,fileSha256:P(t.filehash),fileEncSha256:P(t.encFilehash),height:t.height,width:t.width,fileLength:(0,o.isNumber)(e.size)?e.size:void 0,mediaKey:P(t.mediaKey),mediaKeyTimestamp:(0,o.isNumber)(t.mediaKeyTimestamp)?t.mediaKeyTimestamp:void 0,jpegThumbnail:P(e.body)},productId:e.productId,title:e.title,description:e.description,currencyCode:e.currencyCode,priceAmount1000:e.priceAmount1000||void 0,salePriceAmount1000:e.salePriceAmount1000||void 0,retailerId:e.retailerId,url:e.url,productImageCount:e.productImageCount},businessOwnerJid:e.businessOwnerJid,contextInfo:n,body:e.caption,footer:e.footer};break;case s.MSG_TYPE.DOCUMENT:a.documentMessage=T(e,t,n,l);break;case s.MSG_TYPE.PTT:case s.MSG_TYPE.AUDIO:c=(0,o.isString)(c)?parseInt(c,10):c;const d={url:t.url,mimetype:l,directPath:t.directPath||void 0,fileSha256:P(t.filehash),fileEncSha256:P(t.encFilehash),seconds:c,ptt:"ptt"===e.type,fileLength:(0,o.isNumber)(e.size)?e.size:void 0,mediaKey:P(t.mediaKey),mediaKeyTimestamp:(0,o.isNumber)(t.mediaKeyTimestamp)?t.mediaKeyTimestamp:void 0,contextInfo:n,streamingSidecar:e.streamingSidecar};_.ServerProps.pttWaveformSend&&e.waveform&&((0,g.validateWaveform)(e.waveform)?d.waveform=e.waveform.buffer:(__LOG__(4,void 0,new Error,!0)`Outgoing waveform with invalid size: ${e.waveform.byteLength}`,SEND_LOGS("outgoing-waveform-invalid-size"))),a.audioMessage=d,M(e.type?"ptt":"audio",a.audioMessage);break;case s.MSG_TYPE.VIDEO:a.videoMessage=v(e,t,n,l);break;case s.MSG_TYPE.PROTOCOL:let u;switch(e.subtype){case"admin_revoke":case"sender_revoke":u={key:C(e.protocolMessageKey),type:p.Message$ProtocolMessageType.REVOKE};break;case"ephemeral_setting":u={type:p.Message$ProtocolMessageType.EPHEMERAL_SETTING,ephemeralExpiration:e.ephemeralDuration};break;case"ephemeral_sync_response":u={type:p.Message$ProtocolMessageType.EPHEMERAL_SYNC_RESPONSE,ephemeralExpiration:e.ephemeralDuration,ephemeralSettingTimestamp:e.ephemeralSettingTimestamp,disappearingMode:y(e.disappearingModeInitiator)};break;case"app_state_sync_key_share":u={type:p.Message$ProtocolMessageType.APP_STATE_SYNC_KEY_SHARE,appStateSyncKeyShare:e.appStateSyncKeyShare};break;case"app_state_sync_key_request":u={type:p.Message$ProtocolMessageType.APP_STATE_SYNC_KEY_REQUEST,appStateSyncKeyRequest:e.appStateSyncKeyRequest};break;case"app_state_fatal_exception_notification":u={type:p.Message$ProtocolMessageType.APP_STATE_FATAL_EXCEPTION_NOTIFICATION,appStateFatalExceptionNotification:e.appStateFatalExceptionNotification}}u&&(a.protocolMessage=u);break;case s.MSG_TYPE.INTERACTIVE:let m={};if((e.caption||e.nativeFlowName===h.default.ORDER_STATUS)&&(m={body:{text:e.caption}}),e.interactiveHeader){const r={title:e.interactiveHeader.title,subtitle:e.interactiveHeader.subtitle,hasMediaAttachment:e.interactiveHeader.hasMediaAttachment};if(e.interactiveHeader.thumbnail)r.jpegThumbnail=P(e.interactiveHeader.thumbnail);else if(e.interactiveHeader.mediaType)switch(e.interactiveHeader.mediaType){case f.InteractiveMessageHeaderMediaType.VIDEO:r.videoMessage=v(e,t,n,l);break;case f.InteractiveMessageHeaderMediaType.DOCUMENT:r.documentMessage=T(e,t,n,l);break;case f.InteractiveMessageHeaderMediaType.IMAGE:r.imageMessage=S(e,t,n,l)}m.header=r}e.footer&&(m.footer={text:e.footer});const O=(0,g.getInteractiveMessageFieldNameForType)(e.interactiveType);O&&(m[O]=e.interactivePayload),n&&(m.contextInfo=n),a.interactiveMessage=m;break;case s.MSG_TYPE.PAYMENT:const I={};I.stanzaId=e.quotedStanzaID,I.mentionedJid=e.mentionedJidList&&e.mentionedJidList.map(A),I.isForwarded=e.isForwarded,I.forwardingScore=e.forwardingScore,I.participant=A(e.quotedParticipant),e.quotedMsg&&(I.quotedMessage=b(e.quotedMsg));const w=e.paymentNoteMsg?b(Object.assign(e.paymentNoteMsg,{_isPaymentNoteMsg:!0}),I):void 0;switch(e.subtype){case"send":const t=e.paymentRequestMessageKey?{fromMe:e.paymentRequestMessageKey.fromMe,remoteJid:A(e.paymentRequestMessageKey.remote),id:e.paymentRequestMessageKey.id,participant:A(e.paymentRequestMessageKey.participant)}:void 0;a.sendPaymentMessage={requestMessageKey:t,noteMessage:w};break;case"request":a.requestPaymentMessage={amount1000:e.amount1000,expiryTimestamp:e._paymentExpiryTimestamp,requestFrom:e._paymentRequestFrom,currencyCodeIso4217:e._currencyCodeIso4217,noteMessage:w}}break;case s.MSG_TYPE.TEMPLATE_BUTTON_REPLY:a.templateButtonReplyMessage={selectedId:e.selectedId,selectedIndex:e.selectedIndex,selectedDisplayText:e.body,contextInfo:n};break;case"template":return"text"===e.subtype?(e.type="chat",e.title&&(e.body="*"+e.title+"*\n"+e.body)):e.type=e.subtype,b(e,t,n,a);case s.MSG_TYPE.LIST:a.listMessage=e.list,a.listMessage.contextInfo=n;break;case s.MSG_TYPE.LIST_RESPONSE:a.listResponseMessage=e.listResponse,a.listResponseMessage.contextInfo=n;break;case s.MSG_TYPE.BUTTONS_RESPONSE:a.buttonsResponseMessage=e.buttonsResponse,a.buttonsResponseMessage.contextInfo=n;break;case s.MSG_TYPE.ORDER:e.itemCount||e.message||e.orderId||e.orderTitle||e.sellerJid||e.status||e.surface||e.thumbnail||e.token||e.totalAmount1000||e.totalCurrencyCode?a.orderMessage={itemCount:e.itemCount,message:e.message,orderId:e.orderId,orderTitle:e.orderTitle,sellerJid:e.sellerJid,status:e.status,surface:e.surface,thumbnail:P(e.thumbnail),token:e.token,totalAmount1000:e.totalAmount1000,totalCurrencyCode:e.totalCurrencyCode}:a.conversation=e.body;break;case s.MSG_TYPE.NATIVE_FLOW:e.headerType===p.Message$ButtonsMessageHeaderType.IMAGE&&(a.imageMessage=S(e,t,void 0,l)),a=E(a,e,n),a.buttonsMessage=(0,i.default)((0,i.default)({},a.buttonsMessage),{},{buttons:e.nativeFlowButtons});break;case s.MSG_TYPE.REACTION:a.reactionMessage={key:C(e.reactionParentKey),text:e.reactionText,senderTimestampMs:e.reactionTimestamp}}return!0===e.isDynamicReplyButtonsMsg&&(a=E(a,e,n)),e.isViewOnce&&(a=m(a)),a}function C(e){const t={fromMe:e.fromMe,id:e.id},n=A(e.remote),r=A(e.participant);return(0,o.isString)(n)&&(t.remoteJid=n),(0,o.isString)(r)&&(t.participant=r),t}function A(e){return e instanceof c.default?e.toString({legacy:!0}):(0,o.isString)(e)?e.replace(/@c.us$/,"@s.whatsapp.net"):void 0}function P(e){return e?(0,a.decodeB64)(e):void 0}function M(e,t){t.viewOnce||(null==t.directPath&&null==t.staticUrl&&(__LOG__(2,void 0,void 0,!0)`directPath missing from msg type ${e}`,SEND_LOGS(`outgoing-${e}-message-missing-direct-path`)),null==t.fileSha256&&(__LOG__(2,void 0,void 0,!0)`fileSha256 missing from msg type ${e}`,SEND_LOGS(`outgoing-${e}-message-missing-file-sha`)),null==t.fileEncSha256&&(__LOG__(2,void 0,void 0,!0)`fileEncSha256 missing from msg type ${e}`,SEND_LOGS(`outgoing-${e}-message-missing-file-enc-sha`)),null==t.url&&null==t.staticUrl&&(__LOG__(2,void 0,void 0,!0)`url(deprecatedMms3Url) missing from msg type ${e}`,SEND_LOGS(`outgoing-${e}-message-missing-mms3-url`)))}},13493:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.convertToTextWithoutSpecialEmojis=Oe,t.decodeBytes=re,t.decodeJid=te,t.decodeUrl=ne,t.isValidReactionMessage=Ae,t.parseAudioMessageProto=q,t.parseButtons=oe,t.parseButtonsMessageProto=Te,t.parseButtonsResponseMessageProto=Ee,t.parseCancelPaymentRequestMessageProto=fe,t.parseContactMessageProto=W,t.parseContactsArrayMessageProto=H,t.parseContextInfoProto=Q,t.parseConversationProto=j,t.parseCtwaContextProto=X,t.parseDeclinePaymentRequestMessageProto=pe,t.parseDeviceSentMessage=ie,t.parseDisappearingModeProto=be,t.parseDocumentMessageProto=z,t.parseEphemeralFutureProofMessageProto=ve,t.parseExtendedTextMessageProto=$,t.parseGroupInviteMessageProto=_e,t.parseImageMessageProto=Y,t.parseInteractiveMessageProto=Ce,t.parseListMessageProto=me,t.parseListResponseMessageProto=ye,t.parseLiveLocationMessageProto=ce,t.parseLocationMessageProto=V,t.parseMsgProto=F,t.parseOrderMessageProto=ge,t.parsePaymentInviteMessageProto=he,t.parsePollUpdateMessageProto=Me,t.parseProductMessageProto=le,t.parseProtocolMessageProto=ee,t.parseReactionMessageProto=Pe,t.parseRequestPaymentMessageProto=ue,t.parseSendPaymentMessageProto=de,t.parseStickerMessageProto=K,t.parseTemplateButtonReplyMessage=se,t.parseTemplateMessage=ae,t.parseVideoMessageProto=J,t.parseViewOnceFutureProofMessageProto=Se,t.validateRequiredMediaProperties=Ie;var i=r(n(81109)),a=r(n(88306)),o=n(15688),s=r(n(78403)),l=r(n(45095)),c=n(51737),d=n(35470),u=n(88555),p=n(40234),f=r(n(64369)),h=n(72441),_=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=x(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(95726)),g=r(n(65212)),m=n(15461),y=r(n(76139)),E=r(n(89867)),S=n(45454),v=n(99140),T=n(17239),b=n(24606),C=n(24808),A=n(67247),P=n(6303),M=n(99234),O=n(57701),I=n(41796),w=n(34535),R=r(n(84064)),D=n(26287),L=r(n(5165)),N=n(90837),k=n(64551),U=n(93650),G=n(21224);function x(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(x=function(e){return e?n:t})(e)}const B=(0,a.default)((function(e){if((0,I.isConnectedToPage)())return y.default.hostname(e);if(!e)return"";const t=y.default.isHttp(e)?e:"http://"+e;return new self.URL(t).hostname}));function F(e,t,n,r,i,a,o,s){if(!e)return __LOG__(4,void 0,new Error,!0)`drop: not Message`,SEND_LOGS("null-message"),t;const{conversation:d,imageMessage:p,contactMessage:f,locationMessage:h,liveLocationMessage:_,extendedTextMessage:g,documentMessage:y,audioMessage:E,videoMessage:S,stickerMessage:v,contactsArrayMessage:T,sendPaymentMessage:b,requestPaymentMessage:C,productMessage:A,groupInviteMessage:P,viewOnceMessage:M,ephemeralMessage:O,orderMessage:I,listMessage:w,listResponseMessage:R,protocolMessage:D,declinePaymentRequestMessage:L,cancelPaymentRequestMessage:N,paymentInviteMessage:U,templateMessage:G,templateButtonReplyMessage:x,buttonsResponseMessage:B,buttonsMessage:F,interactiveMessage:Z,reactionMessage:te,pollUpdateMessage:ne}=e;let re;var oe,be,Ae,Ie;((0,c.isString)(d)&&j(t,d),P&&_e(t,P),p&&(Y(t,p),re=p.contextInfo),v&&(K(t,v),re=v.contextInfo),f&&(W(t,f),re=f.contextInfo),T&&(H(t,T),re=T.contextInfo),h&&(V(t,h),re=h.contextInfo),_&&(ce(t,_,i),re=_.contextInfo),b)&&(re=null===(oe=b.noteMessage)||void 0===oe||null===(be=oe.extendedTextMessage)||void 0===be?void 0:be.contextInfo,de(t,b,r));C&&(re=null===(Ae=C.noteMessage)||void 0===Ae||null===(Ie=Ae.extendedTextMessage)||void 0===Ie?void 0:Ie.contextInfo,ue(t,C,r));if(L&&pe(t,L),N&&fe(t,N),U&&he(t,U),g&&($(t,g),re=g.contextInfo),y&&(z(t,y),re=y.contextInfo),E&&(q(t,E),re=E.contextInfo),S&&(J(t,S),re=S.contextInfo),D&&ee(t,D,n,s),A&&(le(t,A),re=A.contextInfo),I&&(ge(t,I),re=I.contextInfo),w&&(me(t,w),re=w.contextInfo),R&&(ye(t,R),re=R.contextInfo),M&&Se(t,M),O&&ve(t,O),F&&Te(t,F,o),B&&(Ee(t,B),re=B.contextInfo),Z&&(Ce(t,Z,o),re=Z.contextInfo),te&&Pe(t,te),ne&&Me(t),(0,u.isMDBackend)()){const{deviceSentMessage:r,highlyStructuredMessage:i}=e;var we;if(r&&ie(t,r,n),i)t.type=m.MSG_TYPE.HSM,(null===(we=i.hydratedHsm)||void 0===we?void 0:we.hydratedTemplate)&&(t.body=Oe(i.hydratedHsm.hydratedTemplate.hydratedContentText))}return G&&((0,u.isMDBackend)()&&G.hydratedTemplate?ae(t,G.hydratedTemplate):ae(t,(0,l.default)(G.hydratedFourRowTemplate,"templateMessage.hydratedFourRowTemplate"))),x&&(se(t,x),re=x.contextInfo,t.type=m.MSG_TYPE.TEMPLATE_BUTTON_REPLY),re&&(Q(t,re,a),re.externalAdReply&&k.ServerProps.ctwaContextRender&&X(t,re.externalAdReply)),t}function j(e,t){e.type=m.MSG_TYPE.CHAT,e.body=Oe(t)}function Y(e,t){e.type=m.MSG_TYPE.IMAGE,e.deprecatedMms3Url=ne(t.url),e.directPath=t.directPath||"",e.staticUrl=t.staticUrl||"",e.mimetype=t.mimetype||"",e.caption=Oe(t.caption),e.filehash=re(t.fileSha256),e.encFilehash=re(t.fileEncSha256),e.size=t.fileLength||0,e.height=t.height||0,e.width=t.width||0,e.mediaKey=re(t.mediaKey),e.mediaKeyTimestamp=null!=t.mediaKeyTimestamp?t.mediaKeyTimestamp:p.Clock.globalUnixTime(),e.body=re(t.jpegThumbnail)||"",e.interactiveAnnotations=t.interactiveAnnotations,e.scanLengths=t.scanLengths,e.scansSidecar=t.scansSidecar,e.isViewOnce=!0===t.viewOnce,e.thumbnailDirectPath=t.thumbnailDirectPath,e.thumbnailSha256=re(t.thumbnailSha256),e.thumbnailEncSha256=re(t.thumbnailEncSha256),Ie(e,t)}function K(e,t){e.type=m.MSG_TYPE.STICKER,e.deprecatedMms3Url=ne(t.url),e.directPath=t.directPath||"",e.mimetype=t.mimetype||"",e.filehash=re(t.fileSha256),e.encFilehash=re(t.fileEncSha256),e.mediaKey=(0,s.default)(re(t.mediaKey)),e.mediaKeyTimestamp=null!=t.mediaKeyTimestamp?t.mediaKeyTimestamp:p.Clock.globalUnixTime(),e.height=t.height||0,e.width=t.width||0,e.firstFrameLength=t.firstFrameLength,e.firstFrameSidecar=t.firstFrameSidecar,e.isAnimated=t.isAnimated,Ie(e,t)}function W(e,t){e.type=m.MSG_TYPE.VCARD,e.vcardFormattedName=t.displayName,e.body=t.vcard}function H(e,t){const n=t.contacts;e.type=m.MSG_TYPE.MULTI_VCARD,e.vcardFormattedName=t.displayName,e.vcardList=Array.isArray(n)?n.map((e=>({displayName:e.displayName,vcard:e.vcard}))):[]}function V(e,t){const n=t.name&&t.address?`${t.name}\n${t.address}`:t.name||t.address||"";e.type=m.MSG_TYPE.LOCATION,e.lat=void 0!==t.degreesLatitude?t.degreesLatitude:void 0,e.lng=void 0!==t.degreesLongitude?t.degreesLongitude:void 0,e.loc=n,e.body=re(t.jpegThumbnail)||"",e.clientUrl=t.url}function $(e,t){const n=t.matchedText||t.canonicalUrl||t.description||t.title;if(n){const n=B(t.canonicalUrl||""),r=B(t.matchedText||"");e.canonicalUrl=n===r||""===n?t.canonicalUrl:r}e.type=m.MSG_TYPE.CHAT,e.subtype=n?"url":void 0,e.body=Oe(t.text||""),e.matchedText=t.matchedText,e.description=t.description,e.title=t.title,e.thumbnail=re(t.jpegThumbnail)||"",e.richPreviewType=t.previewType,e.doNotPlayInline=t.doNotPlayInline,e.textColor=t.textArgb,e.backgroundColor=t.backgroundArgb,e.mediaKey=re(t.mediaKey),e.mediaKeyTimestamp=t.mediaKeyTimestamp,e.thumbnailDirectPath=t.thumbnailDirectPath,e.thumbnailSha256=re(t.thumbnailSha256),e.thumbnailEncSha256=re(t.thumbnailEncSha256),e.thumbnailHeight=t.thumbnailHeight,e.thumbnailWidth=t.thumbnailWidth;const r=C.Message$ExtendedTextMessageFontType;if(null!=t.font)switch(t.font){case r.SANS_SERIF:case r.SERIF:case r.NORICAN_REGULAR:case r.BRYNDAN_WRITE:case r.BEBASNEUE_REGULAR:case r.OSWALD_HEAVY:e.font=t.font}}function z(e,t){e.type=m.MSG_TYPE.DOCUMENT,e.deprecatedMms3Url=ne(t.url),e.directPath=t.directPath,e.mimetype=t.mimetype,e.filehash=re(t.fileSha256),e.encFilehash=re(t.fileEncSha256),e.size=t.fileLength||0,e.pageCount=t.pageCount||0,e.mediaKey=re(t.mediaKey),e.mediaKeyTimestamp=null!=t.mediaKeyTimestamp?t.mediaKeyTimestamp:p.Clock.globalUnixTime(),e.filename=(0,v.cleanIncomingFilename)(t.fileName||t.title),e.caption=e.filename,e.body=re(t.jpegThumbnail)||"",e.isVcardOverMmsDocument=Boolean(t.contactVcard)&&e.size<=1024*k.ServerProps.vcardMaxSizeKb,e.thumbnailDirectPath=t.thumbnailDirectPath,e.thumbnailSha256=re(t.thumbnailSha256),e.thumbnailEncSha256=re(t.thumbnailEncSha256),e.thumbnailHeight=t.thumbnailHeight,e.thumbnailWidth=t.thumbnailWidth,Ie(e,t)}function q(e,t){e.type=t.ptt?m.MSG_TYPE.PTT:m.MSG_TYPE.AUDIO,e.deprecatedMms3Url=ne(t.url),e.directPath=t.directPath,e.mimetype=t.mimetype,e.filehash=re(t.fileSha256),e.encFilehash=re(t.fileEncSha256),e.size=t.fileLength||0,e.duration=`${t.seconds||0}`,e.mediaKey=re(t.mediaKey),e.mediaKeyTimestamp=null!=t.mediaKeyTimestamp?t.mediaKeyTimestamp:p.Clock.globalUnixTime(),e.streamingSidecar=t.streamingSidecar,e.waveform=t.waveform&&(0,U.validateWaveform)(t.waveform)?new Uint8Array(t.waveform):void 0,Ie(e,t)}function J(e,t){e.type=m.MSG_TYPE.VIDEO,e.deprecatedMms3Url=ne(t.url),e.directPath=t.directPath,e.staticUrl=t.staticUrl||"",e.mimetype=t.mimetype,e.filehash=re(t.fileSha256),e.encFilehash=re(t.fileEncSha256),e.size=t.fileLength||0,e.height=t.height,e.width=t.width,e.duration=`${t.seconds||0}`,e.mediaKey=re(t.mediaKey),e.mediaKeyTimestamp=null!=t.mediaKeyTimestamp?t.mediaKeyTimestamp:p.Clock.globalUnixTime(),e.caption=Oe(t.caption),e.body=re(t.jpegThumbnail)||"",e.isGif=t.gifPlayback,e.gifAttribution=t.gifAttribution,e.streamingSidecar=t.streamingSidecar,e.interactiveAnnotations=t.interactiveAnnotations,e.isViewOnce=!0===t.viewOnce,e.thumbnailDirectPath=t.thumbnailDirectPath,e.thumbnailSha256=re(t.thumbnailSha256),e.thumbnailEncSha256=re(t.thumbnailEncSha256),Ie(e,t)}function Q(e,t,n){const r=t.quotedMessage,i=t.mentionedJid;e.quotedMsg=r&&F(r,{type:m.MSG_TYPE.UNKNOWN}),e.quotedMsg&&"payment"===e.quotedMsg.type&&n&&__LOG__(2)`parseContextInfoProto: payment not supported`,e.quotedStanzaID=t.stanzaId,e.quotedParticipant=te(t.participant),e.quotedRemoteJid=te(t.remoteJid),e.quotedGroupSubject=te(t.groupSubject),e.quotedParentGroupJid=te(t.parentGroupJid),e.mentionedJidList=Array.isArray(i)?i.map(te):i,e.isForwarded=t.isForwarded,e.forwardingScore=t.forwardingScore,null!=t.expiration&&(e.ephemeralDuration=t.expiration),null!=t.ephemeralSettingTimestamp&&(e.ephemeralSettingTimestamp=t.ephemeralSettingTimestamp),null!=t.ephemeralSharedSecret&&(e.ephemeralSharedSecret=t.ephemeralSharedSecret),null!=t.disappearingMode&&be(e,t.disappearingMode),null!=t.actionLink&&(e.actionLink=t.actionLink)}function X(e,t){const n=_.findLink(t.sourceUrl||"",!1,e.from);e.ctwaContext={sourceUrl:t.sourceUrl,description:t.body,title:t.title,thumbnail:t.thumbnail?re(t.thumbnail):null,thumbnailUrl:t.thumbnailUrl,mediaType:t.mediaType,mediaUrl:t.mediaUrl,isSuspiciousLink:(null==n?void 0:n.suspiciousCharacters)&&n.suspiciousCharacters.size>0}}function Z(e,t){if(!e)throw new Error("parseProtocolMessageProto: no message key is defined for protocol message");const{id:n}=e;if(!n)throw new Error("parseProtocolMessageProto: no message id is defined for protocol message");return(0,u.isLegacyWebdBackend)()?new g.default({id:n,fromMe:!!e.fromMe,remote:te(e.remoteJid),participant:te(e.participant)}):function(e,t,n){var r;let i,a,o;if(null==n||null===(r=n.id)||void 0===r?void 0:r.fromMe)i=!!t.fromMe,o=te(t.remoteJid),t.fromMe?o.isUser()||(a=(0,M.getMeUser)()):a=te(t.participant);else if(o=n.id.remote,t.fromMe)i=!1,a=n.author;else{const e=te(t.participant);e?e.equals((0,M.getMeUser)())?(i=!0,o.isUser()||(a=(0,M.getMeUser)())):(i=!1,o.isUser()||(a=e)):i=!0}null!=o&&(o instanceof E.default&&o.isBroadcast()&&!o.isStatusV3()||"broadcast"===(0,h.interpretAndValidateJid)(o.toString()).jidType)&&(o=te(t.participant),a=void 0);return new g.default({id:e,fromMe:i,remote:o,participant:a})}(n,e,t)}function ee(e,t,n,r){if("relay"!==n&&t.type!==C.Message$ProtocolMessageType.EPHEMERAL_SETTING)return;const{key:i,type:a}=t;let o=null;if(e.type=m.MSG_TYPE.PROTOCOL,null!=a)switch(a){case C.Message$ProtocolMessageType.REVOKE:o=Z(i,e),e.protocolMessageKey=o,e.subtype=r===d.EDIT_ATTR.ADMIN_REVOKE?"admin_revoke":"sender_revoke";break;case C.Message$ProtocolMessageType.EPHEMERAL_SETTING:e.subtype="ephemeral_setting",e.ephemeralDuration=t.ephemeralExpiration;break;case C.Message$ProtocolMessageType.EPHEMERAL_SYNC_RESPONSE:e.subtype="ephemeral_sync_response",e.ephemeralDuration=t.ephemeralExpiration,e.ephemeralSettingTimestamp=t.ephemeralSettingTimestamp,null!=t.disappearingMode&&be(e,t.disappearingMode);break;case C.Message$ProtocolMessageType.HISTORY_SYNC_NOTIFICATION:e.subtype="history_sync_notification";const{historySyncNotification:n}=t;if(n){const r={directPath:n.directPath,encFilehash:re(n.fileEncSha256),filehash:re(n.fileSha256),mediaKey:re(n.mediaKey),type:"md-msg-hist"};e.historySyncMetaData={historySyncNotification:t.historySyncNotification,downloadOptions:r}}break;case C.Message$ProtocolMessageType.APP_STATE_SYNC_KEY_REQUEST:case C.Message$ProtocolMessageType.APP_STATE_SYNC_KEY_SHARE:case C.Message$ProtocolMessageType.MSG_FANOUT_BACKFILL_REQUEST:case C.Message$ProtocolMessageType.INITIAL_SECURITY_NOTIFICATION_SETTING_SYNC:case C.Message$ProtocolMessageType.APP_STATE_FATAL_EXCEPTION_NOTIFICATION:e.subtype="unknown"}}function te(e){return e&&E.default.isWid(e)?(0,S.createWid)(e):e}function ne(e){return e&&!e.includes("/u/")?e:void 0}function re(e){return e?(0,o.encodeB64)(e):void 0}function ie(e,t,n){const r=te(t.destinationJid);e.id.remote=r,e.to=r,F(t.message,e,n)}function ae(e,t){const{documentMessage:n,imageMessage:r,locationMessage:i,videoMessage:a}=t;e.isFromTemplate=!0,n?z(e,n):r?Y(e,r):i?V(e,i):a?J(e,a):(e.type=m.MSG_TYPE.CHAT,t.hydratedContentText&&(e.body=Oe(t.hydratedContentText))),t.hydratedButtons&&oe(e,t),t.hydratedContentText&&(e.caption=Oe(t.hydratedContentText)),t.hydratedFooterText&&(e.footer=Oe(t.hydratedFooterText)),t.hydratedTitleText&&(e.title=Oe(t.hydratedTitleText))}function oe(e,t){const{hydratedButtons:n}=t;n.length&&(e.hydratedButtons=n)}function se(e,t){e.body=Oe(t.selectedDisplayText),e.selectedIndex=t.selectedIndex,e.selectedId=t.selectedId}function le(e,t){const{product:n,body:r,footer:i}=t;n&&(n.productImage&&Y(e,n.productImage),e.type=m.MSG_TYPE.PRODUCT,e.businessOwnerJid=t.businessOwnerJid,e.productId=n.productId,e.currencyCode=n.currencyCode,e.priceAmount1000=n.priceAmount1000,e.salePriceAmount1000=n.salePriceAmount1000,e.retailerId=n.retailerId,e.url=n.url,e.productImageCount=n.productImageCount,e.title=n.title,e.description=n.description,e.caption=r,e.footer=i)}function ce(e,t,n){e.type="location",e.isLive=!0,e.lat=t.degreesLatitude,e.lng=t.degreesLongitude,e.body=re(t.jpegThumbnail)||"",e.accuracy=t.accuracyInMeters,e.speed=t.speedInMps,e.degrees=t.degreesClockwiseFromMagneticNorth,e.comment=Oe(t.caption),e.sequence=t.sequenceNumber,n&&(e.finalLat=n.degreesLatitude,e.finalLng=n.degreesLongitude,e.finalThumbnail=re(n.jpegThumbnail)||"",e.finalAccuracy=n.accuracyInMeters,e.finalSpeed=n.speedInMps,e.finalDegrees=n.degreesClockwiseFromMagneticNorth,e.finalTimeOffset=n.timeOffset)}function de(e,t,n){if((null==n?void 0:n.futureproofed)||(0,U.hasUnsupportedCurrency)(n))e.type="unknown",e.subtype="phone_only_feature",__LOG__(2)`parseSendPaymentMessageProto: does not support novi transactions`;else{var r,i,a;e.type=m.MSG_TYPE.PAYMENT,e.subtype="send",t.background&&(e.paymentBackground=t.background),(null===(r=t.noteMessage)||void 0===r?void 0:r.extendedTextMessage)||null!=(null===(i=t.noteMessage)||void 0===i?void 0:i.conversation)||(null===(a=t.noteMessage)||void 0===a?void 0:a.stickerMessage)?(e.paymentNoteMsg={},t.noteMessage=F(t.noteMessage,e.paymentNoteMsg)):e.subtype="futureproof",(0,U.parseMsgPaymentInfo)(e,n);const o=t.requestMessageKey;o&&(e.paymentRequestMessageKey=function(e,t){if(!e)throw new Error("_getPaymentRequestMessageKey: no message key is defined");const{id:n}=e;if(!n)throw new Error("_getPaymentRequestMessageKey: no key id is defined");if(!t.id)return __LOG__(3)`_getPaymentRequestMessageKey: no message id is defined`,null;let r;if(t.id.remote.isGroup()){var i;if(!t.id.fromMe&&!(null===(i=te(e.participant))||void 0===i?void 0:i.equals((0,M.getMeUser)()))&&"send"!==t.subtype)return null;r=te(e.participant)}return new g.default({fromMe:!t.id.fromMe,remote:t.id.remote,id:n,participant:r})}(o,e))}}function ue(e,t,n){if((null==n?void 0:n.futureproofed)||(0,U.hasUnsupportedCurrency)(n))e.subtype="phone_only_feature",__LOG__(2)`parseRequestPaymentMessageProto: does not support novi transactions`;else{var r,i,a;if(e.type=m.MSG_TYPE.PAYMENT,(0,U.parseMsgPaymentInfo)(e,n),e.subtype="request",t.background&&(e.paymentBackground=t.background),(null===(r=t.noteMessage)||void 0===r?void 0:r.extendedTextMessage)||null!=(null===(i=t.noteMessage)||void 0===i?void 0:i.conversation)||(null===(a=t.noteMessage)||void 0===a?void 0:a.stickerMessage)?(e.paymentNoteMsg={},t.noteMessage=F(t.noteMessage,e.paymentNoteMsg)):e.subtype="futureproof",null!=t.amount){if(t.amount.currencyCode&&!e.paymentCurrency&&(e.paymentCurrency=t.amount.currencyCode),null!=t.amount.value&&!e.paymentAmount1000){const n=t.amount,r=null==n.offset||0===n.offset?1e3:n.offset;e.paymentAmount1000=1e3*parseFloat(n.value)/r}}else t.currencyCodeIso4217&&!e.paymentCurrency&&(e.paymentCurrency=t.currencyCodeIso4217),null==t.amount1000||e.paymentAmount1000||(e.paymentAmount1000=t.amount1000);t.requestFrom&&!e.paymentMessageReceiverJid&&(e.paymentMessageReceiverJid=te(t.requestFrom)),e.paymentStatus&&e.paymentTxnStatus||(0,U.isEitherSenderOrReceiverOfPaymentMessage)(e)&&(e.paymentStatus=G.PaymentInfoStatus.WAITING,e.paymentTxnStatus=G.PaymentInfoTxnStatus.COLLECT_INIT),null==t.expiryTimestamp||e.paymentExpiryTimestamp||(e.paymentExpiryTimestamp=t.expiryTimestamp)}}function pe(e,t){const n=function(e,t){if(!e)throw new Error("parseProtocolMessageProto: no message key is defined for decline payment request message");const{id:n}=e;if(!n)throw new Error("parseProtocolMessageProto: no message id is defined for decline payment request message");let r;if(t.id.remote.isGroup()){var i;if(!t.id.fromMe&&!(null===(i=te(e.participant))||void 0===i?void 0:i.equals((0,M.getMeUser)()))&&"send"!==t.subtype)return null;r=te(e.participant)}return new g.default({fromMe:!t.id.fromMe,remote:t.id.remote,id:n,participant:r})}(t.key,e);e.paymentRequestMessageKey=n,e.subtype="payment_action_request_declined"}function fe(e,t){const n=t.key;if(n){const t=function(e,t){if(!e)throw new Error("parseProtocolMessageProto: no message key is defined for cancel payment request message");const{id:n}=e;if(!n)throw new Error("parseProtocolMessageProto: no message id is defined for cancel payment request message");let r;var i;if(t.id.remote.isGroup())if(r=t.id.participant,t.id.fromMe)r=te(t.from);else if(!(null===(i=te(e.participant))||void 0===i?void 0:i.equals((0,M.getMeUser)())))return null;return new g.default({id:n,fromMe:t.id.fromMe,remote:t.id.remote,participant:r})}(n,e);e.paymentRequestMessageKey=t,e.subtype="payment_transaction_request_cancelled"}}function he(e,t){t.serviceType===C.Message$PaymentInviteMessageServiceType.NOVI?(e.subtype="phone_only_feature",__LOG__(2)`[payment-invite] parsePaymentInviteMessageProto: does not support novi transactions`):(e.type=m.MSG_TYPE.PAYMENT,e.subtype="invite",e.paymentExpiryTimestamp=t.expiryTimestamp,e.paymentInviteServiceType=t.serviceType,__LOG__(2)`[payment-invite] render payment invite of type ${t.serviceType}`)}function _e(e,t){e.comment=t.caption,e.inviteCode=t.inviteCode,e.inviteCodeExp=t.inviteExpiration,e.inviteGrp=t.groupJid,e.inviteGrpName=t.groupName,e.type=m.MSG_TYPE.GROUPS_V4_INVITE}function ge(e,t){e.type=m.MSG_TYPE.ORDER,e.thumbnail=re(t.thumbnail),e.message=t.message||"",e.orderId=t.orderId,e.itemCount=t.itemCount||0,e.status=t.status,e.surface=t.surface,e.sellerJid=t.sellerJid,e.orderTitle=t.orderTitle||"",e.token=t.token||"",e.totalAmount1000=t.totalAmount1000,e.totalCurrencyCode=t.totalCurrencyCode,e.body=""}function me(e,t){var n,r;k.ServerProps.webListMessage&&t.listType===C.Message$ListMessageListType.SINGLE_SELECT||(0,O.productListMessagesEnabled)()&&t.listType===C.Message$ListMessageListType.PRODUCT_LIST?(e.type=m.MSG_TYPE.LIST,e.list=t,e.footer=t.footerText,t.listType===C.Message$ListMessageListType.PRODUCT_LIST&&(e.businessOwnerJid=null===(n=t.productListInfo)||void 0===n?void 0:n.businessOwnerJid,e.productListItemCount=null===(r=t.productListInfo)||void 0===r?void 0:r.productSections.reduce(((e,t)=>e+t.products.length),0))):(t.listType===C.Message$ListMessageListType.PRODUCT_LIST&&(0,O.productListMessageFallbackEnabled)()&&(e.subtype="phone_only_feature"),e.type=m.MSG_TYPE.UNKNOWN)}function ye(e,t){if(k.ServerProps.webListMessage&&t.listType===C.Message$ListResponseMessageListType.SINGLE_SELECT){e.type=m.MSG_TYPE.LIST_RESPONSE,e.listResponse=(0,i.default)((0,i.default)({},t),{},{contextInfo:void 0});let n=t.title||"";t.description&&(n+="\n"+t.description),e.body=Oe(n)}}function Ee(e,t){let{selectedDisplayText:n,selectedButtonId:r,type:i}=t;(0,O.buttonsMessagesEnabled)()&&i===C.Message$ButtonsResponseMessageType.DISPLAY_TEXT?(e.type=m.MSG_TYPE.BUTTONS_RESPONSE,e.selectedButtonId=r,e.body=Oe(n)):e.type=m.MSG_TYPE.UNKNOWN}function Se(e,t){k.ServerProps.viewOnceRead?F(t.message,e):(e.type=m.MSG_TYPE.UNKNOWN,e.subtype="phone")}function ve(e,t){F(t.message,e)}function Te(e,t,n){if(!(0,O.buttonsMessagesEnabled)())return void(e.type=m.MSG_TYPE.UNKNOWN);const{documentMessage:r,imageMessage:a,locationMessage:o,videoMessage:s,contentText:l,footerText:c,text:d,buttons:u=[],headerType:p}=t,f=L.default.cast((0,U.getBizNativeFlowName)({buttonsMessage:t}));if(!(0,U.shouldParseNFM)(f,n)||(0,U.hasUnsupportedButtons)(u))return e.type=m.MSG_TYPE.UNKNOWN,void(e.subtype="phone_only_feature");if(p!==C.Message$ButtonsMessageHeaderType.UNKNOWN&&new Set(C.Message$ButtonsMessageHeaderType.members()).has(p)){if(e.type=m.MSG_TYPE.CHAT,e.headerType=p,a?Y(e,a):r?z(e,r):o?V(e,(0,i.default)((0,i.default)({},o),{},{name:void 0,address:void 0})):s?J(e,s):(d&&(e.title=Oe(d)),l&&(e.body=Oe(l))),null==f)u.length&&(e.isDynamicReplyButtonsMsg=!0,e.dynamicReplyButtons=u);else{var h;if(e.type=m.MSG_TYPE.NATIVE_FLOW,e.nativeFlowName=L.default.cast(f),e.nativeFlowButtons=u,!e.nativeFlowName||!(0,D.isValidNativeFlowMessage)(e))return e.type=m.MSG_TYPE.UNKNOWN,void(e.subtype="phone_only_feature");if(e.nativeFlowName===L.default.ORDER_STATUS&&!(0,N.validateOrderAndSendReceipt)(null===(h=e.id)||void 0===h?void 0:h.remote,e))return void(e.subtype="non_renderable")}l&&(e.caption=Oe(l)),c&&(e.footer=Oe(c))}else e.type=m.MSG_TYPE.UNKNOWN}function be(e,t){if(null==e.from)return;const n=e.from.equals((0,M.getMeUser)());if(null!=t.initiator)switch(t.initiator){case C.DisappearingModeInitiator.CHANGED_IN_CHAT:e.disappearingModeInitiator=b.DisappearingModeInitiator.ChangedInChat;break;case C.DisappearingModeInitiator.INITIATED_BY_ME:e.disappearingModeInitiator=n?b.DisappearingModeInitiator.InitiatedByMe:b.DisappearingModeInitiator.InitiatedByOther;break;case C.DisappearingModeInitiator.INITIATED_BY_OTHER:e.disappearingModeInitiator=n?b.DisappearingModeInitiator.InitiatedByOther:b.DisappearingModeInitiator.InitiatedByMe}}function Ce(e,t,n){var r;const i=(0,U.getInteractiveMessageTypeForProto)(t);if(!i||!(0,U.isInteractiveMessageTypeEnabled)(i))return e.type=m.MSG_TYPE.UNKNOWN,void(e.subtype="phone_only_feature");const{body:a,footer:o}=t,s=(0,U.getInteractiveMessageFieldNameForType)(i),l={type:m.MSG_TYPE.INTERACTIVE,caption:null!==(r=Oe(null==a?void 0:a.text))&&void 0!==r?r:"",interactiveType:i,interactivePayload:t[s]};if(!(0,U.isSupportedInteractiveMessageVersion)(l))return e.type=m.MSG_TYPE.UNKNOWN,void(e.subtype="phone_only_feature");if(i===R.default.NATIVE_FLOW){var c;if(l.nativeFlowName=L.default.cast((0,U.getBizNativeFlowName)({interactiveMessage:t})),!(0,U.isValidNativeFlowName)(l.nativeFlowName,n)||!(0,D.isValidNativeFlowMessage)(l))return e.type=m.MSG_TYPE.UNKNOWN,void(e.subtype="phone_only_feature");if(l.nativeFlowName===L.default.ORDER_STATUS&&!(0,N.validateOrderAndSendReceipt)(null===(c=e.id)||void 0===c?void 0:c.remote,l))return void(e.subtype="non_renderable")}o&&(l.footer=Oe(o.text)),function(e,t){let{header:n}=t;if(!n)return;const r={title:Oe(n.title),subtitle:Oe(n.subtitle),thumbnail:re(n.jpegThumbnail),mediaType:void 0,hasMediaAttachment:Boolean(n.hasMediaAttachment)};r.hasMediaAttachment&&(n.documentMessage?(z(e,n.documentMessage),r.mediaType=w.InteractiveMessageHeaderMediaType.DOCUMENT):n.videoMessage?(J(e,n.videoMessage),r.mediaType=w.InteractiveMessageHeaderMediaType.VIDEO):n.imageMessage&&(Y(e,n.imageMessage),r.mediaType=w.InteractiveMessageHeaderMediaType.IMAGE)),e.interactiveHeader=r}(e,t),Object.assign(e,l)}function Ae(e){const t=e.text;return null==t||t.length<=f.default.REACTION_CONTENT_MAX_LENGTH}function Pe(e,t){if(!(0,O.receiveReactionsEnabled)())return e.type=m.MSG_TYPE.UNKNOWN,void(e.subtype="reaction");if(!Ae(t))throw new P.ReactionValidationError("[messaging] Reaction failed validation");const n=Oe(t.text);e.type=m.MSG_TYPE.REACTION,e.reactionParentKey=Z(t.key,e),e.reactionText=n,e.reactionTimestamp=t.senderTimestampMs}function Me(e){(0,O.isPollsFutureproofUpdateHidingEnabled)()&&(e.type=m.MSG_TYPE.UNKNOWN,e.subtype=m.MSG_TYPE.POLL_UPDATE)}function Oe(e){return e?T.Conn.platform===T.PLATFORMS.ANDROID?e:A.EmojiUtil.convertToTextWithoutSpecialEmojis(e):e}function Ie(e,t){var n;if(Math.random()>.001)return;if(!e.id)return;if("status"===(null===(n=e.id.remote)||void 0===n?void 0:n.user)&&E.default.isPSA(e.author)&&!t.staticUrl)return;if(e.id.fromMe)return;const r=e.type;null==t.directPath&&null==t.fileEncSha256?(__LOG__(2,void 0,void 0,!0)`directPath and fileEncSha256 missing from msg type ${r}`,SEND_LOGS(`${r}-message-missing-direct-path-and-file-enc`)):null==t.directPath?(__LOG__(2,void 0,void 0,!0)`directPath missing from msg type ${r}`,SEND_LOGS(`${r}-message-missing-direct-path`)):null==t.fileEncSha256&&(__LOG__(2,void 0,void 0,!0)`fileEncSha256 missing from msg type ${r}`,SEND_LOGS(`${r}-message-missing-file-enc`)),null==t.url&&(__LOG__(2,void 0,void 0,!0)`url(deprecatedMms3Url) is missing from msg type ${r}`,SEND_LOGS(`${r}-message-missing-mms3-url`)),null==t.mediaKey&&(__LOG__(2,void 0,void 0,!0)`mediaKey is missing from msg type ${r}`,SEND_LOGS(`${r}-message-missing-media-key`))}},93650:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getBizNativeFlowName=function(e){var t,n,r,i,a,o;if(1===(null===(t=e.interactiveMessage)||void 0===t||null===(n=t.nativeFlowMessage)||void 0===n||null===(r=n.buttons)||void 0===r?void 0:r.length))return(0,f.getNativeFlowNameByButtonName)(e.interactiveMessage.nativeFlowMessage.buttons[0].name);if(1===(null===(i=e.buttonsMessage)||void 0===i||null===(a=i.buttons)||void 0===a?void 0:a.length))return(0,f.getNativeFlowNameByButtonName)(null===(o=e.buttonsMessage.buttons[0].nativeFlowInfo)||void 0===o?void 0:o.name)},t.getInteractiveMessageFieldNameForType=m,t.getInteractiveMessageTypeForProto=function(e){for(const t of p.default.members())if(m(t)in e)return t;return null},t.hasUnsupportedButtons=function(e){return e.some((e=>e.nativeFlowInfo&&g.includes(e.nativeFlowInfo.name)||g.includes(e.buttonId)))},t.hasUnsupportedCurrency=function(e){var t;const n=(null==e||null===(t=e.primaryAmount)||void 0===t?void 0:t.currencyCode)||(null==e?void 0:e.currency);if(["XUS","XDX","USDP"].includes(null==n?void 0:n.toUpperCase()))return!0;return!1},t.isEitherSenderOrReceiverOfPaymentMessage=function(e){var t,n;if((null===(t=e.id)||void 0===t?void 0:t.remote.isGroup())&&!(null===(n=e.id)||void 0===n?void 0:n.participant.equals((0,c.getMeUser)()))&&!e.paymentMessageReceiverJid.equals((0,c.getMeUser)()))return!1;return!0},t.isInteractiveMessageTypeEnabled=function(e){switch(e){case p.default.NATIVE_FLOW:return(0,d.interactiveNativeFlowMessagesEnabled)();case p.default.SHOPS_STOREFRONT:return(0,d.shopsInteractiveMessageEnabled)()}},t.isSupportedInteractiveMessageVersion=function(e){let{interactivePayload:t,interactiveType:n}=e;const r=null==t?void 0:t.messageVersion;if(null==r||null==n)return!1;switch(n){case p.default.NATIVE_FLOW:case p.default.SHOPS_STOREFRONT:return r<=1}},t.isValidNativeFlowName=_,t.msgKeyToProtobuf=function(e){var t;return{fromMe:e.fromMe,id:e.id,participant:e.fromMe||null===(t=e.participant)||void 0===t?void 0:t.toString({legacy:!0}),remoteJid:e.remote.toString({legacy:!0})}},t.parseMsgPaymentInfo=function(e,t){t&&(e.paymentStatus=t.status,e.paymentTxnStatus=t.txnStatus,e.paymentCurrency=t.currency||"",e.paymentAmount1000=(0,a.default)((0,i.maybeNumberOrThrowIfTooLarge)(t.amount1000),"maybeNumberOrThrowIfTooLarge(paymentInfo.amount1000)"),e.paymentMessageReceiverJid=(0,s.createWid)((0,a.default)(t.receiverJid,"paymentInfo.receiverJid")),e.paymentExpiryTimestamp=(0,i.maybeNumberOrThrowIfTooLarge)(t.expiryTimestamp),e.paymentTransactionTimestamp=(0,a.default)((0,i.maybeNumberOrThrowIfTooLarge)(t.transactionTimestamp),"maybeNumberOrThrowIfTooLarge(paymentInfo.transactionTimestamp)"))},t.protobufToMsgKey=function(e){const{fromMe:t,id:n,participant:r,remoteJid:i}=e;(0,l.default)(null!=t&&null!=i&&null!=n,"fromMe, remoteJid, and id should be set");let a=null!=r&&(0,s.isWidlike)(r)?(0,s.createWid)(r):void 0;const d=(0,s.createWid)(i);(d.isGroup()||d.isBroadcast())&&t&&(a=(0,c.getMaybeMeUser)());return new o.default({fromMe:t,id:n,participant:a,remote:(0,s.createWid)(i)})},t.shouldParseNFM=function(e,t){if(null!=e||null!=(null==t?void 0:t.nativeFlowName))return!!(0,d.nativeFlowMessagesEnabled)()&&_(e,t);return!0},t.typeAttributeFromProtobuf=function e(t){if(t.ephemeralMessage){const{message:n}=t.ephemeralMessage;return n?e(n):u.MSG_TYPES.text}if(t.deviceSentMessage){const{message:n}=t.deviceSentMessage;return n?e(n):u.MSG_TYPES.text}if(t.reactionMessage)return u.MSG_TYPES.reaction;if(t.conversation||t.extendedTextMessage||t.templateButtonReplyMessage||t.protocolMessage||t.interactiveMessage)return u.MSG_TYPES.text;return u.MSG_TYPES.media},t.validateWaveform=function(e){return e.byteLength>=64&&e.byteLength<=192};var i=n(8243),a=r(n(45095)),o=r(n(65212)),s=n(45454),l=r(n(41143)),c=n(99234),d=n(57701),u=n(12037),p=r(n(84064)),f=n(26287),h=r(n(5165));function _(e,t){return null==e&&null==(null==t?void 0:t.nativeFlowName)||null==(null==t?void 0:t.nativeFlowName)||null!=e&&h.default.cast(t.nativeFlowName)===e}const g=["novi_login","novi_report_transaction","novi_hub","novi_view_code","novi_view_transaction","novi_view_bank_detail","novi_view_card_detail","wa_payment_transaction_details","wa_payment_learn_more","wa_payment_fbpin_reset"];function m(e){switch(e){case p.default.NATIVE_FLOW:return"nativeFlowMessage";case p.default.SHOPS_STOREFRONT:return"shopStorefrontMessage"}}},55878:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.decryptGroupSignalProto=function(){return p.apply(this,arguments)},t.decryptSignalProto=function(){return d.apply(this,arguments)},t.encryptSenderKeyMsgSignalProto=function(){return f.apply(this,arguments)},t.encryptSignalProto=function(){return u.apply(this,arguments)};var i=r(n(48926)),a=n(8001),o=n(99234),s=n(45033),l=n(52083),c=n(93832);function d(){return(d=(0,i.default)((function*(e,t,n){const r=new window.libsignal.SessionCipher((0,l.getSignalProtocolStore)(),(0,c.createSignalAddress)(e));try{const e=yield Promise.resolve(r);let i;switch(t){case s.CiphertextType.Pkmsg:i=yield e.decryptPreKeyWhisperMessage(n);break;case s.CiphertextType.Msg:i=yield e.decryptWhisperMessage(n);break;default:return Promise.reject(new Error(`decryptSignalProto: Received unsupported msg type ${t}`))}return i}catch(e){if(e&&"call_failure"===e.reason&&e.value&&"number"==typeof e.value.result)__LOG__(3)`decryptSignalProto error code ${e.value.result}`;else{if(e&&"MessageCounterError"===e.name)return Promise.reject(new a.SignalMessageCounterError(e));__LOG__(3)`decryptSignalProto js error ${e}`}return Promise.reject(new a.SignalDecryptionError(e))}}))).apply(this,arguments)}function u(){return(u=(0,i.default)((function*(e,t){const n=yield new window.libsignal.SessionCipher((0,l.getSignalProtocolStore)(),(0,c.createSignalAddress)(e)),{type:r,body:i}=yield n.encrypt(t);return __LOG__(2)`encryptSignalProto complete, type=${r}`,{type:3===r?s.CiphertextType.Pkmsg:s.CiphertextType.Msg,ciphertext:(0,c.strToBuffer)(i)}}))).apply(this,arguments)}function p(){return(p=(0,i.default)((function*(e,t,n){try{const r=yield new window.libsignal.GroupCipher((0,l.getSignalProtocolStore)(),e.toString({legacy:!0}),(0,c.createSignalAddress)(t));return yield r.decryptSenderKeyMessage(n)}catch(e){if(e&&"MessageCounterError"===e.name)throw new a.SignalMessageCounterError(e);throw new a.SignalDecryptionError(e)}}))).apply(this,arguments)}function f(){return(f=(0,i.default)((function*(e,t){const n=new window.libsignal.GroupCipher((0,l.getSignalProtocolStore)(),e.toString({legacy:!0}),(0,c.createSignalAddress)((0,o.assertGetMe)())),r=yield Promise.resolve(n).then((e=>e.encrypt(t)));return{ciphertext:(0,c.strToBuffer)(r)}}))).apply(this,arguments)}},8001:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SignalMessageCounterError=t.SignalDecryptionError=void 0;var r=n(40265);class i extends((0,r.customError)("SignalDecryptionError")){}t.SignalDecryptionError=i;class a extends((0,r.customError)("SignalMessageCounterError")){}t.SignalMessageCounterError=a},11849:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.waSignalStore=void 0;var r=n(88102),i=n(318),a=n(77246);const o="signal_reg_id",s="signal_static_pubkey",l="signal_static_privkey",c="signal_next_pk_id",d="signal_last_spk_id",u="signal_first_unupload_pk_id",p="signal_sever_has_pre_keys",f="adv_signed_identity",h={name:"AES-CTR",length:128,counter:new Uint8Array(16)};function _(e){return self.crypto.subtle.generateKey({name:h.name,length:h.length},!1,["encrypt","decrypt"]).then((t=>self.crypto.subtle.encrypt(h,t,e).then((e=>({encKey:t,value:e})))))}function g(e){return self.crypto.subtle.decrypt(h,e.encKey,e.value)}const m=new class{constructor(){this.idToSignedPreKey=new Map,r.Cmd.on("logout",(()=>{this.registrationInfo=void 0,this.idToSignedPreKey.clear()}))}getMeta(e){return(0,i.getMetaTable)().get(e).then((e=>e?e.value:null))}putMeta(e){const t=(0,i.getMetaTable)(),n=e.map((e=>t.createOrReplace(e)));return Promise.all(n).then()}setServerHasPreKeys(e){this.putMeta([{key:p,value:e}])}getServerHasPreKeys(){return this.getMeta(p)}putADVSignedIdentity(e){return this.putMeta([{key:f,value:e}])}getADVSignedIdentity(){return this.getMeta(f)}getPreKeysByRange(e,t){return(0,i.getPreKeyTable)().greaterThan(["keyId"],e-1,{limit:t})}getPreKeyById(e){return(0,i.getPreKeyTable)().get(e)}removePreKeyById(e){return(0,i.getPreKeyTable)().remove(e)}bulkRemovePreKey(e){return(0,i.getPreKeyTable)().bulkRemove(e)}putPreKeys(e){const t=(0,i.getPreKeyTable)(),n=e.map((e=>{const{keyId:n,keyPair:r,isDirectDistribution:i}=e;return t.get(n).then((e=>{if(e)throw Error(`preKey id ${n} already exists`);return t.create({keyId:n,keyPair:r,isDirectDistribution:i})}))}));return Promise.all(n).then()}markPreKeyAsDirectDistribution(e){return(0,i.getPreKeyTable)().merge(e,{isDirectDistribution:1})}getSignedPreKey(){return this.getMeta(d).then((e=>this.getSignedPreKeyById(e)))}getSignedPreKeyById(e){if(this.idToSignedPreKey.has(e))return Promise.resolve(this.idToSignedPreKey.get(e));return(0,i.getSignedPreKeyTable)().get(e).then((t=>(this.idToSignedPreKey.set(e,t),t)))}putSignedPreKeys(e){const t=(0,i.getSignedPreKeyTable)(),n=e.map((e=>{const{keyId:n,keyPair:r,signature:i}=e;return t.get(n).then((e=>{if(e)throw Error(`signed preKey id ${n} already exists`);return t.create({keyId:n,keyPair:r,signature:i})}))}));return Promise.all(n).then()}putSession(e,t){return(0,i.getSessionTable)().createOrReplace({address:e,session:t})}bulkPutSession(e){return(0,i.getSessionTable)().bulkCreateOrReplace(e)}removeSession(e){return(0,i.getSessionTable)().remove(e)}bulkRemoveSession(e){return(0,i.getSessionTable)().bulkRemove(e)}getSession(e){return(0,i.getSessionTable)().get(e).then((e=>e?e.session:null))}bulkGetSession(e){return(0,i.getSessionTable)().bulkGet(e).then((e=>e.map((e=>e?e.session:null))))}putIdentity(e,t){return(0,i.getIdentityTable)().createOrReplace({identifier:e,identityKey:t})}bulkPutIdentity(e){return(0,i.getIdentityTable)().bulkCreateOrReplace(e)}bulkGetIdentity(e){return(0,i.getIdentityTable)().bulkGet(e).then((e=>e.map((e=>e?e.identityKey:null))))}getIdentity(e){return(0,i.getIdentityTable)().get(e).then((e=>e?e.identityKey:null))}removeIdentity(e){return(0,i.getIdentityTable)().remove(e)}bulkRemoveIdentity(e){return(0,i.getIdentityTable)().bulkRemove(e)}getIdentityKeyWithRowId(e){return(0,i.getIdentityTable)().get(e).then((e=>e?{identityKey:e.identityKey,rowId:e.rowId}:null))}bulkGetIdentityKeyWithRowId(e){return(0,i.getIdentityTable)().bulkGet(e).then((e=>e.map((e=>e?{identityKey:e.identityKey,rowId:e.rowId}:null))))}bulkPutIdentityKeyWithRowId(e){return(0,i.getIdentityTable)().bulkCreateOrReplace(e)}saveBaseKey(e,t,n){return(0,i.getBaseKeyTable)().createOrReplace({address:e,originalMsgId:t,baseKey:n})}loadBaseKey(e,t){return(0,i.getBaseKeyTable)().equals(["address","originalMsgId"],[e,t]).then((e=>e&&0!==e.length?e[0].baseKey:null))}deleteBaseKey(e,t){const n=(0,i.getBaseKeyTable)();return n.equals(["address","originalMsgId"],[e,t]).then((e=>{if(e&&0!==e.length)return n.remove(e[0].id)}))}putSenderKey(e,t,n){return(0,i.getSenderKeyTable)().createOrReplace({senderKeyName:e,senderId:t,senderKey:n})}bulkPutSenderKey(e){return(0,i.getSenderKeyTable)().bulkCreateOrReplace(e)}removeSenderKey(e){return(0,i.getSenderKeyTable)().remove(e)}getSenderKey(e){return(0,i.getSenderKeyTable)().get(e).then((e=>e?e.senderKey:null))}removeSenderKeyBySenderId(e){const t=(0,i.getSenderKeyTable)();return t.equals(["senderId"],e).then((e=>t.bulkRemove(e.map((e=>e.senderKeyName)))))}clearCredential(){const e=[(0,i.getIdentityTable)(),(0,i.getMetaTable)(),(0,i.getPreKeyTable)(),(0,i.getSessionTable)(),(0,i.getSignedPreKeyTable)()];return Promise.all(e.map((e=>e.clear()))).then((()=>{}))}getRegistrationInfo(){return null!=this.registrationInfo?Promise.resolve(this.registrationInfo):Promise.all([this.getMeta(o),this.getMeta(s),this.getMeta(l)]).then((e=>{let[t,n,r]=e;if(t&&n&&r)return Promise.all([g(n),g(r)]).then((e=>{let[n,r]=e;return this.registrationInfo={registrationId:t,identityKeyPair:{pubKey:n,privKey:r}},this.registrationInfo}))}))}setRegistrationInfo(e){return Promise.all([_(e.identityKeyPair.pubKey),_(e.identityKeyPair.privKey)]).then((t=>{let[n,r]=t;return Promise.all([this.putMeta([{key:o,value:e.registrationId},{key:s,value:n},{key:l,value:r}])]).then()}))}getOrGenPreKeys(e,t){return(0,a.getStorage)().lock(["signal-meta-store","prekey-store"],(()=>Promise.all([this.getMeta(u),this.getMeta(c)]).then((n=>{let[r,i]=n;const a=r||1,o=i||1,s=o-a,l=e-s;if(l<=0)return __LOG__(2)`getPreKeys: no prekey needs to be generated, avaliable: ${s}, need: ${e}`,this.getPreKeysByRange(a,e);const c=function(e,t){const n=[];for(let r=e;r<t;r++)n.push(r);return n}(o,o+l).map((e=>t(e)));return Promise.all(c).then((e=>this.savePreKeys(e))).then((()=>this.getPreKeysByRange(a,e)))}))))}getOrGenSinglePreKey(e){return this.getOrGenPreKeys(1,e).then((e=>{if(1!==e.length)throw Error("Expected to get exactly one key but got ${keys.length}");return e[0]}))}savePreKeys(e){if(0===e.length)return Promise.resolve();const t=e[e.length-1];return Promise.all([this.putMeta([{key:c,value:t.keyId+1}]),this.putPreKeys(e)]).then()}markKeyAsUploaded(e){return Promise.all([this.getMeta(u),this.getMeta(c)]).then((t=>{let[n,r]=t;if(e<0||!r||e>=r)throw Error(`markKeyAsUploaded: key ${e} is out of boundary.`);const i=n?Math.max(n,e+1):e+1;return this.putMeta([{key:u,value:i}])}))}rotateSignedPreKey(e,t){return(0,a.getStorage)().lock(["signal-meta-store","signed-prekey-store"],(()=>this.getMeta(d).then((n=>{const r=null==n?1:n+1;return t(e,r).then((e=>(this.putSignedPreKeys([e]),this.putMeta([{key:d,value:r}]),e)))}))))}};t.waSignalStore=m},93832:(e,t)=>{"use strict";function n(e,t){for(let n=0;n<t;n++)e.writeUint8(t)}Object.defineProperty(t,"__esModule",{value:!0}),t.bufferEqual=function(e,t){if(!e||!t)return!1;if(e.byteLength!==t.byteLength)return!1;const n=new DataView(e),r=new DataView(t);for(let e=0;e<n.byteLength;e++)if(n.getUint8(e)!==r.getUint8(e))return!1;return!0},t.bufferToStr=function(e){return new window.dcodeIO.ByteBuffer.wrap(e).toString("binary")},t.createSignalAddress=function(e){if(!(e.isUser()||e.isServer()||e.isPSA()))throw new Error(`Jid ${e.toString({legacy:!0})} is not fully qualified, jid.server should be "s.whatsapp.net"`);return new window.libsignal.SignalProtocolAddress(e.getSignalAddress(),0)},t.strToBuffer=function(e){return new window.dcodeIO.ByteBuffer.wrap(e,"binary").toArrayBuffer()},t.unpad=function(e){const t=new Uint8Array(e);if(0===t.length)throw new Error("unpadPkcs7 given empty bytes");const n=t[t.length-1];if(n>t.length)throw new Error(`unpad given ${t.length} bytes, but pad is ${n}`);return new Uint8Array(t.buffer,t.byteOffset,t.length-n)},t.writePad=n,t.writeRandomPadMax16=function(e){const t=new Uint8Array(1);self.crypto.getRandomValues(t),n(e,1+(15&t[0]))}},77605:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Session=t.KeyGenerator=t.Cipher=void 0;var r=s(n(58425)),i=s(n(55878)),a=s(n(54084));function o(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(o=function(e){return e?n:t})(e)}function s(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=o(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var s=i?Object.getOwnPropertyDescriptor(e,a):null;s&&(s.get||s.set)?Object.defineProperty(r,a,s):r[a]=e[a]}return r.default=e,n&&n.set(e,r),r}const l=r;t.KeyGenerator=l;const c=i;t.Cipher=c;const d=a;t.Session=d},58425:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.generateIdentityKeyPair=function(){return l.apply(this,arguments)},t.generatePreKeyPair=function(){return o.apply(this,arguments)},t.generateSignedKeyPair=function(){return s.apply(this,arguments)};var i=r(n(48926)),a=n(53614);function o(){return(o=(0,i.default)((function*(e){const t=yield window.libsignal.KeyHelper.generatePreKey(e),{keyId:n,keyPair:r}=t;return{keyId:n,keyPair:(0,a.toCurveKeyPair)(r),isDirectDistribution:0}}))).apply(this,arguments)}function s(){return(s=(0,i.default)((function*(e,t){const n=yield window.libsignal.KeyHelper.generateSignedPreKey(e,t),{keyId:r,keyPair:i,signature:o}=n;return{keyId:r,keyPair:(0,a.toCurveKeyPair)(i),signature:o}}))).apply(this,arguments)}function l(){return(l=(0,i.default)((function*(){const e=yield window.libsignal.KeyHelper.generateIdentityKeyPair();return(0,a.toCurveKeyPair)(e)}))).apply(this,arguments)}},46361:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.stringifyIdentityKey=function(e){if(e instanceof ArrayBuffer)return(0,r.bufferToStr)(e);return e};var r=n(93832)},52083:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.enableMemSignalStore=function(){o=i.default},t.enablePersistSignalStore=function(){o=a.default},t.getSignalProtocolStore=function(){return o};var i=r(n(54624)),a=r(n(76128));let o=a.default},54624:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(48926)),a=r(n(50361)),o=n(88102),s=n(46361),l=n(53614),c=n(99234),d=n(1291),u=n(11849),p=n(93832);var f=new class{constructor(){this.Direction={SENDING:1,RECEIVING:2},this.RegistrationInfo=null,this.SignedPreKeyStore=new Map,this.SessionStore=new Map,this.IdentityStore=new Map,this.PrekeyStore=new Map,this.SenderKeyStore=new Map,o.Cmd.on("logout",(()=>{this.cleanStorage()}))}getIdentityKeyPair(){var e=this;return(0,i.default)((function*(){var t;return e.RegistrationInfo||(e.RegistrationInfo=yield u.waSignalStore.getRegistrationInfo()),(null===(t=e.RegistrationInfo)||void 0===t?void 0:t.identityKeyPair)?(0,l.toSignalCurveKeyPair)(e.RegistrationInfo.identityKeyPair):void 0}))()}getLocalRegistrationId(){var e=this;return(0,i.default)((function*(){var t;return e.RegistrationInfo||(e.RegistrationInfo=yield u.waSignalStore.getRegistrationInfo()),(null===(t=e.RegistrationInfo)||void 0===t?void 0:t.registrationId)||void 0}))()}isTrustedIdentity(){return Promise.resolve(!0)}loadIdentityKey(e){var t=this;return(0,i.default)((function*(){var n;if(null==e)throw new Error("Tried to get identity key for undefined/null key");if(!t.IdentityStore.has(e)){const n=yield u.waSignalStore.getIdentityKeyWithRowId(e);t.IdentityStore.set(e,n)}return(null===(n=t.IdentityStore.get(e))||void 0===n?void 0:n.identityKey)||void 0}))()}saveIdentity(e,t){var n=this;return(0,i.default)((function*(){if(null==e)return Promise.reject(new Error("Tried to put identity key for undefined/null key"));const r=(0,s.stringifyIdentityKey)(t),i=yield n.loadIdentityKey(e);i&&i===r||(i&&e===(0,p.createSignalAddress)((0,c.getMeUser)()).toString()?(0,d.handleSelfPrimaryIdentityChange)():n.putIdentity(e,r))}))()}putIdentity(e,t){this.IdentityStore.set(e,{identityKey:t})}removeIdentity(e){return null==e?Promise.reject(new Error("Tried to remove identity key for undefined/null key")):(this.IdentityStore.set(e,{deleted:!0}),Promise.resolve())}loadPreKey(e){var t=this;return(0,i.default)((function*(){if(null==e)return;if(!t.PrekeyStore.has(e)){var n;const r=null===(n=yield u.waSignalStore.getPreKeyById(e))||void 0===n?void 0:n.keyPair;t.PrekeyStore.set(e,{keyPair:r})}const r=t.PrekeyStore.get(e);return(null==r?void 0:r.keyPair)||void 0}))()}removePreKey(e){return null==e?Promise.reject(new Error("Tried to remove pre key without keyId")):(this.PrekeyStore.set(e,{deleted:!0}),Promise.resolve())}loadSignedPreKey(e){var t=this;return(0,i.default)((function*(){if(null!=e){if(!t.SignedPreKeyStore.has(e)){var n;const r=null===(n=yield u.waSignalStore.getSignedPreKeyById(e))||void 0===n?void 0:n.keyPair;t.SignedPreKeyStore.set(e,r)}return t.SignedPreKeyStore.get(e)||void 0}}))()}loadSession(e){var t=this;return(0,i.default)((function*(){var n;if(null!=e){if(!t.SessionStore.has(e)){const n=yield u.waSignalStore.getSession(e);t.SessionStore.set(e,n?{session:n}:void 0)}return(null===(n=t.SessionStore.get(e))||void 0===n?void 0:n.session)||void 0}}))()}storeSession(e,t){return null==e?Promise.reject(new Error("Tried to put session without identifier")):(this.SessionStore.set(e,{session:t}),Promise.resolve())}removeSession(e){return null==e?Promise.reject(new Error("Tried to remove session without identifier")):(this.SessionStore.set(e,{deleted:!0}),Promise.resolve())}storeSenderKey(e,t){return null==e?Promise.reject(new Error("Tried to put session without identifier")):(this.SenderKeyStore.set(e,t),Promise.resolve())}loadSenderKey(e){var t=this;return(0,i.default)((function*(){if(null!=e){if(!t.SenderKeyStore.has(e)){const n=yield u.waSignalStore.getSenderKey(e);t.SenderKeyStore.set(e,n)}return t.SenderKeyStore.get(e)||void 0}}))()}cleanStorage(){this.RegistrationInfo=null,this.SessionStore.clear(),this.IdentityStore.clear(),this.PrekeyStore.clear(),this.SignedPreKeyStore.clear(),this.SenderKeyStore.clear()}_generateSessionUpdate(){const e=[],t=[];return Array.from(this.SessionStore.keys()).forEach((n=>{const r=this.SessionStore.get(n);r&&(r.deleted?t.push(n):e.push({address:n,session:(0,a.default)(r.session)}))})),{update:e,remove:t}}_generateSenderKeyUpdate(){const e=[];return Array.from(this.SenderKeyStore.keys()).forEach((t=>{const n=this.SenderKeyStore.get(t);if(n){const r=t.split("::");2===r.length&&e.push({senderKeyName:t,senderId:r[1],senderKey:(0,a.default)(n)})}})),e}_generateIdentityUpdate(){const e=[],t=[];return Array.from(this.IdentityStore.keys()).forEach((n=>{const r=this.IdentityStore.get(n);r&&(r.deleted?t.push(n):e.push({identifier:n,identityKey:r.identityKey,rowId:r.rowId}))})),{update:e,remove:t}}_generatePreKeyUpdate(){const e=[];return Array.from(this.PrekeyStore.keys()).forEach((t=>{const n=this.PrekeyStore.get(t);(null==n?void 0:n.deleted)&&e.push(parseInt(t,10))})),e}generateSnapshot(){const e=this._generateIdentityUpdate(),t=this._generateSessionUpdate();return{sessionUpdate:t.update,sessionRemove:t.remove,identityUpdate:e.update,identityRemove:e.remove,senderKeyUpdate:this._generateSenderKeyUpdate(),preKeyRemove:this._generatePreKeyUpdate()}}flushBufferToDiskIfNotMemOnlyMode(){return Promise.resolve()}};t.default=f},76128:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(81109)),a=r(n(48926)),o=n(97197),s=n(46361),l=n(53614),c=n(99234),d=n(57701),u=n(1291),p=n(11849),f=n(77246),h=n(93832);var _=new class{constructor(){this.Direction={SENDING:1,RECEIVING:2},this.RegistrationInfoReadThruCache=null,this.SignedPreKeyStoreReadThruCache=new Map,this.SessionCache=new Map,this.SessionCacheDirtySet=new Set,this._sessionMutex=new o.Semaphore(1),this.IdentityCache=new Map,this.IdentityCacheDirtySet=new Set,this._identityMutex=new o.Semaphore(1)}getIdentityKeyPair(){var e=this;return(0,a.default)((function*(){var t;return e.RegistrationInfoReadThruCache||(e.RegistrationInfoReadThruCache=yield p.waSignalStore.getRegistrationInfo()),(null===(t=e.RegistrationInfoReadThruCache)||void 0===t?void 0:t.identityKeyPair)?(0,l.toSignalCurveKeyPair)(e.RegistrationInfoReadThruCache.identityKeyPair):void 0}))()}getLocalRegistrationId(){var e=this;return(0,a.default)((function*(){var t;return e.RegistrationInfoReadThruCache||(e.RegistrationInfoReadThruCache=yield p.waSignalStore.getRegistrationInfo()),(null===(t=e.RegistrationInfoReadThruCache)||void 0===t?void 0:t.registrationId)||void 0}))()}isTrustedIdentity(){return Promise.resolve(!0)}saveIdentity(e,t){var n=this;return(0,a.default)((function*(){if(null==e)throw new Error("Tried to put identity key for undefined/null key");const r=(0,s.stringifyIdentityKey)(t),i=yield n.loadIdentityKey(e);if(!i||i!==r){if(i){if(e===(0,h.createSignalAddress)((0,c.getMeUser)()).toString())return void(0,u.handleSelfPrimaryIdentityChange)();yield(0,u.handleNewIdentity)(e)}yield n.putIdentity(e,r)}}))()}_putIdentityImpl(e,t){const n=this.IdentityCache.get(e);this.IdentityCache.set(e,(0,i.default)((0,i.default)({},n),{},{identityKey:t})),this.IdentityCacheDirtySet.add(e)}putIdentity(e,t){var n=this;return(0,a.default)((function*(){const r=yield n._identityMutex.acquire();try{(0,d.identityStoreCacheEnabled)()?n._putIdentityImpl(e,t):(yield p.waSignalStore.putIdentity(e,t),n.IdentityCache.set(e,{identityKey:t}))}finally{r.release()}}))()}_loadIdentityKeyImpl(e){var t=this;return(0,a.default)((function*(){var n;if(null==e)throw new Error("Tried to get identity key for undefined/null key");if(!t.IdentityCache.has(e)){const n=yield p.waSignalStore.getIdentityKeyWithRowId(e);t.IdentityCache.set(e,n)}return(null===(n=t.IdentityCache.get(e))||void 0===n?void 0:n.identityKey)||void 0}))()}loadIdentityKey(e){var t=this;return(0,a.default)((function*(){const n=yield t._identityMutex.acquire();try{return yield t._loadIdentityKeyImpl(e)}finally{n.release()}}))()}getIdentityRowId(e){var t=this;return(0,a.default)((function*(){var n;if(null==e)throw new Error("Tried to get identity key for undefined/null key");return yield t.loadIdentityKey(e),(null===(n=t.IdentityCache.get(e))||void 0===n?void 0:n.rowId)||void 0}))()}bulkGetIdentityRowId(e){var t=this;return(0,a.default)((function*(){if(null==e)throw new Error("Tried to get identity key for undefined/null key");return 0===e.length?[]:(yield t.bulkLoadIdentityKey(e),e.map((e=>{var n;return(null===(n=t.IdentityCache.get(e))||void 0===n?void 0:n.rowId)||void 0})))}))()}_bulkLoadIdentityKeyImpl(e){var t=this;return(0,a.default)((function*(){if(null==e)throw new Error("Tried to get identity key for undefined/null key");if(0===e.length)return[];const n=new Array(e.length),r=[];if(e.forEach(((e,i)=>{var a;t.IdentityCache.has(e)?n[i]=null===(a=t.IdentityCache.get(e))||void 0===a?void 0:a.identityKey:r.push({id:e,pos:i})})),r.length>0){(yield p.waSignalStore.bulkGetIdentityKeyWithRowId(r.map((e=>e.id)))).forEach(((e,i)=>{const a=r[i];t.IdentityCache.set(a.id,e),n[a.pos]=null==e?void 0:e.identityKey}))}return n}))()}bulkLoadIdentityKey(e){var t=this;return(0,a.default)((function*(){const n=yield t._identityMutex.acquire();try{return yield t._bulkLoadIdentityKeyImpl(e)}finally{n.release()}}))()}_bulkCreateIdentityImpl(e){var t=this;return(0,a.default)((function*(){if(null==e)throw new Error("Tried to bulk put identity key with undefined/null");__LOG__(2,void 0,void 0,void 0,["Persist protocol store"])`bulkCreateIdentity: store ${e.length} value(s): start`,yield(0,f.getStorage)().lock(["identity-store"],(0,a.default)((function*(){const n=e.map((e=>e.identifier)),r=yield t._bulkLoadIdentityKeyImpl(n),i=e.filter(((e,t)=>!r[t]));i.length>0&&(yield p.waSignalStore.bulkPutIdentity(i),i.forEach((e=>{let{identifier:n,identityKey:r}=e;t.IdentityCache.set(n,{identityKey:r})}))),__LOG__(2,void 0,void 0,void 0,["Persist protocol store"])`bulkCreateIdentity: store ${e.length} value(s) (new: ${i.length}): end`})))}))()}bulkCreateIdentity(e){var t=this;return(0,a.default)((function*(){const n=yield t._identityMutex.acquire();try{yield t._bulkCreateIdentityImpl(e)}finally{n.release()}}))()}_removeIdentityImpl(e){var t=this;return(0,a.default)((function*(){if(null==e)return Promise.reject(new Error("Tried to remove identity key for undefined/null key"));yield p.waSignalStore.removeIdentity(e),t.IdentityCache.delete(e),t.IdentityCacheDirtySet.delete(e)}))()}removeIdentity(e){var t=this;return(0,a.default)((function*(){const n=yield t._identityMutex.acquire();try{yield t._removeIdentityImpl(e)}finally{n.release()}}))()}loadPreKey(e){return(0,a.default)((function*(){if(null==e)return Promise.resolve(void 0);const t=yield p.waSignalStore.getPreKeyById(e);return(null==t?void 0:t.keyPair)||void 0}))()}removePreKey(e){return null==e?Promise.reject(new Error("Tried to remove pre key without keyId")):p.waSignalStore.removePreKeyById(e)}loadSignedPreKey(e){var t=this;return(0,a.default)((function*(){if(null!=e){if(!t.SignedPreKeyStoreReadThruCache.has(e)){var n;const r=null===(n=yield p.waSignalStore.getSignedPreKeyById(e))||void 0===n?void 0:n.keyPair;t.SignedPreKeyStoreReadThruCache.set(e,r)}return t.SignedPreKeyStoreReadThruCache.get(e)||void 0}}))()}loadSession(e){var t=this;return(0,a.default)((function*(){if(null!=e){if(!t.SessionCache.has(e)){const n=yield p.waSignalStore.getSession(e);t.SessionCache.set(e,n)}return t.SessionCache.get(e)||void 0}}))()}_storeSessionImpl(e,t){if(null==e)throw new Error("Tried to put session without identifier");this.SessionCache.set(e,t),this.SessionCacheDirtySet.add(e)}storeSession(e,t){var n=this;return(0,a.default)((function*(){const r=yield n._sessionMutex.acquire();return n._storeSessionImpl(e,t),r.release(),Promise.resolve()}))()}removeSession(e){var t=this;return(0,a.default)((function*(){if(null==e)return Promise.reject(new Error("Tried to remove session without identifier"));yield p.waSignalStore.removeSession(e),t.SessionCache.delete(e),t.SessionCacheDirtySet.delete(e)}))()}containSessions(e){var t=this;return(0,a.default)((function*(){const n=[];for(const r of e)t.SessionCache.has(r)||n.push(r);if(n.length>0){(yield p.waSignalStore.bulkGetSession(n)).forEach(((e,r)=>{const i=n[r];t.SessionCache.set(i,e)}))}return e.map((e=>!!t.SessionCache.get(e)))}))()}storeSenderKey(e,t){if(null==e)return Promise.reject(new Error("Tried to put senderKey without senderKeyName"));const n=e.split("::");if(n.length<2)return Promise.reject(new Error("Tried to put senderKey with invalid senderKeyName"));const r=n[1];return p.waSignalStore.putSenderKey(e,r,t)}loadSenderKey(e){return(0,a.default)((function*(){if(null==e)return Promise.resolve(void 0);return(yield p.waSignalStore.getSenderKey(e))||void 0}))()}deleteAllCache(){__LOG__(2,void 0,void 0,void 0,["Persist protocol store"])`deleteAllCache`,this.RegistrationInfoReadThruCache=null,this.SignedPreKeyStoreReadThruCache.clear(),this.SessionCache.clear(),this.IdentityCache.clear(),this.SessionCacheDirtySet.clear(),this.IdentityCacheDirtySet.clear()}_flushSessions(){var e=this;return(0,a.default)((function*(){if(0===e.SessionCacheDirtySet.size)return void __LOG__(2,void 0,void 0,void 0,["Persist protocol store"])`flushSessions: no updates`;__LOG__(2,void 0,void 0,void 0,["Persist protocol store"])`flushSessions: get dirty updates for ${Array.from(e.SessionCacheDirtySet).join(",")}`;const t=[];e.SessionCacheDirtySet.forEach((n=>{const r=e.SessionCache.get(n);r&&t.push({address:n,session:r})})),t.length>0&&(yield p.waSignalStore.bulkPutSession(t)),e.SessionCacheDirtySet.clear(),__LOG__(2,void 0,void 0,void 0,["Persist protocol store"])`flushSessions: ${t.length} flushed`}))()}_flushIdentities(){var e=this;return(0,a.default)((function*(){if(!(0,d.identityStoreCacheEnabled)())return void __LOG__(2,void 0,void 0,void 0,["Persist protocol store"])`flushIdentities: disabled`;if(0===e.IdentityCacheDirtySet.size)return void __LOG__(2,void 0,void 0,void 0,["Persist protocol store"])`flushIdentities: no updates`;__LOG__(2,void 0,void 0,void 0,["Persist protocol store"])`flushIdentities: get dirty updates for ${Array.from(e.IdentityCacheDirtySet).join(",")}`;const t=[];e.IdentityCacheDirtySet.forEach((n=>{const r=e.IdentityCache.get(n);r&&t.push((0,i.default)((0,i.default)({},r),{},{identifier:n}))})),t.length>0&&(yield p.waSignalStore.bulkPutIdentityKeyWithRowId(t)),e.IdentityCacheDirtySet.clear(),__LOG__(2,void 0,void 0,void 0,["Persist protocol store"])`flushIdentities: ${t.length} flushed`}))()}flushBufferToDiskIfNotMemOnlyMode(){var e=this;return(0,a.default)((function*(){const t=yield e._sessionMutex.acquire(),n=yield e._identityMutex.acquire();try{yield(0,f.getStorage)().lock(["identity-store","session-store"],(()=>Promise.all([e._flushSessions(),e._flushIdentities()])))}finally{n.release(),t.release()}}))()}_updateIdentityRangeAfterEncryptionImpl(e,t){var n=this;return(0,a.default)((function*(){if(__LOG__(2,void 0,void 0,void 0,["Persist protocol store"])`updateIdentityRangeAfterEncryption: start`,yield n._bulkLoadIdentityKeyImpl(t),(0,d.identityStoreCacheEnabled)()){const r=[];t.forEach((t=>{const i=n.IdentityCache.get(t);i&&(null==i.rowId||i.rowId>e)&&(n.IdentityCache.set(t,{identityKey:i.identityKey,rowId:e}),n.IdentityCacheDirtySet.add(t),r.push(t))})),__LOG__(2,void 0,void 0,void 0,["Persist protocol store"])`updateIdentityRangeAfterEncryption: ${r.length} updated`}else{const r=[];t.forEach((t=>{const i=n.IdentityCache.get(t);i&&(null==i.rowId||i.rowId>e)&&(i.rowId=e,r.push({identifier:t,identityKey:i.identityKey,rowId:e}))})),r.length>0&&(yield p.waSignalStore.bulkPutIdentityKeyWithRowId(r),__LOG__(2,void 0,void 0,void 0,["Persist protocol store"])`updateIdentityRangeAfterEncryption: ${r.length} flushed`)}}))()}updateIdentityRangeAfterEncryption(e,t){var n=this;return(0,a.default)((function*(){const r=yield n._identityMutex.acquire();try{yield n._updateIdentityRangeAfterEncryptionImpl(e,t)}finally{r.release()}}))()}};t.default=_},54084:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.createGroupSignalSession=function(){return E.apply(this,arguments)},t.createSignalSession=function(){return h.apply(this,arguments)},t.deleteDeviceSenderKey=function(e){const t=String((0,f.createSignalAddress)(e));return p.waSignalStore.removeSenderKeyBySenderId(t)},t.deleteGroupSenderKeyInfo=function(e){const t=(0,f.createSignalAddress)((0,c.assertGetMe)()),n=`${e.toString({legacy:!0})}::${t.toString()}`;return p.waSignalStore.removeSenderKey(n)},t.deleteRemoteInfo=function(){return g.apply(this,arguments)},t.getGroupSenderKeyInfo=function(){return S.apply(this,arguments)},t.getRemoteRegId=function(){return _.apply(this,arguments)},t.hasSameBaseKey=function(){return y.apply(this,arguments)},t.hasSignalSessions=function(e){return d.default.containSessions(e.map((e=>(0,f.createSignalAddress)(e).toString())))},t.saveSessionBaseKey=function(){return m.apply(this,arguments)};var i=r(n(48926)),a=n(8584),o=n(52230),s=n(46308),l=n(53614),c=n(99234),d=r(n(76128)),u=n(52083),p=n(11849),f=n(93832);function h(){return(h=(0,i.default)((function*(e){const{wid:t,identity:n,deviceIdentity:r}=e;if(__LOG__(2)`Signal::createSignalSession with `,null!=t.device&&t.device!==o.DEFAULT_DEVICE_ID){if(!r)throw new Error("Signal::createSignalSession: expected device-identity in keyBundle for companion device");if(!(yield(0,s.validateADVwithIdentityKey)(t,r,n)))throw new Error("Signal::createSignalSession: invalid identityKey fetched")}let i,c,u;try{i=(0,l.toSignalCurvePubKey)(new a.Binary(e.identity).readBuffer())}catch(e){throw __LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("Signal::createSignalSession: invalid identityKey fetched"),e}try{c=(0,l.toSignalCurvePubKey)(new a.Binary(e.skey.pubkey).readBuffer())}catch(e){throw __LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("Signal::createSignalSession: invalid signedPreKey fetched"),e}if(e.key)try{u=(0,l.toSignalCurvePubKey)(new a.Binary(e.key.pubkey).readBuffer())}catch(e){__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("Signal::createSignalSession: invalid preKey fetched")}const p={registrationId:e.regId,identityKey:i,signedPreKey:{keyId:e.skey.id,publicKey:c,signature:new a.Binary(e.skey.signature).readBuffer()}};return e.key&&u&&(p.preKey={keyId:e.key.id,publicKey:u}),new window.libsignal.SessionBuilder(d.default,(0,f.createSignalAddress)(t)).processPreKey(p)}))).apply(this,arguments)}function _(){return(_=(0,i.default)((function*(e){const t=new window.libsignal.SessionCipher(d.default,(0,f.createSignalAddress)(e));return(yield Promise.resolve(t)).getRemoteRegistrationId()}))).apply(this,arguments)}function g(){return(g=(0,i.default)((function*(e){const t=(0,f.createSignalAddress)(e).toString();yield Promise.all([(0,u.getSignalProtocolStore)().removeIdentity(t),(0,u.getSignalProtocolStore)().removeSession(t)])}))).apply(this,arguments)}function m(){return(m=(0,i.default)((function*(e,t){const n=(0,f.createSignalAddress)(e),r=new window.libsignal.SessionInfo(d.default,n),i=yield r.getSessionBaseKey();i?yield p.waSignalStore.saveBaseKey(n.toString(),t,i):__LOG__(2)`saveSessionBaseKey: for ${t}, no basekey provided`}))).apply(this,arguments)}function y(){return(y=(0,i.default)((function*(e,t){const n=(0,f.createSignalAddress)(e),r=new window.libsignal.SessionInfo(d.default,(0,f.createSignalAddress)(e)),[i,a]=yield Promise.all([r.getSessionBaseKey(),p.waSignalStore.loadBaseKey(n.toString(),t)]);return a?i?(0,f.bufferEqual)(a,i)?(__LOG__(2)`hasSameBaseKey: MsgId: ${t}, savedBaseKey and sessionBaseKey is same`,!0):(__LOG__(2)`hasSameBaseKey: MsgId: ${t}, savedBaseKey and sessionBaseKey is different `,!1):(__LOG__(2)`hasSameBaseKey: MsgId: ${t}, no session has been saved locally `,!1):(__LOG__(2)`hasSameBaseKey: MsgId: ${t}, no base key has been saved locally `,!1)}))).apply(this,arguments)}function E(){return(E=(0,i.default)((function*(e,t,n){const r=new window.libsignal.GroupCipher((0,u.getSignalProtocolStore)(),t,(0,f.createSignalAddress)(e));return(yield Promise.resolve(r)).decryptSenderKeyDistributionMessage(n)}))).apply(this,arguments)}function S(){return(S=(0,i.default)((function*(e){const t=new window.libsignal.GroupCipher(d.default,e.toString({legacy:!0}),(0,f.createSignalAddress)((0,c.assertGetMe)())),n=yield t.createSenderKeyDistributionMsg();return(0,f.strToBuffer)(n)}))).apply(this,arguments)}},91335:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.extractIdentityKey=function(e){const t=window.dcodeIO.ByteBuffer.wrap(e);t.readUint8();try{const e=window.libsignal.Protobuf.PreKeyWhisperMessage.decode(t);return(0,i.toCurveKeyPubKey)(e.identityKey.toArrayBuffer())}catch(e){return __LOG__(3)`extractIdentityKey: parse proto failed`,null}},t.xmppPreKey=function(e){return(0,r.wap)("key",null,(0,r.wap)("id",null,(0,r.BIG_ENDIAN_CONTENT)(e.keyId,3)),(0,r.wap)("value",null,e.keyPair.pubKey))},t.xmppSignedPreKey=function(e){return(0,r.wap)("skey",null,(0,r.wap)("id",null,(0,r.BIG_ENDIAN_CONTENT)(e.keyId,3)),(0,r.wap)("value",null,e.keyPair.pubKey),(0,r.wap)("signature",null,e.signature))};var r=n(31914),i=n(53614)},21084:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(50073),i=n(381),a=n(92844),o=n(60980),s=n(45606),l=n(58052),c=n(89835);class d extends c.SyncActionBase{constructor(){super(...arguments),this.version=4}applyMutations(e){return Promise.all(e.map((e=>{try{if("set"===e.operation){const{value:t}=e,n=t.androidUnsupportedActions;if(!n)return __LOG__(3)`android unsupported actions: malformed mutation`,{actionState:s.SyncActionState.Malformed};return n.allowed&&this.updatePrimaryAllowsAllMutationsFlag("allow_unsupported_mutation"),{actionState:s.SyncActionState.Success}}return __LOG__(3)`locale setting sync: operation not supported`,{actionState:s.SyncActionState.Unsupported}}catch(e){return{actionState:s.SyncActionState.Failed}}})))}getAndroidUnsupportedActionsMutation(){const e=(0,a.unixTimeMs)();return{collection:s.CollectionName.RegularLow,index:JSON.stringify([s.Actions.AndroidUnsupportedActions]),operation:r.SyncdMutationSyncdOperation.SET,version:this.version,binarySyncAction:(0,o.encodeProtobuf)(i.SyncActionValueSpec,{timestamp:e,androidUnsupportedActions:{allowed:!0}}).readBuffer(),timestamp:e,action:s.Actions.AndroidUnsupportedActions}}updatePrimaryAllowsAllMutationsFlag(e){(0,l.getPrimaryAllowsAllMutations)()||(__LOG__(2)`[syncd] primary allows all mutations flag set: ${e}`,(0,l.setPrimaryAllowsAllMutations)())}}const u=new d;Object.freeze(u);var p=u;t.default=p},74362:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(81109)),a=r(n(48926)),o=r(n(45095)),s=n(50073),l=n(381),c=r(n(89867)),d=n(45454),u=n(84902),p=n(60980),f=n(38342),h=n(69951),_=n(45606),g=n(57701),m=n(19937),y=r(n(11339)),E=n(76214),S=r(n(68132)),v=n(89835),T=n(22954),b=n(93824);function C(e,t){switch(t){case m.MessageRangeEncloseType.RangesAreEqual:case m.MessageRangeEncloseType.RangeAEnclosesRangeB:return{actionState:_.SyncActionState.Success};case m.MessageRangeEncloseType.RangeBEnclosesRangeA:case m.MessageRangeEncloseType.RangesNotEnclosing:return{actionState:_.SyncActionState.Orphan,orphanModel:{modelType:_.SyncModelType.Chat,modelId:e.toString()}}}}class A extends v.SyncActionBase{constructor(){super(...arguments),this.version=3}getChatJidAndMessageKey(e){const[,t]=e.indexArr;return t||(0,T.throwInvalidActionIndex)(),{chatJid:t,messageKey:null}}setArchive(e){return(0,a.default)((function*(){yield(0,E.getChatTable)().bulkCreateOrMerge(e),e.forEach((e=>{const t=(0,d.createWid)(e.id),n=h.ChatCollection.get(t);n&&(n.archive=e.archive)}))}))()}validateSyncActionValue(e){const t=e.archiveChatAction;return null!=(null==t?void 0:t.archived)&&(0,m.validateMessageRange)(null==t?void 0:t.messageRange)}applyMutations(e){var t=this;return(0,a.default)((function*(){const n=new Map;yield(0,E.getChatTable)().bulkGet(e.map((e=>{const{indexParts:t}=e,[,n]=t;return n&&c.default.isWid(n)?(0,d.createWid)(n).toString():null})).filter(Boolean)).then((e=>e.forEach((e=>{e&&n.set(e.id,e)}))));const r=[],i=yield Promise.all(e.map(function(){var e=(0,a.default)((function*(e){try{if("set"===e.operation){const{indexParts:i,value:a}=e,[,s]=i;if(s||(0,T.throwInvalidActionIndex)(),!c.default.isWid(s))return(0,b.uploadCriticalEventMetric)(y.default.MD_SYNCD_CRITICAL_EVENT_CODE.ACTION_INVALID_INDEX_DATA),{actionState:_.SyncActionState.Malformed};const l=a.archiveChatAction;if(!t.validateSyncActionValue(a))return __LOG__(3)`[syncd][archive-chat]: malformed mutation`,{actionState:_.SyncActionState.Malformed};const u=(0,o.default)(null==l?void 0:l.archived,"archiveChatAction?.archived"),p=(0,o.default)(null==l?void 0:l.messageRange,"archiveChatAction?.messageRange"),f=(0,d.createWid)(s);if(!n.has(f.toString()))return{actionState:_.SyncActionState.Orphan,orphanModel:{modelType:_.SyncModelType.Chat,modelId:f.toString()}};const h=yield t._applyMutation(f,u,p,a);return h.updates&&r.push(h.updates),h.syncApplyActionResult}return __LOG__(3)`[syncd][archive-chat]: REMOVE operation not supported`,{actionState:_.SyncActionState.Unsupported}}catch(e){return{actionState:_.SyncActionState.Failed}}}));return function(){return e.apply(this,arguments)}}()));return r.length>0&&(yield t.setArchive(r)),i}))()}_applyMutation(e,t,n,r){return(0,a.default)((function*(){if(yield(0,f.removeActiveMessageRange)(e.toString(),(0,f.getActiveRangeAction)("archive")),!t)return{updates:{id:e.toString(),archive:t},syncApplyActionResult:{actionState:_.SyncActionState.Success}};const i=yield(0,m.constructMessageRange)(e,!1),a=(0,m.compareMessageRanges)(i,n),o=(0,p.encodeProtobuf)(l.SyncActionValueSpec,r).readBuffer(),s=()=>(0,f.addActiveMessageRange)(e.toString(),(0,f.getActiveRangeAction)("archive"),o),c=(0,g.archiveV2Supported)()&&S.default.showArchiveV2;switch(a){case m.MessageRangeEncloseType.RangesAreEqual:case m.MessageRangeEncloseType.RangeBEnclosesRangeA:return yield s(),{updates:{id:e.toString(),archive:t},syncApplyActionResult:C(e,a)};case m.MessageRangeEncloseType.RangeAEnclosesRangeB:case m.MessageRangeEncloseType.RangesNotEnclosing:return c?{updates:{id:e.toString(),archive:t},syncApplyActionResult:C(e,a)}:(yield s(),{updates:void 0,syncApplyActionResult:C(e,a)})}}))()}_constructArchiveChatIndex(e){return JSON.stringify([_.Actions.Archive,e.toString({legacy:!0})])}getArchiveChatMutation(e,t,n){var r=this;return(0,a.default)((function*(){const i={timestamp:e,archiveChatAction:{archived:t,messageRange:yield(0,m.constructMessageRange)(n,!0)}};return{collection:_.CollectionName.RegularLow,index:r._constructArchiveChatIndex(n),binarySyncAction:(0,p.encodeProtobuf)(l.SyncActionValueSpec,i).readBuffer(),version:r.version,operation:s.SyncdMutationSyncdOperation.SET,timestamp:e,action:_.Actions.Archive}}))()}getMutationsForArchive(e,t,r){var i=this;return(0,a.default)((function*(){const a=[yield i.getArchiveChatMutation(e,t,r)];if(t&&(0,g.pinChatSyncEnabled)()){const t=n(36014).default;a.push(t.getPinMutation(e,!1,r))}return a}))()}resolveConflicts(e,t){var n=this;return(0,a.default)((function*(){var r,s;const c=e=>(0,u.decodeProtobuf)(l.SyncActionValueSpec,e),h=c(e.binarySyncAction),g=c(t.binarySyncAction),y=e.timestamp,E=t.timestamp,S=(0,o.default)(h.archiveChatAction,"pendingMutationValue.archiveChatAction"),v=(0,o.default)(g.archiveChatAction,"incomingMutationValue.archiveChatAction");switch((0,m.compareMessageRanges)((0,o.default)(v.messageRange,"incomingArchiveChatAction.messageRange"),(0,o.default)(S.messageRange,"pendingArchiveChatAction.messageRange"))){case m.MessageRangeEncloseType.RangeAEnclosesRangeB:return _.ConflictResolutionState.ApplyRemoteAndDropLocal;case m.MessageRangeEncloseType.RangeBEnclosesRangeA:return _.ConflictResolutionState.SkipRemote;case m.MessageRangeEncloseType.RangesAreEqual:return y<=E?_.ConflictResolutionState.ApplyRemoteAndDropLocal:_.ConflictResolutionState.SkipRemote;case m.MessageRangeEncloseType.RangesNotEnclosing:const t=y<=E?null!==(r=v.archived)&&void 0!==r&&r:null!==(s=S.archived)&&void 0!==s&&s,c=(0,m.mergeMessageRanges)((0,o.default)(v.messageRange,"incomingArchiveChatAction.messageRange"),(0,o.default)(S.messageRange,"pendingArchiveChatAction.messageRange")),u=(0,p.encodeProtobuf)(l.SyncActionValueSpec,(0,i.default)((0,i.default)({},g),{},{archiveChatAction:{archived:t,messageRange:c}})).readBuffer(),h=(0,i.default)((0,i.default)({},e),{},{binarySyncAction:u});return delete h.id,yield(0,m.lockForMessageRangeSync)(["chat"],[h],(0,a.default)((function*(){const r=JSON.parse(e.index),i=(0,d.createWid)(r[1]);return yield(0,f.addActiveMessageRange)(i.toString(),(0,f.getActiveRangeAction)("archive"),u),n.setArchive([{id:i.toString(),archive:t}])}))),_.ConflictResolutionState.SkipRemoteAndDropLocal}}))()}}const P=new A;Object.freeze(P);var M=P;t.default=M},28464:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(81109)),a=r(n(48926)),o=n(381),s=n(45454),l=n(84902),c=n(38342),d=n(69702),u=r(n(21084)),p=n(69951),f=n(45606),h=r(n(73407)),_=n(57701),g=n(19937),m=n(76214),y=n(58052),E=r(n(68132)),S=n(99069),v=n(89835);class T extends v.SyncActionBase{constructor(){super(...arguments),this.version=4}decodeValue(e){if(!e.binarySyncData){if(!e.binarySyncAction)throw __LOG__(4,void 0,new Error,!0,["syncd"])`binarySyncAction should not be null`,SEND_LOGS("syncd binarySyncAction should not be null"),new Error("binarySyncAction should not be null");return(0,l.decodeProtobuf)(o.SyncActionValueSpec,e.binarySyncAction)}{const t=(0,l.decodeProtobuf)(o.SyncActionDataSpec,e.binarySyncData);if(t.value)return t.value}}applyMutations(e,t){var n=this;return(0,a.default)((function*(){u.default.updatePrimaryAllowsAllMutationsFlag("other mutation");const{setMutationsPendingToPersist:r}=t;if(e.length>0){const t=e[e.length-1];try{let e=[];if(!(0,_.archiveV2Supported)())return __LOG__(3)`archive setting sync: ArchiveV2 not supported yet`,[{actionState:f.SyncActionState.Unsupported}];if("set"===t.operation){const{value:o}=t,l=o.unarchiveChatsSetting;if(null==(null==l?void 0:l.unarchiveChats))return __LOG__(3)`archive setting sync: malformed mutation`,[{actionState:f.SyncActionState.Malformed}];const c=l.unarchiveChats;return(0,y.getArchiveV2EnabledSetting)()||((0,y.setArchiveV2EnabledSetting)(!0),E.default.archive=(0,i.default)((0,i.default)({},E.default.archive),{},{enabled:!0})),(0,y.setUnarchiveChatsSetting)(c),E.default.archive=(0,i.default)((0,i.default)({},E.default.archive),{},{classic:c}),yield(0,S.getStorage)().lock(["message","chat","sync-actions","active-message-ranges"],(0,a.default)((function*(){e=yield n.updateSideEffectOnChats(c,r),yield(0,m.getChatTable)().bulkCreateOrMerge(e)}))),e.forEach((e=>{const t=(0,s.createWid)(e.id),n=p.ChatCollection.get(t);n&&(n.archive=e.archive)})),[{actionState:f.SyncActionState.Success}]}return __LOG__(3)`archive setting sync: operation not supported`,[{actionState:f.SyncActionState.Unsupported}]}catch(e){return[{actionState:f.SyncActionState.Failed}]}}return __LOG__(3)`archive setting sync: no mutations`,[{actionState:f.SyncActionState.Failed}]}))()}handleSettingOn(e){var t=this;return(0,a.default)((function*(){const n=[];performance.now();const r=(yield(0,m.getChatTable)().all()).filter((e=>e.archive)).map((e=>e.id)),i=(yield Promise.all(r.map((e=>(0,c.getActiveMessageRanges)(e))))).flat().filter((e=>e.action===d.ActiveRangeAction.Archive)).map((e=>e.chatId)),a=r.filter((e=>!i.includes(e))),o=(yield Promise.all(a.map((t=>{const n=(0,s.createWid)(t),r=JSON.stringify([f.Actions.Archive,n.toString({legacy:!0})]),i=e.find((e=>e.index===r));return i?Promise.resolve(i):h.default.getSyncAction(r)})))).filter((e=>{if(!e)return!1;const n=t.decodeValue(e).archiveChatAction;return[f.SyncActionState.Success,f.SyncActionState.Orphan].includes(e.actionState)&&(null==n?void 0:n.archived)&&n.messageRange})).map((e=>{const n=e&&t.decodeValue(e).archiveChatAction;return[e?JSON.parse(e.index)[1]:"",null==n?void 0:n.messageRange]})),l=new Map(o),u=Array.from(l.keys()),p=yield Promise.all(u.map((e=>(0,g.constructMessageRange)((0,s.createWid)(e),!1))));return u.forEach(((e,t)=>{const r=p[t],i=l.get(e);if(i){const t=(0,g.compareMessageRanges)(r,i);if(t===g.MessageRangeEncloseType.RangeAEnclosesRangeB||t===g.MessageRangeEncloseType.RangesNotEnclosing){const t=(0,s.createWid)(e);n.push({id:t.toString({legacy:!1}),archive:!1})}else __LOG__(4,void 0,new Error,!0)`Archive_Setting_Sync: Unsupported rangeEnclosedType ${t}`,SEND_LOGS("ArchiveSettingSync setting true rangeEnclosedType unsupported")}})),performance.now(),n.length,n}))()}handleSettingOff(e){var t=this;return(0,a.default)((function*(){const n=[],r=yield h.default.getSyncActionsRows(["action"],[f.Actions.Archive]),i=e.filter((e=>e.action===f.Actions.Archive)),a=i.map((e=>e.index));return[...r.filter((e=>!a.includes(e.index))),...i].filter((e=>{if(e.actionState===f.SyncActionState.Success){var n;return null===(n=t.decodeValue(e).archiveChatAction)||void 0===n?void 0:n.archived}return!1})).forEach((e=>{const t=JSON.parse(e.index)[1],r=(0,s.createWid)(t);n.push({id:r.toString({legacy:!1}),archive:!0})})),n.length,n}))()}updateSideEffectOnChats(e,t){return e?this.handleSettingOn(t):this.handleSettingOff(t)}}const b=new T;Object.freeze(b);var C=b;t.default=C},29867:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(81109)),a=r(n(48926)),o=r(n(45095)),s=n(50073),l=n(381),c=r(n(89867)),d=n(45454),u=n(84902),p=n(60980),f=n(38342),h=r(n(21084)),_=n(69951),g=n(45606),m=r(n(73407)),y=n(57701),E=n(19937),S=r(n(11339)),v=n(76214),T=n(6684),b=n(89835),C=n(22954),A=n(93824);class P extends b.SyncActionBase{constructor(){super(...arguments),this.version=6}getChatJidAndMessageKey(e){const[,t]=e.indexArr;return t||(0,C.throwInvalidActionIndex)(),{chatJid:t,messageKey:null}}_getMessageIdsThatWereUnstarredInCurrentPatch(e,t){const n=new Set;return e.forEach((e=>{if(e.actionName===g.Actions.Star&&e.timestamp>t){const t=(0,A.getMsgKeyFromStarActionIndex)(e.index);n.add(t.toString())}})),n}validateSyncActionValue(e){const t=e.clearChatAction;return(0,E.validateMessageRange)(null==t?void 0:t.messageRange)}applyMutations(e,t){var n=this;h.default.updatePrimaryAllowsAllMutationsFlag("other mutation");const{allSupportedSetMutations:r}=t;return Promise.all(e.map(function(){var e=(0,a.default)((function*(e){try{if(!(0,y.clearOrDeleteChatSyncEnabled)())return __LOG__(3)`[syncd][clear-chat]: not enabled`,Promise.resolve({actionState:g.SyncActionState.Unsupported});if("set"===e.operation){var t;const{indexParts:i,value:a}=e,[,s,l,u]=i;if(s&&l&&u||(0,C.throwInvalidActionIndex)(),!c.default.isWid(s))return(0,A.uploadCriticalEventMetric)(S.default.MD_SYNCD_CRITICAL_EVENT_CODE.ACTION_INVALID_INDEX_DATA),{actionState:g.SyncActionState.Malformed};if(!n.validateSyncActionValue(a))return __LOG__(3)`[syncd][clear-chat]: malformed mutation`,{actionState:g.SyncActionState.Malformed};const p=(0,o.default)(null===(t=a.clearChatAction)||void 0===t?void 0:t.messageRange,"value.clearChatAction?.messageRange"),f=(0,d.createWid)(s),h=f.toString();if(!(yield(0,v.getChatTable)().get(h)))return{actionState:g.SyncActionState.Orphan,orphanModel:{modelType:g.SyncModelType.Chat,modelId:h}};const _=n._getMessageIdsThatWereUnstarredInCurrentPatch(r,e.timestamp);return n._applyMutation(f,p,"1"===l,"0"===u,_,a)}return __LOG__(3)`[syncd][clear-chat]: REMOVE operation not supported`,{actionState:g.SyncActionState.Unsupported}}catch(e){return{actionState:g.SyncActionState.Failed}}}));return function(){return e.apply(this,arguments)}}()))}clearChat(e,t,r,i){return(0,a.default)((function*(){const{queryAndRemoveMessagesInMessageRange:a}=n(13946),o=yield a(e,t,{skipStarred:!r,skipMessages:i});if((0,y.receiveReactionsEnabled)()&&o.length>0){const t=n(68819).getJobManager;yield t().waitUntilPersisted(T.jobSerializers.deleteReactions(e.toString(),o))}const s=_.ChatCollection.get(e);s&&s.deleteMessages(o)}))()}_applyMutation(e,t,n,r,i,o){var s=this;return(0,a.default)((function*(){const a=(0,p.encodeProtobuf)(l.SyncActionValueSpec,o).readBuffer();return yield(0,f.addActiveMessageRange)(e.toString(),(0,f.getActiveRangeAction)("clearChat",{deleteMedia:r,deleteStarred:n}),a),yield s.clearChat(e,t,n,i),{actionState:g.SyncActionState.Success}}))()}getClearChatMutation(e,t,n,r){var i=this;return(0,a.default)((function*(){let a=yield(0,E.constructForwardMovingMessageRange)(t);const o=i._constructClearChatIndex(t,n,r||!1),c=yield m.default.getPendingMutationsRowsByIndex(["index"],o);if(c.length){var d;const e=c.reduce(((e,t)=>e.timestamp>t.timestamp?e:t)),t=null===(d=(0,u.decodeProtobuf)(l.SyncActionValueSpec,e.binarySyncAction).clearChatAction)||void 0===d?void 0:d.messageRange;t&&(a=(0,E.mergeMessageRanges)(a,t))}const f={timestamp:e,clearChatAction:{messageRange:a}};return{collection:g.CollectionName.RegularHigh,index:o,binarySyncAction:(0,p.encodeProtobuf)(l.SyncActionValueSpec,f).readBuffer(),version:i.version,operation:s.SyncdMutationSyncdOperation.SET,timestamp:e,action:g.Actions.ClearChat}}))()}_constructClearChatIndex(e,t,n){return JSON.stringify([g.Actions.ClearChat,e.toString({legacy:!0}),t?"1":"0",n?"1":"0"])}resolveConflicts(e,t){var n=this;return(0,a.default)((function*(){const r=e=>(0,u.decodeProtobuf)(l.SyncActionValueSpec,e),s=r(e.binarySyncAction),c=r(t.binarySyncAction),h=e.timestamp,_=t.timestamp,m=(0,o.default)(s.clearChatAction,"pendingMutationValue.clearChatAction"),y=(0,o.default)(c.clearChatAction,"incomingMutationValue.clearChatAction");switch((0,E.compareMessageRanges)((0,o.default)(y.messageRange,"incomingClearChatAction.messageRange"),(0,o.default)(m.messageRange,"pendingClearChatAction.messageRange"))){case E.MessageRangeEncloseType.RangeAEnclosesRangeB:return g.ConflictResolutionState.ApplyRemoteAndDropLocal;case E.MessageRangeEncloseType.RangeBEnclosesRangeA:return g.ConflictResolutionState.SkipRemote;case E.MessageRangeEncloseType.RangesAreEqual:return h<=_?g.ConflictResolutionState.ApplyRemoteAndDropLocal:g.ConflictResolutionState.SkipRemote;case E.MessageRangeEncloseType.RangesNotEnclosing:const t=(0,E.mergeMessageRanges)((0,o.default)(y.messageRange,"incomingClearChatAction.messageRange"),(0,o.default)(m.messageRange,"pendingClearChatAction.messageRange")),r=(0,p.encodeProtobuf)(l.SyncActionValueSpec,(0,i.default)((0,i.default)({},c),{},{clearChatAction:{messageRange:t}})).readBuffer(),s=(0,i.default)((0,i.default)({},e),{},{binarySyncAction:r});return delete s.id,yield(0,E.lockForMessageRangeSync)([],[s],(0,a.default)((function*(){const i=JSON.parse(e.index),a=(0,d.createWid)(i[1]),o="1"===i[2],s="1"===i[3];return yield(0,f.addActiveMessageRange)(a.toString(),(0,f.getActiveRangeAction)("clearChat",{deleteStarred:o,deleteMedia:s}),r),n.clearChat(a,t,o)}))),g.ConflictResolutionState.SkipRemoteAndDropLocal}}))()}}const M=new P;Object.freeze(M);var O=M;t.default=O},24900:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(81109)),a=r(n(48926)),o=n(72441),s=n(45454),l=n(45606),c=n(35673),d=n(19380),u=n(76214),p=n(959),f=n(89835),h=n(66837),_=n(22954);class g extends f.SyncActionBase{constructor(){super(...arguments),this.version=2}applyMutations(e){return(0,a.default)((function*(){const t=[],n=[],r=yield Promise.all(e.map((e=>{try{const a=e.indexParts,[,o]=a;o||(0,_.throwInvalidActionIndex)();const c=(0,s.createUserWid)(o);if("set"===e.operation){var r;const n=e.value.contactAction;if(!n)return __LOG__(3)`contact sync: malformed mutation`,{actionState:l.SyncActionState.Malformed};const a={id:o,name:n.fullName||"",shortName:n.firstName||(null!==(r=(0,p.getShortName)(n.fullName))&&void 0!==r?r:""),type:"in",isAddressBookContact:1,isContactSyncCompleted:0};return t.push(a),d.ContactCollection.add((0,i.default)((0,i.default)({},a),{},{id:c}),{merge:!0}),(0,h.syncNewContact)(c),{actionState:l.SyncActionState.Success}}if("remove"===e.operation){const e=d.ContactCollection.get(c);return null!=e&&e.setNotMyContact(),n.push(c),{actionState:l.SyncActionState.Success}}return __LOG__(3)`contact sync: operation not supported`,{actionState:l.SyncActionState.Unsupported}}catch(e){return{actionState:l.SyncActionState.Failed}}})));if(yield(0,u.getContactTable)().bulkCreateOrMerge(t),n.length>0){const e=n.map((e=>(0,o.toPhoneUserJid)(e.user)));yield(0,c.setNotAddressBookContacts)(e)}return r}))()}}const m=new g;Object.freeze(m);var y=m;t.default=y},56928:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(81109)),a=r(n(48926)),o=r(n(45095)),s=n(50073),l=n(381),c=r(n(89867)),d=n(45454),u=n(84902),p=n(60980),f=n(38342),h=r(n(21084)),_=n(69951),g=n(45606),m=r(n(73407)),y=n(77772),E=n(57701),S=n(19937),v=r(n(11339)),T=n(76214),b=n(6684),C=n(13946),A=n(89835),P=n(22954),M=n(93824);class O extends A.SyncActionBase{constructor(){super(...arguments),this.version=6}validateSyncActionValue(e){const t=e.deleteChatAction;return(0,S.validateMessageRange)(null==t?void 0:t.messageRange)}applyMutations(e){var t=this;return h.default.updatePrimaryAllowsAllMutationsFlag("other mutation"),Promise.all(e.map(function(){var e=(0,a.default)((function*(e){try{if(!(0,E.clearOrDeleteChatSyncEnabled)())return __LOG__(3)`[syncd][delete-chat]: not enabled`,Promise.resolve({actionState:g.SyncActionState.Unsupported});if("set"===e.operation){var n;const{indexParts:r,value:i}=e,[,a,s]=r;if(a&&s||(0,P.throwInvalidActionIndex)(),!c.default.isWid(a))return(0,M.uploadCriticalEventMetric)(v.default.MD_SYNCD_CRITICAL_EVENT_CODE.ACTION_INVALID_INDEX_DATA),{actionState:g.SyncActionState.Malformed};if(!t.validateSyncActionValue(i))return __LOG__(3)`[syncd][delete-chat]: malformed mutation`,{actionState:g.SyncActionState.Malformed};const l=(0,o.default)(null===(n=i.deleteChatAction)||void 0===n?void 0:n.messageRange,"value.deleteChatAction?.messageRange"),u=(0,d.createWid)(a),p=u.toString();return(yield(0,T.getChatTable)().get(p))?t._applyMutation(u,l,"0"===s,i):{actionState:g.SyncActionState.Orphan,orphanModel:{modelType:g.SyncModelType.Chat,modelId:p}}}return __LOG__(3)`[syncd][delete-chat]: REMOVE operation not supported`,{actionState:g.SyncActionState.Unsupported}}catch(e){return{actionState:g.SyncActionState.Failed}}}));return function(){return e.apply(this,arguments)}}()))}deleteChat(e,t){return(0,a.default)((function*(){const r=_.ChatCollection.get(e);if(t){const i=yield(0,C.queryAndRemoveMessagesInMessageRange)(e,t);if((0,E.receiveReactionsEnabled)()&&i.length>0){const t=n(68819).getJobManager;yield t().waitUntilPersisted(b.jobSerializers.deleteReactions(e.toString(),i))}r&&r.deleteMessages(i)}else yield(0,y.deleteFromStorage)(e),r&&r.delete()}))()}_applyMutation(e,t,n,r){var i=this;return(0,a.default)((function*(){const a=(0,p.encodeProtobuf)(l.SyncActionValueSpec,r).readBuffer();yield(0,f.addActiveMessageRange)(e.toString(),(0,f.getActiveRangeAction)("deleteChat",{deleteMedia:n}),a);const o=yield(0,S.constructMessageRange)(e,!1);switch((0,S.compareMessageRanges)(o,t)){case S.MessageRangeEncloseType.RangeAEnclosesRangeB:case S.MessageRangeEncloseType.RangesNotEnclosing:yield i.deleteChat(e,t);break;default:yield i.deleteChat(e)}return{actionState:g.SyncActionState.Success}}))()}getDeleteChatMutation(e,t,n){var r=this;return(0,a.default)((function*(){let i=yield(0,S.constructForwardMovingMessageRange)(t);const a=r._constructDeleteChatIndex(t,n||!1),o=yield m.default.getPendingMutationsRowsByIndex(["index"],a);if(o.length){var c;const e=o.reduce(((e,t)=>e.timestamp>t.timestamp?e:t)),t=null===(c=(0,u.decodeProtobuf)(l.SyncActionValueSpec,e.binarySyncAction).deleteChatAction)||void 0===c?void 0:c.messageRange;t&&(i=(0,S.mergeMessageRanges)(i,t))}const d={timestamp:e,deleteChatAction:{messageRange:i}};return{collection:g.CollectionName.RegularHigh,index:a,binarySyncAction:(0,p.encodeProtobuf)(l.SyncActionValueSpec,d).readBuffer(),version:r.version,operation:s.SyncdMutationSyncdOperation.SET,timestamp:e,action:g.Actions.DeleteChat}}))()}_constructDeleteChatIndex(e,t){return JSON.stringify([g.Actions.DeleteChat,e.toString({legacy:!0}),t?"1":"0"])}resolveConflicts(e,t){var n=this;return(0,a.default)((function*(){const r=e=>(0,u.decodeProtobuf)(l.SyncActionValueSpec,e),s=r(e.binarySyncAction),c=r(t.binarySyncAction),h=e.timestamp,_=t.timestamp,m=(0,o.default)(s.deleteChatAction,"pendingMutationValue.deleteChatAction"),y=(0,o.default)(c.deleteChatAction,"incomingMutationValue.deleteChatAction");switch((0,S.compareMessageRanges)((0,o.default)(y.messageRange,"incomingDeleteChatAction.messageRange"),(0,o.default)(m.messageRange,"pendingDeleteChatAction.messageRange"))){case S.MessageRangeEncloseType.RangeAEnclosesRangeB:return g.ConflictResolutionState.ApplyRemoteAndDropLocal;case S.MessageRangeEncloseType.RangeBEnclosesRangeA:return g.ConflictResolutionState.SkipRemote;case S.MessageRangeEncloseType.RangesAreEqual:return h<=_?g.ConflictResolutionState.ApplyRemoteAndDropLocal:g.ConflictResolutionState.SkipRemote;case S.MessageRangeEncloseType.RangesNotEnclosing:const t=(0,S.mergeMessageRanges)((0,o.default)(y.messageRange,"incomingDeleteChatAction.messageRange"),(0,o.default)(m.messageRange,"pendingDeleteChatAction.messageRange")),r=(0,p.encodeProtobuf)(l.SyncActionValueSpec,(0,i.default)((0,i.default)({},c),{},{deleteChatAction:{messageRange:t}})).readBuffer(),s=(0,i.default)((0,i.default)({},e),{},{binarySyncAction:r});return delete s.id,yield(0,S.lockForMessageRangeSync)([],[s],(0,a.default)((function*(){const i=JSON.parse(e.index),a=(0,d.createWid)(i[1]);return yield(0,f.addActiveMessageRange)(a.toString(),(0,f.getActiveRangeAction)("deleteChat",{deleteMedia:"1"===i[2]}),r),n.deleteChat(a,t)}))),g.ConflictResolutionState.SkipRemoteAndDropLocal}}))()}}const I=new O;Object.freeze(I);var w=I;t.default=w},41058:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(48926)),a=r(n(45095)),o=n(50073),s=n(381),l=n(92844),c=r(n(65212)),d=r(n(89867)),u=n(84902),p=n(60980),f=n(45606),h=n(57701),_=n(84886),g=r(n(11339)),m=n(76214),y=n(59871),E=n(6684),S=n(89835),v=n(22954),T=n(93824);class b extends S.SyncActionBase{constructor(){super(...arguments),this.version=3}applyMutations(e){return(0,i.default)((function*(){const t=[],r=new Map;yield(0,m.getMessageTable)().bulkGet(e.map((e=>{var t;const[,n,r,i,a]=e.indexParts;return n&&r&&i&&a&&d.default.isWid(n)?null===(t=(0,v.syncKeyToMsgKey)(n,r,i,a))||void 0===t?void 0:t.toString():null})).filter(Boolean)).then((e=>e.forEach((e=>{e&&r.set(e.id,e)}))));const i=yield Promise.all(e.map((e=>{try{if("set"===e.operation){const[,n,i,a,o]=e.indexParts;n&&i&&a&&o||(0,v.throwInvalidActionIndex)();const s=(0,v.syncKeyToMsgKey)(n,i,a,o);if(!s)return(0,T.uploadCriticalEventMetric)(g.default.MD_SYNCD_CRITICAL_EVENT_CODE.ACTION_INVALID_INDEX_DATA),{actionState:f.SyncActionState.Malformed};const l=r.get(s.toString());if(!l)return{actionState:f.SyncActionState.Orphan,orphanModel:{modelId:s.toString(),modelType:f.SyncModelType.Msg}};t.push(l.id);const c=y.MsgCollection.get(s);return c?c.delete():__LOG__(3)`delete_message_for_me_sync: msg ${s} found in storage but not in collection`,{actionState:f.SyncActionState.Success}}return __LOG__(3)`delete_message_for_me_sync: operation not supported`,{actionState:f.SyncActionState.Unsupported}}catch(e){return{actionState:f.SyncActionState.Failed}}})));if(t.length>0&&(yield(0,_.removeMessagesFromHistory)(t),(0,h.receiveReactionsEnabled)())){const e=new Set;t.forEach((t=>e.add(c.default.fromString(t).remote.toString())));const r=Array.from(e.values()).join(",").toString(),i=n(68819).getJobManager;yield i().waitUntilPersisted(E.jobSerializers.deleteReactions(r,t))}return i}))()}resolveConflicts(e,t){var n,r;const i=e=>(0,u.decodeProtobuf)(s.SyncActionValueSpec,e),o=(0,a.default)(null===(n=i(e.binarySyncAction).deleteMessageForMeAction)||void 0===n?void 0:n.deleteMedia,"decodeValue(localMutation.binarySyncAction).deleteMessageForMeAction?.deleteMedia");return!(0,a.default)(null===(r=i(t.binarySyncAction).deleteMessageForMeAction)||void 0===r?void 0:r.deleteMedia,"decodeValue(remoteMutation.binarySyncAction).deleteMessageForMeAction?.deleteMedia")&&o?Promise.resolve(f.ConflictResolutionState.SkipRemote):Promise.resolve(f.ConflictResolutionState.SkipRemoteAndDropLocal)}getDeleteForMeMutations(e,t){const n=(0,l.unixTimeMs)();return e.map((e=>{const r={deleteMessageForMeAction:{deleteMedia:t,messageTimestamp:e.t},timestamp:n};return{collection:f.CollectionName.RegularHigh,index:JSON.stringify([f.Actions.DeleteMessageForMe,e.id.remote.toString({legacy:!0}),e.id.id,e.id.fromMe?"1":"0",e.isGroupMsg&&!e.id.fromMe?e.sender.toString({legacy:!0}):"0"]),binarySyncAction:(0,p.encodeProtobuf)(s.SyncActionValueSpec,r).readBuffer(),version:this.version,operation:o.SyncdMutationSyncdOperation.SET,timestamp:n,action:f.Actions.DeleteMessageForMe}}))}}const C=new b;Object.freeze(C);var A=C;t.default=A},12123:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(81109)),a=r(n(48926)),o=r(n(89867)),s=n(45454),l=n(68638),c=n(45606),d=n(82663),u=n(59802),p=n(35389),f=r(n(11339)),h=n(89835),_=n(22954),g=n(93824);class m extends h.SyncActionBase{constructor(){super(...arguments),this.version=c.LABEL_ASSOCIATION_SYNC_VERSION}applyMutations(e){return(0,a.default)((function*(){const t=new Set,r=[],h=[],m=yield Promise.all(e.map(function(){var e=(0,a.default)((function*(e){try{if("set"===e.operation){var a;const{indexParts:m,value:y}=e,[,E,S]=m;E&&S||(0,_.throwInvalidActionIndex)();const v=null===(a=y.labelAssociationAction)||void 0===a?void 0:a.labeled;if(null==v)return __LOG__(3)`label jid sync: malformed mutation`,{actionState:c.SyncActionState.Malformed};if(!o.default.isWid(S))return(0,g.uploadCriticalEventMetric)(f.default.MD_SYNCD_CRITICAL_EVENT_CODE.ACTION_INVALID_INDEX_DATA),{actionState:c.SyncActionState.Malformed};const T=(0,s.createWid)(S),b=T.toString(),C={labelId:E,associationId:b,type:d.LabelAssociationType.Jid};if(v){let e=t.has(b);if(!e){(yield(0,l.getTable)().get(b))&&(t.add(b),e=!0)}const a=n(63183).Chat,o=e?null:new a({id:T});r.push(C),o&&((0,l.getTable)().create((0,i.default)((0,i.default)({},o.toJSON()),{},{id:b})),t.add(b)),o&&n(69951).ChatCollection.add(o),(0,p.addToLabelCollection)(b,[E],u.LabelItemParentType.Chat)}else h.push(C),(0,p.removeLabelFromCollection)(b,E,u.LabelItemParentType.Chat);return{actionState:c.SyncActionState.Success}}return __LOG__(3)`label jid sync: unsupported operation`,{actionState:c.SyncActionState.Unsupported}}catch(e){return{actionState:c.SyncActionState.Failed}}}));return function(){return e.apply(this,arguments)}}()));return yield(0,d.getTable)().bulkRemove(h.map((e=>[e.labelId,e.associationId,e.type]))),yield(0,d.getTable)().bulkCreateOrReplace(r),m}))()}}const y=new m;Object.freeze(y);var E=y;t.default=E},35096:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(48926)),a=r(n(89867)),o=n(45606),s=n(82663),l=n(59802),c=n(35389),d=r(n(11339)),u=n(76214),p=n(89835),f=n(22954),h=n(93824);function _(){return(_=(0,i.default)((function*(e){const t=new Set;return yield(0,u.getMessageTable)().bulkGet(e.map((e=>{var t;const[,,n,r,i,o]=e.indexParts;return n&&r&&i&&o&&a.default.isWid(n)?null===(t=(0,f.syncKeyToMsgKey)(n,r,i,o))||void 0===t?void 0:t.toString():null})).filter(Boolean)).then((e=>e.forEach((e=>{e&&t.add(e.id)})))),t}))).apply(this,arguments)}class g extends p.SyncActionBase{constructor(){super(...arguments),this.version=o.LABEL_ASSOCIATION_SYNC_VERSION}applyMutations(e){return(0,i.default)((function*(){const t=[],n=[],r=yield function(){return _.apply(this,arguments)}(e),i=yield Promise.all(e.map((e=>{try{if("set"===e.operation){var i;const{indexParts:a,value:u}=e,[,p,_,g,m,y]=a;p&&_&&g&&m&&y||(0,f.throwInvalidActionIndex)();const E=null===(i=u.labelAssociationAction)||void 0===i?void 0:i.labeled;if(null==E)return __LOG__(3)`label message sync: malformed mutation`,{actionState:o.SyncActionState.Malformed};const S=(0,f.syncKeyToMsgKey)(_,g,m,y);if(!S)return(0,h.uploadCriticalEventMetric)(d.default.MD_SYNCD_CRITICAL_EVENT_CODE.ACTION_INVALID_INDEX_DATA),{actionState:o.SyncActionState.Malformed};if(!r.has(S.toString()))return{actionState:o.SyncActionState.Orphan,orphanModel:{modelId:S.toString(),modelType:o.SyncModelType.Msg}};const v={labelId:p,associationId:S.toString(),type:s.LabelAssociationType.Message};return E?(t.push(v),(0,c.addToLabelCollection)(S.toString(),[p],l.LabelItemParentType.Msg)):(n.push(v),(0,c.removeLabelFromCollection)(S.toString(),p,l.LabelItemParentType.Msg)),{actionState:o.SyncActionState.Success}}return __LOG__(3)`label message sync: operation not supported`,{actionState:o.SyncActionState.Unsupported}}catch(e){return{actionState:o.SyncActionState.Failed}}})));return yield(0,s.getTable)().bulkRemove(n.map((e=>[e.labelId,e.associationId,e.type]))),yield(0,s.getTable)().bulkCreateOrReplace(t),i}))()}}const m=new g;Object.freeze(m);var y=m;t.default=y},80056:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(81109)),a=r(n(48926)),o=n(45606),s=n(94337),l=n(16770),c=n(89835),d=n(22954);class u extends c.SyncActionBase{constructor(){super(...arguments),this.version=3}applyMutations(e){return Promise.all(e.map(function(){var e=(0,a.default)((function*(e){try{if("set"===e.operation){var t;const{indexParts:n,value:r}=e,[,a]=n;a||(0,d.throwInvalidActionIndex)();const c=r.labelEditAction;if(!c)return __LOG__(3)`label sync: malformed mutation`,{actionState:o.SyncActionState.Malformed};if(c.deleted)return yield(0,s.getTable)().remove(a),l.LabelCollection.remove(a),{actionState:o.SyncActionState.Success};const{color:u,predefinedId:p}=c,f=null!==(t=c.name)&&void 0!==t?t:"";""===f&&__LOG__(3)`labelEditAction.name is empty`,null==u&&__LOG__(3)`labelEditAction.color is empty`;const h={id:a,name:f,colorIndex:u,predefinedId:p};return yield(0,s.getTable)().createOrReplace(h),l.LabelCollection.add((0,i.default)({},h),{merge:!0}),{actionState:o.SyncActionState.Success}}return __LOG__(3)`label sync: operation not supported`,{actionState:o.SyncActionState.Unsupported}}catch(e){return{actionState:o.SyncActionState.Failed}}}));return function(){return e.apply(this,arguments)}}()))}}const p=new u;Object.freeze(p);var f=p;t.default=f},79171:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(48926)),a=n(45606),o=r(n(14296)),s=n(33970),l=n(89835);class c extends l.SyncActionBase{constructor(){super(...arguments),this.version=3}applyMutations(e){return Promise.all(e.map(function(){var e=(0,i.default)((function*(e){try{if("set"===e.operation){const{value:t}=e,n=t.localeSetting;if(!n)return __LOG__(3)`locale setting sync: malformed mutation`,{actionState:a.SyncActionState.Malformed};const r=n.locale;return yield o.default.setLocale(r,s.L10N_PRIORITY.PHONE),{actionState:a.SyncActionState.Success}}return __LOG__(3)`locale setting sync: operation not supported`,{actionState:a.SyncActionState.Unsupported}}catch(e){return{actionState:a.SyncActionState.Failed}}}));return function(){return e.apply(this,arguments)}}()))}}const d=new c;Object.freeze(d);var u=d;t.default=u},64294:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(81109)),a=r(n(48926)),o=r(n(45095)),s=n(50073),l=n(381),c=r(n(64369)),d=r(n(89867)),u=n(45454),p=n(84902),f=n(60980),h=n(38342),_=n(69951),g=n(45606),m=n(19937),y=r(n(11339)),E=n(76214),S=n(89835),v=n(22954),T=n(93824);function b(e,t){switch(t){case m.MessageRangeEncloseType.RangesAreEqual:case m.MessageRangeEncloseType.RangeAEnclosesRangeB:return{actionState:g.SyncActionState.Success};case m.MessageRangeEncloseType.RangeBEnclosesRangeA:case m.MessageRangeEncloseType.RangesNotEnclosing:return{actionState:g.SyncActionState.Orphan,orphanModel:{modelType:g.SyncModelType.Chat,modelId:e.toString()}}}}class C extends S.SyncActionBase{constructor(){super(...arguments),this.version=3}_setRead(e,t){const r=_.ChatCollection.get(e);if(r){const e=n(9609);t?e.markSeen(r):e.markUnseen(r)}}_isChatMarkedUnreadByUser(e){return(0,a.default)((function*(){const t=yield(0,E.getChatTable)().get(e.toString());return(null==t?void 0:t.unreadCount)===c.default.MARKED_AS_UNREAD}))()}validateSyncActionValue(e){const t=e.markChatAsReadAction;return null!=(null==t?void 0:t.read)&&(0,m.validateMessageRange)(null==t?void 0:t.messageRange)}applyMutations(e){var t=this;return Promise.all(e.map(function(){var e=(0,a.default)((function*(e){try{if("set"===e.operation){var n,r;const{indexParts:i,value:a}=e,[,s]=i;if(s||(0,v.throwInvalidActionIndex)(),!t.validateSyncActionValue(a))return __LOG__(3)`[syncd][mark-chat-as-read]: malformed mutation`,{actionState:g.SyncActionState.Malformed};if(!d.default.isWid(s))return(0,T.uploadCriticalEventMetric)(y.default.MD_SYNCD_CRITICAL_EVENT_CODE.ACTION_INVALID_INDEX_DATA),{actionState:g.SyncActionState.Malformed};const l=(0,o.default)(null===(n=a.markChatAsReadAction)||void 0===n?void 0:n.read,"value.markChatAsReadAction?.read"),c=(0,o.default)(null===(r=a.markChatAsReadAction)||void 0===r?void 0:r.messageRange,"value.markChatAsReadAction?.messageRange"),p=(0,u.createWid)(s),f=p.toString();return(yield(0,E.getChatTable)().get(f))?t._applyMutation(p,l,c,a):{actionState:g.SyncActionState.Orphan,orphanModel:{modelType:g.SyncModelType.Chat,modelId:f}}}return __LOG__(3)`[syncd][mark-chat-as-read]: operation not supported`,{actionState:g.SyncActionState.Unsupported}}catch(e){return{actionState:g.SyncActionState.Failed}}}));return function(){return e.apply(this,arguments)}}()))}_applyMutation(e,t,n,r){var i=this;return(0,a.default)((function*(){yield(0,h.removeActiveMessageRange)(e.toString(),(0,h.getActiveRangeAction)("markChatAsRead"));const a=yield(0,m.constructMessageRange)(e,!1),o=(0,m.compareMessageRanges)(a,n),s=(0,f.encodeProtobuf)(l.SyncActionValueSpec,r).readBuffer();switch(o){case m.MessageRangeEncloseType.RangesAreEqual:case m.MessageRangeEncloseType.RangeBEnclosesRangeA:return yield(0,h.addActiveMessageRange)(e.toString(),(0,h.getActiveRangeAction)("markChatAsRead"),s),i._setRead(e,t),Promise.resolve(b(e,o));case m.MessageRangeEncloseType.RangesNotEnclosing:case m.MessageRangeEncloseType.RangeAEnclosesRangeB:return t&&(yield i._isChatMarkedUnreadByUser(e))&&i._setRead(e,t),Promise.resolve(b(e,o))}}))()}_constructMarkChatAsReadIndex(e){return JSON.stringify([g.Actions.MarkChatAsRead,e.toString({legacy:!0})])}getMarkChatAsReadMutation(e,t,n){var r=this;return(0,a.default)((function*(){const i={timestamp:e,markChatAsReadAction:{read:t,messageRange:yield(0,m.constructMessageRange)(n,!0)}};return{collection:g.CollectionName.RegularLow,index:r._constructMarkChatAsReadIndex(n),binarySyncAction:(0,f.encodeProtobuf)(l.SyncActionValueSpec,i).readBuffer(),version:r.version,operation:s.SyncdMutationSyncdOperation.SET,timestamp:e,action:g.Actions.MarkChatAsRead}}))()}resolveConflicts(e,t){var n=this;return(0,a.default)((function*(){var r,s;const c=e=>(0,p.decodeProtobuf)(l.SyncActionValueSpec,e),d=c(e.binarySyncAction),_=c(t.binarySyncAction),y=e.timestamp,E=t.timestamp,S=(0,o.default)(d.markChatAsReadAction,"pendingMutationValue.markChatAsReadAction"),v=(0,o.default)(_.markChatAsReadAction,"incomingMutationValue.markChatAsReadAction");switch((0,m.compareMessageRanges)((0,o.default)(v.messageRange,"incomingMarkChatAsReadAction.messageRange"),(0,o.default)(S.messageRange,"pendingMarkChatAsReadAction.messageRange"))){case m.MessageRangeEncloseType.RangeAEnclosesRangeB:return g.ConflictResolutionState.ApplyRemoteAndDropLocal;case m.MessageRangeEncloseType.RangeBEnclosesRangeA:return g.ConflictResolutionState.SkipRemote;case m.MessageRangeEncloseType.RangesAreEqual:return y<=E?g.ConflictResolutionState.ApplyRemoteAndDropLocal:g.ConflictResolutionState.SkipRemote;case m.MessageRangeEncloseType.RangesNotEnclosing:const t=y<=E?null!==(r=v.read)&&void 0!==r&&r:null!==(s=S.read)&&void 0!==s&&s,c=(0,m.mergeMessageRanges)((0,o.default)(v.messageRange,"incomingMarkChatAsReadAction.messageRange"),(0,o.default)(S.messageRange,"pendingMarkChatAsReadAction.messageRange")),d=(0,f.encodeProtobuf)(l.SyncActionValueSpec,(0,i.default)((0,i.default)({},_),{},{markChatAsReadAction:{read:t,messageRange:c}})).readBuffer(),p=(0,i.default)((0,i.default)({},e),{},{binarySyncAction:d});return delete p.id,yield(0,m.lockForMessageRangeSync)(["chat"],[p],(0,a.default)((function*(){const r=JSON.parse(e.index),i=(0,u.createWid)(r[1]);return yield(0,h.addActiveMessageRange)(i.toString(),(0,h.getActiveRangeAction)("markChatAsRead"),d),n._setRead(i,t)}))),g.ConflictResolutionState.SkipRemoteAndDropLocal}}))()}}const A=new C;Object.freeze(A);var P=A;t.default=P},19937:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.MessageRangeEncloseType=void 0,t.compareMessageRanges=function(e,t){const n=E(e,t),r=E(t,e);if(n&&r)return y.RangesAreEqual;if(n)return y.RangeAEnclosesRangeB;if(r)return y.RangeBEnclosesRangeA;return y.RangesNotEnclosing},t.constructForwardMovingMessageRange=function(){return P.apply(this,arguments)},t.constructMessageRange=S,t.lockForMessageRangeSync=void 0,t.mergeMessageRanges=b,t.validateMessageRange=function(e){if(null==e)return(0,m.uploadCriticalEventMetric)(_.default.MD_SYNCD_CRITICAL_EVENT_CODE.MESSAGE_RANGE_UNSET),!1;for(const[t,n]of C)if(n(e))return(0,m.uploadCriticalEventMetric)(t),!1;for(const t of e.messages)for(const[e,n]of A)if(n(t))return(0,m.uploadCriticalEventMetric)(e),!1;return!0};var i=r(n(48926)),a=n(8243),o=n(381),s=r(n(89867)),l=n(45454),c=n(84902),d=n(38342),u=n(69702),p=n(45606),f=r(n(73407)),h=n(30986),_=r(n(11339)),g=n(38804),m=n(93824);const y=n(76672).Mirrored(["RangeAEnclosesRangeB","RangeBEnclosesRangeA","RangesAreEqual","RangesNotEnclosing"]);function E(e,t){const n=new Set(e.messages.map((e=>{var t;return null===(t=e.key)||void 0===t?void 0:t.id})));for(let e=0;e<t.messages.length;e++){var r;if(null==t.messages[e].timestamp)if(!n.has(null===(r=t.messages[e].key)||void 0===r?void 0:r.id))return!1}for(let r=0;r<t.messages.length;r++){var i,o,s;if(!n.has(null===(i=t.messages[r].key)||void 0===i?void 0:i.id)&&(0,a.numberOrThrowIfTooLarge)(null!==(o=e.lastMessageTimestamp)&&void 0!==o?o:0)<=(0,a.numberOrThrowIfTooLarge)(null!==(s=t.messages[r].timestamp)&&void 0!==s?s:0))return!1}return!0}function S(){return v.apply(this,arguments)}function v(){return(v=(0,i.default)((function*(e,t,n){let r=yield(0,h.getLastMessageTimestamp)(e);const i=yield(0,h.getLastSystemMessageTimestamp)(e),{messages:o,newLastMessageTimestamp:s}=yield(0,h.getAdditionalMessages)(e,r,n);if(null!=s&&(r=s),null==r){var l;r=null===(l=o.sort(h.timestampComparison)[o.length-1])||void 0===l?void 0:l.timestamp}const c={messages:o};if(null!=r&&(c.lastMessageTimestamp=r),null!=i&&(null==r||i>(0,a.numberOrThrowIfTooLarge)(r))&&(c.lastSystemMessageTimestamp=i),t&&null==c.lastMessageTimestamp){const t=yield(0,h.getFirstSystemMessageTimestamp)(e);null!=t&&(c.lastMessageTimestamp=t,t===i&&(c.lastSystemMessageTimestamp=void 0))}return c}))).apply(this,arguments)}function T(e,t,n){const r=new Map;return e.concat(t).forEach((e=>{var t,i,o;const s=null!==(t=null===(i=e.key)||void 0===i?void 0:i.id)&&void 0!==t?t:"";if((0,a.numberOrThrowIfTooLarge)(null!==(o=e.timestamp)&&void 0!==o?o:0)>=n){const t=r.get(s);var l,c;if(t)r.set(s,(0,a.numberOrThrowIfTooLarge)(null!==(l=t.timestamp)&&void 0!==l?l:0)<(0,a.numberOrThrowIfTooLarge)(null!==(c=e.timestamp)&&void 0!==c?c:0)?e:t);else r.set(s,e)}})),Array.from(r.values())}function b(e,t){var n,r;const i=(0,a.numberOrThrowIfTooLarge)(null!==(n=e.lastMessageTimestamp)&&void 0!==n?n:0),o=(0,a.numberOrThrowIfTooLarge)(null!==(r=t.lastMessageTimestamp)&&void 0!==r?r:0),s=Math.max(i,o),l={messages:T(e.messages,t.messages,s)};if(0!==s&&(l.lastMessageTimestamp=s),null!=e.lastSystemMessageTimestamp||null!=t.lastSystemMessageTimestamp){var c,d;const n=Math.max((0,a.numberOrThrowIfTooLarge)(null!==(c=e.lastSystemMessageTimestamp)&&void 0!==c?c:0),(0,a.numberOrThrowIfTooLarge)(null!==(d=t.lastSystemMessageTimestamp)&&void 0!==d?d:0));(null==s||n>s)&&(l.lastSystemMessageTimestamp=n)}return l}t.MessageRangeEncloseType=y;const C=[[_.default.MD_SYNCD_CRITICAL_EVENT_CODE.MESSAGE_RANGE_LAST_SYSTEM_MESSAGE_TIMESTAMP_SET,e=>{let{lastSystemMessageTimestamp:t,lastMessageTimestamp:n}=e;return null!=t&&null!=n&&(0,a.numberOrThrowIfTooLarge)(t)<(0,a.numberOrThrowIfTooLarge)(n)}],[_.default.MD_SYNCD_CRITICAL_EVENT_CODE.MESSAGE_RANGE_MESSAGES_CROSS_LIMIT,e=>e.messages.filter((e=>null!=e.timestamp)).length>1e3]],A=[[_.default.MD_SYNCD_CRITICAL_EVENT_CODE.MESSAGE_RANGE_MESSAGE_KEY_UNSET,e=>null==e.key],[_.default.MD_SYNCD_CRITICAL_EVENT_CODE.MESSAGE_RANGE_MESSAGE_KEY_REMOTE_JID_UNSET,e=>{var t;return null==(null===(t=e.key)||void 0===t?void 0:t.remoteJid)}],[_.default.MD_SYNCD_CRITICAL_EVENT_CODE.MESSAGE_RANGE_MESSAGE_KEY_FROM_ME_UNSET,e=>{var t;return null==(null===(t=e.key)||void 0===t?void 0:t.fromMe)}],[_.default.MD_SYNCD_CRITICAL_EVENT_CODE.MESSAGE_RANGE_MESSAGE_KEY_STANZA_ID_UNSET,e=>{var t;return null==(null===(t=e.key)||void 0===t?void 0:t.id)}],[_.default.MD_SYNCD_CRITICAL_EVENT_CODE.MESSAGE_RANGE_MESSAGE_KEY_REMOTE_JID_INVALID,e=>{var t;return!(0,l.isWidlike)(null===(t=e.key)||void 0===t?void 0:t.remoteJid)}],[_.default.MD_SYNCD_CRITICAL_EVENT_CODE.MESSAGE_RANGE_MESSAGE_KEY_PARTICIPANT_UNSET,e=>{var t,n,r;return s.default.isGroup(null===(t=e.key)||void 0===t?void 0:t.remoteJid)&&!(null===(n=e.key)||void 0===n?void 0:n.fromMe)&&null==(null===(r=e.key)||void 0===r?void 0:r.participant)}]];function P(){return(P=(0,i.default)((function*(e,t){var n;let r=yield S(e,!0,t);(yield(0,d.getActiveMessageRanges)(e.toString())).forEach((e=>{switch(e.action){case u.ActiveRangeAction.ClearChatDeleteStarredDeleteMedia:case u.ActiveRangeAction.ClearChatDeleteStarredKeepMedia:case u.ActiveRangeAction.ClearChatKeepStarredDeleteMedia:case u.ActiveRangeAction.ClearChatKeepStarredKeepMedia:case u.ActiveRangeAction.DeleteChatDeleteMedia:case u.ActiveRangeAction.DeleteChatKeepMedia:const t=e.actionValue.messageRange;t&&(r=b(r,t));break;case u.ActiveRangeAction.Archive:case u.ActiveRangeAction.MarkChatAsRead:}}));const i=yield M(e);return r.messages=T(r.messages,i,(0,a.numberOrThrowIfTooLarge)(null!==(n=r.lastMessageTimestamp)&&void 0!==n?n:0)),r=(0,h.fixMessageRange)(r),r}))).apply(this,arguments)}function M(){return O.apply(this,arguments)}function O(){return(O=(0,i.default)((function*(e){const t=[];return(yield f.default.getSyncActionsRows(["action"],[p.Actions.DeleteMessageForMe])).forEach((n=>{const r=e.toString({legacy:!0}),i=JSON.parse(n.index);if(5!==i.length)__LOG__(2)`constructForwardMovingMessageRange: delete for me mutation index malformed ${n.index}`;else if(r===i[1]&&n.actionState===p.SyncActionState.Success){var a;const e=null===(a=(0,c.decodeProtobuf)(o.SyncActionValueSpec,n.binarySyncAction).deleteMessageForMeAction)||void 0===a?void 0:a.messageTimestamp;if(null==e)__LOG__(2)`constructForwardMovingMessageRange: deleteMessageForMeAction malformed`;else{const n={remoteJid:i[1],id:i[2],fromMe:"1"===i[3],participant:"0"!==i[4]?i[4]:void 0};t.push({key:n,timestamp:e})}}})),t}))).apply(this,arguments)}t.lockForMessageRangeSync=(e,t,n)=>(0,g.lockForSync)([...e,"message","active-message-ranges"],t,n)},70119:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(48926)),a=n(8243),o=n(50073),s=n(381),l=n(92844),c=r(n(89867)),d=n(45454),u=n(60980),p=n(45606),f=r(n(11339)),h=n(76214),_=n(72472),g=n(89835),m=n(22954),y=n(93824);class E extends g.SyncActionBase{constructor(){super(...arguments),this.version=2}getChatJidAndMessageKey(e){const[,t]=e.indexArr;return{chatJid:t,messageKey:null}}applyMutations(e){return Promise.all(e.map(function(){var e=(0,i.default)((function*(e){try{if("set"===e.operation){var t;const{indexParts:n,value:r}=e,[,i]=n;if(i||(0,m.throwInvalidActionIndex)(),!c.default.isWid(i))return(0,y.uploadCriticalEventMetric)(f.default.MD_SYNCD_CRITICAL_EVENT_CODE.ACTION_INVALID_INDEX_DATA),{actionState:p.SyncActionState.Malformed};const o=r.muteAction,s=null===(t=r.muteAction)||void 0===t?void 0:t.muted,u=(0,a.maybeNumberOrThrowIfTooLarge)(null==o?void 0:o.muteEndTimestamp);if(null==s||s&&null==u)return __LOG__(3)`mute chat sync: malformed mutation`,{actionState:p.SyncActionState.Malformed};const g=(0,d.createWid)(i);if(!(yield(0,h.getChatTable)().get(g.toString())))return{actionState:p.SyncActionState.Orphan,orphanModel:{modelType:p.SyncModelType.Chat,modelId:g.toString()}};const E=null!=u?u:0,S=E>0&&E<(0,l.unixTimeMs)()?0:Math.floor(E/1e3);return yield(0,h.getChatTable)().merge(g.toString(),{muteExpiration:S}),_.MuteCollection.add({id:g,expiration:S},{merge:!0}),{actionState:p.SyncActionState.Success}}return __LOG__(3)`mute chat sync: operation not supported`,{actionState:p.SyncActionState.Unsupported}}catch(e){return{actionState:p.SyncActionState.Failed}}}));return function(){return e.apply(this,arguments)}}()))}generateMuteMutation(e,t){const n=void 0!==t&&0!==t,r=(0,l.unixTimeMs)();let i=t;-1!==i&&(i*=1e3);const a={timestamp:r,muteAction:{muted:n,muteEndTimestamp:i}};return{collection:p.CollectionName.RegularHigh,index:JSON.stringify([p.Actions.Mute,e.toString({legacy:!0})]),operation:o.SyncdMutationSyncdOperation.SET,version:this.version,binarySyncAction:(0,u.encodeProtobuf)(s.SyncActionValueSpec,a).readBuffer(),timestamp:r,action:p.Actions.Mute}}}const S=new E;Object.freeze(S);var v=S;t.default=v},34610:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(48926)),a=n(50073),o=n(381),s=n(51737),l=n(88555),c=n(40234),d=n(60980),u=n(57849),p=n(45606),f=n(36677),h=n(89835),_=n(38804);class g extends h.SyncActionBase{constructor(){super(...arguments),this.version=7}applyMutations(e){return(0,i.default)((function*(){if(!0!==(0,u.getABPropConfigValue)("nux_sync"))return __LOG__(3)`NuxSync: nux_sync ab prop required`,e.map((()=>({actionState:p.SyncActionState.Unsupported})));const t=[],n=e.map((e=>{if("set"!==e.operation)return __LOG__(3)`NuxSync: operation not supported ${e}`,{actionState:p.SyncActionState.Malformed};const n=e.indexParts[1];return(0,s.isString)(n)?(t.push(n),{actionState:p.SyncActionState.Success}):(__LOG__(3)`NuxSync: malformed mutation ${e}`,{actionState:p.SyncActionState.Malformed})}));return t.length&&(__LOG__(2)`NuxSync: adding keys to local store ${t}`,(0,f.addToLocalNuxSyncList)(t)),n}))()}_createNuxMutation(e,t){return{collection:p.CollectionName.RegularLow,index:JSON.stringify([p.Actions.Nux,e]),binarySyncAction:(0,d.encodeProtobuf)(o.SyncActionValueSpec,{timestamp:t}).readBuffer(),version:this.version,operation:a.SyncdMutationSyncdOperation.SET,timestamp:t,action:p.Actions.Nux}}markNuxAsSeen(e){var t=this;return(0,i.default)((function*(){if((0,l.isMDBackend)()&&!0===(0,u.getABPropConfigValue)("nux_sync")){(0,f.addToLocalNuxSyncList)([e]);const n=t._createNuxMutation(e,c.Clock.globalUnixTimeMilliseconds());yield(0,_.lockForSync)([],[n],(()=>Promise.resolve()))}}))()}}const m=new g;Object.freeze(m);var y=m;t.default=y},36014:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(48926)),a=n(8243),o=r(n(45095)),s=n(50073),l=n(381),c=n(92844),d=r(n(89867)),u=n(45454),p=n(84902),f=n(60980),h=r(n(21084)),_=r(n(74362)),g=n(45606),m=r(n(73407)),y=n(9025),E=n(57701),S=r(n(11339)),v=n(76214),T=n(89835),b=n(38804),C=n(22954),A=n(93824);class P extends T.SyncActionBase{constructor(){super(...arguments),this.version=5}applyMutations(e){var t=this;return(0,i.default)((function*(){h.default.updatePrimaryAllowsAllMutationsFlag("other mutation");const n=[];for(let r=0;r<e.length;r++)n.push(yield t.applyMutation(e[r]));return n}))()}applyMutation(e){var t=this;return(0,i.default)((function*(){if("remove"===e.operation)return __LOG__(3)`syncd: pin_chat_sync: REMOVE not supported`,Promise.resolve({actionState:g.SyncActionState.Unsupported});if(!(0,E.pinChatSyncEnabled)())return __LOG__(3)`syncd: pin_chat_sync: not enabled`,Promise.resolve({actionState:g.SyncActionState.Unsupported});const{indexParts:n,value:r,timestamp:i}=e,[,a]=n;try{if(a||(__LOG__(3)`syncd: pin_chat_sync: missing chatId in index`,(0,C.throwInvalidActionIndex)()),!d.default.isWid(a))return(0,A.uploadCriticalEventMetric)(S.default.MD_SYNCD_CRITICAL_EVENT_CODE.ACTION_INVALID_INDEX_DATA),{actionState:g.SyncActionState.Malformed};const e=(0,u.createWid)(a),{pinAction:n}=r;if(null==n)return __LOG__(3)`syncd: pin_chat_sync: missing pinAction`,Promise.resolve({actionState:g.SyncActionState.Malformed});const{pinned:o}=n;if(null==o)return __LOG__(3)`syncd: pin_chat_sync: missing pinned field`,Promise.resolve({actionState:g.SyncActionState.Malformed});if(null==(yield(0,v.getChatTable)().get(e.toString())))return{actionState:g.SyncActionState.Orphan,orphanModel:{modelType:g.SyncModelType.Chat,modelId:e.toString()}};if(!o)return yield t.applyUpdates([{wid:e,pinned:!1,timestamp:i}]),{actionState:g.SyncActionState.Success};const s=yield t.getLocalPins();if(s.some((t=>t.chatId.toString()===e.toString())))return yield t.applyUpdates([{wid:e,pinned:o,timestamp:i}]),{actionState:g.SyncActionState.Success};if(s.length<3)return yield t.applyUpdates([{wid:e,pinned:o,timestamp:i}]),{actionState:g.SyncActionState.Success};const l=s.reduce(((e,t)=>t.timestamp<e.timestamp?t:e)),c=[],p=l.timestamp<i?l.chatId:e;return p===l.chatId&&c.push({wid:l.chatId,pinned:!1,timestamp:i},{wid:e,pinned:!0,timestamp:i}),yield Promise.all([t.applyUpdates(c),t.createPendingUnpin(p,i)]),Promise.resolve({actionState:g.SyncActionState.Success})}catch(e){return{actionState:g.SyncActionState.Failed}}}))()}applyUpdates(e){return(0,i.default)((function*(){if(0===e.length)return;const t=e.map((e=>{let{wid:t,pinned:n,timestamp:r}=e;const i={id:t.toString(),pin:n?r:0};return n&&(i.archive=!1),i}));yield Promise.all(t.map((e=>(0,v.getChatTable)().merge(e.id,e)))),yield Promise.all(e.map(function(){var e=(0,i.default)((function*(e){const t=yield(0,y.getExisting)(e.wid);null!=t&&(t.pin=e.pinned?e.timestamp:0,e.pinned&&(t.archive=!1))}));return function(){return e.apply(this,arguments)}}()))}))()}createPendingUnpin(e,t){var n=this;return(0,i.default)((function*(){yield m.default.appendPendingMutationsRows([n.getPinMutation(t,!1,e)])}))()}getLocalPins(){return(0,i.default)((function*(){const e=(0,v.getChatTable)().all().then((e=>e.filter((e=>null!=e.pin&&e.pin>0)).map((e=>[e.id,(0,o.default)(e.pin,"chatRow.pin")])))),t=m.default.getSyncActionsRows(["action"],[g.Actions.Pin]).then((e=>e.filter((e=>e.actionState===g.SyncActionState.Orphan)).map((e=>{var t;const n=JSON.parse(e.index);if(n.length<2)return null;const r=n[1],i=(0,p.decodeProtobuf)(l.SyncActionValueSpec,e.binarySyncAction);return null!=i.pinAction&&i.pinAction.pinned?[r,(0,a.numberOrThrowIfTooLarge)(null!==(t=i.timestamp)&&void 0!==t?t:0)]:null})).filter(Boolean))),[n,r]=yield Promise.all([e,t]);return[...n,...r].map((e=>{let[t,n]=e;return{chatId:(0,u.createWid)(t),timestamp:n}}))}))()}unpinAll(){var e=this;return(0,i.default)((function*(){const t=yield e.getLocalPins(),n=(0,c.unixTimeMs)(),r=t.map((t=>{let{chatId:r}=t;return e.getPinMutation(n,!1,r)}));return(0,b.lockForSync)(["chat"],r,(()=>Promise.resolve())).then((()=>e.applyUpdates(t.map((e=>{let{chatId:t}=e;return{wid:t,pinned:!1,timestamp:n}})))))}))()}getMutationsForPin(e,t,n){var r=this;return(0,i.default)((function*(){const i=[r.getPinMutation(e,t,n)];return t&&i.push(yield _.default.getArchiveChatMutation(e,!1,n)),i}))()}getChatJidAndMessageKey(e){const[,t]=e.indexArr;return{chatJid:t,messageKey:null}}getPinMutation(e,t,n){return{collection:g.CollectionName.RegularLow,index:JSON.stringify([g.Actions.Pin,n.toString({legacy:!0})]),binarySyncAction:(0,f.encodeProtobuf)(l.SyncActionValueSpec,{timestamp:e,pinAction:{pinned:t}}).readBuffer(),version:this.version,operation:s.SyncdMutationSyncdOperation.SET,timestamp:e,action:g.Actions.Pin}}}const M=new P;Object.freeze(M);var O=M;t.default=O},44720:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(48926)),a=r(n(45095)),o=n(57849),s=n(45606),l=n(34771),c=n(89835);class d extends c.SyncActionBase{constructor(){super(...arguments),this.version=7}applyMutations(e){return(0,i.default)((function*(){if(!0!==(0,o.getABPropConfigValue)("primary_feature_sync"))return __LOG__(3)`primary feature sync: operation not supported`,e.map((()=>({actionState:s.SyncActionState.Unsupported})));let t;const n=e.map((e=>{var n;if("set"!==e.operation)return __LOG__(3)`primary feature sync: operation not supported`,{actionState:s.SyncActionState.Malformed};return null==(null===(n=e.value.primaryFeature)||void 0===n?void 0:n.flags)?(__LOG__(3)`primary feature sync: malformed mutation`,{actionState:s.SyncActionState.Malformed}):((null==t||e.timestamp>t.timestamp)&&(t=e),{actionState:s.SyncActionState.Success})}));if(null!=t){var r;const e=(0,a.default)(null===(r=t.value.primaryFeature)||void 0===r?void 0:r.flags,"latestMutation.value.primaryFeature?.flags");l.PrimaryFeatures.setPrimaryFeatures(e)}return n}))()}}const u=new d;Object.freeze(u);var p=u;t.default=p},42339:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(48926)),a=n(50073),o=n(381),s=n(60980),l=n(45606),c=n(58597),d=r(n(11339)),u=r(n(45723)),p=n(53006),f=n(89835);class h extends f.SyncActionBase{constructor(){super(...arguments),this.version=1}applyMutations(e){return(0,i.default)((function*(){return yield Promise.all(e.map(function(){var e=(0,i.default)((function*(e){try{if("set"===e.operation){var t;const{value:r}=e;let i=null===(t=r.pushNameSetting)||void 0===t?void 0:t.name;i||(__LOG__(3)`push name sync: empty pushname`,(0,c.logCriticalBootstrapStageIfNecessary)(d.default.BOOTSTRAP_APP_STATE_DATA_STAGE_CODE.PUSHNAME_INVALID),i=""),(0,u.default)(i),(0,p.setPushnameLocally)(i),yield(0,c.logCriticalBootstrapStageIfNecessary)(d.default.BOOTSTRAP_APP_STATE_DATA_STAGE_CODE.PUSHNAME_APPLIED);const a=n(95023).default;return a.isSyncDCriticalDataSyncInProcess()&&(a.setSyncDCriticalSynced(),yield a.setSyncDCriticalDataSyncCompleted()),Promise.resolve({actionState:l.SyncActionState.Success})}return __LOG__(3)`push name sync: operation not supported`,Promise.resolve({actionState:l.SyncActionState.Unsupported})}catch(e){return(0,c.logCriticalBootstrapStageIfNecessary)(d.default.BOOTSTRAP_APP_STATE_DATA_STAGE_CODE.PUSHNAME_INVALID),{actionState:l.SyncActionState.Failed}}}));return function(){return e.apply(this,arguments)}}()))}))()}getPushnameMutation(e,t){return{collection:l.CollectionName.CriticalBlock,index:JSON.stringify([l.Actions.SettingPushName]),binarySyncAction:(0,s.encodeProtobuf)(o.SyncActionValueSpec,{timestamp:e,pushNameSetting:{name:t}}).readBuffer(),version:this.version,operation:a.SyncdMutationSyncdOperation.SET,timestamp:e,action:l.Actions.SettingPushName}}}const _=new h;Object.freeze(_);var g=_;t.default=g},60282:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(48926)),a=n(45606),o=n(76214),s=n(99662),l=n(89835),c=n(22954);class d extends l.SyncActionBase{constructor(){super(...arguments),this.version=2}applyMutations(e){return Promise.all(e.map(function(){var e=(0,i.default)((function*(e){try{if("set"===e.operation){const{indexParts:t,value:n}=e,[,r]=t;r||(0,c.throwInvalidActionIndex)();const i=n.quickReplyAction;if(!i)return __LOG__(3)`quick replies sync: malformed mutation`,{actionState:a.SyncActionState.Malformed};if(i.deleted)return yield(0,o.getQuickReplyTable)().remove(r),s.QuickReplyCollection.remove(r),{actionState:a.SyncActionState.Success};const{shortcut:l,message:d}=i;if(!l||!d)return __LOG__(3)`quick replies sync: malformed mutation`,{actionState:a.SyncActionState.Malformed};const u=i.keywords||[],p=i.count||0;return yield(0,o.getQuickReplyTable)().createOrReplace({id:r,shortcut:l,count:p,message:d,keywords:u}),s.QuickReplyCollection.add({id:r,shortcut:l,message:d,keywords:u,count:p},{merge:!0}),{actionState:a.SyncActionState.Success}}return __LOG__(3)`quick replies sync: operation not supported`,{actionState:a.SyncActionState.Unsupported}}catch(e){return{actionState:a.SyncActionState.Failed}}}));return function(){return e.apply(this,arguments)}}()))}}const u=new d;Object.freeze(u);var p=u;t.default=p},40108:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(48926)),a=n(50073),o=n(381),s=n(92844),l=n(60980),c=n(45606),d=r(n(73407)),u=n(837),p=n(89835);class f extends p.SyncActionBase{constructor(){super(...arguments),this.version=3}applyMutations(e){return Promise.all(e.map(function(){var e=(0,i.default)((function*(e){try{if("set"===e.operation){var t;const n=null===(t=e.value.keyExpiration)||void 0===t?void 0:t.expiredKeyEpoch;return null==n?(__LOG__(4,void 0,new Error)`sentinel mutation sync: malformed mutation`,{actionState:c.SyncActionState.Malformed}):(yield d.default.expireSyncKey(n),{actionState:c.SyncActionState.Success})}return __LOG__(3)`sentinel mutation sync: operation not supported`,{actionState:c.SyncActionState.Unsupported}}catch(e){return{actionState:c.SyncActionState.Failed}}}));return function(){return e.apply(this,arguments)}}()))}getSentinelMutations(){var e=this;return(0,i.default)((function*(){const t=(0,s.unixTimeMs)(),n=Array.from(c.CollectionName.members()),r={keyExpiration:{expiredKeyEpoch:(yield(0,u.getNewestKeyPair)()).keyEpoch},timestamp:t};return n.map((n=>({collection:n,index:JSON.stringify([c.Actions.Sentinel,n]),operation:a.SyncdMutationSyncdOperation.SET,version:e.version,binarySyncAction:(0,l.encodeProtobuf)(o.SyncActionValueSpec,r).readBuffer(),timestamp:t,action:c.Actions.Sentinel})))}))()}}const h=new f;Object.freeze(h);var _=h;t.default=_},21263:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(48926)),a=n(50073),o=n(381),s=n(92844),l=r(n(89867)),c=n(60980),d=n(45606),u=n(84886),p=r(n(11339)),f=n(76214),h=n(59871),_=n(19011),g=n(89835),m=n(22954),y=n(93824);class E extends g.SyncActionBase{constructor(){super(...arguments),this.version=2}getChatJidAndMessageKey(e){const[,t,n,r,i]=e.indexArr;t&&n&&r&&i||(0,m.throwInvalidActionIndex)();const a=(0,m.syncKeyToMsgKey)(t,n,r,i);return{chatJid:t,messageKey:null==a?void 0:a.toString()}}applyMutations(e){return(0,i.default)((function*(){const t=[],n=[],r=new Set;yield(0,f.getMessageTable)().bulkGet(e.map((e=>{var t;const[,n,r,i,a]=e.indexParts;return n&&r&&i&&a&&l.default.isWid(n)?null===(t=(0,m.syncKeyToMsgKey)(n,r,i,a))||void 0===t?void 0:t.toString():null})).filter(Boolean)).then((e=>e.forEach((e=>{e&&r.add(e.id)}))));const i=yield Promise.all(e.map((e=>{try{if("set"===e.operation){var i;const{indexParts:a,value:o}=e,[,s,l,c,u]=a;s&&l&&c&&u||(0,m.throwInvalidActionIndex)();const f=null===(i=o.starAction)||void 0===i?void 0:i.starred;if(null==f)return __LOG__(3)`star message sync: malformed mutation`,{actionState:d.SyncActionState.Malformed};const g=(0,m.syncKeyToMsgKey)(s,l,c,u);if(!g)return(0,y.uploadCriticalEventMetric)(p.default.MD_SYNCD_CRITICAL_EVENT_CODE.ACTION_INVALID_INDEX_DATA),{actionState:d.SyncActionState.Malformed};if(!r.has(g.toString()))return{actionState:d.SyncActionState.Orphan,orphanModel:{modelId:g.toString(),modelType:d.SyncModelType.Msg}};f?t.push(g.toString()):n.push(g.toString());const E=h.MsgCollection.get(g);return E?(E.star=f,E.star?(0,_.addStarredMsgs)([E]):(0,_.removeStarredMsgs)([E])):__LOG__(3)`star_message_sync: msg ${g} found in storage but not in collection`,{actionState:d.SyncActionState.Success}}return __LOG__(3)`star message sync: operation not supported`,{actionState:d.SyncActionState.Unsupported}}catch(e){return{actionState:d.SyncActionState.Failed}}})));return yield Promise.all([(0,u.starMessages)(t),(0,u.unstarMessages)(n)]),i}))()}getStarMessageMutations(e,t){const n=(0,s.unixTimeMs)();return e.map((e=>({collection:d.CollectionName.RegularHigh,index:(0,y.constructStarMsgKey)(e),operation:a.SyncdMutationSyncdOperation.SET,version:this.version,binarySyncAction:(0,c.encodeProtobuf)(o.SyncActionValueSpec,{timestamp:n,starAction:{starred:t}}).readBuffer(),timestamp:n,action:d.Actions.Star})))}}const S=new E;Object.freeze(S);var v=S;t.default=v},89835:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SyncActionBase=void 0;var r=n(45606);t.SyncActionBase=class{getChatJidAndMessageKey(){}resolveConflicts(e,t){return t.timestamp>=e.timestamp?Promise.resolve(r.ConflictResolutionState.ApplyRemoteAndDropLocal):Promise.resolve(r.ConflictResolutionState.SkipRemote)}dropMutationDueToCrossIndexConflict(){return Promise.resolve(!1)}}},22954:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.syncKeyToMsgKey=function(e,t,n,r){let l;if(!a.default.isWid(e))return __LOG__(3)`syncKeyToMsgKey: invalid remote value: ${e.replace(d,"#")}`,null;if(!(0,o.createWid)(e).isUser()){if("0"===n&&!a.default.isWid(r))return __LOG__(3)`syncKeyToMsgKey: invalid participant value: ${r.replace(d,"#")}`,null;l="1"===n?(0,s.getMeUser)():(0,o.createWid)(r)}return new i.default({fromMe:"1"===n,remote:(0,o.createWid)(e),id:t,participant:l})},t.throwInvalidActionIndex=function(){throw new l.default.MdFatalError({mdFatalErrorCode:l.default.MD_SYNCD_FATAL_ERROR_CODE.INVALID_ACTION_INDEX}).commit(!0),new c.SyncdFatalError("invalid action index")};var i=r(n(65212)),a=r(n(89867)),o=n(45454),s=n(99234),l=r(n(11339)),c=n(85156);const d=/\d(?=)/gm},11681:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(48926)),a=n(92844),o=n(45606),s=n(76214);class l{static loadStatesFromDb(){var e=this;return(0,i.default)((function*(){(yield(0,s.getCollectionVersionTable)().all()).forEach((t=>e.collectionStates.set(t.collection,{collection:t.collection,state:t.state,finiteFailureStartTime:t.finiteFailureStartTime})))}))()}static persistToDb(){const e=[];return this.collectionStates.forEach((t=>e.push(t))),__LOG__(2)`syncd: state machine persistToDb. states:`,e.forEach((e=>{const t=null==e.finiteFailureStartTime?"":`(failure start: ${e.finiteFailureStartTime})`;__LOG__(2)`syncd: ${e.collection}: ${e.state} ${t}`})),(0,s.getCollectionVersionTable)().bulkCreateOrMerge(e)}static clean(){this.collectionStates=new Map}static getCollectionState(e){const t=this.collectionStates.get(e);return t?t.state:(this.moveCollectionsToUpToDate([e]),o.CollectionSyncState.UpToDate)}static getCollectionsInStateDirty(){const e=[];return this.collectionStates.forEach((t=>{t.state===o.CollectionSyncState.Dirty&&e.push(t.collection)})),e}static getCollectionsInStateRetry(){const e=[];return this.collectionStates.forEach((t=>{t.state===o.CollectionSyncState.FailingFiniteRetry&&e.push(t.collection)})),e}static getCollectionsInStateFatal(){const e=[];return this.collectionStates.forEach((t=>{t.state===o.CollectionSyncState.Fatal&&e.push(t.collection)})),e}static getCollectionsInStateBlocked(){const e=[];return this.collectionStates.forEach((t=>{t.state===o.CollectionSyncState.Blocked&&e.push(t.collection)})),e}static moveCollectionsToUpToDate(e){e.forEach((e=>this.collectionStates.set(e,{collection:e,state:o.CollectionSyncState.UpToDate,finiteFailureStartTime:void 0})))}static moveCollectionsToDirty(e){e.forEach((e=>{var t;return this.collectionStates.set(e,{collection:e,state:o.CollectionSyncState.Dirty,finiteFailureStartTime:null===(t=this.collectionStates.get(e))||void 0===t?void 0:t.finiteFailureStartTime})}))}static moveCollectionsToFiniteRetry(e){e.forEach((e=>{var t,n;return this.collectionStates.set(e,{collection:e,state:o.CollectionSyncState.FailingFiniteRetry,finiteFailureStartTime:null!==(t=null===(n=this.collectionStates.get(e))||void 0===n?void 0:n.finiteFailureStartTime)&&void 0!==t?t:(0,a.unixTimeMs)()})}))}static moveCollectionsToFatal(e){e.forEach((e=>this.collectionStates.set(e,{collection:e,state:o.CollectionSyncState.Fatal})))}static moveCollectionsToBlocked(e){e.forEach((e=>{var t;return this.collectionStates.set(e,{collection:e,state:o.CollectionSyncState.Blocked,finiteFailureStartTime:null===(t=this.collectionStates.get(e))||void 0===t?void 0:t.finiteFailureStartTime})}))}static getExpiredCollections(){const e=[];return this.collectionStates.forEach((t=>{if(t.state===o.CollectionSyncState.FailingFiniteRetry){let n;null==t.finiteFailureStartTime?(n=1/0,__LOG__(3)`Collection ${t.collection} is in finite retry state with no failure start time`):n=t.finiteFailureStartTime;n+o.FINITE_FAILURE_EXPIRY_DURATION<(0,a.unixTimeMs)()&&e.push(t.collection)}})),e}}t.default=l,l.collectionStates=new Map},45606:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SyncModelType=t.SyncDataType=t.SyncActionState=t.MIN_PATCH_SIZE=t.MIN_INLINE_MUTATIONS=t.MAX_PATCH_SIZE=t.MAX_INLINE_MUTATIONS=t.LABEL_ASSOCIATION_SYNC_VERSION=t.FINITE_FAILURE_EXPIRY_DURATION=t.DEFAULT_COLLECTION_VERSION=t.ConflictResolutionState=t.CollectionSyncState=t.CollectionState=t.CollectionName=t.BACKOFF_MIN_TIMEOUT=t.BACKOFF_MAX_TIMEOUT=t.BACKOFF_BASE=t.Actions=void 0;var r=n(92844);t.BACKOFF_MIN_TIMEOUT=1e3;t.BACKOFF_MAX_TIMEOUT=36e5;t.BACKOFF_BASE=2;const i=2*r.DAY_MILLISECONDS;t.FINITE_FAILURE_EXPIRY_DURATION=i;t.MIN_INLINE_MUTATIONS=100;t.MAX_INLINE_MUTATIONS=2e3;t.MIN_PATCH_SIZE=10;t.MAX_PATCH_SIZE=100;t.DEFAULT_COLLECTION_VERSION=0;t.LABEL_ASSOCIATION_SYNC_VERSION=3;const a=n(76672)({Star:"star",Contact:"contact",Mute:"mute",PinDEPRECATED:"pin",Pin:"pin_v1",SettingPushName:"setting_pushName",LabelEdit:"label_edit",LabelMessage:"label_message",LabelJid:"label_jid",QuickReply:"quick_reply",LocaleSetting:"setting_locale",Archive:"archive",MarkChatAsRead:"markChatAsRead",ClearChat:"clearChat",DeleteMessageForMe:"deleteMessageForMe",Sentinel:"sentinel",UnarchiveChatsSetting:"setting_unarchiveChats",DeleteChat:"deleteChat",AndroidUnsupportedActions:"android_unsupported_actions",PrimaryFeature:"primary_feature",Nux:"nux"});t.Actions=a;const o=n(76672)({Regular:"regular",RegularLow:"regular_low",RegularHigh:"regular_high",CriticalBlock:"critical_block",CriticalUnblockLow:"critical_unblock_low"});t.CollectionName=o;const s=n(76672).Mirrored(["Success","SuccessHasMore","Conflict","ConflictHasMore","ErrorRetry","ErrorFatal","Blocked"]);t.CollectionState=s;const l=n(76672).Mirrored(["UpToDate","Dirty","FailingFiniteRetry","Fatal","Blocked"]);t.CollectionSyncState=l;const c=n(76672).Mirrored(["Success","Malformed","Orphan","Unsupported","Skipped","Failed"]);t.SyncActionState=c;const d=n(76672)({Msg:"Msg",Chat:"Chat"});t.SyncModelType=d;const u=n(76672).Mirrored(["ApplyRemoteAndDropLocal","SkipRemote","SkipRemoteAndDropLocal"]);t.ConflictResolutionState=u;const p=n(76672).Mirrored(["Patch","Snapshot"]);t.SyncDataType=p},58597:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.logCriticalBootstrapStageIfNecessary=function(){return c.apply(this,arguments)};var i=r(n(48926)),a=n(92844),o=n(57849),s=n(88432),l=r(n(11339));function c(){return(c=(0,i.default)((function*(e){(yield(0,o.getABPropConfigValue)("md_app_state_critical_data_processing_logging"))&&n(95023).default.isSyncDCriticalDataSyncInProcess()&&new l.default.MdBootstrapAppStateCriticalDataProcessing({bootstrapAppStateDataStage:e,mdSessionId:yield s.MdSyncFieldStatsMeta.getMdSessionId(),mdTimestamp:(0,a.unixTimeMs)()}).commit()}))).apply(this,arguments)}},73407:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(48926)),a=n(899),o=(n(381),n(84902),n(76214)),s=n(99069);const l=new ArrayBuffer(a.KEY_LENGTH_BYTES);t.default=class{static getAllPendingMutationsRows(){return(0,o.getPendingMutationsTable)().all()}static performTransaction(e){return(0,s.getStorage)().lock(["collection-version","pending-mutations","sync-actions"],e)}static getPendingMutationsRows(e,t){return(0,o.getPendingMutationsTable)().equals(e,t)}static getPendingMutationsRowsById(e){return(0,i.default)((function*(){return(yield(0,o.getPendingMutationsTable)().bulkGet(e)).filter(Boolean)}))()}static getPendingMutationsRowsByIndex(e,t){return(0,o.getPendingMutationsTable)().equals(e,t)}static appendPendingMutationsRows(e){return(0,o.getPendingMutationsTable)().bulkCreate(e)}static bulkUpdatePendingMutationsKeyId(e){return(0,o.getPendingMutationsTable)().bulkCreateOrMerge(e)}static bulkRemovePendingMutations(e){return(0,o.getPendingMutationsTable)().bulkRemove(e)}static hasPendingMutationForCollection(e){return(0,o.getPendingMutationsTable)().equals(["collection"],e).then((e=>e.length>0))}static getCollectionVersion(e){return(0,i.default)((function*(){const t=yield(0,o.getCollectionVersionTable)().get(e);return null==t?void 0:t.version}))()}static getCollectionVersions(e){return(0,i.default)((function*(){const t=yield(0,o.getCollectionVersionTable)().bulkGet(e);return new Map(e.map(((e,n)=>{var r;return[e,null===(r=t[n])||void 0===r?void 0:r.version]})))}))()}static setCollectionVersion(e,t,n){return(0,o.getCollectionVersionTable)().createOrMerge(e,{collection:e,version:t,ltHash:n})}static getLtHash(e){return(0,i.default)((function*(){const t=yield(0,o.getCollectionVersionTable)().get(e);return(null==t?void 0:t.ltHash)||l}))()}static getAllCollectionLtHashes(){return(0,i.default)((function*(){return(yield(0,o.getCollectionVersionTable)().all()).map((e=>({collection:e.collection,ltHash:e.ltHash})))}))()}static getSyncAction(e){return(0,o.getSyncActionsTable)().get(e)}static getSyncActionsRows(e,t){return(0,o.getSyncActionsTable)().anyOf(e,t)}static setSyncAction(e){return(0,o.getSyncActionsTable)().createOrReplace(e)}static setSyncActionRows(e){return(0,o.getSyncActionsTable)().bulkCreateOrReplace(e)}static updateSyncActionRows(e){return(0,o.getSyncActionsTable)().bulkCreateOrMerge(e)}static deleteSyncActionRows(e){return(0,o.getSyncActionsTable)().bulkRemove(e)}static getSyncKey(e){return(0,o.getSyncKeysTable)().get(e)}static getAllSyncKeys(){return(0,o.getSyncKeysTable)().all()}static createSyncKey(e){return(0,o.getSyncKeysTable)().create(e)}static getSyncKeyData(e){return(0,o.getSyncKeysTable)().get(e)}static expireSyncKey(e){return(0,i.default)((function*(){(yield(0,o.getSyncKeysTable)().equals(["keyEpoch"],e)).forEach((e=>(0,o.getSyncKeysTable)().merge(e.keyId,{keyId:e.keyId,timestamp:0})))}))()}static getMissingKey(e){return(0,o.getMissingKeysTable)().get(e)}static getMissingKeyCount(){return(0,o.getMissingKeysTable)().count()}static bulkGetMissingKeys(e){return(0,o.getMissingKeysTable)().bulkGet(e)}static getAllMissingKeys(){return(0,o.getMissingKeysTable)().all()}static bulkRemoveMissingKeys(e){return(0,o.getMissingKeysTable)().bulkRemove(e)}static createOrUpdateMissingKeys(e){return(0,o.getMissingKeysTable)().bulkCreateOrMerge(e)}}},1377:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.checkLtHash=function(){return R.apply(this,arguments)},t.computeLtHash=I,t.computeLtHashAndValidatePatch=function(){return v.apply(this,arguments)},t.computeLtHashAndValidateSnapshot=function(){return S.apply(this,arguments)},t.computeOutgoingSnapshotAndPatchMacs=function(){return O.apply(this,arguments)},t.logMacsInSnapshot=k;var i=r(n(48926)),a=n(899),o=n(7589),s=n(50073),l=n(62109),c=n(63109),d=n(85156),u=n(17239),p=n(45606),f=r(n(73407)),h=n(68254),_=n(837),g=r(n(11339)),m=n(85156);function y(e,t){return`${e.slice(-16)}:${(0,c.arrayBufferToHexPadded)(t).slice(-16)}`}const E=new TextDecoder;function S(){return(S=(0,i.default)((function*(e,t){const{mac:n,version:r,keyId:i,records:o}=t,s=yield(0,_.getKeyData)(i.id);if(!s)throw new m.SyncdMissingKeyError;const d=new Map(o.map((e=>[(0,c.arrayBufferToHexPadded)(e.index.blob),(0,l.valueMacFromIndexAndValueCipherText)(e.value.blob)])));__LOG__(2)`syncd:
${e} snapshot macsToAdd:
    ${Array.from(d.entries()).map((e=>{let[t,n]=e;return y(t,n)})).join("\n\t")}`;const u=yield a.LT_HASH_ANTI_TAMPERING.add(a.EMPTY_LT_HASH,Array.from(d.values())),{snapshotMacKey:p}=yield(0,l.generateEncryptionKeys)(s),f=(0,c.to64BitNetworkOrder)(r.version),h=(0,c.toUtf8)(e).buffer;return __LOG__(2)`syncd: validating snapshot mac for ${e} snapshot v${r.version}:
ltHash: ${(0,c.arrayBufferToHexPadded)(u)}
encoded version: ${(0,c.arrayBufferToHexPadded)(f)}
encoded collection: ${(0,c.arrayBufferToHexPadded)(h)}
expected snapshotMAC: ${(0,c.arrayBufferToHexPadded)(n)}`,yield C(e,n,p,u,f,h,!0,o.length,t.version.version),u}))).apply(this,arguments)}function v(){return(v=(0,i.default)((function*(e,t){const{version:n,mutations:r,snapshotMac:i,patchMac:a,keyId:o}=t,s=o.id,d=yield(0,_.getKeyData)(s);if(!d)throw new m.SyncdMissingKeyError;const{snapshotMacKey:u,patchMacKey:p}=yield(0,l.generateEncryptionKeys)(d),f=r.map((e=>({operation:e.operation,indexMac:e.record.index.blob,valueMac:(0,l.valueMacFromIndexAndValueCipherText)(e.record.value.blob)}))),h=yield I(e,f),g=(0,c.to64BitNetworkOrder)(n.version),y=(0,c.toUtf8)(e).buffer;__LOG__(2)`syncd: validating snapshot and patch mac for ${e} v${n.version}:
expected snapshotMAC: ${(0,c.arrayBufferToHexPadded)(i)}
expected patchMAC: ${(0,c.arrayBufferToHexPadded)(a)}
encoded version: ${(0,c.arrayBufferToHexPadded)(g)}
encoded collection: ${(0,c.arrayBufferToHexPadded)(y)}
key ID: ${(0,c.arrayBufferToHexPadded)(s)}`;try{yield P(e,a,p,i,f.map((e=>e.valueMac)),g,y,r.length,n.version),yield C(e,i,u,h,g,y,!1,r.length,n.version)}catch(t){throw yield k(e),t}return h}))).apply(this,arguments)}function T(){return b.apply(this,arguments)}function b(){return(b=(0,i.default)((function*(e,t){var n;const r=null!==(n=yield f.default.getCollectionVersion(e))&&void 0!==n?n:0;if(r!==t-1){const n=r>t-1?"greater-than-expected":"less-than-expected";throw __LOG__(3,void 0,void 0,!0)`syncd: ${e} received patch v${t} !== latest local version (v${r}) + 1`,SEND_LOGS(`syncd-version-check-error-local-version-${n}`),new d.SyncdRetryableError(`syncd-version-check-error-local-version-${n}`)}const i=yield f.default.getLtHash(e);if((0,o.areBuffersEqual)(i,a.EMPTY_LT_HASH))throw __LOG__(3,void 0,void 0,!0)`syncd: empty local lthash found when processing ${e} patch v${t}`,SEND_LOGS("syncd-empty-lthash-on-mac-mismatch"),new d.SyncdRetryableError("empty lthash")}))).apply(this,arguments)}function C(){return A.apply(this,arguments)}function A(){return(A=(0,i.default)((function*(e,t,n,r,i,a,s,c,d){const u=yield(0,l.generateSnapshotMac)(n,r,i,a);if(!(0,o.areBuffersEqual)(u,t)){yield T(e,d);const t=s?g.default.MD_SYNCD_FATAL_ERROR_CODE.SNAPSHOT_MAC_MISMATCH_IN_SNAPSHOT:g.default.MD_SYNCD_FATAL_ERROR_CODE.SNAPSHOT_MAC_MISMATCH_IN_PATCH;throw yield(0,h.uploadFatalErrorMetric)(t,e,c,d),__LOG__(3,void 0,void 0,!0)`syncd: unable to validate snapshot mac.`,SEND_LOGS("syncd: unable to validate snapshot mac."),new m.SyncdFatalError("unable to validate snapshot mac")}}))).apply(this,arguments)}function P(){return M.apply(this,arguments)}function M(){return(M=(0,i.default)((function*(e,t,n,r,i,a,s,c,d){const u=yield(0,l.generatePatchMac)(n,r,i,a,s);if(!(0,o.areBuffersEqual)(u,t))throw yield T(e,d),yield(0,h.uploadFatalErrorMetric)(g.default.MD_SYNCD_FATAL_ERROR_CODE.MAC_MISMATCH_PATCH,e,c,d),__LOG__(3,void 0,void 0,!0)`syncd: unable to validate patch mac.`,SEND_LOGS("syncd: unable to validate patch mac."),new m.SyncdFatalError("unable to validate patch mac")}))).apply(this,arguments)}function O(){return(O=(0,i.default)((function*(e,t,n,r){const i=((yield f.default.getCollectionVersion(e))||p.DEFAULT_COLLECTION_VERSION)+1,{patchMacKey:a,snapshotMacKey:o}=yield(0,l.generateEncryptionKeys)(r),s=(0,c.to64BitNetworkOrder)(i),d=(0,c.toUtf8)(e).buffer,u=yield(0,l.generateSnapshotMac)(o,t,s,d),h=yield(0,l.generatePatchMac)(a,u,n.map((e=>e.valueMac)),s,d);return __LOG__(2)`syncd: computing snapshot and patch macs for outgoing patch ${e} v${i}:
encoded version: ${(0,c.arrayBufferToHexPadded)(s)}
encoded collection: ${(0,c.arrayBufferToHexPadded)(d)}
snapshotMAC: ${(0,c.arrayBufferToHexPadded)(u)}
patchMAC: ${(0,c.arrayBufferToHexPadded)(h)}`,{snapshotMac:u,patchMac:h}}))).apply(this,arguments)}function I(){return w.apply(this,arguments)}function w(){return(w=(0,i.default)((function*(e,t){const n=yield f.default.getLtHash(e),r=yield L(t.map((e=>e.indexMac))),i=new Map,o=new Map,l=new Map;t.forEach((t=>{const{indexMac:n,valueMac:a,operation:d}=t,p=E.decode(n),f=r.get(p);if(f)d===s.SyncdMutationSyncdOperation.REMOVE?o.set((0,c.arrayBufferToHexPadded)(n),f):l.set((0,c.arrayBufferToHexPadded)(n),f);else if(d===s.SyncdMutationSyncdOperation.REMOVE){var h,_;__LOG__(3,void 0,void 0,!0)`syncd: missing indexMAC in sync-actions table for REMOVE mutation in collection ${e} for platform ${null!==(h=u.Conn.platform)&&void 0!==h?h:"[empty]"}:
${(0,c.arrayBufferToHexPadded)(n).slice(-16)}`,SEND_LOGS(`syncd: missing indexMAC in sync-actions table for REMOVE mutation in collection ${e} for platform ${null!==(_=u.Conn.platform)&&void 0!==_?_:"[empty]"}`)}d===s.SyncdMutationSyncdOperation.SET&&i.set((0,c.arrayBufferToHexPadded)(n),a)}));const d=yield a.LT_HASH_ANTI_TAMPERING.subtractThenAdd(n,Array.from(i.values()),Array.from(o.values()).concat(Array.from(l.values())));return __LOG__(2)`syncd: computing ltHash for ${e}:
currentLtHash: ${(0,c.arrayBufferToHexPadded)(n)}
macsToAdd:
    ${Array.from(i.entries()).map((e=>{let[t,n]=e;return y(t,n)})).join("\n\t")}
macsToRemove:
    ${Array.from(o.entries()).map((e=>{let[t,n]=e;return y(t,n)})).join("\n\t")}
macsToOverwrite (also remove):
    ${Array.from(l.entries()).map((e=>{let[t,n]=e;return y(t,n)})).join("\n\t")}
newLtHash: ${(0,c.arrayBufferToHexPadded)(d)}`,d}))).apply(this,arguments)}function R(){return(R=(0,i.default)((function*(){const e=[];yield f.default.performTransaction((0,i.default)((function*(){const t=yield f.default.getAllCollectionLtHashes();yield Promise.all(t.map(function(){var t=(0,i.default)((function*(t){let{collection:n,ltHash:r}=t;const i=yield f.default.getSyncActionsRows(["collection"],[n]);e.push({collection:n,ltHash:r,mutations:i})}));return function(){return t.apply(this,arguments)}}()))}))),yield Promise.all(e.map(function(){var e=(0,i.default)((function*(e){let{collection:t,ltHash:n,mutations:r}=e;const i=yield D(r);(0,o.areBuffersEqual)(n,i)||(__LOG__(4,!0,new Error,!0)`syncd: failed LtHash check for ${t}`,SEND_LOGS("LtHash check failed"))}));return function(){return e.apply(this,arguments)}}()))}))).apply(this,arguments)}function D(e){const t=new Map(e.map((e=>[(0,c.arrayBufferToHexPadded)(e.indexMac),e.valueMac])));return a.LT_HASH_ANTI_TAMPERING.add(a.EMPTY_LT_HASH,Array.from(t.values()))}function L(){return N.apply(this,arguments)}function N(){return(N=(0,i.default)((function*(e){const t=yield f.default.getSyncActionsRows(["indexMac"],e);return new Map(t.map((e=>[E.decode(e.indexMac),e.valueMac])))}))).apply(this,arguments)}function k(){return U.apply(this,arguments)}function U(){return(U=(0,i.default)((function*(e){__LOG__(2)`syncd: logMacs: ${e}: prepare`;const[t,n]=yield f.default.performTransaction((0,i.default)((function*(){return __LOG__(2)`syncd: logMacs: ${e}: in transaction`,[yield f.default.getCollectionVersion(e),yield f.default.getSyncActionsRows(["collection"],[e])]})));if(__LOG__(2)`syncd: current snapshot ${e} v${t} with ${n.length} mutations:`,n.length>100)return;n.reduce(((e,t,n)=>(n%20==0&&e.push(""),e[e.length-1]+=y((0,c.arrayBufferToHexPadded)(t.indexMac),t.valueMac)+" | ",e)),[]).forEach((e=>__LOG__(2)`|${e}`))}))).apply(this,arguments)}},2161:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.maxSupportedVersion=t.ActionHandlers=void 0;var i=r(n(6162)),a=r(n(21084)),o=r(n(74362)),s=r(n(28464)),l=r(n(29867)),c=n(45606),d=r(n(24900)),u=r(n(56928)),p=r(n(41058)),f=r(n(12123)),h=r(n(35096)),_=r(n(80056)),g=r(n(79171)),m=r(n(64294)),y=r(n(70119)),E=r(n(34610)),S=r(n(36014)),v=r(n(44720)),T=r(n(42339)),b=r(n(60282)),C=r(n(40108)),A=r(n(21263));const P=new Map([[c.Actions.Star,A.default],[c.Actions.Contact,d.default],[c.Actions.Mute,y.default],[c.Actions.LabelEdit,_.default],[c.Actions.LabelMessage,h.default],[c.Actions.LabelJid,f.default],[c.Actions.QuickReply,b.default],[c.Actions.LocaleSetting,g.default],[c.Actions.SettingPushName,T.default],[c.Actions.Archive,o.default],[c.Actions.MarkChatAsRead,m.default],[c.Actions.ClearChat,l.default],[c.Actions.DeleteMessageForMe,p.default],[c.Actions.Sentinel,C.default],[c.Actions.UnarchiveChatsSetting,s.default],[c.Actions.Pin,S.default],[c.Actions.DeleteChat,u.default],[c.Actions.AndroidUnsupportedActions,a.default],[c.Actions.PrimaryFeature,v.default],[c.Actions.Nux,E.default]]);t.ActionHandlers=P;t.maxSupportedVersion=()=>(0,i.default)(Array.from(P.values()).map((e=>e.version)))},29938:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.applyAppStateSyncResponse=function(){return B.apply(this,arguments)},t.applyIndividualMutations=function(){return x.apply(this,arguments)};var i=r(n(6479)),a=r(n(48926)),o=r(n(89734)),s=n(8243),l=r(n(45095)),c=n(50073),d=n(381),u=n(92844),p=n(84902),f=n(57849),h=n(2161),_=r(n(21084)),g=n(1377),m=n(45606),y=n(58597),E=r(n(73407)),S=n(58743),v=n(68254),T=n(84051),b=n(88432),C=r(n(11339)),A=n(59037),P=n(11540),M=n(85156),O=n(93824),I=n(6954),w=n(72466),R=r(n(89453)),D=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=U(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(78375)),L=n(35377),N=n(62274);const k=["indexMac","valueMac"];function U(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(U=function(e){return e?n:t})(e)}const G=new ArrayBuffer(128);function x(){return(x=(0,a.default)((function*(e){if(0===e.length)return Promise.resolve();__LOG__(2)`syncd: start applyIndividualMutations`;const t=(0,I.syncActionsToDecryptedMutation)(e).reduce(((e,t)=>{var n;const r=null!==(n=e.get(t.collection))&&void 0!==n?n:[];return r.push(t),e.set(t.collection,r),e}),new Map),n=Array.from(t.keys()).map(function(){var e=(0,a.default)((function*(e){__LOG__(2)`syncd: apply individual mutations for collection ${e}`;const n=t.get(e);if(void 0===n)return;const{setMutationsToPersist:r,pendingMutationsToDrop:o}=yield J(e,n,!0),s=r.map((e=>{const{indexMac:t,valueMac:n}=e;return(0,i.default)(e,k)}));__LOG__(2)`syncd: end apply individual mutations for collection ${e}`,yield E.default.performTransaction((0,a.default)((function*(){yield E.default.updateSyncActionRows(s),yield E.default.bulkRemovePendingMutations(o)}))),__LOG__(2)`syncd: end update db after apply individual mutations for collection ${e}`}));return function(){return e.apply(this,arguments)}}());yield Promise.all(n),__LOG__(2)`syncd: end applyIndividualMutations`}))).apply(this,arguments)}function B(){return(B=(0,a.default)((function*(e,t){const{name:n,version:r,patches:i,snapshot:a,syncedPendingMutationsId:o,syncedEncryptedMutations:s}=e;__LOG__(2)`syncd: start applying collection ${n}`;try{const[l,c]=yield Y(n,i,a,t),d=performance.now();if(null!=l)yield W(n,l,c,t),__LOG__(2)`syncd: ${n} snapshot and patches applied successfully`;else if(null!=c){const e=Math.min.apply(Math,c.map((e=>e.version.version)));if(null!=t&&e>t+1&&c.length>0){const r=yield E.default.getAllMissingKeys();if(__LOG__(2)`syncd: missing keys: [${r.map((e=>e.keyHex+":"+e.timestamp))}]`,__LOG__(2)`syncd: has missing patches. collection: ${n}, localVersion: ${t},
minPatch: ${e}`,__LOG__(4,void 0,new Error,!0)`syncd: has missing patches`,SEND_LOGS("syncd: has missing patches"),yield(0,f.getABPropConfigValue)("web_should_fatal_on_missing_patch"))throw yield(0,v.uploadFatalErrorMetric)(C.default.MD_SYNCD_FATAL_ERROR_CODE.SERVER_DID_NOT_SEND_ALL_PATCHES,n,void 0,null!=t?t:0),new M.SyncdFatalError("syncd: has missing patches")}yield V(n,c,t),__LOG__(2)`syncd: ${n} patches applied successfully`}else null!=r?(yield F(n,r,o,s),__LOG__(2)`syncd: ${n} v${r} uploaded successfully`):((0,O.isBootstrap)(t)&&(yield E.default.setCollectionVersion(n,0,G)),__LOG__(2)`syncd: sync ${n} but there are no updates`);const p=Math.floor(performance.now()-d);return __LOG__(2)`syncd: applyAppStateSyncResponse: finished applying ${n} in ${p}ms`,(c||l)&&(0,O.isBootstrap)(t)&&!(0,O.isCriticalCollection)(n)&&new C.default.MdBootstrapDataApplied({mdBootstrapPayloadType:C.default.MD_BOOTSTRAP_PAYLOAD_TYPE.NON_CRITICAL,mdBootstrapSource:C.default.MD_BOOTSTRAP_SOURCE.APP_STATE,mdSessionId:yield b.MdSyncFieldStatsMeta.getMdSessionId(),mdTimestamp:(0,u.unixTimeMs)(),mdBootstrapStepDuration:p,collection:(0,O.collectionNameToMetric)(n),usedSnapshot:null!=l}).commit(),yield(0,g.logMacsInSnapshot)(e.name),e}catch(e){const t=e.message;return e instanceof M.SyncdMissingKeyError?(__LOG__(3)`syncd: key error: ${n} missing keys`,{name:n,state:m.CollectionState.Blocked}):e instanceof M.SyncdFatalError?(__LOG__(4,void 0,new Error,!0)`syncd: fatal error: ${n} throws ${t}`,SEND_LOGS(`syncd: fatal error: ${String(n)} throws ${t}`),{name:n,state:m.CollectionState.ErrorFatal}):(__LOG__(3,void 0,void 0,!0)`syncd: retryable error: ${n} throws ${t}`,SEND_LOGS(`syncd: retryable error: ${String(n)} throws ${t}`),{name:n,state:m.CollectionState.ErrorRetry})}}))).apply(this,arguments)}function F(){return j.apply(this,arguments)}function j(){return(j=(0,a.default)((function*(e,t,n,r){var i;yield(0,g.logMacsInSnapshot)(e);const o=r.map((e=>({indexMac:e.indexMac,valueMac:e.valueMac,operation:e.operation}))),s=yield(0,g.computeLtHash)(e,o),l=(0,I.encryptedUploadMutationsToSyncActions)(r.filter((e=>e.operation===c.SyncdMutationSyncdOperation.SET)),m.SyncActionState.Success),d=null!==(i=yield E.default.getCollectionVersion(e))&&void 0!==i?i:0;t!==d+1&&(__LOG__(4,void 0,new Error,!0)`syncd: _uploadSuccessful: unexpected server version (${t}) after patch upload, expected ${d+1}`,SEND_LOGS("syncd: unexpected server version after patch upload")),__LOG__(2)`syncd: _uploadSuccessful: write to db for ${e}`,yield E.default.performTransaction((0,a.default)((function*(){yield E.default.setSyncActionRows(l),yield E.default.bulkRemovePendingMutations(n),yield E.default.setCollectionVersion(e,t,s)}))),__LOG__(2)`syncd: end _uploadSuccessful for ${e}`}))).apply(this,arguments)}function Y(){return K.apply(this,arguments)}function K(){return(K=(0,a.default)((function*(e,t,n,r){let i=Promise.resolve(),o=0;const l=(0,u.unixTimeMs)();if(null!=n){const t=R.default.validateExternalBlobReference(e,n);o+=(0,s.numberOrThrowIfTooLarge)(t.fileSizeBytes||0),__LOG__(2)`syncd: download snapshot for ${e}`,i=(0,A.downloadSnapshot)(e,t)}let c,d,p=Promise.resolve();if(null!=t){const n=t.map((t=>R.default.validatePatchProtobuf(e,t)));p=Promise.all(n.map(function(){var t=(0,a.default)((function*(t){let n=t.mutations||[];const r=t.externalMutations;return r&&(__LOG__(2)`syncd: download patch for ${e}`,n=yield(0,A.downloadExternalPatch)(e,r),__LOG__(2)`syncd: ${e}'s external patch downloaded`,o+=(0,s.numberOrThrowIfTooLarge)(r.fileSizeBytes||0)),{mutations:n,version:t.version,snapshotMac:t.snapshotMac,patchMac:t.patchMac,keyId:t.keyId,exitCode:t.exitCode,deviceIndex:t.deviceIndex}}));return function(){return t.apply(this,arguments)}}()))}try{[c,d]=yield Promise.all([i,p]),(0,O.isBootstrap)(r)&&(0,N.commitBootstrapAppStateDownloadMetric)(e,l,o,!0)}catch(t){throw(0,O.isBootstrap)(r)&&(0,N.commitBootstrapAppStateDownloadMetric)(e,l,o,!1),t}return[c,d]}))).apply(this,arguments)}function W(){return H.apply(this,arguments)}function H(){return(H=(0,a.default)((function*(e,t,n,r){yield(0,g.logMacsInSnapshot)(e);try{__LOG__(2)`syncd: start validate ${e}'s snapshot`;const n=yield(0,g.computeLtHashAndValidateSnapshot)(e,t);__LOG__(2)`syncd: collection ${e}'s snapshot validated`;const r=yield(0,S.tryDecryptSnapshot)(e,t);__LOG__(2)`syncd: collection ${e}'s snapshot decrypted`,D.addMutationCount(t.records.length),(0,L.logMetricsForMutations)(r),(0,w.validateNoSameIndexForMultipleMutations)(e,r,m.SyncDataType.Snapshot);const i=t.version.version,{setMutationsToPersist:o,pendingMutationsToDrop:s}=yield J(e,r);__LOG__(2)`syncd: processed ${r.length} mutations in snapshot of collection ${e} v${i}`,__LOG__(2)`syncd: collection ${e}'s snapshot v${i} applied`,yield E.default.performTransaction((0,a.default)((function*(){yield E.default.setSyncActionRows(o),yield E.default.bulkRemovePendingMutations(s),yield E.default.setCollectionVersion(e,i,n)}))),__LOG__(2)`syncd: completed applying snapshot for ${e}`}catch(n){throw n instanceof M.SyncdMissingKeyError&&(yield(0,T.handleMissingKeysInSnapshot)(e,t)),n}if(n)return V(e,n,r)}))).apply(this,arguments)}function V(){return $.apply(this,arguments)}function $(){return($=(0,a.default)((function*(e,t,n){if(0===t.length)return __LOG__(2)`syncd: no patches for collection ${e}`,Promise.resolve();(0,w.validateNoDuplicatePatchVersionInCollection)(e,t);const r=(0,o.default)(t,(e=>e.version.version));try{for(let t=0;t<r.length;t++)yield z(e,r[t],n)}catch(t){throw t instanceof M.SyncdMissingKeyError&&(yield(0,T.handleMissingKeysInPatches)(e,r)),t}}))).apply(this,arguments)}function z(){return q.apply(this,arguments)}function q(){return(q=(0,a.default)((function*(e,t){if(yield(0,g.logMacsInSnapshot)(e),t.exitCode){var n;const r=t.exitCode.code;switch(r){case 100:(0,v.uploadFatalErrorMetric)(C.default.MD_SYNCD_FATAL_ERROR_CODE.TERMINAL_PATCH_MISSING_DATA,e);break;case 101:(0,v.uploadFatalErrorMetric)(C.default.MD_SYNCD_FATAL_ERROR_CODE.TERMINAL_PATCH_DESERIALIZATION_ERROR,e);break;default:(0,v.uploadFatalErrorMetric)(C.default.MD_SYNCD_FATAL_ERROR_CODE.TERMINAL_PATCH_UNKNOWN,e)}throw new M.SyncdFatalError(`received terminal patch with exit code:  ${String(r)} text: ${String(null===(n=t.exitCode)||void 0===n?void 0:n.text)}  `)}0===t.deviceIndex&&_.default.updatePrimaryAllowsAllMutationsFlag("device index");const r=t.mutations.filter((e=>e.operation===c.SyncdMutationSyncdOperation.SET)).length,i=t.mutations.length-r;__LOG__(2)`syncd: applying patch ${e} v${t.version.version} from device ${t.deviceIndex}
SET count: ${r}
REMOVE count: ${i}`,0===r&&0===i&&(__LOG__(3,void 0,void 0,!0)`syncd: ${e}: empty patch found`,SEND_LOGS(`syncd: ${e}: empty patch found`));const o=yield(0,g.computeLtHashAndValidatePatch)(e,t);__LOG__(2)`syncd: completed computeLtHashAndValidatePatch for ${e} v${t.version.version}`;const s=yield(0,S.tryDecryptPatch)(e,t);(0,L.logMetricsForMutations)(s),D.addMutationCount(s.length),(0,w.validateNoSameIndexForMultipleMutations)(e,s,m.SyncDataType.Patch);const l=te(s),d=l.filter((e=>e.operation===c.SyncdMutationSyncdOperation.REMOVE));yield X(e,d),__LOG__(2)`syncd: completed _applyRemoveMutations for ${e} v${t.version.version}`;const u=l.filter((e=>e.operation===c.SyncdMutationSyncdOperation.SET)),{setMutationsToPersist:p,pendingMutationsToDrop:f}=yield J(e,u);__LOG__(2)`syncd: processed ${s.length} mutations in patch version ${t.version.version} of collection ${e}`;const h=t.version.version;yield E.default.performTransaction((0,a.default)((function*(){yield E.default.deleteSyncActionRows(d.map((e=>e.index))),yield E.default.setSyncActionRows(p),yield E.default.bulkRemovePendingMutations(f),yield E.default.setCollectionVersion(e,h,o)}))),__LOG__(2)`syncd: completed final transaction in _applyPatch for ${e} v${t.version.version}`}))).apply(this,arguments)}function J(){return Q.apply(this,arguments)}function Q(){return(Q=(0,a.default)((function*(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];(0,y.logCriticalBootstrapStageIfNecessary)(C.default.BOOTSTRAP_APP_STATE_DATA_STAGE_CODE.ABOUT_TO_APPLY_MUTATIONS);const r=n?" (individual mutations)":"",i=[],a=(0,w.validateAndTypeSetMutations)(e,t),{supportedMutations:o,unsupportedMutations:s}=ne(e,a);s.forEach((e=>i.push((0,I.setMutationToSyncAction)(e,m.SyncActionState.Unsupported))));const{remoteMutationsToApply:c,pendingMutationsToDrop:u}=yield(0,P.resolveConflict)(e,o),f=o.filter((e=>!c.includes(e)));f.forEach((e=>i.push((0,I.setMutationToSyncAction)(e,m.SyncActionState.Skipped,e.actionName))));const h=re(c);for(let t=0;t<h.length;t++){const n=h[t][0].actionHandler,a=h[t].map((e=>{let t;return t=e.binarySyncData?(0,l.default)((0,p.decodeProtobuf)(d.SyncActionDataSpec,e.binarySyncData).value,"decodeProtobuf(SyncActionDataSpec, m.binarySyncData).value"):(0,p.decodeProtobuf)(d.SyncActionValueSpec,e.binarySyncAction),{operation:"set",indexParts:e.indexArr,value:t,timestamp:e.timestamp}}));let o=[],s=!1;try{__LOG__(2)`syncd: before apply mutation batch for ${e}. mutations count: ${a.length}  ${r}`,o=yield n.applyMutations(a,{setMutationsPendingToPersist:i,allSupportedSetMutations:c})}catch(t){if(t instanceof M.SyncdFatalError||e===m.CollectionName.CriticalBlock)throw t;s=!0,__LOG__(3)`synd: catching error during _applySetMutations: ${t}`}__LOG__(2)`syncd: after apply mutation batch for ${e}  ${r}`;for(let e=0;e<h[t].length;e++){var _,g;i.push((0,I.setMutationToSyncAction)(h[t][e],s?m.SyncActionState.Failed:o[e].actionState,h[t][e].actionName,s||null===(_=o[e].orphanModel)||void 0===_?void 0:_.modelId,s||null===(g=o[e].orphanModel)||void 0===g?void 0:g.modelType))}}return(0,y.logCriticalBootstrapStageIfNecessary)(C.default.BOOTSTRAP_APP_STATE_DATA_STAGE_CODE.APPLIED_MUTATIONS),__LOG__(2)`syncd: completed apply set mutations for ${e}  ${r}`,{setMutationsToPersist:i,pendingMutationsToDrop:u}}))).apply(this,arguments)}function X(){return Z.apply(this,arguments)}function Z(){return(Z=(0,a.default)((function*(e,t){const{supportedMutations:n}=ee(t),r=re(n);__LOG__(2)`syncd: before apply remove mutations for ${e}`;for(let t=0;t<r.length;t++){const n=r[t][0].actionHandler;yield n.applyMutations(r[t].map((t=>({operation:"remove",indexParts:ie(e,t.index)}))),{setMutationsPendingToPersist:[],allSupportedSetMutations:[]})}__LOG__(2)`syncd: after apply remove mutations for ${e}`}))).apply(this,arguments)}function ee(e){const t=[],n=[];return e.forEach((e=>{if(e.version>(0,h.maxSupportedVersion)())return void n.push(e);const r=ie(e.collection,e.index),i=m.Actions.cast(r[0]);if(!i)return __LOG__(3)`syncd: invalid action ${r[0]}`,void n.push(e);const a=h.ActionHandlers.get(i);if(!a)return __LOG__(3)`syncd: no handler for action ${i}`,void n.push(e);t.push({collection:e.collection,index:e.index,indexMac:e.indexMac,keyId:e.keyId,binarySyncAction:e.binarySyncAction,binarySyncData:e.binarySyncData,valueMac:e.valueMac,version:e.version,indexArr:r,actionName:i,actionHandler:a})})),{supportedMutations:t,unsupportedMutations:n}}function te(e){const t=e.filter((e=>e.operation===c.SyncdMutationSyncdOperation.SET)),n=new Set(t.map((e=>e.index)));return e.filter((e=>e.operation===c.SyncdMutationSyncdOperation.REMOVE)).forEach((e=>{n.has(e.index)||t.push(e)})),t}function ne(e,t){const n=[],r=[];return t.forEach((t=>{if(t.version>(0,h.maxSupportedVersion)())return void r.push(t);const i=ie(e,t.index),a=m.Actions.cast(i[0]);if(!a)return __LOG__(3)`syncd: invalid action ${i[0]}`,void r.push(t);const o=h.ActionHandlers.get(a);if(!o)return __LOG__(3)`syncd: no handler for action ${a}`,void r.push(t);n.push({collection:t.collection,index:t.index,indexMac:t.indexMac,keyId:t.keyId,timestamp:t.timestamp,binarySyncAction:t.binarySyncAction,binarySyncData:t.binarySyncData,valueMac:t.valueMac,version:t.version,indexArr:i,actionName:a,actionHandler:o})})),{supportedMutations:n,unsupportedMutations:r}}function re(e){return e.reduce(((e,t)=>(0!==e.length&&t.actionName===e[e.length-1][0].actionName?e[e.length-1].push(t):e.push([t]),e)),[])}function ie(e,t){try{const e=JSON.parse(t);if(e.length<1)throw new Error;return e}catch(t){throw(0,v.uploadFatalErrorMetric)(C.default.MD_SYNCD_FATAL_ERROR_CODE.INVALID_ACTION_INDEX,e),new M.SyncdFatalError("invalid action index")}}},13815:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.decodeExternalBlobReference=function(e,t){try{return(0,o.decodeProtobuf)(i.ExternalBlobReferenceSpec,t)}catch(t){throw(0,s.uploadFatalErrorMetric)(l.default.MD_SYNCD_FATAL_ERROR_CODE.EXTERNAL_BLOB_REFERENCE_PROTOBUF_DESERIALIZATION_FAILED,e),new c.SyncdFatalError("external blob reference protobuf deserialization failed")}},t.decodeSyncActionData=function(e,t){try{return(0,o.decodeProtobuf)(a.SyncActionDataSpec,t)}catch(t){throw(0,s.uploadFatalErrorMetric)(l.default.MD_SYNCD_FATAL_ERROR_CODE.ACTION_DATA_PROTOBUF_DESERIALIZATION_FAILED,e),new c.SyncdFatalError("action data protobuf deserialization failed")}},t.decodeSyncdMutations=function(e,t){try{return(0,o.decodeProtobuf)(i.SyncdMutationsSpec,t)}catch(t){throw(0,s.uploadFatalErrorMetric)(l.default.MD_SYNCD_FATAL_ERROR_CODE.MUTATIONS_PROTOBUF_DESERIALIZATION_FAILED,e),new c.SyncdFatalError("mutations protobuf deserialization failed")}},t.decodeSyncdPatch=function(e,t){try{return(0,o.decodeProtobuf)(i.SyncdPatchSpec,t)}catch(t){throw(0,s.uploadFatalErrorMetric)(l.default.MD_SYNCD_FATAL_ERROR_CODE.PATCH_PROTOBUF_DESERIALIZATION_FAILED,e),new c.SyncdFatalError("patch protobuf deserialization failed")}},t.decodeSyncdSnapshot=function(e,t){try{return(0,o.decodeProtobuf)(i.SyncdSnapshotSpec,t)}catch(t){throw(0,s.uploadFatalErrorMetric)(l.default.MD_SYNCD_FATAL_ERROR_CODE.SNAPSHOT_PROTOBUF_DESERIALIZATION_FAILED,e),new c.SyncdFatalError("snapshot protobuf deserialization failed")}};var i=n(50073),a=n(381),o=n(84902),s=n(68254),l=r(n(11339)),c=n(85156)},58743:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.tryDecryptPatch=function(){return S.apply(this,arguments)},t.tryDecryptSnapshot=function(){return E.apply(this,arguments)};var i=r(n(48926)),a=n(7589),o=n(50073),s=n(381),l=n(62109),c=n(32458),d=n(63109),u=n(60980),p=n(13815),f=n(68254),h=n(837),_=r(n(11339)),g=n(85156),m=r(n(16088));const y=new TextDecoder;function E(){return(E=(0,i.default)((function*(e,t){return yield Promise.all(t.records.map((t=>v(e,o.SyncdMutationSyncdOperation.SET,t))))}))).apply(this,arguments)}function S(){return(S=(0,i.default)((function*(e,t){return yield Promise.all(t.mutations.map((t=>v(e,t.operation,t.record))))}))).apply(this,arguments)}function v(){return T.apply(this,arguments)}function T(){return(T=(0,i.default)((function*(e,t,n){const r=n.keyId.id,i=yield(0,h.getKeyData)(r);if(!i){if(t===o.SyncdMutationSyncdOperation.REMOVE)throw new g.SyncdFatalError("no key data for remove mutations");throw new g.SyncdMissingKeyError}const{syncAction:a,indexMac:l,valueMac:c,indexValueBinary:d}=yield b(e,r,i,t,n),{index:p,value:f,version:_}=a,m=f?(0,u.encodeProtobuf)(s.SyncActionValueSpec,f).readBuffer():f;return{index:y.decode(p),action:null,binarySyncAction:m,version:_,keyId:r,operation:t,indexMac:l,valueMac:c,collection:e,binarySyncData:d}}))).apply(this,arguments)}function b(){return C.apply(this,arguments)}function C(){return(C=(0,i.default)((function*(e,t,n,r,i){const o=i.index.blob,s=i.value.blob,u=(0,l.valueMacFromIndexAndValueCipherText)(s),h=(0,d.split)(s,c.IV_LENGTH,s.byteLength-c.MAC_LENGTH-c.IV_LENGTH),y=h[0],E=h[1],S=h[2],v=yield(0,l.generateEncryptionKeys)(n),{indexKey:T,valueEncryptionKey:b,valueMacKey:C}=v,A=(0,d.combine)([y,E]),P=(0,l.generateAssociatedData)(r,t),M=yield(0,l.generateMac)(P,A,C);if(!(0,a.areBuffersEqual)(S,M))throw(0,f.uploadFatalErrorMetric)(_.default.MD_SYNCD_FATAL_ERROR_CODE.DECRYPTION_FAILED,e),new g.SyncdFatalError("decryption failure: valueMAC mismatch");const O=yield(0,l.decryptCipherText)(new Uint8Array(y),b,E),I=(0,p.decodeSyncActionData)(e,O),w=m.default.validateSyncActionDataProtobuf(e,I),R=yield(0,l.generateIndexMac)(T,w.index);if(!(0,a.areBuffersEqual)(o,R))throw(0,f.uploadFatalErrorMetric)(_.default.MD_SYNCD_FATAL_ERROR_CODE.DECRYPTION_FAILED,e),new g.SyncdFatalError("decryption failure: indexMAC mismatch");return{syncAction:w,indexMac:o,valueMac:u,indexValueBinary:O}}))).apply(this,arguments)}},59037:(e,t,n)=>{"use strict";var r=n(59182).default,i=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.downloadExternalPatch=function(){return g.apply(this,arguments)},t.downloadSnapshot=function(){return _.apply(this,arguments)};var a=i(n(81109)),o=i(n(48926)),s=n(15688),l=n(13815),c=n(26384),d=n(27856),u=n(68254),p=i(n(11339)),f=n(85156),h=i(n(89453));function _(){return(_=(0,o.default)((function*(e,t){try{const n=yield m(t),r=(0,l.decodeSyncdSnapshot)(e,n);return h.default.validateSnapshotProtobuf(e,r)}catch(n){if(__LOG__(2)`syncd: error downloading snapshot of expected size ${t.fileSizeBytes} with expected hash b64 length of ${(0,s.encodeB64)(t.fileEncSha256).length} for collection ${e}`,n instanceof d.MediaNotFoundError)throw(0,u.uploadFatalErrorMetric)(p.default.MD_SYNCD_FATAL_ERROR_CODE.SNAPSHOT_EXPIRED,e),new f.SyncdFatalError("snapshot expired");throw n}}))).apply(this,arguments)}function g(){return(g=(0,o.default)((function*(e,t){try{const n=yield m(t);return(0,l.decodeSyncdMutations)(e,n).mutations.map((t=>h.default.validateMutationProtobuf(e,t)))}catch(n){if(__LOG__(2)`syncd: error downloading patch of expected size ${t.fileSizeBytes} with expected hash b64 length of ${(0,s.encodeB64)(t.fileEncSha256).length} for collection ${e}`,n instanceof d.MediaNotFoundError)throw(0,u.uploadFatalErrorMetric)(p.default.MD_SYNCD_FATAL_ERROR_CODE.EXTERNAL_PATCH_EXPIRED,e),new f.SyncdFatalError("external patch expired");throw n}}))).apply(this,arguments)}function m(e){const{mediaKey:t,directPath:n,fileSha256:i,fileEncSha256:o}=e,l={directPath:n,encFilehash:(0,s.encodeB64)(o),filehash:(0,s.encodeB64)(i),mediaKey:(0,s.encodeB64)(t),type:"md-app-state",userDownloadAttemptCount:0};return c.downloadManager.downloadAndDecrypt((0,a.default)({signal:(new r).signal},l))}},11540:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.resolveConflict=function(){return d.apply(this,arguments)};var i=r(n(48926)),a=n(45606),o=r(n(73407)),s=n(43402);function l(){return c.apply(this,arguments)}function c(){return(c=(0,i.default)((function*(e,t){const n=yield Promise.all(e.map(function(){var e=(0,i.default)((function*(e){const n=t.get(e.index);if(n){const t=e.actionHandler;return{remoteMutationIndex:e.index,conflictResolutionState:yield t.resolveConflicts(n,e)}}}));return function(){return e.apply(this,arguments)}}())),r=new Map;return n.forEach((e=>{e&&r.set(e.remoteMutationIndex,e.conflictResolutionState)})),r}))).apply(this,arguments)}function d(){return(d=(0,i.default)((function*(e,t){const n=[];let r=[];const i=yield o.default.getPendingMutationsRows(["collection"],e),c=new Map(i.map((e=>[e.index,e]))),d=yield l(t,c);t.forEach((e=>{const t=d.get(e.index);if(t)switch(t){case a.ConflictResolutionState.SkipRemote:break;case a.ConflictResolutionState.ApplyRemoteAndDropLocal:n.push(e),r=r.concat(i.filter((t=>t.index===e.index)));break;case a.ConflictResolutionState.SkipRemoteAndDropLocal:r=r.concat(i.filter((t=>t.index===e.index)))}else n.push(e)}));const u=(0,s.sort)(n),p=[];for(let e=0;e<u.length;e++){const t=u[e].actionHandler;(yield t.dropMutationDueToCrossIndexConflict(u[e],c))||p.push(u[e])}return{remoteMutationsToApply:p,pendingMutationsToDrop:r.map((e=>e.id)).filter(Boolean)}}))).apply(this,arguments)}},43402:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t._setDependency=function(e,t){l.set(e,t)},t.sort=function(e){const t=[],n=[];try{return e.forEach((r=>{t.push(r);const i=l.get(r.actionName);null!=i&&e.forEach((e=>{e!==r&&i.includes(e.actionName)&&function(e,t){const n=e.actionHandler.getChatJidAndMessageKey(e),r=t.actionHandler.getChatJidAndMessageKey(t);if(n&&r)return n.chatJid===r.chatJid&&(null==n.messageKey||null==r.messageKey||n.messageKey===r.messageKey);return!1}(e,r)&&(e.timestamp<r.timestamp?n.push([e,r]):n.push([r,e]))}))})),i.default.array(t,n)}catch(e){throw(0,a.uploadFatalErrorMetric)(o.default.MD_SYNCD_FATAL_ERROR_CODE.CYCLIC_MUTATION_DEPENDENCY_IN_PATCH,null),new s.SyncdFatalError("cyclic mutation dependency in patch")}};var i=r(n(94633)),a=(n(45606),n(68254)),o=r(n(11339)),s=n(85156);const l=new Map},6954:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.encryptedUploadMutationsToSyncActions=function(e,t){return e.map((e=>({index:e.index,action:e.action,binarySyncAction:e.binarySyncAction,actionState:t,version:e.version,keyId:e.keyId,indexMac:e.indexMac,valueMac:e.valueMac,collection:e.collection,timestamp:e.timestamp})))},t.setMutationToSyncAction=function(e,t,n,r,i){return{index:e.index,binarySyncAction:e.binarySyncAction,binarySyncData:e.binarySyncData,version:e.version,keyId:e.keyId,indexMac:e.indexMac,valueMac:e.valueMac,collection:e.collection,timestamp:e.timestamp,action:n,actionState:t,modelId:r,modelType:null!=i?i:void 0}},t.syncActionsToDecryptedMutation=function(e){return e.map((e=>({collection:e.collection,index:e.index,action:e.action,indexMac:e.indexMac,keyId:e.keyId,operation:r.SyncdMutationSyncdOperation.SET,binarySyncAction:e.binarySyncAction,binarySyncData:e.binarySyncData,valueMac:e.valueMac,version:e.version})))};var r=n(50073)},72466:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.validateAndTypeSetMutations=function(e,t){return t.map((t=>{let n;if(t.binarySyncData){const e=t.binarySyncData;n=(0,s.decodeProtobuf)(o.SyncActionDataSpec,e).value}else t.binarySyncAction&&(n=(0,s.decodeProtobuf)(o.SyncActionValueSpec,t.binarySyncAction));if(!n)throw(0,c.uploadFatalErrorMetric)(d.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_ACTION_VALUE,e),new u.SyncdFatalError("missing action value");const r=(0,i.maybeNumberOrThrowIfTooLarge)(n.timestamp);if(null==r)throw(0,c.uploadFatalErrorMetric)(d.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_ACTION_TIMESTAMP,e),new u.SyncdFatalError("missing action timestamp");return{index:t.index,version:t.version,keyId:t.keyId,indexMac:t.indexMac,valueMac:t.valueMac,collection:t.collection,binarySyncAction:t.binarySyncAction,binarySyncData:t.binarySyncData,timestamp:r}}))},t.validateNoDuplicatePatchVersionInCollection=function(e,t){const n=new Set;t.forEach((t=>{const r=t.version.version;if(n.has(r))throw(0,c.uploadFatalErrorMetric)(d.default.MD_SYNCD_FATAL_ERROR_CODE.DUPLICATE_PATCH_VERSION_IN_COLLECTION,e),new u.SyncdFatalError("duplicate patch version in collection");n.add(r)}))},t.validateNoSameIndexForMultipleMutations=function(e,t,n){const r=new Set,i=new Set;t.forEach((t=>{let o=!1;if(t.operation===a.SyncdMutationSyncdOperation.SET&&(r.has(t.index)?o=!0:r.add(t.index)),t.operation===a.SyncdMutationSyncdOperation.REMOVE&&(i.has(t.index)?o=!0:i.add(t.index)),o)switch(n){case l.SyncDataType.Patch:throw(0,c.uploadFatalErrorMetric)(d.default.MD_SYNCD_FATAL_ERROR_CODE.SAME_INDEX_FOR_MULTIPLE_MUTATIONS_IN_PATCH,e),new u.SyncdFatalError("same index for multiple mutations in patch");case l.SyncDataType.Snapshot:throw(0,c.uploadFatalErrorMetric)(d.default.MD_SYNCD_FATAL_ERROR_CODE.SAME_INDEX_FOR_MULTIPLE_MUTATIONS_IN_SNAPSHOT,e),new u.SyncdFatalError("same index for multiple mutations in snapshot")}}))};var i=n(8243),a=n(50073),o=n(381),s=n(84902),l=n(45606),c=n(68254),d=r(n(11339)),u=n(85156)},89453:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(8243),a=n(68254),o=r(n(11339)),s=n(85156);class l{static validateSnapshotProtobuf(e,t){const{version:n,records:r,mac:c,keyId:d}=t,u=null==n?void 0:n.version;if(!n||null==u)throw(0,a.uploadFatalErrorMetric)(o.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_SNAPSHOT_VERSION,e),new s.SyncdFatalError("missing snapshot version");const p=r.map((t=>l.validateRecordProtobuf(e,t)));if(!c)throw(0,a.uploadFatalErrorMetric)(o.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_SNAPSHOT_MAC,e),new s.SyncdFatalError("missing snapshot mac");const f=l.validateKeyIdProtobuf(e,d,o.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_SNAPSHOT_KEY_ID);return{version:{version:(0,i.numberOrThrowIfTooLarge)(u)},records:p,mac:c,keyId:f}}static validatePatchProtobuf(e,t){const{version:n,mutations:r,externalMutations:c,snapshotMac:d,patchMac:u,keyId:p,exitCode:f,deviceIndex:h}=t,_=null==n?void 0:n.version;if(!n||null==_)throw(0,a.uploadFatalErrorMetric)(o.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_PATCH_VERSION,e),new s.SyncdFatalError("missing patch version");if(r&&r.length>0&&c)throw(0,a.uploadFatalErrorMetric)(o.default.MD_SYNCD_FATAL_ERROR_CODE.PATCH_WITH_BOTH_INLINE_AND_EXTERNAL_MUTATIONS,e),new s.SyncdFatalError("patch with both inline and external mutations");if(!d)throw(0,a.uploadFatalErrorMetric)(o.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_PATCH_SNAPSHOT_MAC,e),new s.SyncdFatalError("missing patch snapshot mac");if(!u)throw(0,a.uploadFatalErrorMetric)(o.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_PATCH_MAC,e),new s.SyncdFatalError("missing patch mac");const g=l.validateKeyIdProtobuf(e,p,o.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_PATCH_KEY_ID);if(c){const t=l.validateExternalBlobReference(e,c);return{version:{version:(0,i.numberOrThrowIfTooLarge)(_)},mutations:void 0,externalMutations:t,snapshotMac:d,patchMac:u,keyId:g,deviceIndex:h}}const m=r.map((t=>l.validateMutationProtobuf(e,t)));return{version:{version:(0,i.numberOrThrowIfTooLarge)(_)},mutations:m,externalMutations:void 0,exitCode:f,snapshotMac:d,patchMac:u,keyId:g,deviceIndex:h}}static validateExternalBlobReference(e,t){const{mediaKey:n,directPath:r,handle:i,fileSizeBytes:l,fileSha256:c,fileEncSha256:d}=t;if(!n)throw(0,a.uploadFatalErrorMetric)(o.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_EXTERNAL_BLOB_REFERENCE_MEDIA_KEY,e),new s.SyncdFatalError("missing external blob reference media key");if(!r)throw(0,a.uploadFatalErrorMetric)(o.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_EXTERNAL_BLOB_REFERENCE_DIRECT_PATH,e),new s.SyncdFatalError("missing external blob reference direct path");if(!c)throw(0,a.uploadFatalErrorMetric)(o.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_EXTERNAL_BLOB_REFERENCE_FILE_SHA256,e),new s.SyncdFatalError("missing external blob reference file SHA256");if(!d)throw(0,a.uploadFatalErrorMetric)(o.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_EXTERNAL_BLOB_REFERENCE_FILE_ENC_SHA256,e),new s.SyncdFatalError("missing external blob reference file enc SHA256");return{mediaKey:n,directPath:r,handle:i,fileSizeBytes:l,fileSha256:c,fileEncSha256:d}}static validateMutationProtobuf(e,t){const{operation:n,record:r}=t;if(null==n)throw(0,a.uploadFatalErrorMetric)(o.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_MUTATION_OPERATION,e),new s.SyncdFatalError("missing mutation operation");if(!r)throw(0,a.uploadFatalErrorMetric)(o.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_MUTATION_RECORD,e),new s.SyncdFatalError("missing mutation record");return{operation:n,record:l.validateRecordProtobuf(e,r)}}static validateRecordProtobuf(e,t){const{index:n,value:r,keyId:i}=t,c=null==n?void 0:n.blob,d=null==r?void 0:r.blob;if(!n||!c)throw(0,a.uploadFatalErrorMetric)(o.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_MUTATION_INDEX,e),new s.SyncdFatalError("missing mutation index");if(!r||!d)throw(0,a.uploadFatalErrorMetric)(o.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_MUTATION_VALUE,e),new s.SyncdFatalError("missing mutation value");return{index:{blob:c},value:{blob:d},keyId:l.validateKeyIdProtobuf(e,i,o.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_MUTATION_KEY_ID)}}static validateKeyIdProtobuf(e,t,n){const r=null==t?void 0:t.id;if(!t||!r)throw(0,a.uploadFatalErrorMetric)(n,e),new s.SyncdFatalError("missing mutation key id");return{id:r}}}t.default=l},16088:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(68254),a=r(n(11339)),o=n(85156);t.default=class{static validateSyncActionDataProtobuf(e,t){const{index:n,value:r,padding:s,version:l}=t;if(!n)throw(0,i.uploadFatalErrorMetric)(a.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_ACTION_INDEX,e),new o.SyncdFatalError("missing action index");if(null==l)throw(0,i.uploadFatalErrorMetric)(a.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_ACTION_VERSION,e),new o.SyncdFatalError("missing action version");return{index:n,value:r,padding:s,version:l}}}},35377:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.logMetricsForMutations=function(e){(0,o.logCriticalBootstrapStageIfNecessary)(s.default.BOOTSTRAP_APP_STATE_DATA_STAGE_CODE.MUTATIONS_DECRYPTED),e.forEach(l)};var i=n(381),a=n(84902),o=n(58597),s=r(n(11339));function l(e){let t;const{binarySyncAction:n}=e;if(null==n)return;const r=(0,a.decodeProtobuf)(i.SyncActionValueSpec,n);r.archiveChatAction?t=r.archiveChatAction.messageRange:r.markChatAsReadAction?t=r.markChatAsReadAction.messageRange:r.clearChatAction?t=r.clearChatAction.messageRange:r.deleteChatAction&&(t=r.deleteChatAction.messageRange),null!=t&&new s.default.MdAppStateMessageRange({additionalMessagesCount:t.messages.length}).commit()}},62274:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.commitBootstrapAppStateDownloadMetric=function(){return d.apply(this,arguments)};var i=r(n(48926)),a=n(8243),o=n(92844),s=n(45606),l=n(88432),c=r(n(11339));function d(){return(d=(0,i.default)((function*(e,t,n,r){const i=new c.default.MdBootstrapAppStateDataDownloaded({mdBootstrapPayloadType:[s.CollectionName.CriticalBlock,s.CollectionName.CriticalUnblockLow].includes(e)?c.default.MD_BOOTSTRAP_PAYLOAD_TYPE.CRITICAL:c.default.MD_BOOTSTRAP_PAYLOAD_TYPE.NON_CRITICAL,mdTimestamp:(0,o.unixTimeMs)(),mdBootstrapStepDuration:(0,o.unixTimeMs)()-t,mdBootstrapStepResult:r?c.default.MD_BOOTSTRAP_STEP_RESULT.SUCCESS:c.default.MD_BOOTSTRAP_STEP_RESULT.FAILURE,mdSessionId:yield l.MdSyncFieldStatsMeta.getMdSessionId()}),d=yield l.MdSyncFieldStatsMeta.getStorageEstimation();d.mdStorageQuotaBytes!==l.STORAGE_QUOTA_UNAVAILABLE&&(i.mdStorageQuotaUsedBytes=d.mdStorageQuotaUsedBytes,i.mdStorageQuotaBytes=d.mdStorageQuotaBytes);try{const e=(0,a.maybeNumberOrThrowIfTooLarge)(n);null!=e&&(i.mdBootstrapPayloadSize=e)}catch(e){}i.commit()}))).apply(this,arguments)}},65582:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleAppStateSyncKeyRequest=function(){return l.apply(this,arguments)};var i=r(n(48926)),a=n(63109),o=r(n(73407)),s=n(26442);function l(){return(l=(0,i.default)((function*(e,t){const n=e.keyIds;if(n){const e=n.map((e=>e.keyId)).filter(Boolean);if(__LOG__(2)`syncd: handleAppStateSyncKeyRequest from device ${t.getDeviceId()}
\t for keyIds: [${e.map(a.arrayBufferToHex)}]`,e){const n=[],r=[];return yield Promise.all(e.map(function(){var e=(0,i.default)((function*(e){const t=yield o.default.getSyncKey(new Uint8Array(e));t?n.push(t):r.push(e)}));return function(){return e.apply(this,arguments)}}())),__LOG__(2)`syncd: handleAppStateSyncKeyRequest from device ${t.getDeviceId()}: about to send key share
\t keys with keydata: [${n.map((e=>(0,a.arrayBufferToHex)(e.keyId.buffer)))}]
\t keys without keydata: [${r.map((e=>(0,a.arrayBufferToHex)(e)))}]`,(0,s.sendAppStateSyncKeyShare)({type:"missing_key",keys:n,orphanKeys:r,peerDeviceId:t})}}}))).apply(this,arguments)}},82568:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleAppStateSyncKeyShare=function(){return h.apply(this,arguments)};var i=r(n(48926)),a=n(8243),o=n(63109),s=n(58597),l=r(n(73407)),c=n(68254),d=n(4573),u=r(n(11339)),p=n(93932),f=n(38804);function h(){return(h=(0,i.default)((function*(e,t){(0,s.logCriticalBootstrapStageIfNecessary)(u.default.BOOTSTRAP_APP_STATE_DATA_STAGE_CODE.MISSING_KEYS_RECEIVED);const n=t.getDeviceId();__LOG__(2)`syncd: handling key share from device ${n} with ${e.keys.length} keys`;const r=[],h=e.keys;if(!h)return Promise.resolve();yield Promise.all(h.map(function(){var e=(0,i.default)((function*(e){var t;const i=null===(t=e.keyId)||void 0===t?void 0:t.keyId,s=e.keyData,p=null==s?void 0:s.keyData;if(!i)return void __LOG__(2)`syncd: received key with missing keyID from device ${n}`;const f=(0,o.arrayBufferToHex)(i);if(__LOG__(2)`syncd: received key share key id ${f} from device ${n} ${null!=p?"with":"without"} keyData`,6!==i.byteLength)return new u.default.MdFatalError({mdFatalErrorCode:u.default.MD_SYNCD_FATAL_ERROR_CODE.INVALID_KEY_SHARE_KEY_ID}).commit(!0),__LOG__(4,void 0,new Error,!0)`syncd: fatal error: key share key id has invalid bytelength of ${i.byteLength}`,SEND_LOGS(`syncd: fatal error: key share key id has invalid bytelength of ${i.byteLength}`),(0,c.handleFatalError)();if(r.push({keyId:i,keyData:p}),s){var h,_,g;const e=s.timestamp,t=null===(h=s.fingerprint)||void 0===h?void 0:h.currentIndex,r=null===(_=s.fingerprint)||void 0===_?void 0:_.rawId,o=null===(g=s.fingerprint)||void 0===g?void 0:g.deviceIndexes;if(!p||null==e||null==t||null==r||!o)return new u.default.MdFatalError({mdFatalErrorCode:u.default.MD_SYNCD_FATAL_ERROR_CODE.INVALID_KEY_SHARE_KEY_DATA}).commit(!0),__LOG__(4,void 0,new Error,!0)`syncd: fatal error: invalid key share key data`,SEND_LOGS("syncd: fatal error: invalid key share key data"),(0,c.handleFatalError)();const m=new Uint8Array(i);(yield l.default.getSyncKey(m))||(yield l.default.createSyncKey({keyId:m,keyEpoch:(0,d.getKeyEpoch)(i),keyData:p,timestamp:(0,a.numberOrThrowIfTooLarge)(e),fingerprint:{rawId:r,currentIndex:t,deviceIndexes:o}}),__LOG__(2)`syncd: stored key share key id ${f} from device ${n}`)}}));return function(){return e.apply(this,arguments)}}())),r.some((e=>null!=e.keyData))||__LOG__(2)`syncd: key share from device ${n} has no keys with keydata.`,yield(0,p.updateMissingKeys)(r,t),(0,f.syncBlockedCollections)()}))).apply(this,arguments)}},84051:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleMissingKeysInPatches=function(){return h.apply(this,arguments)},t.handleMissingKeysInSnapshot=function(){return f.apply(this,arguments)},t.requestAllMissingKeys=function(){return E.apply(this,arguments)};var i=r(n(48926)),a=n(7589),o=n(63109),s=n(93932),l=(n(45606),r(n(73407))),c=n(4573),d=n(65031),u=n(85156);const p=new ArrayBuffer(0);function f(){return(f=(0,i.default)((function*(e,t){const n=new Set,r=(yield l.default.getAllSyncKeys()).map((e=>(0,o.arrayBufferToHex)(e.keyId.buffer)));t.records.forEach((e=>{const t=e.keyId.id;if((0,a.areBuffersEqual)(t,p))throw new u.SyncdFatalError("snapshot has empty key");const i=(0,o.arrayBufferToHex)(t);r.includes(i)||n.add(i)})),__LOG__(2)`syncd: collection ${e}'s snapshot has missing keys ${Array.from(n)}`,yield _(n)}))).apply(this,arguments)}function h(){return(h=(0,i.default)((function*(e,t){const n=new Set,r=(yield l.default.getAllSyncKeys()).map((e=>(0,o.arrayBufferToHex)(e.keyId.buffer)));t.forEach((e=>{const t=e.keyId.id;if((0,a.areBuffersEqual)(t,p))throw new u.SyncdFatalError("syncd: patch has empty key. patch device id: ${p.deviceIndex}");const i=(0,o.arrayBufferToHex)(t);r.includes(i)||(__LOG__(2)`syncd: handleMissingKeysInPatches: missing key: keyId: ${i}, patch version: ${e.version.version}, patch device id: ${e.deviceIndex}`,n.add(i))})),__LOG__(2)`syncd: collection ${e}'s patches has missing keys ${Array.from(n)}`,yield _(n)}))).apply(this,arguments)}function _(){return g.apply(this,arguments)}function g(){return(g=(0,i.default)((function*(e){if(!n(28237).OfflineMessageHandler.isResumeFromRestartComplete())return void __LOG__(2)`syncd: _handleMissingKeys: skipping due to resume from restart in progress`;const t=Array.from(e);__LOG__(2)`syncd: _handleMissingKeys: missing keys [${t}]`;const r=new Set((yield l.default.bulkGetMissingKeys(t)).filter(Boolean).map((e=>e.keyHex))),i=t.filter((e=>!r.has(e)));if(__LOG__(2)`syncd: _handleMissingKeys: missing keys after filter: [${i}]`,0===i.length)return Promise.resolve();const a=i.map((e=>(0,o.hexToUint8Array)(e).buffer)),c=yield m(a);yield(0,s.addMissingKeys)(a,c.map((e=>e.getDeviceId())))}))).apply(this,arguments)}function m(){return y.apply(this,arguments)}function y(){return(y=(0,i.default)((function*(e){const t=yield(0,c.getPeerDevices)();return yield(0,d.sendAppStateSyncKeyRequest)(e,t),t}))).apply(this,arguments)}function E(){return(E=(0,i.default)((function*(){const e=yield l.default.getAllMissingKeys();__LOG__(2)`syncd: requestAllMissingKeys: missing keys: [${e.map((e=>e.keyHex))}]`,0!==e.length&&(yield m(e.map((e=>e.keyId))))}))).apply(this,arguments)}},837:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.clearSyncKeysCache=function(){m=new Map},t.getActiveKey=function(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return y.enqueue((()=>E(e)))},t.getKeyData=function(){return b.apply(this,arguments)},t.getNewestKeyPair=v;var i=r(n(48926)),a=r(n(22762)),o=r(n(63105)),s=r(n(6162)),l=n(15688),c=n(27870),d=n(63109),u=r(n(73407)),p=n(9108),f=n(4573),h=r(n(11339)),_=n(26442),g=n(13722);let m=new Map;const y=new c.PromiseQueue;function E(){return S.apply(this,arguments)}function S(){return(S=(0,i.default)((function*(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=yield v(),n=yield(0,p.getMyDeviceList)();const{currentIndex:r,devices:i,rawId:a}=n;if(null==r)throw new Error("syncd: missing current index for own device");n={currentIndex:r,deviceIndexes:i.map((e=>e.keyIndex)),rawId:a};const o=(0,g.hasKeyExpired)(t),s=(0,g.hasADeviceBeenRemoved)(t,n);return e&&(o||s)?(t=(0,g.rotateKey)(t,n),__LOG__(2)`syncd: stored key rotation key id ${(0,d.arrayBufferToHex)(t.keyId.buffer)}`,yield u.default.createSyncKey(t),yield(0,_.sendAppStateSyncKeyShare)({type:"key_rotation",keys:[t]}),o&&(__LOG__(2)`syncd: key rotation due to key expiry`,new h.default.MdAppStateKeyRotation({mdAppStateKeyRotationReason:h.default.MD_APP_STATE_KEY_ROTATION_REASON_CODE.APP_STATE_SYNC_KEY_EXPIRY}).commit()),s&&(__LOG__(2)`syncd: key rotation due to device removal`,new h.default.MdAppStateKeyRotation({mdAppStateKeyRotationReason:h.default.MD_APP_STATE_KEY_ROTATION_REASON_CODE.DEVICE_DEREGISTERATION}).commit()),E(e)):{keyId:t.keyId.buffer,keyData:t.keyData}}))).apply(this,arguments)}function v(){return T.apply(this,arguments)}function T(){return(T=(0,i.default)((function*(){const e=yield u.default.getAllSyncKeys(),t=(0,s.default)(e.map((e=>(0,f.getKeyEpoch)(e.keyId.buffer)))),n=(0,o.default)(e,(e=>(0,f.getKeyEpoch)(e.keyId.buffer)===t));return(0,a.default)(n,(e=>(0,f.getKeyDeviceId)(e.keyId.buffer)))}))).apply(this,arguments)}function b(){return(b=(0,i.default)((function*(e){var t;let n=m.get((0,l.encodeB64)(e));return n?n.keyData:(n=yield u.default.getSyncKeyData(new Uint8Array(e)),n&&m.set((0,l.encodeB64)(e),n),null===(t=n)||void 0===t?void 0:t.keyData)}))).apply(this,arguments)}},4573:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getKeyDeviceId=function(e){return new DataView(e).getUint16(0)},t.getKeyEpoch=function(e){return new DataView(e).getUint32(2)},t.getPeerDevices=function(){return l.apply(this,arguments)};var i=r(n(48926)),a=n(45454),o=n(9108),s=n(99234);function l(){return(l=(0,i.default)((function*(){const e=[],t=(0,s.assertGetMe)();try{const n=yield(0,o.getMyDeviceList)();n.devices.forEach((r=>{r.id!==t.getDeviceId()&&e.push((0,a.createDeviceWidFromUserAndDevice)(n.id,r.id))}))}catch(e){return __LOG__(3,void 0,void 0,!0)`syncd: getPeerDevices: error ${e}. Future key requests will only be sent to primary device.`,SEND_LOGS(e.toString()),[(0,a.createDeviceWidFromUserAndDevice)(t.user,0)]}return e}))).apply(this,arguments)}},65031:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendAppStateSyncKeyRequest=function(){return f.apply(this,arguments)};var i=r(n(48926)),a=n(63109),o=r(n(65212)),s=n(52407),l=n(58597),c=n(99234),d=r(n(11339)),u=n(17304),p=n(238);function f(){return(f=(0,i.default)((function*(e,t){const n={keyIds:e.map((e=>({keyId:e})))},r=t.map((e=>{const t=new o.default({fromMe:!0,remote:(0,c.assertGetMeUser)(),id:o.default.newId()});return new u.Msg({id:t,to:e,type:"protocol",subtype:"app_state_sync_key_request",appStateSyncKeyRequest:n})})),i=t.map((e=>e.getDeviceId())),f=e.map((e=>(0,a.arrayBufferToHex)(e)));__LOG__(2)`syncd: send key request key id ${f} to peer deviceIds ${i}`,yield(0,p.storePeerMessages)(r),yield Promise.all(r.map(s.encryptAndSendKeyMsg)),(0,l.logCriticalBootstrapStageIfNecessary)(d.default.BOOTSTRAP_APP_STATE_DATA_STAGE_CODE.MISSING_KEYS_REQUESTED)}))).apply(this,arguments)}},26442:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendAppStateSyncKeyShare=function(){return p.apply(this,arguments)};var i=r(n(48926)),a=n(63109),o=r(n(65212)),s=n(52407),l=n(99234),c=n(4573),d=n(17304),u=n(238);function p(){return(p=(0,i.default)((function*(e){let t,n;if("key_rotation"===e.type?(t=f(e.keys),n=yield(0,c.getPeerDevices)()):"missing_key"===e.type&&(t=f(e.keys,e.orphanKeys),n=[e.peerDeviceId]),null==n)return Promise.resolve();const r=n,i=r.map((e=>{const n=new o.default({fromMe:!0,remote:(0,l.assertGetMeUser)(),id:o.default.newId()});return new d.Msg({id:n,to:e,type:"protocol",subtype:"app_state_sync_key_share",appStateSyncKeyShare:t})})),p=r.map((e=>e.getDeviceId())),h=e.keys.map((e=>(0,a.arrayBufferToHex)(e.keyId.buffer)));__LOG__(2)`syncd: send key share key id ${h} to peer deviceIds ${p} due to ${e.type}`,yield(0,u.storePeerMessages)(i),yield Promise.all(i.map(s.encryptAndSendKeyMsg))}))).apply(this,arguments)}function f(e,t){let n=e.map((e=>({keyId:{keyId:e.keyId.buffer},keyData:{keyData:e.keyData,fingerprint:{rawId:e.fingerprint.rawId,currentIndex:e.fingerprint.currentIndex,deviceIndexes:e.fingerprint.deviceIndexes},timestamp:e.timestamp}})));if(t){const e=t.map((e=>({keyId:{keyId:e},keyData:void 0})));n=n.concat(e)}return{keys:n}}},93932:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addMissingKeys=function(){return b.apply(this,arguments)},t.setMissingKeyTimeout=m,t.updateMissingKeyDevices=function(){return g.apply(this,arguments)},t.updateMissingKeys=function(e,t){const n=t.getDeviceId(),r=[],a=[];return e.forEach((e=>{const t=e.keyData,n=(0,s.arrayBufferToHex)(e.keyId);t?r.push(n):a.push(n)})),__LOG__(2)`syncd: updateMissingKeys from device ${n}
\tkeys with keyData: ${r}
\tkeys without keyData: ${a}`,(0,h.getStorage)().lock(["missing-keys"],function(){var e=(0,i.default)((function*(){if(r.length>0&&(yield c.default.bulkRemoveMissingKeys(r),yield m()),a.length>0){const e=(yield c.default.bulkGetMissingKeys(a)).filter(Boolean);e.forEach((e=>e.deviceResponses.set(n,!1))),__LOG__(2)`syncd: updateMissingKeys: begin updating missing keys from device ${n}
\tmissingKeys: [${a}]`,yield c.default.createOrUpdateMissingKeys(e),__LOG__(2)`syncd: updateMissingKeys: finish updating missing keys from device ${n}`,yield v()}}));return function(){return e.apply(this,arguments)}}())};var i=r(n(48926)),a=r(n(22762)),o=n(52613),s=n(63109),l=n(92844),c=r(n(73407)),d=n(68254),u=n(4573),p=r(n(11339)),f=n(64551),h=n(99069);let _;function g(){return(g=(0,i.default)((function*(){const e=(yield(0,u.getPeerDevices)()).map((e=>e.getDeviceId()));return(0,h.getStorage)().lock(["missing-keys"],function(){var t=(0,i.default)((function*(){const t=yield c.default.getAllMissingKeys();if(0===t.length)return Promise.resolve();t.forEach((t=>{t.deviceResponses.forEach(((n,r)=>{e.includes(r)||t.deviceResponses.delete(r)}))})),yield c.default.createOrUpdateMissingKeys(t),yield v()}));return function(){return t.apply(this,arguments)}}())}))).apply(this,arguments)}function m(){return y.apply(this,arguments)}function y(){return(y=(0,i.default)((function*(){clearTimeout(_),_=null;const e=yield c.default.getAllMissingKeys();if(0===e.length)return;__LOG__(2)`syncd: _setMissingKeyTimeout: missing keys: ${e.map((e=>(0,s.arrayBufferToHex)(e.keyId)))}`;const t=(0,a.default)(e,(e=>e.timestamp)),n=f.ServerProps.syncdWaitForKeyTimeoutDays*l.DAY_MILLISECONDS-(-t.timestamp+(0,l.unixTimeMs)());__LOG__(2)`syncd: earliest missing key: ${(0,s.arrayBufferToHex)(t.keyId)}, timestamp=${t.timestamp}, timeoutMs=${n}`,_=setTimeout(E,n)}))).apply(this,arguments)}function E(){return S.apply(this,arguments)}function S(){return(S=(0,i.default)((function*(){0!==(yield c.default.getAllMissingKeys()).length&&(new p.default.MdFatalError({mdFatalErrorCode:p.default.MD_SYNCD_FATAL_ERROR_CODE.TIMEOUT_WHILE_WAITING_FOR_MISSING_KEY}).commit(!0),__LOG__(4,void 0,new Error,!0)`syncd: fatal error: timeout while waiting for missing key`,SEND_LOGS("syncd fatal error: timeout while waiting for missing key"),(0,d.handleFatalError)())}))).apply(this,arguments)}function v(){return T.apply(this,arguments)}function T(){return(T=(0,i.default)((function*(){const e=yield c.default.getAllMissingKeys();for(const t of e){let e=!0;for(const n of t.deviceResponses.values())if(null==n){e=!1;break}if(e)return __LOG__(4,void 0,new Error,!0)`syncd: fatal error: missing key on all clients`,SEND_LOGS("syncd: fatal error: missing key on all clients"),new p.default.MdFatalError({mdFatalErrorCode:p.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_KEY_ON_ALL_CLIENTS}).commit(!0),yield(0,o.asyncSleep)(5e3),void(0,d.handleFatalError)()}}))).apply(this,arguments)}function b(){return(b=(0,i.default)((function*(e,t){const n=()=>{const e=new Map;return t.forEach((t=>e.set(t,null))),e},r=e.map((e=>({keyHex:(0,s.arrayBufferToHex)(e),keyId:e,timestamp:(0,l.unixTimeMs)(),deviceResponses:n()})));yield c.default.createOrUpdateMissingKeys(r),yield m()}))).apply(this,arguments)}},13722:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.hasADeviceBeenRemoved=function(e,t){const n=e.fingerprint,{rawId:r,currentIndex:a,deviceIndexes:o}=t,s=new Set(n.deviceIndexes);for(let e=n.currentIndex+1;e<=a;e++)s.add(e);return n.rawId!==r||!(0,i.default)(s,new Set(o))},t.hasKeyExpired=function(e){const t=e.timestamp,n=Math.min(90,Math.max(1,d.ServerProps.syncdKeyMaxUseDays));return(0,s.unixTimeMs)()-t>n*s.DAY_MILLISECONDS},t.rotateKey=function(e,t){const{keyId:n,keyEpoch:r}=function(e){const t=(0,c.getKeyEpoch)(e.keyId.buffer)+1,n=(0,l.assertGetMe)().getDeviceId();return{keyId:new Uint8Array((0,a.concatArrayBuffers)((0,o.intToBytes)(2,n).buffer,(0,o.intToBytes)(4,t).buffer)),keyEpoch:t}}(e),i=self.crypto.getRandomValues(new Uint8Array(32)).buffer,d=function(e){const{currentIndex:t,deviceIndexes:n,rawId:r}=e;return{rawId:r,currentIndex:t,deviceIndexes:n}}(t),u=(0,s.unixTimeMs)();return{keyId:n,keyEpoch:r,keyData:i,fingerprint:d,timestamp:u}};var i=r(n(18446)),a=n(32428),o=n(51239),s=n(92844),l=n(99234),c=n(4573),d=n(64551)},28900:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t._generateMutationsToUpload=G,t.buildSyncIqNode=function(){return A.apply(this,arguments)};var i=r(n(48926)),a=r(n(89734)),o=n(15688),s=n(7589),l=n(50073),c=n(31914),d=n(1377),u=n(18309),p=n(45606),f=r(n(73407)),h=n(81122),_=n(66622),g=n(99234),m=r(n(52991)),y=n(837),E=n(4573),S=n(84527),v=n(2622),T=n(64551),b=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=C(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(78375));function C(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(C=function(e){return e?n:t})(e)}function A(){return(A=(0,i.default)((function*(e){const{collectionNodes:t,collectionWithEncryptedMutations:n,localCollectionVersions:r,collectionsToSkip:i}=yield P(e);return{syncIqNode:(0,c.wap)("iq",{to:c.S_WHATSAPP_NET,xmlns:"w:sync:app:state",type:"set",id:(0,c.generateId)()},(0,c.wap)("sync",null,t)),collectionWithEncryptedMutations:n,localCollectionVersions:r,collectionsToSkip:i}}))).apply(this,arguments)}function P(){return M.apply(this,arguments)}function M(){return(M=(0,i.default)((function*(e){__LOG__(2)`syncd: start _buildCollectionNodes`;const t=[],n=function(){var e=(0,i.default)((function*(e,n){const r=yield f.default.getCollectionVersion(e);let i,a;if(null!=n&&n.length>0)if(null==r)__LOG__(2)`syncd: skipping ${e} in sync iq patch because initial full sync
is incomplete`,t.push(e);else{const{patchNode:t,encryptedMutations:r}=yield O(e,n);i=t,a=r}return{collection:e,version:r,patchNode:i,encryptedMutations:a}}));return function(){return e.apply(this,arguments)}}(),r=new Map,a=new Map,o=[];e.forEach(((e,t)=>o.push(n(t,e))));const s=(yield Promise.all(o)).map((e=>{const{collection:t,version:n,patchNode:i,encryptedMutations:o}=e;return o&&a.set(t,o),r.set(t,n),(0,c.wap)("collection",{name:(0,c.CUSTOM_STRING)(t),version:(0,c.INT)(null!=n?n:p.DEFAULT_COLLECTION_VERSION),return_snapshot:void 0===n?"true":"false"},i)}));return __LOG__(2)`syncd: end _buildCollectionNodes`,{collectionNodes:s,collectionWithEncryptedMutations:a,localCollectionVersions:r,collectionsToSkip:t}}))).apply(this,arguments)}function O(){return I.apply(this,arguments)}function I(){return(I=(0,i.default)((function*(e,t){const n=yield(0,y.getActiveKey)(!w(t)),r=(yield G(e,t,n)).map((e=>(0,_.encryptMutation)(e,n))),a=yield Promise.all(r),o=a.map((e=>({indexMac:e.indexMac,valueMac:e.valueMac,operation:e.operation}))),s=yield(0,d.computeLtHash)(e,o),{snapshotMac:l,patchMac:u}=yield(0,d.computeOutgoingSnapshotAndPatchMacs)(e,s,a,n.keyData),p=a.map((e=>U(e.keyId,e.operation,e.indexMac,e.indexAndValueCipherText))),f=k(p),h=function(){var e=(0,i.default)((function*(){const e=yield(0,S.uploadExternalPatch)(f);return L(yield R(e,f),n.keyId,l,u)}));return function(){return e.apply(this,arguments)}}();let g;(0,S.exceedInlineMutationCount)(p)?g=yield h():(g=N(p,n.keyId,l,u),(0,S.exceedPatchProtobufSize)(g)&&(g=yield h()));return{patchNode:(0,c.wap)("patch",null,g),encryptedMutations:a}}))).apply(this,arguments)}function w(e){return m.default.isLogoutInProgress&&e.some((e=>JSON.parse(e.index)[0]===p.Actions.Sentinel))}function R(){return D.apply(this,arguments)}function D(){return(D=(0,i.default)((function*(e,t){const{mediaKey:n,directPath:r,encFilehash:i,handle:a}=e;if(!a)throw new Error("Missing handle after uploading external patch to mms4");const s=yield(0,u.calculateFilehash)(t);return{mediaKey:(0,o.decodeB64)(n),directPath:r,handle:a,fileSizeBytes:t.byteLength,fileSha256:(0,o.decodeB64)(s),fileEncSha256:(0,o.decodeB64)(i)}}))).apply(this,arguments)}function L(e,t,n,r){const i=T.ServerProps.syncdPatchDeviceIndexIncluded?(0,g.assertGetMe)().getDeviceId():void 0;return(0,h.encodeSyncdPatch)({keyId:{id:t},externalMutations:e,snapshotMac:n,patchMac:r,deviceIndex:i})}function N(e,t,n,r){const i=T.ServerProps.syncdPatchDeviceIndexIncluded?(0,g.assertGetMe)().getDeviceId():void 0;return(0,h.encodeSyncdPatch)({keyId:{id:t},mutations:e,snapshotMac:n,patchMac:r,deviceIndex:i})}function k(e){return(0,h.encodeSyncdMutations)({mutations:e})}function U(e,t,n,r){return{operation:t,record:{keyId:{id:e},index:{blob:n},value:{blob:r}}}}function G(){return x.apply(this,arguments)}function x(){return(x=(0,i.default)((function*(e,t,n){const r=yield f.default.getSyncActionsRows(["collection"],[e]);let i=t;const a=B(e,r,t,n.keyId);i=i.concat(a);const o=F(r,i,n.keyId);return b.addKeyRotationRemoveCount(o.length),i=i.concat(o),i}))).apply(this,arguments)}function B(e,t,n,r){let i=t.filter((e=>!n.map((e=>e.index)).includes(e.index)&&!(0,s.areBuffersEqual)(e.keyId,r)));i=(0,a.default)(i,(e=>(0,E.getKeyEpoch)(e.keyId)));const o=Math.min(5,Math.max(1,T.ServerProps.syncdAdditionalMutations));return i=i.slice(0,o),(0,v.syncActionsToPendingMutations)(i,l.SyncdMutationSyncdOperation.SET)}function F(e,t,n){const r=t.map((e=>e.index)),i=e.filter((e=>r.includes(e.index))).filter((e=>!(0,s.areBuffersEqual)(e.keyId,n)));return(0,v.syncActionsToPendingMutations)(i,l.SyncdMutationSyncdOperation.REMOVE)}},81122:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.encodeSyncActionData=function(e){try{return(0,o.encodeProtobuf)(a.SyncActionDataSpec,e).readBuffer()}catch(e){throw new s.default.MdFatalError({mdFatalErrorCode:s.default.MD_SYNCD_FATAL_ERROR_CODE.ACTION_DATA_PROTOBUF_SERIALIZATION_FAILED}).commit(!0),new l.SyncdFatalError("action data protobuf serialization failed")}},t.encodeSyncdMutations=function(e){try{return(0,o.encodeProtobuf)(i.SyncdMutationsSpec,e).readBuffer()}catch(e){throw new s.default.MdFatalError({mdFatalErrorCode:s.default.MD_SYNCD_FATAL_ERROR_CODE.MUTATIONS_PROTOBUF_SERIALIZATION_FAILED}).commit(!0),new l.SyncdFatalError("mutations protobuf serialization failed")}},t.encodeSyncdPatch=function(e){try{return(0,o.encodeProtobuf)(i.SyncdPatchSpec,e).readBuffer()}catch(e){throw new s.default.MdFatalError({mdFatalErrorCode:s.default.MD_SYNCD_FATAL_ERROR_CODE.PATCH_PROTOBUF_SERIALIZATION_FAILED}).commit(!0),new l.SyncdFatalError("patch protobuf serialization failed")}};var i=n(50073),a=n(381),o=n(60980),s=r(n(11339)),l=n(85156)},66622:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.encryptMutation=function(){return y.apply(this,arguments)};var i=r(n(81109)),a=r(n(48926)),o=n(76100),s=n(50073),l=n(381),c=n(62109),d=n(32458),u=n(63109),p=n(84902),f=r(n(73407)),h=n(81122),_=n(837),g=r(n(11339)),m=n(85156);function y(){return(y=(0,a.default)((function*(e,t){const{index:n,operation:r}=e;let a=t.keyId,o=t.keyData;switch(r){case s.SyncdMutationSyncdOperation.SET:break;case s.SyncdMutationSyncdOperation.REMOVE:const e=yield f.default.getSyncAction(n);if(!e)throw new m.SyncdFatalError("no corresponding set mutation");const t=e.keyId;a=t,o=yield(0,_.getKeyData)(t)}const{indexMac:l,indexAndValueCipherText:d}=yield E(e,a,o),u=(0,c.valueMacFromIndexAndValueCipherText)(d);return(0,i.default)((0,i.default)({},e),{},{keyId:a,keyData:o,indexMac:l,indexAndValueCipherText:d,valueMac:u})}))).apply(this,arguments)}function E(){return S.apply(this,arguments)}function S(){return(S=(0,a.default)((function*(e,t,n){try{const{index:r,binarySyncAction:i,operation:a,version:s}=e,l=(0,o.stringToArrayBuffer)(r),p=yield(0,c.generateEncryptionKeys)(n),{indexKey:f,valueEncryptionKey:h,valueMacKey:_}=p,g=yield self.crypto.getRandomValues(new Uint8Array(d.IV_LENGTH)),m=v(l,i,(0,c.generatePadding)(l.byteLength,i.byteLength),s),y=yield(0,c.generateCipherText)(g,h,m),E=(0,c.generateAssociatedData)(a,t),S=yield(0,c.generateMac)(E,y,_),T=(0,u.combine)([y,S]);return{indexMac:yield(0,c.generateIndexMac)(f,l),indexAndValueCipherText:T}}catch(e){throw new g.default.MdFatalError({mdFatalErrorCode:g.default.MD_SYNCD_FATAL_ERROR_CODE.ENCRYPTION_FAILED}).commit(!0),new m.SyncdFatalError("encryption failure")}}))).apply(this,arguments)}function v(e,t,n,r){return(0,h.encodeSyncActionData)({index:e,value:(0,p.decodeProtobuf)(l.SyncActionValueSpec,t),padding:n,version:r})}},84527:(e,t,n)=>{"use strict";var r=n(59182).default,i=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.exceedInlineMutationCount=function(e){const t=Math.min(2e3,Math.max(o.ServerProps.syncdInlineMutationsMaxCount,100));return e.length>t},t.exceedPatchProtobufSize=function(e){const t=1e3*Math.min(100,Math.max(o.ServerProps.syncdPatchProtobufMaxSize,10));return e.byteLength>t},t.uploadExternalPatch=function(e){return s.default.encryptAndUpload({blob:e,signal:(new r).signal,type:"md-app-state",uploadOrigin:a.default.UPLOAD_ORIGIN_TYPE.UNKNOWN,userUploadAttemptCount:0,forwardedFromWeb:!1,isViewOnce:!1})};var a=i(n(11339)),o=n(64551),s=i(n(54824))},34089:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return l.apply(this,arguments)};var i=r(n(48926)),a=n(28900),o=r(n(73407)),s=n(83853);function l(){return(l=(0,i.default)((function*(e){const t=new Map,n=new Map;yield Promise.all(e.map(function(){var e=(0,i.default)((function*(e){const r=yield o.default.getPendingMutationsRows(["collection"],e),i=r.map((e=>e.id)).filter(Boolean);n.set(e,i);const a=(0,s.compactPatch)(r);t.set(e,a)}));return function(){return e.apply(this,arguments)}}()));const r=yield(0,a.buildSyncIqNode)(t);return{syncIqNode:r.syncIqNode,collectionWithPendingMutationsIds:n,collectionWithEncryptedMutations:r.collectionWithEncryptedMutations,localCollectionVersions:r.localCollectionVersions,collectionsToSkip:r.collectionsToSkip}}))).apply(this,arguments)}},2622:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.syncActionsToPendingMutations=function(e,t){return e.map((e=>{let n=e.binarySyncAction;if(!n){const t=(0,i.decodeProtobuf)(r.SyncActionDataSpec,e.binarySyncData).value;n=(0,a.encodeProtobuf)(r.SyncActionValueSpec,t).readBuffer()}return{collection:e.collection,index:e.index,binarySyncAction:n,operation:t,version:e.version,timestamp:e.timestamp,action:e.action}}))};var r=n(381),i=n(84902),a=n(60980)},83853:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.compactPatch=function(e){return(0,i.default)(e.reverse(),(e=>e.index)).reverse()};var i=r(n(45578))},61107:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.syncResponseParser=void 0;var i=n(71914),a=n(45606),o=n(13815),s=r(n(11339)),l=n(85156);const c=new i.WapParser("syncResponseParser",(e=>{__LOG__(2)`syncd: start parsing syncd collections`;const t=[];return e.child("sync").mapChildrenWithTag("collection",(e=>{const n={},r=a.CollectionName.cast(e.attrString("name"));if(!r)throw new l.SyncdFatalError("invalid collection name");n.name=r,n.state=function(e,t){if(!e.hasAttr("type")||"error"!==e.attrString("type"))return e.hasAttr("has_more_patches")?(__LOG__(2)`syncd: collection ${t} got server code has_mode_patches`,a.CollectionState.SuccessHasMore):(__LOG__(2)`syncd: collection ${t} did not get server error`,a.CollectionState.Success);{const n=e.child("error"),r=n.attrString("code"),i=n.attrString("text");switch(__LOG__(2)`syncd: collection ${t} got server error: ${r}`,r){case"409":return e.hasAttr("has_more_patches")?a.CollectionState.ConflictHasMore:a.CollectionState.Conflict;case"400":return new s.default.MdFatalError({mdFatalErrorCode:s.default.MD_SYNCD_FATAL_ERROR_CODE.XMPP_BAD_REQUEST_FOR_COLLECTION}).commit(!0),__LOG__(4,void 0,new Error,!0)`syncd: fatal error: collection ${String(t)} throws ${i}`,SEND_LOGS(`syncd: fatal error: collection ${String(t)} throws ${i}`),a.CollectionState.ErrorFatal;case"404":return new s.default.MdFatalError({mdFatalErrorCode:s.default.MD_SYNCD_FATAL_ERROR_CODE.XMPP_NOT_FOUND_FOR_COLLECTION}).commit(!0),__LOG__(4,void 0,new Error,!0)`syncd: fatal error: collection ${String(t)} throws ${i}`,SEND_LOGS(`syncd: fatal error: collection ${String(t)} throws ${i}`),a.CollectionState.ErrorFatal;default:return __LOG__(3,void 0,void 0,!0)`syncd: retryable error: collection ${String(t)} throws ${i}`,SEND_LOGS(`syncd: retryable error: collection ${String(t)} throws ${i}`),a.CollectionState.ErrorRetry}}}(e,n.name),e.hasAttr("version")&&(n.version=parseInt(e.attrString("version"),10)),e.hasChild("patches")&&(n.patches=e.child("patches").mapChildrenWithTag("patch",(e=>(0,o.decodeSyncdPatch)(r,e.contentBytes())))),e.hasChild("snapshot")&&(n.snapshot=(0,o.decodeExternalBlobReference)(r,e.child("snapshot").contentBytes())),t.push(n),null==n.version&&null==n.patches&&null==n.snapshot&&__LOG__(2)`syncd: collection ${r} has no version, patches or snapshot`,__LOG__(2)`syncd: successfully parsed collection ${r}`})),t}));t.syncResponseParser=c},23026:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.serverSync=function(){return g.apply(this,arguments)};var i=r(n(48926)),a=n(29938),o=n(24747),s=n(45606),l=n(58597),c=r(n(73407)),d=r(n(11339)),u=r(n(34089)),p=n(61107),f=n(85156),h=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=_(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(78375));function _(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(_=function(e){return e?n:t})(e)}function g(){return(g=(0,i.default)((function*(e){let t=[],n=[...e],r=0;for(;(r<5||n.length>0&&r<500)&&0!==n.length;){const{doneCollections:e,refetchCollections:i}=yield m(n);n=i,t=t.concat(e),r++}return n.length>0&&(__LOG__(4,void 0,new Error,!0,["syncd"])`syncd: reached max iterations for collections: ${n}`,SEND_LOGS("syncd: max iteration"),t=t.concat(n.map((e=>({state:s.CollectionState.ErrorRetry,name:e}))))),t}))).apply(this,arguments)}function m(){return y.apply(this,arguments)}function y(){return(y=(0,i.default)((function*(e){if(0===e.length)return{doneCollections:[],refetchCollections:[]};try{const{collectionDetails:t,localCollectionVersions:n,collectionsToUpload:r}=yield E(e);r.length>0&&__LOG__(2)`syncd: deferred local mutation upload for ${r}`,__LOG__(2)`syncd: local collection versions:`,n.forEach(((e,t)=>{__LOG__(2)`\n\t${t} v${null!=e?e:"(undefined)}"}`}));const o=[],l=[];t.forEach((e=>{switch(e.state){case s.CollectionState.ErrorRetry:case s.CollectionState.ErrorFatal:case s.CollectionState.Blocked:return void l.push(e);default:o.push(e)}e.state!==s.CollectionState.Conflict&&e.state!==s.CollectionState.ConflictHasMore||h.incConflict()})),__LOG__(2)`syncd: start apply collections: ${o.map((e=>e.name))}`;const d=yield Promise.all(o.map((e=>(0,a.applyAppStateSyncResponse)(e,n.get(e.name)))));__LOG__(2)`syncd: end apply collections: ${o.map((e=>e.name))}`;const u=[];return yield Promise.all(d.map(function(){var e=(0,i.default)((function*(e){if(e.state===s.CollectionState.Conflict){(yield c.default.hasPendingMutationForCollection(e.name))?u.push(e.name):(e.state=s.CollectionState.Success,l.push(e))}else e.state===s.CollectionState.ConflictHasMore||e.state===s.CollectionState.SuccessHasMore||e.state===s.CollectionState.Success&&r.some((t=>t===e.name))?u.push(e.name):l.push(e)}));return function(){return e.apply(this,arguments)}}())),{doneCollections:l,refetchCollections:u}}catch(t){if(t instanceof f.SyncdFatalError){__LOG__(4,void 0,new Error,!0)`syncd: fatal error: syncd global throws ${t.message}`,SEND_LOGS(`syncd: fatal error: syncd global throws ${t.message}`);return{doneCollections:e.map((e=>({state:s.CollectionState.ErrorFatal,name:e}))),refetchCollections:[]}}__LOG__(3,void 0,void 0,!0)`syncd: retryable error: syncd global throws ${t.message}`,SEND_LOGS(`syncd: retryable error: syncd global throws ${t.message}`);return{doneCollections:e.map((e=>({state:s.CollectionState.ErrorRetry,name:e,serverBackoff:t.errorBackoff}))),refetchCollections:[]}}}))).apply(this,arguments)}function E(){return S.apply(this,arguments)}function S(){return(S=(0,i.default)((function*(e){const{syncIqNode:t,collectionWithPendingMutationsIds:n,collectionWithEncryptedMutations:r,localCollectionVersions:i,collectionsToSkip:a}=yield(0,u.default)(e);(0,l.logCriticalBootstrapStageIfNecessary)(d.default.BOOTSTRAP_APP_STATE_DATA_STAGE_CODE.REQUEST_BUILT),__LOG__(2)`syncd: sending sync request for collections: ${e.map((e=>{var t,r,a;return`\n\t${e} v${null!==(t=i.get(e))&&void 0!==t?t:"(undefined)"} ${(null!==(r=null===(a=n.get(e))||void 0===a?void 0:a.length)&&void 0!==r?r:0)>0&&null!=i.get(e)?" with local changes":""}`}))}`;const s=yield(0,o.sendIq)(t,p.syncResponseParser);if(__LOG__(2)`syncd: completed network operation for collections: ${e}`,(0,l.logCriticalBootstrapStageIfNecessary)(d.default.BOOTSTRAP_APP_STATE_DATA_STAGE_CODE.RESPONSE_RECEIVED),s.success){(0,l.logCriticalBootstrapStageIfNecessary)(d.default.BOOTSTRAP_APP_STATE_DATA_STAGE_CODE.RESPONSE_PARSED_VALID);const e=s.result;return __LOG__(2)`syncd: received sync response for collections: ${e.map((e=>{let t=`\n${e.name}`;return null!=e.version&&(t+=`\n\tupdated to version ${e.version}`),null!=e.snapshot&&(t+="\n\tcontains snapshot"),null!=e.patches&&(t+=`\n\tcontains ${e.patches.length} patches`),t}))}`,e.forEach((e=>{const t=n.get(e.name);t&&(e.syncedPendingMutationsId=t);const i=r.get(e.name);i&&(e.syncedEncryptedMutations=i)})),{collectionDetails:e,localCollectionVersions:i,collectionsToUpload:a}}const{errorCode:c,errorText:f,errorBackoff:h}=s;throw v(c,f,h)}))).apply(this,arguments)}function v(e,t,n){switch(e){case 400:return new d.default.MdFatalError({mdFatalErrorCode:d.default.MD_SYNCD_FATAL_ERROR_CODE.XMPP_BAD_REQUEST_GLOBAL_ERROR}).commit(!0),new f.SyncdFatalError(t);case 404:return new d.default.MdFatalError({mdFatalErrorCode:d.default.MD_SYNCD_FATAL_ERROR_CODE.XMPP_NOT_FOUND_GLOBAL_ERROR}).commit(!0),new f.SyncdFatalError(t);case 405:return new d.default.MdFatalError({mdFatalErrorCode:d.default.MD_SYNCD_FATAL_ERROR_CODE.XMPP_BAD_METHOD_GLOBAL_ERROR}).commit(!0),new f.SyncdFatalError(t);case 406:return new d.default.MdFatalError({mdFatalErrorCode:d.default.MD_SYNCD_FATAL_ERROR_CODE.XMPP_NOT_ACCEPTABLE_GLOBAL_ERROR}).commit(!0),new f.SyncdFatalError(t);default:return new f.SyncdRetryableError(t,n)}}},68254:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleFatalError=function(){return y.apply(this,arguments)},t.uploadFatalErrorMetric=function(){return E.apply(this,arguments)};var i=r(n(81109)),a=r(n(48926)),o=(n(45606),n(88102)),s=n(57849),l=n(65044),c=r(n(11339)),d=n(83578),u=n(93824),p=n(13983),f=n(89751),h=n(92844),_=n(52613),g=n(58052);const m=(0,h.unixTime)();function y(){return(y=(0,a.default)((function*(e){__LOG__(2)`syncd: starting fatal flow for ${e}`;const t=(0,s.getABPropConfigValue)("should_deregister_on_syncd_fatal"),r=n(95023).default;let i=[];null!=e&&(i=e.map((e=>String(e)))),yield(0,_.asyncSleep)(5e3),__LOG__(2)`syncd: start notifying primary on fatal error`;try{yield(0,p.sendAppStateFatalExceptionNotification)(i)}catch(e){__LOG__(4,void 0,new Error,!0)`syncd: error when sending fatal message to primary: ${e}`,SEND_LOGS("syncd: could not send fatal to primary")}__LOG__(2)`syncd: end notifying primary on fatal error`,!1!==t?(__LOG__(4,!0,new Error)`syncd: Received fatal error and logged out`,l.Socket.logout(!1,d.LogoutReason.SyncdFailure)):r.isSyncDCriticalDataSyncInProcess()?(__LOG__(4,!0,new Error,!0)`syncd: critical sync failed during bootstrap`,SEND_LOGS("syncd: critical sync failed during bootstrap"),l.Socket.logout(!1,d.LogoutReason.SyncdErrorDuringBootstrap)):(__LOG__(4,!0,new Error)`syncd: Received fatal error and showed fatal flag`,(0,f.updateSyncdDisabledDueToFatalFlag)(!0),o.Cmd.handleFatalError())}))).apply(this,arguments)}function E(){return(E=(0,a.default)((function*(e,t,r,a){const o=n(95023).default;let l={mdFatalErrorCode:e,collection:t?(0,u.collectionNameToMetric)(t):void 0,isBootstrap:o.isSyncDCriticalDataSyncInProcess()};if((null!=r||null!=a)&&(yield(0,s.getABPropConfigValue)("md_app_state_gate_D34336913"))){const e=(0,g.getPairingTimestamp)(),t=null!=e?1e3*((0,h.unixTime)()-e):void 0;l=(0,i.default)((0,i.default)({},l),{},{timeSinceRefreshMs:1e3*((0,h.unixTime)()-m),timeSincePairingMs:t,patchSnapshotMutationCount:r,patchVersion:a})}new c.default.MdFatalError(l).commit(!0)}))).apply(this,arguments)}},13983:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendAppStateFatalExceptionNotification=function(){return p.apply(this,arguments)};var i=r(n(48926)),a=n(92844),o=r(n(65212)),s=n(45454),l=n(52407),c=n(99234),d=n(17304),u=n(238);function p(){return(p=(0,i.default)((function*(e){const t={collectionNames:e,timestamp:(0,a.unixTimeMs)()},n=new o.default({fromMe:!0,remote:(0,c.getMeUser)(),id:o.default.newId()}),r=new d.Msg({id:n,to:(0,s.createDeviceWidFromUserAndDevice)((0,c.assertGetMe)().user,0),type:"protocol",subtype:"app_state_fatal_exception_notification",appStateFatalExceptionNotification:t});return yield(0,u.storePeerMessages)([r]),(0,l.encryptAndSendKeyMsg)(r)}))).apply(this,arguments)}},12600:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.applyAllOrphansAndUnsupported=function(){return g.apply(this,arguments)},t.checkOrphanChats=p,t.checkOrphanMessages=d,t.checkOrphanMutations=function(){return c.apply(this,arguments)};var i=r(n(48926)),a=n(29938),o=n(89751),s=n(45606),l=r(n(73407));function c(){return(c=(0,i.default)((function*(e,t){if((0,o.isSyncdDisabled)())return Promise.resolve();yield Promise.all([d(e),p(t)])}))).apply(this,arguments)}function d(){return u.apply(this,arguments)}function u(){return(u=(0,i.default)((function*(e){yield h(e,s.SyncModelType.Msg)}))).apply(this,arguments)}function p(){return f.apply(this,arguments)}function f(){return(f=(0,i.default)((function*(e){yield h(e,s.SyncModelType.Chat)}))).apply(this,arguments)}function h(){return _.apply(this,arguments)}function _(){return(_=(0,i.default)((function*(e,t){if((0,o.isSyncdDisabled)())return Promise.resolve();const n=yield l.default.getSyncActionsRows(["modelId","modelType","actionState"],e.map((e=>[e,t,s.SyncActionState.Orphan])));yield(0,a.applyIndividualMutations)(n)}))).apply(this,arguments)}function g(){return(g=(0,i.default)((function*(){if((0,o.isSyncdDisabled)())return Promise.resolve();__LOG__(2)`syncd: start applyAllOrphansAndUnsupported`;const e=yield l.default.getSyncActionsRows(["actionState"],[s.SyncActionState.Orphan,s.SyncActionState.Unsupported]);yield(0,a.applyIndividualMutations)(e),__LOG__(2)`syncd: end applyAllOrphansAndUnsupported`}))).apply(this,arguments)}},37933:(e,t,n)=>{"use strict";var r=n(95318);t.Z=function(){return c.apply(this,arguments)};var i=r(n(48926)),a=n(45606),o=r(n(73407)),s=r(n(40108)),l=n(38804);function c(){return(c=(0,i.default)((function*(){const e=yield s.default.getSentinelMutations();return yield o.default.appendPendingMutationsRows(e),(0,l.markCollectionsForSync)(Array.from(a.CollectionName.members()))}))).apply(this,arguments)}},38804:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.SYNCD_INTERNAL_TABLES_TO_LOCK=void 0,t.initialize=function(){if((0,s.isMDBackend)())return(0,y.isSyncdDisabled)()?Promise.resolve():(function(){const e=6e4,t=(0,o.default)((0,a.default)((function*(){const e=yield(0,S.getSyncActionsTable)().count();v.setStoredMutationCount(e);const t=yield(0,S.getSyncActionsTable)().equals(["actionState"],c.SyncActionState.Malformed);v.setInvalidActionCount(t.length);const n=yield(0,S.getSyncActionsTable)().equals(["actionState"],c.SyncActionState.Unsupported);v.setUnsupportedActionCount(n.length);const r=yield d.default.getMissingKeyCount();v.setMissingKeyCount(r)})),e,{maxWait:3*e});E.Cmd.on(E.APP_STATE_SYNC_COMPLETED,t)}(),G(),l.default.loadStatesFromDb().then((()=>Y())));return Promise.reject(new Error("This call is only supported in MD mode"))},t.lockForSync=function(e,t,n){const r=(0,f.getStorage)().lock([...e,...A],(e=>Promise.all([d.default.appendPendingMutationsRows(t),n(e)]))).then((()=>{L(t.map((e=>e.collection)))}));return Promise.resolve(r)},t.markCollectionsForSync=L,t.sanitizeActionInSyncActionsRow=G,t.syncBlockedCollections=function(){const e=l.default.getCollectionsInStateBlocked();return __LOG__(2)`syncd: sync blocked collections: ${e}`,l.default.moveCollectionsToDirty(e),I=new Set([...Array.from(I),...Array.from(O)]),__LOG__(2)`syncd: syncBlockedCollections:
\tmoving blocked collections to dirty: [${e}]
\tadding inflight collections to pending: [${Array.from(O)}]`,B()};var i=r(n(81109)),a=r(n(48926)),o=r(n(23279)),s=n(88555),l=r(n(11681)),c=n(45606),d=r(n(73407)),u=r(n(11339)),p=n(23026),f=n(99069),h=r(n(35609)),_=n(41796),g=n(12600),m=n(68254),y=n(89751),E=n(88102),S=n(76214),v=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=C(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(78375)),T=n(58052),b=n(58597);function C(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(C=function(e){return e?n:t})(e)}const A=["pending-mutations"];t.SYNCD_INTERNAL_TABLES_TO_LOCK=A;const P=36e5;let M,O=new Set,I=new Set,w=!1,R=0,D=0;if((0,_.isConnectedToPage)()){const e=n(8080).Stream,t=n(8080).StreamMode;(0,h.default)(e,"change:mode",(()=>e.mode===t.MAIN)).then((()=>{(0,s.isMDBackend)()&&!(0,y.isSyncdDisabled)()&&((0,g.applyAllOrphansAndUnsupported)(),__LOG__(2)`syncd: syncing pending mutations and blocked collections due to app resume`,function(){W.apply(this,arguments)}())}))}function L(){return N.apply(this,arguments)}function N(){return(N=(0,a.default)((function*(e,t){if((0,s.isMDBackend)()){const n=null!=t?yield k(e,t):e;return __LOG__(2)`syncd: marking for sync: ${n}`,n.forEach((e=>{const t=l.default.getCollectionState(e);__LOG__(2)`syncd: ${e} state before sync: ${t}`,t===c.CollectionSyncState.UpToDate?l.default.moveCollectionsToDirty([e]):t===c.CollectionSyncState.Dirty&&(I=new Set([...Array.from(I),e]))})),yield l.default.persistToDb(),B()}return Promise.reject(new Error("This call is only supported in MD mode"))}))).apply(this,arguments)}function k(){return U.apply(this,arguments)}function U(){return(U=(0,a.default)((function*(e,t){__LOG__(2)`syncd: start filter collections: ${e}`;const n=yield d.default.getCollectionVersions(e);return e.filter((e=>{const r=n.get(e);if(null==r)return __LOG__(2)`syncd: local version for ${e} missing; will mark for sync.`,!0;const i=t.get(e);return null==i?(__LOG__(2)`syncd: server version for ${e} missing; will mark for sync.`,!0):r<i?(__LOG__(2)`syncd: local version (${r}) for ${e} less than server version (${i}); will mark for sync.`,!0):(__LOG__(2)`syncd: local version (${r})for ${e} >= server version (${i}); will not mark for sync.`,!1)}))}))).apply(this,arguments)}function G(){return x.apply(this,arguments)}function x(){return(x=(0,a.default)((function*(){if(!(0,T.getMdSyncActionsActionSanitized)()){__LOG__(2)`syncd: sanitizing null 'action' property in sync-actions table`;const e=(yield(0,S.getSyncActionsTable)().all()).filter((e=>null==e.action)).map((e=>{const t=JSON.parse(e.index)[0];return c.Actions.cast(t)?(0,i.default)((0,i.default)({},e),{},{action:t}):(__LOG__(2)`syncd: invalid action ${t}`,(0,i.default)({},e))}));yield d.default.updateSyncActionRows(e),(0,T.setMdSyncActionsActionSanitized)(!0)}}))).apply(this,arguments)}function B(){return F.apply(this,arguments)}function F(){return(F=(0,a.default)((function*(){if((0,y.isSyncdDisabled)())return Promise.resolve();const e=l.default.getCollectionsInStateDirty();__LOG__(2)`syncd: dirty collections: ${e}`;const t=new Set(e.filter((e=>!O.has(e))));if(0===t.size)return __LOG__(2)`syncd: no collections to sync`,Promise.resolve();let n=[];try{O=new Set([...Array.from(O),...Array.from(t)]),__LOG__(2)`syncd: initiate server sync`,n=yield(0,p.serverSync)(Array.from(t)),__LOG__(2)`syncd: server sync successful`;const e=n.filter((e=>e.state===c.CollectionState.ErrorRetry));e.length>0&&(D=e[0].serverBackoff||0,R=0),K(n)}catch(e){l.default.moveCollectionsToFiniteRetry(Array.from(t))}finally{l.default.persistToDb(),O=new Set(Array.from(O).filter((e=>!t.has(e)))),Y(),E.Cmd.trigger(E.APP_STATE_SYNC_COMPLETED,n)}}))).apply(this,arguments)}function j(){if((0,y.isSyncdDisabled)())return;const e=new Set(l.default.getCollectionsInStateRetry());var t,n;0!==e.size&&(M=setTimeout((0,a.default)((function*(){try{w=!0,R+=1,__LOG__(2)`syncd: initiate server sync retry`;const t=yield(0,p.serverSync)(Array.from(e));__LOG__(2)`syncd: server sync retry successful`,K(t)}catch(t){l.default.moveCollectionsToFiniteRetry(Array.from(e))}finally{!function(){const e=l.default.getExpiredCollections();e.length>0&&(l.default.moveCollectionsToFatal(e),__LOG__(4,void 0,new Error,!0)`syncd: fatal error: expired collections`,SEND_LOGS("syncd: fatal error: expired collections"),new u.default.MdFatalError({mdFatalErrorCode:u.default.MD_SYNCD_FATAL_ERROR_CODE.TOO_MANY_INTERNAL_SERVER_ERRORS_IN_7D}).commit(!0))}(),l.default.persistToDb(),w=!1,Y()}})),(t=R,n=D,Math.min(Math.max(2**t*1e3,n),P))))}function Y(){if(__LOG__(2)`syncd: state machine tick`,l.default.getCollectionsInStateDirty().length>0&&(I=new Set(Array.from(I).filter((e=>O.has(e)))),B()),l.default.getCollectionsInStateRetry().length>0){if(w)return void __LOG__(2)`syncd: retry is in flight`;null!=M&&clearTimeout(M),j()}l.default.getCollectionsInStateFatal().length>0&&(0,m.handleFatalError)(l.default.getCollectionsInStateFatal())}function K(e){return e.forEach((e=>e.state!==c.CollectionState.Success||I.has(e.name)?e.state===c.CollectionState.ErrorRetry?((0,b.logCriticalBootstrapStageIfNecessary)(u.default.BOOTSTRAP_APP_STATE_DATA_STAGE_CODE.ENTERED_RETRY_MODE),l.default.moveCollectionsToFiniteRetry([e.name])):e.state===c.CollectionState.ErrorFatal?l.default.moveCollectionsToFatal([e.name]):e.state!==c.CollectionState.Blocked||I.has(e.name)?void 0:l.default.moveCollectionsToBlocked([e.name]):l.default.moveCollectionsToUpToDate([e.name])))}function W(){return(W=(0,a.default)((function*(){__LOG__(2)`syncd: syncPendingMutationsAndBlockedCollections`;const e=yield d.default.getAllPendingMutationsRows(),t=l.default.getCollectionsInStateBlocked();l.default.moveCollectionsToDirty(t);const n=e.map((e=>e.collection)).concat(t);n.length>0&&(__LOG__(2)`syncd: syncPendingMutationsAndBlockedCollections: [${n}]`,L(n))}))).apply(this,arguments)}},89751:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.isSyncdDisabled=function(){return"true"===(0,i.default)(a.default,"localStorage").getItem(o.KEYS.SYNCD_DISABLED_DUE_TO_FATAL)},t.updateSyncdDisabledDueToFatalFlag=function(e){(0,i.default)(a.default,"localStorage").setItem(o.KEYS.SYNCD_DISABLED_DUE_TO_FATAL,e.toString())};var i=r(n(45095)),a=r(n(4285)),o=n(72407)},85156:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SyncdRetryableError=t.SyncdMissingKeyError=t.SyncdFatalError=void 0;class n extends Error{constructor(){super(...arguments),this.name="SyncdMissingKeyError"}}t.SyncdMissingKeyError=n;class r extends Error{constructor(e,t){super(e),this.name="SyncdRetryableError",this.backoff=t,this.message=e}}t.SyncdRetryableError=r;class i extends Error{constructor(e){super(e),this.name="SyncdFatalError",this.message=e}}t.SyncdFatalError=i},93824:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.collectionNameToMetric=function(e){switch(e){case a.CollectionName.CriticalBlock:return o.default.COLLECTION.CRITICAL_BLOCK;case a.CollectionName.CriticalUnblockLow:return o.default.COLLECTION.CRITICAL_UNBLOCK_LOW;case a.CollectionName.Regular:return o.default.COLLECTION.REGULAR;case a.CollectionName.RegularHigh:return o.default.COLLECTION.REGULAR_HIGH;case a.CollectionName.RegularLow:return o.default.COLLECTION.REGULAR_LOW}},t.constructMsgKeySegments=c,t.constructMuteChatKey=function(e){return JSON.stringify([a.Actions.Mute,e.id.remote.toString({legacy:!0})])},t.constructPinChatKey=function(e){return JSON.stringify([a.Actions.Pin,e.id.remote.toString({legacy:!0})])},t.constructStarMsgKey=function(e){return JSON.stringify([a.Actions.Star,...c(e)])},t.constructStarMsgKeyFromMsgKey=function(e){return JSON.stringify([a.Actions.Star,...d(e)])},t.extractParticipantForSync=u,t.getMsgKeyFromStarActionIndex=function(e){const t=JSON.parse(e);if(t.length<5)throw new Error("[sync-action] star action index malformed, cannot create MsgKey");const n=(0,l.syncKeyToMsgKey)(t[1],t[2],t[3],t[4]);if(!n)throw __LOG__(3)`[sync-action] star action index data is malformed, , cannot create MsgKey`,new Error("[sync-action] star action index data is malformed, , cannot create MsgKey");return n},t.isBootstrap=function(e){return null==e},t.isCriticalCollection=function(e){switch(e){case a.CollectionName.CriticalBlock:case a.CollectionName.CriticalUnblockLow:return!0;case a.CollectionName.Regular:case a.CollectionName.RegularHigh:case a.CollectionName.RegularLow:return!1}},t.logKeysInfoInIntern=function(){return p.apply(this,arguments)},t.uploadCriticalEventMetric=function(e){new o.default.MdCriticalEvent({mdCriticalEventCode:e}).commit()};var i=r(n(48926)),a=(n(63109),n(45606)),o=r(n(11339)),s=n(76214),l=n(22954);function c(e){return d(e.id)}function d(e){const t=u(e);return[e.remote.toString({legacy:!0}),e.id,e.fromMe?"1":"0",t]}function u(e){let t="0";return!e.participant||e.remote.isUser()||e.fromMe||(t=e.participant.toString({legacy:!0})),t}function p(){return(p=(0,i.default)((function*(){(yield(0,s.getSyncKeysTable)().all()).forEach((()=>{}))}))).apply(this,arguments)}},1374:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.genCurrentSessionId=function(){return p.apply(this,arguments)},t.genSessionId=f;var i=r(n(48926)),a=n(8584),o=n(73045),s=r(n(45095)),l=n(53614),c=n(99234),d=r(n(76128)),u=n(93832);function p(){return(p=(0,i.default)((function*(){const e=(0,u.createSignalAddress)((0,c.getMeUser)()).toString(),t=(0,s.default)(yield d.default.loadIdentityKey(e),"yield PersistSignalProtocolStore.loadIdentityKey(primaryDeviceIdentifier)"),n=(0,l.toCurveKeyPubKey)((0,u.strToBuffer)(t)),r=(0,s.default)(yield d.default.getIdentityKeyPair(),"yield SignalProtocolStore.getIdentityKeyPair()");return f(n,(0,l.toCurveKeyPubKey)(r.pubKey))}))).apply(this,arguments)}function f(){return h.apply(this,arguments)}function h(){return(h=(0,i.default)((function*(e,t){if(32!==e.byteLength)throw new Error(`genSessionId: primary identity public key is ${e.byteLength} bytes, should be 32!`);if(32!==t.byteLength)throw new Error(`genSessionId: companion identity public key is ${e.byteLength} bytes, should be 32!`);const n=new a.Binary;n.writeBuffer(e),n.write("_".charCodeAt(0)),n.writeBuffer(t);const r=n.readByteArray();return yield(0,o.sha256Base64)(r)}))).apply(this,arguments)}},88432:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.STORAGE_QUOTA_UNAVAILABLE=t.MdSyncFieldStatsMeta=void 0;var i=r(n(48926)),a=r(n(63236)),o=n(1374);t.STORAGE_QUOTA_UNAVAILABLE=-1;const s=new class{constructor(){this._storageEstimation={mdStorageQuotaBytes:-2,mdStorageQuotaUsedBytes:-2},this._mdSessionId=null}getStorageEstimation(){var e=this;return(0,i.default)((function*(){if(-2!==e._storageEstimation.mdStorageQuotaBytes)return Promise.resolve(e._storageEstimation);const t=yield(0,a.default)();return e._storageEstimation={mdStorageQuotaBytes:t?t.quota:-1,mdStorageQuotaUsedBytes:t?t.usage:-1},e._storageEstimation}))()}getMdSessionId(){var e=this;return(0,i.default)((function*(){return null!=e._mdSessionId||(e._mdSessionId=yield(0,o.genCurrentSessionId)()),e._mdSessionId}))()}};t.MdSyncFieldStatsMeta=s},35047:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.convertToBucket=function(e){if(e<0)throw new Error("cannot convert negative number to a bucket");return 0===e?o.default.MUTATION_COUNT_BUCKET.ZERO:1===e?o.default.MUTATION_COUNT_BUCKET.ONE:e<10?o.default.MUTATION_COUNT_BUCKET.LT10:e<100?o.default.MUTATION_COUNT_BUCKET.LT100:e<500?o.default.MUTATION_COUNT_BUCKET.LT500:e<1e3?o.default.MUTATION_COUNT_BUCKET.LT1K:e<5e3?o.default.MUTATION_COUNT_BUCKET.LT5K:o.default.MUTATION_COUNT_BUCKET.GTE5K},t.generateActionStatCounts=function(){return l.apply(this,arguments)};var i=r(n(48926)),a=n(45606),o=r(n(11339)),s=n(34296);function l(){return(l=(0,i.default)((function*(){const e=new Map;return(yield(0,s.getTable)().all()).map((t=>{var n;const r=JSON.parse(t.index)[0],i=null!==(n=e.get(r))&&void 0!==n?n:{action:r,applied:0,invalid:0,orphan:0,unsupported:0,failed:0};switch(t.actionState){case a.SyncActionState.Success:case a.SyncActionState.Skipped:i.applied++;break;case a.SyncActionState.Malformed:i.invalid++;break;case a.SyncActionState.Orphan:i.orphan++;break;case a.SyncActionState.Unsupported:i.unsupported++;break;case a.SyncActionState.Failed:i.failed++}e.set(r,i)})),e}))).apply(this,arguments)}},78375:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addKeyRotationRemoveCount=function(e){if(0===e)return;void 0===s.keyRotationRemoveCount&&(s.keyRotationRemoveCount=0);s.keyRotationRemoveCount+=e,d()},t.addMutationCount=function(e){if(0===e)return;void 0===s.mutationCount&&(s.mutationCount=0);s.mutationCount+=e,d()},t.addUnsetActionCount=function(e){if(0===e)return;void 0===s.unsetActionCount&&(s.unsetActionCount=0);s.unsetActionCount+=e,d()},t.clear=c,t.incConflict=function(){void 0===s.uploadConflictCount&&(s.uploadConflictCount=0);s.uploadConflictCount++,d()},t.setInvalidActionCount=function(e){s.invalidActionCount=e,d()},t.setMissingKeyCount=function(e){s.missingKeyCount=e,d()},t.setStoredMutationCount=function(e){s.storedMutationCount=e,d()},t.setUnsupportedActionCount=function(e){s.unsupportedActionCount=e,d()};var i=n(57319),a=n(88102),o=r(n(11339));let s=new o.default.MdAppStateSyncDaily;const l=new i.ShiftTimer((function(){const e=function(e){const t=new o.default.MdAppStateSyncDaily;e.mutationCount>0&&(t.mutationCount=e.mutationCount);e.invalidActionCount>0&&(t.invalidActionCount=e.invalidActionCount);e.unsupportedActionCount>0&&(t.unsupportedActionCount=e.unsupportedActionCount);e.keyRotationRemoveCount>0&&(t.keyRotationRemoveCount=e.keyRotationRemoveCount);e.storedMutationCount>0&&(t.storedMutationCount=e.storedMutationCount);e.uploadConflictCount>0&&(t.uploadConflictCount=e.uploadConflictCount);e.unsetActionCount>0&&(t.unsetActionCount=e.unsetActionCount);e.missingKeyCount>0&&(t.missingKeyCount=e.missingKeyCount);return t}(s);c(),e.commit()}));function c(){s=new o.default.MdAppStateSyncDaily}function d(){l.onOrBefore(3e5)}a.Cmd.on("logout",(()=>{l.isScheduled()&&l.forceRunNow()}))},49332:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.logDailyStats=function(){return S.apply(this,arguments)};var i=r(n(81109)),a=r(n(48926)),o=n(66423),s=r(n(63236)),l=n(99234),c=n(28307),d=n(57701),u=n(55975),p=n(15875),f=n(41566),h=r(n(11339)),_=n(76214),g=n(72472),m=n(22917),y=n(75861),E=n(7595);function S(){return(S=(0,a.default)((function*(){const e=v(),t=yield T(),n=yield P(),r=O(),a=(0,i.default)((0,i.default)((0,i.default)((0,i.default)({},e),t),n),r),s=new h.default.Daily;s.set(a),s.commit(),(0,E.logDailyPrivateStatsTestEvents)();const l=o.DailyAggregatedStatsCollection.toArray().filter((e=>e.shouldBeSubmitted()));o.DailyAggregatedStatsCollection.remove(l),l.forEach((e=>{new h.default.PttDaily({eventTime:e.getEndTime(),pttCancelBroadcast:e.pttCancelBroadcast,pttCancelGroup:e.pttCancelGroup,pttCancelIndividual:e.pttCancelIndividual,pttDraftReviewBroadcast:e.pttDraftReviewBroadcast,pttDraftReviewGroup:e.pttDraftReviewGroup,pttDraftReviewIndividual:e.pttDraftReviewIndividual,pttFastplaybackBroadcast:e.pttFastplaybackBroadcast,pttFastplaybackGroup:e.pttFastplaybackGroup,pttFastplaybackIndividual:e.pttFastplaybackIndividual,pttLockBroadcast:e.pttLockBroadcast,pttLockGroup:e.pttLockGroup,pttLockIndividual:e.pttLockIndividual,pttOutOfChatBroadcast:e.pttOutOfChatBroadcast,pttOutOfChatGroup:e.pttOutOfChatGroup,pttOutOfChatIndividual:e.pttOutOfChatIndividual,pttPlaybackBroadcast:e.pttPlaybackBroadcast,pttPlaybackGroup:e.pttPlaybackGroup,pttPlaybackIndividual:e.pttPlaybackIndividual,pttRecordBroadcast:e.pttRecordBroadcast,pttRecordGroup:e.pttRecordGroup,pttRecordIndividual:e.pttRecordIndividual,pttSendBroadcast:e.pttSendBroadcast,pttSendGroup:e.pttSendGroup,pttSendIndividual:e.pttSendIndividual,pttPausedRecordBroadcast:e.pttPausedRecordBroadcast,pttPausedRecordGroup:e.pttPausedRecordGroup,pttPausedRecordIndividual:e.pttPausedRecordIndividual,pttStopTapBroadcast:e.pttStopTapBroadcast,pttStopTapGroup:e.pttStopTapGroup,pttStopTapIndividual:e.pttStopTapIndividual}).commit()}))}))).apply(this,arguments)}function v(){const e=p.deviceInfo.get();return{languageCode:e.lg,locationCode:e.lc,osBuildNumber:e.osBuild,simMcc:parseInt(e.mcc,10),simMnc:parseInt(e.mnc,10)}}function T(){return b.apply(this,arguments)}function b(){return(b=(0,a.default)((function*(){const e=(0,l.getUserPrivacySettings)(),t={receiptsEnabled:"none"!==e.readReceipts};if((0,d.privacySettingsEnabled)()){var n,r,i,a;const o=yield(0,y.queryDisallowedLists)();t.privacySettingsAbout=C(e.about),t.privacySettingsAboutExceptNum="contact_blacklist"===e.about?A(null===(n=o.status)||void 0===n?void 0:n.disallowedList.length):null,t.privacySettingsGroups=C(e.groupAdd),t.privacySettingsGroupsExceptNum="contact_blacklist"===e.groupAdd?A(null===(r=o.groupadd)||void 0===r?void 0:r.disallowedList.length):null,t.privacySettingsLastSeen=C(e.lastSeen),t.privacySettingsLastSeenExceptNum="contact_blacklist"===e.lastSeen?A(null===(i=o.last)||void 0===i?void 0:i.disallowedList.length):null,t.privacySettingsProfilePhoto=C(e.profilePicture),t.privacySettingsProfilePhotoExceptNum="contact_blacklist"===e.profilePicture?A(null===(a=o.profile)||void 0===a?void 0:a.disallowedList.length):null}if((0,f.isDisappearingModeEnabled)()){var o;const e=(0,l.getMaybeMeUser)(),n=(0,c.getDisappearingModeSettingForUser)(e);t.defaultDisappearingDuration=null!==(o=null==n?void 0:n.duration)&&void 0!==o?o:0}return t}))).apply(this,arguments)}function C(e){if(null==e)return null;switch(e){case"all":return h.default.PRIVACY_SETTINGS_VALUE_TYPE.EVERYONE;case"contacts":return h.default.PRIVACY_SETTINGS_VALUE_TYPE.MY_CONTACTS;case"contact_blacklist":return h.default.PRIVACY_SETTINGS_VALUE_TYPE.MY_CONTACTS_EXCEPT;case"none":return h.default.PRIVACY_SETTINGS_VALUE_TYPE.NOBODY}}function A(e){return null==e?null:0===e?h.default.PRIVACY_SETTINGS_CONTACTS_BUCKETS.B0:e<5?h.default.PRIVACY_SETTINGS_CONTACTS_BUCKETS.B1:e<10?h.default.PRIVACY_SETTINGS_CONTACTS_BUCKETS.B5:e<15?h.default.PRIVACY_SETTINGS_CONTACTS_BUCKETS.B10:e<20?h.default.PRIVACY_SETTINGS_CONTACTS_BUCKETS.B15:e<30?h.default.PRIVACY_SETTINGS_CONTACTS_BUCKETS.B20:e<40?h.default.PRIVACY_SETTINGS_CONTACTS_BUCKETS.B30:e<50?h.default.PRIVACY_SETTINGS_CONTACTS_BUCKETS.B40:e<60?h.default.PRIVACY_SETTINGS_CONTACTS_BUCKETS.B50:e<70?h.default.PRIVACY_SETTINGS_CONTACTS_BUCKETS.B60:e<80?h.default.PRIVACY_SETTINGS_CONTACTS_BUCKETS.B70:e<90?h.default.PRIVACY_SETTINGS_CONTACTS_BUCKETS.B80:e<100?h.default.PRIVACY_SETTINGS_CONTACTS_BUCKETS.B90:h.default.PRIVACY_SETTINGS_CONTACTS_BUCKETS.B100}function P(){return M.apply(this,arguments)}function M(){return(M=(0,a.default)((function*(){const e=yield(0,_.getContactTable)().equals(["isAddressBookContact"],1).then((e=>e.length)),t=yield(0,s.default)(),n=yield u.LruMediaStore.count(),r=yield Promise.all([t,e,n]);let i=0,a=0;const o=r[0];return null!=o&&(i=o.available,a=o.quota),{addressbookWhatsappSize:I(r[1],10),storageAvailSize:I(i,100),storageTotalSize:I(a,100),mediaFolderFileCount:r[2]}}))).apply(this,arguments)}function O(){let e=h.default.NOTIFICATION_SETTING_TYPE.UNKNOWN;return null!=window.Notification&&(e=window.Notification.permission===m.PERMISSION_ALLOWED&&g.MuteCollection.getGlobalNotifications()?h.default.NOTIFICATION_SETTING_TYPE.ALLOWED:h.default.NOTIFICATION_SETTING_TYPE.BLOCKED),{osNotificationSetting:e}}function I(e,t){return Math.round(e/t)*t}},42862:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.registerTasks=function(){if((0,s.isLegacyWebdBackend)())return;(0,a.startScheduler)({scheduledTimeResolver:{get:e=>(0,C.getTaskScheduledTime)(String(e)),set:(e,t)=>(0,C.updateTaskScheduledTime)(String(e),t)}}),P.filter((e=>e!==A.LOG_DB_ROW_COUNTS||!1)).forEach((e=>{const t=function(e){switch(e){case A.MONITOR_DB_STORAGE:return function(){var e=(0,i.default)((function*(){return a.DO_NOT_RESCHEDULE}));return function(){return e.apply(this,arguments)}}();case A.CLEAN_TC_TOKENS:return function(){var e=(0,i.default)((function*(e){if(e)__LOG__(2)`CleanTcToken skip first run`;else try{yield(0,p.pruneExpiredTcTokens)()}catch(e){__LOG__(4,!0,new Error)`Failed to delete the expired TcTokens with error: ${e}`}return o.DAY_SECONDS}));return function(){return e.apply(this,arguments)}}();case A.LOG_DAILY_STATS:return()=>(0,h.logDailyStats)().catch((e=>{__LOG__(4,!0,new Error)`Failed to log daily stats: ${e}`})).then((()=>o.DAY_SECONDS));case A.LOG_DB_ROW_COUNTS:break;case A.ROTATE_KEY:return function(){var e=(0,i.default)((function*(e){return e?__LOG__(2)`RotateKeyTask skip first run`:yield(0,g.getJobManager)().waitUntilCompleted(y.jobSerializers.rotateKey()),27*o.DAY_SECONDS}));return function(){return e.apply(this,arguments)}}();case A.SYNC_AB_PROPS:return function(){var e=(0,i.default)((function*(e){return e||(yield(0,d.syncABPropsTask)()),(0,c.getRefresh)()}));return function(){return e.apply(this,arguments)}}();case A.SYNC_CONTACTS:return function(){var e=(0,i.default)((function*(e){if(!e){try{yield(0,m.getNonAddressBookContactsAndMarkAllContactsDirty)()}catch(e){__LOG__(4,!0,new Error)`Failed to sync non-address book contacts with error: ${e}`}try{yield(0,f.contactSync)()}catch(e){__LOG__(4,!0,new Error,!0)`contact sync failed`,SEND_LOGS("contact sync failed: "+e)}}return(0,T.getContactSyncRefreshSeconds)()}));return function(){return e.apply(this,arguments)}}();case A.REPORT_SYNCD_ACTION_STAT:return function(){var e=(0,i.default)((function*(e){return e||(yield(0,S.reportSyncdStatsJob)()),o.DAY_SECONDS}));return function(){return e.apply(this,arguments)}}();case A.LT_HASH_CHECK:return function(){var e=(0,i.default)((function*(e){const t=(0,l.getABPropConfigValue)("lthash_check_hours");return 0===t?24*o.HOUR_SECONDS:(e||(yield(0,u.checkLtHash)()),t*o.HOUR_SECONDS)}));return function(){return e.apply(this,arguments)}}();case A.REQUEST_ALL_SYNCD_MISSING_KEYS:return function(){var e=(0,i.default)((function*(e){return e||(yield(0,v.requestAllSyncdMissingKeysJob)()),6*o.HOUR_SECONDS}));return function(){return e.apply(this,arguments)}}();case A.SYNCD_SYNC_ALL_COLLECTIONS:return function(){var e=(0,i.default)((function*(e){const t=(0,l.getABPropConfigValue)("syncd_periodic_sync_days");return 0===t?(__LOG__(2)`syncd: syncdPeriodicSyncDays is 0, skipping sync`,o.DAY_SECONDS):(e||(yield(0,b.syncdSyncAllCollectionsJob)()),o.DAY_SECONDS*t)}));return function(){return e.apply(this,arguments)}}();case A.CLEAN_ORPHAN_REACTIONS:return(0,i.default)((function*(){if(!(0,_.receiveReactionsEnabled)())return o.DAY_SECONDS;try{yield(0,E.pruneExpiredOrphanReactions)()}catch(e){__LOG__(4,!0,new Error)`Failed to delete the expired orphan reactions with error: ${e}`}return o.DAY_SECONDS}))}}(e);null!=t&&(0,a.registerTask)(e,t)}))};var i=r(n(48926)),a=n(2821),o=n(92844),s=n(88555),l=n(57849),c=n(72126),d=n(89981),u=n(1377),p=n(48285),f=n(189),h=n(49332),_=n(57701),g=n(68819),m=n(24872),y=n(6684),E=n(63374),S=n(66101),v=n(4454),T=n(66837),b=n(5474),C=n(60998);const A=n(76672)({CLEAN_TC_TOKENS:"cleanTcTokens",LOG_DAILY_STATS:"logDailyStats",LOG_DB_ROW_COUNTS:"logDbRowCounts",ROTATE_KEY:"rotateKey",SYNC_AB_PROPS:"syncAbProps",SYNC_CONTACTS:"syncContacts",MONITOR_DB_STORAGE:"monitorDbStorage",REPORT_SYNCD_ACTION_STAT:"reportSyncdActionStat",LT_HASH_CHECK:"ltHashCheck",REQUEST_ALL_SYNCD_MISSING_KEYS:"requestAllSyncdMissingKeys",SYNCD_SYNC_ALL_COLLECTIONS:"syncdSyncAllCollections",CLEAN_ORPHAN_REACTIONS:"cleanOrphanReactions"}),P=[A.CLEAN_TC_TOKENS,A.LOG_DAILY_STATS,A.LOG_DB_ROW_COUNTS,A.ROTATE_KEY,A.SYNC_AB_PROPS,A.SYNC_CONTACTS,A.MONITOR_DB_STORAGE,A.REPORT_SYNCD_ACTION_STAT,A.LT_HASH_CHECK,A.REQUEST_ALL_SYNCD_MISSING_KEYS,A.SYNCD_SYNC_ALL_COLLECTIONS,A.CLEAN_ORPHAN_REACTIONS]},47473:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.shouldBlockByCountry=function(e){var t;return!!(0,i.countryGatingEnabled)()&&((null===(t=e.privacyMode)||void 0===t?void 0:t.hostStorage)===a.HostStorageEnumType.Facebook&&!(0,r.getFbBrandedNumber)(e.id.user))};var r=n(17478),i=n(57701),a=n(49714)},70768:(e,t,n)=>{"use strict";var r=n(59182).default,i=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.TosManager=t.TOS_3_ID=void 0;var a=i(n(48926)),o=n(13959),s=n(92574),l=i(n(76521)),c=n(19770),d=n(99234),u=n(57701),p=n(72407),f=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=_(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(53055)),h=n(99684);function _(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(_=function(e){return e?n:t})(e)}const g="20210210";t.TOS_3_ID=g;const m={minTimeout:1e3,maxTimeout:16e3,retries:5,signal:(new r).signal};class y extends l.default{constructor(){super(...arguments),this._noticeIds=[g],this._refreshInterval=864e5}getState(e){const t=this._getStoreKey(e);return f._getUser(t)||"UNKNOWN"}setState(e,t){if((0,u.tosFetchEnabled)()){new Set(this._noticeIds).has(e)?(f._setUser(this._getStoreKey(e),t),this.trigger("change")):__LOG__(3)`ToS state manager unrecognized user notice id: ${e}`}}run(){var e=this;return(0,a.default)((function*(){if((0,u.tosFetchEnabled)()){try{yield(0,c.exponentialBackoff)(m,((t,n)=>e._query().catch((e=>{if(e instanceof s.ServerStatusCodeError)switch(e.statusCode){case 500:return __LOG__(3)`ToS state manager query failed, retriable error: ${e.errorMessage}, failCount ${n}`,t(e)}throw e}))))}catch(e){if(__LOG__(4,!0,new Error,!0)`ToS state manager state pull failed, error: ${e}`,SEND_LOGS("ToS state manager run failed"),!(e instanceof s.ServerStatusCodeError&&500===e.statusCode))return}if(e._getNoticeIdsToRun().length>0){const t=(0,d.getMaybeMeUser)();yield(0,o.delayMs)(e._refreshInterval),(0,d.getMaybeMeUser)()===t&&e.run()}}}))()}_query(){var e=this;return(0,a.default)((function*(){if(!(0,d.getMaybeMeUser)())return;const t=e._getNoticeIdsToRun();if(t.length>0){const n=yield(0,h.queryTosState)(t);e._refreshInterval=1e3*n.refresh;const r=new Set(e._noticeIds);let i=!1;n.notice.filter((e=>r.has(e.id))).forEach((t=>{const n=t.state?"ACCEPTED":"NOT_ACCEPTED",r=e._getStoreKey(t.id);f._getUser(r)!==n&&(f._setUser(r,n),i=!0)})),f._setUser(p.KEYS.TOS_STATE_FETCH_ITERATION,(0,u.tosFetchIteration)()),i&&e.trigger("change")}}))()}_getNoticeIdsToRun(){const e=parseInt(f._getUser(p.KEYS.TOS_STATE_FETCH_ITERATION),10)||0;if((0,u.tosFetchIteration)()>e)return this._noticeIds;const t=this._noticeIds.map((e=>this.getState(e)));return this._noticeIds.filter(((e,n)=>"ACCEPTED"!==t[n]))}_getStoreKey(e){switch(e){case g:return p.KEYS.TOS_3}throw new Error("Unknown user notice id: "+e)}maybeUpdateServer(e){var t=this;return(0,a.default)((function*(){if((0,u.tosFetchEnabled)())try{const n=new Set(e);yield(0,c.exponentialBackoff)(m,((e,r)=>{const i=t._getAcceptedNoticeIds(n);return i.length>0?(0,h.updateTosState)(i).catch((t=>{if(t instanceof s.ServerStatusCodeError&&500===t.statusCode)return __LOG__(3)`ToS state manager server session state update failed, retriable error: ${t.errorMessage}, failCount ${r}`,e(t);throw t})):Promise.resolve()}))}catch(e){__LOG__(4,!0,new Error,!0)`ToS state manager server session state update failed, error: ${e}`,SEND_LOGS("ToS state manager server session state update failed")}}))()}_getAcceptedNoticeIds(e){if((0,d.getMaybeMeUser)()){const t=this._noticeIds.map((e=>this.getState(e)));return this._noticeIds.filter(((n,r)=>"ACCEPTED"===t[r]&&e.has(n)))}return[]}resetTosState(){}}const E=new y;t.TosManager=E},37894:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.shouldBlockByTos=l,t.shouldBlockByTosB2C=function(e,t){if((0,a.tos3GatingEnabledB2C)()&&l(e)&&t)return t.type!==r.MSG_TYPE.DEBUG&&t.type!==r.MSG_TYPE.E2E_NOTIFICATION&&t.type!==r.MSG_TYPE.NOTIFICATION_TEMPLATE&&!t.isSentByMe;return!1};var r=n(15461),i=n(17478),a=n(57701),o=n(49714),s=n(70768);function l(e){var t;if((0,a.tos3GatingEnabled)()&&("NOT_ACCEPTED"===s.TosManager.getState(s.TOS_3_ID)&&(null===(t=e.privacyMode)||void 0===t?void 0:t.hostStorage)===o.HostStorageEnumType.Facebook&&!(0,i.getFbBrandedNumber)(e.id.user)))return!0;return!1}},66577:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.USyncBusinessProtocol=void 0,t.businessParser=function(e){e.assertTag("business");const t=e.maybeChild("error");if(t)return{errorCode:t.attrInt("code"),errorText:t.attrString("text")};const n=e.maybeChild("verified_name");return{verifiedName:n?(0,a.default)(n):null}};var i=n(31914),a=r(n(27874));t.USyncBusinessProtocol=class{getQueryElement(){return(0,i.wap)("business",null,(0,i.wap)("verified_name",null))}getUserElement(){return null}}},93967:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.USyncContactProtocol=void 0,t.contactParser=function(e){e.assertTag("contact");const t=e.maybeChild("error");if(t)return{errorCode:t.attrInt("code"),errorText:t.attrString("text")};return{type:e.attrString("type")}};var r=n(31914);t.USyncContactProtocol=class{getQueryElement(){return(0,r.wap)("contact",null)}getUserElement(e){const t=e.getPhone();return t?(0,r.wap)("contact",null,t):null}}},81051:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.USyncDeviceProtocol=void 0,t.deviceParser=function(e){e.assertTag("devices");const t=e.maybeChild("error");if(t)return{errorCode:t.attrInt("code"),errorText:t.attrString("text")};const n=e.maybeChild("key-index-list"),r=e.maybeChild("device-list"),i=null==n?null:{ts:n.attrTime("ts"),signedKeyIndexBytes:n.hasContent()?n.contentBytes():null,expectedTs:n.hasAttr("expected_ts")?n.attrTime("expected_ts"):void 0};return{deviceList:null==r?void 0:r.mapChildrenWithTag("device",(e=>({id:e.attrInt("id"),keyIndex:e.hasAttr("key-index")?e.attrInt("key-index"):null}))),keyIndex:i}};var r=n(31914),i=n(57849);t.USyncDeviceProtocol=class{getQueryElement(){return(0,r.wap)("devices",{version:(0,r.CUSTOM_STRING)(String(2))})}getUserElement(e){const t=e.getDeviceHash(),n=e.getTs(),a=e.getExpectedTs();return t||null!=n||null!=a?(0,r.wap)("devices",{device_hash:t?(0,r.CUSTOM_STRING)(t):r.DROP_ATTR,ts:null!=n?(0,r.INT)(n):r.DROP_ATTR,expected_ts:(0,i.getABPropConfigValue)("adv_v2_m4_m5")&&null!=a?(0,r.INT)(a):r.DROP_ATTR}):null}}},3776:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.USyncDisappearingModeProtocol=void 0,t.disappearingModeParser=function(e){e.assertTag("disappearing_mode");const t=e.maybeChild("error");if(t)return{errorCode:t.attrInt("code"),errorText:t.attrString("text")};const n=e.attrInt("duration",0),r=e.attrInt("t");return{duration:n,t:r}};var r=n(31914);t.USyncDisappearingModeProtocol=class{getQueryElement(){return(0,r.wap)("disappearing_mode",null)}getUserElement(){return null}}},35564:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.USyncFeaturesProtocol=void 0,t.featureParser=function(e){e.assertTag("feature");const t=e.maybeChild("error");if(t)return{errorCode:t.attrInt("code"),errorText:t.attrString("text")};const n={};return Object.keys(i).forEach((t=>{const r=e.maybeChild(t);r&&(n[t]=r.attrString("value"))})),n};var r=n(31914);const i={document:(0,r.wap)("document",null),encrypt:(0,r.wap)("encrypt",null),encrypt_blist:(0,r.wap)("encrypt_blist",null),encrypt_contact:(0,r.wap)("encrypt_contact",null),encrypt_group_gen2:(0,r.wap)("encrypt_group_gen2",null),encrypt_image:(0,r.wap)("encrypt_image",null),encrypt_location:(0,r.wap)("encrypt_location",null),encrypt_url:(0,r.wap)("encrypt_url",null),encrypt_v2:(0,r.wap)("encrypt_v2",null),voip:(0,r.wap)("voip",null),multi_agent:(0,r.wap)("multi_agent",null)};t.USyncFeaturesProtocol=class{constructor(e){if(this.queries=e,0===e.length)throw new Error("must specify at least one query")}getQueryElement(){return(0,r.wap)("feature",null,this.queries&&this.queries.map((e=>i[e])))}getUserElement(){return null}}},52284:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.USyncQuery=t.USYNC_SUPPORT_TYPE=void 0;var i=r(n(48926)),a=n(31914),o=n(71914),s=n(81663),l=r(n(89867)),c=n(66577),d=n(24747),u=n(93967),p=n(81051),f=n(3776),h=n(35564),_=n(60226),g=n(85880),m=n(39410);const y={FEATURE:"feature",DEVICE:"devices",CONTACT:"contact",PICTURE:"picture",STATUS:"status",BUSINESS:"business",DISAPPEARING_MODE:"disappearing_mode"};t.USYNC_SUPPORT_TYPE=y;const E={feature:h.featureParser,devices:p.deviceParser,contact:u.contactParser,picture:_.pictureParser,status:g.statusParser,business:c.businessParser,disappearing_mode:f.disappearingModeParser};function S(e){const t=[];return e.forEachChildWithTag("user",(e=>{const n={};e.hasAttr("jid")&&(Object.keys(y).forEach((t=>{const r=y[t],i=e.maybeChild(r);i&&E[r]&&(n[r]=E[r](i))})),n.id=(0,s.deviceJidToUserWid)(e.attrPhoneDeviceJid("jid")),t.push(n))})),t}const v=new o.WapParser("usyncParser",(e=>{e.assertAttr("type","result");const t={error:{},refresh:{},list:[],sideList:[]},n=e.child("usync"),r=n.child("result"),i=n.child("list"),a=n.maybeChild("side_list");return Object.keys(y).forEach((e=>{const n=y[e],i=r.maybeChild(n);if(i){const e=i.maybeChild("error");e?t.error[n]={errorCode:e.attrInt("code"),errorText:e.attrString("text"),errorBackoff:e.attrInt("backoff")}:i.hasAttr("refresh")&&(t.refresh[n]=i.attrInt("refresh",0))}})),t.list=S(i),a&&(t.sideList=S(a)),__LOG__(2)`usync query success!`,t}));t.USyncQuery=class{constructor(){this.context="interactive",this.mode="query",this.protocols=[],this.users=[]}withMode(e){return this.mode=e,this}withContext(e){return this.context=e,this}withContactProtocol(){return this.protocols.push(new u.USyncContactProtocol),this}withBusinessProtocol(){return this.protocols.push(new c.USyncBusinessProtocol),this}withDeviceProtocol(){return this.protocols.push(new p.USyncDeviceProtocol),this}withDisappearingModeProtocol(){return this.protocols.push(new f.USyncDisappearingModeProtocol),this}withPictureProtocol(){return this.protocols.push(new _.USyncPictureProtocol),this}withStatusProtocol(){return this.protocols.push(new g.USyncStatusProtocol),this}withFeaturesProtocol(e){return this.protocols.push(new h.USyncFeaturesProtocol(e)),this}withUser(e){return this.users.push(e),this}_buildStanza(){if(0===this.protocols.length)throw new Error("a usync query must have at least one protocol");const e=this.users.filter((e=>{const t=e.getId();return(!t||!l.default.isServer(t))&&e.validate()}));0===e.length&&__LOG__(3)`Usync warning: a usync query must have at least one user`;const t=(0,a.wap)("query",null,this.protocols.map((e=>e.getQueryElement()))),n=e.map((e=>{const t=e.getId();return(0,a.wap)("user",{jid:t?(0,m.USER_JID)(t):a.DROP_ATTR},this.protocols.map((t=>t.getUserElement(e))))})),r=(0,a.wap)("list",null,n);return(0,a.wap)("iq",{to:a.S_WHATSAPP_NET,xmlns:"usync",type:"get",id:(0,a.generateId)()},(0,a.wap)("usync",{sid:(0,a.generateId)(),index:"0",last:"true",mode:(0,a.CUSTOM_STRING)(this.mode),context:(0,a.CUSTOM_STRING)(this.context)},t,r))}execute(){var e=this;return(0,i.default)((function*(){const t=e._buildStanza(),n=yield(0,d.sendIq)(t,v);return n.success?n.result:{error:{all:{errorCode:n.errorCode,errorText:n.errorText,errorType:n.errorType}},refresh:{},list:[]}}))()}}},60226:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.USyncPictureProtocol=void 0,t.pictureParser=function(e){e.assertTag("picture");const t=e.maybeChild("error");if(t)return{errorCode:t.attrInt("code"),errorText:t.attrString("text")};return{id:e.attrInt("id")}};var r=n(31914);t.USyncPictureProtocol=class{getQueryElement(){return(0,r.wap)("picture",null)}getUserElement(){return null}}},85880:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.USyncStatusProtocol=void 0,t.statusParser=function(e){e.assertTag("status");const t=e.maybeChild("error");if(t)return{errorCode:t.attrInt("code"),errorText:t.attrString("text")};if(!e.hasContent())return e.hasAttr("code")&&401===e.attrInt("code")?null:i.fbt._("Hey there! I am using WhatsApp.",null,{hk:"1lXNBq"}).toString();return 0!==e.contentString().length?e.contentString():i.fbt._("Hey there! I am using WhatsApp.",null,{hk:"1lXNBq"}).toString()};var r=n(31914),i=n(48360);t.USyncStatusProtocol=class{getQueryElement(){return(0,r.wap)("status",null)}getUserElement(){return null}}},79942:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.USyncUser=void 0;var r=n(47685);t.USyncUser=class{withId(e){return this._id=e,this}withDeviceHash(e){return this._deviceHash=e,this}withTs(e){return this._ts=e,this}withExpectedTs(e){return this._expectedTs=e,this}withPhone(e){return this._phone=e,this}getDeviceHash(){return this._deviceHash}getPhone(){return this._phone}getId(){return this._id}getTs(){return this._ts}getExpectedTs(){return this._expectedTs}validate(){const{_id:e,_phone:t}=this;if(null==e&&null==t)throw new Error("user must have an id or a phone");if(e){const t=(0,r.validateWid)(e.toString());return t||__LOG__(3)`USync user created with invalid jid: ${e.toString()}`,t}return!0}}},36129:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(8584);class i{static tag(e){return null==e?void 0:e[0]}static attr(e,t){return(null==t?void 0:t[1])?t[1][e]:void 0}static attrs(e){return e[1]}static child(e,t){const n=t[2];if(Array.isArray(n)){const t=n.length;for(let r=0;r<t;r++){const t=n[r];if(Array.isArray(t)&&t[0]===e)return t}}}static firstChild(e){const t=e[2];if(Array.isArray(t))return t[0]}static children(e,t){if(!t)return null==e?void 0:e[2];const n=e[2];return Array.isArray(n)?n.filter((e=>e[0]===t)):void 0}static dataStr(e){if(!e)return"";const t=e[2];return"string"==typeof t?t:t instanceof ArrayBuffer?new r.Binary(t).readString(t.byteLength):""}static toString(e,t){if(!e)return"undefined";const n=function(e,t){if(e){let n="";for(const r in e){n+=" "+r+"="+("string"==typeof e[r]?t?"...":'"'+e[r]+'"':e[r])}return n}return""}(e[1],t),r=function(e,t){if(e instanceof ArrayBuffer)return"<<bin:"+e.byteLength+">>";if("string"==typeof e)return t?"<<string:"+e.length+">>":e;if(Array.isArray(e))return e.map((e=>i.toString(e,t))).join("\n");return""}(e[2],t);return"<"+e[0]+n+(r?">\n"+r+"\n</"+e[0]+">":"/>")}}t.default=i},33163:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(51584)),a=r(n(13218)),o=r(n(16579)),s=r(n(2525)),l=n(51737);function c(e){switch(typeof e){case"object":return null==e?e=>null===e:function(e){const t=[];let n=!1,r=0;(0,s.default)(e,(function(e,i){if(void 0===e)return void(n=!0);r++;const a=c(e);t.push((function(e){return e.hasOwnProperty(i)&&a&&a(e[i])}))}));const i=(0,o.default)(t,(function(e,t){return e?function(n){return t(n)&&e(n)}:t}));return function(e){if("object"!=typeof e||null==e)return!1;const t=Object.keys(e).length;return!(t<r)&&!(!n&&t>r)&&i(e)}}(e);case"function":return e;case"boolean":case"undefined":case"number":case"string":return function(t){return t===e};default:throw new TypeError("Unknown Template type: "+typeof e)}}class d{constructor(e){this.predicate=c(e)}test(e){return this.predicate(e)}}t.default=d,d.ANY=()=>!0,d.OBJECT=a.default,d.STRING=l.isString,d.BOOLEAN=i.default},41090:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(21224),i={voipIndividualOutgoing:r.WebFeaturesFlag.FORCE_UPGRADE,groupsV3:r.WebFeaturesFlag.FORCE_UPGRADE,groupsV3Create:r.WebFeaturesFlag.DEVELOPMENT,changeNumberV2:r.WebFeaturesFlag.FORCE_UPGRADE,queryStatusV3Thumbnail:r.WebFeaturesFlag.DEVELOPMENT,liveLocations:r.WebFeaturesFlag.FORCE_UPGRADE,queryVname:r.WebFeaturesFlag.FORCE_UPGRADE,voipIndividualIncoming:r.WebFeaturesFlag.FORCE_UPGRADE,quickRepliesQuery:r.WebFeaturesFlag.FORCE_UPGRADE,payments:r.WebFeaturesFlag.FORCE_UPGRADE,labelsDisplay:r.WebFeaturesFlag.FORCE_UPGRADE,labelsEdit:r.WebFeaturesFlag.FORCE_UPGRADE,stickerPackQuery:r.WebFeaturesFlag.FORCE_UPGRADE,liveLocationsFinal:r.WebFeaturesFlag.FORCE_UPGRADE,mediaUpload:r.WebFeaturesFlag.FORCE_UPGRADE,vnameV2:r.WebFeaturesFlag.FORCE_UPGRADE,videoPlaybackUrl:r.WebFeaturesFlag.FORCE_UPGRADE,statusRanking:r.WebFeaturesFlag.FORCE_UPGRADE,voipIndividualVideo:r.WebFeaturesFlag.DEVELOPMENT,thirdPartyStickers:r.WebFeaturesFlag.FORCE_UPGRADE,frequentlyForwardedSetting:r.WebFeaturesFlag.FORCE_UPGRADE,recentStickers:r.WebFeaturesFlag.FORCE_UPGRADE,recentStickersV2:r.WebFeaturesFlag.PRODUCTION,recentStickersV3:r.WebFeaturesFlag.PRODUCTION,groupsV4JoinPermission:r.WebFeaturesFlag.FORCE_UPGRADE,catalog:r.WebFeaturesFlag.FORCE_UPGRADE,starredStickers:r.WebFeaturesFlag.PRODUCTION,templateMessage:r.WebFeaturesFlag.PRODUCTION,templateMessageInteractivity:r.WebFeaturesFlag.DEVELOPMENT,ephemeralMessages:r.WebFeaturesFlag.PRODUCTION,e2ENotificationSync:r.WebFeaturesFlag.FORCE_UPGRADE,syncdRelease1:r.WebFeaturesFlag.PRODUCTION,userNotice:r.WebFeaturesFlag.PRODUCTION,syncdRelease11:r.WebFeaturesFlag.PRODUCTION,support:r.WebFeaturesFlag.PRODUCTION,groupUiiCleanup:r.WebFeaturesFlag.FORCE_UPGRADE,groupDogfoodingInternalOnly:r.WebFeaturesFlag.DEVELOPMENT,settingsSync:r.WebFeaturesFlag.PRODUCTION,ephemeral24HDuration:r.WebFeaturesFlag.DEVELOPMENT,archiveV2:r.WebFeaturesFlag.PRODUCTION,mdForceUpgrade:r.WebFeaturesFlag.FORCE_UPGRADE,disappearingMode:r.WebFeaturesFlag.PRODUCTION,externalMdOptInAvailable:r.WebFeaturesFlag.PRODUCTION,noDeleteMessageTimeLimit:r.WebFeaturesFlag.DEVELOPMENT};t.default=i},80208:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.settingsSync=t.MD_OPT_IN_DEADLINE_SETTINGS_KEY=t.DISAPPEARING_MODE_SETTINGS_KEY=t.ARCHIVE_SETTINGS_KEY=void 0;var i=r(n(41609));const a="archive";t.ARCHIVE_SETTINGS_KEY=a;const o="disappearing_mode";t.DISAPPEARING_MODE_SETTINGS_KEY=o;const s="md_opt_in_deadline";t.MD_OPT_IN_DEADLINE_SETTINGS_KEY=s;const l={querySettings:function(e){return new Promise(((t,n)=>{const r=this.queryNode({type:"settings"},void 0),a=e?"query,settings,resume":"query,settings";this.binSend("sendEphemeral",r,n,{onSend:this.binWrap((e=>{this.BinaryProtocol.read(e).then((e=>{const n={settings:[],status:parseInt(this.N.attr("code",e),10)||200};if(__LOG__(2)`bin-recv: response,settings`,"response"===this.N.tag(e)&&"settings"===this.N.attr("type",e)){const t=this.N.children(e);if(Array.isArray(t))for(let e=0;e<t.length;e++){const r=this.parseSetting(t[e]);(0,i.default)(r)||n.settings.push(r)}}t(n)})).catch(n)}),t),onDrop:this.wrap(n),serverCacheable:Boolean(e)},{debugString:a,metricName:"QUERY_SETTINGS"})}))},setArchiveSetting:function(e){return new Promise(((t,n)=>{const r=this.actionNode("set",[["archive_v2",{classic:e.toString()},void 0]]);this.binSend("send",r,n,{clientCacheable:!0,onSend:this.wrap(t),onDrop:this.wrap(n)},{debugString:"action,settings,archive",metrics:"SET_ARCHIVE_SETTING",ackRequest:!0})}))},parseSetting:function(e){switch(this.N.tag(e)){case"archive_v2":return{type:a,value:{classic:"true"===this.N.attr("classic",e),enabled:this.N.attr("enabled",e)&&"true"===this.N.attr("enabled",e)}};case"disappearing_mode":return{type:o,value:{duration:parseInt(this.N.attr("duration",e),10),settingTimestamp:parseInt(this.N.attr("t",e),10)}};case"md_opt_in_deadline":return{type:s,value:{timestamp:parseInt(this.N.attr("t",e),10)}};default:return}}};t.settingsSync=l},56891:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={};Object.defineProperty(t,"default",{enumerable:!0,get:function(){return i.instance}});var i=n(86875);Object.keys(i).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===i[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}}))}))},78144:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:i.default.isWid,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:a.createWid,o=t;switch(e){case"author":case"broadcast":case"chat":case"descOwner":case"from":case"gid":case"id":case"jid":case"owner":case"participant":case"quotedRemoteJid":case"quotedParticipant":case"remote":case"subjectOwner":case"s_o":case"to":case"wid":case"changeNumberNewJid":case"changeNumberOldJid":case"recipient":case"paymentMessageReceiverJid":case"parentGroup":case"revokeSender":n(t)&&(o=r(t));break;default:const i=parseInt(e,10);!isNaN(i)&&n(t)&&(o=r(t))}return o};var i=r(n(89867)),a=n(45454)},77113:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.loadProtoVersions=function(){return s.apply(this,arguments)},t.protoMap=void 0;var i=r(n(48926)),a=n(46582);const o={};function s(){return(s=(0,i.default)((function*(){const e=yield(0,a.requireLoadProtoVersions)();Object.assign(o,e)}))).apply(this,arguments)}t.protoMap=o},7353:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(11865)),a=n(8584);const o={NEW:"REQUEST_STATE_NEW",SENT:"REQUEST_STATE_SENT",WEBDACKED:"REQUEST_STATE_WEBDACKED",WILL_RETRY:"REQUEST_STATE_WILL_RETRY"};class s{constructor(e){this.state=o.NEW,this.age=0,this.resends=0;const t=e.data;this.data=t,this.isToPhone=t instanceof ArrayBuffer,this.tag=e.tag,this.clientCacheable=!!e.clientCacheable,this.serverCacheable=!!e.serverCacheable,this.retryOn5xx=!!e.retryOn5xx,this.onSend=e.onSend,this.logOnSend=e.logOnSend,this.onDrop=e.onDrop,this.binaryOpts=e.binaryOpts,this.on5xx=e.on5xx,this.resendGuard=e.resendGuard,this.onTag=e.onTag,this.tagToCancel=e.tagToCancel,this.ephemeral=!!e.ephemeral,this.ignore=!!e.ignore,this.isCallOffer=!!e.isCallOffer,this.isWap4Bridge=!!e.isWap4Bridge}getTag(){return this.tag||(this.onSend?this.onSend.tag:void 0)}getName(){var e;return(null===(e=this.binaryOpts)||void 0===e?void 0:e.metricName)?this.binaryOpts.metricName.toLowerCase():`${this.data[0]}_${(0,i.default)(this.data[1])}`}toString(){const e=this.data;return this.binaryOpts?this.binaryOpts.debugString:Array.isArray(e)?0===e.length?"[]":1===e.length?`[${e[0]}]`:"query"===e[0]||"action"===e[0]?`[${e[0]}, ${e[1]}${e.length>2?", ...":""}]`:`Invalid request: ${e[0]}`:e instanceof Object?"{...}":`${String(e)}`}serialize(){const e=this.tag;if(this.binaryOpts){const t=this.binaryOpts,n=null!=t.metric?t.metric:0,r=(this.ignore?0:1)<<7|(!this.ignore&&t.ackRequest?1:0)<<6|(!0===t.available?1:0)<<5|(!1===t.available?1:0)<<4|(null!=t.expires&&0!==t.expires?1:0)<<3|(t.skipOffline?1:0)<<2;return a.Binary.build(e,",",n,r,this.data).readBuffer()}const t="string"==typeof this.data?this.data:JSON.stringify(this.data);return`${String(e)},,${String(t)}`}}t.default=s,s.STATE=o},66934:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.VoipSignaling=void 0,t.base64DecodeRecursively=function e(t){const n=t[2];Array.isArray(n)&&n.forEach((t=>{t&&(t[2]instanceof ArrayBuffer||"string"==typeof t[2]?t[2]=(0,a.decodeB64ToJsArray)(t[2]):t[2]&&e(t))}))};var i=r(n(78718)),a=n(15688),o=n(84902),s=n(60980),l=n(19380),c=n(24808),d=n(99234),u=r(n(36129)),p=n(45473),f=n(43067);const h={formatCallOffer:function(e,t,n){const r=n.payload,i={to:n.common.peer_jid,id:t,from:(0,d.getMaybeMeUser)().toString({legacy:!0})};let a,o;const l=r[2];l.forEach(((e,t)=>{switch(e[0]){case"enc":const i={call:{callKey:new Uint8Array(e[2])}},l={},d=r[1].retry_count;d&&(l.count=d);const u=["call",l,(0,f.cdataArrayBuffer)((0,s.encodeProtobuf)(c.MessageSpec,i))];a=u,o=t;break;default:(0,f.arrayToB64Recursively)(n.payload,!0)}})),l.splice(o,1),l.push(a),r[2]=l;return e.actionNode("relay",[["call",i,[r]]])},parseCallSignalingMsg:function(e){try{const t=l.ContactCollection.get(e.from),n={peer_jid:e.from.toString({legacy:!0}),isContact:null==t?void 0:t.isMyContact},r=["wrapper",{},e.data];switch(e.type){case"offer":{const t=_("offer",r);n.peer_platform=e.platform,e.version&&e.version.length&&(n.peer_version=e.version.join(".")),this.parseCallOffer(t,n,!1);break}case"accept":{const t=_("accept",r);n.type=p.TYPE.ACCEPT,n.call_id=u.default.attr("call-id",t)||"",n.peer_platform=e.platform,e.version&&e.version.length&&(n.peer_version=e.version.join("."));break}case"receipt":const t=e.data;switch(n.call_id=u.default.attr("call-id",t)||"",u.default.tag(t)){case"offer":n.type=p.TYPE.OFFER_RECEIPT;break;case"accept":n.type=p.TYPE.ACCEPT_RECEIPT;break;case"reject":default:return}break;case"terminate":const i=_("terminate",r);n.call_id=u.default.attr("call-id",i)||"",n.type=p.TYPE.TERMINATE;break;default:const a=function(e){const t=u.default.firstChild(e);if(!t)throw new Error("voip_signaling:Failed to get first child node");return t}(r);n.call_id=u.default.attr("call-id",a)}return(null==n?void 0:n.call_id)&&this.createCommonHeader(n),n}catch(e){return void __LOG__(3)`Error parsing voip signaling message`}},parseCallOffer:function(e,t,n){if(t.type=p.TYPE.OFFER,t.call_id=u.default.attr("call-id",e)||"",n){const n=_("call",e),i=u.default.children(n);if(i instanceof ArrayBuffer){var r;const e=(0,o.decodeProtobuf)(c.MessageSpec,i);(null===(r=e.call)||void 0===r?void 0:r.callKey)?this.receiveCallOfferKey(e.call.callKey,t):__LOG__(3)`voip_signaling:invalid messageProto.call`}else __LOG__(3)`voip_signaling:invalid serializedMessage`}else t.enc=this.parseRawE2EMaterial(e);const i=u.default.children(e,"video");t.video_count=Array.isArray(i)?i.length:void 0,t.isVideoCall=!!t.video_count,t.isGroupCall_DEPRECATED=!!t.group_info;const a=u.default.attr("t",e);a&&(t.t=a)},parseRawE2EMaterial:function(e){const t=u.default.child("enc",e);if(t)return(0,a.decodeB64ToJsArray)(u.default.dataStr(t));__LOG__(3)`voip_signaling:enc node not present`},receiveCallOfferKey:function(e,t){t&&(t[2]=Array.prototype.slice.call(new Uint8Array(e)))},createCommonHeader(e){e.common=(0,i.default)(e,["type","call_id","peer_jid"])}};function _(e,t){const n=u.default.child(e,t);if(!n)throw new Error(`voip_signaling:Failed to get child node ${e}`);return n}t.VoipSignaling=h},43067:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.arrayToB64Recursively=o,t.cdataArrayBuffer=s,t.cdataB64=l,t.formatCallSignalingMsg=function(e,t){var n;const r=t.common.peer_jid;o(t.payload,!1);const i=t.payload;return["call",{from:null===(n=(0,a.getMaybeMeUser)())||void 0===n?void 0:n.toString({legacy:!0}),to:r,id:e},[i]]};var r=n(15688),i=n(8584),a=n(99234);function o(e,t){const n=e[2];Array.isArray(n)&&n.forEach((e=>{e&&(e[2]instanceof Array&&!(e[2][0]instanceof Array)?e[2]=t?s(new Uint8Array(e[2])):l(new Uint8Array(e[2])):e[2]&&o(e,t))}))}function s(e){return e instanceof Uint8Array?e.buffer:e instanceof ArrayBuffer?e:e instanceof i.Binary?e.readBuffer():void 0}function l(e){return e instanceof Uint8Array||e instanceof ArrayBuffer?(0,r.encodeB64)(e):e instanceof i.Binary?(0,r.encodeB64)(e.readBuffer()):void 0}},86875:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.instance=void 0;var i=r(n(81109)),a=r(n(48926)),o=n(15688),s=n(81484),l=n(81576),c=n(11141),d=n(87614),u=r(n(45095)),p=r(n(47259)),f=n(20461),h=n(51737),_=n(31914),g=n(92574),m=(n(10206),k(n(35232))),y=r(n(89867)),E=n(45454),S=n(84902),v=n(83657),T=n(9978),b=k(n(53614)),C=n(24808),A=r(n(41090)),P=n(7293),M=n(90667),O=n(6822),I=n(77113),w=k(n(98250)),R=n(43067),D=n(21224),L=n(65044);function N(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(N=function(e){return e?n:t})(e)}function k(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=N(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}return r.default=e,n&&n.set(e,r),r}let U,G;function x(e){return function(){if(!U)return Promise.reject(new m.ProtoVersionUndefined(`wap:${e}:not connected to phone yet`));const t=U[e];return t?t.apply(U,arguments):Promise.reject(new Error(`wap:${e}:unsupported`))}}const B=x("sendPresenceUpdate"),F=x("sendChatstateUpdate");const j=new class{constructor(){this.setSharedSecret=(0,f.promiseWrapSync)(function(){var e=(0,a.default)((function*(e){__LOG__(2)`Wap:saveSharedSecret start`;const t=(0,u.default)((0,o.decodeB64ToJsArray)(e),"decodeB64ToJsArray(payload)"),n=t.slice(0,32),r=t.slice(64),i=w.get().keyPair,a=(0,u.default)(i,"keyPair").privKey,d=yield b.sharedSecret(n,a).then((e=>(0,l.extractAndExpand)(e,"",80))),p=new Uint8Array(d,0,32),f=new Uint8Array(d,32,32),h=new Uint8Array(d,64,16),_=new Uint8Array(n.concat(r)),g=yield(0,c.hmacSha256)(f,_),m=(0,o.encodeB64)(g),y=(0,o.encodeB64)(t.slice(32,64));if(y!==m)return void __LOG__(3)`Wap:saveSharedSecret hmac mismatch ${y} ${m}`;const E=yield(0,s.aesCbcDecrypt)(p,h,new Uint8Array(r)),S=new Uint8Array(E,0,32),v=new Uint8Array(E,32,32);w.setSecretKeys("0.1",S,v),__LOG__(2)`Wap:saveSharedSecret done`}));return function(){return e.apply(this,arguments)}}()),this.addContact=x("addContact"),this.groupMetadataFindFromPhone=x("groupMetadataFindFromPhone"),this.resyncMessages=x("resyncMessages"),this.resyncReceipts=x("resyncReceipts"),this.queryReceivedActions=x("queryReceivedActions"),this.addParticipants=x("addParticipants"),this.changeSubject=x("changeSubject"),this.createGroup=x("createGroup"),this.leaveGroup=x("leaveGroup"),this.removeParticipants=x("removeParticipants"),this.promoteParticipants=x("promoteParticipants"),this.demoteParticipants=x("demoteParticipants"),this.setGroupDescription=x("setGroupDescription"),this.setGroupProperty=x("setGroupProperty"),this.setGroupEphemeralDuration=x("setGroupEphemeralDuration"),this.requestMediaReupload=x("requestMediaReupload"),this.sendMedia=x("sendMedia"),this.mediaUpload=x("mediaUpload"),this.sendConversationSeen=x("sendConversationSeen"),this.sendConversationUnseen=x("sendConversationUnseen"),this.sendConversationClear=x("sendConversationClear"),this.sendConversationDelete=x("sendConversationDelete"),this.sendConversationArchive=x("sendConversationArchive"),this.sendConversationMute=x("sendConversationMute"),this.sendConversationNotSpam=x("sendConversationNotSpam"),this.sendConversationPin=x("sendConversationPin"),this.sendConversationDismissChangeNumber=x("sendConversationDismissChangeNumber"),this.sendMessagePlayed=x("sendMessagePlayed"),this.sendMessageDelete=x("sendMessageDelete"),this.sendMessageStarred=x("sendMessageStarred"),this.sendUnstarAll=x("sendUnstarAll"),this.sendSetPicture=x("sendSetPicture"),this.deletePicture=x("deletePicture"),this.sendSetStatus=x("sendSetStatus"),this.setPushname=x("setPushname"),this.statusQuery=x("statusQuery"),this.sendStatusSeen=x("sendStatusSeen"),this.statusQueryThumbnail=x("statusQueryThumbnail"),this.sendSetBlock=x("sendSetBlock"),this.sendSpamReport=x("sendSpamReport"),this.chatFindQuery=x("chatFindQuery"),this.contactFindQuery=x("contactFindQuery"),this.queryIdentity=x("queryIdentity"),this.queryVname=x("queryVname"),this.msgCreateRecord=x("msgCreateRecord"),this.msgFindQuery=x("msgFindQuery"),this.queryLinkPreview=x("queryLinkPreview"),this.queryVcard=x("queryVcard"),this.queryMsgInfo=x("queryMsgInfo"),this.recentEmojiQuery=x("recentEmojiQuery"),this.clearBPQueue=x("clearBPQueue"),this.parseWebMessageInfo=x("parseWebMessageInfo"),this.subscribeLiveLocation=x("subscribeLiveLocation"),this.unsubscribeLiveLocation=x("unsubscribeLiveLocation"),this.queryActiveLiveLocation=x("queryActiveLiveLocation"),this.disableLiveLocation=x("disableLiveLocation"),this.findGroupPendingInvitesFromPhone=x("findGroupPendingInvitesFromPhone"),this.acceptGroupV4Invite=x("acceptGroupV4Invite"),this.revokeGroupV4Invite=x("revokeGroupV4Invite"),this.sendCallOffer=x("sendCallOffer"),this.queryCall=x("queryCall"),this.sendCallEnd=x("sendCallEnd"),this.queryLabels=x("queryLabels"),this.queryNextLabelColor=x("queryNextLabelColor"),this.queryLabelPalette=x("queryLabelPalette"),this.addOrRemoveLabels=x("addOrRemoveLabels"),this.deleteLabel=x("deleteLabel"),this.createLabel=x("createLabel"),this.editLabel=x("editLabel"),this.queryQuickReplies=x("queryQuickReplies"),this.flushQuickReplyCounts=x("flushQuickReplyCounts"),this.queryStickerPacks=x("queryStickerPacks"),this.queryStickersInStickerPack=x("queryStickersInStickerPack"),this.queryRecentStickers=x("queryRecentStickers"),this.queryStarredStickers=x("queryStarredStickers"),this.queryVideoPlaybackUrl=x("queryVideoPlaybackUrl"),this.queryNoticeState=x("queryNoticeState"),this.querySettings=x("querySettings"),this.setArchiveSetting=x("setArchiveSetting"),this.queryDisappearingMode=x("queryDisappearingMode"),this.sendMdOptIn=x("sendMdOptIn")}isInitialized(){return!!G}setVersion(e,t,n){const r=e[0],a=e[1],o=[r,a,t,n].join("."),s=G!==o;if(__LOG__(2)`wap:setVersion ${o} set: ${String(s)}`,!s)return;const l=U;switch(r){case 0:switch(a){case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 11:case 12:case 13:case 14:case 15:case 16:throw __LOG__(3)`wap:setVersion deprecated version: ${o}`,new m.DeprecatedProtocolVersion("wap_deprecated_version");case 17:U=(0,i.default)({},I.protoMap[a]),U.setSubProtocol(t);break;default:U=void 0}}if(!U)throw __LOG__(3)`wap:setVersion unknown version. attempting to update`,new m.UpdateImmediately("wap_unknown_version");G=o,U.supportsFeatureFlags&&this.processFeatureFlags(n),l&&U&&U.upgradeProtoVersion(l)}processFeatureFlags(e){if(!e)return;const t=(0,u.default)(U,"protoVersion"),n=t.implementedFeatures||{},r=(0,S.decodeProtobufWithUnknowns)(D.WebFeaturesSpec,(0,o.decodeB64)(e)),i=(0,S.getUnknownFields)(r);delete r.unsafeUnknownFields;for(const e in n)P.GK.setFeatureFromFlags(e,D.WebFeaturesFlag.FORCE_UPGRADE,D.WebFeaturesFlag.FORCE_UPGRADE);const a=Object.keys(D.WebFeaturesSpec.internalSpec),s=Object.keys(r);a.forEach((e=>{const t=(0,P.getProtobufFeatureName)(e);!s.includes(e)&&P.GK.supportsFeature(t)&&P.GK.setFeature(t,!1)}));for(const e in r){if(n[e])continue;const i=r[e],a=A.default[e];if(i===D.WebFeaturesFlag.FORCE_UPGRADE&&a!==D.WebFeaturesFlag.FORCE_UPGRADE)throw __LOG__(3)`wap:features:${e} phone value is ${i} and web value is ${a}. updating...`,new m.UpdateImmediately("wap_feature_force_upgrade");if(P.GK.setFeatureFromFlags(e,a,i),P.GK.supportsFeatureFromFlags(e)){const n=I.protoMap.features[e];n&&Object.assign(t,n)}}for(const e in i){const t=i[e];if("number"==typeof t&&D.WebFeaturesFlag.cast(t)===D.WebFeaturesFlag.FORCE_UPGRADE)throw __LOG__(3)`wap:features:unknown: ${e}: ${t}`,new m.UpdateImmediately("wap_feature_implemented_unknown")}}delete(){const e=U?U.delete.apply(U,arguments):void 0;return U=void 0,G=void 0,__LOG__(2)`wap:unsetVersion, which should only happen when logout`,e}cannotReachPhone(){U&&U.cannotReachPhone.apply(U,arguments)}handle(e,t,n,r){return(0,u.default)(U,"protoVersion").handle.apply(U,[e,t,n,r])}queryServerProps(){return L.Socket.sendEphemeral2({data:["query","props"],retryOn5xx:!1})}resyncPictures(e){const t=e.filter((e=>y.default.isWid(e.id)));return 0===t.length?Promise.resolve([]):L.Socket.sendEphemeral2({data:["query","resumePic",t],retryOn5xx:!0})}setRememberMe(e){return L.Socket.sendBasic({data:["admin","remember",!!e]})}queryMediaConnections(e){const t=new Date,n=L.Socket.send2({data:["query","mediaConn"]}).then((e=>{if(__LOG__(2,!0)`queryMediaConnections result: ${JSON.stringify(e)}`,200!==e.status){if(e.status>=400)throw new g.ServerStatusCodeError(e.status,"queryMediaConnections");throw new g.ServerStatusCodeError(e.status,"Invalid return status")}const{media_conn:n}=e;if(!(n&&n.auth&&n.ttl&&n.hosts&&Array.isArray(n.hosts)&&0!==n.hosts.length))throw __LOG__(2)`wap:queryMediaConnections mediaConn exists ${String(!!n)}`,n&&(__LOG__(2)`wap:queryMediaConnections mediaConn.auth exists ${String(!!n.auth)}`,__LOG__(2)`wap:queryMediaConnections mediaConn.ttl exists ${String(!!n.ttl)}`,__LOG__(2)`wap:queryMediaConnections mediaConn.hosts exists ${String(!!n.hosts)}`,__LOG__(2)`wap:queryMediaConnections mediaConn.hosts isArray ${String(Array.isArray(n.hosts))}`,n.hosts&&__LOG__(2)`wap:queryMediaConnections mediaConn.hosts.length ${n.hosts.length}`),__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("wap:queryMediaConnections unexpected mediaConn"),new Error("Invalid mediaConn");const{auth:r,auth_ttl:a,ttl:o,max_buckets:s}=n;return{auth:r,authTTL:a,hosts:n.hosts.map((e=>{var t;const n=null===(t=e.rules)||void 0===t?void 0:t.map((e=>e.download_buckets?{downloadBuckets:e.download_buckets}:e));return(0,i.default)((0,i.default)({},e),{},{rules:n})})),queryStartTime:t,ttl:o,maxBuckets:s}}));return(0,p.default)(n,e)}acceptGroupInvite(e){return L.Socket.send2({data:["action","invite",e],retryOn5xx:!0})}revokeGroupInvite(e){return L.Socket.send2({data:["action","inviteReset",e],retryOn5xx:!0})}contactFindBroadcast(e){return L.Socket.send2({data:["query","contact",e],retryOn5xx:!0})}commonGroupsFind(e){return y.default.isServer(e)?Promise.resolve({status:200,groups:[]}):L.Socket.send2({data:["query","group","common",e]})}getCapabilities(e){return L.Socket.send2({data:["query","caps",e.filter(y.default.isUser)],retryOn5xx:!0})}queryExist(e){return y.default.isUser(e)?L.Socket.send2({data:["query","exist",e],retryOn5xx:!0}):Promise.resolve({status:400})}queryCtwaContext(e,t,n){return(0,a.default)((function*(){var r,i,a,o;const s={accountNumber:(0,E.createWid)(e).toString({legacy:!0}),code:t,expectedSourceUrl:n,id:(0,_.generateId)()},l=yield L.Socket.send2({data:["query","ctwa",s],retryOn5xx:!0});if(200!==l.status)throw new g.ServerStatusCodeError(l.status,`queryCtwaContext:fail ${l.status}`);const c={sourceId:l.data.source.id,sourceType:l.data.source.type,sourceUrl:l.data.source.url,description:l.data.body,title:l.data.headline,mediaType:(null===(r=l.data.video)||void 0===r?void 0:r.url)?C.ContextInfo$ExternalAdReplyInfoMediaType.VIDEO:C.ContextInfo$ExternalAdReplyInfoMediaType.IMAGE,isSuspiciousLink:l.data.source.url!==n,thumbnailUrl:null===(i=l.data.thumbnail)||void 0===i?void 0:i.url,mediaUrl:null===(a=l.data.video)||void 0===a?void 0:a.url};return(null===(o=l.data.thumbnail)||void 0===o?void 0:o.bytes)&&(c.thumbnail=l.data.thumbnail.bytes),c}))()}queryBusinessProfile(e,t){return(0,a.default)((function*(){const n=yield L.Socket.send2({data:["query","businessProfile",e.filter((e=>y.default.isUser(e.wid))),t],retryOn5xx:!0});switch(n.status){case 200:return n.profiles;default:throw new Error(`queryBusinessProfile:fail ${n} ${n.status}`)}}))()}queryMerchantCompliance(e){return(0,a.default)((function*(){const t=yield L.Socket.send2({data:["query","merchantCompliance",e.filter((e=>y.default.isUser(e.wid)))],retryOn5xx:!0});switch(t.status){case 200:return t.compliance_infos;default:throw new Error(`queryMerchantCompliance:fail ${t} ${t.status}`)}}))()}queryBusinessCategories(e){return(0,a.default)((function*(){const t={id:(0,_.generateId)(),query:e},n=yield L.Socket.send2({data:["query","businessCategories",t],retryOn5xx:!0});switch(n.status){case 200:const e=n.data.not_a_biz[0],t=e.id,r=n.data.categories.reduce(((t,n)=>(n.id!==e.id&&t.push({id:n.id,localized_display_name:n.name}),t)),[]);return r.unshift({id:t,localized_display_name:e.name,not_a_biz:!0}),{categories:r,notABizId:t};default:throw new Error(`queryBusinessCategories:fail ${n} ${n.status}`)}}))()}queryOrder(e,t,n,r){return(0,a.default)((function*(){const i={id:(0,_.generateId)(),orderId:e,imageWidth:t.toString(),imageHeight:n.toString(),token:r},a=yield L.Socket.send2({data:["query","order",i],retryOn5xx:!0});switch(a.status){case 200:const{data:e}=a;try{const{currency:t,subtotal:n,total:r,tax:i}=e.price,a=parseInt(e.creationTS,10);return{currency:t,createdAt:a,products:e.products.map((e=>{var t,n;return{id:e.id,price:e.price,thumbnailId:null===(t=e.image)||void 0===t?void 0:t.id,thumbnailUrl:null===(n=e.image)||void 0===n?void 0:n.url,currency:e.currency,name:e.name,quantity:parseInt(e.quantity||0,10)}})),subtotal:n,total:r,tax:i}}catch(e){throw new g.ServerStatusCodeError(a.status,`queryOrder:response malformed ${a.status}`)}case 404:throw new g.E404;default:throw new g.ServerStatusCodeError(a.status,`queryOrder:fail ${a.status}`)}}))()}createOrder(e,t){return(0,a.default)((function*(){const n={product:t.map((e=>({id:e.id,name:e.name,quantity:(0,h.isNumber)(e.quantity)?e.quantity.toString():void 0,price:(0,h.isNumber)(e.priceAmount1000)?e.priceAmount1000.toString():void 0,currency:e.currency}))),bizJID:e,id:(0,_.generateId)()},r=yield L.Socket.send2({data:["action","createOrder",n],retryOn5xx:!0});if(200===r.status)return r.data;throw new g.ServerStatusCodeError(r.status,`createOrder:fail wap action return status: ${r.status}`)}))()}refreshCart(e,t,n,r){return(0,a.default)((function*(){const i=t.map((e=>({id:e}))),a={id:(0,_.generateId)(),products:i,bizJID:y.default.user(e),imageDimensions:{width:n.toString(),height:r.toString()}},o=yield L.Socket.send2({data:["action","refreshOrder",a],retryOn5xx:!0});if(200===o.status)return o.data;throw new g.ServerStatusCodeError(o.status,`refreshCart:fail wap action return status: ${o.status}`)}))()}queryProductCatalog(e,t,n,r,i,o){return(0,a.default)((function*(){const a={catalogWid:e,afterCursor:t,limit:n,width:r,height:i,allowShopSource:o,type:"get_product_catalog_reh",stanza_id:(0,_.generateId)()},s=yield L.Socket.send2({data:["query","bizCatalog",a],retryOn5xx:!0});switch(s.status){case 200:return"string"==typeof s.data||s.data instanceof String?JSON.parse(s.data):s.data;default:throw new g.ServerStatusCodeError(s.status,`queryProductCatalog:fail ${s.status}`)}}))()}queryProductList(e,t,n,r){return(0,a.default)((function*(){const i={catalogWid:e,product_ids:t,width:""+n,height:""+r,stanza_id:(0,_.generateId)()},a=yield L.Socket.send2({data:["action","getProductList",i],retryOn5xx:!0});switch(a.status){case 200:return a.data.data;default:throw new g.ServerStatusCodeError(a.status,`queryProductList:fail ${a.status}`)}}))()}queryProduct(e,t,n,r,i){return(0,a.default)((function*(){const a={catalogWid:e,productID:t,width:n,height:r,fetchComplianceInfo:i,type:"get_product_reh",stanza_id:(0,_.generateId)()},o=yield L.Socket.send2({data:["query","bizCatalog",a],retryOn5xx:!0});switch(o.status){case 200:const e="string"==typeof o.data||o.data instanceof String?JSON.parse(o.data):o.data.product;return e.compliance_category===O.ProductComplianceCategory.CountryOriginExempt&&(e.compliance_info={country_code_origin:String(T.SyntheticCountryCode.NotApplicable)}),{data:e};case 404:case"not_found":return{error:"NOT_FOUND"};default:throw new g.ServerStatusCodeError(o.status,`queryProduct:fail ${o.status}`)}}))()}reportBusinessCatalogProduct(e,t,n){return(0,a.default)((function*(){const r={id:t,jid:e.toString(),reason:n,stanza_id:(0,_.generateId)()},i=yield L.Socket.send2({data:["action","reportProduct_reh",r],retryOn5xx:!0});if(200!==i.status)throw new g.ServerStatusCodeError(i.status,`reportBusinessCatalogProduct:fail ${i.status}`)}))()}deleteBusinessCatalogProduct(e){return(0,a.default)((function*(){const t=["action","deleteProduct_reh",{product_ids:e,stanza_id:(0,_.generateId)()}],n=yield L.Socket.send2({data:t,retryOn5xx:!0});if(200!==n.status)throw new g.ServerStatusCodeError(n.status,`deleteBusinessCatalogProduct:fail ${n.status}`);return{deletedCount:n.deletedCount}}))()}createBusinessCatalog(){return(0,a.default)((function*(){const e=["action","createCatalog_reh",{stanza_id:(0,_.generateId)()}],t=yield L.Socket.send2({data:e,retryOn5xx:!0});if(200!==t.status)throw new g.ServerStatusCodeError(t.status,`createBusinessCatalog:fail ${t.status}`)}))()}getComplianceInfoRequestParams(e){const{complianceInfo:t}=e,{isExempt:n,hasCountryCodeOrigin:r,hasImporterName:i,hasImporterAddress:a}=(0,v.scanComplianceInfoForMissingData)(t);if(n||!t||!(r||i||a))return;const o={compliance_info:{}};if(t.countryCodeOrigin&&(o.compliance_info.country_code_origin=t.countryCodeOrigin),t.importerName&&(o.compliance_info.importer_name=t.importerName),t.importerAddress){const e={};t.importerAddress.street1&&(e.street1=t.importerAddress.street1),t.importerAddress.street2&&(e.street2=t.importerAddress.street2),t.importerAddress.postalCode&&(e.postal_code=t.importerAddress.postalCode),t.importerAddress.city&&(e.city=t.importerAddress.city),t.importerAddress.region&&(e.region=t.importerAddress.region),t.importerAddress.countryCode&&(e.country_code=t.importerAddress.countryCode),Object.keys(e).length>0&&(o.compliance_info.importer_address=e)}return o}editBusinessCatalogProduct(e,t,n){var r=this;return(0,a.default)((function*(){var a,o;const s=(0,i.default)({product_id:e.id,name:e.name,image_url:e.imageCdnUrl,url:e.url,additional_image_urls:e.additionalImageCdnUrl,width:t.toString(),height:n.toString(),stanza_id:(0,_.generateId)(),is_hidden:e.isHidden},r.getComplianceInfoRequestParams(e));"number"==typeof e.priceAmount1000&&(s.price=(e.priceAmount1000/10).toString(),e.currency&&(s.currency=e.currency)),e.description&&(s.description=e.description),e.retailerId&&(s.retailer_id=e.retailerId),(null===(a=e.complianceInfo)||void 0===a?void 0:a.countryCodeOrigin)===String(T.SyntheticCountryCode.NotApplicable)&&(s.compliance_category=O.ProductComplianceCategory.CountryOriginExempt);const l=yield L.Socket.send2({data:["action","editProduct_reh",s],retryOn5xx:!0});if(200===l.status)return l.data.product;throw new g.CatalogEditServerError(l.status,(0,M.parseLegacyProductErrorReason)(null==l||null===(o=l.data)||void 0===o?void 0:o.reason))}))()}editBusinessComplianceWebd(e){return(0,a.default)((function*(){var t,n,r,i,a,o,s;const l={customer_care_details:{email:null===(t=e.customerCareDetails)||void 0===t?void 0:t.email,landline_number:null===(n=e.customerCareDetails)||void 0===n?void 0:n.landlineNumber,mobile_number:null===(r=e.customerCareDetails)||void 0===r?void 0:r.mobileNumber},grievance_officer_details:{email:null===(i=e.grievanceOfficerDetails)||void 0===i?void 0:i.email,landline_number:null===(a=e.grievanceOfficerDetails)||void 0===a?void 0:a.landlineNumber,mobile_number:null===(o=e.grievanceOfficerDetails)||void 0===o?void 0:o.mobileNumber,name:null===(s=e.grievanceOfficerDetails)||void 0===s?void 0:s.name},entity_name:e.entityName,entity_type:e.entityType,entity_type_custom:e.entityTypeCustom,is_registered:e.isRegistered},c=yield L.Socket.send2({data:["action","editBusinessCompliance",l],retryOn5xx:!0});switch(c.status){case 200:return c.compliance_infos;default:throw new Error(`editBusinessCompliance:fail ${c} ${c.status}`)}}))()}addBusinessCatalogProduct(e,t,n){var r=this;return(0,a.default)((function*(){var a,o;const s=(0,i.default)({name:e.name,description:e.description||"",image_url:e.imageCdnUrl,url:e.url||"",additional_image_urls:e.additionalImageCdnUrl,retailer_id:e.retailerId||"",width:t.toString(),height:n.toString(),stanza_id:(0,_.generateId)(),is_hidden:e.isHidden},r.getComplianceInfoRequestParams(e));"number"==typeof e.priceAmount1000&&(s.price=(e.priceAmount1000/10).toString(),e.currency&&(s.currency=e.currency)),(null===(a=e.complianceInfo)||void 0===a?void 0:a.countryCodeOrigin)===String(T.SyntheticCountryCode.NotApplicable)&&(s.compliance_category=O.ProductComplianceCategory.CountryOriginExempt);const l=yield L.Socket.send2({data:["action","addProduct_reh",s],retryOn5xx:!0});if(200===l.status)return l.data.product;throw new g.CatalogEditServerError(l.status,(0,M.parseLegacyProductErrorReason)(null==l||null===(o=l.data)||void 0===o?void 0:o.reason))}))()}productVisibilitySet(e){return(0,a.default)((function*(){const t={product_visibility:e.map((e=>[e.productId,e.isHidden])),stanza_id:(0,_.generateId)()},n=yield L.Socket.send2({data:["action","productVisibilitySet",t],retryOn5xx:!0});if(200!==n.status)throw new g.ServerStatusCodeError(n.status,`productVisibilitySet:fail ${n.status}`)}))()}appealCatalogProduct(e,t){return(0,a.default)((function*(){const n={id:e,reason:t,stanza_id:(0,_.generateId)()},r=yield L.Socket.send2({data:["action","appealProduct_reh",n],retryOn5xx:!0});if(200===r.status)return!0;throw new g.ServerStatusCodeError(r.status,`appealCatalogProduct:fail ${r.status}`)}))()}groupV4InviteRequestMetadataFind(e,t,n,r,i){return L.Socket.send2({data:["query","InvitedGroupMetadata",{from:e,admin:t,code:n,expiration:r,gid:i}],retryOn5xx:!1})}groupV4InviteGrpPicThumb(e,t,n,r){return L.Socket.send2({data:["query","AddRequestGrpProfilePicThumb",{admin:e,code:t,expiration:n,gid:r}],retryOn5xx:!0})}groupMetadataFind(e){return(0,a.default)((function*(){const t=yield L.Socket.send2({data:["query","GroupMetadata",e],retryOn5xx:!0});return t.status&&t.status>=400?Promise.reject(new g.ServerStatusCodeError(t.status)):t}))()}groupInviteInfo(e){return L.Socket.send2({data:["query","invite",e],retryOn5xx:!0})}groupInviteCode(e){return L.Socket.send2({data:["query","inviteCode",e],retryOn5xx:!0})}profilePicFind(e){return y.default.isServer(e)?Promise.resolve({status:400}):L.Socket.sendEphemeral2({data:["query","ProfilePicThumb",e],retryOn5xx:!0})}profilePicFindThumbFromPhone(){return U?U.profilePicFindThumbFromPhone.apply(U,arguments):Promise.reject(new m.ProtoVersionUndefined("wap:profilePicFindThumbFromPhone:not connected to phone"))}statusFind(e){return y.default.isServer(e)?Promise.resolve({status:""}):L.Socket.sendEphemeral2({data:["query","Status",e],retryOn5xx:!0})}sendPing(){return L.Socket.send2({data:["admin","test"],retryOn5xx:!0})}sendPresenceAvailable(){return B("available")}sendPresenceUnavailable(){return B("unavailable")}sendChatstateComposing(e){return F("composing",e)}sendChatstatePaused(e){return F("paused",e)}sendChatstateRecording(e){return F("recording",e)}subscribePresence(e){return L.Socket.send2({data:["action","presence","subscribe",e],retryOn5xx:!0})}downloadImage(){return Promise.reject(new Error("Image download is not yet implemented"))}logoutToken(){return(0,a.default)((function*(){const{encKey:e,macKey:t}=w.get(),n=yield(0,c.hmacSha256)((0,u.default)(t,"macKey"),new Uint8Array((0,u.default)(e,"encKey")));return(0,o.encodeB64)(n)}))()}sendGroupCallOffer(e){return this.sendCallSignalingMsg(e)}sendCallSignalingMsg(e,t){return(0,a.default)((function*(){const n=t||(0,d.randomHex)(8),r=(0,R.formatCallSignalingMsg)(n,e);if(!r)return Promise.reject(new Error("unknown call signaling msg type"));return yield L.Socket.send2({tag:n,data:["action","call",r],retryOn5xx:!0})}))()}};t.instance=j},97951:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.attemptWithDirectConnectionRetry=function(){return l.apply(this,arguments)};var i=r(n(48926)),a=n(92574),o=r(n(15131)),s=n(884);function l(){return(l=(0,i.default)((function*(e,t){if(!(yield(0,s.isCypherNeeded)(e)))return t();const n=function(){var n=(0,i.default)((function*(){let n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const r=(yield o.default.getCypher(e,{forceRenew:n})).cypher;return t(r)}));return function(){return n.apply(this,arguments)}}();try{return yield n()}catch(e){return e instanceof a.ServerStatusCodeError&&421===e.statusCode?(__LOG__(2)`Received 421 from Direct Connection request. Renewing certificate and retrying.`,n(!0)):Promise.reject(e)}}))).apply(this,arguments)}},79235:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.queryBusinessProfile=function(e,t){const n=(0,l.getBusinessProfileQueryVersion)();let r;r=(0,o.isMDBackend)()?t?Promise.all([(0,u.default)(e,n),(0,c.getMerchantCompliance)(e)]).then(f):(0,u.default)(e,n):t?Promise.all([p.default.queryBusinessProfile(e,n),p.default.queryMerchantCompliance(e)]).then(f):p.default.queryBusinessProfile(e,n);return(0,a.attachErrorLogger)(r,"Query business profile failed")},t.queryBusinessPublicKey=function(e){if((0,o.isMDBackend)()){return(0,n(68819).getJobManager)().waitUntilCompleted(d.jobSerializers.getPublicKey(e))}return Promise.reject(new Error("This feature is only available for MD."))},t.querySignedUserInfo=function(e){if((0,o.isMDBackend)()){return(0,n(68819).getJobManager)().waitUntilCompleted(d.jobSerializers.getSignedUserInfo(e))}return Promise.reject(new Error("This feature is only available for MD."))},t.updateCartEnabled=function(e){let t;t=(0,o.isMDBackend)()?(0,s.updateCartEnabled)(e):Promise.reject(new Error("This feature is only available for MD."));return t};var i=r(n(81109)),a=n(92574),o=n(88555),s=n(8021),l=n(56149),c=n(63442),d=n(6684),u=r(n(63638)),p=r(n(56891));function f(e){let[t,n]=e;return t.map(((e,t)=>(0,i.default)((0,i.default)({},e),{},{profile:(0,i.default)((0,i.default)({},e.profile),{},{legal_entity_details:n[t]})})))}},40346:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.queryBusinessCategories=function(e){let t;const n=(0,a.phaseOutNotABusiness)();(0,o.qplPointProfileCatsView)("datasource_start"),t=(0,i.isMDBackend)()?(0,s.queryBusinessCategories)(e,n):l.default.queryBusinessCategories(e);return t.then((e=>((0,o.qplPointProfileCatsView)("datasource_end"),e))),t};var i=n(88555),a=n(57701),o=n(90166),s=n(87117),l=r(n(56891))},56149:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DIRECT_CONNECTION_FLAG=void 0,t.getBusinessProfileQueryVersion=function(){let e=247;(0,r.bizLinkedAccountsEnabled)()&&(e|=256);return i.ServerProps.webBizProfileOptions&e};var r=n(57701),i=n(64551);t.DIRECT_CONNECTION_FLAG=128},45741:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.createLabelAssociationMutations=T,t.editLabelAssociation=function(e,t){let n;if((0,c.isMDBackend)()){t.some((e=>e instanceof p.default))&&(__LOG__(4,void 0,new Error,!0)`contact model is invalid for editLabelAssociation`,SEND_LOGS("contact model is invalid for editLabelAssociation")),n=E(e,t.map((e=>e instanceof _.Msg?{labelAssociationType:h.LabelAssociationType.Message,modelId:e.id.toString(),mutationIndexSegments:(0,m.constructMsgKeySegments)(e)}:{labelAssociationType:h.LabelAssociationType.Jid,modelId:e.id.toString(),mutationIndexSegments:[e.id.toString({legacy:!0})]})))}else n=y.default.addOrRemoveLabels(e,t).then((e=>{if(200!==e.status)throw new l.ServerStatusCodeError(e.status)}));return n},t.editLabelAssociationMD=E,t.editLocalLabelAssociationMD=S;var i=r(n(48926)),a=n(50073),o=n(381),s=n(92844),l=n(92574),c=n(88555),d=n(60980),u=n(45606),p=r(n(121)),f=n(57701),h=n(82663),_=n(17304),g=n(38804),m=n(93824),y=r(n(56891));function E(e,t){return(0,f.canEditLabelAssociation)()?(0,g.lockForSync)(["label-association"],T(e,t),(()=>S(e,t))):Promise.reject(new Error("editLabelAssociation is not supported"))}function S(){return v.apply(this,arguments)}function v(){return(v=(0,i.default)((function*(e,t){const n=[],r=[];e.forEach((e=>{let{id:i,type:a}=e;t.map((e=>{let{modelId:t,labelAssociationType:o}=e;"add"===a?n.push({labelId:i,associationId:t,type:o}):r.push([i,t,o])}))}));const i=(0,h.getTable)();yield Promise.all([i.bulkCreateOrReplace(n).catch((()=>{throw __LOG__(4,!0,new Error,!0)`bulkCreateOrReplace into label association table failed`,SEND_LOGS("bulkCreateOrReplace into label association table failed when saving label associations"),new Error("bulkCreateOrReplace into label association table failed")})),i.bulkRemove(r).catch((()=>{throw __LOG__(4,!0,new Error,!0)`bulkRemove from label association table failed`,SEND_LOGS("bulkRemove from label association table failed while saving label associations"),new Error("bulkRemove form label association table failed")}))])}))).apply(this,arguments)}function T(e,t){const n=(0,s.unixTimeMs)(),r=[];return e.forEach((e=>{let{id:i,type:s}=e;t.forEach((e=>{let{labelAssociationType:t,mutationIndexSegments:l}=e;const c=t===h.LabelAssociationType.Message?u.Actions.LabelMessage:u.Actions.LabelJid;r.push({timestamp:n,collection:u.CollectionName.Regular,operation:a.SyncdMutationSyncdOperation.SET,index:JSON.stringify([c,i,...l]),version:u.LABEL_ASSOCIATION_SYNC_VERSION,binarySyncAction:(0,d.encodeProtobuf)(o.SyncActionValueSpec,{timestamp:n,labelAssociationAction:{labeled:"add"===s}}).readBuffer(),action:c})}))})),r}},21374:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addProduct=function(e,t,n){let r;T.QPL.markerPoint(b.QuickLogMarkerId.WHATSAPP_PRODUCT_SAVE,"datasource_start"),r=(0,o.isMDBackend)()?(0,c.addProductMD)(e,t,n):A.default.addBusinessCatalogProduct(e,t,n);return r.then((()=>T.QPL.markerPoint(b.QuickLogMarkerId.WHATSAPP_PRODUCT_SAVE,"datasource_end"))),r=r.then(O),r.catch((e=>{if(e instanceof a.ServerStatusCodeError&&406===e.statusCode||e instanceof a.CatalogEditServerError&&406===e.statusCode)throw e;throw __LOG__(4,!0,new Error,!0)`Add product failed, error: ${e}`,SEND_LOGS("Add product failed"),e}))},t.appealProduct=function(e,t){let n;T.QPL.markerPoint(b.QuickLogMarkerId.WHATSAPP_PRODUCT_APPEAL,"datasource_start"),n=(0,o.isMDBackend)()?(0,d.appealProductMD)(e,t):A.default.appealCatalogProduct(e,t);return n.then((()=>T.QPL.markerPoint(b.QuickLogMarkerId.WHATSAPP_PRODUCT_APPEAL,"datasource_end"))),(0,a.attachErrorLogger)(n,"Appeal product failed")},t.createCatalog=function(){let e;T.QPL.markerPoint(b.QuickLogMarkerId.WHATSAPP_CATALOG_CREATE,"datasource_start"),e=(0,o.isMDBackend)()?(0,p.createProductCatalog)():A.default.createBusinessCatalog();return e.then((()=>{T.QPL.markerPoint(b.QuickLogMarkerId.WHATSAPP_CATALOG_CREATE,"datasource_end")})),(0,a.attachErrorLogger)(e,"Create catalog failed")},t.deleteProducts=function(e){let t;T.QPL.markerPoint(b.QuickLogMarkerId.WHATSAPP_PRODUCT_DELETE,"datasource_start"),t=(0,o.isMDBackend)()?(0,f.deleteProductsMD)(e):A.default.deleteBusinessCatalogProduct(e);return t=t.then((()=>T.QPL.markerPoint(b.QuickLogMarkerId.WHATSAPP_PRODUCT_DELETE,"datasource_end"))),(0,a.attachErrorLogger)(t,"Delete product failed")},t.editProduct=function(e,t,n){let r;T.QPL.markerPoint(b.QuickLogMarkerId.WHATSAPP_PRODUCT_SAVE,"datasource_start"),r=(0,o.isMDBackend)()?(0,h.default)(e,t,n):A.default.editBusinessCatalogProduct(e,t,n);return r.then((()=>T.QPL.markerPoint(b.QuickLogMarkerId.WHATSAPP_PRODUCT_SAVE,"datasource_end"))),r=r.then(O),r.catch((e=>{if(e instanceof a.ServerStatusCodeError&&406===e.statusCode||e instanceof a.CatalogEditServerError&&406===e.statusCode)throw e;throw __LOG__(4,!0,new Error,!0)`Edit product failed, error: ${e}`,SEND_LOGS("Edit product failed"),e}))},t.mapMsgToProductModel=function(e){let t;e.businessOwnerJid&&(t=(0,s.createWid)(e.businessOwnerJid));return{catalogWid:t,id:e.productId||"",url:e.url,name:e.title,description:e.description,imageCdnUrl:e.mediaData.renderableUrl,reviewStatus:"",currency:e.currencyCode,priceAmount1000:e.priceAmount1000,salePriceAmount1000:e.salePriceAmount1000,retailerId:e.retailerId,productMsgMediaData:e.mediaData,imageCount:null!=e.productImageCount&&0!==e.productImageCount?e.productImageCount:1,fetchedFromServer:!1,t:e.t,isHidden:!1}},t.mapProductResponseToModel=O,t.parseDateValue=M,t.productVisibilitySet=function(e){let t;T.QPL.markerPoint(b.QuickLogMarkerId.WHATSAPP_PRODUCT_SET_VISIBLE,"datasource_start"),t=(0,o.isMDBackend)()?(0,E.default)(e):A.default.productVisibilitySet(e);return t.then((()=>T.QPL.markerPoint(b.QuickLogMarkerId.WHATSAPP_PRODUCT_SET_VISIBLE,"datasource_end"))),(0,a.attachErrorLogger)(t,"Product visibility change failed")},t.queryCatalog=function(e,t,n,r,i,s,l){let c;if((0,o.isMDBackend)())c=(0,u.attemptWithDirectConnectionRetry)(e,(a=>(0,S.default)({catalogWid:e,afterCursor:t,limit:n,width:r,height:i,checkmarkCollectionId:s,allowShopSource:l,directConnectionEncryptedInfo:a})));else{const a=e.toString({legacy:!0});c=A.default.queryProductCatalog(a,t,n,r,i,l)}return c.catch((e=>{if(e instanceof a.ServerStatusCodeError&&404===e.statusCode)throw e;throw __LOG__(4,!0,new Error,!0)`Query catalog failed, error: ${e}`,SEND_LOGS("Query catalog failed"),e}))},t.queryProduct=function(e,t,n,r,i,s){let l;!0===s&&(0,g.qplPointProductView)("datasource_start"),l=(0,o.isMDBackend)()?(0,u.attemptWithDirectConnectionRetry)(e,(a=>(0,v.default)(e,t,n,r,i,a))):A.default.queryProduct(e.toString({legacy:!0}),t,n,r,i);return l.then((()=>!0===s&&(0,g.qplPointProductView)("datasource_end"))),(0,a.attachErrorLogger)(l,"Query product failed")},t.queryProductList=function(e,t,r,i,s){if((0,_.commerceFeaturesDisabledBySanctions)())return Promise.reject(new a.E451);let l;if(s&&(0,g.qplPointPLMDetailsView)("datasource_start"),(0,o.isMDBackend)()){const a=n(68819).getJobManager;l=(0,u.attemptWithDirectConnectionRetry)(e,(n=>a().waitUntilCompleted(m.jobSerializers.queryProductList(e,t,n,r,i))))}else{const n=e.toString({legacy:!0});l=A.default.queryProductList(n,t,r,i)}return l.then((()=>s&&(0,g.qplPointPLMDetailsView)("datasource_end"))).catch((e=>{if(451===e.errorCode)throw new a.E451})),l},t.reportProduct=function(e,t,n){let r;T.QPL.markerPoint(b.QuickLogMarkerId.WHATSAPP_PRODUCT_REPORT,"datasource_start"),r=(0,o.isMDBackend)()?(0,C.default)(e,t,n):A.default.reportBusinessCatalogProduct(e,t,n);return r.then((()=>T.QPL.markerPoint(b.QuickLogMarkerId.WHATSAPP_PRODUCT_REPORT,"datasource_end"))),(0,a.attachErrorLogger)(r,"Report product failed")};var i=r(n(81109)),a=n(92574),o=n(88555),s=n(45454),l=r(n(30381)),c=n(93306),d=n(27534),u=n(97951),p=n(90880),f=n(15814),h=r(n(21013)),_=n(57701),g=n(90166),m=n(6684),y=n(6822),E=r(n(17728)),S=r(n(43077)),v=r(n(27678)),T=n(48870),b=n(27798),C=r(n(93374)),A=r(n(56891));function P(e){return null==e?null:(0,o.isMDBackend)()?parseInt(e,10):10*parseInt(e,10)}function M(e){return e?l.default.utc(e,l.default.ISO_8601).valueOf():null}function O(e,t){var n,r;const a=(null===(n=e.capability_to_review_status[0])||void 0===n?void 0:n.value)||"APPROVED",o={catalogWid:t,id:e.id,isHidden:e.is_hidden||!1,url:e.url||"",name:e.name,description:e.description||"",availability:null!==(r=y.ProductAvailability.cast(e.availability))&&void 0!==r?r:y.ProductAvailability.UNKNOWN,additionalImageCdnUrl:e.additional_image_cdn_urls.map((e=>e[1].value)),additionalImageHashes:e.image_hashes_for_whatsapp.slice(1),imageCdnUrl:e.image_cdn_urls[1].value,imageHash:e.image_hashes_for_whatsapp[0],reviewStatus:a,currency:e.currency,priceAmount1000:P(e.price),salePriceAmount1000:P(e.sale_price),salePriceStartDate:M(e.sale_start_date),salePriceEndDate:M(e.sale_end_date),retailerId:e.retailer_id||"",productMsgMediaData:null,imageCount:e.additional_image_cdn_urls.length+1,fetchedFromServer:!0,t:Date.now()/1e3,old:!1,canAppeal:e.whatsapp_product_can_appeal,checkmark:e.checkmark};return e.compliance_info&&(o.complianceInfo=function(e){const t={countryCodeOrigin:e.country_code_origin};e.importer_name&&(t.importerName=e.importer_name);e.importer_address&&(t.importerAddress=function(e){const t={street1:e.street1,city:e.city,countryCode:e.country_code};e.street2&&(t.street2=e.street2);e.postal_code&&(t.postalCode=e.postal_code);e.region&&(t.region=e.region);e.country_code&&(t.countryCode=e.country_code);return t}(e.importer_address));return t}(e.compliance_info)),(0,i.default)({},o)}},76892:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.updateQuickReply=function(e){let t=Promise.resolve();if((0,r.isMDBackend)()){const{id:n,shortcut:r,count:a,message:o,keywords:s}=e;t=(0,i.getQuickReplyTable)().createOrReplace({id:n,shortcut:r,count:a,message:o,keywords:s})}return t};var r=n(88555),i=n(76214)},72639:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if((0,o.isMDBackend)()){if(t){const n=s.ContactCollection.gadd(e);(0,l.updateVerifiedInfo)(n,t.verifiedName)}}else c.default.queryVname(e).catch((0,i.filteredCatch)(a.WebdDrop,(()=>{})))};var i=n(50796),a=n(92574),o=n(88555),s=n(19380),l=n(66167),c=r(n(56891))},76931:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendChatStateComposing=function(e){if((0,a.isLegacyWebdBackend)())return s.default.sendChatstateComposing(e).then((e=>{if(200!==e.status)throw new i.ServerStatusCodeError(e.status)}));return(0,o.default)(e,"composing"),Promise.resolve()},t.sendChatStatePaused=function(e){if((0,a.isLegacyWebdBackend)())return s.default.sendChatstatePaused(e).then((e=>{if(200!==e.status)throw new i.ServerStatusCodeError(e.status)}));return(0,o.default)(e,"paused"),Promise.resolve()},t.sendChatStateRecording=function(e){if((0,a.isLegacyWebdBackend)())return s.default.sendChatstateRecording(e).then((e=>{if(200!==e.status)throw new i.ServerStatusCodeError(e.status)}));return(0,o.default)(e,"recording"),Promise.resolve()};var i=n(92574),a=n(88555),o=r(n(88795)),s=r(n(56891))},91177:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.clearStorage=y,t.sendClear=function(e,t,r){if((0,d.isLegacyWebdBackend)())return m.default.sendConversationClear(e.id,t,!r).then((e=>{if(200!==e.status)throw new c.ServerStatusCodeError(e.status);return e}));return((0,h.clearOrDeleteChatSyncEnabled)()?function(){return S.apply(this,arguments)}(e,t,r):function(){return v.apply(this,arguments)}(e,r)).then(function(){var t=(0,a.default)((function*(t){if(null!=t.result&&t.result.length>0&&(0,h.receiveReactionsEnabled)()){const r=t.result,i=n(68819).getJobManager;return yield i().waitUntilPersisted(_.jobSerializers.deleteReactions(e.id.toString(),r)),t}return t}));return function(){return t.apply(this,arguments)}}())};var i=r(n(81109)),a=r(n(48926)),o=r(n(45095)),s=n(381),l=n(92844),c=n(92574),d=n(88555),u=n(84902),p=n(38342),f=r(n(69048)),h=n(57701),_=n(6684),g=n(13946),m=r(n(56891));function y(){return E.apply(this,arguments)}function E(){return(E=(0,a.default)((function*(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(n)return(0,g.queryAndRemoveMessagesInMessageRange)(e.id,n,{skipStarred:t,skipRecentSystemMessages:!1});const r=yield(0,g.getBoundsForChat)(e.id),a=yield(0,g.queryAndRemoveMessageHistory)(e.id);return null==r&&__LOG__(3)`_sendClearMD: Expected to receive boundaries for chat while clearing`,f.default.purgeRange((0,i.default)({chatId:e.id.toString()},(0,o.default)(r,"rowIdBounds"))),a}))).apply(this,arguments)}function S(){return(S=(0,a.default)((function*(e,t,r){const[{lockForMessageRangeSync:i}]=yield Promise.all([Promise.resolve().then(n.bind(n,19937))]),o=n(29867).default,c=(0,l.unixTimeMs)(),d=yield o.getClearChatMutation(c,e.id,!r);let f;return yield i(["message"],[d],(0,a.default)((function*(){var t;yield(0,p.addActiveMessageRange)(e.id.toString(),(0,p.getActiveRangeAction)("clearChat",{deleteStarred:!r}),d.binarySyncAction);const n=null===(t=(0,u.decodeProtobuf)(s.SyncActionValueSpec,d.binarySyncAction).clearChatAction)||void 0===t?void 0:t.messageRange;f=yield y(e,r,n)}))),{_duplicate:null,result:f}}))).apply(this,arguments)}function v(){return(v=(0,a.default)((function*(e,t){return{_duplicate:null,result:yield y(e,t)}}))).apply(this,arguments)}},91829:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.create=function(){return y.apply(this,arguments)};var i=r(n(81109)),a=r(n(48926)),o=n(88555),s=n(10635),l=r(n(29224)),c=n(8197),d=n(48285),u=n(69951),p=n(19380),f=n(24606),h=n(28307),_=n(75888),g=n(41566),m=n(5819);function y(){return(y=(0,a.default)((function*(e,t,r){var i;const{forceUsync:a=!1,firstIncomingMsg:y,nextPrivacyMode:v}=null!=r?r:{},T=e.isUser()&&a?yield(0,_.getOrQueryUsyncInfo)(e):null,b=null==T?e:T.wid;if(!e.equals(b)){const e=u.ChatCollection.get(b);if(null!=e)return e}let C=null,A=!1;if(null!=T&&(null===(i=T.bizInfo)||void 0===i?void 0:i.verifiedName.isApi))A=!0;else if(null==T){const t=p.ContactCollection.get(e);null!=t&&t.isEnterprise&&(A=!0)}!A&&b.isUser()&&(0,g.isDisappearingModeEnabled)()&&(C=null==y||y.id.fromMe?(0,h.getDisappearingModeSettingForChat)(b):(0,h.getDisappearingModeSettingFromMsg)(y));const P=u.ChatCollection.gadd(E(b,null!=t?t:{},C)),M=T?(0,c.getPrivacyModeFromQueryExistResponse)(T):null,O=(0,c.comparePrivacyMode)(v,M)>0?v:M,I=(0,l.default)(b,O),w=null!=C?(0,s.genDisappearingModeSystemMsg)(b,C.duration,C.initiator===f.DisappearingModeInitiator.InitiatedByMe):null;if((0,o.isLegacyWebdBackend)()){const e=n(26453).default;return e([{meta:{add:"relay"},chat:b,msg:I}]),null!=w&&e([{meta:{add:"relay"},chat:b,msg:w}]),P}yield(0,d.createChat)(b,S(P));return yield(0,m.handleSingleMsgMD)(I.from,I,false,false),null!=w&&(yield(0,m.handleSingleMsgMD)(w.from,w,false,false)),P}))).apply(this,arguments)}function E(e,t,n){let r=(0,i.default)({id:e},t);return null!=n&&(r=(0,i.default)((0,i.default)({},r),{},{ephemeralDuration:n.duration,ephemeralSettingTimestamp:n.settingTimestamp,disappearingModeInitiator:n.initiator})),r}function S(e){return{id:e.id.toString(),t:e.t,unreadCount:e.unreadCount,archive:e.archive,isReadOnly:e.isReadOnly,modifyTag:e.modifyTag,notSpam:e.notSpam,pin:e.pin,changeNumberOldJid:null!=e.changeNumberOldJid?e.changeNumberOldJid.toString():void 0,changeNumberNewJid:null!=e.changeNumberNewJid?e.changeNumberNewJid.toString():void 0,muteExpiration:e.muteExpiration,endOfHistoryTransferType:(e.endOfHistoryTransferType,e.endOfHistoryTransferType),ephemeralDuration:e.ephemeralDuration,ephemeralSettingTimestamp:e.ephemeralSettingTimestamp,disappearingModeInitiator:(e.disappearingModeInitiator,e.disappearingModeInitiator),tcToken:null!=e.tcToken?e.tcToken:void 0,tcTokenTimestamp:null!=e.tcTokenTimestamp?e.tcTokenTimestamp:void 0}}},77772:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.deleteFromStorage=function(e){return(0,E.getStorage)().lock(["chat","label-association","message"],(0,a.default)((function*(){const t=yield(0,y.getBoundsForChat)(e),[n,r,i]=yield Promise.all([(0,_.getChatTable)().remove(e.toString()),(0,y.queryAndRemoveMessageHistory)(e),v(e)]);return{chatBoundaries:t,deletedMsgIds:r}}))).then(function(){var t=(0,a.default)((function*(t){let{chatBoundaries:r,deletedMsgIds:a}=t;if(r){if(u.default.purgeRange((0,i.default)({chatId:e.toString()},r)),(0,f.receiveReactionsEnabled)()){const t=n(68819).getJobManager;yield t().waitUntilPersisted(g.jobSerializers.deleteReactions(e.toString(),a))}}else __LOG__(3)`sendConversationDelete: chat boundaries was null`}));return function(){return t.apply(this,arguments)}}())},t.sendConversationDelete=function(e,t,r){if((0,l.isLegacyWebdBackend)())return S.default.sendConversationDelete(e,t);let i=Promise.resolve({status:400,_duplicate:!1});if((0,f.clearOrDeleteChatSyncEnabled)())i=A(e,!0);else{const n=r();(t&&t.equals(n)||t===n)&&(i=A(e,!1))}return i.then(function(){var t=(0,a.default)((function*(t){if(null!=t.result&&t.result.length>0&&(0,f.receiveReactionsEnabled)()){const r=t.result,i=n(68819).getJobManager;return yield i().waitUntilPersisted(g.jobSerializers.deleteReactions(e.toString(),r)),t}return t}));return function(){return t.apply(this,arguments)}}())};var i=r(n(81109)),a=r(n(48926)),o=n(381),s=n(92844),l=n(88555),c=n(84902),d=n(38342),u=r(n(69048)),p=n(45741),f=n(57701),h=n(82663),_=n(76214),g=n(6684),m=n(54598),y=n(13946),E=n(99069),S=r(n(56891));function v(){return T.apply(this,arguments)}function T(){return(T=(0,a.default)((function*(e){if(!(0,f.canEditLabelAssociation)())return;const{labelsToUpdate:t,modelRecords:n}=yield b(e);yield(0,p.editLocalLabelAssociationMD)(t,n)}))).apply(this,arguments)}function b(){return C.apply(this,arguments)}function C(){return(C=(0,a.default)((function*(e){return{labelsToUpdate:(yield(0,m.queryLocalLabelAssociation)([{associationId:e.toString(),type:h.LabelAssociationType.Jid}])).map((e=>{let{labelId:t}=e;return{id:t,type:"remove"}})),modelRecords:[{labelAssociationType:h.LabelAssociationType.Jid,modelId:e.toString(),mutationIndexSegments:[e.toString({legacy:!0})]}]}}))).apply(this,arguments)}function A(){return P.apply(this,arguments)}function P(){return(P=(0,a.default)((function*(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const[{lockForMessageRangeSync:i},{default:l}]=yield Promise.all([Promise.resolve().then(n.bind(n,19937)),Promise.resolve().then(n.bind(n,36014))]),u=n(56928).default,p=(0,s.unixTimeMs)(),[h,g,m]=yield Promise.all([u.getDeleteChatMutation(p,e,!r),l.getPinMutation(p,!1,e),M(e)]),E=[...m];let S;return(0,f.pinChatSyncEnabled)()&&E.push(g),t&&E.push(h),yield i(["message","chat","label-association"],E,(0,a.default)((function*(){var n;t&&(yield(0,d.addActiveMessageRange)(e.toString(),(0,d.getActiveRangeAction)("deleteChat",{deleteMedia:!r}),h.binarySyncAction));const i=null===(n=(0,c.decodeProtobuf)(o.SyncActionValueSpec,h.binarySyncAction).deleteChatAction)||void 0===n?void 0:n.messageRange;i&&(S=yield(0,y.queryAndRemoveMessagesInMessageRange)(e,i),yield Promise.all([(0,_.getChatTable)().remove(e.toString()),v(e)]))}))),{status:200,_duplicate:!1,result:S}}))).apply(this,arguments)}function M(){return O.apply(this,arguments)}function O(){return(O=(0,a.default)((function*(e){if(!(0,f.canEditLabelAssociation)())return[];const{labelsToUpdate:t,modelRecords:n}=yield b(e);return(0,p.createLabelAssociationMutations)(t,n)}))).apply(this,arguments)}},11082:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.find=function(){return c.apply(this,arguments)},t.findLocal=function(){return d.apply(this,arguments)};var i=r(n(48926)),a=n(88555),o=n(68638),s=n(64448),l=r(n(56891));function c(){return(c=(0,i.default)((function*(e,t){const n=performance.now(),r=yield l.default.chatFindQuery(e,(e=>{t.binarySize=e.binarySize}));return"preempted"!==r&&(t.timing=Math.ceil(performance.now()-n),t.size=r.length),r}))).apply(this,arguments)}function d(){return(d=(0,i.default)((function*(e){if((0,a.isLegacyWebdBackend)())return null;const t=yield(0,o.getTable)().get(e);return t?(0,s.hydrateWids)(t):null}))).apply(this,arguments)}},9025:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getExisting=function(){return l.apply(this,arguments)};var i=r(n(48926)),a=n(88555),o=n(69951),s=n(11082);function l(){return(l=(0,i.default)((function*(e){const t=o.ChatCollection.get(e);if(t&&!t.stale)return t;if((0,a.isLegacyWebdBackend)())return null;const n=yield(0,s.findLocal)(e.toString());return n?o.ChatCollection.gadd(n):null}))).apply(this,arguments)}},11902:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setLastReceivedKey=function(){return Promise.resolve()}},45197:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendConversationMute=function(e,t,n){let r=Promise.resolve();if((0,a.isMDBackend)()){const n=l.default.generateMuteMutation(e,t);r=(0,s.lockForSync)(["chat"],[n],(n=>{let[r]=n;return r.merge(e.toString(),{muteExpiration:t})})).then((()=>({status:200,_duplicate:null})))}else r=o.default.sendConversationMute(e,t,n).then((e=>{if(200!==e.status)throw new i.ServerStatusCodeError(e.status);return e}));return r};var i=n(92574),a=n(88555),o=r(n(56891)),s=n(38804),l=r(n(70119))},3060:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.resyncMessages=function(){return c.apply(this,arguments)};var i=r(n(81109)),a=r(n(48926)),o=n(88555),s=n(99069),l=r(n(56891));function c(){return(c=(0,a.default)((function*(e){const t=yield l.default.resyncMessages(e);if((0,o.isMDBackend)()&&(!t.status||t.status<400)){const{data:e}=t,r=[],o=[];return e.forEach((e=>{n(69951).ChatCollection.get(e.id)?"clear"===e.type?r.push({id:e.id.toString(),t:e.t,unreadCount:e.unreadCount,archive:e.archive,isReadOnly:e.isReadOnly,modifyTag:e.modifyTag,notSpam:e.notSpam,pin:e.pin,changeNumberOldJid:e.changeNumberOldJid,changeNumberNewJid:e.changeNumberNewJid,muteExpiration:e.muteExpiration,ephemeralDuration:e.ephemeralDuration,ephemeralSettingTimestamp:e.ephemeralSettingTimestamp}):"delete"===e.type?o.push(e.id.toString()):r.push((0,i.default)((0,i.default)({},e),{},{id:e.id.toString()})):r.push((0,i.default)((0,i.default)({},e),{},{id:e.id.toString()}))})),(0,s.getStorage)().lock(["chat"],function(){var e=(0,a.default)((function*(e){let[t]=e;return yield t.bulkCreateOrMerge(r),t.bulkRemove(o)}));return function(){return e.apply(this,arguments)}}()).then((()=>t)).catch((()=>{throw __LOG__(4,!0,new Error,!0)`get storage or bulk update chats failed`,SEND_LOGS("get storage or bulk update chats failedwhen re-sync messages"),new Error("get storage or bulk update chats failed")}))}return t}))).apply(this,arguments)}},97848:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.markConversationSeen=function(e,t){if((0,s.isLegacyWebdBackend)())return Promise.resolve();return(0,u.getChatTable)().merge(e.toString(),{unreadCount:t}).catch((e=>{if(e instanceof l.DbOnLogoutAbort)throw e;throw __LOG__(4,!0,new Error,!0)`update chat table failed`,SEND_LOGS("update chat table failed when mark convestation seen"),new Error("update chat table failed")}))},t.markConversationUnseen=function(e){if((0,s.isLegacyWebdBackend)())return Promise.resolve();return(0,u.getChatTable)().merge(e.toString(),{unreadCount:-1}).catch((e=>{if(e instanceof l.DbOnLogoutAbort)throw e;throw __LOG__(4,!0,new Error,!0)`update chat table failed`,SEND_LOGS("update chat table failed when mark conversation as unseen"),new Error("update chat table failed")}))},t.sendConversationSeen=function(){return h.apply(this,arguments)},t.sendConversationUnseen=function(e,t){if((0,s.isLegacyWebdBackend)())return f.default.sendConversationUnseen(e,t).then((e=>{const{status:t}=e;if(200!==t)throw new o.ServerStatusCodeError(t)}));return Promise.all([Promise.resolve().then(n.bind(n,19937))]).then((t=>{let[{lockForMessageRangeSync:r}]=t;const i=n(64294).default,o=(0,a.unixTimeMs)();return i.getMarkChatAsReadMutation(o,!1,e).then((t=>r([],[t],(()=>(0,c.addActiveMessageRange)(e.toString(),"markChatAsRead",t.binarySyncAction)))))}))};var i=r(n(48926)),a=n(92844),o=n(92574),s=n(88555),l=n(35232),c=n(38342),d=n(48285),u=n(76214),p=n(35099),f=r(n(56891));function h(){return(h=(0,i.default)((function*(e,t,r){if((0,s.isLegacyWebdBackend)()){const n=yield f.default.sendConversationSeen(e.id,t,r),{status:i,_duplicate:a}=n;if(200!==i)throw new o.ServerStatusCodeError(i);return{_duplicate:a}}const[{lockForMessageRangeSync:i}]=yield Promise.all([Promise.resolve().then(n.bind(n,19937))]),l=n(64294).default,u=(0,a.unixTimeMs)();if(-1===r){const t=yield l.getMarkChatAsReadMutation(u,!0,e.id),n=e.id.toString();i([],[t],(()=>(0,c.addActiveMessageRange)(e.id.toString(),"markChatAsRead",t.binarySyncAction))),yield(0,d.updateChatForMarkAsReadSync)(n)}else yield(0,p.markChatRead)(e,t);return{_duplicate:!1}}))).apply(this,arguments)}},86657:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendDeleteMsgs=function(e,t,r){const f=[],h=[];if(e.forEach((e=>{f.push(e.id),h.push(String(e.rowId))})),(0,o.isLegacyWebdBackend)())return p.default.sendMessageDelete(r,f,t).then((e=>{if(200!==e.status)throw new a.ServerStatusCodeError(e.status)}));const _=s.default.getDeleteForMeMutations(e,t),g=f.map((e=>e.toString()));return(0,u.lockForSync)(["message","label-association"],_,(()=>(0,c.removeMessagesFromHistory)(g))).then(function(){var e=(0,i.default)((function*(e){if((0,l.receiveReactionsEnabled)()&&g.length>0){const e=n(68819).getJobManager;yield e().waitUntilPersisted(d.jobSerializers.deleteReactions(r.toString(),g))}return e}));return function(){return e.apply(this,arguments)}}()).catch((()=>{throw __LOG__(4,!0,new Error,!0)`remove messages from history failed`,SEND_LOGS("remove messages from history failed when send delete messages"),new Error("remove messages from history failed")}))};var i=r(n(48926)),a=n(92574),o=n(88555),s=r(n(41058)),l=n(57701),c=n(84886),d=n(6684),u=n(38804),p=r(n(56891))},69694:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendStarMsgs=function(e,t,n){if((0,a.isLegacyWebdBackend)())return c.default.sendMessageStarred(e,t.map((e=>e.id)),n).then((e=>{if(200!==e.status)throw new i.ServerStatusCodeError(e.status)}));return u(t,n)},t.sendUnstarAll=function(e,t){if((0,a.isLegacyWebdBackend)())return c.default.sendUnstarAll(t).then((e=>{if(200!==e.status)throw new i.ServerStatusCodeError(e.status)}));return u(e,!1)};var i=n(92574),a=n(88555),o=n(84886),s=n(38804),l=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=d(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(78375)),c=r(n(56891));function d(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(d=function(e){return e?n:t})(e)}function u(e,t){t||l.addUnsetActionCount(e.length);const r=n(21263).default.getStarMessageMutations(e,t);return(0,s.lockForSync)(["message"],r,(()=>t?(0,o.starMessages)(e.map((e=>e.id.toString()))).catch((()=>{throw __LOG__(4,!0,new Error,!0)`star messages failed`,SEND_LOGS("star messages failed"),new Error("star messages failed")})):(0,o.unstarMessages)(e.map((e=>e.id.toString()))).catch((()=>{throw __LOG__(4,!0,new Error,!0)`unstar messages failed`,SEND_LOGS("unstar messages failed"),new Error("unstar messages failed")}))))}},58871:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.updateLocal=function(e,t){if((0,r.isLegacyWebdBackend)())return Promise.resolve();return(0,a.getTable)().merge(e.toString(),t).catch((e=>{if(e instanceof i.DbOnLogoutAbort)throw e;throw __LOG__(4,!0,new Error,!0)`update chat table failed`,SEND_LOGS("update chat table failed when update local"),new Error("update chat table failed")}))};var r=n(88555),i=n(35232),a=n(68638)},30312:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendSetBlock=function(){return d.apply(this,arguments)};var i=r(n(48926)),a=n(92574),o=n(88555),s=n(56375),l=n(76214),c=r(n(56891));function d(){return(d=(0,i.default)((function*(e,t){if((0,o.isLegacyWebdBackend)())return c.default.sendSetBlock(e,[{jid:t}]).then((e=>{if(200!==e.status)throw new a.ServerStatusCodeError(e.status);return!(e._duplicate||200!==e.status)}));const n=e?(0,s.blockUser)(t):(0,s.unblockUser)(t);yield n.then((e=>{if(e&&null!=e.errorCode)throw new a.ServerStatusCodeError(e.errorCode,e.errorText)}));try{const n=t.toString();return e?yield(0,l.getBlocklistTable)().createOrReplace({id:n}):yield(0,l.getBlocklistTable)().remove(t.toString()),!0}catch(e){throw __LOG__(4,!0,new Error,!0)`send set block failed`,SEND_LOGS("Failed to send set block"),new Error("send set block failed")}}))).apply(this,arguments)}},45873:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setChecksum=function(e){(0,r.isMDBackend)()&&(0,i.setContactChecksum)(e);return Promise.resolve()};var r=n(88555),i=n(50313)},189:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.contactSync=function(){return c.apply(this,arguments)};var i=r(n(48926)),a=n(88555),o=n(45454),s=n(10058),l=n(76214);function c(){return(c=(0,i.default)((function*(e){if((0,a.isLegacyWebdBackend)())return;const t=yield(0,l.getContactTable)().all();if(t.length>0){const n=t.map((e=>(0,o.createWid)(e.id)));return(0,s.syncContactListInChunksJob)(n,e)}}))).apply(this,arguments)}},8071:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setFrequent=function(e){const t={};Object.keys(e).forEach((n=>{t[n]=e[n].map((e=>e.toString()))})),(0,r.isMDBackend)()&&(0,i.setFrequentContacts)(t);return Promise.resolve()};var r=n(88555),i=n(50313)},2253:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.setPresenceAvailable=function(){if((0,o.isLegacyWebdBackend)())return void p.default.sendPresenceAvailable().catch((0,i.filteredCatch)([a.WebdDrop,s.ProtoVersionUndefined],(()=>{})));(0,d.default)("available")},t.setPresenceUnavailable=function(){if((0,o.isLegacyWebdBackend)())return void p.default.sendPresenceUnavailable().catch((0,i.filteredCatch)([a.WebdDrop,s.ProtoVersionUndefined],(()=>{})));(0,d.default)("unavailable")},t.subscribePresence=function(e,t){if((0,o.isLegacyWebdBackend)())return p.default.subscribePresence(e);let n;n=e instanceof l.default?e:(0,c.createWid)(e);return Promise.resolve((0,u.default)(n,t))};var i=n(50796),a=n(92574),o=n(88555),s=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=f(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(35232)),l=r(n(89867)),c=n(45454),d=r(n(93167)),u=r(n(34083)),p=r(n(56891));function f(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(f=function(e){return e?n:t})(e)}},78426:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.profilePicFind=T,t.profilePicFindThumbFromPhone=function(){return v.apply(this,arguments)},t.profilePicResync=function(){return C.apply(this,arguments)},t.requestDeletePicture=function(){return E.apply(this,arguments)},t.sendSetPicture=function(){return S.apply(this,arguments)};var i=r(n(81109)),a=r(n(48926)),o=n(15688),s=r(n(45095)),l=n(92574),c=n(88555),d=r(n(76139)),u=n(94943),p=n(76214),f=n(41601),h=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=y(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(98250)),_=r(n(66612)),g=n(99069),m=r(n(56891));function y(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(y=function(e){return e?n:t})(e)}function E(){return(E=(0,a.default)((function*(e){let t;t=(0,c.isMDBackend)()?(0,_.default)(e,null).then((()=>({_duplicate:!1,status:200}))):m.default.deletePicture(e).then((e=>{if(e.status&&200!==e.status)throw new l.ServerStatusCodeError(e.status);return e}));const r=yield t;return r._duplicate?r:(0,c.isMDBackend)()?(0,p.getProfilePicThumbTable)().remove(e.toString()).then((()=>{(0,n(37638).changeProfilePicThumb)(e,f.PROFILE_PIC_COMMAND.REMOVE)})).then((()=>r)):r}))).apply(this,arguments)}function S(){return(S=(0,a.default)((function*(e,t,r){let i;if((0,c.isMDBackend)()){const t=d.default.parseDataURL(r).data,n=(0,o.decodeB64)(t);i=(0,_.default)(e,n).then((0,a.default)((function*(){const t=yield(0,u.getProfilePic)(e,{preview:!1});return{_duplicate:!1,tag:t.tag,eurl:t.eurl,token:"",status:200}})))}else i=m.default.sendSetPicture(e,t,r).then((e=>{if(200!==e.status)throw new l.ServerStatusCodeError(e.status);return e}));const s=yield i,h=yield A(e);if(s.token=h,s._duplicate)return s;if((0,c.isMDBackend)()){const t=e.toString();return(0,p.getProfilePicThumbTable)().createOrMerge(t,{id:t,tag:s.tag,eurl:s.eurl}).then((()=>{(0,n(37638).changeProfilePicThumb)(e,f.PROFILE_PIC_COMMAND.SET)})).then((()=>s))}return s}))).apply(this,arguments)}function v(){return(v=(0,a.default)((function*(e,t){const n=yield m.default.profilePicFindThumbFromPhone(e,t),r=yield A(e);if(n.token=r,(0,c.isMDBackend)()){const e=n.id.toString();return(0,p.getProfilePicThumbTable)().createOrMerge(e,{id:e,tag:n.tag,raw:n.raw}).then((()=>n))}return n}))).apply(this,arguments)}function T(){return b.apply(this,arguments)}function b(){return(b=(0,a.default)((function*(e,t){let n;n=(0,c.isMDBackend)()?Promise.all([(0,u.getProfilePic)(e,(0,i.default)((0,i.default)({},t),{},{preview:!1})),(0,u.getProfilePic)(e,(0,i.default)((0,i.default)({},t),{},{preview:!0}))]).then((e=>{const t=e[0],n=e[1];return{tag:t.tag,eurl:t.eurl,previewEurl:n.eurl,token:""}})):m.default.profilePicFind(e).then((e=>{if(null!=e.status&&200!==e.status)throw new l.ServerStatusCodeError(e.status);return e}));const r=t=>(0,g.getStorage)().lock(["profile-pic-thumb"],function(){var n=(0,a.default)((function*(n){let[r]=n;return(yield r.get(e.toString()))?r.merge(e.toString(),t):r.create(t)}));return function(){return n.apply(this,arguments)}}()),o={id:e.toString(),tag:void 0,eurl:void 0,raw:void 0,previewEurl:void 0};try{const t=yield(0,s.default)(n,"serverPromise");return A(e).then((e=>(t.token=e,(0,c.isMDBackend)()?(o.tag=t.tag,o.eurl=t.eurl,o.raw=null,o.previewEurl=t.previewEurl,r(o).then((()=>t))):t)))}catch(e){if(!(e instanceof l.ServerStatusCodeError))throw e;if((0,c.isLegacyWebdBackend)())throw e;return(0,c.isMDBackend)()&&404===e.status||(0,c.isLegacyWebdBackend)()&&401===e.status?(o.tag="",o.raw=null):(o.tag=null,o.eurl=null,o.previewEurl=null),r(o).then((()=>{throw e}))}}))).apply(this,arguments)}function C(){return(C=(0,a.default)((function*(e){if((0,c.isMDBackend)())return Promise.all(e.map(function(){var e=(0,a.default)((function*(e){try{const t=yield T(e.id);return{id:e.id,eurl:t.eurl,tag:t.tag,token:t.token,previewEurl:t.previewEurl}}catch(t){if(t instanceof l.ServerStatusCodeError)switch(t.status){case 401:case 404:return{id:e.id,tag:"",token:""};default:return __LOG__(3)`ProfilePicThumb:resyncPictures error - ${t.status}, ${t.message}`,{id:e.id,token:""}}throw t}}));return function(){return e.apply(this,arguments)}}()));const t=yield m.default.resyncPictures(e);return Array.isArray(t)?Promise.all(t.map(function(){var e=(0,a.default)((function*(e){const t=yield A(e.id);return(0,i.default)((0,i.default)({},e),{},{token:t})}));return function(){return e.apply(this,arguments)}}())):"number"==typeof t.status&&t.status>=400?(423!==t.status&&429!==t.status&&__LOG__(3)`ProfilePicThumbStore:resyncPictures error ${t.status}`,Promise.reject(new l.ServerStatusCodeError(t.status))):(__LOG__(3)`ProfilePicThumbStore:resyncPictures unknown reply`,Promise.reject(new Error("ProfilePicThumbStore:resyncPictures unknown reply")))}))).apply(this,arguments)}function A(e){if((0,c.isMDBackend)())return Promise.resolve("");const t=String(e),n=new ArrayBuffer(2*t.length),r=new Uint16Array(n);for(let e=0;e<t.length;e++)r[e]=t.charCodeAt(e);return Promise.resolve().then((()=>h.getSecurityToken(n)))}},57547:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.queryExists=function(e){const t=`+${e.toString()}`;if((0,a.isLegacyWebdBackend)())return Promise.all([l.default.queryExist(t),(0,o.isDisappearingModeEnabled)()?l.default.queryDisappearingMode(e):Promise.resolve()]).then((e=>{let[t,n]=e,r=null;if(200===t.status&&(r={wid:t.jid,biz:t.biz||!1}),null!=r&&null!=n&&200===n.status){const e=n.duration,t=n.settingTimestamp;r=(0,i.default)({disappearingMode:{duration:e,settingTimestamp:t}},r)}return r}));return(0,s.queryExist)(t)},t.queryPhoneExists=function(e){if((0,a.isLegacyWebdBackend)())return Promise.reject(new Error("Should Not Reach queryPhoneExists preMD"));return(0,s.queryExist)(e)};var i=r(n(81109)),a=n(88555),o=n(41566),s=n(71820),l=r(n(56891))},88129:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getContactsToRemove=function(e){const t=[],i={};return e.forEach((e=>{e&&(i[e.id]=!0)})),r.ContactCollection.forEach((e=>{const{id:r}=e;!(e.isUser||e.isGroup&&!n(69951).ChatCollection.get(r))||i[r.toString()]||e.isPSA||t.push(e)})),t};var r=n(19380)},26707:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendNotSpam=function(){return u.apply(this,arguments)},t.sendSpamReport=function(e,t){if((0,o.isLegacyWebdBackend)())return d.default.sendSpamReport(e.id).then((e=>{if(200!==e.status)throw new a.ServerStatusCodeError(e.status)}));return(0,c.reportSpam)(e,t).then((e=>{if(null==e?void 0:e.errorCode)throw new a.ServerStatusCodeError(e.errorCode,e.errorText)}))};var i=r(n(48926)),a=n(92574),o=n(88555),s=n(90101),l=n(76214),c=n(18701),d=r(n(56891));function u(){return(u=(0,i.default)((function*(e){return(0,o.isLegacyWebdBackend)()?d.default.sendConversationNotSpam(e.id).then((e=>{if(200!==e.status)throw new a.ServerStatusCodeError(e.status)})):(e.isGroup&&e.groupMetadata&&(yield(0,s.persistGroupMetadata)(e.groupMetadata.id,{notAddedByContact:!1})),(0,l.getChatTable)().merge(e.id.toString(),{notSpam:!0}).catch((()=>{throw __LOG__(4,!0,new Error,!0)`get chat table merge failed`,SEND_LOGS("get chat table merge failed when sending spam report"),new Error("get chat table merge failed")})))}))).apply(this,arguments)}},46898:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getStatus=function(e){if((0,s.isLegacyWebdBackend)())return p.default.statusFind(e).then((t=>({id:e,status:null!=t.status?t.status:""}))).catch((0,a.filteredCatch)(o.WebdDrop,(()=>({id:e,stale:!0,status:""}))));return(0,l.default)(e).then((e=>e.error?(__LOG__(3)`getStatus: failed ${e.error.errorCode} : ${e.error.errorText}`,{id:e.id,stale:!0,status:""}):{id:e.id,status:null!=e.status?e.status:""}))},t.queryStatusAll=function(){if((0,s.isLegacyWebdBackend)())return p.default.statusQuery();return(0,u.queryStatusAllMD)()},t.queryStatusUpdate=function(e,t,n){if((0,s.isLegacyWebdBackend)())return p.default.statusQuery(e,t,n,"after");return Promise.resolve([])},t.sendReadStatus=function(){return f.apply(this,arguments)},t.setMyStatus=function(e){if((0,s.isLegacyWebdBackend)())return p.default.sendSetStatus(e);return(0,n(68819).getJobManager)().waitUntilCompleted(c.jobSerializers.setAbout(e))};var i=r(n(48926)),a=n(50796),o=n(92574),s=n(88555),l=r(n(66457)),c=n(6684),d=n(35099),u=n(6331),p=r(n(56891));function f(){return(f=(0,i.default)((function*(e,t,n){if((0,s.isLegacyWebdBackend)()){return 200===(yield p.default.sendStatusSeen(e,t)).status}return yield(0,d.markStatusRead)(e,n),!0}))).apply(this,arguments)}},27211:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.updateLocal=function(e,t){if((0,r.isLegacyWebdBackend)())return Promise.resolve();return(0,a.getTable)().merge((0,i.toPhoneUserJid)(e.user),t)};var r=n(88555),i=n(72441),a=n(4233)},79583:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendCreateGroup=function(e,t,n,r,l,c,d,u){if((0,a.isLegacyWebdBackend)())return s.default.createGroup(e,t,n,r,l,c,d).then((e=>{if(200===e.status)return e;throw new i.ServerStatusCodeError(e.status)}));return(0,o.createGroup)(e,t,d,u).then((e=>({gid:e.wid,participants:e.participants.map((e=>({[e.wid.toString()]:{code:null!=e.error?e.error.toString():"200",invite_code:e.invite_code,invite_code_exp:e.invite_code_exp}})))})))};var i=n(92574),a=n(88555),o=n(26539),s=r(n(56891))},90447:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.markExited=function(e){if((0,a.isLegacyWebdBackend)())return Promise.resolve();return(0,o.getTable)().merge(e.toString(),{isReadOnly:!0})},t.sendExitGroup=function(e){if((0,a.isLegacyWebdBackend)())return l.default.leaveGroup(e).then((e=>{if(200!==e.status)throw new i.ServerStatusCodeError(e.status);return{_duplicate:e._duplicate}}));return(0,s.leaveGroups)([e]).then((()=>({_duplicate:null})))};var i=n(92574),a=n(88555),o=n(68638),s=n(12594),l=r(n(56891))},64808:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendJoinGroupViaInviteV4=function(e,t,n,r){return(0,o.joinGroupViaInviteV4)(e,t,n,r)},t.sendQueryGroupInviteV4=function(){return s.apply(this,arguments)},t.sendRevokeGroupInviteV4=function(e,t){return(0,o.revokeGroupInviteV4)(e,t)};var i=r(n(81109)),a=r(n(48926)),o=n(82394);function s(){return(s=(0,a.default)((function*(e,t,n,r,a){const s=yield(0,o.queryGroupInviteV4)(e,t,n,r,a);return null!=s.groupMetadata?(0,i.default)({},s.groupMetadata):{status:s.status}}))).apply(this,arguments)}},10790:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.groupMetadataFindFromPhone=function(e){if((0,l.isLegacyWebdBackend)())return p.default.groupMetadataFindFromPhone(e);return Promise.reject(new Error("groupMetadataFindFromPhone: not supported in MD_BACKEND mode"))},t.sendQueryGroup=function(){return f.apply(this,arguments)},t.sendQueryGroupInvite=function(e){if((0,l.isLegacyWebdBackend)())return p.default.groupInviteInfo(e).then((e=>{if(200!==e.status)throw new s.ServerStatusCodeError(e.status);return e}));return(0,d.queryGroupInvite)(e).then((e=>(0,i.default)({status:200},e)))},t.updateSubject=h;var i=r(n(81109)),a=r(n(48926)),o=n(51737),s=n(92574),l=n(88555),c=n(19380),d=n(85057),u=n(61051),p=r(n(56891));function f(){return(f=(0,a.default)((function*(e){let t;(0,l.isMDBackend)()?(__LOG__(2,void 0,void 0,void 0,["groups"])`querying server for groupMetadata of group id ${e.toString()}`,t=(0,u.queryGroupJob)(e,"interactive")):t=p.default.groupMetadataFind(e);try{const n=yield t;if(n.id)return h(e,n.subject),{id:n.id,owner:n.owner,creation:n.creation,desc:n.desc,descId:n.descId,descOwner:n.descOwner,descTime:n.descTime,restrict:n.restrict||!1,announce:n.announce||!1,noFrequentlyForwarded:n.noFrequentlyForwarded||!1,ephemeralDuration:n.ephemeralDuration||0,participants:n.participants,support:!0===n.support};__LOG__(3)`Store:GroupMetadata Unexpected server response`}catch(t){if(t instanceof s.ServerStatusCodeError&&t.status>=400)return{id:e,stale:!1};throw t}}))).apply(this,arguments)}function h(e,t){(0,o.isString)(t)&&c.ContactCollection.find(e).then((function(e){e.name||e.set({name:t})}))}},9530:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isConnectedAsRegistered=s,t.isLoggedIn=function(){if((0,r.isLegacyWebdBackend)())return!!(0,i.getLoginTokens)().server;return(0,a.isRegistered)()&&s()},t.setIsConnectedAsRegistered=function(e){o=e};var r=n(88555),i=n(99234),a=n(58052);let o=!1;function s(){return o}},4121:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.queryServerProps=function(){if((0,a.isLegacyWebdBackend)())return s.default.queryServerProps();return(0,o.default)().then((e=>{if(e.success)return e.result;throw new i.ServerStatusCodeError(e.errorCode,e.errorText)}))};var i=n(92574),a=n(88555),o=r(n(66501)),s=r(n(56891))},13611:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendQueryMediaConn=function(e){return(0,c.backoff)({delay:e=>{let{taskDuration:t}=e;const n=1e3*p();return Math.max(n-t,0)},signal:e},function(){var t=(0,a.default)((function*(t){let n;n=(0,l.isMDBackend)()?(0,d.queryMediaConn)(e):u.default.queryMediaConnections(e);try{const e=yield n;let{ttl:t,authTTL:r}=e;return null==r?(r=1e3*t,t=3e5):(r*=1e3,t*=1e3),(0,i.default)((0,i.default)({},e),{},{authTTL:r,ttl:t})}catch(e){if(e instanceof s.E507)throw e;if(e instanceof s.ServerStatusCodeError&&e.status>=500)return t(e);throw e}}));return function(){return t.apply(this,arguments)}}())};var i=r(n(81109)),a=r(n(48926)),o=n(37178),s=n(92574),l=n(88555),c=n(96177),d=n(78518),u=r(n(56891));const p=(0,o.createTimer)({algo:{type:"fibonacci",first:0,second:1},max:9e5,jitter:.25})},84159:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return d.apply(this,arguments)};var i=r(n(48926)),a=n(88555),o=n(16258),s=n(3151),l=r(n(56891));function c(e){if(null!=e)switch(e){case o.MediaRetryNotificationResultType.SUCCESS:return 200;case o.MediaRetryNotificationResultType.NOT_FOUND:case o.MediaRetryNotificationResultType.DECRYPTION_ERROR:return 404;case o.MediaRetryNotificationResultType.GENERAL_ERROR:return 500}return 500}function d(){return(d=(0,i.default)((function*(e){if((0,a.isLegacyWebdBackend)()){const{status:t,url:n,mediaKey:r,mediaKeyTimestamp:i,encFilehash:a,directPath:o}=yield l.default.requestMediaReupload(e);return{isMD:!1,status:t,url:n,mediaKey:r,mediaKeyTimestamp:i,encFilehash:a,directPath:o}}return s.RequestMediaReuploadManager.requestMediaReupload(e).then((e=>{let{result:t,directPath:n}=e;return{status:c(t),directPath:n,isMD:!0}}))}))).apply(this,arguments)}},97563:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.updateLocal=s,t.updateLocalAndModel=function(){return l.apply(this,arguments)};var i=r(n(48926)),a=n(88555),o=n(90981);function s(e,t){return(0,a.isLegacyWebdBackend)()?Promise.resolve():(0,o.getTable)().merge(e.toString(),t).catch((e=>{throw __LOG__(4,!0,new Error,!0)`updateLocal: failed to update in storage`,SEND_LOGS("message updateLocal failed"),e}))}function l(){return(l=(0,i.default)((function*(e,t){try{yield s(e,t);const r=n(59871).MsgCollection.get(e);r&&r.set(t)}catch(e){return Promise.reject(new Error(`[messaging] updateLocalAndModel: failed with error ${e}`))}}))).apply(this,arguments)}},25680:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getHighestAck=function(){return l.apply(this,arguments)};var i=r(n(48926)),a=n(35470),o=n(88555),s=n(17972);function l(){return(l=(0,i.default)((function*(e){if((0,o.isLegacyWebdBackend)())return Promise.reject(new Error("getHighestAck: not supported for non MD"));const t=yield s.MsgInfoCollection.find(e.id);if(!t)return __LOG__(2)`getHighestAck: no orphan ack found for ${e.id}`,null;let n=null,r=null;return 0===t.playedRemaining&&0!==t.played.length?(r=a.ACK.PLAYED,n=t.played):0===t.readRemaining&&0!==t.read.length?(r=a.ACK.READ,n=t.read):0===t.deliveryRemaining&&0!==t.delivery.length&&(r=a.ACK.RECEIVED,n=t.delivery),null==r||null==n?(__LOG__(2)`getHighestAck: orphan ack has 0 receipt for ${e.id}`,null):(__LOG__(2)`getHighestAck: orphan ack ${r} for ${e.id}`,{ack:r,t:Math.max(...n.map((e=>e.t))),to:e.to,from:e.from,deliveryPrivacyMode:t.deliveryPrivacyMode})}))).apply(this,arguments)}},76581:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.msgFindByIds=function(e){if((0,i.isLegacyWebdBackend)())return Promise.resolve([]);return(0,a.getMsgsByMsgKey)(e).catch((e=>{throw __LOG__(4,!0,new Error,!0)`msgFindByIds: failed to find msg in storage`,SEND_LOGS("msgFindByIdsMD failed"),e}))},t.msgFindQuery=function(e,t,n,r){if((0,i.isLegacyWebdBackend)())return o.default.msgFindQuery(e,t,n,r);return(0,a.msgFindQuery)(e,t).catch((e=>{throw __LOG__(4,!0,new Error,!0)`msgFindQuery: failed to find msg in storage`,SEND_LOGS("msgFindQueryMD failed"),e}))},t.queryVcard=function(e){if((0,i.isLegacyWebdBackend)())return o.default.queryVcard(e);return(0,a.queryVcard)(e).catch((e=>{throw __LOG__(4,!0,new Error,!0)`queryVcard: failed to find vCard in storage`,SEND_LOGS("queryVcardMD failed"),e}))};var i=n(88555),a=n(84886),o=r(n(56891))},28259:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendQueryMsgInfo=function(){return u.apply(this,arguments)};var i=r(n(81109)),a=r(n(48926)),o=n(92574),s=n(88555),l=n(15461),c=n(47124),d=r(n(56891));function u(){return(u=(0,a.default)((function*(e){let t;const{id:n}=e;t=(0,s.isMDBackend)()?(0,c.queryMsgInfo)(e.id).catch((e=>{throw __LOG__(4,!0,new Error,!0)`sendQueryMsgInfo: failed to find msg info in storage`,SEND_LOGS("queryMsgInfo failed"),e})):d.default.queryMsgInfo(n).then((e=>{if(e.status>=400)throw __LOG__(2)`model:MsgInfo:findQuery error ${e.status}`,new o.ServerStatusCodeError(e.status);return e}));const r=yield t;return(0,i.default)((0,i.default)({},r),{},{id:n,usePlayReceipt:e.type===l.MSG_TYPE.PTT||e.isViewOnce})}))).apply(this,arguments)}},15665:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendQueryReactions=function(){return f.apply(this,arguments)},t.updateHasReactionInParent=p;var i=r(n(81109)),a=r(n(48926)),o=n(35470),s=n(88555),l=r(n(65212)),c=n(67811),d=n(63374),u=n(97563);function p(e,t){const r=n(59871).MsgCollection.get(e);return r&&r.hasReaction!==t?(0,u.updateLocalAndModel)(r.id,{hasReaction:t}):Promise.resolve()}function f(){return(f=(0,a.default)((function*(e){if((0,s.isLegacyWebdBackend)())return Promise.reject(new Error("Not supported in non MD"));const t=yield(0,d.getReactions)(e.id.toString()).catch((e=>{throw __LOG__(4,!0,new Error,!0)`getReactions: failed to find msg info in storage`,SEND_LOGS("getReactions failed"),e})),n=t.reactions.map((e=>{const t=e.senders.map((e=>{let t=(0,i.default)((0,i.default)({},e),{},{id:l.default.fromString(e.msgKey)});return(0,c.isReactionByMe)(e.senderUserJid)&&e.ack===o.ACK.CLOCK&&(t=(0,i.default)((0,i.default)({},t),{},{isSendFailure:!0})),t}));return(0,i.default)((0,i.default)({},e),{},{hasReactionByMe:e.hasReactionByMe,id:e.aggregateEmoji,senders:t})})),r=n.length>0;return yield p(e.id.toString(),r),(0,i.default)((0,i.default)({},t),{},{id:e.id,reactions:n})}))).apply(this,arguments)}},7992:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sendDeliveryReceiptsAfterPresence=function(){if((0,r.isLegacyWebdBackend)())return;(0,i.sendDeliveryReceiptsAfterPresence)()};var r=n(88555),i=n(16927)},90298:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.createMessageSendMetric=m,t.logSuccessfulMessageSend=y,t.sendMsgRecord=function(e){if((0,s.isLegacyWebdBackend)())return g.default.msgCreateRecord(e).then((e=>{if(200!==e.status)throw new o.ServerStatusCodeError(e.status);return e}));const t=m(e);let r;e.isForwarded&&(r=function(e){const t={messageType:e.getWamMessageType(),messageMediaType:e.getWamMediaType(),mediaCaptionPresent:Boolean(e.caption),fastForwardEnabled:!0,messageIsFanout:!0,isFrequentlyForwarded:Boolean(e.isFrequentlyForwarded)};null!=e.ephemeralDuration&&(t.ephemeralityDuration=e.ephemeralDuration);if(!e.isGroupMsg){const r=(0,d.getMaybeMeUser)(),i=n(28307).getDisappearingModeSettingForUser,a=i(r);null!=a&&(t.senderDefaultDisappearingDuration=a.duration);const o=i(e.to);null!=o&&(t.receiverDefaultDisappearingDuration=o.duration)}const r=e.getWamDisappearingModeInitiator();null!=r&&(t.disappearingChatInitiator=r);return new p.default.ForwardSend(t)}(e));const{encryptAndSendMsg:i}=n(95547);return i(e).catch((t=>{if(__LOG__(3,void 0,void 0,void 0,["messaging"])`sendMsgRecord: MD send failure, msg: ${e.id.toString()}`,(0,_.updateLocalAndModel)(e.id,{isSendFailure:!0}),e.type===l.MSG_TYPE.REACTION){const t={parentMsgKey:e.reactionParentKey,msgKey:e.id,reactionText:e.reactionText,senderUserJid:e.from.toString()};(0,h.updateFailedPropsForSentReactionsDBAndModel)(t,void 0,!0)}throw t})).then((n=>(null!=n.deviceCount&&(t.deviceSizeBucket=(0,f.default)(n.deviceCount)),y(t,e),r&&E(r),{t:parseInt(n.t,10),data:null})))};var i=r(n(81109)),a=n(92844),o=n(92574),s=n(88555),l=n(15461),c=n(16116),d=n(99234),u=n(42515),p=r(n(11339)),f=r(n(16786)),h=n(76332),_=n(97563),g=r(n(56891));function m(e){const t=(0,i.default)({messageType:e.getWamMessageType(),messageMediaType:e.getWamMediaType(),mediaCaptionPresent:Boolean(e.caption),fastForwardEnabled:!0,messageIsFanout:!0,messageIsForward:Boolean(e.isForwarded),isViewOnce:Boolean(e.isViewOnce)},(0,u.getGroupMetricsFromChatWid)(e.to));if(null!=e.ephemeralDuration&&(t.ephemeralityDuration=e.ephemeralDuration),!e.isGroupMsg){const r=(0,d.getMaybeMeUser)(),i=n(28307).getDisappearingModeSettingForUser,a=i(r);null!=a&&(t.senderDefaultDisappearingDuration=a.duration);const o=i(e.to);null!=o&&(t.receiverDefaultDisappearingDuration=o.duration)}e.isRevoke&&(t.messageIsRevoke=!0,t.revokeType="admin_revoke"===e.subtype?p.default.REVOKE_TYPE.SENDER:p.default.REVOKE_TYPE.ADMIN,t.revokeDuration=e.revokeDuration);const r=e.getWamDisappearingModeInitiator();return null!=r&&(t.disappearingChatInitiator=r),new p.default.MessageSend(t)}function y(e,t){e.messageSendResult=p.default.MESSAGE_SEND_RESULT_TYPE.OK,e.messageSendResultIsTerminal=!1,E(e),(0,c.handleActivitiesForChatThreadLogging)([{activityType:"msgSend",chatId:t.id.remote,ts:(0,a.unixTime)(),isViewOnce:Boolean(t.isViewOnce)}])}function E(e){e.markMessageSendT(),e.commit()}},85195:(e,t,n)=>{"use strict";var r=n(59182).default,i=n(95318);t.Z=function(e,t){if((0,u.isLegacyWebdBackend)())return function(e,t){const n=new FormData;n.append("t",String((0,c.unixTime)())),n.append("v","2.2210.9");const r=(0,h.getLoginTokens)().server;r&&n.append("tok",r);return n.append("buffer",e),E(t,function(){var e=(0,a.default)((function*(e){const r=yield(0,f.default)(y,{method:"POST",body:n});if(200===r.status)e(void 0);else{if(r.status>=500)throw new d.ServerStatusCodeError(r.status);e(t)}}));return function(){return e.apply(this,arguments)}}())}(e,t);return function(e,t){const n=new Uint8Array((0,o.decodeB64)(e)),r=(0,c.unixTime)();return E(t,function(){var e=(0,a.default)((function*(e){const i=yield(0,g.default)(n,r);if(null==i?void 0:i.errorCode){if(i.errorCode>=500)throw new d.ServerStatusCodeError(i.errorCode,i.errorText);e(t)}e(void 0)}));return function(){return e.apply(this,arguments)}}())}(e,t)};var a=i(n(48926)),o=n(15688),s=n(13959),l=n(4352),c=n(92844),d=n(92574),u=n(88555),p=i(n(81602)),f=i(n(26847)),h=n(99234),_=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=m(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(47272)),g=i(n(13176));function m(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(m=function(e){return e?n:t})(e)}const y="https://web.whatsapp.com/wam";function E(e,t){return(0,l.promiseLoop)(function(){var n=(0,a.default)((function*(n,i,a){const o=(0,s.delayMs)(_.expBackoff(a,12e4,1e3,.1));try{return yield p.default.waitIfOffline({signal:(new r).signal}),yield t(n)}catch(t){return a>1?(__LOG__(3)`wam:sendLogs failure error: ${String(t)}`,n(e)):o}}));return function(){return n.apply(this,arguments)}}())}},24569:(e,t,n)=>{"use strict";var r=n(59182).default,i=n(95318);t.Z=function(e,t){if((0,c.isLegacyWebdBackend)()||!(0,p.getABPropConfigValue)("web_ps_v3_enabled"))return Promise.resolve(t);const n=new Uint8Array((0,o.decodeB64)(e));return i=t,h=function(){var e=(0,a.default)((function*(e){const{uploadedBufferKeys:r,metrics:i}=yield(0,u.upload_UNSAFE_INTERNAL_DO_NOT_USE)([{key:t,content:n}],f.getToken);i.map(m),0===r.length&&e(t),e(void 0)}));return function(){return e.apply(this,arguments)}}(),(0,l.promiseLoop)(function(){var e=(0,a.default)((function*(e,t,n){const a=(0,s.delayMs)(_.expBackoff(n,12e4,1e3,.1));try{return yield d.default.waitIfOffline({signal:(new r).signal}),yield h(e)}catch(t){return n>1?(__LOG__(3)`wam:sendLogs failure error: ${String(t)}`,e(i)):a}}));return function(){return e.apply(this,arguments)}}());var i,h};var a=i(n(48926)),o=n(15688),s=n(13959),l=n(4352),c=n(88555),d=i(n(81602)),u=n(14604),p=n(57849),f=n(35065),h=i(n(11339)),_=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=g(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(47272));function g(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(g=function(e){return e?n:t})(e)}function m(e){const{result:t,uploadTime:n,httpResponseCode:r}=e,i=function(e){switch(e){case"success":return h.default.PS_BUFFER_UPLOAD_RESULT.SUCCESS;case"error-server-other":return h.default.PS_BUFFER_UPLOAD_RESULT.ERROR_SERVER_OTHER;case"error-parsing":return h.default.PS_BUFFER_UPLOAD_RESULT.ERROR_PARSING;case"error-decoding":return h.default.PS_BUFFER_UPLOAD_RESULT.ERROR_DECODING;case"error-credential":return h.default.PS_BUFFER_UPLOAD_RESULT.ERROR_CREDENTIAL;case"error-other":return h.default.PS_BUFFER_UPLOAD_RESULT.ERROR_OTHER;default:return h.default.PS_BUFFER_UPLOAD_RESULT.ERROR_ACCESS_TOKEN}}(t);new h.default.PsBufferUpload({psBufferUploadResult:i,psBufferUploadT:n,psBufferUploadHttpResponseCode:r,applicationState:"visible"===document.visibilityState?h.default.APPLICATION_STATE.FOREGROUND:h.default.APPLICATION_STATE.BACKGROUND}).commit()}},70308:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.prepareRetryReceiptBridge=function(e){if((0,i.isLegacyWebdBackend)())return Promise.resolve(e);return(0,n(77723).Z)(e)},t.sendCallEndBridge=function(e,t){if((0,i.isLegacyWebdBackend)())return o.default.sendCallEnd(e,t);return Promise.resolve({})},t.sendCallOfferBridge=function(e){if((0,i.isLegacyWebdBackend)())return e.payload[2].find((e=>"enc"===e[0]))?o.default.sendCallOffer(e):o.default.sendGroupCallOffer(e);return(0,n(26775).Z)(e,a.TYPE.OFFER)},t.sendCallSignalingMsgBridge=function(e,t){if((0,i.isLegacyWebdBackend)())return o.default.sendCallSignalingMsg(e,t);return(0,n(25662).Z)(e)},t.sendEncRekeyBridge=function(e){if((0,i.isLegacyWebdBackend)())return o.default.sendCallSignalingMsg(e);return(0,n(26775).Z)(e,a.TYPE.ENC_REKEY)},t.sendQueryCallBridge=function(e,t){if((0,i.isLegacyWebdBackend)())return o.default.queryCall(e,t);return Promise.resolve({status:200})};var i=n(88555),a=n(45473),o=r(n(56891))},15183:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=e.shift(),a=t.blocklist.map((e=>({id:e}))),o=n(32826).BlocklistCollection;if((0,r.isLegacyWebdBackend)())return void o.set(a);(0,i.getBlocklistTable)().clear().then((()=>Promise.all(a.map((e=>{let{id:t}=e;return(0,i.getBlocklistTable)().create({id:t.toString()})}))))).then((()=>o.set(a)))};var r=n(88555),i=n(76214)},70257:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=e.shift(),r=n(69951).ChatCollection,I=n(59871).MsgCollection;if(Array.isArray(t)){const e=[],s=[],l=[],u=[];t.forEach((function(t){if("c.us"===t.id)s.push(t);else{const n=!!r.get(t.id),i=["delete","clear","ephemeral","archive","unarchive","star","unstar","spam","modify_tag","pin","modify"].includes(t.type);i?n&&i?s.push(t):__LOG__(2)`Model:chat:handle received junk chat record: ${JSON.stringify(t)}`:e.push(t)}}));const h=e.find((e=>f.default.isPSA(e.id)));null!=h&&(h.name=C.default.t(1022));const _=n(19011).AllStarredMsgsCollection;let g;return s.forEach((function(e){const t=e.type;if("c.us"===e.id.toString()){switch(r.disableSortListener(),t){case"clear":__LOG__(2)`Model:chat:handle:clear:all before:${String(e.before)} kind:${String(e.kind)}`,r.forEach((function(t){"number"==typeof e.before?t.deleteMsgsOlderThan(e.before,e.star,e.kind):t.deleteMsgs(e.star,e.kind)}));break;case"delete":__LOG__(2)`Model:chat:handle:delete:all`,r.toArray().forEach((function(e){e.isGroup?e.deleteMsgs(!0):l.push(e)}));break;case"archive":__LOG__(2)`Model:chat:handle:archive:all`,r.forEach((function(e){u.push({id:e.id,archive:!0,pin:void 0})}));break;case"unarchive":__LOG__(2)`Model:chat:handle:unarchive:all`,r.forEach((function(e){u.push({id:e.id,archive:!1})}));break;case"unstar":__LOG__(2)`Model:chat:handle:unstar:all`,_.delete(),r.forEach((function(e){e.unstarAll()}));break;default:__LOG__(3)`Model:chat:handle unknown ${JSON.stringify(e)}`}r.enableSortListener()}else{const n=r.get(e.id);if(!n)return;switch(t){case"ephemeral":if(null!=e.t){const t=n.getLastReceivedNonExpiredMsg(e.t);t&&(0,A.setLastReceivedKey)(n.id,t.id).then((()=>{n.lastReceivedKey=t.id}))}break;case"clear":case"star":case"unstar":if(e.keys){const n=e.keys.length,r="star"===t,i=[],a=[],o=[];let s=!1;for(let l=0;l<n;l++){let n,d,u,f,h;const _=e.keys[l];Array.isArray(_)?([n,d,u]=_,f=new p.default({fromMe:d,remote:e.id,id:n,participant:u}),h=I.get(f),h?"clear"===t?h.delete():(h.star=r,o.push(h)):r&&(s=!0)):!(0,c.default)(_)||"star"!==t&&"unstar"!==t||(f=_.id,h=I.get(_.id),h?(h.star=r,o.push(h)):a.push(_)),i.push(f&&f.toString())}"star"!==t&&"unstar"!==t||_.process(r,a,o,s),__LOG__(2)`model:Chat:handle:messages:${[t,e.id,i.join(),e.modifyTag].join()}`}else"clear"===t?("number"==typeof e.before?n.deleteMsgsOlderThan(e.before,e.star,e.kind):n.deleteMsgs(e.star,e.kind),__LOG__(2)`model:Chat:handle cleared chat:${[e.id,e.before,e.modifyTag,e.kind].join()}`):"unstar"===t&&(n.unstarAll(),__LOG__(2)`model:Chat:handle unstarred chat: ${e.id}`);isNaN(e.modifyTag)||u.push({id:e.id,modifyTag:e.modifyTag});break;case"delete":l.push(n),__LOG__(2)`model:Chat:handle deleted chat for ${String(e.id)}`;break;case"archive":u.push({id:e.id,archive:!0,pin:void 0});break;case"unarchive":u.push({id:e.id,archive:!1});break;case"spam":u.push({id:e.id,notSpam:e.notSpam});break;case"modify_tag":u.push({id:e.id,modifyTag:e.modifyTag});break;case"pin":u.push({id:e.id,pin:e.pin});break;case"modify":u.push({id:e.id,changeNumberOldJid:e.changeNumberOldJid,changeNumberNewJid:e.changeNumberNewJid})}}})),g=(0,d.isMDBackend)()?(0,P.getStorage)().lock(["chat"],function(){var t=(0,o.default)((function*(t){let[n]=t;try{return yield n.bulkCreateOrMerge(e.map((e=>(0,a.default)((0,a.default)({},e),{},{id:e.id.toString()})))),yield Promise.all(u.map((e=>{const{id:t}=e,r=(0,i.default)(e,M);n.merge(t.toString(),r)}))),n.bulkRemove(l.map((e=>e.id.toString())))}catch(e){__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("ChatHandler: bulk handle error")}}));return function(){return t.apply(this,arguments)}}()):Promise.resolve(),g.then((()=>{r.add(e,{merge:!0}),u.forEach((e=>{const{id:t}=e,n=(0,i.default)(e,O),a=r.get(t);a&&a.set(n)})),l.forEach((e=>e.delete()))}))}if("leave"===t.cmd)t.gids.forEach((function(e){const t=r.get(e);t&&(0,y.localExitGroup)(t)}));else{if("preempt"===t.cmd){let e=Promise.resolve();(0,d.isMDBackend)()&&(e=(0,h.getTable)().bulkCreateOrMerge(t.response.map((e=>(0,a.default)((0,a.default)({},e),{},{id:e.id.toString(),muteExpiration:0})))));const n=(0,S.getBridge)();return e.then((()=>n.sendAndReceive("chat_collection","add",{things:t.response,options:{merge:!0}}))).then((()=>{g.Conn.platform!==g.PLATFORMS.IPHONE&&g.Conn.platform!==g.PLATFORMS.SMBI||((0,l.default)(t.response)?n.fireAndForget("msg_collection","trigger",{name:u.COLLECTION_HAS_SYNCED}):setTimeout((()=>{n.fireAndForget("msg_collection","trigger",{name:u.COLLECTION_HAS_SYNCED})}),2500)),n.fireAndForget("chat_collection","trigger",{name:u.COLLECTION_HAS_SYNCED,args:{count:t.response.length,binarySize:t.binarySize}})}))}if("action"===t.cmd){const e=t.id,n=t.data;if("create"!==n[0]&&"introduce"!==n[0]){if(n.length<3)return void __LOG__(3)`model:chat: incorrect length of payload data for action ${JSON.stringify(t)}`;const e=t.data[0],r="unknown"===t.data[1]?null:t.data[1];let i;return i=e===v.GROUP_ACTIONS.RESTRICT||e===v.GROUP_ACTIONS.ANNOUNCE||e===v.GROUP_ACTIONS.NO_FORWARD?{action:e,value:t.data[2]}:e===v.GROUP_ACTIONS.EPHEMERAL?{action:e,duration:t.data[2]}:(0,a.default)({action:e},t.data[2]),(0,b.handleGroupActionWap)({chatId:t.id,author:r},i)}{const t=n[1],i=n[2],a=[...(0,s.default)(i.admins,(e=>({id:e,isAdmin:!0}))),...(0,s.default)(i.superadmins||[],(e=>({id:e,isAdmin:!0,isSuperAdmin:!0}))),...(0,s.default)(i.regulars,(e=>({id:e,isAdmin:!1})))];T.default.add({id:e,creation:i.creation,owner:t,participants:a,stale:!1,desc:i.desc,descId:i.descId,descTime:i.descTime,descOwner:i.descOwner,restrict:!!i.restrict,announce:!!i.announce},{merge:!0}),m.ContactCollection.add({id:e,name:i.subject},{merge:!0});const o=r.get(e);if(!o)return;const l=o.msgs.last();if(!l)return;if("gp2"===l.type&&"add"===l.subtype){const t=(0,E.getMaybeMeUser)();T.default.trigger(`group_participant_change_${t.toString()}`,e),f.default.equals(l.recipients[0],t)&&_.Cmd.alertNewMsg(l)}}}else __LOG__(3)`model:chat: unknown payload: ${JSON.stringify(t)}`}};var i=r(n(6479)),a=r(n(81109)),o=r(n(48926)),s=r(n(35161)),l=r(n(41609)),c=r(n(13218)),d=n(88555),u=n(13042),p=r(n(65212)),f=r(n(89867)),h=n(68638),_=n(88102),g=n(17239),m=n(19380),y=n(5501),E=n(99234),S=n(41796),v=n(36098),T=r(n(63928)),b=n(34648),C=r(n(14296)),A=n(11902),P=n(99069);const M=["id"],O=["id"]},32720:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=e.shift();switch(t.type){case"picture":(0,i.changeProfilePicThumb)(t.jid,t.tag);break;default:(0,r.handle)([t])}return Promise.resolve()};var r=n(98423),i=n(37638)},66405:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let t;const r=e.shift();r.id="1";const u=n(56891).default,{protoVersion:p,binVersion:f,features:h}=r;if(p){l.GK.setVersion(p);const e=l.GK.setFeatures(h);t=!!e.KEY_PARTICIPANT,u.setVersion(p,f,null==h?void 0:h.FLAGS)}if(r.initial){l.GK.setPlatform(r.platform),(0,s.setLogoutToken)(r.browserToken),r.hasOwnProperty("is24h")&&i.Clock.setIs24Hour(r.is24h);const e=r.ref,t=r.serverToken,n=r.clientToken,a=r.connected;e&&a&&t&&(0,s.setRefTok)(e,t),(0,s.setLoginTokens)({client:n,server:t});const p=r.secret?u.setSharedSecret(r.secret):Promise.resolve();return Promise.all([(0,c.requireContactCollection)(),p]).then((e=>{let[t]=e;if("true"!==r.isResponse&&d.save(),r.wid){const e=r.wid;(0,s.setMe)(e),o.Conn.trigger("me_ready"),r.pushname&&(o.Conn.pushname=r.pushname,(0,s.setPushname)(r.pushname)),t.gadd(e)}o.Conn.set(r)}))}o.Conn.connected&&t&&(__LOG__(2)`models:Conn:participantChange:to:${String(l.GK.supportsFeature(l.GK.F.KEY_PARTICIPANT))}`,a.default.hardRefresh());return o.Conn.set(r),Promise.resolve()};var i=n(40234),a=r(n(79264)),o=n(17239),s=n(99234),l=n(7293),c=n(46582),d=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=u(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(98250));function u(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(u=function(e){return e?n:t})(e)}},78496:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=e.shift();if(Array.isArray(t)){const n=e.shift();!function(e,t){const n=t&&"remove"===t.missing?(0,s.getContactsToRemove)(e):[];(0,l.mungePSAContact)(e),a.ContactCollection.add(e,{merge:!0}),n.forEach((e=>{e.unset("name"),e.unset("shortName")})),(null==t?void 0:t.checksum)&&(a.ContactCollection.setChecksum(t.checksum),__LOG__(2)`handle:Contact update checksum ${t.checksum}`);__LOG__(2)`handle:Contact updated ${e.map((e=>e.id)).join()}`}(t,n)}else"preempt"===t.cmd?function(e){(0,l.mungePSAContact)(e.response),a.ContactCollection.add(e.response,{merge:!0}),e.checksum&&(a.ContactCollection.setChecksum(e.checksum),__LOG__(2)`Store:Contact:handle update checksum ${e.checksum}`);a.ContactCollection.trigger(i.COLLECTION_HAS_SYNCED,{count:e.response.length,binarySize:e.binarySize})}(t):"frequent"===t.type?function(e){let t;delete e.type,t=(0,r.isMDBackend)()?(0,o.setFrequent)(e):Promise.resolve();t.then((()=>{a.ContactCollection.updateFrequentContacts(e)}))}(t):"sidelist"===t.type?function(e){const{notification:t,action:n,hash:r}=e,i=a.ContactCollection.resolveWidsFromHash(r);if(!i)return;"business"===t&&"profile"===n&&i.forEach((e=>{const t=a.ContactCollection.get(e);if(t)t.businessProfile&&t.businessProfile.markStale();else{const e=a.ContactCollection.getUserCount(),t=a.ContactCollection.contactHashLength();__LOG__(4,void 0,new Error,!0)`Hash: ${r} Users: ${e}, Hashes: ${t}`,SEND_LOGS("Stale wid in contact hash index")}}))}(t):__LOG__(3)`handle:Contact unknown: ${JSON.stringify(t)}`};var r=n(88555),i=n(13042),a=n(19380),o=n(8071),s=n(88129),l=n(76285)},67938:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(!Array.isArray(e))return __LOG__(4,void 0,new Error,!0)`ws2: Invalid message, not an array`,void SEND_LOGS("ws2:invalid-msg");const t=e.shift();switch(t){case"Blocklist":return void(0,i.default)(e);case"Contact":return void(0,l.default)(e);case"Props":case"ServerProps":return void n(64551).ServerProps.handle(e);case"Location":case"LiveLocation":return void n(85865).LiveLocationCollection.handle(e);case"Chat":return void(0,a.default)(e);case"Msg":return void(0,c.default)(e);case"Stream":return void(0,p.default)(e);case"Conn":return void(0,s.default)(e);case"Cmd":return void(0,o.default)(e);case"Presence":return void(0,u.default)(e);case"MsgInfo":return void(0,d.default)(e);case"BusinessProfile":return void n(93581).BusinessProfileCollection.handle(e);case"GroupMetadata":return void n(63928).default.handle(e);case"Label":return void n(16770).LabelCollection.handle(e);case"QuickReply":return void n(99662).QuickReplyCollection.handle(e);case"Call":return void n(60868).CallCollection.handle(e);case"Mute":return void n(72472).MuteCollection.handle(e);case"Status":return void n(46133).StatusCollection.handle(e);case"StatusV3":return void n(59387).StatusV3Collection.handle(e);default:__LOG__(4,void 0,new Error,!0)`ws2: Invalid type received: ${t}`,SEND_LOGS("ws2: Invalid type received")}};var i=r(n(15183)),a=r(n(70257)),o=r(n(32720)),s=r(n(66405)),l=r(n(78496)),c=r(n(26453)),d=r(n(74609)),u=r(n(82805)),p=r(n(80169))},26453:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let[t]=e;const r=n(59871).MsgCollection;function m(){return y.apply(this,arguments)}function y(){return(y=(0,i.default)((function*(e,n){let i;i=u.default.isStatusV3(t.broadcast)?new d.default({from:t.from,to:t.broadcast,id:n,selfDir:t.self||"out"}):new d.default({from:t.from,to:e,id:n,participant:t.participant,selfDir:t.self||"out"});const a=r.get(i);a?yield(0,f.updateMsgAck)(a,t.broadcast,{from:t.from,to:e,ack:t.ack,t:t.t}):(__LOG__(2)`Msg:out of order ack`,r.preAck[i]=t)}))).apply(this,arguments)}if("ack"===t.cmd){const e=[t.to];if(u.default.isBroadcast(t.to)&&t.ack===s.ACK.SENT){const n=g.default.get(t.to);n&&Array.prototype.push.apply(e,(0,a.default)(n.participants.toArray(),"id"))}const n=e.map((e=>m(e,t.id)));return Promise.all(n)}if("acks"===t.cmd){const e=t.id.map((e=>m(t.to,e)));return Promise.all(e)}if(t.msg){if(!(t.chat instanceof u.default))return Promise.resolve();const e="update"===t.meta.add;return u.default.isStatusV3(t.chat)&&!n(59387).StatusV3Collection.handleUpdate(t.msg,t.meta.checksum,e)?Promise.resolve():(t.msg.recvFresh=!0,t.msg.isNewMsg=!0,r.processMultipleMessages(t.chat,[t.msg],{add:"after",update:e,isHistory:!1}).catch((0,o.filteredCatch)(l.LogoutDrop,(()=>{}))).catch((e=>{__LOG__(4,void 0,new Error,!0)`Msg: ${String(t.msg.id)} chat: ${String(t.chat)} Error: ${e.name}, message: ${e.message}, stack: ${e.stack}`,SEND_LOGS("msg_handler: error storing/processing single message")})))}if(t.msgs){const e=t.msgs.length;if(!e)return Promise.resolve();let n=null;if(!(t.chat instanceof u.default))return Promise.resolve();const i=t.meta;i.isHistory=!0,"unread"===i.add&&(i.firstUnreadKey=new d.default({fromMe:i.unreadFromMe,remote:t.chat,id:i.unreadId,participant:i.unreadParticipant}),n=new h.ChatMsgsCollection);for(let n=0;n<e;n++){t.msgs[n].invis=!0}return _.Conn.platform!==_.PLATFORMS.IPHONE&&_.Conn.platform!==_.PLATFORMS.SMBI||r.trigger(c.COLLECTION_HAS_SYNCED),r.trigger("handle:msg_history",{count:t.msgs.length,binarySize:t.binarySize}),r.processMultipleMessages(t.chat,t.msgs,i,n).catch((0,o.filteredCatch)(l.LogoutDrop,(()=>{}))).catch((n=>{__LOG__(4,void 0,new Error,!0)`Msgs count: ${e} Chat: ${String(t.chat)} Error: ${n.name}, message: ${n.message}, stack: ${n.stack}`,SEND_LOGS("msg_handler: error storing/processing multiple messages")}))}if(t.recent){const e=t.meta,n=t.binarySize;return delete t.recent,delete t.meta,delete t.binarySize,r.trigger(c.COLLECTION_HAS_SYNCED,{count:Object.keys(t).length,binarySize:n}),e.isHistory=!0,Promise.all(Object.keys(t).map((n=>{let i;try{i=(0,p.createWid)(n)}catch(e){return Promise.resolve()}const a=t[n];a.invis=!0;const s="last"===e.add&&e.resume?new h.ChatMsgsCollection:null;r.processMultipleMessages(i,[a],e,s).catch((0,o.filteredCatch)(l.LogoutDrop,(()=>{}))).catch((()=>{__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("msg_handler: error storing recent messages")}))})))}return __LOG__(2)`************** Msg else clause. something strange is going on`,Promise.resolve()};var i=r(n(48926)),a=r(n(35161)),o=n(50796),s=n(35470),l=n(92574),c=n(13042),d=r(n(65212)),u=r(n(89867)),p=n(45454),f=n(78027),h=n(51612),_=n(17239),g=r(n(63928))},74609:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=e.shift(),{from:n,to:i,ack:a,participant:o,t:s}=t;switch(t.cmd){case"ack":r.MsgInfoCollection.updateInfo(t.id,n,i,a,o,s);break;case"acks":t.id.forEach((e=>{r.MsgInfoCollection.updateInfo(e,n,i,a,o,s)}))}};var r=n(17972)},82805:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=e.shift();return(0,i.default)(t)};var i=r(n(54248))},80169:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){switch(e[0]){case"asleep":break;case"killsw":r.Updater.killServiceWorker();break;case"update":case"update_desktop":break;default:__LOG__(3)`Stream:handle unknown cmd ${e[0]}`}};var r=n(83023)},64388:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ABPropConfigs=void 0;t.ABPropConfigs={in_app_support_v2_enabled:[233,"bool",!1],in_app_support_v2_locale_langs:[379,"string",""],in_app_support_v2_numbers:[390,"string",""],in_app_support_v2_number_prefixes:[1031,"string","15517868"],in_app_support_v2_jump_to_group:[819,"bool",!1],in_app_support_v2_jump_to_group_wait_time_in_ms:[974,"int",5e3],groups_dogfooding_ui:[308,"bool",!1],md_icdc_enabled:[309,"bool",!1],md_icdc_hash_length:[310,"int",10],played_self_enabled:[361,"bool",!1],ephemeral_24h_duration:[407,"bool",!1],disappearing_mode:[536,"bool",!1],payments_expressive_backgrounds_enabled:[605,"bool",!1],ephemeral_allow_group_members:[432,"bool",!1],business_profile_refresh_m1_enabled:[470,"bool",!1],num_days_key_index_list_expiration:[730,"int",35],num_days_before_device_expiry_check:[731,"int",7],media_reupload_limit_mb:[1098,"int",100],native_shop_preview_enabled:[636,"bool",!1],sync_archive_v2_setting:[736,"bool",!1],ptt_conversation_waveform:[637,"bool",!1],ptt_waveform_send:[746,"bool",!1],adv_v2_m4_m5:[753,"bool",!1],adv_v2_m6:[903,"bool",!1],ptt_draft_enabled:[777,"bool",!1],ptt_pausable_enabled:[871,"bool",!1],tos_3_client_gating_biz_initiated_enabled:[953,"bool",!1],tos_3_client_gating_enabled:[791,"bool",!1],tos_3_client_force_fetch_enabled:[792,"bool",!1],tos_client_state_fetch_enabled:[877,"bool",!1],tos_client_state_force_fetch_enabled:[878,"bool",!1],tos_client_state_fetch_iteration:[908,"int",0],country_client_gating_enabled:[1105,"bool",!1],system_msg_numbers_fb_branded:[1035,"string","16505434800,16503130062,16507885324,16508620604,16504228206,447710173736,16315551023,16505361212,16508129150,16315555102,16315558723,16505212669,16507885280,19032707825,0"],system_msg_numbers_fb_inc:[1036,"string",""],log_clock_skew:[1190,"bool",!1],trusted_contacts:[794,"bool",!1],trusted_contacts_sender:[995,"bool",!1],trusted_contacts_ti:[922,"bool",!1],tctoken_duration:[865,"int",604800],tctoken_num_buckets:[909,"int",4],tctoken_duration_sender:[996,"int",604800],tctoken_num_buckets_sender:[997,"int",4],reactions_receive:[827,"bool",!1],reactions_send:[828,"bool",!1],reactions_announcement_only:[1150,"bool",!1],reaction_cleanup_days:[987,"int",31],md_migration_experience:[861,"int",0],web_abprop_direct_connection_md:[869,"bool",!1],media_upload_prekeys_fetch_enabled:[907,"bool",!1],status_quick_reply_enabled:[1455,"bool",!1],ptt_remember_play_position:[952,"bool",!1],banned_shops_ux_enabled:[957,"bool",!1],group_suspend_v0_enabled:[973,"bool",!1],parent_group_view_enabled:[982,"bool",!1],parent_group_create_enabled:[1173,"bool",!1],parent_group_query_ts:[1228,"int",0],parent_group_link_limit:[1238,"int",0],cadmin_self_demote:[1286,"bool",!1],forwarded_ptt_ui_enabled:[1040,"bool",!1],shops_storefront_url_format:[1054,"string","https://www.facebook.com/%s/shop/"],message_count_logging_md_enabled:[1135,"bool",!1],dev_prop_string:[1064,"string",""],dev_prop_boolean:[1065,"bool",!1],dev_prop_int:[1066,"int",0],dev_prop_float:[1067,"float",0],order_details_from_cart_enabled:[1107,"bool",!1],order_details_custom_item_enabled:[1176,"bool",!1],order_details_from_catalog_enabled:[1212,"bool",!1],md_app_state_critical_data_processing_logging:[1187,"bool",!1],md_app_state_report_md_sync_mutation_stats:[1221,"bool",!1],order_management_enabled:[1188,"bool",!1],growth_lock_v0_enabled:[1204,"bool",!1],smart_filters_enabled_consumer:[1287,"bool",!1],smb_collections_enabled:[451,"bool",!1],consumer_collections_enabled:[582,"bool",!1],smb_collections_appeal_flow_enabled:[724,"bool",!1],smb_multi_device_awareness:[1074,"bool",!1],smb_quick_replies_v2_enabled:[875,"bool",!1],smb_ecommerce_compliance_india_m4:[1003,"bool",!1],smb_ecommerce_compliance_india_m4_5:[1192,"bool",!1],smart_filters_enabled:[1015,"bool",!1],btm_threads_logging_enabled:[1022,"bool",!1],native_commerce_threads_logging_enabled:[1034,"bool",!1],threads_logging_observe_list_enabled:[1168,"bool",!1],smb_hide_unsupported_currency_price:[1203,"bool",!1],hyperlinked_phone_numbers_enabled:[1215,"bool",!1],smb_catkit_query_version:[1229,"int",1],smb_phase_out_not_a_business:[1263,"bool",!1],smb_threads_logging_enabled:[1251,"bool",!1],smb_click_to_chat_logging_enabled:[1252,"bool",!1],smb_broadcast_logging_enabled:[1253,"bool",!1],smb_status_logging_enabled:[1254,"bool",!1],smb_biz_profile_logging_enabled:[1255,"bool",!1],smb_registration_flow_logging_enabled:[1256,"bool",!1],btm_qpl_enabled:[1272,"bool",!1],smb_multi_device_agents_enabled:[1438,"bool",!1],qpl_enabled:[212,"bool",!1],qpl_upload_delay:[215,"int",1440],qpl_sampling_as_string:[466,"string",'json:{"sampling":[]}'],qpl_initial_upload_delay:[1223,"int",5],should_deregister_on_syncd_fatal:[383,"bool",!0],group_catch_up:[559,"bool",!1],web_abprop_ctwa_context_compose_enabled:[591,"bool",!1],web_abprop_group_description_length:[592,"int",0],web_abprop_ephemeral_messages_allowed_values:[593,"string","604800"],web_abprop_collections_display:[584,"bool",!1],web_abprop_collections_management:[585,"bool",!1],web_abprop_drop_full_history_sync:[600,"bool",!1],web_abprop_business_profile_incomplete_nux_banner:[710,"bool",!1],web_abprop_product_catalog_nux_banner:[711,"bool",!1],web_abprop_click_nux_banner_migration:[712,"bool",!1],web_abprop_ecommerce_compliance_india:[717,"bool",!1],web_abprop_edit_ecommerce_compliance_india:[826,"bool",!1],drop_last_name:[726,"bool",!1],web_abprop_catalog_icon_on_top_bar:[734,"bool",!1],web_abprop_collections_nux_banner:[741,"bool",!1],nfm_rendering_enabled:[760,"bool",!1],web_abprop_nux_cart_interstitial:[761,"bool",!1],web_abprop_business_profile_refresh_status_enabled:[763,"bool",!1],web_abprop_business_profile_refresh_linked_account_enabled:[764,"bool",!1],web_abprop_business_profile_refresh_edit_cover_photo_enabled:[765,"bool",!1],web_abprop_business_profile_refresh_cover_photo_view_enabled:[766,"bool",!1],elevated_important_msg:[809,"bool",!1],web_privacy_settings:[837,"bool",!1],web_privacy_settings_v2:[1226,"bool",!1],web_status_psa:[873,"bool",!1],web_status_psa_history_sync:[1095,"bool",!1],web_2fa:[1195,"bool",!1],web_abprop_stateful_enumeration_enabled:[887,"bool",!0],web_abprop_block_catalog_creation_ecommerce_compliance_india:[894,"bool",!1],web_sticker_store:[930,"bool",!1],web_proactive_prekeys_fetch_group_size_limit:[937,"int",0],web_favorite_stickers:[962,"bool",!1],web_orchestrator_enabled_version:[984,"string","default"],web_wam_v5_enabled:[1033,"bool",!1],web_ps_v3_enabled:[1114,"bool",!1],web_shop_storefront_message:[1053,"bool",!1],web_identity_store_cache:[1078,"bool",!1],web_abprop_large_files_encryption_optimization:[1086,"bool",!1],web_send_invisible_msg_to_new_groups:[1099,"bool",!1],web_send_invisible_msg_min_group_size:[1100,"int",128],web_init_chat_batch_size:[1171,"int",100],web_init_chat_max_unread_message_count:[1172,"int",0],web_abprop_skip_file_copy_on_attach:[1174,"bool",!1],reaction_history_sync:[1179,"bool",!1],web_abprop_screen_sharing_enabled:[1189,"bool",!1],web_graphql_for_catalog_m1:[1205,"bool",!1],web_abprop_config_experiment_test:[1217,"bool",!1],web_adaptive_offline_resume_enabled:[1224,"bool",!1],web_wa_signal_enabled:[1225,"bool",!1],web_gdpr_request_account_info_enabled:[1232,"bool",!1],web_new_compose_box_input:[1243,"bool",!1],web_abprop_document_resume_upload:[1247,"bool",!1],more_reactions_option:[1322,"bool",!1],web_rotate_sender_key_if_sent:[1329,"bool",!1],web_lru_cache_optimization:[1339,"bool",!1],web_lru_cache_purge_logic_refactor:[1383,"bool",!1],companion_min_versions:[1367,"string","json:[]"],comparion_force_upgrade:[1368,"bool",!1],web_abprop_business_profile_refresh_linked_accounts_killswitch:[1351,"bool",!1],web_default_pull_mode_enabled:[1355,"bool",!1],web_abprop_chatd_login_cookie_enabled:[1371,"bool",!1],web_prekeys_fetch_first_batch_size:[1373,"float",0],md_app_state_gate_D34336913:[1379,"bool",!1],web_address_capture_message_enabled:[1385,"bool",!1],syncd_periodic_sync_days:[1400,"int",0],web_enable_hyperlinked_phone_numbers_ps_logging:[1401,"bool",!1],web_enable_push_notification_dev:[1419,"bool",!1],web_get_maybe_me_user_optimization_enabled:[1451,"bool",!1],web_should_fatal_on_missing_patch:[1461,"bool",!0],stop_abprops_traffic_in_serverprops_response:[315,"bool",!1],enable_biz_activity_report_request:[455,"bool",!1],plm_products_max_batch_fetch_size:[464,"int",18],enable_granular_reject_reasons:[550,"bool",!1],elevating_profile_names_enabled:[604,"bool",!1],enable_group_profile_editor:[689,"bool",!1],csat_message_rating:[690,"bool",!1],facebook_link_preview_use_thumbnail:[810,"bool",!1],tam_attachment_cache_compaction_enabled:[838,"bool",!1],business_threads_logging_enabled:[853,"bool",!1],private_stats_biz_view_logging_enabled:[904,"bool",!1],no_delete_message_time_limit:[1011,"bool",!1],sender_revoke_window_sender:[1333,"bool",!1],sender_revoke_window_receiver:[1334,"bool",!1],sender_revoke_ui:[1335,"bool",!1],admin_revoke_receiver:[1177,"bool",!1],admin_revoke_sender:[1292,"bool",!1],admin_revoke_history_sync_consumer:[1245,"bool",!1],admin_hfm_toggle:[1021,"bool",!1],csat_message_trigger:[1082,"bool",!1],graphql_privacy_imp_m1:[1096,"bool",!1],lthash_check_hours:[1104,"int",0],interactive_message_native_flow_killswitch:[1133,"bool",!1],sender_key_expired_logging_enabled:[1185,"bool",!1],group_size_limit:[1304,"int",257],address_capture_native_flow_killswitch:[1306,"bool",!1],commerce_sanctioned:[1319,"bool",!1],commerce_bloks_apps_mapping:[1320,"string","{}"],graphql_privacy_imp_m2:[1327,"bool",!1],nux_sync:[1343,"bool",!1],reactions_animations:[1361,"bool",!1],in_app_survey_enabled:[1377,"bool",!1],poll_creation_enabled:[1394,"bool",!1],poll_receiving_enabled:[1395,"bool",!1],poll_hide_futureproof_update_placeholders:[1405,"bool",!0],poll_name_length:[1406,"int",255],poll_option_length:[1407,"int",100],poll_option_count:[1408,"int",12],poll_offline_accuracy:[1409,"int",30],poll_cleanup_days:[1410,"int",90],group_suspend_v1_enabled:[1415,"bool",!1],smb_product_price_label:[1417,"string","control"],interactive_response_message_killswitch:[1435,"bool",!1],interactive_response_message_native_flow_killswitch:[1436,"bool",!1],client_group_participants_limit:[618,"int",257],payment_stickers_render_enabled:[812,"bool",!1],privacy_allow_contacts_except:[808,"bool",!1],primary_feature_sync:[1063,"bool",!1],privacy_narrative_v1:[1071,"bool",!1],add_dm_to_chat_overflow_menu:[1309,"bool",!1],keep_in_chat_receiver:[1352,"bool",!1],keep_in_chat_sender:[1353,"bool",!1],ddm_reversed_options:[1397,"bool",!1],pnh_historical_mapping_retention_seconds:[1429,"int",7776e3],trusted_contacts_reciprocity:[1437,"bool",!1],sticker_md_favorite_stickers_enabled:[864,"bool",!1],premium_billing_enabled:[1447,"bool",!1]}},93714:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.compareServerPropsAndABProps=function(){new Map([["web_abprop_ctwa_context_compose_enabled",["ctwaContextCompose",o.ServerProps.ctwaContextCompose]],["web_abprop_group_description_length",["groupDescLength",o.ServerProps.groupDescLength]],["web_abprop_ephemeral_messages_allowed_values",["ephemeralMessagesAllowedValues",o.ServerProps.ephemeralMessagesAllowedValues]]]).forEach(((e,t)=>{const n=(0,i.getABPropConfigValue)(t);new a.default.WebcAbpropsValidation({abpropName:t,abpropValue:String(n),serverPropName:String(e[0]),serverPropValue:String(e[1])}).commit()}))};var i=n(57849),a=r(n(11339)),o=n(64551)},72126:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getABKey=function(){const e=l();return null==e?void 0:e.abKey},t.getHash=function(){const e=l();return null==e?void 0:e.hash},t.getLastSyncTime=function(){const e=l(),t=null==e?void 0:e.lastSyncTime;if(null==t)return null;return parseInt(t,10)},t.getRefresh=function(){var e;const t=l();return parseInt(null!==(e=null==t?void 0:t.refresh)&&void 0!==e?e:86400,10)},t.isABPropsAfterFirstSync=function(){return null!=l()},t.updateAttributesLocalStorage=function(e,t,n,r){var c,d;let u=null;null!=n&&(u=n,u<600?u=600:u>s&&(u=s));const p=l()||{},f={abKey:null!=e?e:p.abKey,hash:null!=t?t:p.hash,refresh:null!==(c=null===(d=u)||void 0===d?void 0:d.toString())&&void 0!==c?c:p.refresh,lastSyncTime:r};(0,i.default)(a.default,"localStorage").setItem(o.KEYS.ABPROPS,JSON.stringify(f))};var i=r(n(45095)),a=r(n(4285)),o=n(72407);const s=604800;function l(){const e=(0,i.default)(a.default,"localStorage").getItem(o.KEYS.ABPROPS);return null==e?null:JSON.parse(e)}},17478:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getFbBrandedNumber=function(e){if((0,i.isMDBackend)()){return(0,r.getABPropConfigValue)("system_msg_numbers_fb_branded").split(",").includes(e)}return!1},t.getIsInternalNumber=function(e){if((0,i.isMDBackend)()){const t=(0,r.getABPropConfigValue)("system_msg_numbers_fb_branded").split(","),n=(0,r.getABPropConfigValue)("system_msg_numbers_fb_inc").split(",");return t.includes(e)||n.includes(e)}return a.has(e)};var r=n(57849),i=n(88555);const a=new Set(["16505434800","16503130062","16507885324","16508620604","16504228206","16505212669","447710173736","16507885280","19032707825","16505361212","16508129150","16315555102","0"])},78542:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if((0,r.isMDBackend)()){const t=(0,i.getABPropConfigValue)("in_app_support_v2_numbers");return null!=t&&""!==t&&t.split(",").includes(e)}return!1};var r=n(88555),i=n(57849)},92182:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.exposureKeys=t.accessedConfigs=void 0,t.updateGlobalABKey=function(e){i.default.Global.set({abKey2:e})},t.updateGlobalExpoKey=function(){i.default.Global.set({expoKey:Array.from(o).join(",")})};var i=r(n(11339));const a=new Set;t.accessedConfigs=a;const o=new Set;t.exposureKeys=o},57849:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ABPropConfigCodeToName=void 0,t.clearABPropConfigs=function(){return p.reset()},t.getABPropConfigValue=f,t.getAllABPropConfigs=function(){return p.getAllConfigs()},t.updateABPropsFromStorage=function(){return h.apply(this,arguments)};var i=r(n(48926)),a=n(88555),o=n(34541),s=n(64388),l=n(92182);const c=new Map;let d=!1;const u={};t.ABPropConfigCodeToName=u,Object.keys(s.ABPropConfigs).forEach((e=>{const[t]=s.ABPropConfigs[e];u[t]=e})),Object.freeze(u);const p={reset:()=>{c.clear(),l.accessedConfigs.clear(),l.exposureKeys.clear(),d=!1},bulkCreateOrReplace(e){let t=!1;e.forEach((e=>{c.set(e.configCode,e),!0===e.hasAccessed&&(l.accessedConfigs.add(e.configCode),null!=e.configExpoKey&&(l.exposureKeys.add(e.configExpoKey),t=!0))})),t&&(0,l.updateGlobalExpoKey)(),d=!0,f("web_abprop_config_experiment_test")},getConfigValue(e){var t;if(!d)return __LOG__(3)`[ABProps] configs need to be initialized before its first access, config code: ${e}`,null;if(c.get(e)&&!l.accessedConfigs.has(e)){var n;const t=null===(n=c.get(e))||void 0===n?void 0:n.configExpoKey;null==t||l.exposureKeys.has(t)||(l.exposureKeys.add(t),(0,l.updateGlobalExpoKey)()),l.accessedConfigs.add(e),(0,o.setConfigAccessed)(e)}return null===(t=c.get(e))||void 0===t?void 0:t.configValue},getAllConfigs:()=>Array.from(c.values())};function f(e){var t;(0,a.isLegacyWebdBackend)()&&(__LOG__(4,!0,new Error,!0)`[ABProps] getABPropConfigValue() should not be called by non-MD build, config name: ${e}`,SEND_LOGS(`[ABProps] getABPropConfigValue() should not be called by non-MD build, config name: ${e}`));const n=s.ABPropConfigs[e],[r,i,o]=n;return null!==(t=p.getConfigValue(r))&&void 0!==t?t:o}function h(){return(h=(0,i.default)((function*(){try{const e=(yield(0,o.getABPropConfigs)()).map((e=>{const t=u[Number(e.configCode)];if(null!=t){const n=s.ABPropConfigs[t],[r,i,a]=n;return{configCode:r,configValue:(0,o.parseConfigValue)(e.configValue,i,a),configExpoKey:e.configExpoKey,hasAccessed:e.hasAccessed}}__LOG__(3)`[ABProps] ABProp (code: ${e.configCode}) exists in storage but no longer available for this client version`})).filter((e=>!!e));p.bulkCreateOrReplace(e)}catch(e){__LOG__(4,!0,new Error,!0)`[ABProps] Failed to update ABProps configs cache from storage`,SEND_LOGS("[ABProps] Failed to update ABProps configs cache from storage: "+e)}__LOG__(2,void 0,void 0,void 0,["abprops"])`--- Print ABProps Start ---`,c.forEach(((e,t)=>{__LOG__(2,void 0,void 0,void 0,["abprops"])`code: ${t}, name: ${u[e.configCode]}, value: ${e.configValue}, type: ${typeof e.configValue}`})),__LOG__(2,void 0,void 0,void 0,["abprops"])`--- Print ABProps End ---`}))).apply(this,arguments)}},41566:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isAdminHfmToggleEnabled=function(){var e;return(0,r.isMDBackend)()?null!==(e=(0,o.getABPropConfigValue)("admin_hfm_toggle"))&&void 0!==e&&e:a.GK.supportsFeature(a.GK.F.FREQUENTLY_FORWARDED_SETTING)},t.isDefaultDisappearingMessagesEnabled=function(){return s.PrimaryFeatures.ddmSettings&&(0,r.isMDBackend)()&&(0,o.getABPropConfigValue)("web_privacy_settings_v2")},t.isDisappearingModeEnabled=function(){var e;return(0,r.isMDBackend)()?null!==(e=(0,o.getABPropConfigValue)("disappearing_mode"))&&void 0!==e&&e:a.GK.supportsFeature(a.GK.F.DISAPPEARING_MODE)},t.isDropLastNameEnabled=function(){var e;return!!(0,r.isMDBackend)()&&(null!==(e=(0,o.getABPropConfigValue)("drop_last_name"))&&void 0!==e&&e)},t.isElevatedImportantMessageEnabled=function(){var e;return!(!(0,r.isMDBackend)()||!l())&&(null!==(e=(0,o.getABPropConfigValue)("elevated_important_msg"))&&void 0!==e&&e)},t.isEphemeral24HDurationEnabled=function(){var e;return(0,r.isMDBackend)()?null!==(e=(0,o.getABPropConfigValue)("ephemeral_24h_duration"))&&void 0!==e&&e:a.GK.supportsFeature(a.GK.F.EPHEMERAL_24_H_DURATION)},t.isGroupCatchUpEnabled=l,t.isInAppSupportEnabled=function(){if((0,r.isMDBackend)()){if(!(0,o.getABPropConfigValue)("in_app_support_v2_enabled"))return!1;const e=(0,o.getABPropConfigValue)("in_app_support_v2_locale_langs");if(""===e)return!0;const t=new Set(e.split(",")),r=n(14296).default;return t.has(r.getLocale())}return a.GK.supportsFeature(a.GK.F.SUPPORT)},t.isPrivacyNarrativeV1Enabled=function(){return(0,r.isMDBackend)()&&(0,o.getABPropConfigValue)("privacy_narrative_v1")},t.isSenderRevokeUiEnabled=function(){var e;return(0,r.isMDBackend)()?null!==(e=(0,o.getABPropConfigValue)("sender_revoke_ui"))&&void 0!==e&&e:a.GK.supportsFeature(a.GK.F.NO_DELETE_MESSAGE_TIME_LIMIT)},t.isSenderRevokeWindowReceiverEnabled=function(){var e;return(0,r.isMDBackend)()?null!==(e=(0,o.getABPropConfigValue)("sender_revoke_window_receiver"))&&void 0!==e&&e:a.GK.supportsFeature(a.GK.F.NO_DELETE_MESSAGE_TIME_LIMIT)},t.isSenderRevokeWindowSenderEnabled=function(){var e;return(0,r.isMDBackend)()?null!==(e=(0,o.getABPropConfigValue)("sender_revoke_window_sender"))&&void 0!==e&&e:a.GK.supportsFeature(a.GK.F.NO_DELETE_MESSAGE_TIME_LIMIT)};var r=n(88555),i=n(99234),a=n(7293),o=n(57849),s=n(34771);function l(){if((0,r.isMDBackend)()){var e,t;const n=null!==(e=(0,i.getUnreadMentionCountEnabled)())&&void 0!==e&&e;return null!==(t=(0,o.getABPropConfigValue)("group_catch_up"))&&void 0!==t&&t&&n}return!1}},41796:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getBridge=function(){return(0,i.default)(a,"_bridge")},t.isConnectedToPage=function(){return true},t.setBridge=function(e){a=e};var i=r(n(45095));let a=null},79736:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.makeBridge=function(){return new r.DynamicRouter};var r=n(2486)},22854:(e,t,n)=>{"use strict";var r=n(95318);t.Z=void 0;var i=n(39948),a=n(99234),o=r(n(52991)),s=r(n(43610));var l={whoAmI(){const e=(0,a.getMaybeMeUser)().toString();return Promise.resolve(e)},logImpl:(e,t,n,r,a)=>(i.Logger.logImpl(e,t,n,r,a),Promise.resolve()),initFromStorage:()=>s.default.invoke("initFromStorage",[]),setLogoutState:e=>(o.default.isLogoutInProgress=e,s.default.invoke("setLogoutState",[e])),sendLogs:e=>n(86374).sendLogs(e),deleteDbEncKeyCache:()=>s.default.invoke("deleteDbEncKeyCache",[]),initDatabaseEncnKey:e=>s.default.invoke("initDatabaseEncnKey",[e]),generateFinalDbEncryptionAndFtsKey:e=>s.default.invoke("generateFinalDbEncryptionAndFtsKey",[e]),startBackendWorker:e=>s.default.invoke("startBackendWorker",[e])};t.Z=l},41208:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=new MessageChannel,n=t.port1,r=t.port2;s.default.respondTo(n),i.default.init(),o.default.setConnectionManager(i.default),i.default.connectVia(n),e.postMessage((0,a.buildHandshakePayload)(r),[r])};var i=r(n(82090)),a=n(3620),o=r(n(43610)),s=r(n(72601))},79038:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(41208));const a=new(r(n(35474)).default);(0,i.default)(a);var o=a;t.default=o},82090:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(45095)),a=n(38284),o=n(88156),s=r(n(41143));var l=new class{init(){return this._port=null,this._deferred=new o.Resolvable,(0,a.promiseTimeout)(this._deferred.promise,5e3)}isConnected(){return null!=this._port}getPort(){return this._port}waitForConnection(){var e;return(0,i.default)(null===(e=this._deferred)||void 0===e?void 0:e.promise,"ConnectionManager Initialization Promise")}connectVia(e){if(this.isConnected())throw new Error("Connection already established");(0,s.default)(this._deferred,"ConnectionManager not initialized"),this._port=e,this._deferred.resolve()}};t.default=l},52991:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(11339));const a={[i.default.WEBC_SCENARIO_TYPE.IDLE]:0,[i.default.WEBC_SCENARIO_TYPE.INITIAL_PAIRING]:3e5,[i.default.WEBC_SCENARIO_TYPE.OFFLINE_RESUME]:12e4};let o,s;var l={isLogoutInProgress:!1,getCurrentScenario(){var e;return null!==(e=s)&&void 0!==e?e:i.default.WEBC_SCENARIO_TYPE.IDLE},initOrUpdateTracking(e){o&&clearTimeout(o),s=e,s!==i.default.WEBC_SCENARIO_TYPE.IDLE&&(o=setTimeout((()=>{s=i.default.WEBC_SCENARIO_TYPE.IDLE,o=null}),a[e]))}};t.default=l},43610:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(48926)),a=r(n(45095)),o=r(n(41143)),s=n(12758),l=n(22068),c=n(23097);var d=new class{constructor(){this._pending=new Map,this._onResponseReceipt=e=>{const t=(0,c.unwrapResponsePayload)(e.data);if(null!=t){const{invocationId:e,result:n}=t;if(this._pending.has(e)){const{resolve:t}=(0,a.default)(this._pending.get(e),"this._pending.get(invocationId)");t(n),this._pending.delete(e)}}}}setConnectionManager(e){this._conn=e,e.waitForConnection().then((()=>{const t=(0,a.default)(e.getPort(),"Port obtained from ConnectionManager after connection");t.addEventListener("message",this._onResponseReceipt),t.start()}))}invoke(e,t){var n=this;return(0,i.default)((function*(){(0,o.default)(n._conn,"Connection has not been inited"),yield n._conn.waitForConnection(),(0,o.default)(n._conn,"Connection has not been inited");const r=(0,a.default)(n._conn.getPort(),"Port obtained from ConnectionManager after connection"),i=(0,l.genInvocationId)();return r.postMessage((0,s.buildInvocationPayload)({invocationId:i,method:e,args:t})),new Promise(((e,t)=>{n._pending.set(i,{resolve:e,reject:t})}))}))()}};t.default=d},72601:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(12758),i=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=o(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var s=i?Object.getOwnPropertyDescriptor(e,a):null;s&&(s.get||s.set)?Object.defineProperty(r,a,s):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(77303)),a=n(23097);function o(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(o=function(e){return e?n:t})(e)}var s=new class{constructor(){this._onMessage=(e,t)=>{const n=t.data,o=(0,r.unwrapInvocationPayload)(n);if(null!=o){const{method:t,args:n,invocationId:r}=o;i.get()[t](...n).then((t=>{e.postMessage((0,a.buildResponsePayload)(r,t))}))}}}respondTo(e){e.addEventListener("message",(t=>this._onMessage(e,t))),e.start()}};t.default=s},22068:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.extractInvocationId=function(e){if(null!=e&&"number"==typeof e)return e},t.genInvocationId=function(){return n++};let n=1},77303:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.get=s,t.log=void 0,t.sendLogs=function(e){return s().sendLogs(e)},t.set=function(e){o=e};var i=r(n(45095)),a=r(n(79405));let o;function s(){return(0,i.default)(o,"InvocationInterface was not inited")}const l=(0,r(n(64662)).default)((function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0;return function(o){for(var l=arguments.length,c=new Array(l>1?l-1:0),d=1;d<l;d++)c[d-1]=arguments[d];const u=(0,a.default)(o,c,!t);let p;return n&&(p={name:n.name,stack:n.stack}),s().logImpl(e,u,p,r,i),u}}),((e,t,n,r,i)=>n||i?null:String(e)+String(Boolean(t))+String(Boolean(r))));t.log=l},3620:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.buildHandshakePayload=function(e){return{__command:a.HANDSHAKE_COMMAND,__port:e}},t.extractPortFromHandshakePayload=function(e){if(null!=e&&null!=e.__command&&e.__command===a.HANDSHAKE_COMMAND&&null!=e.__port){(0,i.default)(e.__port instanceof MessagePort,"Malformed connection payload");return e.__port}};var i=r(n(41143)),a=n(37557)},12758:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.buildInvocationPayload=function(e){let{invocationId:t,method:n,args:r}=e;return{__id:t,__command:o.INVOCATION_COMMAND,__method:n,__args:r}},t.unwrapInvocationPayload=function(e){if(null!=e&&e.__command===o.INVOCATION_COMMAND){(0,i.default)(e.__id,"Invocation ID missing");const t=(0,a.extractInvocationId)(e.__id);(0,i.default)(null!=t&&e.__method&&"string"==typeof e.__method&&e.__id&&e.__args&&Array.isArray(e.__args),"Malformed invocation message");const n=e,r=n.__method,o=n.__args;return{method:r,args:o,invocationId:t}}};var i=r(n(41143)),a=n(22068),o=n(37557)},23097:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.buildResponsePayload=function(e,t){return{__id:e,__command:o.RESPONSE_COMMAND,__result:t}},t.unwrapResponsePayload=function(e){if(null!=e&&e.__command===o.RESPONSE_COMMAND){(0,i.default)(null!=e.__id,"Invocation ID missing");const t=(0,a.extractInvocationId)(e.__id);(0,i.default)(null!=t&&e.hasOwnProperty("__result"),"Malformed response message");return{result:e.__result,invocationId:t}}};var i=r(n(41143)),a=n(22068),o=n(37557)},37557:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RESPONSE_COMMAND=t.INVOCATION_COMMAND=t.HANDSHAKE_COMMAND=void 0;t.HANDSHAKE_COMMAND="@@handshake";t.INVOCATION_COMMAND="@@invoke";t.RESPONSE_COMMAND="@@response"},88102:(e,t,n)=>{"use strict";var r=n(59182).default,i=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.Revoke=t.CmdImpl=t.Cmd=t.APP_STATE_SYNC_COMPLETED=void 0;var a=i(n(48926)),o=i(n(81109)),s=i(n(23279)),l=n(89385),c=n(88555),d=n(98159),u=i(n(76521)),p=i(n(41143)),f=n(7293),h=(i(n(11339)),n(31019));const _=n(76672).Mirrored(["Sender","Admin"]);t.Revoke=_;t.APP_STATE_SYNC_COMPLETED="app_state_sync_completed";class g extends u.default{constructor(){super(...arguments),this.isMainLoaded=!1,this.uiBusy=0,this.isMainStreamReadyMd=!1,this._clearUiBusy=(0,s.default)((()=>{this.uiBusy&&(__LOG__(2)`cmd:clearUIBusy uibusy timeout`,this.uiBusy=0,this._triggerIdleEvent())}),1e3,{maxWait:5e3}),this._triggerIdleEvent=function(e){let t;const n=()=>{if(t)return;t=new r;const{signal:n}=t;(0,d.documentFlushed)({signal:n}).then((()=>{n.aborted||(t=null,e())}),(e=>{if(e.name!==l.ABORT_ERROR)throw e}))};return n.cancel=()=>{t&&(t.abort(),t=null)},n}((()=>{(0,p.default)(0===this.uiBusy,`ui_idle triggered when uiBusy is ${this.uiBusy}`),0===this.uiBusy&&(this._clearUiBusy.cancel(),this.trigger("ui_idle"))}))}mainLoaded(){this.isMainLoaded=!0,this.trigger("main_loaded")}incrementProgress(){__LOG__(2)`Cmd: incrementProgress`,this.trigger("increment_progress")}initialLoadReady(){__LOG__(2)`Cmd: initialLoadReady`,this.trigger("initial_load_ready")}logSocketSummary(){this.trigger("log_socket_summary")}muteAll(e,t,n){this.trigger("mute_all",e,t,n)}muteAllCall(e,t){this.trigger("mute_all_call",e,t)}muteChat(e,t){this.trigger("mute_chat",(0,h.unproxy)(e),t)}muteChats(e,t,n){const r=e.map((e=>(0,h.unproxy)(e)));this.trigger("mute_chats",r,t,n)}deleteOrExitChat(e,t){this.trigger("delete_or_exit_chat",(0,h.unproxy)(e),t)}clearChat(e,t){this.trigger("clear_chat",(0,h.unproxy)(e),t)}archiveChat(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.trigger("archive_chat",(0,h.unproxy)(e),t,n)}pinChat(e,t){this.trigger("pin_chat",(0,h.unproxy)(e),t)}pinChats(e,t){const n=e.map((e=>(0,h.unproxy)(e)));this.trigger("pin_chats",n,t)}markChatUnread(e,t){this.trigger("mark_chat_unread",(0,h.unproxy)(e),t)}msgInfoDrawer(e){this.trigger("msg_info_drawer",(0,h.unproxy)(e))}chatSearch(e){this.trigger("chat_search",(0,h.unproxy)(e))}chatInfoDrawer(e,t,n){this.trigger("chat_info_drawer",(0,h.unproxy)(e),t,n)}attachMediaDrawer(e){const t=(0,o.default)((0,o.default)({},e),{},{chat:(0,h.unproxy)(e.chat)});this.trigger("attach_media_drawer",t)}attachProduct(e){this.trigger("attach_product",e)}verificationDrawer(e){this.trigger("verification_drawer",e)}liveLocationDrawer(e,t){this.trigger("live_location_drawer",e,t)}expiredLocationDrawer(e){this.trigger("expired_location_drawer",e)}mediaViewerModal(e){const{msg:t,getZoomNode:n,currentTime:r,highlightedMsgIds:i}=e;this.trigger("media_viewer_modal",{msg:t,getZoomNode:n,currentTime:r,highlightedMsgIds:i})}openMediaViewerForAlbumMedia(e){this.trigger("open_media_viewer_for_album_media",e)}productImageViewerModal(e,t){this.trigger("product_image_viewer_modal",e,t)}ephemeralDrawer(e,t,n){this.trigger("ephemeral_drawer",e,t,n)}communityHome(e){this.trigger("open_community_home",e)}sendStarMsgs(e,t,n,r){this.trigger("send_star_msgs",(0,h.unproxy)(e),t,n,r)}sendUnstarMsgs(e,t,n,r){this.trigger("send_unstar_msgs",(0,h.unproxy)(e),t,n,r)}sendDeleteMsgs(e,t,n,r,i){this.trigger("send_delete_msgs",(0,h.unproxy)(e),t,n,r,i)}sendRevokeMsgs(e,t,n){this.trigger("send_revoke_msgs",(0,h.unproxy)(e),t,n)}addFavoriteSticker(e){this.trigger("add_favorite_sticker",e)}removeFavoriteSticker(e){this.trigger("remove_favorite_sticker",e)}_openChat(e,t){const n=(0,h.unproxy)(e);return new Promise((e=>{this.trigger("open_chat",n,t,e)})).catch((e=>{throw __LOG__(2)`Unexpected openChat error: ${String(e)}`,e}))}openChatAt(e,t){var n=this;const r=(0,h.unproxy)(e);if(!t)return this.openChatBottom(r);this.setUiBusy(!0,"open_chat_at");const i=this._openChat(r,t).then(function(){var e=(0,a.default)((function*(e){let r,i;const a=null==t.enableAnimation||t.enableAnimation;if(e)if(e.wasVisible)r=()=>n._scrollToFocusedMsg({pos:"offset",offset:e.offset}),i=()=>n._scrollToFocusedMsg({pos:"center",animate:a,duration:400,easing:[.7,0,.3,1]});else switch(r=()=>n._scrollToFocusedMsg({pos:e.alignAt}),e.alignAt){case"top":case"bottom":i=()=>n._scrollToFocusedMsg({pos:"center",animate:a,duration:400,easing:[.88,.64,.13,.99]});break;case"center":default:i=()=>Promise.resolve()}else r=()=>n._scrollToFocusedMsg({pos:"center"}),i=()=>Promise.resolve();return yield r(),i()}));return function(){return e.apply(this,arguments)}}()).then((()=>{this.flashFocusedMsg(t.highlightMentionMsg)})).then((()=>!0)).catch((0,l.catchAbort)((()=>!1)));return i.finally((()=>{this.setUiBusy(!1,"open_chat_at")})),i}openChatFromUnread(e){const t=(0,h.unproxy)(e);let n;if(t.unreadMsgAnchor&&(n={collection:t.unreadMsgAnchor.msgChunk,promise:Promise.resolve(),msg:t.unreadMsgAnchor,isUnreadDivider:t.shouldShowUnreadDivider}),n||t.unreadCount>0){this.setUiBusy(!0,"open_from_unread");const e=this._openChat(t,n).then((()=>this._scrollToFocusedMsg({pos:"top",offset:-120}))).then((()=>!0)).catch((0,l.catchAbort)((()=>!1)));return e.finally((()=>{this.setUiBusy(!1,"open_from_unread")})),e}return this.openChatBottom(t)}openChatBottom(e){const t=(0,h.unproxy)(e);let n;this.setUiBusy(!0,"open_bottom"),t.msgs.length>0&&(n={collection:t.msgs,msg:t.msgs.last(),isUnreadDivider:!1});const r=this._openChat(t,n).then((()=>this._scrollChatToBottom())).then((()=>!0)).catch((0,l.catchAbort)((()=>!1)));return r.finally((()=>{this.setUiBusy(!1,"open_bottom")})),r}scrollToPtt(e){const t=(0,h.unproxy)(e.chat),n={collection:e.chat.msgs,msg:e,key:e.id,highlightMsg:!1};this.setUiBusy(!0,"open_chat_at");const r=this._openChat(t,n).then((()=>this._scrollToFocusedMsg({pos:"center",animate:!0,duration:400,easing:[.7,0,.3,1]}))).then((()=>!0)).catch((0,l.catchAbort)((()=>!1)));return r.finally((()=>{this.setUiBusy(!1,"open_chat_at")})),r}_scrollToFocusedMsg(e){return new Promise((t=>{this.trigger("scroll_to_focused_msg",t,e)})).catch((e=>{__LOG__(3)`Unexpected scrollToFocusedMsg error: ${String(e)}`}))}_scrollChatToBottom(){return new Promise((e=>{this.trigger("scroll_chat_to_bottom",e)})).catch((e=>{__LOG__(3)`Unexpected scrollChatToBottom error: ${String(e)}`}))}flashFocusedMsg(e){setTimeout((()=>{this.trigger("flash_focused_msg"),e&&this.trigger("flash_mention_msg")}),0)}updateChatlistSelection(e){const t=(0,h.unproxy)(e);this.trigger("update_chatlist_selection",t)}closeChat(e){const t=(0,h.unproxy)(e);this.trigger("close_chat",t)}focusChatTextInput(e){const t=(0,h.unproxy)(e);t?this.trigger("focus_chat_text_input_"+t.id.toString()):this.trigger("focus_chat_text_input")}toggleQuickReplies(){this.trigger("quick_replies_toggle")}setChatCtwaContextLinkData(e,t){this.trigger("chat_set_ctwa_context_link_data_"+e.id.toString(),t)}addChatMsgSentLogAttributes(e,t){this.trigger("chat_add_sending_log_attributes_"+e.id.toString(),t)}focusShowMsg(e){this.trigger("focus_show_msg",e)}enterChatTextInput(e){const t=(0,h.unproxy)(e);this.trigger("enter_chat_text_input_"+t.id.toString())}focusNextChat(e){this.trigger("focus_next_chat",e)}focusPrevChat(e){this.trigger("focus_prev_chat",e)}focusChatList(){this.trigger("focus_chat_list")}focusChatSearch(){this.trigger("focus_chat_search")}pasteChatTextInput(e,t){const n=(0,h.unproxy)(e);this.trigger("paste_chat_text_input_"+n.id.toString(),t)}startGroupCall(e,t){const n=(0,h.unproxy)(e);this.trigger("voip_start_group_call",n,t)}closeStatusViewer(){this.trigger("close_status_viewer")}sendPasteToCompose(e,t){const n=(0,h.unproxy)(e);this.trigger("send_paste_to_compose_"+n.id.toString(),t)}openComposeBoxPanel(e){this.trigger("open_compose_box_panel",e)}login(e){this.trigger("login",e)}logout(){const e=(0,c.isMDBackend)();f.GK.resetFeatures(),f.GK.setFeature(f.GK.F.MD_BACKEND,e),this.trigger("logout")}openContextMenu(e,t){this.trigger("open_context_menu",e,t)}closeContextMenu(e){this.trigger("close_context_menu",e)}openTooltip(e,t){this.trigger("open_tooltip",e,t)}closeTooltip(e){this.trigger("close_tooltip",e)}openToast(e,t){this.trigger("open_toast",e,t)}closeToast(e){this.trigger("close_toast",e)}alertNewMsg(e){this.trigger("alert_new_msg",e)}alertNewReactionMsg(e){this.trigger("alert_new_reaction_msg",e)}newMediaMsg(e){this.trigger("new_media_msg",e)}alertCall(e,t,n,r,i){this.trigger("alert_call",e,t,n,r,i)}cancelCall(e){this.trigger("cancel_call",e)}windowError(){}cannotReachPhone(){}sentPing(){}openModal(e,t){this.trigger("open_modal",e,t)}closeModal(e){this.trigger("close_modal",e)}openModalMedia(e,t){this.trigger("open_media",e,t)}closeModalMedia(){this.trigger("close_media")}setDrawerContext(e,t){this.trigger(`update_context_${e}`,t)}openDrawerRight(e,t,n,r,i){this.trigger("open_drawer_right",e,t,n,void 0,r,i)}openDrawerMid(e,t,n,r,i,a){this.trigger("open_drawer_mid",e,t,n,r,i,a)}openDrawerLeft(e,t,n,r,i){this.trigger("open_drawer_left",e,t,n,void 0,r,i)}existsDrawerRight(e){this.trigger("exists_drawer_right",e)}existsDrawerMid(e){this.trigger("exists_drawer_mid",e)}existsDrawerLeft(e){this.trigger("exists_drawer_left",e)}closeDrawerRight(){this.trigger("close_drawer_right")}closeDrawerMid(){this.trigger("close_drawer_mid")}closeDrawerLeft(){this.trigger("close_drawer_left")}onPanesWillChange(e){this.trigger("panes_will_change",e)}onPanesDidChange(e){this.trigger("panes_did_change",e)}openGroupInviteModal(e){this.trigger("open_group_invite_modal",e)}reactionChangeLastMessage(){this.trigger("reaction_changed_last_msg")}openGroupV4InviteRequestFlow(e,t,n,r){this.trigger("open_group_v4_invite_request_flow",e,t,n,r)}uiResize(){this.trigger("resize")}setUiBusy(e){let t=this.uiBusy||0;e?(++t,this._clearUiBusy(),this._triggerIdleEvent.cancel()):t&&--t,this.uiBusy=t,0===t&&(this._clearUiBusy.cancel(),this._triggerIdleEvent())}windowMouseDown(e){this.trigger("window_mousedown",e)}windowClick(e){this.trigger("window_click",e)}midnight(){this.trigger("midnight")}textsizeChange(e){this.trigger("textsize_change",e)}scrollMessages(){this.trigger("scroll_messages")}getConversationHeaderOffset(e){this.trigger("get_conversation_header_offset",e)}floaterEscapeOverlap(e,t){this.trigger("floater_escape_overlap",e,t)}autoplayPTT(e){this.trigger("sequential_playback_ptt",e)}refreshMessages(){this.trigger("refresh_messages")}readyForMainStreamModeLegacy(){this.trigger("main_stream_mode_ready_legacy")}storageInitializationError(){this.trigger("storage_initialization_error")}restartBackend(){this.trigger("md_restart_backend")}downgradeWebclient(){this.trigger("md_downgrade_webclient")}upgradeToMDInternal(){this.trigger("upgrade_to_md")}upgradeToMDProd(){this.trigger("upgrade_to_md_prod")}refreshQR(){this.trigger("md_refresh_qr")}setSocketState(e){this.trigger("set_socket_state",e)}socketStreamDisconnected(){this.trigger("socket_stream_disconnected")}openSocketStream(){this.trigger("open_socket_stream")}readyForMainStreamMode(){this.isMainStreamReadyMd=!0,this.trigger("main_stream_mode_ready")}onInitialChatHistorySynced(){this.trigger("on_initial_chat_synced")}onRecentChatHistorySynced(){this.trigger("on_recent_chat_history_synced")}onFullChatHistorySynced(){this.trigger("on_full_chat_history_synced")}onHistorySyncChunkProcessed(e){this.trigger("new_history_sync_chunk_processed",e)}handleOfflineProgressUpdate(){this.trigger("offline_progress_update")}criticalSyncDone(){this.trigger("on_critical_sync_done")}onTemporaryBan(e){this.trigger("account_temporarily_banned",e)}onStartingLogout(){this.trigger("starting_logout")}handleFatalError(){this.trigger("handle_fatal_error")}merchantDetailsDrawer(e){this.trigger("merchant_details_drawer",e)}showMerchantDetailsEntityTypePopup(e,t){this.trigger("show_merchant_details_entity_type_popup",e,t)}showCountrySelector(e,t,n,r){this.trigger("show_country_selector_popup",e,t,n,r)}toggleStickerMaker(){this.trigger("toggle_sticker_maker")}onAccountSyncForPrivacy(e){this.trigger("account_sync_for_privacy",e)}openStickerPack(e){this.trigger("open_sticker_pack",e)}onStatusViewerOpen(){this.trigger("status_viewer_open")}triggerStorageAlert(){}onAbPropsUpdate(){this.trigger("on_ab_props_update")}}t.CmdImpl=g;const m=new g;t.Cmd=m},35470:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EDIT_ATTR=t.ACK_STRING=t.ACK=void 0;t.ACK={MD_DOWNGRADE:-7,INACTIVE:-6,CONTENT_UNUPLOADABLE:-5,CONTENT_TOO_BIG:-4,CONTENT_GONE:-3,EXPIRED:-2,FAILED:-1,CLOCK:0,SENT:1,RECEIVED:2,READ:3,PLAYED:4,PEER:5};t.EDIT_ATTR={SENDER_REVOKE:7,ADMIN_REVOKE:8};t.ACK_STRING={SENDER:"sender",DELIVERY:"delivery",READ:"read",PLAYED:"played",INACTIVE:"inactive",READ_SELF:"read-self",PLAYED_SELF:"played-self"}},13042:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PAGE_SIZE=t.MSG_PRELOAD_THRESHOLD=t.COLLECTION_HAS_SYNCED=void 0;t.COLLECTION_HAS_SYNCED="collection_has_synced";t.PAGE_SIZE=50;t.MSG_PRELOAD_THRESHOLD=20},64369:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={IMG_THUMB_MAX_EDGE:100,DOC_THUMB_MAX_EDGE:480,VIDEO_THUMB_MAX_EDGE:480,MAX_PORTRAIT_MEDIA_CAPTION_LENGTH:500,MAX_FILES:30,MEDIA_EDITOR_OUTLINE_TENSION:.4,MMS_THUMBNAIL_UPLOAD_TIMEOUT:3e3,FREQUENTLY_FORWARDED_SENTINEL:127,MAX_SMB_LABEL_COUNT:20,WA_COMMERCE_POLICY_URL:"https://www.whatsapp.com/policies/commerce-policy",MAX_TXT_MSG_SIZE:65536,GROUP_DESCRIPTION_INFO_PANEL_TRUNC_LENGTH:100,BUSINESS_DESCRIPTION_INFO_PANEL_TRUNC_LENGTH:200,TEMPLATE_URL_START:64,TEMPLATE_URL_END:32,SQUELCH_RESET_VALUE:-1,MAX_CAPTION_LENGTH:1024,REACTION_CONTENT_MAX_LENGTH:30,MAX_CART_MESSAGE_LENGTH:1024,MAX_PUSHNAME_LENGTH:25,KEY_BUNDLE_TYPE:"",NEW_MSG_SENT:"new_msg_sent",ONE_BY_ONE_TRANS_GIF:"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",VOIP_LOG_COLOR:"#aa6627",VOIP_MAX_GROUP_CALL_PARTICIPANTS:8,WAM_SYS_INFO_INIT_DELAY:5e3,MARKED_AS_UNREAD:-1};t.default=n},20289:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UPLOAD_TO_CLB=t.TICKET_URL=t.LOG_SIZE=t.CLB_URL=t.CLB_TOKEN=t.CLB_CHECK_URL=void 0;t.CLB_CHECK_URL="https://crashlogs.whatsapp.net/wa_fls_upload_check";t.CLB_TOKEN="1063127757113399|745146ffa34413f9dbb5469f5370b7af";t.CLB_URL="https://crashlogs.whatsapp.net/wa_clb_data";t.TICKET_URL="https://web.whatsapp.com/web-contact-us";let n=0;n=1;t.UPLOAD_TO_CLB=1;t.LOG_SIZE=4999},21310:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.PLATFORM=t.FAQ_BASE_URL=void 0,t.getBusinessFaqUrl=function(){return s("general/chats/about-chatting-with-businesses")},t.getCannotConnectFaqUrl=function(){return s("web/troubleshooting/cant-connect-to-whatsapp-web-or-desktop")},t.getCatalogCartOnOffFaqUrl=function(){return s("general/account-and-profile/about-cart")},t.getCiphertextFaqUrl=function(){return s("general/security-and-privacy/seeing-waiting-for-this-message-this-may-take-a-while")},t.getCodeChangeFaqUrl=function(){return s("general/security-and-privacy/security-code-change-notification")},t.getCommunityHomeNuxUrl=function(){return s("general/about-community")},t.getE2EEnterpriseFaqUrl=function(){return s("general/security-and-privacy/end-to-end-encryption-for-business-messages")},t.getE2EFaqUrl=function(){return s("general/security-and-privacy/end-to-end-encryption")},t.getEphemeralFaqUrl=function(){return s("general/chats/about-disappearing-messages")},t.getFanoutPlaceholderFaqUrl=function(){return s("general/security-and-privacy/seeing-waiting-for-this-message-check-your-phone")},t.getFaqUrl=function(){return`${a}/web?lang=${i.default.getLocale()}`},t.getFrequentlyForwardedFaqUrl=function(){return s("general/chats/about-forwarding-limits")},t.getGroupInviteGrowthLockedFaqUrl=function(){return s("cxt/?entrypointid=invite-via-link-unavailable",!0)},t.getLinkDeviceFaqUrl=function(){return s("web/download-and-installation/how-to-link-a-device")},t.getLoginFaqUrl=function(){return s("web/download-and-installation/how-to-log-in-or-out")},t.getMDCodeChangeFaqUrl=function(){return`${a}/${i.default.getLocale()}/web/26000361`},t.getMdOptInFaqUrl=function(){return s("general/download-and-installation/about-linked-devices")},t.getNonVerifiedTransitionFaqUrl=function(){return s("general/business-account-becomes-a-standard-account")},t.getNotificationChromeFaqUrl=function(){return s("web/troubleshooting/cant-receive-notifications-on-chrome")},t.getNotificationEdgeFaqUrl=function(){return s("web/troubleshooting/cant-receive-notifications-on-microsoft-edge")},t.getNotificationFirefoxFaqUrl=function(){return s("web/troubleshooting/cant-receive-notifications-on-firefox")},t.getNotificationOperaFaqUrl=function(){return s("web/troubleshooting/cant-receive-notifications-on-opera")},t.getNotificationSafariFaqUrl=function(){return s("web/troubleshooting/cant-receive-notifications-on-safari")},t.getRevokeFaqUrl=function(){return s("web/chats/how-to-delete-messages")},t.getSupportChatFaqUrl=function(){return s("general/what-information-does-whatsapp-collect-when-you-contact-support")},t.getSupportChatSafetyFaqUrl=function(){return s("general/about-safely-communicating-with-whatsapp-support")},t.getSuspiciousLinkFaqUrl=function(){return s("web/chats/suspicious-links")},t.getUnverifiedTransitionFaqUrl=function(){return s("general/business-account-becomes-unverified")},t.getVerifiedHighFaqUrl=function(){return s("general/verified-business-account")},t.getVerifiedLowUnknownFaqUrl=function(){return s("general/unverified-business-account")},t.getVerifiedTransitionFaqUrl=function(){return s("general/business-account-becomes-verified")},t.getViewOnceFaqUrl=function(){return s("general/chats/about-view-once")};var i=r(n(14296));const a="https://faq.whatsapp.com";t.FAQ_BASE_URL=a;const o="web";function s(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return t?`${a}/${e}&platform=web&lang=${i.default.getLocale()}`:`${a}/${e}?lang=${i.default.getLocale()}`}t.PLATFORM=o},15461:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SYSTEM_MESSAGE_TYPES=t.MSG_TYPE=void 0;t.MSG_TYPE={NOTIFICATION:"notification",NOTIFICATION_TEMPLATE:"notification_template",GROUP_NOTIFICATION:"group_notification",GP2:"gp2",BROADCAST_NOTIFICATION:"broadcast_notification",E2E_NOTIFICATION:"e2e_notification",CALL_LOG:"call_log",PROTOCOL:"protocol",CHAT:"chat",LOCATION:"location",PAYMENT:"payment",VCARD:"vcard",CIPHERTEXT:"ciphertext",MULTI_VCARD:"multi_vcard",REVOKED:"revoked",OVERSIZED:"oversized",GROUPS_V4_INVITE:"groups_v4_invite",HSM:"hsm",TEMPLATE_BUTTON_REPLY:"template_button_reply",IMAGE:"image",VIDEO:"video",AUDIO:"audio",PTT:"ptt",STICKER:"sticker",DOCUMENT:"document",PRODUCT:"product",ORDER:"order",LIST:"list",INTERACTIVE:"interactive",LIST_RESPONSE:"list_response",BUTTONS_RESPONSE:"buttons_response",REACTION:"reaction",POLL_CREATION:"poll_creation",POLL_UPDATE:"poll_update",NATIVE_FLOW:"native_flow",UNKNOWN:"unknown"};t.SYSTEM_MESSAGE_TYPES=["notification","notification_template","group_notification","gp2","broadcast_notification","e2e_notification","call_log","protocol"]},68387:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.VISIBILITY_WITH_ERROR=t.VISIBILITY=t.ALL_NONE_WITH_ERROR=t.ALL_NONE=void 0;var i=r(n(81109));const a={all:"all",contacts:"contacts",contact_blacklist:"contact_blacklist",none:"none"};t.VISIBILITY=a;const o=(0,i.default)((0,i.default)({},a),{},{error:"error"});t.VISIBILITY_WITH_ERROR=o;const s={all:"all",none:"none"};t.ALL_NONE=s;const l=(0,i.default)((0,i.default)({},s),{},{error:"error"});t.ALL_NONE_WITH_ERROR=l},15411:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TEMPLATE_BUTTON_SUBTYPE=void 0;t.TEMPLATE_BUTTON_SUBTYPE={QUICK_REPLY:"quick_reply",CALL:"call",URL:"url"}},80940:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TLD=void 0;const n=new Set(["abb","abbott","able","abudhabi","ac","academy","accountant","accountants","actor","ad","adult","ae","aero","af","afl","africa","ag","agency","ai","airforce","al","am","amsterdam","anz","ao","apartments","app","apple","ar","army","art","as","asia","associates","at","au","audi","audio","auto","autos","aws","ax","axa","az","azure","ba","baby","band","bank","bar","barcelona","barclaycard","barclays","basketball","bb","bd","be","beauty","beer","berlin","best","bet","bf","bg","bh","bi","bible","bid","bike","bingo","bio","biz","bj","black","blog","blue","bm","bn","bnpparibas","bo","bond","bot","boutique","box","br","bradesco","broker","brussels","bs","bt","build","builders","business","buzz","bw","by","bz","bzh","ca","cab","cafe","cam","camera","camp","canon","capetown","capital","car","cards","care","career","careers","cars","casa","cash","casino","cat","cc","cd","center","ceo","cern","cf","cfd","cg","ch","charity","chat","cheap","christmas","chrome","church","ci","city","ck","cl","click","clinic","clothing","cloud","club","cm","cn","co","coach","codes","coffee","college","cologne","com","community","company","computer","construction","consulting","contact","cooking","cool","coop","country","coupons","courses","cpa","cr","credit","cricket","crs","cu","cv","cw","cx","cy","cymru","cyou","cz","dance","date","dating","day","de","deals","delivery","deloitte","dental","desi","design","dev","dhl","diamonds","diet","digital","direct","directory","discount","dj","dk","dm","do","doctor","dog","domains","download","dz","earth","ec","eco","edu","education","ee","eg","email","energy","engineer","engineering","enterprises","es","estate","et","eu","eus","events","exchange","expert","express","fail","faith","family","fan","fans","farm","fashion","fi","film","finance","financial","fish","fishing","fit","fitness","fj","flights","flowers","fm","fo","football","forsale","foundation","fr","frl","fun","fund","futbol","fyi","ga","gal","gallery","game","games","garden","gay","gd","gdn","ge","gent","gg","gh","gi","gift","gifts","gives","gl","glass","gle","global","gm","gmbh","gold","golf","goog","google","gop","gov","gp","gq","gr","graphics","gratis","green","group","gs","gt","guide","guru","gw","gy","hair","haus","health","healthcare","help","hitachi","hk","hn","hockey","holdings","holiday","homes","honda","horse","host","hosting","house","how","hr","ht","hu","icu","id","ie","il","im","immo","in","inc","industries","info","ink","institute","insure","int","international","investments","io","iq","ir","is","ismaili","ist","istanbul","it","java","jcb","je","jetzt","jm","jo","jobs","jp","ke","kg","kh","ki","kim","kitchen","kiwi","kn","komatsu","kp","kpmg","kpn","kr","krd","kred","kw","ky","kyoto","kz","la","land","lat","law","lawyer","lb","lc","lease","leclerc","legal","lgbt","li","lidl","life","lighting","limited","limo","link","live","lk","llc","loan","loans","lol","london","love","lr","ls","lt","ltd","lu","luxe","luxury","lv","ly","ma","madrid","management","market","marketing","markets","mba","mc","md","me","media","melbourne","men","menu","mg","miami","mil","mk","ml","mm","mn","mo","mobi","moda","moe","mom","monash","money","monster","mortgage","moscow","movie","mp","mr","ms","mt","mu","museum","mv","mw","mx","my","mz","na","nagoya","name","navy","nc","ne","net","network","neustar","new","news","nf","ng","ngo","ni","nico","ninja","nl","no","np","nr","nrw","ntt","nu","nyc","nz","observer","office","okinawa","om","one","ong","onl","online","ooo","orange","org","organic","ovh","pa","page","paris","partners","parts","party","pe","pet","pf","pg","ph","pharmacy","photo","photography","photos","physio","pics","pictures","pink","pizza","pk","pl","place","plumbing","plus","pm","pn","poker","porn","post","pr","press","pro","promo","properties","property","ps","pt","pub","pw","py","qa","quebec","quest","racing","radio","re","realestate","realtor","recipes","red","ren","rent","rentals","report","rest","restaurant","review","reviews","ricoh","rip","ro","rocks","rs","ru","rugby","ruhr","run","rw","sa","sale","salon","sandvik","sap","saxo","sb","sbi","sbs","sc","school","schule","science","scot","sd","se","security","services","sex","sexy","sg","sh","sharp","shiksha","shoes","shop","shopping","show","si","site","sk","ski","skin","sky","sl","sm","sn","sncf","so","social","software","solar","solutions","sony","soy","spa","space","sport","spot","sr","srl","st","statebank","storage","store","stream","studio","study","style","su","supply","support","surf","sv","swiss","sx","sy","systems","sz","tab","taipei","tatar","tattoo","tax","taxi","tc","team","tech","technology","tel","tf","tg","th","theater","tickets","tips","tirol","tj","tk","tl","tm","tn","to","today","tokyo","tools","top","tours","town","toyota","toys","tr","trade","trading","training","travel","tt","tube","tui","tv","tw","tz","ua","ug","uk","university","uno","us","uy","uz","va","vc","ve","vegas","ventures","vet","vg","vi","video","vig","villas","vin","vip","vision","vn","vodka","vote","voto","vu","wales","wang","watch","webcam","website","wedding","wf","wien","wiki","win","wine","work","works","world","ws","wtf","xin","xyz","yandex","ye","yoga","yokohama","you","youtube","yt","za","zip","zm","zone","zw","","","","","","","","","","","","","",""]);t.TLD=n},54392:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.KEYBOARD_EVENT_KEY_VALUE=void 0;t.KEYBOARD_EVENT_KEY_VALUE={UNIDENTIFIED:"Unidentified",ALT:"Alt",ALT_GRAPH:"AltGraph",CAPS_LOCK:"CapsLock",CONTROL:"Control",FN:"Fn",FN_LOCK:"FnLock",HYPER:"Hyper",META:"Meta",NUM_LOCK:"NumLock",SCROLL_LOCK:"ScrollLock",SHIFT:"Shift",SUPER:"Super",SYMBOL:"Symbol",SYMBOL_LOCK:"SymbolLock",OS:"OS",ENTER:"Enter",TAB:"Tab",SPACE:" ",ARROW_DOWN:"ArrowDown",ARROW_LEFT:"ArrowLeft",ARROW_RIGHT:"ArrowRight",ARROW_UP:"ArrowUp",LEFT:"Left",RIGHT:"Right",UP:"Up",DOWN:"Down",END:"End",HOME:"Home",PAGE_DOWN:"PageDown",PAGE_UP:"PageUp",BACKSPACE:"Backspace",CLEAR:"Clear",COPY:"Copy",CR_SEL:"CrSel",CRSEL:"Crsel",CUT:"Cut",DELETE:"Delete",ERASE_EOF:"EraseEof",EX_SEL:"ExSel",EXSEL:"Exsel",INSERT:"Insert",PASTE:"Paste",REDO:"Redo",UNDO:"Undo"}},83578:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LogoutReason=t.LOGOUT_REASON_CODE=void 0;const r=n(76672)({UserInitiated:"user_initiated",SyncdFailure:"syncd_failure",InvalidAdvStatus:"invalid_adv_status",CriticalSyncTimeout:"critical_sync_timeout",AccountSyncTimeout:"account_sync_timeout",MDOptOut:"md_opt_out",UnknownCompanion:"unknown_companion",ClientVersionOutdated:"client_version_outdated",SyncdErrorDuringBootstrap:"syncd_error_during_bootstrap",AccountSyncError:"account_sync_error",ClientFatalError:"client_fatal_error",StorageQuotaExceeded:"storage_quota_exceeded",PrimaryIdentityKeyChange:"primary_identity_key_change"});t.LogoutReason=r;t.LOGOUT_REASON_CODE={CLIENT_FATAL:"0",SYNC_FAIL:"1"}},95770:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MMS_URL_MEDIA_TYPE_SEARCH_PARAM=t.IS_MMS_URL_SEARCH_PARAM=void 0;t.IS_MMS_URL_SEARCH_PARAM="__wa-mms";t.MMS_URL_MEDIA_TYPE_SEARCH_PARAM="mms-type"},38839:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SpamFlow=void 0;const r=n(76672)({Chat:"chat",Account:"account_info",Group:"group_info",Block:"block_dialog",Dropdown:"overflow_menu",MediaViewer:"media_viewer",MessageMenu:"message_menu"});t.SpamFlow=r},22565:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.encryptAndMac=function(e,t,n){return(0,o.aesCbcEncrypt)(e,new Uint8Array(n)).then((e=>(0,s.hmacSha256)(t,e).then((t=>a.Binary.build(t,e).readBuffer()))))},t.macAndDecrypt=function(e,t,n){return Promise.resolve(new Uint8Array(n)).then((n=>{const r=(0,i.encodeB64)(n.subarray(0,32)),a=n.subarray(32);return(0,s.hmacSha256)(t,a).then((t=>{const n=(0,i.encodeB64)(t);if(r!==n)throw __LOG__(3)`crypto:macAndDecrypt HMAC don't match ${r} vs. ${n}`,new Error("macAndDecrypt HMAC mismatch");return(0,o.aesCbcDecryptSplit)(e,a)}))}))},t.removeEncryptedPadding=function(e,t){const n=e.slice(-t.byteLength);if((0,r.arrayBuffersDeepEqual)(n,t))return e.slice(0,e.byteLength-t.byteLength);return e};var r=n(95024),i=n(15688),a=n(8584),o=n(81484),s=n(11141)},47343:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.decodeBroadcastEphemeralSetting=function(){return _.apply(this,arguments)};var i=r(n(48926)),a=n(15688),o=n(8584),s=n(92844),l=n(84902),c=n(28286);const d=new Uint8Array(32);function u(){return p.apply(this,arguments)}function p(){return(p=(0,i.default)((function*(e,t){const n=yield self.crypto.subtle.importKey("raw",e,"HKDF",!1,["deriveKey"]),r=yield self.crypto.subtle.deriveKey({name:"HKDF",hash:"SHA-256",salt:d,info:t},n,{name:"HMAC",hash:"SHA-256"},!0,["verify"]);return self.crypto.subtle.exportKey("raw",r)}))).apply(this,arguments)}function f(){return h.apply(this,arguments)}function h(){return(h=(0,i.default)((function*(e,t,n){const r=e.slice(0,12),i=e.slice(12,44),a=yield self.crypto.subtle.importKey("raw",i,"AES-GCM",!1,["decrypt"]);return self.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(r),additionalData:n},a,t)}))).apply(this,arguments)}function _(){return(_=(0,i.default)((function*(e,t,n,r,i){const d=e.toString({legacy:!0}),p=t.toString({legacy:!0}),h=n.toString({legacy:!0}),_=o.Binary.build(`Ephemeral ${p} ${d}`).readByteArray(),g=new Uint8Array(i),m=(0,a.decodeB64)(r),y=o.Binary.build(h).readBuffer(),E=yield u(g,_),S=yield f(E,m,y),{duration:v,timestamp:T}=(0,l.decodeProtobuf)(c.EphemeralSettingSpec,S);if(null==v||null==T)throw new Error("ephSetting decoded into malformed proto");return{ephemeralDuration:v,ephemeralSettingTimestamp:(0,s.castLongIntToUnixTime)(T)}}))).apply(this,arguments)}},24606:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DisappearingModeInitiator=void 0;const r=n(76672)({ChangedInChat:"chat",InitiatedByMe:"me",InitiatedByOther:"other"});t.DisappearingModeInitiator=r},24175:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.generateEphemeralSystemMessage=function(){return d.apply(this,arguments)};var i=r(n(48926)),a=n(88555),o=n(40234),s=r(n(65212)),l=n(15461),c=n(99234);function d(){return(d=(0,i.default)((function*(e,t){if((0,a.isMDBackend)()){const r=n(5819).handleSingleMsgMD,i={id:new s.default({id:s.default.newId(),remote:e.id,fromMe:!1}),from:e.id,to:(0,c.getMaybeMeUser)(),t:o.Clock.globalUnixTime(),type:l.MSG_TYPE.PROTOCOL,subtype:"ephemeral_setting",ephemeralDuration:t,isNewMsg:!0};yield r(e.id,i,!1,!1)}}))).apply(this,arguments)}},28307:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getDisappearingModeSettingForChat=function(e){const t=c((0,s.getMaybeMeUser)()),n=c(e);if(!t&&!n)return null;if(t&&n)return n.duration<t.duration?n:t;return null!=n?n:t},t.getDisappearingModeSettingForUser=c,t.getDisappearingModeSettingFromMsg=function(e){var t;if(null==e)return null;const n=c((0,s.getMaybeMeUser)());let r=e.disappearingModeInitiator;if(null!=n&&null==e.disappearingModeInitiator)return n;if(null==n&&e.disappearingModeInitiator===o.DisappearingModeInitiator.InitiatedByMe)r=o.DisappearingModeInitiator.ChangedInChat;else if(null!=e.disappearingModeInitiator&&e.disappearingModeInitiator===o.DisappearingModeInitiator.ChangedInChat)return null;if(null==r)return null;const i=e.ephemeralDuration,a=null!==(t=e.ephemeralSettingTimestamp)&&void 0!==t?t:0;if(null==i||0===i)return null;if(null!=n&&n.settingTimestamp>a)return n;return{duration:i,settingTimestamp:a,initiator:r}};var i=n(88555),a=n(19380),o=n(24606),s=n(99234),l=r(n(68132));function c(e){var t;const n=(0,s.getMaybeMeUser)().toString()===e.toString(),r=a.ContactCollection.get(e);if(!r)return null;let c=r.disappearingModeDuration,d=r.disappearingModeSettingTimestamp;return(0,i.isLegacyWebdBackend)()&&n&&(c=l.default.disappearingMode.duration,d=l.default.disappearingMode.settingTimestamp),null==c||0===c?null:(__LOG__(2)`disappearing mode setting fetched for ${e.toString()}: duration=${c} settingTimestamp=${d}`,{duration:c,settingTimestamp:null!==(t=d)&&void 0!==t?t:0,initiator:n?o.DisappearingModeInitiator.InitiatedByMe:o.DisappearingModeInitiator.InitiatedByOther})}},6901:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getEphemeralExpirationTimestamp=function(e,t,n,r,i){if("ephemeral_setting"===r)return null;if(null==e||0===e)return null;if(i&&null!=t)return t+e;return n+e}},14777:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isEphemeralDurationAllowed=function(e){return!(e<0)&&(0===e||r.ServerProps.getEphemeralMessagesAllowedValues().includes(e))};var r=n(64551)},76290:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.shouldUpdateEphemeralSetting=function(e){const{oldDuration:t,oldSettingTimestamp:n,newDuration:i,newSettingTimestamp:a,chatId:o}=e;if(a>n)return!0;if(a<n)return!1;if(t===i)return!1;if((0,r.getMaybeMeUser)().isLessThan(o))return!1;return!0};var r=n(99234)},39519:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.currencyForCountryShortcode=function(e){const t=a.REGION_TO_CURRENCY[e.toUpperCase()];return(null==t?void 0:t.length)>0?t[0]:a.DEFAULT_CURRENCY},t.formatAmount1000=t.formatAmount=void 0,t.formatAmount1000ToParts=function(e,t){const n=c(),r=p(n),i=f(n,e),a=u(e,t).replace(i,"").trim(),o=a.indexOf(r),s=-1===o?a:a.substring(0,o),l=-1===o?"":a.substring(o);return{symbol:i,integer:s,decimal:l}},t.formatLocalSymbol=function(e){return f(s[e],e)},t.isSupportedCurrency=function(e){return l.has(e)},t.parseValueFromString=_,t.validatePriceString=function(e,t,n,r){const i=c(),o=void 0!==a.CURRENCY_DIGITS[e]?a.CURRENCY_DIGITS[e]:a.DEFAULT_DIGITS,s=h(e,t);if(null!=n&&s<n)return!1;if(null!=r&&s>r)return!1;const l=t.replace(/\D+$/g,""),d=p(i);if(Number.isNaN(s)||l!==t||(t.split(d)[1]||"").length>o)return!1;return!0},t.valueFromString=h;var i=r(n(81109)),a=n(76595),o=r(n(14296));const s={IDR:"in-ID",MXN:"es-MX",INR:"en-IN"},l=new Set(["DZD","ARS","AUD","BDT","BOB","BRL","GBP","CAD","CLP","CNY","COP","CRC","CZK","DKK","EGP","EUR","GTQ","HNL","HKD","HUF","ISK","INR","IDR","ILS","JPY","KES","KRW","MOP","MYR","MXN","NZD","NIO","NGN","NOK","PKR","PYG","PEN","PHP","PLN","QAR","RON","RUB","SAR","SGD","ZAR","SEK","CHF","TWD","THB","TRY","AED","USD","UYU","VEF","VND"]),c=()=>[o.default.getFullLocale(),o.default.getLocale()].filter(Boolean),d=function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:c();return new Intl.NumberFormat(r,(0,i.default)({style:"currency",currency:e},n)).format(t)};t.formatAmount=d;const u=(e,t,n,r)=>d(e,t/1e3,n,r);function p(e){return new Intl.NumberFormat(e).format(1.1).substring(1,2)}function f(e,t){return u(t,0,{},e).replace(/\d+([,.]\d+)?/g,"").trim()}function h(e,t){const n=c(),r=f(n,e),i=function(e){return new Intl.NumberFormat(e).format(1e4).substring(2,3)}(n);return _(t,r,p(n),i)}function _(e,t,n,r){const i=e.replace(t,"").trim().split(r).join(""),a=parseFloat(i.replace(n,".")||"0");return Math.round(1e3*a)}t.formatAmount1000=u},76595:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.REGION_TO_CURRENCY=t.MAX_FRACTION_DIGITS=t.DEFAULT_DIGITS=t.DEFAULT_CURRENCY=t.CURRENCY_DIGITS=void 0;t.DEFAULT_CURRENCY="USD";t.MAX_FRACTION_DIGITS=4;t.DEFAULT_DIGITS=2;t.CURRENCY_DIGITS={ADP:0,AFN:0,ALL:0,BHD:3,BIF:0,BYR:0,CLF:4,CLP:0,DJF:0,ESP:0,GNF:0,IQD:0,IRR:0,ISK:0,ITL:0,JOD:3,JPY:0,KMF:0,KPW:0,KRW:0,KWD:3,LAK:0,LBP:0,LUF:0,LYD:3,MGA:0,MGF:0,MMK:0,MRO:0,OMR:3,PYG:0,RSD:0,RWF:0,SLL:0,SOS:0,STD:0,SYP:0,TMM:0,TND:3,TRL:0,UGX:0,UYI:0,UYW:4,VND:0,VUV:0,XAF:0,XOF:0,XPF:0,YER:0,ZMK:0,ZWD:0};t.REGION_TO_CURRENCY={AC:["SHP"],AD:["EUR"],AE:["AED"],AF:["AFN"],AG:["XCD"],AI:["XCD"],AL:["ALL"],AM:["AMD"],AO:["AOA"],AR:["ARS"],AS:["USD"],AT:["EUR"],AU:["AUD"],AW:["AWG"],AX:["EUR"],AZ:["AZN"],BA:["BAM"],BB:["BBD"],BD:["BDT"],BE:["EUR"],BF:["XOF"],BG:["BGN"],BH:["BHD"],BI:["BIF"],BJ:["XOF"],BL:["EUR"],BM:["BMD"],BN:["BND"],BO:["BOB"],BQ:["USD"],BR:["BRL"],BS:["BSD"],BT:["BTN","INR"],BV:["NOK"],BW:["BWP"],BY:["BYN"],BZ:["BZD"],CA:["CAD"],CC:["AUD"],CD:["CDF"],CF:["XAF"],CG:["XAF"],CH:["CHF"],CI:["XOF"],CK:["NZD"],CL:["CLP"],CM:["XAF"],CN:["CNY"],CO:["COP"],CR:["CRC"],CU:["CUP","CUC"],CV:["CVE"],CW:["ANG"],CX:["AUD"],CY:["EUR"],CZ:["CZK"],DE:["EUR"],DG:["USD"],DJ:["DJF"],DK:["DKK"],DM:["XCD"],DO:["DOP"],DZ:["DZD"],EA:["EUR"],EC:["USD"],EE:["EUR"],EG:["EGP"],EH:["MAD"],ER:["ERN"],ES:["EUR"],ET:["ETB"],EU:["EUR"],FI:["EUR"],FJ:["FJD"],FK:["FKP"],FM:["USD"],FO:["DKK"],FR:["EUR"],GA:["XAF"],GB:["GBP"],GD:["XCD"],GE:["GEL"],GF:["EUR"],GG:["GBP"],GH:["GHS"],GI:["GIP"],GL:["DKK"],GM:["GMD"],GN:["GNF"],GP:["EUR"],GQ:["XAF"],GR:["EUR"],GS:["GBP"],GT:["GTQ"],GU:["USD"],GW:["XOF"],GY:["GYD"],HK:["HKD"],HM:["AUD"],HN:["HNL"],HR:["HRK"],HT:["HTG","USD"],HU:["HUF"],IC:["EUR"],ID:["IDR"],IE:["EUR"],IL:["ILS"],IM:["GBP"],IN:["INR"],IO:["USD"],IQ:["IQD"],IR:["IRR"],IS:["ISK"],IT:["EUR"],JE:["GBP"],JM:["JMD"],JO:["JOD"],JP:["JPY"],KE:["KES"],KG:["KGS"],KH:["KHR"],KI:["AUD"],KM:["KMF"],KN:["XCD"],KP:["KPW"],KR:["KRW"],KW:["KWD"],KY:["KYD"],KZ:["KZT"],LA:["LAK"],LB:["LBP"],LC:["XCD"],LI:["CHF"],LK:["LKR"],LR:["LRD"],LS:["ZAR","LSL"],LT:["EUR"],LU:["EUR"],LV:["EUR"],LY:["LYD"],MA:["MAD"],MC:["EUR"],MD:["MDL"],ME:["EUR"],MF:["EUR"],MG:["MGA"],MH:["USD"],MK:["MKD"],ML:["XOF"],MM:["MMK"],MN:["MNT"],MO:["MOP"],MP:["USD"],MQ:["EUR"],MR:["MRU"],MS:["XCD"],MT:["EUR"],MU:["MUR"],MV:["MVR"],MW:["MWK"],MX:["MXN"],MY:["MYR"],MZ:["MZN"],NA:["NAD","ZAR"],NC:["XPF"],NE:["XOF"],NF:["AUD"],NG:["NGN"],NI:["NIO"],NL:["EUR"],NO:["NOK"],NP:["NPR"],NR:["AUD"],NU:["NZD"],NZ:["NZD"],OM:["OMR"],PA:["PAB","USD"],PE:["PEN"],PF:["XPF"],PG:["PGK"],PH:["PHP"],PK:["PKR"],PL:["PLN"],PM:["EUR"],PN:["NZD"],PR:["USD"],PS:["ILS","JOD"],PT:["EUR"],PW:["USD"],PY:["PYG"],QA:["QAR"],RE:["EUR"],RO:["RON"],RS:["RSD"],RU:["RUB"],RW:["RWF"],SA:["SAR"],SB:["SBD"],SC:["SCR"],SD:["SDG"],SE:["SEK"],SG:["SGD"],SH:["SHP"],SI:["EUR"],SJ:["NOK"],SK:["EUR"],SL:["SLL"],SM:["EUR"],SN:["XOF"],SO:["SOS"],SR:["SRD"],SS:["SSP"],ST:["STN"],SV:["USD"],SX:["ANG"],SY:["SYP"],SZ:["SZL"],TA:["GBP"],TC:["USD"],TD:["XAF"],TF:["EUR"],TG:["XOF"],TH:["THB"],TJ:["TJS"],TK:["NZD"],TL:["USD"],TM:["TMT"],TN:["TND"],TO:["TOP"],TR:["TRY"],TT:["TTD"],TV:["AUD"],TW:["TWD"],TZ:["TZS"],UA:["UAH"],UG:["UGX"],UM:["USD"],US:["USD"],UY:["UYU"],UZ:["UZS"],VA:["EUR"],VC:["XCD"],VE:["VES"],VG:["USD"],VI:["USD"],VN:["VND"],VU:["VUV"],WF:["XPF"],WS:["WST"],XK:["EUR"],YE:["YER"],YT:["EUR"],ZA:["ZAR"],ZM:["ZMW"],ZW:["USD"]}},67811:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.REVOKED_REACTION_TEXT=t.MAX_REACTIONS_DISPLAY_AGGREGATES=void 0,t.canHaveReactions=v,t.canReactToMessage=function(e){var t;if(!(0,f.sendReactionsEnabled)())return!1;if(!v(e.type))return!1;if(null===(t=e.chat.groupMetadata)||void 0===t?void 0:t.announce)return!(e.chat.groupMetadata.groupType===h.GroupType.DEFAULT_ANNOUNCEMENT_GROUP&&!(0,f.reactionsCommunityAnnouncementOnly)())&&e.replyChecks();return e.canReply()},t.canRevokeReaction=function(){return(0,f.sendReactionsEnabled)()},t.createReactionsRowFromOffline=function(){return T.apply(this,arguments)},t.getReactionAggregates=E,t.getReactionEmojisAndSum=function(e){let t=[],n=0;if(0===e.length)return{numberOfSenderReactions:n,reactionArrayEmojis:t};if(1!==e.length)return function(e){let t=[],n=0;const r=E(e),i=r.slice(0,3);return t=i.map((e=>e.reactionByMe?e.reactionByMe.reactionText:e.reactionAggregate)),n=r.reduce(((e,t)=>e+t.reactionSenders.length),0),{numberOfSenderReactions:n,reactionArrayEmojis:t}}(e);{const r=e[0],i=r.reactions.slice(0,3);t=i.map((e=>(e.hasReactionByMe&&r.reactionByMe,e.hasReactionByMe&&r.reactionByMe?r.reactionByMe.reactionText:e.aggregateEmoji))),n=r.reactions.reduce(((e,t)=>e+t.senders.length),0)}return{numberOfSenderReactions:n,reactionArrayEmojis:t}},t.isReactionByMe=S,t.lastMessageReactionChange=function(e){const t=n(59871).MsgCollection;e.forEach((e=>{const n=t.get(e);(null==n?void 0:n.isLastMessage())&&d.Cmd.reactionChangeLastMessage()}))},t.reactionBubbleAriaLabelOneReaction=function(e,t){return c.fbt._("{name} reacted with {reactionContent}",[c.fbt._param("name",e),c.fbt._param("reactionContent",t)],{hk:"2Vcjyz"})},t.reactionBubbleAriaLabelString=function(e,t){const n=t.join(_.default.t(407));if(1===e)return c.fbt._("reaction {reactions_content}",[c.fbt._param("reactions_content",n)],{hk:"2ksvWq"});return c.fbt._({"*":"Reactions {reactions_content} {num_sender_reactions} in total",_1:"Reactions {reactions_content} 1 in total"},[c.fbt._plural(e,"num_sender_reactions"),c.fbt._param("reactions_content",n)],{hk:"3KYY1f"})},t.reactionSenderToReactionUpdate=function(e){const{id:t,parentMsgKey:n,reactionText:r,senderUserJid:i}=e;return{parentMsgKey:o.default.fromString(n),msgKey:t,reactionText:r,senderUserJid:i}},t.shouldShowReactionBubble=function(e,t){if(!(0,f.receiveReactionsEnabled)())return!1;if(!v(e.type))return!1;if(t===m.ReactionBubbleType.NON_CONVERSATION)return!1;if(t===m.ReactionBubbleType.MEDIA_ITEM&&e.type===s.MSG_TYPE.STICKER)return!1;return!0},t.webMsgInfoReactionTypeToReactionsRow=function(e){let{id:t,reactionTimestamp:n,reactionText:r,reactionParentKey:i,sender:a,unread:o}=e;const s=(0,l.toUserWid)(a);return{msgKey:t.toString(),parentMsgKey:i.toString(),senderUserJid:s.toString(),reactionText:null!=r?r:"",timestamp:n,orphan:0,read:!o}};var i=r(n(48926)),a=r(n(81109)),o=r(n(65212)),s=n(15461),l=n(45454),c=n(48360),d=n(88102),u=n(67247),p=n(99234),f=n(57701),h=n(55981),_=r(n(14296)),g=n(84886),m=n(94270),y=n(26704);t.REVOKED_REACTION_TEXT="";function E(e){const t=new Map;e.forEach((e=>{let n=null;if(e.reactionByMe){const a=e.reactionByMe.reactionText;n=u.EmojiUtil.getEmojiAggregate(a);const o=t.get(n);if(o){var r,i;const t=(null===(r=o.reactionByMe)||void 0===r?void 0:r.timestamp)||0,n=(null===(i=e.reactionByMe)||void 0===i?void 0:i.timestamp)||0;(o.reactionByMe&&t<n||!o.reactionByMe)&&(o.reactionByMe=e.reactionByMe)}}e.reactions.forEach((n=>{const r=n.aggregateEmoji,i=n.senders.toArray(),a=t.get(r);if(a){const e=a.reactionSenders.concat(i);a.reactionSenders=e,t.set(r,a)}else{const a=n.hasReactionByMe?e.reactionByMe:null;t.set(r,{reactionByMe:a,reactionSenders:i,reactionAggregate:r})}}))}));return Array.from(t.values()).map((e=>{const t=e.reactionSenders.sort(((e,t)=>S(e.senderUserJid)&&!S(t.senderUserJid)?-1:S(t.senderUserJid)&&!S(e.senderUserJid)?1:t.timestamp-e.timestamp));return(0,a.default)((0,a.default)({},e),{},{reactionSenders:t})})).sort(((e,t)=>e.reactionByMe&&t.reactionByMe?t.reactionSenders.length===e.reactionSenders.length?t.reactionByMe.timestamp-e.reactionByMe.timestamp:t.reactionSenders.length-e.reactionSenders.length:e.reactionByMe?-1:t.reactionByMe?1:t.reactionSenders.length===e.reactionSenders.length?t.reactionSenders[0].timestamp-e.reactionSenders[0].timestamp:t.reactionSenders.length-e.reactionSenders.length))}function S(e){return e===(0,p.getMaybeMeUser)().toString()}function v(e){return!(!(0,f.receiveReactionsEnabled)()||e===s.MSG_TYPE.UNKNOWN||e===s.MSG_TYPE.CIPHERTEXT||e===s.MSG_TYPE.REVOKED||e===s.MSG_TYPE.DEBUG||e===s.MSG_TYPE.GP2||e===s.MSG_TYPE.NOTIFICATION||e===s.MSG_TYPE.NOTIFICATION_TEMPLATE||e===s.MSG_TYPE.E2E_NOTIFICATION||e===s.MSG_TYPE.CALL_LOG)}function T(){return(T=(0,i.default)((function*(e){const t=[],n=[];e.forEach((e=>{e.msg&&n.push(e.msg.reactionParentKey.toString())}));const r=yield(0,g.getMsgsByMsgKey)(n),i=new Map;return r.forEach((e=>{i.set(e.id.toString(),e)})),e.forEach((e=>{var n,r;const a=e.msg,o=null===(n=e.receiptInfo)||void 0===n?void 0:n.author;if(!o||!a)return void __LOG__(3)`createReactionsRowFromOffline: sender or reactionMsg are null`;const c=i.get(a.reactionParentKey.toString());let d,u=0;if(c||(u=1,d=y.OrphanReactionsReasonType.ParentMsgMissing),(null==c?void 0:c.type)===s.MSG_TYPE.CIPHERTEXT&&(u=1,d=y.OrphanReactionsReasonType.ParentMsgPlaceholder),c&&c.type!==s.MSG_TYPE.CIPHERTEXT&&!v(c.type))return void __LOG__(3)`createReactionsRowFromOffline: reactions not allowed for this message type ${c.type}`;const p=(0,l.toUserWid)(o),f={msgKey:a.id.toString(),parentMsgKey:a.reactionParentKey.toString(),senderUserJid:p.toString(),reactionText:null!==(r=a.reactionText)&&void 0!==r?r:"",timestamp:a.reactionTimestamp,orphan:u,orphanReason:d,read:!1};t.push(f)})),t}))).apply(this,arguments)}t.MAX_REACTIONS_DISPLAY_AGGREGATES=3},64603:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TcTokenMode=void 0,t.getTcTokenDuration=s,t.isTokenExpired=function(e,t){return e<l(t)},t.shouldSendNewToken=function(e){if(null==e)return!0;const t=(0,a.getABPropConfigValue)("tctoken_duration_sender"),n=Math.floor(i.Clock.globalUnixTime()/t),r=Math.floor(e/t);return n>r},t.tokenExpirationCutoff=l;var r=n(92844),i=n(40234),a=n(57849);const o=n(76672)({Sender:"sender",Receiver:"receiver"});function s(e){const t=e===o.Receiver?"tctoken_duration":"tctoken_duration_sender";return(0,r.castToUnixTime)(Math.min((0,a.getABPropConfigValue)(t),15552e3))}function l(e){const t=e===o.Receiver?"tctoken_num_buckets":"tctoken_num_buckets_sender",n=(0,a.getABPropConfigValue)(t),l=s(e),c=Math.floor(i.Clock.globalUnixTime()/l);return(0,r.castToUnixTime)((c-(n-1))*l)}t.TcTokenMode=o},69048:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(48926)),a=r(n(81109)),o=r(n(45095)),s=r(n(51998)),l=n(6663),c=r(n(79038));var d=new class{constructor(){this._pendingMap=new Map}_ensureWorkerInited(){this._worker||(c.default.onerror=e=>{this._handleWorkerError(e)},c.default.onmessageerror=e=>{this._handleMessageError(e)},c.default.onmessage=e=>{const t=e.data;this._handleWorkerResponse(t)},this._worker=c.default)}_handleMessageError(){}_handleWorkerError(e){__LOG__(3)`FTS:client: worker error: ${e}`}_handleWorkerResponse(e){const{reqId:t}=e,n=this._pendingMap.get(t);n&&(e.error?(__LOG__(3)`FTS:client: worker completed job ${n.command.operation} with error`,n.reject(new Error("FTS worker error"))):n.resolve(e.result),this._untrackInvocation(t))}startIndexer(){return this._runCommand({operation:"start-indexer"})}indexFull(){return this._runCommand({operation:"run"})}index(){return this._runCommand({operation:"consume"})}purge(e){return this._runCommand({operation:"purge",ids:e})}purgeRange(e){return this._runCommand((0,a.default)({operation:"purge-range"},e))}reInit(){return this._runCommand({operation:"re-init"})}clearInitializationPromises(){return this._runCommand({operation:"clear-init"})}search(e,t){var n=this;return(0,i.default)((function*(){const r=yield n._runCommand({operation:"find",query:e,queryOptions:t});return n._coerceToSearchResult(r)}))()}_coerceToSearchResult(e){var t=this;return(0,i.default)((function*(){if(Array.isArray(e)||"boolean"==typeof e)return{canceled:!1,eof:!0,status:404,messages:[]};const{resolved:n,unresolved:r}=yield(0,l.resolveMsgIds)(e.messages),{eof:i,status:a}=e;return r.length>0&&t.purge(r),{canceled:!1,eof:i,status:a,messages:n}}))()}_runCommand(e){this._ensureWorkerInited();const t=(0,s.default)();return new Promise(((n,r)=>{this._pendingMap.set(t,{resolve:n,reject:r,command:e}),this._message({command:e,reqId:t})})).finally((()=>{this._untrackInvocation(t)}))}_untrackInvocation(e){this._pendingMap.delete(e)}_message(e){(0,o.default)(this._worker,"this._worker").postMessage(e)}};t.default=d},6663:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.resolveMsgIds=function(e){if((0,r.isMDBackend)()){const t=e.map((e=>+e.id)),n=new Map(e.map((e=>[+e.id,e])));return(0,i.getTable)().anyOf(["rowId"],t).then((e=>{const t=[];e.forEach((e=>{const r=(0,a.hydrateMessage)(e),i=n.get(r.rowId);null!=i&&i.id===String(r.rowId)&&i.timestamp===r.t&&i.chatId===r.id.remote.toString()&&(t.push(r),n.delete(r.rowId))}));const r=Array.from(n.keys(),(e=>String(e)));return t.sort(((e,t)=>t.t-e.t)),{resolved:t,unresolved:r}}))}return Promise.resolve({resolved:[],unresolved:[]})};var r=n(88555),i=n(90981),a=n(12896)},80872:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FTS_TYPING_DELAY=t.FTS_TTL=t.FTS_NUM_RESULTS=t.FTS_MIN_CHARS=void 0;t.FTS_MIN_CHARS=2;t.FTS_TTL=6e4;t.FTS_TYPING_DELAY=300;t.FTS_NUM_RESULTS=30},51998:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return n++};let n=0},88555:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isLegacyWebdBackend=function(){return!r.GK.supportsFeature(r.GK.F.MD_BACKEND)},t.isMDBackend=function(){return r.GK.supportsFeature(r.GK.F.MD_BACKEND)};var r=n(7293)},10206:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.debugDisableFeatureFlag=function(e){n[e]=!1},t.debugEnableFeatureFlag=function(e){n[e]=!0},t.isFeatureEnabled=function(e){return n[e]},t.overwriteDebugFeatures=function(){};const n={a11y_block:!1,format_bulleted_msg:!1,web_voip_voice_call:!1,web_voip_video_call:!1,youtube_video_preview_without_blur:!1}},7293:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.GK=t.FEATURE_CHANGE_EVENT=void 0,t.getProtobufFeatureName=E;var i=r(n(23279)),a=r(n(18446)),o=r(n(14176)),s=r(n(66678)),l=r(n(44908)),c=r(n(85564)),d=r(n(11865)),u=r(n(82492)),p=r(n(17204)),f=r(n(76521)),h=(r(n(53565)),n(21224));const _=(0,p.default)(Object.keys(h.WebFeaturesSpec.internalSpec).map((e=>[E(e),!1]))),g={RESEND_ICON:!1,DEBUG_COMMANDS:!1,MD_BACKEND:!1,MEDIA_AUTO_DOWNLOAD:!1,DOWNLOAD_STATUS_THUMB_MMS:!1,MEDIA_EXISTENCE_CHECK:!1,SKIP_COMPLIANCE_PHONE_CHECK:!1},m=[[(0,u.default)(g,_),{},{},{},{ARCHIVE_BROADCAST:!0},{RECENT_EMOJI_SYNC:!0},{},{},{},{},{},{STARRED_GIFS:!1,INDEX_RECEIVED_VCARD:!1},{STATUS_V3_UI_SENDING:!1},{MEDIAS_COUNT:!1},{},{VOIP_VOICE_CALL:!0},{DESKTOP_VOIP_VOICE_CALL:!0,DESKTOP_VOIP_VIDEO_CALL:!0,DESKTOP_VOIP_GROUP_VOICE_CALL:!1,DESKTOP_VOIP_GROUP_VIDEO_CALL:!1}]],y={KEY_PARTICIPANT:!1,RICH_TEXT:!0};function E(e){return(0,d.default)(e).toUpperCase()}const S="feature_change";t.FEATURE_CHANGE_EVENT=S;class v extends f.default{constructor(){super(),this.FEATURE_CHANGE_EVENT=S,this.silenceChangeEvents=!0,this.triggerFeaturesChangedDebounced=(0,i.default)((()=>{this.trigger(S)}),50),this.features={};const e=(0,c.default)((0,c.default)(m).map(Object.keys)).concat(Object.keys(y));this.F=(0,p.default)((0,l.default)(e).map((e=>[e,e]))),this.setVersion([0,0]),this.silenceChangeEvents=!1}setVersion(e){if(this.proto&&this.proto.length===e.length&&this.proto[0]===e[0]&&this.proto[1]===e[1])return;this.proto=e;const t=m.slice(0,e[0]+1),n=m.slice(e[0]+1,m.length),r=t[e[0]],i=r.slice(0,e[1]+1),l=r.slice(e[1]+1,r.length);t[e[0]]=i,n.unshift(l);const d=(0,s.default)(this.features);this.features=(0,u.default)((0,o.default)((0,u.default)({},...(0,c.default)(t)),(e=>!e)),this.features||{});const f=(0,u.default)({},...(0,c.default)(n));this.features=(0,o.default)(this.features,((e,t)=>!!f[t])),this.VF=(0,p.default)(Object.keys((0,u.default)({},...(0,c.default)(t))).map((e=>[e,e]))),(0,a.default)(d,this.features)||this.triggerFeaturesChanged()}setPlatform(e){let t=!1;switch(e){case"iphone":t=!1!==this.features.RECENT_EMOJI_SYNC||!1!==this.features.ARCHIVE_BROADCAST||!0!==this.features.RESEND_ICON,this.features.RECENT_EMOJI_SYNC=!1,this.features.ARCHIVE_BROADCAST=!1,this.features.RESEND_ICON=!0}t&&this.triggerFeaturesChanged()}setFeatureFromFlags(e,t,n){let r=!1;switch(n){case h.WebFeaturesFlag.FORCE_UPGRADE:switch(t){case h.WebFeaturesFlag.FORCE_UPGRADE:r=!0;break;case h.WebFeaturesFlag.PRODUCTION:case h.WebFeaturesFlag.DEVELOPMENT:case h.WebFeaturesFlag.NOT_STARTED:r=!1,__LOG__(4,void 0,new Error,!0)`wap:features:${e} phone value is ${n} and web value is ${t}.`,SEND_LOGS("wap_feature_unreachable_code")}break;case h.WebFeaturesFlag.PRODUCTION:switch(t){case h.WebFeaturesFlag.FORCE_UPGRADE:r=!1,__LOG__(4,void 0,new Error,!0)`wap:features:${e} phone value is ${n} and web value is ${t}.`,SEND_LOGS("wap_feature_unexpected");break;case h.WebFeaturesFlag.PRODUCTION:r=!0;break;case h.WebFeaturesFlag.DEVELOPMENT:case h.WebFeaturesFlag.NOT_STARTED:r=!1}break;case h.WebFeaturesFlag.DEVELOPMENT:switch(t){case h.WebFeaturesFlag.FORCE_UPGRADE:case h.WebFeaturesFlag.PRODUCTION:case h.WebFeaturesFlag.DEVELOPMENT:case h.WebFeaturesFlag.NOT_STARTED:r=!1}break;case h.WebFeaturesFlag.NOT_STARTED:r=!1}const i=E(e);return this.setFeature(i,r)}setFeature(e,t){let n;n=!!t;const r=this.features[e]!==n;return this.features[e]=n,r&&this.triggerFeaturesChanged(),r}setFeatures(e){const t={},n=(0,u.default)({},y,e);for(const e in n)e in this.VF||(t[e]=this.setFeature(e,n[e]));return t}supportsFeature(e){return!!this.features[e]}supportsFeatureFromFlags(e){const t=E(e);return this.supportsFeature(t)}supportsAllFeatures(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.every((e=>!!this.features[e]))}supportsAnyFeature(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.some((e=>!!this.features[e]))}resetFeatures(){this.proto=[0,0],this.features={},this.triggerFeaturesChanged()}triggerFeaturesChanged(){this.silenceChangeEvents||this.triggerFeaturesChangedDebounced()}overwriteDebugGKs(){}}const T=new v;t.GK=T},57701:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.adminRevokeHistorySyncConsumerEnabled=function(){if((0,r.isMDBackend)())return(0,i.getABPropConfigValue)("admin_revoke_history_sync_consumer");return!1},t.adminRevokeReceiverEnabled=function(){if((0,r.isMDBackend)())return(0,i.getABPropConfigValue)("admin_revoke_receiver");return!1},t.adminRevokeSenderEnabled=function(){if((0,r.isMDBackend)())return(0,i.getABPropConfigValue)("admin_revoke_sender");return!1},t.archiveV2Supported=function(){if((0,r.isMDBackend)())return(0,i.getABPropConfigValue)("sync_archive_v2_setting");return c.GK.supportsFeature(c.GK.F.ARCHIVE_V_2)},t.bannedShopsEnabled=function(){if((0,r.isMDBackend)())return(0,i.getABPropConfigValue)("banned_shops_ux_enabled");return!1},t.bizLinkedAccountsEnabled=function(){if((0,r.isMDBackend)())return(0,i.getABPropConfigValue)("web_abprop_business_profile_refresh_linked_account_enabled");return!1},t.blockCatalogCreationECommerceComplianceIndia=function(e){var t;return h(null==e?void 0:e.id.user,(()=>(0,i.getABPropConfigValue)("web_abprop_block_catalog_creation_ecommerce_compliance_india")),(()=>p.ServerProps.blockCatalogCreationEcommerceComplianceIndia))&&(null==e||null===(t=e.profileOptions)||void 0===t?void 0:t.commerceExperience)===a.COMMERCE_EXPERIENCE_TYPES.NONE},t.btmThreadsLoggingEnabled=function(){if((0,r.isMDBackend)())return(0,i.getABPropConfigValue)("btm_threads_logging_enabled");return!1},t.buttonsMessagesEnabled=function(){return p.ServerProps.webButtonsMessage},t.cadminSelfDemoteEnabled=function(){return!1},t.canAppealCollections=function(){if((0,r.isMDBackend)())return(0,i.getABPropConfigValue)("smb_collections_appeal_flow_enabled");return p.ServerProps.webCollectionsAppealEnabled},t.canDisplayLabel=function(){if((0,r.isMDBackend)())return s.Conn.isSMB;return c.GK.supportsFeature(c.GK.F.LABELS_DISPLAY)},t.canEditLabel=function(){if((0,r.isMDBackend)())return!1;return c.GK.supportsFeature(c.GK.F.LABELS_EDIT)},t.canEditLabelAssociation=function(){if((0,r.isMDBackend)())return s.Conn.isSMB;return c.GK.supportsFeature(c.GK.F.LABELS_EDIT)},t.canManageCollections=function(){if((0,r.isMDBackend)())return(0,i.getABPropConfigValue)("smb_collections_enabled");return p.ServerProps.webCollectionsManagement},t.canSeeBizProfileV3=function(){if((0,r.isMDBackend)())return(0,i.getABPropConfigValue)("business_profile_refresh_m1_enabled");return p.ServerProps.webBizProfileV3Enabled},t.canSeeECommerceComplianceIndiaCountryOriginExemptBusinessJourney=function(e){return h(e,(()=>(0,i.getABPropConfigValue)("smb_ecommerce_compliance_india_m4_5")),(()=>p.ServerProps.smbEcommerceComplianceIndiaM4_5))},t.canSeeECommerceComplianceIndiaHardEnforcementBusinessJourney=function(e){return h(e,(()=>(0,i.getABPropConfigValue)("smb_ecommerce_compliance_india_m4")),(()=>p.ServerProps.smbEcommerceComplianceIndiaM4))},t.canSeeECommerceComplianceIndiaSoftEnforcement=function(e){return f(e)},t.canSeeSMBUpsell=function(){return p.ServerProps.webSMBUpsellInBizProfile},t.canSeeStatusV3OnContact=function(){if((0,r.isMDBackend)())return(0,i.getABPropConfigValue)("web_abprop_business_profile_refresh_status_enabled");return p.ServerProps.webBizProfileV3M2},t.canSendQuickReply=function(){if((0,r.isMDBackend)())return s.Conn.isSMB;return c.GK.supportsFeature(c.GK.F.QUICK_REPLIES_QUERY)},t.canToggleCartOnOff=function(){return(0,r.isMDBackend)()&&p.ServerProps.webCartOnOffToggle},t.canViewCollections=function(){if((0,r.isMDBackend)())return(0,i.getABPropConfigValue)("consumer_collections_enabled");return p.ServerProps.webCollectionsDisplay},t.clearOrDeleteChatSyncEnabled=function(){if(p.ServerProps.syncdClearChatDeleteChatEnabled&&(s.Conn.platform===s.PLATFORMS.ANDROID||s.Conn.platform===s.PLATFORMS.SMBA)&&(0,d.getPrimaryAllowsAllMutations)())return!0;return!1},t.commerceFeaturesDisabledBySanctions=function(){if((0,r.isMDBackend)())return(0,i.getABPropConfigValue)("commerce_sanctioned");return!1},t.commerceThreadsLoggingEnabled=function(){return!(0,r.isLegacyWebdBackend)()&&(0,i.getABPropConfigValue)("native_commerce_threads_logging_enabled")},t.communitiesEnabled=m,t.communityCreationEnabled=function(){return!1},t.countryGatingEnabled=function(){if((0,r.isMDBackend)())return(0,i.getABPropConfigValue)("country_client_gating_enabled");return!1},t.forwardingLimitToGroupsEnabled=function(){return p.ServerProps.webForwardingLimitToGroups||!1},t.getGroupSizeLimit=function(){let e;(0,r.isMDBackend)()&&(e=(0,i.getABPropConfigValue)("group_size_limit")-1);(null==e||e<=0||Number.isNaN(e))&&(e=p.ServerProps.maxParticipants);return e},t.getMaxPollNameLength=function(){return(0,r.isLegacyWebdBackend)()?0:Math.min((0,i.getABPropConfigValue)("poll_name_length"),100)},t.getMaxPollOptionCount=function(){return(0,r.isLegacyWebdBackend)()?0:Math.min((0,i.getABPropConfigValue)("poll_option_count"),20)},t.getMaxPollOptionLength=function(){return(0,r.isLegacyWebdBackend)()?0:Math.min((0,i.getABPropConfigValue)("poll_option_length"),100)},t.getPollCleanupDays=function(){return(0,r.isLegacyWebdBackend)()?0:(0,i.getABPropConfigValue)("poll_cleanup_days")},t.getPollOfflineAccuracy=function(){return(0,r.isLegacyWebdBackend)()?0:(0,i.getABPropConfigValue)("poll_offline_accuracy")},t.graphQLForCatalogM1Enabled=function(){return(0,r.isMDBackend)()&&(0,i.getABPropConfigValue)("graphql_privacy_imp_m1")},t.graphQLForCollectionM2Enabled=function(){return(0,r.isMDBackend)()&&(0,i.getABPropConfigValue)("graphql_privacy_imp_m2")},t.hideUnsupportedCurrency=function(){if((0,r.isMDBackend)())return(0,i.getABPropConfigValue)("smb_hide_unsupported_currency_price");return!1},t.hyperlinkedPhoneNumbersEnabled=function(){if((0,r.isMDBackend)())return(0,i.getABPropConfigValue)("hyperlinked_phone_numbers_enabled");return!1},t.hyperlinkedPhoneNumbersPsLoggingEnabled=function(){if((0,r.isMDBackend)())return(0,i.getABPropConfigValue)("web_enable_hyperlinked_phone_numbers_ps_logging");return!1},t.identityStoreCacheEnabled=function(){if((0,r.isMDBackend)())return(0,i.getABPropConfigValue)("web_identity_store_cache");return!1},t.interactiveNativeFlowMessagesEnabled=function(){if((0,r.isMDBackend)())return!(0,i.getABPropConfigValue)("interactive_message_native_flow_killswitch");return!1},t.isHighQualityVideoThumbnailsEnabled=function(){const{UA:e}=n(26741);return!e.isGecko},t.isMediaGalleryFixEnabled=function(){return(0,r.isMDBackend)()},t.isMultiDeviceAgentsEnabled=function(){return!((0,r.isLegacyWebdBackend)()||!s.Conn.isSMB)&&(0,i.getABPropConfigValue)("smb_multi_device_agents_enabled")},t.isPollsCreationEnabled=y,t.isPollsFutureproofUpdateHidingEnabled=function(){return!(0,r.isLegacyWebdBackend)()&&(0,i.getABPropConfigValue)("poll_hide_futureproof_update_placeholders")},t.isPollsReceivingEnabled=function(){return!(0,r.isLegacyWebdBackend)()&&(!!y()||(0,i.getABPropConfigValue)("poll_receiving_enabled"))},t.isRecentStickersEnabled=E,t.isStarredStickersEnabled=function(){return c.GK.supportsFeature(c.GK.F.STARRED_STICKERS)&&E()},t.isThirdPartyStickersEnabled=function(){return c.GK.supportsAllFeatures(c.GK.F.THIRD_PARTY_STICKERS,c.GK.F.MEDIA_UPLOAD)},t.mdMigrationExperience=function(){return s.Conn.isSMB&&p.ServerProps.webMdMigrationExperience},t.mediaUploadPrekeysFetchEnabled=function(){if((0,r.isMDBackend)())return(0,i.getABPropConfigValue)("media_upload_prekeys_fetch_enabled");return!1},t.moreReactionsOption=function(){if((0,r.isMDBackend)())return!1;return!1},t.nativeFlowMessagesEnabled=function(){if((0,r.isMDBackend)())return(0,i.getABPropConfigValue)("nfm_rendering_enabled");return!1},t.newComposeBoxInputEnabled=function(){if((0,r.isMDBackend)())return(0,i.getABPropConfigValue)("web_new_compose_box_input");return!1},t.orderDetailsCustomItemEnabled=function(){if((0,r.isMDBackend)())return(0,i.getABPropConfigValue)("order_details_custom_item_enabled");return!1},t.orderDetailsFromCartEnabled=function(){if((0,r.isMDBackend)())return(0,i.getABPropConfigValue)("order_details_from_cart_enabled");return!1},t.orderDetailsFromCatalogEnabled=function(){if((0,r.isMDBackend)())return(0,i.getABPropConfigValue)("order_details_from_catalog_enabled");return!1},t.orderManagementEnabled=function(){if((0,r.isMDBackend)())return(0,i.getABPropConfigValue)("order_management_enabled");return!1},t.parseWMIReaction=function(){if((0,r.isMDBackend)())return(0,i.getABPropConfigValue)("reaction_history_sync")||g();return!1},t.paymentBackgroundEnabled=function(){if((0,r.isMDBackend)()&&p.ServerProps.webPaymentBackgroundEnabled)return!0;return!1},t.phaseOutNotABusiness=function(){if((0,r.isMDBackend)())return(0,i.getABPropConfigValue)("smb_phase_out_not_a_business");return!1},t.pinChatSyncEnabled=function(){if(p.ServerProps.syncdPinChatEnabled)return!!(s.Conn.platform!==s.PLATFORMS.ANDROID&&s.Conn.platform!==s.PLATFORMS.SMBA||(0,d.getPrimaryAllowsAllMutations)());return!1},t.privacyAllowContactsExceptEnabled=function(){if((0,r.isMDBackend)())return(0,i.getABPropConfigValue)("privacy_allow_contacts_except")&&u.PrimaryFeatures.contactExcept;return!1},t.privacySettingsEnabled=function(){return(0,r.isMDBackend)()},t.proactivePrekeysFetchGroupSizeLimit=function(){if((0,r.isMDBackend)())return(0,i.getABPropConfigValue)("web_proactive_prekeys_fetch_group_size_limit")||0;return 0},t.productListMessageFallbackEnabled=function(){return p.ServerProps.webProductListMessageFallback},t.productListMessagesEnabled=function(){return p.ServerProps.webProductListMessage},t.reactionsAnimationsEnabled=function(){if(c.GK.supportsFeature(c.GK.F.MD_BACKEND))return g()&&(0,i.getABPropConfigValue)("reactions_animations");return!1},t.reactionsCommunityAnnouncementOnly=function(){if((0,r.isMDBackend)())return(0,i.getABPropConfigValue)("reactions_announcement_only");return!1},t.receiveReactionsEnabled=g,t.rotateSenderKeyIfSentEnabled=function(){if((0,r.isMDBackend)())return(0,i.getABPropConfigValue)("web_rotate_sender_key_if_sent");return!1},t.sendKeyDistributionMsgMinGroupSize=function(){if((0,r.isMDBackend)())return(0,i.getABPropConfigValue)("web_send_invisible_msg_min_group_size");return 0},t.sendKeyDistributionMsgToNewGroups=function(){if((0,r.isMDBackend)())return(0,i.getABPropConfigValue)("web_send_invisible_msg_to_new_groups");return!1},t.sendReactionsEnabled=_,t.shopsInteractiveMessageEnabled=function(){if((0,r.isMDBackend)())return(0,i.getABPropConfigValue)("web_shop_storefront_message");return!1},t.smartFiltersEnabled=function(){if((0,r.isMDBackend)())return s.Conn.isSMB&&(0,i.getABPropConfigValue)("smart_filters_enabled")||!s.Conn.isSMB&&(0,i.getABPropConfigValue)("smart_filters_enabled_consumer");return!1},t.smbBizProfileLoggingEnabled=function(){if((0,r.isMDBackend)()&&s.Conn.isSMB)return(0,i.getABPropConfigValue)("smb_biz_profile_logging_enabled");return!1},t.smbClickToChatLoggingEnabled=function(){if((0,r.isMDBackend)()&&s.Conn.isSMB)return(0,i.getABPropConfigValue)("smb_click_to_chat_logging_enabled");return!1},t.smbStatusLoggingEnabled=function(){if((0,r.isMDBackend)()&&s.Conn.isSMB)return(0,i.getABPropConfigValue)("smb_status_logging_enabled");return!1},t.tos3GatingEnabled=function(){if((0,r.isMDBackend)()&&!s.Conn.isSMB)return(0,i.getABPropConfigValue)("tos_3_client_gating_enabled");return!1},t.tos3GatingEnabledB2C=function(){if((0,r.isMDBackend)()&&!s.Conn.isSMB)return(0,i.getABPropConfigValue)("tos_3_client_gating_biz_initiated_enabled");return!1},t.tosFetchEnabled=function(){if((0,r.isMDBackend)()&&!s.Conn.isSMB)return(0,i.getABPropConfigValue)("tos_client_state_fetch_enabled");return!1},t.tosFetchIteration=function(){if((0,r.isMDBackend)())return(0,i.getABPropConfigValue)("tos_client_state_fetch_iteration");return 0},t.web2FAEnabled=function(){return(0,r.isMDBackend)()&&(0,i.getABPropConfigValue)("web_2fa")},t.webGDPRRequestAccountInfoEnabled=function(){return(0,r.isMDBackend)()&&(0,i.getABPropConfigValue)("web_gdpr_request_account_info_enabled")},t.webMediaAutoDownloadEnabled=function(){return c.GK.supportsFeature(c.GK.F.MEDIA_AUTO_DOWNLOAD)&&p.ServerProps.webMediaAutoDownloadEnabled};var r=n(88555),i=n(57849),a=n(93170),o=n(33049),s=n(17239),l=n(92059),c=n(7293),d=n(58052),u=n(34771),p=n(64551);function f(e){return(0,l.getCountryShortcodeByPhone)(e||"")===o.COMPLIANCE_INFO_CODES.INDIA||c.GK.supportsFeature(c.GK.F.SKIP_COMPLIANCE_PHONE_CHECK)}function h(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:()=>!1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>!1;return!!f(e)&&((0,r.isMDBackend)()?t():n())}function _(){return!!(0,r.isMDBackend)()&&((0,i.getABPropConfigValue)("reactions_send")&&u.PrimaryFeatures.reactionsSend)}function g(){return!!(0,r.isMDBackend)()&&((0,i.getABPropConfigValue)("reactions_receive")||_())}function m(){return!1}function y(){return!(0,r.isLegacyWebdBackend)()&&(0,i.getABPropConfigValue)("poll_creation_enabled")}function E(){return c.GK.supportsAnyFeature(c.GK.F.RECENT_STICKERS_V_2,c.GK.F.RECENT_STICKERS_V_3)&&c.GK.supportsFeature(c.GK.F.MEDIA_UPLOAD)}},12670:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getConfig=function(){return l().config},t.getMyDeviceJid=function(){var e;const t=null===(e=l().myJids)||void 0===e?void 0:e.deviceJid;if(null==t)throw(0,a.default)("Trying to access myDeviceJid, but it's not set");return(0,o.unsafeCoerceToPhoneDeviceJid)(t)},t.setGlobals=function(e){s=e,(0,i.setGlobals)(e)};var i=n(66543),a=r(n(24935)),o=n(52230);let s=null;function l(){if(null==s)throw Error("globals api called before set");return s}},14702:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.L10n=void 0;var i=r(n(76521)),a=r(n(42317)),o=r(n(97331)),s=r(n(30381)),l=n(24460),c=n(33970),d=r(n(70210)),u=r(n(42435)),p=r(n(17588));const f=new Set(["",""]),h=new Set(["ar","ar-XB","fa","ur","he","dv","ku"]),_=new Set(["ar","ar-XB","fa"]),g="".split("");function m(e){return g[parseInt(e,10)]}const y=new Error("Unimplemented method");class E extends i.default{constructor(e,t,n){if(super(),!e||!t)throw y;this._locale=e,this.localeStrings={},this.localeStrings[c.DEFAULT_LOCALE]=t,this.fbtStrings={},this.fbtStrings[c.DEFAULT_LOCALE]={en_GB:{}},this.markTranslations=n,this.customizeMoment()}getLocale(){throw y}getFbtTranslations(){throw y}setLocale(){throw y}normalizeLocale(e){const t=e.replace(/-/g,"_").toLowerCase(),n=this._getTranslationFilename(t);if(n)return n;let r=t;for(;r;){r=r.split("_").slice(0,-1).join("_");const e=r&&this._getTranslationFilename(r);if(e)return e}}isLocaleSupported(e){return!!e&&!!this.normalizeLocale(e)}_getTranslationFilename(e){const t=d.default[e]||e;return p.default[t]}isRTL(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getLocale();return h.has(e)}LR(e,t){return this.isRTL()?t:e}embedDir(e){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.isRTL())?this.embedRTL(e):this.embedLTR(e)}forceDir(e){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.isRTL())?this.forceRTL(e):this.forceLTR(e)}embedLTR(e){return""+e+""}embedRTL(e){return""+e+""}isolateLTR(e){return""+e+""}isolateRTL(e){return""+e+""}forceLTR(e){return""+e}forceRTL(e){return""+e}t(e,t,n){"number"!=typeof e&&__LOG__(3)`l10n.t was called with an unprocessed id (${e}). If you just added a string on local, restarting your build may address the issue.`;const r=e,i=null!=t?t._plural:null;let a=n||this.getLocale();this.localeStrings[a]||(a=c.DEFAULT_LOCALE);let o=this._getString(r,a,i);this.markTranslations&&(o?a===c.DEFAULT_LOCALE&&(o="["+o+"]"):(o="!!"+r+"!!",__LOG__(2)`l10n:t string key "${r}" not found`)),o||(o=this._getString(r,c.DEFAULT_LOCALE,i)),o||__LOG__(2)`l10n:t string key "${r}" fallback failed`;for(const e in t){if(!t.hasOwnProperty(e)||"_plural"===e)continue;const n=new RegExp("__"+e+"__","g");let r;r="string"==typeof t[e]&&f.has(t[e].slice(0,1))?t[e]:this.n(t[e],a),o=o.replace(n,r)}return o}_getString(e,t,n){const r=this.localeStrings[t]||this.localeStrings[c.DEFAULT_LOCALE];if(null==r)throw new Error(`Couldn't find translations for locale ${t} or default (${c.DEFAULT_LOCALE})`);if(!Array.isArray(r))throw new Error("Unexpected locale format.");const[i,a]=r,o=i[e]||"";if(null==n)return o;const s=u.default[t];if(null==s)return o;const l=s.numbers[s.plurals(n)];if(1===l)return o;return a[2===s.numbers.length&&2===l?e.toString():`${e}_${l}`]||o}useArabicScriptDigits(e){return _.has(e||this.getLocale())}isLatinAlphabetLanguage(e){return o.default.isLatin(this.removeAccents(e))}n(e,t){let n=e;return isNaN(n)||(n=n.toString()),this.useArabicScriptDigits(t)?n.toString().replace(/[0-9]/g,m):n}filesize(e){const t=this;return this.n((0,a.default)(e,{base:2,round:0,suffixes:{B:t.t(461),kB:t.t(463),MB:t.t(464),GB:t.t(462)}}))}normalizeForm(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return(0,l.normalizeForm)(e)}removeAccents(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return(0,l.removeAccents)(e)}accentFold(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return this.removeAccents(e).toLowerCase()}customizeMoment(){s.default.relativeTimeRounding(Math.floor),s.default.relativeTimeThreshold("s",60),s.default.relativeTimeThreshold("m",60),s.default.relativeTimeThreshold("h",24)}}t.L10n=E},92059:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getCountryShortcodeByPhone=function(e){if(null==e||0===e.length)return"";const t=function(e,t){if(null!=e&&e.length>0&&null!=t){let n=t[e[0]],r=e;for(;r.length>0&&n;){if(n.c)return n.c;r=r.substr(1,r.length-1),n=n[r[0]]}}return""}(e,n);return""===t&&"1"===e[0]?"US":"RU"===t&&["6","7"].includes(e[1])?"KZ":t};const n={1:{2:{0:{4:{c:"CA"}},2:{6:{c:"CA"}},3:{6:{c:"CA"}},4:{2:{c:"BS"},9:{c:"CA"}},5:{0:{c:"CA"}},6:{4:{c:"AI"},8:{c:"AG"}},8:{4:{c:"VG"},9:{c:"CA"}}},3:{0:{6:{c:"CA"}},4:{0:{c:"VI"},3:{c:"CA"},5:{c:"KY"}},6:{5:{c:"CA"},7:{c:"CA"}}},4:{0:{3:{c:"CA"}},1:{6:{c:"CA"},8:{c:"CA"}},3:{1:{c:"CA"},7:{c:"CA"},8:{c:"CA"}},4:{1:{c:"BM"}},5:{0:{c:"CA"}},7:{3:{c:"GD"}}},5:{0:{6:{c:"CA"}},1:{4:{c:"CA"},9:{c:"CA"}},4:{8:{c:"CA"}},7:{9:{c:"CA"}},8:{1:{c:"CA"},7:{c:"CA"}}},6:{0:{4:{c:"CA"}},1:{3:{c:"CA"}},3:{9:{c:"CA"}},4:{7:{c:"CA"},9:{c:"TC"}},5:{8:{c:"JM"}},6:{4:{c:"MS"}},7:{0:{c:"MP"},1:{c:"GU"},2:{c:"CA"}},8:{4:{c:"AS"}}},7:{0:{5:{c:"CA"},9:{c:"CA"}},2:{1:{c:"MF"}},5:{8:{c:"LC"}},6:{7:{c:"DM"}},7:{8:{c:"CA"}},8:{0:{c:"CA"},2:{c:"CA"},4:{c:"VC"},7:{c:"PR"}}},8:{0:{7:{c:"CA"},9:{c:"DO"}},1:{9:{c:"CA"}},2:{5:{c:"CA"},9:{c:"DO"}},4:{9:{c:"DO"}},6:{7:{c:"CA"},8:{c:"TT"},9:{c:"KN"}},7:{3:{c:"CA"},6:{c:"JM"}}},9:{0:{2:{c:"CA"},5:{c:"CA"}},3:{9:{c:"PR"}}}},2:{0:{c:"EG"},1:{1:{c:"SS"},2:{c:"MA"},3:{c:"DZ"},6:{c:"TN"},8:{c:"LY"}},2:{0:{c:"GM"},1:{c:"SN"},2:{c:"MR"},3:{c:"ML"},4:{c:"GN"},5:{c:"CI"},6:{c:"BF"},7:{c:"NE"},8:{c:"TG"},9:{c:"BJ"}},3:{0:{c:"MU"},1:{c:"LR"},2:{c:"SL"},3:{c:"GH"},4:{c:"NG"},5:{c:"TD"},6:{c:"CF"},7:{c:"CM"},8:{c:"CV"},9:{c:"ST"}},4:{0:{c:"GQ"},1:{c:"GA"},2:{c:"CG"},3:{c:"CD"},4:{c:"AO"},5:{c:"GW"},6:{c:"IO"},7:{c:"AC"},8:{c:"SC"},9:{c:"SD"}},5:{0:{c:"RW"},1:{c:"ET"},2:{c:"SO"},3:{c:"DJ"},4:{c:"KE"},5:{c:"TZ"},6:{c:"UG"},7:{c:"BI"},8:{c:"MZ"}},6:{0:{c:"ZM"},1:{c:"MG"},2:{c:"RE"},3:{c:"ZW"},4:{c:"NA"},5:{c:"MW"},6:{c:"LS"},7:{c:"BW"},8:{c:"SZ"},9:{c:"KM"}},7:{c:"ZA"},9:{0:{c:"SH"},1:{c:"ER"},7:{c:"AW"},8:{c:"FO"},9:{c:"GL"}}},3:{0:{c:"GR"},1:{c:"NL"},2:{c:"BE"},3:{c:"FR"},4:{c:"ES"},5:{0:{c:"GI"},1:{c:"PT"},2:{c:"LU"},3:{c:"IE"},4:{c:"IS"},5:{c:"AL"},6:{c:"MT"},7:{c:"CY"},8:{c:"FI"},9:{c:"BG"}},6:{c:"HU"},7:{0:{c:"LT"},1:{c:"LV"},2:{c:"EE"},3:{c:"MD"},4:{c:"AM"},5:{c:"BY"},6:{c:"AD"},7:{c:"MC"},8:{c:"SM"}},8:{0:{c:"UA"},1:{c:"RS"},2:{c:"ME"},3:{c:"XK"},5:{c:"HR"},6:{c:"SI"},7:{c:"BA"},9:{c:"MK"}},9:{c:"IT"}},4:{0:{c:"RO"},1:{c:"CH"},2:{0:{c:"CZ"},1:{c:"SK"},3:{c:"LI"}},3:{c:"AT"},4:{c:"GB"},5:{c:"DK"},6:{c:"SE"},7:{c:"NO"},8:{c:"PL"},9:{c:"DE"}},5:{0:{0:{c:"FK"},1:{c:"BZ"},2:{c:"GT"},3:{c:"SV"},4:{c:"HN"},5:{c:"NI"},6:{c:"CR"},7:{c:"PA"},8:{c:"PM"},9:{c:"HT"}},1:{c:"PE"},2:{c:"MX"},3:{c:"CU"},4:{c:"AR"},5:{c:"BR"},6:{c:"CL"},7:{c:"CO"},8:{c:"VE"},9:{0:{c:"GP"},1:{c:"BO"},2:{c:"GY"},3:{c:"EC"},4:{c:"GF"},5:{c:"PY"},6:{c:"MQ"},7:{c:"SR"},8:{c:"UY"},9:{c:"CW"}}},6:{0:{c:"MY"},1:{c:"AU"},2:{c:"ID"},3:{c:"PH"},4:{c:"NZ"},5:{c:"SG"},6:{c:"TH"},7:{0:{c:"TL"},2:{c:"NF"},3:{c:"BN"},4:{c:"NR"},5:{c:"PG"},6:{c:"TO"},7:{c:"SB"},8:{c:"VU"},9:{c:"FJ"}},8:{0:{c:"PW"},1:{c:"WF"},2:{c:"CK"},3:{c:"NU"},5:{c:"WS"},6:{c:"KI"},7:{c:"NC"},8:{c:"TV"},9:{c:"PF"}},9:{0:{c:"TK"},1:{c:"FM"},2:{c:"MH"}}},7:{c:"RU"},8:{1:{c:"JP"},2:{c:"KR"},4:{c:"VN"},5:{0:{c:"KP"},2:{c:"HK"},3:{c:"MO"},5:{c:"KH"},6:{c:"LA"}},6:{c:"CN"},8:{0:{c:"BD"},6:{c:"TW"}}},9:{0:{c:"TR"},1:{c:"IN"},2:{c:"PK"},3:{c:"AF"},4:{c:"LK"},5:{c:"MM"},6:{0:{c:"MV"},1:{c:"LB"},2:{c:"JO"},3:{c:"SY"},4:{c:"IQ"},5:{c:"KW"},6:{c:"SA"},7:{c:"YE"},8:{c:"OM"}},7:{0:{c:"PS"},1:{c:"AE"},2:{c:"IL"},3:{c:"BH"},4:{c:"QA"},5:{c:"BT"},6:{c:"MN"},7:{c:"NP"}},8:{c:"IR"},9:{2:{c:"TJ"},3:{c:"TM"},4:{c:"AZ"},5:{c:"GE"},6:{c:"KG"},8:{c:"UZ"}}}}},24460:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getLanguageCodeFromLocale=function(e){return e.replace(/_/g,"-").split("-")[0].toLowerCase()},t.getRegionCodeFromLocale=function(e){const t=e.replace(/_/g,"-").split("-");if(t.length<=1)return null;return t[t.length-1].toUpperCase()},t.normalizeForm=a,t.removeAccents=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return(0,i.default)(a(e).replace(/(?:[\^`\xA8\xAF\xB4\xB7\xB8\u02B0-\u034E\u0350-\u0357\u035D-\u0362\u0374\u0375\u037A\u0384\u0385\u0483-\u0487\u0559\u0591-\u05A1\u05A3-\u05BD\u05BF\u05C1\u05C2\u05C4\u064B-\u0652\u0657\u0658\u06DF\u06E0\u06E5\u06E6\u06EA-\u06EC\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F5\u0818\u0819\u08E3-\u08FE\u093C\u094D\u0951-\u0954\u0971\u09BC\u09CD\u0A3C\u0A4D\u0ABC\u0ACD\u0AFD-\u0AFF\u0B3C\u0B4D\u0B55\u0BCD\u0C4D\u0CBC\u0CCD\u0D3B\u0D3C\u0D4D\u0DCA\u0E47-\u0E4C\u0E4E\u0EBA\u0EC8-\u0ECC\u0F18\u0F19\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F82-\u0F84\u0F86\u0F87\u0FC6\u1037\u1039\u103A\u1063\u1064\u1069-\u106D\u1087-\u108D\u108F\u109A\u109B\u135D-\u135F\u17C9-\u17D3\u17DD\u1939-\u193B\u1A75-\u1A7C\u1A7F\u1AB0-\u1ABD\u1B34\u1B44\u1B6B-\u1B73\u1BAA\u1BAB\u1C36\u1C37\u1C78-\u1C7D\u1CD0-\u1CE8\u1CED\u1CF4\u1CF7-\u1CF9\u1D2C-\u1D6A\u1DC4-\u1DCF\u1DF5-\u1DF9\u1DFD-\u1DFF\u1FBD\u1FBF-\u1FC1\u1FCD-\u1FCF\u1FDD-\u1FDF\u1FED-\u1FEF\u1FFD\u1FFE\u2CEF-\u2CF1\u2E2F\u302A-\u302F\u3099-\u309C\u30FC\uA66F\uA67C\uA67D\uA67F\uA69C\uA69D\uA6F0\uA6F1\uA700-\uA721\uA788-\uA78A\uA7F8\uA7F9\uA8C4\uA8E0-\uA8F1\uA92B-\uA92E\uA953\uA9B3\uA9C0\uA9E5\uAA7B-\uAA7D\uAABF-\uAAC2\uAAF6\uAB5B-\uAB5F\uAB69-\uAB6B\uABEC\uABED\uFB1E\uFE20-\uFE2F\uFF3E\uFF40\uFF70\uFF9E\uFF9F\uFFE3]|\uD800\uDEE0|\uD802[\uDEE5\uDEE6]|\uD803[\uDD22-\uDD27\uDF46-\uDF50]|\uD804[\uDCB9\uDCBA\uDD33\uDD34\uDD73\uDDC0\uDDCA-\uDDCC\uDE35\uDE36\uDEE9\uDEEA\uDF3C\uDF4D\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC42\uDC46\uDCC2\uDCC3\uDDBF\uDDC0\uDE3F\uDEB6\uDEB7\uDF2B]|\uD806[\uDC39\uDC3A\uDD3D\uDD3E\uDD43\uDDE0\uDE34\uDE47\uDE99]|\uD807[\uDC3F\uDD42\uDD44\uDD45\uDD97]|\uD81A[\uDEF0-\uDEF4\uDF30-\uDF36]|\uD81B[\uDF8F-\uDF9F\uDFF0\uDFF1]|\uD834[\uDD67-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD]|\uD838[\uDD30-\uDD36\uDEEC-\uDEEF]|\uD83A[\uDCD0-\uDCD6\uDD44-\uDD46\uDD48-\uDD4A])/g,""))};var i=r(n(97331));function a(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e.normalize("NFKD")}},14296:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(48926)),a=(r(n(35161)),r(n(29690)),n(13959)),o=n(4352),s=n(26741),l=n(48360),c=r(n(30381)),d=n(14702),u=n(41796),p=n(24460),f=n(33970),h=r(n(68609)),_=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=m(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(47272)),g=n(34355);function m(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(m=function(e){return e?n:t})(e)}const y=self.location.href;y&&y.includes("/%F0%9F%8C%90/")&&Promise.resolve().then(n.bind(n,76139)).then((e=>{let{default:t}=e;t.canMuckHistory()&&window.history.replaceState({},"","/")}));const E="en-GB",S={LTR:"LTR",RTL:"RTL"},v={LTR:"style",RTL:"style_rtl"},T=f.L10N_PRIORITY;class b extends d.L10n{constructor(){super({l:f.DEFAULT_LOCALE,priority:T.DEFAULT,loc:f.DEFAULT_LOCALE},n(43756).default,f.MARK_TRANSLATIONS);{const e=function(){if((0,u.isConnectedToPage)())return document.querySelector("html").getAttribute("loc")}(),t={};this._considerLocale(t,e,T.PREVIOUS)&&this.downloadAndSetTranslation(t)}}getLocale(){return this._locale.l}getFbtTranslations(){return this.fbtStrings[this._locale.l]}getFullLocale(){return this._locale.loc.replace("_","-")}_getFBTLocale(){return(0,g.normalizeLocaleToFBTLocale)(this.getLocale())}getLanguage(){return(0,p.getLanguageCodeFromLocale)(this.getFullLocale())}getRegion(){return(0,p.getRegionCodeFromLocale)(this.getFullLocale())}normalizeForm(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(!s.UA.isTrident)return e.normalize("NFKD");try{return e.normalize("NFKD")}catch(t){return e}}setLocale(e,t){var n=this;return(0,i.default)((function*(){const r={l:n._locale.l,priority:n._locale.priority,loc:n._locale.l};return n._considerLocale(r,e,t)?n.downloadAndSetTranslation(r):Promise.resolve()}))()}isLocaleSupported(e){try{return super.isLocaleSupported(e)&&(!self.Intl||Array.isArray(self.Intl.Collator.supportedLocalesOf(e)))}catch(e){return!1}}init(e){var t;this._initFbt();const n={l:f.DEFAULT_LOCALE,priority:T.DEFAULT,loc:f.DEFAULT_LOCALE};if(this._considerLocale(n,e,T.PREVIOUS),this._considerLocale(n,function(){let e=(y||self.location.href||"").split("/%F0%9F%8C%90/");return e.length>1?e[1].split("/")[0]:void 0}(),T.URL),this._considerLocale(n,navigator.language,T.BROWSER),null===(t=navigator.languages)||void 0===t?void 0:t.length)for(let e=0;e<navigator.languages.length&&!this._considerLocale(n,navigator.languages[e],T.BROWSER);e++);return this.downloadAndSetTranslation(n)}_initFbt(){const e=f.MARK_TRANSLATIONS?e=>this.getLocale()===f.DEFAULT_LOCALE?new l.FbtResult(["{",...e.contents,"}"]):new l.FbtResult(e.contents):void 0;(0,l.init)({translations:this.getFbtTranslations(),hooks:{getViewerContext:()=>({locale:this._getFBTLocale()}),getFbtResult:e}})}_considerLocale(e,t,n){if(null!=e.priority&&n<e.priority)return;if(null==t||t===this.getLocale())return;const r=this.normalizeLocale(t);return r?(e.l=r,e.priority=n,e.loc=t,e):void 0}downloadAppLocale(e){return this.localeStrings[e]?Promise.resolve(this.localeStrings[e]):(0,o.promiseLoop)(function(){var t=(0,i.default)((function*(t,r,i){const o=(0,a.delayMs)(_.expBackoff(i,12e4,1e3,.1)),s=yield n(26299)(`./${e}`);try{const[e]=yield s.default();return t(e)}catch(t){return 10===i&&(__LOG__(4,void 0,new Error,!0)`${i} times, locale is ${e}`,SEND_LOGS("downadAppLocale failure")),o}}));return function(){return t.apply(this,arguments)}}())}downloadFbtLocaleAndSetCache(e){var t=this;return this.fbtStrings[e]?Promise.resolve(this.fbtStrings[e]):(0,o.promiseLoop)(function(){var r=(0,i.default)((function*(r,i,o){const s=(0,a.delayMs)(_.expBackoff(o,12e4,1e3,.1)),l=yield n(26299)(`./${e}`);try{const[,n]=yield l.default();return t.fbtStrings[e]=n,r(n)}catch(t){return 10===o&&(__LOG__(4,void 0,new Error,!0)`${o} times, locale is ${e}`,SEND_LOGS("downadAppLocale failure")),s}}));return function(){return r.apply(this,arguments)}}())}_downloadMomentResourceFile(e){return(0,i.default)((function*(){try{return(yield n(19922)(`./${e}`)).default}catch(t){__LOG__(2)`l10n:_downloadMomentResourceFile failed to download resource ${e}`}}))()}downloadMomentLocale(e){var t=this;const{l:n,loc:r}=e;return c.default.locale()===r?Promise.resolve():(0,o.promiseLoop)(function(){var e=(0,i.default)((function*(e,i,o){const s=(0,a.delayMs)(_.expBackoff(o,12e4,1e3,.1)),l=r.replace(/_/g,"-");let c,d;if(l===f.DEFAULT_MOMENT_LOCALE)c=()=>Promise.resolve(),d=f.DEFAULT_MOMENT_LOCALE;else{const e=[];if(e.push(l),n===f.DEFAULT_LOCALE)e.push(E);else{const t=n.replace(/_/g,"-");e.push(t),null!=h.default[t]&&e.push(h.default[t])}e.push(E);for(let n=0;n<e.length;++n)if(c=yield t._downloadMomentResourceFile(e[n]),null!=c){d=e[n];break}null==c&&(__LOG__(3)`Could not fetch moment locales, using default en-US`,c=()=>Promise.resolve(),d=f.DEFAULT_MOMENT_LOCALE)}try{return yield c(),e(d)}catch(e){return 10===o&&(__LOG__(4,void 0,new Error,!0)`${o} times, locale is (${n}, ${r})`,SEND_LOGS("downloadMomentLocale failure")),s}}));return function(){return e.apply(this,arguments)}}())}updateFbtContext(e){null!=e&&l.FbtTranslations.registerTranslations(e)}downloadAndSetTranslation(e){const{l:t,loc:r}=this._locale,{l:i,loc:a}=e,o=this.isRTL(i),s=o?S.RTL:S.LTR;if((0,u.isConnectedToPage)()&&document.getElementById(v[s])&&a===r)return Promise.resolve();const l=self.performance.now();let d,p;return this._fetchPromise=Promise.all([this.downloadAppLocale(i),this.downloadFbtLocaleAndSetCache(i),this.downloadMomentLocale(e)]).then((t=>{let[n,r,o]=t;d=self.performance.now(),this.localeStrings[i]=n,this._locale=e,this.trigger("set_collator",i),o&&(c.default.locale(o),__LOG__(2)`l10n:moment locale updated to: ${o}`),this.customizeMomentLocale(c.default.locale()),(0,u.isConnectedToPage)()&&(document.documentElement&&document.documentElement.setAttribute("lang",e.l),document.documentElement&&document.documentElement.setAttribute("dir",s)),this.updateFbtContext(r),this.trigger("locale_change",{l:i,loc:a})})).then((()=>{p=self.performance.now(),__LOG__(2)`l10n:locale updated: (${t}, ${r}) > (${i}, ${a}), Fetch: ${d-l}ms, Apply: ${p-d}ms`;if(n(92658).default.supported){var e;const t=n(25613).default,r=n(64237).default;(null===(e=navigator.serviceWorker)||void 0===e?void 0:e.controller)&&t.request(navigator.serviceWorker.controller,r.SET_L10N,{isRTL:o,locale:i}).catch((()=>{}))}})).catch((()=>(__LOG__(2)`l10n:locale update error: (${t}, ${r}) > (${i}, ${a})`,this.downloadAndSetTranslation({l:f.DEFAULT_LOCALE,priority:T.DEFAULT,loc:f.DEFAULT_LOCALE}))))}_updateSpellChecker(){}_updateElectronMain(){}customizeMomentLocale(e){const t=f.LOCALE_CUSTOMIZATIONS[e];t&&c.default.locale(e,t)}}b.Dir=S;var C=new b;t.default=C},33970:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.SHOULD_USE_MOMENT_LOCALE_FORMAT=t.MARK_TRANSLATIONS=t.LOCALE_DATE_TIME_CUSTOMIZATIONS=t.LOCALE_CUSTOMIZATIONS=t.LOCALES_THAT_PREFER_24HOUR_TIME=t.L10N_PRIORITY=t.DEFAULT_MOMENT_LOCALE=t.DEFAULT_LOCALE=void 0;var i=r(n(81109));t.L10N_PRIORITY={SAVED:6,PHONE:5,PREVIOUS:4,URL:3,BROWSER:2,DEFAULT:1};t.DEFAULT_LOCALE="en";t.DEFAULT_MOMENT_LOCALE="en-US";const a=new Set(["ur"]);t.SHOULD_USE_MOMENT_LOCALE_FORMAT=a;const o=new Set(["af","az","ca","cs","da","de","el","et","fi","fr","he","hr","hu","id","it","kk","lt","mk","nb","pl","pt","pt-BR","ro","ru","sk","sl","sr","sv","tr","uk"]);t.LOCALES_THAT_PREFER_24HOUR_TIME=o;const s={"zh-tw":{longDateFormat:{LT:"Ah:mm",LTS:"Ah:m:s",L:"YYYYMMMD",LL:"YYYYMMMD",LLL:"YYYYMMMDLT",LLLL:"YYYYMMMDddddLT",l:"YYYYMMMD",ll:"YYYYMMMD",lll:"YYYYMMMDLT",llll:"YYYYMMMDddddLT"}},"zh-cn":{longDateFormat:{LT:"Ah:mm",LTS:"Ah:m:s",L:"YYYY-MM-DD",LL:"YYYYMMMD",LLL:"YYYYMMMDLT",LLLL:"YYYYMMMDddddLT",l:"YYYYMMMD",ll:"YYYYMMMD",lll:"YYYYMMMDLT",llll:"YYYYMMMDddddLT"}},ar:{longDateFormat:{LT:"h:mm A",LTS:"HH:mm:ss",L:"YYYY/MM/DD",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"}},ta:{longDateFormat:{LT:"h:mm A",LTS:"h:mm:ss A",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY h:mm A",LLLL:"dddd, D MMMM YYYY, h:mm A"},preparse:null,postformat:null,meridiem:null,meridiemHour:null},nl:{longDateFormat:{l:"DD-MM-YYYY",L:"DD-MM-YYYY"}},"en-ie":{longDateFormat:{l:"DD/MM/YYYY",L:"DD/MM/YYYY"}},hi:{preparse:null,postformat:null,longDateFormat:{LT:"A h:mm ",LTS:"A h:mm:ss ",LLL:"D MMMM YYYY A h:mm ",LLLL:"dddd, D MMMM YYYY, A h:mm "},meridiem:(e,t)=>0===e&&0===t?"":e>=20||e<4?"":e>=4&&e<12?"":e>=12&&e<16?"":""}};t.LOCALE_DATE_TIME_CUSTOMIZATIONS=s;const l=(0,i.default)((0,i.default)({},s),{"pt-pt":{weekdays:["Domingo","Segunda-feira","Tera-feira","Quarta-feira","Quinta-feira","Sexta-feira","Sbado"]}});t.LOCALE_CUSTOMIZATIONS=l;t.MARK_TRANSLATIONS=!1},34355:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.normalizeLocaleToFBTLocale=function(e){const t=n[e];if(null!=t)return t;return e};const n={af:"af_ZA",ar:"ar_AR",az:"az_AZ",bg:"bg_BG",bn:"bn_IN",ca:"ca_ES",cs:"cs_CZ",da:"da_DK",de:"de_DE",el:"el_GR",en:"en_GB",es:"es_MX",et:"et_EE",fa:"fa_IR",fi:"fi_FI",fil:"tl_PH",fr:"fr_FR",gu:"gu_IN",he:"he_IL",hi:"hi_IN",hr:"hr_HR",hu:"hu_HU",id:"id_ID",it:"it_IT",ja:"ja_JP",kk:"kk_KZ",kn:"kn_IN",ko:"ko_KR",lt:"lt_LT",lv:"lv_LV",mk:"mk_MK",ml:"ml_IN",mr:"mr_IN",ms:"ms_MY",nb:"nb_NO",nl:"nl_NL",pa:"pa_IN",pl:"pl_PL",pt:"pt_PT","pt-BR":"pt_BR",ro:"ro_RO",ru:"ru_RU",sk:"sk_SK",sl:"sl_SI",sq:"sq_AL",sr:"sr_RS",sv:"sv_SE",sw:"sw_KE",ta:"ta_IN",te:"te_IN",th:"th_TH",tr:"tr_TR",uk:"uk_UA",ur:"ur_PK",uz:"uz_UZ",vi:"vi_VN","zh-CN":"zh_CN","zh-HK":"zh_HK","zh-TW":"zh_TW"}},42435:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={ach:{name:"Acholi",numbers:[1,2],plurals:e=>Number(e>1)},af:{name:"Afrikaans",numbers:[1,2],plurals:e=>Number(1!=e)},ak:{name:"Akan",numbers:[1,2],plurals:e=>Number(e>1)},am:{name:"Amharic",numbers:[1,2],plurals:e=>Number(e>1)},an:{name:"Aragonese",numbers:[1,2],plurals:e=>Number(1!=e)},ar:{name:"Arabic",numbers:[0,1,2,3,11,100],plurals:e=>Number(0===e?0:1==e?1:2==e?2:e%100>=3&&e%100<=10?3:e%100>=11?4:5)},arn:{name:"Mapudungun",numbers:[1,2],plurals:e=>Number(e>1)},ast:{name:"Asturian",numbers:[1,2],plurals:e=>Number(1!=e)},ay:{name:"Aymar",numbers:[1],plurals:()=>0},az:{name:"Azerbaijani",numbers:[1,2],plurals:e=>Number(1!=e)},be:{name:"Belarusian",numbers:[1,2,5],plurals:e=>Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)},bg:{name:"Bulgarian",numbers:[1,2],plurals:e=>Number(1!=e)},bn:{name:"Bengali",numbers:[1,2],plurals:e=>Number(1!=e)},bo:{name:"Tibetan",numbers:[1],plurals:()=>0},br:{name:"Breton",numbers:[1,2],plurals:e=>Number(e>1)},bs:{name:"Bosnian",numbers:[1,2,5],plurals:e=>Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)},ca:{name:"Catalan",numbers:[1,2],plurals:e=>Number(1!=e)},cgg:{name:"Chiga",numbers:[1],plurals:()=>0},cs:{name:"Czech",numbers:[1,2,5],plurals:e=>Number(1==e?0:e>=2&&e<=4?1:2)},csb:{name:"Kashubian",numbers:[1,2,5],plurals:e=>Number(1==e?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)},cy:{name:"Welsh",numbers:[1,2,3,8],plurals:e=>Number(1==e?0:2==e?1:8!=e&&11!=e?2:3)},da:{name:"Danish",numbers:[1,2],plurals:e=>Number(1!=e)},de:{name:"German",numbers:[1,2],plurals:e=>Number(1!=e)},dz:{name:"Dzongkha",numbers:[1],plurals:()=>0},el:{name:"Greek",numbers:[1,2],plurals:e=>Number(1!=e)},en:{name:"English",numbers:[1,2],plurals:e=>Number(1!=e)},eo:{name:"Esperanto",numbers:[1,2],plurals:e=>Number(1!=e)},es:{name:"Spanish",numbers:[1,2],plurals:e=>Number(1!=e)},es_ar:{name:"Argentinean Spanish",numbers:[1,2],plurals:e=>Number(1!=e)},et:{name:"Estonian",numbers:[1,2],plurals:e=>Number(1!=e)},eu:{name:"Basque",numbers:[1,2],plurals:e=>Number(1!=e)},fa:{name:"Persian",numbers:[1],plurals:()=>0},fi:{name:"Finnish",numbers:[1,2],plurals:e=>Number(1!=e)},fil:{name:"Filipino",numbers:[1,2],plurals:e=>Number(e>1)},fo:{name:"Faroese",numbers:[1,2],plurals:e=>Number(1!=e)},fr:{name:"French",numbers:[1,2],plurals:e=>Number(e>1)},fur:{name:"Friulian",numbers:[1,2],plurals:e=>Number(1!=e)},fy:{name:"Frisian",numbers:[1,2],plurals:e=>Number(1!=e)},ga:{name:"Irish",numbers:[1,2,3,7,11],plurals:e=>Number(1==e?0:2==e?1:e<7?2:e<11?3:4)},gd:{name:"Scottish Gaelic",numbers:[1,2,3,20],plurals:e=>Number(1==e||11==e?0:2==e||12==e?1:e>2&&e<20?2:3)},gl:{name:"Galician",numbers:[1,2],plurals:e=>Number(1!=e)},gu:{name:"Gujarati",numbers:[1,2],plurals:e=>Number(1!=e)},gun:{name:"Gun",numbers:[1,2],plurals:e=>Number(e>1)},ha:{name:"Hausa",numbers:[1,2],plurals:e=>Number(1!=e)},he:{name:"Hebrew",numbers:[1,2],plurals:e=>Number(1!=e)},hi:{name:"Hindi",numbers:[1,2],plurals:e=>Number(1!=e)},hr:{name:"Croatian",numbers:[1,2,5],plurals:e=>Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)},hu:{name:"Hungarian",numbers:[1,2],plurals:e=>Number(1!=e)},hy:{name:"Armenian",numbers:[1,2],plurals:e=>Number(1!=e)},ia:{name:"Interlingua",numbers:[1,2],plurals:e=>Number(1!=e)},id:{name:"Indonesian",numbers:[1],plurals:()=>0},is:{name:"Icelandic",numbers:[1,2],plurals:e=>Number(e%10!=1||e%100==11)},it:{name:"Italian",numbers:[1,2],plurals:e=>Number(1!=e)},ja:{name:"Japanese",numbers:[1],plurals:()=>0},jbo:{name:"Lojban",numbers:[1],plurals:()=>0},jv:{name:"Javanese",numbers:[0,1],plurals:e=>Number(0!==e)},ka:{name:"Georgian",numbers:[1],plurals:()=>0},kk:{name:"Kazakh",numbers:[1],plurals:()=>0},km:{name:"Khmer",numbers:[1],plurals:()=>0},kn:{name:"Kannada",numbers:[1,2],plurals:e=>Number(1!=e)},ko:{name:"Korean",numbers:[1],plurals:()=>0},ku:{name:"Kurdish",numbers:[1,2],plurals:e=>Number(1!=e)},kw:{name:"Cornish",numbers:[1,2,3,4],plurals:e=>Number(1==e?0:2==e?1:3==e?2:3)},ky:{name:"Kyrgyz",numbers:[1],plurals:()=>0},lb:{name:"Letzeburgesch",numbers:[1,2],plurals:e=>Number(1!=e)},ln:{name:"Lingala",numbers:[1,2],plurals:e=>Number(e>1)},lo:{name:"Lao",numbers:[1],plurals:()=>0},lt:{name:"Lithuanian",numbers:[1,2,10],plurals:e=>Number(e%10==1&&e%100!=11?0:e%10>=2&&(e%100<10||e%100>=20)?1:2)},lv:{name:"Latvian",numbers:[0,1,2],plurals:e=>Number(e%10==1&&e%100!=11?0:0!==e?1:2)},mai:{name:"Maithili",numbers:[1,2],plurals:e=>Number(1!=e)},mfe:{name:"Mauritian Creole",numbers:[1,2],plurals:e=>Number(e>1)},mg:{name:"Malagasy",numbers:[1,2],plurals:e=>Number(e>1)},mi:{name:"Maori",numbers:[1,2],plurals:e=>Number(e>1)},mk:{name:"Macedonian",numbers:[1,2],plurals:e=>Number(1==e||e%10==1?0:1)},ml:{name:"Malayalam",numbers:[1,2],plurals:e=>Number(1!=e)},mn:{name:"Mongolian",numbers:[1,2],plurals:e=>Number(1!=e)},mnk:{name:"Mandinka",numbers:[0,1,2],plurals:e=>Number(0===e?0:1==e?1:2)},mr:{name:"Marathi",numbers:[1,2],plurals:e=>Number(1!=e)},ms:{name:"Malay",numbers:[1],plurals:()=>0},mt:{name:"Maltese",numbers:[1,2,11,20],plurals:e=>Number(1==e?0:0===e||e%100>1&&e%100<11?1:e%100>10&&e%100<20?2:3)},nah:{name:"Nahuatl",numbers:[1,2],plurals:e=>Number(1!=e)},nap:{name:"Neapolitan",numbers:[1,2],plurals:e=>Number(1!=e)},nb:{name:"Norwegian Bokmal",numbers:[1,2],plurals:e=>Number(1!=e)},ne:{name:"Nepali",numbers:[1,2],plurals:e=>Number(1!=e)},nl:{name:"Dutch",numbers:[1,2],plurals:e=>Number(1!=e)},nn:{name:"Norwegian Nynorsk",numbers:[1,2],plurals:e=>Number(1!=e)},no:{name:"Norwegian",numbers:[1,2],plurals:e=>Number(1!=e)},nso:{name:"Northern Sotho",numbers:[1,2],plurals:e=>Number(1!=e)},oc:{name:"Occitan",numbers:[1,2],plurals:e=>Number(e>1)},or:{name:"Oriya",numbers:[2,1],plurals:e=>Number(1!=e)},pa:{name:"Punjabi",numbers:[1,2],plurals:e=>Number(1!=e)},pap:{name:"Papiamento",numbers:[1,2],plurals:e=>Number(1!=e)},pl:{name:"Polish",numbers:[1,2,5],plurals:e=>Number(1==e?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)},pms:{name:"Piemontese",numbers:[1,2],plurals:e=>Number(1!=e)},ps:{name:"Pashto",numbers:[1,2],plurals:e=>Number(1!=e)},pt:{name:"Portuguese",numbers:[1,2],plurals:e=>Number(1!=e)},"pt-BR":{name:"Brazilian Portuguese",numbers:[1,2],plurals:e=>Number(1!=e)},rm:{name:"Romansh",numbers:[1,2],plurals:e=>Number(1!=e)},ro:{name:"Romanian",numbers:[1,2,20],plurals:e=>Number(1==e?0:0===e||e%100>0&&e%100<20?1:2)},ru:{name:"Russian",numbers:[1,2,5],plurals:e=>Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)},sah:{name:"Yakut",numbers:[1],plurals:()=>0},sco:{name:"Scots",numbers:[1,2],plurals:e=>Number(1!=e)},se:{name:"Northern Sami",numbers:[1,2],plurals:e=>Number(1!=e)},si:{name:"Sinhala",numbers:[1,2],plurals:e=>Number(1!=e)},sk:{name:"Slovak",numbers:[1,2,5],plurals:e=>Number(1==e?0:e>=2&&e<=4?1:2)},sl:{name:"Slovenian",numbers:[5,1,2,3],plurals:e=>Number(e%100==1?1:e%100==2?2:e%100==3||e%100==4?3:0)},so:{name:"Somali",numbers:[1,2],plurals:e=>Number(1!=e)},son:{name:"Songhay",numbers:[1,2],plurals:e=>Number(1!=e)},sq:{name:"Albanian",numbers:[1,2],plurals:e=>Number(1!=e)},sr:{name:"Serbian",numbers:[1,2,5],plurals:e=>Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)},su:{name:"Sundanese",numbers:[1],plurals:()=>0},sv:{name:"Swedish",numbers:[1,2],plurals:e=>Number(1!=e)},sw:{name:"Swahili",numbers:[1,2],plurals:e=>Number(1!=e)},ta:{name:"Tamil",numbers:[1,2],plurals:e=>Number(1!=e)},te:{name:"Telugu",numbers:[1,2],plurals:e=>Number(1!=e)},tg:{name:"Tajik",numbers:[1,2],plurals:e=>Number(e>1)},th:{name:"Thai",numbers:[1],plurals:()=>0},ti:{name:"Tigrinya",numbers:[1,2],plurals:e=>Number(e>1)},tk:{name:"Turkmen",numbers:[1,2],plurals:e=>Number(1!=e)},tr:{name:"Turkish",numbers:[1,2],plurals:e=>Number(e>1)},tt:{name:"Tatar",numbers:[1],plurals:()=>0},ug:{name:"Uyghur",numbers:[1],plurals:()=>0},uk:{name:"Ukrainian",numbers:[1,2,5],plurals:e=>Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)},ur:{name:"Urdu",numbers:[1,2],plurals:e=>Number(1!=e)},uz:{name:"Uzbek",numbers:[1,2],plurals:e=>Number(e>1)},vi:{name:"Vietnamese",numbers:[1],plurals:()=>0},wa:{name:"Walloon",numbers:[1,2],plurals:e=>Number(e>1)},wo:{name:"Wolof",numbers:[1],plurals:()=>0},yo:{name:"Yoruba",numbers:[1,2],plurals:e=>Number(1!=e)},zh:{name:"Chinese",numbers:[1],plurals:()=>0}};t.default=n},9978:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.SyntheticCountryCode=void 0,t.bubbleCountryOnListOfCountries=p,t.formatCountriesOfOrigin=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const n=u(e,!0);if(""===t)return n;return p(n,t)},t.getCountries=function(){return f.apply(this,arguments)},t.getCountryName=function(){return c.apply(this,arguments)},t.unshiftNotApplicableToListOfCountries=u;var i=r(n(48926)),a=n(48360),o=(r(n(56720)),r(n(14296))),s=n(33970);const l={countrySeparator:{borderBottom:"bajl15op"}};function c(){return(c=(0,i.default)((function*(e){if(!e)return;return(yield h(o.default.getLocale()))[e.toUpperCase()]}))).apply(this,arguments)}const d=n(76672)({NotApplicable:"NOT_APPLICABLE"});function u(e,t){const n=[...e];return n.unshift([String(d.NotApplicable),a.fbt._("Not Applicable",null,{hk:"2k1klN"}),a.fbt._("Item is a service or non-physical good",null,{hk:"3uDBY7"}),...!0===t?[l.countrySeparator]:[]]),n}function p(e,t,n){const r=e.findIndex((e=>{let[n]=e;return n===t})),[i,a]=[...e[r]],o=[...e];return o.splice(r,1),o.unshift([i,a,null,...n?[l.countrySeparator]:[]]),o}function f(){return(f=(0,i.default)((function*(){const e=yield h(o.default.getLocale());return Object.keys(e).filter((e=>!e.includes("@"))).map((t=>[t,e[t]])).sort(((e,t)=>{let[,n]=e,[,r]=t;return String(n).localeCompare(String(r))}))}))).apply(this,arguments)}function h(){return _.apply(this,arguments)}function _(){return(_=(0,i.default)((function*(e){const t=(yield n.e(5211).then(n.t.bind(n,1820,19))).default.includes(e)?e:s.DEFAULT_LOCALE;return(yield n(29127)(`./${t}.json`)).default}))).apply(this,arguments)}t.SyntheticCountryCode=d},68609:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={"zh-HK":"zh-TW",pa:"pa-IN"};t.default=n},70210:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={pt:"pt_br",pt_ao:"pt",pt_ch:"pt",pt_cv:"pt",pt_fr:"pt",pt_gq:"pt",pt_gw:"pt",pt_lu:"pt",pt_mo:"pt",pt_mz:"pt",pt_pt:"pt",pt_st:"pt",pt_tl:"pt",zh_hans:"zh_cn",zh_hant:"zh_tw",zh_sg:"zh_cn",tl:"fil",in:"id",iw:"he",mo:"ro",jw:"jv",ji:"yi"};t.default=n},17588:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={af:"af",ar:"ar",ar_xb:"ar-XB",az:"az",bg:"bg",bn:"bn",ca:"ca",cs:"cs",da:"da",de:"de",el:"el",en:"en",es:"es",et:"et",fa:"fa",fi:"fi",fil:"fil",fr:"fr",gu:"gu",he:"he",hi:"hi",hr:"hr",hu:"hu",id:"id",it:"it",ja:"ja",kk:"kk",kn:"kn",ko:"ko",lt:"lt",lv:"lv",mk:"mk",ml:"ml",mr:"mr",ms:"ms",nb:"nb",nl:"nl",pa:"pa",pl:"pl",pt:"pt",pt_br:"pt-BR",ro:"ro",ru:"ru",sk:"sk",sl:"sl",sq:"sq",sr:"sr",sv:"sv",sw:"sw",ta:"ta",te:"te",th:"th",tr:"tr",uk:"uk",ur:"ur",uz:"uz",vi:"vi",zh_cn:"zh-CN",zh_hk:"zh-HK",zh_tw:"zh-TW"};t.default=n},71473:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.MAX_AUTO_DOWNLOAD_SIZE=t.AutoDownloadQueue=t.AUTO_DOWNLOAD_TYPES=t.AUDIO_AUTO_DOWNLOAD_SIZE_LIMIT=void 0,t.shouldAutoDownloadMedia=m,t.shouldTrustMedia=g,t.validateMediaSize=y;var i=r(n(48926)),a=r(n(30844)),o=n(15461),s=r(n(61516)),l=n(99234),c=n(78986),d=r(n(11339)),u=n(54676);const p=n(76672)({MEDIA:"media",MMS_THUMBNAIL:"mms_thumbnail"});t.AUTO_DOWNLOAD_TYPES=p;const f=33554432;t.MAX_AUTO_DOWNLOAD_SIZE=f;const h=524288;t.AUDIO_AUTO_DOWNLOAD_SIZE_LIMIT=h;const _=512e3;function g(e){return e.isTrusted()}function m(e){switch(e.type){case o.MSG_TYPE.AUDIO:case o.MSG_TYPE.PTT:return(0,l.getAutoDownloadAudio)();case o.MSG_TYPE.STICKER:case o.MSG_TYPE.IMAGE:return(0,l.getAutoDownloadPhotos)();case o.MSG_TYPE.VIDEO:return e.isGif&&e.size<_?(0,l.getAutoDownloadPhotos)():(0,l.getAutoDownloadVideos)();case o.MSG_TYPE.DOCUMENT:return(0,l.getAutoDownloadDocuments)()}return!1}function y(e){switch(e.type){case o.MSG_TYPE.IMAGE:case o.MSG_TYPE.VIDEO:case o.MSG_TYPE.DOCUMENT:return e.size<=f;case o.MSG_TYPE.AUDIO:case o.MSG_TYPE.PTT:return e.size<h;case o.MSG_TYPE.STICKER:return!0}return!1}const E=new class{constructor(){this._downloaderQueue=new a.default(5,{photos:2,videos:1,audio:1,documents:1,mms_thumbnail:4})}getEnqueuedTasksCount(){return this._downloaderQueue.getEnqueuedTasksCount()}clearQueue(){this._downloaderQueue.clearQueue()}enqueue(e,t){if(this.getEnqueuedTasksCount()>=32)return!1;if(t===p.MEDIA&&g(e)&&e.isNewMsg&&m(e)&&y(e))switch(e.type){case o.MSG_TYPE.AUDIO:case o.MSG_TYPE.PTT:return this._enqueueMedia({message:e,group:"audio"}),!0;case o.MSG_TYPE.IMAGE:case o.MSG_TYPE.STICKER:return this._enqueueMedia({message:e,group:"photos"}),!0;case o.MSG_TYPE.VIDEO:return e.isGif&&e.size<_?(this._enqueueMedia({message:e,group:"photos"}),!0):(this._enqueueMedia({message:e,group:"videos"}),!0);case o.MSG_TYPE.DOCUMENT:return this._enqueueMedia({message:e,group:"documents"}),!0}if(t===p.MMS_THUMBNAIL){if(e.type===o.MSG_TYPE.DOCUMENT||(0,u.typeIsUrl)(e))return this._enqueueMmsThumbnail({message:e,group:"mms_thumbnail"}),!0;if(e.type===o.MSG_TYPE.IMAGE||e.type===o.MSG_TYPE.VIDEO)return this._enqueueStatusV3Thumbnail({message:e,group:"mms_thumbnail"}),!0}return!1}_enqueueMedia(e){var t=this;let{message:n,group:r}=e;return(0,i.default)((function*(){yield t._downloaderQueue.enqueue((0,i.default)((function*(){m(n)&&(yield n.downloadMedia({downloadEvenIfExpensive:!1,rmrReason:d.default.WEBC_RMR_REASON_CODE.OTHER,isUserInitiated:!1,isAutoDownload:!0}))})),{group:r,priority:-n.t})}))()}_enqueueMmsThumbnail(e){var t=this;let{message:n,group:r}=e;return(0,i.default)((function*(){yield t._downloaderQueue.enqueue((0,i.default)((function*(){yield(0,s.default)({msg:n})})),{group:r,priority:-n.t})}))()}_enqueueStatusV3Thumbnail(e){var t=this;let{message:n,group:r}=e;return(0,i.default)((function*(){yield t._downloaderQueue.enqueue((0,i.default)((function*(){yield(0,c.downloadStatusV3Thumbnail)({msg:n})})),{group:r,priority:-n.t})}))()}};t.AutoDownloadQueue=E},99140:(e,t)=>{"use strict";function n(e){if(!e)return e;const t=e.replace(/[\u202a-\u202e\u2066-\u2069\u200E\u200F\u061C]/g,""),n=t.split(".");if(1===n.length)return t;for(let e=n.length-1;e>0;e--){const t=n[e].trim();if(t.length)return n.slice(0,e).join(".")+"."+t}return t}Object.defineProperty(t,"__esModule",{value:!0}),t.cleanFilename=n,t.cleanIncomingFilename=function(e){if(!e)return e;const t=n(e);if(e!==t&&t){const e=t.split("."),n=e.length>=2&&e.pop();["bat","exe","cmd","com","lnk","pif","scr","vb","vbe","vbs","wsh","js","ps1","hta","sh","csh","msi","app","scpt","applescript","reg","vbe","wsf","sct"].includes(n)&&__LOG__(2,!0)`cleanIncomingFilename:extension: ${n||""}`}return t}},56406:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.canPlayOgg=function(){return!!M.canPlayOgg},t.decodeWebpToRGBANoOpaque=B,t.fetchMedia=function(){return X.apply(this,arguments)},t.gatherAndSetMetadata=function(){return Z.apply(this,arguments)},t.gatherAndSetMetadataNoOpaque=function(){return ee.apply(this,arguments)},t.getImageWidthHeight=function(e){return Q(function(){var t=(0,a.default)((function*(t){t(e);const n=new Image;return yield new Promise(((t,r)=>{n.onload=t,n.onabort=()=>{r(new Error("getImageWidthHeight onabort"))},n.onerror=()=>{r(new Error("getImageWidthHeight onerror"))},n.src=e.url()})),{width:n.naturalWidth,height:n.naturalHeight}}));return function(){return t.apply(this,arguments)}}())},t.getImageWidthHeightNoOpaque=G,t.getRawDocumentMimetype=z,t.getResizedThumbData=function(e,t){return new Promise((n=>{const r=new Image;r.setAttribute("crossorigin","anonymous"),r.onload=()=>{const e=t.map((e=>{let{width:t,height:n,minWidth:i,minHeight:a,imageFormat:o,imageFormatOptions:s,keepAspectRatio:l}=e;if(null!=i&&r.width<i||null!=a&&r.height<a)return null;const c=document.createElement("canvas"),d=c.getContext("2d");let u,p,f=0,h=0;if(r.height>r.width){u=t,p=r.height/r.width*t,h=-(p-n)/2}else{p=n,u=r.width/r.height*n,f=-(u-t)/2}return l?(c.width=u,c.height=p):(c.width=t,c.height=n),d.drawImage(r,f,h,u,p),{dataUrl:c.toDataURL(o,s).replace("data:image/jpeg;base64,",""),width:c.width,height:c.height}}));n(e)},r.src=e}))},t.opaqueDataToArrayBuffer=function(e){return Q((t=>{t(e);const n=e.getBlob();if(n)return x(n);const r=(0,l.default)(e.getBase64(),"b64 should be defined");return(0,o.decodeB64)(r)}))},t.parseWebpNoOpaque=j,t.processRawAudioVideo=function(){return $.apply(this,arguments)},t.processRawDocument=function(){return J.apply(this,arguments)},t.processRawImage=function(){return H.apply(this,arguments)},t.processRawSticker=function(){return V.apply(this,arguments)},t.shouldUseLruMediaStore=function(e){const t=e===O.MEDIA_TYPES.STICKER||e===O.MEDIA_TYPES.IMAGE,n=e===O.MEDIA_TYPES.AUDIO||e===O.MEDIA_TYPES.DOCUMENT||e===O.MEDIA_TYPES.GIF||e===O.MEDIA_TYPES.PPIC||e===O.MEDIA_TYPES.PRODUCT||e===O.MEDIA_TYPES.PTT||e===O.MEDIA_TYPES.VIDEO||e===O.MEDIA_TYPES.TEMPLATE||e===O.MEDIA_TYPES.THUMBNAIL_DOCUMENT||e===O.MEDIA_TYPES.THUMBNAIL_IMAGE||e===O.MEDIA_TYPES.THUMBNAIL_LINK||e===O.MEDIA_TYPES.THUMBNAIL_VIDEO;return(t||n)&&(0,L.getRememberMe)()},t.shouldUseMediaCache=function(e){return e===O.MEDIA_TYPES.STICKER||e===O.MEDIA_TYPES.IMAGE||e===O.MEDIA_TYPES.PRODUCT||e===O.MEDIA_TYPES.PTT||e===O.MEDIA_TYPES.AUDIO},t.videoWidthHeightDuration=function(e){return Q((t=>(t(e),M.videoWidthHeightDuration(e.forceToBlob()))))},t.videoWidthHeightDurationNoOpaque=K;var i=r(n(81109)),a=r(n(48926)),o=n(15688),s=n(50796),l=r(n(45095)),c=n(18412),d=n(67602),u=n(85582),p=r(n(64369)),f=U(n(48011)),h=n(65885),_=U(n(51428)),g=U(n(35232)),m=r(n(76139)),y=n(93778),E=r(n(11854)),S=n(61498),v=r(n(97769)),T=n(99140),b=r(n(93915)),C=r(n(52368)),A=n(57701),P=n(21921),M=U(n(16737)),O=n(61596),I=n(58668),w=n(43257),R=r(n(34949)),D=n(76076),L=n(53055),N=n(64551);function k(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(k=function(e){return e?n:t})(e)}function U(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=k(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}return r.default=e,n&&n.set(e,r),r}function G(e){return new Promise(((t,n)=>{const r=new Image,i=window.URL.createObjectURL(e);r.onload=()=>{const e={width:r.naturalWidth,height:r.naturalHeight};window.URL.revokeObjectURL(i),t(e)},r.onabort=()=>{window.URL.revokeObjectURL(i),n(new Error("getImageWidthHeight onabort"))},r.onerror=()=>{window.URL.revokeObjectURL(i),n(new Error("getImageWidthHeight onerror"))},r.src=i}))}function x(e){return(0,h.blobToArrayBuffer)(e).catch((e=>{throw __LOG__(3)`MediaUtils error: ${e}`,e}))}function B(){return F.apply(this,arguments)}function F(){return(F=(0,a.default)((function*(e){const t=yield x(e);return(0,b.default)(t)}))).apply(this,arguments)}function j(){return Y.apply(this,arguments)}function Y(){return(Y=(0,a.default)((function*(e){const t=yield x(e);return(0,D.parseWebp)(t)}))).apply(this,arguments)}function K(e){return M.videoWidthHeightDuration(e)}function W(e,t){return Q(function(){var n=(0,a.default)((function*(n){n(e);const r=yield M.transcode(e.forceToBlob(),t).then((e=>R.default.createFromData(e,e.type)));return n(r),r.autorelease(),r}));return function(){return n.apply(this,arguments)}}())}function H(){return(H=(0,a.default)((function*(e,t){const{transparency:n,minDimension:r}=null!=t?t:{},i=e.forceToBlob(),{width:a,height:o,images:s}=yield _.rotateAndResize(i,N.ServerProps.imageMaxEdge,_.BLOB|_.CANVAS,{transparency:n,minDimension:r}),{images:l}=yield _.rotateAndResize(s.canvas,p.default.IMG_THUMB_MAX_EDGE,_.DATA_URL|_.CANVAS),c=(0,u.getResizedDataUrl)(l.canvas,"image/jpeg",2e4),d=c?m.default.parseDataURL(c).data:null;return d||__LOG__(2)`processRawImage: Failed to reach max thumbnail size, preview will be null`,{type:I.OUTWARD_TYPES.IMAGE,mediaBlob:s.blob,mimetype:s.blob.type,fullWidth:a,fullHeight:o,preview:d}}))).apply(this,arguments)}function V(){return(V=(0,a.default)((function*(e){const t=e.forceToBlob(),{width:n,height:r,images:i}=yield _.rotateAndResize(t,N.ServerProps.imageMaxEdge,_.BLOB,{transparency:!0}),a=yield _.toWebpSticker(i.blob),o=yield R.default.createFromData(a,a.type);return{type:I.OUTWARD_TYPES.STICKER,mediaBlob:o,mimetype:a.type,fullWidth:n,fullHeight:r}}))).apply(this,arguments)}function $(){return($=(0,a.default)((function*(e,t,n,r,a){var o;const s=e.forceToBlob(),l=yield(0,P.checkAndRepair)(s,!!r);if(!l)throw __LOG__(3)`processRawAudioVideo bad video file ${s.type}`,new g.InvalidMediaFileType;const c=l.type,d=l.file,u=r||l.isGif;switch((0,h.typeFromMimetype)(c)){case h.FILETYPE.VIDEO:if(t)throw __LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("media-fault: ptt became video"),new g.InvalidMediaFileType;const e={type:I.OUTWARD_TYPES.VIDEO,mediaBlob:d,mimetype:c,isGif:u,gifAttribution:u?a||0:void 0};if(n&&null!=n.duration&&null!=n.fullHeight&&0!==n.fullHeight&&null!=n.fullWidth&&0!==n.fullWidth&&n.preview)return(0,i.default)((0,i.default)({},e),{},{fullWidth:n.fullWidth,fullHeight:n.fullHeight,preview:n.preview,duration:n.duration.toString()});const{duration:r,thumbs:[s,l]}=yield _.generateVideoThumbsAndDuration({file:d,maxDimensions:[p.default.IMG_THUMB_MAX_EDGE,p.default.VIDEO_THUMB_MAX_EDGE],debugHint:"processRawAudioVideo"}),f=yield R.default.createFromBase64Jpeg(m.default.parseDataURL(l.url).data);return(0,i.default)((0,i.default)({},e),{},{fullWidth:s.fullWidth,fullHeight:s.fullHeight,preview:m.default.parseDataURL(s.url).data,fullPreviewData:f,duration:r.toString()});case h.FILETYPE.AUDIO:const y=null!==(o=null==n?void 0:n.duration)&&void 0!==o?o:yield(0,h.getAudioDuration)(d);return{type:t?I.OUTWARD_TYPES.PTT:I.OUTWARD_TYPES.AUDIO,mediaBlob:d,mimetype:c,duration:y.toString(),waveform:null==n?void 0:n.waveform};default:throw __LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("media-fault: audio/video became other"),new Error(`audio/video became ${c}`)}}))).apply(this,arguments)}function z(){return q.apply(this,arguments)}function q(){return(q=(0,a.default)((function*(e,t){const n=e.type;if(n){if("*"===w.DOC_MIMES||w.DOC_MIMES.includes(n))return n;throw new g.InvalidMediaFileType(`disallowed mimetype ${n}`)}{const n=Math.min(w.MIMETYPE_DETERMINING_LENGTH,e.size),i=yield x(e.slice(0,n)),a=new Uint8Array(i);var r;if((0,w.isMsCompoundFileBinaryFormat)(a.subarray(0,8)))return null!=t&&null!==(r=(0,h.getMimeTypeForFilepath)(t))&&void 0!==r?r:w.MSCFB_MIME;const o=(0,v.default)(a);if(null==o?void 0:o.mime){const e=(0,w.isAllowedDocumentMimetype)(o.mime,t,!0);if(e)return e}else if(t){const e=(0,h.getMimeTypeForFilepath)(t);if(e)return e}throw new g.InvalidMediaFileType(`type: ${String(e.type)} name: ${String(t)}`)}}))).apply(this,arguments)}function J(){return(J=(0,a.default)((function*(e,t,n,r){var i,a;const o=e.forceToBlob(),s=(0,T.cleanFilename)(o.name||t||null),l=yield z(o,s),c=n?(0,h.blobToText)(o):null,[d,u]=yield Promise.all([f.enrich(o,l),c]),p=null!==(i=null==d||null===(a=d.microThumbnail)||void 0===a?void 0:a.dataUrl)&&void 0!==i?i:null==d?void 0:d.thumbUrl,_=p?m.default.parseDataURL(p).data:null;return{type:I.OUTWARD_TYPES.DOCUMENT,mediaBlob:yield R.default.createFromData(o,l),mimetype:l,filename:s||void 0,documentPreview:d,preview:_,fullPreviewData:null==d?void 0:d.fullPreviewData,fullPreviewSize:d?{width:d.width,height:d.height}:null,pageCount:null!=r?r:null==d?void 0:d.pdfPages,isVcardOverMmsDocument:n,parsedVcards:u?(0,y.parseMultiVcard)(u):null}}))).apply(this,arguments)}function Q(e){const t=[];return(0,c.promiseCallSync)(e,null,(function(e){e.retain(),t.push(e)})).finally((()=>{for(let e=0;e<t.length;e++)t[e].autorelease()}))}function X(){return(X=(0,a.default)((function*(e){const t=yield(0,C.default)(e,"GET",null,E.default.RESP_TYPE.ARRAY_BUFFER);return t?Promise.resolve({result:t.response,status:t.status}):Promise.resolve(null)}))).apply(this,arguments)}function Z(){return(Z=(0,a.default)((function*(e,t){let n,r;t.retain();try{switch(e.type){case I.TYPE.VIDEO:const i=t.forceToBlob(),{thumbs:[a],duration:o}=yield _.generateVideoThumbsAndDuration({file:i,maxDimensions:[p.default.VIDEO_THUMB_MAX_EDGE],debugHint:"gatherAndSetMetadata"});let s;(0,A.isHighQualityVideoThumbnailsEnabled)()&&(s=yield R.default.createFromBase64Jpeg(m.default.parseDataURL(a.url).data)),n={mediaBlob:t,renderableUrl:t.url(),fullWidth:a.fullWidth,fullHeight:a.fullHeight,duration:void 0!==o?`${Math.ceil(o)}`:void 0,durationFloat:o,fullPreviewData:s};break;case I.TYPE.AUDIO:const l=yield W(t);l.retain(),n={mediaBlob:l,renderableUrl:l.url()},r=()=>l.autorelease();break;default:e.type!==I.TYPE.IMAGE&&e.type!==I.TYPE.STICKER||(__LOG__(4,void 0,new Error,!0)`object type: ${e.type||""}`,SEND_LOGS("Entering gatherAndSetMetadata (with OpaqueData) unexpectedly")),n={mediaBlob:t,renderableUrl:t.url()}}e.consolidate(n)}catch(n){if(!(n instanceof g.MediaUnsupportedError))throw n;e.consolidate({mediaBlob:t,renderableUrl:t.url()})}finally{t.autorelease(),null!=r&&r()}}))).apply(this,arguments)}function ee(){return(ee=(0,a.default)((function*(e,t){const n=yield Promise.resolve().then((()=>{switch(e.type){case I.TYPE.VIDEO:return K(t).then((e=>({fullWidth:e.width,fullHeight:e.height,duration:void 0!==e.duration?`${Math.ceil(e.duration)}`:void 0,durationFloat:e.duration})));case I.TYPE.IMAGE:return null!=e.contentInfo.fullHeight&&null!=e.contentInfo.fullWidth&&e.size===t.size?null:G(t).then((e=>({fullWidth:e.width,fullHeight:e.height,size:t.size})));case I.TYPE.STICKER:return(0,S.detectWebpSupport)().then((e=>e?(0,d.promiseProps)({widthHeight:G(t),webpData:j(t)}).then((e=>({fullWidth:e.widthHeight.width,fullHeight:e.widthHeight.height,animationDuration:e.webpData.animationDuration,firstFrameLength:e.webpData.firstFrameLength,singleLoopDuration:e.webpData.singleLoopDuration,emojis:e.webpData.emojis,isAnimated:e.webpData.animationDuration>0,size:t.size,isFirstParty:e.webpData.isFirstParty,isFromStickerMaker:e.webpData.isFromStickerMaker,stickerPackId:e.webpData.stickerPackId,stickerPackName:e.webpData.stickerPackName,stickerPackPublisher:e.webpData.stickerPackPublisher}))):j(t).then(function(){var e=(0,a.default)((function*(e){let{animationDuration:n,firstFrameLength:r,singleLoopDuration:i,emojis:a,isFirstParty:o,isFromStickerMaker:s,stickerPackId:l,stickerPackName:c,stickerPackPublisher:d}=e;if(n>0)return{animationDuration:n,firstFrameLength:r,singleLoopDuration:i,emojis:a,isAnimated:!0,size:t.size,isFirstParty:o,isFromStickerMaker:s,stickerPackId:l,stickerPackName:c,stickerPackPublisher:d};const u=yield B(t);return{animationDuration:n,rgbaBuffer:u.rgbaBuffer,rgbaWidth:u.width,rgbaHeight:u.height,emojis:a,isAnimated:!1,size:t.size,isFirstParty:o,isFromStickerMaker:s,stickerPackId:l,stickerPackName:c,stickerPackPublisher:d}}));return function(){return e.apply(this,arguments)}}())));case I.TYPE.AUDIO:default:return{}}})).catch((0,s.filteredCatch)(g.MediaUnsupportedError,(t=>{throw e.consolidate({}),t})));null!=n&&e.consolidate(n)}))).apply(this,arguments)}},34949:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(15688),a=r(n(45095)),o=n(57319),s=n(65885);let l=[];const c=new o.ShiftTimer((function(){const e=l;l=[];for(let t=0;t<e.length;t++){const n=e[t];n._inAutoreleasePool=!1,0!==n._retainCount||n.released||(n.released=!0,n._releaseImpl())}}));class d{constructor(){this._retainCount=1,this._inAutoreleasePool=!1,this.released=!1,this._b64=void 0,this._blob=void 0,this._url=void 0,this._mimetype=void 0,this._released=void 0}retain(){if(this.released)throw __LOG__(3)`OpaqueData:retain called on released OpaqueData`,new Error("OpaqueData:retain called on released OpaqueData");this._retainCount++}autorelease(){this.released?__LOG__(3)`OpaqueData:autorelease called on released object`:0===this._retainCount?__LOG__(3)`OpaqueData:autorelease too many release calls`:1===this._retainCount?(this._retainCount=0,this._inAutoreleasePool||(this._inAutoreleasePool=!0,l.push(this),c.onOrBefore(1e3))):this._retainCount--}autoreleaseWhenPromiseCompletes(e){const t=()=>{this.autorelease()};e.then(t,t)}throwIfReleased(e){if(this.released)throw __LOG__(4,void 0,new Error)`${e} called on released OpaqueData`,new Error(`${e} called on released OpaqueData`);0===this._retainCount&&__LOG__(4,void 0,new Error)`${e} called on unretained OpaqueData`}url(){return this.throwIfReleased("OpaqueData:url"),null!=this._url&&""!==this._url?this._url:null!=this._b64&&""!==this._b64?(this._url=`data:image/jpeg;base64,${this._b64}`,this._url):(this._url=window.URL.createObjectURL((0,a.default)(this._blob,"this._blob")),this._url)}getBlob(){return this._blob}getBase64(){return this._b64}validate(){return!0===this._released?Promise.resolve(!1):this._blob?(0,s.validateBlob)(this._blob):Promise.resolve(!0)}size(){return this.throwIfReleased("OpaqueData:size"),this._blob?this._blob.size:null!=this._b64?(0,i.sizeWhenB64Decoded)(this._b64):(__LOG__(4,void 0,new Error,!0)`OpaqueData:size returned 0`,SEND_LOGS("opaque-data-size-0"),0)}formData(){return this.throwIfReleased("OpaqueData:formData"),this.forceToBlob()}type(){return this.throwIfReleased("OpaqueData:type"),null!=this._mimetype&&""!==this._mimetype?this._mimetype:"undefined"}forceToBlob(){this.throwIfReleased("OpaqueData:forceToBlob");const e=this._blob;if(e)return e;const t=this._b64;if(null!=t&&""!==t){this._b64=void 0,this._url=void 0;const e=this._mimetype;return this._blob=new Blob([(0,i.decodeB64)(t)],null!=e&&""!==e?{type:e}:void 0)}throw new Error("OpaqueData:forceToBlob no b64 or blob")}_releaseImpl(){this._mimetype=void 0;this._blob?(this._blob=void 0,null!=this._url&&""!==this._url&&(window.URL.revokeObjectURL(this._url),this._url=void 0)):(this._b64=void 0,this._url=void 0)}isBlobEqual(e){return e?this._blob===e._blob:!this._blob}}t.default=d,d.createFromBase64Jpeg=e=>new Promise((t=>{const n=new d;return n._b64=e,n._mimetype="image/jpeg",t(n)})),d.createFromData=(e,t)=>new Promise((n=>{const r=new d;return r._blob=e instanceof Blob&&e.type===t?e:new Blob([e],{type:t}),r._mimetype=t,n(r)}))},61516:(e,t,n)=>{"use strict";var r=n(59182).default,i=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return _.apply(this,arguments)};var a=i(n(48926)),o=n(89385),s=n(15688),l=i(n(45095)),c=n(15461),d=i(n(34475)),u=n(26384),p=i(n(92360)),f=n(61596),h=i(n(34949));function _(){return(_=(0,a.default)((function*(e){const{msg:t,isPreload:n,signal:i}=e,{thumbnailSha256:a,thumbnailEncSha256:_,thumbnailDirectPath:g,mediaKey:m,mediaKeyTimestamp:y}=t;if(null==g||null==_||null==a||null==m||null==y)return;if(!(t.type!==c.MSG_TYPE.DOCUMENT&&t.type!==c.MSG_TYPE.INTERACTIVE||(0,f.getMsgMediaType)(t)!==f.MEDIA_TYPES.DOCUMENT||null!=t.thumbnailHeight&&null!=t.thumbnailWidth))return;const E=t.asUrl;if(!E||null!=E.thumbnailHeight&&null!=E.thumbnailWidth){__LOG__(2)`media.downloadMmsThumbnail: start`;try{const e=yield u.downloadManager.downloadAndDecrypt({directPath:g,encFilehash:_,filehash:a,mediaKey:m,mediaKeyTimestamp:y,type:(0,p.default)(t),signal:i||(new r).signal,userDownloadAttemptCount:0,isPreload:n});if(E)E.thumbnailHQ=(0,s.encodeB64)(e);else{const n=(0,l.default)(t.mediaObject,"mediaObject cannot be null for thumbnail download"),r={fullPreviewData:yield h.default.createFromData(e,"image/jpeg")};t.type===c.MSG_TYPE.DOCUMENT&&(r.fullPreviewSize={height:(0,l.default)(t.thumbnailHeight,"msg.thumbnailHeight"),width:(0,l.default)(t.thumbnailWidth,"msg.thumbnailWidth")}),n.consolidate(r)}__LOG__(2)`media.downloadMmsThumbnail: success`}catch(e){if(e.name===o.ABORT_ERROR)return void __LOG__(2)`media.downloadMmsThumbnail aborted`;__LOG__(3,!0)`media.downloadMmsThumbnail: error\n${(0,d.default)(e)}`}}}))).apply(this,arguments)}},92360:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){switch(e.type){case r.MSG_TYPE.DOCUMENT:return a.MEDIA_TYPES.THUMBNAIL_DOCUMENT;case r.MSG_TYPE.VIDEO:return a.MEDIA_TYPES.THUMBNAIL_VIDEO;case r.MSG_TYPE.IMAGE:return a.MEDIA_TYPES.THUMBNAIL_IMAGE;case r.MSG_TYPE.CHAT:return a.MEDIA_TYPES.THUMBNAIL_LINK;case r.MSG_TYPE.INTERACTIVE:{const{interactiveHeader:t}=e;if(null!=(null==t?void 0:t.mediaType))switch(t.mediaType){case i.InteractiveMessageHeaderMediaType.DOCUMENT:return a.MEDIA_TYPES.THUMBNAIL_DOCUMENT;case i.InteractiveMessageHeaderMediaType.VIDEO:return a.MEDIA_TYPES.THUMBNAIL_VIDEO}break}}throw new Error("getThumbnailTypeForMsg: Unsupported msg type")};var r=n(15461),i=n(34535),a=n(61596)},46220:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return e?(0,a.unproxy)(e).isGroup?i.default.UPLOAD_ORIGIN_TYPE.CHAT_GROUP:i.default.UPLOAD_ORIGIN_TYPE.CHAT_PERSONAL:i.default.UPLOAD_ORIGIN_TYPE.UNKNOWN};var i=r(n(11339)),a=n(31019)},84866:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.MediaBlobCacheImpl=t.MediaBlobCache=void 0;var i=r(n(23493)),a=n(42430),o=n(88297),s=n(58668);class l{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:25e7;if(this._filehashesToCleanUp=new Set,this.getOrCreateURL=e=>{if(this._filehashToUrl[e])return this.touch(e),this._filehashToUrl[e];const t=this.get(e);if(!t)throw new Error(`There is no blob matching filehash: ${e}.`);const n=window.URL.createObjectURL(t);return this._filehashToUrl[e]=n,n},this.revokeURL=(e,t)=>{if(t){if(this._filehashToUrl[e]!==t)throw new Error("The url provided does not match the filehash.");delete this._filehashToUrl[e],window.URL.revokeObjectURL(t)}},this._scheduleCleanup=(0,i.default)((()=>{this._filehashesToCleanUp.forEach((e=>{window.URL.revokeObjectURL(this._filehashToUrl[e]),delete this._filehashToUrl[e]})),this._filehashesToCleanUp.clear()}),0,{leading:!1}),null!=e&&e<0)throw new Error("Size limit cannot be a negative number.");this._usageCounts={},this._filehashToUrl={},this._lruCache=new a.LruCache({sizeLimit:e,getSize:e=>e.size,onEvict:e=>{this._filehashToUrl[e]&&0===this._getUsageCount(e)&&(this.revokeURL(e,this._filehashToUrl[e]),(0,o.getOrCreateMediaObject)(e).consolidate({downloadStage:s.DOWNLOAD_STAGE.INIT,progressiveStage:null}))},shouldEvict:e=>0===this._getUsageCount(e)})}get(e){return this._lruCache.get(e)}has(e){return this._lruCache.has(e)}touch(e){this.get(e)}put(e,t){this._lruCache.put(e,t)}clear(){this._scheduleCleanup.flush(),this._usageCounts={},Object.keys(this._filehashToUrl).forEach((e=>{this._filehashToUrl[e]&&this.revokeURL(e,this._filehashToUrl[e])})),this._filehashToUrl={},this._lruCache.clear()}increaseUsageCount(e){this._usageCounts[e]=this._getUsageCount(e)+1,this._filehashesToCleanUp.delete(e)}decreaseUsageCount(e){const t=this._getUsageCount(e);if(t<=0)throw new Error("Cannot decrease the usageCount to a negative number.");this._usageCounts[e]=t-1,0===this._usageCounts[e]&&(delete this._usageCounts[e],this._filehashesToCleanUp.add(e),this._scheduleCleanup())}_getUsageCount(e){return this._usageCounts[e]||0}}t.MediaBlobCacheImpl=l;const c=new l;t.MediaBlobCache=c},45554:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MediaKeyCache=void 0,t.shouldUseMediaKeyCache=function(){if((0,i.isMDBackend)())return(0,a.getABPropConfigValue)("web_abprop_document_resume_upload");return!1};var r=n(42430),i=n(88555),a=n(57849);const o={sizeLimit:10,getSize:()=>1};const s=new r.LruCache(o);t.MediaKeyCache=s},45987:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.cleanJPEG=function(e){const t=new r.Binary(e),n=new r.Binary(e),j=new r.Binary;let Y,K=!1,W=!1,H=!1,V=!1;const $={version:257,densityUnits:0,xDensity:1,yDensity:1};if(255!==t.readUint8()||t.readUint8()!==y)throw new Error("SOI marker not at the start of the file.");n.advance(2);let z;for(;null!=z||t.size();){if(void 0===z){const e=t.readUint8();if(255!==e)throw new Error(`0x${e.toString(16)} is not a marker prefix.`);z=t.readUint8()}switch(z){case b:if(W)Y=t.readUint16(),n.advance(Y+2),t.advance(t.size()-n.size());else{if(Y=t.readUint16(),"JFIF\0"!==t.readString(5))throw new Error("APP0 marker missing 'JFIF' magic bytes.");V=!0,$.version=t.readUint16(),$.densityUnits=t.readUint8(),$.xDensity=t.readUint16(),$.yDensity=t.readUint16(),n.advance(Y+2),t.advance(t.size()-n.size()),W=!0}break;case S:if(!H&&!V)throw new Error("Missing magic bytes marker.");let e,r;t.advance(t.readUint16()-2);let y=t.readUint8();for(;t.size();){if(r=t.readUint8(),e=255===y&&!F.includes(r),e){z=r;break}y=r}j.writeByteArray(n.readByteArray(n.size()-t.size()-2));continue;case C:if(Y=t.readUint16(),!H&&"Exif\0\0"!==t.readString(6))throw new Error("APP1 marker missing 'EXIF' magic bytes.");H=!0,n.advance(Y+2),t.advance(t.size()-n.size());break;case U:case B:if(!H&&!V)throw new Error("Missing magic bytes marker.");Y=t.readUint16(),n.advance(Y+2),t.advance(t.size()-n.size());break;case E:if(!H&&!V)throw new Error("Missing magic bytes marker.");K=!0,j.writeByteArray(n.readByteArray(2));break;case i:case a:case o:case s:case c:case d:case u:case p:case f:case h:case _:case g:case m:case v:case l:case T:if(!H&&!V)throw new Error("Missing magic bytes marker.");Y=t.readUint16(),j.writeByteArray(n.readByteArray(2+Y)),t.advance(t.size()-n.size());break;case A:case P:case M:case O:case I:case w:case R:case D:case L:case N:case k:case G:case x:throw new Error(`Received unexpected APP marker 0x${z.toString(16)}`);default:throw new Error(`Did not understand marker: 0x${z.toString(16)}`)}if(z=void 0,K)break}if(!K)throw new Error("No EOI tag found.");const q=function(e){const t=new r.Binary;return t.writeBytes(255,216,255,224,0,16,74,70,73,70,0),t.writeUint16(e.version),t.writeUint8(e.densityUnits),t.writeUint16(e.xDensity),t.writeUint16(e.yDensity),t.writeBytes(0,0),t.readByteArray()}($);return new Blob([q,j.readByteArray()],{type:"image/jpeg"})};var r=n(8584);const i=192,a=193,o=194,s=195,l=196,c=197,d=198,u=199,p=201,f=202,h=203,_=205,g=206,m=207,y=216,E=217,S=218,v=219,T=221,b=224,C=225,A=226,P=227,M=228,O=229,I=230,w=231,R=232,D=233,L=234,N=235,k=236,U=237,G=238,x=239,B=254,F=[0,208,209,210,211,212,213,214,215]},84979:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(48926)),a=r(n(13684));const o={ignoreSearch:!0,ignoreMethod:!0,ignoreVary:!0};class s extends a.default{constructor(e){super(),this._encodeKey=e=>{const t=encodeURIComponent(e);return`https://_media_cache_v2_.whatsapp.com/${encodeURIComponent(this.storeName)}_${t}`},this.storeName=e}doGet(e){const t=this._encodeKey(e);return this.cacheStore?Promise.resolve(this.cacheStore.match(t,o).then((e=>e?e.arrayBuffer():null))):(__LOG__(3)`Unable to get. This error can occur if abstract method doGet gets called.`,Promise.reject(new Error("Unable to get")))}doPut(e,t){const n=this._encodeKey(e);return this.cacheStore?Promise.resolve(this.cacheStore.put(n,new Response(t)).then((()=>t))):(__LOG__(3)`Unable to put. This error can occur if abstract method doPut gets called.`,Promise.reject(new Error("Unable to put in cache")))}doDel(e){var t=this;return(0,i.default)((function*(){const n=t._encodeKey(e);if(!t.cacheStore)return __LOG__(3)`Unable to delete. This error can occur if abstract method doDel gets called.`,Promise.reject(new Error("Unable to delete"));yield t.cacheStore.delete(n,o)}))()}doClear(){return Promise.resolve(caches.delete(this.storeName).then((e=>{e||__LOG__(2)`Tried to delete a non-existent cache: ${this.storeName}`})))}doOpen(){return caches.open(this.storeName).then((e=>{this.cacheStore=e})).catch((e=>{throw this.cacheStore=null,__LOG__(3)`Unable to open cache: ${this.storeName}, error: ${e}`,e}))}doClose(){return this.cacheStore=null,Promise.resolve()}}t.default=s},48520:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(48926)),a=r(n(13684)),o=r(n(91481)),s=n(3971),l=n(29830);class c extends a.default{constructor(){super(),this._store=new o.default(l.initialize,s.IdbArrayBufferTable)}doGet(e){var t=this;return(0,i.default)((function*(){const n=yield t._store.get(e);return n?n.data:null}))()}doQueryByIndex(){throw new Error("Not implemented. Actual Arraybuffer store does not need it.")}doGetAll(){throw new Error("Not implemented. Actual Arraybuffer store does not need it.")}doPut(e,t){var n=this;return(0,i.default)((function*(){return(yield n._store.put(e,{id:e,data:t})).data}))()}doDel(e){return this._store.del(e)}doCount(){return this._store.count()}clear(){return this._store.clear()}doOpen(){return Promise.resolve()}doClose(){return Promise.resolve()}}t.default=c},25289:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(13684));class a extends i.default{get(){return Promise.resolve()}queryByIndex(){return Promise.resolve([])}getAll(){return Promise.resolve([])}put(e,t){return Promise.resolve(t)}del(){return Promise.resolve()}count(){return Promise.resolve(0)}clear(){return Promise.resolve()}}t.default=a},55975:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.MediaStore=t.LruMediaStore=void 0;var i=r(n(48926)),a=r(n(51463)),o=n(88555),s=r(n(26945)),l=n(35232),c=r(n(34475)),d=n(57849),u=r(n(84979)),p=r(n(48520)),f=r(n(25289)),h=r(n(71058));class _{constructor(){this._getBackingStore=(0,a.default)((0,i.default)((function*(){try{const e=function(){const e=function(){if(null!=s.default&&"caches"in self)return new u.default("lru-media-array-buffer-cache");return null!=s.default?new p.default("media_lru_buffer"):null}();return null==e?null:new h.default({maxSize:(0,o.isMDBackend)()&&(0,d.getABPropConfigValue)("web_lru_cache_purge_logic_refactor")?void 0:Number.MAX_SAFE_INTEGER,arrayBufferStore:e})}();if(null!=e)return yield e.open(),e}catch(e){if("SecurityError"===e.name)__LOG__(3)`There was a security error attempting to open the media storage. \
This likely indicates a permissions error. Falling back to dummy \
(no-op) storage.`;else{if(e instanceof l.DbOnLogoutAbort)throw e;__LOG__(4,!0,new Error,!0)`Failed to initialize media store! Falling back to dummy (no-op) storage. Error:
${(0,c.default)(e)}`,SEND_LOGS("Failed to initialize media store")}}return new f.default})))}get(e){var t=this;return(0,i.default)((function*(){return(yield t._getBackingStore()).get(e)}))()}queryByIndex(e,t){var n=this;return(0,i.default)((function*(){return(yield n._getBackingStore()).queryByIndex(e,t)}))()}getAll(){var e=this;return(0,i.default)((function*(){return(yield e._getBackingStore()).getAll()}))()}put(e,t){var n=this;return(0,i.default)((function*(){return(yield n._getBackingStore()).put(e,t)}))()}del(e){var t=this;return(0,i.default)((function*(){const n=yield t._getBackingStore();yield n.del(e)}))()}count(){var e=this;return(0,i.default)((function*(){return(yield e._getBackingStore()).count()}))()}clear(){var e=this;return(0,i.default)((function*(){const t=yield e._getBackingStore();yield t.clear()}))()}open(){var e=this;return(0,i.default)((function*(){const t=yield e._getBackingStore();yield t.open()}))()}close(){var e=this;return(0,i.default)((function*(){const t=yield e._getBackingStore();yield t.close()}))()}}t.MediaStore=_;const g=new _;t.LruMediaStore=g},71058:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(48926)),a=r(n(45095)),o=n(27870),s=r(n(13684)),l=n(88555),c=r(n(86128)),d=n(57849),u=r(n(63236)),p=r(n(37804));class f extends s.default{constructor(e){var t;super(),t=this,this._queueMap=new o.PromiseQueueMap,this._isInitialized=!1,this.updateMaxSizeInterval=null,this._dispose=e=>this._bufferStore.del(e),this.doPut=(e,n)=>this._queueMap.enqueue(e,(0,i.default)((function*(){if(n.byteLength>t.getMaxSize())return n;if(n.byteLength>3e7)return n;const r={id:e,timestamp:(new Date).getTime(),size:n.byteLength};try{return(0,l.isMDBackend)()&&(0,d.getABPropConfigValue)("web_lru_cache_purge_logic_refactor")&&(yield t._updateMaxSize()),yield t._metaInfoStore.putObject(r),t._bufferStore.put(e,n)}catch(e){if(e instanceof c.default.AbortError&&e.message.includes("QuotaExceededError"))return __LOG__(2)`LruMediaStore: encounter QuotaExceededError, thus shrink the size of LruMediaStore`,void t.setMaxSize((0,a.default)(t.getCurrentSize(),"_this.getCurrentSize()")/2);throw e}}))),this.doDel=e=>this._isInitialized?this._queueMap.enqueue(e,(()=>this._metaInfoStore.del(e))):Promise.resolve(),this._updateMaxSize=function(){var e=(0,i.default)((function*(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const n=yield(0,u.default)();if(null==n)return void t._clearStoreForThisSession();const r=t.getCurrentSize();if(null==r)return;const i=n.available,a=t._calculateTargetedBufferSize(n.quota);if(i>a)return void(e&&t.setMaxSize(i));const o=(0,l.isMDBackend)()&&(0,d.getABPropConfigValue)("web_lru_cache_purge_logic_refactor")?2:1,s=a*o-i;r<s?t._clearStoreForThisSession():t.setMaxSize(r-s)}));return function(){return e.apply(this,arguments)}}();const{maxSize:n,arrayBufferStore:r}=e;this._bufferStore=r,this._isInitialized=null!=n,this._metaInfoStore=new p.default(null!=n?n:0,this._dispose),this.updateMaxSizeInterval=setInterval(this._updateMaxSize,6e4)}doGet(e){var t=this;return(0,i.default)((function*(){const n=yield t._bufferStore.get(e);return null!=n&&t.put(e,n),n}))()}doClear(){var e=this;return(0,i.default)((function*(){return yield e._bufferStore.clear(),e._metaInfoStore.clear()}))()}doCount(){return this._metaInfoStore.count()}doOpen(){var e=this;return(0,i.default)((function*(){yield Promise.all([e._metaInfoStore.open(),e._bufferStore.open()]),!e._isInitialized&&(0,l.isMDBackend)()&&(0,d.getABPropConfigValue)("web_lru_cache_purge_logic_refactor")&&(yield e._updateMaxSize(!0),e._isInitialized=!0)}))()}doClose(){var e=this;return(0,i.default)((function*(){yield Promise.all([e._metaInfoStore.close(),e._bufferStore.close()])}))()}getCurrentSize(){return this._metaInfoStore.getCurrentSize()}getMaxSize(){return this._metaInfoStore.getMaxSize()}setMaxSize(e){return this._metaInfoStore.setMaxSize(e)}_calculateTargetedBufferSize(e){const t=Math.floor(.01*e);return t<1e8?1e8:t>5e8?5e8:t}_clearStoreForThisSession(){this.setMaxSize(0),this.updateMaxSizeInterval&&(clearInterval(this.updateMaxSizeInterval),this.updateMaxSizeInterval=null)}}t.default=f},37804:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(91481)),a=n(9362),o=n(29830),s=r(n(3459));class l extends s.default{constructor(e,t){super(new i.default(o.initialize,a.IdbMetaInfoTable),{primaryIndex:a.metaInfoPrimaryIndex,dateIndex:a.metaInfoDateIndex,sizeIndex:a.metaInfoSizeIndex,maxSize:e,dispose:t})}}t.default=l},91481:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(48926)),a=r(n(13684));class o extends a.default{constructor(e,t){super(),this._initialize=e,this._table=t}doGet(e){var t=this;return(0,i.default)((function*(){return yield t._initialize(),t._table.get(e)}))()}doQueryByIndex(e,t){var n=this;return(0,i.default)((function*(){return yield n._initialize(),n._table.all({limit:t.limit,index:[e]})}))()}doGetAll(){var e=this;return(0,i.default)((function*(){return yield e._initialize(),e._table.all()}))()}doPut(e,t){var n=this;return(0,i.default)((function*(){return yield n._initialize().then((()=>n._table.createOrReplace(t))),t}))()}doDel(e){var t=this;return(0,i.default)((function*(){return yield t._initialize(),t._table.remove(e)}))()}doCount(){var e=this;return(0,i.default)((function*(){return yield e._initialize(),e._table.count()}))()}doClear(){var e=this;return(0,i.default)((function*(){return yield e._initialize(),e._table.clear(!0)}))()}doOpen(){return this._initialize()}doClose(){return Promise.resolve()}}t.default=o},3459:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(48926)),a=r(n(45095)),o=n(4352),s=n(27870),l=n(57319),c=r(n(13684)),d=n(88555),u=n(57849);class p extends c.default{constructor(e,t){var n;if(super(),n=this,this._queueMap=new s.PromiseQueueMap,this._purgeCount=0,this._optimizationEnabled=!1,this._purge=()=>{if(this._pendingPurgePromise)return this._pendingPurgePromise;const e=this.open().then((()=>(0,o.promiseLoop)(function(){var e=(0,i.default)((function*(e){const t=()=>{n._pendingPurgePromise=null,e()},r=n.getCurrentSize();if(null==r||r<=n._maxSize)return void t();const a=yield n.queryOneByIndex(n._dateIndex),o=n.getCurrentSize(),s=n._maxSize;if(null==o||o<=s)return void t();if(null==a)return(0,i.default)((function*(){const e=yield n.count();__LOG__(3,void 0,void 0,!0)`SizeLruObjectStore: _purge error: No row returned but currentSize (${o}) > maxSize (${s}). Row count is ${e} (may be out of date).`,SEND_LOGS("size-lru-store-invalid-empty")}))(),Promise.reject(new Error("Query returned no result but currentSize > maxSize"));const l=a[n._primaryIndex];return n.del(l)}));return function(){return e.apply(this,arguments)}}())));return this._pendingPurgePromise=e},this._purgeOptimized=(e,t)=>{this._purgeCount++;const r=Promise.resolve().then((0,i.default)((function*(){var r;const i=yield n._store.get(e),a=null==i?0:n._getSize(i),o=null!==(r=n.getCurrentSize())&&void 0!==r?r:0,s=n.getMaxSize(),l=o+(t-a);if(l<=s)return;const c=yield n.count(),d=yield n.doQueryByIndex(n._dateIndex,{limit:c}),u=[];let p=l;for(const t of d)if(t[n._primaryIndex]!==e&&(p-=n._getSize(t),u.push(t[n._primaryIndex]),p<=s))break;if(p>s)throw __LOG__(3,void 0,void 0,!0)`SizeLruObjectStore: _purge error: Adjusted size is too big even after removal of all items.`,SEND_LOGS("size-lru-store-invalid-empty"),new Error("Above max limit after purge");yield Promise.all(u.map((e=>n.del(e)))),0==--n._purgeCount&&(n._pendingPurgePromiseOptimized=null)})));return null!=this._pendingPurgePromiseOptimized?(this._pendingPurgePromiseOptimized=this._pendingPurgePromiseOptimized.finally((()=>r)),this._pendingPurgePromiseOptimized):(this._pendingPurgePromiseOptimized=r,r)},this._schedulePurge=()=>{this._purgeTimer.debounce(2e3)},this.doPut=(e,t)=>this._queueMap.enqueue(e,(0,i.default)((function*(){if(t[n._primaryIndex]!==e)throw new Error("The key you provide does not match.");const r=yield n._store.get(e),i=null==r?0:n._getSize(r),o=n._getSize(t);n._optimizationEnabled&&(yield n._purgeOptimized(e,o));const s=yield n._store.put(e,t);return n._currentSize=(0,a.default)(n.getCurrentSize(),"_this.getCurrentSize()")+(o-i),n._optimizationEnabled||n._schedulePurge(),s}))),this.doDel=e=>this._queueMap.enqueue(e,(0,i.default)((function*(){const t=yield n._store.get(e);if(null!=t){try{yield n._dispose(e,t)}catch(e){throw __LOG__(3,void 0,void 0,!0)`SizeLRUObjectStore: _dispose error: ${e.message}`,SEND_LOGS("size-lru-store-dispose-error"),e}yield n._store.del(e),n._currentSize=(0,a.default)(n.getCurrentSize(),"_this.getCurrentSize()")-n._getSize(t)}}))),this._store=e,this._primaryIndex=t.primaryIndex,this._dateIndex=t.dateIndex,this._sizeIndex=t.sizeIndex,t.maxSize<0)throw new Error("Cannot set max size to a negative number");this._maxSize=Math.floor(t.maxSize),this._dispose=t.dispose,this._purgeTimer=new l.ShiftTimer((()=>{this._purge().catch((e=>{__LOG__(3)`Error while purging: ${e.message}`}))})),this._optimizationEnabled=(0,d.isMDBackend)()&&(0,u.getABPropConfigValue)("web_lru_cache_optimization")}getCurrentSize(){return this._currentSize}getMaxSize(){return this._maxSize}setMaxSize(e){return e<0?Promise.reject(new Error("Cannot set size to a negative number")):(this._maxSize=Math.floor(e),this._purgeTimer.cancel(),this._purge().catch((e=>{__LOG__(3)`Error while purging during setMaxSize: ${e.message}`})))}putObject(e){const t=e[this._primaryIndex];return this.put(t,e)}_getSize(e){const t=e[this._sizeIndex];return"number"!=typeof t||t<0?(__LOG__(3)`Invalid size in index ${this._sizeIndex}: ${t}`,0):t}doGet(e){return this._store.get(e)}queryOneByIndex(e){var t=this;return(0,i.default)((function*(){const n=yield t._store.queryByIndex(e,{limit:1});return 0===n.length?null:n[0]}))()}doQueryByIndex(e,t){return this._store.queryByIndex(e,t)}doGetAll(){return this._store.getAll()}doClear(){var e=this;return(0,i.default)((function*(){e._purgeTimer.cancel(),yield e._store.clear(),e._currentSize=0}))()}doCount(){return this._store.count()}doOpen(){var e=this;return(0,i.default)((function*(){if(yield e._store.open(),null!=e._currentSize)return;const t=yield e._store.doGetAll();e._currentSize=t.reduce(((t,n)=>t+e._getSize(n)),0)}))()}doClose(){return this._currentSize=null,this._store.close()}}t.default=p},78986:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0});var i={MediaPrep:!0,checkExistence:!0,clearMediaForChat:!0,downloadMsg:!0,downloadProgressiveJpegThumbnail:!0,downloadStatusV3Thumbnail:!0,downloadVideoThumbnail:!0,forwardMediaMsg:!0,manuallySetMedia:!0,prepRawMedia:!0,resumeUploadMsg:!0};Object.defineProperty(t,"MediaPrep",{enumerable:!0,get:function(){return p.default}}),Object.defineProperty(t,"checkExistence",{enumerable:!0,get:function(){return f.default}}),Object.defineProperty(t,"clearMediaForChat",{enumerable:!0,get:function(){return h.default}}),Object.defineProperty(t,"downloadMsg",{enumerable:!0,get:function(){return _.default}}),Object.defineProperty(t,"downloadProgressiveJpegThumbnail",{enumerable:!0,get:function(){return g.default}}),Object.defineProperty(t,"downloadStatusV3Thumbnail",{enumerable:!0,get:function(){return m.default}}),Object.defineProperty(t,"downloadVideoThumbnail",{enumerable:!0,get:function(){return y.default}}),Object.defineProperty(t,"forwardMediaMsg",{enumerable:!0,get:function(){return E.default}}),Object.defineProperty(t,"manuallySetMedia",{enumerable:!0,get:function(){return S.default}}),Object.defineProperty(t,"prepRawMedia",{enumerable:!0,get:function(){return v.default}}),Object.defineProperty(t,"resumeUploadMsg",{enumerable:!0,get:function(){return T.default}});var a=n(74025);Object.keys(a).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===a[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}}))}));var o=n(39287);Object.keys(o).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===o[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}}))}));var s=n(79019);Object.keys(s).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===s[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}}))}));var l=n(96575);Object.keys(l).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===l[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return l[e]}}))}));var c=n(85046);Object.keys(c).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===c[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return c[e]}}))}));var d=n(4007);Object.keys(d).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===d[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return d[e]}}))}));var u=n(48086);Object.keys(u).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===u[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return u[e]}}))}));var p=r(n(94995)),f=r(n(16389)),h=r(n(48714)),_=r(n(93628)),g=r(n(42454)),m=r(n(65403)),y=r(n(11679)),E=r(n(37461)),S=r(n(79373)),v=r(n(40674)),T=r(n(23127))},21921:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.checkAndRepair=function(e,t){const n=new i.default.WebcMediaAnalyzed;let r=!1;return function(e){let t;return new Promise(((n,r)=>{__LOG__(2)`MediaAnalyzer:sendMessageToWorker`,t=o||new a.default,o=void 0,t.onmessage=e=>{try{e.data&&"log"===e.data.type?__LOG__(2)`(via Milan) ${e.data.msg}`:n(e.data)}catch(e){r(e)}},t.onerror=e=>{r(new Error(`Milan.onerror = ${(null==e?void 0:e.message)?e.message:e}`))},t.postMessage(e)})).finally((()=>{t&&(t.terminate(),o=new a.default)}))}({type:"prep",file:e,asGif:t}).then((e=>{let{type:t,result:n,error:i,filename:a,file:o}=e;switch(t){case"result":return __LOG__(2)`MediaAnalyzer:checkAndRepair approved file`,r=!!n,n;case"parsingError":return __LOG__(2)`trouble parsing file ${o} (fossil ${a}) ${String(i)}`,o&&(__LOG__(4,void 0,new Error,!0)`MediaAnalyzer:checkAndRepair got parsing error! ${String(i)}`,SEND_LOGS("media-parsing-error")),void __LOG__(2)`MediaAnalyzer:checkAndRepair rejected file (${String(i)})`}})).catch((e=>{__LOG__(4,void 0,new Error,!0)`MediaAnalyzer:checkAndRepair got error! ${String(e)}`,SEND_LOGS("media-detection-error")})).finally((()=>{if(n){let t;if(e.name){const n=e.name.split(".");n.length>1&&(t=n[n.length-1])}n.set({webcMediaSupported:r,webcMediaExtensions:t}),n.markWebcMediaAnalyzeT(),n.commit()}}))};var i=r(n(11339)),a=r(n(91528));let o},74025:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.cancelDownloadMedia=i,t.cancelDownloadMsg=function(e){e.mediaObject?i(e.mediaObject):e.mediaObject||(__LOG__(4,void 0,new Error,!0)`id: ${e.id.toString()} type: ${e.type}`,SEND_LOGS("media-fault: cancelDownloadMsg msg without mediaObject"))};var r=n(9329);function i(e){(0,r.cancelDownloadMedia)(e)}},39287:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.cancelUploadMedia=i,t.cancelUploadMsg=function(e){e.mediaObject?i(e.mediaObject):(__LOG__(4,void 0,new Error,!0)`id: ${e.id.toString()} type: ${e.type}`,SEND_LOGS("media-fault: cancelUploadMsg msg without mediaObject"))};var r=n(70996);function i(e){(0,r.cancelUploadMedia)(e)}},16389:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return s.apply(this,arguments)};var i=r(n(48926)),a=n(61596),o=n(9329);function s(){return(s=(0,i.default)((function*(e){if(yield e.waitForPhoneUpload(),!e.mediaObject)return __LOG__(4,void 0,new Error,!0)`checkExistence msg without mediaObject, id: ${e.id.toString()} type: ${e.type}`,void SEND_LOGS("media-fault: checkExistence msg without mediaObject");yield(0,o.checkExistence)({mimetype:e.mimetype,mediaObject:e.mediaObject,mediaType:(0,a.getMsgMediaType)(e)})}))).apply(this,arguments)}},48714:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){r.clearMediaForChat(e)};var r=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=i(t);if(n&&n.has(e))return n.get(e);var r={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=a?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(r,o,s):r[o]=e[o]}r.default=e,n&&n.set(e,r);return r}(n(88297));function i(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(i=function(e){return e?n:t})(e)}},60953:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.consolidateMediaUpdate=function(e,t){if(e.isUnsentPhoneMsg()){e.mediaObject&&(__LOG__(4,void 0,new Error,!0)`id: ${e.id.toString()} type: ${e.type}`,SEND_LOGS("media-fault: consolidateMediaUpdate unsent message"));const t=h(e);if(t.hasOwnProperty("preview")){const n=t.preview;delete t.preview,n&&p.default.createFromBase64Jpeg(n).then((t=>{(null==e?void 0:e.mediaData)&&e.isUnsentPhoneMsg()&&(e.mediaData.preview=t)}))}e.mediaData.set((0,i.default)((0,i.default)({},t),{},{mediaStage:e.phoneUploading?c.MEDIA_DATA_STAGE.REMOTE_UPLOADING:c.MEDIA_DATA_STAGE.REMOTE_NEED_UPLOAD}))}else _(e,e,t)},t.consolidateMediaUpdateWithValues=_;var i=r(n(81109)),a=n(15461),o=r(n(64328)),s=n(21009),l=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=f(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(88297)),c=n(58668),d=n(61596),u=n(9329),p=r(n(34949));function f(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(f=function(e){return e?n:t})(e)}function h(e){const t={};return c.MAPPED_MSG_PROPS.forEach((n=>{const r=e[n],i=c.MSG_TO_MEDIA[n];t[i]=r})),t.type===a.MSG_TYPE.INTERACTIVE&&(t.type=(0,s.getInteractiveMsgMediaType)(e)),t}function _(e,t,n){const r=h(t);let i=e.mediaObject;const a=t.filehash;if(i)a&&a!==i.filehash&&(__LOG__(2)`media:msg ${e.id.toString()} ${i.filehash?"changed":"added"} filehash`,l.disassociateMediaFromMsg(i,e),i=l.getOrCreateMediaObject(a),e.mediaObject=i,l.associateMediaWithMsg(i,e));else{i=a?l.getOrCreateMediaObject(a):new s.MediaObject;const t=e.mediaData;void 0!==t.aspectRatio&&(r.aspectRatio=t.aspectRatio),e.mediaObject=i,l.associateMediaWithMsg(i,e)}let p=!1;const{deprecatedMms3Url:f,mediaKey:_,mediaKeyTimestamp:g,encFilehash:m,type:y,streamingSidecar:E,firstFrameSidecar:S,directPath:v,scansSidecar:T,scanLengths:b,staticUrl:C}=t;if(f||m){let e,n;try{e=(0,d.msgToMediaType)(t)}catch(t){e=~d.MEDIA_TYPE_VALUES.indexOf(y)?y:null}p=!i.entries.has({encFilehash:m,deprecatedMms3Url:f}),p?_&&e&&m?n=i.entries.addEntry({deprecatedMms3Url:f,mediaKey:_,mediaKeyTimestamp:g,encFilehash:m,type:e,sidecar:E,directPath:v,firstFrameSidecar:S,scansSidecar:T,scanLengths:b,debugHint:"consolidate",staticUrl:C}):p=!1:_&&(n=i.entries.updateEntry({deprecatedMms3Url:f,mediaKey:_,mediaKeyTimestamp:g,encFilehash:m,type:e,sidecar:E,directPath:v,firstFrameSidecar:S,scansSidecar:T,scanLengths:b,staticUrl:C})),n||(p=!1),p&&i.downloadStage===c.DOWNLOAD_STAGE.ERROR_MISSING&&(r.downloadStage=c.DOWNLOAD_STAGE.INIT)}if(i.consolidate(r)||i.notifyMsgsAsync(),p&&i.downloadStage===c.DOWNLOAD_STAGE.NEED_POKE){let r;try{r=(0,d.getMsgMediaType)(e)}catch(n){if(!t.type)throw n;r=(0,d.msgToMediaType)({type:t.type,isGif:e.isGif})}(0,u.downloadMedia)({mimetype:t.mimetype,mediaObject:i,downloadEvenIfExpensive:!1,mediaType:r,rmrReason:n,downloadOrigin:(0,o.default)(e)})}}},93628:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{msg:t,isUserClick:n,mode:r,downloadEvenIfExpensive:l,rmrReason:c,rmrData:d,isAutoDownload:u}=e,{mediaObject:p}=t;if(p){return p.getPendingProcess("fromDisk").then((0,i.default)((function*(){n&&p.userDownloadAttemptCount++,yield(0,s.downloadMedia)({mimetype:t.mimetype,mediaObject:p,downloadEvenIfExpensive:l,mediaType:(0,o.getMsgMediaType)(t),rmrReason:c,rmrData:d,downloadOrigin:(0,a.default)(t),isVcardOverMmsDocument:t.isVcardOverMmsDocument,mode:r,isAutoDownload:u,isViewOnce:Boolean(t.isViewOnce)}),p.userDownloadAttemptCount=0})))}return __LOG__(4,void 0,new Error,!0)`id: ${t.id.toString()} type: ${t.type}`,SEND_LOGS("media-fault: downloadMsg msg without mediaObject"),Promise.resolve()};var i=r(n(48926)),a=r(n(64328)),o=n(61596),s=(r(n(11339)),n(9329))},42454:(e,t,n)=>{"use strict";var r=n(59182).default,i=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return p.apply(this,arguments)};var a=i(n(48926)),o=n(89385),s=i(n(45095)),l=i(n(34475)),c=n(26384),d=n(61596),u=i(n(34949));function p(){return(p=(0,a.default)((function*(e){const{msg:t,isPreload:n,signal:i}=e;__LOG__(2)`media.downloadProgressiveJpegThumbnail: start`;try{const e=(0,s.default)(t.scanLengths,"msg.scanLengths"),a=(0,s.default)(t.scansSidecar,"msg.scansSidecar"),o=(0,s.default)(t.mediaObject,"msg.mediaObject"),l=(0,s.default)(o.filehash,"mediaObject.filehash"),{encFilehash:p,directPath:f}=t,h=yield c.downloadManager.downloadAndDecrypt({directPath:f,encFilehash:p,filehash:l,mediaKey:t.mediaKey,mediaKeyTimestamp:t.mediaKeyTimestamp,type:d.MEDIA_TYPES.IMAGE,signal:i||(new r).signal,userDownloadAttemptCount:0,progressiveJpegOpts:{mimetype:"image/jpeg",scansSidecar:a,scanLengths:e,scanCount:1},isPreload:n});o.consolidate({fullPreviewData:yield u.default.createFromData(h,"image/jpeg")}),__LOG__(2)`media.downloadProgressiveJpegThumbnail: success`}catch(e){if(e.name===o.ABORT_ERROR)return void __LOG__(2)`media.downloadProgressiveJpegThumbnail aborted`;__LOG__(3,void 0,void 0,!0)`media.downloadProgressiveJpegThumbnail: error\n${(0,l.default)(e)}`,SEND_LOGS("download-pjpeg-thumbnail-failed")}}))).apply(this,arguments)}},65403:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return l.apply(this,arguments)};var i=r(n(48926)),a=n(15461),o=r(n(61516)),s=r(n(42454));function l(){return(l=(0,i.default)((function*(e){const{msg:t,isPreload:n,signal:r}=e,{encFilehash:i,thumbnailSha256:l,thumbnailEncSha256:c,thumbnailDirectPath:d}=t;t.type===a.MSG_TYPE.IMAGE&&t.scanLengths&&t.scansSidecar&&i?yield(0,s.default)({msg:t,signal:r,isPreload:n}):l&&c&&d&&(yield(0,o.default)({msg:t,signal:r,isPreload:n}))}))).apply(this,arguments)}},11679:(e,t,n)=>{"use strict";var r=n(59182).default,i=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return _.apply(this,arguments)};var a=i(n(48926)),o=i(n(45095)),s=i(n(64369)),l=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=h(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(51428)),c=i(n(34475)),d=i(n(76139)),u=n(26384),p=n(61596),f=i(n(34949));function h(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(h=function(e){return e?n:t})(e)}function _(){return(_=(0,a.default)((function*(e){const{msg:t}=e,{encFilehash:n,filehash:i,directPath:a}=t;if(!n||!i||!a)return;const{fullPreviewData:h,fullWidth:_,fullHeight:g}=t.mediaData;if(!h||null==_||null==g){__LOG__(2)`media.downloadVideoThumbnail: start`;try{const e=Math.max(parseInt(t.mediaData.duration,10),1),c={video:{size:t.mediaData.size,duration:e},secondsToDownload:1},h=yield u.downloadManager.downloadAndDecrypt({directPath:a,encFilehash:n,filehash:i,mediaKey:t.mediaKey,mediaKeyTimestamp:t.mediaKeyTimestamp,type:p.MEDIA_TYPES.VIDEO,signal:(new r).signal,userDownloadAttemptCount:0,partialVideoOpts:c,isPreload:!0}),_=new Blob([h],{type:"video/mp4"}),{thumbs:[g]}=yield l.generateVideoThumbsAndDuration({file:_,maxDimensions:[s.default.VIDEO_THUMB_MAX_EDGE],debugHint:"downloadVideoThumbnail",throwOnBlack:!0}),m=yield f.default.createFromBase64Jpeg(d.default.parseDataURL(g.url).data),y=(0,o.default)(t.mediaObject,"mediaObject cannot be null for thumbnail download"),E={fullPreviewData:m,fullWidth:g.fullWidth,fullHeight:g.fullHeight};y.consolidate(E),__LOG__(2)`media.downloadVideoThumbnail: success`}catch(e){if(e instanceof l.BlackVideoThumbnailError)return void __LOG__(2)`media.downloadVideoThumbnail: black thumbnail was generated, fallback to blurred thumbnail`;__LOG__(3,!0)`media.downloadVideoThumbnail: error\n${(0,c.default)(e)}`}}}))).apply(this,arguments)}},37461:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return d.apply(this,arguments)};var i=r(n(81109)),a=r(n(48926)),o=r(n(94995)),s=n(58668),l=r(n(11339)),c=r(n(34949));function d(){return(d=(0,a.default)((function*(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];__LOG__(2)`Prepping media msg`;const a=e.mediaObject;if(!a)return __LOG__(4,void 0,new Error,!0)`id: ${e.id.toString()} type: ${e.type}`,SEND_LOGS("media-fault: forwardMediaMsg msg without mediaObject"),Promise.reject(new Error("non initialized media"));const d=e.mediaData.toJSON();null!=d.preview&&(d.preview=a.contentInfo._preview),d.mediaBlob instanceof c.default&&d.mediaBlob.retain();const u={mimetype:d.mimetype},p=d.isGif?(0,i.default)((0,i.default)({},u),{},{isGif:!0}):u;d.type===s.OUTWARD_TYPES.PTT&&(d.type=s.OUTWARD_TYPES.AUDIO);const f={businessOwnerJid:e.businessOwnerJid,productId:e.productId,currencyCode:e.currencyCode,priceAmount1000:e.priceAmount1000,salePriceAmount1000:e.salePriceAmount1000,retailerId:e.retailerId,url:e.url,productImageCount:e.productImageCount,title:e.title,description:e.description},h=yield new o.default(d.type,Promise.resolve(d)).sendToChat(t,{forwardedFromWeb:!0,caption:d.type===s.OUTWARD_TYPES.DOCUMENT||d.type===s.OUTWARD_TYPES.PRODUCT?e.caption:void 0,footer:d.type===s.OUTWARD_TYPES.PRODUCT?e.footer:void 0,addEvenWhilePreparing:!0,placeholderProps:p,isForwarded:e.isForwarded||!e.isSentByMe,forwardingScore:e.getForwardingScoreWhenForwarded(),multicast:r,productMsgOptions:f});if(d.type===s.OUTWARD_TYPES.STICKER){var _,g,m;new l.default.StickerSend({stickerSendOrigin:l.default.STICKER_SEND_ORIGIN_TYPE.FORWARD,stickerIsAnimated:Boolean(null===(_=e.mediaData)||void 0===_?void 0:_.isAnimated),stickerIsFirstParty:Boolean(null===(g=e.mediaData)||void 0===g?void 0:g.isFirstParty),stickerIsFromStickerMaker:Boolean(null===(m=e.mediaData)||void 0===m?void 0:m.isFromStickerMaker)}).commit();n(49264).RecentStickerCollectionMd.addStickerWithMediaData(d,e.id.id)}return h}))).apply(this,arguments)}},64328:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return e.asProduct?i.default.DOWNLOAD_ORIGIN_TYPE.PRODUCT_CATALOG:e.isStatusV3?i.default.DOWNLOAD_ORIGIN_TYPE.STATUS_USER:e.isGroupMsg?i.default.DOWNLOAD_ORIGIN_TYPE.CHAT_GROUP:i.default.DOWNLOAD_ORIGIN_TYPE.CHAT_PERSONAL};var i=r(n(11339))},79373:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let{msg:t,media:n,rmrReason:r}=e;const l=t.mediaObject;if(!l)return;s.default.createFromData(n,t.mimetype).then((e=>{(0,o.manuallySetMedia)({mimetype:t.mimetype,mediaObject:l,mediaBlob:e,mediaType:(0,a.getMsgMediaType)(t),rmrReason:r,downloadOrigin:(0,i.default)(t)})}))};var i=r(n(64328)),a=n(61596),o=(r(n(11339)),n(9329)),s=r(n(34949))},79019:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mediaMetadata=function(e){const t=e.mediaObject;if(!t)throw __LOG__(4,void 0,new Error,!0)`id: ${e.id.toString()} type: ${e.type}`,SEND_LOGS("media-fault: mediaMetadata msg without mediaObject"),new Error("msg.mediaMetadata with no mediaObject");const n=t.entries.getEntryByEncFilehash({encFilehash:e.encFilehash,deprecatedMms3Url:e.deprecatedMms3Url});if(!n)throw __LOG__(4,void 0,new Error,!0)`id: ${e.id.toString()} type: ${e.type}`,SEND_LOGS("media-fault: mediaMetadata no entry"),new Error("msg.mediaMetadata with entry mismatch");const r=e.mediaData;return{url:n.deprecatedMms3Url,directPath:n.directPath,encFilehash:n.encFilehash,mediaKey:n.mediaKey,mediaKeyTimestamp:n.mediaKeyTimestamp,filehash:e.filehash,type:r.type,mimetype:r.mimetype,filename:r.filename,duration:r.duration,width:r.fullWidth,height:r.fullHeight,firstFrameLength:r.firstFrameLength,isAnimated:r.isAnimated,thumbnailDirectPath:e.thumbnailDirectPath,thumbnailSha256:e.thumbnailSha256,thumbnailEncSha256:e.thumbnailEncSha256,thumbnailHeight:e.thumbnailHeight,thumbnailWidth:e.thumbnailWidth,waveform:e.waveform,staticUrl:e.staticUrl}}},96575:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.deregisterMsg=function(e){e.off(null,p);const t=e.mediaObject;t&&a.disassociateMediaFromMsg(t,e)},t.prepareMsg=function(e){const t=e.mediaObject;if(t)return t.resolveWhenConsolidated();const n=e.mediaData,r=n.preview;if(r instanceof c.default&&void 0===n.aspectRatio&&(void 0===n.fullWidth||void 0===n.fullHeight))return(0,s.getImageWidthHeight)(r).then((t=>{let{width:n,height:r}=t;e.mediaObject||e.mediaData.set({aspectRatio:n/r})}));return Promise.resolve()},t.registerMsg=function(e){e.mimetype||e.type!==o.OUTWARD_TYPES.IMAGE||(e.mimetype="image/jpeg");e.mimetype||e.type!==o.OUTWARD_TYPES.STICKER||(e.mimetype="image/webp");e.on(u,p),(0,i.consolidateMediaUpdate)(e,l.default.WEBC_RMR_REASON_CODE.MSG_INIT)},t.registerMsgEarly=function(e,t){e.isUnsentPhoneMsg()&&(__LOG__(4,void 0,new Error,!0)`id: ${e.id.toString()} type: ${e.type}`,SEND_LOGS("media-fault: registerMsgEarly msg without mediaObject"));const n={};for(let r=0;r<o.MEDIA_MSG_PROPS.length;r++){const i=o.MEDIA_MSG_PROPS[r],a=t[i];n[i]=void 0!==a?a:e[i]}n.mimetype||n.type!==o.OUTWARD_TYPES.IMAGE||(t.mimetype=n.mimetype="image/jpeg");e.on(u,p),(0,i.consolidateMediaUpdateWithValues)(e,n,l.default.WEBC_RMR_REASON_CODE.MSG_UPDATE);const r={};for(let e=0;e<o.MSG_SPECIFIC_FIELDS.length;e++){const t=o.MSG_SPECIFIC_FIELDS[e];r[t]=n[o.MEDIA_TO_MSG[t]]}e.mediaData.set(r)};var i=n(60953),a=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=d(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(88297)),o=n(58668),s=n(56406),l=r(n(11339)),c=r(n(34949));function d(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(d=function(e){return e?n:t})(e)}const u=`change:phoneUploading change:ack ${o.MEDIA_MSG_PROPS.map((e=>`change:${e}`)).join(" ")}`;function p(e){(0,i.consolidateMediaUpdate)(e,l.default.WEBC_RMR_REASON_CODE.MSG_UPDATE)}},40674:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){let n;__LOG__(2)`Prepping raw media`,n=t.isPtt?a.OUTWARD_TYPES.PTT:t.asDocument?a.OUTWARD_TYPES.DOCUMENT:t.asGif?a.OUTWARD_TYPES.VIDEO:t.isAudio?a.OUTWARD_TYPES.AUDIO:t.asSticker?a.OUTWARD_TYPES.STICKER:a.OUTWARD_TYPES.UNKNOWN;const r=Promise.resolve(e).then((e=>(e.autoreleaseWhenPromiseCompletes(r),(0,o.default)(e,t))));return new i.default(n,r)};var i=r(n(94995)),a=n(58668),o=r(n(27989))},85046:(e,t,n)=>{"use strict";var r=n(59182).default,i=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.uploadProductImage=function(){return d.apply(this,arguments)};var a=i(n(48926)),o=n(65885),s=n(61596),l=i(n(11339)),c=i(n(54824));function d(){return(d=(0,a.default)((function*(e,t){const n=yield(0,o.blobToArrayBuffer)(e.forceToBlob()).then((e=>c.default.unencryptedUpload({file:e,hash:t,signal:(new r).signal,type:s.MEDIA_TYPES.PRODUCT_CATALOG_IMAGE,uploadOrigin:l.default.UPLOAD_ORIGIN_TYPE.PRODUCT_CATALOG,isViewOnce:!1})));return new URL(n.directPath,"https://mmg.whatsapp.net").toString()}))).apply(this,arguments)}},23127:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t;const{mediaObject:n}=e;if(!n)return __LOG__(4,void 0,new Error,!0)`id: ${e.id.toString()} type: ${e.type}`,SEND_LOGS("media-fault: resumeUploadMsg msg without mediaObject"),Promise.resolve();n.userUploadAttemptCount++;const{filehash:r}=n,p=(0,s.shouldUseMediaKeyCache)()&&null!=r&&null!==(t=s.MediaKeyCache.get(r))&&void 0!==t?t:void 0;e.ack=a.ACK.CLOCK;const f=(0,c.uploadMedia)({mimetype:e.mimetype,mediaObject:n,mediaKeyInfo:p,mediaType:(0,l.getMsgMediaType)(e),forwardedFromWeb:Boolean(e.forwardedFromWeb),uploadOrigin:(0,o.default)(e.chat),isViewOnce:Boolean(e.isViewOnce)}).then(function(){var t=(0,i.default)((function*(t){let{mediaEntry:i}=t;if((0,s.shouldUseMediaKeyCache)()&&null!=r&&s.MediaKeyCache.delete(r),!i)throw new Error("upload failed: media entry was not created");n.userUploadAttemptCount=0;const a={deprecatedMms3Url:i.deprecatedMms3Url,directPath:i.directPath,mediaKey:i.mediaKey,mediaKeyTimestamp:i.mediaKeyTimestamp,filehash:n.filehash,encFilehash:i.encFilehash,size:n.size,streamingSidecar:i.sidecar,firstFrameSidecar:i.firstFrameSidecar};return yield(0,u.default)(e,a),e}));return function(){return t.apply(this,arguments)}}());return(0,d.resendMsgToChat)(e.chat,f).catch((()=>{e.ack=a.ACK.FAILED}))};var i=r(n(48926)),a=n(35470),o=r(n(46220)),s=n(45554),l=n(61596),c=n(70996),d=n(75887),u=(n(13705),r(n(2603)))},4007:(e,t,n)=>{"use strict";var r=n(59182).default,i=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.deregisterSticker=function(e){const{mediaObject:t}=e;t&&c.disassociateMediaFromSticker(t,e)},t.deregisterStickerPackIcon=function(e){const{mediaObject:t}=e;t&&c.disassociateMediaFromStickerPack(t,e)},t.downloadStickerOrStickerPackIcon=function(){return m.apply(this,arguments)},t.prepSticker=function(e){__LOG__(2)`Prepping sticker`;const t=e.mediaObject,n=e.mediaData.toJSON();if(n.fullWidth=125,n.fullHeight=125,!t)return __LOG__(4,void 0,new Error,!0)`id: ${e.id}`,SEND_LOGS("media-fault: prepSticker sticker without mediaObject"),new l.default(n.type,Promise.reject(new Error("non initialized media")));return new l.default(n.type,Promise.resolve(n))},t.registerSticker=function(e){g(e,e.mediaObject||function(e){if(!e.filehash)return __LOG__(4,void 0,new Error,!0)`Unexpected sticker with no filehash`,void SEND_LOGS("sticker-filehash-error");const t=c.getOrCreateMediaObject(e.filehash);return c.associateMediaWithSticker(t,e),t}(e),u.MEDIA_TYPES.STICKER)},t.registerStickerPackIcon=function(e){g(e,e.mediaObject||function(e){if(!e.filehash)return __LOG__(4,void 0,new Error,!0)`Unexpected sticker pack with no filehash`,void SEND_LOGS("sticker-pack-filehash-error");const t=c.getOrCreateMediaObject(e.filehash);return c.associateMediaWithStickerPack(t,e),t}(e),u.MEDIA_TYPES.IMAGE)};var a=i(n(48926)),o=n(88555),s=n(26384),l=i(n(94995)),c=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=_(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(88297)),d=n(58668),u=n(61596),p=i(n(11339)),f=n(9329),h=n(64551);function _(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(_=function(e){return e?n:t})(e)}function g(e,t,n){const r=function(e){const t={};return d.MAPPED_STICKER_PROPS.forEach((n=>{const r=e[n],i=d.MSG_TO_MEDIA[n];t[i]=r})),t}(e);if(e.mediaData.set(r),!t)return;e.mediaObject=t;const{deprecatedMms3Url:i,encFilehash:a}=e;if((a||i)&&!t.entries.has({encFilehash:a,deprecatedMms3Url:i})){t.entries.addEntry({deprecatedMms3Url:i,mediaKey:e.mediaKey,mediaKeyTimestamp:e.mediaKeyTimestamp,encFilehash:a,type:n,directPath:e.directPath,debugHint:"setMediaObjectValues"})&&t.downloadStage===d.DOWNLOAD_STAGE.ERROR_MISSING&&(r.downloadStage=d.DOWNLOAD_STAGE.INIT)}t.consolidate(r)}function m(){return(m=(0,a.default)((function*(e,t){if(e.isPlaceholder||e.isCreateButton)return e.mediaData.mediaStage=d.MEDIA_DATA_STAGE.PREPARING,Promise.resolve();const i=e.mediaObject;if(!i)return Promise.reject(new Error("media-fault: downloadStickerOrStickerPackIcon sticker/stickerPack without mediaObject"));if(i.downloadStage===d.DOWNLOAD_STAGE.RESOLVED)return Promise.resolve();const a="STICKER"===t?p.default.WEBC_RMR_REASON_CODE.STICKER_PANEL_STICKER:p.default.WEBC_RMR_REASON_CODE.STICKER_PANEL_ICON;let l=!1;yield i.getPendingProcess("fromDisk").then((()=>{if((0,o.isLegacyWebdBackend)()&&!e.deprecatedMms3Url||!e.filehash||!e.mediaKey||!e.encFilehash)return l=!0,s.downloadManager.rmr({mediaObject:i,signal:(new r).signal,rmrReason:a})})).then((()=>(0,f.downloadMedia)({mimetype:e.mimetype,mediaObject:e.mediaObject,downloadEvenIfExpensive:!0,mediaType:(0,u.msgToMediaType)({type:e.type,isGif:!1}),rmrReason:a,downloadOrigin:p.default.DOWNLOAD_ORIGIN_TYPE.STICKER_PICKER,shouldThrow:!0}))),(0,o.isMDBackend)()&&l&&h.ServerProps.webServerStickerPanel&&n(49264).RecentStickerCollectionMd.updateStickerMediaData(e.filehash,i.entries.getDownloadEntry())}))).apply(this,arguments)}},48086:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.videoStreamingInfo=function(e){const t=e.mediaObject;return t?t.videoStreamingInfo(e.id.toString()):null};n(21009)},2320:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(81109)),a=n(11290),o=n(99140),s=n(84866),l=n(58668);class c extends a.BaseModel{constructor(){super(...arguments),this.type=(0,a.prop)(l.OUTWARD_TYPES.UNKNOWN),this.directPath=(0,a.prop)(),this.mediaKey=(0,a.prop)(),this.mediaKeyTimestamp=(0,a.prop)(),this.encFilehash=(0,a.prop)(),this.mediaStage=(0,a.prop)(l.MEDIA_DATA_STAGE.INIT),this.size=(0,a.prop)(),this.loadedSize=(0,a.prop)(),this.filehash=(0,a.prop)(),this.mimetype=(0,a.prop)(),this.mediaBlob=(0,a.prop)(),this.renderableUrl=(0,a.prop)(),this.fullHeight=(0,a.prop)(),this.fullWidth=(0,a.prop)(),this.aspectRatio=(0,a.prop)(),this.rgbaBuffer=(0,a.prop)(),this.rgbaHeight=(0,a.prop)(),this.rgbaWidth=(0,a.prop)(),this.animationDuration=(0,a.prop)(0),this.animatedAsNewMsg=(0,a.prop)(!1),this.isAnimated=(0,a.prop)(),this.isFirstParty=(0,a.prop)(),this.isFromStickerMaker=(0,a.prop)(),this.stickerPackId=(0,a.prop)(),this.stickerPackName=(0,a.prop)(),this.stickerPackPublisher=(0,a.prop)(),this.singleLoopDuration=(0,a.prop)(),this.firstFrameLength=(0,a.prop)(),this.firstFrameSidecar=(0,a.prop)(),this.emojis=(0,a.prop)(),this.progressiveStage=(0,a.prop)(),this.isViewOnce=(0,a.prop)(!1),this.staticUrl=(0,a.prop)(),this.preview=(0,a.prop)(),this.sidecar=(0,a.prop)(),this.duration=(0,a.prop)(),this.durationFloat=(0,a.prop)(),this.isGif=(0,a.prop)(),this.gifAttribution=(0,a.prop)(),this.streamable=(0,a.derived)((function(){return this.isStreamable()}),["isGif","isViewOnce","mediaStage","sidecar","type","_swStreamingSupported"]),this._swStreamingSupported=(0,a.prop)(!1),this._listeningToSwSupport=(0,a.prop)(!1),this.filename=(0,a.prop)(),this.pageCount=(0,a.prop)(),this.documentPreview=(0,a.prop)(),this.isVcardOverMmsDocument=(0,a.prop)(!1),this.parsedVcards=(0,a.prop)(),this.fullPreviewSize=(0,a.prop)(),this.fullPreviewData=(0,a.prop)(),this.subtype=(0,a.prop)(),this.waveform=(0,a.prop)()}initialize(){super.initialize()}set(e,t,n){let r,a=n;return"string"==typeof e?r={[e]:t}:(r=e,a=t),r=function(e){if(e.filename&&e.type===d.TYPE.DOCUMENT){const t=(0,o.cleanFilename)(e.filename);return(0,i.default)((0,i.default)({},e),{},{filename:t,caption:t})}return e}(r),super.set(r,a)}isStreamable(){return this.isStreamableType()&&this.listenToServiceWorkerSupport()&&!this.isViewOnce}_updateStreamingSupported(e){this._swStreamingSupported=e}listenToServiceWorkerSupport(){if(this._listeningToSwSupport)return this._swStreamingSupported;{const e=n(92658).default;this.listenTo(e,"change:streamingSupported",this._updateStreamingSupported),this._swStreamingSupported=Boolean(e.streamingSupported)}return this._listeningToSwSupport=!0,this._swStreamingSupported}isStreamableType(){let e=!1;return e=this.type===l.OUTWARD_TYPES.VIDEO&&!this.isGif&&(this.mediaStage===l.MEDIA_DATA_STAGE.INIT||this.mediaStage===l.MEDIA_DATA_STAGE.FETCHING||this.mediaStage===l.MEDIA_DATA_STAGE.DECRYPTING||this.mediaStage===l.MEDIA_DATA_STAGE.RESOLVED)&&null!=this.fullWidth&&null!=this.fullHeight&&Boolean(this.sidecar&&this.sidecar.byteLength>0),e}isDownloadable(){return!this.isViewOnce&&(null!=this.renderableUrl||s.MediaBlobCache.has(this.filehash)||this.mediaStage===l.MEDIA_DATA_STAGE.EXISTS||this.mediaStage===l.MEDIA_DATA_STAGE.PROGRESSIVE_READY)}}c.Proxy="mediaData";const d=(0,a.defineModel)(c);d.TYPE=l.OUTWARD_TYPES;var u=d;t.default=u},80923:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.MediaEntryList=t.MediaEntry=void 0;var i=r(n(48926)),a=n(20177),o=n(61070),s=n(92844),l=r(n(21081)),c=n(46640),d=r(n(22283)),u=r(n(87798));const p="PROBABLY_ON_SERVER",f="PROBABLY_OFF_SERVER",h="UNKNOWN";class _{constructor(e){this.useBackupUrl=!1,this._encFilehashPromise=null,this.deprecatedMms3Url=e.deprecatedMms3Url,this.mediaKey=e.mediaKey,this.mediaKeyTimestamp=e.mediaKeyTimestamp,this.encFilehash=e.encFilehash,this.serverStatus=h,this.sidecar=e.sidecar,this.directPath=e.directPath,this.firstFrameSidecar=e.firstFrameSidecar,this.type=e.type,this.scansSidecar=e.scansSidecar,this.scanLengths=e.scanLengths,this.staticUrl=e.staticUrl}url(e){var t=this;return(0,i.default)((function*(){const{useFallback:n,forceHashUrl:r}=e||{},{encFilehash:i}=t;if(!i)return Promise.reject(new Error("media_entry: encFilehash does not exist"));const{selectedHost:a,fallbackHost:o}=yield c.mediaHosts.getHostsInfo({operation:d.default.DOWNLOAD,encFilehash:i,type:t.type}),s=n&&o?o:a;return(0,l.default)({directPath:r?null:t.directPath,encFilehash:i,hostname:s.hostname,type:t.type})}))()}canReuseMediaKey(){if(null==this.directPath)return!1;const e=(0,s.castToUnixTime)(this.mediaKeyTimestamp);return(0,o.isMediaKeyReusable)(e)}markWhetherOnServer(e){this.serverStatus=e?p:f}}t.MediaEntry=_;function g(e){e.entries.sort(((e,t)=>{const n=m(t)-m(e);return 0===n?t.mediaKeyTimestamp-e.mediaKeyTimestamp:n}))}function m(e){let t=0;switch(e.serverStatus){case p:t+=200;break;case f:break;case h:t+=100}return e.encFilehash?t+=20:e._encFilehashPromise&&(t+=10),t}t.MediaEntryList=class{constructor(){this.entries=[]}_updateEntry(e){let{foundEntry:t,mediaKey:n,mediaKeyTimestamp:r,encFilehash:i,sidecar:o,directPath:s,firstFrameSidecar:l,scansSidecar:c,scanLengths:d,deprecatedMms3Url:u,staticUrl:p}=e;if(n&&!(0,a.b64Equal)(t.mediaKey,n)){const e=t.mediaKey.replace("=","").split("\n")[0],r=n.replace("=","").split("\n")[0];return __LOG__(4,void 0,new Error,!0)`media-fault: mediaKey changed for the same MMS3 url. type:${t.type}. equal?:${e===r}. Debug:\n${JSON.stringify({before:{hasDirectPath:Boolean(t.directPath),hasEncFilehash:Boolean(t.encFilehash),hasMediaKey:Boolean(t.mediaKey),hasDeprecatedMms3Url:Boolean(t.deprecatedMms3Url)},after:{hasDirectPath:Boolean(s),hasEncFilehash:Boolean(i),hasDeprecatedMms3Url:Boolean(u)}},null,2)}`,SEND_LOGS("media-key-mismatch-same-mms3-url"),null}return null!=r&&(t.mediaKeyTimestamp=r),o&&(t.sidecar=o),l&&(t.firstFrameSidecar=l),c&&(t.scansSidecar=c),(null==d?void 0:d.length)&&(t.scanLengths=d),p&&(t.staticUrl=p),t.directPath=s,t}updateEntry(e){let{deprecatedMms3Url:t,mediaKey:n,mediaKeyTimestamp:r,encFilehash:i,type:a,sidecar:o,directPath:s,firstFrameSidecar:l,scansSidecar:c,scanLengths:d,staticUrl:u}=e;const p=this.getEntryByEncFilehash({encFilehash:i,deprecatedMms3Url:t});if(p)return this._updateEntry({foundEntry:p,mediaKey:n,mediaKeyTimestamp:r,encFilehash:i,sidecar:o,directPath:s,firstFrameSidecar:l,scansSidecar:c,scanLengths:d,deprecatedMms3Url:t,staticUrl:u})}addEntry(e){const{deprecatedMms3Url:t,mediaKey:n,mediaKeyTimestamp:r,encFilehash:i,type:a,sidecar:o,directPath:s,firstFrameSidecar:l,scansSidecar:c,scanLengths:d,staticUrl:u,debugHint:p}=e;null==i&&(__LOG__(4,void 0,new Error,!0)`Media type ${a} from ${p} is missing encFilehash`,SEND_LOGS(`media-entry-missing-upload-hash-${a}-${p}`));const f=this.entries,h=this.getEntryByEncFilehash({encFilehash:i,deprecatedMms3Url:t}),g=h?this._updateEntry({foundEntry:h,mediaKey:n,mediaKeyTimestamp:r,encFilehash:i,sidecar:o,directPath:s,firstFrameSidecar:l,scansSidecar:c,scanLengths:d,deprecatedMms3Url:t,staticUrl:u}):null;if(g)return g;if(!n)return null;const m=new _({deprecatedMms3Url:t,mediaKey:n,mediaKeyTimestamp:r,encFilehash:i,type:a,sidecar:o,directPath:s,firstFrameSidecar:l,scansSidecar:c,scanLengths:d,staticUrl:u});return f.push(m),m}_getKey(e){let{encFilehash:t,deprecatedMms3Url:n}=e;return null==t?`mms3:${n}`:t}has(e){return null!=this.getEntryByEncFilehash(e)}getEntryByEncFilehash(e){const t=this._getKey(e);return this.entries.find((e=>this._getKey(e)===t))}getUploadEntry(){return g(this),this.entries.find((e=>(0,u.default)(e.mediaKeyTimestamp)))||null}getDownloadEntry(){g(this);const e=this.entries[0];return e&&e.serverStatus!==f?e:null}}},50170:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(40265),i=n(35232);class a extends((0,r.customError)("MediaFileTooLarge",!0,i.MediaFileError)){constructor(e){super(`File (${e.type()}) size = ${e.size()}`),this.opaqueData=e}}t.default=a},16737:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.canPlayOgg=void 0,t.disposeVideo=v,t.getMediaTagErrorReason=y,t.image=function(e){return E(e).then((e=>{if(e&&e.naturalWidth>0)return{img:e,fullWidth:e.naturalWidth,fullHeight:e.naturalHeight};throw new l.MediaLoadError("image loaded with zero width")})).catch((()=>{throw new l.MediaLoadError("unable to render image")}))},t.loadImage=E,t.loadVideo=S,t.transcode=function(e,t){const n=t||e.type;if((0,f.isOpus)(n)&&!_){if(e.size<=3e5){return new d.default(e).generateBlob()}return Promise.reject(new l.TranscodeBlobTooLargeError)}return Promise.resolve(e)},t.videoWidthHeightDuration=function(e){return S(e).then((e=>{let{video:t,fullWidth:n,fullHeight:r,duration:i}=e;return v(t),{width:n,height:r,duration:i}}))};var i=n(40265),a=n(50796),o=n(13959),s=n(38284),l=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=h(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(35232)),c=n(26741),d=r(n(51631)),u=r(n(67707)),p=r(n(11339)),f=n(43257);function h(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(h=function(e){return e?n:t})(e)}const _=(new Audio).canPlayType("audio/ogg");t.canPlayOgg=_;let g=0,m=Promise.resolve();function y(e){if(!e||!e.error)return null;const t=e.error;let n=Object.keys(u.default).find((e=>u.default[e]===t.code));n=n||`UNKNOWN CODE ${t.code}`;const r=t.message&&~t.message.indexOf(":")?t.message.split(":")[0]:"";return r?`${n}: ${r}`:n}function E(e){let t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return new Promise((function(r,i){t=new Image;const a=/^(?:data|blob):/.test(e);n&&!a&&t.setAttribute("crossOrigin","anonymous"),t.onload=r,t.onabort=()=>{i(new Error("loadImage onabort"))},t.onerror=()=>{i(new l.InvalidImageFileType("Image tag load error"))},t.src=e})).then((()=>t))}function S(e){const t=m.then((()=>function(e){const t=new p.default.WebcMediaLoad;let n,r,d=null;const u=++g;function f(){n&&d&&(document.body&&document.body.removeChild(d),d=null)}let h=!0;const _=new Promise((function(t,i){__LOG__(2)`MediaLoad:video called (#${u})`;let a=!1,o=!1;n=document.createElement("video"),n.setAttribute("crossOrigin","anonymous"),n.volume=0,n.muted=!0,n.playsinline=!0;const s=()=>{o&&a&&t()};if(n.onloadedmetadata=()=>{__LOG__(2)`MediaLoad:video.onloadedmetadata #${u}. Video ready: ${o}. Video width: ${n.videoWidth}`,n.onloadedmetadata=null,a=!0,s()},n.oncanplaythrough=()=>{__LOG__(2)`MediaLoad:video.oncanplaythrough #${u}. Metadata loaded: ${a}. Video width: ${n.videoWidth}`,n.oncanplaythrough=null,n.onseeked=()=>{o=!0,n.onseeked=null,s()},n.currentTime=0},n.onerror=()=>{const t=n.error?n.error.message:"no error message";__LOG__(3)`MediaLoad:video.onerror #${u}: ${String(t)}\n Blob info -> size:${e.size}, type: ${e.type}`;const r=y(n);i(new l.UnableToPlayVideoError(r))},n.src=r=window.URL.createObjectURL(e),c.UA.isSafari){d=document.createElement("div");const e=d;e.style="opacity: 0.004",e.appendChild(n),document.body&&document.body.appendChild(e)}n.load(),n.currentTime=1})).finally((()=>{h=!1}));setTimeout((()=>{f(),h&&(__LOG__(3)`unable to load video #${u} (${e.size} bytes)`,new p.default.WebcMediaLoad({webcMediaLoadResult:p.default.WEBC_MEDIA_LOAD_RESULT_CODE.SILENCE}).commit())}),8e3);const m=(0,s.promiseTimeout)(_,2e4).then((()=>(0,o.delayMs)(10))).then((()=>{if(t.markWebcMediaLoadT(),__LOG__(2)`MediaLoad:video #${u} successful`,n.pause(),n.videoWidth>0)return t.webcMediaLoadResult=p.default.WEBC_MEDIA_LOAD_RESULT_CODE.SUCCESS,t.commit(),{video:n,fullWidth:n.videoWidth,fullHeight:n.videoHeight,duration:n.duration};throw n.duration>0?(__LOG__(3)`MediaLoad:video #${u} dimensions are not defined. Video readyState: ${n.readyState}. Video width: ${n.videoWidth}`,new l.MediaUnsupportedError("video loaded with duration but no dims")):(t.webcMediaLoadResult=p.default.WEBC_MEDIA_LOAD_RESULT_CODE.ZEROWIDTH,t.commit(),new l.MediaLoadError("video loaded with zero width"))})).catch((0,a.filteredCatch)(i.TimeoutError,(e=>{throw __LOG__(4,void 0,new Error,!0)`MediaLoad:video load error, currentTime=${n.currentTime}. duration=${n.duration}`,SEND_LOGS("video-load-timeout"),e}))).finally((()=>{f(),n&&(n.onloadedmetadata=null,n.onloadeddata=null,n.oncanplaythrough=null,n.ontimeupdate=null,n.onerror=null),r&&window.URL.revokeObjectURL(r)}));return m.catch((()=>{v(n)})),m}(e)));return m=(0,s.promiseTimeout)(t,1e3).then((()=>{}),(()=>{})),t}function v(e){try{e.pause(),e.src="",e.load()}catch(e){__LOG__(4,void 0,new Error,!0)`Error: ${String(e)}`,SEND_LOGS("dispose-video-error")}}},21009:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.MediaObject=void 0,t.consolidate=S,t.getInteractiveMsgMediaType=v,t.webMediaTypeToWamMediaType=function(e){switch(e){case"VIDEO":return 3;case"IMAGE":return 2;case"AUDIO":return 4;case"STICKER":return 16;case"DOCUMENT":return 8;case"PRODUCT":return 18;default:throw new Error(`web media type is invalid: ${e}`)}};var i=r(n(81109)),a=r(n(48926)),o=n(57319),s=n(35470),l=n(88555),c=n(15461),d=r(n(28011)),u=n(34535),p=n(80923),f=n(61596),h=n(58668),_=n(56406),g=(r(n(11339)),r(n(34949))),m=r(n(84159)),y=n(64551),E=n(22104);function S(e,t){const n=e.contentInfo;let r=!1;const i=function(e){switch(e){case h.OUTWARD_TYPES.IMAGE:case h.OUTWARD_TYPES.PRODUCT:return h.TYPE.IMAGE;case h.OUTWARD_TYPES.VIDEO:return h.TYPE.VIDEO;case h.OUTWARD_TYPES.STICKER:return h.TYPE.STICKER;case h.OUTWARD_TYPES.AUDIO:case h.OUTWARD_TYPES.PTT:return h.TYPE.AUDIO;case h.OUTWARD_TYPES.DOCUMENT:default:return}}(t.type,t.subtype);i&&!e.type&&(e.type=i,r=!0);const{downloadStage:a,uploadStage:o}=t;a&&a!==e.downloadStage&&(e.downloadStage=a,r=!0),o&&o!==e.uploadStage&&(e.uploadStage=o,r=!0),t.resolvedPreview&&!n.preview&&(t.resolvedPreview.retain(),n.preview=t.resolvedPreview,r=!0),void 0!==t.progressiveStage&&t.progressiveStage!==e.progressiveStage&&(e.progressiveStage=t.progressiveStage,r=!0);const s=t.mediaBlob;s&&!s.isBlobEqual(e.mediaBlob)&&(e.mediaBlob&&e.clearBlob(),s.retain(),e.mediaBlob=s,e.size=s.size(),r=!0),null!=t.size&&(null==e.size||t.size<e.size)&&(e.size=t.size,r=!0);const{loadedSize:l}=t;null!=l&&l!==e.loadedSize&&(e.loadedSize=l,r=!0),t.filehash&&!e.filehash&&(e.filehash=t.filehash,r=!0),t.parsedVcards&&t.parsedVcards!==e.parsedVcards&&(e.parsedVcards=t.parsedVcards,r=!0);const c=e.contentFields();for(let i=0;i<c.length;i++){const a=c[i];switch(a){case"preview":t.preview&&!n._preview&&(e.runProcessIfNotRunBefore("preview",A,t.preview),n._preview=t.preview,r=!0);break;case"fullWidth":case"fullHeight":case"aspectRatio":{const e=t[a];null!=e&&0!==e&&n[a]!==e&&(n[a]=e,r=!0);break}case"animationDuration":case"singleLoopDuration":{const e=t[a];null!=e&&e!==n[a]&&(n[a]=e,r=!0);break}default:const i=t[a];void 0!==i&&void 0===n[a]&&(n[a]=i,r=!0)}}return null!=n.aspectRatio&&0!==n.aspectRatio||(null!=n.fullWidth&&0!==n.fullWidth&&null!=n.fullHeight&&0!==n.fullHeight?(n.aspectRatio=n.fullWidth/n.fullHeight,r=!0):n.preview&&e.runProcessIfNotRunBefore("aspectRatio",M,n.preview)),r}function v(e){var t;if(null!=(null===(t=e.interactiveHeader)||void 0===t?void 0:t.mediaType))switch(e.interactiveHeader.mediaType){case u.InteractiveMessageHeaderMediaType.DOCUMENT:return h.OUTWARD_TYPES.DOCUMENT;case u.InteractiveMessageHeaderMediaType.VIDEO:return h.OUTWARD_TYPES.VIDEO;case u.InteractiveMessageHeaderMediaType.IMAGE:return h.OUTWARD_TYPES.IMAGE}}function T(e,t,n){for(let r=0;r<n.length;r++){const i=n[r];e[i]=t[i]}}function b(e,t){return t.filehash?e.id.fromMe&&e.ack<s.ACK.SENT?(e.local||(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("media-fault: unsent media system message not local")),function(e){switch(e.uploadStage){case h.UPLOAD_STAGE.INIT:case h.UPLOAD_STAGE.PREPARING:return h.MEDIA_DATA_STAGE.PREPARING;case h.UPLOAD_STAGE.UPLOADING:return h.MEDIA_DATA_STAGE.UPLOADING;case h.UPLOAD_STAGE.NEED_UPLOAD:return h.MEDIA_DATA_STAGE.NEED_UPLOAD;case h.UPLOAD_STAGE.ERROR_MISSING:return h.MEDIA_DATA_STAGE.ERROR_MISSING;case h.UPLOAD_STAGE.ERROR_TOO_LARGE:return h.MEDIA_DATA_STAGE.ERROR_TOO_LARGE;case h.UPLOAD_STAGE.UPLOADED:return h.MEDIA_DATA_STAGE.SENDING;case h.UPLOAD_STAGE.ERROR_FILE_NOT_READABLE:return h.MEDIA_DATA_STAGE.ERROR_FILE_NOT_READABLE;case h.UPLOAD_STAGE.FINALIZING:return h.MEDIA_DATA_STAGE.FINALIZING}}(t)):C(t):h.MEDIA_DATA_STAGE.PREPARING}function C(e){switch(e.downloadStage){case h.DOWNLOAD_STAGE.INIT:return h.MEDIA_DATA_STAGE.INIT;case h.DOWNLOAD_STAGE.EXISTS:return h.MEDIA_DATA_STAGE.EXISTS;case h.DOWNLOAD_STAGE.PREPARING:return h.MEDIA_DATA_STAGE.PREPARING;case h.DOWNLOAD_STAGE.REUPLOADING:return h.MEDIA_DATA_STAGE.REUPLOADING;case h.DOWNLOAD_STAGE.FETCHING:return h.MEDIA_DATA_STAGE.FETCHING;case h.DOWNLOAD_STAGE.PROCESSING:return h.MEDIA_DATA_STAGE.DECRYPTING;case h.DOWNLOAD_STAGE.NEED_POKE:return h.MEDIA_DATA_STAGE.NEED_POKE;case h.DOWNLOAD_STAGE.ERROR_MISSING:return h.MEDIA_DATA_STAGE.ERROR_MISSING;case h.DOWNLOAD_STAGE.ERROR_UNSUPPORTED:return h.MEDIA_DATA_STAGE.ERROR_UNSUPPORTED;case h.DOWNLOAD_STAGE.RESOLVED:return h.MEDIA_DATA_STAGE.RESOLVED;case h.DOWNLOAD_STAGE.PROGRESSIVE_READY:return h.MEDIA_DATA_STAGE.PROGRESSIVE_READY}}function A(){return P.apply(this,arguments)}function P(){return(P=(0,a.default)((function*(e){const t=yield g.default.createFromBase64Jpeg(e);return t.autorelease(),{resolvedPreview:t}}))).apply(this,arguments)}function M(){return O.apply(this,arguments)}function O(){return(O=(0,a.default)((function*(e){const{width:t,height:n}=yield(0,_.getImageWidthHeight)(e);return{aspectRatio:t/n}}))).apply(this,arguments)}t.MediaObject=class{constructor(){this._msgs=[],this._notifyTimer=new o.ShiftTimer((()=>{!function(e){const t={};T(t,e,h.FIELDS.RAW),T(t,e.contentInfo,e.contentFields()),e.mediaBlob&&(t.renderableUrl=e.mediaBlob.url());const n=e._msgs,r=n.length;for(let i=0;i<r;i++){const[r,a]=n[i];if(null!=r&&!a){if(r.type!==c.MSG_TYPE.CIPHERTEXT){t.mediaStage=b(r,e);for(let e=0;e<h.MSG_SPECIFIC_FIELDS.length;e++){const n=h.MSG_SPECIFIC_FIELDS[e];t[n]=r.get(h.MEDIA_TO_MSG[n])}t.type===c.MSG_TYPE.INTERACTIVE&&(t.type=v(r))}else{delete t.mediaStage;for(let e=0;e<h.MSG_SPECIFIC_FIELDS.length;e++)delete t[h.MSG_SPECIFIC_FIELDS[e]]}r.mediaData.set(t)}}for(let e=n.length-1;e>=0;e--)n[e][1]&&n.splice(e,1);const i=e._callOnConsolidate;!e._pendingChanges&&i&&(e._callOnConsolidate=null,i.forEach((e=>{e()})));e._saveMedia&&e._saveMedia(e)}(this),function(e){const t={};T(t,e,h.FIELDS.RAW),T(t,e.contentInfo,e.contentFields()),e.mediaBlob&&(t.renderableUrl=e.mediaBlob.url());const n=C(e);e._stickers=e._stickers.filter((e=>{let[t,n]=e;return!n})),e._stickers.forEach((e=>{let[r,a]=e;r.mediaData.set((0,i.default)((0,i.default)({},t),{},{mediaStage:n}))})),e._stickerPacks=e._stickerPacks.filter((e=>{let[t,n]=e;return!n})),e._stickerPacks.forEach((e=>{let[r,a]=e;r.mediaData.set((0,i.default)((0,i.default)({},t),{},{mediaStage:n}))})),!e._pendingChanges&&e._callOnConsolidate&&(e._callOnConsolidate.forEach((e=>{e()})),e._callOnConsolidate=null);e._saveMedia&&e._saveMedia(e)}(this)})),this._callOnConsolidate=null,this._keyedProcesses=null,this._pendingChangesCount=0,this._saveMedia=null,this._stickers=[],this._stickerPacks=[],this.entries=new p.MediaEntryList,this.downloadStage=h.DOWNLOAD_STAGE.INIT,this.uploadStage=h.UPLOAD_STAGE.INIT,this.userUploadAttemptCount=0,this.userDownloadAttemptCount=0,this.downloadPromise=null,this.uploadPromise=null,this.mediaBlob=null,this.size=void 0,this.loadedSize=void 0,this.filehash=void 0,this.contentInfo={},this.progressiveStage=void 0,this.parsedVcards=null}consolidate(e){return!!S(this,e)&&(this.notifyMsgsAsync(),!0)}clearBlob(){const e=this.mediaBlob;e&&(this.mediaBlob=null,e.autorelease())}contentFields(){const e=this.type||h.TYPE.DOCUMENT;return h.FIELDS[e]}resolveWhenConsolidated(){return this._notifyTimer.ts||this._pendingChanges?new Promise((e=>{this._callOnConsolidate?this._callOnConsolidate.push(e):this._callOnConsolidate=[e]})):Promise.resolve()}notifyMsgsAsync(){this._notifyTimer.debounce(0)}addMsg(e){const t=this._msgs;for(let n=0;n<t.length;n++){const[r,i]=t[n];r!==e||i||(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("redundant-media-msg"))}t.push([e,!1]),this.notifyMsgsAsync()}removeMsg(e){const t=this._msgs;let n=!1;for(let r=0;!n&&r<t.length;r++){const[i,a]=t[r];i!==e||a||(t[r][1]=!0,n=!0)}}hasAssociatedMsgsOrStickers(){const e=this._msgs;for(let t=0;t<e.length;t++)if(!e[t][1])return!0;return this.hasAssociatedStickers()||this.hasAssociatedStickerPacks()}associatedMsgs(){const e=this._msgs,t=[];for(let n=0;n<e.length;n++){const[r,i]=e[n];i||t.push(r)}return t}rmr(e){var t=this;return(0,a.default)((function*(){const r=t.associatedStickers();if((0,l.isMDBackend)()){if(r.length>0&&y.ServerProps.webServerStickerPanel){if(0===t.associatedMsgs().filter((e=>null!=e)).length){return n(49264).RecentStickerCollectionMd.removeAndSave(r.map((e=>e.id))),r.forEach((e=>{e.delete()})),Promise.resolve(200)}}}else{if(r.length>0)return(0,E.rmrSticker)(t.entries,t._stickers,r[0]).then((e=>e.status));const e=t.associatedStickerPacks();if(e.length>0)return(0,E.rmrStickerPack)(t.entries,t._stickerPacks,e[0]).then((e=>e.status))}const[i]=t._msgs.find((e=>{let[t,n]=e;return!n&&!t.isUnsentPhoneMsg()}))||[null];if(i||(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("media-fault: rmr called on MediaObject with no msg")),!i)return Promise.reject(new Error("rmr called on MediaObject with no msg"));e.onMsgSelect(i);const a=yield(0,m.default)(i);if(200===a.status){const e=i.mediaData.type;if("unknown"===e)return Promise.reject(new Error("rmr called on MediaData with unknown type"));const n=a.isMD?t.entries.updateEntry({deprecatedMms3Url:i.deprecatedMms3Url,encFilehash:i.encFilehash,directPath:a.directPath}):t.entries.addEntry({deprecatedMms3Url:a.url,mediaKey:a.mediaKey||i.mediaKey,mediaKeyTimestamp:a.mediaKeyTimestamp,encFilehash:a.encFilehash,type:e,directPath:a.directPath,debugHint:"rmr"});n||(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("media-fault: rmr entry can not be found")),null==n||n.markWhetherOnServer(!0)}return a.status}))()}msgProps(e){const t={};T(t,this,h.FIELDS.RAW),T(t,this.contentInfo,this.contentFields()),T(t,e,h.MSG_SPECIFIC_FIELDS),t.preview=this.contentInfo._preview;const n={};for(const e in t){const r=h.MEDIA_TO_MSG[e];r&&(n[r]=t[e])}return n}delete(){this._saveMedia=null;const{cancelDownloadMedia:e,cancelUploadMedia:t}=n(78986);e(this),t(this),this.clearBlob()}runProcessIfNotRunBefore(e,t,n){let r=this._keyedProcesses;r||(r=this._keyedProcesses={}),r.hasOwnProperty(e)||(this._pendingChangesCount++,r[e]=Promise.resolve(n).then(t).then((e=>{this.consolidate(e)})).finally((()=>{this._pendingChangesCount--,0===this._pendingChangesCount&&this.notifyMsgsAsync()})))}getPendingProcess(e){return 0!==this._pendingChangesCount&&this._keyedProcesses&&this._keyedProcesses.hasOwnProperty(e)?this._keyedProcesses[e]:Promise.resolve()}videoStreamingInfo(e){var t=this;return(0,a.default)((function*(){if(t.type!==h.TYPE.VIDEO)return __LOG__(4,void 0,new Error,!0)`type: ${String(t.type)}`,void SEND_LOGS("media-fault: media streaming info request for non-video type");const n=t.entries.getDownloadEntry();if(!n||!n.sidecar)return null;const[r,a]=yield Promise.all([(0,d.default)(f.MEDIA_TYPES.VIDEO,n.mediaKey),n.url()]);return{cryptoKeys:(0,i.default)((0,i.default)({},r),{},{cipherKey:r.encKey,sidecar:n.sidecar}),streamData:{clientUrl:a,size:t.size,msgKey:e}}}))()}addStickerPack(e){const t=this._stickerPacks;for(let n=0;n<t.length;n++){const[r,i]=t[n];r!==e||i||(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("redundant-sticker-pack-add"))}t.push([e,!1]),this.notifyMsgsAsync()}addSticker(e){const t=this._stickers;for(let n=0;n<t.length;n++){const[r,i]=t[n];r!==e||i||(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("redundant-sticker-add"))}t.push([e,!1]),this.notifyMsgsAsync()}removeSticker(e){const t=this._stickers;let n=!1;for(let r=0;!n&&r<t.length;r++){const[i,a]=t[r];i!==e||a||(t[r][1]=!0,n=!0)}}removeStickerPack(e){const t=this._stickerPacks;let n=!1;for(let r=0;!n&&r<t.length;r++){const[i,a]=t[r];i!==e||a||(t[r][1]=!0,n=!0)}}hasAssociatedStickers(){return this._stickers.some((e=>{let[t,n]=e;return!n}))}hasAssociatedStickerPacks(){return this._stickerPacks.some((e=>{let[t,n]=e;return!n}))}associatedStickers(){return this._stickers.reduce(((e,t)=>{let[n,r]=t;return r?e:e.concat(n)}),[])}associatedStickerPacks(){return this._stickerPacks.reduce(((e,t)=>{let[n,r]=t;return r?e:e.concat(n)}),[])}toJSON(){return{mediaBlob:this.mediaBlob,size:this.size,filehash:this.filehash,type:this.type,contentInfo:this.contentInfo,downloadStage:this.downloadStage,uploadStage:this.uploadStage}}}},22104:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.rmrSticker=function(){return d.apply(this,arguments)},t.rmrStickerPack=function(){return u.apply(this,arguments)};var i=r(n(48926)),a=r(n(78403)),o=r(n(45095)),s=n(88555),l=n(61596),c=r(n(56891));function d(){return(d=(0,i.default)((function*(e,t,n){if(n||(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("media-fault: rmr called on MediaObject without sticker")),(0,s.isMDBackend)())return Promise.reject(new Error("This call is only supported in non-MD mode"));const r=yield c.default.mediaUpload("sticker",n.id),i=r.sticker;if(200===r.status&&i){const n=0;t.forEach((e=>{let[t,r]=e;r||(t.directPath===i.directPath&&(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("rmrSticker:same-direct-path-after-rmr")),i.mediaKey=(0,o.default)((0,a.default)(i.mediaKey),"sanitizeBase64(nextSticker.mediaKey)"),t.deprecatedMms3Url=i.url,t.filehash=i.filehash,t.width=i.width,t.height=i.height,t.mediaKey=i.mediaKey,t.mediaKeyTimestamp=n,t.directPath=i.directPath,t.encFilehash=i.encFilehash,i.mimetype&&(t.mimetype=i.mimetype))}));const r=e.addEntry({deprecatedMms3Url:i.url,mediaKey:i.mediaKey,mediaKeyTimestamp:n,encFilehash:i.encFilehash,type:l.MEDIA_TYPES.STICKER,directPath:i.directPath,debugHint:"rmrSticker"});r&&r.markWhetherOnServer(!0)}return r}))).apply(this,arguments)}function u(){return(u=(0,i.default)((function*(e,t,n){if(n||(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("media-fault: rmr called on MediaObject without stickerPack")),(0,s.isMDBackend)())return Promise.reject(new Error("This call is only supported in non-MD mode"));const r=yield c.default.mediaUpload("sticker-pack",n.id),i=r.stickerPack;if(200===r.status&&i){const n=0;t.forEach((e=>{let[t,r]=e;r||(t.directPath===i.directPath&&(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("rmrStickerPack:same-direct-path-after-rmr")),t.url=i.url,t.filehash=i.filehash,t.mediaKey=i.mediaKey,t.mediaKeyTimestamp=n,t.directPath=i.directPath,t.encFilehash=i.encFilehash,i.mimetype&&(t.mimetype=i.mimetype))}));const r=e.addEntry({deprecatedMms3Url:i.url,mediaKey:i.mediaKey,mediaKeyTimestamp:n,encFilehash:i.encFilehash,type:l.MEDIA_TYPES.IMAGE,directPath:i.directPath,debugHint:"rmrStickerPack"});r&&r.markWhetherOnServer(!0)}return r}))).apply(this,arguments)}},94995:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(81109)),a=r(n(48926)),o=n(18412),s=n(35470),l=n(88555),c=n(85582),d=n(40234),u=B(n(51428)),p=r(n(65212)),f=n(15461),h=r(n(76139)),_=r(n(41143)),g=n(18309),m=n(99234),y=r(n(92360)),E=r(n(46220)),S=n(84866),v=r(n(2320)),T=n(45554),b=B(n(88297)),C=n(58668),A=n(61596),P=n(56406),M=r(n(11339)),O=n(9329),I=n(70996),w=r(n(34949)),R=r(n(15554)),D=n(75887),L=n(13705),N=n(64551),k=n(31019),U=r(n(2603)),G=r(n(74460));function x(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(x=function(e){return e?n:t})(e)}function B(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=x(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}return r.default=e,n&&n.set(e,r),r}function F(e,t){return"product"===t.type?M.default.DOWNLOAD_ORIGIN_TYPE.PRODUCT_CATALOG:(0,k.unproxy)(e).isGroup?M.default.DOWNLOAD_ORIGIN_TYPE.CHAT_GROUP:M.default.DOWNLOAD_ORIGIN_TYPE.CHAT_PERSONAL}function j(e){return N.ServerProps.webUploadDocumentThumbMmsEnabled&&e===A.MEDIA_TYPES.DOCUMENT}function Y(e,t,r){var o;__LOG__(2)`Media:sendToChat chat ${t.id.toString()}`;const{caption:g,footer:v}=r,k=r.quotedMsg?r.quotedMsg.msgContextInfo(t.id):{},x=(0,m.getMeUser)(),B=r.productMsgOptions||{};let Y,K,W,H;!t.isUser&&(0,l.isMDBackend)()&&(Y=x),t.isEphemeralSettingOn()&&(K=t.getEphemeralSetting());const V=t.getEphemeralSettingTimestamp();null!=V&&(W=V);const $=t.getDisappearingModeInitiator();null!=$&&(H=$);const z=(0,i.default)({t:d.Clock.globalUnixTime(),from:x,isNewMsg:!0,to:t.id,self:"out",type:null!==(o=r.type)&&void 0!==o?o:e._baseType,ack:s.ACK.CLOCK,local:!0,id:new p.default({from:x,to:t.id,id:p.default.newId(),participant:Y,selfDir:"out"}),caption:g,footer:v,quotedMsg:k.quotedMsg,quotedParticipant:k.quotedParticipant,quotedStanzaID:k.quotedStanzaID,quotedRemoteJid:k.quotedRemoteJid,mentionedJidList:r.mentionedJidList,isForwarded:r.isForwarded,forwardingScore:r.forwardingScore,multicast:r.multicast,forwardedFromWeb:r.forwardedFromWeb,ctwaContext:r.ctwaContext,ephemeralDuration:K,ephemeralSettingTimestamp:W,disappearingModeInitiator:H},B),q=e.waitForPrep().then((e=>{const t=e.mediaBlob;return!t||t instanceof w.default?e:w.default.createFromData(t,t.type).then((t=>(e.mediaBlob=t,e)))})).then((e=>{const n=e.filehash;n||(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("media-fault: sendToChat filehash undefined"));const i=b.getOrCreateMediaObject(n),a=i.mediaBlob;a&&(a.retain(),e.mediaBlob instanceof w.default&&e.mediaBlob.autorelease(),e.mediaBlob=a),e.mediaBlob instanceof w.default&&(e.renderableUrl=e.mediaBlob.url()),i.consolidate(e.toJSON()),e.mediaBlob instanceof w.default&&e.mediaBlob.autorelease();if((0,P.shouldUseMediaCache)((0,A.castToV4)(i.type))&&e.mediaBlob instanceof w.default){const t=e.mediaBlob.formData();S.MediaBlobCache.put(n,t)}(0,O.downloadMedia)({mimetype:e.mimetype,mediaObject:i,downloadEvenIfExpensive:!0,mediaType:(0,A.msgToMediaType)({type:e.type,isGif:e.isGif}),rmrReason:M.default.WEBC_RMR_REASON_CODE.SEND_TO_CHAT,downloadOrigin:F(t,z),mode:"manual"});const o=i.msgProps(e);return o.caption=g,g||e.type!==C.OUTWARD_TYPES.DOCUMENT||(o.caption=e.filename),N.ServerProps.viewOnceWrite&&r.isViewOnce&&(o.isViewOnce=!0),o}));let J,Q,X;function Z(){return ee.apply(this,arguments)}function ee(){return(ee=(0,a.default)((function*(e){J=e;const{mediaObject:n}=e;n||(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("media-fault: incorrect media object for created msg")),(0,_.default)(n,"msg is missing mediaObject");const r=(0,A.msgToMediaType)(e),a=n.entries.getUploadEntry(),o=a?{key:a.mediaKey,timestamp:a.mediaKeyTimestamp}:(0,R.default)();let{fullPreviewData:s,fullPreviewSize:l}=n.contentInfo,d=e.body;if(j(r)&&!s&&n.contentInfo.preview){const e=yield u.base64ImageToCanvas(n.contentInfo.preview.url()),t=yield(0,c.generateMicroThumb)(e,1300,{mimetype:"image/jpeg",maxAttempts:10});s=n.contentInfo.preview,l={width:t.width,height:t.height},d=h.default.parseDataURL(t.dataUrl).data}const p=s&&l&&j(r),g=e.safe(),m=s&&p&&g.type===f.MSG_TYPE.DOCUMENT?(0,G.default)({thumbnail:s,mediaKeyInfo:o,mediaType:(0,y.default)(g),uploadOrigin:(0,E.default)(t),forwardedFromWeb:Boolean(e.forwardedFromWeb),isViewOnce:Boolean(e.isViewOnce)}):Promise.resolve(null),S=(0,I.uploadMedia)({mimetype:e.mimetype,mediaObject:n,mediaType:r,forwardedFromWeb:Boolean(e.forwardedFromWeb),uploadOrigin:(0,E.default)(t),mediaKeyInfo:o,isViewOnce:Boolean(e.isViewOnce)}),{filehash:v}=n;(0,T.shouldUseMediaKeyCache)()&&null!=v&&T.MediaKeyCache.put(v,o);const[{kind:b,mediaEntry:C},P]=yield Promise.all([S,m]),M=null==P?void 0:P.mediaEntry;if(Q=b,!C)throw new Error("upload failed: media entry was not created");(0,T.shouldUseMediaKeyCache)()&&null!=v&&T.MediaKeyCache.delete(v);let O={};if(p){if(!(M&&P&&l)){const e={thumbnailResultEntry:M,uploadThumbnailResult:P,fullPreviewSize:l};throw __LOG__(4,void 0,new Error,!0)`upload failed: thumbnail data incomplete\nDebug info:${JSON.stringify(e)}`,SEND_LOGS("mms-thumbnail-data-incomplete"),new Error("upload failed: thumbnail data incomplete")}O={thumbnailDirectPath:M.directPath,thumbnailSha256:P.filehash,thumbnailEncSha256:M.encFilehash,thumbnailHeight:l.height,thumbnailWidth:l.width}}return(0,U.default)(J,(0,i.default)({deprecatedMms3Url:C.deprecatedMms3Url,directPath:C.directPath,mediaKey:C.mediaKey,mediaKeyTimestamp:C.mediaKeyTimestamp,filehash:n.filehash,encFilehash:C.encFilehash,size:n.size,streamingSidecar:C.sidecar,firstFrameSidecar:C.firstFrameSidecar,body:d},O))}))).apply(this,arguments)}if(r.addEvenWhilePreparing){const e=r.placeholderProps||{};X=(0,D.addAndSendMsgToChat)(t,(0,i.default)((0,i.default)({},e),z),(e=>(J=e,q.then((e=>(0,U.default)(J,e))).then((()=>Z(J))))))[1]}else{const e=q.then((e=>{const t=r.useBasePropsType?z.type:e.type;return(0,i.default)((0,i.default)((0,i.default)({},z),e),{},{type:t})}));X=(0,D.addAndSendMsgToChat)(t,e,Z)[1]}return X.then((e=>({result:e,error:null}))).catch((e=>({result:null,error:e}))).then((e=>{var t,r;let{result:i,error:a}=e;if(i===L.SendMsgResult.OK)return J.type===C.OUTWARD_TYPES.STICKER&&((0,l.isMDBackend)()?N.ServerProps.webServerStickerPanel&&n(49264).RecentStickerCollectionMd.addStickerWithMediaData(J.mediaData,J.id.toString()):n(91692).RecentStickerCollection.addStickerWithMediaData(J.mediaData)),L.SendMsgResult.OK;const o=null===(t=J)||void 0===t||null===(r=t.mediaObject)||void 0===r?void 0:r.uploadStage;if(J&&(J.ack=s.ACK.FAILED),Q===I.UploadMediaResultKind.CANCELLATION)return __LOG__(2)`Media:sendToChat canceled`,L.SendMsgResult.ERROR_CANCELLED;if(__LOG__(3)`Media:sendToChat error\nresult: ${i}\nuploadStage: ${o}\nuploadResultKind: ${Q}\nerror: ${String(a)}`,null!=o)switch(o){case C.UPLOAD_STAGE.NEED_UPLOAD:case C.UPLOAD_STAGE.ERROR_TOO_LARGE:return L.SendMsgResult.ERROR_UPLOAD;case C.UPLOAD_STAGE.ERROR_MISSING:return L.SendMsgResult.ERROR_EXPIRED}return Q===I.UploadMediaResultKind.ERROR?L.SendMsgResult.ERROR_UPLOAD:null!=i?i:L.SendMsgResult.ERROR_UNKNOWN}))}t.default=class{constructor(e,t){this._baseType=e,this._mediaData=new v.default({mediaStage:C.MEDIA_DATA_STAGE.PREPARING}),this._prepwork=t.then((e=>{if(this._mediaData.set(e),!e.filehash)return e.mediaBlob||(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("media-fault: no hash or blob")),(0,g.calculateFilehashFromBlob)(e.mediaBlob).then((e=>{this._mediaData.filehash=e}))}),(e=>{throw this._mediaData.mediaStage=C.MEDIA_DATA_STAGE.ERROR_UNSUPPORTED,e}))}sendToChat(e,t){return(0,o.promiseCallSync)(Y,null,this,e,t)}waitForPrep(){var e=this;return(0,a.default)((function*(){return yield e._prepwork,e._mediaData}))()}}},88297:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.associateMediaWithMsg=function(e,t){e.addMsg(t)},t.associateMediaWithSticker=function(e,t){e.addSticker(t)},t.associateMediaWithStickerPack=function(e,t){e.addStickerPack(t)},t.clearMediaForChat=function(){},t.delistAndDeleteAllMedia=function(){const e=s;s={};for(const t in e)e[t].delete()},t.disassociateMediaFromMsg=function(e,t){if(t.mediaObject=null,e.removeMsg(t),e.hasAssociatedMsgsOrStickers())return;const{filehash:n}=e;n&&delete s[n];n&&(0,o.shouldUseLruMediaStore)((0,a.msgToMediaType)(t))&&r.LruMediaStore.del(n);e.delete()},t.disassociateMediaFromSticker=function(e,t){if(t.mediaObject=null,e.removeSticker(t),e.hasAssociatedMsgsOrStickers())return;const{filehash:n}=e;n&&delete s[n];n&&r.LruMediaStore.del(n);e.delete()},t.disassociateMediaFromStickerPack=function(e,t){if(t.mediaObject=null,e.removeStickerPack(t),e.hasAssociatedMsgsOrStickers())return;const{filehash:n}=e;n&&delete s[n];n&&r.LruMediaStore.del(n);e.delete()},t.getOrCreateMediaObject=function(e){if(s.hasOwnProperty(e))return s[e];return s[e]=new i.MediaObject};var r=n(55975),i=n(21009),a=n(61596),o=n(56406);let s={}},58668:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UPLOAD_STAGE=t.TYPE=t.OUTWARD_TYPES=t.MSG_TO_MEDIA=t.MSG_SPECIFIC_FIELDS=t.MEDIA_TO_MSG=t.MEDIA_MSG_PROPS=t.MEDIA_DATA_STAGE=t.MAPPED_STICKER_PROPS=t.MAPPED_MSG_PROPS=t.MAPPED_MEDIA_PROPS=t.FIELDS=t.DOWNLOAD_STAGE=void 0;const r=Object.freeze({preview:"body",mediaKey:"mediaKey",mediaKeyTimestamp:"mediaKeyTimestamp",size:"size",filehash:"filehash",mimetype:"mimetype",duration:"duration",pageCount:"pageCount",fullHeight:"height",fullWidth:"width",type:"type",filename:"filename",caption:"caption",isGif:"isGif",gifAttribution:"gifAttribution",sidecar:"streamingSidecar",subtype:"subtype",firstFrameLength:"firstFrameLength",firstFrameSidecar:"firstFrameSidecar",isAnimated:"isAnimated",isVcardOverMmsDocument:"isVcardOverMmsDocument",isViewOnce:"isViewOnce",waveform:"waveform",staticUrl:"staticUrl"});t.MEDIA_TO_MSG=r;const i=Object.freeze({body:"preview",directPath:"directPath",mediaKey:"mediaKey",mediaKeyTimestamp:"mediaKeyTimestamp",size:"size",filehash:"filehash",mimetype:"mimetype",duration:"duration",pageCount:"pageCount",height:"fullHeight",width:"fullWidth",type:"type",filename:"filename",caption:"caption",isGif:"isGif",gifAttribution:"gifAttribution",streamingSidecar:"sidecar",subtype:"subtype",firstFrameLength:"firstFrameLength",firstFrameSidecar:"firstFrameSidecar",isAnimated:"isAnimated",isVcardOverMmsDocument:"isVcardOverMmsDocument",isViewOnce:"isViewOnce",waveform:"waveform",staticUrl:"staticUrl",stickerPackId:"stickerPackId",stickerPackName:"stickerPackName",stickerPackPublisher:"stickerPackPublisher"});t.MSG_TO_MEDIA=i;const a=Object.keys(i);t.MAPPED_MSG_PROPS=a;const o=Object.keys(r);t.MAPPED_MEDIA_PROPS=o;t.MAPPED_STICKER_PROPS=["filehash","height","mimetype","size","type","width","stickerPackId","stickerPackName","stickerPackPublisher"];const s=[...a,"deprecatedMms3Url","encFilehash","streamable"];t.MEDIA_MSG_PROPS=s;const l=Object.freeze({VIDEO:Object.freeze(["aspectRatio","fullWidth","fullHeight","preview","duration","durationFloat","isViewOnce","fullPreviewData","staticUrl"]),AUDIO:Object.freeze(["duration","waveform"]),IMAGE:Object.freeze(["aspectRatio","fullWidth","fullHeight","preview","isViewOnce","fullPreviewData","staticUrl"]),PRODUCT:Object.freeze(["aspectRatio","fullWidth","fullHeight","preview"]),STICKER:Object.freeze(["animationDuration","singleLoopDuration","emojis","firstFrameLength","firstFrameSidecar","isAnimated","isFirstParty","isFromStickerMaker","stickerPackId","stickerPackName","stickerPackPublisher","fullWidth","fullHeight","preview","rgbaBuffer","rgbaWidth","rgbaHeight","aspectRatio"]),STICKER_PACK:Object.freeze([]),DOCUMENT:Object.freeze(["aspectRatio","pageCount","preview","isVcardOverMmsDocument","parsedVcards","fullPreviewData","fullPreviewSize"]),RAW:Object.freeze(["mediaBlob","size","loadedSize","filehash","progressiveStage"])});t.FIELDS=l;t.MSG_SPECIFIC_FIELDS=["type","filename","caption","isGif","gifAttribution","mimetype","pageCount","sidecar","subtype","isViewOnce"];const c=n(76672).Mirrored(["INIT","EXISTS","PREPARING","REUPLOADING","FETCHING","PROCESSING","NEED_POKE","ERROR_MISSING","ERROR_UNSUPPORTED","PROGRESSIVE_READY","RESOLVED"]);t.DOWNLOAD_STAGE=c;const d=n(76672).Mirrored(["INIT","PREPARING","UPLOADING","FINALIZING","NEED_UPLOAD","ERROR_FILE_NOT_READABLE","ERROR_MISSING","ERROR_TOO_LARGE","UPLOADED"]);t.UPLOAD_STAGE=d;const u=n(76672).Mirrored(["INIT","EXISTS","PREPARING","UPLOADING","FINALIZING","SENDING","REUPLOADING","FETCHING","DECRYPTING","RESOLVED","NEED_POKE","NEED_UPLOAD","ERROR_FILE_NOT_READABLE","ERROR_MISSING","ERROR_TOO_LARGE","ERROR_UNSUPPORTED","PROGRESSIVE_READY","REMOTE_UPLOADING","REMOTE_NEED_UPLOAD"]);t.MEDIA_DATA_STAGE=u;t.OUTWARD_TYPES={IMAGE:"image",VIDEO:"video",AUDIO:"audio",PTT:"ptt",STICKER:"sticker",DOCUMENT:"document",PRODUCT:"product",UNKNOWN:"unknown"};const p=Object.freeze({VIDEO:"VIDEO",IMAGE:"IMAGE",AUDIO:"AUDIO",STICKER:"STICKER",DOCUMENT:"DOCUMENT",PRODUCT:"PRODUCT"});t.TYPE=p},71644:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){try{const t=null!=e&&""!==e?JSON.parse(e):a.default,n={};return o(t,n,"",""),n}catch(e){return null}};var i=n(51737),a=r(n(47466));function o(e,t,n,r){let a=e;if(Array.isArray(a)||(0,i.isString)(a)){(0,i.isString)(a)&&(a=[a]);for(let e=0;e<a.length;e++){const o=a[e];(0,i.isString)(o)&&(t[o]=r+n)}}else if("object"==typeof a)for(const e in a)o(a[e],t,e,r+n)}},43257:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.VIDEO_MIMES=t.MSCFB_MIME=t.MSCFB_HEADER=t.MIMETYPE_DETERMINING_LENGTH=t.MIMETYPES=t.IMAGE_MIMES=t.EXT_TO_MIME=t.DOC_MIMES=t.DOCUMENT_MIMETYPES=void 0,t.getExtension=function(e){const t=u[e];return t?"."+(t.ext||e.split("/")[1]).toLowerCase():""},t.getMediaMimeType=function(e,t){const n=t.subarray(0,262),r=(0,o.default)(n);if(r)return r.mime;if("image"===e)return"image/jpeg";throw new l.MediaEncryptionError("unknown mime decrypt error for type:"+e)},t.isAllowedDocumentMimetype=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];for(const r in _){const i=u[r];if(null==i)continue;const{signatureMimetype:a,ext:o}=i;if((n?a:r)===e&&o&&(null==t?void 0:t.toLowerCase().endsWith(o.toLowerCase())))return r}if(n)return e;return null!=e?e:"application/octet-stream"},t.isMsCompoundFileBinaryFormat=function(e){return(0,a.default)(e,d)},t.isOpus=function(e){return!!e&&e.includes("audio/ogg")},t.previewType=function(e){const t=u[e];return null==t?void 0:t.previewType};var i=r(n(35937)),a=r(n(63438)),o=r(n(97769)),s=r(n(71644)),l=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=c(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(35232));function c(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(c=function(e){return e?n:t})(e)}t.MIMETYPE_DETERMINING_LENGTH=262;const d=new Uint8Array([208,207,17,224,161,177,26,225]);t.MSCFB_HEADER=d;t.MSCFB_MIME="application/x-cfb";const u={"text/plain":{ext:"TXT",msgType:"document",icon:"icon-doc-txt",canSend:!0},"text/rtf":{ext:"RTF",msgType:"document",icon:"icon-doc-doc",canSend:!0,signatureMimetype:"application/rtf"},"text/vcard":{ext:"VCF",msgType:"vcard"},"application/zip":{ext:"ZIP",icon:"icon-doc-generic",msgType:"document"},"application/pdf":{ext:"PDF",msgType:"document",icon:"icon-doc-pdf",canSend:!0,signatureMimetype:"application/pdf",previewType:"pdf"},"application/msword":{ext:"DOC",msgType:"document",icon:"icon-doc-doc",canSend:!0,signatureMimetype:"application/x-msi",previewType:"msoffice"},"application/vnd.ms-excel":{ext:"XLS",msgType:"document",icon:"icon-doc-xls",canSend:!0,signatureMimetype:"application/x-msi",previewType:"msoffice"},"application/vnd.ms-powerpoint":{ext:"PPT",msgType:"document",icon:"icon-doc-ppt",canSend:!0,signatureMimetype:"application/x-msi",previewType:"msoffice"},"application/vnd.openxmlformats-officedocument.wordprocessingml.document":{ext:"DOCX",msgType:"document",icon:"icon-doc-doc",canSend:!0,signatureMimetype:"application/zip",previewType:"msoffice"},"application/vnd.openxmlformats-officedocument.presentationml.presentation":{ext:"PPTX",msgType:"document",icon:"icon-doc-ppt",canSend:!0,signatureMimetype:"application/zip",previewType:"msoffice"},"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":{ext:"XLSX",msgType:"document",icon:"icon-doc-xls",canSend:!0,signatureMimetype:"application/zip",previewType:"msoffice"},"audio/aac":{msgType:"audio",ext:"AAC"},"audio/mp4":{msgType:"audio"},"audio/amr":{msgType:"audio"},"audio/mpeg":{msgType:"audio"},"audio/ogg; codecs=opus":{msgType:"audio",ext:"OGG"},"audio/wav":{msgType:"audio",ext:"wav"},"video/mp4":{msgType:"video",ext:"MP4"},"video/3gpp":{msgType:"video"},"image/jpeg":{msgType:"image"},"image/png":{msgType:"image"}},p=u;t.MIMETYPES=p;const f=(0,i.default)(p,(e=>"document"===(null==e?void 0:e.msgType)));t.DOCUMENT_MIMETYPES=f;t.DOC_MIMES="*";t.IMAGE_MIMES="image/*";t.VIDEO_MIMES="video/mp4,video/3gpp,video/quicktime";const h=(0,s.default)();t.EXT_TO_MIME=h;const _=(0,i.default)(u,(e=>"document"===(null==e?void 0:e.msgType)&&!0===e.canSend&&null!=e.ext))},691:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FILE_PROGRESS_THROTTLE_WAIT_MS=void 0;t.FILE_PROGRESS_THROTTLE_WAIT_MS=100},61596:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.MEDIA_TYPE_VALUES=t.MEDIA_TYPES=void 0,t.castToV4=function(e){let t;if(null==e)t=s.DOCUMENT;else{if(!(e in s))throw new Error(`castToV4: unexpected mmsv3 type ${e}`);t=s[e]}return t},t.getMsgMediaType=function(e){return c({type:e.type,interactiveHeader:e.interactiveHeader,isGif:e.type===a.MSG_TYPE.VIDEO&&e.isGif})},t.msgToMediaType=c;var i=r(n(52628)),a=n(15461),o=n(34535);const s=Object.freeze({AUDIO:"audio",DOCUMENT:"document",GIF:"gif",IMAGE:"image",NATIVE_FLOW:"native_flow",PPIC:"ppic",PRODUCT:"product",PTT:"ptt",STICKER:"sticker",VIDEO:"video",TEMPLATE:"template",THUMBNAIL_DOCUMENT:"thumbnail-document",THUMBNAIL_IMAGE:"thumbnail-image",THUMBNAIL_VIDEO:"thumbnail-video",THUMBNAIL_LINK:"thumbnail-link",HISTORY_SYNC:"md-msg-hist",MD_APP_STATE:"md-app-state",PRODUCT_CATALOG_IMAGE:"product-catalog-image",PAYMENT_BG_IMAGE:"payment-bg-image"});t.MEDIA_TYPES=s;const l=(0,i.default)(s);function c(e){let{type:t,isGif:n,interactiveHeader:r}=e;switch(t){case a.MSG_TYPE.IMAGE:return s.IMAGE;case a.MSG_TYPE.VIDEO:return n?s.GIF:s.VIDEO;case a.MSG_TYPE.AUDIO:return s.AUDIO;case a.MSG_TYPE.PTT:return s.PTT;case a.MSG_TYPE.DOCUMENT:return s.DOCUMENT;case a.MSG_TYPE.STICKER:return s.STICKER;case a.MSG_TYPE.PRODUCT:return s.PRODUCT;case a.MSG_TYPE.NATIVE_FLOW:return s.NATIVE_FLOW;case a.MSG_TYPE.INTERACTIVE:if(null!=(null==r?void 0:r.mediaType))switch(r.mediaType){case o.InteractiveMessageHeaderMediaType.DOCUMENT:return s.DOCUMENT;case o.InteractiveMessageHeaderMediaType.VIDEO:return s.VIDEO;case o.InteractiveMessageHeaderMediaType.IMAGE:return s.IMAGE}}throw new Error(`msg is not a media msg: ${t}, isGif=${String(n)}`)}t.MEDIA_TYPE_VALUES=l},22283:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={DOWNLOAD:"DOWNLOAD",UPLOAD:"UPLOAD"};t.default=n},18309:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.calculateFilehash=function(e){return(0,i.sha256Base64)(e)},t.calculateFilehashFromBlob=function(e){return(e instanceof s.default?(0,o.opaqueDataToArrayBuffer)(e):(0,a.blobToArrayBuffer)(e)).then((e=>(0,i.sha256Base64)(e))).catch((t=>{const n={error:`${t}`,blobSize:e.size,isOpaqueData:e instanceof s.default};__LOG__(3,void 0,void 0,!0)`calculateFilehashFromBlob error. Debug:\n${JSON.stringify(n,null,2)}`,SEND_LOGS("calculate-filehash-from-blob-error")}))};var i=n(73045),a=n(65885),o=n(56406),s=r(n(34949))},7407:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){const a=16*Math.ceil(e/16),o=t.slice(0,i.IV_LENGTH+a);return(0,r.hmacSha256)(n,o,i.HMAC_LENGTH)};var r=n(11141),i=n(71940)},71940:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.IV_LENGTH=t.HMAC_LENGTH=void 0,t.calculateStreamingSidecar=function(){return c.apply(this,arguments)};var i=r(n(48926)),a=r(n(98913)),o=n(32428),s=n(11141);const l=65536;t.IV_LENGTH=16;function c(){return(c=(0,i.default)((function*(e,t){const n=e instanceof ArrayBuffer?e.byteLength:e.buffer.byteLength,r=Math.ceil((n-16)/l),i=(0,a.default)(r,(n=>{const r=n*l,i=e.slice(r,r+16+l);return(0,s.hmacSha256)(t,i,10)})),c=yield Promise.all(i);return(0,o.concatArrayBuffers)(...c)}))).apply(this,arguments)}t.HMAC_LENGTH=10},28011:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return d.apply(this,arguments)};var i=r(n(48926)),a=n(15688),o=n(81576),s=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=c(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(35232)),l=n(61596);function c(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(c=function(e){return e?n:t})(e)}function d(){return(d=(0,i.default)((function*(e,t){const n=u(e);let r;try{r=(0,a.decodeB64)(t)}catch(e){}if(!t||!n||!r)throw new s.MediaEncryptionError(`createKeys fail: !!mediakey: ${!!t} info: ${n} type: ${e}`);const i=yield(0,o.extractAndExpand)(r,n,112);if(!i||i.byteLength<112)throw new s.MediaEncryptionError("computeMediaKeys: hkdf error");return{iv:i.slice(0,16),encKey:i.slice(16,48),macKey:i.slice(48,80),refKey:i.slice(80,112)}}))).apply(this,arguments)}function u(e){switch(e){case l.MEDIA_TYPES.AUDIO:return"WhatsApp Audio Keys";case l.MEDIA_TYPES.DOCUMENT:return"WhatsApp Document Keys";case l.MEDIA_TYPES.GIF:return"WhatsApp Video Keys";case l.MEDIA_TYPES.IMAGE:return"WhatsApp Image Keys";case l.MEDIA_TYPES.PPIC:throw new Error("Cannot create media keys for profile pics");case l.MEDIA_TYPES.PRODUCT:return"WhatsApp Image Keys";case l.MEDIA_TYPES.PTT:return"WhatsApp Audio Keys";case l.MEDIA_TYPES.STICKER:return"WhatsApp Image Keys";case l.MEDIA_TYPES.VIDEO:return"WhatsApp Video Keys";case l.MEDIA_TYPES.THUMBNAIL_DOCUMENT:return"WhatsApp Document Thumbnail Keys";case l.MEDIA_TYPES.THUMBNAIL_IMAGE:return"WhatsApp Image Thumbnail Keys";case l.MEDIA_TYPES.THUMBNAIL_VIDEO:return"WhatsApp Video Thumbnail Keys";case l.MEDIA_TYPES.THUMBNAIL_LINK:return"WhatsApp Link Thumbnail Keys";case l.MEDIA_TYPES.TEMPLATE:throw new Error("Cannot create media keys for template");case l.MEDIA_TYPES.HISTORY_SYNC:return"WhatsApp History Keys";case l.MEDIA_TYPES.MD_APP_STATE:return"WhatsApp App State Keys";case l.MEDIA_TYPES.PRODUCT_CATALOG_IMAGE:throw new Error("Cannot create media keys for product catalog image");case l.MEDIA_TYPES.PAYMENT_BG_IMAGE:return"WhatsApp Payment Background Keys"}}},74994:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return h.apply(this,arguments)};var i=r(n(48926)),a=n(95024),o=n(81484),s=n(11141),l=n(46269),c=n(60977),d=n(35232),u=n(18309),p=n(23125);const f=10;function h(){return(h=(0,i.default)((function*(e){let{mediaKeys:t,ciphertextHmac:n,expectedPlaintextHash:r,debugString:h}=e;if(yield Promise.resolve(),__LOG__(2)`decryptMedia: [${h}] start`,n.byteLength<f)throw new d.MediaDecryptionError(`ciphertext too short: ${n.byteLength}`);const{iv:_,encKey:g,macKey:m}=t,y=(0,l.castTypedArrays)(Uint8Array,n);try{return yield(0,s.hmacSha256)(m,(0,c.concatTypedArrays)(Uint8Array,[new Uint8Array(_),(0,p.isPerformanceExperimentEnabled)()?y.subarray(0,-10):y.slice(0,-10)]),f).then((e=>{const t=y.buffer.slice(-10);if(!(0,a.arrayBuffersDeepEqual)(e,t))throw new d.MediaDecryptionError("decryptMedia: hmac mismatch");return(0,o.aesCbcDecrypt)(g,_,y.subarray(0,-10))})).then(function(){var e=(0,i.default)((function*(e){if(null==r)return e;if((yield(0,u.calculateFilehash)(e))!==r)throw new d.MediaDecryptionError("decryptMedia: plaintext hash mismatch");return __LOG__(2)`decryptMedia: [${h}] success`,e}));return function(){return e.apply(this,arguments)}}())}catch(e){if(__LOG__(3)`decryptMedia: [${h}] error`,e instanceof d.MediaDecryptionError)throw e;throw new d.MediaDecryptionError(`decryption error: ${String(e)}; stack: ${e.stack}`)}}))).apply(this,arguments)}},80733:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.decryptPartialMedia=t.decrypt=t.cleanupCiphertextAndIv=t.HMAC_SIZE=t.BLOCK_SIZE=void 0;var i=r(n(48926)),a=n(60977);t.BLOCK_SIZE=16;t.HMAC_SIZE=10;const o=function(){var e=(0,i.default)((function*(e){const{ciphertext:t,iv:n,mediaKeys:r}=e,{encKey:i}=r;try{const e=yield self.crypto.subtle.importKey("raw",new Uint8Array(i),"AES-CBC",!1,["decrypt"]).catch((e=>{throw __LOG__(2)`decryptPartialMedia:decrypt importKey error: ${String(e)}`,e}));return self.crypto.subtle.decrypt({name:"AES-CBC",iv:n},e,t)}catch(e){throw __LOG__(2)`decryptPartialMedia:decrypt decrypt error: ${String(e)}`,e}}));return function(){return e.apply(this,arguments)}}();t.decrypt=o;const s=function(){var e=(0,i.default)((function*(e){const{ciphertext:t,mediaKeys:n}=e,{encKey:r}=n,i={name:"AES-CBC",iv:(t instanceof Uint8Array?t:new Uint8Array(t)).slice(-16)};try{const e=yield self.crypto.subtle.importKey("raw",new Uint8Array(r),"AES-CBC",!1,["encrypt"]).catch((e=>{__LOG__(2)`decryptPartialMedia:getEncryptedPadding importKey error: ${String(e)}`})),t=new Uint8Array([]);return self.crypto.subtle.encrypt(i,e,t)}catch(e){return void __LOG__(2)`decryptPartialMedia:getEncryptedPadding encrypt error: ${String(e)}`}}));return function(){return e.apply(this,arguments)}}(),l=e=>{const{serverRangeStart:t,ciphertext:n,mediaKeys:r}=e;let i=n instanceof Uint8Array?n:new Uint8Array(n);const o=i.byteLength%16==0;let l;return 0===t?l=new Uint8Array(r.iv):(l=i.slice(0,16),i=i.slice(16)),o||(i=i.slice(0,i.byteLength-10)),o?s({ciphertext:i,mediaKeys:r}).then((e=>(i=(0,a.concatTypedArrays)(Uint8Array,[i,new Uint8Array(e)]),{ciphertext:i,iv:l}))):Promise.resolve({ciphertext:i,iv:l})};t.cleanupCiphertextAndIv=l;const c=function(){var e=(0,i.default)((function*(e){let{mediaKeys:t,ciphertext:n}=e;const{ciphertext:r,iv:i}=yield l({serverRangeStart:0,ciphertext:n,mediaKeys:t});return o({ciphertext:r,iv:i,mediaKeys:t})}));return function(){return e.apply(this,arguments)}}();t.decryptPartialMedia=c},83899:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let{mediaKey:t,plaintext:n,type:r}=e;return new Promise(((e,i)=>{if(t.slice(0,10),__LOG__(2)`encryptMedia: start`,!r)throw new d.MediaEncryptionError('encryptMedia: missing "type"');if(!t)throw new d.MediaEncryptionError('encryptMedia: missing "mediaKey"');(0,h.default)(r,t).then((e=>(0,m.isPerformanceExperimentEnabled)()?function(){return v.apply(this,arguments)}(n,r,e):function(){return y.apply(this,arguments)}(n,r,e))).then((t=>{__LOG__(2)`encryptMedia: success`,e(t)})).catch((e=>{if(__LOG__(3)`encryptMedia: error`,e instanceof d.MediaEncryptionError)throw e;throw new d.MediaEncryptionError(`encryption error: ${String(e)}; stack: ${e.stack}`)})).catch(i)}))};var i=r(n(48926)),a=n(32428),o=n(81484),s=n(11141),l=n(67602),c=n(60977),d=n(35232),u=n(18309),p=r(n(7407)),f=n(71940),h=r(n(28011)),_=n(61596),g=n(76076),m=n(23125);function y(){return(y=(0,i.default)((function*(e,t,n){let{iv:r,encKey:i,macKey:c}=n;const d=yield(0,o.aesCbcEncrypt)(i,e,r),h=d.slice(r.byteLength),m=yield(0,s.hmacSha256)(c,d,10);let y=Promise.resolve();if(t===_.MEDIA_TYPES.VIDEO||t===_.MEDIA_TYPES.AUDIO){const e=(0,a.concatArrayBuffers)(d,m);y=(0,f.calculateStreamingSidecar)(e,c)}let E=Promise.resolve();if(t===_.MEDIA_TYPES.STICKER){const{firstFrameLength:t}=(0,g.parseWebp)(e);if(null!=t){const e=(0,a.concatArrayBuffers)(d,m);E=(0,p.default)(t,e,c)}}const S=(0,a.concatArrayBuffers)(h,m);return(0,l.promiseProps)({ciphertextHmac:S,hash:(0,u.calculateFilehash)(S),sidecar:y,firstFrameSidecar:E})}))).apply(this,arguments)}function E(e){let{ivCiphertext:t,signature:n,macKey:r}=e;const i=(0,a.concatArrayBuffers)(t,n);return{sidecar:(0,f.calculateStreamingSidecar)(i,r),firstFrameSidecar:Promise.resolve()}}const S=new Map([[_.MEDIA_TYPES.VIDEO,E],[_.MEDIA_TYPES.AUDIO,E],[_.MEDIA_TYPES.STICKER,function(e){let{plaintext:t,ivCiphertext:n,signature:r,macKey:i}=e;const{firstFrameLength:o}=(0,g.parseWebp)(t);return{sidecar:Promise.resolve(),firstFrameSidecar:null!=o?(0,p.default)(o,(0,a.concatArrayBuffers)(n,r),i):Promise.resolve()}}]]);function v(){return(v=(0,i.default)((function*(e,t,n){var r,i;let{iv:a,encKey:d,macKey:p}=n;const f=(0,m.shouldEncryptInChunks)(e.byteLength)?yield(0,o.aesCbcEncryptWithChunking)(d,e,a):yield(0,o.aesCbcEncrypt)(d,e,a),h=new Uint8Array(f).subarray(a.byteLength),_=yield(0,s.hmacSha256)(p,f,10),{sidecar:g=Promise.resolve(),firstFrameSidecar:y=Promise.resolve()}=null!==(r=null===(i=S.get(t))||void 0===i?void 0:i({plaintext:e,ivCiphertext:f,signature:_,macKey:p}))&&void 0!==r?r:{},E=(0,c.concatTypedArrays)(Uint8Array,[h,new Uint8Array(_)]).buffer;return(0,l.promiseProps)({ciphertextHmac:E,hash:(0,u.calculateFilehash)(E),sidecar:g,firstFrameSidecar:y})}))).apply(this,arguments)}},27126:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ImageStreamer=t.EOI_TAG=void 0,t.getProgressiveMediaCacheKey=E;var i=r(n(48926)),a=n(71610),o=n(76100),s=n(95024),l=n(81484),c=n(11141),d=n(40265),u=n(60977),p=n(22565),f=n(84866);class h extends((0,d.customError)("ChunkValidationError")){constructor(e){super(`Chunk ${e} does not match sidecar`)}}const _=16,g=new Uint8Array([2,2]),m=new Uint8Array([255,217]);t.EOI_TAG=m;function y(){return(y=(0,i.default)((function*(e,t){const{encKey:n}=t;return(yield(0,l.aesCbcEncrypt)(n,g,new Uint8Array(e.slice(-16)))).slice(-16)}))).apply(this,arguments)}function E(e,t){return`${e}-progressive-${t}`}t.ImageStreamer=class{constructor(e){this._alignedScanLengths=[],this._increasingScanLengths=[],this._lastDecryptedChunk=0,this._downloadedBytes=new ArrayBuffer(0);const{cryptoKeys:t,scanLengths:n,scansSidecar:r,filehash:i,mimetype:a,debugString:o,onProgressiveUpdate:s}=e;this._cryptoKeys=t,this._scanLengths=n,this._scansSideCar=r,this._filehash=i,this._mimetype=a,this._nextChunkIV=this._cryptoKeys.iv,this._decryptedChunks=new Array(n.length),this._onProgressiveUpdate=s,this._debugString=o}_validateSidecar(e,t){var n=this;return(0,i.default)((function*(){0===t&&(n._nextChunkIV=n._cryptoKeys.iv);const{macKey:r}=n._cryptoKeys,i=n._scansSideCar.slice(10*t,10*t+10),a=n._nextChunkIV;n._nextChunkIV=e.slice(-16);const o=(0,u.concatTypedArrays)(Uint8Array,[new Uint8Array(a),new Uint8Array(e)]),l=yield(0,c.hmacSha256)(r,o,10);if(!(0,s.arrayBuffersDeepEqual)(l,i))throw new h(t)}))()}_cleanupCipherTextAndIV(e,t){var n=this;return(0,i.default)((function*(){let r=e;const i=r.byteLength%_==0;let a;if(0===t)a=n._cryptoKeys.iv;else{const e=n._increasingScanLengths[t-1];a=n._downloadedBytes.slice(e-_,e)}if(i||(r=r.slice(0,r.byteLength-10)),i){const e=yield function(){return y.apply(this,arguments)}(r,n._cryptoKeys);return{cipherText:(0,u.concatTypedArrays)(Uint8Array,[new Uint8Array(r),new Uint8Array(e)]),iv:a}}return{cipherText:r,iv:a}}))()}_getLastFullyLoadedChunkIndex(e){let t=0;for(let n=0;n<this._alignedScanLengths.length;n++)if(t+=this._alignedScanLengths[n],e<t)return n;return this._alignedScanLengths.length}_handleChunk(e,t){var n=this;return(0,i.default)((function*(){yield n._validateSidecar(e,t);const{cipherText:r,iv:i}=yield n._cleanupCipherTextAndIV(e,t),a=yield(0,l.aesCbcDecrypt)(n._cryptoKeys.encKey,i,r),o=yield(0,p.removeEncryptedPadding)(a,g.buffer);return __LOG__(2)`ImageStreamer: [${n._debugString}] Successfully decrypted chunk ${t} of ${n._scanLengths.length} total`,o}))()}_generateBlobFromFullyLoadedChunks(e){var t=this;return(0,i.default)((function*(){var n;const r=yield Promise.all(t._decryptedChunks.slice(0,e)),i=t._scanLengths.slice(0,e).reduce(((e,t)=>e+t),0),a=(0,u.concatTypedArrays)(Uint8Array,r.map((e=>new Uint8Array(e)))).slice(0,i),o=(0,s.arrayBuffersDeepEqual)(m.buffer,a.slice(-m.length).buffer)?a:(0,u.concatTypedArrays)(Uint8Array,[a,m]),l=[o],c=t._mimetype?new Blob(l,{type:t._mimetype}):new Blob(l),d=E(t._filehash,e);return f.MediaBlobCache.put(d,c),__LOG__(2)`ImageStreamer: [${t._debugString}] Generated progressive image using ${e} chunks of ${t._scanLengths.length} total`,null===(n=t._onProgressiveUpdate)||void 0===n||n.call(t,e),t._lastDecryptedChunk=e,o.buffer}))()}_decryptFullyLoadedChunks(e,t){var n=this;return(0,i.default)((function*(){for(let r=0;r<t;r++)if(!n._decryptedChunks[r]){const t=0===r?0:n._increasingScanLengths[r-1],i=e.slice(t,t+n._alignedScanLengths[r]);yield Promise.all(n._decryptedChunks),n._decryptedChunks[r]||(n._decryptedChunks[r]=n._handleChunk(i,r))}}))()}handleProgress(e,t){var n=this;return(0,i.default)((function*(){if(!n._alignedScanLengths.length){n._alignedScanLengths=(0,a.alignChunkLengthsToMultipleOfAesBlockSize)(n._scanLengths,e);for(let e=0;e<n._alignedScanLengths.length;e++){const t=n._alignedScanLengths[e],r=0===e?t:n._increasingScanLengths[e-1]+t;n._increasingScanLengths.push(r)}}const r="string"==typeof t?t.length:t.byteLength,i=n._getLastFullyLoadedChunkIndex(r);if(i<=n._lastDecryptedChunk)return null;try{const e="string"==typeof t?yield(0,o.largeStringToArrayBuffer)(t):t;return n._downloadedBytes=e,yield n._decryptFullyLoadedChunks(n._downloadedBytes,i),yield n._generateBlobFromFullyLoadedChunks(i)}catch(e){__LOG__(3)`ImageStreamer:handleProgress error: ${e}`;const t=`${e.message}, [${n._debugString}]scanLengths length: ${n._scanLengths.length}, scansSidecar byteLength: ${n._scansSideCar.byteLength}.`;e instanceof h?(__LOG__(2)`ImageStreamer:chunk validation error: ${t}`,__LOG__(4,void 0,new Error,!0)`ImageStreamer:chunk validation error`,SEND_LOGS("ImageStreamer:chunk validation error")):(__LOG__(2)`ImageStreamer:handleProgress error: ${t}`,__LOG__(4,void 0,new Error,!0)`ImageStreamer:handleProgress error`,SEND_LOGS("ImageStreamer:handleProgress error"))}}))()}}},15554:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){const e=new Uint8Array(32);return self.crypto.getRandomValues(e),{key:(0,r.encodeB64)(e),timestamp:i.Clock.globalUnixTime()}};var r=n(15688),i=n(40234)},95987:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t;const n=(0,a.generateMediaEventId)(),r=new o.default.MediaDownload2({mediaId:n,connectionType:o.default.CONNECTION_TYPE.HOSTNAME,overallMediaType:(0,a.getMetricMediaType)(e.type),overallMmsVersion:4,networkStack:o.default.NETWORK_STACK_TYPE.NATIVE,overallDownloadMode:(0,a.getMetricOverallDownloadModeType)(e.type),overallAttemptCount:e.userDownloadAttemptCount,overallDownloadOrigin:e.downloadOrigin,overallBackendStore:null!==(t=(0,a.getMetricBackendStore)(e.directPath))&&void 0!==t?t:void 0,isViewOnce:e.isViewOnce});return i.downloadUploadCrashLogger.mark(n,i.ProgressType.DOWNLOAD_STARTED),{mediaId:n,handleDownloadSuccess:e=>{r.set({overallMediaSize:e,overallDownloadResult:o.default.MEDIA_DOWNLOAD_RESULT_TYPE.OK,overallIsFinal:!0,downloadHttpCode:200}),i.downloadUploadCrashLogger.mark(n,i.ProgressType.DOWNLOAD_FINISHED,{overallMediaSize:e})},handleDownloadHostFound:e=>{let{hostName:t,hostClass:n,failCount:i}=e;r.set({overallDomain:t,overallConnectionClass:n,overallRetryCount:i})},handleDownloadError:(e,t)=>{r.set({overallDownloadResult:(0,a.getMetricDownloadErrorResultType)(e),overallIsFinal:t});const n=(0,a.getStatusCode)(e);null!=n&&(r.downloadHttpCode=n),r.markOverallCumT(),r.commit(),(0,a.logErrorUnknownDetails)(r,e)},handleDownloadAttemptSuccess:e=>{r.set({overallT:e})},handleDownloadAttemptError:e=>{let{err:t,overallT:n,failCount:i}=e;const s=new o.default.MediaDownload2(r);s.set({mediaId:(0,a.generateMediaEventId)(),overallDownloadResult:(0,a.getMetricDownloadErrorResultType)(t),overallIsFinal:!1,overallT:n,overallRetryCount:i});const l=(0,a.getStatusCode)(t);null!=l&&(r.downloadHttpCode=l),r.markOverallCumT(),s.commit(),(0,a.logErrorUnknownDetails)(s,t)},handleDownloadAndDecryptSuccess:()=>{r.markOverallCumT(),r.commit()},markDecryptionEnd:()=>{r.markOverallDecryptT()},markDecryptionStart:()=>{r.startOverallDecryptT()}}};var i=n(22200),a=n(29992),o=r(n(11339))},47235:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.DownloadAndDecryptCache=void 0,t.getLRUStoreKey=l;var i=r(n(48926)),a=r(n(34475)),o=n(55975),s=n(56406);function l(e){var t,n;const r=null===(t=e.progressiveJpegOpts)||void 0===t?void 0:t.scanCount,i=null===(n=e.progressiveJpegOpts)||void 0===n?void 0:n.scanLengths;if(null!=r&&i)return`${e.filehash}-${r}/${i.length}-scans`;if(e.partialVideoOpts){const{secondsToDownload:t}=e.partialVideoOpts;return`${e.filehash}-${t}-seconds`}return e.filehash}t.DownloadAndDecryptCache=class{get(e,t){return(0,i.default)((function*(){if(!(0,s.shouldUseLruMediaStore)(t.type))return null;try{return yield o.LruMediaStore.get(l(t))}catch(e){return __LOG__(3,!0)`downloadManager.asyncCache.get error:\n${(0,a.default)(e)}`,null}}))()}set(e,t,n){return(0,i.default)((function*(){if((0,s.shouldUseLruMediaStore)(n.type))try{yield o.LruMediaStore.put(l(n),t)}catch(e){__LOG__(3,!0)`downloadManager.asyncCache.set error:\n${(0,a.default)(e)}`}}))()}}},26384:(e,t,n)=>{"use strict";var r=n(59182).default,i=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.downloadManager=void 0;var a=i(n(81109)),o=i(n(48926)),s=i(n(30844)),l=i(n(45095)),c=n(92574),d=n(35232),u=n(76562),p=i(n(34475)),f=i(n(45007)),h=i(n(95987)),_=i(n(28011)),g=i(n(74994)),m=n(80733),y=n(47235),E=n(22200),S=n(27856),v=n(37115),T=i(n(56747)),b=n(27126),C=n(21009),A=n(61596),P=n(58668),M=i(n(32489)),O=i(n(11339)),I=i(n(39436));const w=1,R=2,D=e=>{switch(e){case A.MEDIA_TYPES.THUMBNAIL_DOCUMENT:return R;case A.MEDIA_TYPES.VIDEO:default:return w}};function L(){return N.apply(this,arguments)}function N(){return(N=(0,o.default)((function*(e){const{directPath:t,encFilehash:n,filehash:i,mediaKey:a,onDecryptStart:o,downloadOrigin:s,staticUrl:c,type:d,mode:u,progressiveJpegOpts:f,partialVideoOpts:y,onProgress:v,userDownloadAttemptCount:C,isViewOnce:A}=e,{handleDownloadSuccess:P,handleDownloadHostFound:M,handleDownloadError:O,handleDownloadAttemptSuccess:w,handleDownloadAttemptError:R,handleDownloadAndDecryptSuccess:D,markDecryptionStart:L,markDecryptionEnd:N,mediaId:k}=(0,h.default)({directPath:t,downloadOrigin:s,type:d,userDownloadAttemptCount:C,isViewOnce:A}),U=e.signal||(new r).signal,G=i.slice(0,10);__LOG__(2)`downloadManager.download: [${G}] start`;try{const e=null==f?void 0:f.scanCount,r=null!=e&&e===(null==f?void 0:f.scanLengths.length)?null:e;let s=null;const p=(0,T.default)({partialVideoOpts:y,progressiveJpegOpts:f,scanCount:r}),h=null==r&&f?(e,t)=>{var n;null===(n=s)||void 0===n||n.handleProgress(e.total,t)}:null,[S,C,A]=yield Promise.all([(0,_.default)(d,a).then((e=>(f&&(s=new b.ImageStreamer({cryptoKeys:e,scanLengths:f.scanLengths,scansSidecar:f.scansSidecar,mimetype:f.mimetype,filehash:i,debugString:G,onProgressiveUpdate:f.onProgressiveUpdate})),e))),B({scanCount:r,directPath:t,encFilehash:n,type:d,signal:U}),I.default.download({directPath:t,encFilehash:n,staticUrl:c,type:d,signal:U,mode:u,byteRange:p,onResponseText:h,onDownloadHostFound:M,onDownloadAttemptSuccess:w,onDownloadAttemptError:R,debugString:G,onProgress:v})]);let O;var x;if(o&&o(),P(A.byteLength),E.downloadUploadCrashLogger.mark(k,E.ProgressType.DOWNLOAD_DECRYPTION_STARTED),L(),null!=r)O=(0,l.default)(yield null===(x=s)||void 0===x?void 0:x.handleProgress(C,A),"yield imageStreamer?.handleProgress(encryptedFileSize, ciphertextHmac)");else O=y?yield(0,m.decryptPartialMedia)({mediaKeys:S,ciphertext:A}):yield(0,g.default)({mediaKeys:S,ciphertextHmac:A,expectedPlaintextHash:i,debugString:G});return N(),E.downloadUploadCrashLogger.mark(k,E.ProgressType.DOWNLOAD_DECRYPTION_FINISHED),__LOG__(2)`downloadManager.download: [${G}] success`,D(),O}catch(t){throw t instanceof S.MediaNotFoundError?(O(t,Boolean(e.isFinalRmrRetry)),__LOG__(2,!0)`downloadManager.download: [${G}] expected error\n${(0,p.default)(t)}`):(O(t,!0),__LOG__(3,!0)`downloadManager.download: [${G}] error\n${(0,p.default)(t)}`),E.downloadUploadCrashLogger.mark(k,E.ProgressType.DOWNLOAD_ERROR),t}}))).apply(this,arguments)}function k(){return U.apply(this,arguments)}function U(){return(U=(0,o.default)((function*(e){var t,n;const{mediaObject:r}=e,i=null!==(t=null===(n=r.filehash)||void 0===n?void 0:n.slice(0,10))&&void 0!==t?t:"";r.filehash,r.type,__LOG__(2)`downloadManager.rmr: [${i}] start`,r.consolidate({downloadStage:P.DOWNLOAD_STAGE.REUPLOADING});const o=performance.now(),s=new O.default.WebcMediaRmr((0,a.default)((0,a.default)({},e.rmrData),{},{webcRmrReason:e.rmrReason})),l=(0,u.getEffectiveNetworkType)();null!=l&&(s.webcBrowserNetworkType=l),r.type&&(s.messageMediaType=(0,C.webMediaTypeToWamMediaType)(r.type)),null!=r.size&&(s.webcMediaSize=r.size);try{const e=yield r.rmr({onMsgSelect:function(e){null==s.webcChatType&&e.chat&&(s.webcChatType=e.chat.getWebcChatType()),null==s.webcMessageT&&(s.webcMessageT=e.t),s.messageMediaType=e.getWamMediaType()}});if(s.webcRmrStatusCode=e,__LOG__(2)`downloadManager.rmr: [${i}] status ${e}`,404===e)throw new v.MediaNotOnPhone;if(200!==e)throw new c.ServerStatusCodeError(e)}catch(e){throw s.webcMediaRmrError=!0,e instanceof v.MediaNotOnPhone?(__LOG__(2,!0)`downloadManager.rmr: [${i}] error MediaNotOnPhone\n${(0,p.default)(e)}`,e):(__LOG__(3,!0)`downloadManager.rmr: [${i}] error ${e.status||e.message}\n${e.stack}`,new d.MediaNeedsReupload)}finally{s.webcMediaRmrT=Math.ceil(performance.now()-o),s.commit()}}))).apply(this,arguments)}function G(){return x.apply(this,arguments)}function x(){return(x=(0,o.default)((function*(e){const{directPath:t,encFilehash:n,signal:i,type:a}=e;yield I.default.checkExistence({directPath:t,encFilehash:n,type:a,signal:i||(new r).signal})}))).apply(this,arguments)}function B(e){const{scanCount:t,directPath:n,encFilehash:r,type:i,signal:a}=e;return null==t?Promise.resolve(null):I.default.getEncryptedMediaSize({directPath:(0,l.default)(n,"directPath is required for partial downloads"),encFilehash:(0,l.default)(r,"encFilehash is required for partial downloads"),signal:a,type:i})}const F=new class{constructor(){this.preloader=new s.default(10,{thumbnail:4}),this.downloadAndDecrypt=(0,f.default)((e=>(0,y.getLRUStoreKey)(e)),new y.DownloadAndDecryptCache,(e=>!0===e.isPreload?this.preloader.enqueue((()=>L(e)),{priority:-D(e.type),group:"thumbnail",signal:e.signal}):L(e))),this.rmr=(0,M.default)((e=>e.mediaObject.filehash||""),k),this.checkExistence=(0,M.default)((e=>e.encFilehash),G),E.downloadUploadCrashLogger.init()}};t.downloadManager=F},37115:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MediaNotOnPhone=void 0;var r=n(92574);class i extends r.ServerStatusCodeError{constructor(){super(404),this.name="MediaNotOnPhone"}}t.MediaNotOnPhone=i},56747:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let{partialVideoOpts:t,progressiveJpegOpts:n,scanCount:a}=e;if(n&&null!=a)return{start:0,end:(0,r.alignChunkLengthsToMultipleOfAesBlockSize)(n.scanLengths).slice(0,a).reduce(((e,t)=>e+t),0)};if(t){const{video:{size:e,duration:n},secondsToDownload:r}=t,a=Math.max(e*r/n,131072);return{start:0,end:Math.ceil(a/i.BLOCK_SIZE)*i.BLOCK_SIZE-1}}return null};var r=n(71610),i=n(80733)},40859:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NoMediaHostsError=void 0;var r=n(40265);class i extends((0,r.customError)("NoMediaHostsError")){}t.NoMediaHostsError=i},46640:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={mediaHosts:!0};Object.defineProperty(t,"mediaHosts",{enumerable:!0,get:function(){return i.mediaHosts}});var i=n(82828);Object.keys(i).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===i[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}}))}))},51320:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.THRESHOLD=void 0,t.maybeSwitchHost=function(e,t,n,o){let{selectedHost:s,fallbackHost:l}=t,{selectedHost:c,fallbackHost:d}=n;if(o<i)return{changed:!1,host:e};switch(e.type){case r.HOST_TYPE.PRIMARY:if(!e.equals(c))return{changed:!0,host:c};break;case r.HOST_TYPE.FALLBACK:if(!s.equals(c))return{changed:!0,host:c};if(a(e,l,d)||a(e,s.fallback,c.fallback))return{changed:!0,host:s}}return{changed:!1,host:e}};var r=n(17930);const i=52428800;function a(e,t,n){return e.equals(t)&&null!=n&&null!=t&&!t.equals(n)}t.THRESHOLD=i},17930:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.MediaHost=t.HOST_TYPE=void 0;var i=r(n(81109)),a=n(61596);const o=new Set(a.MEDIA_TYPE_VALUES),s=Object.freeze({PRIMARY:"primary",FALLBACK:"fallback"});t.HOST_TYPE=s;class l{constructor(e){this.hostname=e.hostname,this.ips=e.ips||[],this.type=e.type,this.class=e.class;const{downloadBuckets:t,supportedDownloadTypes:n,supportedUploadTypes:r}=function(e){var t,n;const r=e||[];let i,a,s;for(const e of r){if(e.download){var l;i=null!==(l=i)&&void 0!==l?l:new Set;for(const t of e.download)i.add(t)}if(e.upload){var c;a=null!==(c=a)&&void 0!==c?c:new Set;for(const t of e.upload)a.add(t)}e.downloadBuckets&&(s=e.downloadBuckets.map((e=>parseInt(e,10))))}return{supportedDownloadTypes:null!==(t=i)&&void 0!==t?t:o,supportedUploadTypes:null!==(n=a)&&void 0!==n?n:o,downloadBuckets:s}}(e.rules);this.downloadBuckets=t,this._supportedDownloadTypes=n,this._supportedUploadTypes=r,this.fallback=null!=e.fallback?new l((0,i.default)((0,i.default)((0,i.default)({},e),e.fallback),{},{type:"fallback",fallback:void 0})):null}equals(e){return this.hostname===(null==e?void 0:e.hostname)}isFallback(){return this.type===s.FALLBACK}supportsDownloadMediaType(e){return this._supportedDownloadTypes.has(e)}supportsUploadMediaType(e){const t="product-catalog-image"===e?"product":e;return this._supportedUploadTypes.has(t)}}t.MediaHost=l},82828:(e,t,n)=>{"use strict";var r=n(59182).default,i=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.mediaHosts=t.FETCH_STATE=void 0;var a=i(n(6479)),o=i(n(48926)),s=n(89385),l=n(92574),c=n(81806),d=n(40859),u=n(17930),p=i(n(32489)),f=n(13611),h=n(70426);const _=["forceRefresh"],g=["name","message","stack"];t.FETCH_STATE={PENDING:"PENDING",SUCCESS:"SUCCESS",ERROR:"ERROR"};const m=new class{constructor(){var e=this;this._locked=!1,this._fetch=(0,p.default)((()=>"all"),function(){var t=(0,o.default)((function*(t){let{signal:n}=t;try{const t=yield(0,f.sendQueryMediaConn)(n);e._err=null,e._data={auth:t.auth,authExpirationTime:new Date(t.queryStartTime.getTime()+t.authTTL),authTTL:t.authTTL,hosts:t.hosts.map((e=>new u.MediaHost(e))),hostsRefreshTime:new Date(t.queryStartTime.getTime()+t.ttl),queryStartTime:t.queryStartTime,maxBuckets:t.maxBuckets}}catch(t){const i=t;var r;if(i instanceof l.E507)return e._data=e._previousData,e._previousData=null,e._locked=!0,void setTimeout((0,o.default)((function*(){yield e._refreshIfStale({signal:n}),e._locked=!1})),null!==(r=i.backoff)&&void 0!==r?r:void 0);if(e._data=null,e._err=i,i.name===s.ABORT_ERROR)return void __LOG__(2)`mediaHosts.sendQueryMediaConn aborted`;__LOG__(3,!0)`mediaHosts.sendQueryMediaConn error: ${function(e){const{name:t,message:n,stack:r}=e,i=(0,a.default)(e,g),o=(0,c.normalizeStack)(e),s=o.slice(o.indexOf("\n")+1),l=0===Object.keys(i).length?"":" "+JSON.stringify(i,((e,t)=>e&&"object"==typeof t?String(t):t));return`${e.name||"Error"}: ${e.message}${l}\n${s}`}(i)}`,__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("Error fetching mms hosts")}}));return function(){return t.apply(this,arguments)}}()),this._reset()}getHostsInfo(e){var t=this;let{directPath:n,encFilehash:i,operation:a,type:s,signal:l,forceRefresh:c=!1}=e;return(0,o.default)((function*(){if(!t._locked){const e={signal:l||(new r).signal,forceRefresh:c};yield t._refreshIfStale(e)}if(!t._data)throw new d.NoMediaHostsError("no fetched data");const{auth:e,hosts:o,maxBuckets:u}=t._data,{selectedHost:p,fallbackHost:f}=(0,h.routeSelection)({directPath:n,encFilehash:i,hosts:o,operation:a,type:s,maxBuckets:u});if(!p)throw new d.NoMediaHostsError("no selected host");return{auth:e,selectedHost:p,fallbackHost:f}}))()}_isExpiredOrMissing(){if(!this._data)return!0;const e=this._data;return new Date>=e.authExpirationTime}_needsRefresh(){if(!this._data)return!0;const e=this._data;if(new Date>=e.hostsRefreshTime)return!0;const{authTTL:t,queryStartTime:n}=e,r=Math.floor(.8*t),i=new Date(n.getTime()+r);return new Date>=i}_refreshIfStale(e){var t=this;let{forceRefresh:n}=e,r=(0,a.default)(e,_);return(0,o.default)((function*(){return t._isExpiredOrMissing()||n?(t._reset(),yield t._fetch(r),!0):!!t._needsRefresh()&&(t._fetch(r),!1)}))()}_reset(){this._previousData=this._data,this._data=null,this._err=null}};t.mediaHosts=m},70426:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.OPERATIONS=void 0,t.routeSelection=function(e){var t,n;let r,{encFilehash:c,directPath:d,hosts:u,operation:p,type:f,maxBuckets:h}=e;if(!u.length)return{selectedHost:null,fallbackHost:null};if(p===l.DOWNLOAD){const e=d?d.match(/&_nc_hot=([0-9]+)/):null,t=parseInt(null==e?void 0:e[1],10),n=Number.isNaN(t)?null:(0,a.unixTime)()-t,{mmsHotContentTimespan:l,mmsVCacheAggregationEnabled:p}=s.ServerProps;let _;null!=l&&l>0&&(f===o.MEDIA_TYPES.STICKER||null!=n&&n<=l)?_=1:p&&null!=h&&(_=(0,i.default)(c,h)+100);const g=function(e){const t=new Map;return e.forEach((e=>{var n;null===(n=e.downloadBuckets)||void 0===n||n.forEach((n=>{t.set(n,e)}))})),t}(u),m=null==_?null:g.get(_),y=g.get(0);(null==m?void 0:m.supportsDownloadMediaType(f))?r=m:(null==y?void 0:y.supportsDownloadMediaType(f))&&(r=y)}const _=u.find((e=>e.isFallback()));return r=null!==(t=r)&&void 0!==t?t:u.find((e=>p===l.UPLOAD?e.supportsUploadMediaType(f):e.supportsDownloadMediaType(f))),{selectedHost:null!==(n=r)&&void 0!==n?n:null,fallbackHost:null!=_?_:null}};var i=r(n(13353)),a=n(92844),o=n(61596),s=n(64551);const l={DOWNLOAD:"DOWNLOAD",UPLOAD:"UPLOAD"};t.OPERATIONS=l},27856:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MediaTooLargeError=t.MediaNotFoundError=t.MediaInvalidError=t.MMSUnauthorizedError=t.MMSThrottleError=t.MMSForbiddenError=void 0;var r=n(23082);class i extends r.HttpStatusCodeError{constructor(e){super(404,e),this.name="MediaNotFoundError"}}t.MediaNotFoundError=i;class a extends r.HttpStatusCodeError{constructor(e){super(413,e),this.name="MediaTooLargeError"}}t.MediaTooLargeError=a;class o extends r.HttpStatusCodeError{constructor(e){super(415,e),this.name="MediaInvalidError"}}t.MediaInvalidError=o;class s extends r.HttpStatusCodeError{constructor(e){super(401,e),this.name="MMSUnauthorizedError"}}t.MMSUnauthorizedError=s;class l extends r.HttpStatusCodeError{constructor(e){super(403,e),this.name="MMSForbiddenError"}}t.MMSForbiddenError=l;class c extends r.HttpStatusCodeError{constructor(e){super(507,e),this.name="MMSThrottleError"}}t.MMSThrottleError=c},21081:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let{directPath:t,encFilehash:n,hostname:r,type:l,mode:c,byteRange:d}=e;if(t)return function(e){let{directPath:t,encFilehash:n,hostname:r,query:a}=e;const o=new URL(t,`https://${r}`);if(o.hostname!==r)throw __LOG__(4,void 0,new Error,!0)`url.hostname: ${o.hostname}, hostname: ${r}, directPath: ${t}`,SEND_LOGS("malicious directPath"),new Error("malicious directPath");const l=o.searchParams||new s.default(o.search);return l.set("hash",(0,i.default)(n)),Object.keys(a).forEach((e=>{const t=a[e];null!=t&&l.set(e,t)})),`https://${o.host}${o.pathname}?${l.toString()}`}({encFilehash:n,hostname:r,directPath:t,query:{mode:c,bytestart:null==d?void 0:d.start.toString(),byteend:null==d?void 0:d.end.toString(),[o.MMS_URL_MEDIA_TYPE_SEARCH_PARAM]:l,[o.IS_MMS_URL_SEARCH_PARAM]:""}});return(0,a.default)({hostname:r,type:l,encFilehash:n,query:{mode:c,[o.IS_MMS_URL_SEARCH_PARAM]:""}})};var i=r(n(27194)),a=r(n(43311)),o=n(95770),s=r(n(53565))},43311:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let{hostname:t,type:n,encFilehash:r,query:l}=e;const c=(0,a.default)(s[n],"MEDIA_TYPE_TO_PATH[type]"),d=new URL(`https://${t}${c}/${(0,i.default)(r)}`),u={};l&&Object.keys(l).forEach((e=>{null!=l[e]&&(u[e]=l[e])}));let p=new o.default(u).toString();p&&(p=`?${p}`);return`https://${d.host}${d.pathname}${p}`};var i=r(n(27194)),a=r(n(45095)),o=r(n(53565));const s={audio:"/mms/audio",document:"/mms/document",gif:"/mms/gif",image:"/mms/image",ppic:"/pps/photo",product:"/mms/image",ptt:"/mms/ptt",sticker:"/mms/sticker","thumbnail-document":"/mms/thumbnail-document","thumbnail-link":"/mms/thumbnail-link",video:"/mms/video","md-app-state":"/mms/md-app-state","product-catalog-image":"/product/image"}},42594:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t,n;let{auth:r,encFilehash:o,hostname:s,query:l,type:c,byteRange:d}=e;const u=null==l?void 0:l.final_hash;return(0,a.default)({encFilehash:o,hostname:s,type:c,query:{auth:r,token:(0,i.default)(o),resume:null==l||null===(t=l.resume)||void 0===t?void 0:t.toString(10),stream:null==l||null===(n=l.stream)||void 0===n?void 0:n.toString(10),final_hash:null!=u?(0,i.default)(u):void 0,bytestart:null==d?void 0:d.start.toString(10),byteend:null==d?void 0:d.end.toString(10)}})};var i=r(n(27194)),a=r(n(43311))},39436:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={};Object.defineProperty(t,"default",{enumerable:!0,get:function(){return i.default}});var i=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=a(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=i?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(r,o,s):r[o]=e[o]}r.default=e,n&&n.set(e,r);return r}(n(27276));function a(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(a=function(e){return e?n:t})(e)}Object.keys(i).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===i[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}}))}))},5489:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(e instanceof i.MMSThrottleError)return!1;return e instanceof a.NoMediaHostsError||e instanceof r.HttpNetworkError||e instanceof i.MMSUnauthorizedError||e instanceof r.HttpStatusCodeError&&e.status>=500};var r=n(23082),i=n(27856),a=n(40859)},87206:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={minTimeout:1e3,retries:3};t.default=n},79306:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return d.apply(this,arguments)};var i=r(n(48926)),a=n(23082),o=n(27856),s=r(n(19242)),l=n(36823);const c="complete";function d(){return(d=(0,i.default)((function*(e){const t={encFilehash:e.encFilehash,type:e.type};__LOG__(2)`mmsCheckIfUploadExists: start`;try{const t=yield(0,s.default)(e),{directPath:n,url:r,handle:i,resume:l}=t;if(l===c){if(null==n||""===n)throw new a.HttpInvalidResponseError("mmsCheckIfUploadExists: missing directPath");if(null==r||""===r)throw new a.HttpInvalidResponseError("mmsCheckIfUploadExists: missing url");return __LOG__(2)`mmsCheckIfUploadExists: success`,{directPath:n,url:r,handle:i,complete:!0}}const d=parseInt(l,10);if(0===d)throw new o.MediaNotFoundError("mmsCheckIfUploadExists");if(Number.isNaN(d))throw __LOG__(4,void 0,new Error,!0)`mmsCheckIfUploadExists: resume is NaN, resume=${d}`,SEND_LOGS("upload-offset-is-NaN"),new a.HttpInvalidResponseError("mmsCheckIfUploadExists: invalid resume");return{complete:!1,resume:d}}catch(e){throw(0,l.mmsLogError)("mmsCheckIfUploadExists",e,t),e}}))).apply(this,arguments)}},27276:(e,t,n)=>{"use strict";var r=n(59182).default,i=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(n(81109)),o=i(n(48926)),s=i(n(45095)),l=i(n(81602)),c=n(19770),d=i(n(5489)),u=n(46640),p=n(61596),f=i(n(11339)),h=i(n(87206)),_=i(n(79306)),g=i(n(87439)),m=n(84062),y=n(36823),E=i(n(72702)),S=i(n(22283)),v=n(74641),T=i(n(6704)),b=i(n(29049)),C=i(n(66717)),A=n(29908);function P(){return(P=(0,o.default)((function*(e){const{encFilehash:t,signal:n,type:r}=e;let i=!1;const s={encFilehash:e.encFilehash,type:e.type};__LOG__(2)`mmsClient.checkIfUploadExists: start`;try{let e=null;const s=yield(0,c.exponentialBackoff)((0,a.default)((0,a.default)({},h.default),{},{signal:n}),function(){var a=(0,o.default)((function*(a,o){__LOG__(2)`mmsClient.checkIfUploadExists: attempt #${o+1}`,yield l.default.waitIfOffline({signal:n});try{const{auth:a,selectedHost:s,fallbackHost:l}=yield u.mediaHosts.getHostsInfo({operation:S.default.UPLOAD,encFilehash:t,type:r,signal:n}),c=(0,C.default)({selectedHost:s,fallbackHost:l,lastHostUsed:e,attemptCount:o,lastFetchMadeProgress:i});return e=c,yield(0,_.default)({auth:a,encFilehash:t,hostname:c.hostname,type:r,signal:n,onProgress:()=>{i=!0}})}catch(e){if((0,d.default)(e))return a(e);throw e}}));return function(){return a.apply(this,arguments)}}());return __LOG__(2)`mmsClient.checkIfUploadExists: success`,s}catch(e){throw(0,y.mmsLogError)("mmsClient.checkIfUploadExists",e,s),e}}))).apply(this,arguments)}function M(){return(M=(0,o.default)((function*(e){const{encFilehash:t,type:n,onUploadAttemptSuccess:r}=e;__LOG__(2)`mmsClient.upload: start`;try{if((0,A.shouldUseStreamingUpload)(e.ciphertextHmac.byteLength,e.type)){const t=new A.UploadStreamer(e);return yield t.upload()}const{response:t,retryStartTime:n}=yield k(e);return r(Date.now()-n),__LOG__(2)`mmsClient.upload: success`,(0,s.default)(t,"response")}catch(e){throw(0,y.mmsLogError)("mmsClient.upload",e,{encFilehash:t,type:n},!1),e}}))).apply(this,arguments)}function O(){return(O=(0,o.default)((function*(e){const{directPath:t,encFilehash:n,type:r,debugString:i,staticUrl:a,onDownloadAttemptSuccess:o}=e;__LOG__(2)`mmsClient.download: [${i}] start`;try{const{response:t,retryStartTime:n}=yield R(e);return o(Date.now()-n),__LOG__(2)`mmsClient.download: [${i}] success`,t}catch(e){throw(0,y.mmsLogError)("mmsClient.download",e,{directPath:t,encFilehash:n,type:r,staticUrl:a}),e}}))).apply(this,arguments)}function I(e,t){const{directPath:n,encFilehash:r,type:i,signal:s}=t;return __LOG__(2)`runTaskWithBackoff: start`,(0,c.exponentialBackoff)((0,a.default)((0,a.default)({},h.default),{},{signal:s}),function(){var t=(0,o.default)((function*(t,a){__LOG__(2)`runMmsTaskWithBackoff: attempt #${a+1}`;try{const t=yield function(){return w.apply(this,arguments)}({operation:S.default.DOWNLOAD,directPath:n,encFilehash:r,type:i,signal:s,failCount:a});return yield e(t)}catch(e){if((0,d.default)(e))return t(e);throw e}}));return function(){return t.apply(this,arguments)}}())}function w(){return(w=(0,o.default)((function*(e){const{failCount:t,operation:n,directPath:r,encFilehash:i,type:a,signal:o}=e,{selectedHost:s,fallbackHost:l}=yield u.mediaHosts.getHostsInfo({operation:n,directPath:r,encFilehash:i,type:a,signal:o});return(t>=2&&l?l:s).hostname}))).apply(this,arguments)}function R(){return D.apply(this,arguments)}function D(){return(D=(0,o.default)((function*(e){let{debugString:t,signal:n,directPath:i,encFilehash:l,staticUrl:p,type:f,onDownloadHostFound:_,mode:g,byteRange:y,onDownloadAttemptError:E,onResponseText:A,onProgress:P}=e,M=Date.now(),O=!1,I=null;const w=yield(0,c.exponentialBackoff)((0,a.default)((0,a.default)({},h.default),{},{signal:n}),function(){var e=(0,o.default)((function*(e,a){M=Date.now(),__LOG__(2)`mmsClient.download: [${t}] attempt #${a+1}`;const s=e=>u.mediaHosts.getHostsInfo({operation:S.default.DOWNLOAD,directPath:i,encFilehash:l,type:f,signal:n,forceRefresh:e});try{const{selectedHost:e,fallbackHost:c}=yield s();let d=(0,C.default)({selectedHost:e,fallbackHost:c,attemptCount:a,lastHostUsed:I,lastFetchMadeProgress:O});I=d,_({hostName:d.hostname,hostClass:d.class,failCount:a});let u=0,h=null;const E={selectedHost:e,fallbackHost:c},S=e=>{if(null!=e&&null==h){const t=e.get("Content-Length"),n=parseInt(t,10);h=Number.isNaN(n)?null:n}};return yield(0,b.default)(function(){var e=(0,o.default)((function*(e){let{retry:a,failCount:o}=e;const c=e=>{null==P||P(e),O=!0,e.lengthComputable&&(u=e.loaded)};u=0;const _=new r,{signal:b}=_,C=yield(0,T.default)([n,b],(e=>{const n=(0,m.mms4Download)({directPath:i,encFilehash:l,staticUrl:p,hostname:d.hostname,type:f,signal:e,mode:g,byteRange:y,debugString:t,onHeadersReceived:S,onProgress:c,onResponseText:A}).then((e=>({kind:"download-completed",arrayBuffer:e}))),r=(0,v.shouldPollDownloadHosts)(f,h)?(0,v.pollMediaHosts)({connectionBlock:E,getHost:()=>d,getMediaHosts:()=>s(!0),getRemainingBytes:()=>null!=h?h-u:null,signal:e}).then((e=>({kind:"host-changed",host:e}))):null;return Promise.race([n,r].filter(Boolean)).finally((()=>_.abort()))}));return"host-changed"===C.kind?(d=C.host,I=d,a()):C.arrayBuffer}));return function(){return e.apply(this,arguments)}}())}catch(t){O=!1;const n=(0,d.default)(t);if(!n||a===h.default.retries||E({err:t,overallT:Date.now()-M,failCount:a}),n)return e(t);throw t}}));return function(){return e.apply(this,arguments)}}());return{response:(0,s.default)(w,"response"),retryStartTime:M}}))).apply(this,arguments)}function L(){return N.apply(this,arguments)}function N(){return(N=(0,o.default)((function*(e){let{auth:t,encFilehash:n,hostname:r,type:i,signal:a,byteLength:o,byteOffset:s,failCount:l}=e;if(null!=s&&0===l)return s;if(!(0,v.shouldPollUploadHosts)(i,o))return 0;try{const e=yield(0,_.default)({auth:t,encFilehash:n,hostname:r,type:i,signal:a});if(e.complete)return 0;const{resume:s}=e;return s>=o?0:s}catch(e){return __LOG__(4,!0,new Error,!0)`Failed to compute upload offset`,SEND_LOGS("upload-offset-failed"),0}}))).apply(this,arguments)}function k(){return U.apply(this,arguments)}function U(){return(U=(0,o.default)((function*(e){const{ciphertextHmac:t,encFilehash:n,type:i,signal:s,onUploadHostFound:p,onUploadAttemptError:_,onProgress:g,byteOffset:m}=e;let y=!1,A=Date.now(),P=null;return{response:yield(0,c.exponentialBackoff)((0,a.default)((0,a.default)({},h.default),{},{signal:s}),function(){var e=(0,o.default)((function*(e,a){const c=e=>u.mediaHosts.getHostsInfo({operation:S.default.UPLOAD,encFilehash:n,type:i,signal:s,forceRefresh:e});A=Date.now(),__LOG__(2)`mmsClient.upload: attempt #${a+1}`;try{yield l.default.waitIfOffline({signal:s});const{auth:e,selectedHost:d,fallbackHost:u}=yield c(),f={selectedHost:d,fallbackHost:u};let h=(0,C.default)({selectedHost:d,fallbackHost:u,attemptCount:a,lastHostUsed:P,lastFetchMadeProgress:y});return P=h,p({hostName:h.hostname,hostClass:h.class,failCount:a}),yield(0,b.default)(function(){var l=(0,o.default)((function*(o){let{retry:l}=o;const d=yield L({auth:e,encFilehash:n,byteLength:t.byteLength,hostname:h.hostname,type:i,signal:s,byteOffset:m,failCount:a}),u=new r,{signal:p}=u,_=yield(0,T.default)([s,p],(r=>{const a=(0,v.shouldPollUploadHosts)(i,t.byteLength)?(0,v.pollMediaHosts)({connectionBlock:f,getHost:()=>h,getMediaHosts:()=>c(!0),getRemainingBytes:()=>t.byteLength,signal:r}).then((e=>({kind:"host-changed",host:e}))):null,o=(0,E.default)({auth:e,ciphertextHmac:d>0?new Uint8Array(t).subarray(d):t,hostname:h.hostname,encFilehash:n,type:i,signal:s,onProgress:e=>{y=!0,g(e,d)},byteRange:d>0?{start:d,end:t.byteLength}:void 0}).then((e=>({kind:"upload-completed",value:e})));return Promise.race([o,a].filter(Boolean)).finally((()=>u.abort()))}));return"host-changed"===_.kind?(h=_.host,P=h,l()):_.value}));return function(){return l.apply(this,arguments)}}())}catch(t){y=!1;const n=(0,d.default)(t);if(!n||a===h.default.retries||_(t,Date.now()-A,a,f.default.OVERALL_LAST_UPLOAD_RETRY_PHASE_TYPE.UPLOAD),n)return e(t);throw t}}));return function(){return e.apply(this,arguments)}}()),retryStartTime:A}}))).apply(this,arguments)}function G(){return(G=(0,o.default)((function*(e){const{failCount:t,operation:n,directPath:r,encFilehash:i,type:a,signal:o}=e,{selectedHost:s,fallbackHost:l,auth:c}=yield u.mediaHosts.getHostsInfo({operation:n,directPath:r,encFilehash:i,type:a,signal:o});return{hostname:(t>=2&&l?l:s).hostname,auth:c}}))).apply(this,arguments)}var x={download:function(){return O.apply(this,arguments)},upload:function(){return M.apply(this,arguments)},checkExistence:function(e){return I((t=>(0,m.mmsCheckExistence)((0,a.default)((0,a.default)({},e),{},{hostname:t}))),e)},getEncryptedMediaSize:function(e){return I((t=>(0,m.mmsGetEncryptedMediaSize)((0,a.default)((0,a.default)({},e),{},{hostname:t}))),e)},checkIfUploadExists:function(){return P.apply(this,arguments)},deleteMdHistorySyncBlob:function(e){const{directPath:t,encFilehash:n}=e;return function(e,t){const{directPath:n,encFilehash:r,type:i,signal:s,operation:l}=t;return __LOG__(2)`runTaskWithBackoff: start`,(0,c.exponentialBackoff)((0,a.default)((0,a.default)({},h.default),{},{signal:s}),function(){var t=(0,o.default)((function*(t,a){__LOG__(2)`runMmsTaskWithBackoff: attempt #${a+1}`;try{const{hostname:t,auth:o}=yield function(){return G.apply(this,arguments)}({operation:l,directPath:n,encFilehash:r,type:i,signal:s,failCount:a});return yield e(t,o)}catch(e){if((0,d.default)(e))return t(e);throw e}}));return function(){return t.apply(this,arguments)}}())}(((e,r)=>(0,g.default)({directPath:t,hostname:e,encFilehash:n,auth:r})),(0,a.default)((0,a.default)({},e),{},{type:p.MEDIA_TYPES.IMAGE,operation:S.default.UPLOAD}))}};t.default=x},87439:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return u.apply(this,arguments)};var i=r(n(48926)),a=n(15688),o=r(n(27194)),s=n(23082),l=r(n(26847)),c=r(n(43311)),d=n(61596);function u(){return(u=(0,i.default)((function*(e){const{directPath:t,encFilehash:n,hostname:r,auth:i}=e,u=t.split("?")[0],p=(new TextEncoder).encode(u),f=(0,a.encodeB64UrlSafe)(p),h=(0,c.default)({encFilehash:n,hostname:r,type:d.MEDIA_TYPES.IMAGE,query:{token:(0,o.default)(n),d_md:f,auth:i}}),_=yield(0,l.default)(h,{method:"DELETE"});if(!_.ok)throw new s.HttpStatusCodeError(_.status,"MMS Delete error")}))).apply(this,arguments)}},84062:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.mms4Download=function(e){let{directPath:t,encFilehash:n,staticUrl:r,hostname:a,type:o,signal:l,onProgress:c,onResponseText:u,onHeadersReceived:f,mode:h,byteRange:_,debugString:g}=e;const m=r||(0,d.default)({directPath:t,encFilehash:n,hostname:a,type:o,mode:h,byteRange:_});return function(){return p.apply(this,arguments)}({url:m,signal:l,onHeadersReceived:f,onProgress:c,onResponseText:u,ciphertextValidator:_?null:function(){var e=(0,i.default)((function*(e){return(yield(0,s.calculateFilehash)(e))===n}));return function(){return e.apply(this,arguments)}}(),debugString:g,debug:{encFilehash:n,type:o,url:m}})},t.mmsCheckExistence=function(){return f.apply(this,arguments)},t.mmsGetEncryptedMediaSize=function(){return h.apply(this,arguments)},t.validateMmsResponse=_;var i=r(n(48926)),a=n(23082),o=n(35232),s=n(18309),l=n(27856),c=n(61181),d=r(n(21081)),u=n(36823);function p(){return(p=(0,i.default)((function*(e){let{url:t,signal:n,onHeadersReceived:r,onProgress:i,onResponseText:o,debug:s,debugString:l,ciphertextValidator:d}=e;__LOG__(2)`mmsDownload: [${l}] start`;try{const e=yield(0,c.extendedFetch)(t,{signal:n,onProgress:i,onResponseText:o,onHeadersReceived:r});yield _({response:e,functionName:"mmsDownload",url:t});const s=yield e.arrayBuffer();if(d&&!(yield d(s)))throw __LOG__(3)`download hash mismatch error. downloaded size: ${s.byteLength}`,new a.MmsDownloadFilehashMismatchError({url:t});return __LOG__(2)`mmsDownload: [${l}] success`,s}catch(e){throw(0,u.mmsLogError)("mmsDownload",e,s),e}}))).apply(this,arguments)}function f(){return(f=(0,i.default)((function*(e){const{directPath:t,encFilehash:n,hostname:r,type:i,signal:a}=e;yield m({directPath:t,encFilehash:n,hostname:r,type:i,signal:a,functionName:"mmsCheckExistence"})}))).apply(this,arguments)}function h(){return(h=(0,i.default)((function*(e){const{directPath:t,encFilehash:n,hostname:r,type:i,signal:a}=e,s=(yield m({directPath:t,encFilehash:n,hostname:r,type:i,signal:a,functionName:"mmsGetEncryptedMediaSize"})).headers.get("content-length");if(!s)throw new o.UnableToGetContentLengthError;return parseInt(s,10)}))).apply(this,arguments)}function _(){return g.apply(this,arguments)}function g(){return(g=(0,i.default)((function*(e){const{response:t,url:n,functionName:r}=e;if(!t.ok)switch(t.status){case 401:throw new l.MMSUnauthorizedError(r,{url:n});case 403:if((yield t.text()).includes("URL signature expired"))throw new l.MediaNotFoundError(r,{url:n,status:t.status});throw new l.MMSForbiddenError(r,{url:n});case 404:case 410:throw new l.MediaNotFoundError(r,{url:n,status:t.status});case 507:throw new l.MMSThrottleError(r,{url:n});default:throw new a.HttpStatusCodeError(t.status,r,{url:n})}}))).apply(this,arguments)}function m(){return y.apply(this,arguments)}function y(){return(y=(0,i.default)((function*(e){const{directPath:t,encFilehash:n,hostname:r,type:i,signal:a,functionName:o}=e,s=(0,d.default)({directPath:t,encFilehash:n,hostname:r,type:i,mode:"auto"}),l=yield(0,c.extendedFetch)(s,{method:"HEAD",signal:a});return yield _({response:l,functionName:o,url:s}),l}))).apply(this,arguments)}},19242:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return d.apply(this,arguments)};var i=r(n(48926)),a=n(23082),o=n(27856),s=n(61181),l=r(n(42594)),c=n(36823);function d(){return(d=(0,i.default)((function*(e){const{auth:t,encFilehash:n,hostname:r,signal:i,type:d,onProgress:u}=e,p=(0,l.default)({auth:t,encFilehash:n,hostname:r,query:{resume:1},type:d});__LOG__(2)`mmsGetUploadProgress: start`;try{const e=yield(0,s.extendedFetch)(p,{method:"post",signal:i,onProgress:u});if(!e.ok)switch(e.status){case 401:throw new o.MMSUnauthorizedError("mmsGetUploadProgress",{url:p});case 404:throw new o.MediaNotFoundError("mmsGetUploadProgress",{url:p});default:throw new a.HttpStatusCodeError(e.status,"mmsGetUploadProgress",{url:p})}const t=yield e.json();if(!t.resume)throw new a.HttpInvalidResponseError("mmsGetUploadProgress: missing resume",{url:p});return __LOG__(2)`mmsGetUploadProgress: success`,{directPath:t.direct_path,resume:t.resume,url:t.url,handle:t.handle}}catch(e){throw(0,c.mmsLogError)("mmsUpload",e,{encFilehash:n,type:d,url:p}),e}}))).apply(this,arguments)}},36823:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mmsLogError=function(e,t){let n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];t instanceof i.MediaNotFoundError&&n?__LOG__(2)`${e}: expected error`:"object"==typeof t&&(null==t?void 0:t.name)===r.ABORT_ERROR?__LOG__(2)`${e}: canceled`:__LOG__(3)`${e}: error`};var r=n(89385),i=n(27856)},72702:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return d.apply(this,arguments)};var i=r(n(48926)),a=n(23082),o=n(27856),s=n(61181),l=r(n(42594)),c=n(36823);function d(){return(d=(0,i.default)((function*(e){const{auth:t,ciphertextHmac:n,encFilehash:r,hostname:i,type:d,signal:u,onProgress:p,byteRange:f}=e,h=(0,l.default)({auth:t,encFilehash:r,hostname:i,type:d,byteRange:f});__LOG__(2)`mmsUpload: start`;try{const e=yield(0,s.extendedFetch)(h,{method:"post",body:n,signal:u,onProgress:p}).then((e=>{if(!e.ok)switch(e.status){case 401:throw new o.MMSUnauthorizedError("mmsUpload",{url:h});case 413:throw new o.MediaTooLargeError("mmsUpload",{url:h});case 415:throw new o.MediaInvalidError("mmsUpload: hash mismatch",{url:h});case 507:throw new o.MMSThrottleError("mmsUpload",{url:h});default:throw new a.HttpStatusCodeError(e.status,"mmsUpload",{url:h})}return e.json()})).then((e=>{if(!e.direct_path)throw new a.HttpInvalidResponseError("mmsUpload: missing direct_path");if(!e.url)throw new a.HttpInvalidResponseError("mmsUpload: missing url");return{directPath:e.direct_path,url:e.url,handle:e.handle}}));return __LOG__(2)`mmsUpload: success`,e}catch(e){throw(0,c.mmsLogError)("mmsUpload",e,{encFilehash:r,type:d,url:h},!1),e}}))).apply(this,arguments)}},41486:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.mmsUploadStream=function(e){let{auth:t,encFilehash:n,type:r,hostname:i,byteStart:a,byteEnd:o,chunk:c,signal:u,onProgress:p}=e;const f=(0,l.default)({auth:t,encFilehash:n,type:r,hostname:i,query:{stream:1},byteRange:{start:a,end:o}});return(0,s.extendedFetch)(f,{method:"post",body:c,signal:u,onProgress:p}).then((e=>{e.ok||d(e.status,"mmsUploadStream",f)}))},t.mmsUploadStreamFinalize=function(){return u.apply(this,arguments)};var i=r(n(48926)),a=n(23082),o=n(27856),s=n(61181),l=r(n(42594)),c=n(36823);function d(e,t,n){switch(e){case 401:throw new o.MMSUnauthorizedError(t,{url:n});case 413:throw new o.MediaTooLargeError(t,{url:n});case 415:throw new o.MediaInvalidError(`${t}: hash mismatch`,{url:n});case 507:throw new o.MMSThrottleError("mmsUploadStreamFinalize",{url:n});default:throw new a.HttpStatusCodeError(e,t,{url:n})}}function u(){return(u=(0,i.default)((function*(e){let{auth:t,encFilehash:n,type:r,hostname:i,finalHash:o,signal:u}=e;const p=(0,l.default)({auth:t,encFilehash:n,type:r,hostname:i,query:{stream:1,final_hash:o}});__LOG__(2)`mmsUploadStreamFinalize: start`;try{const e=yield(0,s.extendedFetch)(p,{method:"post",signal:u}).then((e=>(e.ok||d(e.status,"mmsUploadStreamFinalize",p),e.json()))).then((e=>{if(null==e.direct_path||""===e.direct_path)throw new a.HttpInvalidResponseError("mmsUploadStreamFinalize: missing direct_path");if(null==e.url||""===e.url)throw new a.HttpInvalidResponseError("mmsUploadStreamFinalize: missing url");return{directPath:e.direct_path,url:e.url,handle:e.handle}}));return __LOG__(2)`mmsUploadStreamFinalize: success`,e}catch(e){throw(0,c.mmsLogError)("mmsUpload",e,{encFilehash:n,type:r,url:p},!1),e}}))).apply(this,arguments)}},74641:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.SERVER_POLLING_INTERVAL=void 0,t.pollMediaHosts=function(){return u.apply(this,arguments)},t.shouldPollDownloadHosts=function(e,t){return c.ServerProps.downloadHostSwitchingEnabled&&e===s.MEDIA_TYPES.DOCUMENT&&(null!=t?t:0)>o.THRESHOLD},t.shouldPollUploadHosts=function(e,t){return c.ServerProps.uploadHostSwitchingEnabled&&e===s.MEDIA_TYPES.DOCUMENT&&t>o.THRESHOLD};var i=r(n(48926)),a=n(13959),o=n(51320),s=n(61596),l=r(n(29049)),c=n(64551);const d=3e5;function u(){return(u=(0,i.default)((function*(e){let t=e.connectionBlock;return yield(0,a.delayMs)(d,e.signal),(0,l.default)((n=>{let{retry:r}=n;return new Promise((n=>e.getMediaHosts().then((i=>{let{selectedHost:a,fallbackHost:s}=i;const l={selectedHost:a,fallbackHost:s},c=e.getRemainingBytes();if(null==c)return r(d);const{changed:u,host:p}=(0,o.maybeSwitchHost)(e.getHost(),t,l,c);return t=l,u?n(p):r(d)}))))}),e.signal)}))).apply(this,arguments)}t.SERVER_POLLING_INTERVAL=d},66717:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let{selectedHost:t,fallbackHost:n,attemptCount:r,lastHostUsed:i,lastFetchMadeProgress:a}=e;if(a&&i)return i;if(r<=1)return t;if(3===r&&n)return n;if((null==i?void 0:i.equals(t))&&null!=t.fallback)return t.fallback;return null!=n?n:t}},29908:(e,t,n)=>{"use strict";var r=n(59182).default,i=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.UploadStreamer=void 0,t.shouldUseStreamingUpload=function(e,t){return T.ServerProps.streamingUploadChunkSize>0&&t===f.MEDIA_TYPES.DOCUMENT&&e>T.ServerProps.streamingUploadChunkSize};var a=i(n(6479)),o=i(n(81109)),s=i(n(48926)),l=n(23082),c=i(n(81602)),d=n(19770),u=i(n(5489)),p=n(82828),f=n(61596),h=i(n(11339)),_=i(n(87206)),g=n(41486),m=n(74641),y=i(n(6704)),E=i(n(29049)),S=n(70426),v=i(n(66717)),T=n(64551);const b=["auth"];function C(e,t){return(0,u.default)(e)&&t<_.default.retries}t.UploadStreamer=class{constructor(e){var t;this._retryStartTime=Date.now(),this._lastUploadedChunkIndex=0,this._offset=0,this._config=e,this._payload=new Uint8Array(e.ciphertextHmac),this._debugString=e.encFilehash.slice(0,10),this._chunkSize=0===T.ServerProps.streamingUploadChunkSize?this._payload.byteLength:T.ServerProps.streamingUploadChunkSize,this._offset=null!==(t=e.byteOffset)&&void 0!==t?t:0}upload(){var e=this;return(0,s.default)((function*(){e._config.onStreamUploadStart(),__LOG__(2)`uploadStreamer: [${e._debugString}] start upload`,yield c.default.waitIfOffline({signal:e._config.signal});const t=Math.ceil((e._payload.byteLength-e._offset)/e._chunkSize);for(let n=0;n<t;n++){e._logChunkUploadProgress(n,t);const r=e._offset+n*e._chunkSize,i=r+e._chunkSize,a=e._payload.subarray(r,i);yield e._uploadChunkWithBackoff(a,r)}const n=yield e._finalizeWithBackoff();return e._config.onUploadAttemptSuccess(Date.now()-e._retryStartTime),n}))()}_resetRetryStartTime(){this._retryStartTime=Date.now()}_getAttemptTime(){return Date.now()-this._retryStartTime}_getRemainingBytes(){return this._payload.byteLength-this._lastUploadedChunkIndex*this._chunkSize}_logChunkUploadProgress(e,t){__LOG__(2)`uploadStreamer: [${this._debugString}] uploading chunk ${e+1}/${t}`}_uploadChunkWithBackoff(e,t){var n=this;return(0,d.exponentialBackoff)((0,o.default)((0,o.default)({},_.default),{},{signal:this._config.signal}),function(){var r=(0,s.default)((function*(r,i){try{yield n._uploadChunk(e,t,i)}catch(e){if(C(e,i))return n._config.onUploadAttemptError(e,n._getAttemptTime(),i,h.default.OVERALL_LAST_UPLOAD_RETRY_PHASE_TYPE.UPLOAD),n._resetRetryStartTime(),r(e);throw e}}));return function(){return r.apply(this,arguments)}}())}_finalizeWithBackoff(){var e=this;return(0,d.exponentialBackoff)((0,o.default)((0,o.default)({},_.default),{},{signal:this._config.signal}),function(){var t=(0,s.default)((function*(t,n){try{var r,i;return null===(r=(i=e._config).onFinalize)||void 0===r||r.call(i),yield e._finalize(n)}catch(r){if(function(e,t){return!(e instanceof l.HttpStatusCodeError&&e.status>=500)&&C(e,t)}(r,n))return e._config.onUploadAttemptError(r,e._getAttemptTime(),n,h.default.OVERALL_LAST_UPLOAD_RETRY_PHASE_TYPE.FINALIZE),e._resetRetryStartTime(),t(r);throw r}}));return function(){return t.apply(this,arguments)}}())}_uploadChunk(e,t,n){var i=this;return(0,s.default)((function*(){let o=null,l=!1;yield c.default.waitIfOffline({signal:i._config.signal});const d=yield i._getMediaHosts(n),{auth:u}=d,p=(0,a.default)(d,b);let f=o=(0,v.default)({selectedHost:p.selectedHost,fallbackHost:p.fallbackHost,lastHostUsed:o,lastFetchMadeProgress:l,attemptCount:n});const h=e=>{l=!0,i._config.onProgress(e,t)};return(0,E.default)(function(){var a=(0,s.default)((function*(a){let{retry:s}=a;const l=new r,{signal:c}=l,d=yield(0,y.default)([c,i._config.signal],(r=>{const a=(0,m.shouldPollUploadHosts)(i._config.type,i._payload.byteLength)?(0,m.pollMediaHosts)({connectionBlock:p,signal:r,getHost:()=>f,getMediaHosts:()=>i._getMediaHosts(n,!0),getRemainingBytes:()=>i._getRemainingBytes()}).then((e=>({host:e,kind:"host-changed"}))):null,o=(0,g.mmsUploadStream)({auth:u,encFilehash:i._config.encFilehash,type:i._config.type,hostname:f.hostname,byteStart:t,byteEnd:t+e.byteLength,chunk:e,signal:r,onProgress:h}).then((()=>({kind:"upload-completed"})));return Promise.race([o,a].filter(Boolean)).finally((()=>l.abort()))}));if("host-changed"===d.kind)return o=f,f=d.host,s()}));return function(){return a.apply(this,arguments)}}())}))()}_finalize(e){var t=this;return(0,s.default)((function*(){yield c.default.waitIfOffline({signal:t._config.signal});const{auth:n,selectedHost:r}=yield t._getMediaHosts(e);return __LOG__(2)`uploadStreamer: [${t._debugString}] finalizing`,(0,g.mmsUploadStreamFinalize)({auth:n,hostname:r.hostname,encFilehash:t._config.encFilehash,finalHash:t._config.encFilehash,type:t._config.type,signal:t._config.signal})}))()}_getMediaHosts(e){var t=this;let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return(0,s.default)((function*(){const r=yield p.mediaHosts.getHostsInfo({operation:S.OPERATIONS.UPLOAD,encFilehash:t._config.encFilehash,type:t._config.type,signal:t._config.signal,forceRefresh:n});return t._config.onUploadHostFound({failCount:e,hostName:r.selectedHost.hostname,hostClass:r.selectedHost.class}),r}))()}}},51127:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,r,s){const l=(0,a.generateMediaEventId)(),c=new o.default.MediaUpload2({mediaId:l,connectionType:o.default.CONNECTION_TYPE.HOSTNAME,overallMediaType:(0,a.getMetricMediaType)(e),overallMmsVersion:4,overallAttemptCount:n,networkStack:o.default.NETWORK_STACK_TYPE.NATIVE,overallUploadMode:(0,a.getMetricOverallUploadModeType)(e),overallIsForward:r,overallUploadOrigin:t,isViewOnce:s});return{handleStreamUploadStart:function(){c.set({uploadIsStreaming:!0})},handleArrayBufferCreated:function(e){c.set({overallMediaSize:e})},handleCheckExistingError:function(e){e instanceof i.HttpStatusCodeError&&c.set({resumeHttpCode:e.status})},handleCheckExistingSuccess:function(){c.set({overallUploadResult:o.default.MEDIA_UPLOAD_RESULT_TYPE.DUPLICATE,overallIsFinal:!0,resumeHttpCode:200}),c.markOverallCumT(),c.commit()},handleUploadHostFound:function(e){let{hostName:t,hostClass:n,failCount:r}=e;c.set({overallDomain:t,overallConnectionClass:n,overallRetryCount:r})},handleUploadSuccess:function(){c.set({resumeHttpCode:404,overallUploadResult:o.default.MEDIA_UPLOAD_RESULT_TYPE.OK,overallIsFinal:!0,uploadHttpCode:200,finalizeHttpCode:200}),c.markOverallCumT(),c.commit()},handleUploadError:function(e){c.set({overallUploadResult:(0,a.getMetricUploadErrorResultType)(e),overallIsFinal:!0});const t=(0,a.getStatusCode)(e);null!=t&&(c.uploadHttpCode=t,c.finalizeHttpCode=t),c.markOverallCumT(),c.commit(),(0,a.logErrorUnknownDetails)(c,e)},handleUploadAttemptSuccess:function(e){c.set({overallT:e})},handleUploadAttemptError:function(e,t,n,r){const i=new o.default.MediaUpload2(c),s=(0,a.getStatusCode)(e),l=r===o.default.OVERALL_LAST_UPLOAD_RETRY_PHASE_TYPE.FINALIZE?s:i.finalizeHttpCode;i.set({mediaId:(0,a.generateMediaEventId)(),overallUploadResult:(0,a.getMetricUploadErrorResultType)(e),overallIsFinal:!1,overallT:t,overallRetryCount:n,overallLastUploadRetryPhase:r,finalizeHttpCode:l}),null!=s&&(c.uploadHttpCode=s),c.markOverallCumT(),i.commit(),(0,a.logErrorUnknownDetails)(c,e)},mediaId:l,handleEncryptionStart:function(){c.startOverallEncryptT()},handleEncryptionSuccess:function(){c.markOverallEncryptT()},handleUploadProgress:function(e){c.set({uploadBytesTransferred:e})}}};var i=n(23082),a=n(29992),o=r(n(11339))},54824:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(48926)),a=n(89385),o=n(50796),s=n(92844),l=n(65885),c=r(n(51127)),d=n(22200),u=r(n(83899)),p=n(27856),f=r(n(32489)),h=(r(n(11339)),r(n(39436))),_=n(23125),g=r(n(15554)),m=n(64551),y=r(n(53565));function E(e){let{mediaKey:t,mediaKeyTimestamp:n}=e;if(null!=t&&null!=n)return{mediaKey:t,mediaKeyTimestamp:n};const{key:r,timestamp:i}=(0,g.default)();return{mediaKey:r,mediaKeyTimestamp:i}}var S=new class{constructor(){var e=this;this.checkIfAlreadyUploaded=(0,f.default)((e=>e.encFilehash),function(){var e=(0,i.default)((function*(e){const{encFilehash:t,type:n}=e;__LOG__(2)`uploadManager.checkIfAlreadyUploaded: start`;try{const t=yield h.default.checkIfUploadExists(e).catch((0,o.filteredCatch)(p.MediaNotFoundError,(()=>null)));return __LOG__(2)`uploadManager.checkIfAlreadyUploaded: success`,t}catch(e){throw e.name===a.ABORT_ERROR?__LOG__(2)`uploadManager.checkIfAlreadyUploaded: canceled`:__LOG__(3)`uploadManager.checkIfAlreadyUploaded: error`,e}}));return function(){return e.apply(this,arguments)}}()),this._memoizedUpload=(0,f.default)((e=>e.encFilehash),function(){var e=(0,i.default)((function*(e){var t;const{ciphertextHmac:n,encFilehash:r,type:i,signal:a,onUploadHostFound:o,onUploadAttemptSuccess:s,onUploadAttemptError:l,onUploadSuccess:c,onProgress:d,onFinalize:u,onStreamUploadStart:p}=e,f=yield h.default.upload({ciphertextHmac:n,encFilehash:r,type:i,signal:a,onUploadHostFound:o,onUploadAttemptSuccess:s,onUploadAttemptError:l,onProgress:d,byteOffset:null!==(t=e.byteOffset)&&void 0!==t?t:0,onFinalize:u,onStreamUploadStart:p});return c(),f}));return function(){return e.apply(this,arguments)}}()),this._getExistingOrUpload=(0,f.default)((e=>e.encFilehash),function(){var t=(0,i.default)((function*(t){const{ciphertextHmac:n,encFilehash:r,signal:i,type:o,onCheckExistingSuccess:s,onCheckExistingError:l,onUploadHostFound:c,onUploadAttemptSuccess:d,onUploadAttemptError:u,onUploadSuccess:p,onProgress:f,onFinalize:h,onStreamUploadStart:_}=t;__LOG__(2)`uploadManager._getExistingOrUpload: start`;try{const t=yield e.checkIfAlreadyUploaded({encFilehash:r,type:o,signal:i}).catch((e=>{throw l(e),e})).then((t=>!0===(null==t?void 0:t.complete)?(s(),{directPath:t.directPath,handle:t.handle,url:t.url}):e._memoizedUpload({ciphertextHmac:n,encFilehash:r,type:o,signal:i,onUploadHostFound:c,onUploadAttemptSuccess:d,onUploadAttemptError:u,onUploadSuccess:p,onCheckExistingSuccess:s,onCheckExistingError:l,onProgress:f,onFinalize:h,onStreamUploadStart:_,byteOffset:null==t?void 0:t.resume})));return __LOG__(2)`uploadManager._getExistingOrUpload: success`,t}catch(e){throw e.name===a.ABORT_ERROR?__LOG__(2)`uploadManager._getExistingOrUpload: canceled`:__LOG__(3)`uploadManager._getExistingOrUpload: error`,e}}));return function(){return t.apply(this,arguments)}}()),d.downloadUploadCrashLogger.init()}encryptAndUpload(e){var t=this;return(0,i.default)((function*(){const{blob:n,signal:r,type:o,userUploadAttemptCount:s,forwardedFromWeb:p,uploadOrigin:f,onProgress:h,onFinalize:g,isViewOnce:y}=e;__LOG__(2)`uploadManager.encryptAndUpload: start`;const{handleCheckExistingSuccess:S,handleCheckExistingError:T,handleUploadHostFound:b,handleUploadAttemptSuccess:C,handleUploadAttemptError:A,handleUploadSuccess:P,handleArrayBufferCreated:M,handleUploadError:O,mediaId:I,handleEncryptionStart:w,handleEncryptionSuccess:R,handleStreamUploadStart:D,handleUploadProgress:L}=(0,c.default)(o,f,s,p,y),N=(e,t)=>{null==h||h(e,t);const n=t+e.loaded;L(n)};d.downloadUploadCrashLogger.mark(I,d.ProgressType.UPLOAD_ENCRYPTION_STARTED);try{let a;if((0,_.isPerformanceExperimentEnabled)()){const i=E(e);a=Promise.resolve(n).then((e=>{d.downloadUploadCrashLogger.mark(I,d.ProgressType.UPLOAD_BLOB_TO_ARRAY_BUFFER_STARTED,{size:n instanceof Blob?n.size:n.byteLength});const t=e instanceof Blob?(0,l.blobToArrayBuffer)(e):e;return d.downloadUploadCrashLogger.mark(I,d.ProgressType.UPLOAD_BLOB_TO_ARRAY_BUFFER_FINISHED),t})).then((e=>(M(e.byteLength),w(),(0,u.default)({type:o,plaintext:e,mediaKey:i.mediaKey})))).then((n=>{let{hash:a,ciphertextHmac:s,sidecar:l,firstFrameSidecar:c}=n;R(),d.downloadUploadCrashLogger.mark(I,d.ProgressType.UPLOAD_ENCRYPTION_FINISHED);return(e.mediaKey?t._getExistingOrUpload:t._memoizedUpload)({ciphertextHmac:s,encFilehash:a,type:o,signal:r,onCheckExistingSuccess:S,onCheckExistingError:T,onUploadHostFound:b,onUploadAttemptSuccess:C,onUploadAttemptError:A,onUploadSuccess:P,onProgress:N,onFinalize:g,onStreamUploadStart:D}).then((e=>({directPath:p&&m.ServerProps.mmsCatV1ForwardHotOverrideEnabled?v(e.directPath):e.directPath,encFilehash:a,mediaKey:i.mediaKey,mediaKeyTimestamp:i.mediaKeyTimestamp,sidecar:l,firstFrameSidecar:c,url:e.url,handle:e.handle})))}))}else{d.downloadUploadCrashLogger.mark(I,d.ProgressType.UPLOAD_BLOB_TO_ARRAY_BUFFER_STARTED,{size:n instanceof Blob?n.size:n.byteLength});const s=n instanceof Blob?(0,l.blobToArrayBuffer)(n):Promise.resolve(n);d.downloadUploadCrashLogger.mark(I,d.ProgressType.UPLOAD_BLOB_TO_ARRAY_BUFFER_FINISHED),a=s.then(function(){var n=(0,i.default)((function*(n){M(n.byteLength);const{mediaKey:i,mediaKeyTimestamp:a}=E(e);w();const{ciphertextHmac:s,hash:l,sidecar:c,firstFrameSidecar:f}=yield(0,u.default)({type:o,plaintext:n,mediaKey:i});R(),d.downloadUploadCrashLogger.mark(I,d.ProgressType.UPLOAD_ENCRYPTION_FINISHED);const h=e.mediaKey?t._getExistingOrUpload:t._memoizedUpload,_=yield h({ciphertextHmac:s,encFilehash:l,type:o,signal:r,onCheckExistingSuccess:S,onCheckExistingError:T,onUploadHostFound:b,onUploadAttemptSuccess:C,onUploadAttemptError:A,onUploadSuccess:P,onFinalize:g,onStreamUploadStart:D,onProgress:N});return{directPath:p&&m.ServerProps.mmsCatV1ForwardHotOverrideEnabled?v(_.directPath):_.directPath,encFilehash:l,mediaKey:i,mediaKeyTimestamp:a,sidecar:c,firstFrameSidecar:f,url:_.url,handle:_.handle}}));return function(){return n.apply(this,arguments)}}())}const s=yield a;return __LOG__(2)`uploadManager.encryptAndUpload: success`,d.downloadUploadCrashLogger.mark(I,d.ProgressType.UPLOAD_FINISHED),s}catch(e){throw e.name===a.ABORT_ERROR?__LOG__(2)`uploadManager.encryptAndUpload: canceled`:__LOG__(3)`uploadManager.encryptAndUpload: error`,d.downloadUploadCrashLogger.mark(I,d.ProgressType.UPLOAD_ERROR),O(e),e}}))()}unencryptedUpload(e){const{file:t,hash:n,type:r,signal:i,uploadOrigin:a,isViewOnce:o}=e,{handleCheckExistingSuccess:s,handleCheckExistingError:l,handleUploadHostFound:d,handleUploadAttemptSuccess:u,handleUploadAttemptError:p,handleUploadSuccess:f,handleStreamUploadStart:h,handleUploadProgress:_}=(0,c.default)(r,a,0,!1,o);return this._getExistingOrUpload({ciphertextHmac:t,encFilehash:n,type:r,signal:i,onCheckExistingSuccess:s,onCheckExistingError:l,onUploadHostFound:d,onUploadAttemptSuccess:u,onUploadAttemptError:p,onUploadSuccess:f,onStreamUploadStart:h,onProgress:(e,t)=>{_(e.loaded+t)}})}};function v(e){const[t,n]=e.split("?"),r=new y.default(n),i=(0,s.unixTime)();return r.set("_nc_hot",String(i)),`${t}?${r.toString()}`}t.default=S},22200:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.downloadUploadCrashLogger=t.ProgressType=void 0;var i=r(n(4285)),a=n(64551);const o=n(76672).Mirrored(["DOWNLOAD_STARTED","DOWNLOAD_FINISHED","DOWNLOAD_DECRYPTION_STARTED","DOWNLOAD_DECRYPTION_FINISHED","DOWNLOAD_ERROR","UPLOAD_STARTED","UPLOAD_FINISHED","UPLOAD_BLOB_TO_ARRAY_BUFFER_STARTED","UPLOAD_BLOB_TO_ARRAY_BUFFER_FINISHED","UPLOAD_ENCRYPTION_STARTED","UPLOAD_ENCRYPTION_FINISHED","UPLOAD_ERROR"]);t.ProgressType=o;const s="DownloadUploadCrashLoggerLikelyCrashed",l=new Set([o.DOWNLOAD_DECRYPTION_FINISHED,o.DOWNLOAD_ERROR,o.UPLOAD_FINISHED,o.UPLOAD_ERROR]);const c=new class{constructor(){this.hasPerformedInit=!1,this._clearAllStorage=()=>{null===i.default||void 0===i.default||i.default.removeItem(s)}}_getStorage(){const e=null===i.default||void 0===i.default?void 0:i.default.getItem(s);return e?JSON.parse(e):{}}_commitStorage(){null===i.default||void 0===i.default||i.default.setItem(s,JSON.stringify(this.storage))}_shouldLog(){return!0===a.ServerProps.webLogUploadDownloadCrashes}init(){!this.hasPerformedInit&&this._shouldLog()&&(window.addEventListener("beforeunload",this._clearAllStorage),this.storage=this._getStorage(),Object.entries(this.storage).forEach((e=>{let[t,{progressType:n,metadata:r}]=e;var i,a;__LOG__(3,void 0,void 0,!0)`downloadUploadCrashLogger.likelyCrashedDuring${a=n,a.toLowerCase().replace(/(?:^|_)(\w)/g,((e,t)=>t.toLocaleUpperCase()))}WithID${t}${r?`AndData => ${i=r,Object.entries(i).map((e=>{let[t,n]=e;return`${t}: ${String(n)}`})).join(", ")}`:""}`,SEND_LOGS("download-upload-manager-likely-crashed")})),this._clearAllStorage(),this.hasPerformedInit=!0)}reset(){this._shouldLog()&&(window.removeEventListener("beforeunload",this._clearAllStorage),this._clearAllStorage(),this.hasPerformedInit=!1)}mark(e,t,n){this._shouldLog()&&(l.has(t)?delete this.storage[String(e)]:this.storage[String(e)]={progressType:t,metadata:n},this._commitStorage())}};t.downloadUploadCrashLogger=c},23125:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isLargeFilesEnabled=o,t.isPerformanceExperimentEnabled=function(){if(o())return!0;if((0,r.isMDBackend)())return(0,i.getABPropConfigValue)("web_abprop_large_files_encryption_optimization");return!1},t.shouldEncryptInChunks=function(e){return o()&&e>a.DEFAULT_MAX_FILE_SIZE_BYTES};var r=n(88555),i=n(57849),a=n(64551);function o(){return a.ServerProps.maxFileSize>a.DEFAULT_MAX_FILE_SIZE_BYTES||a.ServerProps.maxElectronFileSize>a.DEFAULT_MAX_FILE_SIZE_BYTES}},9329:(e,t,n)=>{"use strict";var r=n(59182).default,i=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.NoEntryAfterRMR=t.MissingEncFilehash=void 0,t.cancelDownloadMedia=function(e){const{downloadPromise:t}=e;if(null==t)return;const n=N.get(t);if(null==n)return;N.delete(t),n()},t.checkExistence=function(){return F.apply(this,arguments)},t.downloadMedia=x,t.manuallySetMedia=function(){return k.apply(this,arguments)};var a=i(n(48926)),o=i(n(23493)),s=n(89385),l=n(40265),c=n(50796),d=i(n(45095)),u=n(65885),p=I(n(35232)),f=n(93778),h=n(691),_=n(26384),g=n(27856),m=n(37115),y=n(84866),E=I(n(16737)),S=n(61596),v=n(58668),T=n(56406),b=i(n(11339)),C=n(43257),A=i(n(34949)),P=i(n(6704)),M=n(64551);function O(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(O=function(e){return e?n:t})(e)}function I(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=O(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}return r.default=e,n&&n.set(e,r),r}class w extends((0,l.customError)("NoEntryAfterRMR")){}t.NoEntryAfterRMR=w;class R extends((0,l.customError)("MissingEncFilehash")){}t.MissingEncFilehash=R;const D=3,L=4,N=new WeakMap;function k(){return(k=(0,a.default)((function*(e){let{mimetype:t,mediaObject:n,mediaBlob:r,mediaType:i,rmrReason:a,downloadOrigin:o}=e;n.mediaBlob||(yield(0,T.gatherAndSetMetadata)(n,r),yield x({mimetype:t,mediaObject:n,downloadEvenIfExpensive:!1,mediaType:i,rmrReason:a,downloadOrigin:o}))}))).apply(this,arguments)}function U(){return G.apply(this,arguments)}function G(){return(G=(0,a.default)((function*(e){const{mimetype:t}=e,n=M.ServerProps.webLargeFilesUi?(0,o.default)((t=>{e.mediaObject.consolidate({loadedSize:t.loaded})}),h.FILE_PROGRESS_THROTTLE_WAIT_MS):void 0,r=yield _.downloadManager.downloadAndDecrypt({directPath:e.directPath,encFilehash:e.encFilehash,filehash:e.objFilehash,isFinalRmrRetry:e.isFinalRmrRetry,mediaKey:e.mediaKey,mediaKeyTimestamp:e.mediaKeyTimestamp,signal:e.signal,staticUrl:e.staticUrl,type:e.mediaType,onDecryptStart:()=>{e.mediaObject.consolidate({downloadStage:v.DOWNLOAD_STAGE.PROCESSING})},onProgress:n,userDownloadAttemptCount:e.mediaObject.userDownloadAttemptCount,downloadOrigin:e.downloadOrigin,mode:e.mode,progressiveJpegOpts:j({scanLengths:e.scanLengths,scansSidecar:e.scansSidecar,mimetype:t,mediaObject:e.mediaObject}),isViewOnce:e.isViewOnce}),i=null!=t&&""!==t?t:(0,C.getMediaMimeType)(e.mediaType,new Uint8Array(r));return new Blob([r],{type:i})}))).apply(this,arguments)}function x(){return B.apply(this,arguments)}function B(){return(B=(0,a.default)((function*(e){let{mimetype:t,mediaObject:n,downloadEvenIfExpensive:i,mediaType:o,signal:l,rmrReason:h,rmrData:b,downloadOrigin:C,shouldThrow:M,isVcardOverMmsDocument:O,mode:I,isAutoDownload:D,isFinalRmrRetry:L,isViewOnce:k}=e;if(!n)return;const G=n.filehash;if(!G)return;if(n.downloadPromise)return n.downloadPromise;if(n.downloadStage===v.DOWNLOAD_STAGE.ERROR_MISSING)return;if(n.downloadStage===v.DOWNLOAD_STAGE.PREPARING)return;if(n.mediaBlob){return(yield n.mediaBlob.validate())?void n.consolidate({downloadStage:v.DOWNLOAD_STAGE.RESOLVED}):(n.clearBlob(),n.consolidate({downloadStage:v.DOWNLOAD_STAGE.NEED_POKE}),void n.notifyMsgsAsync())}const B=y.MediaBlobCache.get(G);let F,j;const Y=new r;return(0,P.default)([Y.signal,l].filter(Boolean),(e=>{const l=function(){var r=(0,a.default)((function*(){if(B)j=B;else{if(F=n.entries.getDownloadEntry(),!F){if(!i)return void n.consolidate({downloadStage:v.DOWNLOAD_STAGE.NEED_POKE});if(yield _.downloadManager.rmr({mediaObject:n,signal:e,rmrReason:h,rmrData:b}),F=n.entries.getDownloadEntry(),!F)throw new w}n.consolidate({downloadStage:v.DOWNLOAD_STAGE.FETCHING}),F=(0,d.default)(F,"entry");const{encFilehash:r,scansSidecar:a,scanLengths:s,directPath:l,mediaKey:c,mediaKeyTimestamp:u,staticUrl:p}=F;if(!r)throw F.markWhetherOnServer(!1),new R;const f=yield U({directPath:l,encFilehash:r,objFilehash:G,isFinalRmrRetry:L,mediaKey:c,mediaKeyTimestamp:u,signal:e,staticUrl:p,mediaType:o,mediaObject:n,downloadOrigin:C,mode:I,scanLengths:s,mimetype:t,scansSidecar:a,isViewOnce:k});j=o===S.MEDIA_TYPES.PTT||o===S.MEDIA_TYPES.AUDIO?yield E.transcode(f):f}if("text/vcard"===j.type&&O)try{const e=yield(0,u.blobToText)(j);if(e){const t=(0,f.parseMultiVcard)(e);t.length>0?n.consolidate({parsedVcards:t}):(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("vcard_over_mms:Failed to parse vcard over mms contents"))}}catch(e){__LOG__(4,void 0,new Error,!0)`Failed to retrieve blob text contents ${String(e)}`,SEND_LOGS(`vcard_over_mms:blobToText failed with error: ${String(e)}`)}if((0,T.shouldUseMediaCache)(o))D||(y.MediaBlobCache.put(G,j),yield(0,T.gatherAndSetMetadataNoOpaque)(n,j));else{const e=yield A.default.createFromData(j,j.type);yield(0,T.gatherAndSetMetadata)(n,e)}return n.consolidate({downloadStage:v.DOWNLOAD_STAGE.RESOLVED}),n.downloadPromise=null,n.resolveWhenConsolidated()}));return function(){return r.apply(this,arguments)}}()().catch((0,c.filteredCatch)(g.MediaNotFoundError,function(){var e=(0,a.default)((function*(e){if(!F)throw e;if(F.markWhetherOnServer(!1),!i)throw e;return yield _.downloadManager.rmr({mediaObject:n,signal:(new r).signal,rmrReason:h,rmrData:b}),n.downloadPromise=null,x({mimetype:t,mediaObject:n,downloadEvenIfExpensive:!1,mediaType:o,rmrReason:h,rmrData:b,downloadOrigin:C,isFinalRmrRetry:!0,isVcardOverMmsDocument:O,mode:I,isAutoDownload:D})}));return function(){return e.apply(this,arguments)}}())).catch((0,c.filteredCatch)(p.MediaUnsupportedError,(e=>{if(n.consolidate({downloadStage:v.DOWNLOAD_STAGE.ERROR_UNSUPPORTED}),__LOG__(3)`downloadMedia: media unsupported error: ${e.name}, ${e.message}, ${t||""}`,__LOG__(4,void 0,new Error,!0)`Assertion failed! ${e.message}`,SEND_LOGS("downloadMedia: media unsupported error:"),M)throw e}))).catch((0,c.filteredCatch)(m.MediaNotOnPhone,(e=>{if(n.consolidate({downloadStage:v.DOWNLOAD_STAGE.ERROR_MISSING}),M)throw e}))).catch((0,c.filteredCatch)([w,R],(e=>{if(n.consolidate({downloadStage:v.DOWNLOAD_STAGE.ERROR_MISSING}),__LOG__(3)`Unexpected download error: ${e.name}`,__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS(`unexpected download error: ${e.name}`),M)throw e}))).catch((0,c.filteredCatch)(p.MediaDecryptionError,(e=>{if(n.consolidate({downloadStage:v.DOWNLOAD_STAGE.ERROR_MISSING}),M)throw e}))).catch((e=>{if(n.consolidate({downloadStage:v.DOWNLOAD_STAGE.NEED_POKE}),e instanceof p.MediaLoadError){if(__LOG__(3)`downloadMedia: media unsupported error: ${e.name}, ${e.message}, ${t||""}`,__LOG__(4,void 0,new Error,!0)`Assertion failed! ${e.message}`,SEND_LOGS("downloadMedia: media load error:"),M)throw e}else if(e instanceof p.TranscodeBlobTooLargeError){if(__LOG__(3)`downloadMedia: error: ${e.message}, ${t||""}`,__LOG__(4,void 0,new Error,!0)`Assertion failed! ${e.message}`,SEND_LOGS("downloadMedia: transcode blob too large"),M)throw e}else if(e instanceof p.UnableToPlayVideoError){if(__LOG__(3)`downloadMedia: error: ${e.message}, ${t||""}`,__LOG__(4,void 0,new Error,!0)`Assertion failed! ${e.message}`,SEND_LOGS("downloadMedia: unable to play video"),M)throw e}else if(e.name!==s.ABORT_ERROR){if(__LOG__(2)`downloadMedia: error`,M)throw e}else if(M)throw e})).finally((()=>{n.downloadPromise=null}));return N.set(l,(()=>{Y.abort()})),n.downloadPromise=l,l}))}))).apply(this,arguments)}function F(){return(F=(0,a.default)((function*(e){let{mimetype:t,mediaObject:n,mediaType:i}=e;const{filehash:a}=n;if(!a)return;if(n.downloadStage!==v.DOWNLOAD_STAGE.INIT)return;if(yield Y(n))return;const o=y.MediaBlobCache.get(a),s=new r;if(o)return void(n.downloadStage===v.DOWNLOAD_STAGE.INIT&&n.consolidate({downloadStage:v.DOWNLOAD_STAGE.EXISTS}));const l=n.entries.getDownloadEntry();if(!l)return void(n.downloadStage===v.DOWNLOAD_STAGE.INIT&&n.consolidate({downloadStage:v.DOWNLOAD_STAGE.NEED_POKE}));const{encFilehash:c}=l;if(!c)return l.markWhetherOnServer(!1),void(n.downloadStage===v.DOWNLOAD_STAGE.INIT&&n.consolidate({downloadStage:v.DOWNLOAD_STAGE.NEED_POKE}));try{yield _.downloadManager.checkExistence({directPath:l.directPath,encFilehash:c,signal:s.signal,type:i}),n.downloadStage===v.DOWNLOAD_STAGE.INIT&&n.consolidate({downloadStage:v.DOWNLOAD_STAGE.EXISTS})}catch(e){n.downloadStage===v.DOWNLOAD_STAGE.INIT&&n.consolidate({downloadStage:v.DOWNLOAD_STAGE.NEED_POKE}),__LOG__(2)`checkExistence: error`}}))).apply(this,arguments)}function j(e){const{scanLengths:t,scansSidecar:n,mimetype:r,mediaObject:i}=e;if(!function(e,t){return!!(e&&t&&e.length>=2&&10*e.length===t.byteLength)}(t,n))return null;const a=new b.default.WebcProgressiveImage({webcFirstRenderScans:0});return{mimetype:r,scansSidecar:(0,d.default)(n,"scansSidecar"),scanLengths:(0,d.default)(t,"scanLengths"),onProgressiveUpdate:e=>{i.downloadStage!==v.DOWNLOAD_STAGE.RESOLVED&&(i.consolidate({downloadStage:v.DOWNLOAD_STAGE.PROGRESSIVE_READY,progressiveStage:e}),a.webcFirstRenderScans||(a.webcFirstRenderScans=e,a.markWebcFirstRenderT()),e>=D&&!a.webcMidQualityT&&a.markWebcMidQualityT(),e!==L||a.webcFullQualityT||(a.markWebcFullQualityT(),a.commit()))}}}function Y(){return K.apply(this,arguments)}function K(){return(K=(0,a.default)((function*(e){if(!e.mediaBlob)return!1;return(yield e.mediaBlob.validate())?(e.consolidate({downloadStage:v.DOWNLOAD_STAGE.RESOLVED}),!0):(e.clearBlob(),e.consolidate({downloadStage:v.DOWNLOAD_STAGE.NEED_POKE}),e.notifyMsgsAsync(),!1)}))).apply(this,arguments)}},70996:(e,t,n)=>{"use strict";var r=n(59182).default,i=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.UploadMediaResultKind=void 0,t.cancelUploadMedia=function(e){const{uploadPromise:t}=e;if(null==t)return;const n=P.get(t);if(null==n)return;P.delete(t),n()},t.getBlobFromMediaObject=R,t.getOrDownloadBlob=I,t.uploadMedia=function(e){let{mimetype:t,mediaObject:n,mediaType:i,forwardedFromWeb:o,uploadOrigin:u,mediaKeyInfo:p,isViewOnce:S}=e;if(n.uploadPromise)return n.uploadPromise;const v=new r,{signal:T}=v,b=Promise.resolve().then((()=>{n.consolidate({uploadStage:m.UPLOAD_STAGE.UPLOADING})})).then((()=>I({mediaObject:n,mimetype:t,mediaType:i,abortSignal:T,uploadOrigin:u}))).then(function(){var e=(0,a.default)((function*(e){const t=n.entries.getUploadEntry();t&&p&&(0,d.default)(t.mediaKey===p.key,"uploadEntry.mediaKey and mediaKeyInfo.mediaKey should be the same");const r=yield function(){return O.apply(this,arguments)}({blob:e,forwardedFromWeb:o,mediaKeyInfo:p,mediaObject:n,mediaType:i,signal:T,uploadEntry:t,uploadOrigin:u,isViewOnce:S});if(!r)throw new Error("could not create media entry");if((i===y.MEDIA_TYPES.PTT||i===y.MEDIA_TYPES.AUDIO)&&!E.canPlayOgg())if(E.shouldUseMediaCache(i)){const e=n.filehash;if(e&&n.mediaBlob)return g.transcode(n.mediaBlob.formData()).then((t=>{_.MediaBlobCache.put(e,t)})).then((()=>r))}else if(n.mediaBlob)return E.gatherAndSetMetadata(n,n.mediaBlob).then((()=>r));return r}));return function(){return e.apply(this,arguments)}}()).then((e=>{if(T.aborted)throw new s.AbortError;return n.consolidate({uploadStage:m.UPLOAD_STAGE.UPLOADED}),__LOG__(2)`MediaAlgo.uploadMedia: success`,{kind:M.SUCCESS,mediaEntry:e}})).catch((e=>{throw e.name===s.ABORT_ERROR?__LOG__(2)`MediaAlgo.uploadMedia: canceled`:__LOG__(3)`MediaAlgo.uploadMedia: error`,e})).finally((()=>{delete n.uploadPromise})).catch((0,l.filteredCatch)(c.FileNotReadableError,(()=>(n.consolidate({uploadStage:m.UPLOAD_STAGE.ERROR_FILE_NOT_READABLE}),{kind:M.ERROR})))).catch((0,l.filteredCatch)(f.MediaNotOnPhone,(()=>(n.consolidate({uploadStage:m.UPLOAD_STAGE.ERROR_MISSING}),{kind:M.ERROR})))).catch((0,l.filteredCatch)(h.MediaTooLargeError,(()=>(n.consolidate({uploadStage:m.UPLOAD_STAGE.ERROR_TOO_LARGE}),{kind:M.ERROR})))).catch((e=>(n.consolidate({uploadStage:m.UPLOAD_STAGE.NEED_UPLOAD}),e.name===s.ABORT_ERROR?{kind:M.CANCELLATION}:{kind:M.ERROR})));return P.set(b,(()=>{v.abort()})),n.uploadPromise=b,b};var a=i(n(48926)),o=i(n(23493)),s=n(89385),l=n(50796),c=n(35232),d=i(n(41143)),u=n(691),p=i(n(51127)),f=n(37115),h=n(27856),_=n(84866),g=A(n(16737)),m=n(58668),y=n(61596),E=A(n(56406)),S=i(n(11339)),v=n(9329),T=n(64551),b=i(n(54824));function C(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(C=function(e){return e?n:t})(e)}function A(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=C(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}return r.default=e,n&&n.set(e,r),r}const P=new WeakMap;const M={SUCCESS:"success",CANCELLATION:"cancellation",ERROR:"error",TIMEOUT:"timeout"};function O(){return(O=(0,a.default)((function*(e){let{blob:t,forwardedFromWeb:n,mediaKeyInfo:r,mediaObject:i,mediaType:a,signal:s,uploadEntry:l,uploadOrigin:c,isViewOnce:d}=e;if(null==l?void 0:l.canReuseMediaKey())return(0,p.default)(a,c,0,n,d).handleCheckExistingSuccess(),l;const f=r?r.key:null==l?void 0:l.mediaKey,h=r?r.timestamp:null==l?void 0:l.mediaKeyTimestamp,_=T.ServerProps.webLargeFilesUi?(0,o.default)(((e,t)=>{const n=e.loaded+t;Number.isFinite(n)&&i.consolidate({loadedSize:n})}),u.FILE_PROGRESS_THROTTLE_WAIT_MS):void 0,{directPath:g,encFilehash:y,mediaKey:E,mediaKeyTimestamp:S,url:v,sidecar:C,firstFrameSidecar:A}=yield b.default.encryptAndUpload({blob:t,mediaKey:f,mediaKeyTimestamp:h,type:a,signal:s,userUploadAttemptCount:i.userUploadAttemptCount,forwardedFromWeb:n,uploadOrigin:c,onProgress:_,onFinalize:()=>{i.consolidate({uploadStage:m.UPLOAD_STAGE.FINALIZING})},isViewOnce:d});return i.entries.addEntry({deprecatedMms3Url:v,mediaKey:E,mediaKeyTimestamp:S,encFilehash:y,type:a,sidecar:C,directPath:g,firstFrameSidecar:A,debugHint:"upload"})}))).apply(this,arguments)}function I(){return w.apply(this,arguments)}function w(){return(w=(0,a.default)((function*(e){let{mediaObject:t,mimetype:n,mediaType:r,abortSignal:i,uploadOrigin:a}=e;const o=R(t);if(o)return o;if(yield(0,v.downloadMedia)({mimetype:n,mediaObject:t,downloadEvenIfExpensive:!0,mediaType:r,signal:i,rmrReason:S.default.WEBC_RMR_REASON_CODE.UPLOAD,downloadOrigin:a===S.default.UPLOAD_ORIGIN_TYPE.CHAT_PERSONAL?S.default.DOWNLOAD_ORIGIN_TYPE.CHAT_PERSONAL:S.default.DOWNLOAD_ORIGIN_TYPE.CHAT_GROUP,mode:"manual"}),t.downloadStage===m.DOWNLOAD_STAGE.ERROR_MISSING)throw new f.MediaNotOnPhone;const s=R(t);if(s)return s;throw new Error("cant upload media w/out mediaBlob after download")}))).apply(this,arguments)}function R(e){const t=e.mediaBlob;return t?t.formData():e.filehash?_.MediaBlobCache.get(e.filehash):void 0}t.UploadMediaResultKind=M},27989:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){const n=Promise.resolve().then((()=>{var n;const r=e.size();let c;c=t.asDocument?a.FILETYPE.DOCUMENT:t.asSticker?a.FILETYPE.STICKER:(0,a.typeFromMimetype)(e.type());const d=null!==(n=t.isVcardOverMmsDocument)&&void 0!==n&&n;if(r>function(e,t){if(e===a.FILETYPE.DOCUMENT)return t?1024*l.ServerProps.vcardMaxSizeKb:(0,l.getMaxFilesSizeServerProp)();return l.ServerProps.media}(c,d))throw new o.default(e);if(r<=0)throw new i.MediaFileEmpty;let u;switch(null!=t.gifAttribution?u=t.gifAttribution:t.asGif&&(u=0),c){case"image":return s.processRawImage(e,{minDimension:t.minDimension,transparency:t.transparency});case"sticker":return s.processRawSticker(e);case"video":case"audio":return s.processRawAudioVideo(e,!!t.isPtt,t.precomputedFields,t.asGif,u,e.type());case"document":return s.processRawDocument(e,t.filename,d,t.documentPageCount);default:throw new Error("Received unsupported mediaType: "+c)}}));return e.retain(),e.autoreleaseWhenPromiseCompletes(n),n};var i=d(n(35232)),a=n(65885),o=r(n(50170)),s=d(n(56406)),l=n(64551);function c(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(c=function(e){return e?n:t})(e)}function d(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=c(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}return r.default=e,n&&n.set(e,r),r}},3151:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.RequestMediaReuploadManagerImpl=t.RequestMediaReuploadManager=void 0;var i=r(n(48926)),a=r(n(45095)),o=r(n(27184));class s{constructor(){var e=this;this._rmrRequests=new Map,this.requestMediaReupload=function(){var t=(0,i.default)((function*(t){const n=t.id.id,r=e._rmrRequests.get(n);if(r)return(0,a.default)(r.request,"existingRequest.request");const i=new Promise(((r,i)=>{e._rmrRequests.set(n,{resolve:r,reject:i,msg:t})}));return(0,a.default)(e._rmrRequests.get(n),"_this._rmrRequests.get(msgId)").request=i,yield(0,o.default)(t),i}));return function(){return t.apply(this,arguments)}}(),this.resolveMediaReupload=e=>{let{msgId:t,result:n,directPath:r}=e;const i=this._rmrRequests.get(t);null!=i?(i.resolve({result:n,directPath:r}),this._rmrRequests.delete(t)):__LOG__(3)`resolveMediaReupload: msgId (${t}) is not found in _rmrRequests`},this.getMediaKey=e=>{var t;return null===(t=this._rmrRequests.get(e))||void 0===t?void 0:t.msg.mediaKey}}}t.RequestMediaReuploadManagerImpl=s;const l=new s;t.RequestMediaReuploadManager=l},2603:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return o.apply(this,arguments)};var i=r(n(48926)),a=n(97563);function o(){return(o=(0,i.default)((function*(e,t){yield(0,a.updateLocal)(e.id,t),e.set(t)}))).apply(this,arguments)}},74460:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return f.apply(this,arguments)};var i=r(n(81109)),a=r(n(48926)),o=n(89385),s=n(40265),l=r(n(47259)),c=n(38284),d=n(18309),u=n(21009),p=(r(n(11339)),n(70996));function f(){return(f=(0,a.default)((function*(e){const{thumbnail:t,mediaType:n,mediaKeyInfo:r,uploadOrigin:f,forwardedFromWeb:h,timeout:_,signal:g,isViewOnce:m}=e,y=new u.MediaObject;try{return null==_?yield E():yield(0,c.promiseTimeout)(E(),_)}catch(e){const t=e;if(t instanceof s.TimeoutError)return(0,p.cancelUploadMedia)(y),{kind:p.UploadMediaResultKind.TIMEOUT};throw t}function E(){return S.apply(this,arguments)}function S(){return(S=(0,a.default)((function*(){try{const e=yield(0,l.default)((0,d.calculateFilehashFromBlob)(t),g);y.filehash=e,y.mediaBlob=t;const a=yield(0,l.default)((0,p.uploadMedia)({mimetype:"image/jpeg",mediaObject:y,mediaType:n,forwardedFromWeb:h,uploadOrigin:f,mediaKeyInfo:r,isViewOnce:m}),g);return a.kind===p.UploadMediaResultKind.SUCCESS?(0,i.default)((0,i.default)({},a),{},{filehash:e}):{kind:a.kind}}catch(e){const t=e;if("object"==typeof t&&(null==t?void 0:t.name)===o.ABORT_ERROR)return(0,p.cancelUploadMedia)(y),{kind:p.UploadMediaResultKind.CANCELLATION}}}))).apply(this,arguments)}}))).apply(this,arguments)}},87798:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return r.Clock.globalUnixTime()-e<i.ServerProps.mmsMediaKeyTTL+Math.floor(86400*Math.random())};var r=n(40234),i=n(64551)},65212:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(87614),a=r(n(89867)),o=n(45454),s=r(n(5030)),l=n(99234),c=n(7293);class d{constructor(e){let t=e;if(!t)throw new Error("MsgKey error: obj is null/undefined");t.id instanceof d&&(t=t.id,__LOG__(3)`MsgKey error: id is already a MsgKey`);const n=t.from&&t.to&&t.id,r=void 0!==t.fromMe&&t.remote&&t.id;let i,o,s,u,p,f,h;const _=(0,l.getMaybeMeUser)();if(!_)throw new Error("MsgKey error: me is undefined");if(n&&r)throw __LOG__(3)`Unclear constructor MsgKey: ${JSON.stringify(t)}`,new Error("MsgKey error: unclear which constructor to use");if(!n&&!r)throw __LOG__(3)`No matching constructor MsgKey: ${JSON.stringify(t)}`,new Error("MsgKey error: don't have a matching constructor");if(n){if(({from:i,to:o,id:s,participant:u,selfDir:p}=t),!(i instanceof a.default)||!(o instanceof a.default)||u&&!(u instanceof a.default))throw __LOG__(3)`Incorrect Wid MsgKey: from:${String(i)} to:${String(o)} p:${String(u)}`,new Error("MsgKey error: something is not a wid");p=a.default.equals(i,o)?p:void 0,a.default.equals(i,o)&&a.default.equals(i,_)?(f="out"===p,h=_):a.default.equals(i,_)?(f=!0,h=o):a.default.equals(o,_)?(f=!1,h=i):a.default.equals(i,o)&&(a.default.isGroup(i)||a.default.isBroadcast(i))?(f=!0,h=i):__LOG__(3)`MsgKey case error: ${[i,o,s,_].join()}`,void 0!==f&&(this.fromMe=f),h&&(this.remote=h),s&&(this.id=s)}else if(r){if(({fromMe:f,remote:h,id:s,participant:u}=t),!(h instanceof a.default)||u&&!(u instanceof a.default))throw __LOG__(3)`Incorrect Wid MsgKey: remote:${String(h)} p:${String(u)}`,new Error("MsgKey error: something is not a wid");a.default.equals(_,h)&&(p=f?"out":"in"),void 0!==f&&(this.fromMe=f),h&&(this.remote=h),s&&(this.id=s)}const g=[this.fromMe,this.remote,this.id];void 0!==p&&(this.self=p,g.push(this.self));c.GK.supportsAnyFeature(c.GK.F.KEY_PARTICIPANT,c.GK.F.MD_BACKEND)&&void 0!==u&&(this.participant=u,g.push(this.participant)),this._serialized=g.join("_")}toString(){return this._serialized}clone(){return new d({fromMe:this.fromMe,remote:this.remote,id:this.id,participant:this.participant})}equals(e){return e instanceof d&&this.toString()===e.toString()}static fromString(e){const{fromMe:t,remote:n,id:r,participant:i}=(0,s.default)(e);return new d({fromMe:t,remote:(0,o.createWid)(n),id:r,participant:i?(0,o.createWid)(i):void 0})}static newId(){return"3EB0"+(0,i.randomHex)(8)}}t.default=d},5030:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(!e||!(0,r.isString)(e))throw new Error("MsgKey fromString error: str is null or not a string");const t=e.split("_");let n;t.length<3?__LOG__(3)`MsgKey error: cannot create MsgKey from ${e}`:4===t.length?"out"!==t[3]&&"in"!==t[3]&&(n=t[3]):5===t.length&&(n=t[4]);return{fromMe:"true"===t[0],remote:t[1],id:t[2],participant:n}};var r=n(51737)},61653:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.NuxKeyTypes=t.NUX=t.CoolOffPeriodKeys=void 0;r(n(11339));t.NUX={SAFARI_LIMITED_SUPPORT:"safari_limited_support",SENDER_REVOKE_LEGAL_DISCLAIMER_NUX:"revoke_legal_disclaimer_nux",ADMIN_REVOKE_LEGAL_DISCLAIMER_NUX:"admin_revoke_legal_disclaimer_nux",EPHEMERAL:"ephemeral",EPHEMERAL_VIEW_ONCE:"ephemeral_view_once",EPHEMERAL_VIEW_ONCE_RECEIVER:"ephemeral_view_once_receiver",ARCHIVE:"archive",COMMUNITY:"community",COMMUNITY_HOME:"community_home"};t.NuxKeyTypes={COOL_OFF_NUX:{INCOMPLETE_BUSINESS_PROFILE_BANNER:"incomplete_business_profile_banner",PRODUCT_CATALOG_BANNER:"product_catalog_banner",COLLECTIONS:"collections_banner",CART_INTERSTITIAL:"cart_interstitial"},VIEW_COUNT_NUX:{SAFARI_LIMITED_SUPPORT:"safari_limited_support",SENDER_REVOKE_LEGAL_DISCLAIMER_NUX:"revoke_legal_disclaimer_nux",ADMIN_REVOKE_LEGAL_DISCLAIMER_NUX:"admin_revoke_legal_disclaimer_nux",EPHEMERAL:"ephemeral",EPHEMERAL_VIEW_ONCE:"ephemeral_view_once",EPHEMERAL_VIEW_ONCE_RECEIVER:"ephemeral_view_once_receiver",ARCHIVE:"archive",COMMUNITY:"community",COMMUNITY_HOME:"community_home"}};t.CoolOffPeriodKeys={DEFAULT:"default_cool_off_banners_key",CATALOG:"catalog_banners_key"}},36677:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NUX_SYNC_KEY_LIST=void 0,t.addToLocalNuxSyncList=function(e){const t=new Set((0,r.getNuxSyncList)());t.add(...e),(0,r.setNuxSyncList)(Array.from(t))},t.nuxExistsInNuxSync=function(e){return(0,r.getNuxSyncList)().includes(e)};var r=n(98469);const i=n(76672).Mirrored([]);t.NUX_SYNC_KEY_LIST=i},59182:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(39930));let a;if("undefined"!=typeof self)a=self;else{if(void 0===n.g)throw new Error("Couldn't get global object");a=n.g}var o="AbortController"in a?a.AbortController:class{constructor(){this.signal=new i.default}abort(){const e=new Event("abort");this.signal.dispatchEvent(e)}};t.default=o},39930:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(90120)),a=class extends i.default{constructor(){super(),this.aborted=!1}dispatchEvent(e){return"abort"===e.type&&(this.aborted=!0,"function"==typeof this.onabort&&this.onabort.call(this,e)),super.dispatchEvent(e)}toString(){return"[object AbortSignal]"}};t.default=a},90120:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(76521));t.default=class{constructor(){this._emitter=new i.default}addEventListener(e,t){this._emitter.on(e,t,this)}removeEventListener(e,t){this._emitter.off(e,t,this)}dispatchEvent(e){return this._emitter.trigger(e.type),!0}}},61438:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ADVSignedKeyIndexListSpec=t.ADVSignedDeviceIdentitySpec=t.ADVSignedDeviceIdentityHMACSpec=t.ADVKeyIndexListSpec=t.ADVDeviceIdentitySpec=void 0;var r=n(1390);const i={};t.ADVKeyIndexListSpec=i;const a={};t.ADVSignedKeyIndexListSpec=a;const o={};t.ADVDeviceIdentitySpec=o;const s={};t.ADVSignedDeviceIdentitySpec=s;const l={};t.ADVSignedDeviceIdentityHMACSpec=l,i.internalSpec={rawId:[1,r.TYPES.UINT32],timestamp:[2,r.TYPES.UINT64],currentIndex:[3,r.TYPES.UINT32],validIndexes:[4,r.FLAGS.REPEATED|r.FLAGS.PACKED|r.TYPES.UINT32]},a.internalSpec={details:[1,r.TYPES.BYTES],accountSignature:[2,r.TYPES.BYTES]},o.internalSpec={rawId:[1,r.TYPES.UINT32],timestamp:[2,r.TYPES.UINT64],keyIndex:[3,r.TYPES.UINT32]},s.internalSpec={details:[1,r.TYPES.BYTES],accountSignatureKey:[2,r.TYPES.BYTES],accountSignature:[3,r.TYPES.BYTES],deviceSignature:[4,r.TYPES.BYTES]},l.internalSpec={details:[1,r.TYPES.BYTES],hmac:[2,r.TYPES.BYTES]}},98263:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CompanionPropsSpec=t.CompanionPropsPlatformType=t.CompanionProps$AppVersionSpec=void 0;var r=n(1390);const i=n(76672)({UNKNOWN:0,CHROME:1,FIREFOX:2,IE:3,OPERA:4,SAFARI:5,EDGE:6,DESKTOP:7,IPAD:8,ANDROID_TABLET:9,OHANA:10,ALOHA:11,CATALINA:12});t.CompanionPropsPlatformType=i;const a={};t.CompanionPropsSpec=a;const o={};t.CompanionProps$AppVersionSpec=o,a.internalSpec={os:[1,r.TYPES.STRING],version:[2,r.TYPES.MESSAGE,o],platformType:[3,r.TYPES.ENUM,i],requireFullSync:[4,r.TYPES.BOOL]},o.internalSpec={primary:[1,r.TYPES.UINT32],secondary:[2,r.TYPES.UINT32],tertiary:[3,r.TYPES.UINT32],quaternary:[4,r.TYPES.UINT32],quinary:[5,r.TYPES.UINT32]}},24808:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Message$StickerMessageSpec=t.Message$SenderKeyDistributionMessageSpec=t.Message$SendPaymentMessageSpec=t.Message$RequestPaymentMessageSpec=t.Message$ReactionMessageSpec=t.Message$ProtocolMessageType=t.Message$ProtocolMessageSpec=t.Message$ProductMessageSpec=t.Message$ProductMessage$ProductSnapshotSpec=t.Message$ProductMessage$CatalogSnapshotSpec=t.Message$PaymentInviteMessageSpec=t.Message$PaymentInviteMessageServiceType=t.Message$OrderMessageSpec=t.Message$OrderMessageOrderSurface=t.Message$OrderMessageOrderStatus=t.Message$LocationMessageSpec=t.Message$LiveLocationMessageSpec=t.Message$ListResponseMessageSpec=t.Message$ListResponseMessageListType=t.Message$ListResponseMessage$SingleSelectReplySpec=t.Message$ListMessageSpec=t.Message$ListMessageListType=t.Message$ListMessage$SectionSpec=t.Message$ListMessage$RowSpec=t.Message$ListMessage$ProductSpec=t.Message$ListMessage$ProductSectionSpec=t.Message$ListMessage$ProductListInfoSpec=t.Message$ListMessage$ProductListHeaderImageSpec=t.Message$InvoiceMessageSpec=t.Message$InvoiceMessageAttachmentType=t.Message$InteractiveResponseMessageSpec=t.Message$InteractiveResponseMessage$NativeFlowResponseMessageSpec=t.Message$InteractiveResponseMessage$BodySpec=t.Message$InteractiveMessageSpec=t.Message$InteractiveMessage$ShopMessageSurface=t.Message$InteractiveMessage$ShopMessageSpec=t.Message$InteractiveMessage$NativeFlowMessageSpec=t.Message$InteractiveMessage$NativeFlowMessage$NativeFlowButtonSpec=t.Message$InteractiveMessage$HeaderSpec=t.Message$InteractiveMessage$FooterSpec=t.Message$InteractiveMessage$CollectionMessageSpec=t.Message$InteractiveMessage$BodySpec=t.Message$InitialSecurityNotificationSettingSyncSpec=t.Message$ImageMessageSpec=t.Message$HistorySyncNotificationSpec=t.Message$HistorySyncNotificationHistorySyncType=t.Message$HighlyStructuredMessageSpec=t.Message$HighlyStructuredMessage$HSMLocalizableParameterSpec=t.Message$HighlyStructuredMessage$HSMLocalizableParameter$HSMDateTimeSpec=t.Message$HighlyStructuredMessage$HSMLocalizableParameter$HSMDateTime$HSMDateTimeUnixEpochSpec=t.Message$HighlyStructuredMessage$HSMLocalizableParameter$HSMDateTime$HSMDateTimeComponentSpec=t.Message$HighlyStructuredMessage$HSMLocalizableParameter$HSMDateTime$HSMDateTimeComponentDayOfWeekType=t.Message$HighlyStructuredMessage$HSMLocalizableParameter$HSMDateTime$HSMDateTimeComponentCalendarType=t.Message$HighlyStructuredMessage$HSMLocalizableParameter$HSMCurrencySpec=t.Message$GroupInviteMessageSpec=t.Message$GroupInviteMessageGroupType=t.Message$FutureProofMessageSpec=t.Message$ExtendedTextMessageSpec=t.Message$ExtendedTextMessagePreviewType=t.Message$ExtendedTextMessageInviteLinkGroupType=t.Message$ExtendedTextMessageFontType=t.Message$DocumentMessageSpec=t.Message$DeviceSentMessageSpec=t.Message$DeclinePaymentRequestMessageSpec=t.Message$ContactsArrayMessageSpec=t.Message$ContactMessageSpec=t.Message$ChatSpec=t.Message$CancelPaymentRequestMessageSpec=t.Message$CallSpec=t.Message$ButtonsResponseMessageType=t.Message$ButtonsResponseMessageSpec=t.Message$ButtonsMessageSpec=t.Message$ButtonsMessageHeaderType=t.Message$ButtonsMessage$ButtonType=t.Message$ButtonsMessage$ButtonSpec=t.Message$ButtonsMessage$Button$NativeFlowInfoSpec=t.Message$ButtonsMessage$Button$ButtonTextSpec=t.Message$AudioMessageSpec=t.Message$AppStateSyncKeySpec=t.Message$AppStateSyncKeyShareSpec=t.Message$AppStateSyncKeyRequestSpec=t.Message$AppStateSyncKeyIdSpec=t.Message$AppStateSyncKeyFingerprintSpec=t.Message$AppStateSyncKeyDataSpec=t.Message$AppStateFatalExceptionNotificationSpec=t.LocationSpec=t.InteractiveAnnotationSpec=t.HydratedTemplateButtonSpec=t.HydratedTemplateButton$HydratedURLButtonSpec=t.HydratedTemplateButton$HydratedQuickReplyButtonSpec=t.HydratedTemplateButton$HydratedCallButtonSpec=t.DisappearingModeSpec=t.DisappearingModeInitiator=t.DeviceListMetadataSpec=t.ContextInfoSpec=t.ContextInfo$ExternalAdReplyInfoSpec=t.ContextInfo$ExternalAdReplyInfoMediaType=t.ContextInfo$AdReplyInfoSpec=t.ContextInfo$AdReplyInfoMediaType=t.ActionLinkSpec=void 0,t.TemplateButtonSpec=t.TemplateButton$URLButtonSpec=t.TemplateButton$QuickReplyButtonSpec=t.TemplateButton$CallButtonSpec=t.PollUpdateMessageSpec=t.PollUpdateMessageContentSpec=t.PollUpdateMessageContent$PollVoteMessageSpec=t.PollCreationMessageSpec=t.PollCreationMessage$OptionSpec=t.PointSpec=t.PaymentBackgroundType=t.PaymentBackgroundSpec=t.PaymentBackground$MediaDataSpec=t.MoneySpec=t.MessageSpec=t.MessageContextInfoSpec=t.Message$VideoMessageSpec=t.Message$VideoMessageAttribution=t.Message$TemplateMessageSpec=t.Message$TemplateMessage$HydratedFourRowTemplateSpec=t.Message$TemplateMessage$FourRowTemplateSpec=t.Message$TemplateButtonReplyMessageSpec=t.Message$StickerSyncRMRMessageSpec=t.Message$StickerMessageSpec=t.Message$SenderKeyDistributionMessageSpec=t.Message$SendPaymentMessageSpec=t.Message$RequestPaymentMessageSpec=t.Message$ReactionMessageSpec=t.Message$ProtocolMessageType=t.Message$ProtocolMessageSpec=t.Message$ProductMessageSpec=t.Message$ProductMessage$ProductSnapshotSpec=t.Message$ProductMessage$CatalogSnapshotSpec=t.Message$PaymentInviteMessageSpec=t.Message$PaymentInviteMessageServiceType=t.Message$OrderMessageSpec=t.Message$OrderMessageOrderSurface=t.Message$OrderMessageOrderStatus=t.Message$LocationMessageSpec=t.Message$LiveLocationMessageSpec=t.Message$ListResponseMessageSpec=t.Message$ListResponseMessageListType=t.Message$ListResponseMessage$SingleSelectReplySpec=t.Message$ListMessageSpec=t.Message$ListMessageListType=t.Message$ListMessage$SectionSpec=t.Message$ListMessage$RowSpec=t.Message$ListMessage$ProductSpec=t.Message$ListMessage$ProductSectionSpec=t.Message$ListMessage$ProductListInfoSpec=t.Message$ListMessage$ProductListHeaderImageSpec=t.Message$InvoiceMessageSpec=t.Message$InvoiceMessageAttachmentType=t.Message$InteractiveResponseMessageSpec=t.Message$InteractiveResponseMessage$NativeFlowResponseMessageSpec=t.Message$InteractiveResponseMessage$BodySpec=t.Message$InteractiveMessageSpec=t.Message$InteractiveMessage$ShopMessageSurface=t.Message$InteractiveMessage$ShopMessageSpec=t.Message$InteractiveMessage$NativeFlowMessageSpec=t.Message$InteractiveMessage$NativeFlowMessage$NativeFlowButtonSpec=t.Message$InteractiveMessage$HeaderSpec=t.Message$InteractiveMessage$FooterSpec=t.Message$InteractiveMessage$CollectionMessageSpec=t.Message$InteractiveMessage$BodySpec=t.Message$InitialSecurityNotificationSettingSyncSpec=t.Message$ImageMessageSpec=t.Message$HistorySyncNotificationSpec=t.Message$HistorySyncNotificationHistorySyncType=t.Message$HighlyStructuredMessageSpec=t.Message$HighlyStructuredMessage$HSMLocalizableParameterSpec=t.Message$HighlyStructuredMessage$HSMLocalizableParameter$HSMDateTimeSpec=t.Message$HighlyStructuredMessage$HSMLocalizableParameter$HSMDateTime$HSMDateTimeUnixEpochSpec=t.Message$HighlyStructuredMessage$HSMLocalizableParameter$HSMDateTime$HSMDateTimeComponentSpec=t.Message$HighlyStructuredMessage$HSMLocalizableParameter$HSMDateTime$HSMDateTimeComponentDayOfWeekType=t.Message$HighlyStructuredMessage$HSMLocalizableParameter$HSMDateTime$HSMDateTimeComponentCalendarType=t.Message$HighlyStructuredMessage$HSMLocalizableParameter$HSMCurrencySpec=t.Message$GroupInviteMessageSpec=t.Message$GroupInviteMessageGroupType=t.Message$FutureProofMessageSpec=t.Message$ExtendedTextMessageSpec=t.Message$ExtendedTextMessagePreviewType=t.Message$ExtendedTextMessageInviteLinkGroupType=t.Message$ExtendedTextMessageFontType=t.Message$DocumentMessageSpec=t.Message$DeviceSentMessageSpec=t.Message$DeclinePaymentRequestMessageSpec=t.Message$ContactsArrayMessageSpec=t.Message$ContactMessageSpec=t.Message$ChatSpec=t.Message$CancelPaymentRequestMessageSpec=t.Message$CallSpec=t.Message$ButtonsResponseMessageType=t.Message$ButtonsResponseMessageSpec=t.Message$ButtonsMessageSpec=t.Message$ButtonsMessageHeaderType=t.Message$ButtonsMessage$ButtonType=t.Message$ButtonsMessage$ButtonSpec=t.Message$ButtonsMessage$Button$NativeFlowInfoSpec=t.Message$ButtonsMessage$Button$ButtonTextSpec=t.Message$AudioMessageSpec=t.Message$AppStateSyncKeySpec=t.Message$AppStateSyncKeyShareSpec=t.Message$AppStateSyncKeyRequestSpec=t.Message$AppStateSyncKeyIdSpec=t.Message$AppStateSyncKeyFingerprintSpec=t.Message$AppStateSyncKeyDataSpec=t.Message$AppStateFatalExceptionNotificationSpec=t.LocationSpec=t.InteractiveAnnotationSpec=t.HydratedTemplateButtonSpec=t.HydratedTemplateButton$HydratedURLButtonSpec=t.HydratedTemplateButton$HydratedQuickReplyButtonSpec=t.HydratedTemplateButton$HydratedCallButtonSpec=t.DisappearingModeSpec=t.DisappearingModeInitiator=t.DeviceListMetadataSpec=t.ContextInfoSpec=t.ContextInfo$ExternalAdReplyInfoSpec=t.ContextInfo$ExternalAdReplyInfoMediaType=t.ContextInfo$AdReplyInfoSpec=t.ContextInfo$AdReplyInfoMediaType=t.ActionLinkSpec=void 0;var r=n(1390),i=n(93890);const a=n(76672)({UNKNOWN:0,DISPLAY_TEXT:1});t.Message$ButtonsResponseMessageType=a;const o=n(76672)({UNKNOWN:0,RESPONSE:1,NATIVE_FLOW:2});t.Message$ButtonsMessage$ButtonType=o;const s=n(76672)({UNKNOWN:0,EMPTY:1,TEXT:2,DOCUMENT:3,IMAGE:4,VIDEO:5,LOCATION:6});t.Message$ButtonsMessageHeaderType=s;const l=n(76672)({DEFAULT:0,PARENT:1});t.Message$GroupInviteMessageGroupType=l;const c=n(76672)({UNKNOWN_SURFACE:0,FB:1,IG:2,WA:3});t.Message$InteractiveMessage$ShopMessageSurface=c;const d=n(76672)({UNKNOWN:0,SINGLE_SELECT:1});t.Message$ListResponseMessageListType=d;const u=n(76672)({UNKNOWN:0,SINGLE_SELECT:1,PRODUCT_LIST:2});t.Message$ListMessageListType=u;const p=n(76672)({CATALOG:1});t.Message$OrderMessageOrderSurface=p;const f=n(76672)({INQUIRY:1});t.Message$OrderMessageOrderStatus=f;const h=n(76672)({UNKNOWN:0,FBPAY:1,NOVI:2,UPI:3});t.Message$PaymentInviteMessageServiceType=h;const _=n(76672)({GREGORIAN:1,SOLAR_HIJRI:2});t.Message$HighlyStructuredMessage$HSMLocalizableParameter$HSMDateTime$HSMDateTimeComponentCalendarType=_;const g=n(76672)({MONDAY:1,TUESDAY:2,WEDNESDAY:3,THURSDAY:4,FRIDAY:5,SATURDAY:6,SUNDAY:7});t.Message$HighlyStructuredMessage$HSMLocalizableParameter$HSMDateTime$HSMDateTimeComponentDayOfWeekType=g;const m=n(76672)({INITIAL_BOOTSTRAP:0,INITIAL_STATUS_V3:1,FULL:2,RECENT:3,PUSH_NAME:4});t.Message$HistorySyncNotificationHistorySyncType=m;const y=n(76672)({REVOKE:0,EPHEMERAL_SETTING:3,EPHEMERAL_SYNC_RESPONSE:4,HISTORY_SYNC_NOTIFICATION:5,APP_STATE_SYNC_KEY_SHARE:6,APP_STATE_SYNC_KEY_REQUEST:7,MSG_FANOUT_BACKFILL_REQUEST:8,INITIAL_SECURITY_NOTIFICATION_SETTING_SYNC:9,APP_STATE_FATAL_EXCEPTION_NOTIFICATION:10});t.Message$ProtocolMessageType=y;const E=n(76672)({NONE:0,GIPHY:1,TENOR:2});t.Message$VideoMessageAttribution=E;const S=n(76672)({DEFAULT:0,PARENT:1});t.Message$ExtendedTextMessageInviteLinkGroupType=S;const v=n(76672)({NONE:0,VIDEO:1});t.Message$ExtendedTextMessagePreviewType=v;const T=n(76672)({SANS_SERIF:0,SERIF:1,NORICAN_REGULAR:2,BRYNDAN_WRITE:3,BEBASNEUE_REGULAR:4,OSWALD_HEAVY:5});t.Message$ExtendedTextMessageFontType=T;const b=n(76672)({IMAGE:0,PDF:1});t.Message$InvoiceMessageAttachmentType=b;const C=n(76672)({NONE:0,IMAGE:1,VIDEO:2});t.ContextInfo$ExternalAdReplyInfoMediaType=C;const A=n(76672)({NONE:0,IMAGE:1,VIDEO:2});t.ContextInfo$AdReplyInfoMediaType=A;const P=n(76672)({UNKNOWN:0,DEFAULT:1});t.PaymentBackgroundType=P;const M=n(76672)({CHANGED_IN_CHAT:0,INITIATED_BY_ME:1,INITIATED_BY_OTHER:2});t.DisappearingModeInitiator=M;const O={};t.MessageSpec=O;const I={};t.Message$StickerSyncRMRMessageSpec=I;const w={};t.Message$ReactionMessageSpec=w;const R={};t.Message$ButtonsResponseMessageSpec=R;const D={};t.Message$ButtonsMessageSpec=D;const L={};t.Message$ButtonsMessage$ButtonSpec=L;const N={};t.Message$ButtonsMessage$Button$NativeFlowInfoSpec=N;const k={};t.Message$ButtonsMessage$Button$ButtonTextSpec=k;const U={};t.Message$FutureProofMessageSpec=U;const G={};t.Message$DeviceSentMessageSpec=G;const x={};t.Message$GroupInviteMessageSpec=x;const B={};t.Message$InteractiveResponseMessageSpec=B;const F={};t.Message$InteractiveResponseMessage$NativeFlowResponseMessageSpec=F;const j={};t.Message$InteractiveResponseMessage$BodySpec=j;const Y={};t.Message$InteractiveMessageSpec=Y;const K={};t.Message$InteractiveMessage$NativeFlowMessageSpec=K;const W={};t.Message$InteractiveMessage$NativeFlowMessage$NativeFlowButtonSpec=W;const H={};t.Message$InteractiveMessage$CollectionMessageSpec=H;const V={};t.Message$InteractiveMessage$ShopMessageSpec=V;const $={};t.Message$InteractiveMessage$FooterSpec=$;const z={};t.Message$InteractiveMessage$BodySpec=z;const q={};t.Message$InteractiveMessage$HeaderSpec=q;const J={};t.Message$ListResponseMessageSpec=J;const Q={};t.Message$ListResponseMessage$SingleSelectReplySpec=Q;const X={};t.Message$ListMessageSpec=X;const Z={};t.Message$ListMessage$ProductListInfoSpec=Z;const ee={};t.Message$ListMessage$ProductListHeaderImageSpec=ee;const te={};t.Message$ListMessage$ProductSectionSpec=te;const ne={};t.Message$ListMessage$ProductSpec=ne;const re={};t.Message$ListMessage$SectionSpec=re;const ie={};t.Message$ListMessage$RowSpec=ie;const ae={};t.Message$OrderMessageSpec=ae;const oe={};t.Message$ProductMessageSpec=oe;const se={};t.Message$ProductMessage$ProductSnapshotSpec=se;const le={};t.Message$ProductMessage$CatalogSnapshotSpec=le;const ce={};t.Message$TemplateButtonReplyMessageSpec=ce;const de={};t.Message$TemplateMessageSpec=de;const ue={};t.Message$TemplateMessage$HydratedFourRowTemplateSpec=ue;const pe={};t.Message$TemplateMessage$FourRowTemplateSpec=pe;const fe={};t.Message$StickerMessageSpec=fe;const he={};t.Message$LiveLocationMessageSpec=he;const _e={};t.Message$PaymentInviteMessageSpec=_e;const ge={};t.Message$CancelPaymentRequestMessageSpec=ge;const me={};t.Message$DeclinePaymentRequestMessageSpec=me;const ye={};t.Message$RequestPaymentMessageSpec=ye;const Ee={};t.Message$SendPaymentMessageSpec=Ee;const Se={};t.Message$HighlyStructuredMessageSpec=Se;const ve={};t.Message$HighlyStructuredMessage$HSMLocalizableParameterSpec=ve;const Te={};t.Message$HighlyStructuredMessage$HSMLocalizableParameter$HSMDateTimeSpec=Te;const be={};t.Message$HighlyStructuredMessage$HSMLocalizableParameter$HSMDateTime$HSMDateTimeUnixEpochSpec=be;const Ce={};t.Message$HighlyStructuredMessage$HSMLocalizableParameter$HSMDateTime$HSMDateTimeComponentSpec=Ce;const Ae={};t.Message$HighlyStructuredMessage$HSMLocalizableParameter$HSMCurrencySpec=Ae;const Pe={};t.Message$ContactsArrayMessageSpec=Pe;const Me={};t.Message$InitialSecurityNotificationSettingSyncSpec=Me;const Oe={};t.Message$AppStateFatalExceptionNotificationSpec=Oe;const Ie={};t.Message$AppStateSyncKeyRequestSpec=Ie;const we={};t.Message$AppStateSyncKeyShareSpec=we;const Re={};t.Message$AppStateSyncKeyDataSpec=Re;const De={};t.Message$AppStateSyncKeyFingerprintSpec=De;const Le={};t.Message$AppStateSyncKeyIdSpec=Le;const Ne={};t.Message$AppStateSyncKeySpec=Ne;const ke={};t.Message$HistorySyncNotificationSpec=ke;const Ue={};t.Message$ProtocolMessageSpec=Ue;const Ge={};t.Message$ChatSpec=Ge;const xe={};t.Message$CallSpec=xe;const Be={};t.Message$VideoMessageSpec=Be;const Fe={};t.Message$AudioMessageSpec=Fe;const je={};t.Message$DocumentMessageSpec=je;const Ye={};t.Message$ExtendedTextMessageSpec=Ye;const Ke={};t.Message$LocationMessageSpec=Ke;const We={};t.Message$ContactMessageSpec=We;const He={};t.Message$InvoiceMessageSpec=He;const Ve={};t.Message$ImageMessageSpec=Ve;const $e={};t.Message$SenderKeyDistributionMessageSpec=$e;const ze={};t.ContextInfoSpec=ze;const qe={};t.ContextInfo$ExternalAdReplyInfoSpec=qe;const Je={};t.ContextInfo$AdReplyInfoSpec=Je;const Qe={};t.MessageContextInfoSpec=Qe;const Xe={};t.DeviceListMetadataSpec=Xe;const Ze={};t.InteractiveAnnotationSpec=Ze;const et={};t.PointSpec=et;const tt={};t.LocationSpec=tt;const nt={};t.TemplateButtonSpec=nt;const rt={};t.TemplateButton$CallButtonSpec=rt;const it={};t.TemplateButton$URLButtonSpec=it;const at={};t.TemplateButton$QuickReplyButtonSpec=at;const ot={};t.HydratedTemplateButtonSpec=ot;const st={};t.HydratedTemplateButton$HydratedCallButtonSpec=st;const lt={};t.HydratedTemplateButton$HydratedURLButtonSpec=lt;const ct={};t.HydratedTemplateButton$HydratedQuickReplyButtonSpec=ct;const dt={};t.MoneySpec=dt;const ut={};t.PaymentBackgroundSpec=ut;const pt={};t.PaymentBackground$MediaDataSpec=pt;const ft={};t.DisappearingModeSpec=ft;const ht={};t.ActionLinkSpec=ht;const _t={};t.PollCreationMessageSpec=_t;const gt={};t.PollCreationMessage$OptionSpec=gt;const mt={};t.PollUpdateMessageSpec=mt;const yt={};t.PollUpdateMessageContentSpec=yt;const Et={};t.PollUpdateMessageContent$PollVoteMessageSpec=Et,O.internalSpec={conversation:[1,r.TYPES.STRING],senderKeyDistributionMessage:[2,r.TYPES.MESSAGE,$e],imageMessage:[3,r.TYPES.MESSAGE,Ve],contactMessage:[4,r.TYPES.MESSAGE,We],locationMessage:[5,r.TYPES.MESSAGE,Ke],extendedTextMessage:[6,r.TYPES.MESSAGE,Ye],documentMessage:[7,r.TYPES.MESSAGE,je],audioMessage:[8,r.TYPES.MESSAGE,Fe],videoMessage:[9,r.TYPES.MESSAGE,Be],call:[10,r.TYPES.MESSAGE,xe],chat:[11,r.TYPES.MESSAGE,Ge],protocolMessage:[12,r.TYPES.MESSAGE,Ue],contactsArrayMessage:[13,r.TYPES.MESSAGE,Pe],highlyStructuredMessage:[14,r.TYPES.MESSAGE,Se],fastRatchetKeySenderKeyDistributionMessage:[15,r.TYPES.MESSAGE,$e],sendPaymentMessage:[16,r.TYPES.MESSAGE,Ee],liveLocationMessage:[18,r.TYPES.MESSAGE,he],requestPaymentMessage:[22,r.TYPES.MESSAGE,ye],declinePaymentRequestMessage:[23,r.TYPES.MESSAGE,me],cancelPaymentRequestMessage:[24,r.TYPES.MESSAGE,ge],templateMessage:[25,r.TYPES.MESSAGE,de],stickerMessage:[26,r.TYPES.MESSAGE,fe],groupInviteMessage:[28,r.TYPES.MESSAGE,x],templateButtonReplyMessage:[29,r.TYPES.MESSAGE,ce],productMessage:[30,r.TYPES.MESSAGE,oe],deviceSentMessage:[31,r.TYPES.MESSAGE,G],messageContextInfo:[35,r.TYPES.MESSAGE,Qe],listMessage:[36,r.TYPES.MESSAGE,X],viewOnceMessage:[37,r.TYPES.MESSAGE,U],orderMessage:[38,r.TYPES.MESSAGE,ae],listResponseMessage:[39,r.TYPES.MESSAGE,J],ephemeralMessage:[40,r.TYPES.MESSAGE,U],invoiceMessage:[41,r.TYPES.MESSAGE,He],buttonsMessage:[42,r.TYPES.MESSAGE,D],buttonsResponseMessage:[43,r.TYPES.MESSAGE,R],paymentInviteMessage:[44,r.TYPES.MESSAGE,_e],interactiveMessage:[45,r.TYPES.MESSAGE,Y],reactionMessage:[46,r.TYPES.MESSAGE,w],stickerSyncRmrMessage:[47,r.TYPES.MESSAGE,I],interactiveResponseMessage:[48,r.TYPES.MESSAGE,B],pollCreationMessage:[49,r.TYPES.MESSAGE,_t],pollUpdateMessage:[50,r.TYPES.MESSAGE,mt]},I.internalSpec={filehash:[1,r.FLAGS.REPEATED|r.TYPES.STRING],rmrSource:[2,r.TYPES.STRING],requestTimestamp:[3,r.TYPES.INT64]},w.internalSpec={key:[1,r.TYPES.MESSAGE,i.MessageKeySpec],text:[2,r.TYPES.STRING],groupingKey:[3,r.TYPES.STRING],senderTimestampMs:[4,r.TYPES.INT64]},R.internalSpec={selectedButtonId:[1,r.TYPES.STRING],selectedDisplayText:[2,r.TYPES.STRING],contextInfo:[3,r.TYPES.MESSAGE,ze],type:[4,r.TYPES.ENUM,a],__oneofs__:{response:["selectedDisplayText"]}},D.internalSpec={text:[1,r.TYPES.STRING],documentMessage:[2,r.TYPES.MESSAGE,je],imageMessage:[3,r.TYPES.MESSAGE,Ve],videoMessage:[4,r.TYPES.MESSAGE,Be],locationMessage:[5,r.TYPES.MESSAGE,Ke],contentText:[6,r.TYPES.STRING],footerText:[7,r.TYPES.STRING],contextInfo:[8,r.TYPES.MESSAGE,ze],buttons:[9,r.FLAGS.REPEATED|r.TYPES.MESSAGE,L],headerType:[10,r.TYPES.ENUM,s],__oneofs__:{header:["text","documentMessage","imageMessage","videoMessage","locationMessage"]}},L.internalSpec={buttonId:[1,r.TYPES.STRING],buttonText:[2,r.TYPES.MESSAGE,k],type:[3,r.TYPES.ENUM,o],nativeFlowInfo:[4,r.TYPES.MESSAGE,N]},N.internalSpec={name:[1,r.TYPES.STRING],paramsJson:[2,r.TYPES.STRING]},k.internalSpec={displayText:[1,r.TYPES.STRING]},U.internalSpec={message:[1,r.TYPES.MESSAGE,O]},G.internalSpec={destinationJid:[1,r.TYPES.STRING],message:[2,r.TYPES.MESSAGE,O],phash:[3,r.TYPES.STRING]},x.internalSpec={groupJid:[1,r.TYPES.STRING],inviteCode:[2,r.TYPES.STRING],inviteExpiration:[3,r.TYPES.INT64],groupName:[4,r.TYPES.STRING],jpegThumbnail:[5,r.TYPES.BYTES],caption:[6,r.TYPES.STRING],contextInfo:[7,r.TYPES.MESSAGE,ze],groupType:[8,r.TYPES.ENUM,l]},B.internalSpec={body:[1,r.TYPES.MESSAGE,j],nativeFlowResponseMessage:[2,r.TYPES.MESSAGE,F],contextInfo:[15,r.TYPES.MESSAGE,ze],__oneofs__:{interactiveResponseMessage:["nativeFlowResponseMessage"]}},F.internalDefaults={version:1},F.internalSpec={name:[1,r.TYPES.STRING],paramsJson:[2,r.TYPES.STRING],version:[3,r.TYPES.INT32]},j.internalSpec={text:[1,r.TYPES.STRING]},Y.internalSpec={header:[1,r.TYPES.MESSAGE,q],body:[2,r.TYPES.MESSAGE,z],footer:[3,r.TYPES.MESSAGE,$],shopStorefrontMessage:[4,r.TYPES.MESSAGE,V],collectionMessage:[5,r.TYPES.MESSAGE,H],nativeFlowMessage:[6,r.TYPES.MESSAGE,K],contextInfo:[15,r.TYPES.MESSAGE,ze],__oneofs__:{interactiveMessage:["shopStorefrontMessage","collectionMessage","nativeFlowMessage"]}},K.internalDefaults={messageVersion:1},K.internalSpec={buttons:[1,r.FLAGS.REPEATED|r.TYPES.MESSAGE,W],messageParamsJson:[2,r.TYPES.STRING],messageVersion:[3,r.TYPES.INT32]},W.internalSpec={name:[1,r.TYPES.STRING],buttonParamsJson:[2,r.TYPES.STRING]},H.internalDefaults={messageVersion:1},H.internalSpec={bizJid:[1,r.TYPES.STRING],id:[2,r.TYPES.STRING],messageVersion:[3,r.TYPES.INT32]},V.internalDefaults={messageVersion:1},V.internalSpec={id:[1,r.TYPES.STRING],surface:[2,r.TYPES.ENUM,c],messageVersion:[3,r.TYPES.INT32]},$.internalSpec={text:[1,r.TYPES.STRING]},z.internalSpec={text:[1,r.TYPES.STRING]},q.internalSpec={title:[1,r.TYPES.STRING],subtitle:[2,r.TYPES.STRING],documentMessage:[3,r.TYPES.MESSAGE,je],imageMessage:[4,r.TYPES.MESSAGE,Ve],jpegThumbnail:[6,r.TYPES.BYTES],videoMessage:[7,r.TYPES.MESSAGE,Be],hasMediaAttachment:[5,r.TYPES.BOOL],__oneofs__:{media:["documentMessage","imageMessage","jpegThumbnail","videoMessage"]}},J.internalSpec={title:[1,r.TYPES.STRING],listType:[2,r.TYPES.ENUM,d],singleSelectReply:[3,r.TYPES.MESSAGE,Q],contextInfo:[4,r.TYPES.MESSAGE,ze],description:[5,r.TYPES.STRING]},Q.internalSpec={selectedRowId:[1,r.TYPES.STRING]},X.internalSpec={title:[1,r.TYPES.STRING],description:[2,r.TYPES.STRING],buttonText:[3,r.TYPES.STRING],listType:[4,r.TYPES.ENUM,u],sections:[5,r.FLAGS.REPEATED|r.TYPES.MESSAGE,re],productListInfo:[6,r.TYPES.MESSAGE,Z],footerText:[7,r.TYPES.STRING],contextInfo:[8,r.TYPES.MESSAGE,ze]},Z.internalSpec={productSections:[1,r.FLAGS.REPEATED|r.TYPES.MESSAGE,te],headerImage:[2,r.TYPES.MESSAGE,ee],businessOwnerJid:[3,r.TYPES.STRING]},ee.internalSpec={productId:[1,r.TYPES.STRING],jpegThumbnail:[2,r.TYPES.BYTES]},te.internalSpec={title:[1,r.TYPES.STRING],products:[2,r.FLAGS.REPEATED|r.TYPES.MESSAGE,ne]},ne.internalSpec={productId:[1,r.TYPES.STRING]},re.internalSpec={title:[1,r.TYPES.STRING],rows:[2,r.FLAGS.REPEATED|r.TYPES.MESSAGE,ie]},ie.internalSpec={title:[1,r.TYPES.STRING],description:[2,r.TYPES.STRING],rowId:[3,r.TYPES.STRING]},ae.internalSpec={orderId:[1,r.TYPES.STRING],thumbnail:[2,r.TYPES.BYTES],itemCount:[3,r.TYPES.INT32],status:[4,r.TYPES.ENUM,f],surface:[5,r.TYPES.ENUM,p],message:[6,r.TYPES.STRING],orderTitle:[7,r.TYPES.STRING],sellerJid:[8,r.TYPES.STRING],token:[9,r.TYPES.STRING],totalAmount1000:[10,r.TYPES.INT64],totalCurrencyCode:[11,r.TYPES.STRING],contextInfo:[17,r.TYPES.MESSAGE,ze]},oe.internalSpec={product:[1,r.TYPES.MESSAGE,se],businessOwnerJid:[2,r.TYPES.STRING],catalog:[4,r.TYPES.MESSAGE,le],body:[5,r.TYPES.STRING],footer:[6,r.TYPES.STRING],contextInfo:[17,r.TYPES.MESSAGE,ze]},se.internalSpec={productImage:[1,r.TYPES.MESSAGE,Ve],productId:[2,r.TYPES.STRING],title:[3,r.TYPES.STRING],description:[4,r.TYPES.STRING],currencyCode:[5,r.TYPES.STRING],priceAmount1000:[6,r.TYPES.INT64],retailerId:[7,r.TYPES.STRING],url:[8,r.TYPES.STRING],productImageCount:[9,r.TYPES.UINT32],firstImageId:[11,r.TYPES.STRING],salePriceAmount1000:[12,r.TYPES.INT64]},le.internalSpec={catalogImage:[1,r.TYPES.MESSAGE,Ve],title:[2,r.TYPES.STRING],description:[3,r.TYPES.STRING]},ce.internalSpec={selectedId:[1,r.TYPES.STRING],selectedDisplayText:[2,r.TYPES.STRING],contextInfo:[3,r.TYPES.MESSAGE,ze],selectedIndex:[4,r.TYPES.UINT32]},de.internalSpec={fourRowTemplate:[1,r.TYPES.MESSAGE,pe],hydratedFourRowTemplate:[2,r.TYPES.MESSAGE,ue],contextInfo:[3,r.TYPES.MESSAGE,ze],hydratedTemplate:[4,r.TYPES.MESSAGE,ue],__oneofs__:{format:["fourRowTemplate","hydratedFourRowTemplate"]}},ue.internalSpec={documentMessage:[1,r.TYPES.MESSAGE,je],hydratedTitleText:[2,r.TYPES.STRING],imageMessage:[3,r.TYPES.MESSAGE,Ve],videoMessage:[4,r.TYPES.MESSAGE,Be],locationMessage:[5,r.TYPES.MESSAGE,Ke],hydratedContentText:[6,r.TYPES.STRING],hydratedFooterText:[7,r.TYPES.STRING],hydratedButtons:[8,r.FLAGS.REPEATED|r.TYPES.MESSAGE,ot],templateId:[9,r.TYPES.STRING],__oneofs__:{title:["documentMessage","hydratedTitleText","imageMessage","videoMessage","locationMessage"]}},pe.internalSpec={documentMessage:[1,r.TYPES.MESSAGE,je],highlyStructuredMessage:[2,r.TYPES.MESSAGE,Se],imageMessage:[3,r.TYPES.MESSAGE,Ve],videoMessage:[4,r.TYPES.MESSAGE,Be],locationMessage:[5,r.TYPES.MESSAGE,Ke],content:[6,r.TYPES.MESSAGE,Se],footer:[7,r.TYPES.MESSAGE,Se],buttons:[8,r.FLAGS.REPEATED|r.TYPES.MESSAGE,nt],__oneofs__:{title:["documentMessage","highlyStructuredMessage","imageMessage","videoMessage","locationMessage"]}},fe.internalSpec={url:[1,r.TYPES.STRING],fileSha256:[2,r.TYPES.BYTES],fileEncSha256:[3,r.TYPES.BYTES],mediaKey:[4,r.TYPES.BYTES],mimetype:[5,r.TYPES.STRING],height:[6,r.TYPES.UINT32],width:[7,r.TYPES.UINT32],directPath:[8,r.TYPES.STRING],fileLength:[9,r.TYPES.UINT64],mediaKeyTimestamp:[10,r.TYPES.INT64],firstFrameLength:[11,r.TYPES.UINT32],firstFrameSidecar:[12,r.TYPES.BYTES],isAnimated:[13,r.TYPES.BOOL],pngThumbnail:[16,r.TYPES.BYTES],contextInfo:[17,r.TYPES.MESSAGE,ze]},he.internalSpec={degreesLatitude:[1,r.TYPES.DOUBLE],degreesLongitude:[2,r.TYPES.DOUBLE],accuracyInMeters:[3,r.TYPES.UINT32],speedInMps:[4,r.TYPES.FLOAT],degreesClockwiseFromMagneticNorth:[5,r.TYPES.UINT32],caption:[6,r.TYPES.STRING],sequenceNumber:[7,r.TYPES.INT64],timeOffset:[8,r.TYPES.UINT32],jpegThumbnail:[16,r.TYPES.BYTES],contextInfo:[17,r.TYPES.MESSAGE,ze]},_e.internalSpec={serviceType:[1,r.TYPES.ENUM,h],expiryTimestamp:[2,r.TYPES.INT64]},ge.internalSpec={key:[1,r.TYPES.MESSAGE,i.MessageKeySpec]},me.internalSpec={key:[1,r.TYPES.MESSAGE,i.MessageKeySpec]},ye.internalSpec={noteMessage:[4,r.TYPES.MESSAGE,O],currencyCodeIso4217:[1,r.TYPES.STRING],amount1000:[2,r.TYPES.UINT64],requestFrom:[3,r.TYPES.STRING],expiryTimestamp:[5,r.TYPES.INT64],amount:[6,r.TYPES.MESSAGE,dt],background:[7,r.TYPES.MESSAGE,ut]},Ee.internalSpec={noteMessage:[2,r.TYPES.MESSAGE,O],requestMessageKey:[3,r.TYPES.MESSAGE,i.MessageKeySpec],background:[4,r.TYPES.MESSAGE,ut]},Se.internalSpec={namespace:[1,r.TYPES.STRING],elementName:[2,r.TYPES.STRING],params:[3,r.FLAGS.REPEATED|r.TYPES.STRING],fallbackLg:[4,r.TYPES.STRING],fallbackLc:[5,r.TYPES.STRING],localizableParams:[6,r.FLAGS.REPEATED|r.TYPES.MESSAGE,ve],deterministicLg:[7,r.TYPES.STRING],deterministicLc:[8,r.TYPES.STRING],hydratedHsm:[9,r.TYPES.MESSAGE,de]},ve.internalSpec={default:[1,r.TYPES.STRING],currency:[2,r.TYPES.MESSAGE,Ae],dateTime:[3,r.TYPES.MESSAGE,Te],__oneofs__:{paramOneof:["currency","dateTime"]}},Te.internalSpec={component:[1,r.TYPES.MESSAGE,Ce],unixEpoch:[2,r.TYPES.MESSAGE,be],__oneofs__:{datetimeOneof:["component","unixEpoch"]}},be.internalSpec={timestamp:[1,r.TYPES.INT64]},Ce.internalSpec={dayOfWeek:[1,r.TYPES.ENUM,g],year:[2,r.TYPES.UINT32],month:[3,r.TYPES.UINT32],dayOfMonth:[4,r.TYPES.UINT32],hour:[5,r.TYPES.UINT32],minute:[6,r.TYPES.UINT32],calendar:[7,r.TYPES.ENUM,_]},Ae.internalSpec={currencyCode:[1,r.TYPES.STRING],amount1000:[2,r.TYPES.INT64]},Pe.internalSpec={displayName:[1,r.TYPES.STRING],contacts:[2,r.FLAGS.REPEATED|r.TYPES.MESSAGE,We],contextInfo:[17,r.TYPES.MESSAGE,ze]},Me.internalSpec={securityNotificationEnabled:[1,r.TYPES.BOOL]},Oe.internalSpec={collectionNames:[1,r.FLAGS.REPEATED|r.TYPES.STRING],timestamp:[2,r.TYPES.INT64]},Ie.internalSpec={keyIds:[1,r.FLAGS.REPEATED|r.TYPES.MESSAGE,Le]},we.internalSpec={keys:[1,r.FLAGS.REPEATED|r.TYPES.MESSAGE,Ne]},Re.internalSpec={keyData:[1,r.TYPES.BYTES],fingerprint:[2,r.TYPES.MESSAGE,De],timestamp:[3,r.TYPES.INT64]},De.internalSpec={rawId:[1,r.TYPES.UINT32],currentIndex:[2,r.TYPES.UINT32],deviceIndexes:[3,r.FLAGS.REPEATED|r.FLAGS.PACKED|r.TYPES.UINT32]},Le.internalSpec={keyId:[1,r.TYPES.BYTES]},Ne.internalSpec={keyId:[1,r.TYPES.MESSAGE,Le],keyData:[2,r.TYPES.MESSAGE,Re]},ke.internalSpec={fileSha256:[1,r.TYPES.BYTES],fileLength:[2,r.TYPES.UINT64],mediaKey:[3,r.TYPES.BYTES],fileEncSha256:[4,r.TYPES.BYTES],directPath:[5,r.TYPES.STRING],syncType:[6,r.TYPES.ENUM,m],chunkOrder:[7,r.TYPES.UINT32],originalMessageId:[8,r.TYPES.STRING]},Ue.internalSpec={key:[1,r.TYPES.MESSAGE,i.MessageKeySpec],type:[2,r.TYPES.ENUM,y],ephemeralExpiration:[4,r.TYPES.UINT32],ephemeralSettingTimestamp:[5,r.TYPES.INT64],historySyncNotification:[6,r.TYPES.MESSAGE,ke],appStateSyncKeyShare:[7,r.TYPES.MESSAGE,we],appStateSyncKeyRequest:[8,r.TYPES.MESSAGE,Ie],initialSecurityNotificationSettingSync:[9,r.TYPES.MESSAGE,Me],appStateFatalExceptionNotification:[10,r.TYPES.MESSAGE,Oe],disappearingMode:[11,r.TYPES.MESSAGE,ft]},Ge.internalSpec={displayName:[1,r.TYPES.STRING],id:[2,r.TYPES.STRING]},xe.internalSpec={callKey:[1,r.TYPES.BYTES],conversionSource:[2,r.TYPES.STRING],conversionData:[3,r.TYPES.BYTES],conversionDelaySeconds:[4,r.TYPES.UINT32]},Be.internalSpec={url:[1,r.TYPES.STRING],mimetype:[2,r.TYPES.STRING],fileSha256:[3,r.TYPES.BYTES],fileLength:[4,r.TYPES.UINT64],seconds:[5,r.TYPES.UINT32],mediaKey:[6,r.TYPES.BYTES],caption:[7,r.TYPES.STRING],gifPlayback:[8,r.TYPES.BOOL],height:[9,r.TYPES.UINT32],width:[10,r.TYPES.UINT32],fileEncSha256:[11,r.TYPES.BYTES],interactiveAnnotations:[12,r.FLAGS.REPEATED|r.TYPES.MESSAGE,Ze],directPath:[13,r.TYPES.STRING],mediaKeyTimestamp:[14,r.TYPES.INT64],jpegThumbnail:[16,r.TYPES.BYTES],contextInfo:[17,r.TYPES.MESSAGE,ze],streamingSidecar:[18,r.TYPES.BYTES],gifAttribution:[19,r.TYPES.ENUM,E],viewOnce:[20,r.TYPES.BOOL],thumbnailDirectPath:[21,r.TYPES.STRING],thumbnailSha256:[22,r.TYPES.BYTES],thumbnailEncSha256:[23,r.TYPES.BYTES],staticUrl:[24,r.TYPES.STRING]},Fe.internalSpec={url:[1,r.TYPES.STRING],mimetype:[2,r.TYPES.STRING],fileSha256:[3,r.TYPES.BYTES],fileLength:[4,r.TYPES.UINT64],seconds:[5,r.TYPES.UINT32],ptt:[6,r.TYPES.BOOL],mediaKey:[7,r.TYPES.BYTES],fileEncSha256:[8,r.TYPES.BYTES],directPath:[9,r.TYPES.STRING],mediaKeyTimestamp:[10,r.TYPES.INT64],contextInfo:[17,r.TYPES.MESSAGE,ze],streamingSidecar:[18,r.TYPES.BYTES],waveform:[19,r.TYPES.BYTES]},je.internalSpec={url:[1,r.TYPES.STRING],mimetype:[2,r.TYPES.STRING],title:[3,r.TYPES.STRING],fileSha256:[4,r.TYPES.BYTES],fileLength:[5,r.TYPES.UINT64],pageCount:[6,r.TYPES.UINT32],mediaKey:[7,r.TYPES.BYTES],fileName:[8,r.TYPES.STRING],fileEncSha256:[9,r.TYPES.BYTES],directPath:[10,r.TYPES.STRING],mediaKeyTimestamp:[11,r.TYPES.INT64],contactVcard:[12,r.TYPES.BOOL],thumbnailDirectPath:[13,r.TYPES.STRING],thumbnailSha256:[14,r.TYPES.BYTES],thumbnailEncSha256:[15,r.TYPES.BYTES],jpegThumbnail:[16,r.TYPES.BYTES],contextInfo:[17,r.TYPES.MESSAGE,ze],thumbnailHeight:[18,r.TYPES.UINT32],thumbnailWidth:[19,r.TYPES.UINT32]},Ye.internalSpec={text:[1,r.TYPES.STRING],matchedText:[2,r.TYPES.STRING],canonicalUrl:[4,r.TYPES.STRING],description:[5,r.TYPES.STRING],title:[6,r.TYPES.STRING],textArgb:[7,r.TYPES.FIXED32],backgroundArgb:[8,r.TYPES.FIXED32],font:[9,r.TYPES.ENUM,T],previewType:[10,r.TYPES.ENUM,v],jpegThumbnail:[16,r.TYPES.BYTES],contextInfo:[17,r.TYPES.MESSAGE,ze],doNotPlayInline:[18,r.TYPES.BOOL],thumbnailDirectPath:[19,r.TYPES.STRING],thumbnailSha256:[20,r.TYPES.BYTES],thumbnailEncSha256:[21,r.TYPES.BYTES],mediaKey:[22,r.TYPES.BYTES],mediaKeyTimestamp:[23,r.TYPES.INT64],thumbnailHeight:[24,r.TYPES.UINT32],thumbnailWidth:[25,r.TYPES.UINT32],inviteLinkGroupType:[26,r.TYPES.ENUM,S]},Ke.internalSpec={degreesLatitude:[1,r.TYPES.DOUBLE],degreesLongitude:[2,r.TYPES.DOUBLE],name:[3,r.TYPES.STRING],address:[4,r.TYPES.STRING],url:[5,r.TYPES.STRING],isLive:[6,r.TYPES.BOOL],accuracyInMeters:[7,r.TYPES.UINT32],speedInMps:[8,r.TYPES.FLOAT],degreesClockwiseFromMagneticNorth:[9,r.TYPES.UINT32],comment:[11,r.TYPES.STRING],jpegThumbnail:[16,r.TYPES.BYTES],contextInfo:[17,r.TYPES.MESSAGE,ze]},We.internalSpec={displayName:[1,r.TYPES.STRING],vcard:[16,r.TYPES.STRING],contextInfo:[17,r.TYPES.MESSAGE,ze]},He.internalSpec={note:[1,r.TYPES.STRING],token:[2,r.TYPES.STRING],attachmentType:[3,r.TYPES.ENUM,b],attachmentMimetype:[4,r.TYPES.STRING],attachmentMediaKey:[5,r.TYPES.BYTES],attachmentMediaKeyTimestamp:[6,r.TYPES.INT64],attachmentFileSha256:[7,r.TYPES.BYTES],attachmentFileEncSha256:[8,r.TYPES.BYTES],attachmentDirectPath:[9,r.TYPES.STRING],attachmentJpegThumbnail:[10,r.TYPES.BYTES]},Ve.internalSpec={url:[1,r.TYPES.STRING],mimetype:[2,r.TYPES.STRING],caption:[3,r.TYPES.STRING],fileSha256:[4,r.TYPES.BYTES],fileLength:[5,r.TYPES.UINT64],height:[6,r.TYPES.UINT32],width:[7,r.TYPES.UINT32],mediaKey:[8,r.TYPES.BYTES],fileEncSha256:[9,r.TYPES.BYTES],interactiveAnnotations:[10,r.FLAGS.REPEATED|r.TYPES.MESSAGE,Ze],directPath:[11,r.TYPES.STRING],mediaKeyTimestamp:[12,r.TYPES.INT64],jpegThumbnail:[16,r.TYPES.BYTES],contextInfo:[17,r.TYPES.MESSAGE,ze],firstScanSidecar:[18,r.TYPES.BYTES],firstScanLength:[19,r.TYPES.UINT32],experimentGroupId:[20,r.TYPES.UINT32],scansSidecar:[21,r.TYPES.BYTES],scanLengths:[22,r.FLAGS.REPEATED|r.TYPES.UINT32],midQualityFileSha256:[23,r.TYPES.BYTES],midQualityFileEncSha256:[24,r.TYPES.BYTES],viewOnce:[25,r.TYPES.BOOL],thumbnailDirectPath:[26,r.TYPES.STRING],thumbnailSha256:[27,r.TYPES.BYTES],thumbnailEncSha256:[28,r.TYPES.BYTES],staticUrl:[29,r.TYPES.STRING]},$e.internalSpec={groupId:[1,r.TYPES.STRING],axolotlSenderKeyDistributionMessage:[2,r.TYPES.BYTES]},ze.internalSpec={stanzaId:[1,r.TYPES.STRING],participant:[2,r.TYPES.STRING],quotedMessage:[3,r.TYPES.MESSAGE,O],remoteJid:[4,r.TYPES.STRING],mentionedJid:[15,r.FLAGS.REPEATED|r.TYPES.STRING],conversionSource:[18,r.TYPES.STRING],conversionData:[19,r.TYPES.BYTES],conversionDelaySeconds:[20,r.TYPES.UINT32],forwardingScore:[21,r.TYPES.UINT32],isForwarded:[22,r.TYPES.BOOL],quotedAd:[23,r.TYPES.MESSAGE,Je],placeholderKey:[24,r.TYPES.MESSAGE,i.MessageKeySpec],expiration:[25,r.TYPES.UINT32],ephemeralSettingTimestamp:[26,r.TYPES.INT64],ephemeralSharedSecret:[27,r.TYPES.BYTES],externalAdReply:[28,r.TYPES.MESSAGE,qe],entryPointConversionSource:[29,r.TYPES.STRING],entryPointConversionApp:[30,r.TYPES.STRING],entryPointConversionDelaySeconds:[31,r.TYPES.UINT32],disappearingMode:[32,r.TYPES.MESSAGE,ft],actionLink:[33,r.TYPES.MESSAGE,ht],groupSubject:[34,r.TYPES.STRING],parentGroupJid:[35,r.TYPES.STRING]},qe.internalSpec={title:[1,r.TYPES.STRING],body:[2,r.TYPES.STRING],mediaType:[3,r.TYPES.ENUM,C],thumbnailUrl:[4,r.TYPES.STRING],mediaUrl:[5,r.TYPES.STRING],thumbnail:[6,r.TYPES.BYTES],sourceType:[7,r.TYPES.STRING],sourceId:[8,r.TYPES.STRING],sourceUrl:[9,r.TYPES.STRING],containsAutoReply:[10,r.TYPES.BOOL],renderLargerThumbnail:[11,r.TYPES.BOOL],showAdAttribution:[12,r.TYPES.BOOL]},Je.internalSpec={advertiserName:[1,r.TYPES.STRING],mediaType:[2,r.TYPES.ENUM,A],jpegThumbnail:[16,r.TYPES.BYTES],caption:[17,r.TYPES.STRING]},Qe.internalSpec={deviceListMetadata:[1,r.TYPES.MESSAGE,Xe],deviceListMetadataVersion:[2,r.TYPES.INT32]},Xe.internalSpec={senderKeyHash:[1,r.TYPES.BYTES],senderTimestamp:[2,r.TYPES.UINT64],senderKeyIndexes:[3,r.FLAGS.REPEATED|r.FLAGS.PACKED|r.TYPES.UINT32],recipientKeyHash:[8,r.TYPES.BYTES],recipientTimestamp:[9,r.TYPES.UINT64],recipientKeyIndexes:[10,r.FLAGS.REPEATED|r.FLAGS.PACKED|r.TYPES.UINT32]},Ze.internalSpec={polygonVertices:[1,r.FLAGS.REPEATED|r.TYPES.MESSAGE,et],location:[2,r.TYPES.MESSAGE,tt],__oneofs__:{action:["location"]}},et.internalSpec={xDeprecated:[1,r.TYPES.INT32],yDeprecated:[2,r.TYPES.INT32],x:[3,r.TYPES.DOUBLE],y:[4,r.TYPES.DOUBLE]},tt.internalSpec={degreesLatitude:[1,r.TYPES.DOUBLE],degreesLongitude:[2,r.TYPES.DOUBLE],name:[3,r.TYPES.STRING]},nt.internalSpec={quickReplyButton:[1,r.TYPES.MESSAGE,at],urlButton:[2,r.TYPES.MESSAGE,it],callButton:[3,r.TYPES.MESSAGE,rt],index:[4,r.TYPES.UINT32],__oneofs__:{button:["quickReplyButton","urlButton","callButton"]}},rt.internalSpec={displayText:[1,r.TYPES.MESSAGE,Se],phoneNumber:[2,r.TYPES.MESSAGE,Se]},it.internalSpec={displayText:[1,r.TYPES.MESSAGE,Se],url:[2,r.TYPES.MESSAGE,Se]},at.internalSpec={displayText:[1,r.TYPES.MESSAGE,Se],id:[2,r.TYPES.STRING]},ot.internalSpec={quickReplyButton:[1,r.TYPES.MESSAGE,ct],urlButton:[2,r.TYPES.MESSAGE,lt],callButton:[3,r.TYPES.MESSAGE,st],index:[4,r.TYPES.UINT32],__oneofs__:{hydratedButton:["quickReplyButton","urlButton","callButton"]}},st.internalSpec={displayText:[1,r.TYPES.STRING],phoneNumber:[2,r.TYPES.STRING]},lt.internalSpec={displayText:[1,r.TYPES.STRING],url:[2,r.TYPES.STRING]},ct.internalSpec={displayText:[1,r.TYPES.STRING],id:[2,r.TYPES.STRING]},dt.internalSpec={value:[1,r.TYPES.INT64],offset:[2,r.TYPES.UINT32],currencyCode:[3,r.TYPES.STRING]},ut.internalSpec={id:[1,r.TYPES.STRING],fileLength:[2,r.TYPES.UINT64],width:[3,r.TYPES.UINT32],height:[4,r.TYPES.UINT32],mimetype:[5,r.TYPES.STRING],placeholderArgb:[6,r.TYPES.FIXED32],textArgb:[7,r.TYPES.FIXED32],subtextArgb:[8,r.TYPES.FIXED32],mediaData:[9,r.TYPES.MESSAGE,pt],type:[10,r.TYPES.ENUM,P]},pt.internalSpec={mediaKey:[1,r.TYPES.BYTES],mediaKeyTimestamp:[2,r.TYPES.INT64],fileSha256:[3,r.TYPES.BYTES],fileEncSha256:[4,r.TYPES.BYTES],directPath:[5,r.TYPES.STRING]},ft.internalSpec={initiator:[1,r.TYPES.ENUM,M]},ht.internalSpec={url:[1,r.TYPES.STRING],buttonTitle:[2,r.TYPES.STRING]},_t.internalSpec={encKey:[1,r.TYPES.BYTES],name:[2,r.TYPES.STRING],options:[3,r.FLAGS.REPEATED|r.TYPES.MESSAGE,gt],selectableOptionsCount:[4,r.TYPES.UINT32]},gt.internalSpec={optionName:[1,r.TYPES.STRING]},mt.internalSpec={pollCreationMessageKey:[1,r.TYPES.MESSAGE,i.MessageKeySpec],encPayload:[2,r.TYPES.BYTES],encIv:[3,r.TYPES.BYTES]},yt.internalSpec={voteMessage:[1,r.TYPES.MESSAGE,Et],__oneofs__:{update:["voteMessage"]}},Et.internalSpec={selectedOptions:[1,r.FLAGS.REPEATED|r.TYPES.BYTES],senderTimestampMs:[2,r.TYPES.INT64]}},28286:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EphemeralSettingSpec=void 0;var r=n(1390);const i={};t.EphemeralSettingSpec=i,i.internalSpec={duration:[1,r.TYPES.SFIXED32],timestamp:[2,r.TYPES.SFIXED64]}},73027:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WallpaperSettingsSpec=t.PushnameSpec=t.MediaVisibility=t.HistorySyncSpec=t.HistorySyncMsgSpec=t.HistorySyncHistorySyncType=t.GroupParticipantSpec=t.GroupParticipantRank=t.GlobalSettingsSpec=t.ConversationSpec=t.ConversationEndOfHistoryTransferType=t.AutoDownloadSettingsSpec=void 0;var r=n(1390),i=n(21224),a=n(24808);const o=n(76672)({INITIAL_BOOTSTRAP:0,INITIAL_STATUS_V3:1,FULL:2,RECENT:3,PUSH_NAME:4});t.HistorySyncHistorySyncType=o;const s=n(76672)({COMPLETE_BUT_MORE_MESSAGES_REMAIN_ON_PRIMARY:0,COMPLETE_AND_NO_MORE_MESSAGE_REMAIN_ON_PRIMARY:1});t.ConversationEndOfHistoryTransferType=s;const l=n(76672)({REGULAR:0,ADMIN:1,SUPERADMIN:2});t.GroupParticipantRank=l;const c=n(76672)({DEFAULT:0,OFF:1,ON:2});t.MediaVisibility=c;const d={};t.HistorySyncSpec=d;const u={};t.ConversationSpec=u;const p={};t.HistorySyncMsgSpec=p;const f={};t.PushnameSpec=f;const h={};t.GroupParticipantSpec=h;const _={};t.WallpaperSettingsSpec=_;const g={};t.GlobalSettingsSpec=g;const m={};t.AutoDownloadSettingsSpec=m,d.internalSpec={syncType:[1,r.FLAGS.REQUIRED|r.TYPES.ENUM,o],conversations:[2,r.FLAGS.REPEATED|r.TYPES.MESSAGE,u],statusV3Messages:[3,r.FLAGS.REPEATED|r.TYPES.MESSAGE,i.WebMessageInfoSpec],chunkOrder:[5,r.TYPES.UINT32],progress:[6,r.TYPES.UINT32],pushnames:[7,r.FLAGS.REPEATED|r.TYPES.MESSAGE,f],globalSettings:[8,r.TYPES.MESSAGE,g],threadIdUserSecret:[9,r.TYPES.BYTES],threadDsTimeframeOffset:[10,r.TYPES.UINT32]},u.internalSpec={id:[1,r.FLAGS.REQUIRED|r.TYPES.STRING],messages:[2,r.FLAGS.REPEATED|r.TYPES.MESSAGE,p],newJid:[3,r.TYPES.STRING],oldJid:[4,r.TYPES.STRING],lastMsgTimestamp:[5,r.TYPES.UINT64],unreadCount:[6,r.TYPES.UINT32],readOnly:[7,r.TYPES.BOOL],endOfHistoryTransfer:[8,r.TYPES.BOOL],ephemeralExpiration:[9,r.TYPES.UINT32],ephemeralSettingTimestamp:[10,r.TYPES.INT64],endOfHistoryTransferType:[11,r.TYPES.ENUM,s],conversationTimestamp:[12,r.TYPES.UINT64],name:[13,r.TYPES.STRING],pHash:[14,r.TYPES.STRING],notSpam:[15,r.TYPES.BOOL],archived:[16,r.TYPES.BOOL],disappearingMode:[17,r.TYPES.MESSAGE,a.DisappearingModeSpec],unreadMentionCount:[18,r.TYPES.UINT32],markedAsUnread:[19,r.TYPES.BOOL],participant:[20,r.FLAGS.REPEATED|r.TYPES.MESSAGE,h],tcToken:[21,r.TYPES.BYTES],tcTokenTimestamp:[22,r.TYPES.UINT64],contactPrimaryIdentityKey:[23,r.TYPES.BYTES],pinned:[24,r.TYPES.UINT32],muteEndTime:[25,r.TYPES.UINT64],wallpaper:[26,r.TYPES.MESSAGE,_],mediaVisibility:[27,r.TYPES.ENUM,c],tcTokenSenderTimestamp:[28,r.TYPES.UINT64],suspended:[29,r.TYPES.BOOL]},p.internalSpec={message:[1,r.TYPES.MESSAGE,i.WebMessageInfoSpec],msgOrderId:[2,r.TYPES.UINT64]},f.internalSpec={id:[1,r.TYPES.STRING],pushname:[2,r.TYPES.STRING]},h.internalSpec={userJid:[1,r.FLAGS.REQUIRED|r.TYPES.STRING],rank:[2,r.TYPES.ENUM,l]},_.internalSpec={filename:[1,r.TYPES.STRING],opacity:[2,r.TYPES.UINT32]},g.internalSpec={lightThemeWallpaper:[1,r.TYPES.MESSAGE,_],mediaVisibility:[2,r.TYPES.ENUM,c],darkThemeWallpaper:[3,r.TYPES.MESSAGE,_],autoDownloadWiFi:[4,r.TYPES.MESSAGE,m],autoDownloadCellular:[5,r.TYPES.MESSAGE,m],autoDownloadRoaming:[6,r.TYPES.MESSAGE,m],showIndividualNotificationsPreview:[7,r.TYPES.BOOL],showGroupNotificationsPreview:[8,r.TYPES.BOOL]},m.internalSpec={downloadImages:[1,r.TYPES.BOOL],downloadAudio:[2,r.TYPES.BOOL],downloadVideo:[3,r.TYPES.BOOL],downloadDocuments:[4,r.TYPES.BOOL]}},82348:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MsgRowOpaqueDataSpec=t.MsgOpaqueDataSpec=void 0;var r=n(1390);const i={};t.MsgRowOpaqueDataSpec=i;const a={};t.MsgOpaqueDataSpec=a,i.internalSpec={currentMsg:[1,r.TYPES.MESSAGE,a],quotedMsg:[2,r.TYPES.MESSAGE,a]},a.internalSpec={body:[1,r.TYPES.STRING],caption:[3,r.TYPES.STRING],lng:[5,r.TYPES.DOUBLE],isLive:[6,r.TYPES.BOOL],lat:[7,r.TYPES.DOUBLE],paymentAmount1000:[8,r.TYPES.INT32],paymentNoteMsgBody:[9,r.TYPES.STRING],canonicalUrl:[10,r.TYPES.STRING],matchedText:[11,r.TYPES.STRING],title:[12,r.TYPES.STRING],description:[13,r.TYPES.STRING],futureproofBuffer:[14,r.TYPES.BYTES],clientUrl:[15,r.TYPES.STRING],loc:[16,r.TYPES.STRING]}},16258:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ServerErrorReceiptSpec=t.MediaRetryNotificationSpec=t.MediaRetryNotificationResultType=void 0;var r=n(1390);const i=n(76672)({GENERAL_ERROR:0,SUCCESS:1,NOT_FOUND:2,DECRYPTION_ERROR:3});t.MediaRetryNotificationResultType=i;const a={};t.MediaRetryNotificationSpec=a;const o={};t.ServerErrorReceiptSpec=o,a.internalSpec={stanzaId:[1,r.TYPES.STRING],directPath:[2,r.TYPES.STRING],result:[3,r.TYPES.ENUM,i]},o.internalSpec={stanzaId:[1,r.TYPES.STRING]}},93890:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MessageKeySpec=void 0;var r=n(1390);const i={};t.MessageKeySpec=i,i.internalSpec={remoteJid:[1,r.TYPES.STRING],fromMe:[2,r.TYPES.BOOL],id:[3,r.TYPES.STRING],participant:[4,r.TYPES.STRING]}},91344:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VerifiedNameCertificateSpec=t.VerifiedNameCertificate$DetailsSpec=t.LocalizedNameSpec=t.BizIdentityInfoVerifiedLevelValue=t.BizIdentityInfoSpec=t.BizIdentityInfoHostStorageType=t.BizIdentityInfoActualActorsType=t.BizAccountPayloadSpec=t.BizAccountLinkInfoSpec=t.BizAccountLinkInfoHostStorageType=t.BizAccountLinkInfoAccountType=void 0;var r=n(1390);const i=n(76672)({ENTERPRISE:0});t.BizAccountLinkInfoAccountType=i;const a=n(76672)({ON_PREMISE:0,FACEBOOK:1});t.BizAccountLinkInfoHostStorageType=a;const o=n(76672)({SELF:0,BSP:1});t.BizIdentityInfoActualActorsType=o;const s=n(76672)({ON_PREMISE:0,FACEBOOK:1});t.BizIdentityInfoHostStorageType=s;const l=n(76672)({UNKNOWN:0,LOW:1,HIGH:2});t.BizIdentityInfoVerifiedLevelValue=l;const c={};t.LocalizedNameSpec=c;const d={};t.VerifiedNameCertificateSpec=d;const u={};t.VerifiedNameCertificate$DetailsSpec=u;const p={};t.BizAccountPayloadSpec=p;const f={};t.BizAccountLinkInfoSpec=f;const h={};t.BizIdentityInfoSpec=h,c.internalSpec={lg:[1,r.TYPES.STRING],lc:[2,r.TYPES.STRING],verifiedName:[3,r.TYPES.STRING]},d.internalSpec={details:[1,r.TYPES.BYTES],signature:[2,r.TYPES.BYTES],serverSignature:[3,r.TYPES.BYTES]},u.internalSpec={serial:[1,r.TYPES.UINT64],issuer:[2,r.TYPES.STRING],verifiedName:[4,r.TYPES.STRING],localizedNames:[8,r.FLAGS.REPEATED|r.TYPES.MESSAGE,c],issueTime:[10,r.TYPES.UINT64]},p.internalSpec={vnameCert:[1,r.TYPES.MESSAGE,d],bizAcctLinkInfo:[2,r.TYPES.BYTES]},f.internalSpec={whatsappBizAcctFbid:[1,r.TYPES.UINT64],whatsappAcctNumber:[2,r.TYPES.STRING],issueTime:[3,r.TYPES.UINT64],hostStorage:[4,r.TYPES.ENUM,a],accountType:[5,r.TYPES.ENUM,i]},h.internalSpec={vlevel:[1,r.TYPES.ENUM,l],vnameCert:[2,r.TYPES.MESSAGE,d],signed:[3,r.TYPES.BOOL],revoked:[4,r.TYPES.BOOL],hostStorage:[5,r.TYPES.ENUM,s],actualActors:[6,r.TYPES.ENUM,o],privacyModeTs:[7,r.TYPES.UINT64],featureControls:[8,r.TYPES.UINT64]}},84331:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NoiseCertificateSpec=t.NoiseCertificate$DetailsSpec=t.HandshakeMessageSpec=t.HandshakeMessage$ServerHelloSpec=t.HandshakeMessage$ClientHelloSpec=t.HandshakeMessage$ClientFinishSpec=t.ClientPayloadSpec=t.ClientPayloadProduct=t.ClientPayloadIOSAppExtension=t.ClientPayloadConnectType=t.ClientPayloadConnectReason=t.ClientPayload$WebInfoWebSubPlatform=t.ClientPayload$WebInfoSpec=t.ClientPayload$WebInfo$WebdPayloadSpec=t.ClientPayload$UserAgentSpec=t.ClientPayload$UserAgentReleaseChannel=t.ClientPayload$UserAgentPlatform=t.ClientPayload$UserAgent$AppVersionSpec=t.ClientPayload$DNSSourceSpec=t.ClientPayload$DNSSourceDNSResolutionMethod=t.ClientPayload$CompanionRegDataSpec=void 0;var r=n(1390);const i=n(76672)({WHATSAPP:0,MESSENGER:1});t.ClientPayloadProduct=i;const a=n(76672)({SYSTEM:0,GOOGLE:1,HARDCODED:2,OVERRIDE:3,FALLBACK:4});t.ClientPayload$DNSSourceDNSResolutionMethod=a;const o=n(76672)({CELLULAR_UNKNOWN:0,WIFI_UNKNOWN:1,CELLULAR_EDGE:100,CELLULAR_IDEN:101,CELLULAR_UMTS:102,CELLULAR_EVDO:103,CELLULAR_GPRS:104,CELLULAR_HSDPA:105,CELLULAR_HSUPA:106,CELLULAR_HSPA:107,CELLULAR_CDMA:108,CELLULAR_1XRTT:109,CELLULAR_EHRPD:110,CELLULAR_LTE:111,CELLULAR_HSPAP:112});t.ClientPayloadConnectType=o;const s=n(76672)({PUSH:0,USER_ACTIVATED:1,SCHEDULED:2,ERROR_RECONNECT:3,NETWORK_SWITCH:4,PING_RECONNECT:5});t.ClientPayloadConnectReason=s;const l=n(76672)({SHARE_EXTENSION:0,SERVICE_EXTENSION:1,INTENTS_EXTENSION:2});t.ClientPayloadIOSAppExtension=l;const c=n(76672)({WEB_BROWSER:0,APP_STORE:1,WIN_STORE:2,DARWIN:3,WIN32:4});t.ClientPayload$WebInfoWebSubPlatform=c;const d=n(76672)({RELEASE:0,BETA:1,ALPHA:2,DEBUG:3});t.ClientPayload$UserAgentReleaseChannel=d;const u=n(76672)({ANDROID:0,IOS:1,WINDOWS_PHONE:2,BLACKBERRY:3,BLACKBERRYX:4,S40:5,S60:6,PYTHON_CLIENT:7,TIZEN:8,ENTERPRISE:9,SMB_ANDROID:10,KAIOS:11,SMB_IOS:12,WINDOWS:13,WEB:14,PORTAL:15,GREEN_ANDROID:16,GREEN_IPHONE:17,BLUE_ANDROID:18,BLUE_IPHONE:19,FBLITE_ANDROID:20,MLITE_ANDROID:21,IGLITE_ANDROID:22,PAGE:23,MACOS:24,OCULUS_MSG:25,OCULUS_CALL:26,MILAN:27,CAPI:28});t.ClientPayload$UserAgentPlatform=u;const p={};t.HandshakeMessageSpec=p;const f={};t.HandshakeMessage$ClientFinishSpec=f;const h={};t.HandshakeMessage$ServerHelloSpec=h;const _={};t.HandshakeMessage$ClientHelloSpec=_;const g={};t.NoiseCertificateSpec=g;const m={};t.NoiseCertificate$DetailsSpec=m;const y={};t.ClientPayloadSpec=y;const E={};t.ClientPayload$CompanionRegDataSpec=E;const S={};t.ClientPayload$DNSSourceSpec=S;const v={};t.ClientPayload$WebInfoSpec=v;const T={};t.ClientPayload$WebInfo$WebdPayloadSpec=T;const b={};t.ClientPayload$UserAgentSpec=b;const C={};t.ClientPayload$UserAgent$AppVersionSpec=C,p.internalSpec={clientHello:[2,r.TYPES.MESSAGE,_],serverHello:[3,r.TYPES.MESSAGE,h],clientFinish:[4,r.TYPES.MESSAGE,f]},f.internalSpec={static:[1,r.TYPES.BYTES],payload:[2,r.TYPES.BYTES]},h.internalSpec={ephemeral:[1,r.TYPES.BYTES],static:[2,r.TYPES.BYTES],payload:[3,r.TYPES.BYTES]},_.internalSpec={ephemeral:[1,r.TYPES.BYTES],static:[2,r.TYPES.BYTES],payload:[3,r.TYPES.BYTES]},g.internalSpec={details:[1,r.TYPES.BYTES],signature:[2,r.TYPES.BYTES]},m.internalSpec={serial:[1,r.TYPES.UINT32],issuer:[2,r.TYPES.STRING],expires:[3,r.TYPES.UINT64],subject:[4,r.TYPES.STRING],key:[5,r.TYPES.BYTES]},y.internalSpec={username:[1,r.TYPES.UINT64],passive:[3,r.TYPES.BOOL],userAgent:[5,r.TYPES.MESSAGE,b],webInfo:[6,r.TYPES.MESSAGE,v],pushName:[7,r.TYPES.STRING],sessionId:[9,r.TYPES.SFIXED32],shortConnect:[10,r.TYPES.BOOL],connectType:[12,r.TYPES.ENUM,o],connectReason:[13,r.TYPES.ENUM,s],shards:[14,r.FLAGS.REPEATED|r.TYPES.INT32],dnsSource:[15,r.TYPES.MESSAGE,S],connectAttemptCount:[16,r.TYPES.UINT32],device:[18,r.TYPES.UINT32],regData:[19,r.TYPES.MESSAGE,E],product:[20,r.TYPES.ENUM,i],fbCat:[21,r.TYPES.BYTES],fbUserAgent:[22,r.TYPES.BYTES],oc:[23,r.TYPES.BOOL],lc:[24,r.TYPES.INT32],iosAppExtension:[30,r.TYPES.ENUM,l],fbAppId:[31,r.TYPES.UINT64],fbDeviceId:[32,r.TYPES.BYTES],pull:[33,r.TYPES.BOOL]},E.internalSpec={eRegid:[1,r.TYPES.BYTES],eKeytype:[2,r.TYPES.BYTES],eIdent:[3,r.TYPES.BYTES],eSkeyId:[4,r.TYPES.BYTES],eSkeyVal:[5,r.TYPES.BYTES],eSkeySig:[6,r.TYPES.BYTES],buildHash:[7,r.TYPES.BYTES],companionProps:[8,r.TYPES.BYTES]},S.internalSpec={dnsMethod:[15,r.TYPES.ENUM,a],appCached:[16,r.TYPES.BOOL]},v.internalSpec={refToken:[1,r.TYPES.STRING],version:[2,r.TYPES.STRING],webdPayload:[3,r.TYPES.MESSAGE,T],webSubPlatform:[4,r.TYPES.ENUM,c]},T.internalSpec={usesParticipantInKey:[1,r.TYPES.BOOL],supportsStarredMessages:[2,r.TYPES.BOOL],supportsDocumentMessages:[3,r.TYPES.BOOL],supportsUrlMessages:[4,r.TYPES.BOOL],supportsMediaRetry:[5,r.TYPES.BOOL],supportsE2EImage:[6,r.TYPES.BOOL],supportsE2EVideo:[7,r.TYPES.BOOL],supportsE2EAudio:[8,r.TYPES.BOOL],supportsE2EDocument:[9,r.TYPES.BOOL],documentTypes:[10,r.TYPES.STRING],features:[11,r.TYPES.BYTES]},b.internalSpec={platform:[1,r.TYPES.ENUM,u],appVersion:[2,r.TYPES.MESSAGE,C],mcc:[3,r.TYPES.STRING],mnc:[4,r.TYPES.STRING],osVersion:[5,r.TYPES.STRING],manufacturer:[6,r.TYPES.STRING],device:[7,r.TYPES.STRING],osBuildNumber:[8,r.TYPES.STRING],phoneId:[9,r.TYPES.STRING],releaseChannel:[10,r.TYPES.ENUM,d],localeLanguageIso6391:[11,r.TYPES.STRING],localeCountryIso31661Alpha2:[12,r.TYPES.STRING],deviceBoard:[13,r.TYPES.STRING]},C.internalSpec={primary:[1,r.TYPES.UINT32],secondary:[2,r.TYPES.UINT32],tertiary:[3,r.TYPES.UINT32],quaternary:[4,r.TYPES.UINT32],quinary:[5,r.TYPES.UINT32]}},78155:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HandshakeMessageSpec=t.HandshakeMessage$ServerHelloSpec=t.HandshakeMessage$ClientHelloSpec=t.HandshakeMessage$ClientFinishSpec=t.ClientPayloadSpec=t.ClientPayloadProduct=t.ClientPayloadIOSAppExtension=t.ClientPayloadConnectType=t.ClientPayloadConnectReason=t.ClientPayload$WebInfoWebSubPlatform=t.ClientPayload$WebInfoSpec=t.ClientPayload$WebInfo$WebdPayloadSpec=t.ClientPayload$UserAgentSpec=t.ClientPayload$UserAgentReleaseChannel=t.ClientPayload$UserAgentPlatform=t.ClientPayload$UserAgent$AppVersionSpec=t.ClientPayload$DNSSourceSpec=t.ClientPayload$DNSSourceDNSResolutionMethod=t.ClientPayload$CompanionRegDataSpec=t.CertChainSpec=t.CertChain$NoiseCertificateSpec=t.CertChain$NoiseCertificate$DetailsSpec=void 0;var r=n(1390);const i=n(76672)({WHATSAPP:0,MESSENGER:1});t.ClientPayloadProduct=i;const a=n(76672)({SYSTEM:0,GOOGLE:1,HARDCODED:2,OVERRIDE:3,FALLBACK:4});t.ClientPayload$DNSSourceDNSResolutionMethod=a;const o=n(76672)({CELLULAR_UNKNOWN:0,WIFI_UNKNOWN:1,CELLULAR_EDGE:100,CELLULAR_IDEN:101,CELLULAR_UMTS:102,CELLULAR_EVDO:103,CELLULAR_GPRS:104,CELLULAR_HSDPA:105,CELLULAR_HSUPA:106,CELLULAR_HSPA:107,CELLULAR_CDMA:108,CELLULAR_1XRTT:109,CELLULAR_EHRPD:110,CELLULAR_LTE:111,CELLULAR_HSPAP:112});t.ClientPayloadConnectType=o;const s=n(76672)({PUSH:0,USER_ACTIVATED:1,SCHEDULED:2,ERROR_RECONNECT:3,NETWORK_SWITCH:4,PING_RECONNECT:5});t.ClientPayloadConnectReason=s;const l=n(76672)({SHARE_EXTENSION:0,SERVICE_EXTENSION:1,INTENTS_EXTENSION:2});t.ClientPayloadIOSAppExtension=l;const c=n(76672)({WEB_BROWSER:0,APP_STORE:1,WIN_STORE:2,DARWIN:3,WIN32:4});t.ClientPayload$WebInfoWebSubPlatform=c;const d=n(76672)({RELEASE:0,BETA:1,ALPHA:2,DEBUG:3});t.ClientPayload$UserAgentReleaseChannel=d;const u=n(76672)({ANDROID:0,IOS:1,WINDOWS_PHONE:2,BLACKBERRY:3,BLACKBERRYX:4,S40:5,S60:6,PYTHON_CLIENT:7,TIZEN:8,ENTERPRISE:9,SMB_ANDROID:10,KAIOS:11,SMB_IOS:12,WINDOWS:13,WEB:14,PORTAL:15,GREEN_ANDROID:16,GREEN_IPHONE:17,BLUE_ANDROID:18,BLUE_IPHONE:19,FBLITE_ANDROID:20,MLITE_ANDROID:21,IGLITE_ANDROID:22,PAGE:23,MACOS:24,OCULUS_MSG:25,OCULUS_CALL:26,MILAN:27,CAPI:28});t.ClientPayload$UserAgentPlatform=u;const p={};t.HandshakeMessageSpec=p;const f={};t.HandshakeMessage$ClientFinishSpec=f;const h={};t.HandshakeMessage$ServerHelloSpec=h;const _={};t.HandshakeMessage$ClientHelloSpec=_;const g={};t.CertChainSpec=g;const m={};t.CertChain$NoiseCertificateSpec=m;const y={};t.CertChain$NoiseCertificate$DetailsSpec=y;const E={};t.ClientPayloadSpec=E;const S={};t.ClientPayload$CompanionRegDataSpec=S;const v={};t.ClientPayload$DNSSourceSpec=v;const T={};t.ClientPayload$WebInfoSpec=T;const b={};t.ClientPayload$WebInfo$WebdPayloadSpec=b;const C={};t.ClientPayload$UserAgentSpec=C;const A={};t.ClientPayload$UserAgent$AppVersionSpec=A,p.internalSpec={clientHello:[2,r.TYPES.MESSAGE,_],serverHello:[3,r.TYPES.MESSAGE,h],clientFinish:[4,r.TYPES.MESSAGE,f]},f.internalSpec={static:[1,r.TYPES.BYTES],payload:[2,r.TYPES.BYTES]},h.internalSpec={ephemeral:[1,r.TYPES.BYTES],static:[2,r.TYPES.BYTES],payload:[3,r.TYPES.BYTES]},_.internalSpec={ephemeral:[1,r.TYPES.BYTES],static:[2,r.TYPES.BYTES],payload:[3,r.TYPES.BYTES]},g.internalSpec={leaf:[1,r.TYPES.MESSAGE,m],intermediate:[2,r.TYPES.MESSAGE,m]},m.internalSpec={details:[1,r.TYPES.BYTES],signature:[2,r.TYPES.BYTES]},y.internalSpec={serial:[1,r.TYPES.UINT32],issuerSerial:[2,r.TYPES.UINT32],key:[3,r.TYPES.BYTES],notBefore:[4,r.TYPES.UINT64],notAfter:[5,r.TYPES.UINT64]},E.internalSpec={username:[1,r.TYPES.UINT64],passive:[3,r.TYPES.BOOL],userAgent:[5,r.TYPES.MESSAGE,C],webInfo:[6,r.TYPES.MESSAGE,T],pushName:[7,r.TYPES.STRING],sessionId:[9,r.TYPES.SFIXED32],shortConnect:[10,r.TYPES.BOOL],connectType:[12,r.TYPES.ENUM,o],connectReason:[13,r.TYPES.ENUM,s],shards:[14,r.FLAGS.REPEATED|r.TYPES.INT32],dnsSource:[15,r.TYPES.MESSAGE,v],connectAttemptCount:[16,r.TYPES.UINT32],device:[18,r.TYPES.UINT32],regData:[19,r.TYPES.MESSAGE,S],product:[20,r.TYPES.ENUM,i],fbCat:[21,r.TYPES.BYTES],fbUserAgent:[22,r.TYPES.BYTES],oc:[23,r.TYPES.BOOL],lc:[24,r.TYPES.INT32],iosAppExtension:[30,r.TYPES.ENUM,l],fbAppId:[31,r.TYPES.UINT64],fbDeviceId:[32,r.TYPES.BYTES],pull:[33,r.TYPES.BOOL]},S.internalSpec={eRegid:[1,r.TYPES.BYTES],eKeytype:[2,r.TYPES.BYTES],eIdent:[3,r.TYPES.BYTES],eSkeyId:[4,r.TYPES.BYTES],eSkeyVal:[5,r.TYPES.BYTES],eSkeySig:[6,r.TYPES.BYTES],buildHash:[7,r.TYPES.BYTES],companionProps:[8,r.TYPES.BYTES]},v.internalSpec={dnsMethod:[15,r.TYPES.ENUM,a],appCached:[16,r.TYPES.BOOL]},T.internalSpec={refToken:[1,r.TYPES.STRING],version:[2,r.TYPES.STRING],webdPayload:[3,r.TYPES.MESSAGE,b],webSubPlatform:[4,r.TYPES.ENUM,c]},b.internalSpec={usesParticipantInKey:[1,r.TYPES.BOOL],supportsStarredMessages:[2,r.TYPES.BOOL],supportsDocumentMessages:[3,r.TYPES.BOOL],supportsUrlMessages:[4,r.TYPES.BOOL],supportsMediaRetry:[5,r.TYPES.BOOL],supportsE2EImage:[6,r.TYPES.BOOL],supportsE2EVideo:[7,r.TYPES.BOOL],supportsE2EAudio:[8,r.TYPES.BOOL],supportsE2EDocument:[9,r.TYPES.BOOL],documentTypes:[10,r.TYPES.STRING],features:[11,r.TYPES.BYTES]},C.internalSpec={platform:[1,r.TYPES.ENUM,u],appVersion:[2,r.TYPES.MESSAGE,A],mcc:[3,r.TYPES.STRING],mnc:[4,r.TYPES.STRING],osVersion:[5,r.TYPES.STRING],manufacturer:[6,r.TYPES.STRING],device:[7,r.TYPES.STRING],osBuildNumber:[8,r.TYPES.STRING],phoneId:[9,r.TYPES.STRING],releaseChannel:[10,r.TYPES.ENUM,d],localeLanguageIso6391:[11,r.TYPES.STRING],localeCountryIso31661Alpha2:[12,r.TYPES.STRING],deviceBoard:[13,r.TYPES.STRING]},A.internalSpec={primary:[1,r.TYPES.UINT32],secondary:[2,r.TYPES.UINT32],tertiary:[3,r.TYPES.UINT32],quaternary:[4,r.TYPES.UINT32],quinary:[5,r.TYPES.UINT32]}},21224:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebNotificationsInfoSpec=t.WebMessageInfoStubType=t.WebMessageInfoStatus=t.WebMessageInfoSpec=t.WebMessageInfoBizPrivacyStatus=t.WebFeaturesSpec=t.WebFeaturesFlag=t.UserReceiptSpec=t.StatusPSASpec=t.ReactionSpec=t.PollUpdateSpec=t.PollAdditionalMetadataSpec=t.PhotoChangeSpec=t.PaymentInfoTxnStatus=t.PaymentInfoStatus=t.PaymentInfoSpec=t.PaymentInfoCurrency=t.NotificationMessageInfoSpec=t.MediaDataSpec=void 0;var r=n(1390),i=n(24808),a=n(93890);const o=n(76672)({E2EE:0,FB:2,BSP:1,BSP_AND_FB:3});t.WebMessageInfoBizPrivacyStatus=o;const s=n(76672)({UNKNOWN:0,REVOKE:1,CIPHERTEXT:2,FUTUREPROOF:3,NON_VERIFIED_TRANSITION:4,UNVERIFIED_TRANSITION:5,VERIFIED_TRANSITION:6,VERIFIED_LOW_UNKNOWN:7,VERIFIED_HIGH:8,VERIFIED_INITIAL_UNKNOWN:9,VERIFIED_INITIAL_LOW:10,VERIFIED_INITIAL_HIGH:11,VERIFIED_TRANSITION_ANY_TO_NONE:12,VERIFIED_TRANSITION_ANY_TO_HIGH:13,VERIFIED_TRANSITION_HIGH_TO_LOW:14,VERIFIED_TRANSITION_HIGH_TO_UNKNOWN:15,VERIFIED_TRANSITION_UNKNOWN_TO_LOW:16,VERIFIED_TRANSITION_LOW_TO_UNKNOWN:17,VERIFIED_TRANSITION_NONE_TO_LOW:18,VERIFIED_TRANSITION_NONE_TO_UNKNOWN:19,GROUP_CREATE:20,GROUP_CHANGE_SUBJECT:21,GROUP_CHANGE_ICON:22,GROUP_CHANGE_INVITE_LINK:23,GROUP_CHANGE_DESCRIPTION:24,GROUP_CHANGE_RESTRICT:25,GROUP_CHANGE_ANNOUNCE:26,GROUP_PARTICIPANT_ADD:27,GROUP_PARTICIPANT_REMOVE:28,GROUP_PARTICIPANT_PROMOTE:29,GROUP_PARTICIPANT_DEMOTE:30,GROUP_PARTICIPANT_INVITE:31,GROUP_PARTICIPANT_LEAVE:32,GROUP_PARTICIPANT_CHANGE_NUMBER:33,BROADCAST_CREATE:34,BROADCAST_ADD:35,BROADCAST_REMOVE:36,GENERIC_NOTIFICATION:37,E2E_IDENTITY_CHANGED:38,E2E_ENCRYPTED:39,CALL_MISSED_VOICE:40,CALL_MISSED_VIDEO:41,INDIVIDUAL_CHANGE_NUMBER:42,GROUP_DELETE:43,GROUP_ANNOUNCE_MODE_MESSAGE_BOUNCE:44,CALL_MISSED_GROUP_VOICE:45,CALL_MISSED_GROUP_VIDEO:46,PAYMENT_CIPHERTEXT:47,PAYMENT_FUTUREPROOF:48,PAYMENT_TRANSACTION_STATUS_UPDATE_FAILED:49,PAYMENT_TRANSACTION_STATUS_UPDATE_REFUNDED:50,PAYMENT_TRANSACTION_STATUS_UPDATE_REFUND_FAILED:51,PAYMENT_TRANSACTION_STATUS_RECEIVER_PENDING_SETUP:52,PAYMENT_TRANSACTION_STATUS_RECEIVER_SUCCESS_AFTER_HICCUP:53,PAYMENT_ACTION_ACCOUNT_SETUP_REMINDER:54,PAYMENT_ACTION_SEND_PAYMENT_REMINDER:55,PAYMENT_ACTION_SEND_PAYMENT_INVITATION:56,PAYMENT_ACTION_REQUEST_DECLINED:57,PAYMENT_ACTION_REQUEST_EXPIRED:58,PAYMENT_ACTION_REQUEST_CANCELLED:59,BIZ_VERIFIED_TRANSITION_TOP_TO_BOTTOM:60,BIZ_VERIFIED_TRANSITION_BOTTOM_TO_TOP:61,BIZ_INTRO_TOP:62,BIZ_INTRO_BOTTOM:63,BIZ_NAME_CHANGE:64,BIZ_MOVE_TO_CONSUMER_APP:65,BIZ_TWO_TIER_MIGRATION_TOP:66,BIZ_TWO_TIER_MIGRATION_BOTTOM:67,OVERSIZED:68,GROUP_CHANGE_NO_FREQUENTLY_FORWARDED:69,GROUP_V4_ADD_INVITE_SENT:70,GROUP_PARTICIPANT_ADD_REQUEST_JOIN:71,CHANGE_EPHEMERAL_SETTING:72,E2E_DEVICE_CHANGED:73,VIEWED_ONCE:74,E2E_ENCRYPTED_NOW:75,BLUE_MSG_BSP_FB_TO_BSP_PREMISE:76,BLUE_MSG_BSP_FB_TO_SELF_FB:77,BLUE_MSG_BSP_FB_TO_SELF_PREMISE:78,BLUE_MSG_BSP_FB_UNVERIFIED:79,BLUE_MSG_BSP_FB_UNVERIFIED_TO_SELF_PREMISE_VERIFIED:80,BLUE_MSG_BSP_FB_VERIFIED:81,BLUE_MSG_BSP_FB_VERIFIED_TO_SELF_PREMISE_UNVERIFIED:82,BLUE_MSG_BSP_PREMISE_TO_SELF_PREMISE:83,BLUE_MSG_BSP_PREMISE_UNVERIFIED:84,BLUE_MSG_BSP_PREMISE_UNVERIFIED_TO_SELF_PREMISE_VERIFIED:85,BLUE_MSG_BSP_PREMISE_VERIFIED:86,BLUE_MSG_BSP_PREMISE_VERIFIED_TO_SELF_PREMISE_UNVERIFIED:87,BLUE_MSG_CONSUMER_TO_BSP_FB_UNVERIFIED:88,BLUE_MSG_CONSUMER_TO_BSP_PREMISE_UNVERIFIED:89,BLUE_MSG_CONSUMER_TO_SELF_FB_UNVERIFIED:90,BLUE_MSG_CONSUMER_TO_SELF_PREMISE_UNVERIFIED:91,BLUE_MSG_SELF_FB_TO_BSP_PREMISE:92,BLUE_MSG_SELF_FB_TO_SELF_PREMISE:93,BLUE_MSG_SELF_FB_UNVERIFIED:94,BLUE_MSG_SELF_FB_UNVERIFIED_TO_SELF_PREMISE_VERIFIED:95,BLUE_MSG_SELF_FB_VERIFIED:96,BLUE_MSG_SELF_FB_VERIFIED_TO_SELF_PREMISE_UNVERIFIED:97,BLUE_MSG_SELF_PREMISE_TO_BSP_PREMISE:98,BLUE_MSG_SELF_PREMISE_UNVERIFIED:99,BLUE_MSG_SELF_PREMISE_VERIFIED:100,BLUE_MSG_TO_BSP_FB:101,BLUE_MSG_TO_CONSUMER:102,BLUE_MSG_TO_SELF_FB:103,BLUE_MSG_UNVERIFIED_TO_BSP_FB_VERIFIED:104,BLUE_MSG_UNVERIFIED_TO_BSP_PREMISE_VERIFIED:105,BLUE_MSG_UNVERIFIED_TO_SELF_FB_VERIFIED:106,BLUE_MSG_UNVERIFIED_TO_VERIFIED:107,BLUE_MSG_VERIFIED_TO_BSP_FB_UNVERIFIED:108,BLUE_MSG_VERIFIED_TO_BSP_PREMISE_UNVERIFIED:109,BLUE_MSG_VERIFIED_TO_SELF_FB_UNVERIFIED:110,BLUE_MSG_VERIFIED_TO_UNVERIFIED:111,BLUE_MSG_BSP_FB_UNVERIFIED_TO_BSP_PREMISE_VERIFIED:112,BLUE_MSG_BSP_FB_UNVERIFIED_TO_SELF_FB_VERIFIED:113,BLUE_MSG_BSP_FB_VERIFIED_TO_BSP_PREMISE_UNVERIFIED:114,BLUE_MSG_BSP_FB_VERIFIED_TO_SELF_FB_UNVERIFIED:115,BLUE_MSG_SELF_FB_UNVERIFIED_TO_BSP_PREMISE_VERIFIED:116,BLUE_MSG_SELF_FB_VERIFIED_TO_BSP_PREMISE_UNVERIFIED:117,E2E_IDENTITY_UNAVAILABLE:118,GROUP_CREATING:119,GROUP_CREATE_FAILED:120,GROUP_BOUNCED:121,BLOCK_CONTACT:122,EPHEMERAL_SETTING_NOT_APPLIED:123,SYNC_FAILED:124,SYNCING:125,BIZ_PRIVACY_MODE_INIT_FB:126,BIZ_PRIVACY_MODE_INIT_BSP:127,BIZ_PRIVACY_MODE_TO_FB:128,BIZ_PRIVACY_MODE_TO_BSP:129,DISAPPEARING_MODE:130,E2E_DEVICE_FETCH_FAILED:131,ADMIN_REVOKE:132,GROUP_INVITE_LINK_GROWTH_LOCKED:133,COMMUNITY_LINK_PARENT_GROUP:134,COMMUNITY_LINK_SIBLING_GROUP:135,COMMUNITY_LINK_SUB_GROUP:136});t.WebMessageInfoStubType=s;const l=n(76672)({ERROR:0,PENDING:1,SERVER_ACK:2,DELIVERY_ACK:3,READ:4,PLAYED:5});t.WebMessageInfoStatus=l;const c=n(76672)({UNKNOWN:0,PENDING_SETUP:1,PENDING_RECEIVER_SETUP:2,INIT:3,SUCCESS:4,COMPLETED:5,FAILED:6,FAILED_RISK:7,FAILED_PROCESSING:8,FAILED_RECEIVER_PROCESSING:9,FAILED_DA:10,FAILED_DA_FINAL:11,REFUNDED_TXN:12,REFUND_FAILED:13,REFUND_FAILED_PROCESSING:14,REFUND_FAILED_DA:15,EXPIRED_TXN:16,AUTH_CANCELED:17,AUTH_CANCEL_FAILED_PROCESSING:18,AUTH_CANCEL_FAILED:19,COLLECT_INIT:20,COLLECT_SUCCESS:21,COLLECT_FAILED:22,COLLECT_FAILED_RISK:23,COLLECT_REJECTED:24,COLLECT_EXPIRED:25,COLLECT_CANCELED:26,COLLECT_CANCELLING:27,IN_REVIEW:28});t.PaymentInfoTxnStatus=c;const d=n(76672)({UNKNOWN_STATUS:0,PROCESSING:1,SENT:2,NEED_TO_ACCEPT:3,COMPLETE:4,COULD_NOT_COMPLETE:5,REFUNDED:6,EXPIRED:7,REJECTED:8,CANCELLED:9,WAITING_FOR_PAYER:10,WAITING:11});t.PaymentInfoStatus=d;const u=n(76672)({UNKNOWN_CURRENCY:0,INR:1});t.PaymentInfoCurrency=u;const p=n(76672)({NOT_STARTED:0,FORCE_UPGRADE:1,DEVELOPMENT:2,PRODUCTION:3});t.WebFeaturesFlag=p;const f={};t.WebMessageInfoSpec=f;const h={};t.PaymentInfoSpec=h;const _={};t.WebNotificationsInfoSpec=_;const g={};t.NotificationMessageInfoSpec=g;const m={};t.WebFeaturesSpec=m;const y={};t.MediaDataSpec=y;const E={};t.PhotoChangeSpec=E;const S={};t.StatusPSASpec=S;const v={};t.UserReceiptSpec=v;const T={};t.ReactionSpec=T;const b={};t.PollUpdateSpec=b;const C={};t.PollAdditionalMetadataSpec=C,f.internalDefaults={status:l.PENDING},f.internalSpec={key:[1,r.FLAGS.REQUIRED|r.TYPES.MESSAGE,a.MessageKeySpec],message:[2,r.TYPES.MESSAGE,i.MessageSpec],messageTimestamp:[3,r.TYPES.UINT64],status:[4,r.TYPES.ENUM,l],participant:[5,r.TYPES.STRING],messageC2STimestamp:[6,r.TYPES.UINT64],ignore:[16,r.TYPES.BOOL],starred:[17,r.TYPES.BOOL],broadcast:[18,r.TYPES.BOOL],pushName:[19,r.TYPES.STRING],mediaCiphertextSha256:[20,r.TYPES.BYTES],multicast:[21,r.TYPES.BOOL],urlText:[22,r.TYPES.BOOL],urlNumber:[23,r.TYPES.BOOL],messageStubType:[24,r.TYPES.ENUM,s],clearMedia:[25,r.TYPES.BOOL],messageStubParameters:[26,r.FLAGS.REPEATED|r.TYPES.STRING],duration:[27,r.TYPES.UINT32],labels:[28,r.FLAGS.REPEATED|r.TYPES.STRING],paymentInfo:[29,r.TYPES.MESSAGE,h],finalLiveLocation:[30,r.TYPES.MESSAGE,i.Message$LiveLocationMessageSpec],quotedPaymentInfo:[31,r.TYPES.MESSAGE,h],ephemeralStartTimestamp:[32,r.TYPES.UINT64],ephemeralDuration:[33,r.TYPES.UINT32],ephemeralOffToOn:[34,r.TYPES.BOOL],ephemeralOutOfSync:[35,r.TYPES.BOOL],bizPrivacyStatus:[36,r.TYPES.ENUM,o],verifiedBizName:[37,r.TYPES.STRING],mediaData:[38,r.TYPES.MESSAGE,y],photoChange:[39,r.TYPES.MESSAGE,E],userReceipt:[40,r.FLAGS.REPEATED|r.TYPES.MESSAGE,v],reactions:[41,r.FLAGS.REPEATED|r.TYPES.MESSAGE,T],quotedStickerData:[42,r.TYPES.MESSAGE,y],futureproofData:[43,r.TYPES.BYTES],statusPsa:[44,r.TYPES.MESSAGE,S],pollUpdates:[45,r.FLAGS.REPEATED|r.TYPES.MESSAGE,b],pollAdditionalMetadata:[46,r.TYPES.MESSAGE,C]},h.internalSpec={currencyDeprecated:[1,r.TYPES.ENUM,u],amount1000:[2,r.TYPES.UINT64],receiverJid:[3,r.TYPES.STRING],status:[4,r.TYPES.ENUM,d],transactionTimestamp:[5,r.TYPES.UINT64],requestMessageKey:[6,r.TYPES.MESSAGE,a.MessageKeySpec],expiryTimestamp:[7,r.TYPES.UINT64],futureproofed:[8,r.TYPES.BOOL],currency:[9,r.TYPES.STRING],txnStatus:[10,r.TYPES.ENUM,c],useNoviFiatFormat:[11,r.TYPES.BOOL],primaryAmount:[12,r.TYPES.MESSAGE,i.MoneySpec],exchangeAmount:[13,r.TYPES.MESSAGE,i.MoneySpec]},_.internalSpec={timestamp:[2,r.TYPES.UINT64],unreadChats:[3,r.TYPES.UINT32],notifyMessageCount:[4,r.TYPES.UINT32],notifyMessages:[5,r.FLAGS.REPEATED|r.TYPES.MESSAGE,f]},g.internalSpec={key:[1,r.TYPES.MESSAGE,a.MessageKeySpec],message:[2,r.TYPES.MESSAGE,i.MessageSpec],messageTimestamp:[3,r.TYPES.UINT64],participant:[4,r.TYPES.STRING]},m.internalSpec={labelsDisplay:[1,r.TYPES.ENUM,p],voipIndividualOutgoing:[2,r.TYPES.ENUM,p],groupsV3:[3,r.TYPES.ENUM,p],groupsV3Create:[4,r.TYPES.ENUM,p],changeNumberV2:[5,r.TYPES.ENUM,p],queryStatusV3Thumbnail:[6,r.TYPES.ENUM,p],liveLocations:[7,r.TYPES.ENUM,p],queryVname:[8,r.TYPES.ENUM,p],voipIndividualIncoming:[9,r.TYPES.ENUM,p],quickRepliesQuery:[10,r.TYPES.ENUM,p],payments:[11,r.TYPES.ENUM,p],stickerPackQuery:[12,r.TYPES.ENUM,p],liveLocationsFinal:[13,r.TYPES.ENUM,p],labelsEdit:[14,r.TYPES.ENUM,p],mediaUpload:[15,r.TYPES.ENUM,p],mediaUploadRichQuickReplies:[18,r.TYPES.ENUM,p],vnameV2:[19,r.TYPES.ENUM,p],videoPlaybackUrl:[20,r.TYPES.ENUM,p],statusRanking:[21,r.TYPES.ENUM,p],voipIndividualVideo:[22,r.TYPES.ENUM,p],thirdPartyStickers:[23,r.TYPES.ENUM,p],frequentlyForwardedSetting:[24,r.TYPES.ENUM,p],groupsV4JoinPermission:[25,r.TYPES.ENUM,p],recentStickers:[26,r.TYPES.ENUM,p],catalog:[27,r.TYPES.ENUM,p],starredStickers:[28,r.TYPES.ENUM,p],voipGroupCall:[29,r.TYPES.ENUM,p],templateMessage:[30,r.TYPES.ENUM,p],templateMessageInteractivity:[31,r.TYPES.ENUM,p],ephemeralMessages:[32,r.TYPES.ENUM,p],e2ENotificationSync:[33,r.TYPES.ENUM,p],recentStickersV2:[34,r.TYPES.ENUM,p],recentStickersV3:[36,r.TYPES.ENUM,p],userNotice:[37,r.TYPES.ENUM,p],support:[39,r.TYPES.ENUM,p],groupUiiCleanup:[40,r.TYPES.ENUM,p],groupDogfoodingInternalOnly:[41,r.TYPES.ENUM,p],settingsSync:[42,r.TYPES.ENUM,p],archiveV2:[43,r.TYPES.ENUM,p],ephemeralAllowGroupMembers:[44,r.TYPES.ENUM,p],ephemeral24HDuration:[45,r.TYPES.ENUM,p],mdForceUpgrade:[46,r.TYPES.ENUM,p],disappearingMode:[47,r.TYPES.ENUM,p],externalMdOptInAvailable:[48,r.TYPES.ENUM,p],noDeleteMessageTimeLimit:[49,r.TYPES.ENUM,p]},y.internalSpec={localPath:[1,r.TYPES.STRING]},E.internalSpec={oldPhoto:[1,r.TYPES.BYTES],newPhoto:[2,r.TYPES.BYTES],newPhotoId:[3,r.TYPES.UINT32]},S.internalSpec={campaignId:[44,r.FLAGS.REQUIRED|r.TYPES.STRING],campaignExpirationTimestamp:[45,r.TYPES.UINT64]},v.internalSpec={userJid:[1,r.FLAGS.REQUIRED|r.TYPES.STRING],receiptTimestamp:[2,r.TYPES.INT64],readTimestamp:[3,r.TYPES.INT64],playedTimestamp:[4,r.TYPES.INT64],pendingDeviceJid:[5,r.FLAGS.REPEATED|r.TYPES.STRING],deliveredDeviceJid:[6,r.FLAGS.REPEATED|r.TYPES.STRING]},T.internalSpec={key:[1,r.TYPES.MESSAGE,a.MessageKeySpec],text:[2,r.TYPES.STRING],groupingKey:[3,r.TYPES.STRING],senderTimestampMs:[4,r.TYPES.INT64],unread:[5,r.TYPES.BOOL]},b.internalSpec={pollUpdateMessageKey:[1,r.TYPES.MESSAGE,a.MessageKeySpec],pollUpdateMessage:[2,r.TYPES.MESSAGE,i.PollUpdateMessageContentSpec]},C.internalSpec={pollInvalidated:[1,r.TYPES.BOOL]}},19991:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getAbPropKey=function(){return(0,i.getABKey)()||"abkey"},t.getEventSampling=function(){return(0,r.getABPropConfigValue)("qpl_sampling_as_string")},t.getInitialUploadDelayInSeconds=function(){return 60*(0,r.getABPropConfigValue)("qpl_initial_upload_delay")},t.getUploadIntervalInSeconds=function(){return 60*(0,r.getABPropConfigValue)("qpl_upload_delay")},t.isBusinessTeamQPLEnabled=function(){return(0,r.getABPropConfigValue)("btm_qpl_enabled")},t.isQplEnabled=function(){return(0,r.getABPropConfigValue)("qpl_enabled")};var r=n(57849),i=n(72126)},90166:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.qplPointCartView=function(e){r.QPL.markerPoint(i.QuickLogMarkerId.WHATSAPP_CART_VIEW,e)},t.qplPointOrderCreate=function(e){r.QPL.markerPoint(i.QuickLogMarkerId.WHATSAPP_ORDER_CREATE,e)},t.qplPointOrderView=function(e){r.QPL.markerPoint(i.QuickLogMarkerId.WHATSAPP_ORDER_VIEW,e)},t.qplPointPLMDetailsView=function(e){r.QPL.markerPoint(i.QuickLogMarkerId.WHATSAPP_PLM_DETAILS_VIEW,e)},t.qplPointProductView=function(e){r.QPL.markerPoint(i.QuickLogMarkerId.WHATSAPP_PRODUCT_VIEW,e)},t.qplPointProfileCatsView=function(e){r.QPL.markerPoint(i.QuickLogMarkerId.WHATSAPP_PROFILE_CATS_VIEW,e)},t.qplPointProfileSave=function(e){r.QPL.markerPoint(i.QuickLogMarkerId.WHATSAPP_PROFILE_SAVE,e)};var r=n(48870),i=n(27798)},74152:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.config=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];l&&!0!==t?__LOG__(3,void 0,void 0,void 0,["qpl"])`QPL Config has already been initialized`:(s=new Map,c=e,h(),l={isQplEnabled:d,uploadInterval:u,getEventDetails:f,uploadDelay:p,getAbPropKey:c.getAbPropKey});return l};var r=n(30433),i=n(27798);const a={sampleRate:0,samplingMethod:1},o=[i.QuickLogMarkerId.WHATSAPP_CART_ADD,i.QuickLogMarkerId.WHATSAPP_CART_VIEW,i.QuickLogMarkerId.WHATSAPP_CATALOG_COLLECTIONS_VIEW,i.QuickLogMarkerId.WHATSAPP_CATALOG_CREATE,i.QuickLogMarkerId.WHATSAPP_CATALOG_LOAD_MORE,i.QuickLogMarkerId.WHATSAPP_CATALOG_VIEW,i.QuickLogMarkerId.WHATSAPP_COLLECTIONS_MANAGEMENT_VIEW,i.QuickLogMarkerId.WHATSAPP_COLLECTION_APPEAL,i.QuickLogMarkerId.WHATSAPP_COLLECTION_EDIT,i.QuickLogMarkerId.WHATSAPP_COLLECTION_RENAME,i.QuickLogMarkerId.WHATSAPP_COLLECTION_VIEW_ALL,i.QuickLogMarkerId.WHATSAPP_ORDER_CREATE,i.QuickLogMarkerId.WHATSAPP_ORDER_VIEW,i.QuickLogMarkerId.WHATSAPP_PLM_DETAILS_VIEW,i.QuickLogMarkerId.WHATSAPP_PRODUCT_APPEAL,i.QuickLogMarkerId.WHATSAPP_PRODUCT_DELETE,i.QuickLogMarkerId.WHATSAPP_PRODUCT_IMAGES_LOAD,i.QuickLogMarkerId.WHATSAPP_PRODUCT_MESSAGE_SEND,i.QuickLogMarkerId.WHATSAPP_PRODUCT_REPORT,i.QuickLogMarkerId.WHATSAPP_PRODUCT_SAVE,i.QuickLogMarkerId.WHATSAPP_PRODUCT_SET_VISIBLE,i.QuickLogMarkerId.WHATSAPP_PRODUCT_VIEW,i.QuickLogMarkerId.WHATSAPP_PROFILE_CATS_VIEW,i.QuickLogMarkerId.WHATSAPP_PROFILE_SAVE,i.QuickLogMarkerId.WHATSAPP_PROFILE_VIEW];let s,l,c;function d(){return c.isQplEnabled()}function u(){return c.getUploadIntervalInSeconds()}function p(){return c.getInitialUploadDelayInSeconds()}function f(e){const t=s.get(e);return t?!c.isBusinessTeamQPLEnabled()&&o.includes(e)?a:t:a}function h(){try{let e=c.getEventSampling();0===e.indexOf("json:")&&(e=e.slice(5));const t=JSON.parse(e);t.sampling.forEach((e=>{const t=e[0],n=e[1],r=Math.max(e[2],0);s.set(t,{sampleRate:r,samplingMethod:n})}))}catch(e){(0,r.errorParsingConfig)(e)}}},16215:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){return JSON.stringify(e)+"\n"+t.map((function(e){return JSON.stringify((0,i.default)((0,i.default)({},{wa_ab_key2:n}),e))})).join("\n")};var i=r(n(81109))},30433:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.annotationKeyTooLong=function(e,t,n){if(a++>5)return;new i.default.WebcQplHealth({webcQplHealthEventType:i.default.WEBC_QPL_HEALTH_EVENT_TYPE.ANNOTATION_KEY_TOO_LONG,webcQplHealthEventData:`markerId: ${e}, instanceKey: ${t}, annotationKey: ${n}`}).commit()},t.annotationSizeLimitExceeded=function(e,t,n){if(a++>5)return;new i.default.WebcQplHealth({webcQplHealthEventType:i.default.WEBC_QPL_HEALTH_EVENT_TYPE.ANNOTATION_SIZE_LIMIT_EXCEEDED,webcQplHealthEventData:`markerId: ${e}, instanceKey: ${t}, annotationKey: ${n}`}).commit()},t.errorParsingConfig=function(e){if(a++>5)return;new i.default.WebcQplHealth({webcQplHealthEventType:i.default.WEBC_QPL_HEALTH_EVENT_TYPE.ERROR_PARSING_CONFIG,webcQplHealthEventData:`errorString: ${e}`}).commit()},t.errorUploadingChunk=function(e){if(a++>5)return;new i.default.WebcQplHealth({webcQplHealthEventType:i.default.WEBC_QPL_HEALTH_EVENT_TYPE.ERROR_UPLOADING_CHUNK,webcQplHealthEventData:`errorString: ${e}`}).commit()},t.maxPointCountExceeded=function(e,t){if(a++>5)return;new i.default.WebcQplHealth({webcQplHealthEventType:i.default.WEBC_QPL_HEALTH_EVENT_TYPE.MAX_POINT_COUNT_EXCEEDED,webcQplHealthEventData:`markerId: ${e}, instanceKey: ${t}`}).commit()},t.maxStorageEventCountReached=function(){if(a++>5)return;new i.default.WebcQplHealth({webcQplHealthEventType:i.default.WEBC_QPL_HEALTH_EVENT_TYPE.MAX_STORAGE_EVENT_COUNT_REACHED}).commit()},t.pointDataTooLong=function(e,t,n){if(a++>5)return;new i.default.WebcQplHealth({webcQplHealthEventType:i.default.WEBC_QPL_HEALTH_EVENT_TYPE.POINT_DATA_TOO_LONG,webcQplHealthEventData:`markerId: ${e}, instanceKey: ${t}, data: ${n}`}).commit()},t.pointNameTooLong=function(e,t,n){if(a++>5)return;new i.default.WebcQplHealth({webcQplHealthEventType:i.default.WEBC_QPL_HEALTH_EVENT_TYPE.POINT_NAME_TOO_LONG,webcQplHealthEventData:`markerId: ${e}, instanceKey: ${t}, pointName: ${n}`}).commit()};var i=r(n(11339));let a=0},37726:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.startQPL=function(){const e=(0,a.config)(r);e.isQplEnabled()&&((0,c.start)({isQplEnabled:e.isQplEnabled,sendEvents:t=>(0,o.sendEventsOverNetwork)(t,e.getAbPropKey()),uploadInterval:e.uploadInterval(),startUploadDelay:e.uploadDelay()}),s.QPL.init((e=>{l.QuickLogMarkerId.cast(e.marker_id);return(0,i.add)([e]),Promise.resolve()}),{debug:()=>{},warn:()=>{}},e.getEventDetails,e.isQplEnabled))};var r=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=d(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(19991)),i=n(63719),a=n(74152),o=n(11675),s=n(48870),l=n(27798),c=n(33994);function d(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(d=function(e){return e?n:t})(e)}},92006:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.markerEnded=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=`${e}|${t}`;i.delete(n),a.delete(n)},t.validateAnnotations=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;const a=`${e}|${t}`,o=i.get(a)||0;let s=0;function l(n,i){return s+=i,!(s+o>1e3)||((0,r.annotationSizeLimitExceeded)(e,t,n),!1)}function c(n){for(let i=0;i<n.length;i++)return!(n[i].length>50)||((0,r.annotationKeyTooLong)(e,t,n[i]),!1)}if(null==n?void 0:n.bool){const e=Object.keys(n.bool);if(!l("bool",e.length)||!c(e))return!1}if(null==n?void 0:n.int){const e=Object.keys(n.int);if(!l("int",e.length)||!c(e))return!1}if(null==n?void 0:n.double){const e=Object.keys(n.double);if(!l("double",e.length)||!c(e))return!1}if(null==n?void 0:n.bool_array){const e=Object.keys(n.bool_array);for(let t=0;t<e.length;t++)if(!l(e[t],n.bool_array[e[t]].length))return!1;if(!c(e))return!1}if(null==n?void 0:n.int_array){const e=Object.keys(n.int_array);for(let t=0;t<e.length;t++)if(!l(e[t],n.int_array[e[t]].length))return!1;if(!c(e))return!1}if(null==n?void 0:n.double_array){const e=Object.keys(n.double_array);for(let t=0;t<e.length;t++)if(!l(e[t],n.double_array[e[t]].length))return!1;if(!c(e))return!1}if(null==n?void 0:n.string){const e=Object.keys(n.string);for(let t=0;t<e.length;t++)if(!l(e[t],n.string[e[t]].length))return!1;if(!c(e))return!1}if(null==n?void 0:n.string_array){const e=Object.keys(n.string_array);for(let t=0;t<e.length;t++){const r=n.string_array[e[t]];for(let n=0;n<r.length;n++)if(!l(e[t],r[n].length))return!1}if(!c(e))return!1}return i.set(a,o+s),!0},t.validatePoints=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;if(n.length>50)return(0,r.pointNameTooLong)(e,t,n),!1;const i=`${e}|${t}`,o=a.get(i)||0;if(o+1>1e3)return(0,r.maxPointCountExceeded)(e,t),!1;return a.set(i,o+1),!0};var r=n(30433);n(27798);const i=new Map,a=new Map},11675:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendEventsOverNetwork=function(){return h.apply(this,arguments)};var i=r(n(48926)),a=n(92844),o=n(92574),s=n(65885),l=r(n(11854)),c=r(n(16215));const d="https://graph.whatsapp.net/wa_qpl_data",u="1063127757113399|745146ffa34413f9dbb5469f5370b7af",p="167028690535322";let f;function h(){return(h=(0,i.default)((function*(e,t){const n=new FormData;n.append("access_token",u),n.append("app_id",p),void 0===f&&(f=Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString()),n.append("user_id",f),n.append("upload_time",(0,a.unixTime)().toString()),n.append("batch_info",JSON.stringify({}));const r={app_version:"2.2210.9",app_build_number:parseInt("359061622",10)||0};n.append("batches[]",(0,s.createFile)([(0,c.default)(r,e,t)],"qpldata.txt"),"qpldata.txt");const i=yield l.default.post(d,n);if(__LOG__(2,void 0,void 0,void 0,["qpl"])`qpl_networkSendEventsOverNetwork, completed XHR`,200!==i.status)throw new o.ServerStatusCodeError(i.status,`Failed call to QPL endpoint: ${d}, response: ${i.responseText}`)}))).apply(this,arguments)}},48870:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.QuickLogActionType=t.QplInstanceKeyOptions=t.QPLMarkerType=t.QPL=void 0;var i=n(92006),a=r(n(60407)),o=n(27798);let s;const l=n(76672)({SUCCESS:2,FAIL:3,CANCEL:4});t.QuickLogActionType=l;const c=n(76672)({REGULAR:1,USER_FLOW:2});t.QPLMarkerType=c;const d=n(76672).Mirrored(["AUTO_INCREMENT","MANUAL_INCREMENT","REUSE_INSTANCE"]);t.QplInstanceKeyOptions=d;class u{static clearInstance(){s=null,u.markerInstanceHelper.clear()}static getNextMarkerInstanceValue(e){u.markerInstanceHelper.get(e)||u.markerInstanceHelper.set(e,this._instanceKeyGenerator());const t=u.markerInstanceHelper.get(e),n=void 0!==t?t.next().value:0;return void 0!==n?n:0}static*_instanceKeyGenerator(){let e=0;for(;;)yield e++}static init(e,t,n,r){s&&__LOG__(4,void 0,new Error)`QPL already initialized`,s=new a.default({performanceNow:Date.now,moduleLoadTimestamp:Date.now(),logger:t,sendEvent:e,quickLogConfigHelper:{getEventDetails:n,isKillswitchOn:()=>!r()}})}static getInstance(){return s||(__LOG__(3)`Attempt to use QPL logger prior to initialization`,s=new a.default({performanceNow:Date.now,moduleLoadTimestamp:Date.now(),logger:{debug:()=>{},warn:()=>{}},sendEvent:()=>{},quickLogConfigHelper:{getEventDetails:()=>({sampleRate:1,samplingMethod:1}),isKillswitchOn:()=>!0}})),s}static logActiveQplMarkers(){const e=u.getInstance().getActiveMarkerIDs({type:c.REGULAR});e.length&&e.forEach((e=>{const t=o.QuickLogMarkerId.getName(e);__LOG__(3)`QPL [${t}] There are ${this._numberOfMarkersOpen(e)} active markers remaining. You need to call markerEnd`}))}static markerStart(e,t){if(this._markerExists(e)){const t=this._numberOfMarkersOpen(e);__LOG__(4,void 0,new Error)`QPL [${o.QuickLogMarkerId.getName(e)}] is already opened ${t} time(s), attempting ${t+1}`}u.getInstance().markerStart(e,null==t?void 0:t.instanceKey),(null==t?void 0:t.annotations)&&(0,i.validateAnnotations)(e,t.instanceKey,t.annotations)&&u.getInstance().markerAnnotate(e,t.annotations,{instanceKey:t.instanceKey})}static markerStartClosePrevious(e,t){let n;n=(null==t?void 0:t.instanceKeyOption)===d.AUTO_INCREMENT?u.getNextMarkerInstanceValue(e):void 0!==(null==t?void 0:t.instanceKey)?t.instanceKey:0;const r=[d.AUTO_INCREMENT,d.MANUAL_INCREMENT].includes(null==t?void 0:t.instanceKeyOption)?n-1:n;if(this._markerExists(e)){const n=(null==t?void 0:t.actionTypeForClosePrevious)||l.CANCEL;u.markerEnd(e,n,{instanceKey:r})}return u.markerStart(e,{instanceKey:n,annotations:null==t?void 0:t.annotations}),{instanceKey:n}}static markerAnnotate(e,t,n){u.tryLogErrorMessage(e,n?n.instanceKey:0,"markerAnnotate"),(0,i.validateAnnotations)(e,null==n?void 0:n.instanceKey,t)&&u.getInstance().markerAnnotate(e,t,{instanceKey:null==n?void 0:n.instanceKey})}static markerPoint(e,t,n){u.tryLogErrorMessage(e,n?n.instanceKey:0,"markerPoint"),(null==n?void 0:n.data)&&(0,i.validateAnnotations)(e,n.instanceKey,n.data),(0,i.validatePoints)(e,(null==n?void 0:n.instanceKey)||0,t)&&u.getInstance().markerPoint(e,t,n)}static markerEnd(e,t,n){o.QuickLogMarkerId.getName(e),l.getName(t),u.tryLogErrorMessage(e,null==n?void 0:n.instanceKey,"markerEnd"),u.getInstance().markerEnd(e,t,null==n?void 0:n.instanceKey),(0,i.markerEnded)(e,null==n?void 0:n.instanceKey)}static markerDrop(e,t){u.tryLogErrorMessage(e,null==t?void 0:t.instanceKey,"markerDrop"),u.getInstance().markerDrop(e,null==t?void 0:t.instanceKey),(0,i.markerEnded)(e,null==t?void 0:t.instanceKey)}static getActiveMarkerIDs(e){return u.getInstance().getActiveMarkerIDs(e)}static getMarker(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return u.getInstance().getMarker(e,t)}static getMarkerInstances(e){return u.getInstance().getMarkerInstances(e)}static _markerExists(e){const t=u.getMarkerInstances(e);return!!t&&0!==t.size}static _numberOfMarkersOpen(e){const t=u.getMarkerInstances(e);return t?t.size:0}static tryLogErrorMessage(e){let t=arguments.length>2?arguments[2]:void 0;this._markerExists(e)||__LOG__(3)`QPL [${o.QuickLogMarkerId.getName(e)}] calling ${t} without an open marker`}}t.QPL=u,u.markerInstanceHelper=new Map},27798:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.QuickLogMarkerId=void 0;const r=n(76672)({WHATSAPP_COLLECTIONS_MANAGEMENT_VIEW:774768970,WHATSAPP_PRODUCT_APPEAL:774769273,WHATSAPP_CATALOG_CREATE:774769395,WHATSAPP_CATALOG_LOAD_MORE:774769641,WHATSAPP_ORDER_VIEW:774769843,WHATSAPP_PROFILE_VIEW:774770248,WHATSAPP_CATALOG_VIEW:774771408,WHATSAPP_PRODUCT_DELETE:774774122,WHATSAPP_CART_VIEW:774774619,WHATSAPP_CART_ADD:774774794,WHATSAPP_PROFILE_SAVE:774775117,WHATSAPP_PRODUCT_VIEW:774775607,WHATSAPP_COLLECTION_APPEAL:774776895,WHATSAPP_PLM_DETAILS_VIEW:774777097,WHATSAPP_COLLECTION_EDIT:774777483,WHATSAPP_ORDER_CREATE:774777518,WHATSAPP_PROFILE_CATS_VIEW:774777556,WHATSAPP_PRODUCT_SET_VISIBLE:774778628,WHATSAPP_PRODUCT_IMAGES_LOAD:774778674,WHATSAPP_PRODUCT_SAVE:774779113,WHATSAPP_PRODUCT_MESSAGE_SEND:774779800,WHATSAPP_COLLECTION_VIEW_ALL:774780089,WHATSAPP_CATALOG_COLLECTIONS_VIEW:774781666,WHATSAPP_PRODUCT_REPORT:774782053,WHATSAPP_COLLECTION_RENAME:774782934,WHATSAPP_WEB_TEST_EVENT:891422769,CHAT_OPEN:891425633});t.QuickLogMarkerId=r},33994:(e,t,n)=>{"use strict";var r=n(59182).default,i=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.start=function(){return m.apply(this,arguments)};var a=i(n(48926)),o=n(13959),s=n(92574),l=n(63719),c=n(19770),d=n(30433);const u={minTimeout:1e3,maxTimeout:1e4,retries:5,signal:(new r).signal},p=100,f=4,h=6e4,_=9e5;let g;function m(){return(m=(0,a.default)((function*(e){var t,n,r,i,a;g||(g={sendEvents:e.sendEvents,isQplEnabled:e.isQplEnabled,startUploadDelay:1e3*(null!==(t=e.startUploadDelay)&&void 0!==t?t:300),uploadInterval:1e3*(null!==(n=e.uploadInterval)&&void 0!==n?n:86400),uploadRetryDelayMin:1e3*(null!==(r=e.uploadRetryDelayMin)&&void 0!==r?r:h),uploadRetryDelayMax:1e3*(null!==(i=e.uploadRetryDelayMax)&&void 0!==i?i:_),uploadRetryMaxAttemptsCount:null!==(a=e.uploadRetryMaxAttemptsCount)&&void 0!==a?a:f},yield(0,o.delayMs)(g.startUploadDelay),S())}))).apply(this,arguments)}function y(){return E.apply(this,arguments)}function E(){return(E=(0,a.default)((function*(){const e=g.uploadRetryDelayMin+Math.floor(Math.random()*(g.uploadRetryDelayMax-g.uploadRetryDelayMin));yield(0,o.delayMs)(e)}))).apply(this,arguments)}function S(){return v.apply(this,arguments)}function v(){return(v=(0,a.default)((function*(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(g.isQplEnabled())try{const e=yield(0,l.rowCount)();let t=0;for(;t<e;){const e=yield(0,l.getFromBottom)(p);yield T(e);const n=e[0].id||0,r=e[e.length-1].id||0;yield(0,l.deleteRange)(n,r),t+=e.length}yield(0,o.delayMs)(g.uploadInterval||0),S()}catch(t){e<g.uploadRetryMaxAttemptsCount?(yield y(),S(e+1)):(__LOG__(4,!0,new Error,!0)`QPL Uploader, error during upload session, error: ${t}`,SEND_LOGS("QPL Uploader upload session failed"),(0,d.errorUploadingChunk)(t),yield(0,o.delayMs)(g.uploadInterval||0),S())}}))).apply(this,arguments)}function T(){return b.apply(this,arguments)}function b(){return(b=(0,a.default)((function*(e){yield(0,c.exponentialBackoff)(u,((t,n)=>(e[0].id,e[e.length-1].id,g.sendEvents(e).catch((e=>{if(e instanceof s.ServerStatusCodeError)switch(e.statusCode){case 500:return __LOG__(3)`QPL Uploader uploadChunk, retriable error: ${e.errorMessage}, failCount ${n}`,t(e)}throw e})))))}))).apply(this,arguments)}},68106:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let t=-1;for(let n=0,i=e.length;n<i;n++)t=t>>>8^r[255&(t^e.charCodeAt(n))];return~t};let r=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];void 0!==n.g.Int32Array&&(r=new Int32Array(r))},60407:(e,t,n)=>{"use strict";var r=n(95318),i=r(n(81109)),a=r(n(68106));function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(t,"__esModule",{value:!0});const s=Object.freeze({TRUST_CLIENT_REPORTED_SAMPLE_RATE:1}),l=Object.freeze({API_CALL:27787270,CRASH_RESILIENCE:27787276,LOCKLESS_IS_MARKER_ON_ACCURACY:27787269,LOCKLESS_MARKER_START:27787266,LOCKLESS_QUEUE_SIZE:27787265,LOCKLESS_STARTED_MARKERS_MAP_COLLISIONS:27787273,LOSS_TRACKING_MARKER_RECEIVED:27787272,LOSS_TRACKING_MARKER_STARTED:27787271,QPL_CONFIG_LOAD:27799150,QPL_CONFIG_SAVE:27791744,QPL_HEARTBEAT_HARDCODED_CONFIG:27792138,QPL_HEARTBEAT_SEVER_CONFIG:27803336,USAGE:27791726,ZERO_SAMPLE_RATE_DUE_MISSING_CONFIG:27787268,ZERO_SAMPLE_RATE_DUE_MISSING_EVENT_IN_CONFIG:27787267}),c=Object.freeze({REGULAR:1,USER_FLOW:2});function d(e,t){const n=t-e;if(0===n)return"0";const[r,i]=n.toFixed(6).split(".",2);return"0"===r?i.replace(/^0+/,""):r+i}function u(e,t,n,r){const a=t[e];if(!a||0===Object.entries(a).length)return null;const o={};return Object.keys(a).forEach((e=>{const t=a[e];null==t||0===t.length?delete a[e]:o[e]=r?r(t):t})),{[e]:(0,i.default)((0,i.default)({},null==n?void 0:n[e]),o)}}function p(e,t){if(null==e)return t;const n=(0,i.default)((0,i.default)((0,i.default)((0,i.default)((0,i.default)((0,i.default)((0,i.default)((0,i.default)((0,i.default)({},t),u("string",e,t)),u("int",e,t,Math.trunc)),u("double",e,t)),u("bool",e,t)),u("string_array",e,t)),u("int_array",e,t,(e=>e.map(Math.trunc)))),u("double_array",e,t)),u("bool_array",e,t));return Object.keys(n).forEach((e=>{const t=n[e];null!=t&&0!==Object.entries(t).length||delete n[e]})),0!==Object.entries(n).length?n:null}function f(e,t){if(!t)return e;const n={};return t.string&&(n.annotations=t.string),t.int&&(n.annotations_int=t.int),t.double&&(n.annotations_double=t.double),t.bool&&(n.annotations_bool=t.bool),t.string_array&&(n.annotations_string_array=t.string_array),t.int_array&&(n.annotations_int_array=t.int_array),t.double_array&&(n.annotations_double_array=t.double_array),t.bool_array&&(n.annotations_bool_array=t.bool_array),(0,i.default)((0,i.default)({},e),n)}const h=new Map([[1,"random_sampling"],[3,"per_user"]]);function _(e,t){return 0!==e&&(e<=1||("string"==typeof t?0==(n=t,((0,a.default)(n)>>>0)%e):Math.random()*e<=1));var n}class g{constructor(e){let t;o(this,"_settings",void 0),o(this,"_nextListenerId",1),o(this,"_defaultSampleRate",100),o(this,"_listeners",new Map),o(this,"_listenersWithMarker",new Map),o(this,"_debuggingId",void 0),o(this,"_logger",void 0),o(this,"_markerSampleRate",{}),o(this,"activeMarkers",new Map),this._settings=e,this._logger=e.logger,this._listenersWithMarker=null!==(t=e.listenersWithMarker)&&void 0!==t?t:new Map}getMarker(e,t){const n=this._getMarkerInstances(e);if(!n)return null;const r=n.get(t);return r||null}getMarkerInstances(e){return this._getMarkerInstances(e)}_getMarkerInstances(e){let t;return(null===(t=this._settings.quickLogConfigHelper)||void 0===t?void 0:t.isKillswitchOn())?null:this.activeMarkers.get(e)}addMarker(e,t,n){let r=this.activeMarkers.get(e);r||(r=new Map,this.activeMarkers.set(e,r)),r.set(t,n)}deleteMarker(e,t){let n;null===(n=this.activeMarkers.get(e))||void 0===n||n.delete(t)}markerStart(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.currentTimestamp(),{cancelOnUnload:i=!1,trackedForLoss:a=!1,type:o=c.REGULAR,samplingBasis:s=null}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(null===(t=this._settings.quickLogConfigHelper)||void 0===t?void 0:t.isKillswitchOn())return;this.getMarker(e,n)&&this._logger.warn(`Duplicate QPL markerId: ${e} & instanceKey: ${n}`);const[d,u,p]=this._getSamplingPolicy(e,s),f={passesSampling:d,timestamp:r,sampleRate:u,samplingMethod:p,points:[],cancelOnUnload:i,trackedForLoss:a,type:o};this._listeners.forEach((t=>{t.onMarkerStart(e,n,r)})),this._listenersWithMarker.forEach((t=>{t.onMarkerStartWithMarker(e,n,r,f)})),d&&this.addMarker(e,n,f),d&&!0===a&&this._uploadEvent({marker_id:l.LOSS_TRACKING_MARKER_STARTED,action_id:0,sample_rate:1,annotations_int:{tracked_marker_id:e},marker_type:c.REGULAR})}markerAnnotate(e,t){let{instanceKey:n=0}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._listeners.forEach((r=>{Object.keys(t).forEach((i=>{const a=t[i];a&&Object.keys(a).forEach((t=>{r.onAnnotation(e,n,t,a[t])}))}))}));const r=this.getMarker(e,n);r&&(r.annotations=p(t,r.annotations))}markerPoint(e,t){let{instanceKey:n=0,data:r,timestamp:i=this.currentTimestamp()}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._listeners.forEach((a=>{let o;return a.onMarkerPoint(e,n,t,null==r||null===(o=r.string)||void 0===o?void 0:o.__key,i)}));const a=this.getMarker(e,n);if(!a)return;const o={name:t,timeSinceStart:Math.trunc(i-a.timestamp)},s=p(r);s&&(o.data=s),a.points.push(o)}markerEnd(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.currentTimestamp();this._listeners.forEach((i=>i.onMarkerEnd(t,e,n,r)));const a=this.getMarker(e,n);if(a){if(a.passesSampling){if(!0!==a.timestampIsApproximate){const o=a.type===c.USER_FLOW?a.points:function(e){return Array.from(new Set(e.map((e=>e.name)))).map((t=>e.find((e=>e.name===t)))).filter(Boolean)}(a.points),l=function(e,t){return!0===t?(0,i.default)((0,i.default)({},e),{},{tracked_for_loss:!0}):e}(f({marker_id:e,action_id:t,instance_id:n,sample_rate:a.sampleRate,method:h.get(a.samplingMethod),duration_ns:d(a.timestamp,r),points:o,metadata:{application_analytics:{time_since_qpl_module_init:r-this._settings.moduleLoadTimestamp}},marker_type:a.type,flags:s.TRUST_CLIENT_REPORTED_SAMPLE_RATE},a.annotations),a.trackedForLoss);this._uploadEvent(l)}this._debuggingId===e&&this._settings.onDebuggingIdEnded&&this._settings.onDebuggingIdEnded()}this.deleteMarker(e,n)}}markerDrop(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.deleteMarker(e,t);const n=this.currentTimestamp();this._listeners.forEach((r=>{r.onMarkerDrop&&r.onMarkerDrop(e,t,n)}))}markEvent(e,t,n){let r,{timestamp:i=this.currentTimestamp(),annotations:a}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(null===(r=this._settings.quickLogConfigHelper)||void 0===r?void 0:r.isKillswitchOn())return;const[o,l,d]=this._getSamplingPolicy(e);if(!o)return;const u=p("function"==typeof a?a():a),_={marker_id:e,action_id:0,instance_id:0,sample_rate:l,method:h.get(d),da_type:t,da_level:n,metadata:{application_analytics:{time_since_qpl_module_init:i-this._settings.moduleLoadTimestamp}},marker_type:c.REGULAR,flags:s.TRUST_CLIENT_REPORTED_SAMPLE_RATE};this._uploadEvent(f(_,u))}dropAllMarkers(){this.activeMarkers.clear()}setAlwaysOnSampleRate(e,t){this._markerSampleRate[e]=t}currentTimestamp(){return this._settings.performanceNow()}enableDebug(e){this._debuggingId=parseInt(e,10)}disableDebug(){this._debuggingId=null}addListener(e){const t=this._nextListenerId++;return this._listeners.set(t,e),{dispose:()=>{this._listeners.delete(t)}}}_getSamplingPolicy(e,t){let n,r,i,a,o;if(this._settings.unsampleAllEvents&&this._settings.unsampleAllEvents()||this._debuggingId===e)return[!0,1,1];const s=null!==(n=null===(r=this._settings.quickLogConfigHelper)||void 0===r?void 0:r.getEventDetails(e))&&void 0!==n?n:{sampleRate:0,samplingMethod:1};if(null==this._markerSampleRate[e]&&0!==s.sampleRate&&3===s.samplingMethod){let e;return[!0,null!==(e=s.sampleRate)&&void 0!==e?e:1,3]}const l=null!==(i=null!==(a=this._markerSampleRate[e])&&void 0!==a?a:s.sampleRate)&&void 0!==i?i:this._defaultSampleRate,c=null!==(o=s.samplingMethod)&&void 0!==o?o:1;return[_(l,t),l,c]}_uploadEvent(e){const t=this._settings.decorateEventBeforeUpload?this._settings.decorateEventBeforeUpload(e):e;this._settings.sendEvent(e,t)}getActiveMarkerIDs(e){let{type:t}=e;const n=new Set;return this.activeMarkers.forEach(((e,r)=>{e.forEach((e=>{e.type===t&&n.add(r)}))})),Array.from(n)}forEachMarkerInstance(e,t){const n=this._getMarkerInstances(e);if(n)for(const e of n.keys())t(e)}}var m,y;o(g,"normalizeAnnotations",p),function(e){e[e.REGULAR=1]="REGULAR",e[e.USER_FLOW=2]="USER_FLOW"}(t.QPLMarkerType||(t.QPLMarkerType={})),(m=t.QuickLogActionType||(t.QuickLogActionType={}))[m.SUCCESS=2]="SUCCESS",m[m.FAIL=3]="FAIL",m[m.CANCEL=4]="CANCEL",(y=t.QPLDataEventLevel||(t.QPLDataEventLevel={}))[y.FATAL=1]="FATAL",y[y.ERROR=3]="ERROR",y[y.CRITICAL=4]="CRITICAL",y[y.WARN=5]="WARN",y[y.INFO=7]="INFO",y[y.DEBUG=9]="DEBUG",t.default=g},99234:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.THIS_TAB=void 0,t.assertGetMe=C,t.assertGetMeUser=function(){return(0,l.default)(A(),"meUser")},t.clearDeprecatedKeys=M,t.clearTokens=function(){S.forEach((e=>{m._set(e,void 0)}))},t.deleteComposeContents=function(e){m._clearUserSessionItem(R(e))},t.getAutoDownloadAudio=function(){var e;return null===(e=m._getUser(g.KEYS.AUTO_DOWNLOAD_AUDIO))||void 0===e||e},t.getAutoDownloadDocuments=function(){var e;return null!==(e=m._getUser(g.KEYS.AUTO_DOWNLOAD_DOCUMENTS))&&void 0!==e&&e},t.getAutoDownloadPhotos=function(){var e;return null===(e=m._getUser(g.KEYS.AUTO_DOWNLOAD_PHOTOS))||void 0===e||e},t.getAutoDownloadVideos=function(){var e;return null!==(e=m._getUser(g.KEYS.AUTO_DOWNLOAD_VIDEOS))&&void 0!==e&&e},t.getBrowserId=function(){return m._get(g.KEYS.BROWSER_ID)},t.getCollapseMuted=function(){return m._getUser(g.KEYS.GLOBAL_COLLAPSE_MUTED)},t.getComposeContents=function(e){return m._getUserSession(R(e))},t.getContactChecksum=function(){return m._getUser(g.KEYS.CONTACT_CHECKSUM)},t.getDailyStatsStartTime=N,t.getForcedMdUpgradeComplete=function(){return m._get(g.KEYS.FORCED_MD_UPGRADE_COMPLETE,p.default)},t.getGeocoderLocation=function(){return m._getUser(g.KEYS.GEOCODER_LOCATION)},t.getGlobalCallRingtone=function(){return!m._getUser(g.KEYS.GLOBAL_MUTE_CALL_RINGTONE)},t.getGlobalNotifications=function(){return!m._getUser(g.KEYS.GLOBAL_MUTE_NOTIFICATIONS)},t.getGlobalPreviews=function(){return!m._getUser(g.KEYS.GLOBAL_MUTE_PREVIEWS)},t.getGlobalSecurityNotifications=function(){var e;return null===(e=!m._getUser(g.KEYS.SECURITY_NOTIFICATIONS))||void 0===e||e},t.getGlobalSounds=function(){return!m._getUser(g.KEYS.GLOBAL_MUTE_SOUNDS)},t.getGroupParticipantAssignedColor=function(e){return m._getUser(g.KEYS.GROUP_ASSIGNED_COLOR+"-"+e.toString())},t.getHistorySyncEarliestDate=function(){const e=m._get(g.KEYS.HISTORY_SYNC_EARLIEST_DATE);if(!e)return D((0,c.unixTime)());return e},t.getIgnoreNondirectGroupMsg=function(){return m._getUser(g.KEYS.IGNORE_NONDIRECT_GROUP_MSG)},t.getLangPref=function(){return m._get(g.KEYS.LANG)},t.getLastChatMuteDuration=function(){return m._getUser(g.KEYS.LAST_CHAT_MUTE_DURATION)},t.getLastComposeBoxPanel=function(){return m._getUser(g.KEYS.LAST_SELECTED_COMPOSE_BOX_PANEL)},t.getLastMobilePlatform=function(){return m._get(g.KEYS.MOBILE_PLATFORM)},t.getLastStatusUsage=function(){return m._getUser(g.KEYS.LAST_STATUS_USAGE)},t.getLoginTokens=P,t.getLogoutToken=function(){return m._getPS(g.KEYS.LOGOUT_TOKEN)},t.getMapsOverQuota=function(){return m._get(g.KEYS.GMAPS_OVER_LIMIT)},t.getMaybeMeUser=function(){const e=b();return e?(0,h.toUserWid)(e):void 0},t.getMe=b,t.getMeUser=A,t.getMutex=function(){return m._getPSIgnoringCache(g.KEYS.WHATSAPP_MUTEX)},t.getNoTakeover=function(){return m._getTS(g.KEYS.NO_TAKEOVER)},t.getNoticeBannerClosedAt=function(){return m._getUser(g.KEYS.NOTICE_BANNER_CLOSED_AT)},t.getNoticeId=function(){return m._getUser(g.KEYS.NOTICE_ID)},t.getOldLogoutCreds=function(){return m._getPS(g.KEYS.OLD_LOGOUT_CREDS)||[]},t.getOutgoingMessageSound=function(){return m._getUser(g.KEYS.OUTGOING_MESSAGE_SOUND)},t.getPrimaryFeatures=function(){var e;return null!==(e=m._get(g.KEYS.PRIMARY_FEATURES))&&void 0!==e?e:[]},t.getPsKillSwitchToken=function(){return m._get(g.KEYS.PS_KILLSWITCH_TOKEN)},t.getPttPlaybackRate=function(){var e;return null!==(e=m._get(g.KEYS.PTT_PLAYBACK_RATE))&&void 0!==e?e:1},t.getPushname=function(){return m._getUser(g.KEYS.LAST_PUSHNAME)},t.getSeenGroupDesc=function(e){return m._getUser(e.toString())},t.getShouldPreemptivelyCleanupLogs=function(){return!1!==m._get(g.KEYS.LOG_PREEMPT_CLEAN_UP)},t.getShowMdUpgradeCompleteMsg=function(){return m._get(g.KEYS.SHOW_MD_UPGRADE_COMPLETE_MSG,p.default)},t.getSmbLabelPalette=function(){return m._getUser(g.KEYS.SMB_LABEL_COLOR_PALETTE)},t.getStorageAlert=function(){return _.STORAGE_ALERT_TYPE.NO_ALERT},t.getStorageDismissState=function(){return{lowQuotaDismissed:!0,highQuotaDismissed:!0}},t.getSystemThemeMode=function(){return m._get(g.KEYS.SYSTEM_THEME_MODE)},t.getTheme=function(){return m._get(g.KEYS.THEME)},t.getUnknownId=function(){let e=m._get(g.KEYS.UNKNOWN_ID);e||(e="unknown"+Math.floor(1e10*Math.random()),O(e));return e},t.getUnreadMentionCountEnabled=function(){return m._get(g.KEYS.UNREAD_MENTION_COUNT_ENABLED)},t.getUserPrivacySettings=function(){var e;return null!==(e=m._getUser(g.KEYS.USER_PRIVACY_SETTINGS))&&void 0!==e?e:{}},t.getVersion=function(){return m._get(g.KEYS.PROTO_VERSION)},t.getVideoVolumeSettings=function(){return{volume:m._get(g.KEYS.VIDEO_VOLUME),muted:!!m._get(g.KEYS.VIDEO_MUTE)}},t.getWamBuffer=function(){return m._get(g.KEYS.WAM_BUFFER,void 0,!0)},t.getWamInfo=function(){return m._get(g.KEYS.WAM_INFO)},t.initDailyStatsStartTime=function(){N()},t.knowsPhone=function(){const e=P();return!(!e.client||!e.server)},t.localTakeoverSuccess=function(){const e=m.getRememberMe()?{}:(0,o.default)(m._getAllKeyValues(),y.LS_ONLY_KEYS);e.wa_tab_src=T,(0,l.default)(d.default,"localStorage").setItem(g.KEYS.LOCAL_TAKEOVER_OK,JSON.stringify(e)),(0,l.default)(d.default,"localStorage").removeItem(g.KEYS.LOCAL_TAKEOVER_OK)},t.markUserSentMessageToChat=function(e){const t=L(e),n=m._getUser(g.KEYS.CHATS_USER_SENT_MESSAGE_TO)||[];if(!Array.isArray(n))return __LOG__(3)`UserPrefs:markUserSentMessageToChat value in store is not an array`,m._setUser(g.KEYS.CHATS_USER_SENT_MESSAGE_TO,[t]),!1;const r=!n.includes(t);r&&(n.push(t),m._setUser(g.KEYS.CHATS_USER_SENT_MESSAGE_TO,n));return __LOG__(2)`UserPrefs:markUserSentMessageToChat`,r},t.mdOptedIn=function(){return m._get(g.KEYS.MD_OPTED_IN,u.default)},t.mutexFilter=function(e){if(e.key!==g.KEYS.WHATSAPP_MUTEX)return!1;if(!(e.newValue||"").includes(T))return!0;return!1},t.parseMutex=function(e){const t=e?JSON.parse(e):"";return t?t.toString().split(/:/).pop():t},t.parseTakeover=function(e){const t=e?JSON.parse(e):{};if((0,a.default)(t))return delete t.wa_tab_src,t;return{}},t.removeMutex=function(){m._setPS(g.KEYS.WHATSAPP_MUTEX)},t.removeUserSentMessageToChat=function(e){const t=m._getUser(g.KEYS.CHATS_USER_SENT_MESSAGE_TO)||[];if(!Array.isArray(t))return __LOG__(3)`UserPrefs:removeUserSentMessageToChat value in store is not an array`,void m._setUser(g.KEYS.CHATS_USER_SENT_MESSAGE_TO,[]);const n=L(e);t.includes(n)&&m._setUser(g.KEYS.CHATS_USER_SENT_MESSAGE_TO,(0,i.default)(t,n));__LOG__(2)`UserPrefs:removeUserSentMessageToChat`},t.setAutoDownloadAudio=function(e){m._setUser(g.KEYS.AUTO_DOWNLOAD_AUDIO,e)},t.setAutoDownloadDocuments=function(e){m._setUser(g.KEYS.AUTO_DOWNLOAD_DOCUMENTS,e)},t.setAutoDownloadPhotos=function(e){m._setUser(g.KEYS.AUTO_DOWNLOAD_PHOTOS,e)},t.setAutoDownloadVideos=function(e){m._setUser(g.KEYS.AUTO_DOWNLOAD_VIDEOS,e)},t.setBrowserId=function(e){m._set(g.KEYS.BROWSER_ID,e)},t.setCollapseMuted=function(e){m._setUser(g.KEYS.GLOBAL_COLLAPSE_MUTED,e)},t.setComposeContents=function(e,t){m._setUserSession(R(e),t)},t.setContactChecksum=function(e){m._setUser(g.KEYS.CONTACT_CHECKSUM,e)},t.setForcedMdUpgradeComplete=function(e){m._set(g.KEYS.FORCED_MD_UPGRADE_COMPLETE,e,p.default)},t.setGeocoderLocation=function(e){m._setUser(g.KEYS.GEOCODER_LOCATION,e)},t.setGlobalCallRingtone=function(e){m._setUser(g.KEYS.GLOBAL_MUTE_CALL_RINGTONE,!e)},t.setGlobalNotifications=function(e){m._setUser(g.KEYS.GLOBAL_MUTE_NOTIFICATIONS,!e)},t.setGlobalPreviews=function(e){m._setUser(g.KEYS.GLOBAL_MUTE_PREVIEWS,!e)},t.setGlobalSecurityNotifications=function(e){m._setUser(g.KEYS.SECURITY_NOTIFICATIONS,!e)},t.setGlobalSounds=function(e){m._setUser(g.KEYS.GLOBAL_MUTE_SOUNDS,!e)},t.setGroupParticipantAssignedColor=function(e,t){m._setUser(g.KEYS.GROUP_ASSIGNED_COLOR+"-"+e.toString(),t)},t.setHistorySyncEarliestDate=D,t.setIgnoreNondirectGroupMsg=function(e){m._setUser(g.KEYS.IGNORE_NONDIRECT_GROUP_MSG,e)},t.setLangPref=function(e){m._set(g.KEYS.LANG,e)},t.setLastChatMuteDuration=function(e){m._setUser(g.KEYS.LAST_CHAT_MUTE_DURATION,e)},t.setLastComposeBoxPanel=function(e){m._setUser(g.KEYS.LAST_SELECTED_COMPOSE_BOX_PANEL,e)},t.setLastMobilePlatform=function(e){m._set(g.KEYS.MOBILE_PLATFORM,e)},t.setLastStatusUsage=function(){m._setUser(g.KEYS.LAST_STATUS_USAGE,Date.now())},t.setLoginTokens=function(e){const t=e.client,n=e.server;t&&n&&!(0,s.default)(t)&&(__LOG__(2)`UserPrefs:setLoginTokens`,m._set(g.KEYS.CLIENT_TOKEN,t),m._set(g.KEYS.SERVER_TOKEN,n))},t.setLogoutToken=function(e){m._setPS(g.KEYS.LOGOUT_TOKEN,e)},t.setMapsOverQuota=function(e){m._set(g.KEYS.GMAPS_OVER_LIMIT,e)},t.setMdOptedIn=function(e){m._set(g.KEYS.MD_OPTED_IN,e,u.default)},t.setMe=function(e){const{isMDBackend:t}=n(88555);t()?m._set(g.KEYS.LAST_WID_MD,e):m._set(g.KEYS.LAST_WID,e)},t.setMutex=function(e){const t=e?T+":"+e:e;m._setPS(g.KEYS.WHATSAPP_MUTEX,t)},t.setNoTakeover=function(e){m._setTS(g.KEYS.NO_TAKEOVER,e)},t.setNoticeBannerClosedAt=function(e){m._setUser(g.KEYS.NOTICE_BANNER_CLOSED_AT,e)},t.setNoticeId=function(e){m._setUser(g.KEYS.NOTICE_ID,e)},t.setOldLogoutCreds=function(e){m._setPS(g.KEYS.OLD_LOGOUT_CREDS,e)},t.setOutgoingMessageSound=function(e){m._setUser(g.KEYS.OUTGOING_MESSAGE_SOUND,e)},t.setPrimaryFeatures=function(e){m._set(g.KEYS.PRIMARY_FEATURES,e)},t.setPsKillSwitchToken=function(e){m._set(g.KEYS.PS_KILLSWITCH_TOKEN,e)},t.setPttPlaybackRate=function(e){m._set(g.KEYS.PTT_PLAYBACK_RATE,e)},t.setPushname=function(e){m._setUser(g.KEYS.LAST_PUSHNAME,e)},t.setRefTok=function(e,t){M(),m.setRefTokCookies(e,t)},t.setSeenGroupDesc=function(e){m._setUser(e.toString(),!0)},t.setShouldPreemptivelyCleanupLogs=function(e){m._set(g.KEYS.LOG_PREEMPT_CLEAN_UP,e)},t.setShowMdUpgradeCompleteMsg=function(e){m._set(g.KEYS.SHOW_MD_UPGRADE_COMPLETE_MSG,e,p.default)},t.setSmbLabelPalette=function(e){m._set(g.KEYS.SMB_LABEL_COLOR_PALETTE,e)},t.setStorageAlert=function(){},t.setStorageDismissState=function(){},t.setSystemThemeMode=function(e){m._set(g.KEYS.SYSTEM_THEME_MODE,e)},t.setTheme=function(e){m._set(g.KEYS.THEME,e)},t.setUnknownId=O,t.setUnreadMentionCountEnabled=function(e){m._set(g.KEYS.UNREAD_MENTION_COUNT_ENABLED,e)},t.setUserPrivacySettings=function(e){m._setUser(g.KEYS.USER_PRIVACY_SETTINGS,e)},t.setVersion=function(e){null!=e&&m._set(g.KEYS.PROTO_VERSION,e)},t.setVideoMutedSetting=w,t.setVideoVolumeSetting=I,t.setVideoVolumeSettings=function(e,t){I(e),w(t)},t.setWamBuffer=function(e){m._set(g.KEYS.WAM_BUFFER,e,void 0,!0)},t.setWamInfo=function(e){m._set(g.KEYS.WAM_INFO,e)},t.takeoverFilter=function(e){if(e.key!==g.KEYS.LOCAL_TAKEOVER_OK)return!1;if(!(e.newValue||"").includes(T))return!0;return!1};var i=r(n(82569)),a=r(n(13218)),o=r(n(57557)),s=r(n(52353)),l=r(n(45095)),c=n(92844),d=r(n(4285)),u=r(n(45234)),p=r(n(24609)),f=r(n(89867)),h=n(45454),_=n(60764),g=n(72407),m=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=E(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(53055)),y=n(70499);function E(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(E=function(e){return e?n:t})(e)}const S=[g.KEYS.LOGOUT_TOKEN,g.KEYS.CLIENT_TOKEN,g.KEYS.SERVER_TOKEN,g.KEYS.SECRET_BUNDLE],v=[g.KEYS.VERSION],T="x"+Math.round(1e9*Math.random());function b(){let e=null;const{isMDBackend:t}=n(88555);return e=t()?m._get(g.KEYS.LAST_WID_MD):m._get(g.KEYS.LAST_WID),e&&f.default.isWid(e)?(0,h.createWid)(e):e}function C(){return(0,l.default)(b(),"me")}function A(){return(0,h.toUserWid)(C())}function P(){return{client:m._get(g.KEYS.CLIENT_TOKEN),server:m._get(g.KEYS.SERVER_TOKEN)}}function M(){v.forEach((function(e){u.default.removeItem(e)}))}function O(e){return m._set(g.KEYS.UNKNOWN_ID,e)}function I(e){m._set(g.KEYS.VIDEO_VOLUME,e)}function w(e){m._set(g.KEYS.VIDEO_MUTE,e)}function R(e){return`${g.KEYS.COMPOSE_CONTENTS_PREFIX}${e.toString()}`}function D(e){const t=90*c.DAY_SECONDS,n=(c.YEAR_SECONDS,e-t);return m._set(g.KEYS.HISTORY_SYNC_EARLIEST_DATE,n),n}function L(e){return`${e.toString()}_`}function N(){const e=m._get(g.KEYS.DAILY_STATS_START_TIME);if("number"==typeof e)return e;const t=Date.now();return m._set(g.KEYS.DAILY_STATS_START_TIME,t),t}t.THIS_TAB=T},15875:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.waNoiseInfo=t.deviceInfo=void 0;var i=r(n(48926)),a=n(15688),o=n(8584),s=n(12669),l=r(n(14296)),c=n(58052);const d=new class{get(){return{osVersion:"0.1",osBuild:"0.1",hardware:"desktop",manufacturer:"",device:"Desktop",lg:l.default.getLanguage(),lc:l.default.getRegion()||"",mcc:"000",mnc:"000",sim_mnc:"000",sim_mcc:"000"}}};t.deviceInfo=d;const u=new class{get(){var e=this;return(0,i.default)((function*(){const t=(0,c.getNoiseInfo)(),n=e._getIv();return t&&n?(t.recoveryToken=yield e._decryptNoiseData(t.recoveryToken,n[0]),t.staticKeyPair.pubKey=yield e._decryptNoiseData(t.staticKeyPair.pubKey,n[1]),t.staticKeyPair.privKey=yield e._decryptNoiseData(t.staticKeyPair.privKey,n[2]),t):null}))()}set(e){var t=this;return(0,i.default)((function*(){const n=new Uint8Array(48);self.crypto.getRandomValues(n);const r=t._processIv(n);return t._setIv(r),e.recoveryToken=yield t._encryptNoiseData(e.recoveryToken,r[0]),e.staticKeyPair.pubKey=yield t._encryptNoiseData(e.staticKeyPair.pubKey,r[1]),e.staticKeyPair.privKey=yield t._encryptNoiseData(e.staticKeyPair.privKey,r[2]),(0,c.setNoiseInfo)(e)}))()}_setIv(e){return(0,c.setNoiseInfoIv)(e.map(a.encodeB64))}_getIv(){const e=(0,c.getNoiseInfoIv)();return e?e.map((e=>new Uint8Array((0,a.decodeB64)(e)))):null}_processIv(e){const t=new o.Binary(e);return[t.readByteArray(16),t.readByteArray(16),t.readByteArray(16)]}_encryptNoiseData(e,t){return(0,i.default)((function*(){const n=s.DbEncKeyStore.encKeys[0];return yield self.crypto.subtle.encrypt({iv:t,name:"AES-CBC"},n.key,e)}))()}_decryptNoiseData(e,t){return(0,i.default)((function*(){const n=s.DbEncKeyStore.encKeys[0];return yield self.crypto.subtle.decrypt({iv:t,name:"AES-CBC"},n.key,e)}))()}};t.waNoiseInfo=u},50313:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getContactChecksum=function(){return r._getUser(a)},t.getFrequentContacts=function(){return r._getUser(o)},t.getGKFeatures=function(){return r._getUser(s)},t.getGKProto=function(){return r._getUser(l)},t.getHistoryInitialSyncBoundry=function(){const e=r._getUser(c);try{return JSON.parse(e)}catch(e){return null}},t.getInitialGroupPhash=function(e){const t=r._getUser(d);try{return JSON.parse(t)[e]}catch(e){return null}},t.getInitialGroupPhashMap=function(){const e=r._getUser(d);try{return JSON.parse(e)}catch(e){return null}},t.setContactChecksum=function(e){r._setUser(a,e)},t.setFrequentContacts=function(e){r._setUser(o,e)},t.setGKFeatures=function(e){r._setUser(s,e)},t.setGKProto=function(e){r._setUser(l,e)},t.setHistoryInitialSyncBoundry=function(e){r._setUser(c,JSON.stringify(e))},t.setInitialGroupPhash=function(e){r._setUser(d,JSON.stringify(e))};var r=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=i(t);if(n&&n.has(e))return n.get(e);var r={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=a?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(r,o,s):r[o]=e[o]}r.default=e,n&&n.set(e,r);return r}(n(53055));function i(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(i=function(e){return e?n:t})(e)}const a="contact_checksum",o="frequent_contacts",s="gk_features",l="gk_proto",c="history_initial_sync_boundry",d="initial_group_phash"},58052:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.clearRegistrationInfo=function(){const e=[h,g,m,y,E,A];(0,s.isMDBackend)()?e.push(d.KEYS.LAST_WID_MD):e.push(d.KEYS.LAST_WID);e.map((e=>{u._set(e,void 0)}))},t.getADVSecretKey=function(){return u._get(T)},t.getAllCriticalDataSynced=function(){return!!u._get(S,l.default)},t.getArchiveV2EnabledSetting=function(){return u._get(I)},t.getBlocklistHash=function(){return u._get(b)},t.getChatThreadLoggingLastUploadedStartTs=function(){return u._get(N)},t.getChatThreadLoggingOffset=function(){return u._get(D)},t.getChatThreadLoggingSecretB64=function(){return u._get(L)},t.getHistorySyncStatus=x,t.getInitialHistorySyncComplete=function(){return!!u._get(E,l.default)},t.getIsCommunityDiscovered=function(){return!!u._get(k)},t.getLastHistorySycnedChunk=function(){return u._get(M)},t.getMdInternVersion=function(){return},t.getMdSyncActionsActionSanitized=function(){return u._get(R)},t.getNoiseInfo=G,t.getNoiseInfoIv=function(){return u._get(_)},t.getPairingTimestamp=function(){return u._get(U)},t.getPrimaryAllowsAllMutations=function(){return!!u._get(w)},t.getRoutingInfo=function(){const e=u._get(y,l.default);if(!e)return null;const{domain:t,edgeRouting:n}=e;return{domain:t,edgeRouting:n?(0,o.decodeB64)(n):null}},t.getShouldCheckContactSyncStatus=function(){return!!u._get(C)},t.getUnarchiveChatsSetting=function(){return u._get(O)},t.getUpgradeMdWamFlag=function(){return!!u._get(P)},t.getWebEncSalt=function(){return u._get(A,l.default)},t.isRegistered=function(){return!(!G()||!c.getMe())},t.setADVSecretKey=function(e){return u._set(T,e)},t.setAllCriticalDataSynced=function(){return u._set(S,!0)},t.setArchiveV2EnabledSetting=function(e){u._set(I,e)},t.setBlocklistHash=function(e){return u._set(b,e)},t.setChatThreadLoggingLastUploadedStartTs=function(e){u._set(N,e)},t.setChatThreadLoggingOffset=function(e){u._set(D,e)},t.setChatThreadLoggingSecretB64=function(e){u._set(L,e)},t.setHistorySyncStatus=function(e){var t;const n=null!==(t=x())&&void 0!==t?t:{};u._set(v,(0,i.default)((0,i.default)({},n),e),void 0,void 0,!1)},t.setInitialHistorySyncComplete=function(){return u._set(E,"true",void 0,void 0,!1)},t.setIsCommunityDiscovered=function(e){u._set(k,e)},t.setLastHistorySycnedChunk=function(e,t){if(null==e||null==t)return;u._set(M,`${e}_${t}`,void 0,void 0,!1)},t.setMdInternVersion=function(){},t.setMdSyncActionsActionSanitized=function(e){u._set(R,e)},t.setNoiseInfo=function(e){const t={recoveryToken:e.recoveryToken,pubKey:e.staticKeyPair.pubKey,privKey:e.staticKeyPair.privKey};return u._set(h,(0,a.default)(t,o.encodeB64),void 0,void 0,!1)},t.setNoiseInfoIv=function(e){u._set(_,e,void 0,void 0,!1)},t.setPairingTimestamp=function(e){return u._set(U,e)},t.setPrimaryAllowsAllMutations=function(){return u._set(w,!0)},t.setRoutingInfo=function(e){const{domain:t,edgeRouting:n}=e,r={domain:t,edgeRouting:n?(0,o.encodeB64)(n):null};return u._set(y,r,l.default)},t.setShouldCheckContactSyncStatus=function(){return u._set(C,!0)},t.setUnarchiveChatsSetting=function(e){u._set(O,e)},t.setUpgradeMdWamFlag=function(e){return u._set(P,e)},t.setWebEncSalt=function(e){return u._set(A,e,void 0,void 0,!1)};var i=r(n(81109)),a=r(n(66604)),o=n(15688),s=n(88555),l=r(n(45234)),c=f(n(99234)),d=n(72407),u=f(n(53055));function p(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(p=function(e){return e?n:t})(e)}function f(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=p(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}return r.default=e,n&&n.set(e,r),r}const h="WANoiseInfo",_="WANoiseInfoIv",g="WAMeInfo",m="WADeviceId",y="WARoutingInfo",E="WaInitialHistorySynced",S="critical_data_synced",v="WAHistorySyncStatus",T="WaADVSecretKey",b="WABlocklistHash",C="WAShouldCheckContactSyncStatus",A="WebEncKeySalt",P="MdUpgradeWamFlag",M="MdHistoryLastChunkProcessed",O="WAUnarchiveChatsSetting",I="WAArchiveV2EnabledSetting",w="WASyncdPrimaryAllowsAllMutations",R="MdSyncActionsActionSanitized",D="ChatThreadLoggingOffset",L="ChatThreadLoggingSecret",N="ChatThreadLoggingLastUploadedStartTs",k="WAIsCommunityDiscovered",U="MdPairingTimestamp";function G(){const e=u._get(h);if(!e)return null;const t=(0,a.default)(e,o.decodeB64);return{recoveryToken:t.recoveryToken,staticKeyPair:{pubKey:t.pubKey,privKey:t.privKey}}}function x(){return u._get(v)}},98469:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.NuxPrefsEvent=void 0,t.getNUX=d,t.getNuxSyncList=function(){var e;return null!==(e=o._get(a.KEYS.NUX_LIST))&&void 0!==e?e:[]},t.removeNUX=function(e){o._setUser(e)},t.setNUX=u,t.setNuxSyncList=function(e){o._set(a.KEYS.NUX_LIST,e)},t.shouldShowNUX=function(e){const t=d(e);return!t||t.views<t.maxViews},t.viewNUX=function(e){const t=d(e);if(!t)throw new Error("UserPrefs:viewNUX key "+e+" does not exist");u(e,{views:t.views+1,maxViews:t.maxViews})};var i=r(n(76521)),a=(n(61653),n(72407)),o=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=s(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(53055));function s(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(s=function(e){return e?n:t})(e)}class l extends i.default{handleNuxChange(e){this.trigger(e)}}const c=new l;function d(e){return o._getUser(e)}function u(e,t){o._setUser(e,t)}t.NuxPrefsEvent=c},72407:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.KEYS=void 0;t.KEYS={STORAGE_TEST:"storage_test",CLIENT_TOKEN:"WAToken1",SERVER_TOKEN:"WAToken2",SECRET:"WASecretKey",SECRET_BUNDLE:"WASecretBundle",SECURITY_NOTIFICATIONS:"WASecurityNotifications",BROWSER_ID:"WABrowserId",GEOCODER_LOCATION:"WAGeocoderLocation",GROUP_ASSIGNED_COLOR:"WAGroupAssignedColor-17",GMAPS_OVER_LIMIT:"WAGmapsOverLimit",GLOBAL_MUTE_SOUNDS:"WAGlobalSounds",GLOBAL_MUTE_CALL_RINGTONE:"WAGlobalCallRingtone",OUTGOING_MESSAGE_SOUND:"WAOutgoingMessageSound",GLOBAL_MUTE_NOTIFICATIONS:"WAGlobalNotifications",GLOBAL_MUTE_IN_APP_NOTIFICATIONS:"WAGlobalInAppNotifications",GLOBAL_MUTE_PREVIEWS:"WAGlobalPreviews",GLOBAL_COLLAPSE_MUTED:"WAGlobalCollapseMuted",NOTIFICATION_SOUND:"WANotificationSound",AUTO_DOWNLOAD_PHOTOS:"WAAutoDownloadPhotos",AUTO_DOWNLOAD_AUDIO:"WAAutoDownloadAudio",AUTO_DOWNLOAD_VIDEOS:"WAAutoDownloadVideos",AUTO_DOWNLOAD_DOCUMENTS:"WAAutoDownloadDocuments",LANG:"WALangPref",LAST_ACTIVE_EMOJI_TAB:"WALastActiveEmojiTab",LAST_SELECTED_COMPOSE_BOX_PANEL:"WALastActiveComposeBoxPanel",LAST_CHAT_MUTE_DURATION:"WALastChatMuteDuration",UNKNOWN_ID:"WAUnknownID",VERSION:"WAVersion",LOAD_RETRY_GENERATION:"WALoadRetryGeneration",WHATSAPP_MUTEX:"whatsapp-mutex",LAST_WID:"last-wid",LAST_WID_MD:"last-wid-md",SAVE_TO_CAMERA_ROLL:"save_to_camera_roll",SMB_LABEL_COLOR_PALETTE:"smb_label_color_palette",LAST_PUSHNAME:"last-pushname",PROTO_VERSION:"WAProtoVersion",PTT_PLAYBACK_RATE:"WAPttPlaybackRate",LOGOUT_DIRTY_BIT:"post-logout",UNREAD_MENTION_COUNT_ENABLED:"WAUnreadMentionCountEnabled",DAILY_STATS_START_TIME:"WADailyStatsStartTime",PRIMARY_FEATURES:"WAPrimaryFeatures",TOS_STATE_FETCH_ITERATION:"ToSStateFetchIteration",NUX_LIST:"WANuxList",LOG_PREEMPT_CLEAN_UP:"WALogPreemptiveCleanUp",PRESERVED_USER_KEYS:"preserved_user_keys",EMOJI_VARIANT_COLLECTION:"emoji_variant_collection",RECENT_EMOJI_COLLECTION:"recent_emoji_collection",CHAT_PREFERENCE_COLLECTION:"chat_preference",LAST_STATUS_USAGE:"last-status-usage",MD_OPTED_IN:"md-opted-in",SHOW_MD_UPGRADE_COMPLETE_MSG:"show-md-upgrade-complete-msg",FORCED_MD_UPGRADE_COMPLETE:"forced-md-upgrade-complete",MOBILE_PLATFORM:"mobile-platform",REMEMBER_ME:"remember-me",LOGOUT_TOKEN:"logout-token",OLD_LOGOUT_CREDS:"old-logout-cred",NO_TAKEOVER:"no-takeover",WHATSAPP_LS_VERSION:"ver",WAM_BUFFER:"wam-buffer",WAM_INFO:"wam-info",TIME_SPENT_EVENT:"WaTimeSpentEvent",VIDEO_VOLUME:"video-volume",VIDEO_MUTE:"video-mute",CONTACT_CHECKSUM:"contact-checksum",USER_PRIVACY_SETTINGS:"user-privacy-settings",IS_SMB:"is-smb",COMPOSE_CONTENTS_PREFIX:"compose-contents_",THEME:"theme",SYSTEM_THEME_MODE:"system-theme-mode",ABPROPS:"abprops",HISTORY_SYNC_EARLIEST_DATE:"history-sync-earliest-date",CHATS_USER_SENT_MESSAGE_TO:"chats-user-sent-message-to",SYNCD_DISABLED_DUE_TO_FATAL:"syncd_disabled_due_to_fatal",SYNCD_FIRST_CLEAR_OR_DELETE:"syncd-first-clear-or-delete",CONTACT_SYNC_REFRESH:"contact-sync-refresh-seconds",TOS_3:"TOS_STATE_20210210",NOTICE_BANNER_CLOSED_AT:"notice-banner-closed-at",NOTICE_ID:"notice-id",LOG_CURSOR:"debugCursor",LOCAL_TAKEOVER_OK:"local-takeover-ok",PS_KILLSWITCH_TOKEN:"ps-killswitch-token",STORAGE_DISMISS_STATE:"storage-dismiss-state",STORAGE_ALERT_FLAG:"storage-alert-flag"}},53055:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t._clearUserSessionItem=function(e){const t=w();if(!t)return void __LOG__(3)`userPrefs: Me has not loaded yet.`;const n=(0,d.default)(U(t.toString(),e));_.default.removeItem(n)},t._get=N,t._getAllKeyValues=function(){const e=L();return(0,s.default)(Object.keys(e).map((function(t){return[t,e.getItem(t)]})))},t._getKeys=T,t._getMe=w,t._getPS=M,t._getPSIgnoringCache=function(e){return N(e,h.default,!1,!0)},t._getTS=function(e){return N(e,_.default)},t._getUser=R,t._getUserSession=function(e){const t=w();if(!t)return __LOG__(3)`userPrefs: Me has not loaded yet.`,null;return N((0,d.default)(U(t.toString(),e)),_.default)},t._set=k,t._setAllKeyValues=function(e){const t=L();Object.keys(e).forEach((function(n){null!=e[n]&&t.setItem(n,e[n])}))},t._setKeys=b,t._setPS=O,t._setTS=function(e,t){k(e,t,_.default)},t._setUser=D,t._setUserSession=function(e,t){const n=w();if(!n)return void __LOG__(3)`userPrefs: Me has not loaded yet.`;k((0,d.default)(U(n.toString(),e)),t,_.default)},t._storage=L,t.clearAllLocalState=function(){return P.apply(this,arguments)},t.clearAllTemporaryStorageData=function(){_.default.clear(A())},t.getCollection=function(e){return R(e)},t.getRememberMe=I,t.setCollection=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];null==w()||n||D(e,t)},t.setRefTokCookies=function(e,t){if(void 0===self.document)return;p.setCookie({name:"ref",value:e,path:y.PP_REF,domain:u.COOKIE_DOMAIN,secure:!0}),p.setCookie({name:"tok",value:t,path:y.PP_TOK,domain:u.COOKIE_DOMAIN,secure:!0})},t.setRememberMe=function(e){const t=!!e;if(t===I())return;__LOG__(2)`UserPrefs:setRememberMe: ${String(t)}`;const n=L();O(m.KEYS.REMEMBER_ME,t);const r=L();if(n!==r){(0,a.default)(Object.keys(n.dataStore),E.LS_ONLY_KEYS.concat(E.LS_PRESERVE_KEYS)).forEach((function(e){const t=n.getItem(e);null!=t&&(r.setItem(e,t),n.removeItem(e))}))}t||f.Logger.clearLogs()},t.updatePreservedUserKeys=function(){var e;const t=w(),n=null!==(e=M(m.KEYS.PRESERVED_USER_KEYS))&&void 0!==e?e:[];if(null!=t){const e=E.LS_PRESERVE_USER_KEYS.map((e=>(0,d.default)(U(t.toString(),e))));O(m.KEYS.PRESERVED_USER_KEYS,(0,o.default)(n,e))}};var i=r(n(48926)),a=r(n(91966)),o=r(n(93386)),s=r(n(17204)),l=r(n(2525)),c=r(n(7287)),d=r(n(11782)),u=n(57932),p=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=S(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(64418)),f=n(39948),h=r(n(45234)),_=r(n(24609)),g=r(n(78144)),m=n(72407),y=n(41601),E=n(70499);function S(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(S=function(e){return e?n:t})(e)}function v(){void 0!==self.document&&(p.setCookie({name:"ref",expirationDate:0,domain:u.COOKIE_DOMAIN,path:y.PP_REF}),p.setCookie({name:"tok",expirationDate:0,domain:u.COOKIE_DOMAIN,path:y.PP_TOK}))}function T(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return(0,c.default)(t,t.map((t=>e.getItem(t,n))))}function b(e,t){(0,l.default)(t,(function(t,n){e.setItem(n,t)}))}function C(){var e;const t=null!==(e=M(m.KEYS.PRESERVED_USER_KEYS))&&void 0!==e?e:[],n=[...E.LS_PRESERVE_KEYS,...t];return T(h.default,n,!0)}function A(){return T(_.default,E.TS_PRESERVE_KEYS,!0)}function P(){return(P=(0,i.default)((function*(){const e=C(),t=[_.default.clear(A()),h.default.clear(e)];t.push(f.Logger.clearLogs()),v(),yield Promise.all(t)}))).apply(this,arguments)}function M(e){return N(e,h.default)}function O(e,t){k(e,t,h.default)}function I(){let e=M(m.KEYS.REMEMBER_ME);const{isMDBackend:t}=n(88555);return t()&&!1===e&&(e=!0,O(m.KEYS.REMEMBER_ME,!0)),null===e&&(e=!0,O(m.KEYS.REMEMBER_ME,!0)),!!e}function w(){return n(99234).getMaybeMeUser()}function R(e){const t=w();if(!t)return __LOG__(3)`userPrefs: Me has not loaded yet.`,null;return N((0,d.default)(U(t.toString(),e)))}function D(e,t){const n=w();if(!n)return void __LOG__(3)`userPrefs: Me has not loaded yet.`;k((0,d.default)(U(n.toString(),e)),t)}function L(){return I()?h.default:_.default}function N(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:L(),n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(null==e)throw new Error("_get called with no key");const i=t.getItem(e,r);if(n||null==i)return i;try{return JSON.parse(i,g.default)}catch(n){return __LOG__(2,void 0,void 0,!0)`userPrefs:_get(${e}) '${n}' ${i}`,SEND_LOGS("userprefs-parse-error"),void t.removeItem(e)}}function k(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:L(),r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(null==e)throw new Error("_set called with no key");if(null==t)n.removeItem(e);else if(r){if("string"!=typeof t)throw new Error("_set: expecting string because isRawString is true");n.setItem(e,t)}else n.setItem(e,JSON.stringify(t),i)}function U(e,t){return[e,t].join(":")}},98250:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.clear=function(){h=void 0},t.get=function(){return(0,l.default)(h,"BUNDLE")},t.getBundle=function(){return h},t.getOrGenerate=function(){var e;if((null===(e=h)||void 0===e?void 0:e.key)&&h.keyPair)return(0,o.encodeB64)(h.key);const t=u.keyPair(),n=(0,o.encodeB64)(t.pubKey);return _({key:t.pubKey,keyPair:t,encKey:undefined,macKey:undefined}),n},t.getSecurityToken=function(){return g.apply(this,arguments)},t.load=function(){const e=function(){let e=c._get(d.KEYS.SECRET_BUNDLE);if(!e)return __LOG__(3)`UserPrefs:Attempted to load non-existent secret bundle!`,null;"string"==typeof e&&(e=JSON.parse(e));return(0,a.default)(e,o.decodeB64)}();if(!e)return __LOG__(2)`secret_bundle:load: attempted to load non-existent secret bundle!`,null;return _(e),e},t.save=function(){if(!h)return void __LOG__(2)`secret_bundle:save: trying to save empty secret bundle!`;delete h.keyPair,e=h,c._set(d.KEYS.SECRET_BUNDLE,(0,a.default)(e,o.encodeB64));var e},t.set=_,t.setSecretKeys=function(e,t,n){"0.1"===e?h&&t&&n?(h.encKey=t,h.macKey=n,h.key=n):__LOG__(3)`secret_bundle:setSecretKeys v${e} ${String(t)} ${String(n)}`:__LOG__(2)`secret_bundle:setSecretKeys unknown version: v${e}`};var i=r(n(48926)),a=r(n(66604)),o=n(15688),s=n(11141),l=r(n(45095)),c=f(n(53055)),d=n(72407),u=f(n(53614));function p(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(p=function(e){return e?n:t})(e)}function f(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=p(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}return r.default=e,n&&n.set(e,r),r}let h;function _(e){h=e}function g(){return(g=(0,i.default)((function*(e){if(!h)return __LOG__(3)`secret_bundle:getSecurityToken: no secret bundle`,Promise.reject(new Error("secret_bundle:getSecurityToken: no secret bundle"));const t=yield(0,s.hmacSha256)(h.key,new Uint8Array(e));return(0,o.encodeB64)(t)}))).apply(this,arguments)}},70499:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TS_PRESERVE_KEYS=t.LS_PRESERVE_USER_KEYS=t.LS_PRESERVE_KEYS=t.LS_ONLY_KEYS=void 0;var r=n(72407);const i=[r.KEYS.LOG_CURSOR,r.KEYS.WHATSAPP_MUTEX,r.KEYS.REMEMBER_ME,r.KEYS.WHATSAPP_LS_VERSION];t.LS_ONLY_KEYS=i;const a=[r.KEYS.LANG,r.KEYS.WHATSAPP_MUTEX,r.KEYS.REMEMBER_ME,r.KEYS.OLD_LOGOUT_CREDS,r.KEYS.MD_OPTED_IN,r.KEYS.PRESERVED_USER_KEYS,r.KEYS.THEME,r.KEYS.SYSTEM_THEME_MODE,r.KEYS.MD_INTERN_VERSION_STR];t.LS_PRESERVE_KEYS=a;const o=[r.KEYS.SHOW_MD_UPGRADE_COMPLETE_MSG,r.KEYS.FORCED_MD_UPGRADE_COMPLETE];t.TS_PRESERVE_KEYS=o;const s=[r.KEYS.EMOJI_VARIANT_COLLECTION,r.KEYS.RECENT_EMOJI_COLLECTION,r.KEYS.CHAT_PREFERENCE_COLLECTION,r.KEYS.GLOBAL_MUTE_NOTIFICATIONS,r.KEYS.OUTGOING_MESSAGE_SOUND,r.KEYS.GLOBAL_MUTE_PREVIEWS,r.KEYS.GLOBAL_COLLAPSE_MUTED,r.KEYS.GLOBAL_MUTE_SOUNDS,r.KEYS.AUTO_DOWNLOAD_PHOTOS,r.KEYS.AUTO_DOWNLOAD_VIDEOS,r.KEYS.AUTO_DOWNLOAD_AUDIO,r.KEYS.AUTO_DOWNLOAD_DOCUMENTS,r.KEYS.TOS_3];t.LS_PRESERVE_USER_KEYS=s},72441:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"asChatJid",{enumerable:!0,get:function(){return r.asChatJid}}),Object.defineProperty(t,"asMulticastJid",{enumerable:!0,get:function(){return r.asMulticastJid}}),Object.defineProperty(t,"asPhoneChatJid",{enumerable:!0,get:function(){return r.asPhoneChatJid}}),Object.defineProperty(t,"asStatusJid",{enumerable:!0,get:function(){return r.asStatusJid}}),Object.defineProperty(t,"authorAsUserJid",{enumerable:!0,get:function(){return r.authorAsUserJid}}),Object.defineProperty(t,"authorToUserId",{enumerable:!0,get:function(){return r.authorToUserId}}),t.defaultDeviceJidForUser=void 0,Object.defineProperty(t,"defaultLidDeviceJidForLidUserJid",{enumerable:!0,get:function(){return r.defaultLidDeviceJidForLidUserJid}}),Object.defineProperty(t,"defaultPhoneDeviceJidForUser",{enumerable:!0,get:function(){return r.defaultPhoneDeviceJidForUser}}),Object.defineProperty(t,"extractDeviceIDParts",{enumerable:!0,get:function(){return r.extractDeviceIDParts}}),Object.defineProperty(t,"extractDeviceId",{enumerable:!0,get:function(){return r.extractDeviceId}}),Object.defineProperty(t,"extractFromJid",{enumerable:!0,get:function(){return r.extractFromJid}}),Object.defineProperty(t,"extractJidFromJidWithType",{enumerable:!0,get:function(){return r.extractJidFromJidWithType}}),Object.defineProperty(t,"extractPhoneUserJid",{enumerable:!0,get:function(){return r.extractPhoneUserJid}}),Object.defineProperty(t,"extractUserId",{enumerable:!0,get:function(){return r.extractUserId}}),Object.defineProperty(t,"extractUserJid",{enumerable:!0,get:function(){return r.extractUserJid}}),Object.defineProperty(t,"fullFormDeviceJidString",{enumerable:!0,get:function(){return r.fullFormDeviceJidString}}),t.getGroupCallDomain=void 0,Object.defineProperty(t,"getGroupDomain",{enumerable:!0,get:function(){return r.getGroupDomain}}),Object.defineProperty(t,"getServerDomain",{enumerable:!0,get:function(){return r.getServerDomain}}),t.getUserDomain=void 0,Object.defineProperty(t,"groupIdFromJid",{enumerable:!0,get:function(){return r.groupIdFromJid}}),Object.defineProperty(t,"interpretAndValidateJid",{enumerable:!0,get:function(){return r.interpretAndValidateJid}}),Object.defineProperty(t,"interpretAsDeviceId",{enumerable:!0,get:function(){return r.interpretAsDeviceId}}),Object.defineProperty(t,"interpretAsGroupJid",{enumerable:!0,get:function(){return r.interpretAsGroupJid}}),Object.defineProperty(t,"interpretAsNumber",{enumerable:!0,get:function(){return r.interpretAsNumber}}),Object.defineProperty(t,"interpretAsPhoneUserJid",{enumerable:!0,get:function(){return r.interpretAsPhoneUserJid}}),Object.defineProperty(t,"interpretAsUserJid",{enumerable:!0,get:function(){return r.interpretAsUserJid}}),Object.defineProperty(t,"isPrimaryDevice",{enumerable:!0,get:function(){return r.isPrimaryDevice}}),Object.defineProperty(t,"maybeSanitizeLogLineText",{enumerable:!0,get:function(){return r.maybeSanitizeLogLineText}}),Object.defineProperty(t,"parseJidParts",{enumerable:!0,get:function(){return r.parseJidParts}}),Object.defineProperty(t,"phoneNumberFromJid",{enumerable:!0,get:function(){return r.phoneNumberFromJid}}),Object.defineProperty(t,"sanitizeJidForLogging",{enumerable:!0,get:function(){return r.sanitizeJidForLogging}}),Object.defineProperty(t,"stripAgentIdFromPhoneDeviceJid",{enumerable:!0,get:function(){return r.stripAgentIdFromPhoneDeviceJid}}),Object.defineProperty(t,"switchOnChatJidType",{enumerable:!0,get:function(){return r.switchOnChatJidType}}),Object.defineProperty(t,"switchOnJidType",{enumerable:!0,get:function(){return r.switchOnJidType}}),Object.defineProperty(t,"switchOnMsgrChatJidType",{enumerable:!0,get:function(){return r.switchOnMsgrChatJidType}}),Object.defineProperty(t,"switchOnMulticastJidType",{enumerable:!0,get:function(){return r.switchOnMulticastJidType}}),Object.defineProperty(t,"switchOnPhoneChatJidType",{enumerable:!0,get:function(){return r.switchOnPhoneChatJidType}}),Object.defineProperty(t,"switchOnPhoneJidType",{enumerable:!0,get:function(){return r.switchOnPhoneJidType}}),Object.defineProperty(t,"toBroadcastJid",{enumerable:!0,get:function(){return r.toBroadcastJid}}),t.toDeviceJid=void 0,Object.defineProperty(t,"toGroupJid",{enumerable:!0,get:function(){return r.toGroupJid}}),Object.defineProperty(t,"toPhoneDeviceJid",{enumerable:!0,get:function(){return r.toPhoneDeviceJid}}),Object.defineProperty(t,"toPhoneUserJid",{enumerable:!0,get:function(){return r.toPhoneUserJid}}),t.toUserJid=void 0,Object.defineProperty(t,"unsafeCoerceToDeviceId",{enumerable:!0,get:function(){return r.unsafeCoerceToDeviceId}}),Object.defineProperty(t,"unsafeCoerceToDeviceJid",{enumerable:!0,get:function(){return r.unsafeCoerceToDeviceJid}}),Object.defineProperty(t,"unsafeCoerceToGroupJid",{enumerable:!0,get:function(){return r.unsafeCoerceToGroupJid}}),Object.defineProperty(t,"unsafeCoerceToUserJid",{enumerable:!0,get:function(){return r.unsafeCoerceToUserJid}}),Object.defineProperty(t,"userIdFromJid",{enumerable:!0,get:function(){return r.userIdFromJid}});var r=n(52230);const i=(0,r.createJidUtils)({platform:"whatsapp"}),a=i.toUserJid;t.toUserJid=a;const o=i.toDeviceJid;t.toDeviceJid=o;const s=i.getUserDomain;t.getUserDomain=s;const l=i.getGroupCallDomain;t.getGroupCallDomain=l;const c=i.defaultDeviceJidForUser;t.defaultDeviceJidForUser=c},54602:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getErrorCodeFromLogoutReason=function(e){switch(e){case r.LogoutReason.ClientFatalError:return r.LOGOUT_REASON_CODE.CLIENT_FATAL;case r.LogoutReason.SyncdFailure:case r.LogoutReason.SyncdErrorDuringBootstrap:case r.LogoutReason.AccountSyncError:case r.LogoutReason.CriticalSyncTimeout:return r.LOGOUT_REASON_CODE.SYNC_FAIL;default:return null}},t.getPrevLogoutReasonCode=function(){return i},t.setPrevLogoutReasonCode=function(e){i=e};var r=n(83578);let i=null},63726:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PRODUCT_INQUIRY_TYPE=t.BIZ_SYSTEM_MSG_SUBTYPES_V2_INIT=t.BIZ_SYSTEM_MSG_SUBTYPES_V2=t.BIZ_SYSTEM_MSG_SUBTYPES=void 0;t.BIZ_SYSTEM_MSG_SUBTYPES=["blue_msg_bsp_fb_to_bsp_premise","blue_msg_bsp_fb_to_self_fb","blue_msg_bsp_fb_to_self_premise","blue_msg_bsp_fb_unverified","blue_msg_bsp_fb_unverified_to_bsp_premise_verified","blue_msg_bsp_fb_unverified_to_self_fb_verified","blue_msg_bsp_fb_unverified_to_self_premise_verified","blue_msg_bsp_fb_verified","blue_msg_bsp_fb_verified_to_bsp_premise_unverified","blue_msg_bsp_fb_verified_to_self_fb_unverified","blue_msg_bsp_fb_verified_to_self_premise_unverified","blue_msg_bsp_premise_to_self_premise","blue_msg_bsp_premise_unverified","blue_msg_bsp_premise_unverified_to_self_premise_verified","blue_msg_bsp_premise_verified","blue_msg_bsp_premise_verified_to_self_premise_unverified","blue_msg_consumer_to_bsp_fb_unverified","blue_msg_consumer_to_bsp_premise_unverified","blue_msg_consumer_to_self_fb_unverified","blue_msg_consumer_to_self_premise_unverified","blue_msg_self_fb_to_bsp_premise","blue_msg_self_fb_to_self_premise","blue_msg_self_fb_unverified","blue_msg_self_fb_unverified_to_bsp_premise_verified","blue_msg_self_fb_unverified_to_self_premise_verified","blue_msg_self_fb_verified","blue_msg_self_fb_verified_to_bsp_premise_unverified","blue_msg_self_fb_verified_to_self_premise_unverified","blue_msg_self_premise_to_bsp_premise","blue_msg_self_premise_unverified","blue_msg_self_premise_verified","blue_msg_to_bsp_fb","blue_msg_to_consumer","blue_msg_to_self_fb","blue_msg_unverified_to_bsp_fb_verified","blue_msg_unverified_to_bsp_premise_verified","blue_msg_unverified_to_self_fb_verified","blue_msg_unverified_to_verified","blue_msg_verified_to_bsp_fb_unverified","blue_msg_verified_to_bsp_premise_unverified","blue_msg_verified_to_self_fb_unverified","blue_msg_verified_to_unverified"];const n=["biz_privacy_mode_init_fb","biz_privacy_mode_init_bsp"];t.BIZ_SYSTEM_MSG_SUBTYPES_V2_INIT=n;const r=[...n,"biz_privacy_mode_to_fb","biz_privacy_mode_to_bsp"];t.BIZ_SYSTEM_MSG_SUBTYPES_V2=r;t.PRODUCT_INQUIRY_TYPE="product_inquiry"},58819:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){const[r]=e.source.errors||[];switch(null==r?void 0:r.code){case 2498052:case 2498049:case 2498050:case 2498051:case 2498053:case 2498056:return Promise.reject(new i.ServerStatusCodeError(400,e.message));case 2498048:return Promise.reject(new i.E451);case 2498054:return Promise.reject(new i.ServerStatusCodeError(421));case 2498055:default:return __LOG__(3)`GraphQL: Failed fetching ${n} query. Falling back to IQ.`,t()}};var i=n(92574);r(n(99805))},33049:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.COMPLIANCE_INFO_LENGTH=t.COMPLIANCE_INFO_CODES=void 0;t.COMPLIANCE_INFO_CODES={INDIA:"IN"};t.COMPLIANCE_INFO_LENGTH={ENTITY_NAME:1024,ENTITY_TYPE_CUSTOM:1024,EMAIL:256,GRIEVANCE_OFFICER_NAME:256,LANDLINE_NUMBER:20,MOBILE_NUMBER:20,IMPORTER_NAME:1024,STREET1:1024,STREET2:1024,CITY:1024,REGION:1024,POSTAL_CODE:12}},83657:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.scanComplianceInfoForMissingData=t.isBusinessCompliant=t.getGrievanceOfficerDetailsError=t.getEntityTypeText=t.getCustomerCareDetailsError=t.existsGrievanceOfficerDetailsContact=t.existsFieldIgnoreHardEnforcement=t.existsField=t.existsCustomerCareDetailsContact=void 0;var r=n(48360),i=n(93170),a=n(9978),o=n(57701);t.getEntityTypeText=e=>{const{entityType:t,entityTypeCustom:n,isRegistered:a}=e||{},o={[i.businessTypeOptions.limitedLiabilityPartnership]:r.fbt._("Limited liability partnership",null,{hk:"2dwmwU"}),[i.businessTypeOptions.soleProprietorship]:r.fbt._("Sole proprietorship",null,{hk:"2N7jks"}),[i.businessTypeOptions.partnership]:r.fbt._("Partnership",null,{hk:"ZeckL"}),[i.businessTypeOptions.publicCompany]:r.fbt._("Public Company",null,{hk:"1YuMvC"}),[i.businessTypeOptions.privateCompany]:r.fbt._("Private Company",null,{hk:"WL0uU"}),[i.businessTypeOptions.other]:r.fbt._("Other",null,{hk:"3zua5D"})},s=n||o[t]||"";if(!s)return"";let l="";return[i.businessTypeOptions.partnership,i.businessTypeOptions.other].includes(t)&&(l=a?r.fbt._("Registered Business",null,{hk:"3N1x9I"}):r.fbt._("Not Registered Business",null,{hk:"2zDsuK"})),`${s.toString()}${l?` (${l.toString()})`:""}`};const s=(e,t)=>!(!e&&!t),l=e=>!!(null==e?void 0:e.trim());t.existsFieldIgnoreHardEnforcement=l;const c=(e,t)=>!(0,o.canSeeECommerceComplianceIndiaHardEnforcementBusinessJourney)(t.user)||l(e);t.existsField=c;const d=(e,t,n,r,i)=>!(0,o.canSeeECommerceComplianceIndiaHardEnforcementBusinessJourney)(t.user)||n.some((t=>l(t===r?i:null==e?void 0:e[t]))),u=(e,t,n,r)=>d(e,t,["mobileNumber","landlineNumber"],n,r);t.existsCustomerCareDetailsContact=u;const p=(e,t,n,r)=>d(e,t,["mobileNumber","landlineNumber","email"],n,r);t.existsGrievanceOfficerDetailsContact=p;t.isBusinessCompliant=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;if(!(0,o.canSeeECommerceComplianceIndiaHardEnforcementBusinessJourney)(n.user))return!0;if(!t)return!1;const{entityName:r,entityType:i,entityTypeCustom:a,customerCareDetails:l,grievanceOfficerDetails:d}=t;return[e,r,null==l?void 0:l.email,null==d?void 0:d.name].every((e=>c(e,n)))&&s(i,a)&&u(l,n)&&p(d,n)};t.getCustomerCareDetailsError=(e,t,n,r,i)=>u(e,i,t,n)?r:"";t.getGrievanceOfficerDetailsError=(e,t,n,r,i)=>p(e,i,t,n)?r:"";t.scanComplianceInfoForMissingData=e=>{const t=(null==e?void 0:e.countryCodeOrigin)===String(a.SyntheticCountryCode.NotApplicable),n=!t&&void 0!==(null==e?void 0:e.countryCodeOrigin),r=!t&&void 0!==(null==e?void 0:e.importerName);return{isExempt:t,hasImporterAddress:!t&&void 0!==(null==e?void 0:e.importerAddress)&&[e.importerAddress.street1,e.importerAddress.street2,e.importerAddress.city,e.importerAddress.region,e.importerAddress.postalCode,e.importerAddress.countryCode].some((e=>e)),hasImporterName:r,hasCountryCodeOrigin:n}}},30155:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.cypherStringToString=function(e){return e},t.genCypher=function(){return o.apply(this,arguments)},t.stringToCypherString=function(e){return e};var i=r(n(48926)),a=n(52542);function o(){return(o=(0,i.default)((function*(e,t,n){try{const{subtle:r}=yield(0,a.getEngine)(),i=yield r.generateKey({name:"AES-GCM",length:256},!0,["encrypt"]),o=(0,a.arrayBufferToBase64)(yield r.encrypt({name:"AES-GCM",iv:new Uint8Array((0,a.base64ToArrayBuffer)(t)),tagLength:128},i,(0,a.stringToArrayBuffer)(JSON.stringify(n)))),s=yield r.exportKey("raw",i);return`AesKey=${yield(0,a.encryptWithPublicKey)(e,s)};IV=${t};Data=${o}`}catch(e){return __LOG__(3)`[direct-connection] cypher creation failed with ${e.toString()}`,null}}))).apply(this,arguments)}},90915:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.enablePostcodeInCatalog=function(){if((0,a.isMDBackend)())return(0,l.getABPropConfigValue)("web_abprop_direct_connection_md");return!1},t.genDirectConnectionMessageModifiers=function(){return y.apply(this,arguments)},t.supportsDirectConnection=_;var i=r(n(48926)),a=n(88555),o=n(15461),s=n(45454),l=n(57849),c=n(56149),d=n(24808),u=n(64551);function p(){return((0,c.getBusinessProfileQueryVersion)()&c.DIRECT_CONNECTION_FLAG)>0}function f(){return u.ServerProps.isDirectConnectionForPLMTransparent&&((0,a.isLegacyWebdBackend)()||!(0,l.getABPropConfigValue)("web_abprop_direct_connection_md"))}function h(e,t){return e===o.MSG_TYPE.LIST&&t===d.Message$ListMessageListType.PRODUCT_LIST}function _(){return(0,a.isMDBackend)()?(0,l.getABPropConfigValue)("web_abprop_direct_connection_md"):f()}function g(){return m.apply(this,arguments)}function m(){return(m=(0,i.default)((function*(e,t,r){var i;if(f()||!h(e,t)||!r)return!1;if(!p())return __LOG__(3)`[direct-connection] This web client cannot detect if the product list message recevied is coming from a direct connection business`,"unknown";const a=(0,s.createWid)(r),{BusinessProfileCollection:o}=n(93581);let l=o.get(a);return l&&l.profileOptions||(l=yield o.find(a)),(null===(i=l.profileOptions)||void 0===i?void 0:i.directConnection)||!1}))).apply(this,arguments)}function y(){return(y=(0,i.default)((function*(e,t,n){const r=yield g(e,t,n);return!0!==r||_()?{requiresDirectConnection:r}:{requiresDirectConnection:r,type:o.MSG_TYPE.UNKNOWN,subtype:"phone_only_feature"}}))).apply(this,arguments)}},52542:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.arrayBufferToBase64=f,t.arrayBufferToString=_,t.base64ToArrayBuffer=p,t.certificateStringToString=function(e){return e},t.encodeToString=function(e){return e.map((e=>{const t=f(e.toSchema(!0).toBER(!1)).split(/(.{0,64})/g).filter((e=>""!==e)).join("\n");return`${s}\n${t}\n${l}`})).join("\n")},t.encryptWithPublicKey=function(){return O.apply(this,arguments)},t.extractCertificates=S,t.fetchFromCABundle=function(){return E.apply(this,arguments)},t.genRootIssuers=function(){return b.apply(this,arguments)},t.getCommonName=C,t.getEngine=A,t.getRandomValues=function(){return M.apply(this,arguments)},t.stringToArrayBuffer=h,t.stringToCertificateString=function(e){return e},t.validateCertificates=function(){return T.apply(this,arguments)};var i=r(n(48926)),a=r(n(57291)),o=n(29595);const s="-----BEGIN CERTIFICATE-----",l="-----END CERTIFICATE-----",c=`(?:${s})((?:.|\n)*?)(?:${l})`;function d(){return n.e(6352).then(n.bind(n,63008))}function u(){return n.e(6352).then(n.bind(n,65267))}function p(e){let t="";try{t=atob(e)}catch(e){__LOG__(3)`[direct-connection] base64 decoding failed with ${e.toString()}`}return h(t)}function f(e){return btoa(_(e))}function h(e){const t=e.length,n=new Uint8Array(t);for(let r=0;r<t;r++)n[r]=e.charCodeAt(r);return n.buffer}function _(e){return String.fromCharCode(...Array.from(new Uint8Array(e)))}function g(){return m.apply(this,arguments)}function m(){return(m=(0,i.default)((function*(e,t){const{CertificateChainValidationEngine:n}=yield d();return new n({trustedCerts:t,certs:e})}))).apply(this,arguments)}function y(e,t){return e.flat().reduce(((e,n)=>e.every((e=>!(0,o.isEqualBuffer)(e.tbs,n.tbs)))&&t.includes(n)?[...e,n]:e),[])}function E(){return(E=(0,i.default)((function*(){const{CA_BUNDLE:e}=yield n.e(239).then(n.bind(n,19477));return S(e)}))).apply(this,arguments)}function S(){return v.apply(this,arguments)}function v(){return(v=(0,i.default)((function*(e){const{Certificate:t}=yield d(),{fromBER:n}=yield u();return(0,a.default)(Array.from(e.matchAll(new RegExp(c,"gm"))).map((e=>{let[r,i]=e;const{result:a}=n(p(i));let o;try{o=a.error?null:new t({schema:a})}catch(e){__LOG__(3)`[direct-connection] certificate chain parsing from Get Public Key IQ failed with ${e.toString()}`}return o})))}))).apply(this,arguments)}function T(){return(T=(0,i.default)((function*(e,t){return(yield g(e,t)).verify()}))).apply(this,arguments)}function b(){return(b=(0,i.default)((function*(e,t){const n=yield g(e,t),r=y(yield Promise.all(e.map((e=>n.findIssuer(e,n)))),t);return 0===r.length?(__LOG__(3)`[direct-connection] no trusted root certificates could be found for ${C(e[0])}`,null):r}))).apply(this,arguments)}function C(e){var t;return null===(t=e.issuer.typesAndValues.find((e=>{let{type:t}=e;return"2.5.4.3"===t})))||void 0===t?void 0:t.value.valueBlock.value}function A(){return P.apply(this,arguments)}function P(){return(P=(0,i.default)((function*(){const{getEngine:e}=yield d();return e()}))).apply(this,arguments)}function M(){return(M=(0,i.default)((function*(e){const{getRandomValues:t}=yield d();return t(e)}))).apply(this,arguments)}function O(){return(O=(0,i.default)((function*(e,t){const n=yield e.getPublicKey({algorithm:{algorithm:{name:"RSA-OAEP",hash:{name:"SHA-256"}},usages:["encrypt"]}}),r=yield A();return f(yield r.subtle.encrypt({name:"RSA-OAEP"},n,t))}))).apply(this,arguments)}},37899:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.formatInteractive=function(e){var t,n;let{formatAsSearchResult:r=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var i;if(e.interactiveType===a.default.SHOPS_STOREFRONT)return e.caption||(null===(i=e.interactiveHeader)||void 0===i?void 0:i.title)||"";if(e.nativeFlowName===o.default.ORDER_DETAILS){const t=c(e);if(null!=t)return t}return[null===(t=e.interactiveHeader)||void 0===t?void 0:t.title,r?null===(n=e.interactiveHeader)||void 0===n?void 0:n.subtitle:null,e.caption,e.footer].filter(Boolean).join("\n")},t.formatOrderDetailsMessagePreview=c;var i=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=l(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(39519)),a=r(n(84064)),o=r(n(5165)),s=n(34841);function l(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(l=function(e){return e?n:t})(e)}function c(e){const t=(0,s.getOrderInfo)(e);if(null==t)return null;const{items:n,totalAmount:r,currency:a}=t,o=i.formatAmount(a,r);return n[0].name+"  "+o}},59802:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LabelItemParentType=void 0;const r=n(76672).Mirrored(["Chat","Contact","Msg"]);t.LabelItemParentType=r},35389:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addToLabelCollection=a,t.createLabelItemId=s,t.getParentCollection=function(e){switch(e){case i.LabelItemParentType.Chat:return n(69951).ChatCollection;case i.LabelItemParentType.Contact:return n(19380).ContactCollection;case i.LabelItemParentType.Msg:return n(59871).MsgCollection}},t.getParentTypeFromModel=o,t.initializeLabels=function(e){const t=o(e);if((0,r.isMDBackend)())e.labels=n(16770).LabelCollection.getLabelsForModel(e.id.toString(),t);else{const n=()=>{a(e.id.toString(),e.labels,t)};n(),e.listenTo(e,"change:labels",n)}},t.removeLabelFromCollection=function(e,t,a){const o=n(16770).LabelCollection.get(t),l=null==o?void 0:o.labelItemCollection;if(!l)return void __LOG__(3)`labelItemCollection does not exist for lableId ${t}`;l.remove(s(e,t,a)),(0,r.isMDBackend)()&&a===i.LabelItemParentType.Chat&&l.remove(s(e,t,i.LabelItemParentType.Contact))};var r=n(88555),i=n(59802);function a(e,t,a){if(t&&t.length>0){const o=n(16770).LabelCollection;t.forEach((t=>{const n=o.gadd({id:t});n.labelItemCollection.gadd({id:s(e,t,a),labelId:t,parentId:e,parentType:a}),(0,r.isMDBackend)()&&a===i.LabelItemParentType.Chat&&n.labelItemCollection.gadd({id:s(e,t,i.LabelItemParentType.Contact),labelId:t,parentId:e,parentType:i.LabelItemParentType.Contact})}))}}function o(e){if(e instanceof n(63183).Chat)return i.LabelItemParentType.Chat;if(e instanceof n(121).default)return i.LabelItemParentType.Contact;if(e instanceof n(17304).Msg)return i.LabelItemParentType.Msg;throw new Error("getParentTypeFromModel: model is invalid")}function s(e,t,n){return`${e}_${t}_${n}`}},45218:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parse=function(e){return JSON.parse(e)},t.stringify=function(e){return JSON.stringify(e)}},26316:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.businessHoursFromConfig=d,t.dayToWeekday=c,t.getBusinessHours=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const{config:n}=e,r=(new Date).getDay(),i=o.DAYS_OF_WEEK.map(((e,i)=>{const a=(r+i)%o.DAYS_OF_WEEK.length,s=o.DAYS_OF_WEEK[a];return{day:c(a),hours:d(n[s],t).toString(),first:0===i}}));return i},t.getBusinessHoursForEdit=function(e){const t=null==e?{}:e.config,{note:n,timezone:r}=e||{};let i;const s=o.DAYS_OF_WEEK.map(((e,n)=>{const r=t[e],o=a.default.weekdays(n);let s;return r&&(i=r.mode,r.hours&&(s=r.hours.map((e=>{let[t,n]=e;return[(0,l.minutesToTime)(t),(0,l.minutesToTime)(n)]})))),{dayName:o,dayKey:e,closed:!r,hours:s}})),c=a.default.weekdays(!0,0),d=a.default.weekdays().indexOf(c),u=s.splice(d);return{mode:i,days:[...u,...s],timezone:r,note:n}},t.getWebsiteLink=function(e){return`https://l.wl.co/l?u=${encodeURIComponent(e)}`};var i=n(48360),a=r(n(30381)),o=n(93170),s=r(n(14296)),l=n(78600);function c(e){return a.default.weekdays(e)}function d(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];switch(null==e?void 0:e.mode){case o.BUSINESS_HOUR_MODES.SPECIFIC_HOURS:return t?p(null==e?void 0:e.hours):u(null==e?void 0:e.hours);case o.BUSINESS_HOUR_MODES.APPOINTMENT_ONLY:return i.fbt._("By appointment only",null,{hk:"e1vew"});case o.BUSINESS_HOUR_MODES.OPEN_24H:return i.fbt._("Open 24 hours",null,{hk:"1AlfF5"});default:return i.fbt._("Closed",null,{hk:"3IRgct"})}}function u(e){return e?e.map((e=>e.map(l.minutesToTime).join(" - "))).join("\n"):""}function p(e){if(1===(null==e?void 0:e.length))return e[0].map(l.minutesToTime).join(" - ");if(2===(null==e?void 0:e.length)){const t=(0,l.minutesToTime)(e[0][0]),n=(0,l.minutesToTime)(e[0][1]),r=(0,l.minutesToTime)(e[1][0]),i=(0,l.minutesToTime)(e[1][1]);return s.default.t(240,{openTime:t,closeTime:n,additionalOpenTime:r,additionalCloseTime:i})}return""}},78600:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.minutesToTime=function(e){return a.default.utc().startOf("day").add(e,"minutes").format(i.Clock.timestampStrFormat())},t.timeStringToMinutes=void 0;var i=n(40234),a=r(n(30381));const o=["h:mm A","h:mmA","HH:mm","HH.mm","H:mm","H.mm"];t.timeStringToMinutes=e=>{let t;const n=e.trim();if(!n)return;for(const e of o){const r=(0,a.default)(n,e,!0);if(r.isValid()){t=r;break}}if(!t)return;const r=t,i=(0,a.default)().startOf("day"),s=r.diff(i);return a.default.duration(s).asMinutes()}},50974:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){switch(e){case r.VERIFIED_LEVEL.HIGH:return"high";case r.VERIFIED_LEVEL.LOW:return"low";case r.VERIFIED_LEVEL.UNKNOWN:default:return"unknown"}};var r=n(93170)},57932:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.COOKIE_DOMAIN=void 0;t.COOKIE_DOMAIN=".web.whatsapp.com"},64418:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.deleteCookie=function(e){document.cookie=e+"=; expires=Thu, 01 Jan 1970 00:00:01 GMT;"},t.getCookie=function(e){const t=document.cookie.match(new RegExp("(^| )"+e+"=([^;]+)"));return t?t[2]:void 0},t.setCookie=function(e){e.session&&delete e.expirationDate;const t=[];["name","value","domain","path","secure","session","expirationDate"].forEach((n=>{const r=e[n];if(void 0!==r&&"value"!==n)switch(n){case"expirationDate":const i=new Date(e.expirationDate);t.push(`expires=${i.toUTCString()}`);break;case"secure":t.push("secure");break;case"name":const a=e.value||"";t.push(`${String(r)}=${a}`);break;default:t.push(`${n}=${String(r)}`)}})),document.cookie=t.join(";")}},92574:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebdDrop=t.ServerStatusCodeError=t.Server5xxDrop=t.LogoutDrop=t.EphemeralDrop=t.E507=t.E499=t.E451=t.E404=t.E401=t.ConventionViolationDrop=t.CatalogEditServerError=t.BrowserReplacedDrop=void 0,t.attachErrorLogger=function(e,t,n){return e.catch((e=>{throw __LOG__(4,!0,new Error,!0)`${n||t}, error: ${e}`,SEND_LOGS(t),e}))};var r=n(40265);class i extends((0,r.customError)("ServerStatusCodeError")){constructor(e,t){super(t),this.status=e,this.statusCode=e}}t.ServerStatusCodeError=i;class a extends((0,r.customError)("ServerStatusCodeError")){constructor(e,t,n){super(n),this.errors=t,this.status=e,this.statusCode=e}}t.CatalogEditServerError=a;class o extends((0,r.customError)("E451",!0,i)){constructor(){super(451,"commerce features disabled")}}t.E451=o;class s extends((0,r.customError)("E401",!0,i)){constructor(e){super(401,e)}}t.E401=s;class l extends((0,r.customError)("E404",!0,i)){constructor(e){super(404,e)}}t.E404=l;class c extends((0,r.customError)("E499",!0,i)){constructor(e){super(499,e)}}t.E499=c;class d extends((0,r.customError)("E507",!0,i)){constructor(e,t){super(507,e),this.backoff=Number.isNaN(t)?null:t}}t.E507=d;class u extends((0,r.customError)("WebdDrop")){}t.WebdDrop=u;class p extends((0,r.customError)("BrowserReplacedDrop",!0,u)){}t.BrowserReplacedDrop=p;class f extends((0,r.customError)("ConventionViolationDrop",!0,u)){}t.ConventionViolationDrop=f;class h extends((0,r.customError)("Server5xxDrop",!0,u)){}t.Server5xxDrop=h;class _ extends((0,r.customError)("LogoutDrop",!0,u)){}t.LogoutDrop=_;class g extends((0,r.customError)("EphemeralDrop",!0,u)){}t.EphemeralDrop=g},35232:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateImmediately=t.Unmount=t.UnableToPlayVideoError=t.UnableToGetContentLengthError=t.TranscodeBlobTooLargeError=t.SourceUnavailableError=t.SocketNotOpen=t.SocketError=t.SocketClosed=t.ShouldLoop=t.ServerStatusError=t.QueryDrop=t.ProtoVersionUndefined=t.OverconstrainedError=t.Offline=t.NotSupportedError=t.NotFoundError=t.NotAllowedError=t.ModelError=t.ModelCreateError=t.MediaUnsupportedError=t.MediaNeedsReupload=t.MediaMissing=t.MediaLoadError=t.MediaFileFailedLoad=t.MediaFileError=t.MediaFileEmpty=t.MediaEncryptionError=t.MediaDragDropError=t.MediaDecryptionError=t.InvalidServerResponseError=t.InvalidMediaFileType=t.InvalidImageFileType=t.ImageError=t.GaveUpRetry=t.GUMError=t.GUM=t.FileNotReadableError=t.EncodeWebpError=t.Disconnected=t.DeprecatedProtocolVersion=t.DecodeWebpResultsError=t.DbOnLogoutAbort=t.DbMsgEncKeyNotLoaded=t.DbEncKeyNotLoaded=t.DBInvalidFtsHMACKey=t.ConstraintNotSatisfiedError=t.CatalogImageDownloadError=t.CapabilityUnknown=t.CapabilityInvalid=t.CapabilityError=t.CanNotSendUnencrypted=t.BlockedByProxy=t.BingServerError=t.ActiveChatChanged=t.ActionError=void 0;var r=n(40265);class i extends((0,r.customError)("QueryDrop")){}t.QueryDrop=i;class a extends((0,r.customError)("Disconnected")){}t.Disconnected=a;class o extends((0,r.customError)("Offline")){}t.Offline=o;class s extends((0,r.customError)("ShouldLoop")){}t.ShouldLoop=s;class l extends((0,r.customError)("GaveUpRetry")){}t.GaveUpRetry=l;class c extends((0,r.customError)("CatalogImageDownloadError")){}t.CatalogImageDownloadError=c;class d extends((0,r.customError)("MediaFileError")){}t.MediaFileError=d;class u extends((0,r.customError)("InvalidImageFileType",!0,d)){}t.InvalidImageFileType=u;class p extends((0,r.customError)("InvalidMediaFileType",!0,d)){}t.InvalidMediaFileType=p;class f extends((0,r.customError)("MediaEncryptionError",!0,d)){}t.MediaEncryptionError=f;class h extends((0,r.customError)("MediaDecryptionError",!0,d)){}t.MediaDecryptionError=h;class _ extends((0,r.customError)("MediaFileFailedLoad",!0,d)){}t.MediaFileFailedLoad=_;class g extends((0,r.customError)("MediaFileEmpty",!0,d)){}function m(e){try{return JSON.stringify(e)}catch(t){return e.toString()}}t.MediaFileEmpty=g;class y extends((0,r.customError)("SocketError")){constructor(e){super("string"==typeof e?e:m(e)),this.event=e}}t.SocketError=y;class E extends((0,r.customError)("SocketClosed")){constructor(e){super("string"==typeof e?e:m(e)),this.event=e}}t.SocketClosed=E;class S extends((0,r.customError)("SocketNotOpen")){constructor(e){super(`socket not open, is ${e}`)}}t.SocketNotOpen=S;class v extends((0,r.customError)("BlockedByProxy")){}t.BlockedByProxy=v;class T extends((0,r.customError)("ImageError")){constructor(e,t){super("Image failed to load."),this.src=e,this.status=t,this.target={src:e,status:t}}}t.ImageError=T;class b extends((0,r.customError)("DecodeWebpResultsError")){constructor(e,t){super(e),this.event=t}}t.DecodeWebpResultsError=b;class C extends((0,r.customError)("DecodeWebpError")){constructor(e,t){super(e),this.event=t}}t.EncodeWebpError=C;class A extends((0,r.customError)("ServerStatusError")){constructor(e,t,n){super(`${e||"Server replied with a failed status code"}: ${n}`),this.url=t,this.status=n}}t.ServerStatusError=A;class P extends((0,r.customError)("InvalidServerResponseError")){constructor(e,t,n){let r=`Invalid response for ${e}, with status ${t}`;n&&(r=`${r}: ${n}`),super(r)}}t.InvalidServerResponseError=P;class M extends((0,r.customError)("BingServerError",!0,A)){constructor(e,t,n){super(`Error ${t} for ${e}: ${JSON.stringify(n)}`,e,t)}}t.BingServerError=M;class O extends((0,r.customError)("MediaNeedsReupload")){}t.MediaNeedsReupload=O;class I extends((0,r.customError)("MediaMissing")){}t.MediaMissing=I,I.message="Media is no longer available on your phone";class w extends((0,r.customError)("FileNotReadableError",!0,Error)){}t.FileNotReadableError=w;class R extends((0,r.customError)("MediaLoadError")){constructor(e){super(e),this.src=e}}t.MediaLoadError=R;class D extends((0,r.customError)("TranscodeBlobTooLargeError")){constructor(){super("Transcode blob too large")}}t.TranscodeBlobTooLargeError=D;class L extends((0,r.customError)("UnableToPlayVideoError")){constructor(e){super(`Unable to play video. Reason: ${String(e)}`)}}t.UnableToPlayVideoError=L;class N extends((0,r.customError)("MediaDragDropError",!0,R)){}t.MediaDragDropError=N;class k extends((0,r.customError)("MediaUnsupportedError")){}t.MediaUnsupportedError=k,k.message="Media format is unsupported";class U extends((0,r.customError)("ModelError")){}t.ModelError=U;class G extends((0,r.customError)("ModelCreateError")){constructor(e,t){super(e),this.model=t}}t.ModelCreateError=G;class x extends((0,r.customError)("DbEncKeyNotLoadedError")){constructor(e){super(`MasterDatabaseEncryptionKey.${e} was accessed before init`)}}t.DbEncKeyNotLoaded=x;class B extends((0,r.customError)("DbMsgEncKeyNotLoadedError")){constructor(e){super(`MasterDatabaseMessageEncryptionKey.${e} was accessed before init`)}}t.DbMsgEncKeyNotLoaded=B;class F extends((0,r.customError)("DbOnLogoutAbortError")){}t.DbOnLogoutAbort=F,F.message="DB operation was dropped due to logout activity";class j extends((0,r.customError)("DBExpiredFtsHMACKey")){}t.DBInvalidFtsHMACKey=j,j.message="MasterDatabaseEncryptionKey.fts_hmac_keys is in an invalid state";class Y extends((0,r.customError)("ProtoVersionUndefined")){}t.ProtoVersionUndefined=Y;class K extends((0,r.customError)("UpdateImmediately")){}t.UpdateImmediately=K;class W extends((0,r.customError)("DeprecatedProtocolVersion")){}t.DeprecatedProtocolVersion=W;class H extends((0,r.customError)("CapabilityError")){}t.CapabilityError=H;class V extends((0,r.customError)("CapabilityInvalid",!0,H)){}t.CapabilityInvalid=V;class $ extends((0,r.customError)("CapabilityUnknown",!0,H)){}t.CapabilityUnknown=$;class z extends((0,r.customError)("CanNotSendUnencrypted")){}t.CanNotSendUnencrypted=z;class q extends((0,r.customError)("ActionError")){}t.ActionError=q,q.message="Could not perform action.";class J extends((0,r.customError)("Unmount")){}t.Unmount=J;class Q extends((0,r.customError)("ActiveChatChanged")){}t.ActiveChatChanged=Q;class X extends((0,r.customError)("GUMError")){}t.GUMError=X;class Z extends((0,r.customError)("NotSupportedError",!0,X)){}t.NotSupportedError=Z,Z.message="The operation is not supported.";class ee extends((0,r.customError)("NotAllowedError",!0,X)){}t.NotAllowedError=ee,ee.message="The user did not grant permission for the operation";class te extends((0,r.customError)("ConstraintNotSatisfiedError",!0,X)){}t.ConstraintNotSatisfiedError=te,te.message="One of the mandatory Constraints could not be satisfied.";class ne extends((0,r.customError)("OverconstrainedError",!0,X)){}t.OverconstrainedError=ne,ne.message="Due to changes in the environment, one or more mandatory constraints can no longer be satisfied.";class re extends((0,r.customError)("NotFoundError",!0,X)){}t.NotFoundError=re,re.message="The object can not be found here.";class ie extends((0,r.customError)("SourceUnavailableError",!0,X)){}t.SourceUnavailableError=ie,ie.message="The source of the MediaStream could not be accessed due to a hardware error (e.g. lock from another process).";class ae extends((0,r.customError)("UnableToGetContentLengthError")){}t.UnableToGetContentLengthError=ae,ae.message="Failed to get media contentLength from mms";const oe={GUMError:X,NotSupportedError:Z,NotAllowedError:ee,ConstraintNotSatisfiedError:te,OverconstrainedError:ne,NotFoundError:re,SourceUnavailableError:ie};t.GUM=oe},81806:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.normalizeError=s,t.normalizeStack=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const{name:n,message:r,stack:i}=s(e),a=i.indexOf("\n"),l=i.slice(0,a),c=l.match(new RegExp(`(${(0,o.default)(n)}|Error)(:|$)`));if(null!=c){if(!t)return i;const e=c.index+c[0].length,n=null==r?-1:i.indexOf(r,e),o=null==r||-1===n?-1:n+r.length,s=Math.max(0,a,e,o);return i.slice(s).replace(/^\n+/,"")}if(t)return i;const d=""===i?"":`\n${i}`;return r?`${n}: ${r}${d}`:`${n}${d}`};var i=r(n(81109)),a=r(n(48403)),o=r(n(3522));function s(e){const t="object"==typeof e&&"string"==typeof(null==e?void 0:e.name)?e.name:`Thrown${(0,a.default)(typeof e)}Error`;let n,r;if(n=null!=e&&"string"==typeof e.message?e.message:void 0===e?"":String(e),null!=e&&"string"==typeof e.stack)r=e.stack;else{const e=new Error;e.name=t,e.message=n,r="string"==typeof e.stack?e.stack:""}const o="object"==typeof e?(0,i.default)({},e):null;return(0,i.default)((0,i.default)({},o),{},{name:t,message:n,stack:r})}},34475:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=(0,a.normalizeError)(e),{name:n,message:r,stack:s}=t,l=(0,i.default)(t,o),c=(0,a.normalizeStack)(e,!0),d=0===Object.keys(l).length?"":" "+JSON.stringify(l,((e,t)=>e&&"object"==typeof t?String(t):t));return`${n} - ${r||""}${d}\n${c}`};var i=r(n(6479)),a=n(81806);const o=["name","message","stack"]},76521:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(73955)),a=r(n(41609)),o=r(n(51463));const s=/\s+/;t.default=class{on(e,t,n){if(!t)return this;if("function"!=typeof t)throw new Error("Callback parameter passed is not a function");return this._multiEvent(this.on,...arguments)||this._getOrCreateEvents(e).push({callback:t,context:n,ctx:n||this}),this}once(e,t,n){if(!t)return this;if(this._multiEvent(this.once,...arguments))return this;const r=this,i=(0,o.default)((function(){r.off(e,i),t.apply(this,arguments)}));return i._callback=t,this.on(e,i,n)}off(e,t,n){const r=this._events;if(!r)return this;if(this._multiEvent(this.off,...arguments))return this;if(!e&&!t&&!n)return this._events=void 0,this;const i=e?[e]:Object.keys(r);for(let e=0;e<i.length;e++){const a=i[e],o=r[a];if(o){if(r[a]=[],t||n)for(let e=0;e<o.length;e++){const i=o[e];(t&&t!==i.callback&&t!==i.callback._callback||n&&i.context!==n)&&r[a].push(i)}r[a].length||delete r[a]}}return this}trigger(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];if(!this._events)return this;if(this._multiEvent(this.trigger,...arguments))return this;const i=this._getEvents(e),a=this._getEvents("all");return i&&this._triggerEvents(i,n),a&&this._triggerEvents(a,arguments),this}stopListening(e,t,n){const r=this._listeningTo;if(!r)return this;const i=null==e?void 0:e._listenId,o=i?{[i]:e}:r;for(const e in o){const i=o[e];i.off(t,n,this),(!t&&!n||(0,a.default)(i._events))&&delete r[e]}return(0,a.default)(this._listeningTo)&&delete this._listeningTo,this}listenTo(e,t,n){return n?(this._addListeningTo(e),e.on(t,n,this),this):this}listenToOnce(e,t,n){return this._addListeningTo(e),e.once(t,n,this),this}listenToAndRun(e,t,n){return this.listenTo.apply(this,arguments),n.apply(this),this}isListening(e){const t=this._events;return!!t&&("string"==typeof e?!!t[e]:(0,a.default)(t))}_addListeningTo(e){(this._listeningTo||(this._listeningTo={}))[e._listenId||(e._listenId=(0,i.default)("l"))]=e}_getOrCreateEvents(e){const t=this._events||(this._events={});return t[e]||(t[e]=[])}_getEvents(e){if(!e)return;const t=this._events;return t?t[e]:void 0}_multiEvent(e,t){if(s.test(t)){const a=t.split(s);for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];for(let t=0;t<a.length;t++)e.call(this,a[t],...r);return!0}return!1}_triggerEvents(e,t){let n,r=-1;const i=e.length,a=t[0],o=t[1],s=t[2];switch(t.length){case 0:for(;++r<i;)(n=e[r]).callback.call(n.ctx);return;case 1:for(;++r<i;)(n=e[r]).callback.call(n.ctx,a);return;case 2:for(;++r<i;)(n=e[r]).callback.call(n.ctx,a,o);return;case 3:for(;++r<i;)(n=e[r]).callback.call(n.ctx,a,o,s);return;default:for(;++r<i;)(n=e[r]).callback.apply(n.ctx,t)}}bind(){return this.on(...arguments)}unbind(){return this.off(...arguments)}removeListener(){return this.off(...arguments)}removeAllListeners(){return this.off()}emit(){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return this.trigger(arguments)}}},35609:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,i){if(null==i?void 0:i.aborted)return Promise.reject(new r.AbortError);let a,o;const s=n;return new Promise((function(n,l){if(a=s?function(){s.apply(this,arguments)&&n(arguments)}:function(){n(arguments)},i){const e=()=>{var e;null===(e=o)||void 0===e||e(),l(new r.AbortError)};i.addEventListener("abort",e),o=()=>{i.removeEventListener("abort",e),o=null}}e.on(t,a)})).cancellable().finally((function(){var n;e.off(t,a),null===(n=o)||void 0===n||n()}))};var r=n(89385)},9896:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,i){if(null==i?void 0:i.aborted)return Promise.reject(new r.AbortError);let a,o;const s=n;return new Promise((function(n,l){var c;if(a=s?function(){s.apply(this,arguments)&&n.apply(this,arguments)}:n,i){const e=()=>{var e;null===(e=o)||void 0===e||e(),l(new r.AbortError)};i.addEventListener("abort",e),o=()=>{i.removeEventListener("abort",e),o=null}}null===(c=e.addEventListener)||void 0===c||c.call(e,t,a)})).cancellable().finally((function(){var n,r;null===(n=e.removeEventListener)||void 0===n||n.call(e,t,a),null===(r=o)||void 0===r||r()}))};var r=n(89385)},60723:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){if(i.Cmd.isMainLoaded)return Promise.resolve();return(0,a.default)(i.Cmd,"main_loaded")};var i=n(88102),a=r(n(35609))},21244:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return(0,i.default)(window,"offline")};var i=r(n(9896))},59338:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.waitForOnlineNaive=function(){return s.apply(this,arguments)};var i=r(n(48926)),a=n(13959),o=r(n(9896));function s(){return(s=(0,i.default)((function*(){return yield(0,o.default)(self,"online"),(0,a.delayMs)(100)}))).apply(this,arguments)}},26741:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.UA=t.OS_TYPE=t.BROWSER_TYPE=void 0,t.gteVersion=o,t.ltVersion=s,t.parseUA=l;var i=r(n(42238));t.BROWSER_TYPE={CHROME:"chrome",CHROMIUM:"chromium",FIREFOX:"firefox",SAFARI:"safari",IE:"ie",OPERA:"opera",EDGE:"edge"};function a(e,t){let n,r;const i=/(\.0)+[^\.]*$/,a=(e+"").replace(i,"").split("."),o=(t+"").replace(i,"").split("."),s=Math.min(a.length,o.length);for(n=0;n<s;n++)if(r=parseInt(a[n],10)-parseInt(o[n],10),0!==r)return r;return a.length-o.length}function o(e,t){return a(e,t)>=0}function s(e,t){return a(e,t)<0}function l(e){const t=new i.default;t.setUA(e||"");const n=(t.getBrowser().name||"").toUpperCase(),r=t.getBrowser().version||"0.0.0",a=(t.getEngine().name||"").toUpperCase(),l=(t.getOS().name||"").toUpperCase(),c=t.getOS().version||"0.0.0",d="SAFARI"===n,u="CHROME"===n,p="GECKO"===a,f="BLINK"===a;let h=!1;switch(l){case"MAC OS":u?h=o(c,"10.10")&&o(r,"41.0.0"):o(c,"10.7")&&(h=!0);break;case"WINDOWS":o(c,"8.1")&&(p||u&&o(r,"41.0.0"))&&(h=!0)}const _=d||u&&s(r,"76");return{isWebkit:!a||"WEBKIT"===a,isGecko:p,isTrident:"TRIDENT"===a||"EDGEHTML"===a,isSafari:d,isElectron:!1,isBlink:f,isBuggyVideoLoad:u&&o(r,"76")||f&&!u,hasEmoji:h,troublesWithLotsOfVideos:u,supportsEmojiEllipsification:!_,isBrokenGetUserMedia:u&&s(r,"50"),isLocalStorageBroken:d&&o(r,"14.1")&&s(r,"14.1.2"),os:l.toLowerCase(),osVersion:c,browser:n.toLowerCase(),browserVersion:r,parser:t,isChrome:u}}t.OS_TYPE={WINDOWS:"windows",MAC:"mac os",CHROMEOS:"chromium os"};const c=l("undefined"!=typeof self?self.navigator.userAgent:null);t.UA=c},69305:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.supportsAesCbc=function(){return o().then((e=>e.generateKey(a,!1,["encrypt","decrypt"]).then((t=>Promise.resolve(self.crypto).then((e=>({name:"AES-CBC",iv:e.getRandomValues(new Uint8Array(16))}))).then((i=>e.encrypt(i,t,r).then((n=>e.decrypt(i,t,n))).catch((e=>(__LOG__(2)`CryptoSupport:AES-CBC encryption failed: ${e}`,!1))).then((e=>{const t=new Uint8Array(e);return r=t,Array.prototype.slice.call(r).map((e=>String.fromCharCode(e))).join("")===n?(__LOG__(2)`CryptoSupport:AES-CBC encryption/decryption is correct`,!0):(__LOG__(2)`CryptoSupport:AES-CBC encryption/decryption is incorrect`,!1);var r})).catch((e=>(__LOG__(2)`CryptoSupport:AES-CBC decryption failed: ${e}`,!1))))))).catch((e=>(__LOG__(2)`CryptoSupport:AES-CBC key generation failed: ${e}`,!1))))).catch((e=>(__LOG__(2)`CryptoSupport:AES-CBC: ${e}`,!1)))},t.supportsHmacSha256=function(){return o().then((e=>e.generateKey(i,!1,["sign","verify"]).then((t=>e.sign(i,t,r).then((n=>e.verify(i,t,n,r.buffer))).catch((e=>(__LOG__(2)`CryptoSupport:HMAC-SHA256 signing failed: ${e}`,!1))).then((e=>e?(__LOG__(2)`CryptoSupport:HMAC-SHA256 is verified`,!0):(__LOG__(2)`CryptoSupport:HMAC-SHA256 is not verified`,!1))).catch((e=>(__LOG__(2)`CryptoSupport:HMAC-SHA256 verification failed: ${e}`,!1))))).catch((e=>(__LOG__(2)`CryptoSupport:HMAC-SHA256 key generation failed: ${e}`,!1))))).catch((e=>(__LOG__(2)`CryptoSupport:HMAC-SHA256: ${e}`,!1)))};const n="whatsapp is da best",r=new Uint8Array(n.split("").map((e=>e.charCodeAt(0))));const i={name:"HMAC",hash:"SHA-256"},a={name:"AES-CBC",length:256};function o(){return Promise.resolve().then((()=>self.crypto.subtle||self.crypto.webkitSubtle))}},61498:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.detectWebpSupport=function(){return s.apply(this,arguments)},t.getCachedWebpSupport=function(){return o};var i=r(n(48926));const a=(0,n(38284).promiseTimeout)(new Promise((e=>{Modernizr.on("webp",e)})).then((e=>!(!e||!e.valueOf()))),5e3).catch((()=>!1));let o=null;function s(){return(s=(0,i.default)((function*(){if(o)return Promise.resolve(o);const e=yield a;return o=e,e}))).apply(this,arguments)}},55738:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){const e=new Promise((function(e){function t(){e(!1)}if(self.requestFileSystem)self.requestFileSystem(window.TEMPORARY,1,t,(function(t){e("SecurityError"===t.name)}));else if(s.default){const n=s.default.open("pb_detect");n?(n.onsuccess=t,n.onerror=function(t){t.preventDefault(),window.InvalidStateError?e(t instanceof window.InvalidStateError):e(!0)}):t()}else c.UA.isTrident?e(!0):t()})).then((function(e){if(e)return e;if(!l.default)return!1;try{return l.default.setItem("INCOG","0"),l.default.removeItem("INCOG"),!1}catch(e){if("QuotaExceededError"===e.name)return!0;throw e}}));return(0,o.promiseTimeout)(e,100,"detectIncognitoTimeout").catch((0,a.filteredCatch)(i.TimeoutError,(function(){return!1}))).catch((function(e){return __LOG__(3,void 0,void 0,!0)`promiseUtil:determineIncognito failed check: ${String(e)}`,SEND_LOGS("incog-throw"),!1}))};var i=n(40265),a=n(50796),o=n(38284),s=r(n(26945)),l=r(n(4285)),c=n(26741)},93860:(e,t,n)=>{"use strict";var r=n(95318);t.Z=function(){if(c(l))return!0;return(0,i.promiseProps)({cryptoSha256:(0,s.supportsHmacSha256)(),cryptoAesCbc:(0,s.supportsAesCbc)()}).then(c),!1};var i=n(67602),a=r(n(4285)),o=r(n(39312)),s=n(69305);const l={getRandomValues:!!self.crypto.getRandomValues,subtleCrypto:!(!self.crypto||!self.crypto.subtle&&!self.crypto.webkitSubtle),localstorage:!!a.default,sessionstorage:!!o.default,url:!!self.URL,websocket:!!self.WebSocket,worker:!!self.Worker};function c(e){const t=[];for(const n in e)e[n]||t.push(n);if(t.length>0){const e=`https://web.whatsapp.com/browsers.html?missing=${t.join(",")}`;return window.location.replace?window.location.replace(e):window.location.href=e,!0}return!1}},92658:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(38284),a=r(n(76521)),o=r(n(25613)),s=r(n(64237)),l=n(26741);const c="Modernizr"in window;class d extends a.default{constructor(){super(),this.supported=c?Modernizr.serviceworker:"serviceWorker"in navigator,this._checkAlive=()=>{var e;const t=null===(e=navigator.serviceWorker)||void 0===e?void 0:e.controller;return Boolean(t)},this._checkStreamingSupport=()=>{var e;if(!this.supported||!this.alive||l.UA.isSafari)return void(this._streamingSupported=!1);if(this._streamingSupportedPromise)return this._streamingSupported;const t=null===(e=navigator.serviceWorker)||void 0===e?void 0:e.controller;t&&(this._streamingSupportedPromise=(0,i.promiseTimeout)(o.default.request(t,s.default.STREAMING_SUPPORTED),100).catch((()=>!1)).then((e=>(delete this._streamingSupportedPromise,this.streamingSupported=e,e))))},this._setSupported=e=>{this.supported=e},c&&Modernizr.on("serviceworker",this._setSupported);const e=this;Object.defineProperty(this,"streamingSupported",{get:()=>(e._checkStreamingSupport(),e._streamingSupported),set(t){t!==e._streamingSupported&&e.trigger("change:streamingSupported",t),e._streamingSupported=t}}),Object.defineProperty(this,"alive",{get:()=>e._checkAlive()})}}var u=new d;t.default=u},67924:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.JS_HALT_EVENT=t.CLOCK_CHANGE_BACKWARDS_EVENT=t.BaseJsHaltDetector=void 0;var i=r(n(76521));const a="js_halt";t.JS_HALT_EVENT=a;const o="clock_change_backwards";t.CLOCK_CHANGE_BACKWARDS_EVENT=o;class s extends i.default{constructor(e,t){super(),this._interval=e,this._threshold=t}startDetection(){if(this._intervalId)return;let e=Date.now();this._intervalId=setInterval((()=>{const t=Date.now(),n=t-e-this._interval;n>this._threshold?this.trigger(a,n):n<-this._threshold&&this.trigger(o,n),e=t}),this._interval),__LOG__(2)`JsHaltDetector:detection started`}stopDetection(){this._intervalId&&(clearInterval(this._intervalId),this._intervalId=null,__LOG__(2)`JsHaltDetector:detection stopped`)}restartDetection(){this.stopDetection(),this.startDetection(),__LOG__(2)`JsHaltDetector:detection restarted`}}t.BaseJsHaltDetector=s},85553:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.jsHaltDetector=t.DEFAULT_THRESHOLD=t.DEFAULT_INTERVAL=void 0;var r=n(67924);t.DEFAULT_THRESHOLD=3e3;t.DEFAULT_INTERVAL=1e4;const i=new r.BaseJsHaltDetector(1e4,3e3);t.jsHaltDetector=i,i.startDetection()},85582:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addBorder=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"white";const r=document.createElement("canvas"),i=r.getContext("2d"),a=document.createElement("canvas"),o=a.getContext("2d"),s=2*t;r.width=a.width=e.width+2*s,r.height=a.height=e.height+2*s,i.drawImage(e,s,s),o.shadowColor=n,o.shadowBlur=1;for(let e=0;e<s;e++)o.drawImage(r,0,0),i.drawImage(a,0,0);return o.shadowColor="rgba(0,0,0,0)",o.drawImage(e,s,s),a},t.canvasToBlob=c,t.canvasToWebp=function(e){{const t=e.getContext("2d").getImageData(0,0,e.width,e.height);return(0,l.default)(t.data,e.width,e.height,{ensureExtendedFormat:!0})}},t.contain=function(e,t){const{width:n,height:r}=(0,o.boundHeightWidth)(e.height,e.width,t);if(n>e.width&&r>e.height)return e;const i=document.createElement("canvas"),a=i.getContext("2d");return i.width=n,i.height=r,a.drawImage(e,0,0,n,r),i},t.copy=p,t.createCanvas=u,t.fillBackgroundWithGray=function(e){const t=e.getContext("2d");t.fillStyle="rgb(247,247,247)",t.fillRect(0,0,e.width,e.height)},t.generateMicroThumb=function(){return d.apply(this,arguments)},t.getResizedDataUrl=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"image/jpeg",n=arguments.length>2?arguments[2]:void 0;const r=e.toDataURL(t),i=(0,a.dataURLtoBlob)(r);if(i.size<=n)return e.toDataURL(t);for(let r=.9;r>=.1;r-=.1){const i=e.toDataURL(t,r);if((0,a.dataURLtoBlob)(i).size<=n)return i}return null},t.resize=function(e,t,n){const r=e.getContext("2d"),i=r.getImageData(0,0,t,n);e.width=t,e.height=n,r.putImageData(i,0,0)},t.rotate=function(e,t){const n=t.x||0,r=t.y||0;t.degrees&&(t.radians=t.degrees*(Math.PI/180));e.translate(n,r),e.rotate(t.radians),e.translate(-n,-r)},t.scale=function(e,t){const n=e.getContext("2d"),r=p(e),{width:i,height:a}=(0,o.aspectRatioScaled)(e.width/e.height,t);e.width=i,e.height=a,n.drawImage(r,0,0,i,a)},t.square=function(e){const t=e.getContext("2d"),n=e.width,r=e.height,i=t.getImageData(0,0,n,r),a=Math.max(n,r);e.width=a,e.height=a,t.clearRect(0,0,n,r),t.putImageData(i,(a-n)/2,(a-r)/2,0,0,n,r)},t.trim=function(e){if(function(e){const t=e.getContext("2d").getImageData(0,0,e.width,e.height),n=t.data.length/4;let r;for(r=0;r<n;r++){if(0!==t.data[4*r+3])return!1}return!0}(e))return;const{left:t,top:n,right:r,bottom:i}=function(e){const t=e.getContext("2d").getImageData(0,0,e.width,e.height),n=t.data.length/4;let r,i=1/0,a=1/0,o=0,s=0;for(r=0;r<n;r++){if(0===t.data[4*r+3])continue;const n=r%e.width,l=Math.floor(r/e.width);n<i&&(i=n),n>o&&(o=n),l<a&&(a=l),l>s&&(s=l)}return{left:i,top:a,right:o,bottom:s}}(e),a=i-n,o=r-t,s=e.getContext("2d").getImageData(t,n,o,a),l=u(o,a);return l.getContext("2d").putImageData(s,0,0),l};var i=r(n(48926)),a=n(41931),o=n(50057),s=r(n(34949)),l=r(n(29853));function c(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"image/jpeg";return e.toBlob?new Promise((function(n){e.toBlob(n,t)})):Promise.resolve((0,a.dataURLtoBlob)(e.toDataURL(t)))}function d(){return(d=(0,i.default)((function*(e,t,n){var r,i;const a=n||{},o=null!==(r=a.mimetype)&&void 0!==r?r:"image/jpeg",l=null!==(i=a.maxAttempts)&&void 0!==i?i:10;let d=.5,p=e,f=yield c(p,o);for(let n=0;n<l&&!(f.size<=t);n++){const t=Math.floor(e.width*d),n=Math.floor(e.height*d);p=u(t,n);p.getContext("2d").drawImage(e,0,0,t,n),f=yield c(p,o),d*=.5}return{opaqueData:yield s.default.createFromData(f,o),width:p.width,height:p.height,dataUrl:p.toDataURL("image/jpeg")}}))).apply(this,arguments)}function u(e,t){const n=document.createElement("canvas");return n.width=e,n.height=t,n}function p(e){const t=u(e.width,e.height);return t.getContext("2d").drawImage(e,0,0),t}},50057:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.aspectRatioScaled=function(e,t){if("number"!=typeof e||e<0||e!=e)return{width:t,height:t};if(e>1)return{width:t,height:Math.max(t/e,1)};return{width:Math.max(t*e,1),height:t}},t.boundHeightWidth=function(e,t,n){let r=null!=t?t:n,i=null!=e?e:n;r>i?r>n&&(i*=n/r,r=n):i>n&&(r*=n/i,i=n);return{width:Math.max(r,1),height:Math.max(i,1)}},t.rotatePoint=function(e,t,n){const r=n*Math.PI/180;return{x:Math.cos(r)*e+Math.sin(r)*t,y:-Math.sin(r)*e+Math.cos(r)*t}}},51428:(e,t,n)=>{"use strict";var r=n(59182).default,i=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.DATA_URL=t.CANVAS=t.BlackVideoThumbnailError=t.BLOB=void 0,t.base64ImageToCanvas=function(){return x.apply(this,arguments)},t.crop=function(){return I.apply(this,arguments)},t.generateLinkPreview=function(){return R.apply(this,arguments)},t.generateVideoThumbsAndDuration=function(){return O.apply(this,arguments)},t.isCached=function(e){if(!e)return!1;const t=new Image;return t.src=e,!!t.complete},t.rotateAndResize=function(e,t,n,r){const{transparency:i=!1,fitToSquare:a=!1,minDimension:o=0}=null!=r?r:{},u=new ArrayBuffer(0);let p,h,_;e instanceof HTMLCanvasElement?(h=Promise.resolve(e),_=Promise.resolve(u)):(p=window.URL.createObjectURL(e),h=m.loadImage(p),_=(0,c.blobToArrayBuffer)(e).catch((e=>(__LOG__(3)`ImageUtils::rotateAndResize error: ${e}`,u))));return(0,s.promiseProps)({buffer:_,image:h}).then((e=>{var r;let{buffer:c,image:u}=e,p={};try{p=(0,f.default)(c)}catch(e){}let h=0;if(!(null===(r=Modernizr)||void 0===r?void 0:r.exiforientation))switch(p.orientation||"UNKNOWN"){case"right-top":h=1;break;case"left-bottom":h=-1;break;case"bottom-right":h=2}const _=document.createElement("canvas"),m=u.naturalWidth||u.width,y=u.naturalHeight||u.height,E=Math.max(m,y),S=_.getContext("2d"),v={};if(!h){const e=(0,d.boundHeightWidth)(y,m,t);let r,p,f=n&C;if(c&&f&&m===e.width&&y===e.height)try{const e=(0,g.cleanJPEG)(c);v.blob=e,f=!1,r=m,p=y}catch(e){__LOG__(2)`Could not parse JPEG: ${e.message}`}return(f||n&~C)&&(_.width=e.width,_.height=e.height,i||(0,l.fillBackgroundWithGray)(_),S.drawImage(u,0,0,_.width,_.height),a&&((0,l.square)(_),v.blob=void 0),E<o&&((0,l.scale)(_,o),v.blob=void 0),r=_.width,p=_.height,G(v,_,n,i)),(0,s.promiseProps)(v).then((e=>({width:r,height:p,images:e})))}switch(h){case 1:case-1:const e=Math.max(m,y),r=e/2;_.width=_.height=e,i||(0,l.fillBackgroundWithGray)(_),(0,l.rotate)(S,{x:r,y:r,degrees:90*h}),1===h?S.drawImage(u,0,e-y):S.drawImage(u,e-m,0),(0,l.rotate)(S,{x:r,y:r,degrees:-90*h}),(0,l.resize)(_,y,m),a&&(0,l.square)(_),E<o&&(0,l.scale)(_,o);const c=(0,l.contain)(_,t);return G(v,c,n,i),(0,s.promiseProps)(v).then((e=>({width:c.width,height:c.height,images:e})));case 2:const p=(0,d.boundHeightWidth)(y,m,t),f=_.width=p.width,g=_.height=p.height;return i||(0,l.fillBackgroundWithGray)(_),(0,l.rotate)(S,{x:f/2,y:g/2,degrees:90*h}),S.drawImage(u,0,0,f,g),(0,l.rotate)(S,{x:f/2,y:g/2,degrees:-90*h}),a&&(0,l.square)(_),E<o&&(0,l.scale)(_,o),G(v,_,n,i),(0,s.promiseProps)(v).then((e=>({width:_.width,height:_.height,images:e})))}})).finally((()=>{}))},t.toDataUrl=function(){return D.apply(this,arguments)},t.toDataUrlWithRoundedCorners=function(){return w.apply(this,arguments)},t.toWebpSticker=function(){return k.apply(this,arguments)},t.urlToFile=function(){return U.apply(this,arguments)};var a=i(n(48926)),o=n(40265),s=n(67602),l=n(85582),c=n(65885),d=n(50057),u=S(n(35232)),p=n(26741),f=i(n(26642)),h=n(62938),_=n(19770),g=n(45987),m=S(n(16737)),y=n(90669);function E(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(E=function(e){return e?n:t})(e)}function S(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=E(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}return r.default=e,n&&n.set(e,r),r}const v=2,T=4,b=1;t.DATA_URL=b;const C=v;t.BLOB=C;const A=T;t.CANVAS=A;class P extends((0,o.customError)("BlackVideoThumbnailError")){}t.BlackVideoThumbnailError=P,P.message="Generated video thumbnail is black";const M=e=>{let{video:t,fullWidth:n,fullHeight:r,maxDimension:i}=e;const a=document.createElement("canvas"),{width:o,height:s}=(0,d.boundHeightWidth)(r,n,i);a.width=o,a.height=s;const l=a.getContext("2d");l.drawImage(t,0,0,o,s);const c=l.getImageData(0,0,o,s);return{thumb:{url:a.toDataURL("image/jpeg"),width:o,height:s,fullWidth:n,fullHeight:r},imageData:c}};function O(){return(O=(0,a.default)((function*(e){const{file:t,maxDimensions:n,debugHint:i,throwOnBlack:a=!1}=e,{video:o,fullWidth:s,fullHeight:l}=yield m.loadVideo(t),c=e=>{const t=e.width*e.height/4;for(let n=0;n<=1;n+=.25){const r=4*Math.round(t*n);if(0!==e.data[r])return!1;if(0!==e.data[r+1])return!1;if(0!==e.data[r+2])return!1;const i=e.data[r+3];if(0!==i&&255!==i)return!1}return!0};if(p.UA.isBuggyVideoLoad){const e=50,t=5e3/e;return(0,_.exponentialBackoff)({minTimeout:e,maxTimeout:e,retries:t,signal:(new r).signal,factor:1},((e,r)=>{const d=[];let u;for(u of n){const{thumb:n,imageData:p}=M({video:o,fullHeight:l,fullWidth:s,maxDimension:u});if(c(p)){if(r<t)return 0===r&&__LOG__(2)`generateVideoThumbsAndDuration: Setting video.currentTime to 0 to attempt to unblock the video`,o.currentTime=0,e(new Error("retry"));if(Math.random()<=.02&&(__LOG__(4,void 0,new Error,!0)`generateVideoThumbsAndDuration: Failed to generate video thumbnail from ${i}`,SEND_LOGS(`thumbnail-generation-failed-${i}`)),a)throw new P}d.push(n)}const p={duration:~~o.seekable.end(0),thumbs:d};return m.disposeVideo(o),Promise.resolve(p)}))}try{const e=n.map((e=>{const{thumb:t,imageData:n}=M({video:o,fullHeight:l,fullWidth:s,maxDimension:e});if(c(n)&&(Math.random()<=.02&&(__LOG__(4,void 0,new Error,!0)`generateVideoThumbsAndDuration: Failed to generate video thumbnail from ${i}`,SEND_LOGS(`thumbnail-generation-failed-${i}`)),a))throw new P;return t}));return{duration:~~o.seekable.end(0),thumbs:e}}finally{m.disposeVideo(o)}}))).apply(this,arguments)}function I(){return(I=(0,a.default)((function*(e,t,n,r,i,a,o){let l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:b;const c=e instanceof HTMLCanvasElement?e:yield m.loadImage(e),d=document.createElement("canvas"),u=d.getContext("2d");null==a||null==o?(d.height=i,d.width=r,u.drawImage(c,t,n,r,i)):(d.height=o,d.width=a,u.drawImage(c,t,n,r,i,0,0,a,o));const p={};G(p,d,l);const f=yield(0,s.promiseProps)(p);return{images:f,width:r,height:i}}))).apply(this,arguments)}function w(){return(w=(0,a.default)((function*(e){const t=e instanceof HTMLCanvasElement?e:yield m.loadImage(e),n=document.createElement("canvas"),r=n.getContext("2d");n.height=t.height,n.width=t.width;const i=Math.min(t.width,t.height);return r.beginPath(),r.arc(t.width/2,t.height/2,i/2,0,2*Math.PI,!0),r.clip(),r.closePath(),r.drawImage(t,0,0),n.toDataURL("image/png")}))).apply(this,arguments)}function R(){return(R=(0,a.default)((function*(e){try{const t=yield m.loadImage(e),n=100,r=140;if(t.width<n||t.height<n)return __LOG__(2)`Image size too small for link preview`,null;const i=document.createElement("canvas"),a=i.getContext("2d");i.height=r,i.width=r;const o=Math.min(t.width,t.height),s=(t.width-o)/2,l=(t.height-o)/2;return a.drawImage(t,s,l,o,o,0,0,r,r),i.toDataURL("image/jpeg").replace(/^data:image\/jpeg;base64,/,"")}catch(e){return __LOG__(2)`link preview image generation failed: `,null}}))).apply(this,arguments)}function D(){return(D=(0,a.default)((function*(e){try{const t=yield m.loadImage(e),n=document.createElement("canvas"),r=n.getContext("2d");return n.height=t.height,n.width=t.width,r.drawImage(t,0,0),n.toDataURL("image/jpeg").replace(/^data:image\/jpeg;base64,/,"")}catch(e){return __LOG__(2)`data URL conversion failed: `,null}}))).apply(this,arguments)}function L(){return N.apply(this,arguments)}function N(){return(N=(0,a.default)((function*(e,t){try{const n=yield e.arrayBuffer(),r=(0,h.addWebpMetadata)(n,t),i=new Uint8Array(r);return new Blob([i],{type:"image/webp"})}catch(t){return __LOG__(4,void 0,new Error,!0)`addMetadataToSticker: Unable to add metadata to Sticker`,SEND_LOGS("unable-to-add-sticker-metadata"),e}}))).apply(this,arguments)}function k(){return(k=(0,a.default)((function*(e){try{const t=window.URL.createObjectURL(e),n=yield m.loadImage(t);window.URL.revokeObjectURL(t);const r=y.STICKER_DIMENSION,i=(0,l.createCanvas)(r,r),a=i.getContext("2d"),{width:o,height:s}=(0,d.aspectRatioScaled)(n.width/n.height,r);a.drawImage(n,(r-o)/2,(r-s)/2,o,s);const c=yield(0,l.canvasToWebp)(i);return yield L(c,{isFirstParty:!1,isFromStickerMaker:!0,emojis:[],stickerPackPublisher:"WhatsApp Sticker Maker"})}catch(e){throw __LOG__(2)`Webp sticker file generation failed: `,e}}))).apply(this,arguments)}function U(){return(U=(0,a.default)((function*(e){try{const t=yield m.loadImage(e),n=document.createElement("canvas");n.width=t.naturalWidth,n.height=t.naturalHeight;const r=n.getContext("2d");return(0,l.fillBackgroundWithGray)(n),r.drawImage(t,0,0),(0,l.canvasToBlob)(n)}catch(t){throw new u.MediaDragDropError("unable to render image",e)}}))).apply(this,arguments)}function G(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const i=r?"image/png":"image/jpeg";!e.blob&&n&C&&(e.blob=(0,l.canvasToBlob)(t,i)),!e.dataUrl&&n&b&&(e.dataUrl=Promise.resolve(t.toDataURL(i))),!e.canvas&&n&A&&(e.canvas=Promise.resolve(t))}function x(){return(x=(0,a.default)((function*(e){const t=yield m.loadImage(e),n=(0,l.createCanvas)(t.width,t.height);return n.getContext("2d").drawImage(t,0,0),n}))).apply(this,arguments)}},28195:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(48926));t.default=class{constructor(e){let{name:t,handler:n=null,interval:r=3600,restingInterval:i=18e3,sleepWhileResting:a=!1,randomIntervalExtension:o=0}=e;if(this._running=!1,this._slowDown=!1,this._name=t,this._interval=1e3*r,this._restingInterval=1e3*i,this._sleepWhileResting=a,this._randomIntervalExtension=1e3*o,this._rest(),"function"==typeof n)this.poll(n);else if(null!=n)throw new Error("Poll handler must be a function or null")}_getRandomExtension(){return Math.ceil(Math.random()*this._randomIntervalExtension)}_getInterval(){return(this._slowDown?this._restingInterval:this._interval)+this._getRandomExtension()}_rest(){document.addEventListener("visibilitychange",(()=>{this._lock||(document.hidden?this._sleepWhileResting?(__LOG__(2)`LazyPoll[${this._name}]: Inactive paused`,this._pause()):(__LOG__(2)`LazyPoll[${this._name}]: Inactive slowing down`,this._slowDown=!0):this._callback&&(__LOG__(2)`LazyPoll[${this._name}]: Active Resuming`,this._resume()))}),!1)}_isDue(){if(!this._lastPoll)return!0;return Date.now()-this._lastPoll>=this._getInterval()}_pause(){clearTimeout(this._timer),this._running=!1}_resume(){this._slowDown=!1,this._running=!0,this._cycle()}_cycle(){var e=this;return(0,i.default)((function*(){e._running&&(e._isDue()&&(__LOG__(2)`LazyPoll[${e._name}]: Polling...`,yield e._callback(),e._lastPoll=Date.now()),clearTimeout(e._timer),e._timer=setTimeout((()=>e._cycle()),e._getInterval()))}))()}poll(e){null==this._callback?(this._callback=e,this._running=!0,this._cycle()):this.resume()}pause(){__LOG__(2)`LazyPoll[${this._name}]: Manually Paused`,this._lock=!0,this._pause()}resume(){__LOG__(2)`LazyPoll[${this._name}]: Manually Resumed`,this._lock=!1,this._resume()}}},86374:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.SERVER_REQUESTED=void 0,t.sendLogs=function(){return G.apply(this,arguments)},t.upload=I,t.uploadUserReport=function(){return N.apply(this,arguments)};var i=r(n(81109)),a=r(n(48926)),o=r(n(23493)),s=n(88555),l=n(20289),c=n(57977),d=n(53658),u=n(39948),p=n(81155),f=r(n(76139)),h=r(n(11854)),_=n(88102),g=n(17239),m=n(99234),y=r(n(52991)),E=n(89618);const S=e=>new Promise((t=>setTimeout(t,e))),v=n(76672)({CRASHLOG:"crashlog",SUPPORT:"support"}),T=n(76672)({ONLY_EXCEPTION:"only_exception"}),b={shouldHitCheckEndpoint:()=>!1,expectedCodes:[],appendToFormDataForCheck:()=>{},appendToFormDataForUpload:()=>{},shouldUseLightWeightLogs:()=>!1},C={shouldHitCheckEndpoint:()=>!0,expectedCodes:[200,403],appendToFormDataForCheck:()=>{},appendToFormDataForUpload:()=>{},shouldUseLightWeightLogs:()=>!1},A={shouldHitCheckEndpoint:()=>!0,expectedCodes:[200,403],appendToFormDataForCheck:e=>{e.append("support_exception_only_upload","true")},appendToFormDataForUpload:(e,t)=>{t&&t.upload===T.ONLY_EXCEPTION&&e.append("exception_only_upload","true")},shouldUseLightWeightLogs:e=>!!e&&e.upload===T.ONLY_EXCEPTION};function P(e,t,n){return n?b:t?A:C}const M="server-requested";t.SERVER_REQUESTED=M;const O=(0,o.default)(R,36e5);function I(){return w.apply(this,arguments)}function w(){return(w=(0,a.default)((function*(e){let{reason:t,immediate:n=!1,force:r=!1,persist:i=!1,isHighPri:a=!1,nativeCrash:o,voipLog:d,skipSampling:u=!1,hasTaggedMessage:f=!1,ticketId:h}=e;if(y.default.isLogoutInProgress)return Promise.resolve();let m=i?v.SUPPORT:v.CRASHLOG;_.Cmd.logSocketSummary(),__LOG__(2)`Focus at time of upload:`;try{E.UIM.pprint(!0)}catch(e){__LOG__(3)`UIM Print Failed!`}__LOG__(2)`==================================================`,__LOG__(2)`wa:uploadLogs ref: ${g.Conn.ref||"no conn"}`,__LOG__(2)`wa:uploadLogs hash: ${"fdca65977a5968d197b73228961b4afe2515c724"}`,__LOG__(2)`wa:uploadLogs version: ${"2.2210.9"}`,__LOG__(2)`wa:uploadLogs userAgent: ${navigator.userAgent}`,__LOG__(2)`wa:uploadLogs platform: ${g.Conn.platform||"no platform"}`,__LOG__(2)`wa:uploadLogs webPlatform: ${"web"}`,__LOG__(2)`wa:uploadLogs appId: ${""}`,__LOG__(2)`wa:uploadLogs url: ${location.href}`,__LOG__(2)`wa:uploadLogs distribution: ${(0,c.getDistribution)()}`,__LOG__(2)`wa:uploadLogs buildId: ${"359061622"}`,__LOG__(2)`wa:uploadLogs mdOptIn: ${(0,s.isMDBackend)()}`,f&&__LOG__(2)`wa:uploadLogs hasTaggedMessage`;let S=null;if(void 0===t)m=v.SUPPORT,__LOG__(2)`reason for logs: manual-upload`,S=!0;else if(t){let e=t;(0,s.isMDBackend)()&&(e=`[MD] ${t}`),__LOG__(2)`reason for logs: ${e}`}__LOG__(2)`${p.END_OF_UPLOAD}`;let T=R;if(!S&&!r){if(!(Math.random()<l.UPLOAD_TO_CLB))return void __LOG__(2)`wa:uploadLogs squelched logs`;T=O}const b=P(0,f,t===M);try{return yield T({isHighPri:a,immediate:n,logType:m,nativeCrash:o,voipLog:d,skipSampling:u,ticketId:h,getFullLogs:t===M,uploadStrategy:b})}catch(e){__LOG__(2)`wa:uploadLogs error uploading: ${e}`}}))).apply(this,arguments)}function R(){return D.apply(this,arguments)}function D(){return(D=(0,a.default)((function*(e){let t,{isHighPri:n,immediate:r,logType:i,nativeCrash:a,voipLog:o,skipSampling:s=!1,ticketId:c,getFullLogs:d=!1,uploadStrategy:p}=e;if(yield S(r?0:500),p.shouldHitCheckEndpoint()){const e=L({isHighPri:n});if(p.appendToFormDataForCheck(e),t=yield h.default.post(k(i),e),!p.expectedCodes.includes(t.status))throw new Error(`Status code of ${t.status} from ${l.CLB_CHECK_URL} was unexpected, expected values are: ${p.expectedCodes.toString()}`);if(403===t.status)throw new Error("Aborting Crashlog upload due to 403 response")}else __LOG__(2)`Crashlog:doUpload skipping sampling check`;let f=null;if(t)try{f=JSON.parse(t.responseText)}catch(e){__LOG__(2)`Crashlog:failed to parse response from upload check ${String(e)}, will perform default upload`}const _=L({isHighPri:n});p.appendToFormDataForUpload(_,f);const g=(yield u.Logger.getLogs(d,p.shouldUseLightWeightLogs(f))).join("\n"),m=new Blob([g],{type:"text/plain"});_.append("file",m,"logs.txt"),c&&_.append("ticket_id",c),a&&(_.append("attachment",new Blob([a.contents],{type:"application/octet-stream"}),a.filename),_.set("agent",a.agent),_.append("tags","electron_native"),o&&_.append("voip_log",new Blob([o.contents],{type:"text/plain"}),o.filename));const y=U(i),E=yield h.default.post(y,_);if(200!==E.status)throw new Error(`Status code of ${E.status} from ${y} was unexpected, expected 200`);return E.getResponseHeader("X-Uploaded-File-Id")}))).apply(this,arguments)}function L(e){let{isHighPri:t}=e;const r=new FormData;t&&r.append("forced","true");const i=(0,m.getMe)();i&&r.append("from_jid",i.toString());const a=n(79264).default.info(),o=(0,c.getLogUserAgent)({device:a.os,browser:a.ua,appVersion:"2.2210.9"});return r.append("agent",o),r.append("app_id",""),r.append("build_id","359061622"),(0,s.isMDBackend)()&&r.append("md_opt_in","true"),r}function N(){return(N=(0,a.default)((function*(e,t,n,r,a){try{__LOG__(2)`Crashlog:uploadUserReport uploading`,__LOG__(2,!0)`Crashlog:uploadUserReport description: ${r}`;const o=yield I({reason:"user-report",immediate:!0,force:!0,persist:!0}),s=(0,m.getLoginTokens)().server,c=new FormData;s&&c.append("tok",s),null!=e&&c.append("user",String(e)),c.append("email",t),o&&c.append("crashlog",o),c.append("desc",r),a.map(((e,t)=>{c.append(`screenshot-${t}`,e)}));const u=(0,d.getDebugInfo)(),p=(0,i.default)((0,i.default)({},u),{},{subject:n});c.append("info",JSON.stringify(p)),__LOG__(2)`Crashlog:uploadUserReport submitting`,yield h.default.post(l.TICKET_URL,c),__LOG__(2)`Crashlog:uploadUserReport succeeded`}catch(e){__LOG__(2)`Crashlog:uploadUserReport failed ${String(e)}`}}))).apply(this,arguments)}function k(e){return f.default.build(l.CLB_CHECK_URL,{type:String(e),access_token:l.CLB_TOKEN})}function U(e){return f.default.build(l.CLB_URL,{type:String(e),access_token:l.CLB_TOKEN})}function G(){return(G=(0,a.default)((function*(e){yield I({reason:e,hasTaggedMessage:!0})}))).apply(this,arguments)}},53658:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getDebugInfo=function(e){l.Wam.initialize();const t=(0,i.default)((0,i.default)({},s.default.Global.all),{},{webcWebPlatform:"web",webcPhonePlatform:a.Conn.platform,webcProtoVersion:String(a.Conn.protoVersion)}),n=(0,o.getMe)();n&&(t.deviceID=n.toString());e&&(t.context=e);const r={};for(const e in t){const n=t[e];null!=n&&(r[e]=n)}return r};var i=r(n(81109)),a=n(17239),o=n(99234),s=r(n(11339)),l=n(77959)},79405:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:String,a=(0,i.default)(e,t.map(r)).join("");const o=n?4e3:Number.POSITIVE_INFINITY;a.length>o&&(a=a.slice(0,o).replace(/\s+$/," [truncated]"));return a};var i=r(n(30138))},39948:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.Logger=void 0,t.cycleThroughLogLines=v,t.log=void 0;var i=r(n(48926)),a=r(n(35161)),o=n(57319),s=n(20289),l=r(n(79405)),c=n(81155),d=n(81806),u=r(n(45234)),p=r(n(30381)),f=r(n(64662)),h=n(72407);const _=Date.now(),g="LTSXOo+_*-=.<^!#?".split("");function m(){return g[Math.round(Math.random()*(g.length-1))]}const y=m()+m()+m()+m(),E={};E[E.ALL=0]="all",E[E.INFO=1]="info",E[E.LOG=2]="log",E[E.WARN=3]="warn",E[E.ERROR=4]="error",E[E.OFF=5]="off";function S(e){switch(e){case E.INFO:case E.LOG:case E.WARN:case E.ERROR:return E[e];default:throw new Error(`Unexpected numeric log level: ${e}`)}}function v(){return T.apply(this,arguments)}function T(){return(T=(0,i.default)((function*(e,t,n,r){yield b(e,t+1,n,r),yield b(0,e,n,r)}))).apply(this,arguments)}function b(){return C.apply(this,arguments)}function C(){return(C=(0,i.default)((function*(e,t,n,r){for(let i=e;i<t;i+=n){const e=Math.min(i+n,t);yield r(i,e)}}))).apply(this,arguments)}const A=new class{constructor(){var e=this;this.logs=[],this.localCursor=0,this.pending=void 0,this.timer=new o.ShiftTimer((()=>this._persistIdb())),this.isTakeOver=!1,this.log=(0,f.default)((function(t){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;return function(o){for(var s=arguments.length,c=new Array(s>1?s-1:0),d=1;d<s;d++)c[d-1]=arguments[d];const u=(0,l.default)(o,c,!n);return e.logImpl(t,u,r,i,a),u}}),((e,t,n,r,i)=>n||i?null:String(e)+String(Boolean(t))+String(Boolean(r))))}logImpl(e,t,n,r,i){const a=(0,p.default)().locale("en").format("YYYY-MM-DD HH:mm:ss.SSS:"),o=n?`\n${(0,d.normalizeStack)(n,!0)}`:"",l=[S(e),r?"sendlogs":null,...null!=i?i:[]].filter(Boolean).map((e=>`[${e}]`)).join(""),c=`${y} ${a}`+(l?`${l} `:"")+t+o;this.logs.push(c),this.isTakeOver||(this.logs.length>s.LOG_SIZE&&(this.logs.shift(),this.localCursor--),this.timer.debounceAndCap(250,1e3))}logUncaughtError(e,t){const n=e instanceof Error&&e.stack?e:void 0;let r;if(r=n?String(e):t?`Promise rejected: ${String(e)}`:`Error: ${String(e)}`,this.logImpl(E.ERROR,r,n,!0,["uncaught"]),null!=t){const e=String(t);this.logImpl(E.WARN,e)}}onTakeOver(){this.isTakeOver=!0}getLogs(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const o=n(11554).default,s=[];return this.pending&&s.push(this.pending),this.timer.isScheduled()&&(this.timer.forceRunNow(),this.pending&&s.push(this.pending)),Promise.all(s).then((()=>o.idb())).then(function(){var n=(0,i.default)((function*(n){return(0,c.getTimeboxedAndTrimmedLogs)(n,t?0:e._createTimeStamp()-6048e5,r)}));return function(){return n.apply(this,arguments)}}()).then((e=>(0,a.default)(e,"log"))).catch((()=>this.logs))}_clearLogsInBatches(){var e=this;return(0,i.default)((function*(){const t=n(11554).default,{asyncSleep:r}=n(52613),a=yield t.idb(),o=yield a.logs.toCollection().last();if(null==o)return;const s=o.line,l=e._getCursor(),c=function(){var e=(0,i.default)((function*(e,t){try{yield a.transaction("rw",a.logs,(0,i.default)((function*(){const n=yield a.logs.where("line").between(e,t).primaryKeys();yield a.logs.bulkDelete(n)})))}catch(e){__LOG__(2)`_clearLogsInBatches: error while deleting, ${e.stack}`}yield r(0)}));return function(){return e.apply(this,arguments)}}();yield v(l,s,1e3,c)}))()}_clearLogsInDB(){return(0,i.default)((function*(){const e=n(11554).default;yield e.idb().then((e=>e.logs.clear())).catch((()=>{}))}))()}clearLogs(){var e=this;return(0,i.default)((function*(){yield e._clearLogsInDB(),e._setCursor(0),e.localCursor=0,e.logs=[]}))()}clearLogsPreemptive(){var e=this;return(0,i.default)((function*(){{const{getShouldPreemptivelyCleanupLogs:t,setShouldPreemptivelyCleanupLogs:r}=n(99234);t()&&(yield e._clearLogsInDB(),r(!1))}}))()}_optimisticallyAdvanceCursor(e,t){this.localCursor+=t,this._setCursor((e+t)%s.LOG_SIZE)}_persistIdb(){const e=n(11554).default,t=this.logs.slice(Math.max(this.localCursor,0),this.logs.length);t.length&&(this.pending=e.idb().then((e=>e.transaction("rw",e.logs,e.user,(()=>{let n=this._getCursor();this._optimisticallyAdvanceCursor(n,t.length),t.forEach((t=>{n=(n+1)%s.LOG_SIZE,e.logs.put({line:n,log:t,timestamp:this._createTimeStamp()})}))})))).catch((()=>{})).finally((()=>{this.pending=void 0})))}_createTimeStamp(){return performance&&performance.now()+_||Date.now()}_getCursor(){try{return JSON.parse(u.default.getItem(h.KEYS.LOG_CURSOR))||Math.max(this.localCursor,0)}catch(e){return Math.max(this.localCursor,0)}}_setCursor(e){return u.default.setItem(h.KEYS.LOG_CURSOR,String(e))}};t.Logger=A;const P=A.log;t.log=P},81155:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.TRIM_LENGTH=t.END_OF_UPLOAD=void 0,t.getTimeboxedAndTrimmedLogs=function(){return o.apply(this,arguments)};var i=r(n(48926));const a="==================================================EOU";t.END_OF_UPLOAD=a;function o(){return(o=(0,i.default)((function*(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=[];if(n){const n=yield e.logs.orderBy("timestamp").filter((e=>e.timestamp>=t)).reverse().until((e=>e.log.includes("[sendlogs]")),!0).toArray();for(let e=n.length-1;e>=0&&(s(n[e],r),!n[e].log.includes(a));e--);}else yield e.logs.orderBy("timestamp").filter((e=>e.timestamp>=t)).each((e=>{s(e,r)}));return r}))).apply(this,arguments)}function s(e,t){e.log=e.log.slice(0,2500),t.push(e)}t.TRIM_LENGTH=2500},57977:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getDistribution=function(){let e="unknown";return e="prod","web_prod"},t.getLogUserAgent=function(e){let t,{appVersion:n,browser:r,device:i}=e;return t="Web/"+r,`WhatsApp/${n} ${t} Device/${i}`}},64662:(e,t)=>{"use strict";function n(e,t){const r=function(){for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];const o=t?t.apply(this,i):i[0];if(!o)return e.apply(this,i);const s=r.cache;if(s.has(o))return s.get(o);const l=e.apply(this,i);return r.cache=s.set(o,l)||s,l};return r.cache=new(n.Cache||Map),r}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,n.Cache=Map;var r=n;t.default=r},71443:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i.default,n=null;const r=function(r){return null!=n&&t(n.params,r)?n.params=r:n={params:r,result:e.call(this,r)},n.result};return r.clear=()=>{n=null},r};var i=r(n(96774))},48011:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.enrich=function(e,t){let n;switch((0,s.previewType)(t)){case"pdf":n=l(e);break;case"msoffice":n=function(){return c.apply(this,arguments)}(e);break;default:n=Promise.resolve()}return(0,a.promiseTimeout)(n,3e3,"Document enrichment timeout").catch((()=>null))},t.enrichPdf=l;var i=r(n(48926)),a=n(38284),o=r(n(91990)),s=n(43257);function l(e){let t;return o.default.fileToPdf(e).then((e=>(t=e,o.default.pdfToImg(e,1)))).catch((()=>(__LOG__(2)`pdf preview generation failed`,null))).finally((()=>{t&&o.default.releasePdf(t)}))}function c(){return(c=(0,i.default)((function*(e){if("win32"===process.platform)try{yield DocUtils.genPreview(e)}catch(e){__LOG__(2)`document preview generation failed`}}))).apply(this,arguments)}},65885:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.FILETYPE=void 0,t.blobToArrayBuffer=c,t.blobToText=function(){return p.apply(this,arguments)},t.createFile=function(e,t,n){const r=new Blob(e,n||{});return r.name=t,r},t.getAudioDuration=function(e){let t,n;return new Promise(((r,i)=>{t=document.createElement("audio"),t.addEventListener("loadeddata",r),t.addEventListener("error",(()=>{i(new Error("getAudioDuration: error loading audio"))})),t.src=n=URL.createObjectURL(e)})).then((()=>~~t.seekable.end(0))).finally((()=>{n&&URL.revokeObjectURL(n)}))},t.getFileExtension=u,t.getMimeTypeForFilepath=function(e){const t=u(e),n=(0,o.isAllowedDocumentMimetype)(o.EXT_TO_MIME&&t&&o.EXT_TO_MIME[t],e,!1);if(n)return n},t.removeTrailingDots=d,t.typeFromMimetype=function(e){const t=e.split("/")[0];switch(t){case s.IMAGE:case s.VIDEO:case s.AUDIO:return t;default:return s.DOCUMENT}},t.validateBlob=function(e){return c(e.webkitSlice?e.webkitSlice(0,1):e.slice(0,1)).then((e=>1===e.byteLength)).catch((()=>!1))};var i=r(n(48926)),a=n(35232),o=n(43257);const s=Object.freeze({IMAGE:"image",VIDEO:"video",AUDIO:"audio",DOCUMENT:"document",STICKER:"sticker"});t.FILETYPE=s;const l=e=>{var t;return null!==(t=null==e?void 0:e.message)&&void 0!==t?t:""};function c(e){let t;return new Promise(((n,r)=>{t=new FileReader,t.onload=n,t.onerror=()=>{var e;r("NotReadableError"===(null===(e=t.error)||void 0===e?void 0:e.name)?new a.FileNotReadableError(`blobToArrayBuffer error: ${l(t.error)}`):new Error(`blobToArrayBuffer error: ${l(t.error)}`))},t.onabort=()=>{r(new Error(`blobToArrayBuffer abort: ${l(t.error)}`))},t.readAsArrayBuffer(e)})).then((()=>t.result))}function d(e){return e.replace(/\.+$/,"")}function u(e){const t=d(e.trimRight()).split(".");return t.length>1?t[t.length-1].toLowerCase():null}function p(){return(p=(0,i.default)((function*(e){if("function"==typeof e.text)return e.text();const t=new FileReader;if(yield new Promise(((n,r)=>{t.onload=n,t.onerror=e=>{r(new Error(`blobToText error: ${String(e)}`))},t.onabort=e=>{r(new Error(`blobToText abort: ${String(e)}`))},t.readAsText(e)})),t.result instanceof ArrayBuffer)throw new TypeError("blobToText error: Invalid result type: ArrayBuffer");if(null==t.result)throw new TypeError("blobToText: Invalid result type: null");return t.result}))).apply(this,arguments)}},48174:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.setupLodashMemoizeCache=function(){i.default.Cache=a.MemoizeCache};var i=r(n(88306)),a=n(14950)},79264:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(23279)),a=n(15688),o=n(26741);let s=!1;const l=(0,i.default)((()=>s=!1),500);var c={id(){const e=n(99234);let t=e.getBrowserId();if(t)return t;const r=new Uint8Array(16);return self.crypto.getRandomValues(r),t=(0,a.encodeB64)(r),e.setBrowserId(t),t},info(){const e=o.UA.parser.getResult();return{os:e.os.name,version:e.os.version,name:e.browser.name,ua:e.browser.name+" "+e.browser.version}},hardRefresh(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.promptUnloadGuards++,e){n(99234).setNoTakeover(!0)}location.reload(t)},startDownloading(){s=!0,l()},clearDownloading(){s=!1},isDownloading:()=>s,promptUnloadGuards:0,open(e){window.open(e,"_blank","noopener,noreferrer")}};t.default=c},91990:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(48926)),a=n(13959),o=n(4352),s=n(67602),l=n(85582),c=r(n(64369)),d=g(n(51428)),u=r(n(44053)),p=r(n(34949)),f=n(64551),h=g(n(47272));function _(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(_=function(e){return e?n:t})(e)}function g(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=_(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}return r.default=e,n&&n.set(e,r),r}t.default=class{static fileToPdf(e){const t=URL.createObjectURL(e);return(0,o.promiseLoop)((function(e,t,r){const i=(0,a.delayMs)(h.expBackoff(r,12e4,0,0));return n.e(2974).then(n.t.bind(n,99299,23)).then((t=>{t.GlobalWorkerOptions.workerSrc=u.default,e(t.default)})).catch((()=>i))})).then((e=>e.getDocument(t).promise))}static releasePdf(e){return e.destroy()}static pdfToImg(e,t){const n=document.createElement("canvas");return e.getPage(t).then((e=>{const t=e.getViewport({scale:1}),r=n.getContext("2d");return n.height=t.height,n.width=t.width,e.render({canvasContext:r,viewport:t}).promise})).then((()=>(0,s.promiseProps)({blob:(0,l.canvasToBlob)(n),thumbnail:d.rotateAndResize(n,c.default.DOC_THUMB_MAX_EDGE,d.DATA_URL|d.CANVAS|d.BLOB),microThumbnail:f.ServerProps.webUploadDocumentThumbMmsEnabled?(0,l.generateMicroThumb)(n,1300,{mimetype:"image/jpeg",maxAttempts:10}):Promise.resolve(null)}))).then((e=>e)).then(function(){var t=(0,i.default)((function*(t){let{blob:n,thumbnail:r,microThumbnail:i}=t;return{url:URL.createObjectURL(n),thumbUrl:r.images.dataUrl,width:r.images.canvas.width,height:r.images.canvas.height,fullPreviewData:yield p.default.createFromData(r.images.blob,"image/jpeg"),fullPreviewSize:{width:r.images.canvas.width,height:r.images.canvas.height},pdfPages:e.numPages,microThumbnail:i}}));return function(){return t.apply(this,arguments)}}())}}},69315:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.phashV1=function(){return l.apply(this,arguments)},t.phashV2=function(){return c.apply(this,arguments)};var i=r(n(48926)),a=n(15688),o=n(73045),s=n(45454);function l(){return(l=(0,i.default)((function*(e){const t=e.map((e=>(0,s.toUserWid)(e).toString({legacy:!0}))).sort().join(""),n=[];for(let e=0;e<t.length;e++)n.push(t.charCodeAt(e));const r=new Uint8Array(n),i=yield self.crypto.subtle.digest({name:"SHA-1"},r);return`1:${(0,a.encodeB64)(i.slice(0,6))}`}))).apply(this,arguments)}function c(){return(c=(0,i.default)((function*(e){const t=e.map((e=>e.toString({legacy:!0,formatFull:!0}))).sort().join(""),n=[];for(let e=0;e<t.length;e++)n.push(t.charCodeAt(e));const r=new Uint8Array(n),i=yield(0,o.sha256)(r);return`2:${(0,a.encodeB64)(i.slice(0,6))}`}))).apply(this,arguments)}},93778:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.Field=void 0,t.getNameString=O,t.getNameStringFromNames=I,t.mergeVcards=function(e){if(0===e.length)throw new Error("No vcards provided");return 1===e.length?e[0]:{displayName:O(e),vcard:e.map((e=>e.vcard)).join("\n"),isMultiVcard:!0}},t.parseMultiVcard=function(e){const t=e.match(/BEGIN:VCARD([\s\S]*?)END:VCARD/g);return t?t.map((e=>P(e))).filter(Boolean):[]},t.parseVcard=P,t.vcardFromContactModel=function(e){var t;const n=A((0,g.getMaybeMeUser)()?e.displayName:e.formattedName),r=["BEGIN:VCARD","VERSION:3.0",`N:${M(e)}`,`FN:${n}`,`TEL;type=CELL;waid=${String(e.userid)}:${(0,f.default)(e.userid)}`,e.isBusiness?`X-WA-BIZ-NAME:${n}`:null,(null===(t=e.businessProfile)||void 0===t?void 0:t.description)?`X-WA-BIZ-DESCRIPTION:${A(e.businessProfile.description)}`:null,"END:VCARD"].filter(Boolean);return{displayName:n,vcard:r.join("\n"),isMultiVcard:!1}},t.vcardGetDate=function(e){let t=e;return(0,s.default)([/-([^-]*)-([^-]*)-([^-]*)/,/([^-]*)-([^-]*)-([^-]*)/],(n=>{const r=e.match(n);if(r){const e=!r[1].length||"1604"===r[1],n=e?"0000":r[1];return t=(0,_.default)(`${n}-${r[2]}-${r[3]}`).format("l"),e&&(t=t.replace(/[.,-\/\s]*0000[.,-\/\s]*/,"")),!1}})),t},t.vcardGetName=M,t.vcardGetNameFromParsed=function(e){let t=null;const{FN:n,NICKNAME:r,TEL:i}=e;if(null==n?void 0:n[0])t=n[0].value;else if(null==r?void 0:r[0])t=r[0].value;else if(null==i?void 0:i[0]){var a;const e=i[0],n=null===(a=e.properties.waid)||void 0===a?void 0:a[0];t=n?(0,f.default)(n):e.value}return t},t.vcardGetOrganizationString=function(e){var t,n;const r=null===(t=e.ORG)||void 0===t?void 0:t[0],i=null===(n=e.TITLE)||void 0===n?void 0:n[0];if(r&&Array.isArray(r.value)&&r.value.length>0){var a;let e=null;(null==i?void 0:i.value)&&(e=`${i.value}`.trim());const[t,...n]=r.value;n.push(t);const o=n.map((e=>(0,d.isString)(e)?e.trim():"")).filter((e=>e.length)).join(m.default.t(407));return(e||"")+((null===(a=e)||void 0===a?void 0:a.length)&&o.length?" - ":"")+o}return""},t.vcardGetType=function(e){const t={jabber:h.fbt._("Jabber",null,{hk:"3usmYV"}),"skype-username":h.fbt._("Skype",null,{hk:"1eW8ty"}),skype:h.fbt._("Skype",null,{hk:"1eW8ty"}),msn:h.fbt._("Windows Live",null,{hk:"Cb3b1"}),aim:h.fbt._("AIM",null,{hk:"1dlOP"}),yahoo:h.fbt._("Yahoo",null,{hk:"1VtQI7"}),icq:h.fbt._("ICQ",null,{hk:"M7uX3"}),"wa-biz-description":h.fbt._("Description",null,{hk:"3NFP7B"}),[v]:h.fbt._("Business Name",null,{hk:"MfcFj"})};let n=e.properties["X-ABLabel"]||t[e.type.toLowerCase()];if(null!=n&&""!==n)return function(e){if(!e)return;return e.replace(/^_\$!<([^>]*)>!\$_$/,"$1").replace(/\\,/,",").replace(/\\;/,";").replace(/\\\\/,"\\")}(String(n));const r={TEL:[[["cell"],h.fbt._("Mobile",null,{hk:"1ciHPV"})],[["iphone"],h.fbt._("iPhone",null,{hk:"2MkuaG"})],[["main"],h.fbt._("Main",null,{hk:"46Vh7G"})],[["home","fax"],h.fbt._("Home Fax",null,{hk:"34IobZ"})],[["work","fax"],h.fbt._("Work Fax",null,{hk:"4FNmsW"})],[["home"],h.fbt._("Home",null,{hk:"2zkVn1"})],[["work"],h.fbt._("Work",null,{hk:"3QfW2u"})],[["pager"],h.fbt._("Pager",null,{hk:"20r5VT"})],[[],h.fbt._("Home",null,{hk:"2zkVn1"})]],EMAIL:[[["home"],h.fbt._("Home",null,{hk:"2zkVn1"})],[["work"],h.fbt._("Work",null,{hk:"3QfW2u"})],[["internet"],h.fbt._("Email",null,{hk:"2Vzd0N"})]],URL:[[["home"],h.fbt._("Home",null,{hk:"2zkVn1"})],[["work"],h.fbt._("Work",null,{hk:"3QfW2u"})]],ADR:[[["home"],h.fbt._("Home",null,{hk:"2zkVn1"})],[["work"],h.fbt._("Work",null,{hk:"3QfW2u"})]]};return n=e.type,(0,c.default)(r,(t=>{if(t){const[r,i]=t;if(0===(0,o.default)(r,(0,a.default)(e.properties.type,(e=>e.toLowerCase()))).length)return n=i,!1}})),n},t.vcardIsBiz=function(e){return(e.SERVICE||[]).some((e=>e.type.toLowerCase()===v&&e.value))},t.vcardSerialize=function(e){return e.map((function(e){return e.line.replace(/(.{75,75})/g,"$1\n ").replace(/\n^-$/gm,"")})).join("\n")},t.vcardThumbnail=function(e){if(!e)return;const{PHOTO:t}=e;if((null==t?void 0:t[0])&&u.default.isData(t[0].value))return t[0].value},t.vcardWids=function(e){let t=[];(null==e?void 0:e.TEL)&&e.TEL.forEach((e=>{var n,r,i;(null!==(n=null===(r=e.properties)||void 0===r||null===(i=r.waid)||void 0===i?void 0:i.length)&&void 0!==n?n:0)>0&&(t=t.concat((0,a.default)(e.properties.waid,p.createUserWid)))}));return t};var i=r(n(63105)),a=r(n(35161)),o=r(n(91966)),s=r(n(84486)),l=r(n(89734)),c=r(n(2525)),d=n(51737),u=r(n(76139)),p=n(45454),f=r(n(62054)),h=n(48360),_=r(n(30381)),g=n(99234),m=r(n(14296));const y=/X-([^;:]+)(?:;[^:]+)*:(.+)/,E={"X-ABLabel":[/X-ABLabel(?:;([^:]+))*:(.+)/,1],ADR:[/ADR(?:;([^:]+))*:;;(.*);(.*);(.*);(.*);(.*)/,5],"X-ABADR":[/X-ABADR(?:;([^:]+))*:(.*)/,1],URL:[/URL(?:;([^:]+))*:(.*)/,1],EMAIL:[/EMAIL(?:;([^:]+))*:(.+)/,1],TEL:[/TEL(?:;([^:]+))*:(.+)/,1]},S={N:[/N(?:;([^:]+))*:([^;]*);([^;]*);([^;]*);([^;]*);(.*)/,5],FN:[/FN(?:;([^:]+))*:(.*)/,1],NICKNAME:[/NICKNAME(?:;([^:]+))*:(.*)/,1],"X-PHONETIC-FIRST-NAME":[/X-PHONETIC-FIRST-NAME(?:;([^:]+))*:(.*)/,1],"X-PHONETIC-LAST-NAME":[/X-PHONETIC-LAST-NAME(?:;([^:]+))*:(.*)/,1],ORG:[/ORG(?:;([^:]+))*:([^;]*)(?:;(.*))*/,2],TITLE:[/TITLE(?:;([^:]+))*:(.*)/,1],TEL:[/TEL(?:;([^:]+))*:(.*)/,1],PHOTO:[/PHOTO(?:;([^:]+))*:(.*)/,1],BDAY:[/BDAY(?:;([^:]+))*:(.*)/,1],URL:[/URL(?:;([^:]+))*:(.+)/,1],EMAIL:[/EMAIL(?:;([^:]+))*:(.+)/,1]},v="wa-biz-name";class T{constructor(e,t,n,r){this.type=e,this.index=t,this.properties=n||{},this.value=r}}function b(e,t,n){e[t]||(e[t]=[]),e[t].push(n)}function C(e){const t={};return e?(e.split(";").forEach((e=>{const n=e.split(/=/);if(1===n.length){const e=n[0];b(t,e.toLowerCase(),!0)}else if(2===n.length){const[e,r]=n;b(t,e.toLowerCase(),r.toLowerCase())}})),t):t}function A(e){return e?e.replace(/\\/g,"\\\\").replace(/;/g,"\\;").replace(/,/g,"\\,"):""}function P(e){const t=e.replace(/\r?\n|\r/g,"\n").replace(/\n^[ \t]/gm,"").split("\n").filter((e=>0!==e.trim().length)),n={},r={};if(t.length<3)return;const i=t[0].trim().toUpperCase(),a=t[1].trim().toUpperCase(),o=t[t.length-1].trim().toUpperCase(),s="VERSION:2.1"===a||"VERSION:3.0"===a||"VERSION:4.0"===a;if("BEGIN:VCARD"!==i||!s||"END:VCARD"!==o)return __LOG__(4,void 0,new Error,!0)`vcard:parse failed because the vCard is not formatted as expected:
Header as expected? ${String("BEGIN:VCARD"===i)}
Version as expected? ${String(s)}
Footer as expected? ${String("END:VCARD"===o)}
Lines: ${t.length}`,void SEND_LOGS("vcard-fault");for(let e=2;e<t.length-1;e++){var u;const i=t[e],a=i.match(/item(\d+)\.(.*)/),o=a?a[2]:i,s=null===(u=o.match(/([^:;]*)[:;].*/))||void 0===u?void 0:u[1];if(null==s)continue;const l=a?E:S;let c,p,f=s,h=s;if(l[f]){const[e,t]=l[f],n=o.match(e);n&&(c=C(n[1]),p=1===t?p=n[2]:n.slice(2,2+t))}else{const e=o.match(y);e&&(h="SERVICE",f=e[1],p=e[2],c={})}if((Array.isArray(p)?p:[p]).some((e=>e&&(0,d.isString)(e)&&e.trim())))if(a){const t=a[1];r[t]?r[t].fields.push(new T(f,null,c,p)):r[t]={type:f,index:e,key:h,properties:c,value:p,fields:[]}}else b(n,h,new T(f,e,c,p))}return Object.keys(r).forEach((e=>{const{key:t,index:i,type:a,value:o,properties:s,fields:l}=r[e];l.forEach((e=>{s[e.type]=e.value})),b(n,t,new T(a,i,s,o))})),function(e){const t={};return(0,c.default)(e,((e,n)=>{t[n]=(0,l.default)(e,(e=>e.index))})),t}(n)}function M(e){const t=(0,i.default)(e.formattedName.split(e.formattedShortName)),n=t.length?t[0].trim():void 0,r=n?e.formattedShortName:e.formattedName;return`${A(n)};${A(r)};;;`}function O(e){return I(e.map((e=>e.displayName)))}function I(e){const t=e.find((e=>!!e));return e.length?t?1===e.length?t:m.default.t(635,{contactName:t,count:e.length-1,_plural:e.length-1}):m.default.t(636,{count:e.length,_plural:e.length}):h.fbt._("No contacts",null,{hk:"1p56oN"})}t.Field=T},81602:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(48926)),a=n(88555),o=r(n(79264)),s=n(11290),l=r(n(52368)),c=r(n(32489));class d extends s.BaseModel{constructor(){super(...arguments),this.online=(0,s.session)(!0),this.waitIfOffline=(0,c.default)((()=>"all"),(0,i.default)((function*(){this.online||((0,a.isMDBackend)()&&"Firefox"!==o.default.info().name&&navigator.onLine?__LOG__(2)`waitIfOffline: XHR online is false, but navigator.onLine is true, resolving promise`:(__LOG__(2)`waitIfOffline: Waiting...`,yield new Promise((e=>{this.listenToOnce(this,"change:online",(()=>{__LOG__(2)`waitIfOffline: Continuing...`,e()}))}))))}))),this.checkOnline=(0,c.default)((()=>"all"),(0,i.default)((function*(){__LOG__(2)`NetworkStatus:checkOnline checking`;try{const e=yield(0,l.default)("https://web.whatsapp.com/status.json");this.online=!!e,__LOG__(2)`NetworkStatus:checkOnline response ${String(this.online)}`}catch(e){__LOG__(3)`NetworkStatus:checkOnline errored! ${String(e)}`}})))}initialize(){this.listenTo(this,"change:online",this._logOnlineOffline),this._logOnlineOffline()}_logOnlineOffline(){const e=this.online;__LOG__(2)`NetworkStatus ${e?"online":"offline"}`}}var u=new((0,s.defineModel)(d));t.default=u},76562:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getEffectiveNetworkType=function(){if(navigator.connection&&"string"==typeof navigator.connection.effectiveType)return navigator.connection.effectiveType;return null}},11854:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(89385),a=r(n(47259)),o=r(n(76139));const s={GET:"GET",POST:"POST",HEAD:"HEAD",PUT:"PUT"};function l(e,t){for(const n in t)e.setRequestHeader(n,t[n])}function c(e,t,n,r,c,d,u){const p=new XMLHttpRequest,f=new Promise(((r,i)=>{if(p.onload=function(e){4===p.readyState?r(p):(__LOG__(4,void 0,new Error)`xhr.request:onload`,i(e))},p.onerror=e=>{__LOG__(4,void 0,new Error)`xhr.request:onerror`,i(e)},p.ontimeout=e=>{__LOG__(4,void 0,new Error)`xhr.request:ontimeout`,i(e)},d&&(p.onprogress=d),p.onabort=e=>{__LOG__(4,void 0,new Error)`xhr.request:onabort`,i(e)},n instanceof FormData)p.open(t||s.POST,e,!0),c&&(p.responseType=c),u&&l(p,u),p.send(n);else if(n instanceof Object){const r=o.default.build(e,n);p.open(t||s.GET,r,!0),c&&(p.responseType=c),u&&l(p,u),p.send()}else p.open(t||s.GET,e,!0),c&&(p.responseType=c),u&&l(p,u),p.send()})),h=(0,a.default)(f,r).cancellable();return h.catch((0,i.catchAbort)((()=>{p.abort()}))).catch((()=>{})),h}var d={head:function(e,t){return c(e,s.HEAD,null,t)},get:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3?arguments[3]:void 0;return c(e,s.GET,null,r,t,void 0,n)},post:function(e,t,n){return c(e,s.POST,t,n)},request:c,VERB:s,RESP_TYPE:{ARRAY_BUFFER:"arraybuffer",BLOB:"blob",JSON:"json"}};t.default=d},52368:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;return i.default.request(e,t,n,a,r).then((e=>e.status&&e.status<12e3?e:null)).catch((()=>null))};var i=r(n(11854))},23082:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MmsDownloadFilehashMismatchError=t.HttpTimedOutError=t.HttpStatusCodeError=t.HttpNetworkError=t.HttpInvalidResponseError=void 0;var r=n(40265);class i extends((0,r.customError)("HttpNetworkError")){}t.HttpNetworkError=i;t.HttpTimedOutError=class extends i{constructor(){super(...arguments),this.name="HttpTimedOutError"}};class a extends((0,r.customError)("HttpStatusCodeError")){constructor(e,t,n){super(`${t}: ${e}`),this.status=e}}t.HttpStatusCodeError=a;class o extends((0,r.customError)("HttpInvalidResponseError")){constructor(e,t){super(e)}}t.HttpInvalidResponseError=o;t.MmsDownloadFilehashMismatchError=class extends o{constructor(e){super("mmsDownload: filehash mismatch",e),this.name="MmsDownloadFilehashMismatchError"}}},61181:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.extendedFetch=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return h(e,t).catch((e=>{if(e.name===o.ABORT_ERROR)throw new o.AbortError;if(e instanceof l.HttpNetworkError)throw e;throw new l.HttpNetworkError(e.message)}))},t.sharedFetch=h;var i=r(n(48926)),a=r(n(81109)),o=n(89385),s=n(76100),l=n(23082),c=n(25241),d=r(n(3905)),u=r(n(16566)),p=n(64551);const f=n(76672)({UNSENT:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4});function h(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(((n,r)=>{var o;if(null===(o=t.signal)||void 0===o?void 0:o.aborted)return void r(new c.DOMException("AbortError"));const h=new XMLHttpRequest;if(t.signal){const e=t.signal;e.addEventListener("abort",(function t(){e.removeEventListener("abort",t),h.onreadystatechange=()=>{},h.abort(),r(new c.DOMException("AbortError"))}))}const{onProgress:_,onResponseText:g}=t;var m;(null!=_||g)&&((p.ServerProps.webLargeFilesUi&&"post"===(null===(m=t.method)||void 0===m?void 0:m.toLowerCase())?h.upload:h).onprogress=e=>{g&&g(e,h.responseText),_&&_(e)});const{onHeadersReceived:y}=t;h.onreadystatechange=()=>{if(h.readyState===f.UNSENT)r(new Error("fetch error: not sent"));else if(h.readyState===f.HEADERS_RECEIVED&&null!=y)y(new d.default((0,u.default)(h.getAllResponseHeaders())));else if(h.readyState===f.DONE){if(null==h.status)return void r(new Error("fetch error: no status"));if(0===h.status||h.status>=12e3)return void r(new Error(`fetch error: unexpected status ${h.status}`));n(S())}},h.onerror=()=>r(new Error("fetch error: error")),h.ontimeout=()=>{r(new l.HttpTimedOutError("fetch error: timedout"))},h.withCredentials="include"===t.credentials,null!=t.timeout&&(h.timeout=t.timeout),h.open(t.method||"get",e.toString(),!0);const E=new d.default(t.headers||{});for(const e of E.keys()){const t=E.get(e);null!=t&&h.setRequestHeader(e,t)}function S(){const e=new d.default((0,u.default)(h.getAllResponseHeaders()));return(0,a.default)((0,a.default)({ok:200<=h.status&&h.status<300,statusText:h.statusText,status:h.status,url:h.responseURL},function(){if(g)return{text:()=>Promise.resolve(h.responseText),json:()=>Promise.resolve(JSON.parse(h.responseText)),arrayBuffer:()=>(0,s.largeStringToArrayBuffer)(h.responseText)};return{text:()=>v(),json:(e=(0,i.default)((function*(){const e=yield v();return JSON.parse(e)})),function(){return e.apply(this,arguments)}),arrayBuffer:()=>h.response};var e}()),{},{blob:()=>Promise.resolve(new Blob([h.response],{type:e.get("content-type")||""})),clone:S,headers:e})}function v(){return Promise.resolve(String.fromCharCode(...Array.from(new Uint8Array(h.response))))}g?h.overrideMimeType("text/plain; charset=x-user-defined"):h.responseType="arraybuffer",h.send(t.body||null)}))}},16566:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return(e||"").trim().toLowerCase().split("\n").reduce(((e,t)=>{if(!t.trim())return e;const n=t.indexOf(":"),r=t.substr(0,n).trim(),i=t.substr(n+1).trim().replace(/;$/,"");return e[r]?Array.isArray(e[r])?e[r].push(i):e[r]+=`, ${i}`:e[r]=i,e}),{})}},70740:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return(0,i.default)(e,a)};var i=r(n(14176));const a=e=>null==e},26847:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(81109)),a=n(61181);const o=()=>{};var s="fetch"in window?fetch:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,a.sharedFetch)(e,(0,i.default)((0,i.default)({},t),{},{onProgress:o}))};t.default=s},56624:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(26741);["webkitGetUserMedia"].forEach((function(e){const t=Object.getPrototypeOf(navigator)[e];t&&navigator[e]!==t&&(navigator[e]=t)}));var i=function(){var e;if(r.UA.isBrokenGetUserMedia)return null;const t=null===(e=navigator.mediaDevices)||void 0===e?void 0:e.getUserMedia;if(t)return t.bind(navigator.mediaDevices);const n=navigator.getUserMedia||navigator.mozGetUserMedia||navigator.webkitGetUserMedia;return n?function(e){return new Promise((function(t,r){n.call(navigator,e,t,r)}))}:null}();t.default=i},3905:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(85396),a=r(n(17946));let o;var s="Headers"in window&&Headers?Headers:(o=a.default.iterator,class e{constructor(t){if(this._headers={},t instanceof e)for(const e of t.entries()){const[t,n]=e;n.split(", ").forEach((e=>{this.append(t,e)}))}else if("object"==typeof t)for(const e in t){t[e].split(", ").forEach((t=>{this.append(e,t)}))}}append(e,t){const n=e.toLowerCase();n in this._headers?this._headers[n].push(t):this._headers[n]=[t]}delete(e){const t=e.toLowerCase();delete this._headers[t]}entries(){const e=Object.keys(this._headers).map((e=>[e,this.get(e)||""]));return(0,i.iteratorFromArray)(e)}get(e){const t=e.toLowerCase();return t in this._headers?this._headers[t].join(", "):null}has(e){return e.toLowerCase()in this._headers}keys(){return(0,i.mapIterator)(this.entries(),(e=>{let[t]=e;return t}))}set(e,t){const n=e.toLowerCase();this._headers[n]=[t]}values(){return(0,i.mapIterator)(this.entries(),(e=>{let[t,n]=e;return n}))}[o](){return this.entries()}toString(){return"[Object Headers]"}});t.default=s},90466:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.requestIdleCallback=t.cancelIdleCallback=void 0;const n=window.requestIdleCallback,r=window.cancelIdleCallback,i="requestIdleCallback"in window?n:function(e){return setTimeout((()=>{const t=Date.now();e({didTimeout:!1,timeRemaining:()=>Math.max(0,50-(Date.now()-t))})}),1)};t.requestIdleCallback=i;const a="cancelIdleCallback"in window?r:function(e){clearTimeout(e)};t.cancelIdleCallback=a},67707:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=window.MediaError||{MEDIA_ERR_ABORTED:1,MEDIA_ERR_NETWORK:2,MEDIA_ERR_DECODE:3,MEDIA_ERR_SRC_NOT_SUPPORTED:4};t.default=n},17946:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r="Symbol"in window?Symbol:((n=class{}).iterator="@@iterator",n);t.default=r},53565:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,n(35449);var r=URLSearchParams;t.default=r},45007:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){return(0,o.default)(e,function(){var r=(0,i.default)((function*(r){if(r.signal.aborted)throw new a.AbortError;const i=e(r),o=yield t.get(i,r);if(r.signal.aborted)throw new a.AbortError;if(null!=o)return o;const s=yield n(r);if(r.signal.aborted)throw new a.AbortError;return yield t.set(i,s,r),s}));return function(){return r.apply(this,arguments)}}())};var i=r(n(48926)),a=n(89385),o=r(n(32489))},48446:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return t.catch((0,r.catchAbort)((()=>{}))).catch((function(t){e.cancel(t)})),t};var r=n(89385)},38498:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.backoff=function(e,t){const{signal:n,timeoutIterator:r,timeoutIncludesTaskDuration:l}=(0,i.default)((0,i.default)({},s),e);return(0,a.default)((e=>{let{retry:n,failCount:i}=e;return new Promise(((e,a)=>{const s=Date.now();try{t((function(e){return Promise.reject(new o.default(e))}),i).then(e).catch(c)}catch(e){return void c(e)}function c(e){if(!(e instanceof o.default))return void a(e);const t=r.next();if(t.done)return void a(e.source);const i=Date.now()-s,c=l?Math.max(t.value-i,0):t.value;n(c)}}))}),n)},t.defaults=void 0;var i=r(n(81109)),a=r(n(29049)),o=r(n(9143));const s=Object.freeze({timeoutIncludesTaskDuration:!0});t.defaults=s},96177:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.backoff=function(){return c.apply(this,arguments)};var i=r(n(81109)),a=r(n(48926)),o=n(13959),s=r(n(9143));const l={retries:1/0};function c(){return(c=(0,a.default)((function*(e,t){const{delay:n,signal:r,retries:a}=(0,i.default)((0,i.default)({},l),e);let c=0,d=Date.now(),u=null;const p=e=>Promise.reject(new s.default(e));try{return d=Date.now(),yield t(p,c,r)}catch(f){if(c++,!(f instanceof s.default))throw f;u=f}for(;c<=a;){const e=n({iterationCount:c,taskDuration:Date.now()-d});yield(0,o.delayMs)(e,r);try{return d=Date.now(),yield t(p,c,r)}catch(f){if(c++,!(f instanceof s.default))throw f;u=f}}if(!u)throw new Error("assert: backoff completed without error or result");const f=undefined;throw u.source}))).apply(this,arguments)}},19770:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.exponentialBackoff=function(e,t){const n=(0,a.default)((0,a.default)({},c),e),{signal:r,timeoutIncludesTaskDuration:d}=n,u=(0,i.default)(n,l),p=(0,o.exponentialBackoffIterator)(u);return(0,s.backoff)({signal:r,timeoutIterator:p,timeoutIncludesTaskDuration:d},t)};var i=r(n(6479)),a=r(n(81109)),o=n(62971),s=n(38498);const l=["signal","timeoutIncludesTaskDuration"],c=(0,a.default)((0,a.default)({},o.defaults),s.defaults)},32489:(e,t,n)=>{"use strict";var r=n(59182).default,i=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){const n=new Map;return function(i){if(i.signal.aborted)return Promise.reject(new o.AbortError);const c=e.call(this,i);let d=n.get(c);if(null==d||d.aggregator.signal.aborted){const e=new l.default,r=(0,a.default)((0,a.default)({},i),{},{signal:e.signal});d={aggregator:e,promise:t.call(this,r).finally((()=>{e.dispose(),n.delete(c)}))},n.set(c,d)}const u=i.signal||(new r).signal;return d.aggregator.add(u),(0,s.default)(d.promise,u)}};var a=i(n(81109)),o=n(89385),s=i(n(47259)),l=i(n(75783))},6704:(e,t,n)=>{"use strict";var r=n(59182).default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){let n;const i=new r;if(e.some((e=>e.aborted)))i.abort();else{n=()=>{for(const n of e)n.removeEventListener("abort",t);n=null};const t=()=>{var e;null===(e=n)||void 0===e||e(),i.abort()};for(const n of e)n.addEventListener("abort",t)}return t(i.signal).finally((()=>{var e;null===(e=n)||void 0===e||e()}))}},29049:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return new Promise(((n,i)=>{let a,o=0,s=!1;if(t){const e=()=>{t.removeEventListener("abort",e),s=!0,null!=a&&clearTimeout(a),i(new r.AbortError)};if(t.aborted)return void e();t.addEventListener("abort",e)}!function t(){let r=!1,l=!1;a=null;try{const c=e({retry:e=>{if(!s&&!l){if(r=!0,o++,null==e)return t();a=setTimeout(t,e)}},failCount:o});if(!(c instanceof Promise))throw new TypeError("task must return a promise");c.then((e=>{s||r||(l=!0,n(e))})).catch((e=>{s||r||(l=!0,i(e))}))}catch(e){if(s||r)return;i(e)}}()}))};var r=n(89385)},9143:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(40265);class i extends((0,r.customError)("RetryableError")){constructor(e){super("see error at this.source"),this.source=e}}t.default=i},75783:(e,t,n)=>{"use strict";var r=n(59182).default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default=class{constructor(){this._disposed=!1,this._controller=new r,this._signals=new Set,this.signal=this._controller.signal,this._handleAbort=e=>{this.delete(e.currentTarget),this._checkAborted()}}add(){this._throwIfDisposed();for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(const e of t)e.aborted||(e.addEventListener("abort",this._handleAbort),this._signals.add(e));this._checkAborted()}_checkAborted(){if(this._disposed)return;Array.from(this._signals).every((e=>e.aborted))&&(this.dispose(),this._controller.abort())}delete(){this._throwIfDisposed(),this._delete(...arguments)}_delete(){let e=!1;for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(const t of n)this._signals.delete(t)&&(e=!0,t.removeEventListener("abort",this._handleAbort));e&&this._checkAborted()}_throwIfDisposed(){if(this._disposed)throw new Error("Attempt to modify disposed SignalAggregator")}dispose(){if(!this._disposed){this._disposed=!0;for(const e of this._signals)this._delete(e)}}}},25613:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(48926));class a{constructor(e){this._handleMessage=e=>{if(!e.data||!e.data.action)return;const t=e.data;if(!e.ports||0===e.ports.length)return;const n=e.ports;if(!a.isSW()&&window.navigator.serviceWorker&&e.source!==window.navigator.serviceWorker.controller)return;("function"==typeof e.waitUntil?t=>e.waitUntil(t):()=>{})(Promise.resolve(this.requestHandler(t)).then((e=>{n[0].postMessage(e)})).catch((e=>{n[0].postMessage({error:e&&e.toString()})})))},this.requestHandler=e}init(){const e=a.isSW()?self:window.navigator.serviceWorker;try{if(!e)return;e.addEventListener("message",this._handleMessage)}catch(e){}}static isSW(){return"undefined"==typeof window}static getRequestor(e){return a.isSW()?"string"==typeof e?self.clients.get(e):Promise.resolve(e):window.navigator.serviceWorker?window.navigator.serviceWorker.ready.then((()=>window.navigator.serviceWorker?window.navigator.serviceWorker.controller:null)):Promise.resolve(null)}static broadcast(e,t){return(0,i.default)((function*(){if(!a.isSW())throw new Error("Broadcast called from non-serviceworker.");const n=yield self.clients.matchAll();return 0===n.length?Promise.reject(new Error("No clients available.")):Promise.all(n.map((n=>a.request(n,e,t))))}))()}static request(e,t,n){const r=new MessageChannel;return new Promise(((i,o)=>(r.port1.onmessage=e=>{var t;(null===(t=e.data)||void 0===t?void 0:t.error)?o(e.data.error):i(e.data)},a.getRequestor(e).then((e=>{if(!e)return o(new Error("No ServiceWorker controlling this client."));e.postMessage({action:t,message:n,version:"2.2210.9"},[r.port2])})))))}}t.default=a},64237:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={REQUEST_STREAMING_INFO:"GET_STREAMING_INFO",REQUEST_RMR:"REQUEST_RMR",SEND_STREAMING_CHUNK:"SEND_STREAMING_CHUNK",EXP_BACKOFF:"EXP_BACKOFF",LOG:"LOG",UPLOAD_LOGS:"UPLOAD_LOGS",REQUEST_DOCUMENT_DOWNLOAD:"REQUEST_DOCUMENT_DOWNLOAD",SET_L10N:"SET_L10N",STREAMING_SUPPORTED:"STREAMING_SUPPORTED",REMOVE_PP:"REMOVE_PP",LOGOUT:"LOGOUT",CLEAN_ASSETS:"CLEAN_ASSETS",PRELOAD_LAZY_LOADED_BUNDLES:"PRELOAD_LAZY_LOADED_BUNDLES",ACTIVE_TAB:"ACTIVE_TAB"};t.default=n},38125:(e,t,n)=>{"use strict";var r=n(95318),i=n(39948),a=r(n(25613)),o=r(n(64237)),s=r(n(92658)),l=n(88102),c=n(46582),d=n(27838),u=n(62583),p=n(8080),f=n(65044);if(s.default.supported){const e=function(){try{const e=navigator.serviceWorker;(null==e?void 0:e.controller)&&e.controller.addEventListener("error",(e=>{f.Socket.state!==u.SOCKET_STATE.UNLAUNCHED&&__LOG__(3)`ServiceWorker controller error: ${e.error}`}))}catch(e){__LOG__(3)`Unable to add "error" event listener to service worker, error: ${e}`}};try{const t=navigator.serviceWorker;t&&t.addEventListener("controllerchange",(()=>{e(),f.Socket.state===u.SOCKET_STATE.UNLAUNCHED&&(p.Stream.needsUpdate=!0)}))}catch(e){__LOG__(3)`Unable to add "controllerchange" event listener to service worker container, error: ${e}`}try{const e=navigator.serviceWorker;e&&e.addEventListener("error",(e=>{f.Socket.state!==u.SOCKET_STATE.UNLAUNCHED&&__LOG__(3)`ServiceWorker container error: ${e.error}`}))}catch(e){__LOG__(3)`Unable to add "error" event listener to service worker container, error: ${e}`}e();const t=function(e,t){e.buffer.forEach((e=>{var n;const r=null!==(n=e.message[0])&&void 0!==n?n:"",a=function(e){switch(e){case"info":return 1;case"log":return 2;case"warn":return 3;case"error":return 4}throw new Error(`Invalid level: ${e}`)}(e.level.match(/^(.*?)(?:Verbose)?$/i)[1]);i.Logger.logImpl(a,`ServiceWorker (${t}): ${r}`,e.error,e.attachedToSendLogs,e.extraTags)}))};new a.default((e=>{let{action:r,message:i,version:a}=e;switch(r){case o.default.REQUEST_STREAMING_INFO:case o.default.EXP_BACKOFF:case o.default.REQUEST_RMR:case o.default.SEND_STREAMING_CHUNK:return(0,c.requireHandleVideoStreamingRequest)().then((e=>e({action:r,message:i})));case o.default.LOG:if(f.Socket.state===u.SOCKET_STATE.UNLAUNCHED)return;return i&&t(i,a),{test:!0};case o.default.UPLOAD_LOGS:i&&t(i,a);return n(86374).upload({reason:"Requested by Service Worker"}).then((()=>{}));case o.default.ACTIVE_TAB:return{isActive:(0,d.getIsTabActive)()};default:return Promise.reject(new Error(`Invalid Action: ${r}`))}})).init(),l.Cmd.on("logout",(()=>{const e=navigator.serviceWorker;(null==e?void 0:e.controller)&&a.default.request(e.controller,o.default.LOGOUT).catch((()=>{}))}))}},13684:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(48926));t.default=class{open(){return this._openPromise?this._openPromise:this._closePromise?(this._openPromise=this._closePromise.catch((e=>{throw this._openPromise=null,e})).then((()=>(this._openPromise=null,this.open()))),this._openPromise):(this._openPromise=this.doOpen().catch((e=>{throw this._openPromise=null,e})).then((()=>{this._openPromise=null})),this._openPromise)}close(){return this._closePromise?this._closePromise:this._openPromise?(this._closePromise=this._openPromise.catch((e=>{throw this._closePromise=null,e})).then((()=>(this._closePromise=null,this.close()))),this._closePromise):(this._closePromise=this.doClose().catch((e=>{throw this._closePromise=null,e})).then((()=>{this._closePromise=null})),this._closePromise)}get(e){var t=this;return(0,i.default)((function*(){return yield t.open(),t.doGet(e)}))()}queryByIndex(e,t){var n=this;return(0,i.default)((function*(){return yield n.open(),n.doQueryByIndex(e,t)}))()}getAll(){var e=this;return(0,i.default)((function*(){return yield e.open(),e.doGetAll()}))()}put(e,t){var n=this;return(0,i.default)((function*(){return yield n.open(),n.doPut(e,t)}))()}del(e){var t=this;return(0,i.default)((function*(){return yield t.open(),t.doDel(e)}))()}count(){var e=this;return(0,i.default)((function*(){return yield e.open(),e.doCount()}))()}clear(){var e=this;return(0,i.default)((function*(){return yield e.open(),e.doClear()}))()}doGet(){throw new Error("Not implemented")}doQueryByIndex(){throw new Error("Not implemented")}doGetAll(){throw new Error("Not implemented")}doPut(){throw new Error("Not implemented")}doDel(){throw new Error("Not implemented")}doCount(){throw new Error("Not implemented")}doClear(){throw new Error("Not implemented")}doOpen(){throw new Error("Not implemented")}doClose(){throw new Error("Not implemented")}}},26945:(e,t)=>{"use strict";let n;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;try{n=self.indexedDB}catch(e){}var r=n;t.default=r},5558:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.WEB_IDB_DB_NAMES=void 0,t.deleteAllIdb=function(){return l.apply(this,arguments)};var i=r(n(48926)),a=n(38284),o=r(n(86128));const s={__dbnames:"__dbnames",fts_storage:"fts-storage",fts_loadgen_metadata:"loadgen-storage",_hsm_storage_DEPRECATED:"hsm-storage",jobs_storage:"jobs-storage",lru_media_storage_idb:"lru-media-storage-idb",model_storage:"model-storage",offd_storage:"offd-storage",signal_storage:"signal-storage",sw:"sw",wawc:"wawc",wawc_db_enc:"wawc_db_enc",qpl_storage:"qpl-storage"};function l(){return(l=(0,i.default)((function*(){const e=Object.keys(s).map((e=>s[e]));let t=!1;const n=e.map(function(){var e=(0,i.default)((function*(e){if("__dbnames"!==e&&"sw"!==e)try{yield(0,a.promiseTimeout)(Promise.resolve(o.default.delete(e)),7e3)}catch(e){t=!0}}));return function(){return e.apply(this,arguments)}}());return yield Promise.all(n),t}))).apply(this,arguments)}t.WEB_IDB_DB_NAMES=s},4285:(e,t)=>{"use strict";let n;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;try{n=window.localStorage}catch(e){}var r=n;t.default=r},45234:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(48926)),a=r(n(2525)),o=r(n(4285)),s=r(n(11554));var l=new class{constructor(){this.dataStore={}}setItem(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.dataStore[e]=t,null!=o.default&&o.default.setItem(e,t),n&&s.default.idb().then((n=>n.user.put({key:e,value:t}))).catch((e=>{__LOG__(3)`db:setItem:Error ${e}`}))}getItem(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===this.dataStore[e]||t){if(null!=o.default){const t=o.default.getItem(e);return null!=t&&this.setItem(e,t,!1),t}return null}return this.dataStore[e]}removeItem(e){delete this.dataStore[e],null!=o.default&&o.default.removeItem(e),s.default.idb().then((t=>t.user.delete(e))).catch((e=>{__LOG__(3)`db:removeItem:Error ${e}`}))}clear(e){var t=this;return(0,i.default)((function*(){t.dataStore={},null!=o.default&&(o.default.clear(),e&&(0,a.default)(e,(function(e,t){o.default.setItem(t,e)}))),yield s.default.idb().then((e=>e.user.clear())).catch((e=>{__LOG__(3)`db:clear:Error ${e}`}))}))()}};t.default=l},39312:(e,t)=>{"use strict";let n;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;try{n=window.sessionStorage}catch(e){}var r=n;t.default=r},24609:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(2525)),a=r(n(45095)),o=n(51737),s=r(n(39312)),l=n(72407);var c=(()=>{try{const e=(0,a.default)(s.default,"sessionStorage");return e.setItem(l.KEYS.STORAGE_TEST,l.KEYS.STORAGE_TEST),(0,o.isFunction)(e.clear)}catch(e){return!1}})()?new class{constructor(){this.dataStore={}}setItem(e,t){this.dataStore[e]=t,(0,a.default)(s.default,"sessionStorage").setItem(e,t)}getItem(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return null==this.dataStore[e]||t?(0,a.default)(s.default,"sessionStorage").getItem(e):this.dataStore[e]}removeItem(e){delete this.dataStore[e],(0,a.default)(s.default,"sessionStorage").removeItem(e)}clear(e){return this.dataStore={},(0,a.default)(s.default,"sessionStorage").clear(),e&&(0,i.default)(e,(function(e,t){(0,a.default)(s.default,"sessionStorage").setItem(t,e)})),Promise.resolve()}}:new class{constructor(){this.dataStore={}}setItem(e,t){this.dataStore[e]=t}getItem(e){return void 0===this.dataStore[e]?null:this.dataStore[e]}removeItem(e){delete this.dataStore[e]}clear(){return this.dataStore={},Promise.resolve()}};t.default=c},20869:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.initWAWC=function(){return i.default.openDB()};var i=r(n(11554))},10635:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.genDeviceNotificationMsg=function(e,t,n,r){const l=(0,s.assertGetMe)(),c=new a.default({fromMe:t.equals((0,o.toUserWid)(l)),remote:e,id:a.default.newId()}),d=c.fromMe&&n.includes(l.getDeviceId());return{id:c,t:(0,i.unixTime)(),type:"e2e_notification",subtype:"device",from:e,to:(0,o.toUserWid)(l),body:t.toString(),devicesAdded:n.length,devicesRemoved:r.length,isThisDeviceAdded:d}},t.genDisappearingModeSystemMsg=function(e,t,n){const r=n?(0,s.getMeUser)():e,i=[String(t),r];return l(e,"notification_template","disappearing_mode",i)},t.genEncryptNotificationMsg=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"encrypt";return l(e,"e2e_notification",t,[])},t.genErrorInDeviceListNotificationMsg=function(e,t){const n=(0,s.assertGetMe)();return{id:new a.default({fromMe:!1,remote:e,id:a.default.newId()}),t:(0,i.unixTime)(),type:"e2e_notification",subtype:"error_in_device_list",from:e,to:(0,o.toUserWid)(n),templateParams:[t]}},t.genNotificationMsg=l,t.genSecurityCodeNotificationMsg=function(e,t){const n=(0,s.getMeUser)();return{id:new a.default({fromMe:t.equals(n),remote:e,id:a.default.newId()}),t:(0,i.unixTime)(),type:"e2e_notification",subtype:"identity",from:e,to:n,body:t.toString()}},t.genTealNotificationTemplateMsg=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return l(e,"notification_template",t,n)};var i=n(92844),a=r(n(65212)),o=n(45454),s=n(99234);function l(e,t,n,r){const o=(0,s.getMeUser)();return{id:new a.default({fromMe:e.equals(o),remote:e,id:a.default.newId()}),t:(0,i.unixTime)(),type:t,subtype:n,from:e,to:o,templateParams:r}}},26947:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if((0,i.isMDBackend)()&&!e.isGroupMsg&&0===t.msgs.length)return(0,a.default)(t.id,t.contact.privacyMode);return null};var i=n(88555),a=r(n(29224))},77345:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.genGroupCreationMsg=function(e,t){var n,r,a;const{chatId:s}=e,l=null!==(n=null!==(r=t.owner)&&void 0!==r?r:e.author)&&void 0!==n?n:(0,o.getMaybeMeUser)(),c=t.subject;return{id:new i.default({remote:s,fromMe:!1,participant:l,id:i.default.newId()}),author:l,body:c,from:s,recipients:[],self:"in",subtype:"create",t:null!==(a=t.creation)&&void 0!==a?a:e.ts,type:"gp2"}},t.genGroupEphemeralSettingMsg=function(e,t,n,r){return{id:new i.default({remote:e,fromMe:!1,participant:n,id:i.default.newId()}),author:n,from:e,recipients:[],self:"in",subtype:"ephemeral",t,type:"gp2",templateParams:[`${r}`]}},t.genGroupNotificationMsg=function(e,t){const{chatId:n}=e,r=e.author&&(0,a.toUserWid)(e.author)||void 0;let o=null,l=[],c=r,d=t.action,u=null;switch(t.action){case s.GROUP_ACTIONS.SUBJECT:o=t.subject;break;case s.GROUP_ACTIONS.MODIFY:l=t.participants;break;case s.GROUP_ACTIONS.ADD:t.isInvite&&(d="invite");case s.GROUP_ACTIONS.PROMOTE:case s.GROUP_ACTIONS.DEMOTE:case s.GROUP_ACTIONS.REMOVE:l=t.participants,1===l.length&&(c=l[0]),t.action===s.GROUP_ACTIONS.REMOVE&&1===l.length&&r===c&&(d="leave");break;case s.GROUP_ACTIONS.DELETE:d="leave";break;case s.GROUP_ACTIONS.INVITE_CODE:d="revoke_invite";break;case s.GROUP_ACTIONS.DESC_ADD:d="description",o=t.desc;break;case s.GROUP_ACTIONS.DESC_REMOVE:d="description";break;case s.GROUP_ACTIONS.RESTRICT:case s.GROUP_ACTIONS.ANNOUNCE:case s.GROUP_ACTIONS.NO_FORWARD:u=t.value?["on"]:["off"],o=u[0];break;case s.GROUP_ACTIONS.EPHEMERAL:r&&(u=[`${t.duration}`,r]);break;case s.GROUP_ACTIONS.GROWTH_LOCKED:u=[t.type],o=u[0];break;case s.GROUP_ACTIONS.SUB_GROUP_LINK:case s.GROUP_ACTIONS.PARENT_GROUP_LINK:case s.GROUP_ACTIONS.SIBLING_GROUP_LINK:u=[...t.groups]}const p={id:new i.default({remote:n,fromMe:!1,participant:c,id:i.default.newId()}),author:r,from:n,recipients:l.map(a.toUserWid)||[],self:"in",subtype:d,t:e.ts,type:"gp2"};o&&(p.body=o);u&&(p.templateParams=u);return p},t.genGroupPicChangeNotificationMsg=function(e,t,n,r){return{type:"gp2",self:"in",subtype:"picture",t:n,author:r,body:t,recipients:[],from:e,id:new i.default({remote:e,fromMe:!1,id:i.default.newId()})}},t.genIntialPhashMismatchMsg=function(e,t){return{id:new i.default({remote:e,fromMe:!1,id:i.default.newId()}),from:e,recipients:[],self:"in",subtype:"initial_pHash_mismatch",t,type:"gp2"}};var i=r(n(65212)),a=n(45454),o=n(99234),s=n(36098)},29224:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){switch((0,i.getReducedPrivacyMode)(t)){case i.ReducedPrivacyMode.E2EE:return(0,r.genEncryptNotificationMsg)(e);case i.ReducedPrivacyMode.BSP:return(0,r.genTealNotificationTemplateMsg)(e,"biz_privacy_mode_init_bsp");case i.ReducedPrivacyMode.FB:return(0,r.genTealNotificationTemplateMsg)(e,"biz_privacy_mode_init_fb")}};var r=n(10635),i=n(8197)},1559:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.genPaymentInviteAccoutSetupMsg=function(e,t){return{id:new i.default({remote:e,fromMe:!1,id:i.default.newId()}),from:e,recipients:[],self:"in",subtype:"payment_invite_account_set_up",t,type:a.MSG_TYPE.NOTIFICATION_TEMPLATE,templateParams:[e]}};var i=r(n(65212)),a=n(15461)},8197:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ReducedPrivacyMode=void 0,t.comparePrivacyMode=function(e,t){return null==e&&null==t?0:null==t?1:null==e?-1:e.privacyModeTs-t.privacyModeTs},t.getContactPrivacyMode=function(e){if(!i.default.isUser(e))return;const t=n(19380).ContactCollection.get(e);return null==t?void 0:t.privacyMode},t.getLatestPrivacyMode=function(e,t){return null==e?t:null==t||e.privacyModeTs>t.privacyModeTs?e:t},t.getPrivacyModeFromQueryExistResponse=function(e){var t;const n=null===(t=e.bizInfo)||void 0===t?void 0:t.verifiedName;return null==n?null:e.biz&&!0===n.isApi?n.privacyMode:null},t.getReducedPrivacyMode=function(e){if(null==e||e.actualActors===a.ActualActorsEnumType.Self&&e.hostStorage===a.HostStorageEnumType.OnPremise)return o.E2EE;if(e.hostStorage===a.HostStorageEnumType.Facebook)return o.FB;return o.BSP};var i=r(n(89867)),a=n(49714);const o=n(76672).Mirrored(["E2EE","BSP","FB"]);t.ReducedPrivacyMode=o},85074:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(73955)),a=n(67924),o=n(40234),s=n(85553);var l=new class{constructor(){this._alarms=new Map;const e=()=>{this._alarms.size>0&&this._validateTimeouts()};s.jsHaltDetector.on(a.JS_HALT_EVENT,e),s.jsHaltDetector.on(a.CLOCK_CHANGE_BACKWARDS_EVENT,e),o.Clock.on(o.SKEW_CHANGE_EVENT,this._resetGlobalTimeouts.bind(this))}setLocalTimeout(e,t,n){return this._setTimeout(!1,e,t,n)}setGlobalTimeout(e,t,n){return this._setTimeout(!0,e,t,n)}clearTimeout(e){if(!e)return;const t=this._alarms.get(e);t&&(window.clearTimeout(t.timeoutId),this._alarms.delete(e))}_setTimeout(e,t,n,r){r&&this.clearTimeout(r);const a=r||(0,i.default)("alarm_timer_"),o=n-this._getTimeInMS(e),l=Math.min(o,2147483647);if(o<0)return __LOG__(2)`Alarm:setTimeout:Cannot set alarm in the past.`,t(),a;const c=window.setTimeout((()=>{n-this._getTimeInMS(e)<s.DEFAULT_THRESHOLD?(this._alarms.delete(a),t()):this._setTimeout(e,t,n,a)}),l);return this._alarms.set(a,{isGlobal:e,fn:t,expiration:n,timeoutId:c}),a}_validateTimeouts(){new Map(this._alarms).forEach(((e,t)=>{const{isGlobal:n,fn:r,expiration:i}=e;i<this._getTimeInMS(n)?(this.clearTimeout(t),r()):this._setTimeout(n,r,i,t)}))}_resetGlobalTimeouts(){new Map(this._alarms).forEach(((e,t)=>{const{isGlobal:n,fn:r,expiration:i}=e;n&&this._setTimeout(n,r,i,t)}))}_getTimeInMS(){return 1e3*(arguments.length>0&&void 0!==arguments[0]&&arguments[0]?o.Clock.globalUnixTime():o.Clock.localUnixTime())}};t.default=l},40234:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.SKEW_CHANGE_EVENT=t.HOUR24_FORMAT_CHANGE_EVENT=t.Clock=void 0;var i=r(n(81109)),a=n(92844),o=r(n(76521)),s=n(48360),l=r(n(30381)),c=r(n(14296)),d=n(33970),u=n(22476);const p=["fi","id","ms","ms-my"],f="skew_change";t.SKEW_CHANGE_EVENT=f;const h="hour24_format_change";t.HOUR24_FORMAT_CHANGE_EVENT=h;class _ extends o.default{constructor(){if(super(),this.is24h=!1,this.skewMS=0,this.skew=0,Intl.DateTimeFormat&&Intl.DateTimeFormat().resolvedOptions){const e=Intl.DateTimeFormat().resolvedOptions().timeZone;switch(e?__LOG__(2)`Intl.DateTimeFormat().resolvedOptions().timeZone is ${e}`:__LOG__(2)`Intl.DateTimeFormat().resolvedOptions().timeZone does not exist`,e){case"America/Sao_Paulo":this.timeZoneHardCode="America/Belem";break;case"America/Campo_Grande":case"America/Cuiaba":this.timeZoneHardCode="America/Porto_Velho"}}}getIs24Hour(){return this.is24h}setIs24Hour(e){e!==this.is24h&&(this.is24h=e,this.trigger(h))}setIs24HourBasedOnLocale(){this.setIs24Hour(d.LOCALES_THAT_PREFER_24HOUR_TIME.has(c.default.getLocale()))}setSkew(e){Math.abs(e)>6e4&&__LOG__(2)`Setting large clockskew: ${e}ms`;const t=this.skewMS;this.skewMS=e,this.skew=Math.round(e/1e3),Math.abs(t-this.skewMS)>1e3&&this.trigger(f)}getSkew(){return this.skew}localUnixTime(e){return void 0!==e?e+this.skew:Math.floor(Date.now()/1e3)}globalUnixTime(e){return void 0!==e?e-this.skew:Math.floor((Date.now()-this.skewMS)/1e3)}globalUnixTimeMilliseconds(){return Math.floor(Date.now()-this.skewMS)}relativeStr(e){const t=e+this.skew;return t>=(0,l.default)().startOf("day").unix()?this._timestampStr(t):this._dateRelativeStr(t,!1)}relativeDateStr(e){return this._dateRelativeStr(e+this.skew,!1)}relativeDateAndTimeStr(e){return this._dateRelativeStr(e+this.skew,!0)}monthStr(e){const t=e+this.skew,n=1e3*t;return t>=(0,l.default)().startOf("month").unix()&&t<=(0,l.default)().endOf("month").unix()?s.fbt._("This Month",null,{hk:"3BBgGL"}):t>=(0,l.default)().startOf("year").unix()&&t<=(0,l.default)().endOf("year").unix()?Intl.DateTimeFormat(l.default.locale(),{month:"long"}).format(n):Intl.DateTimeFormat(l.default.locale(),{month:"long",year:"numeric"}).format(n)}timeStr(e){if(this.shouldUseIntlDateTimeFormat()){const t=1e3*(e+this.skew);let n={hour12:!this.is24h,hour:"numeric",minute:"numeric"},r={year:"numeric",month:"numeric",day:"numeric"};null!=this.timeZoneHardCode&&(n=(0,i.default)((0,i.default)({},n),{},{timeZone:this.timeZoneHardCode}),r=(0,i.default)((0,i.default)({},r),{},{timeZone:this.timeZoneHardCode}));return`${Intl.DateTimeFormat(l.default.locale(),n).format(t)}, ${Intl.DateTimeFormat(l.default.locale(),r).format(t)}`}return l.default.unix(e+this.skew).format(this.is24h?`HH${this._hmsSeparator()}mm, l`:"LT, l")}timestampStr(e){return this._timestampStr(e+this.skew)}timestampStrFormat(){return this.is24h?`HH${this._hmsSeparator()}mm`:"LT"}timestampHour(e){const t=e+this.skew,n=l.default.unix(t).hour();return this.is24h?n:n%12}createdStr(e,t){const n=this.daysDelta(e),r=e+this.skew,i=this._timestampStr(r);if(0===n)return t?c.default.t(889,{time:i}):c.default.t(888,{time:i});if(1===n)return t?c.default.t(895,{time:i}):c.default.t(894,{time:i});if(n<7){const e=this._dateRelativeStr(r,!1);return t?c.default.t(893,{day:e,time:i}):c.default.t(892,{day:e,time:i})}const a=this._dateRelativeStr(r,!1);return t?c.default.t(885,{date:a,time:i}):c.default.t(884,{date:a,time:i})}createdByStr(e,t,n){const r=this.daysDelta(e),i=e+this.skew,a=this._timestampStr(i);if(0===r)return n?c.default.t(891,{time:a}):c.default.t(890,{name:t,time:a});if(1===r)return n?c.default.t(897,{time:a}):c.default.t(896,{name:t,time:a});if(r<7){const r=this._dayNameStr(e);return n?s.fbt._("Group created by you, {on_day} at {time}",[s.fbt._param("on_day",r),s.fbt._param("time",a)],{hk:"2dwUQV"}):s.fbt._("Group created by {name}, {on_day} at {time}",[s.fbt._param("name",t),s.fbt._param("on_day",r),s.fbt._param("time",a)],{hk:"34crrC"})}const o=this._dateRelativeStr(i,!1);return n?c.default.t(887,{date:o,time:a}):c.default.t(886,{name:t,date:o,time:a})}_dayNameStr(e){const t=e+this.skew;switch(l.default.unix(t).day()){case 0:return s.fbt._("on Sunday",null,{hk:"3hQdLv"});case 1:return s.fbt._("on Monday",null,{hk:"4uZn7B"});case 2:return s.fbt._("on Tuesday",null,{hk:"4llPGV"});case 3:return s.fbt._("on Wednesday",null,{hk:"4afKlR"});case 4:return s.fbt._("on Thursday",null,{hk:"49dOXK"});case 5:return s.fbt._("on Friday",null,{hk:"3P0f1f"});case 6:return s.fbt._("on Saturday",null,{hk:"1I5myq"});default:throw new Error("Unexpected day number")}}untilStr(e){if(e===u.MUTE_ALWAYS_EXPIRATION_SENTINEL)return s.fbt._("Always",null,{hk:"26Zr18"});const t=this.daysDelta(e),n=e+this.skew,r=this._timestampStr(n);if(0===t)return c.default.t(791,{time:r});if(1===t)return c.default.t(792,{time:r});if(t<7){const e=this._dateRelativeStr(n,!1);return c.default.t(793,{day:e,time:r})}const i=this._dateRelativeStr(n,!1);return c.default.t(790,{date:i,time:r})}lastSeenStr(e){const t=this.daysDelta(e),n=e+this.skew,r=this._timestampStr(n);if(0===t)return c.default.t(859,{time:r});if(1===t)return c.default.t(861,{time:r});if(t<7){const e=this._dateRelativeStr(n,!1);return c.default.t(860,{date:e,time:r})}const i=this._dateRelativeStr(n,!1);return c.default.t(858,{date:i,time:r})}daysDelta(e,t){const n=l.default.unix(e).startOf("day"),r=(void 0===t?(0,l.default)().startOf("day"):l.default.unix(t).startOf("day")).diff(n,"days");return Math.abs(r)}durationStr(e){const t="string"==typeof e?parseInt(e,10):e,n=l.default.utc(1e3*t);if(n.isValid()){const e=t<a.HOUR_SECONDS?"m:ss":"H:mm:ss";return n.format(e)}return""}_getShortTimeLeftStr(e){const t=Math.floor(e/86400);if(t>0)return{time:c.default.t(760,{days:t,_plural:t}),_plural:t};const n=Math.floor(e/3600);if(n>0)return{time:c.default.t(761,{hours:n,_plural:n}),_plural:n};const r=Math.floor(e/60);return r>0?{time:c.default.t(762,{minutes:r,_plural:r}),_plural:r}:{time:c.default.t(763,{seconds:e,_plural:e}),_plural:e}}timeLeftStr(e){return c.default.t(776,this._getShortTimeLeftStr(e))}paymentTimestampStr(e){const t=e+this.skew,n=l.default.unix(t),r=n.startOf("day"),i=(0,l.default)().startOf("day").diff(r,"days");if(0===i)return s.fbt._("today",null,{hk:"445Hu3"});if(1===i)return s.fbt._("yesterday",null,{hk:"qICUM"});if(!(i<7)){const e=n.format("MMMM d");return c.default.t(974,{date:e})}switch(n.day()){case 0:default:return s.fbt._("on Sunday",null,{hk:"2gwfdl"});case 1:return s.fbt._("on Monday",null,{hk:"4ww1V1"});case 2:return s.fbt._("on Tuesday",null,{hk:"3Bz1cZ"});case 3:return s.fbt._("on Wednesday",null,{hk:"493Z1"});case 4:return s.fbt._("on Thursday",null,{hk:"2pNhJx"});case 5:return s.fbt._("on Friday",null,{hk:"Tf9gq"});case 6:return s.fbt._("on Saturday",null,{hk:"1SPYjP"})}}liveLocationLastUpdatedStr(e){const t=e+this.skew,n=this._timestampStr(t),r=l.default.unix(t).startOf("day"),i=(0,l.default)().startOf("day").diff(r,"days");if(0===i)return c.default.t(553,{time:n});if(1===i)return c.default.t(555,{time:n});if(i<6){const e=this._dateRelativeStr(t,!1);return c.default.t(554,{date:e,time:n})}const a=this._dateRelativeStr(t,!1);return c.default.t(552,{date:a,time:n})}_timestampStr(e){if(this.shouldUseIntlDateTimeFormat()){let t={hour12:!this.is24h,hour:"numeric",minute:"numeric"};null!=this.timeZoneHardCode&&(t=(0,i.default)((0,i.default)({},t),{},{timeZone:this.timeZoneHardCode}));const n=Intl.DateTimeFormat(l.default.locale(),t).format(1e3*e);return this.is24h?n.replace(/^24/,"00"):n.replace(/^0/,"12")}return l.default.unix(e).format(this.timestampStrFormat())}_dateStr(e){if(this.shouldUseIntlDateTimeFormat()){let t={year:"numeric",month:"numeric",day:"numeric"};null!=this.timeZoneHardCode&&(t=(0,i.default)((0,i.default)({},t),{},{timeZone:this.timeZoneHardCode}));return Intl.DateTimeFormat(l.default.locale(),t).format(1e3*e)}return l.default.unix(e).format("l")}_dateRelativeStr(e,t){const n=(0,l.default)().startOf("day"),r=l.default.unix(e).startOf("day"),i=n.diff(r,"days"),a=this._timestampStr(e);if(0===i)return t?c.default.t(1005,{time:a}):s.fbt._("today",null,{hk:"445Hu3"});if(1===i)return t?c.default.t(1012,{time:a}):s.fbt._("yesterday",null,{hk:"qICUM"});if(!t&&Math.abs(i)<7)return l.default.unix(e).format("dddd");const o=this._dateStr(e);return t?c.default.t(1004,{date:o,time:a}):o}_hmsSeparator(){const e=l.default.locale();return p.includes(e)?".":":"}shouldUseIntlDateTimeFormat(){return Intl.DateTimeFormat&&!d.LOCALE_DATE_TIME_CUSTOMIZATIONS[l.default.locale()]&&!d.SHOULD_USE_MOMENT_LOCALE_FORMAT.has(l.default.locale())}}const g=new _;t.Clock=g},47272:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.expBackoff=i,t.expDelaySec=function(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.1;return(0,r.delayMs)(Math.floor(1e3*i(e,t,n,a)))};var r=n(13959);function i(e,t,n){let r,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.1;return r=0===e?n||0:2**e,Number.isFinite(t)&&r>t&&(r=t),"number"==typeof n&&Number.isFinite(n)&&r<n&&(r=n),i&&(r*=1+i*Math.random()),r}},41931:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.dataURLtoBlob=function(e){const t=e.match(n);if(!t)throw new Error("invalid data URI");const r=t[2]?t[1]:"text/plain"+(t[3]||";charset=US-ASCII"),i=!!t[4],a=e.slice(t[0].length);let o;o=i?atob(a):decodeURIComponent(a);const s=new ArrayBuffer(o.length),l=new Uint8Array(s);for(let e=0;e<o.length;e+=1)l[e]=o.charCodeAt(e);return new Blob([l],{type:r})};const n=/^data:((.*?)(;charset=.*?)?)(;base64)?,/},95726:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.findLink=M,t.findLinks=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0;if(!A.test(e))return[];C.lastIndex=0;const r=[];let i;for(;i=P(e);){const e=O(i,t,n);e&&r.push(e)}return r},t.validateEmail=function(e){const t=M(e);return t&&t.url===e&&"mailto:"===t.scheme&&t.username&&!t.params&&!t.anchor?t:null};var i=n(53659),a=n(72441),o=n(80940),s=r(n(3689)),l=n(17239),c=n(99234);const d=Array.from(o.TLD).join("|"),u=/^https?:\/\/$/gi,p="\\w|[^\\s\0-]|%[0-9a-f][0-9a-f]",f=`${d}|xn--(?:${p})+`,h=`(?:${p})|(?:${p})(?:${p}|-)*(?:${p})`,_=`(?:${p}|[^\\s%])`,g=`[@!.?,(\\[{<:]*(?!${_}|#)`,m="0-9a-z!#$%&'*+/=?^_`{|}~\\-",y=`(^|\\W\\.|[^/\\w.]|_)((?:http|https)://|mailto:)?(${`\\b\\w[${m}]*(?:\\.[${m}]+)*`}@)?(${`(?!_)(?:(?:${h})\\.)+(${f})(?!\\.${h})`})(?:(?!${h})|(?=_))(?:(?=[^:/?#])|(:\\d{1,5})?(${`/${_}*?`})?(${`\\?(?!${g})${_}*?`})?(${`#${_}*?`})?(?=${g}))`,E=7,S=8,v=9,T=new Map([[34,34],[41,40],[62,60],[93,91],[125,123],[187,171],[8217,8216],[8221,8220]]),b=new Map([[34,34],[40,41],[60,62],[91,93],[123,125],[171,187],[8216,8217],[8220,8221]]),C=new RegExp(`${y}`,"ig"),A=new RegExp(`\\.(?:${f})`,"i");function P(e){try{return C.exec(e)}catch(t){return __LOG__(4,void 0,new Error,!0)`text size: ${e.length}, error: ${String(t)}`,SEND_LOGS("linkify-regex-error"),null}}function M(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0;return A.test(e)?(C.lastIndex=0,O(P(e),t,n)):null}function O(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0;if(!e)return null;const r=e[1].length;let d=e[0];const p=e.index+r,{index:f}=e,h="_"===e[1];if(h&&f-1&&/\S/.test(e.input[f-1]))return null;const _=e[5];if(_&&_.startsWith("xn--")&&!o.TLD.has(s.default.toUnicode(_)))return null;if(e[6]){const t=parseInt(e[6].slice(1),10);if("0"===e[6][1]||!(0<t&&t<65536))return null}const g=[v,S,E].find((t=>null==e?void 0:e[t]))||0;if(g){const t=[];let n=e[g];"_"===n.slice(-1)&&"_"===d[p-1]&&(d=d.slice(0,-1),e[g]=n=n.slice(0,-1));let i=0,a=0;for(let e=0;e<n.length;e++){const r=n.charCodeAt(e);r===a?(a=t.pop()||0,0===a&&(i=e)):b.has(r)?(0!==a&&t.push(a),a=b.get(r)):T.has(r)||0===a&&(i=e)}if(i!==n.length-1){const t=e.slice(2,g);t.splice(3,1),d=t.filter((e=>e)).join("")+n.slice(0,i+1),C.lastIndex=p+d.length}else d=d.slice(r)}else d=d.slice(r);let m=d,y=e[2];const A=Boolean(y&&y.match(u));if(t&&!A)return null;y?y=y.toLowerCase():(y=0===m.toLowerCase().indexOf("irc.")?"irc://":0===m.toLowerCase().indexOf("ftp.")?"ftp://":e[3]?"mailto:":"http://",m=y+m);const P=e[4],M=(0,c.getMaybeMeUser)();return{href:m,url:d,index:p,input:e.input,scheme:y,username:e[3],domain:P,port:e[6],path:e[E],params:e[S],anchor:e[v],isHttp:A,suspiciousCharacters:n&&M?(0,i.findSuspiciousCharacters)(P,(0,a.toPhoneUserJid)(n.user),(0,a.toPhoneUserJid)(M.user),l.Conn.allLanguages):void 0}}},76139:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(88306)),a=r(n(2525)),o=n(15688),s=n(8584),l=n(11141),c=n(51737),d=n(41931),u=n(65885),p=r(n(8575)),f=n(41796),h=r(n(53565));let _;const g=/^(https?:\/\/(?:www\.|(?!www))[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9]\.[^\s]{2,}|www\.[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9]\.[^\s]{2,}|https?:\/\/(?:www\.|(?!www))[a-zA-Z0-9]+\.[^\s]{2,}|www\.[a-zA-Z0-9]+\.[^\s]{2,})/,m="https://l.wl.co/l";var y={URL_REGEX:g,build(e,t){const n=new h.default;return(0,a.default)(t||{},((e,t)=>{n.set(t,e)})),`${e}?${n.toString()}`},canMuckHistory(){var e;return!!((0,f.isConnectedToPage)()&&(null===(e=window.history)||void 0===e?void 0:e.pushState)&&self.location)},relToAbs:e=>(_||(_=document.createElement("a")),_.href=e,_.href),hostname:(0,i.default)((function(e){return _||(_=document.createElement("a")),_.href=this.isHttp(e)?e:"http://"+e,_.hostname})),withoutWww:function(e){return e.split("www.").join("")},isHttp:e=>e&&("https://"===e.toLowerCase().substring(0,8)||"http://"===e.toLowerCase().substring(0,7)),isHttps:e=>e&&"https://"===e.toLowerCase().substring(0,8),hasValidUrlScheme(e){const t=e.trim();return["irc://","ftp://","mailto:","http://","https://"].some((e=>0===t.toLowerCase().indexOf(e)))},isBlob:e=>(0,c.isString)(e)&&"blob:"===e.substring(0,5),isData:e=>(0,c.isString)(e)&&"data:"===e.substring(0,5),isEncryptedMedia:e=>e&&(0,c.isString)(e)&&e.endsWith(".enc"),parseDataURL(e){const t=e.indexOf(":"),n=e.indexOf(";"),r=e.indexOf(",");return{mimetype:e.substring(t+1,n),data:e.substring(r+1)}},dataURLtoFile(e){const t=this.parseDataURL(e).mimetype;return(0,u.createFile)([(0,d.dataURLtoBlob)(e)],"",{type:t})},GSM_NAME:"gme-whatsappinc",GSM_NUMS:"LM4NgcjF-X_EedaZ6MwPVSH0Sac=",gsmURL(e,t){const n=t.replace(/\-/g,"+").replace(/_/g,"/"),r=(0,o.decodeB64)(n),i=p.default.parse(e).path,a=s.Binary.build(i).readByteArray();return(0,l.hmacSha1)(r,a).then((t=>`${e}&signature=${(0,o.encodeB64UrlSafe)(t)}`))},thumbToCSSURL(e){return`url("${this.isHttp(e)||e.startsWith("data:")?e:`data:image/jpeg;base64,${e}`}")`},thumbAsBackgroundImage(e){return e?{backgroundImage:this.thumbToCSSURL(e)}:{}},isValid:e=>g.test(e),toMaliciousSiteRedirect:e=>""===e||0===e.indexOf(m)?e:`${m}?u=${encodeURIComponent(e)}`};t.default=y},62938:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addWebpMetadata=function(e,t){const n=new Uint8Array(e);if(!(0,i.isExtendedFile)(n))throw new Error("Not extended");const s=function(e){const t=new TextEncoder,n=JSON.stringify(e),a=t.encode(n),s=function(e){return(0,r.concatTypedArrays)(Uint8Array,[(0,i.stringToUint8)("II"),new Uint8Array([42,0]),(0,i.numberToLittleEndian)(8),new Uint8Array([1,0]),(0,i.stringToUint8)("AW"),new Uint8Array([7,0]),(0,i.numberToLittleEndian)(e.byteLength),(0,i.numberToLittleEndian)(22),e])}(a),l=[o(i.Chunk.EXIF,s.byteLength),s];a.byteLength%2!=0&&l.push(new Uint8Array([0]));return(0,r.concatTypedArrays)(Uint8Array,l)}((0,a.toRawWebpMetadata)(t)),l=(0,r.concatTypedArrays)(Uint8Array,[n,s]);l.set((0,i.numberToLittleEndian)(l.byteLength-8),4);return l.buffer};var r=n(60977),i=n(64598),a=n(65844);function o(e,t){return(0,r.concatTypedArrays)(Uint8Array,[(0,i.stringToUint8)(e),(0,i.numberToLittleEndian)(t)])}},77069:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t;const n=new Uint8Array(e),a=null!==(t=(0,i.findWebpChunk)(n,i.Chunk.EXIF))&&void 0!==t?t:(0,i.findWebpChunk)(n,i.Chunk.XMP);if(null==a)return(0,r.sha256Base64)(e);const o=n.slice(0,a.position),s=o.byteLength-i.CHUNK_HEADER_SIZE;return o.set((0,i.numberToLittleEndian)(s),i.FOUR),(0,r.sha256Base64)(o)};var r=n(73045),i=n(64598)},93915:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return new Promise(((t,n)=>{const r=new i.default;r.onerror=function(e){r.terminate(),n(new a.DecodeWebpResultsError("worker error",e))},r.onmessageerror=function(e){r.terminate(),n(new a.DecodeWebpResultsError("worker message error",e))},r.onmessage=e=>{r.terminate();const n=e.data;t(n)},r.postMessage({webpBuffer:e},[e])}))};var i=r(n(82578)),a=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=o(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var s=i?Object.getOwnPropertyDescriptor(e,a):null;s&&(s.get||s.set)?Object.defineProperty(r,a,s):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(35232));function o(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(o=function(e){return e?n:t})(e)}},29853:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,r){const{quality:o=90,ensureExtendedFormat:s=!1}=null!=r?r:{};return new Promise(((r,l)=>{const c=new i.default;c.onerror=function(e){c.terminate(),l(new a.EncodeWebpError("worker error",e))},c.onmessageerror=function(e){c.terminate(),l(new a.EncodeWebpError("worker message error",e))},c.onmessage=e=>{c.terminate(),r(e.data.blob)},c.postMessage({rgbaData:e,width:t,height:n,quality:o,ensureExtendedFormat:s})}))};var i=r(n(23573)),a=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=o(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var s=i?Object.getOwnPropertyDescriptor(e,a):null;s&&(s.get||s.set)?Object.defineProperty(r,a,s):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(35232));function o(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(o=function(e){return e?n:t})(e)}},55130:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getWebpMetadata=function(e){const t=function(e){const t=new Uint8Array(e),n=(0,r.findWebpMetadata)(t);if(!n)return{};const{position:i,size:a}=n,o=new TextDecoder,s=t.slice(i,i+a),l=o.decode(s);try{return JSON.parse(l)}catch(e){return __LOG__(2)`Failed to parse emojis out of sticker, returning empty object.`,{}}}(e);return(0,i.toWebpMetadata)(t)};var r=n(64598),i=n(65844)},76076:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.MAX_LOOPS=t.MAX_DURATION=void 0,t.getTotalAnimationDuration=l,t.parseWebp=function(e){const t=new Uint8Array(e);if(!(0,s.isExtendedFile)(t))return __LOG__(2)`Sticker file not extended format.`,c;const{emojis:n,isFirstParty:r,isFromStickerMaker:d,stickerPackId:u,stickerPackName:p,stickerPackPublisher:f}=(0,o.getWebpMetadata)(e),h=(0,i.default)((0,i.default)({},c),{},{emojis:n,isFirstParty:r,isFromStickerMaker:d,stickerPackId:u,stickerPackName:p,stickerPackPublisher:f});if(!(0,s.isAnimatedWebp)(t))return h;let _,g=0,m=44;for(;(0,a.default)(t.slice(m,m+4),(0,s.stringToUint8)(s.Chunk.ANMF));){const e=m+20,n=t.slice(e,e+3);if(3!==n.length)return h;g+=(0,s.littleEndianToNumber)(n);const r=m+4,i=t.slice(r,r+4);if(4!==i.length)return h;m+=8+(0,s.littleEndianToNumber)(i),null==_&&(_=m)}const y=l(g);return(0,i.default)((0,i.default)({},h),{},{animationDuration:y,firstFrameLength:_,singleLoopDuration:g})};var i=r(n(81109)),a=r(n(63438)),o=n(55130),s=n(64598);t.MAX_LOOPS=3;function l(e){if(0===e)return 0;const t=Math.min(Math.floor(5e3/e),3);return Math.max(t,1)*e}t.MAX_DURATION=5e3;const c={animationDuration:0,singleLoopDuration:0,emojis:[],isFirstParty:!1,isFromStickerMaker:!1,stickerPackId:null,stickerPackName:null,stickerPackPublisher:null}},64598:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.WEBP_HEADER_SIZE=t.FOUR=t.Chunk=t.CHUNK_HEADER_SIZE=void 0,t.findWebpChunk=s,t.findWebpMetadata=function(e){if(!l(e))return __LOG__(2)`Sticker file not extended format.`,null;if(null==TextDecoder)return null;const t=s(e,o.EXIF);if(!t)return null;const n=String.fromCharCode(0),r=new TextDecoder,i=e.slice(t.position,t.position+t.size),a=r.decode(i);let c,d;for(let e=a.length;e>0;--e)if(null==d&&"}"===a[e])d=e;else if(null!=d&&a[e]===n){c=e+1;break}if(null==c||null==d)return __LOG__(3)`JSON not found in sticker file`,null;return{position:t.position+c,size:d-c+1}},t.isAnimatedWebp=function(e){const t=new Uint8Array(e);return l(t)&&0!=(2&t[20])},t.isExtendedFile=l,t.littleEndianToNumber=c,t.numberToLittleEndian=function(e){const t=new i.Binary;return t.writeUint32(e,!0),t.readByteArray()},t.stringToUint8=d;var i=n(8584),a=r(n(63438));const o=n(76672)({VP8X:"VP8X",ANMF:"ANMF",EXIF:"EXIF",XMP:"XMP "});t.Chunk=o;t.WEBP_HEADER_SIZE=12;t.CHUNK_HEADER_SIZE=8;t.FOUR=4;function s(e,t){const n=d(t);let r=0;for(r+=12;r<e.byteLength;){const t=e.slice(r,r+8),i=t.slice(0,4);let o=c(t.slice(4,8));if(o%2!=0&&(o+=1),(0,a.default)(i,n))return{position:r,size:o+4+4};r+=8+o}return null}function l(e){const t=e.slice(12,16);return(0,a.default)(t,d(o.VP8X))}function c(e){return e.reduce(((e,t,n)=>e+(t<<8*n)),0)}function d(e){const t=new i.Binary;return t.writeString(e),t.readByteArray()}},65844:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.FIELDS=t.DEFAULT_METADATA=void 0,t.toRawWebpMetadata=function(e){const t={};null!=e.isFirstParty&&(t[a.isFirstParty]=e.isFirstParty?1:0);null!=e.isFromStickerMaker&&(t[a.isFromStickerMaker]=e.isFromStickerMaker?1:0);null!=e.emojis&&(t[a.emojis]=e.emojis);null!=e.stickerPackId&&(t[a.stickerPackId]=e.stickerPackId);null!=e.stickerPackName&&(t[a.stickerPackName]=e.stickerPackName);null!=e.stickerPackPublisher&&(t[a.stickerPackPublisher]=e.stickerPackPublisher);null!=e.stickerPackPlayStoreLink&&(t[a.stickerPackPlayStoreLink]=e.stickerPackPlayStoreLink);null!=e.stickerPackAppleStoreLink&&(t[a.stickerPackAppleStoreLink]=e.stickerPackAppleStoreLink);return t},t.toWebpMetadata=function(e){const t=e[a.isFirstParty],n=e[a.isFromStickerMaker],r=e[a.emojis],s=e[a.stickerPackId],l=e[a.stickerPackName],c=e[a.stickerPackPublisher],d=e[a.stickerPackPlayStoreLink],u=e[a.stickerPackAppleStoreLink],p=(0,i.default)({},o);null!=t&&(p.isFirstParty=1===t);null!=n&&(p.isFromStickerMaker=1===n);null!=r&&Array.isArray(r)&&(p.emojis=r);null!=s&&(p.stickerPackId=s);null!=l&&(p.stickerPackName=l);null!=c&&(p.stickerPackPublisher=c);null!=d&&(p.stickerPackPlayStoreLink=d);null!=u&&(p.stickerPackAppleStoreLink=u);return p};var i=r(n(81109));const a={isFirstParty:"is-first-party-sticker",isFromStickerMaker:"is-from-sticker-maker",emojis:"emojis",stickerPackId:"sticker-pack-id",stickerPackName:"sticker-pack-name",stickerPackPublisher:"sticker-pack-publisher",stickerPackPlayStoreLink:"android-app-store-link",stickerPackAppleStoreLink:"ios-app-store-link"};t.FIELDS=a;const o={isFirstParty:!1,isFromStickerMaker:!1,emojis:[],stickerPackId:null,stickerPackName:null,stickerPackPublisher:null,stickerPackPlayStoreLink:null,stickerPackAppleStoreLink:null};t.DEFAULT_METADATA=o},47734:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){const e=(0,i.randomHex)(16).substr(0,64);return __LOG__(2)`voip:generateCallId: ${e}`,e};var i=n(87614);r(n(64369))},83938:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return Promise.resolve(!1)}},22007:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.generateICELiteAnswerSDP=function(e,t,n,i,a,o,s){const l=(h=e,h.ip.join(".")),c=e.port+1,d=t,u=n,p=a,f=(0,r.encodeB64)(o);var h;let _=`v=0\no=- ${(new Date).getTime()} 2 IN IP4 127.0.0.1\ns=-\nt=0 0\na=group:BUNDLE 0${s?" 1":""}\na=ice-lite\na=msid-semantic: WMS g1noOjzcjYNgtJfnKdCzBmyvTozKsCGWCleP\nm=audio ${c} RTP/SAVP 111\nc=IN IP4 0.0.0.0\na=rtcp:9 IN IP4 ${l}\na=candidate:1152096416 1 udp 2113937151 ${l} ${c} typ host generation 0 network-cost 999\na=ice-ufrag:${d}\na=ice-pwd:${u}\na=ice-options:trickle\na=setup:active\na=mid:0\na=sendrecv\na=msid:g1noOjzcjYNgtJfnKdCzBmyvTozKsCGWCleP df375ff4-7ed5-459d-b991-76c8e47ffc52\na=rtcp-mux\na=crypto:0 AES_CM_128_HMAC_SHA1_32 inline:${f}\na=rtpmap:111 opus/48000/2\na=fmtp:111 useinbandfec=1\na=fmtp:111 maxplaybackrate=16000; sprop-maxcapturerate=16000\na=rtcp-fb:111 goog-remb\na=ssrc:${i} cname:noAs9WOptAnM/+QP\n`;s&&(_+=`m=video ${c} RTP/SAVP 102\nc=IN IP4 0.0.0.0\na=rtcp:9 IN IP4 ${l}\na=candidate:1152096416 1 udp 2113937151 ${l} ${c} typ host generation 0 network-cost 999\na=ice-ufrag:${d}\na=ice-pwd:${u}\na=ice-options:trickle\na=mid:1\na=extmap:3 urn:3gpp:video-orientation\na=sendrecv\na=msid:g1noOjzcjYNgtJfnKdCzBmyvTozKsCGWCleP df375ff4-7ed5-459d-b991-76c8e47ffc52\na=rtcp-mux\na=rtcp-rsize\na=crypto:0 AES_CM_128_HMAC_SHA1_32 inline:${f}\na=rtpmap:102 VP8/90000\na=rtcp-fb:102 nack\na=rtcp-fb:102 nack pli\na=rtcp-fb:102 goog-remb\na=ssrc:${p} cname:rcpcNyS/Kejuq2+Y\na=ssrc:${p} msid:g1noOjzcjYNgtJfnKdCzBmyvTozKsCGWCleP df375ff4-7ed5-459d-b991-76c8e47ffc52\na=ssrc:${p} mslabel:g1noOjzcjYNgtJfnKdCzBmyvTozKsCGWCleP\na=ssrc:${p} label:df375ff4-7ed5-459d-b991-76c8e47ffc52\n`);return{type:"answer",sdp:_}},t.modifyOfferSDP=function(e,t,n,i,a){let o=e;if(o=o.replace(/a=crypto:[1-9].*\r\n/g,""),o=o.replace(/a=crypto:0.*/g,`a=crypto:0 AES_CM_128_HMAC_SHA1_32 inline:${(0,r.encodeB64)(i)}`),o=o.replace(/a=rtcp-fb.*transport-cc.*\r\n/g,""),o=o.replace(/a=extmap:3.*draft-holmer-rmcat.*\r\n/g,""),a){const e=o.search(/m=video/g);let r=o.substring(0,e),i=o.substring(e);r=r.replace(/ssrc:\S+/g,`ssrc:${t}`),i=i.replace(/ssrc:\S+/g,`ssrc:${n}`),i=i.replace(/a=extmap:13 urn:3gpp:video-orientation/g,"a=extmap:3 urn:3gpp:video-orientation"),o=r+i}else o=o.replace(/ssrc:\S+/g,`ssrc:${t}`);return o};var r=n(15688)},84356:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.Voip=void 0,t.checkVoipCapability=function(){return Promise.resolve(!1)};var i=r(n(48926)),a=n(15688),o=n(81576),s=n(11141),l=n(40234),c=n(99234),d=r(n(47734)),u=r(n(56624)),p=n(46582),f=n(56981),h=n(22007),_=n(69594),g=r(n(89345)),m=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=v(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(45473)),y=n(49835),E=n(24746),S=r(n(77107));function v(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(v=function(e){return e?n:t})(e)}let T=null,b=new S.default;const C={init:()=>(__LOG__(2)`voip:init`,Promise.resolve(!1)),updateAudioVideoSwitch:()=>{},cleanup:()=>{},refresh:()=>{},callStart:(e,t)=>{if(!(0,_.isVoiceCallEnabled)()&&!(0,_.isVideoCallEnabled)())throw new Error("voip:callStart: calling not enabled");if(b.getState()!==y.WEB_CALL_STATES.NONE)throw new Error("Call cannot be started because there is already a call in progress");__LOG__(2)`voip:callStart: ${e.toString()} video: ${t.toString()}`,function(){M.apply(this,arguments)}(e,t)},groupCallStart:()=>{},sendGroupCallInvite:()=>{},endCall:(A=(0,i.default)((function*(){const e=b;b.getState()===y.WEB_CALL_STATES.ACTIVE&&(yield function(){return Y.apply(this,arguments)}(b.callId,b.peerJid),(yield(0,p.requireCallCollection)()).remove(e.callId)),e.pc.close(),e.localStream.getTracks().forEach((e=>e.stop())),e.remoteAudioStream&&e.remoteAudioStream.getTracks().forEach((e=>e.stop())),e.remoteVideoStream&&e.remoteVideoStream.getTracks().forEach((e=>e.stop())),b=new S.default})),function(){return A.apply(this,arguments)}),callEndByHandledRemotely:()=>{},acceptCall:()=>{},rejectCall:()=>{},rejectCallWithoutCallCtx:()=>{},resendEncRekeyRetry:()=>{},processMissedIncomingCallMaxRetry:()=>{},mute:()=>{},videoTurnCameraOn:()=>{},videoTurnCameraOff:()=>{},videoStreamPause:()=>{},videoStreamResume:()=>{},videoRequestUpgrade:()=>{},videoAcceptUpgrade:()=>{},videoRejectUpgrade:()=>{},videoCancelUpgrade:()=>{},handleIncomingSignalingMessage:(e,t)=>(0,i.default)((function*(){const n=m.TYPE_NAME[e.type];__LOG__(2)`voip:handleIncomingSignalingMsg: type: "${n}" msg: `;const[r,i]=yield Promise.all([(0,p.requireCallCollection)(),(0,p.requireVoipCommonDisabled)()]),a=r.get(e.call_id);if(null==a?void 0:a.canHandleLocally)switch(e.type){case m.TYPE.OFFER:const n=e.peer_jid,i=e.t;if(n){const{isVideo:e,callId:r,randomBytes:a,key:o,token:s,relay:l}=function(e){const t=e[1]["call-id"];let n=null,r=null,i=null,a=null,o=!1;for(const t of e[2])__LOG__(2)`voip:offer: offerChild: `,"enc"===t[0]?a=new Uint8Array(t[2]):"video"===t[0]?o=!0:"relay"===t[0]&&([n,r,i]=V(t));if(null==n||null==r||null==i)throw new Error("Error parsing relay attributes in Offer");if(null==a)throw new Error("No random byte source found in Offer");return{callId:t,token:n,key:r,relay:i,randomBytes:a,isVideo:o}}(t.payload);yield function(e,t,n){const r=E.AUDIO_CODECS.DEFAULT,i=n?E.VIDEO_CODECS.DEFAULT:E.VIDEO_CODECS.NONE,a=r.concat(i),o=["preaccept",{"call-id":e,"call-creator":t},a.concat([E.CAPABILITIES.DEFAULT,E.ENCOPT.DEFAULT])];return(0,f.sendCallSignalingMsg)({common:{type:"preaccept",call_id:e,peer_jid:t},payload:o})}(r,n.toString({legacy:!0}),e),function(){O.apply(this,arguments)}(e,r,n,a,o,s,l,i)}break;case m.TYPE.OFFER_RECEIPT:case m.TYPE.ACCEPT_RECEIPT:case m.TYPE.MUTE:case m.TYPE.VIDEO_STATE:break;case m.TYPE.ACCEPT:b.getState()===y.WEB_CALL_STATES.OUTGOING_CALLING&&b.setState(y.WEB_CALL_STATES.ACTIVE);break;case m.TYPE.REJECT:b.getState()===y.WEB_CALL_STATES.OUTGOING_CALLING&&(b.pc.close(),b.localStream.getTracks().forEach((e=>e.stop())),b=new S.default);break;case m.TYPE.TERMINATE:b.getState()===y.WEB_CALL_STATES.ACTIVE&&(b.pc.close(),b.localStream.getTracks().forEach((e=>e.stop())),r.remove(b.callId),b=new S.default)}else i.handleIncomingSignalingMessage(e,t)}))(),isInitialized:()=>!0,registerVideoCallback:()=>{},cleanupVideoBuffer:()=>{},updateNetworkMedium:()=>{},registerWebRTCCallback:e=>{T=e},notifyDeviceIdentityChangedOrDeleted:()=>{},getNumParticipantsFromCallOffer:()=>Promise.resolve(-1)};var A;function P(){const e=new Uint8Array(32);return self.crypto.getRandomValues(e),e.buffer}function M(){return(M=(0,i.default)((function*(e,t){if(!u.default)throw new Error("Unable to request Media Devices.");const n=yield(0,u.default)({audio:!0,video:t}),r=(0,d.default)(),i=yield(0,p.requireCallCollection)();i.add({id:r,peerJid:e,offerTime:l.Clock.globalUnixTime(),isVideo:t,outgoing:!0,webClientShouldHandle:!0,canHandleLocally:!0});const a=i.assertGet(r);i.setActiveCall(a);const o=P(),s=(0,c.assertGetMe)(),f=B(),{token:h,key:_,relay:g}=yield W(o,s,e.toString({legacy:!0}),r,t);n.getTracks().forEach((e=>f.addTrack&&f.addTrack(e,n))),b.localStream=n,f.onnegotiationneeded=()=>I(f,r,s,e,o,_,h,g,t,!0),f.ontrack=e=>R(e)}))).apply(this,arguments)}function O(){return(O=(0,i.default)((function*(e,t,n,r,i,a,o,s){(yield(0,p.requireCallCollection)()).add({id:t,peerJid:n,offerTime:s,isVideo:e,outgoing:!1,webClientShouldHandle:!0,canHandleLocally:!0});const l=(0,c.assertGetMe)();if(g.default.openVoipWindow(),yield F(t,n.toString({legacy:!0}),e),!u.default)throw new Error("Unable to request Media Devices.");const d=yield(0,u.default)({audio:!0,video:e}),f=B();d.getTracks().forEach((e=>f.addTrack&&f.addTrack(e,d))),b.localStream=d,f.onnegotiationneeded=()=>I(f,t,l,n,r.buffer,i,a,o,e,!1),f.ontrack=e=>R(e)}))).apply(this,arguments)}function I(){return w.apply(this,arguments)}function w(){return(w=(0,i.default)((function*(e,t,n,r,i,a,o,s,l,c){const[d,u]=yield x(t,n,r,i),[p,f,_,g]=yield k(t,n,r),m=yield e.createOffer();__LOG__(2,!0)`voip:original-offer: ${m.sdp}`,yield z(s,t,n.toString({legacy:!0}),r.toString({legacy:!0}),y.RELAY_INFO.RELAY_LATENCY),m.sdp&&(m.sdp=(0,h.modifyOfferSDP)(m.sdp,p,f,d,l)),__LOG__(2,!0)`voip:modified-offer: ${m.sdp}`,yield e.setLocalDescription(m),__LOG__(2,!0)`voip:localDescription: `;const E=(0,h.generateICELiteAnswerSDP)(s,o,a,_,g,u,l);__LOG__(2,!0)`voip:generated-answer: ${E.sdp}`,b.setState(c?y.WEB_CALL_STATES.OUTGOING_CALLING:y.WEB_CALL_STATES.INCOMING_CALLING),e.setRemoteDescription(E),b.pc=e,b.answer=E,b.callId=t,b.peerJid=r.toString({legacy:!0}),T&&T({type:y.WEB_CALL_EVENTS.MEDIA_READY,data:b.localStream})}))).apply(this,arguments)}function R(e){if(__LOG__(2)`voip:received-track`,!T)throw new Error("No Track callback registered.");"audio"===e.track.kind&&(b.remoteAudioStream=e.streams[0],T({type:y.WEB_CALL_EVENTS.AUDIO_TRACK_RECEIVED,data:e.streams[0]})),"video"===e.track.kind&&(b.remoteVideoStream=e.streams[0],T({type:y.WEB_CALL_EVENTS.VIDEO_TRACK_RECEIVED,data:e.streams[0]}))}function D(e,t,n,r){const i=new TextDecoder;return(0,o.extractWithSaltAndExpand)(e,t,i.decode(n),r)}function L(){return N.apply(this,arguments)}function N(){return(N=(0,i.default)((function*(e,t,n){const r=new TextEncoder,i=r.encode(e).buffer,a=r.encode(t).buffer,o=new Uint32Array([n]).buffer,s=yield D(i,o,a,32);return new Uint32Array(s)[0]}))).apply(this,arguments)}function k(e,t,n){const r=L(e,t.toString({legacy:!0,formatFull:!0}),0),i=L(e,n.toString({legacy:!0}),0),a=L(e,t.toString({legacy:!0,formatFull:!0}),2),o=L(e,n.toString({legacy:!0}),2);return Promise.all([r,a,i,o])}function U(){return G.apply(this,arguments)}function G(){return(G=(0,i.default)((function*(e,t){const n=new TextEncoder;return(yield D(e,s.DEFAULT_SALT.buffer,n.encode(t).buffer,46)).slice(0,30)}))).apply(this,arguments)}function x(e,t,n,r){const i=U(r,t.toString({legacy:!0,formatFull:!0})),a=U(r,n.toString({legacy:!0}));return Promise.all([i,a])}function B(){return new RTCPeerConnection({sdpSemantics:"unified-plan"},{mandatory:{},optional:[{DtlsSrtpKeyAgreement:!1},{RtpDataChannels:!1}]})}function F(e,t,n){const r=E.AUDIO_CODECS.DEFAULT,i=n?E.VIDEO_CODECS.DEFAULT:E.VIDEO_CODECS.NONE,a=["accept",{"call-id":e,"call-creator":t},r.concat(i).concat([["net",{medium:"3"},null],E.ENCOPT.DEFAULT])];return(0,f.sendCallSignalingMsg)({common:{type:"accept",call_id:e,peer_jid:t},payload:a})}function j(e){return["terminate",{"call-id":e},null]}function Y(){return(Y=(0,i.default)((function*(e,t){const n=j(e),r=n[0];yield(0,f.sendCallSignalingMsg)({common:{type:r,call_id:e,peer_jid:t},payload:n})}))).apply(this,arguments)}function K(e,t,n,r){const i=E.AUDIO_CODECS.DEFAULT,a=r?E.VIDEO_CODECS.DEFAULT:E.VIDEO_CODECS.NONE,o=i.concat(a);return["offer",{"call-id":t,"call-creator":n.toString({legacy:!0})},o.concat([["net",{medium:"3"},null],E.CAPABILITIES.DEFAULT,["enc",{count:"0"},Array.from(new Uint8Array(e))],E.ENCOPT.DEFAULT])]}function W(){return H.apply(this,arguments)}function H(){return(H=(0,i.default)((function*(e,t,n,r,i){const a=K(e,r,t,i),o=a[0];__LOG__(2)`voip:send:offer: payload:`;const s=yield(0,f.sendCallOffer)({common:{type:o,call_id:r,peer_jid:n},payload:a});if(!(null==s?void 0:s.status))throw new Error("Error receiving Offer Ack.");switch(s.status){case 200:if(s.payload){__LOG__(2)`voip:recv:offerAck:`;let e=null,t=null,n=null;for(const r of s.payload[2])"relay"===r[0]&&([e,t,n]=V(r));if(null==e||null==t||null==n)throw new Error("Error parsing relay attributes in Offer Ack");return{token:e,key:t,relay:n}}throw new Error("Error receiving Offer Ack: No Payload");case 409:throw new Error("Error receiving Offer Ack: Phone Busy");default:throw new Error(`Error receiving Offer Ack: Unknown status:${status}`)}}))).apply(this,arguments)}function V(e){let t=null,n=null,r=null;const i=new TextDecoder;for(const o of e[2])if("token"===o[0])t=new Uint8Array(o[2]),t=(0,a.encodeB64)(t),__LOG__(2)`voip:relay token: `;else if("key"===o[0])n=new Uint8Array(o[2]),n=i.decode(n),__LOG__(2)`voip:relay key: `;else if("te2"===o[0]){const e=new Uint8Array(o[2]);if(6===e.length){const t=new DataView(e.buffer);r={ip:[t.getUint8(0),t.getUint8(1),t.getUint8(2),t.getUint8(3)],port:t.getUint16(4)},__LOG__(2)`voip:relay address: `}}if(null==t)throw new Error("Could not extract relay token");if(null==n)throw new Error("Could not extract relay key");if(null==r)throw new Error("Could not extract relay address");return[t,n,r]}function $(e,t,n,r){const i=new ArrayBuffer(6),a=new DataView(i);a.setUint8(0,e.ip[0]),a.setUint8(1,e.ip[1]),a.setUint8(2,e.ip[2]),a.setUint8(3,e.ip[3]),a.setUint16(4,e.port);return[r,{"call-id":t,"call-creator":n},[["te",{latency:"10"},Array.from(new Int8Array(i))]]]}function z(){return q.apply(this,arguments)}function q(){return(q=(0,i.default)((function*(e,t,n,r,i){const a=$(e,t,n,i),o=a[0];yield(0,f.sendCallSignalingMsg)({common:{type:o,call_id:t,peer_jid:r},payload:a})}))).apply(this,arguments)}t.Voip=C},69594:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isGroupCallEnabled=function(){let e=!1;return e=!1,false},t.isStatefulEnumerationEnabled=function(){let e=!1;(0,r.isMDBackend)()&&(e=getABPropConfigValue("web_abprop_stateful_enumeration_enabled"));return e},t.isVideoCallEnabled=function(){let e=!1;return e=(0,i.isFeatureEnabled)("web_voip_video_call"),e},t.isVoiceCallEnabled=function(){let e=!1;return e=(0,i.isFeatureEnabled)("web_voip_voice_call"),e};var r=n(88555),i=n(10206)},45473:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TYPE_STR=t.TYPE_NAME=t.TYPE=t.ENC_RETRY_RECEIPT_ATTRS=void 0;t.TYPE={NONE:0,OFFER:1,OFFER_RECEIPT:2,ACCEPT:3,REJECT:4,TERMINATE:5,TRANSPORT:6,OFFER_ACK:7,OFFER_NACK:8,RELAY_LATENCY:9,RELAY_ELECTION:10,INTERRUPTION:11,MUTE:12,PREACCEPT:13,ACCEPT_RECEIPT:14,VIDEO_STATE:15,NOTIFY:16,GROUP_INFO:17,ENC_REKEY:18,PEER_STATE:19,VIDEO_STATE_ACK:20,FLOW_CONTROL:21,WEB_CLIENT:22,ACCEPT_ACK:23,GROUP_UPDATE:24,OFFER_NOTICE:25,MAX:26};t.TYPE_STR={OFFER:"offer",ACCEPT:"accept",ENC_REKEY:"enc_rekey",REJECT:"reject",RECEIPT:"receipt",OFFER_NOTICE:"offer_notice"};t.TYPE_NAME=["NONE","OFFER","OFFER_RECEIPT","ACCEPT","REJECT","TERMINATE","TRANSPORT","OFFER_ACK","OFFER_NACK","RELAY_LATENCY","RELAY_ELECTION","INTERRUPTION","MUTE","PREACCEPT","ACCEPT_RECEIPT","VIDEO_STATE","NOTIFY","GROUP_INFO","ENC_REKEY","PEER_STATE","VIDEO_STATE_ACK","FLOW_CONTROL","WEB_CLIENT","ACCEPT_ACK","GROUP_UPDATE","OFFER_NOTICE","MAX"];t.ENC_RETRY_RECEIPT_ATTRS={SINGLE_PARTICIPANT:"enc",GROUP_CALL:"enc_rekey_retry"}},32968:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.playEndCallTone=function(){}},49835:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WEB_CALL_UI_STATES=t.WEB_CALL_STATES=t.WEB_CALL_EVENTS=t.WAVideoCodecScheme=t.WACallState=t.WACallEvent=t.WACallEndReason=t.VoipSettingsType=t.VideoUpgradeRequestEndedReason=t.VideoState=t.VOIP_WINDOW_IPC_EVENTS=t.RENDERER_IPC_EVENTS=t.RELAY_INFO=t.PlatformTypeMapping=t.ParticipantState=t.MAIN_IPC_EVENTS=t.CallNetworkMedium=t.CALL_STATES=t.CALL_RESULT_TYPE=t.CALL_LOG_RESULT_TYPE=t.CALL_LOG_RESULT=void 0;t.WACallEvent={WANone:0,CallOfferSent:1,CallOfferReceived:2,CallOfferAckedWithRelayInfo:3,CallOfferNacked:4,CallOfferReceiptReceived:5,CallAcceptFailed:6,CallAcceptSent:7,CallAcceptReceived:8,CallPreacceptReceived:9,CallTerminateReceived:10,CallRejectReceived:11,CallOfferResend:12,AudioStreamStarted:13,P2PNegotiationSuccess:14,RelayCreateSuccess:15,CallStateChanged:16,P2PNegotiationFailed:17,MediaStreamError:18,AudioInitError:19,NoSamplingRatesForAudioRecord:20,SendOfferFailed:21,HandleOfferFailed:22,SendAcceptFailed:23,HandlePreAcceptFailed:24,HandleAcceptFailed:25,WillCreateSoundPort:26,SoundPortCreateFailed:27,TransportCandSendFailed:28,P2PTransportCreateFailed:29,P2PTransportMediaCreateFailed:30,P2PTransportStartFailed:31,P2PTransportRestartSuccess:32,MissingRelayInfo:33,ErrorGatheringHostCandidates:34,MediaStreamStartError:35,RelayLatencySendFailed:36,RelayElectionSendFailed:37,CallEnding:38,CallCaptureBufferFilled:39,CallCaptureEnded:40,RxTimeout:41,TxTimeout:42,RxTrafficStarted:43,RxTrafficStopped:44,RTCPPacketReceived:45,RTCPByeReceived:46,RelayBindsFailed:47,SoundPortCreated:48,AudioDriverRestart:49,Echo:50,SelfVideoStateChanged:51,PeerVideoStateChanged:52,VideoPortCreated:53,VideoPortCreateFailed:54,VideoDecodeStarted:55,VideoRenderStarted:56,VideoCaptureStarted:57,VideoPreviewFailed:58,VideoPreviewReady:59,VideoPreviewShouldMinimize:60,VideoStreamCreateError:61,VideoRenderFormatChanged:62,VideoCodecMismatch:63,VideoDecodePaused:64,VideoDecodeResumed:65,VideoEncodeFatalError:66,VideoDecodeFatalError:67,BatteryLevelLow:68,PeerBatteryLevelLow:69,GroupInfoChanged:70,FieldstatsReady:71,PendingCallInfoChanged:72,MuteStateChanged:73,InterruptionStateChanged:74,RxTrafficStateForPeerChanged:75,HandleAcceptReceiptFailed:76,GroupParticipantLeft:77,AudioRouteChangeRequest:78,HandleAcceptAckFailed:79,CallMissed:80,WeakWiFiSwitchedToCellular:81,CallAutoConnect:82,RejectedDecryptionFailure:83,PeerDeviceOrientationChanged:84,HandleOfferAckFailed:85,PendingCallAutoRejected:86,FDLeakDetected:87,RestartCamera:88,AudioTestReplayFinished:89,SyncDevices:90,VideoCodecStateChanged:91,CallFatal:92,UpdateJoinableCallLog:93,WAMax:94};t.WAVideoCodecScheme={VideoCodecSchemeNone:0,VideoCodecSchemeH26X:1,VideoCodecSchemeVPX:2,VideoCodecSchemeVPXH26X:3};t.WACallEndReason={WACallEndReasonUnknown:0,WACallEndReasonEndButtonTapped:1,WACallEndReasonEndButtonTappedOnBusy:2,WACallEndReasonReject:3,WACallEndReasonRejectUnavailable:4,WACallEndReasonRejectBlocked:5,WACallEndReasonTimeout:6,WACallEndReasonPeerUnavailable:7,WACallEndReasonRejectedByPeer:8,WACallEndReasonTimedoutByPeer:9,WACallEndReasonTerminatedByPeer:10,WACallEndReasonFailed:11,WACallEndReasonHandledRemotely:12};t.WACallState={WACallStateNone:0,WACallStateCalling:1,WACallStatePreacceptReceived:2,WACallStateReceivedCall:3,WACallStateAcceptSent:4,WACallStateAcceptReceived:5,WACallStateCallActive:6,WACallStateCallActiveElseWhere:7,WACallStateReceivedCallWithoutOffer:8};t.WEB_CALL_UI_STATES={NONE:"NONE",OUTGOING_RING:"OUTGOING_RING",INCOMING_RING:"INCOMING_RING",OUTGOING_CALLING:"OUTGOING_CALLING",CONNECTING:"CONNECTING",RECONNECTING:"RECONNECTING",ACTIVE:"ACTIVE",ENDED:"ENDED",REJECTED:"REJECTED",REMOTE_CALL_IN_PROGRESS:"REMOTE_CALL_IN_PROGRESS",FAILED:"FAILED"};t.CALL_STATES={INCOMING_RING:"INCOMING_RING",OUTGOING_RING:"OUTGOING_RING",OUTGOING_CALLING:"OUTGOING_CALLING",CONNECTING:"CONNECTING",CONNECTION_LOST:"CONNECTION_LOST",ACTIVE:"ACTIVE",HANDLED_REMOTELY:"HANDLED_REMOTELY",ENDED:"ENDED",REJECTED:"REJECTED",REMOTE_CALL_IN_PROGRESS:"REMOTE_CALL_IN_PROGRESS",FAILED:"FAILED",NOT_ANSWERED:"NOT_ANSWERED"};t.WEB_CALL_STATES={OUTGOING_CALLING:"OUTGOING_CALLING",INCOMING_CALLING:"INCOMING_CALLING",ACTIVE:"ACTIVE",NONE:"NONE"};t.WEB_CALL_EVENTS={MEDIA_READY:"MEDIA_STREAM_READY",AUDIO_TRACK_RECEIVED:"AUDIO_TRACK_RECEIVED",VIDEO_TRACK_RECEIVED:"VIDEO_TRACK_RECEIVED"};t.VOIP_WINDOW_IPC_EVENTS={INIT:"VOIP_WINDOW_INIT",UPDATE:"VOIP_WINDOW_UPDATE",REJECT:"VOIP_WINDOW_REJECT",ACCEPT:"VOIP_WINDOW_ACCEPT",IGNORE:"VOIP_WINDOW_IGNORE",END:"VOIP_WINDOW_END",RESET:"VOIP_WINDOW_RESET",TOGGLE_MUTE:"VOIP_WINDOW_TOGGLE_MUTE",TOGGLE_CAMERA:"VOIP_WINDOW_TOGGLE_CAMERA",OPEN_IN_CALL_MENU:"OPEN_IN_CALL_MENU",CLOSE_IN_CALL_MENU:"CLOSE_IN_CALL_MENU",TOGGLE_DEBUG_INFO:"TOGGLE_DEBUG_INFO",GROUP_CALL_INVITE:"GROUP_CALL_INVITE",UPGRADE_REQUEST:"UPGRADE_REQUEST",UPGRADE_ACCEPT:"UPGRADE_ACCEPT",UPGRADE_REJECT:"UPGRADE_REJECT",UPGRADE_CANCEL:"UPGRADE_CANCEL",INITIATE_WINDOW_MOVE:"INITIATE_WINDOW_MOVE",CLOSE_WINDOW_CLICK:"CLOSE_WINDOW_CLICK",MINIMIZE_WINDOW_CLICK:"MINIMIZE_WINDOW_CLICK",MAXIMIZE_WINDOW_CLICK:"MAXIMIZE_WINDOW_CLICK",UNMAXIMIZE_WINDOW_CLICK:"UNMAXIMIZE_WINDOW_CLICK",WINDOW_MAXIMIZED:"WINDOW_MAXIMIZED",WINDOW_UNMAXIMIZED:"WINDOW_UNMAXIMIZED",WINDOW_TITLE_DBL_CLICK:"WINDOW_TITLE_DBL_CLICK",WINDOW_ESC_PRESS:"WINDOW_ESC_PRESS",WINDOW_ALWAYS_ON_TOP_CHANGED:"WINDOW_ALWAYS_ON_TOP_CHANGED",L10N_UPDATE:"L10N_UPDATE"};t.MAIN_IPC_EVENTS={EVENT:"VOIP_MAIN_WINDOW_EVENT",SIGNALING:"VOIP_MAIN_WINDOW_SIGNALING",LOGGING:"VOIP_MAIN_WINDOW_LOGGING",LOG_PATH:"VOIP_MAIN_WINDOW_LOG_PATH",AV_EVENT:"AV_DEVICE_INFO_CHANGED",AV_LOG:"AV_MAIN_WINDOW_LOGGING",AV_DEVICE_CHANGE_TOAST:"AV_DEVICE_CHANGE_TOAST",AV_DEVICE_STATUS_CHANGE:"AV_DEVICE_STATUS_CHANGE"};t.RENDERER_IPC_EVENTS={ENABLE_VOIP_FEATURES:"voip:ENABLE_VOIP_FEATURES",ENABLE_VOIP_GROUP_FEATURES:"voip:ENABLE_VOIP_GROUP_FEATURES",REQUEST_NUM_PARTICIPANTS:"voip:REQUEST_NUM_PARTICIPANTS"};t.CALL_RESULT_TYPE={INVALID:0,CONNECTED:1,REJECTED_BY_USER:2,REJECTED_BY_SERVER:3,MISSED:4,BUSY:5,SETUP_ERROR:6,SERVER_NACK:7,CALL_OFFER_ACK_NOT_RECEIVED:8,MISSED_NO_RECEIPT:9,ACCEPTED_BUT_NOT_CONNECTED:10,CALL_CANCELED_CELLULAR_IN_PROGRESS:11,CALL_CANCELED_AIRPLANE_MODE_ON:12,CALL_CANCELED_NO_NETWORK:13,CALL_OFFER_ACK_CORRUPT:14,CALL_REJECTED_TOS:15,CALL_REJECTED_E2E:16,CALL_REJECTED_UNAVAILABLE:17,CALL_CANCELED_OFFER_NOT_SENT:18,PEER_SETUP_ERROR:19,ACTIVE_ELSEWHERE:20,NO_DECRYPTED_OFFER:21,ACCEPTED_ELSEWHERE:22,REJECTED_ELSEWHERE:23};t.CALL_LOG_RESULT={0:"invalid",1:"canceled",2:"missed",3:"unavailable",4:"reject",5:"connected"};t.CALL_LOG_RESULT_TYPE={INVALID:0,CANCELED:1,MISSED:2,UNAVAILABLE:3,REJECT:4,CONNECTED:5};t.VoipSettingsType={voipSettingsNone:0,voipSettingsAudio:1,voipSettingsVideo:2};t.VideoState={VideoStateDisabled:0,VideoStateEnabled:1,VideoStatePaused:2,VideoStateUpgradeRequest:3,VideoStateUpgradeAccept:4,VideoStateUpgradeReject:5,VideoStateStopped:6,VideoStateUpgradeRejectByTimeout:7,VideoStateUpgradeCancel:8,VideoStateUpgradeCancelByTimeout:9,VideoStateError:20};t.VideoUpgradeRequestEndedReason={EndedByUser:0,EndedByTimeout:1};t.ParticipantState={ParticipantStateInvalid:0,ParticipantConnected:1,ParticipantIncoming:2,ParticipantRinging:3,ParticipantRejected:4,ParticipantTerminated:5,ParticipantTimedout:6,ParticipantCreatingCall:7,ParticipantInvisible:8,ParticipantVisible:9,ParticipantCancelOffer:10};t.CallNetworkMedium={CallNetworkMediumCellular:1,CallNetworkMediumWifi:2,CallNetworkMediumNone:3};t.PlatformTypeMapping={0:"unknown",1:"android",2:"iphone",3:"wp",4:"ios_tablet",5:"kaios",6:"windows",7:"portal",8:"mac_os_electron",9:"windows_electron"};t.RELAY_INFO={RELAY_ELECTION:"relayelection",RELAY_LATENCY:"relaylatency"}},24746:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VIDEO_CODECS=t.ENCOPT=t.CAPABILITIES=t.AUDIO_CODECS=void 0;t.CAPABILITIES={DEFAULT:["capability",{ver:"1"},[1,4,255,131,207,4]]};t.ENCOPT={DEFAULT:["encopt",{keygen:"2"},null]};t.AUDIO_CODECS={DEFAULT:[["audio",{enc:"opus",rate:"16000"},null],["audio",{enc:"opus",rate:"8000"},null]],RATE_16K:[["audio",{enc:"opus",rate:"16000"},null]]};t.VIDEO_CODECS={NONE:[],DEFAULT:[["video",{orientation:"0",screen_width:"1920",screen_height:"1080",device_orientation:"0",enc:"vp8",dec:"vp8"},null]]}},91214:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.commitDeviceLinkEvent=m,t.initDeviceLinkEvent=function(){return h.apply(this,arguments)},t.setDeviceLinkPairStage=function(e){if(!u)return;f=e,m()};var i=r(n(48926)),a=n(15688),o=n(8584),s=n(73045),l=n(92844),c=r(n(11339)),d=n(58052);let u=null,p=null,f=null;function h(){return(h=(0,i.default)((function*(e,t,n){u=new c.default.MdLinkDeviceCompanion;const r=yield _(e,t);p={regStartTime:n,sessionId:r}}))).apply(this,arguments)}function _(){return g.apply(this,arguments)}function g(){return(g=(0,i.default)((function*(e,t){const n=new o.Binary;n.writeBuffer(e),n.write("_".charCodeAt(0)),n.writeBuffer(t);const r=n.readByteArray(),i=yield(0,s.sha256)(r);return(0,a.encodeB64)(i)}))).apply(this,arguments)}function m(e){const t=(0,d.getUpgradeMdWamFlag)();if(!u||!p)return;const n=p,r=(0,l.unixTime)()-n.regStartTime;if(null==f)return;u=new c.default.MdLinkDeviceCompanion({mdDurationS:r,mdSessionId:n.sessionId,mdTimestampS:n.regStartTime,mdWasUpgraded:t,mdLinkDeviceCompanionErrorCode:null==e?0:e,mdLinkDeviceCompanionStage:f});const i=u;i.commit(!0),null==e&&i.mdLinkDeviceCompanionStage!==c.default.MD_LINK_DEVICE_COMPANION_STAGE.COMPLETE||(u=null,p=null,f=null,(0,d.setUpgradeMdWamFlag)(!1))}},68271:(e,t)=>{"use strict";function n(){let e={},t={},n={};const r={},i=Object.getOwnPropertyNames(window),a=Object.getOwnPropertyNames(document),o=Array.prototype.slice.call(window.document.documentElement.attributes);function s(e,t){const n={};return e.map((e=>{n[e]=!!t.includes(e)})),n}return t=s(["_phantom","__nightmare","_selenium","callPhantom","callSelenium","_Selenium_IDE_Recorder"],i),e=s(["__webdriver_evaluate","__selenium_evaluate","__webdriver_script_function","__webdriver_script_func","__webdriver_script_fn","__fxdriver_evaluate","__driver_unwrapped","__webdriver_unwrapped","__driver_evaluate","__selenium_unwrapped","__fxdriver_unwrapped"],a),n=s(["selenium","webdriver","driver"],o),t.wd=window.navigator.webdriver,r.wKeys=t,r.dKeys=e,r.dElKeys=n,r}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r={getAutoToolsProperties:()=>({data:n()})};t.default=r},7902:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(68271)),a=r(n(11339));var o=new class{constructor(){this.logToWam()}logToWam(){const e=i.default.getAutoToolsProperties(),t={webcDocumentWebdriverEvaluate:e.data.dKeys.__webdriver_evaluate,webcDocumentSeleniumEvaluate:e.data.dKeys.__selenium_evaluate,webcDocumentWebdriverScriptFunction:e.data.dKeys.__webdriver_script_function,webcDocumentWebdriverScriptFunc:e.data.dKeys.__webdriver_script_func,webcDocumentWebdriverScriptFn:e.data.dKeys.__webdriver_script_fn,webcDocumentFxdriverEvaluate:e.data.dKeys.__fxdriver_evaluate,webcDocumentDriverUnwrapped:e.data.dKeys.__driver_unwrapped,webcDocumentWebdriverUnwrapped:e.data.dKeys.__webdriver_unwrapped,webcDocumentDriverEvaluate:e.data.dKeys.__driver_evaluate,webcDocumentSeleniumUnwrapped:e.data.dKeys.__selenium_unwrapped,webcDocumentFxdriverUnwrapped:e.data.dKeys.__fxdriver_unwrapped,webcDocumentElementAttrSelenium:e.data.dElKeys.selenium,webcDocumentElementAttrWebdriver:e.data.dElKeys.webdriver,webcDocumentElementAttrDriver:e.data.dElKeys.driver,webcWindowPhantom:e.data.wKeys._phantom,webcWindowNightmare:e.data.wKeys.__nightmare,webcWindowSelenium:e.data.wKeys._selenium,webcWindowCallphantom:e.data.wKeys.callPhantom,webcWindowCallselenium:e.data.wKeys.callSelenium,webcWindowSeleniumIdeRecorder:e.data.wKeys._Selenium_IDE_Recorder,webcWindowNavigatorWebdriver:!0===e.data.wKeys.wd?a.default.WEBC_WINDOW_NAVIGATOR_WEBDRIVER_TYPE.TRUE:!1===e.data.wKeys.wd?a.default.WEBC_WINDOW_NAVIGATOR_WEBDRIVER_TYPE.FALSE:a.default.WEBC_WINDOW_NAVIGATOR_WEBDRIVER_TYPE.UNDEFINED};new a.default.WebcFingerprint(t).commit()}};t.default=o},42515:(e,t,n)=>{"use strict";function r(e){const t=e.participants.length,n=e.cachedDeviceCount;if(t>32){const e={participantCount:t};return null!=n&&(e.deviceCount=n),e}}Object.defineProperty(t,"__esModule",{value:!0}),t.getGroupMetricsFromChatWid=function(e){if(!e.isGroup())return;const t=n(63928).default.get(e);if(null!=t)return r(t)},t.getGroupMetricsFromGroupMetadata=r},50047:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.logLabelOperationEvent=function(e,t,n){const r={labelOperation:e};null!=t&&Object.assign(r,{labelCount:t});n&&Object.assign(r,{labelTarget:n});new i.default.LabelEvent(r).commit()};var i=r(n(11339))},88353:(e,t,n)=>{"use strict";t.I=void 0;var r=n(15688),i=n(8584),a=n(87278),o=n(55021);const s=n(11339).default;t.I=class{constructor(e,t,n,r){this.bufferKey=e,this.buffer=new i.Binary(void 0,!0),this.buffer.writeString("WAM");const a=(0,o.getWamProtocolVersion)();this.buffer.writeUint8(a),a>=5&&(this.buffer.writeUint8(1),this.buffer.writeUint16(t),"regular"===this.bufferKey?this.buffer.writeUint8(0):this.buffer.writeUint8(2),this.psIdStore=n),this.eventsWritten=0,this.prevGlobals={},this.dirtyGlobals={},this.unsavedPortion=null,this.saveKey=String(1e9*Math.random()|0),r&&this._setAll(r)}size(){return this.buffer.size()}set(e,t){this.dirtyGlobals[String(e)]=t,this.unsavedPortion&&this.unsavedPortion.set(e,t)}write(e){const t=this.buffer;var n;(this.set(47,e.commitTime),this.set(3433,e.sequenceNumber),"private"===e.wamChannel)&&this.set(6005,null===(n=this.psIdStore)||void 0===n?void 0:n.getLatestPrivateStatsIdValueFromKey(this.bufferKey).toString());this._flushGlobals();const r=e.all,i=Object.keys(r);let o=-1,l=!1;for(let e=0;e<i.length;e++){null!=r[i[e]]&&(o=e,l=!0)}(0,a.writeEvent)(t,e.id,-e.weight,l);for(let n=0;n<=o;n++){const c=i[n],d=s.METRICS.getEvent(e.$className,c).id;let u=r[c];null!=u&&("boolean"==typeof u&&(u=u?1:0),l=n<o,(0,a.writeField)(t,d,u,l))}this.eventsWritten++,this.unsavedPortion&&this.unsavedPortion.write(e)}stringBuffer(){return this.eventsWritten>0?(0,r.encodeB64)(this.buffer.peek((e=>e.readByteArray()))):""}getBuffer(){return this.buffer}_setAll(e){const t="regular"===this.bufferKey?"regular":"private";for(const n in e){const r=e[n],i=s.METRICS.getGlobal(n).channels.includes(t);void 0!==r&&i&&this.set(s.METRICS.getGlobal(n).id,r)}}_flushGlobals(){const e=this.dirtyGlobals,t=this.prevGlobals;for(const n in e){let r=e[n];if("boolean"==typeof r)r=r?1:0;else if(void 0===r)r=null;else if(Number.isNaN(r))continue;if(r!==t[n]){t[n]=r;const e=parseInt(n,10);(0,a.writeGlobalAttribute)(this.buffer,e,r)}}this.dirtyGlobals={}}upgradeWamHeaderFromV3ToV5(e){if(!n(57849).getABPropConfigValue("web_wam_v5_enabled")||this.buffer.size()<4)return this.buffer;const[t,r]=this.buffer.peek((e=>[e.readString(3),e.readUint8()]));if(3===r){const n=new i.Binary(void 0,!0);n.writeString(t),n.writeUint8(5),n.writeUint8(1),n.writeUint16(e),"regular"===this.bufferKey?n.writeUint8(0):n.writeUint8(2);const r=this.buffer.peek((e=>e.readByteArray())).slice(4);n.write(r),this.buffer=n}return this.buffer}}},87278:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.writeEvent=function(e,t,n,r){return i(e,t,n,r?1:5)},t.writeField=function(e,t,n,r){return i(e,t,n,r?2:6)},t.writeGlobalAttribute=function(e,t,n){return i(e,t,n,0)};var r=n(8584);function i(e,t,n,i){if(null==n)0===i&&a(e,t,i);else if("number"==typeof n&&n===(0|n))0===n?a(e,t,16|i):1===n?a(e,t,32|i):-128<=n&&n<128?(a(e,t,48|i),e.writeInt8(n)):-32768<=n&&n<32768?(a(e,t,64|i),e.writeInt16(n)):(a(e,t,80|i),e.writeInt32(n));else if("number"==typeof n)a(e,t,112|i),e.writeFloat64(n);else if("string"==typeof n){const o=(0,r.numUtf8Bytes)(n);o<256?(a(e,t,128|i),e.writeUint8(o)):o<65536?(a(e,t,144|i),e.writeUint16(o)):(a(e,t,160|i),e.writeUint32(o)),e.writeString(n)}}function a(e,t,n){t<256?(e.writeUint8(n),e.writeUint8(t)):(e.writeUint8(8|n),e.writeUint16(t))}},34894:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(11339));const a={document:i.default.MEDIA_TYPE.DOCUMENT,video:i.default.MEDIA_TYPE.VIDEO,gif:i.default.MEDIA_TYPE.GIF,image:i.default.MEDIA_TYPE.PHOTO,audio:i.default.MEDIA_TYPE.AUDIO};t.default=class{constructor(e,t,n){this.mediaPickerSentUnchanged=0,this.mediaPickerDeleted=0,this.mediaPickerChanged=new Set,this.mediaPickerCroppedRotated=new Set,this.mediaPickerDrawing=new Set,this.mediaPickerStickers=new Set,this.mediaPickerText=new Set,this.mediaPickerLikeDoc=0,this.mediaPickerNotLikeDoc=0,this.mediaPickerT=0,this.t0=Date.now(),this.mediaType=a[t],this.mediaPickerOrigin=n,this.medias=new Set,this.medias.add(e),this.changeTypes={mediaPickerCroppedRotated:this.mediaPickerCroppedRotated,mediaPickerDrawing:this.mediaPickerDrawing,mediaPickerStickers:this.mediaPickerStickers,mediaPickerText:this.mediaPickerText}}onAdd(e){this.medias.add(e),"document"===this.mediaType?this.mediaPickerLikeDoc++:this.mediaPickerNotLikeDoc++}onChange(e,t){this.mediaPickerChanged.add(e),this.changeTypes[t].add(e)}onDelete(e){if(this.medias.delete(e),this.mediaPickerDeleted++,0===this.medias.size)return this.onCancel()}onSend(){return this.mediaPickerSent=this.medias.size,this.mediaPickerSentUnchanged=this.mediaPickerSent-this.mediaPickerChanged.size,this.dataPreflight()}onCancel(){return this.mediaPickerSent=0,this.mediaPickerSentUnchanged=0,this.dataPreflight()}onPause(){this.mediaPickerT+=Date.now()-(this.t0||0),this.t0=null}onResume(){this.t0=null!=this.t0?this.t0:Date.now()}dataPreflight(){let e=this.mediaPickerSentUnchanged;return isNaN(e)&&(e=0,__LOG__(4,void 0,new Error,!0)`mediaPickerSentUnchange mediaPickerSent: ${null!=this.mediaPickerSent&&0!==this.mediaPickerSent?this.mediaPickerSent:"undefined"}, mediaPickerChanged: ${this.mediaPickerChanged.size||"undefined"}`,SEND_LOGS("mediaPickerSentUnchange is not a number")),{mediaPickerSent:this.mediaPickerSent,mediaPickerSentUnchanged:e,mediaPickerT:this.mediaPickerT+(Date.now()-(this.t0||0)),mediaType:this.mediaType,mediaPickerOrigin:this.mediaPickerOrigin,mediaPickerChanged:this.mediaPickerChanged.size,mediaPickerCroppedRotated:this.mediaPickerCroppedRotated.size,mediaPickerDrawing:this.mediaPickerDrawing.size,mediaPickerStickers:this.mediaPickerStickers.size,mediaPickerText:this.mediaPickerText.size,mediaPickerLikeDoc:this.mediaPickerLikeDoc,mediaPickerNotLikeDoc:this.mediaPickerNotLikeDoc,mediaPickerDeleted:this.mediaPickerDeleted}}}},90535:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.MediaPickerStatsLogger=t.MediaPickerChangeTypes=void 0;var i=r(n(81109)),a=r(n(34894)),o=r(n(11339));t.MediaPickerChangeTypes={mediaPickerCroppedRotated:"mediaPickerCroppedRotated",mediaPickerDrawing:"mediaPickerCroppedRotated",mediaPickerStickers:"mediaPickerCroppedRotated",mediaPickerText:"mediaPickerCroppedRotated"};t.MediaPickerStatsLogger=class{constructor(){this.mediaByTypeAndOrigin=new Map,this.mediaEventReverseIndex=new Map,this.chatRecipients=null}pauseTimer(){this.mediaByTypeAndOrigin.forEach((e=>{e.onPause()}))}resumeTimer(){this.mediaByTypeAndOrigin.forEach((e=>{e.onResume()}))}_getKey(e,t){return`${e}_${t}`}_commitLog(e){new o.default.MediaPicker((0,i.default)((0,i.default)({},e),{},{chatRecipients:this.chatRecipients})).commit()}_processNewMedia(e,t,n){const r=this._getKey(t,n),i=this.mediaByTypeAndOrigin.get(r);if(i)i.onAdd(e),this.mediaEventReverseIndex.set(e,i);else{const i=new a.default(e,t,n);this.mediaByTypeAndOrigin.set(r,i),this.mediaEventReverseIndex.set(e,i)}}logChange(e,t){const n=this.mediaEventReverseIndex.get(e);n&&n.onChange(e,t)}logDelete(e){const t=this.mediaEventReverseIndex.get(e);t&&t.onDelete(e)}logSend(e){this.mediaByTypeAndOrigin.forEach((t=>{this._commitLog((0,i.default)((0,i.default)({},t.onSend()),{},{isViewOnce:e.isViewOnce}))}))}logCancel(){this.mediaByTypeAndOrigin.forEach((e=>{this._commitLog(e.onCancel())}))}logAdd(e,t,n){this.mediaEventReverseIndex.get(e)||this._processNewMedia(e,t,n)}}},29992:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.generateMediaEventId=function(){return 1+Math.floor(Number.MAX_SAFE_INTEGER*Math.random())},t.getMetricBackendStore=function(e){if(!e)return l.default.BACKEND_STORE_TYPE.NON_DIRECT_PATH;switch(e.slice(0,2).toLowerCase()){case"/v":return l.default.BACKEND_STORE_TYPE.EVERSTORE;case"/o":return l.default.BACKEND_STORE_TYPE.OIL}return __LOG__(4,void 0,new Error,!0)`Unrecognized direct path type`,SEND_LOGS("unrecognized-direct-path-type"),null},t.getMetricDownloadErrorResultType=function(e){if(e instanceof s.MMSThrottleError)return l.default.MEDIA_DOWNLOAD_RESULT_TYPE.ERROR_THROTTLE;if(e instanceof o.NoMediaHostsError)return l.default.MEDIA_DOWNLOAD_RESULT_TYPE.ERROR_MEDIA_CONN;if(e instanceof a.HttpNetworkError)return l.default.MEDIA_DOWNLOAD_RESULT_TYPE.ERROR_NETWORK;if(e instanceof a.HttpStatusCodeError)switch(e.status){case 404:case 410:return l.default.MEDIA_DOWNLOAD_RESULT_TYPE.ERROR_TOO_OLD;case 416:return l.default.MEDIA_DOWNLOAD_RESULT_TYPE.ERROR_CANNOT_RESUME;case 401:return l.default.MEDIA_DOWNLOAD_RESULT_TYPE.ERROR_INVALID_URL;case 429:case 507:return l.default.MEDIA_DOWNLOAD_RESULT_TYPE.ERROR_THROTTLE;default:return l.default.MEDIA_DOWNLOAD_RESULT_TYPE.ERROR_UNKNOWN}if(e.name===i.ABORT_ERROR)return l.default.MEDIA_DOWNLOAD_RESULT_TYPE.ERROR_CANCEL;if(e instanceof a.MmsDownloadFilehashMismatchError)return l.default.MEDIA_DOWNLOAD_RESULT_TYPE.ERROR_ENC_HASH_MISMATCH;return l.default.MEDIA_DOWNLOAD_RESULT_TYPE.ERROR_UNKNOWN},t.getMetricMediaType=function(e){switch(e){case"audio":return l.default.MEDIA_TYPE.AUDIO;case"document":case"thumbnail-document":return l.default.MEDIA_TYPE.DOCUMENT;case"gif":return l.default.MEDIA_TYPE.GIF;case"image":case"thumbnail-image":return l.default.MEDIA_TYPE.PHOTO;case"ppic":return l.default.MEDIA_TYPE.PROFILE_PIC;case"product":return l.default.MEDIA_TYPE.PRODUCT_IMAGE;case"ptt":return l.default.MEDIA_TYPE.PTT;case"sticker":return l.default.MEDIA_TYPE.STICKER;case"video":case"thumbnail-video":return l.default.MEDIA_TYPE.VIDEO;case"template":return l.default.MEDIA_TYPE.TEMPLATE;case"md-msg-hist":return l.default.MEDIA_TYPE.MD_HISTORY_SYNC;case"md-app-state":return l.default.MEDIA_TYPE.MD_APP_STATE;case"product-catalog-image":return l.default.MEDIA_TYPE.PRODUCT_IMAGE;case"thumbnail-link":return l.default.MEDIA_TYPE.URL;case"payment-bg-image":return l.default.MEDIA_TYPE.NONE;default:throw new Error(`webMediaType is invalid: ${e}`)}},t.getMetricOverallDownloadModeType=function(e){if(c(e))return l.default.MEDIA_DOWNLOAD_MODE_TYPE.THUMBNAIL;return l.default.MEDIA_DOWNLOAD_MODE_TYPE.FULL},t.getMetricOverallUploadModeType=function(e){if(c(e))return l.default.MEDIA_UPLOAD_MODE_TYPE.THUMBNAIL;return l.default.MEDIA_UPLOAD_MODE_TYPE.REGULAR},t.getMetricUploadErrorResultType=function(e){if(e instanceof s.MMSUnauthorizedError)return l.default.MEDIA_UPLOAD_RESULT_TYPE.ERROR_NO_PERMISSIONS;if(e instanceof s.MediaTooLargeError)return l.default.MEDIA_UPLOAD_RESULT_TYPE.ERROR_BAD_MEDIA;if(e instanceof s.MMSThrottleError)return l.default.MEDIA_UPLOAD_RESULT_TYPE.ERROR_THROTTLE;if(e instanceof a.HttpStatusCodeError&&e.status>=500)return l.default.MEDIA_UPLOAD_RESULT_TYPE.ERROR_SERVER;if(e instanceof o.NoMediaHostsError)return l.default.MEDIA_UPLOAD_RESULT_TYPE.ERROR_MEDIA_CONN;if(e.name===i.ABORT_ERROR)return l.default.MEDIA_UPLOAD_RESULT_TYPE.ERROR_CANCEL;if(e instanceof a.HttpNetworkError)return l.default.MEDIA_UPLOAD_RESULT_TYPE.ERROR_UPLOAD;return l.default.MEDIA_UPLOAD_RESULT_TYPE.ERROR_UNKNOWN},t.getStatusCode=function(e){if(e instanceof a.HttpStatusCodeError)return e.status},t.logErrorUnknownDetails=function(e,t){if(null==t)return;let n;e.overallDownloadResult===l.default.MEDIA_DOWNLOAD_RESULT_TYPE.ERROR_UNKNOWN?n=l.default.WEBC_MEDIA_OPERATION_CODE.DOWNLOAD:e.overallUploadResult===l.default.MEDIA_UPLOAD_RESULT_TYPE.ERROR_UNKNOWN&&(n=l.default.WEBC_MEDIA_OPERATION_CODE.UPLOAD);if(null==n)return;new l.default.WebcMediaErrorUnknownDetails({mediaId:e.mediaId,webcMediaOperation:n,webcMediaErrorName:t.name}).commit()};var i=n(89385),a=n(23082),o=n(40859),s=n(27856),l=r(n(11339));function c(e){switch(e){case"thumbnail-document":case"thumbnail-image":case"thumbnail-video":case"thumbnail-link":return!0}return!1}},30097:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.MessageSendPerfReporter=void 0;var i=n(42515),a=r(n(11339)),o=r(n(57362));t.MessageSendPerfReporter=class{constructor(e,t,n){this._messageIsInvisible=!1,this._messageIsFirstUserMessage=!1,this._isRevokeMessage=!1,this._isDirectedMessage=!1,this._startTime=Date.now(),this._stagesMap=new Map,this._mediaType=t,this._messageType=n,this._cacheGroupMetadata(e)}setFetchedPrekeyCount(e){this._fetchedPrekeyCount=e}setSenderKeyDistributionCount(e){this._senderKeyDistributionCount=e}setMessageIsInvisible(e){this._messageIsInvisible=e}setMessageIsFirstUserMessage(e){this._messageIsFirstUserMessage=e}setIsRevokeMessage(e){this._isRevokeMessage=e}setIsDirectedMessage(e){this._isDirectedMessage=e}startRenderedStage(){this._start(a.default.CLIENT_MESSAGE_SEND_STAGE.CLIENT_RENDERED)}postRenderedStage(){this._post(a.default.CLIENT_MESSAGE_SEND_STAGE.CLIENT_RENDERED)}startSavedStage(){this._start(a.default.CLIENT_MESSAGE_SEND_STAGE.CLIENT_SAVED)}postSavedStage(){this._post(a.default.CLIENT_MESSAGE_SEND_STAGE.CLIENT_SAVED)}startPrekeysFetchStage(){this._start(a.default.CLIENT_MESSAGE_SEND_STAGE.CLIENT_PREKEYS_FETCH)}postPrekeysFetchStage(){this._post(a.default.CLIENT_MESSAGE_SEND_STAGE.CLIENT_PREKEYS_FETCH)}startWrittenWireStage(){this._start(a.default.CLIENT_MESSAGE_SEND_STAGE.CLIENT_WRITTEN_WIRE)}postWrittenWireStage(){this._post(a.default.CLIENT_MESSAGE_SEND_STAGE.CLIENT_WRITTEN_WIRE)}startWaitingToEncryptStage(){this._start(a.default.CLIENT_MESSAGE_SEND_STAGE.CLIENT_WAITING_TO_ENCRYPT)}postWaitingToEncryptStage(){this._post(a.default.CLIENT_MESSAGE_SEND_STAGE.CLIENT_WAITING_TO_ENCRYPT)}startReadyToSendStage(){this._start(a.default.CLIENT_MESSAGE_SEND_STAGE.CLIENT_READY_TO_SEND)}postReadyToSendStage(){this._post(a.default.CLIENT_MESSAGE_SEND_STAGE.CLIENT_READY_TO_SEND)}startClientEncryptStage(){this._start(a.default.CLIENT_MESSAGE_SEND_STAGE.CLIENT_ENCRYPT)}postClientEncryptStage(){this._post(a.default.CLIENT_MESSAGE_SEND_STAGE.CLIENT_ENCRYPT)}_start(e){const t=new a.default.AndroidMessageSendPerf({sendStage:e});return this._stagesMap.set(e,t),t}_post(e){const t=this._stagesMap.get(e)||this._start(e);if(t.mediaType=this._mediaType,t.messageType=this._messageType,t.messageIsInvisible=this._messageIsInvisible,t.messageIsFirstUserMessage=this._messageIsFirstUserMessage,t.durationRelative=Date.now()-this._startTime,t.fetchPrekeys=null!=this._fetchedPrekeyCount&&this._fetchedPrekeyCount>0,t.isRevokeMessage=this._isRevokeMessage,t.isDirectedMessage=this._isDirectedMessage,this._groupMetadata){t.groupSizeBucket=(0,o.default)(this._groupMetadata.participants.length),null!=this._groupMetadata.cachedDeviceSizeBucket&&(t.deviceSizeBucket=this._groupMetadata.cachedDeviceSizeBucket),Object.assign(t,(0,i.getGroupMetricsFromGroupMetadata)(this._groupMetadata));const e=this._groupMetadata.cachedDeviceCount||0;e>0&&(null!=this._fetchedPrekeyCount&&(t.fetchPrekeysPercentage=Math.round(this._fetchedPrekeyCount/e*100)),null!=this._senderKeyDistributionCount&&(t.senderKeyDistributionCountPercentage=Math.round(this._senderKeyDistributionCount/e*100)))}null!=t.fetchPrekeysPercentage&&t.fetchPrekeysPercentage>=50||t.messageIsFirstUserMessage?t.weight=0:null!=t.senderKeyDistributionCountPercentage&&t.senderKeyDistributionCountPercentage>=50&&(t.weight=20),t.markDurationAbs(),t.commit()}_cacheGroupMetadata(e){if(null!=e&&e.isGroup()){const t=n(63928).default.get(e);null!=t&&(this._groupMetadata=t)}}}},11339:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(81109)),a=n(52211);const{BOOLEAN:o,INTEGER:s,NUMBER:l,STRING:c,TIMER:d}=a.TYPES,u=Object.freeze({INVALID_PROTOCOL_BUFFER:1}),p=Object.freeze({ADV_SIGNED_DEVICE_IDENTITY:1,ADV_DEVICE_IDENTITY:2,ADV_SIGNED_KEY_INDEX_LIST:3,ADV_KEY_INDEX_LIST:4}),f=Object.freeze({NONE:1,SOFTWARE:2,BUILTIN:3}),h=Object.freeze({NONE:1,SOFTWARE:2,BUILTIN:3}),_=Object.freeze({LIMITED:0,FULL:1,LEGACY:2,LEVEL_3:3,EXTERNAL:4}),g=Object.freeze({API_1:1,API_2:2}),m=Object.freeze({NOT_AVAILABLE:1,SELF_TEST_FAILURE:2,ENC_KEY_READ_FAILURE:3,ENC_KEY_STORED_USED:4,ENC_KEY_PLAIN_DELETED:5,ENC_KEY_PLAIN_RECOVERED:6}),y=Object.freeze({DEBUG:1,ALPHA:2,BETA:3,RELEASE:4}),E=Object.freeze({FOREGROUND:1,BACKGROUND:2}),S=Object.freeze({JNI:1,OPENSLES:2}),v=Object.freeze({AUTO_REPLY_ACTION_FLAG_RECEIVED:0,AUTO_REPLY_ACTION_REPLY_SENT:1}),T=Object.freeze({NON_DIRECT_PATH:1,EVERSTORE:2,OIL:3}),b=Object.freeze({WIFI_ONLY:0,WIFI_OR_CELLULAR:1}),C=Object.freeze({OFF:0,DAILY:1,WEEKLY:2,MONTHLY:3,MANUAL:4}),A=Object.freeze({SHOWN:1,CLICK:2,DISMISS:3,ELIGIBLE:4,REVOKED:5}),P=Object.freeze({GROUP:1,SMB_WELCOME:2,SMB_VERIFIED:3,SMB_EDIT_PROFILE:4,SMB_EDIT_DESCRIPTION:5,SMB_EDIT_CATEGORY:6,SMB_EDIT_HOURS:7,SMB_EDIT_EMAIL:8,SMB_CATALOG:9,SMB_CATALOG_SHARE_BANNER:10,CROSS_SELL_PROFILE_INTERSTITIAL:11,CROSS_SELL_CHATS_INTERSTITIAL:12,CROSS_SELL_CHATS_BANNER:13,BUSINESS_ACCOUNT_SYSTEM_MESSAGE:14,SMB_CATALOG_CART_INTERSTITIAL:15,PAYMENTS_ONBOARD_BANNER:16,SMB_DIRECTORY_UPSELL:17,SMB_CATALG_LIST_LWI_ADVERTISE_BANNER:18,SMB_LWI_AD_HUB_EDUCATIONAL_BANNER:19,SMB_COLLECTION_CREATION:20,SMB_AWAY_MESSAGE:21,SMB_GREETING_MESSAGE:22,PAYMENTS_INCENTIVE_BANNER:23,SMB_ADSCREATION_CONVERSATIONS_BANNER_WITH_VALID_PRODUCT:24,SMB_ADSCREATION_CONVERSATIONS_BANNER_WITHOUT_VALID_PRODUCT:25,SMB_MD_AWARENESS:26,BACKUP_QUOTA:27,SMB_ADD_COVER_PHOTO:28,PAYMENTS_MERCHANT_ONBOARDING_BANNER:29,SMB_PAYMENTS_MERCHANT_ACCOUNT_STATUS_BANNER:30}),M=Object.freeze({SHOPS:0,NATIVE:1}),O=Object.freeze({UNKNOWN:1,SMB:2,ENT:3}),I=Object.freeze({OTHER:0,CHAT:1,PROFILE:2,BLOCK_LIST:3,TRIGGERED_BLOCK:4,ACCOUNT_INFO:5,CALL_LOG:6,OVERFLOW_MENU:7,GROUP_INFO:8,BLOCK_DIALOG:9,MESSAGE_MENU:10,MEDIA_VIEWER:11}),w=Object.freeze({OTHER:0,NO_LONGER_NEEDED:1,NO_SIGN_UP:2,SPAM:3,OFFENSIVE_MESSAGES:4,OTP_DID_NOT_REQUEST:5}),R=Object.freeze({REQUEST_BUILT:1,RESPONSE_RECEIVED:2,RESPONSE_PARSED_VALID:3,MISSING_KEYS_REQUESTED:4,MISSING_KEYS_RECEIVED:5,MUTATIONS_DECRYPTED:6,ABOUT_TO_APPLY_MUTATIONS:7,APPLIED_MUTATIONS:8,PUSHNAME_APPLIED:9,PUSHNAME_INVALID:10,ENTERED_RETRY_MODE:11}),D=Object.freeze({IMPRESSION:0,TAP_ON_MESSAGE:1,TAP_ON_PROFILE:2,TAP_ON_CATALOG_VIEW_ALL:3,TAP_ON_CATLOG_PRODUCT:4,DISMISS_PREVIEW:5}),L=Object.freeze({REGISTRATION:1,SETTINGS:2,COMPLIANCE:3,QUICK_REPLY_SMART_DEFAULT:4}),N=Object.freeze({DESCRIPTION:1,HOURS:2,ADDRESS:3,EMAIL:4,WEBSITE:5,CATEGORY:6,PROFILE:7}),k=Object.freeze({BUSINESS_PROFILE_VIEW_ACTION_IMPRESSION:1,BUSINESS_PROFILE_VIEW_ACTION_CLICK_WEBSITE:2,BUSINESS_PROFILE_VIEW_ACTION_CLICK_LOCATION:3,BUSINESS_PROFILE_VIEW_ACTION_CLICK_HOURS:4,BUSINESS_PROFILE_VIEW_ACTION_CLICK_DESCRIPTION:5,BUSINESS_PROFILE_VIEW_ACTION_CLICK_EMAIL:6,BUSINESS_PROFILE_VIEW_ACTION_CLICK_ADDTOCONTACT:7,BUSINESS_PROFILE_VIEW_ACTION_CLICK_MORE_BIZ_PROFILE:8}),U=Object.freeze({SOURCE_OTHER:1,SOURCE_INSTAGRAM:2}),G=Object.freeze({ENTRY_BANNER:0,ENTRY_REGISTRATION_ONBOARDING:1,ENTRY_CONVERSATIONS:2,ENTRY_SETTINGS:3,ENTRY_DEEPLINK:4,ENTRY_STATUS_TAB_MENU:5,ENTRY_CALLS_TAB_MENU:6}),x=Object.freeze({OVERFLOW:0,PROFILE:1,CATALOG:2,AWAY_MESSAGE:3,GREETING_MESSAGE:4,QUICK_REPLIES:5,LABELS:6,LINKED_ACCOUNTS:7,SHORT_LINK:8,STATISTICS:9,CREATE_ACCOUNT_LINK:10,MANAGE_CTA:11,CREATE_AD:12,CONTINUE_PROMPT:13,ADVERTISE_LIST_ITEM:14,SHOPS:15,DISABLED_CATALOG:16,BANNED_SHOP:17}),B=Object.freeze({FACEBOOK:0,INSTAGRAM:1}),F=Object.freeze({CALLS_TAB_MISSED:1,CALLS_TAB_OUTGOING:2,SELECT_CONTACT:3,CALL_INFO:4,NOTIFICATION_MISSED:5,CONTACT_INFO:6,QUICK_CONTACT_INFO:7,CONVERSATION:8,CALLS_TAB_INCOMING:9,GROUP_CHAT_INFO:10,GROUP_CHAT_RECENT_LOCATION:11,ANDROID_BROADCAST_DETAILS:12,ANDROID_LIST_CHAT_INFO:13,ANDROID_CONTACTS_APPLICATION:14,CONTACT_VCARD:15,CALLS_TAB_NEW_CALL:16,VOICE_MAIL_CALL_BACK:17,IOS_INTENT:18,LIVE_LOCATION_MAP:19,GROUP_CALL_INFO:20,CALLS_TAB_BOTTOM_SHEET:21,STATUS_VIEWER:22,DEBUG_TOOL:23,GROUP_CHAT_PICKER:24,GROUP_CHAT_DIRECT:25,STELLA:26,CHAT_LIST:27,NEW_CHAT:28,CONVERSATION_OPTIONS:29,CALL_FAILED_SCREEN:30,BUSINESS_DIRECTORY:31}),j=Object.freeze({CELLULAR:1,WIFI:2,NONE:3}),Y=Object.freeze({UNBOUND:1,BINDED:2}),K=Object.freeze({INVALID:0,CONNECTED:1,REJECTED_BY_USER:2,REJECTED_BY_SERVER:3,MISSED:4,BUSY:5,SETUP_ERROR:6,SERVER_NACK:7,CALL_OFFER_ACK_NOT_RECEIVED:8,MISSED_NO_RECEIPT:9,ACCEPTED_BUT_NOT_CONNECTED:10,CALL_CANCELED_CELLULAR_IN_PROGRESS:11,CALL_CANCELED_AIRPLANE_MODE_ON:12,CALL_CANCELED_NO_NETWORK:13,CALL_OFFER_ACK_CORRUPT:14,CALL_REJECTED_TOS:15,CALL_REJECTED_E2E:16,CALL_REJECTED_UNAVAILABLE:17,CALL_CANCELED_OFFER_NOT_SENT:18,PEER_SETUP_ERROR:19,ACTIVE_ELSEWHERE:20,NO_DECRYPTED_OFFER:21,ACCEPTED_ELSEWHERE:22,REJECTED_ELSEWHERE:23}),W=Object.freeze({CALL_SEGMENT_ONE_ON_ONE_ACTIVE:1,CALL_SEGMENT_GROUP_ACTIVE:2,CALL_SEGMENT_ONE_ON_ONE_HOLD_SELF:3,CALL_SEGMENT_ONE_ON_ONE_HOLD_PEER:4}),H=Object.freeze({UNKNOWN:1,CALL_ACCEPT_FAILED:2,INIT_MEDIA_STREAM_FAILED:3,START_MEDIA_STREAM_FAILED:4,AUDIO_INIT_ERROR:5,HANDLE_OFFER_FAILED:6,HANDLE_ACCEPT_FAILED:7,SOUND_PORT_CREATE_FAILED:8,P2P_TRANSPORT_CREATE_FAILED:9,P2P_TRANSPORT_MEDIA_CREATE_FAILED:10,INCOMPATIBLE_SRTP_KEY_EXCHANGE:11,SRTP_KEY_GENERATION_ERROR:12,UNSUPPORTED_AUDIO_CAPS:13,P2P_TRANSPORT_START_FAILED:14,RELAY_BIND_FAILED:15,CANNOT_INITIALIZE_AUDIO_RECORD_OBJECT:16,PEER_RELAY_BIND_FAILED:17,VIDEO_CAPTURE_INIT_FAILED:18,VIDEO_CAPTURE_START_FAILED:19,VIDEO_RENDER_INIT_FAILED:20,VIDEO_RENDER_START_FAILED:21,VIDEO_ENCODER_OPEN_FAILED:22,VIDEO_DECODER_OPEN_FAILED:23,VIDEO_STREAM_CREATE_FAILED:24,VIDEO_STREAM_SETUP_FAILED:25,PEER_SETUP_FAILED:26,HANDLE_PREACCEPT_FAILED:27}),V=Object.freeze({CALLER:1,CALLEE:2}),$=Object.freeze({ENDED_BY_USER:1,TIMEOUT:2,RECONNECTING:3,ENDED_BY_SELF:4,ENDED_BY_PEER:5,VIDEO_ENCODER_FATAL_ERROR:6,VIDEO_DECODER_FATAL_ERROR:7,AUDIO_RECORD_FATAL_ERROR:8,CRASH:9,DETECT_IDENTITY_CHANGE:10,USER_INVISIBLE:11,RELAY_BIND_FAILED:12,SETUP_FAILED:13,ACCEPTED_ELSEWHERE:14,REJECTED_ELSEWHERE:15,GROUP_CALL_ENDED:16,CALL_IS_FULL:17,PHONE_PERMISSION_DENIED:18}),z=Object.freeze({UNKNOWN:0,P2P:1,UDP_RELAY:2,TCP_RELAY:3,MIXED:4}),q=Object.freeze({DISABLED:0,ENABLED:1,PAUSED:2,UPGRADE_REQUEST:3,MUTED:6,ERROR:20}),J=Object.freeze({NONE:0,UNKNOWN:1,APNS_PUSH:2,IOS_VOIP_PUSH:3,GCM_PUSH:4,ONLINE:5,RIM_PUSH:6}),Q=Object.freeze({DEFAULT:0,TEXTURE:1,TEXTURE_FALLBACK:2}),X=Object.freeze({DEFAULT:0,CONSERVATIVE:1,STRICT:2,ERROR:11}),Z=Object.freeze({ACTION_PRODUCT_ADD_CLICKED:1,ACTION_PRODUCT_ADD_SUCCESS:2,ACTION_PRODUCT_ADD_FAILED:3,ACTION_PRODUCT_EDIT_CLICKED:4,ACTION_PRODUCT_EDIT_SUCCESS:5,ACTION_PRODUCT_EDIT_FAILED:6,ACTION_PRODUCT_DELETE_CLICKED:7,ACTION_PRODUCT_DELETE_SUCCESS:8,ACTION_PRODUCT_DELETE_FAILED:9,ACTION_APPEAL_PRODUCT_CLICKED:10,ACTION_APPEAL_PRODUCT_SUCCESS:11,ACTION_APPEAL_PRODUCT_FAILED:12,ACTION_CREATE_PRODUCT_CATALOG:13,ACTION_CREATE_PRODUCT_CATALOG_SUCCESS:14,ACTION_CREATE_PRODUCT_CATALOG_FAILED:15,ACTION_CATALOG_MENU_ITEM_CLICKED:16,ACTION_PRODUCT_RESUBMIT_CLICKED:17,ACTION_START_IMPORT_FLOW:18,ACTION_IMPORT_POST:19,ACTION_CARD_IMPRESSION:20,ACTION_CARD_ITEM_CLICK:21,ACTION_CARD_MORE_CLICK:22,ACTION_LIST_IMPRESSION:23,ACTION_LIST_ITEM_CLICK:24,ACTION_DETAIL_IMAGE_CLICK:25,ACTION_DETAIL_LINK_CLICK:26,ACTION_IMAGE_LIST_IMPRESSION:27,ACTION_IMAGE_LIST_CLICK:28,ACTION_FULL_IMAGE_IMPRESSION:29,ACTION_FULL_IMAGE_SWIPE:30,ACTION_DETAIL_IMPRESSION:31,ACTION_QUOTED_PRODUCT_IN_CONVERSATION_CLICK:32,ACTION_PRODUCT_IN_CONVERSATION_CLICK:33,ACTION_SEND_PRODUCT_MESSAGE:34,ACTION_ONBOARD_IMPRESSION:35,ACTION_SHARE_CATALOG_LINK_CLICK:36,ACTION_SHARE_PRODUCT_LINK_CLICK:37,ACTION_CATALOG_IN_CONVERSATION_CLICK:38,ACTION_SHARE_CATALOG_VIA_WA_LINK_CLICK:39,ACTION_SHARE_PRODUCT_VIA_WA_LINK_CLICK:40,ACTION_SHARE_CATALOG_COPY_LINK_CLICK:41,ACTION_SHARE_PRODUCT_COPY_LINK_CLICK:42,ACTION_SEND_CATALOG_CLICK:43,ACTION_ORDER_MESSAGE_CLICK:44,ACTION_ORDER_LIST_IMPRESSION:45,ACTION_ORDER_LIST_ITEM_CLICK:46,ACTION_MESSAGE_BUSINESS_BUTTON_CLICK:47,ACTION_QUOTED_PRODUCT_MESSAGE_SEND:48,ACTION_CART_ADD_PRODUCT:49,ACTION_CART_ICON_CLICK:50,ACTION_CART_SNACKBAR_CLICK:51,ACTION_CART_LIST_IMPRESSION:52,ACTION_CART_EDIT_PRODUCT:53,ACTION_CART_DELETE_PRODUCT:54,ACTION_CART_ABANDON:55,ACTION_SEND_ORDER_MESSAGE:56,ACTION_MENU_CLICK:57,ACTION_PRODUCT_HIDE_CLICKED:58,ACTION_PRODUCT_HIDE_SUCCESS:59,ACTION_PRODUCT_HIDE_CANCELLED:60,ACTION_PRODUCT_HIDE_FAILED:61,ACTION_PRODUCT_UNHIDE_CLICKED:62,ACTION_PRODUCT_UNHIDE_SUCCESS:63,ACTION_PRODUCT_UNHIDE_CANCELLED:64,ACTION_PRODUCT_UNHIDE_FAILED:65,ACTION_CATALOG_LIST_MENU_CLICKED:66,ACTION_CATALOG_LIST_MENU_CLICKED_WITH_ADVERTISE_SHOWN:67,ACTION_COLLECTION_CREATE_CLICKED:68,ACTION_COLLECTION_CREATED:69,ACTION_MENU_COLLECTIONS_CLICK:70,ACTION_COLLECTION_RENAME_CLICKED:71,ACTION_COLLECTION_RENAME_CANCELLED:72,ACTION_COLLECTION_RENAMED:73,ACTION_COLLECTION_DELETE_CLICKED:74,ACTION_COLLECTION_DELETE_CANCELLED:75,ACTION_COLLECTION_DELETED:76,ACTION_COLLECTION_ASSIGN_ITEMS:77,ACTION_COLLECTION_UNASSIGN_ITEMS:78,ACTION_COLLECTION_IMPRESSION:79}),ee=Object.freeze({CATALOG_ENTRY_POINT_PROFILE:1,CATALOG_ENTRY_POINT_SETTINGS:2,CATALOG_ENTRY_POINT_MESSAGE:3,CATALOG_ENTRY_POINT_ATTACHMENT_PANEL:4,CATALOG_ENTRY_POINT_NUX:5,CATALOG_ENTRY_POINT_DEEPLINK:6,CATALOG_ENTRY_POINT_CHAT:7,CATALOG_ENTRY_POINT_ORDER_MESSAGE:8,CATALOG_ENTRY_POINT_INVOICE_ATTACHMENT_PANEL:9,CATALOG_ENTRY_POINT_PRODUCT_LIST_MESSAGE:10,CATALOG_ENTRY_POINT_TOP_BAR:11}),te=Object.freeze({ACTION_CARD_IMPRESSION:1,ACTION_CARD_ITEM_CLICK:2,ACTION_CARD_MORE_CLICK:3,ACTION_LIST_IMPRESSION:4,ACTION_LIST_ITEM_CLICK:5,ACTION_DETAIL_IMAGE_CLICK:6,ACTION_DETAIL_LINK_CLICK:7,ACTION_IMAGE_LIST_IMPRESSION:8,ACTION_IMAGE_LIST_CLICK:9,ACTION_FULL_IMAGE_IMPRESSION:10,ACTION_FULL_IMAGE_SWIPE:11,ACTION_DETAIL_IMPRESSION:12,ACTION_REPORT_PRODUCT:13,ACTION_SEND_PRODUCT_MESSAGE:14,ACTION_REPORT_PRODUCT_SUCCESS:15,ACTION_REPORT_PRODUCT_FAILURE:16,ACTION_QUOTED_PRODUCT_IN_CONVERSATION_CLICK:17,ACTION_PRODUCT_IN_CONVERSATION_CLICK:18,ACTION_SHARE_CATALOG_LINK_CLICK:19,ACTION_SHARE_PRODUCT_LINK_CLICK:20,ACTION_CATALOG_IN_CONVERSATION_CLICK:21,ACTION_SHARE_CATALOG_VIA_WA_LINK_CLICK:22,ACTION_SHARE_PRODUCT_VIA_WA_LINK_CLICK:23,ACTION_SHARE_CATALOG_COPY_LINK_CLICK:24,ACTION_SHARE_PRODUCT_COPY_LINK_CLICK:25,ACTION_CHAT_CATALOG_ICON_CLICK:26,ACTION_MESSAGE_BUSINESS_BUTTON_CLICK:27,ACTION_CART_ADD_PRODUCT:28,ACTION_CART_EDIT_PRODUCT:29,ACTION_CART_DELETE_PRODUCT:30,ACTION_CART_ABANDON:31,ACTION_CART_ICON_CLICK:32,ACTION_CART_SNACKBAR_CLICK:33,ACTION_SEND_ORDER_MESSAGE:34,ACTION_ORDER_LIST_IMPRESSION:35,ACTION_QUOTED_PRODUCT_MESSAGE_SEND:36,ACTION_CART_LIST_IMPRESSION:37,ACTION_ORDER_MESSAGE_CLICK:38,ACTION_ORDER_LIST_ITEM_CLICK:39,ACTION_PLM_CART_CTA_CLICK:40,ACTION_COLLECTION_IMPRESSION:41}),ne=Object.freeze({CONTACT:0,NON_CONTACT:1,GROUP:2}),re=Object.freeze({ATTACHMENT:1,CAMERA:2,PTT:3,PAYMENT:4,GIMMICK:5,PHONE:6,VIDEO:7,MESSAGE:8,CALL:9}),ie=Object.freeze({CLICK:1}),ae=Object.freeze({OPEN:1,SELECT_FILTER:2,SEARCH_WITH_FILTER:3,SEARCH:4,SEARCH_ITEM_SELECTED:5,SEARCH_MSG_SENT:6}),oe=Object.freeze({CHAT_LIST:0}),se=Object.freeze({NONE:0,OTHER_LABELS:1,UNREAD:2,GROUP:3,BROADCAST_LIST:4,NEW_CUSTOMER:5,NEW_ORDER:6,PENDING_PAYMENT:7,PAID:8,ORDER_COMPLETE:9,CONTACT:10,NON_CONTACT:11}),le=Object.freeze({TOS3:1,COUNTRY:2}),ce=Object.freeze({NOT_MUTED:1,MUTED_NO_NOTIFICATIONS:2,MUTED_SILENT_NOTIFICATIONS:3}),de=Object.freeze({CONTACT:0,CHAT:1,GROUP:2,BROADCAST_LIST:3,MESSAGE:4}),ue=Object.freeze({INDIVIDUAL:1,SMB:2,ENT:3}),pe=Object.freeze({OUTSIDE_DIALOG_BOX:0,OK:1,LEARN_MORE:2}),fe=Object.freeze({SMALL:1,MEDIUM:2,LARGE:3,EXTRA_LARGE:4,XX_LARGE:5,XXX_LARGE:6,LT1500:7,LT2000:8,LT2500:9,LT3000:10,LT3500:11,LT4000:12,LT4500:13,LT5000:14,LARGEST_BUCKET:15}),he=Object.freeze({CLIENT_RENDERED:1,CLIENT_SAVED:2,CLIENT_WRITTEN_WIRE:3,CLIENT_QUEUED:4,CLIENT_WAITING_TO_ENCRYPT:5,CLIENT_READY_TO_SEND:6,CLIENT_ENCRYPT:7,CLIENT_PREKEYS_FETCH:8}),_e=Object.freeze({REGULAR:1,REGULAR_LOW:2,REGULAR_HIGH:3,CRITICAL_BLOCK:4,CRITICAL_UNBLOCK_LOW:5}),ge=Object.freeze({COMMERCE_ACTION_CARD_IMPRESSION:1,COMMERCE_ACTION_CARD_ITEM_CLICK:2,COMMERCE_ACTION_CARD_MORE_CLICK:3,COMMERCE_ACTION_LIST_IMPRESSION:4,COMMERCE_ACTION_LIST_ITEM_CLICK:5,COMMERCE_ACTION_DETAIL_IMAGE_CLICK:6,COMMERCE_ACTION_DETAIL_LINK_CLICK:7,COMMERCE_ACTION_IMAGE_LIST_IMPRESSION:8,COMMERCE_ACTION_IMAGE_LIST_CLICK:9,COMMERCE_ACTION_FULL_IMAGE_IMPRESSION:10,COMMERCE_ACTION_FULL_IMAGE_SWIPE:11,COMMERCE_ACTION_DETAIL_IMPRESSION:12,COMMERCE_ACTION_REPORT_PRODUCT:13,COMMERCE_ACTION_SEND_PRODUCT_MESSAGE:14,COMMERCE_ACTION_REPORT_PRODUCT_SUCCESS:15,COMMERCE_ACTION_REPORT_PRODUCT_FAILURE:16,COMMERCE_ACTION_QUOTED_PRODUCT_IN_CONVERSATION_CLICK:17,COMMERCE_ACTION_PRODUCT_IN_CONVERSATION_CLICK:18,COMMERCE_ACTION_SHARE_CATALOG_LINK_CLICK:19,COMMERCE_ACTION_SHARE_PRODUCT_LINK_CLICK:20,COMMERCE_ACTION_CATALOG_IN_CONVERSATION_CLICK:21,COMMERCE_ACTION_SHARE_CATALOG_VIA_WA_LINK_CLICK:22,COMMERCE_ACTION_SHARE_PRODUCT_VIA_WA_LINK_CLICK:23,COMMERCE_ACTION_SHARE_CATALOG_COPY_LINK_CLICK:24,COMMERCE_ACTION_SHARE_PRODUCT_COPY_LINK_CLICK:25,COMMERCE_ACTION_CHAT_CATALOG_ICON_CLICK:26,COMMERCE_ACTION_CLICK_ON_MESSAGE_BUSINESS_BUTTON:27}),me=Object.freeze({COMMERCE_ENTRY_POINT_PROFILE:1,COMMERCE_ENTRY_POINT_SETTINGS:2,COMMERCE_ENTRY_POINT_MESSAGE:3,COMMERCE_ENTRY_POINT_ATTACHMENT_PANEL:4,COMMERCE_ENTRY_POINT_NUX:5,COMMERCE_ENTRY_POINT_DEEPLINK:6,COMMERCE_ENTRY_POINT_CHAT:7,COMMERCE_ENTRY_POINT_ORDER_MESSAGE:8}),ye=Object.freeze({COMMERCE_PERF_ENTRY_POINT_PROFILE:1,COMMERCE_PERF_ENTRY_POINT_SETTINGS:2,COMMERCE_PERF_ENTRY_POINT_PRODUCT_MESSAGE:3,COMMERCE_PERF_ENTRY_POINT_ATTACHMENT_PANEL:4,COMMERCE_PERF_ENTRY_POINT_CATALOG_PDP:5,COMMERCE_PERF_ENTRY_POINT_DEEPLINK:6,COMMERCE_PERF_ENTRY_POINT_CATALOG_HOME:7,COMMERCE_PERF_ENTRY_POINT_SHOPS_PDP:8,COMMERCE_PERF_ENTRY_POINT_PRODUCT_LIST_MESSAGE:9}),Ee=Object.freeze({COMMERCE_PERF_MARKER_START:1,COMMERCE_PERF_MARKER_CACHE_CONTENT:2,COMMERCE_PERF_MARKER_NETWORK_CONTENT:3,COMMERCE_PERF_MARKER_INTERACT:4}),Se=Object.freeze({COMMERCE_PERF_CATALOG_PDP:1,COMMERCE_PERF_CATALOG_HOME:2,COMMERCE_PERF_PROFILE_CATALOG:3,COMMERCE_PERF_SHOPS_PDP:4}),ve=Object.freeze({PERSON:1,PUSH:2,OTHER:3,BACKOFF:4}),Te=Object.freeze({HOSTNAME:0,IP4:1,IP6:2}),be=Object.freeze({CHATD:1,MMS:2}),Ce=Object.freeze({PROBLEM_DESCRIPTION:1,SUGGESTED_FAQ:2,EMAIL_SEND:3,IN_APP_FAQ:4,CANCELLED:5,FAQ:6}),Ae=Object.freeze({MSG_SENT:1}),Pe=Object.freeze({DEEP_LINK_EXTERNAL:1,DEEP_LINK_WA_LINK_CLICK:2,QR_CODE_SHEET:3}),Me=Object.freeze({DEEP_LINK_UNKNOWN:1,DEEP_LINK_CHAT:2,DEEP_LINK_CONTACT_QR_CODE:3,DEEP_LINK_PAYMENT:4,DEEP_LINK_PRODUCT:5,DEEP_LINK_CATALOG:6,DEEP_LINK_FUTURE_PROOF:7,DEEP_LINK_GROUP_INVITE:8,DEEP_LINK_MSG_FORWARD:9,DEEP_LINK_MESSAGE_QR_CODE:10,DEEP_LINK_OPT_IN_QR_CODE:11,DEEP_LINK_CTWA:12,DEEP_LINK_STICKERPACK:13,DEEP_LINK_NOVI_HUB:14,DEEP_LINK_NOVI_ADD_DEBIT_CARD:15,DEEP_LINK_NOVI_ADD_BANK_ACCOUNT:16,DEEP_LINK_NOVI_WITHDRAW:17,DEEP_LINK_NOVI_RESET_PASSWORD:18,DEEP_LINK_PAYMENT_SIGNUP:19,DEEP_LINK_BIZTOOLS_ACCOUNTS:20,DEEP_LINK_PAYMENT_VIRALITY:21,DEEP_LINK_SETTINGS_ACCOUNT_DELETE:22,DEEP_LINK_SETTINGS_ACCOUNT_REQUEST_INFO:23,DEEP_LINK_SETTINGS_CHATS_HISTORY:24,DEEP_LINK_DISAPPEARING_MODE:25,DEEP_LINK_ARCHIVE_SETTINGS:26,DEEP_LINK_TOS:27,DEEP_LINK_NOVI_CARE:28,DEEP_LINK_NOVI_TPP_ACCOUNT_LINKING:29,DEEP_LINK_CONTACT_SUPPORT:30,DEEP_LINK_BIZTOOLS_DIRECTORY:31,DEEP_LINK_DIRECTORY:32,DEEP_LINK_CALL:33,DEEP_LINK_DIRECTORY_DEEPER_CATEGORY_SELECTION:34}),Oe=Object.freeze({APP_SWITCH:1,BROWSER:2,CANCELLED:3}),Ie=Object.freeze({PRIMARY:1,COMPANION:2}),we=Object.freeze({CHAT:1,INITIATED_BY_ME:2,INITIATED_BY_OTHER:3}),Re=Object.freeze({ACCOUNT_SETTINGS:1,SYSTEM_MESSAGE:2,INDIVIDUAL_CHAT_DISAPPEARING_MESSAGES_SETTING:3,GROUP_CHAT_DISAPPEARING_MESSAGES_SETTING:4,DEEP_LINK:5}),De=Object.freeze({CHAT_PERSONAL:1,CHAT_GROUP:2,STATUS_USER:3,STATUS_ADS:4,PRODUCT_CATALOG:5,GDPR:6,STICKER_PICKER:7,PROFILE_PICTURE:8,BLOKS:9,P2B:10,MESSAGE_HISTORY_SYNC:11}),Le=Object.freeze({NORMAL_QUALITY:1,MID_QUALITY:2,INELIGIBLE_IMAGE_TOO_SMALL:3,INELIGIBLE_PARTIAL_HASHES_NOT_FOUND:4,ERROR_DETERMINING_ELIGIBILITY:5,NOT_DOWNLOADED_ENOUGH_BYTES_TO_DETERMINE_ELIGIBILITY:6}),Ne=Object.freeze({INVALID_SENDER:1,MISSING_DSM:2,INVALID_DSM:3}),ke=Object.freeze({MESSAGE:0,PREKEY_MESSAGE:1,SENDER_KEY_MESSAGE:2}),Ue=Object.freeze({INDIVIDUAL:0,GROUP:1,LIST:2,STATUS:3}),Ge=Object.freeze({INVALID_MESSAGE:0,LEGACY_MESSAGE:1,INVALID_VERSION:2,PRE_KEY_MESSAGE_MISSING_PRE_KEY:3,PRE_KEY_MESSAGE_INVALID_KEY:4,UNTRUSTED_IDENTITY:5,NO_SESSION_AVAILABLE:6,PLAINTEXT_BYTE_MISMATCH:7,UNKNOWN_CIPHERTEXT_TYPE:8,UNKNOWN_CIPHERTEXT_VERSION:9,INVALID_PADDING:10,INVALID_PROTOCOL_BUFFER:11,INVALID_NUMBER_OF_MESSAGE_TYPES:12,INVALID_IMAGE_FILE_LENGTH:13,INVALID_IMAGE_FILE_SHA256:14,INVALID_IMAGE_MEDIA_URL:15,INVALID_IMAGE_MEDIA_KEY:16,INVALID_IMAGE_MIME_TYPE:17,UNKNOWN_V2_TAGS:18,INVALID_EDIT_VERSION:19,INVALID_HSM_NAMESPACE:20,INVALID_HSM_ELEMENT:21,UNKNOWN_PROTOCOL_MESSAGE_TYPE:22,DUPLICATE_MESSAGE:23,FINGERPRINT_IDENTITY_MISMATCH:24,FINGERPRINT_VERSION_MISMATCH:25,INVALID_ARGUMENT:26,INVALID_KEY:27,INVALID_KEY_ID:28,INVALID_MAC:29,NO_MEMORY:30,STALE_KEY_EXCHANGE:31,VRF_SIGNATURE_VERIFICATION_FAILED:32,ERROR_MINIMUM_VALUE:33,ERROR_UNKNOWN:34,INVALID_BROADCAST_STANZA_ATTRIBUTE:35,INVALID_LIST_REPLY_MESSAGE:36,INVALID_LIST_REPLY_ROW_IDENTIFIER:37,INVALID_BUTTONS_RESPONSE_MESSAGE:38,INVALID_BUTTONS_RESPONSE_BUTTON_IDENTIFIER:39,INVALID_ORDER_MESSAGE:40,ERROR_CANCELLED:41,FUTURE_MESSAGE:42,INVALID_EMPTY_PROTOBUF_NOT_ALLOWED:43,SELF_SEND:44,INVALID_MEDIA_MIME_TYPE_TEMPLATE_MESSAGE:45,INVALID_MEDIA_ENC_HASH:46,INVALID_IDENTITY:47,PASSTHROUGH:48,NOT_IN_PENDING_DEVICES:49,EDIT_TYPE_AND_PROTOCOL_MISMATCH:50,DECRYPTION_FAILED:51,DESERIALIZE_INVALID_PROTO_FORMAT:52,DESERIALIZE_RATCHET_KEY_BAD_FORMAT:53,DESERIALIZE_PK_INVALID_PROTO_FORMAT:54,DESERIALZE_PK_KEY_BAD_FORMAT:55,TOO_MANY_MESSAGES_IN_FUTURE:56,EMPTY_VERSION_CONTENT_SUFFIX:57,CONTENT_EXCEEDED_EXPECTED_LENGTH:58,GRP_INVALID_PROTO_FORMAT:59,GRP_INVALID_KEY_FORMAT:60,GRP_VERSION_CONTENT_EMPTY:61,GRP_INVALID_VERSION_CONTENT_LENGTH:62,GRP_SENDER_KEY_INVALID_PROTO_FORMAT:63,GRP_SENDER_KEY_PROTO_ERROR:64,GRP_TOO_MANY_MESSAGES_IN_FUTURE:65}),xe=Object.freeze({MY_PRIMARY:1,OTHER_PRIMARY:2,MY_COMPANION:3,OTHER_COMPANION:4}),Be=Object.freeze({B1:1,B4:2,B8:3,B16:4,B32:5,B64:6,B128:7,B256:8,B512:9,B1000:10,B1500:11,B2000:12,B2500:13,B3000:14,B3500:15,B4000:16,B4500:17,B5000:18,NULL:19}),Fe=Object.freeze({ACTION_OPEN:1,ACTION_SAVE:2,ACTION_DISCARD:3,ACTION_PROFILE_FIELD_OPEN:4,ACTION_PROFILE_FIELD_SAVE:5,ACTION_PROFILE_FIELD_DISCARD:6,ACTION_FACEBOOK_ENABLED:7,ACTION_FACEBOOK_DISABLED:8,ACTION_INSTAGRAM_ENABLED:9,ACTION_INSTAGRAM_DISABLED:10,ACTION_FB_IG_POP_SHOWN:11,ACTION_EDIT_COVER_PHOTO_CLICK:12,ACTION_REMOVE_COVER_PHOTO:13}),je=Object.freeze({CALL_TOO_SHORT:1}),Ye=Object.freeze({CHAT_INFO:1,SYSTEM_MESSAGE:2,CHAT_OVERFLOW:3}),Ke=Object.freeze({ROOM_OPEN_FAILURE:1,UNKNOWN_ERROR:2}),We=Object.freeze({USER_LEAVE:1,DEVICE_UNPAIR:2,IDENTITY_CHANGE:3,AUDIENCE_CHANGE:4,PERIODIC_ROTATION:5,KEY_CORRUPTION:6}),He=Object.freeze({BOTH:1,SELF:2,PEER:3}),Ve=Object.freeze({SHOW:1,LOGOUT:2,UPGRADE:3}),$e=Object.freeze({NEW:0,RETAINED:1,RESURRECTED:2}),ze=Object.freeze({GIPHY:0,TENOR:1}),qe=Object.freeze({GET_CATALOG:1,GET_PRODUCT:2,GET_PRODUCT_LIST:3,GET_COLLECTIONS:4,GET_SINGLE_COLLECTION:5}),Je=Object.freeze({SUCCESS:1,FAILURE:2}),Qe=Object.freeze({INCOMING_CALL_SCREEN_ANSWER:1,INCOMING_CALL_SCREEN_REJECT:2,INCOMING_CALL_NOTIFICATION_ANSWER:3,INCOMING_CALL_NOTIFICATION_REJECT:4,PENDING_CALL_SCREEN_END_AND_ANSWER:5,PENDING_CALL_SCREEN_HOLD_AND_ANSWER:6,PENDING_CALL_SCREEN_REJECT:7,INCOMING_CALL_REMOTE_ANSWER:8,INCOMING_CALL_REMOTE_REJECT:9,PENDING_CALL_NOTIFICATION_END_AND_ANSWER:10,PENDING_CALL_NOTIFICATION_REJECT:11}),Xe=Object.freeze({DEFAULT:0,PROBING_ROTT_TO_RELAY:1,PROBING_E2E_PEER_RX:2,PROBING_E2E_RX:3,HIS_RECENT_PEER_RX:4,HIS_RECENT_RX:5,HIS_RECENT_PROBING_ROTT_TO_RELAY:6,HIS_RECENT_PROBING_E2E_PEER_RX:7,HIS_RECENT_PROBING_E2E_RX:8,ONE_SIDE_INITIAL_BANDWIDTH_ESTIMATION:9}),Ze=Object.freeze({USER_START:0,USER_CANCEL:1,FLOW_SUCCESS:2,FLOW_ERROR:3,USER_VIEW:4,USER_PAY_NOW:5,USER_VIEW_BASKET:6,USER_VIEW_PAYMENT_DETAILS:7,USER_MESSAGE_BUSINESS:8}),et=Object.freeze({ADD:1,EDIT:2,DELETE:3,VIEW:4,CLICK_POSITIVE:5,CLICK_NEGATIVE:6,UPDATE_LABEL_COUNT:7}),tt=Object.freeze({LABEL:1,MESSAGE:2,CONTACT:3,LABELS_SCREEN:4,LABEL_DETAILS_SCREEN:5,EDIT_LABEL_DIALOG:6,DELETE_LABEL_DIALOG:7,LABEL_MESSAGE_DIALOG:8,LABEL_CHAT_DIALOG:9,ADD_LABEL_DIALOG:10,BULK_UNLABEL_DIALOG:11,LABEL_COMBINED_DIALOG:12,GROUP:13,BROADCAST:14}),nt=Object.freeze({OK:1,ERROR_UNKNOWN:2,SERVER_ERROR:3,SERVER_GOAWAY:4,NETWORK_ERROR:5,ANDROID_KEYSTORE_ERROR:6}),rt=Object.freeze({APP_STATE_SYNC_KEY_EXPIRY:1,DEVICE_DEREGISTERATION:2,NO_KEYS:3}),it=Object.freeze({INITIAL:1,RECENT_HISTORY:2,FULL_HISTORY:3,PUSHNAME:4,STATUS_V3:5}),at=Object.freeze({CRITICAL:1,NON_CRITICAL:2}),ot=Object.freeze({APP_STATE:1,HISTORY:2}),st=Object.freeze({SUCCESS:1,FAILURE:2}),lt=Object.freeze({PIN_MUTATION:1,UNPIN_4TH_CHAT_MUTATION:2,DELETE_MUTATION:3,CLEAR_CHAT_REMOVE_STARRED_MUTATION:4,CLEAR_CHAT_KEEP_STARRED_MUTATION:5}),ct=Object.freeze({PAIR_SUCCESS_RECEIVED:1,PAIR_DEVICE_SIGN_SENT:2,FIRST_CONNECT:3,UPLOAD_PREKEYS:4,COMPLETE:5}),dt=Object.freeze({INITIAL_SYNC:1,RESUME_SYNC:2,REGULAR_SYNC:3}),ut=Object.freeze({MESSAGE_RANGE_UNSET:1,MESSAGE_RANGE_LAST_SYSTEM_MESSAGE_TIMESTAMP_SET:2,MESSAGE_RANGE_MESSAGES_UNSET:3,MESSAGE_RANGE_MESSAGES_EMPTY:4,MESSAGE_RANGE_MESSAGES_CROSS_LIMIT:5,MESSAGE_RANGE_MESSAGE_KEY_UNSET:6,MESSAGE_RANGE_MESSAGE_KEY_REMOTE_JID_UNSET:7,MESSAGE_RANGE_MESSAGE_KEY_FROM_ME_UNSET:8,MESSAGE_RANGE_MESSAGE_KEY_STANZA_ID_UNSET:9,MESSAGE_RANGE_MESSAGE_KEY_REMOTE_JID_INVALID:10,MESSAGE_RANGE_MESSAGE_KEY_PARTICIPANT_UNSET:11,MALFORMED_PENDING_MUTATION:12,ACTION_INVALID_INDEX_DATA:13}),pt=Object.freeze({TOO_MANY_INTERNAL_SERVER_ERRORS_IN_7D:1,SERVER_DATA_MISMATCH:2,PROTOBUF_DESERIALIZATION_FAILED:3,EXTERNAL_PATCH_EXPIRED:4,MISSING_OR_EMPTY_INDEX:5,SAME_INDEX_FOR_MULTIPLE_MUTATIONS_IN_PATCH:6,DECRYPTION_FAILED:7,MISSING_PATCH_VERSION:8,DUPLICATE_PATCH_VERSION_IN_COLLECTION:9,ENCRYPTION_FAILED:10,MISSING_MUTATION_VERSION:11,MISSING_MUTATION_VALUE:12,INVALID_MUTATION_INDEX:13,PATCH_WITH_BOTH_INLINE_AND_EXTERNAL_MUTATIONS:14,MISSING_MUTATION_OPERATION:15,MISSING_MUTATION_RECORD:16,MISSING_MUTATION_KEY_ID:17,PATCH_PROTOBUF_DESERIALIZATION_FAILED:18,ACTION_DATA_PROTOBUF_DESERIALIZATION_FAILED:19,MISSING_MUTATION_INDEX:20,MISSING_ACTION_INDEX:21,INVALID_ACTION_INDEX:22,MISSING_ACTION_VALUE:23,MISSING_ACTION_VERSION:24,MISSING_ACTION_TIMESTAMP:25,MUTATIONS_PROTOBUF_DESERIALIZATION_FAILED:26,MUTATIONS_PROTOBUF_SERIALIZATION_FAILED:27,PATCH_PROTOBUF_SERIALIZATION_FAILED:28,ACTION_DATA_PROTOBUF_SERIALIZATION_FAILED:29,MISSING_KEY_ON_ALL_CLIENTS:30,TIMEOUT_WHILE_WAITING_FOR_MISSING_KEY:31,MAC_MISMATCH_SNAPSHOT:33,MAC_MISMATCH_PATCH:34,DB_STORE_NOT_READY:35,TERMINAL_PATCH_MISSING_DATA:36,TERMINAL_PATCH_DESERIALIZATION_ERROR:37,TERMINAL_PATCH_UNKNOWN:38,CYCLIC_MUTATION_DEPENDENCY_IN_PATCH:39,MISSING_SNAPSHOT_VERSION:45,MISSING_SNAPSHOT_MAC:46,MISSING_PATCH_SNAPSHOT_MAC:47,MISSING_PATCH_MAC:48,MISSING_EXTERNAL_BLOB_REFERENCE_MEDIA_KEY:49,MISSING_EXTERNAL_BLOB_REFERENCE_DIRECT_PATH:50,MISSING_EXTERNAL_BLOB_REFERENCE_FILE_SHA256:51,MISSING_EXTERNAL_BLOB_REFERENCE_FILE_ENC_SHA256:52,INVALID_KEY_SHARE_KEY_ID:53,MISSING_PATCH_KEY_ID:56,INVALID_KEY_SHARE_KEY_DATA:57,SNAPSHOT_EXPIRED:58,MISSING_SNAPSHOT_KEY_ID:59,SNAPSHOT_MAC_MISMATCH_IN_PATCH:60,SNAPSHOT_MAC_MISMATCH_IN_SNAPSHOT:61,XMPP_BAD_REQUEST_FOR_COLLECTION:62,XMPP_NOT_FOUND_FOR_COLLECTION:63,XMPP_BAD_REQUEST_GLOBAL_ERROR:64,XMPP_NOT_FOUND_GLOBAL_ERROR:65,XMPP_BAD_METHOD_GLOBAL_ERROR:66,XMPP_NOT_ACCEPTABLE_GLOBAL_ERROR:67,SAME_INDEX_FOR_MULTIPLE_MUTATIONS_IN_SNAPSHOT:68,EXTERNAL_BLOB_REFERENCE_PROTOBUF_DESERIALIZATION_FAILED:69,SNAPSHOT_PROTOBUF_DESERIALIZATION_FAILED:70,REQUESTING_MISSING_KEY_WITH_NO_CLIENTS:71,DB_STORE_NOT_READY_LOW_DISK_SPACE:72,SERVER_DID_NOT_SEND_ALL_PATCHES:73,SERVER_SENT_EARLIER_PATCH:74,MISSING_KEY_FOR_MUTATION_IN_LOCAL_SNAPSHOT:75,MISSING_ACTIVE_KEY_AFTER_ROTATION:76,MISSING_ACTIVE_KEY_FOR_ENCRYPTION:77,MISSING_CURRENT_EPOCH_FOR_ACTIVE_KEY_VALIDATION:78,SAME_INDEX_FOR_MULTIPLE_MUTATIONS_IN_OUTGOING_PATCH:79,INVALID_SNAPSHOT_RECORDS:80,MISSING_EXTERNAL_BLOB_REFERENCE_HANDLE:81,INVALID_EXTERNAL_BLOB_REFERENCE_UPLOADED:82,INVALID_PATCH_KEY_ID_SIZE:83,INVALID_PATCH_MAC_SIZE:84,INVALID_PATCH_SNAPSHOT_MAC_SIZE:85,INVALID_COLLECTION_SNAPSHOT_HASH_SIZE:86,MISSING_COLLECTION_SNAPSHOT_HASH:87,INVALID_PATCH_KEY_ID_DEVICE_ID:88,INVALID_PATCH_KEY_ID_EPOCH:89,DECRYPTION_FAILED_KEY_ID_MISMATCH:90,DECRYPTION_FAILED_VALUE_MAC_MISMATCH:91,DECRYPTION_FAILED_INDEX_MAC_MISMATCH:92,EXTERNAL_PATCH_MISSING_BLOB:93,COLLECTION_PULL_REQUEST_RECEIVED_PUSH_RESPONSE_WITH_UPDATED_VERSION:94,COLLECTION_PUSH_REQUEST_RECEIVED_RESPONSE_WITH_VERSION_MISMATCH:95,MMS_ERROR_INVALID_FILEHASH:96}),ft=Object.freeze({SNAPSHOT:1,EXTERNAL_PATCH:2,INLINE_PATCH:3}),ht=Object.freeze({SYNCD:1,WEB:2}),_t=Object.freeze({BROWSER:1,DESKTOP:2}),gt=Object.freeze({MANUAL:1,FULL:2,PREFETCH:3,HEADER:4,THUMBNAIL:5}),mt=Object.freeze({OK:1,ERROR_UNKNOWN:2,ERROR_TIMEOUT:3,ERROR_DNS:4,ERROR_INSUFFICIENT_SPACE:5,ERROR_TOO_OLD:6,ERROR_CANNOT_RESUME:7,ERROR_HASH_MISMATCH:8,ERROR_INVALID_URL:9,ERROR_OUTPUT_STREAM:10,ERROR_CANCEL:11,DEDUPED:12,ERROR_ENC_HASH_MISMATCH:14,PREFETCH_END:15,ERROR_CANCEL_PROGRAMMATIC:16,ERROR_MEDIA_CONN:17,ERROR_THROTTLE:18,ERROR_SSL:19,ERROR_NETWORK:20,ERROR_CONNECT:21}),yt=Object.freeze({CHAT_PHOTO_LIBRARY:1,CAMERA_TAB_CAPTURE:2,FORWARD:3,PASTE:4,SHARE_EXTENSION:5,EXPORT:6,MENU_CAMERA_CAPTURE:7,EXTERNAL_CAMERA:8,LINK_PREVIEW_DOWNLOAD:9,CAMERA_TAB_MEDIA_STRIP:10,CAMERA_TAB_PHOTO_LIBRARY:11,CHAT_BUTTON_CAMERA_CAPTURE:12,CHAT_BUTTON_CAMERA_MEDIA_STRIP:13,CHAT_BUTTON_CAMERA_PHOTO_LIBRARY:14,STATUS_TAB_CAMERA_CAPTURE:15,STATUS_TAB_CAMERA_MEDIA_STRIP:16,STATUS_TAB_CAMERA_PHOTO_LIBRARY:17,STATUS_REPLY_CAMERA_CAPTURE:18,STATUS_REPLY_CAMERA_MEDIA_STRIP:19,STATUS_REPLY_CAMERA_PHOTO_LIBRARY:20,MENU_CAMERA_PHOTO_LIBRARY:21,CHAT_GIF_INAPP:22,CHAT_GIF_EXTERNAL:23,STATUS_REPLY_GIF_INAPP:24,STATUS_REPLY_GIF_EXTERNAL:25,SMB_QUICK_REPLY_EDIT:26,SMB_QUICK_REPLY_SEND:27,MEDIA_BROWSER:28,CHAT_QUICK_EDIT:29,CAMERA_TAB_GIF:30,STATUS_TAB_GIF:31,PAYMENT_COMPOSER:32}),Et=Object.freeze({NONE:1,PHOTO:2,VIDEO:3,AUDIO:4,PTT:5,LOCATION:6,CONTACT:7,DOCUMENT:8,URL:9,CALL:10,GIF:11,FUTURE:12,CONTACT_ARRAY:13,LIVE_LOCATION:14,PROFILE_PIC:15,STICKER:16,HSM:17,PRODUCT_IMAGE:18,TEMPLATE:19,MD_APP_STATE:20,MD_HISTORY_SYNC:21,CATALOG_LINK:22,PRODUCT_LINK:23,ORDER:24,LIST:25,LIST_REPLY:26,BUTTON_MESSAGE:27,BUTTON_RESPONSE_MESSAGE:28,PRODUCT_LIST:29,BUTTON_NFM:30,VIEW_ONCE_IMAGE:31,VIEW_ONCE_VIDEO:32,SHOP_STOREFRONT:33,REACTION:34,INTERACTIVE_NFM:35,INTERACTIVE_RESPONSE_NFM:36}),St=Object.freeze({REGULAR:1,FAST_FORWARD_EXIST_CHECK:2,VIDEO_EXIST_CHECK:3,PRODUCT:4,MEDIA_RETRY:5,WEB_REUPLOAD:6,THUMBNAIL:7}),vt=Object.freeze({OK:1,DUPLICATE:3,ERROR_UNKNOWN:2,ERROR_REQUEST:4,ERROR_UPLOAD:5,ERROR_OOM:6,ERROR_IO:7,ERROR_NO_PERMISSIONS:8,ERROR_BAD_MEDIA:9,ERROR_INSUFFICIENT_SPACE:10,ERROR_FNF:11,ERROR_CANCEL:12,ERROR_SERVER:13,ERROR_REQUEST_TIMEOUT:14,ERROR_NOT_FINALIZED:15,ERROR_OPTIMISTIC_HASH:16,ERROR_MEDIA_CONN:17,ERROR_DNS:18,ERROR_THROTTLE:19,ERROR_SSL:20,ERROR_NO_CLIENT_NETWORK:21}),Tt=Object.freeze({OTHER:0,INDIVIDUAL:1,GROUP:2,STATUS:3,BROADCAST:4}),bt=Object.freeze({OK:1,ERROR_UNKNOWN:3,ERROR_NETWORK:4,ERROR_EXPIRED:5,ERROR_CANCELLED:6,ERROR_UPLOAD:7,ERROR_BACKFILL_USYNC_FAILED:8}),Ct=Object.freeze({INDIVIDUAL:1,GROUP:2,BROADCAST:3,STATUS:4}),At=Object.freeze({PREKEY_MESSAGE:1,CALL_PAYLOAD:2,RETRY_RECEIPT:3,PREKEY_RESPONSE:4,IDENTITY_RESPONSE:5,USYNC_RESPONSE:6}),Pt=Object.freeze({ZERO:1,ONE:2,LT10:3,LT100:4,LT500:5,LT1K:6,LT5K:7,GTE5K:8}),Mt=Object.freeze({NATIVE:0,OK_HTTP:1,LIGER:2,APACHE:3,WATLS:4}),Ot=Object.freeze({ALLOWED:1,BLOCKED:2,UNKNOWN:3}),It=Object.freeze({NONE:1,SOFTWARE:2,BUILTIN:3}),wt=Object.freeze({NONE:0,OPTIMISTIC:1,OPT_USED:2,OPT_TAKEOVER:3,OPT_DISABLED:4}),Rt=Object.freeze({OTHER:0,CHAT:1,NOTIFICATION:2}),Dt=Object.freeze({RESUME_CHECK:1,UPLOAD:2,FINALIZE:3}),Lt=Object.freeze({NONE_NEW_CONTENT:1,NONE_EXPIRED:2,REUSED:3}),Nt=Object.freeze({CONSUMER:1,SMB:2,ENT:3}),kt=Object.freeze({CELLULAR:1,WIFI:2,NONE:3}),Ut=Object.freeze({PHONE_NUM_HYPERLINK_MSG_RECEIVED:1,LONG_PRESS_PHONE_NUM_HYPERLINK:2,CLICK_PHONE_NUM_HYPERLINK:3,CLICK_CALL:4,CLICK_ADD_TO_CONTACTS:5,CLICK_MESSAGE_ON_WHATSAPP:6,CLICK_COPY_PHONE_NUMBER:7,CLOSE_DIALOG_BOX:8,MESSAGE_SENT:9}),Gt=Object.freeze({OTHER:0,ADD:1,VIEW:2,POPULATE:3}),xt=Object.freeze({OTHER:0,INDIVIDUAL:1,GROUP:2,STATUS:3,BROADCAST:4}),Bt=Object.freeze({OTHER:0,CIPHERTEXT:1,FANOUT:2,DOWNGRADE:3}),Ft=Object.freeze({IPHONE:1,ANDROID:2,BB:3,BBX:7,S40:4,SYMBIAN:5,WP:6,WEBCLIENT:8,OSMETA:11,ENT:12,SMBA:13,KAIOS:14,SMBI:15,WINDOWS:16,WEB:17,PORTAL:18,BLOKS:19,BLUEA:20,BLUEI:21,FBLITEA:22,GREENA:23,GREENI:24,IGDA:25,IGDI:26,IGLITEA:27,MLITEA:28,MSGRA:29,MSGRI:30,MSGRP:31,MSGRW:32,IGDW:33,PAGE:34,MSGRDM:35,MSGRDW:36,MSGROM:37,MSGROC:38,MSGRM:43,IGDM:44,WEARM:45,CAPI:46,XR:47,MACOS:48,TEST:9,UNKNOWN:10}),jt=Object.freeze({LT4:1,LT8:2,LT16:3,LT32:4,LT64:5,LT128:6,LT256:7,LT512:8,LT1000:9,LT1500:10,LT2000:11,LT2500:12,LT3000:13,LT3500:14,LT4000:15,LT4500:16,LT5000:17,LARGEST_BUCKET:18}),Yt=Object.freeze({SEND_MESSAGE:1,GET_VNAME_CERTIFICATE:2,SEND_LIVE_LOCATION_RETRY:3,SEND_LIVE_LOCATION_KEY:4,SEND_PEER_MESSAGE:5,MULTI_DEVICE_CALL:6,CALL_PEER_E2E_FAIL:7,IDENTITY_CHANGE_NOTIFICATION:8,BACK_OFF:9,USER_INTENT_PREFETCH:10,RESEND_MESSAGE:11,RETRY_MESSAGE:12}),Kt=Object.freeze({ADV_SIGNED_DEVICE_IDENTITY:1,ADV_SIGNED_KEY_INDEX_LIST:2}),Wt=Object.freeze({B0:1,B1:2,B5:3,B10:4,B15:5,B20:6,B30:7,B40:8,B50:9,B60:10,B70:11,B80:12,B90:13,B100:14}),Ht=Object.freeze({NOBODY:1,ONLY_SHARE_WITH:2,MY_CONTACTS:3,MY_CONTACTS_EXCEPT:4,EVERYONE:5}),Vt=Object.freeze({CONTACT_CARD:1,CHAT_HEADER:2,CHAT_MENU:3,GROUP_MEMBERSHIP_SCREEN:4,STATUS:5,CALLS:6,BROADCAST_LIST:7,PRODUCT:8,CATALOG:9,SETTINGS:10,SPAM_BLOCK:11,CHATS_HOME:12,SHOPS:13,MENTION:14,EPHEMERAL_SETTINGS_MESSAGE:15,MAP:16,SEARCH:17,PAYMENT_TRANSACTION_DETAILS:18}),$t=Object.freeze({DIT:1,DIRECTORY_SEARCH:2}),zt=Object.freeze({SUCCESS:1,ERROR_PARSING:2,ERROR_DECODING:3,ERROR_CREDENTIAL:4,ERROR_OTHER:5,ERROR_CLIENT_NETWORK:6,ERROR_WAIT_FOR_TOKEN:7,ERROR_SERVER_OTHER:8,SKIPPED_NO_NETWORK:9,SKIPPED_NO_DATA:10,ERROR_ACCESS_TOKEN:11}),qt=Object.freeze({CREATED:1,ROTATED:2,DELETED:3}),Jt=Object.freeze({TEST_VALUE1:1,TEST_VALUE2:2}),Qt=Object.freeze({NO_REASON:0,REASON_UNKNOWN:1,REASON_WAIT_FOR_FIRST_TOKEN:2,REASON_INVALID_SHARED_KEY:3,REASON_INVALID_FACTOR:4,REASON_GEN_FACTOR_FAILURE:5,REASON_COMPUTE_HMAC_FAILURE:6,REASON_BLIND_FAILURE:7,REASON_UNBLIND_FAILURE:8,REASON_LAST_SIGNREQ_NETWORK_FAILURE:9,REASON_LAST_SIGNREQ_SERVER_ERROR:10,REASON_LAST_SIGNREQ_BAD_REQUEST:11,REASON_LAST_SIGNREQ_OTHER_ERROR:12,REASON_WAIT_FOR_GEN_TOKEN:13,REASON_GEN_SHAREDKEY_FAILURE:14,REASON_WAIT_FOR_GEN_FIRST_TOKEN:15}),Xt=Object.freeze({REASON_PS_PINGER:0,REASON_PS_OFFCYCLE:1}),Zt=Object.freeze({SUCCESS:1,CANCEL:2,ERROR:3}),en=Object.freeze({SPEED_1:0,SPEED_1_5:1,SPEED_2:2}),tn=Object.freeze({AUDIO_QUEUE:0,AVPLAYER:1,AVAUDIOPLAYER:2,OPUSPLAYER:3,ANDROIDPLAYER:4,EXOPLAYER:5}),nn=Object.freeze({SENT:1,CANCELLED:2,TOO_SHORT:3}),rn=Object.freeze({FROM_CONVERSATION:0,FROM_VOICEMAIL:1}),an=Object.freeze({UNKNOWN:0,AAC:1,MP3:2,AMR_NB:3,AMR_WB:4,OPUS:5,MULTIPLE_TRACKS:6}),on=Object.freeze({MANUAL:0,SEQUENTIAL:1}),sn=Object.freeze({STICKER_STORE_DATA:0,PREVIEW_IMAGE_DOWNLOAD:1,STICKER_PACK_DATA:2,STICKER_SEARCH:3}),ln=Object.freeze({ACTION_SETTINGS_IMPRESSION:1,ACTION_SETTINGS_ADD_CLICK:2,ACTION_SETTINGS_ADD_ABANDONED:3,ACTION_SETTINGS_ADDED:4,ACTION_SETTINGS_DELETED:5,ACTION_CHAT_IMPRESSION:6,ACTION_CHAT_CLICK:7,ACTION_SETTINGS_EDITED:8,ACTION_CHAT_INVALID_ATTACHMENTS:9,ACTION_SETTINGS_INVALID_ATTACHMENTS:10,ACTION_SETTINGS_MEDIA_TRANSCODE:11,ACTION_CHAT_CLICK_CANCEL:12,ACTION_SMART_DEFAULT_CLICK:13,QUICK_REPLY_MESSAGE_SENT:14}),cn=Object.freeze({QUICK_REPLY_ENTRY_POINT_KEYBOARD:1,QUICK_REPLY_ENTRY_POINT_ATTACHMENT_PANEL:2,QUICK_REPLY_ENTRY_POINT_SETTINGS_MENU:3,QUICK_REPLY_ENTRY_POINT_BANNERS:4,QUICK_REPLY_ENTRY_POINT_NUX:5}),dn=Object.freeze({UNKNOWN:0,CONVERSATIONS:1,BUTTON:2,KEYBOARD:3}),un=Object.freeze({QUICK_REPLY_TRANSCODE_RESULT_OK:1,QUICK_REPLY_TRANSCODE_RESULT_CANCELLED:2,QUICK_REPLY_TRANSCODE_RESULT_FAIL_IMAGE_UNKNOWN:3,QUICK_REPLY_TRANSCODE_RESULT_FAIL_IMAGE_ENCODING:4,QUICK_REPLY_TRANSCODE_RESULT_FAIL_IMAGE_FILE_COPY:5,QUICK_REPLY_TRANSCODE_RESULT_FAIL_VIDEO_UNKNOWN:6}),pn=Object.freeze({CELLULAR_UNKNOWN:0,WIFI_UNKNOWN:1,CELLULAR_EDGE:100,CELLULAR_IDEN:101,CELLULAR_UMTS:102,CELLULAR_EVDO:103,CELLULAR_GPRS:104,CELLULAR_HSDPA:105,CELLULAR_HSUPA:106,CELLULAR_HSPA:107,CELLULAR_CDMA:108,CELLULAR_1XRTT:109,CELLULAR_EHRPD:110,CELLULAR_LTE:111,CELLULAR_HSPAP:112}),fn=Object.freeze({OPEN_TRAY:1,DELETE:2,UPDATE:3}),hn=Object.freeze({SENDER:0,ADMIN:1}),_n=Object.freeze({CALLS_TAB:1,GROUP_CALL_UI:2,ATTACHMENT:3,WEB_MENU:4}),gn=Object.freeze({E2EE:0,BSP:1,FB:2}),mn=Object.freeze({ACTION_CLICK_SHOPS_SETTING:1,ACTION_CLICK_CATALOG_SETTING:2,ACTION_CLICK_COMMERCE_MANAGER_IN_CATALOG_SETTING:3,ACTION_CLICK_CANCEL_IN_CATALOG_SETTING:4,ACTION_CLICK_VIEW_SHOPS_IN_SHOPS_SETTING:5,ACTION_CLICK_COMMERCE_MANAGER_IN_SHOPS_SETTING:6,ACTION_CLICK_CANCEL_IN_SHOPS_SETTING:7,ACTION_SHOPS_PRODUCT_PREVIEW_VISIBLE:8,ACTION_CLICK_SHOPS_PRODUCT_PREVIEW_TILE:9,ACTION_CLICK_MANAGE_SHOPS:10,ACTION_SHARE_SHOPS:11,ACTION_CLICK_VIEW_SHOPS_FROM_EDIT_BIZ_PROFILE:12,ACTION_CLICK_COMMERCE_MANAGER_FROM_EDIT_BIZ_PROFILE:13,ACTION_CLICK_CANCEL_FROM_EDIT_BIZ_PROFILE:14}),yn=Object.freeze({SUCCESS:1,ERROR_BAD_REQUEST:2,ERROR_SERVER:3,ERROR_OTHER:4,ERROR_CLIENT_NETWORK:5}),En=Object.freeze({ACCOUNT_SIGNATURE:1,DEVICE_SIGNATURE:2}),Sn=Object.freeze({LT32:1,LT64:2,LT128:3,LT256:4,LT512:5,LT1000:6,LT1500:7,LT2000:8,LT2500:9,LT3000:10,LT3500:11,LT4000:12,LT4500:13,LT5000:14,LARGEST_BUCKET:15}),vn=Object.freeze({STATIC:0,SHARED:1}),Tn=Object.freeze({OK:1,CANCELLED:2,ERROR_UNKNOWN:3}),bn=Object.freeze({UNKNOWN:1,TEXT:2,IMAGE:3,VOICE:4,DOCUMENT:5,AUDIO:6,STICKER:7,LOCATION:8,PRODUCT:9,CONTACT:10,CONTACT_ARRAY:11,CAMERA_CAPTURE_IMAGE:12,MEDIA_GALLERY:13,GIF_VIDEO:14}),Cn=Object.freeze({OK:1,CANCELLED:2,ERROR_UNKNOWN:3}),An=Object.freeze({RECENT_STORIES:1,PREVIOUS_STORIES:2,MUTED_STORIES:3,MY_STATUS:4}),Pn=Object.freeze({REGULAR:1,PAYMENTS:2}),Mn=Object.freeze({STICKER_SEARCH:1,FORWARD:2,STICKER_PICKER_TAB_RECENTS:3,STICKER_PICKER_TAB_FAVORITES:4,STICKER_PICKER_TAB_EMOTION:5,STICKER_PICKER_TAB_PACK:6,STICKER_PICKER_TAB_CONTEXTUAL_SUGGESTIONS:7,STICKER_MAKER:8,STICKER_STORE:9}),On=Object.freeze({HSM:0,BUTTON:1,LIST:2,PRODUCT_LIST:3,BUTTON_NFM:4,PRODUCT_ITEM:5,SHOP_STOREFRONT:6}),In=Object.freeze({NONE:1,SPEEX:2,WEBRTC:3,MWEBRTC:4,ECHOSUPPRESSOR:5}),wn=Object.freeze({TITLE:1,CONTENT:2,FOOTER:3,BUTTON:4}),Rn=Object.freeze({B0:1,B1:2,B2:3,B11:4,B51:5,B101:6,B501:7,B1K:8,B10K:9,B100K:10,B1M:11}),Dn=Object.freeze({UPLOAD_SUCCESS:1,EMPTY_LOG_DIR:2,GZIP_FAILURE:3,UPLOAD_FAILURE:4,LOG_SIZE_EXCEEDED:5}),Ln=Object.freeze({OTHER:1,APP_OPEN:2,CHAT_OPEN:3,IMAGE_OPEN:4,FIRST_FTS_RESULT:5,CONTACTS_OPEN:6,GROUP_INFO_OPEN:7,MSG_INFO_OPEN:8}),Nn=Object.freeze({UNKNOWN:1,CHAT_PERSONAL:2,CHAT_GROUP:3,STATUS_USER:4,PRODUCT_CATALOG:5,STICKER_WEB:6,PAYMENTS_KYC:7,MESSAGE_HISTORY_SYNC:8}),kn=Object.freeze({OTHER:1,CAMERA:2,GALLERY:3,SHARE:4}),Un=Object.freeze({SUCCESS:0,UNKNOWN_ERROR:1,INVALID_ARGS:2,HTTP_ERROR:3,INVALID_RESPONSE:4,MEM_ALLOC_ERROR:5,NO_DEVICE_FOUND:6,NO_IGD_FOUND:7,NOT_ON_WIFI:100,TOO_MANY_PORTS:101,TIMEOUT:102,ERR_CODE_INVALID_ACTION:401,ERR_CODE_INVALID_ARGS:402,ERR_CODE_ACTION_FAILED:501,ERR_CODE_ACTION_NOT_AUTHORIZED:606,ERR_CODE_PINHOLE_SPACE_EXHAUSTED:701,ERR_CODE_FIREWALL_DISABLED:702,ERR_CODE_INBOUND_PINHOLE_NOT_ALLOWED:703,ERR_CODE_NO_SUCH_ENTRY:704,ERR_CODE_PROTOCOL_NOT_SUPPORTED:705,ERR_CODE_INTERNAL_PORT_WILDCARD_NOT_ALLOWED:706,ERR_CODE_PROTOCOL_WILDCARD_NOT_ALLOWED:707,ERR_CODE_WILDCARD_NOT_PERMITTED_IN_SRC_IP:708,ERR_CODE_NO_PACKET_SENT:709,ERR_CODE_SPECIFIED_ARRAY_INDEX_INVALID:713,ERR_CODE_NO_SUCH_ENTRY_IN_ARRAY:714,ERR_CODE_WILD_CARD_NOT_PERMITTED_IN_SRC_IP:715,ERR_CODE_WILD_CARD_NOT_PERMITTED_IN_EXT_PORT:716,ERR_CODE_CONFLICT_IN_MAPPING_ENTRY:718,ERR_CODE_SAME_PORT_VALUES_REQUIRED:724,ERR_CODE_ONLY_PERMANENT_LEASES_SUPPORTED:725,ERR_CODE_REMOTE_HOST_ONLY_SUPPORTS_WILDCARD:726,ERR_CODE_EXTERNAL_PORT_ONLY_SUPORTS_WILDCARD:727,ERR_CODE_NO_PORT_MAPS_AVAILABLE:728,ERR_CODE_CONFLICT_WITH_OTHER_MECHANISMS:729,ERR_CODE_WILD_CARD_NOT_PERMITTED_IN_INT_PORT:732,DISABLED:999}),Gn=Object.freeze({SUCCESS:0,UNKNOWN_ERROR:1,INVALID_ARGS:2,HTTP_ERROR:3,INVALID_RESPONSE:4,MEM_ALLOC_ERROR:5,NO_DEVICE_FOUND:6,NO_IGD_FOUND:7,NOT_ON_WIFI:100,TIMEOUT:102,ERR_CODE_INVALID_ACTION:401,ERR_CODE_INVALID_ARGS:402,ERR_CODE_ACTION_FAILED:501,ERR_CODE_ACTION_NOT_AUTHORIZED:606,ERR_CODE_WILD_CARD_NOT_PERMITTED_IN_SRC_IP:715,ERR_CODE_WILD_CARD_NOT_PERMITTED_IN_EXT_PORT:716,ERR_CODE_NO_PORT_MAPS_AVAILABLE:728,ERR_CODE_CONFLICT_WITH_OTHER_MECHANISMS:729,ERR_CODE_WILD_CARD_NOT_PERMITTED_IN_INT_PORT:732,DISABLED:999}),xn=Object.freeze({INVALID_STANZA:1,JSON_FETCH:2,JSON_PARSE:3,IMAGE_FETCH:4}),Bn=Object.freeze({BANNER_APPEAR:1,BANNER_SELECT:2,MODAL_APPEAR:3,MODAL_DISMISS:4,MODAL_LINK_FOLLOW:5,MODAL_ACCEPT:6,BLOCKING_MODAL_APPEAR:7,BLOCKING_MODAL_LINK_FOLLOW:8,BLOCKING_MODAL_ACCEPT:9,BANNER_DISMISS:10,EDUCATION_1_APPEAR:11,EDUCATION_1_DISMISS:12,EDUCATION_1_CONTINUE:13,MODAL_BACK:14,BLOCKING_MODAL_BACK:15}),Fn=Object.freeze({ACTION_IMPRESSION:1,ACTION_CLICK_WEBSITE:2,ACTION_CLICK_LOCATION:3,ACTION_CLICK_HOURS:4,ACTION_CLICK_DESCRIPTION:5,ACTION_CLICK_EMAIL:6,ACTION_CLICK_ADDTOCONTACT:7,ACTION_CLICK_MORE_BIZ_PROFILE:8,ACTION_CLICK_MESSAGE:9,ACTION_CLICK_VOICE_CALL:10,ACTION_CLICK_VIDEO_CALL:11,ACTION_CLICK_FORWARD:12,ACTION_CLICK_CATALOG_ICON:13,ACTION_CLICK_SHOPS_ICON:14,ACTION_CLICK_APP_LINK:15,ACTION_APP_IMPRESSION:16,ACTION_CLICK_STATUS:17,ACTION_EXIT:18,ACTION_COVER_PHOTO_IMPRESSION:19}),jn=Object.freeze({SERIAL_MISMATCH_CERT_IN_MESSAGE_INVALID:0,NEW_SERIAL_CERT_IN_MESSAGE_INVALID:1,GET_VNAME_CERT_INVALID:2,VNAME_CERT_UPDATE_INVALID:3,IDENTITY_ADDED_INVALID:4,IDENTITY_CHANGED_INVALID:5,IDENTITY_DELETED_INVALID:6,USYNC_VNAME_CERT_INVALID:7,USYNC_NO_VNAME_CERT:8}),Yn=Object.freeze({STATIC:0,SHARED:1}),Kn=Object.freeze({INVALID:0,NOT_SINGLE_SEGMENT_CALL:1,NOT_START_FROM_VIDEO_CALL:2,HAS_AV_SWITCH:3,SELF_CAMERA_OFF:4,PEER_CAMERA_OFF:5,SELF_HAS_NETWORK_TRANSITION:6,PEER_HAS_NETWORK_TRANSITION:7,CALL_TOO_SHORT:8,PASS:100}),Wn=Object.freeze({UNCACHED:0,IDLE:1,CHECKING:2,DOWNLOADING:3,UPDATEREADY:4,OBSOLETE:5}),Hn=Object.freeze({UNCACHED:0,IDB:1,SW:2}),Vn=Object.freeze({INDIVIDUAL:0,GROUP:1,BROADCAST_LIST:2}),$n=Object.freeze({PROD:0,INTERN:1,DEV:2}),zn=Object.freeze({COMPLETED:0,ERROR:1,TIMEOUT:2,ABORTED:3}),qn=Object.freeze({SUCCESS:0,SILENCE:1,ZEROWIDTH:2}),Jn=Object.freeze({DOWNLOAD:1,UPLOAD:2}),Qn=Object.freeze({NEW_GROUP:1,CREATE_A_ROOM:2,PROFILE:3,CATALOG:4,ARCHIVED:5,STARRED:6,LABELS:7,SETTINGS:8,LOG_OUT:9,CONTACT_INFO:10,SELECT_MESSAGES:11,CLOSE_CHAT:12,MUTE_NOTIFICATIONS:13,CLEAR_MESSAGES:14,DELETE_CHAT:15,REPORT_BUSINESS:16,BLOCK:17,SETTINGS_NOTIFICATIONS:18,SETTINGS_THEME:19,SETTINGS_CHAT_WALLPAPER:20,SETTINGS_BLOCKED:21,SETTINGS_HELP:22,OPEN:23,CLOSE:24}),Xn=Object.freeze({THREADS_SCREEN_CLICK:1,CHAT_SCREEN_CLICK:2,SETTINGS_SCREEN_CLICK:3}),Zn=Object.freeze({LOAD_PREV:0,LOAD_NEXT:1,LOAD_AROUND:2}),er=Object.freeze({NAVIGATE_NEXT:0,RELOAD:1,BACK_FORWARD:2,UNDEFINED:255}),tr=Object.freeze({ANNOTATION_SIZE_LIMIT_EXCEEDED:1,MAX_POINT_COUNT_EXCEEDED:2,MAX_MARKER_COUNT_EXCEEDED:3,TOO_MANY_OPEN_MARKERS_TO_WRITE:4,POINT_TO_END_AT_NOT_FOUND:5,JSON_FORMAT_ERROR:6,MAX_STORAGE_EVENT_COUNT_REACHED:7,ERROR_UPLOADING_CHUNK:8,POINT_NAME_TOO_LONG:9,ANNOTATION_KEY_TOO_LONG:10,POINT_DATA_TOO_LONG:11,ERROR_PARSING_CONFIG:12}),nr=Object.freeze({UNKNOWN:0,USER_SCROLL:1,NEW_MESSAGE_PREFETCH:2,SEARCH_RESULT_CLICK:3}),rr=Object.freeze({OTHER:0,MSG_CLICK:1,STICKER_PANEL_ICON:2,MEDIA_VIEWER:3,VIDEO_STREAMING:4,STATUS_V3:5,MULTI_SELECT_DOWNLOAD:6,DOCUMENT_DOWNLOAD:7,PIP:8,STICKER_PANEL_STICKER:9,SEND_TO_CHAT:10,UPLOAD:11,MSG_INIT:12,MSG_UPDATE:13,MSG_DELETE:14,MSG_RENDER:15}),ir=Object.freeze({INITIAL_PAIRING:0,OFFLINE_RESUME:1,IDLE:2}),ar=Object.freeze({TEXT:0,URL:1,IMAGE:2,VIDEO:3,GIF:4}),or=Object.freeze({MY:0,RECENT:1,VIEWED:2,MUTED:3}),sr=Object.freeze({STICKER_MAKER_BUTTON_TAP:0,IMAGE_UPLOADED:1,IMAGE_CROPPED:2,EMOJI_ADDED:3,STICKER_ADDED:4,TEXT_ADDED:5,IMAGE_OUTLINED:6,SEND_STICKER:7}),lr=Object.freeze({QR:0,MAIN:1,SYNCING:2,OFFLINE:3,CONFLICT:4,PROXYBLOCK:5,TOS_BLOCK:6,SMB_TOS_BLOCK:7,DEPRECATED_VERSION:8}),cr=Object.freeze({PHONE:0,SERVER:1}),dr=Object.freeze({GET:0,SET:1}),ur=Object.freeze({WEB:1,WIN32:2,DARWIN:3,IOS_TABLET:4,ANDROID_TABLET:5,WINSTORE:6,MACSTORE:7,DARWIN_BETA:8,WIN32_BETA:9}),pr=Object.freeze({FALSE:0,TRUE:1,UNDEFINED:2}),fr=Object.freeze({SOURCE_OTHER:1,SOURCE_INSTAGRAM:2}),hr=Object.freeze({FIRST_WELCOME_MESSAGE_IMP:0,FIRST_MESSAGE_SENT:1,QUICK_QUESTIONS_TAP:2,ICEBREAKERS_IMP:3,SELECT_QUESTION_TAP:4,SEND_TAP:5,ADS_CONTENT_DISMISSED:6}),_r=Object.freeze({IQ_REQUEST_FAILED:0,NO_WELCOME_MESSAGE_RETURNED:1,WELCOME_MESSAGE_RETURNED:2}),gr=Object.freeze({DISCONNECTED:1,CONNECTING:2,CONNECTED:3,UNKNOWN:4}),mr=Object.freeze({DISABLED:0,ALLOC:1,ALLOC_AND_RTP:2}),yr=(0,a.defineGlobal)({abKey2:[4473,c,["regular"]],appBuild:[1657,y,["regular","private"]],appIsBetaRelease:[21,o,["regular","private"]],appVersion:[17,c,["regular","private"]],browser:[779,c,["regular"]],browserVersion:[295,c,["regular"]],datacenter:[2795,c,["regular"]],deviceName:[13,c,["regular","private"]],deviceVersion:[4505,c,["regular"]],expoKey:[5029,c,["regular","private"]],mcc:[5,s,["regular","private"]],memClass:[655,s,["regular","private"]],mnc:[3,s,["regular","private"]],networkIsWifi:[23,o,["regular"]],osVersion:[15,c,["regular","private"]],platform:[11,Ft,["regular","private"]],psCountryCode:[6833,c,["private"]],psId:[6005,c,["private"]],webcBucket:[875,c,["regular"]],webcEnv:[633,$n,["regular"]],webcNativeAutolaunch:[1009,o,["regular"]],webcNativeBetaUpdates:[1007,o,["regular"]],webcPhoneAppVersion:[1005,c,["regular"]],webcPhoneCharging:[783,o,["regular"]],webcPhoneDeviceManufacturer:[829,c,["regular"]],webcPhoneDeviceModel:[831,c,["regular"]],webcPhoneOsBuildNumber:[833,c,["regular"]],webcPhoneOsVersion:[835,c,["regular"]],webcPhonePlatform:[707,Ft,["regular"]],webcTabId:[3727,c,["regular"]],webcWebArch:[6605,c,["regular"]],webcWebDeviceManufacturer:[6599,c,["regular"]],webcWebDeviceModel:[6601,c,["regular"]],webcWebOsReleaseNumber:[6603,c,["regular"]],webcWebPlatform:[899,ur,["regular"]],yearClass:[689,s,["regular","private"]],yearClass2016:[2617,s,["regular","private"]]});(0,a.defineEvents)({AdvExpectedTsUnavailable:[3038,{},[1,1,1],"regular"],AdvIdentitySignatureInvalid:[3028,{advSignatureType:[1,En]},[1,1,1],"regular"],AdvIdentityTimestampInvalid:[3046,{advIdentityIncomingTimestampInHours:[2,s],advIdentityLocalTimestampInHours:[1,s],advIdentityPrimaryIdentityMatch:[3,o]},[1,1,1],"regular"],AdvListSignatureInvalid:[3026,{},[1,1,1],"regular"],AdvListTimestampInvalid:[3040,{advListIncomingTimestampInHours:[2,s],advListIsExpired:[3,o],advListLocalTimestampInHours:[1,s]},[1,1,1],"regular"],AdvMetadataCreationFailure:[3048,{advMetadataIsMe:[1,o]},[1,1,1],"regular"],AdvPrimaryIdentityMissing:[3044,{primaryIdentityMissingProtoType:[1,Kt]},[1,1,1],"regular"],AdvProtoDecodeFailed:[3032,{advDecodeErrorType:[2,u],advDecodeProtoType:[1,p]},[1,1,1],"regular"],AdvProtoMissing:[3042,{advCompanionIdentityMissing:[2,o],missingProtoType:[1,At]},[1,1,1],"regular"],AdvStoredTimestampExpired:[3036,{advExpireTimeInHours:[1,s]},[1,1,1],"regular"],AdvTimestampMismatch:[3030,{advProtobufTimestampInHours:[2,s],advStanzaTimestampInHours:[1,s]},[1,1,1],"regular"],AdvUsyncInvalidKeyIndex:[3034,{},[1,1,1],"regular"],AndroidMessageSendPerf:[1994,{appRestart:[16,o],bucketedSenderKeyDistributionCountPercentage:[32,s],bucketedSenderKeyDistributionHashTime:[35,s],deviceCount:[36,s],deviceSizeBucket:[26,Sn],durationAbs:[11,d],durationRelative:[12,d],durationT:[1,d],fetchPrekeys:[15,o],fetchPrekeysPercentage:[21,s],groupSizeBucket:[17,fe],isDirectedMessage:[33,o],isE2eBackfill:[27,o],isMessageFanout:[9,o],isMessageForward:[8,o],isRevokeMessage:[24,o],isViewOnce:[29,o],jobsInQueue:[18,s],mediaType:[3,Et],messageIsFirstUserMessage:[30,o],messageIsInvisible:[31,o],messageType:[4,Ct],networkWasDisconnected:[14,o],participantCount:[37,s],phoneCores:[34,s],prekeysEligibleForPrallelProcessing:[28,o],sendCount:[13,s],sendRetryCount:[10,s],sendStage:[2,he],senderKeyDistributionCountPercentage:[23,s],sessionsMissingWhenComposing:[25,o],targetDeviceGroupSizeBucket:[20,fe],threadsInExecution:[19,s]},[1,1,2e3],"regular"],ArchiveSettings:[2788,{keepChatsArchived:[1,o]},[1,1,1],"regular"],AutoReply:[3212,{autoReplyAction:[1,v]},[1,1,1],"private",113760892],BannerEvent:[1578,{bannerOperation:[2,A],bannerType:[1,P]},[1,1,1],"regular"],BizCatalogView:[3006,{bizPlatform:[14,O],cartToggle:[13,o],catalogEntryPoint:[2,ee],catalogEventSampled:[11,o],catalogOwnerJid:[10,c],catalogReportReasonCode:[8,c],catalogSessionId:[3,c],catalogViewAction:[1,te],collectionId:[15,c],collectionIndex:[16,c],deepLinkOpenFrom:[12,Pe],isNewProductAddedToCart:[7,o],isOrderMsgAttached:[5,o],orderId:[4,c],productId:[9,c],productIndex:[17,c],quantity:[6,s],sequenceNumber:[18,s]},[1,1,1],"private",0],BizProfileView:[3008,{bizFbSize:[8,Rn],bizIgSize:[9,Rn],businessProfileJid:[2,c],catalogSessionId:[6,c],hasCoverPhoto:[13,o],isProfileLinked:[10,o],isSelfView:[11,o],linkedAccount:[5,B],profileEntryPoint:[12,Vt],scrollDepth:[4,s],sequenceNumber:[7,s],viewBusinessProfileAction:[1,Fn],websiteSource:[3,fr]},[1,1,1],"private",0],BusinessMute:[1376,{muteT:[2,d],muteeId:[1,c]},[1,1,1],"regular"],BusinessProfileView:[2440,{businessOwnerJid:[2,c],businessProfileViewAction:[1,k],businessProfileWebsiteSourceTyp:[3,U]},[1,1,1],"private",113760892],BusinessToolsClick:[2218,{businessToolsItem:[3,x],businessToolsSequenceNumber:[2,s],businessToolsSessionId:[1,c],linkingTarget:[4,B]},[1,1,1],"regular"],BusinessToolsEntry:[2216,{businessToolsEntryPoint:[3,G],businessToolsSequenceNumber:[2,s],businessToolsSessionId:[1,c]},[1,1,1],"regular"],BusinessToolsImpression:[2220,{businessToolsSequenceNumber:[2,s],businessToolsSessionId:[1,c]},[1,1,1],"regular"],BusinessUnmute:[1378,{muteeId:[1,c]},[1,1,1],"regular"],Call:[462,{acceptAckLatencyMs:[1016,d],acceptedButNotConnectedTimeSpentMs:[1015,d],activeRelayProtocol:[412,s],allocErrorBitmap:[593,s],androidAudioRouteMismatch:[1055,o],androidCamera2MinHardwareSupportLevel:[444,_],androidCameraApi:[443,g],androidSystemPictureInPictureT:[477,d],androidTelecomTimeSpentBeforeReject:[497,d],appInBackgroundDuringCall:[1109,o],audStreamMixPct:[1119,l],audioCodecDecodedFecFrames:[755,s],audioCodecDecodedPlcFrames:[756,s],audioCodecEncodedFecFrames:[751,s],audioCodecEncodedNonVoiceFrames:[753,s],audioCodecEncodedVoiceFrames:[752,s],audioCodecReceivedFecFrames:[754,s],audioDeviceIssues:[860,s],audioDeviceLastIssue:[861,s],audioDeviceSwitchCount:[867,s],audioDeviceSwitchDuration:[866,d],audioFrameLoss1xMs:[724,d],audioFrameLoss2xMs:[725,d],audioFrameLoss4xMs:[726,d],audioFrameLoss8xMs:[727,d],audioGetFrameUnderflowPs:[83,s],audioInbandFecDecoded:[679,s],audioInbandFecEncoded:[678,s],audioLossPeriodCount:[722,s],audioNackReqPktsRecvd:[646,s],audioNackReqPktsSent:[645,s],audioNackRtpRetransmitDiscardCount:[649,s],audioNackRtpRetransmitFailCount:[651,s],audioNackRtpRetransmitRecvdCount:[648,s],audioNackRtpRetransmitReqCount:[647,s],audioNackRtpRetransmitSentCount:[650,s],audioNumPiggybackRxPkt:[1008,s],audioNumPiggybackTxPkt:[1007,s],audioPlayCbIntervalGtDefaultCnt:[1138,s],audioPlayCbLatencyGteMaxCnt:[1139,s],audioPutFrameOverflowPs:[82,s],audioRecCbLatencyAvg:[1036,s],audioRecCbLatencyMax:[1035,s],audioRecCbLatencyMin:[1034,s],audioRecCbLatencyStddev:[1037,s],audioRtxPktDiscarded:[677,s],audioRtxPktProcessed:[676,s],audioRtxPktSent:[675,s],audioRxAvgFpp:[728,l],audioRxPktLossPctDuringPip:[642,l],audioTotalBytesOnNonDefCell:[450,l],avAvgDelta:[192,l],avMaxDelta:[193,l],aveNumPeersAutoPaused:[578,s],aveTimeBwResSwitches:[994,d],aveTimeBwVidRcDynCondTrue:[719,d],avgClockCbT:[139,d],avgDecodeT:[136,d],avgEncRestartAndKfGenT:[1048,d],avgEncRestartIntervalT:[1047,d],avgEncodeT:[135,d],avgEventQueuingDelay:[816,s],avgPlayCbIntvT:[1152,d],avgPlayCbT:[137,d],avgRecordCbIntvT:[495,d],avgRecordCbT:[138,d],avgRecordGetFrameT:[140,d],avgTargetBitrate:[141,l],avgTcpConnCount:[413,s],avgTcpConnLatencyInMsec:[414,d],batteryDropMatched:[355,o],batteryDropTriggered:[442,o],batteryLowMatched:[354,o],batteryLowTriggered:[441,o],batteryRulesApplied:[353,o],biDirRelayRebindLatencyMs:[843,d],biDirRelayResetLatencyMs:[844,d],builtinAecAvailable:[33,o],builtinAecEnabled:[38,o],builtinAecImplementor:[36,c],builtinAecUuid:[37,c],builtinAgcAvailable:[34,o],builtinNsAvailable:[35,o],bwaVidDisablingCandidate:[1114,o],bwaVidDisablingRxCandidateDuration:[1116,d],bwaVidDisablingTxCandidateDuration:[1115,d],bweEvaluationScoreE2e:[1068,s],bweEvaluationScoreSfuDl:[1070,s],bweEvaluationScoreSfuUl:[1069,s],c2DecAvgT:[302,d],c2DecFrameCount:[300,s],c2DecFramePlayed:[301,s],c2EncAvgT:[298,d],c2EncCpuOveruseCount:[299,s],c2EncFrameCount:[297,s],c2RxTotalBytes:[296,s],c2TxTotalBytes:[295,s],callAcceptFuncT:[132,d],callAecMode:[39,f],callAecOffset:[42,s],callAecTailLength:[43,s],callAgcMode:[52,h],callAndrGcmFgEnabled:[268,o],callAndroidAudioMode:[55,s],callAndroidRecordAudioPreset:[57,s],callAndroidRecordAudioSource:[56,s],callAudioEngineType:[54,S],callAudioRestartCount:[96,l],callAudioRestartReason:[97,l],callAvgAudioRxPipBitrate:[640,l],callAvgRottRx:[259,d],callAvgRottTx:[258,d],callAvgRtt:[107,d],callAvgVideoRxPipBitrate:[638,l],callBatteryChangePct:[195,l],callCalculatedEcOffset:[50,s],callCalculatedEcOffsetStddev:[51,s],callCreatorHid:[505,c],callDefNetwork:[405,j],callEcRestartCount:[99,l],callEchoEnergy:[46,l],callEchoLikelihood:[44,s],callEchoLikelihoodBeforeEc:[47,l],callEndFrameLossMs:[1142,d],callEndFuncT:[130,d],callEndReconnecting:[70,o],callEndReconnectingBeforeNetworkChange:[877,o],callEndReconnectingBeforeP2pFailover:[875,o],callEndReconnectingBeforeRelayFailover:[869,o],callEndReconnectingBeforeRelayReset:[948,o],callEndReconnectingSoonAfterCallActive:[848,o],callEndReconnectingSoonAfterNetworkChange:[878,o],callEndReconnectingSoonAfterP2pFailover:[876,o],callEndReconnectingSoonAfterRelayFailover:[870,o],callEndReconnectingSoonAfterRelayReset:[949,o],callEndedDuringAudFreeze:[518,o],callEndedDuringVidFreeze:[517,o],callEndedInterrupted:[23,o],callEnterPipModeCount:[626,s],callFromUi:[2,F],callHistEchoLikelihood:[45,l],callInitRxPktLossPct3s:[1157,l],callInitialRtt:[109,d],callInterrupted:[22,o],callIsLastSegment:[388,o],callLastRtt:[108,d],callMaxRtt:[106,d],callMessagesBufferedCount:[422,s],callMinRtt:[105,d],callNetwork:[76,j],callNetworkSubtype:[77,s],callNsMode:[53,It],callOfferAckTimout:[159,l],callOfferDelayT:[243,d],callOfferElapsedT:[102,d],callOfferFanoutCount:[588,s],callOfferReceiptDelay:[134,d],callP2pAvgRtt:[457,d],callP2pDisabled:[18,o],callP2pMinRtt:[456,d],callPeerAppVersion:[15,c],callPeerIpStr:[10,c],callPeerIpv4:[8,s],callPeerPlatform:[5,c],callPendingCallsAcceptedCount:[501,s],callPendingCallsCount:[498,s],callPendingCallsRejectedCount:[499,s],callPendingCallsTerminatedCount:[500,s],callPipMode10sCount:[628,s],callPipMode10sT:[633,d],callPipMode120sCount:[631,s],callPipMode120sT:[636,d],callPipMode240sCount:[632,s],callPipMode240sT:[637,d],callPipMode30sCount:[629,s],callPipMode30sT:[634,d],callPipMode60sCount:[630,s],callPipMode60sT:[635,d],callPipModeT:[627,d],callPlaybackBufferSize:[59,s],callPlaybackCallbackStopped:[25,o],callPlaybackFramesPs:[93,l],callPlaybackSilenceRatio:[95,l],callRadioType:[231,pn],callRandomId:[529,c],callRecentPlaybackFramesPs:[94,l],callRecentRecordFramesPs:[29,l],callReconnectingStateCount:[438,s],callRecordBufferSize:[58,s],callRecordCallbackStopped:[24,o],callRecordFramesPs:[28,s],callRecordMaxEnergyRatio:[98,l],callRecordSilenceRatio:[26,s],callRejectFuncT:[131,d],callRelayAvgRtt:[455,d],callRelayBindStatus:[16,Y],callRelayCreateT:[104,d],callRelayMinRtt:[454,d],callRelayServer:[17,c],callReplayerId:[1155,c],callResult:[63,K],callRingingT:[103,d],callRxAvgBitrate:[121,l],callRxAvgBwe:[122,l],callRxAvgJitter:[125,d],callRxAvgLossPeriod:[128,d],callRxMaxJitter:[124,d],callRxMaxLossPeriod:[127,d],callRxMinJitter:[123,d],callRxMinLossPeriod:[126,d],callRxPktLossPct:[120,l],callRxPktLossRetransmitPct:[892,l],callRxStoppedT:[100,d],callSamplingRate:[30,s],callSegmentIdx:[389,s],callSegmentType:[393,W],callSelfIpStr:[9,c],callSelfIpv4:[7,s],callServerNackErrorCode:[68,s],callSetupErrorType:[71,H],callSetupT:[101,d],callSide:[1,V],callSoundPortFuncT:[133,d],callStartFuncT:[129,d],callSwAecMode:[41,s],callSwAecType:[40,In],callT:[92,d],callTermReason:[69,$],callTestBucket:[19,c],callTestEvent:[318,s],callTonesDetectedInRecord:[49,s],callTonesDetectedInRingback:[48,s],callTransitionCount:[78,s],callTransitionCountCellularToWifi:[432,s],callTransitionCountWifiToCellular:[431,s],callTransport:[72,z],callTransportExtrayElected:[515,o],callTransportP2pToRelayFallbackCount:[80,s],callTransportPeerTcpUsed:[587,o],callTransportRelayToRelayFallbackCount:[79,s],callTransportTcpFallbackToUdp:[516,o],callTransportTcpUsed:[514,o],callTxAvgBitrate:[112,l],callTxAvgBwe:[113,l],callTxAvgJitter:[116,d],callTxAvgLossPeriod:[119,d],callTxMaxJitter:[115,d],callTxMaxLossPeriod:[118,d],callTxMinJitter:[114,d],callTxMinLossPeriod:[117,d],callTxPktErrorPct:[111,l],callTxPktLossPct:[110,l],callUserRate:[20,s],callWakeupSource:[156,J],calleeAcceptToDecodeT:[447,d],callerInContact:[476,o],callerOfferToDecodeT:[445,d],callerVidRtpToDecodeT:[446,d],cameraFormats:[765,s],cameraIssues:[850,s],cameraLastIssue:[851,s],cameraOffCount:[331,s],cameraPauseT:[1131,d],cameraPermission:[849,o],cameraPreviewMode:[322,Q],cameraStartDuration:[852,d],cameraStartFailureDuration:[856,d],cameraStartMode:[233,X],cameraStartToFirstFrameT:[916,d],cameraStopDuration:[853,d],cameraStopFailureCount:[858,s],cameraSwitchCount:[855,s],cameraSwitchDuration:[854,d],cameraSwitchFailureDuration:[857,d],clampedBwe:[527,o],codecSamplingRate:[624,s],combinedE2eAvgRtt:[760,l],combinedE2eMaxRtt:[761,l],combinedE2eMinRtt:[759,l],confBridgeSamplingRate:[623,s],conservativeModeStopped:[974,o],conservativeRampUpExploringT:[743,d],conservativeRampUpHeldCount:[643,s],conservativeRampUpHoldingT:[741,d],conservativeRampUpRampingUpT:[742,d],createdFromGroupCallDowngrade:[519,o],dataLimitOnAltNetworkReached:[537,o],deviceBoard:[230,c],deviceHardware:[229,c],dtxRxByteFrameCount:[914,s],dtxRxCount:[912,s],dtxRxDurationT:[911,d],dtxRxTotalCount:[913,s],dtxRxTotalFrameCount:[1083,s],dtxTxByteFrameCount:[910,s],dtxTxCount:[619,s],dtxTxDurationT:[618,d],dtxTxTotalCount:[909,s],dtxTxTotalFrameCount:[1082,s],echoCancellationMsPerSec:[320,s],echoCancelledFrameCount:[940,s],echoEstimatedFrameCount:[941,s],echoSpeakerModeFrameCount:[987,s],encoderCompStepdowns:[81,s],endCallAfterConfirmation:[90,je],failureToCreateAltSocket:[534,s],failureToCreateTestAltSocket:[532,s],fastplayMaxDurationMs:[1005,d],fastplayNumFrames:[1004,s],fastplayNumTriggers:[1006,s],fieldStatsRowType:[328,He],finishedDlBwe:[503,o],finishedOverallBwe:[528,o],finishedUlBwe:[502,o],freezeAheadBweCongestionCorrPct:[1051,l],freezeBweCongestionCorrPct:[1009,l],groupAcceptNoCriticalGroupUpdate:[1013,o],groupAcceptToCriticalGroupUpdateMs:[1014,d],groupCallCallerParticipantCountAtCallStart:[439,s],groupCallInviteCountSinceCallStart:[360,s],groupCallIsGroupCallInvitee:[357,o],groupCallIsLastSegment:[356,o],groupCallNackCountSinceCallStart:[361,s],groupCallReringCountSinceCallStart:[946,s],groupCallReringNackCountSinceCallStart:[947,s],groupCallSegmentIdx:[329,s],groupCallTotalCallTSinceCallStart:[358,d],groupCallTotalP3CallTSinceCallStart:[359,d],groupCallVideoMaximizedCount:[592,s],hasRestrictedSettingsForAudioCalls:[539,o],highPeerBweT:[884,d],hisBasedInitialTxBitrate:[342,s],hisInfoCouldBeUsedForInitBwe:[339,o],historyBasedBweActivated:[807,o],historyBasedBweEnabled:[806,o],historyBasedBweSuccess:[808,o],historyBasedBweVideoTxBitrate:[809,s],incomingCallUiAction:[387,Qe],initBweSource:[337,Xe],initialEstimatedTxBitrate:[244,l],isCallFull:[1149,o],isIpv6Capable:[91,o],isLinkedGroupCall:[1090,o],isPendingCall:[976,o],isRejoin:[927,o],isRering:[945,o],isUpnpExternalIpPrivate:[260,o],isUpnpExternalIpTheSameAsReflexiveIp:[261,o],jbAvgDelay:[146,l],jbAvgDelayUniform:[644,l],jbAvgDisorderTargetSize:[1086,l],jbAvgTargetSize:[1012,l],jbDiscards:[150,l],jbEmpties:[151,l],jbEmptyPeriods1x:[997,l],jbEmptyPeriods2x:[998,l],jbEmptyPeriods4x:[999,l],jbEmptyPeriods8x:[1e3,l],jbGets:[152,l],jbLastDelay:[149,l],jbLost:[277,l],jbLostEmptyDuringPip:[641,s],jbLostEmptyHighPeerBwePerSec:[777,l],jbLostEmptyLowPeerBwePerSec:[775,l],jbLostEmptyLowToHighPeerBwePerSec:[776,l],jbMaxDelay:[148,l],jbMaxDisorderTargetSize:[1087,l],jbMinDelay:[147,l],jbNonSpeechDiscards:[846,l],jbPuts:[153,l],jbTotalEmptyPeriods:[996,l],jbVoiceFrames:[1081,s],joinableAfterCall:[895,o],joinableDuringCall:[894,o],joinableNewUi:[893,o],l1Locations:[986,c],lastConnErrorStatus:[415,s],libsrtpVersionUsed:[504,vn],lobbyVisibleT:[1127,d],logSampleRatio:[1120,s],longConnect:[21,o],lossOfAltSocket:[535,s],lossOfTestAltSocket:[533,s],lowDataUsageBitrate:[157,l],lowPeerBweT:[885,d],lowToHighPeerBweT:[886,d],malformedStanzaXpath:[452,c],maxConnectedParticipants:[1085,s],maxEventQueueDepth:[558,s],mediaStreamSetupT:[448,d],micAvgPower:[253,s],micMaxPower:[252,s],micMinPower:[251,s],micPermission:[859,o],micStartDuration:[862,d],micStartToFirstCallbackT:[931,d],micStopDuration:[863,d],multipleTxRxRelaysInUse:[838,o],nativeSamplesPerFrame:[32,c],nativeSamplingRate:[31,c],neteqAcceleratedFrames:[653,s],neteqExpandedFrames:[652,s],networkFailoverTriggeredCount:[1135,s],networkMediumChangeLatencyMs:[995,d],nseEnabled:[1128,o],nseOfflineQueueMs:[1129,d],numAsserts:[933,s],numConnectedParticipants:[330,s],numConnectedPeers:[1052,s],numCriticalGroupUpdateDropped:[567,s],numDirPjAsserts:[985,s],numInvitedParticipants:[1054,s],numL1Errors:[929,s],numL2Errors:[930,s],numOutOfOrderCriticalGroupUpdate:[625,s],numOutgoingRingingPeers:[1053,s],numPeersAutoPausedOnce:[577,s],numRenderSkipGreenFrame:[1029,s],numResSwitch:[993,s],numTransitionsToSpeech:[1113,s],numVidDlAutoPause:[574,s],numVidDlAutoResume:[576,s],numVidDlAutoResumeRejectBadAudio:[579,s],numVidRcDynCondTrue:[717,s],numVidUlAutoPause:[559,s],numVidUlAutoPauseFail:[560,s],numVidUlAutoPauseRejectHighSendingRate:[564,s],numVidUlAutoPauseRejectTooEarly:[565,s],numVidUlAutoPauseUserAction:[566,s],numVidUlAutoResume:[561,s],numVidUlAutoResumeFail:[562,s],numVidUlAutoResumeRejectAudioLqm:[563,s],numberOfProcessors:[27,s],offerAckLatencyMs:[1017,d],oibweDlProbingTime:[805,d],oibweE2eProbingTime:[802,d],oibweNotFinishedWhenCallActive:[868,o],oibweOibleProbingTime:[803,d],oibweUlProbingTime:[804,d],onMobileDataSaver:[525,o],onWifiAtStart:[540,o],oneSideInitRxBitrate:[507,s],oneSideInitTxBitrate:[506,s],oneSideMinPeerInitRxBitrate:[509,s],oneSideRcvdPeerRxBitrate:[508,o],opusVersion:[287,s],p2pSuccessCount:[522,s],pcntPoorAudLqmAfterPause:[599,l],pcntPoorAudLqmBeforePause:[598,l],pcntPoorVidLqmAfterPause:[597,l],pcntPoorVidLqmBeforePause:[596,l],peerCallNetwork:[264,kt],peerCallResult:[66,K],peerTransport:[591,z],peerVideoHeight:[191,s],peerVideoWidth:[190,s],peerXmppStatus:[4,gr],pingsSent:[160,l],pongsReceived:[161,l],poolMemUsage:[510,s],poolMemUsagePadding:[511,s],presentEndCallConfirmation:[89,je],prevCallTestBucket:[1060,c],previousCallInterval:[266,d],previousCallVideoEnabled:[265,o],previousCallWithSamePeer:[267,o],previousJoinNotEnded:[1001,o],probeAvgBitrate:[327,l],pushToCallOfferDelay:[158,l],rcMaxrtt:[155,l],rcMinrtt:[154,l],receivedByNse:[1130,o],reconnectingStartsBeforeCallActive:[847,o],recordCircularBufferFrameCount:[84,s],reflectivePortsDiff:[162,l],rekeyTime:[1140,s],relayBindFailureAltNetSwitchSuccess:[583,s],relayBindFailureAltNetSwitchTriggered:[582,s],relayBindFailureAltNetworkSwitchToCallEnd:[586,d],relayBindFailureFallbackCount:[581,s],relayBindFailureIpVersionSwitchToCallEnd:[585,d],relayBindFailureIpVersionSwitchTriggered:[584,s],relayBindTimeInMsec:[424,d],relayElectionTimeInMsec:[423,d],relayFallbackOnRxDataFromRelay:[481,s],relayFallbackOnStopRxDataOnP2p:[482,s],relayFallbackOnTransportStanzaNotification:[483,s],renderFreezeHighPeerBweT:[780,d],renderFreezeLowPeerBweT:[778,d],renderFreezeLowToHighPeerBweT:[779,d],rxProbeCountSuccess:[291,s],rxProbeCountTotal:[290,s],rxRelayRebindLatencyMs:[841,d],rxRelayResetLatencyMs:[842,d],rxTotalBitrate:[145,l],rxTotalBytes:[143,l],rxTpFbBitrate:[294,l],rxTrafficStartFalsePositive:[758,o],sbweAvgDowntrend:[963,l],sbweAvgUptrend:[962,l],sbweCeilingCongestionCount:[783,s],sbweCeilingCount:[781,s],sbweCeilingMissingRtcpCongestionCount:[786,s],sbweCeilingNoNewDataReceivedCongestionCount:[787,s],sbweCeilingPktLossCount:[782,s],sbweCeilingReceiveSideCount:[1106,s],sbweCeilingRttCongestionCount:[784,s],sbweCeilingZeroRttCongestionCount:[785,s],sbweGlobalMinRttCongestionCount:[1103,s],sbweHighestRttCongestionCount:[1133,s],sbweHoldCount:[961,s],sbweMinRttEmaCongestionCount:[1104,s],sbweRampDownCount:[960,s],sbweRampUpCount:[959,s],sbweRampUpPauseCount:[1134,s],senderBweInitBitrate:[975,s],sfuAbnormalUplinkRttCount:[879,s],sfuAvgDlPlrAtBalancedCongestion:[1096,l],sfuAvgDlPlrAtHighDlCongestion:[1094,l],sfuAvgDlPlrAtHighUlCongestion:[1092,l],sfuAvgLqHqTargetBitrateDiff:[1002,l],sfuAvgPeerRttAtBalancedCongestion:[1102,s],sfuAvgPeerRttAtHighPeerCongestion:[1100,s],sfuAvgPeerRttAtHighSelfCongestion:[1098,s],sfuAvgSelfRttAtBalancedCongestion:[1101,s],sfuAvgSelfRttAtHighPeerCongestion:[1099,s],sfuAvgSelfRttAtHighSelfCongestion:[1097,s],sfuAvgTargetBitrate:[673,l],sfuAvgTargetBitrateHq:[943,l],sfuAvgUlPlrAtBalancedCongestion:[1095,l],sfuAvgUlPlrAtHighDlCongestion:[1093,l],sfuAvgUlPlrAtHighUlCongestion:[1091,l],sfuBalancedPktLossAtCongestion:[1075,s],sfuBalancedRttAtCongestion:[1079,s],sfuBwaAllParticipantDlBwUsedPct:[919,l],sfuBwaAllParticipantUlBwUsedPct:[918,l],sfuBwaChangeNumStreamCount:[928,s],sfuBwaSelfDlBwUsedPct:[1003,l],sfuBwaSelfUlBwUsedPct:[917,l],sfuBwaSimulcastDisabledCntReasonBattery:[920,s],sfuBwaSimulcastDisabledCntReasonNetMedium:[921,s],sfuBwaVidEncHqStreamScheduledT:[926,d],sfuBwaVidEncLqStreamScheduledT:[925,d],sfuDownlinkAvgCombinedBwe:[662,l],sfuDownlinkAvgPktLossPct:[667,l],sfuDownlinkAvgRemoteBwe:[661,l],sfuDownlinkAvgSenderBwe:[660,l],sfuDownlinkInitCombinedBwe3s:[1158,l],sfuDownlinkInitPktLossPct3s:[1159,l],sfuDownlinkMaxPktLossPct:[668,l],sfuDownlinkMinPktLossPct:[666,l],sfuDownlinkSbweAvgDowntrend:[973,l],sfuDownlinkSbweAvgUptrend:[972,l],sfuDownlinkSbweCeilingCongestionCount:[797,s],sfuDownlinkSbweCeilingCount:[795,s],sfuDownlinkSbweCeilingMissingRtcpCongestionCount:[800,s],sfuDownlinkSbweCeilingNoNewDataReceivedCongestionCount:[801,s],sfuDownlinkSbweCeilingPktLossCount:[796,s],sfuDownlinkSbweCeilingRttCongestionCount:[798,s],sfuDownlinkSbweCeilingZeroRttCongestionCount:[799,s],sfuDownlinkSbweHoldCount:[971,s],sfuDownlinkSbweRampDownCount:[970,s],sfuDownlinkSbweRampUpCount:[969,s],sfuDownlinkSenderBweDiffStddev:[958,l],sfuDownlinkSenderBweStddev:[957,l],sfuFirstRxBandwidthReportTime:[1111,d],sfuFirstRxParticipantReportTime:[883,d],sfuFirstRxUplinkReportTime:[881,d],sfuHighDlPktLossAtCongestion:[1074,s],sfuHighDlRttAtCongestion:[1078,s],sfuHighUlPktLossAtCongestion:[1073,s],sfuHighUlRttAtCongestion:[1077,s],sfuMaxTargetBitrate:[674,l],sfuMaxTargetBitrateHq:[944,l],sfuMinTargetBitrate:[672,l],sfuMinTargetBitrateHq:[942,l],sfuPeerDownlinkStddevAllCombinedBwe:[813,l],sfuRxBandwidthReportCount:[1110,s],sfuRxParticipantReportCount:[882,s],sfuRxUplinkReportCount:[880,s],sfuSimulcastAvgDecSessFlipTime:[833,d],sfuSimulcastAvgEncSchedEventUpdateTime:[837,d],sfuSimulcastBwaCandidateCnt:[923,s],sfuSimulcastBwaDownlinkBottleneckCount:[874,s],sfuSimulcastBwaUplinkBottleneckCount:[873,s],sfuSimulcastDecAvgKfRecvTimeSinceFlip:[952,d],sfuSimulcastDecAvgNumReplayedCachedPkt:[951,l],sfuSimulcastDecAvgNumSkippedCachedPkt:[950,l],sfuSimulcastDecNumNoKf:[953,s],sfuSimulcastDecSessFlipCount:[744,s],sfuSimulcastDecSessFlipErrorBitmap:[768,s],sfuSimulcastDecSessFlipErrorCount:[767,s],sfuSimulcastEncErrorBitmap:[766,s],sfuSimulcastEncSchedEventCount:[732,s],sfuSimulcastEncSchedEventErrorCount:[735,s],sfuSimulcastEncSchedEventSkipCount:[734,s],sfuSimulcastEncSchedEventSuccessUpdateCount:[733,s],sfuSimulcastMaxDecSessFlipTime:[832,d],sfuSimulcastMaxEncSchedEventUpdateTime:[836,d],sfuSimulcastMinDecSessFlipTime:[831,d],sfuSimulcastMinEncSchedEventUpdateTime:[835,d],sfuUplinkAvgCombinedBwe:[659,l],sfuUplinkAvgPktLossPct:[664,l],sfuUplinkAvgRemoteBwe:[658,l],sfuUplinkAvgRtt:[670,l],sfuUplinkAvgSenderBwe:[657,l],sfuUplinkInitCombinedBwe3s:[1160,l],sfuUplinkInitPktLossPct3s:[1161,l],sfuUplinkMaxPktLossPct:[665,l],sfuUplinkMaxRtt:[671,l],sfuUplinkMinPktLossPct:[663,l],sfuUplinkMinRtt:[669,l],sfuUplinkSbweAvgDowntrend:[968,l],sfuUplinkSbweAvgUptrend:[967,l],sfuUplinkSbweCeilingCongestionCount:[790,s],sfuUplinkSbweCeilingCount:[788,s],sfuUplinkSbweCeilingMissingRtcpCongestionCount:[793,s],sfuUplinkSbweCeilingNoNewDataReceivedCongestionCount:[794,s],sfuUplinkSbweCeilingPktLossCount:[789,s],sfuUplinkSbweCeilingRttCongestionCount:[791,s],sfuUplinkSbweCeilingZeroRttCongestionCount:[792,s],sfuUplinkSbweHoldCount:[966,s],sfuUplinkSbweRampDownCount:[965,s],sfuUplinkSbweRampUpCount:[964,s],sfuUplinkSenderBweDiffStddev:[956,l],sfuUplinkSenderBweStddev:[955,l],simulcastAvgLqBitrateWhenHqEnabled:[1011,s],simulcastReplayVideoRenderFreeze2xT:[982,d],simulcastReplayVideoRenderFreeze4xT:[983,d],simulcastReplayVideoRenderFreeze8xT:[984,d],simulcastReplayVideoRenderFreezeT:[981,d],skippedBwaCycles:[748,s],skippedBweCycles:[747,s],speakerAvgPower:[250,s],speakerMaxPower:[249,s],speakerMinPower:[248,s],speakerStartDuration:[864,d],speakerStartToFirstCallbackT:[932,d],speakerStopDuration:[865,d],startedInitBweProbing:[900,o],switchToDefTriggeredByGoodDefNet:[538,s],switchToNonSfu:[750,s],switchToNonSimulcast:[1057,s],switchToSfu:[749,s],switchToSimulcast:[1056,s],symmetricNatPortGap:[257,s],systemNotificationOfNetChange:[541,s],telecomFrameworkCallStartDelayT:[440,d],timeEnc1280w:[992,d],timeEnc160w:[988,d],timeEnc320w:[989,d],timeEnc480w:[990,d],timeEnc640w:[991,d],timeOnNonDefNetwork:[530,d],timeOnNonDefNetworkPerSegment:[531,d],timeSinceLastRtpToCallEndInMsec:[715,d],timeVidRcDynCondTrue:[718,d],totalAqsMsgSent:[1126,s],totalAudioFrameLossMs:[723,d],totalBytesOnNonDefCell:[449,l],totalTimeVidDlAutoPause:[575,d],totalTimeVidUlAutoPause:[573,d],trafficShaperAvgAudioQueueMs:[898,d],trafficShaperAvgQueueMs:[242,d],trafficShaperAvgVideoQueueMs:[899,d],trafficShaperMaxDelayViolations:[240,s],trafficShaperMinDelayViolations:[241,s],trafficShaperOverflowCount:[237,s],trafficShaperQueueEmptyCount:[238,s],trafficShaperQueuedAudioPacketCount:[896,s],trafficShaperQueuedPacketCount:[239,s],trafficShaperQueuedVideoPacketCount:[897,s],transportCurTimeInMsecAsyncWriteWaitingInQueue:[552,d],transportLastSendOsError:[555,s],transportNumAsyncWriteDispatched:[580,s],transportNumAsyncWriteQueued:[551,s],transportOvershoot10PercCount:[699,s],transportOvershoot20PercCount:[700,s],transportOvershoot40PercCount:[701,s],transportOvershootLongestStreakS:[708,s],transportOvershootSinceLast10sCount:[704,s],transportOvershootSinceLast15sCount:[705,s],transportOvershootSinceLast1sCount:[702,s],transportOvershootSinceLast30sCount:[706,s],transportOvershootSinceLast5sCount:[703,s],transportOvershootStreakAvgS:[709,l],transportOvershootTimeBetweenAvgS:[707,l],transportRtpSendErrorRate:[557,l],transportSendErrorCount:[556,s],transportSnJumpDetectCount:[1153,s],transportSplitterRxErrCnt:[1059,s],transportSplitterTxErrCnt:[1058,s],transportSrtcpRxRejectedPktCnt:[1141,s],transportSrtpRxMaxPktSize:[1038,s],transportSrtpRxRejectedBitrate:[763,l],transportSrtpRxRejectedDupPktCnt:[772,s],transportSrtpRxRejectedPktCnt:[762,s],transportSrtpTxFailedPktCnt:[774,s],transportSrtpTxMaxPktSize:[773,s],transportTotalNumSendOsError:[554,s],transportTotalTimeInMsecAsyncWriteQueueToDispatch:[553,d],transportUndershoot10PercCount:[710,s],transportUndershoot20PercCount:[711,s],transportUndershoot40PercCount:[712,s],triggeredButDataLimitReached:[536,s],tsLogUpload:[1112,Dn],txProbeCountSuccess:[289,s],txProbeCountTotal:[288,s],txRelayBindUnbindPacketsMissingMessageIntegrity:[1105,s],txRelayRebindLatencyMs:[839,d],txRelayResetLatencyMs:[840,d],txTotalBitrate:[144,l],txTotalBytes:[142,l],txTpFbBitrate:[293,l],upnpAddResultCode:[246,Un],upnpRemoveResultCode:[247,Gn],usedInitTxBitrate:[341,s],usedIpv4Count:[1150,s],usedIpv6Count:[1151,s],userDescription:[87,c],userProblems:[88,s],userRating:[86,s],v2vAudioFrameLoss1xMs:[1143,d],v2vAudioFrameLoss2xMs:[1144,d],v2vAudioFrameLoss4xMs:[1145,d],v2vAudioFrameLoss8xMs:[1146,d],v2vAudioLossPeriodCount:[1147,s],v2vTotalAudioFrameLossMs:[1148,d],vidAvgBurstyPktLossLength:[1121,d],vidAvgRandomPktLossLength:[1122,d],vidBurstyPktLossTime:[1123,d],vidCorrectRetxDetectPcnt:[688,s],vidFreezeTMsInSample0:[695,d],vidJbAvgDelay:[1062,l],vidJbDiscards:[1063,l],vidJbEmpties:[1064,l],vidJbGets:[1065,l],vidJbLost:[1061,l],vidJbPuts:[1066,l],vidJbResets:[1067,l],vidNumFecDroppedNoHole:[696,s],vidNumFecDroppedTooBig:[697,s],vidNumRandToBursty:[1124,s],vidNumRetxDropped:[698,s],vidNumRxRetx:[757,s],vidPktRxState0:[693,c],vidRandomPktLossTime:[1125,d],vidRxFecRateInSample0:[694,l],vidUlAutoPausedAtCallEnd:[589,o],vidUlTimeSinceAutoPauseAtCallEnd:[590,d],vidWrongRetxDetectPcnt:[716,s],videoActiveTime:[276,d],videoAheadAvSyncDiscardedFramesAvgDeltaT:[1041,d],videoAheadAvSyncRenderedFramesAvgDeltaT:[1043,d],videoAheadNumAvSyncDiscardFrames:[1039,s],videoAveDelayLtrp:[484,d],videoAvgCombPsnr:[390,l],videoAvgEncodingPsnr:[410,l],videoAvgScalingPsnr:[408,l],videoAvgSenderBwe:[186,l],videoAvgTargetBitrate:[184,l],videoAvgTargetBitrateHq:[828,l],videoBehindAvSyncDiscardedFramesAvgDeltaT:[1042,d],videoBehindAvSyncRenderedFramesAvgDeltaT:[1044,d],videoBehindNumAvSyncDiscardFrames:[1040,s],videoCaptureAvgFps:[222,s],videoCaptureConverterTs:[226,d],videoCaptureDupFrames:[887,s],videoCaptureFrameOverwriteCount:[496,s],videoCaptureHeight:[228,s],videoCaptureWidth:[227,s],videoCodecScheme:[401,s],videoCodecSubType:[303,s],videoCodecType:[236,s],videoDecAvgBitrate:[220,s],videoDecAvgConsecutiveKfVp8:[610,l],videoDecAvgConsecutiveLtrpVp8:[611,l],videoDecAvgFps:[207,l],videoDecAvgFramesFromFoundLtrVp8:[612,l],videoDecAvgFramesFromUnfoundLtrVp8:[613,l],videoDecColorId:[205,s],videoDecCrcMismatchFrames:[419,s],videoDecErrorFrames:[174,s],videoDecErrorFramesCodecSwitch:[714,s],videoDecErrorFramesDuplicate:[713,s],videoDecErrorFramesH264:[680,s],videoDecErrorFramesIgnoreConsecutive:[478,s],videoDecErrorFramesOutoforder:[682,s],videoDecErrorFramesSpsPpsH264:[812,s],videoDecErrorFramesSpsPpsMissingAfterResolutionSwitch:[810,s],videoDecErrorFramesSpsPpsNotSupportedAfterResolutionSwitch:[811,s],videoDecErrorFramesVp8:[681,s],videoDecErrorLtrpFramesVp8:[462,s],videoDecErrorLtrpFramesVp8CrcMismatch:[479,s],videoDecErrorLtrpFramesVp8NoLtr:[480,s],videoDecErrorLtrpFramesVp8NoLtr10:[615,s],videoDecErrorLtrpFramesVp8NoLtr5:[614,s],videoDecFatalErrorNum:[1084,s],videoDecInputFrames:[172,s],videoDecKeyframes:[175,s],videoDecLatency:[223,d],videoDecLatencyH264:[684,d],videoDecLatencyVp8:[683,d],videoDecLostPackets:[210,s],videoDecLtrpFramesVp8:[461,s],videoDecLtrpPoolCreateFailed:[490,o],videoDecName:[204,s],videoDecNumPliThrottledByAllLtrp:[915,s],videoDecNumSkippedFramesVp8:[616,s],videoDecNumSwitchesToAllLtrp:[617,s],videoDecOutputFrames:[173,s],videoDecRestart:[206,s],videoDecSkipPackets:[209,s],videoDecodePausedCount:[232,s],videoDowngradeCount:[273,s],videoEnabled:[163,o],videoEnabledAtCallStart:[270,o],videoEncAllLtrpTimeInMsec:[609,d],videoEncAvgBitrate:[221,s],videoEncAvgConsecutiveKfVp8:[605,l],videoEncAvgConsecutiveLtrpVp8:[606,l],videoEncAvgFps:[216,l],videoEncAvgFpsHq:[825,l],videoEncAvgFramesFromFoundLtrVp8:[604,l],videoEncAvgFramesFromUnfoundLtrVp8:[603,l],videoEncAvgPsnrKeyFrameVp8:[465,l],videoEncAvgPsnrLtrpFrameVp8:[469,l],videoEncAvgPsnrPFramePrevRefVp8:[474,l],videoEncAvgQpKeyFrameVp8:[466,l],videoEncAvgQpLtrpFrameVp8:[470,l],videoEncAvgQpPFramePrevRefVp8:[475,l],videoEncAvgSizeAllLtrpFrameVp8:[685,l],videoEncAvgSizeKeyFrameVp8:[464,l],videoEncAvgSizeLtrpFrameVp8:[468,l],videoEncAvgSizePFramePrevRefVp8:[473,l],videoEncAvgTargetFps:[215,l],videoEncAvgTargetFpsHq:[827,l],videoEncColorId:[213,s],videoEncDeviationAllLtrpFrameVp8:[686,l],videoEncDeviationPFramePrevRefVp8:[687,l],videoEncDiscardFrame:[217,s],videoEncDiscardFrameHq:[938,s],videoEncDropFrames:[179,s],videoEncDropFramesHq:[937,s],videoEncErrorFrames:[178,s],videoEncErrorFramesHq:[936,s],videoEncFatalErrorNum:[1049,s],videoEncInputFrames:[176,s],videoEncInputFramesHq:[934,s],videoEncKeyframes:[180,s],videoEncKeyframesHq:[939,s],videoEncKeyframesVp8:[463,s],videoEncKfErrCodecSwitchT:[731,d],videoEncKfIgnoreOldFrames:[729,s],videoEncKfQueueEmpty:[730,s],videoEncLatency:[224,d],videoEncLatencyHq:[826,d],videoEncLtrpFrameGenFailedVp8:[471,s],videoEncLtrpFramesVp8:[467,s],videoEncLtrpPoolCreateFailed:[491,o],videoEncLtrpToKfFallbackVp8:[494,s],videoEncModifyNum:[1050,s],videoEncName:[212,s],videoEncNumErrorLtrHoldFailedVp8:[600,s],videoEncNumErrorLtrHoldFailedVp810:[602,s],videoEncNumErrorLtrHoldFailedVp85:[601,s],videoEncNumSuccessHfFallbackVp8:[622,s],videoEncNumSwitchesToAllLtrp:[607,s],videoEncOutputFrames:[177,s],videoEncOutputFramesHq:[935,s],videoEncPFramePrevRefVp8:[472,s],videoEncRegularLtrpTimeInMsec:[608,d],videoEncRestart:[214,s],videoEncRestartPresetChange:[1046,s],videoEncRestartResChange:[1045,s],videoEncTimeOvershoot10PercH264:[363,d],videoEncTimeOvershoot10PercH265:[366,d],videoEncTimeOvershoot10PercVp8:[369,d],videoEncTimeOvershoot10PercVp9:[372,d],videoEncTimeOvershoot20PercH264:[364,d],videoEncTimeOvershoot20PercH265:[367,d],videoEncTimeOvershoot20PercVp8:[370,d],videoEncTimeOvershoot20PercVp9:[373,d],videoEncTimeOvershoot40PercH264:[365,d],videoEncTimeOvershoot40PercH265:[368,d],videoEncTimeOvershoot40PercVp8:[371,d],videoEncTimeOvershoot40PercVp9:[374,d],videoEncTimeSpentInFastH264Ms:[1026,d],videoEncTimeSpentInFasterH264Ms:[1025,d],videoEncTimeSpentInMediumH264Ms:[1027,d],videoEncTimeSpentInNegative10Vp8Ms:[1019,d],videoEncTimeSpentInNegative12Vp8Ms:[1018,d],videoEncTimeSpentInNegative4Vp8Ms:[1022,d],videoEncTimeSpentInNegative6Vp8Ms:[1021,d],videoEncTimeSpentInNegative8Vp8Ms:[1020,d],videoEncTimeSpentInSuperfastH264Ms:[1023,d],videoEncTimeSpentInVeryfastH264Ms:[1024,d],videoEncTimeUndershoot10PercH264:[375,d],videoEncTimeUndershoot10PercH265:[378,d],videoEncTimeUndershoot10PercVp8:[381,d],videoEncTimeUndershoot10PercVp9:[384,d],videoEncTimeUndershoot20PercH264:[376,d],videoEncTimeUndershoot20PercH265:[379,d],videoEncTimeUndershoot20PercVp8:[382,d],videoEncTimeUndershoot20PercVp9:[385,d],videoEncTimeUndershoot40PercH264:[377,d],videoEncTimeUndershoot40PercH265:[380,d],videoEncTimeUndershoot40PercVp8:[383,d],videoEncTimeUndershoot40PercVp9:[386,d],videoFecRecovered:[183,s],videoH264Time:[334,s],videoH265Time:[335,s],videoHeight:[189,s],videoInitRxBitrate16s:[904,l],videoInitRxBitrate2s:[901,l],videoInitRxBitrate4s:[902,l],videoInitRxBitrate8s:[903,l],videoInitialCodecScheme:[402,s],videoInitialCodecType:[321,s],videoLastCodecType:[404,s],videoLastSenderBwe:[185,l],videoMaxCombPsnr:[392,l],videoMaxEncodingPsnr:[411,l],videoMaxRxBitrate:[426,l],videoMaxScalingPsnr:[409,l],videoMaxTargetBitrate:[420,l],videoMaxTargetBitrateHq:[829,l],videoMaxTxBitrate:[425,l],videoMaxTxBitrateHq:[824,l],videoMinCombPsnr:[391,l],videoMinEncodingPsnr:[407,l],videoMinScalingPsnr:[406,l],videoMinTargetBitrate:[421,l],videoMinTargetBitrateHq:[830,l],videoNackSendDelay:[872,d],videoNewPktsBeforeNack:[871,s],videoNpsiGenFailed:[594,s],videoNpsiNoNack:[595,s],videoNumAvSyncDiscardFrames:[1010,s],videoNumH264Frames:[332,s],videoNumH265Frames:[333,s],videoPeerState:[275,q],videoPeerTriggeredPauseCount:[654,s],videoRenderAvgFps:[208,s],videoRenderConverterTs:[225,d],videoRenderDelayT:[196,d],videoRenderDupFrames:[888,s],videoRenderFreeze2xT:[304,d],videoRenderFreeze4xT:[305,d],videoRenderFreeze8xT:[306,d],videoRenderFreezeT:[235,d],videoRenderInitFreeze16sT:[908,d],videoRenderInitFreeze2sT:[905,d],videoRenderInitFreeze4sT:[906,d],videoRenderInitFreeze8sT:[907,d],videoRenderInitFreezeT:[526,d],videoRenderNumFreezes:[569,s],videoRenderNumSinceLastFreeze10s:[571,s],videoRenderNumSinceLastFreeze30s:[572,s],videoRenderNumSinceLastFreeze5s:[570,s],videoRenderPauseT:[1132,d],videoRenderSumTimeSinceLastFreeze:[568,d],videoRtcpAppRxFailed:[493,s],videoRtcpAppTxFailed:[492,s],videoRxBitrate:[169,l],videoRxBweHitTxBwe:[187,o],videoRxBytesRtcpApp:[489,l],videoRxFecBitrate:[219,l],videoRxFecFrames:[182,s],videoRxKfBeforeLtrpAfterRpsi:[485,s],videoRxLtrpFramesVp8:[460,s],videoRxNumCodecSwitch:[721,s],videoRxPackets:[201,s],videoRxPktErrorPct:[171,l],videoRxPktLossPct:[170,l],videoRxPktRtcpApp:[487,s],videoRxRtcpFir:[621,s],videoRxRtcpNack:[203,s],videoRxRtcpNpsi:[521,s],videoRxRtcpPli:[202,s],videoRxRtcpRpsi:[459,s],videoRxTotalBytes:[168,l],videoSelfState:[274,q],videoSenderBweDiffStddev:[954,l],videoSenderBweStddev:[348,l],videoTargetBitrateReaches1000kbpsT:[351,d],videoTargetBitrateReaches1500kbpsT:[435,d],videoTargetBitrateReaches2000kbpsT:[436,d],videoTargetBitrateReaches200kbpsT:[349,d],videoTargetBitrateReaches250kbpsT:[433,d],videoTargetBitrateReaches500kbpsT:[350,d],videoTargetBitrateReaches750kbpsT:[434,d],videoTotalBytesOnNonDefCell:[451,l],videoTxBitrate:[165,l],videoTxBitrateHq:[823,l],videoTxBytesRtcpApp:[488,l],videoTxFecBitrate:[218,l],videoTxFecFrames:[181,s],videoTxNumCodecSwitch:[720,s],videoTxPackets:[197,s],videoTxPacketsHq:[818,s],videoTxPktErrorPct:[167,l],videoTxPktErrorPctHq:[821,l],videoTxPktLossPct:[166,l],videoTxPktLossPctHq:[822,l],videoTxPktRtcpApp:[486,s],videoTxResendPackets:[198,s],videoTxResendPacketsHq:[819,s],videoTxRtcpFirEmptyJb:[620,s],videoTxRtcpNack:[200,s],videoTxRtcpNpsi:[520,s],videoTxRtcpPli:[199,s],videoTxRtcpPliHq:[820,s],videoTxRtcpRpsi:[458,s],videoTxTotalBytes:[164,l],videoTxTotalBytesHq:[817,l],videoUpdateEncoderFailureCount:[453,s],videoUpgradeCancelByTimeoutCount:[325,s],videoUpgradeCancelCount:[323,s],videoUpgradeCount:[272,s],videoUpgradeRejectByTimeoutCount:[326,s],videoUpgradeRejectCount:[324,s],videoUpgradeRequestCount:[271,s],videoWidth:[188,s],voipParamsCompressedSize:[1136,s],voipParamsUncompressedSize:[1137,s],vpxLibUsed:[513,Yn],waLongFreezeCount:[891,s],waReconnectFreezeCount:[890,s],waShortFreezeCount:[889,s],waVoipHistoryGetVideoTxBitrateResult:[845,s],waVoipHistoryGetVideoTxBitrateSuccess:[740,o],waVoipHistoryIpAddressNotAvailable:[834,o],waVoipHistoryIsCallRecordLoaded:[737,o],waVoipHistoryIsCallRecordSaved:[738,o],waVoipHistoryIsInitialized:[769,o],waVoipHistoryNumOfCallRecordFound:[771,s],waVoipHistoryNumOfCallRecordLoaded:[739,s],waVoipHistorySaveCallRecordConditionCheckStatus:[770,Kn],warpHeaderRxTotalBytes:[656,l],warpHeaderTxTotalBytes:[655,l],warpMiRxPktErrorCount:[1118,s],warpMiTxPktErrorCount:[1117,s],warpRelayChangeDetectCount:[1154,s],warpRxPktErrorCount:[746,s],warpTxPktErrorCount:[745,s],waspKeyErrorCount:[1156,s],wavFileWriteMaxLatency:[1089,d],weakCellularNetConditionDetected:[429,s],weakWifiNetConditionDetected:[430,s],weakWifiSwitchToDefNetSuccess:[397,s],weakWifiSwitchToDefNetSuccessByPeriodicalCheck:[395,s],weakWifiSwitchToDefNetTriggered:[396,s],weakWifiSwitchToDefNetTriggeredByPeriodicalCheck:[394,s],weakWifiSwitchToNonDefNetFalsePositive:[399,s],weakWifiSwitchToNonDefNetSuccess:[400,s],weakWifiSwitchToNonDefNetTriggered:[398,s],wifiRssiAtCallStart:[263,s],wpNotifyCallFailed:[64,s],wpSoftwareEcMatches:[65,o],xmppStatus:[3,gr],xorCipher:[269,mr],zedFileWriteMaxLatency:[1088,d]},[1,1,1],"regular"],CatalogBiz:[1722,{cartToggle:[13,o],catalogAppealReason:[4,c],catalogBizAction:[1,Z],catalogEntryPoint:[7,ee],catalogSessionId:[3,c],collectionCount:[18,s],collectionId:[14,c],collectionIndex:[15,c],deepLinkOpenFrom:[8,Pe],errorCode:[5,s],isOrderMsgAttached:[10,o],orderId:[9,c],productCount:[6,s],productId:[2,c],productIds:[12,c],productIndex:[16,c],quantity:[11,s]},[1,1,1],"regular"],CatalogView:[1630,{bizPlatform:[16,O],cartToggle:[15,o],catalogEntryPoint:[7,ee],catalogEventSampled:[8,o],catalogOwnerJid:[6,c],catalogReportReasonCode:[4,c],catalogSessionId:[2,c],catalogViewAction:[1,te],collectionId:[17,c],collectionIndex:[18,c],deepLinkOpenFrom:[9,Pe],isNewProductAddedToCart:[13,o],isOrderMsgAttached:[10,o],orderId:[11,c],productId:[5,c],productIndex:[19,c],quantity:[12,s]},[1,1,1],"regular"],ChatComposerAction:[2948,{chatComposerActionTarget:[2,re],chatComposerActionType:[1,ie]},[1,1,1],"private",113760892],ChatFilterEvent:[1616,{actionType:[1,ae],filterType:[2,se],searchResultType:[4,de],sessionId:[3,s],targetScreen:[5,oe]},[1,1,1],"regular"],ChatFolderOpen:[2808,{activityIndicatorCount:[2,s],folderType:[1,c],hasImportantMessages:[3,o]},[1,1,1],"regular"],ChatMessageCounts:[1644,{awayMsgsSent:[56,s],bizCatalogType:[60,M],bizConversationDepth:[65,s],blockReason:[33,w],broadcastMsgsReceived:[30,s],broadcastMsgsSent:[29,s],callOffersReceived:[27,s],callOffersSent:[26,s],callsResultBusy:[70,s],callsResultCancelled:[71,s],callsResultConnected:[72,s],callsResultError:[78,s],callsResultMissed:[73,s],callsResultRejected:[74,s],chatEphemeralityDuration:[15,s],chatMuted:[8,ce],chatOverflowClicks:[79,s],chatTypeInd:[2,ue],collectionInquiriesSent:[44,s],commerceMsgsReceived:[41,s],commerceMsgsSent:[40,s],disappearingChatInitiator:[59,we],entryPointConversionApp:[47,c],entryPointConversionSource:[46,c],ephemeralMessagesReceived:[14,s],ephemeralMessagesSent:[13,s],ephemeralMessagesUnreadExpired:[69,s],fbCtaInquiriesSent:[45,s],firstResponseTime:[25,s],gaStatus:[22,$e],greetingMsgsSent:[57,s],groupContainsBiz:[75,o],groupMembershipReplies:[51,s],groupPrivateReplies:[52,s],groupSize:[19,s],isAContact:[6,o],isAGroup:[5,o],isArchived:[10,o],isBlocked:[32,o],isCartAddClicked:[36,o],isCommerceViewed:[35,o],isCtaOnPdpClicked:[37,o],isLabelled:[54,o],isOppositePartyInitiated:[62,o],isPinned:[9,o],labelledMsgs:[55,s],messagesReceived:[4,s],messagesSent:[3,s],messagesStarred:[12,s],messagesUnread:[11,s],newThread:[68,o],ordersSent:[38,s],paymentsSent:[39,s],pdpInquiriesSent:[42,s],pdpViews:[61,s],profileReplies:[64,s],profileViews:[63,s],quickRepliesSent:[58,s],receiverDefaultDisappearingDuration:[21,s],senderDefaultDisappearingDuration:[20,s],spamReports:[31,s],startTime:[7,s],statusReplies:[50,s],statusViews:[49,s],storefrontInquiriesSent:[43,s],threadDs:[66,c],threadId:[67,c],totalCallDuration:[28,s],videoCallsOffered:[76,s],viewOnceMessagesOpened:[18,s],viewOnceMessagesReceived:[17,s],viewOnceMessagesSent:[16,s],voiceCallsOffered:[77,s]},[1,1,1],"regular"],ClockSkewDifferenceT:[3178,{clockSkewHourly:[1,s]},[1,1e3,1e4],"private",37887164],CommercePerf:[2420,{commercePerfEntryPoint:[4,ye],commercePerfMarker:[3,Ee],commercePerfView:[5,Se],instanceKey:[1,s],timespentT:[2,d]},[1,1,1],"private",113760892],CommerceView:[2438,{businessOwnerJid:[4,c],commerceAction:[1,ge],commerceActionSequenceNumber:[5,s],commerceEntryPoint:[2,me],commerceEventSampled:[8,o],commerceReportReasonCode:[6,c],commerceSessionId:[3,c],deepLinkOpenFrom:[9,Pe],productId:[7,c]},[1,1,1],"private",113760892],CompanionForceUpgradeUserAction:[3254,{forceUpgradeReason:[2,c],forceUpgradeUserAction:[1,Ve]},[1,1,1],"private",113760892],CompanionGetDevicesList:[3010,{getDevicesListApiCount:[2,s],getDevicesListApiDeviceType:[3,c],getDevicesListApiEnumerationType:[4,c],getDevicesListApiT:[1,d]},[1,1,1],"regular"],ContactDiscoveryTimeToEngagement:[3190,{elapsedTime:[1,s]},[1,1,1],"private",0],ContactSend:[2234,{channel:[1,be],isMultiVcard:[2,o],messageSendResult:[3,bt],messageSendT:[4,d],vcardDataSize:[5,s]},[1,1,1],"regular"],ContactUsSession:[470,{contactUsAutomaticEmail:[3,o],contactUsExitState:[1,Ce],contactUsFaq:[2,o],contactUsLogs:[4,o],contactUsMenuFaqT:[12,d],contactUsOutage:[5,o],contactUsOutageEmail:[6,o],contactUsProblemDescription:[7,c],contactUsScreenshotC:[19,l],contactUsT:[11,d],languageCode:[21,c]},[1,1,1],"regular"],CtwaBusinessPreview:[3078,{catalogPresent:[4,o],ctwaBusinessPreviewAction:[1,D],eventTimestampMs:[2,s],openingHoursPresent:[5,o],profileLoadTimeMs:[3,s]},[1,1,1],"private",113760892],CtwaWelcomeMessage:[3022,{ctwaWelcomeMessageAction:[1,hr],ctwaWelcomeMessageContainsIcebreakers:[3,o],ctwaWelcomeMessageError:[4,_r],ctwaWelcomeMessageIcebreakersContainAutoreply:[5,o],firstWelcomeMessageImpressionTime:[2,s]},[1,1,1],"private",113760892],Daily:[1158,{accessibilityVoiceover:[108,o],addressbookSize:[11,s],addressbookWhatsappSize:[12,s],androidAdvertisingId:[135,c],androidKeystoreState:[139,m],appCodeHash:[103,c],autoDlAudioCellular:[90,o],autoDlAudioRoaming:[91,o],autoDlAudioWifi:[89,o],autoDlDocCellular:[96,o],autoDlDocRoaming:[97,o],autoDlDocWifi:[95,o],autoDlImageCellular:[87,o],autoDlImageRoaming:[88,o],autoDlImageWifi:[86,o],autoDlVideoCellular:[93,o],autoDlVideoRoaming:[94,o],autoDlVideoWifi:[92,o],backupNetworkSetting:[10,b],backupRestoreEncryptionVersion:[138,s],backupSchedule:[9,C],chatDatabaseSize:[19,s],defaultDisappearingDuration:[140,s],entSecurityNotificationsEnabled:[134,o],favoritedAnimatedStickerCount:[113,s],favoritedFirstPartyStickerCount:[112,s],favoritedTotalStickerCount:[111,s],installedAnimatedStickerPackCount:[116,s],installedAnimatedThirdPartyStickerPackCount:[137,s],installedFirstPartyStickerPackCount:[115,s],installedTotalStickerPackCount:[114,s],ipCountry:[123,c],ipStr:[122,c],languageCode:[5,c],locationCode:[6,c],mdPairTime:[124,s],mediaFolderFileCount:[21,s],mediaFolderSize:[20,s],networkIsRoaming:[7,o],osBuildNumber:[4,c],osNotificationSetting:[118,Ot],packageName:[102,c],paymentsIsEnabled:[100,o],permissionContacts:[104,o],privacySettingsAbout:[141,Ht],privacySettingsAboutExceptNum:[142,Wt],privacySettingsGroups:[143,Ht],privacySettingsGroupsExceptNum:[144,Wt],privacySettingsLastSeen:[145,Ht],privacySettingsLastSeenExceptNum:[146,Wt],privacySettingsProfilePhoto:[147,Ht],privacySettingsProfilePhotoExceptNum:[148,Wt],privacySettingsStatus:[150,Ht],privacySettingsStatusExceptNum:[151,Wt],privacySettingsStatusShareNum:[152,Wt],receiptsEnabled:[8,o],simMcc:[2,s],simMnc:[3,s],storageAvailSize:[31,s],storageTotalSize:[32,s],videoFolderFileCount:[23,s],videoFolderSize:[22,s]},[1,1,1],"regular"],DeepLinkClick:[1156,{deepLinkHasPhoneNumber:[2,o],deepLinkHasText:[1,o],deepLinkSessionId:[3,c]},[1,1,1],"regular"],DeepLinkMsgSent:[3198,{deepLinkAction:[1,Ae],deepLinkSessionId:[2,c]},[1,1,1],"regular"],DeepLinkOpen:[2136,{deepLinkOpenFrom:[2,Pe],deepLinkSessionId:[6,c],deepLinkType:[3,Me],isContact:[4,o],linkOwnerType:[5,Nt]},[1,1,1],"regular"],DisappearingModeSettingChange:[3056,{disappearingModeEntryPoint:[4,Re],lastToggleTimestamp:[3,s],newEphemeralityDuration:[2,s],previousEphemeralityDuration:[1,s]},[1,1,1],"regular"],E2eMessageRecv:[478,{e2eCiphertextType:[5,ke],e2eCiphertextVersion:[6,s],e2eDestination:[4,Ue],e2eFailureReason:[2,Ge],e2eSenderType:[8,xe],e2eSuccessful:[1,o],messageMediaType:[7,Et],offline:[9,o],retryCount:[3,s]},[1,1,20],"regular"],E2eMessageSend:[476,{e2eCiphertextType:[5,ke],e2eCiphertextVersion:[6,s],e2eDestination:[4,Ue],e2eFailureReason:[2,Ge],e2eReceiverType:[8,Ie],e2eSuccessful:[1,o],encRetryCount:[9,s],messageIsInvisible:[10,o],messageMediaType:[7,Et],retryCount:[3,s]},[1,1,1],"regular"],E2eRetryAfterDelivery:[894,{deviceType:[4,Ie],messageType:[1,Ct],msgRetryCount:[3,s],retryRevoke:[2,o]},[1,1,1],"regular"],E2eeSystemMessage:[3176,{chatCategory:[1,ne],e2eeDialogInteraction:[2,pe],e2eeSystemMessageGroupSizeBucket:[3,Be],e2eeSystemMessageType:[4,gn]},[1,1,1],"regular"],EditBusinessProfile:[1466,{businessProfileEntryPoint:[10,L],editBusinessProfileSessionId:[2,c],editProfileAction:[1,Fe],editProfileActionField:[9,N],hasAddress:[5,o],hasCategory:[4,o],hasDescription:[3,o],hasEmail:[7,o],hasHours:[6,o],hasWebsite:[8,o]},[1,1,1],"regular"],EphemeralMessageTime:[2742,{zombieStateDuration:[1,s]},[1,1,1],"regular"],EphemeralPurgeCount:[2744,{messageCount:[1,s]},[1,1,1],"regular"],EphemeralSettingChange:[2370,{chatEphemeralityDuration:[1,s],ephemeralSettingEntryPoint:[3,Ye],ephemeralSettingGroupSize:[5,jt],previousEphemeralityDuration:[2,s]},[1,1,1],"regular"],ForwardSend:[1728,{disappearingChatInitiator:[21,we],e2eCiphertextType:[12,ke],e2eCiphertextVersion:[11,s],ephemeralityDuration:[18,s],fastForwardEnabled:[5,o],isForwardedForward:[22,o],isFrequentlyForwarded:[14,o],mediaCaptionPresent:[10,o],messageForwardAgeT:[4,d],messageIsFanout:[6,o],messageIsFastForward:[3,o],messageIsInternational:[9,o],messageMediaType:[2,Et],messageSendT:[13,d],messageType:[1,Ct],receiverDefaultDisappearingDuration:[20,s],resendCount:[8,s],retryCount:[7,s],senderDefaultDisappearingDuration:[19,s],wouldBeFrequentlyForwardedAt3:[16,o],wouldBeFrequentlyForwardedAt4:[17,o]},[1,1,1],"regular"],GatedChatOpened:[3150,{chatGatedReason:[1,le],selfInitiated:[2,o]},[1,1,1],"regular"],GatedMessageReceived:[3152,{chatGatedReason:[1,le]},[1,1,1],"regular"],GifFromProviderSent:[1124,{gifSearchProvider:[1,ze]},[1,1,1],"regular"],GifSearchCancelled:[1126,{gifSearchProvider:[1,ze]},[1,1,1],"regular"],GifSearchNoResults:[1128,{gifSearchProvider:[1,ze],inputLanguageCode:[3,c],languageCode:[2,c]},[1,1,1],"regular"],GifSearchResultTapped:[1122,{gifSearchProvider:[1,ze],rank:[2,s]},[1,1,1],"regular"],GifSearchSessionStarted:[1134,{gifSearchProvider:[1,ze]},[1,1,1],"regular"],GraphqlCatalogRequest:[3206,{graphqlCatalogEndpoint:[1,qe],graphqlErrorCode:[3,s],graphqlRequestResult:[2,Je]},[1,1,1],"private",0],GroupCatchUp:[3058,{mentionsCountPendingPercentage:[4,s]},[1,1,1],"regular"],GroupCreateC:[156,{},[1,1,1],"regular"],GroupJoinC:[158,{},[1,1,1],"regular"],HfmTextSearchComplete:[2186,{},[1,1,1],"regular"],LabelEvent:[1422,{itemsLabeledCount:[5,s],labelCount:[4,s],labelOperation:[2,et],labelTarget:[1,tt],predefinedLabelNumber:[3,s]},[1,1,1],"regular"],LdpExampleEvent1:[2866,{rapporValue1:[1,s],rapporValue2:[2,s]},[1,1,1],"private",113760892],Login:[460,{androidKeystoreState:[10,m],connectionOrigin:[6,ve],connectionT:[5,d],loginResult:[1,nt],loginT:[3,d],longConnect:[4,o],passive:[8,o],retryCount:[2,s],sequenceStep:[7,s],serverErrorCode:[9,s]},[1,1,1],"regular"],MdAppStateDirtyBits:[2520,{dirtyBitsFalsePositive:[2,o]},[1,20,1e3],"regular"],MdAppStateKeyRotation:[2518,{mdAppStateKeyRotationReason:[1,rt]},[1,20,1e3],"regular"],MdAppStateMessageRange:[2522,{additionalMessagesCount:[1,s]},[1,20,1e3],"regular"],MdAppStateOfflineNotifications:[2602,{redundantCount:[1,s]},[1,20,1e3],"regular"],MdAppStateSyncDaily:[2300,{crossIndexConflictCount:[11,s],invalidActionCount:[4,s],keyRotationRemoveCount:[12,s],missingKeyCount:[9,s],mutationCount:[1,s],storedMutationCount:[7,s],unsetActionCount:[8,s],unsupportedActionCount:[5,s],uploadConflictCount:[10,s]},[1,1,1],"regular"],MdAppStateSyncMutationStats:[3180,{applied:[1,Pt],failed:[2,Pt],invalid:[3,Pt],orphan:[4,Pt],syncdAction:[5,c],unsupported:[6,Pt]},[1,1,20],"private",0],MdBadDeviceSentMessage:[2176,{dsmError:[2,Ne],peerType:[1,Ie]},[1,1,1],"regular"],MdBootstrapAppStateCriticalDataProcessing:[3164,{bootstrapAppStateDataStage:[1,R],mdBootstrapPayloadType:[2,at],mdRegAttemptId:[3,c],mdSessionId:[4,c],mdTimestamp:[5,s]},[1,1,1],"regular"],MdBootstrapAppStateDataDownloaded:[2294,{mdBootstrapContactsCount:[5,s],mdBootstrapHistoryPayloadType:[11,it],mdBootstrapPayloadSize:[4,s],mdBootstrapPayloadType:[2,at],mdBootstrapStepDuration:[6,s],mdBootstrapStepResult:[7,st],mdRegAttemptId:[10,c],mdSessionId:[1,c],mdStorageQuotaBytes:[8,s],mdStorageQuotaUsedBytes:[9,s],mdTimestamp:[3,s]},[1,1,1],"regular"],MdBootstrapDataApplied:[2298,{collection:[5,_e],historySyncStageProgress:[11,s],mdBootstrapContactsCount:[8,s],mdBootstrapHistoryPayloadType:[10,it],mdBootstrapPayloadType:[3,at],mdBootstrapSource:[2,ot],mdBootstrapStepDuration:[6,s],mdRegAttemptId:[9,c],mdSessionId:[1,c],mdTimestamp:[4,s],usedSnapshot:[7,o]},[1,1,1],"regular"],MdBootstrapHistoryDataDownloaded:[2296,{historySyncStageProgress:[14,s],mdBootstrapChatsCount:[6,s],mdBootstrapHistoryPayloadType:[13,it],mdBootstrapMessagesCount:[5,s],mdBootstrapPayloadSize:[4,s],mdBootstrapPayloadType:[2,at],mdBootstrapStepDuration:[7,s],mdBootstrapStepResult:[8,st],mdHsOldestMessageTimestamp:[11,s],mdRegAttemptId:[12,c],mdSessionId:[1,c],mdStorageQuotaBytes:[9,s],mdStorageQuotaUsedBytes:[10,s],mdTimestamp:[3,s]},[1,1,1],"regular"],MdBootstrapHistoryDataReceived:[2998,{historySyncStageProgress:[5,s],mdBootstrapHistoryPayloadType:[3,it],mdBootstrapPayloadType:[2,at],mdSessionId:[1,c],mdTimestamp:[4,s]},[1,1,1],"regular"],MdCriticalEvent:[2746,{mdCriticalEventCode:[1,ut]},[1,1,1],"regular"],MdDeviceSyncAck:[2180,{chatType:[1,Tt],revoke:[2,o]},[1,1,1],"regular"],MdFatalError:[2304,{collection:[2,_e],isBootstrap:[3,o],mdFatalErrorCode:[1,pt],patchSnapshotMutationCount:[9,s],patchVersion:[5,s],sourceType:[10,ft],timeSincePairingMs:[6,s],timeSinceRefreshMs:[7,s],timeSinceTabTakeoverMs:[8,s]},[1,1,1],"regular"],MdLinkDeviceCompanion:[2576,{mdDurationS:[8,s],mdLinkDeviceCompanionErrorCode:[6,s],mdLinkDeviceCompanionStage:[4,ct],mdRegAttemptId:[9,c],mdSessionId:[1,c],mdTimestampS:[7,s],mdWasUpgraded:[5,o]},[1,1,1],"regular"],MdPushnameValidation:[2302,{didWebUserChangeSyncd:[3,o],isSyncdPushnameEmpty:[2,o],matches:[1,o],validationCaller:[4,ht],validationStage:[5,dt],webPlatform:[6,_t]},[1,1,1e3],"regular"],MdRetryFromUnknownDevice:[2178,{offline:[2,o],senderType:[1,Ie]},[1,1,1],"regular"],MdSyncdDogfoodingFeatureUsage:[3016,{mdSyncdDogfoodingFeature:[1,lt]},[1,1,1],"regular"],MediaDownload2:[1590,{connectionType:[31,Te],debugMediaException:[24,c],debugMediaIp:[22,c],debugUrl:[23,c],downloadBytesTransferred:[20,l],downloadConnectT:[15,d],downloadHttpCode:[18,s],downloadIsReuse:[17,o],downloadIsStreaming:[19,o],downloadNetworkT:[16,d],downloadQuality:[37,Le],downloadResumePoint:[14,s],downloadTimeToFirstByteT:[21,d],estimatedBandwidth:[36,l],isViewOnce:[41,o],mediaId:[38,s],networkStack:[30,Mt],overallAttemptCount:[4,s],overallBackendStore:[39,T],overallConnBlockFetchT:[10,d],overallConnectionClass:[29,c],overallCumT:[27,d],overallDecryptT:[12,d],overallDomain:[5,c],overallDownloadMode:[11,gt],overallDownloadOrigin:[35,De],overallDownloadResult:[25,mt],overallFileValidationT:[13,d],overallIsEncrypted:[28,o],overallIsFinal:[26,o],overallMediaSize:[7,l],overallMediaType:[1,Et],overallMmsVersion:[6,s],overallQueueT:[9,d],overallRetryCount:[3,s],overallT:[8,d],usedFallbackHint:[40,c]},[1,1,1],"regular"],MediaPicker:[1038,{audienceSelectorClicked:[24,o],audienceSelectorUpdated:[25,o],chatRecipients:[16,s],isViewOnce:[22,o],mediaPickerChanged:[4,s],mediaPickerCroppedRotated:[10,s],mediaPickerDeleted:[3,s],mediaPickerDrawing:[11,s],mediaPickerFilter:[18,s],mediaPickerLikeDoc:[19,s],mediaPickerNotLikeDoc:[20,s],mediaPickerOrigin:[14,yt],mediaPickerOriginThirdParty:[21,o],mediaPickerSent:[2,s],mediaPickerSentUnchanged:[5,s],mediaPickerStickers:[12,s],mediaPickerT:[15,d],mediaPickerText:[13,s],mediaType:[1,Et],photoGalleryDurationT:[23,d],statusRecipients:[17,s]},[1,1,1],"regular"],MediaUpload2:[1588,{connectionType:[43,Te],debugMediaException:[34,c],debugMediaIp:[32,c],debugUrl:[33,c],estimatedBandwidth:[45,l],finalizeConnectT:[28,d],finalizeHttpCode:[31,s],finalizeIsReuse:[30,o],finalizeNetworkT:[29,d],isViewOnce:[49,o],mediaId:[46,s],networkStack:[42,Mt],overallAttemptCount:[4,s],overallConnBlockFetchT:[10,d],overallConnectionClass:[41,c],overallCumT:[37,d],overallCumUserVisibleT:[38,d],overallDomain:[5,c],overallEncryptT:[50,d],overallIsFinal:[36,o],overallIsForward:[16,o],overallIsManual:[13,o],overallLastUploadRetryPhase:[11,Dt],overallMediaKeyReuse:[40,Lt],overallMediaSize:[7,l],overallMediaType:[1,Et],overallMmsVersion:[6,s],overallOptimisticFlag:[12,wt],overallQueueT:[9,d],overallRetryCount:[3,s],overallT:[8,d],overallTranscodeT:[15,d],overallUploadMode:[39,St],overallUploadOrigin:[44,Nn],overallUploadResult:[35,vt],overallUserVisibleT:[14,d],resumeConnectT:[17,d],resumeHttpCode:[20,s],resumeIsReuse:[19,o],resumeNetworkT:[18,d],uploadBytesTransferred:[27,l],uploadConnectT:[22,d],uploadHttpCode:[25,s],uploadIsReuse:[24,o],uploadIsStreaming:[26,o],uploadNetworkT:[23,d],uploadResumePoint:[21,s],uploadSource:[48,kn],usedFallbackHint:[47,c]},[1,1,1],"regular"],MemoryStat:[1336,{hasVerifiedNumber:[7,o],numMessages:[8,l],privateBytes:[3,l],processType:[5,c],sharedBytes:[4,l],uptime:[6,l],workingSetPeakSize:[2,l],workingSetSize:[1,l]},[1,1,1],"regular"],MessageReceive:[450,{deviceCount:[16,s],deviceSizeBucket:[10,Sn],disappearingChatInitiator:[14,we],ephemeralityDuration:[13,s],isForwardedForward:[18,o],isViewOnce:[9,o],messageIsInternational:[4,o],messageIsOffline:[5,o],messageMediaType:[2,Et],messageQueueTime:[15,d],messageReceiveT0:[6,d],messageReceiveT1:[7,d],messageType:[1,Ct],mutedGroupMessage:[8,o],numOfWebUrlsInTextMessage:[3,s],participantCount:[17,s],receiverDefaultDisappearingDuration:[12,s],senderDefaultDisappearingDuration:[11,s]},[1,1,1],"regular"],MessageSend:[854,{deviceCount:[31,s],deviceSizeBucket:[25,Sn],disappearingChatInitiator:[30,we],e2eBackfill:[23,o],e2eCiphertextType:[10,ke],e2eCiphertextVersion:[9,s],ephemeralityDuration:[21,s],fastForwardEnabled:[15,o],isFromWamsys:[19,o],isViewOnce:[22,o],mediaCaptionPresent:[8,o],messageForwardAgeT:[14,d],messageIsFanout:[5,o],messageIsFastForward:[13,o],messageIsFirstUserMessage:[26,o],messageIsForward:[4,o],messageIsInternational:[7,o],messageIsInvisible:[29,o],messageIsRevoke:[24,o],messageMediaType:[3,Et],messageSendOptUploadEnabled:[12,o],messageSendResult:[1,bt],messageSendResultIsTerminal:[17,o],messageSendT:[11,d],messageType:[2,Ct],participantCount:[32,s],receiverDefaultDisappearingDuration:[28,s],resendCount:[16,s],retryCount:[6,s],revokeDuration:[33,s],revokeType:[34,hn],senderDefaultDisappearingDuration:[27,s],stickerIsFirstParty:[18,o],thumbSize:[20,l]},[1,5,5],"regular"],MessageTemplateBlocks:[3002,{blockEntryPoint:[3,I],blockReason:[2,w],didUserReply:[4,o],templateId:[1,c]},[1,1,1],"private",113760892],OfflineResume:[3112,{chatThreadCount:[1,s],isOfflineCompleteMissed:[2,o],isResumeInForeground:[13,o],lastStanzaT:[3,d],mailboxAge:[14,s],mainScreenLoadT:[4,d],offlineDecryptErrorCount:[5,s],offlineMessageCount:[6,s],offlineNotificationCount:[7,s],offlinePreviewT:[8,d],offlineReceiptCount:[9,s],offlineSizeBytes:[10,s],onTrickleMode:[15,o],pageLoadT:[11,d],socketConnectT:[12,d]},[1,1,1],"regular"],OtpCopyCodeClick:[3080,{businessPhoneNumber:[1,s],otpEntryPoint:[4,Rt],templateId:[3,c]},[1,1,1],"private",0],PaymentsDaily:[2950,{invitedUserCnt:[2,s],invitedUserRegisteredCnt:[3,s],inviterUserCnt:[5,s],invitesReceivedToUserCnt:[4,s],invitesSentToUserCnt:[1,s],startTs:[14,s],totalTransactionReceivedCnt:[10,s],totalTransactionSentCnt:[6,s],transactionReceivedWithBackgroundAndStickerCnt:[13,s],transactionReceivedWithBackgroundCnt:[12,s],transactionReceivedWithStickerCnt:[11,s],transactionSentWithBackgroundAndStickerCnt:[9,s],transactionSentWithBackgroundCnt:[8,s],transactionSentWithStickerCnt:[7,s]},[1,1,1],"private",113760892],PlaceholderActivity:[1980,{deviceCount:[9,s],deviceSizeBucket:[8,Sn],messageIsRevoke:[7,o],messageMediaType:[6,Et],messageType:[5,Ct],participantCount:[10,s],placeholderActionInd:[2,Gt],placeholderChatTypeInd:[3,xt],placeholderTimePeriod:[4,s],placeholderTypeInd:[1,Bt]},[1,1,1],"regular"],PrekeysDepletion:[3014,{deviceSizeBucket:[3,Sn],messageType:[2,Ct],prekeysFetchReason:[1,Yt]},[1,1,1],"regular"],PsBufferUpload:[2244,{applicationState:[6,E],psBufferUploadHttpResponseCode:[3,s],psBufferUploadResult:[1,zt],psBufferUploadT:[2,d],psDitheredT:[11,s],psForceUpload:[10,o],psTokenNotReadyReason:[4,Qt],psUploadReason:[9,Xt],waConnectedToChatd:[5,o]},[1,1,1],"regular"],PsIdCreate:[2310,{},[1,1,1],"regular"],PsIdUpdate:[2862,{psIdAction:[2,qt],psIdKey:[1,s],psIdRotationFrequence:[3,s]},[1,1,1],"regular"],PsP2bThreadsV1:[2994,{chatEphemeralityDuration:[11,s],chatMuted:[6,ce],chatTypeInd:[18,ue],ephemeralMessagesReceived:[13,s],ephemeralMessagesSent:[12,s],groupSize:[3,s],isAContact:[1,o],isAGroup:[2,o],isArchived:[5,o],isPinned:[4,o],messagesReceived:[8,s],messagesSent:[7,s],messagesStarred:[9,s],messagesUnread:[10,s],startTime:[17,s],viewOnceMessagesOpened:[14,s],viewOnceMessagesReceived:[16,s],viewOnceMessagesSent:[15,s]},[1,1,1],"private",113760892],PsPhoneNumberHyperlink:[3266,{isPhoneNumHyperlinkOwner:[1,o],phoneNumHyperlinkAction:[2,Ut],phoneNumberStatusOnWa:[3,o],sequenceNumber:[4,s]},[1,1,1],"private",113760892],PsStructuredMessageInteraction:[3052,{bizPlatform:[1,O],businessOwnerJid:[7,c],messageClass:[3,On],messageClassAttributes:[5,c],messageInteraction:[4,Ze],messageMediaType:[2,Et]},[1,1,1],"private",0],Ptt:[458,{pttDraftPlayCnt:[7,s],pttDraftSeekCnt:[8,s],pttDuration:[5,d],pttLock:[4,o],pttPauseCnt:[9,s],pttResult:[1,nn],pttSize:[3,l],pttSource:[2,rn],pttStop:[6,o],pttStopTapCnt:[10,s]},[1,1,1],"regular"],PttDaily:[2938,{pttCancelBroadcast:[9,s],pttCancelGroup:[8,s],pttCancelIndividual:[7,s],pttDraftReviewBroadcast:[15,s],pttDraftReviewGroup:[14,s],pttDraftReviewIndividual:[13,s],pttFastplaybackBroadcast:[21,s],pttFastplaybackGroup:[20,s],pttFastplaybackIndividual:[19,s],pttLockBroadcast:[12,s],pttLockGroup:[11,s],pttLockIndividual:[10,s],pttOutOfChatBroadcast:[29,s],pttOutOfChatGroup:[30,s],pttOutOfChatIndividual:[31,s],pttPausedRecordBroadcast:[22,s],pttPausedRecordGroup:[23,s],pttPausedRecordIndividual:[24,s],pttPlaybackBroadcast:[18,s],pttPlaybackGroup:[17,s],pttPlaybackIndividual:[16,s],pttRecordBroadcast:[3,s],pttRecordGroup:[2,s],pttRecordIndividual:[1,s],pttSendBroadcast:[6,s],pttSendGroup:[5,s],pttSendIndividual:[4,s],pttStopTapBroadcast:[25,s],pttStopTapGroup:[26,s],pttStopTapIndividual:[27,s]},[1,1,1],"regular"],PttLockC:[2984,{},[1,1,1],"regular"],PttPlayback:[2044,{pttDuration:[12,d],pttMainThreadBlock:[7,o],pttMiniPlayerClick:[15,s],pttMiniPlayerClose:[16,o],pttMiniPlayerPauseCnt:[17,s],pttPlayRequestT:[1,d],pttPlaybackFailed:[8,o],pttPlaybackOverallT:[4,d],pttPlaybackSpeed:[10,en],pttPlaybackSpeedCnt:[11,s],pttPlayedOutOfChat:[18,o],pttPlayedPct:[14,l],pttPlayer:[9,tn],pttPlayerInitT:[2,d],pttPlayerPlayT:[3,d],pttSeekCnt:[13,s],pttTrigger:[5,on],pttType:[6,an]},[1,1,1],"regular"],QuickReply:[1468,{attachmentGifCount:[7,s],attachmentImageCount:[5,s],attachmentVideoCount:[6,s],isSmartDefault:[10,o],quickReplyAction:[1,ln],quickReplyCount:[2,s],quickReplyEntryPoint:[11,cn],quickReplyKeywordCount:[3,s],quickReplyKeywordMatched:[4,o],quickReplyOrigin:[9,dn],quickReplyTranscodeResult:[8,un]},[1,1,1],"regular"],ReactionActions:[3184,{mediaType:[3,Et],messageType:[1,Ct],reactionAction:[2,fn]},[1,10,20],"regular"],RoomsCreationFlow:[2202,{entryResult:[3,Oe],errorReason:[2,Ke],roomsEntryPoint:[1,_n]},[1,1,1],"regular"],SendRevokeMessage:[1348,{messageMediaType:[2,Et],messageType:[1,Ct],revokeSendDelay:[3,s]},[1,1,1],"regular"],SenderKeyExpired:[3130,{chatType:[1,Tt],deviceSizeBucket:[2,Sn],expiryReason:[3,We]},[1,1,1],"regular"],SignCredential:[2242,{applicationState:[6,E],overallT:[4,d],projectCode:[7,$t],retryCount:[2,s],signCredentialResult:[1,yn],signCredentialT:[3,d],waConnectedToChatd:[5,o]},[1,1,1],"regular"],StatusItemView:[1658,{isPosterBiz:[23,o],isPosterInAddressBook:[25,o],mediaType:[4,Et],psaCampaignId:[17,c],psaCampaignItemIndex:[18,s],psaLinkAvailable:[19,o],psaLinkClick:[22,o],psaLinkLoadTime:[21,d],psaLinkOpenResult:[20,Zt],statusItemImpressionCount:[14,s],statusItemIndex:[16,s],statusItemLength:[7,d],statusItemLoadTime:[5,d],statusItemReplied:[8,s],statusItemUnread:[9,o],statusItemViewCount:[10,s],statusItemViewResult:[3,Tn],statusItemViewTime:[6,d],statusRowIndex:[2,s],statusRowSection:[11,An],statusViewerSessionId:[1,s]},[1,1,1],"regular"],StatusReply:[1180,{isPosterBiz:[4,o],isPosterInAddressBook:[6,o],statusReplyMessageType:[3,bn],statusReplyResult:[2,Cn],statusSessionId:[1,s]},[1,1,1],"regular"],StatusTabOpen:[1172,{psaCampaigns:[5,c],statusAvailableUpdatesCount:[2,s],statusRankT:[3,d],statusSessionId:[1,s],statusTabOpenT:[4,d]},[1,1,1],"regular"],StickerCommonQueryToStaticServer:[2740,{httpResponseCode:[2,s],params:[3,c],queryType:[1,sn]},[1,1,1],"regular"],StickerDailyAggregatedEvent:[2884,{stickerAddToFavoriteCount:[11,s],stickerMakerCreates:[16,s],stickerMakerSends:[17,s],stickerPackDeleteCount:[12,s],stickerPickerOpenedCount:[13,s],stickerSearchOpenedCount:[14,s],stickerSendCount:[1,s],stickerSendCountForward:[6,s],stickerSendCountIsAnimated:[9,s],stickerSendCountIsFirstParty:[8,s],stickerSendCountIsWeb:[10,s],stickerSendCountStickerPickerTabEmotion:[5,s],stickerSendCountStickerPickerTabFavorites:[3,s],stickerSendCountStickerPickerTabPack:[15,s],stickerSendCountStickerPickerTabRecents:[2,s],stickerSendCountStickerSearch:[7,s]},[1,1,1],"regular"],StickerSend:[1840,{stickerIsAnimated:[3,o],stickerIsFirstParty:[2,o],stickerIsFromStickerMaker:[5,o],stickerSendMessageType:[4,Pn],stickerSendOrigin:[1,Mn]},[1,1,1],"regular"],StructuredMessageReceive:[3222,{bizPlatform:[1,O],businessOwnerJid:[2,c],messageClass:[3,On],messageClassAttributes:[4,c],messageMediaType:[5,Et]},[1,1,1],"private",0],TemplateTruncation:[1946,{buttonIndex:[3,s],originalLength:[2,s],templateComponent:[1,wn]},[1,1,1],"regular"],TestAnonymousDaily:[2328,{},[1,1,1],"private",113760892],TestAnonymousDailyId:[2958,{psTestEnumField:[1,Jt],psTestFloatField:[2,l]},[1,1,1],"private",248614979],TestAnonymousIdLess:[3004,{psTimeSinceLastEventInMin:[1,s]},[1,1,1],"private",0],TestAnonymousMonthlyId:[2960,{},[1,1,1],"private",191000728],TestAnonymousWeeklyId:[2956,{psTestBooleanField:[2,o],psTestStringField:[3,c],psTimeSinceLastEventInMin:[1,s]},[1,1,1],"private",42196056],UiAction:[472,{deviceCount:[5,s],participantCount:[6,s],sizeBucket:[4,Sn],uiActionPreloaded:[2,o],uiActionT:[3,d],uiActionType:[1,Ln]},[1,1,1],"regular"],UserActivity:[1384,{userActivityBitmapHigh:[4,s],userActivityBitmapLen:[5,s],userActivityBitmapLow:[3,s],userActivitySessionCum:[7,s],userActivitySessionId:[1,c],userActivitySessionSeq:[6,s],userActivityStartTime:[2,s]},[1,1,1],"regular"],UserActivitySessionSummary:[1502,{ipStr:[7,c],userActivityDuration:[2,s],userActivityForeground:[5,s],userActivitySessionsLength:[3,s],userActivityStartTime:[1,s],userActivityTimeChange:[4,s],userSessionSummarySequence:[6,s]},[1,1,1],"regular"],UserNotice:[2472,{userNoticeContentVersion:[2,s],userNoticeEvent:[3,Bn],userNoticeId:[1,s]},[1,1,1],"regular"],UserNoticeError:[2474,{userNoticeContentVersion:[2,s],userNoticeErrorEvent:[3,xn],userNoticeId:[1,s]},[1,1,1],"regular"],ViewBusinessProfile:[1522,{bizFbSize:[9,Rn],bizIgSize:[10,Rn],businessProfileJid:[3,c],catalogSessionId:[6,c],hasCoverPhoto:[12,o],isProfileLinked:[11,o],isSelfView:[7,o],linkedAccount:[5,B],profileEntryPoint:[8,Vt],scrollDepth:[4,s],viewBusinessProfileAction:[1,Fn],websiteSource:[2,fr]},[1,1,1],"regular"],VnameCertHealthEvent:[1890,{vnameCertHealthEventType:[2,jn]},[1,1,1],"regular"],WaShopsManagement:[2908,{isShopsProductPreviewVisible:[2,o],shopsManagementAction:[1,mn],shopsSellerJid:[3,c]},[1,1,1],"regular"],WamTestAnonymous0:[2240,{testAnonymousChatdConnectivity:[2,o],wamTestAnonymous0Field0:[1,c]},[1,1,1],"private",113760892],WebWamForceFlush:[3264,{},[1,1,1],"regular"],WebcAbpropsValidation:[2802,{abpropName:[1,c],abpropValue:[2,c],serverPropName:[3,c],serverPropValue:[4,c]},[1,1,1],"regular"],WebcAssetLoad:[1358,{webcAssetCacheType:[4,Hn],webcAssetFromCache:[2,o],webcAssetLoadT:[3,d],webcAssetName:[1,c],webcAssetSize:[5,l]},[1,1,1],"regular"],WebcChatOpen:[864,{webcChatOpenBeforePaintT:[7,d],webcChatOpenPaintedT:[6,d],webcChatOpenT:[2,d],webcFinalRenderedMessageCount:[5,s],webcRenderedMessageCount:[4,s],webcUnreadCount:[1,l],webcWindowHeightFloat:[8,l]},[1,1,1],"regular"],WebcCpu:[3e3,{cpuSessionSeconds:[2,s],ftsIndexInProgess:[3,o],logInterval:[4,s],percentCpuUsage:[1,s]},[1,1,1],"regular"],WebcDbOpen:[1940,{webcDbName:[1,c],webcDbOpenNumAttempts:[3,s],webcDbOpenWasSuccess:[2,o]},[1,1,1],"regular"],WebcEmojiOpen:[1166,{webcEmojiOpenTab:[1,c]},[1,1,1],"regular"],WebcFingerprint:[1704,{webcCanvasFingerprint:[25,c],webcDocumentDriverEvaluate:[9,o],webcDocumentDriverUnwrapped:[7,o],webcDocumentElementAttrDriver:[14,o],webcDocumentElementAttrSelenium:[12,o],webcDocumentElementAttrWebdriver:[13,o],webcDocumentFxdriverEvaluate:[6,o],webcDocumentFxdriverUnwrapped:[11,o],webcDocumentSeleniumEvaluate:[2,o],webcDocumentSeleniumUnwrapped:[10,o],webcDocumentWebdriverEvaluate:[1,o],webcDocumentWebdriverScriptFn:[5,o],webcDocumentWebdriverScriptFunc:[4,o],webcDocumentWebdriverScriptFunction:[3,o],webcDocumentWebdriverUnwrapped:[8,o],webcWebglFingerprint:[24,c],webcWebglRenderer:[23,c],webcWebglVendor:[22,c],webcWindowSeleniumIdeRecorder:[20,o],webcWindowCallphantom:[18,o],webcWindowCallselenium:[19,o],webcWindowNavigatorWebdriver:[21,pr],webcWindowNightmare:[16,o],webcWindowPhantom:[15,o],webcWindowSelenium:[17,o]},[1,1,1],"regular"],WebcImgError:[1700,{webcImgErrorCode:[1,l]},[1,1,1],"regular"],WebcJobInfo:[3054,{jobName:[1,c],jobPriority:[2,c],jobResultType:[5,zn],pendingJobsCount:[4,s],scenario:[3,ir],webcJobAddedT:[6,d],webcJobCompletedT:[8,d],webcJobStartedT:[7,d]},[1,1,1],"regular"],WebcLogin:[1664,{webcBrowserNetworkType:[14,c],webcBrowserStorageQuotaBytes:[15,s],webcBrowserStorageQuotaUsedBytes:[16,s],webcLoginT:[3,d],webcPersistentLoginEnabled:[17,o],webcQrCodes:[1,s],webcQrLoadT:[2,d],webcSyncChatCount:[8,s],webcSyncChatSize:[10,s],webcSyncChatT:[9,d],webcSyncContactCount:[11,s],webcSyncContactSize:[13,s],webcSyncContactT:[12,d],webcSyncMessageCount:[5,s],webcSyncMessageSize:[7,s],webcSyncMessageT:[6,d],webcSyncT:[4,d]},[1,1,1],"regular"],WebcMediaAnalyzed:[912,{webcMediaAnalyzeT:[3,d],webcMediaExtensions:[2,c],webcMediaSupported:[1,o]},[1,1,1],"regular"],WebcMediaEditorSend:[2890,{editedImageCount:[2,s],emojiLayerCount:[5,s],imageCount:[1,s],paintedImageCount:[3,s],stickerLayerCount:[6,s],textLayerCount:[4,s]},[1,1,1],"regular"],WebcMediaErrorUnknownDetails:[2352,{mediaId:[1,s],webcMediaErrorName:[3,c],webcMediaOperation:[2,Jn]},[1,1,1],"regular"],WebcMediaLoad:[1202,{webcMediaLoadResult:[2,qn],webcMediaLoadT:[1,d]},[1,1,1],"regular"],WebcMediaRmr:[1906,{messageMediaType:[10,Et],webcBrowserNetworkType:[2,c],webcBrowserStorageQuotaBytes:[11,s],webcBrowserStorageQuotaUsedBytes:[12,s],webcChatPosition:[1,s],webcChatType:[9,Vn],webcMediaRmrError:[8,o],webcMediaRmrT:[6,d],webcMediaSize:[7,s],webcMessageIndex:[3,s],webcMessageT:[5,d],webcRmrReason:[14,rr],webcRmrStatusCode:[13,s]},[1,1,1],"regular"],WebcMemoryStat:[1188,{hasVerifiedNumber:[12,o],jsHeapSizeLimit:[9,s],numMessages:[8,l],totalJsHeapSize:[10,s],uptime:[6,l],usedJsHeapSize:[11,s]},[1,1,1],"regular"],WebcMenu:[2504,{webcMenuAction:[2,Xn],webcMenuItemLabel:[3,Qn]},[1,1,1],"regular"],WebcMessageQuery:[1876,{webcAudioMessageCount:[14,s],webcBrowserNetworkType:[1,c],webcBrowserStorageQuotaBytes:[20,s],webcBrowserStorageQuotaUsedBytes:[21,s],webcChatPosition:[2,s],webcChatType:[13,Vn],webcDocumentMessageCount:[16,s],webcEarliestMessageIndex:[11,s],webcEarliestMessageT:[12,d],webcMessageCount:[4,s],webcMessageQueryTrigger:[19,nr],webcMessageQueryType:[3,Zn],webcOtherMessageCount:[18,s],webcPhotoMessageCount:[7,s],webcPttMessageCount:[15,s],webcQueryT:[9,d],webcResponseBytes:[10,s],webcStickerMessageCount:[17,s],webcTextMessageCount:[5,s],webcVideoMessageCount:[6,s]},[1,1,1],"regular"],WebcMessageSend:[2072,{messageIsForward:[3,o],messageMediaType:[2,Et],messageSendT:[4,d],messageType:[1,Ct]},[1,1,1],"regular"],WebcOfflineResume:[2628,{chatThreadCount:[9,s],decryptErrorCount:[4,s],isOfflineCompleteMissed:[11,o],offlineMessageCount:[2,s],offlineNotificationCount:[12,s],offlineReceiptCount:[3,s],offlineSizeBytes:[8,s],webcLastStanzaT:[10,d],webcMainScreenLoadT:[7,d],webcOfflinePreviewT:[6,d],webcPageLoadT:[1,d],webcSocketConnectT:[5,d]},[1,1,1],"regular"],WebcPageLoad:[642,{webcAppcacheStatus:[29,Wn],webcCached:[30,o],webcConnectEnd:[10,d],webcConnectStart:[9,d],webcDomComplete:[19,d],webcDomContentLoadedEventEnd:[18,d],webcDomContentLoadedEventStart:[17,d],webcDomInteractive:[16,d],webcDomLoading:[15,d],webcDomainLookupEnd:[8,d],webcDomainLookupStart:[7,d],webcExeDone:[23,d],webcExeStart:[22,d],webcFetchStart:[6,d],webcInitialMountT:[38,d],webcInitialNavMountT:[39,d],webcInitialPanel:[42,c],webcInitialPanelMountStartT:[43,d],webcInitialPanelMountT:[40,d],webcInitialPanelRenderT:[46,d],webcJsLoadT:[37,d],webcLoadEventEnd:[21,d],webcLoadEventStart:[20,d],webcLoadInForeground:[53,o],webcMainScriptEnd:[45,d],webcMainScriptStart:[44,d],webcNativeLoadT:[36,d],webcNavigation:[32,er],webcPageLoadT:[34,d],webcParallellyFetched:[41,o],webcQrCode:[31,o],webcRedirectCount:[33,l],webcRedirectEnd:[5,d],webcRedirectStart:[4,d],webcRequestStart:[12,d],webcResponseEnd:[14,d],webcResponseStart:[13,d],webcSecureConnectionStart:[11,d],webcUnloadEventEnd:[3,d],webcUnloadEventStart:[2,d],webcWsAttempts:[28,l],webcWsNormal:[27,d],webcWsOpening:[24,d],webcWsPairing:[25,d],webcWsSyncing:[26,d]},[1,1,1],"regular"],WebcPageResume:[884,{webcResumeCount:[1,s]},[1,1,1],"regular"],WebcPhoneDisconnected:[878,{webcPhoneBbarShownT:[2,d],webcPhoneDisconnectedT:[1,d]},[1,1,1],"regular"],WebcProgressiveImage:[2226,{webcFirstRenderScans:[1,s],webcFirstRenderT:[2,d],webcFullQualityT:[4,d],webcMidQualityT:[3,d]},[1,1,10],"regular"],WebcQplHealth:[3134,{webcQplHealthEventData:[1,c],webcQplHealthEventType:[2,tr]},[1,1,1],"regular"],WebcRawPlatforms:[2416,{webcRawPlatform:[1,c]},[1,1,1],"regular"],WebcResourceLoad:[688,{webcResourceCached:[3,o],webcResourceDuration:[2,d],webcResourceName:[1,c]},[1,1,1],"regular"],WebcStatusSession:[1880,{webcStatusMutedItemCount:[4,s],webcStatusMutedRowCount:[7,s],webcStatusRecentItemCount:[2,s],webcStatusRecentRowCount:[5,s],webcStatusSessionId:[1,s],webcStatusViewedItemCount:[3,s],webcStatusViewedRowCount:[6,s]},[1,1,1],"regular"],WebcStatusSync:[1878,{webcStatusMutedItemCount:[4,s],webcStatusMutedRowCount:[7,s],webcStatusRecentItemCount:[2,s],webcStatusRecentRowCount:[5,s],webcStatusSyncT:[1,d],webcStatusViewedItemCount:[3,s],webcStatusViewedRowCount:[6,s]},[1,1,1],"regular"],WebcStatusView:[1882,{webcIsPosterBiz:[11,o],webcIsPostersAddressBook:[12,o],webcStatusLoadT:[6,d],webcStatusLoaded:[4,o],webcStatusMediaType:[5,ar],webcStatusPlaybackT:[8,d],webcStatusReplyCount:[9,s],webcStatusRowIndex:[3,s],webcStatusRowSection:[2,or],webcStatusSessionId:[1,s],webcStatusUnread:[10,o],webcStatusViewT:[7,d]},[1,1,1],"regular"],WebcStickerMakerEvents:[3104,{stickerMakerEventName:[1,sr]},[1,1,1],"regular"],WebcStorageStat:[1504,{webcStorageQuota:[2,s],webcStorageUsage:[1,s]},[1,1,1],"regular"],WebcStreamModeChange:[770,{webcStreamMode:[1,lr]},[1,1,1],"regular"],WebcUiFreeze:[1836,{webcUiFreezeFps:[1,l],webcUiFreezeT:[2,d]},[1,1,1],"regular"],WebcWapRequest:[2006,{webcWapRequestAckT:[3,d],webcWapRequestDestination:[6,cr],webcWapRequestKind:[5,dr],webcWapRequestName:[8,c],webcWapRequestRecvT:[4,d],webcWapRequestResponseSize:[2,s],webcWapRequestSize:[7,s],webcWapRequestStatus:[9,s]},[1,1,10],"regular"]});var Er=(0,i.default)((0,i.default)({},a.events),{METRICS:a.metrics,Global:yr,WamEvent:a.WamEvent,PrivateStatsAllIds:[{key:"DefaultPsId",keyHashInt:113760892,rotationPeriodDays:-1},{key:"IdTtl90Days",keyHashInt:37887164,rotationPeriodDays:90},{key:"IdTtlDaily",keyHashInt:248614979,rotationPeriodDays:1},{key:"IdTtlMonthly",keyHashInt:191000728,rotationPeriodDays:30},{key:"IdTtlWeekly",keyHashInt:42196056,rotationPeriodDays:7}],ADV_DECODE_ERROR_TYPE:u,ADV_DECODE_PROTO_TYPE:p,AEC_MODE:f,AGC_MODE:h,ANDROID_CAMERA2_SUPPORT_LEVEL:_,ANDROID_CAMERA_API:g,ANDROID_KEYSTORE_STATE_TYPE:m,APP_BUILD_TYPE:y,APPLICATION_STATE:E,AUDIO_ENGINE_TYPE:S,AUTO_REPLY_ACTION:v,BACKEND_STORE_TYPE:T,BACKUP_NETWORK_SETTING:b,BACKUP_SCHEDULE:C,BANNER_OPERATIONS:A,BANNER_TYPES:P,BIZ_CATALOG_TYPE:M,BIZ_PLATFORM:O,BLOCK_ENTRY_POINT:I,BLOCK_REASON:w,BOOTSTRAP_APP_STATE_DATA_STAGE_CODE:R,BUSINESS_PREVIEW_ACTION_TYPE:D,BUSINESS_PROFILE_ENTRY_POINT:L,BUSINESS_PROFILE_FIELD:N,BUSINESS_PROFILE_VIEW_ACTION:k,BUSINESS_PROFILE_WEBSITE_SOURCE_TYPE:U,BUSINESS_TOOLS_ENTRY_POINT_TYPE:G,BUSINESS_TOOLS_ITEM_TYPE:x,BUSINESS_TOOLS_LINKED_ACCOUNT_TYPE:B,CALL_FROM_UI:F,CALL_NETWORK_MEDIUM:j,CALL_RELAY_BIND_STATUS:Y,CALL_RESULT_TYPE:K,CALL_SEGMENT_TYPE:W,CALL_SETUP_ERROR_TYPE:H,CALL_SIDE:V,CALL_TERM_REASON:$,CALL_TRANSPORT_TYPE:z,CALL_VIDEO_STATE:q,CALL_WAKEUP_SOURCE:J,CAMERA_PREVIEW_MODE:Q,CAMERA_START_MODE_PARAMS:X,CATALOG_BIZ_ACTION:Z,CATALOG_ENTRY_POINT:ee,CATALOG_VIEW_ACTION:te,CATEGORY_TYPE:ne,CHAT_COMPOSER_ACTION_TARGETS:re,CHAT_COMPOSER_ACTION_TYPES:ie,CHAT_FILTER_ACTION_TYPES:ae,CHAT_FILTER_TARGET_SCREEN:oe,CHAT_FILTER_TYPES:se,CHAT_GATED_REASON:le,CHAT_MUTED_TYPE:ce,CHAT_SEARCH_RESULT_TYPE:de,CHAT_TYPE:ue,CLICKABLE_EVENT:pe,CLIENT_GROUP_SIZE_BUCKET:fe,CLIENT_MESSAGE_SEND_STAGE:he,COLLECTION:_e,COMMERCE_ACTION:ge,COMMERCE_ENTRY_POINT:me,COMMERCE_PERF_ENTRY_POINT:ye,COMMERCE_PERF_MARKER:Ee,COMMERCE_PERF_VIEW:Se,CONNECTION_ORIGIN_TYPE:ve,CONNECTION_TYPE:Te,CONTACT_SEND_CHANNEL:be,CONTACT_US_EXIT_STATE:Ce,DEEP_LINK_ACTION:Ae,DEEP_LINK_OPEN_FROM:Pe,DEEP_LINK_TYPE:Me,DESTINATION:Oe,DEVICE_TYPE:Ie,DISAPPEARING_CHAT_INITIATOR_TYPE:we,DISAPPEARING_MODE_ENTRY_POINT_TYPE:Re,DOWNLOAD_ORIGIN_TYPE:De,DOWNLOAD_QUALITY_TYPE:Le,DSM_ERROR:Ne,E2E_CIPHERTEXT_TYPE:ke,E2E_DESTINATION:Ue,E2E_FAILURE_REASON:Ge,E2E_SENDER_TYPE:xe,E2EE_SIZE_BUCKET:Be,EDIT_PROFILE_ACTION:Fe,END_CALL_CONFIRMATION_TYPE:je,EPHEMERAL_SETTING_ENTRY_POINT_TYPE:Ye,ERROR_REASON:Ke,EXPIRY_REASON:We,FIELD_STATS_ROW_TYPE:He,FORCE_UPGRADE_USER_ACTION_TYPE:Ve,GA_STATUS:$e,GIF_SEARCH_PROVIDER:ze,GRAPHQL_CATALOG_ENDPOINT:qe,GRAPHQL_REQUEST_RESULT:Je,INCOMING_CALL_UI_ACTION_TYPE:Qe,INIT_BWE_SOURCE:Xe,INTERACTION_TYPE:Ze,LABEL_OPERATIONS:et,LABEL_TARGETS:tt,LOGIN_RESULT_TYPE:nt,MD_APP_STATE_KEY_ROTATION_REASON_CODE:rt,MD_BOOTSTRAP_HISTORY_PAYLOAD_TYPE:it,MD_BOOTSTRAP_PAYLOAD_TYPE:at,MD_BOOTSTRAP_SOURCE:ot,MD_BOOTSTRAP_STEP_RESULT:st,MD_FEATURE_CODE:lt,MD_LINK_DEVICE_COMPANION_STAGE:ct,MD_PUSHNAME_VALIDATION_STAGE_CODE:dt,MD_SYNCD_CRITICAL_EVENT_CODE:ut,MD_SYNCD_FATAL_ERROR_CODE:pt,MD_SYNCD_FATAL_ERROR_SOURCE:ft,MD_VALIDATION_CALLER_CHANNEL:ht,MD_VALIDATION_WEB_PLATFORM:_t,MEDIA_DOWNLOAD_MODE_TYPE:gt,MEDIA_DOWNLOAD_RESULT_TYPE:mt,MEDIA_PICKER_ORIGIN_TYPE:yt,MEDIA_TYPE:Et,MEDIA_UPLOAD_MODE_TYPE:St,MEDIA_UPLOAD_RESULT_TYPE:vt,MESSAGE_CHAT_TYPE:Tt,MESSAGE_SEND_RESULT_TYPE:bt,MESSAGE_TYPE:Ct,MISSING_PROTO_TYPE:At,MUTATION_COUNT_BUCKET:Pt,NETWORK_STACK_TYPE:Mt,NOTIFICATION_SETTING_TYPE:Ot,NS_MODE:It,OPTIMISTIC_FLAG_TYPE:wt,OTP_ENTRY_POINT:Rt,OVERALL_LAST_UPLOAD_RETRY_PHASE_TYPE:Dt,OVERALL_MEDIA_KEY_REUSE_TYPE:Lt,OWNER_TYPE:Nt,PEER_CALL_NETWORK_MEDIUM:kt,PHONE_NUM_HYPERLINK_ACTION_TYPE:Ut,PLACEHOLDER_ACTION:Gt,PLACEHOLDER_CHAT_TYPE:xt,PLACEHOLDER_TYPE:Bt,PLATFORM_TYPE:Ft,PRECISE_SIZE_BUCKET:jt,PREKEYS_FETCH_CONTEXT:Yt,PRIMARY_IDENTITY_MISSING_PROTO_TYPE:Kt,PRIVACY_SETTINGS_CONTACTS_BUCKETS:Wt,PRIVACY_SETTINGS_VALUE_TYPE:Ht,PROFILE_ENTRY_POINT:Vt,PROJECT_CODE:$t,PS_BUFFER_UPLOAD_RESULT:zt,PS_ID_ACTION:qt,PS_TEST_ENUM_FIELD:Jt,PS_TOKEN_NOT_READY_REASON:Qt,PS_UPLOAD_REASON:Xt,PSA_LINK_OPEN_RESULT:Zt,PTT_PLAYBACK_SPEED_TYPE:en,PTT_PLAYER_TYPE:tn,PTT_RESULT_TYPE:nn,PTT_SOURCE_TYPE:rn,PTT_STREAM_TYPE:an,PTT_TRIGGER_TYPE:on,QUERY_TYPE:sn,QUICK_REPLY_ACTION:ln,QUICK_REPLY_ENTRY_POINT:cn,QUICK_REPLY_ORIGIN:dn,QUICK_REPLY_TRANSCODE_RESULT:un,RADIO_TYPE:pn,REACTION_ACTION_TYPE:fn,REVOKE_TYPE:hn,ROOMS_ENTRY_POINT:_n,SENDER_TYPE:gn,SHOPS_MANAGEMENT_ACTION:mn,SIGN_CREDENTIAL_RESULT:yn,SIGNATURE_TYPE:En,SIZE_BUCKET:Sn,SRTP_LIBRARY_VERSION:vn,STATUS_ITEM_VIEW_RESULT:Tn,STATUS_REPLY_MESSAGE_TYPE:bn,STATUS_REPLY_RESULT:Cn,STATUS_ROW_SECTION:An,STICKER_SEND_MESSAGE_TYPE:Pn,STICKER_SEND_ORIGIN_TYPE:Mn,STRUCTURED_MESSAGE_CLASS:On,SW_AEC_TYPE:In,TEMPLATE_COMPONENT:wn,TRUST_SIGNAL_BUCKETS:Rn,TS_LOG_UPLOAD_RESULT:Dn,UI_ACTION_TYPE:Ln,UPLOAD_ORIGIN_TYPE:Nn,UPLOAD_SOURCE_TYPE:kn,UPNP_ADD_RESULT_CODE:Un,UPNP_REMOVE_RESULT_CODE:Gn,USER_NOTICE_ERROR_EVENT:xn,USER_NOTICE_EVENT:Bn,VIEW_BUSINESS_PROFILE_ACTION:Fn,VNAME_CERT_HEALTH_EVENT_TYPE:jn,VPX_LIB:Yn,WA_VOIP_HISTORY_SAVE_CALL_RECORD_CONDITION_CHECK_STATUS:Kn,WEBC_APPCACHE_STATUS_CODE:Wn,WEBC_ASSET_CACHE_TYPE_CODE:Hn,WEBC_CHAT_TYPE:Vn,WEBC_ENV_CODE:$n,WEBC_JOB_RESULT_TYPE_CODE:zn,WEBC_MEDIA_LOAD_RESULT_CODE:qn,WEBC_MEDIA_OPERATION_CODE:Jn,WEBC_MENU_ITEM_LABEL:Qn,WEBC_MENU_TYPE:Xn,WEBC_MESSAGE_QUERY_DIRECTION:Zn,WEBC_NAVIGATION_TYPE:er,WEBC_QPL_HEALTH_EVENT_TYPE:tr,WEBC_QUERY_TRIGGER_TYPE:nr,WEBC_RMR_REASON_CODE:rr,WEBC_SCENARIO_TYPE:ir,WEBC_STATUS_MEDIA_TYPE:ar,WEBC_STATUS_ROW_SECTION:or,WEBC_STICKER_MAKER_EVENT_NAME_TYPE:sr,WEBC_STREAM_MODE_CODE:lr,WEBC_WAP_REQUEST_DESTINATION_CODE:cr,WEBC_WAP_REQUEST_KIND_CODE:dr,WEBC_WEB_PLATFORM_TYPE:ur,WEBC_WINDOW_NAVIGATOR_WEBDRIVER_TYPE:pr,WEBSITE_SOURCE_TYPE:fr,WELCOME_MESSAGE_ACTION_TYPE:hr,WELCOME_MESSAGE_ERROR_TYPE:_r,XMPP_STATUS:gr,XOR_CIPHER_MODE:mr});t.default=Er},52211:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.WamEvent=t.TYPES=t.Metric=t.GlobalMetric=void 0,t.defineEvents=function(e){for(const n in e){var t;const r=e[n],i=r[2];let a=1;a=i[2];const o=null!==(t=r[3])&&void 0!==t?t:"regular",s=5===r.length?r[4]:-1;y({name:n,id:r[0],props:r[1],weight:a,wamChannel:o,privateStatsIdInt:s})}},t.defineGlobal=function(e){const t={};for(const n in e){const r=e[n],[i,a,o=["regular"]]=r,s=h.defineGlobal(n,i,a,o);t[n]={type:s.validator,set(e){this.commitOnSet&&o.includes("regular")&&c.Wam.set(s,e)}}}return new((0,l.defineTypeHash)("Global",t,E))},t.metrics=t.events=void 0;var i=r(n(22205)),a=r(n(11700)),o=r(n(63137)),s=r(n(45095)),l=(n(43840),n(36737)),c=n(77959);const d=Object.freeze({BOOLEAN:"boolean",INTEGER:"integer",NUMBER:"number",STRING:"string",TIMER:"timer"});function u(e){return"number"==typeof e&&e===Math.floor(e)}t.TYPES=d;class p{constructor(e,t,n){this.name=e,this.id=t,this.type=n,this.setValidator()}setValidator(){const e=this.type;if("object"==typeof e){const t=(0,o.default)(e);this.validator=e=>e in t}else e===d.INTEGER||e===d.TIMER?this.validator=u:this.validator=e}}t.Metric=p;class f extends p{constructor(e,t,n,r){super(e,t,n),this.channels=r}}t.GlobalMetric=f;const h=new class{constructor(){this._events={},this._globalMetrics=new Map}_key(e,t){return`${e}::${t}`}getEvent(e,t){const n=this._key(e,t);return(0,s.default)(this._events[n],n)}define(e,t,n,r){const i=this._key(e,t);return i in this._events||(this._events[i]=new p(t,n,r)),this._events[i]}defineGlobal(e,t,n,r){return this._globalMetrics.has(e)||this._globalMetrics.set(e,new f(e,t,n,r)),(0,s.default)(this._globalMetrics.get(e),e)}getGlobal(e){return(0,s.default)(this._globalMetrics.get(e),e)}};t.metrics=h;let _=1;class g extends l.TypeHash{constructor(){super(),this.instanceId=_++,this.eventTime=Date.now(),this.commitTime=void 0,this.startMarkers={}}commit(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return c.Wam.commit(this,e)}setTime(e){this.eventTime=e||Date.now()}setSequenceNumber(e){this.sequenceNumber=e}}t.WamEvent=g;const m={};function y(e){let{name:t,id:n,weight:r,props:o,wamChannel:s,privateStatsIdInt:c}=e;const u={id:n,weight:r,wamChannel:s,privateStatsIdInt:c},p={},f=[];for(const e in o){const n=o[e],r=h.define(t,e,n[0],n[1]);p[e]=r.validator,n[1]===d.TIMER&&f.push(e)}const _=(0,l.defineTypeHash)(t,p,g);f.forEach((e=>{u["mark"+(0,a.default)(e)]=function(t){var n,r;const{startMarkers:i,eventTime:a}=this;this[e]=Date.now()-(null!==(n=null===(r=i[e])||void 0===r?void 0:r.ts)&&void 0!==n?n:a),null==t||t.showInTimeline,this.startMark},u[`start${(0,a.default)(e)}`]=function(t){const n=Date.now();this.startMarkers[e]={ts:n},null==t||t.showInTimeline}})),(0,i.default)(_.prototype,u),m[t]=_}t.events=m;class E extends l.TypeHash{constructor(){super(...arguments),this.commitOnSet=!0}}},55843:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.logMessageCounts=function(e,t){e.webcMessageCount+=t.length;for(let n=0,r=t[n];n<t.length;++n,r=t[n])switch(r.type){case i.MSG_TYPE.CHAT:case i.MSG_TYPE.LOCATION:case i.MSG_TYPE.PAYMENT:case i.MSG_TYPE.VCARD:case i.MSG_TYPE.CIPHERTEXT:case i.MSG_TYPE.MULTI_VCARD:case i.MSG_TYPE.REVOKED:case i.MSG_TYPE.OVERSIZED:e.webcTextMessageCount+=1;break;case i.MSG_TYPE.IMAGE:case i.MSG_TYPE.PRODUCT:e.webcPhotoMessageCount+=1;break;case i.MSG_TYPE.VIDEO:e.webcVideoMessageCount+=1;break;case i.MSG_TYPE.AUDIO:e.webcAudioMessageCount+=1;break;case i.MSG_TYPE.PTT:e.webcPttMessageCount+=1;break;case i.MSG_TYPE.STICKER:e.webcStickerMessageCount+=1;break;case i.MSG_TYPE.DOCUMENT:e.webcDocumentMessageCount+=1;break;default:e.webcOtherMessageCount+=1}},t.newMessageQueryEvent=function(e){return new a.default.WebcMessageQuery({webcResponseBytes:0,webcMessageCount:0,webcTextMessageCount:0,webcVideoMessageCount:0,webcPhotoMessageCount:0,webcAudioMessageCount:0,webcPttMessageCount:0,webcStickerMessageCount:0,webcDocumentMessageCount:0,webcOtherMessageCount:0,webcMessageQueryTrigger:e})};var i=n(15461),a=r(n(11339))},57362:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return e<=33?a.SMALL:e<=65?a.MEDIUM:e<=129?a.LARGE:e<=257?a.EXTRA_LARGE:e<=513?a.XX_LARGE:e<=1001?a.XXX_LARGE:e<=1501?a.LT1500:e<=2001?a.LT2000:e<=2501?a.LT2500:e<=3001?a.LT3000:e<=3501?a.LT3500:e<=4001?a.LT4000:e<=4501?a.LT4500:e<=5001?a.LT5000:a.LARGEST_BUCKET};var i=r(n(11339));const{CLIENT_GROUP_SIZE_BUCKET:a}=i.default},16786:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return e<32?a.LT32:e<64?a.LT64:e<128?a.LT128:e<256?a.LT256:e<512?a.LT512:e<1e3?a.LT1000:e<1500?a.LT1500:e<2e3?a.LT2000:e<2500?a.LT2500:e<3e3?a.LT3000:e<3500?a.LT3500:e<4e3?a.LT4000:e<4500?a.LT4500:e<5e3?a.LT5000:a.LARGEST_BUCKET};var i=r(n(11339));const{SIZE_BUCKET:a}=i.default},97480:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.OfflineResumeReporter=void 0;var i=n(92844),a=r(n(11339));const o=new class{constructor(){this.isInitialSync=!1,this.oldestStanzaTs=0,this.offlineResume=new a.default.OfflineResume,this.offlineResume.offlineMessageCount=0,this.offlineResume.offlineReceiptCount=0,this.offlineResume.offlineNotificationCount=0,this.offlineResume.offlineDecryptErrorCount=0,this.offlineResume.offlineSizeBytes=0,this.offlineResume.chatThreadCount=0,this.offlineResume.isOfflineCompleteMissed=!1}roundUp(e,t){return Math.round(e/t)*t}logOldestStanzaTime(e){null!=this.offlineResume&&(0===this.oldestStanzaTs||this.oldestStanzaTs>e)&&(this.oldestStanzaTs=e)}countDays(){if(null==this.offlineResume||0===this.oldestStanzaTs)return 0;const e=(0,i.unixTime)()-this.oldestStanzaTs;return Math.round(e/i.DAY_SECONDS)}logOfflineCount(e){this.offlineResume&&(this.offlineResume.offlineMessageCount+=e.message,this.offlineResume.offlineReceiptCount+=e.receipt,this.offlineResume.offlineNotificationCount+=e.notification)}logOfflineDecryptionErrorCount(e){this.offlineResume&&(this.offlineResume.offlineDecryptErrorCount=e)}logAddOfflineSizeBytes(e){this.offlineResume&&(this.offlineResume.offlineSizeBytes+=e)}logOfflineChatThreadCount(e){const t=this.roundUp(e,10);this.offlineResume&&(this.offlineResume.chatThreadCount=t)}_logPerformanceT(e){const t=Math.floor(performance.now());null!=this.offlineResume&&(this.offlineResume[e]=t)}logLastStanzaT(){this._logPerformanceT("lastStanzaT")}logMainScreenLoadT(){this._logPerformanceT("mainScreenLoadT")}logOfflinePreviewT(){this._logPerformanceT("offlinePreviewT")}logPageLoadT(){this._logPerformanceT("pageLoadT"),window.document&&this.offlineResume&&(this.offlineResume.isResumeInForeground=!document.hidden,document.addEventListener("visibilitychange",this.logResumeInBackground))}logSocketConnectT(){this._logPerformanceT("socketConnectT")}logMissedOfflineComplete(){this.offlineResume&&(this.offlineResume.isOfflineCompleteMissed=!0)}setIsInitialSync(){this.isInitialSync=!0}logResumeInBackground(){this.offlineResume&&document.hidden&&(this.offlineResume.isResumeInForeground=!1)}commit(){const e=this.offlineResume;e&&(e.offlineSizeBytes=this.roundUp(e.offlineSizeBytes,1e3),e.offlineMessageCount=this.roundUp(e.offlineMessageCount,10),e.offlineReceiptCount=this.roundUp(e.offlineReceiptCount,10),e.offlineNotificationCount=this.roundUp(e.offlineNotificationCount,10),e.mailboxAge=this.countDays(),__LOG__(2)`======== offline resume perf ========
message: ${e.offlineMessageCount}
receipt: ${e.offlineReceiptCount}
notification: ${e.offlineNotificationCount}
chatThreadCount: ${e.chatThreadCount}
offlineSizeBytes: ${e.offlineSizeBytes}
decryptError: ${e.offlineDecryptErrorCount}
lastStanzaT: ${e.lastStanzaT}
pageLoadT: ${e.pageLoadT}
connectionT: ${e.socketConnectT}
offlinePreviewT: ${e.offlinePreviewT}
screenLoadT: ${e.mainScreenLoadT}
isResumeInForeground: ${e.isResumeInForeground}
mailboxAge: ${e.mailboxAge}
======================================`,this.isInitialSync||e.commit(),this.offlineResume=null,window.document&&document.removeEventListener("visibilitychange",this.logResumeInBackground))}};t.OfflineResumeReporter=o},71119:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.mainScriptTimer=t.initialScreenTimer=t.exeTimer=t.PageLoad=void 0,t.onInitialRenderComplete=function(){f()},t.saveInitialPanelMountTime=function(e){d=e},t.setInitialScreen=function(e){if(null==u)return;u.set({webcInitialPanel:e})},t.streamInfoChange=function(e,t,n){const r=Math.floor(window.performance.now());p[e]=r,n&&(p.socketSequence=t,h())};var i=r(n(45095)),a=r(n(11339)),o=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=c(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(43840)),s=r(n(34179)),l=n(77959);function c(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(c=function(e){return e?n:t})(e)}let d,u=new a.default.WebcPageLoad;const p={};let f,h;const _=new Promise((e=>f=e)),g=new Promise((e=>h=e));let m,y=!1;function E(e){return window.performance&&window.performance.timing&&window.performance.timing.navigationStart?e-window.performance.timing.navigationStart:null}function S(){u&&document.hidden&&(m=!1)}function v(){var e;if(!(null===(e=window.performance)||void 0===e?void 0:e.timing)||!window.performance.navigation)return void __LOG__(2)`MetricReporter:logPageLoad metrics not provided by browser!`;if(!u)return;const t=u,n=window.performance.timing,r=window.performance.navigation,i=n.navigationStart,a=n.loadEventEnd-i;if(a<=0)return __LOG__(2)`MetricReporter:logPageLoad delayed`,void setTimeout(v,1e4);function o(e){const t=n[e];return t&&E(t)}t.set({webcPageLoadT:a,webcUnloadEventStart:o("unloadEventStart"),webcUnloadEventEnd:o("unloadEventEnd"),webcRedirectStart:o("redirectStart"),webcRedirectEnd:o("redirectEnd"),webcFetchStart:o("fetchStart"),webcDomainLookupStart:o("domainLookupStart"),webcDomainLookupEnd:o("domainLookupEnd"),webcConnectStart:o("connectStart"),webcConnectEnd:o("connectEnd"),webcSecureConnectionStart:o("secureConnectionStart"),webcRequestStart:o("requestStart"),webcResponseStart:o("responseStart"),webcResponseEnd:o("responseEnd"),webcDomLoading:o("domLoading"),webcDomInteractive:o("domInteractive"),webcDomContentLoadedEventStart:o("domContentLoadedEventStart"),webcDomContentLoadedEventEnd:o("domContentLoadedEventEnd"),webcDomComplete:o("domComplete"),webcLoadEventStart:o("loadEventStart"),webcLoadEventEnd:o("loadEventEnd"),webcCached:n.fetchStart===n.domainLookupEnd,webcNavigation:r.type,webcRedirectCount:r.redirectCount,webcWsOpening:p.OPENING,webcWsPairing:p.PAIRING,webcWsSyncing:p.SYNCING,webcWsNormal:p.NORMAL,webcWsAttempts:p.socketSequence,webcQrCode:!p.SYNCING,webcInitialPanelMountT:d-i,webcLoadInForeground:m}),t.commit(),window.document&&document.removeEventListener("visibilitychange",S),u=null}window.document&&(m=!document.hidden,document.addEventListener("visibilitychange",S)),Promise.all([_,g]).then((()=>{v(),(0,s.default)(),y||(y=!0,l.Wam.resumeJobs())}));class T{constructor(e){this._hasStarted=!1,this._label=e.label,this._startProperty=e.startProperty,this._endProperty=e.endProperty}start(){this._hasStarted=!0,null!=u&&(u.set({[this._startProperty]:E(Date.now())}),this._measure=o.startMeasure(this._label))}end(){null!=u&&(u.set({[this._endProperty]:E(Date.now())}),(0,i.default)(this._measure,"this._measure").end())}hasStarted(){return this._hasStarted}}const b=new T({label:"PageLoad.webcExe",startProperty:"webcExeStart",endProperty:"webcExeDone"});t.exeTimer=b;const C=new T({label:"PageLoad.webcMainScript",startProperty:"webcMainScriptStart",endProperty:"webcMainScriptEnd"});t.mainScriptTimer=C;const A=new T({label:"PageLoad.webcInitialPanelRender",startProperty:"webcInitialPanelMountStartT",endProperty:"webcInitialPanelRenderT"});t.initialScreenTimer=A;const P=(0,i.default)(u,"_PageLoad");t.PageLoad=P},43840:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.formatMeasureLabel=function(e){return` ${e}`},t.startMeasure=function(e){return r};const r={end(){}};(null===(n=performance)||void 0===n?void 0:n.mark)&&performance.measure,new Map},16860:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.postPrekeysDepletionMetric=function(e){let{count:t,prekeysFetchReason:r,messageType:a,chatId:o}=e;if(null==t||0===t)return;const s={};null!=r&&(s.prekeysFetchReason=r);null!=a&&(s.messageType=a);if(null!=o&&o.isGroup()){const e=n(63928).default.get(o);null!=(null==e?void 0:e.cachedDeviceSizeBucket)&&(s.deviceSizeBucket=e.cachedDeviceSizeBucket)}setTimeout((()=>{for(let e=0;e<t;e++)new i.default.PrekeysDepletion(s).commit()}),0)};var i=r(n(11339))},99039:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.postSenderKeyExpiredMetric=function(e){let{chatId:t,expiryReason:n,deviceCount:r}=e;const s=new a.default.SenderKeyExpired;null!=n&&(s.expiryReason=n);if(null!=t){const e=(0,i.createWidFromWidLike)(t);e.isGroup()?s.chatType=a.default.MESSAGE_CHAT_TYPE.GROUP:e.isBroadcast()?s.chatType=a.default.MESSAGE_CHAT_TYPE.BROADCAST:e.isUser()&&(s.chatType=a.default.MESSAGE_CHAT_TYPE.INDIVIDUAL)}null!=r&&r>0&&(s.deviceSizeBucket=(0,o.default)(r));s.commit()};var i=n(45454),a=r(n(11339)),o=r(n(16786))},29590:(e,t,n)=>{"use strict";var r=n(95318);t.Z=void 0;var i=r(n(48926)),a=n(87614),o=n(57319),s=n(92844),l=r(n(26372)),c=n(15772);const d=10*s.MINUTE_MILLISECONDS;function u(){return(u=(0,i.default)((function*(){const e=[];(yield l.default.getPsMeta()).map((t=>{null!=t.lastRotationTimeUtc&&e.push(t.key)})),yield l.default.removePsMeta(e)}))).apply(this,arguments)}t.Z=class{constructor(e){this.metric=e,this.psIdKeyBySchemaKeyHashInt={},this.psIdSchemaKeyHashIntById={},this.psIdInfoByKey={},e.PrivateStatsAllIds.map((e=>{this.psIdKeyBySchemaKeyHashInt[e.keyHashInt]=e.key,this.psIdSchemaKeyHashIntById[e.key]=e.keyHashInt,this.psIdInfoByKey[e.key]={value:e.keyHashInt,rotationPeriodDays:e.rotationPeriodDays}})),this.psIdKeyBySchemaKeyHashInt[0]="none",this.psIdSchemaKeyHashIntById.none=0,this.psIdInfoByKey.none={value:"none",rotationPeriodDays:-1},this.resolvesOnInit=this.initialize().then((()=>{this.resolvesOnInit=null})),this.rotatePsIdJob=new o.ShiftTimer((()=>{this.rotatePsIds()})),this.rotatePsIdJob.onOrBefore(d)}initialize(){var e=this;return(0,i.default)((function*(){yield function(){return u.apply(this,arguments)}();const t=[],n=yield l.default.getPsMeta(),r=new Set;n.map((n=>{r.add(n.key),void 0===e.psIdInfoByKey[n.key]?t.push(n.key):e.psIdInfoByKey[n.key].value=n.value}));const i=Object.keys(e.psIdInfoByKey).filter((e=>!r.has(e))).map((t=>("none"!==t&&(e.psIdInfoByKey[t].value=(0,a.randomHex)(16)),{key:t,value:e.psIdInfoByKey[t].value,rotateInDays:e.psIdInfoByKey[t].rotationPeriodDays,creationTs:(0,s.unixTime)()})));yield l.default.addPsMeta(i),yield l.default.removePsMeta(t),i.map((t=>(0,c.logPsIdUpdate)(e.metric.PS_ID_ACTION.CREATED,e.psIdSchemaKeyHashIntById[t.key],t.rotateInDays))),t.map((t=>(0,c.logPsIdUpdate)(e.metric.PS_ID_ACTION.DELETED,e.psIdSchemaKeyHashIntById[t],e.psIdInfoByKey[t].rotationPeriodDays)))}))()}rotatePsIds(){var e=this;return(0,i.default)((function*(){try{const t=yield l.default.getPsMeta(),n=[],r=(e,t)=>{if(-1===t||null==e)return!1;const n=t*s.DAY_SECONDS;return e<Math.floor((0,s.unixTime)()/n)*n};t.map((e=>{const{key:t,rotateInDays:i,creationTs:a}=e;r(a,i)&&n.push(t)})),n.length>0&&(yield(0,c.forceFlushAllWamBuffers)(),yield Promise.all(n.map(function(){var t=(0,i.default)((function*(t){const n=(0,a.randomHex)(16);e.psIdInfoByKey[t].value=n,yield l.default.updatePsMeta({key:t,rotateInDays:e.psIdInfoByKey[t].rotationPeriodDays,value:n,creationTs:(0,s.unixTime)()}),(0,c.logPsIdUpdate)(e.metric.PS_ID_ACTION.ROTATED,e.psIdSchemaKeyHashIntById[t],e.psIdInfoByKey[t].rotationPeriodDays)}));return function(){return t.apply(this,arguments)}}())))}catch(e){__LOG__(3)`error while rotating PS ids ${e}`}finally{e.rotatePsIdJob.onOrBefore(d)}}))()}getPrivateStatsKeyFromInt(e){return this.psIdKeyBySchemaKeyHashInt[e]}getLatestPrivateStatsIdValueFromKey(e){if("regular"===e)throw new Error("tried to get psId for regular channel event");return this.psIdInfoByKey[e].value}}},7595:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.logDailyPrivateStatsTestEvents=function(){if((0,i.isLegacyWebdBackend)())return;new o.default.TestAnonymousDaily({}).commit(),(0,a.getABPropConfigValue)("web_ps_v3_enabled")&&(new o.default.TestAnonymousWeeklyId({}).commit(),new o.default.TestAnonymousIdLess({}).commit())},t.logUiActionShadowPrivateStatsTestEvents=function(){if((0,i.isLegacyWebdBackend)())return;(0,a.getABPropConfigValue)("web_ps_v3_enabled")&&(new o.default.TestAnonymousDailyId({}).commit(),new o.default.TestAnonymousMonthlyId({}).commit())};var i=n(88555),a=n(57849),o=r(n(11339))},14528:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=new class{constructor(){this._resetNextSet=!1,this._value=0}get(){return this._value}_checkReset(){this._resetNextSet&&(this._resetNextSet=!1,this._value=0,this.initialDisplayDate=null)}inc(){return this._checkReset(),this.set(this._value+1)}set(e){if(this._checkReset(),this._value!==e)return 1===e&&(this.initialDisplayDate=Math.floor(window.performance.now())),this._value=e,this.get()}reset(){this._resetNextSet=!0}};t.default=n},34179:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){var e;if(!(null===(e=window.performance)||void 0===e?void 0:e.timing)||!window.performance.getEntriesByType)return void __LOG__(2)`MetricReporter:logResourceLoads metrics not provided by browser!`;const t=window.performance.timing.fetchStart===window.performance.timing.domainLookupEnd,n=window.performance.getEntriesByType("resource"),r=document.createElement("a");n.forEach((function(e){"xmlhttprequest"!==e.initiatorType&&(r.href=e.name,new i.default.WebcResourceLoad({webcResourceName:r.pathname+r.search+r.hash,webcResourceDuration:Math.round(e.duration),webcResourceCached:t}).commit())}))};var i=r(n(11339))},36737:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TypeHash=void 0,t.defineTypeHash=function(e,t,i){const a={$className:{value:e}};for(const i in t){let o=t[i];if("string"!=typeof o&&"function"!=typeof o||(o={type:o}),!o||"object"!=typeof o)throw new Error(`${e} specified with non-object ${o}`);a[i]={enumerable:!0,get:n(i),set:r(i,o)}}class o extends i{constructor(e){super(),this.all={},e&&this.set(e)}}return Object.defineProperties(o.prototype,a),o};function n(e){return function(){return this.all[e]}}function r(e,t){const n=t.type,r=t.set;return function(t){if(t!==this.all[e]){if(null==t);else if("function"==typeof n){if(!n(t))throw __LOG__(2)`type-validator fails ${t}`,new TypeError(`${this.$className}.${e} type-validator failed`)}else if(typeof t!==n)throw new TypeError(`${this.$className}.${e} requires type ${n}, got ${t}`);r&&r.call(this,t),this.all[e]=t}}}t.TypeHash=class{set(e){for(const t in e)this[t]=e[t]}}},77959:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.Wam=void 0,t.injectWamDependencies=function(e){h=e.Browser,_=e.Crashlog,g=e.Metric,E=e.UserPrefs,v=e.WamStorage,m=e.isUserLoggedIn,y=e.uploadStats,S=e.WamContext,M=g.PrivateStatsAllIds.map((e=>e.key)),T=new e.PsIdStore(g),e.CoreWamStorageAdaptor.startWamStore(),b=e.uploadPrivateStats,C=e.setWamBufferSizeUnsafeTestOnly,A=e.setPendingDelayUnsafeTestOnly,(0,u.isConnectedToPage)()&&n(7902);P=new d.ShiftTimer((()=>{!function(){J.apply(this,arguments)}()}));for(;O.length;){O.pop()()}I=!0};var i=r(n(48926)),a=r(n(66604)),o=r(n(63105)),s=r(n(35161)),l=r(n(45095)),c=n(88156),d=n(57319),u=n(41796),p=n(42448),f=n(55021);let h,_,g,m,y,E,S,v,T,b,C,A,P,M=[];const O=[];let I=!1;const w="1";let R=5e4;const D={};let L=0,N=[],k=!1,U=1e4,G=!1,x=null,B=0,F=new c.Resolvable,j=!1,Y=!1;function K(e,t){e.commitTime=null!=t?t:ce(),e.sequenceNumber=B++}function W(){return g.APP_BUILD_TYPE.RELEASE}function H(e){if(x&&!e)return;const t=h.info();x={appVersion:"2.2210.9",appBuild:W(),platform:g.PLATFORM_TYPE.WEBCLIENT,appIsBetaRelease:W()===g.APP_BUILD_TYPE.BETA,browser:t.name||null,browserVersion:t.ua||null,deviceName:t.os||null,deviceVersion:t.version||null,webcEnv:g.WEBC_ENV_CODE.PROD,webcTabId:E.THIS_TAB,webcWebPlatform:g.WEBC_WEB_PLATFORM_TYPE[p.WAM_PLATFORM]},e&&Object.assign(x,e),g.Global.commitOnSet=!1,g.Global.set(x),g.Global.commitOnSet=!0}function V(){return(V=(0,i.default)((function*(){(0,f.resetWamProtocolVersion)(5),yield Promise.all(Object.keys(D).map(function(){var e=(0,i.default)((function*(e){var t;const n=null===(t=D[e])||void 0===t?void 0:t.unsavedPortion;if(n)try{const e=yield v.getNextSequenceNumberForStream(w);n.upgradeWamHeaderFromV3ToV5(e)}catch(e){}}));return function(){return e.apply(this,arguments)}}()))}))).apply(this,arguments)}function $(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return N.push(e),k?t?(j=!1,Y=!0,setTimeout((()=>P.forceRunNow()),1)):P.onOrBefore(U):t&&(P.cancel(),j=!0,Y=!1),F.promise}function z(){k=!1,P.cancel();const e=F;return F=new c.Resolvable,e}function q(){k=!0,Y=!1,N.length>0&&P.onOrBefore(U),j&&(j=!1,Y=!0,P.forceRunNow())}function J(){return(J=(0,i.default)((function*(){const e=Y,t=z(),n=[...N];N=[];try{H(),yield T.resolvesOnInit||Promise.resolve(),yield Promise.all(["regular","none",...M].map((t=>ne(t,n,e))))}finally{t.resolve(),q()}}))).apply(this,arguments)}function Q(e){return"regular"===e?"regular":"private"}function X(){return Z.apply(this,arguments)}function Z(){return(Z=(0,i.default)((function*(e){return new S(e,yield v.getNextSequenceNumberForStream(w),T,x)}))).apply(this,arguments)}function ee(){return te.apply(this,arguments)}function te(){return(te=(0,i.default)((function*(e){var t;const n=null!==(t=D[e])&&void 0!==t?t:yield X(e);return D[e]=n,n}))).apply(this,arguments)}function ne(){return re.apply(this,arguments)}function re(){return(re=(0,i.default)((function*(e,t,n){const r=Q(e);if((0,f.getWamProtocolVersion)()<5&&"private"===r)return;let i;try{i=yield ee(e)}catch(e){return void __LOG__(3)`wam:_executePendingForContext failed to get context ${String((null==e?void 0:e.stack)?e.stack:e)}`}try{for(let n=0;n<t.length;n++){const a=t[n],[o,...s]=a;if(o){const t=s[0];("regular"===t.wamChannel&&t.wamChannel===r||"private"===t.wamChannel&&e===T.getPrivateStatsKeyFromInt(t.privateStatsIdInt))&&i.write(t)}else{const[e,t]=s;e.channels.includes(r)&&(x[e.name]=t,i.set(e.id,t))}}const a=ce();if(i.eventsWritten>0&&(n||i.size()>R||a>L+300||!G)){if(!m())return void(i.buffer.size()>R?D[e]=null:yield ie(e));yield oe(e)}else yield ie(e)}catch(t){__LOG__(3)`wam:_executePending error ${String((null==t?void 0:t.stack)?t.stack:t)}`,_.upload({reason:"wam-error"}),D[e]=null}}))).apply(this,arguments)}function ie(){return ae.apply(this,arguments)}function ae(){return(ae=(0,i.default)((function*(e){if(!D[e])return;const t=D[e].stringBuffer();if(!t)return;const n=(0,l.default)(D[e],"contexts[bufferKey]").unsavedPortion;if(n&&0===n.eventsWritten)return;const r=(0,l.default)(D[e],"contexts[bufferKey]").saveKey;try{if(n){const n=yield v.update(r,e,t);if(!D[e])return;n?(0,l.default)(D[e],"contexts[bufferKey]").unsavedPortion=yield X(e):(D[e]=D[e].unsavedPortion,yield ie(e))}else{if(yield v.add(r,e,t),!D[e])return;(0,l.default)(D[e],"contexts[bufferKey]").unsavedPortion=yield X(e)}}catch(e){__LOG__(3)`wam:save WamStorage failed to save ${String(e)}`}}))).apply(this,arguments)}function oe(){return se.apply(this,arguments)}function se(){return(se=(0,i.default)((function*(e){let t;try{t=yield v.deleteAll(e)}catch(e){t={},__LOG__(3)`wam:sendAllLogs failed to read because ${String(e)}`}const n=t;if(D[e]){D[e].unsavedPortion&&!(D[e].saveKey in n)&&(D[e]=D[e].unsavedPortion);const t=(0,l.default)(D[e],"contexts[bufferKey]").saveKey;n[t]=(0,l.default)(D[e],"contexts[bufferKey]").stringBuffer()}const r=yield Promise.all((0,s.default)(n,((t,n)=>le(t,n,Q(e))))),a=(0,o.default)(r);if(a.length!==r.length&&(L=ce(),G=!0),D[e]&&!a.includes(D[e].saveKey)&&(D[e]=null),0===a.length)return;const c=a.reduce((function(e,t){return e+n[t].length}),0);c<R?yield Promise.all((0,s.default)(a,function(){var t=(0,i.default)((function*(t){try{yield v.add(t,e,n[t])}catch(e){__LOG__(3)`sendAllLogs: adding to WamStorage failed`}}));return function(){return t.apply(this,arguments)}}())):(D[e]=null,__LOG__(3)`wam dropped ${a.length} buffers! (${c} bytes)`)}))).apply(this,arguments)}function le(e,t,n){return""===e||"["===e[0]?Promise.resolve():"private"===n?b(e,t):"regular"===n?y(e,t):Promise.resolve()}function ce(){return Math.floor(Date.now()/1e3)}const de=(0,a.default)({commit:function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return null!=e.commitTime&&0!==e.commitTime?(__LOG__(3)`wam:commit redundant commit! ${e.$className}`,Promise.resolve()):0!==e.weight&&Math.random()*e.weight>1?(e.commitTime=ce(),Promise.resolve()):(K(e),$([!0,e],t))},set:function(e,t){return $([!1,e,t])},resumeJobs:q,initialize:H,upgradeWamRuntime:function(){return V.apply(this,arguments)}},(function(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];if(I)return e(...n);O.push((()=>{e(...n)}))}}));t.Wam=de},75838:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.closeWamStore=function(){(0,l.closeWamStorage)()},t.privateStatsKillSwitchGetBlockedToken=p,t.privateStatsKillSwitchSet=f,t.savePrivateStatsToken=u,t.startWamStore=function(){(0,l.startWamStorage)(h)};var i=r(n(81109)),a=r(n(48926)),o=n(40265),s=n(92844),l=n(11562),c=n(99234),d=r(n(26372));function u(e){return d.default.savePsToken({key:"token",token:e,creationTs:(0,s.unixTime)(),redeemCount:1})}function p(){return Promise.resolve((0,c.getPsKillSwitchToken)())}function f(e){return(0,c.setPsKillSwitchToken)(e),Promise.resolve()}const h={getStreamId:()=>1,saveBuffer:()=>Promise.reject(new o.UnimplementedMethod("saveBuffer not implemented yet")),finishBuffer:()=>Promise.reject(new o.UnimplementedMethod("finishBuffer not implemented yet")),getStartingSequenceRow:()=>Promise.reject(new o.UnimplementedMethod("getStartingSequenceRow not implemented yet")),getBuffers:()=>Promise.reject(new o.UnimplementedMethod("getBuffers not implemented yet")),removeBufferByKey:()=>Promise.resolve(),nukeMetrics:()=>Promise.reject(new o.UnimplementedMethod("nukeMetrics not implemented yet")),updatePrivateStatsIds:()=>Promise.reject(new o.UnimplementedMethod("updatePrivateStatsIds not implemented yet")),redeemPrivateStatsToken:function(){var e=(0,a.default)((function*(e){const t=yield d.default.getPsToken();return t?e({redeemCount:t.redeemCount,creationTs:t.creationTs},{maxExpirySeconds:86400})?d.default.savePsToken((0,i.default)((0,i.default)({},t),{},{redeemCount:t.redeemCount+1})).then((()=>t.token)):Promise.resolve(null):null}));return function(){return e.apply(this,arguments)}}(),savePrivateStatsToken:u,privateStatsKillSwitchGetBlockedToken:p,privateStatsKillSwitchSet:f}},42448:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WAM_PLATFORM=void 0;t.WAM_PLATFORM="WEB"},55021:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getWamProtocolVersion=function(){return n},t.resetWamProtocolVersion=function(e){n=e};let n=3},26372:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(48926)),a=r(n(11554));t.default=class{static add(e,t,n){return(0,i.default)((function*(){return(yield a.default.idb()).wam.add({key:e,buffer:n,channel:t},e).catch((e=>{__LOG__(2)`add failed: ${e}\n${null==e?void 0:e.stack}`}))}))()}static update(e,t,n){return(0,i.default)((function*(){let r=0;try{r=yield a.default.idb().then((r=>r.wam.update(e,{key:e,buffer:n,channel:t})))}catch(e){__LOG__(2)`update failed: ${e}\n${null==e?void 0:e.stack}`}return 0!==r}))()}static deleteAll(e){return(0,i.default)((function*(){const t={};try{yield a.default.idb().then((n=>n.wam.where("channel").equals(e).modify((function(e){t[e.key]=e.buffer,delete this.value}))))}catch(e){__LOG__(2)`deleteAll failed: ${e}\n${null==e?void 0:e.stack}`}return t}))()}static getNextSequenceNumberForStream(e){return(0,i.default)((function*(){let t=-1;try{const n=yield a.default.idb();yield n.transaction("rw",["wam_meta"],(0,i.default)((function*(){0===(yield n.wam_meta.where("streamId").equals(e).count())?(yield n.wam_meta.add({streamId:e,seqNum:1}),t=1):yield n.wam_meta.where("streamId").equals(e).modify((function(e){return t=e.seqNum+1,t>=65536&&(t=1),e.seqNum=t,e}))})))}catch(e){__LOG__(2)`getNextSequenceNumberForStream failed: ${e}\n${null==e?void 0:e.stack}`}if(-1===t)throw new Error(`could not get seq number for streamId ${e}`);return t}))()}static removePsMeta(e){return a.default.idb().then((t=>t.ps_meta.bulkDelete(e))).catch((e=>{__LOG__(2)`removePsMeta failed: ${e}\n${null==e?void 0:e.stack}`}))}static getPsMeta(){return a.default.idb().then((e=>e.ps_meta.toArray())).catch((e=>(__LOG__(2)`getPsMeta failed: ${e}\n${null==e?void 0:e.stack}`,[])))}static addPsMeta(e){return a.default.idb().then((t=>t.ps_meta.bulkPut(e))).catch((e=>{__LOG__(2)`addPsMeta failed: ${e}\n${null==e?void 0:e.stack}`}))}static updatePsMeta(e){return a.default.idb().then((t=>t.ps_meta.update(e.key,e))).catch((e=>{__LOG__(2)`updatePsMeta failed: ${e}\n${null==e?void 0:e.stack}`}))}static getPsToken(){return a.default.idb().then((e=>e.ps_tokens.get("token"))).catch((e=>{__LOG__(2)`getPsToken failed: ${e}\n${null==e?void 0:e.stack}`}))}static savePsToken(e){return a.default.idb().then((t=>t.transaction("rw",["ps_tokens"],(()=>t.ps_tokens.put(e))))).catch((e=>{__LOG__(2)`savePsToken failed: ${e}\n${null==e?void 0:e.stack}`}))}}},15772:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.forceFlushAllWamBuffers=function(){return(new i.default.WebWamForceFlush).commit(!0)},t.logPsIdUpdate=function(e,t,n){new i.default.PsIdUpdate({psIdAction:e,psIdKey:t,psIdRotationFrequence:n}).commit()};var i=r(n(11339))},15078:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(11339));var a=new class{constructor(){this._events=new Map}logSend(e){const t=e.tag;if(t)try{const n=e.getName(),r=n.startsWith("query")?i.default.WEBC_WAP_REQUEST_KIND_CODE.GET:i.default.WEBC_WAP_REQUEST_KIND_CODE.SET,a=e.isToPhone?i.default.WEBC_WAP_REQUEST_DESTINATION_CODE.PHONE:i.default.WEBC_WAP_REQUEST_DESTINATION_CODE.SERVER,o=e.data.byteLength||JSON.stringify(e.data).length;this._createEvent(t,{kind:r,destination:a,name:n,size:o})}catch(e){__LOG__(3)`WAPReporter: fail to log send`}}logBasicSend(e,t){if(e)try{const n=i.default.WEBC_WAP_REQUEST_KIND_CODE.GET,r=i.default.WEBC_WAP_REQUEST_DESTINATION_CODE.SERVER,a=t[1].toLowerCase(),o=JSON.stringify(t).length;this._createEvent(e,{kind:n,destination:r,name:a,size:o})}catch(e){__LOG__(3)`WAPReporter: fail to log basic send`}}logAck(e){if(!e)return;const t=this._events.get(e);t&&t.markWebcWapRequestAckT({showInTimeline:!1})}logRecv(e,t,n){if(!e)return;const r=this._events.get(e);r&&(r.webcWapRequestResponseSize=t,null!=n&&(r.webcWapRequestStatus=n),r.markWebcWapRequestRecvT({showInTimeline:!1}),r.commit(),this._events.delete(e))}delete(e){e&&this._events.delete(e)}clear(){this._events.clear()}_createEvent(e,t){const n=new i.default.WebcWapRequest({webcWapRequestKind:t.kind,webcWapRequestDestination:t.destination,webcWapRequestName:t.name,webcWapRequestSize:t.size});this._events.set(e,n)}};t.default=a},81663:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.chatJidToChatWid=function(e){return(0,i.toChatWid)((0,i.createWid)(e))},t.deviceJidToDeviceWid=function(e){return(0,i.createDeviceWid)(e)},t.deviceJidToUserWid=function(e){return(0,i.toUserWid)((0,i.createWid)(e))},t.groupJidToWid=function(e){return(0,i.createWid)(e)},t.jidWithTypeToWid=function(e){const t=(0,r.extractJidFromJidWithType)(e);return(0,i.createWid)(t)},t.userJidToUserWid=function(e){return(0,i.createUserWid)(e)};var r=n(72441),i=n(45454)},89867:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(52230),i=n(51737);const a=/(?:^([^.:@]+))(?:\.([0-9]{1,2}))?(?:\:([0-9]{1,2}))?@(s\.whatsapp\.net|c\.us|g\.us|broadcast|call|b\.whatsapp\.net)$/i,o=/^([1-9][0-9]{0,14})(?:\.([0-9]{1,2}))?(?:\:([0-9]{1,2}))?@(lid)$/,s="16505361212@c.us",l=["name","short","notify"];class c{constructor(e,t){var n;let{intentionallyUsePrivateConstructor:r}=t;if(!r)throw new Error("You should use WidFactory.createWid() instead of the Wid constructor. If you absolutely must use the constructor, pass {intentionallyUsePrivateConstructor: true} as a second parameter.");const i=null!==(n=e.match(a))&&void 0!==n?n:e.match(o);if(null==i)throw new Error(`wid error: invalid wid: ${e}`);const s=[],l=i[1],c=i[2],d=i[3],u=i[4].toLowerCase();let p;switch(u){case"s.whatsapp.net":p="c.us";break;default:p=u}if(this.server=p,this.user=l,s.push(this.user),null!=c&&""!==c){if("c.us"!==this.server)throw new Error(`wid error: wrong server for wid with agent present: ${e}`);const t=parseInt(c,10);if(isNaN(t))throw new Error(`wid error: NaN agent: ${c} wid: ${e}`);if(t>255)throw new Error(`wid error: agent>255 : ${t} wid: ${e}`);t&&(s.push("."),s.push(t),this.agent=t)}if(d){if("c.us"!==this.server&&"lid"!==this.server)throw new Error(`wid error: wrong server for wid with device present: ${e}`);const t=parseInt(d,10);if(isNaN(t))throw new Error(`wid error: NaN device: ${d} wid: ${e}`);if(t>255)throw new Error(`wid error: device>255 : ${t} wid: ${e}`);t&&(s.push(":"),s.push(t),this.device=t)}s.push("@"),s.push(this.server),this._serialized=s.join("")}getUserPartForLog(){if(this.isGroup()){const e=this.user.split("-");if(2===e.length){const[t,n]=e;return`${t.slice(-4)}-${n}`}}return this.user.slice(-4)}toString(e){if(e){let t,n;const r=e.legacy&&"c.us"===this.server?"s.whatsapp.net":this.server;e.formatFull?(t=`.${this.agent||0}`,n=`:${this.device||0}`):(t=null!=this.agent&&0!==this.agent?`.${this.agent}`:"",n=null!=this.device&&0!==this.device?`:${this.device}`:"");const i=e.forLog?this.getUserPartForLog():this.user;if(e.formatFull||e.legacy&&"c.us"===this.server||e.forLog)return[i,t,n,"@",r].join("")}return this._serialized}toLogString(){return this.toString({forLog:!0,legacy:!1})}toJid(){return this.toString({legacy:!0})}getJidServer(){return"c.us"===this.server?r.WA_USER_JID_SUFFIX:this.server}getSignalAddress(){const e=null!=this.agent&&0!==this.agent?`_${this.agent}`:"",t=null!=this.device&&0!==this.device?`:${this.device}`:"",n=this.isLid()?"@lid":"";return[this.user,e,t,n].join("")}getDeviceId(){const e=this.device;return null==e?0:e}equals(e){return e instanceof c&&this.toString()===e.toString()}isLessThan(e){return e instanceof c&&this.toString()<e.toString()}isGreaterThan(e){return e instanceof c&&this.toString()>e.toString()}isCompanion(){return null!=this.device&&this.device!==r.DEFAULT_DEVICE_ID}isUser(){return"c.us"===this.server||"lid"===this.server}isLid(){return"lid"===this.server}isUserNotPSA(){return this.isUser()&&!this.isPSA()}isBroadcast(){return"broadcast"===this.server}isOfficialBizAccount(){return this.toString()===s}isGroup(){return"g.us"===this.server}isGroupCall(){return"call"===this.server}isServer(){return"server"===this.user.toLowerCase()&&"c.us"===this.server}isPSA(){return"0"===this.user&&"c.us"===this.server}isStatusV3(){return"status"===this.user.toLowerCase()&&"broadcast"===this.server}toJSON(){return this.toString()}static isXWid(e,t){return(0,i.isString)(t)?t.split("@")[1]===e:t instanceof c?t.server===e:(void 0!==t&&__LOG__(2)`wid:isXWid called on nonstring: + ${String(t)}`,!1)}static isUser(e){return c.isXWid("c.us",e)||c.isXWid("lid",e)}static isBroadcast(e){return c.isXWid("broadcast",e)}static isGroup(e){return c.isXWid("g.us",e)}static isGroupCall(e){return c.isXWid("call",e)}static isWid(e){return(0,i.isString)(e)?a.test(e)||o.test(e):e instanceof c}static canBeWid(e){return!e||!l.includes(e)}static isServer(e){return(0,i.isString)(e)?"server@c.us"===e.toLowerCase():e instanceof c&&e.isServer()}static isPSA(e){return(0,i.isString)(e)?"0@c.us"===e.toLowerCase():e instanceof c&&e.isPSA()}static isStatusV3(e){return(0,i.isString)(e)?e.toLowerCase()===r.STATUS_JID:e instanceof c&&e.isStatusV3()}static isOfficialBizAccount(e){return(0,i.isString)(e)?e.toLowerCase()===s:e instanceof c&&e.isOfficialBizAccount()}static user(e){return(0,i.isString)(e)?e.split("@")[0]:e instanceof c?e.user:void 0}static equals(e,t){return e instanceof c||t instanceof c?e instanceof c&&e.equals(t):e===t}static isLessThan(e,t){return e instanceof c&&t instanceof c&&e.toString()<t.toString()}static isGreaterThan(e,t){return e instanceof c&&t instanceof c&&e.toString()>t.toString()}}t.default=c},45454:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.createDeviceWid=l,t.createDeviceWidFromUserAndDevice=function(e,t){return l(`${e}:${t}@c.us`)},t.createUserWid=c,t.createWid=s,t.createWidFromWidLike=function(e){return s("string"==typeof e?e:e._serialized)},t.isWidlike=function(e){return!!e&&(!!a.default.isWid(e)||!(!e||"object"!=typeof e||!a.default.isWid(e._serialized)))},t.toChatWid=function(e){if(e.isUser())return d(e);return e},t.toUserWid=d;var i=n(51737),a=r(n(89867)),o=r(n(19037));function s(e){let t;return(null===o.default||void 0===o.default?void 0:o.default.cache)?(t=o.default.cache[e],t||(t=new a.default(e,{intentionallyUsePrivateConstructor:!0}),o.default.cache[e]=t)):t=new a.default(e,{intentionallyUsePrivateConstructor:!0}),t}function l(e){return s(e)}function c(e,t){let n;if(n=(0,i.isString)(e)&&(e.endsWith("@c.us")||e.endsWith("@s.whatsapp.net")||e.endsWith("@lid"))?e:`${e}@${t||"c.us"}`,n=s(n),!(null!=n.device&&0!==n.device||null!=n.agent&&0!==n.agent))return n;throw __LOG__(4,void 0,new Error)`createUserWid: ${e} is not a valid user jid`,new Error("createUserWid is called with invalid user string")}function d(e){if(!e.isUser())throw new Error("asUserWid: wid is not a user wid");return null!=e.device&&0!==e.device||null!=e.agent&&0!==e.agent?c(e.user,e.server):e}},62054:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(e){let t;if(e instanceof s.default?t=e.user:(0,o.isString)(e)&&(t=e.split("@")[0]),t){const e=t;return l.default.isRTL()?l.default.isolateLTR(c(e)):c(e)}}return""};var i=r(n(88306)),a=n(40277),o=n(51737),s=r(n(89867)),l=r(n(14296));const c=(0,i.default)((e=>"Server"===e?e:(0,a.formatPhone)(e)))},79196:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.widToDeviceJid=function(e){const t=i(e);if("phoneDevice"===t.jidType||"lidDevice"===t.jidType)return t.deviceJid;if("phoneUser"===t.jidType)return(0,r.defaultDeviceJidForUser)(t.userJid);if("lidUser"===t.jidType)return(0,r.defaultLidDeviceJidForLidUserJid)(t.userJid);throw __LOG__(4,void 0,new Error)`widToDeviceJid: "${e.toString()}" is not a DeviceJid`,new Error("widToDeviceJid: can not convert wid to DeviceJid")},t.widToJidWithType=i;var r=n(72441);function i(e){const t=e.toJid(),n=(0,r.interpretAndValidateJid)(t);if("unknown"===n.jidType)throw __LOG__(4,void 0,new Error)`widToJidWithType: "${t}" is not a valid jid`,new Error("widToJidWithType: unknown jid type");return n}},47685:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.validateWid=function(e){if(null==e)return!1;const t=e.match(/(.*)@(.*)/);if(null==t)return"call"===e||"s.whatsapp.net"===e;const n=t[1],i=r.cast(t[2]);if(null==i)return __LOG__(3)`Domain not supported`,!1;switch(i){case r.BROADCAST:return d.test(n);case r.CALL:return l.test(n);case r.G_US:return c.test(n);case r.C_US:case r.S_WHATSAPP_NET:return u.test(n);case r.LID:return p.test(n);case r.MSGR:return f.test(n)}return!1};const r=n(76672)({BROADCAST:"broadcast",CALL:"call",C_US:"c.us",G_US:"g.us",LID:"lid",MSGR:"msgr",S_WHATSAPP_NET:"s.whatsapp.net"}),i=/[0-9]{1,2}/,a=/0/,o=/[1-9][0-9]{0,19}/,s=/(?!10)[1-9][0-9]{4,19}/,l=/^[0-9a-f]{18,32}$/i,c=new RegExp(`^${s.source}[-]${/[1-9][0-9]{9}/.source}$|^${o.source}$`),d=new RegExp(`^${o.source}$|${["status","location"].map((e=>"^"+e+"$")).join("|")}`,"i"),u=new RegExp(`^0$|^${s.source}([.]${a.source})?([:]${i.source})?$`),p=new RegExp(`^${/[1-9][0-9]{0,14}/.source}([.]${a.source})?([:]${i.source})?$`),f=new RegExp(`^${o.source}([:]${/[1-9][0-9]{0,2}/.source})?$`)},94300:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.App=function(){return(0,Te.jsx)(De,{})},t.AppWrapper=void 0,t.hasPending=function(){return null!=Ae&&Ae.hasPending()},t.stopCommsBeforeUnload=function(){(0,I.stopComms)()};var i=r(n(48926)),a=r(n(51463)),o=r(n(45095)),s=n(38284),l=n(57319),c=r(n(85074)),d=n(88555),u=n(40234),p=(r(n(64369)),n(21310)),f=n(39948),h=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=be(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(77144)),_=n(26741),g=r(n(76139)),m=r(n(11554)),y=r(n(94184)),E=n(48360),S=r(n(41143)),v=r(n(30381)),T=n(67294),b=n(51650),C=r(n(6357)),A=(r(n(85954)),n(89721)),P=r(n(66034)),M=r(n(89248)),O=n(88102),I=n(24747),w=r(n(52665)),R=r(n(8623)),D=n(17239),L=n(40249),N=r(n(94049)),k=n(78359),U=n(24113),G=r(n(13259)),x=n(99234),B=n(7293),F=n(57701),j=n(29424),Y=r(n(70842)),K=r(n(14296)),W=n(84387),H=r(n(7260)),V=n(83578),$=n(46582),z=r(n(71443)),q=r(n(11339)),J=n(66776),Q=r(n(96753)),X=n(97480),Z=n(71119),ee=n(81093),te=n(48694),ne=n(77113),re=r(n(40626)),ie=r(n(22028)),ae=n(27838),oe=n(64551),se=r(n(31703)),le=r(n(57050)),ce=r(n(37538)),de=n(23283),ue=n(8080),pe=r(n(3137)),fe=n(97628),he=n(93373),_e=r(n(68481)),ge=n(18644),me=n(48440),ye=n(83023),Ee=r(n(9896)),Se=n(78123),ve=n(65044);n(38125);var Te=n(85893);function be(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(be=function(e){return e?n:t})(e)}ve.Socket.registerHandler((e=>{(0,$.requireHandleSocketMessage)().then((t=>t(e)))}));const Ce=n(76672).Mirrored(["CLIENT_EXPIRED_DIALOG","ANOTHER_SESSION","UNSUPPORTED_TAKEOVER","QR","SYNCING","OFFLINE","PROXYBLOCK","CONFLICT","TOS_BLOCK","SMB_TOS_BLOCK","DEPRECATED_VERSION","MAIN","STARTUP","TEMP_BAN","LOGOUT","PRIMARY_FORCE_UPGRADE"]);let Ae,Pe=!1,Me=!1;function Oe(e){"initialPanelMountTRecorded"===e&&(Pe=!0),"initialPanelRenderTRecorded"===e&&(Me=!0),Pe&&Me&&(0,Z.onInitialRenderComplete)()}const Ie=(0,a.default)((()=>{(0,Z.saveInitialPanelMountTime)(Date.now()),Oe("initialPanelMountTRecorded")}));function we(e){let{cmdAndData:t,isExternal:n,sessionId:r}=e;const{resultType:i,data:a}=t;return __LOG__(2)`main:execApiCmd:${i}`,(0,S.default)(null!=Ae,"Attempted to exec API command before main was loaded"),Ae.execApiCmd({cmd:i,untypedData:a,isExternal:n,sessionId:r})}class Re extends T.Component{constructor(){super(...arguments),this.contextMenuRef=(0,T.createRef)(),this.animate=!0,this.state={mode:ue.Stream.mode,updating:ue.Stream.clientExpired,hardExpired:ue.Stream.hardExpired,anotherSession:!1,takingOver:!1,isUnsupportedTakeover:!1,apiCmd:void 0,locale:K.default.getLocale(),mainLoaded:!1,socketProgressStep:0,theme:(0,fe.getTheme)(),systemThemeMode:(0,fe.getSystemThemeMode)(),isKeyboardUser:!1,initialLoadReady:!1,startLogout:!1,stayInSync:!ve.Socket.hasSynced,primaryForceUpgrade:te.PrimaryForceUpgrade.shouldForceUpgrade},this._unsetIsKeyboardUser=()=>{this.setState({isKeyboardUser:!1})},this._setIsKeyboardUser=()=>{this.setState({isKeyboardUser:!0})},this._handlers={up:this._setIsKeyboardUser,down:this._setIsKeyboardUser,left:this._setIsKeyboardUser,right:this._setIsKeyboardUser,home:this._setIsKeyboardUser,end:this._setIsKeyboardUser,"command+up":this._setIsKeyboardUser,"command+down":this._setIsKeyboardUser,pageUp:this._setIsKeyboardUser,pageDown:this._setIsKeyboardUser,tab:this._setIsKeyboardUser,"shift+tab":this._setIsKeyboardUser,"shift+?":this._setIsKeyboardUser},this._setWamSystemInfo=null,this._setModeScheduler=new l.ShiftTimer((e=>{e!==this.state.mode&&this.setState({mode:e})})),this._handleStreamModeChange=()=>{const e=ue.Stream.mode;this.state.mode!==ue.StreamMode.MAIN?this._setModeScheduler.onOrBefore(0,e):this._setModeScheduler.forceRunNow(e)},this._handleClientExpired=()=>{this.state.updating!==ue.Stream.clientExpired&&this.setState({updating:ue.Stream.clientExpired})},this._handleHardExpired=()=>{this.setState({hardExpired:ue.Stream.hardExpired})},this._handleMouseDown=e=>{0!==e.detail&&this._unsetIsKeyboardUser(),O.Cmd.windowMouseDown(e)},this._handleClick=e=>{O.Cmd.windowClick(e)},this._handleWindowClick=e=>{var t;const n=e.target;if(!n)return;if("A"!==n.nodeName)return;const r=n.getAttribute("href");if(!r)return;if(null===(t=n.dataset)||void 0===t?void 0:t.nohandle)return;const i=(0,ee.parseAPICmd)(r);if("INVALID"===i.resultType)return;const a=this._getDeeplinkSessionId();this._canExecApiCmd()&&we({cmdAndData:i,isExternal:!0,sessionId:a})&&((0,d.isMDBackend)()&&this._logDeepLinkClickMetric(i,a),e.preventDefault())},this._logDeepLinkClickMetric=(e,t)=>{if(e.resultType===b.APICmd.GROUP_INVITE)new q.default.DeepLinkClick({deepLinkHasPhoneNumber:!1,deepLinkHasText:!0}).commit();else if(e.resultType===b.APICmd.MSG_SEND){const n=e.data.phone,r=e.data.text;new q.default.DeepLinkClick({deepLinkHasPhoneNumber:!!n,deepLinkHasText:!!r,deepLinkSessionId:t}).commit()}else(e.resultType===b.APICmd.CATALOG||e.resultType===b.APICmd.PRODUCT)&&new q.default.DeepLinkClick({deepLinkHasPhoneNumber:!0,deepLinkHasText:!1}).commit()},this._handleSetTheme=e=>{if(this.state.theme!==e){for(const t of fe.THEME_ASSETS[e])A.AssetLoader.loadAsset(t,A.LOAD_PRIORITY.THEME_ASSET_LOAD,!1);if(oe.ServerProps.wallpapersV2){const e=P.default.get("defaultPreference");if(e&&Se.DEFAULT_CHAT_WALLPAPER!==e.wallpaperColor){const t=(0,Se.toggleWallpaperColor)(e.wallpaperColor,this.state.theme);e.set("wallpaperColor",t)}}(0,fe.setTheme)(e),this.setState({theme:e})}},this._handleSetSystemThemeMode=e=>{(0,fe.setSystemThemeMode)(e),this.setState({systemThemeMode:e})},this._mdReloadPageOnTakeOver=()=>{__LOG__(2)`[md takeover] refreshing page on takeover`,window.location.reload()},this._handleReadyForMainScreen=()=>{__LOG__(2)`DebouncedLoadingScreen: Ready for main screen`,this.setState({stayInSync:!1})},this._mdReloadPageWithUnsupportedTakeOver=()=>{__LOG__(2)`[unsupported takeover] refreshing page with unsupported takeover`,window.location.reload()},this._getThemeContextValue=(0,z.default)((e=>{let{theme:t,systemThemeMode:n}=e;return{theme:t,setTheme:this._handleSetTheme,systemThemeMode:n,setSystemThemeMode:this._handleSetSystemThemeMode}}))}componentDidMount(){!0===(0,x.mdOptedIn)()&&B.GK.setFeature(B.GK.F.MD_BACKEND,!0);const{theme:e}=this.state;(0,fe.applyThemeToUI)(e),ke().then((t=>{A.AssetLoader.setPlatform(t),A.AssetLoader.loadInitialAssets(fe.THEME_ASSETS[e])})),function(){return Le.apply(this,arguments)}().then(ne.loadProtoVersions).then((()=>{O.Cmd.mainLoaded(),this.setState({mainLoaded:!0})})).then((()=>Promise.all([(0,$.requireEmojiAssetMapCreator)(),(0,$.requireEmojiConfig)(),ke()]))).then((e=>{let[t,n,r]=e;A.AssetLoader.setPlatform(r),A.AssetLoader.initEmojiAsset(t(n)),k.emojiCompletionTracker.beginPreloadFallback()}));const{listeners:t}=this.props;t.add(O.Cmd,"increment_progress",(()=>{this._incProgress()})),t.add(O.Cmd,"initial_load_ready",(()=>{this.setState({initialLoadReady:!0})})),t.add(de.StorageCmd,"storage_not_enough_space",(()=>{O.Cmd.openModal((0,Te.jsx)(w.default,{onOK:()=>{ve.Socket.logout(!1,V.LogoutReason.StorageQuotaExceeded)},okText:E.fbt._("OK",null,{hk:"2KEeHb"}),children:E.fbt._("Your computer does not have enough space for WhatsApp to run. Please create more storage by deleting unused files from your computer, then log in again.",null,{hk:"3tBII8"})}))})),t.add(O.Cmd,"account_temporarily_banned",(e=>{this.setState({temporaryBan:e})})),t.add(O.Cmd,"starting_logout",(()=>{this.setState({startLogout:!0})})),t.add(te.PrimaryForceUpgrade,"change:shouldForceUpgrade",(()=>{const e=te.PrimaryForceUpgrade.shouldForceUpgrade;this.state.primaryForceUpgrade!==e&&this.setState({primaryForceUpgrade:e})})),(0,d.isMDBackend)()&&X.OfflineResumeReporter.logPageLoadT();{const e=n(72117).Z;t.add(window,"beforeunload",e.unloadMutex.bind(e)),t.add(window,"unload",e.unloadMutex.bind(e)),t.add(window,"storage",(t=>{e.storagePong(t)&&((0,d.isMDBackend)()&&(__LOG__(2)`[md takeover] tab taken over. stopping comms`,(0,I.stopComms)()),f.Logger.onTakeOver(),this.setState({takingOver:!1,anotherSession:!0}))}))}if(t.add(ue.Stream,"change:clientExpired",this._handleClientExpired),t.add(ue.Stream,"change:hardExpired",this._handleHardExpired),t.add(ue.Stream,"change:mode",this._handleStreamModeChange),g.default.canMuckHistory()){const e=(0,ee.parseAPICmd)(window.location.href);if(e.resultType!==b.APICmd.INVALID){const{url:t}=e.data;delete e.data.url,this._maybeExecApiCmd(e),window.history.replaceState({},"",t)}}var r;t.add(K.default,"locale_change",(e=>{let{loc:t}=e;__LOG__(2)`App:componentDidMount:rerenderUI locale change`,(0,x.setLangPref)(t),(0,d.isMDBackend)()&&u.Clock.setIs24HourBasedOnLocale(),this.animate=!1,this.setState({locale:`${K.default.getLocale()}#${v.default.locale()}`})})),this._registerYesterdayTimer(),__LOG__(2)`App:componentDidMount:visibilityState: ${document.visibilityState}`,"prerender"===document.visibilityState?(0,s.promiseTimeout)((0,Ee.default)(document,"visibilitychange"),5e3).then((()=>this._beginMutex(0))).catch((()=>this._beginMutex(0))):this._beginMutex(0),this.props.listeners.add(window,"click",this._handleWindowClick,{capture:!0}),this.props.listeners.add(window,"blur",(()=>{this._unsetIsKeyboardUser()})),me.updatePoll.poll(me.checkForUpdates),this._logFirstRenderMountTime(),document.createElement=(r=document.createElement.bind(document),function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("iframe"===e.toLowerCase()){__LOG__(3)`Modified a created iframe element to include sandbox attributes for security fix.`;const n=r(e,t);return n.sandbox=oe.ServerProps.webYouTubePlayerEnhancements||oe.ServerProps.webPipRedesign?"allow-scripts allow-same-origin allow-popups allow-popups-to-escape-sandbox":"allow-scripts allow-same-origin",n}return r(e,t)}),this.props.listeners.add(pe.default,"system_theme_change",(e=>{this.state.systemThemeMode&&this._handleSetTheme(e)}))}componentDidUpdate(e,t){!0===t.anotherSession&&!1===this.state.anotherSession?m.default.openDB().catch((e=>{__LOG__(3)`Failed to open indexeddb: ${e}`})):!1===t.anotherSession&&!0===this.state.anotherSession&&m.default.idb().then((e=>{e.close(),__LOG__(2)`db: closed due to take over`})).catch((()=>{})),this._maybeExecApiCmd(this.state.apiCmd),this.state.mode!==ue.StreamMode.MAIN&&(this.animate=!0),this._logFirstRenderMountTime()}componentWillUnmount(){this._setModeScheduler.cancel(),this._setWamSystemInfo&&this._setWamSystemInfo.cancel()}_beginMutex(e){var t=this;let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return(0,i.default)((function*(){if(_.UA.isLocalStorageBroken&&(0,d.isMDBackend)()){if(yield(0,ae.isAnotherTabActive)()){f.Logger.onTakeOver(),t.setState({isUnsupportedTakeover:!0});try{(0,I.stopComms)()}catch(e){}return}}(0,ae.setTabActive)(),r&&ye.Updater.shouldForceUpdateOnTakeOver()&&ye.Updater.restart();{const i=n(72117).Z,a=r?i.takeoverLocal(e):i.init(e),o=yield a.catch((e=>(t.setState({takingOver:!0}),t._beginMutex(e,!0))));f.Logger.isTakeOver=o,t.setState({takingOver:!1,anotherSession:o})}}))()}_incProgress(){this.setState({socketProgressStep:this.state.socketProgressStep+1})}_maybeExecApiCmd(e){if(e){if(this._canExecApiCmd()){return we({cmdAndData:e,isExternal:!0,sessionId:this._getDeeplinkSessionId()}),void(null!=this.state.apiCmd&&this.setState({apiCmd:null}))}e!==this.state.apiCmd&&this.setState({apiCmd:e})}}_canExecApiCmd(){return null!=Ae&&Ne(this.state)===Ce.MAIN}_logFirstRenderMountTime(){this.state.mode!==ue.StreamMode.SYNCING&&Ie()}_calculateProgress(){return 20*this.state.socketProgressStep}_registerYesterdayTimer(){c.default.setLocalTimeout((()=>{__LOG__(2)`App:registerYesterdayTimer:rerenderUI relative timestamps`,__LOG__(2)`Local Clock: ${Date.now()}, Skew: ${u.Clock.getSkew()}`,O.Cmd.midnight(),this._registerYesterdayTimer()}),(0,v.default)().endOf("day").valueOf())}_getTemporaryBanReason(e){const t=(0,x.getMaybeMeUser)().user;switch(e){case 101:return K.default.t(774,{phone:t});case 102:return E.fbt._("You're temporarily banned from WhatsApp because too many people blocked you.",null,{hk:"3HhQ7n"});case 103:return K.default.t(775,{phone:t});case 104:return E.fbt._("You're temporarily banned from WhatsApp because you sent the same message to too many people.",null,{hk:"2r9Adr"});case 106:return E.fbt._("You're temporarily banned from WhatsApp because you sent too many messages to a broadcast list.",null,{hk:"3QZzJ1"});default:return E.fbt._("You're temporarily banned from WhatsApp because you may have violated our terms of service.",null,{hk:"1d1rXh"})}}_getUiAndIconCount(){switch(Ne(this.state)){case Ce.CLIENT_EXPIRED_DIALOG:return{ui:(0,Te.jsx)(U.DefaultFavicon,{children:(0,Te.jsx)(M.default,{})}),requiresBackendCheck:!1};case Ce.ANOTHER_SESSION:{let e,t;return this.state.takingOver?(e=()=>{},t=K.default.t(357)):(e=()=>{(0,d.isMDBackend)()?this._mdReloadPageOnTakeOver():this._beginMutex(0,!0)},t=K.default.t(253)),{ui:(0,Te.jsx)(U.ErrorFavicon,{children:(0,Te.jsx)(R.default,{cancelText:E.fbt._("Close",null,{hk:"19Jpec"}),onCancel:window.open.bind(window,"https://www.whatsapp.com/","_self"),okText:t,onOK:e,children:K.default.t(1029)})}),requiresBackendCheck:!1}}case Ce.UNSUPPORTED_TAKEOVER:return{ui:(0,Te.jsx)(U.ErrorFavicon,{children:(0,Te.jsx)(R.default,{okText:E.fbt._("Refresh",null,{hk:"3gD6Jh"}),onOK:this._mdReloadPageWithUnsupportedTakeOver,children:E.fbt._("There is already another active WhatsApp Web tab in this browser. WhatsApp Web does not support multiple active tabs in this browser. Please use the existing tab or close it and refresh this tab.",null,{hk:"xnVvw"})})}),requiresBackendCheck:!1};case Ce.TEMP_BAN:const{code:e,expire:t}=this.state.temporaryBan||{},n=this._getTemporaryBanReason(e),r=v.default.duration(t,"seconds").humanize();return{ui:(0,Te.jsx)(U.ErrorFavicon,{children:(0,Te.jsxs)(R.default,{cancelText:K.default.t(596),onCancel:()=>{__LOG__(2)`Banned accounts: user selected logout`,ve.Socket.logout()},okText:E.fbt._("Learn more",null,{hk:"1L9NkE"}),onOK:window.open.bind(window,(0,p.getFaqUrl)()),children:[(0,Te.jsx)("div",{children:n}),(0,Te.jsx)("div",{children:K.default.t(773,{duration:r})})]})}),requiresBackendCheck:!0};case Ce.QR:return{ui:(0,Te.jsxs)(U.DefaultFavicon,{children:[(0,Te.jsx)(J.ModalManager,{type:J.ModalType},"modal-manager"),(0,Te.jsx)(ie.default,{apiCmd:this.state.apiCmd},"qr-code")]}),extraClasses:C.default.isQR,requiresBackendCheck:!0};case Ce.STARTUP:case Ce.SYNCING:if((0,d.isMDBackend)()){let e=(0,Te.jsx)(ce.default,{initialLoadReady:this.state.initialLoadReady,onReady:this._handleReadyForMainScreen});return{ui:(0,Te.jsx)(U.DefaultFavicon,{children:e}),requiresBackendCheck:!0}}return{ui:(0,Te.jsx)(U.DefaultFavicon,{children:(0,Te.jsx)(le.default,{progress:this._calculateProgress()})}),requiresBackendCheck:!0};case Ce.OFFLINE:return{ui:(0,Te.jsx)(U.ErrorFavicon,{children:(0,Te.jsx)(Q.default,{})}),requiresBackendCheck:!0};case Ce.PROXYBLOCK:return{ui:(0,Te.jsx)(U.ErrorFavicon,{children:(0,Te.jsx)(re.default,{})}),requiresBackendCheck:!0};case Ce.CONFLICT:return{ui:(0,Te.jsx)(U.ErrorFavicon,{children:(0,Te.jsx)(R.default,{cancelText:K.default.t(596),onCancel:()=>ve.Socket.logout(),okText:K.default.t(253),onOK:()=>ve.Socket.takeover(),children:K.default.t(696)})}),requiresBackendCheck:!0};case Ce.TOS_BLOCK:return{ui:(0,Te.jsx)(U.ErrorFavicon,{children:(0,Te.jsx)(_e.default,{description:E.fbt._('WhatsApp is updating our Terms and Privacy Policy to reflect new features and comply with the new European Union data protection laws. Open WhatsApp on your phone to read our Terms and Privacy Policy and learn more about the choices you have. If you have accepted the Terms and Privacy Policy, click "LOG IN" to continue using WhatsApp.',null,{hk:"4uxe2b"})})}),requiresBackendCheck:!0};case Ce.SMB_TOS_BLOCK:return{ui:(0,Te.jsx)(U.ErrorFavicon,{children:(0,Te.jsx)(_e.default,{description:E.fbt._('We are updating our WhatsApp Business Terms of Service. Agree to our new Terms on your phone to continue using WhatsApp Business. If you have accepted the Terms of Service, click "LOG IN" to continue using WhatsApp Business.',null,{hk:"3Ti2sa"}),children:(0,Te.jsx)(se.default,{})})}),requiresBackendCheck:!0};case Ce.DEPRECATED_VERSION:return{ui:(0,Te.jsx)(U.ErrorFavicon,{children:(0,Te.jsx)(N.default,{})}),requiresBackendCheck:!0};case Ce.LOGOUT:return{ui:(0,Te.jsxs)(U.DefaultFavicon,{children:[(0,Te.jsx)(J.ModalManager,{type:J.ModalType},"modal-manager"),(0,Te.jsx)(H.default,{},"logout")]}),requiresBackendCheck:!0};case Ce.PRIMARY_FORCE_UPGRADE:return{ui:(0,Te.jsx)(U.ErrorFavicon,{children:(0,Te.jsx)(G.default,{})}),requiresBackendCheck:!0};case Ce.MAIN:const{MainComponent:i}=(0,o.default)(Ae,"Main");return{ui:[(0,Te.jsx)(he.ToastManager,{},"toast-manager"),(0,Te.jsx)(J.ModalManager,{contextMenuRef:this.contextMenuRef,type:J.ModalType},"main-modal-manager"),(0,Te.jsx)(J.ModalManager,{type:J.MediaType},"media-modal-manager"),(0,Te.jsx)(L.ContextMenuManager,{ref:this.contextMenuRef,type:L.Type.MENU},"context-menu-manager"),(0,Te.jsx)(L.ContextMenuManager,{type:L.Type.TOOLTIP},"tooltip-manager"),(0,Te.jsx)(k.InitialEmojisCompletionContext.Provider,{value:k.emojiCompletionTracker,children:(0,Te.jsx)(i,{conn:D.Conn,animate:this.animate})},"main")],extraClasses:C.default.isMain,requiresBackendCheck:!0}}}_getDeeplinkSessionId(){return(0,F.smbClickToChatLoggingEnabled)()?Math.floor(2147483648*Math.random()).toString():void 0}render(){!function(e){if(Z.initialScreenTimer.hasStarted())return;const t=Ne(e);if(!function(e){return e!==Ce.SYNCING}(t))return;(0,Z.setInitialScreen)(t),Z.initialScreenTimer.start(),window.requestAnimationFrame((()=>{Z.initialScreenTimer.end(),Oe("initialPanelRenderTRecorded")}))}(this.state);const{isKeyboardUser:e}=this.state,{ui:t,extraClasses:n,requiresBackendCheck:r}=this._getUiAndIconCount(),i=(0,y.default)(C.default.wrapper,n,{"app-wrapper-native":h.isNative,"app-wrapper-web":h.isWeb,"safari-fix":h.hasSafariFix,"edge-fix":h.hasEdgeFix,"font-fix":h.hasFontFix,"os-ltr":h.isOSLTR,"os-rtl":h.isOSRTL,"os-mac":h.isOSMac,"os-win":h.isOSWin,"keyboard-user":e});r&&null!=Ae&&!(0,x.knowsPhone)()&&Ae.notificationBackend.shutdownAsNeeded();const a=Ne(this.state),o=a===Ce.STARTUP||a===Ce.SYNCING?"loading-screen":this.state.locale;return(0,Te.jsx)(fe.ThemeContext.Provider,{value:this._getThemeContextValue({theme:this.state.theme,systemThemeMode:this.state.systemThemeMode}),children:(0,Te.jsx)(Y.default.Provider,{value:e,children:(0,Te.jsx)(ge.UIE,{displayName:"App",uimState:ge.UIE.State.INACTIVE,children:(0,Te.jsxs)(j.HotKeys,{handlers:this._handlers,className:i,tabIndex:null,onMouseDownCapture:this._handleMouseDown,onClickCapture:this._handleClick,children:[undefined,undefined,t]},o)})})})}}Re.displayName="AppImpl";const De=(0,W.ListenerHOC)(Re);function Le(){return(Le=(0,i.default)((function*(){const[e,t]=yield Promise.all([(0,$.requireMain)(),ke()]);Z.mainScriptTimer.start(),Ae=e(t),Z.mainScriptTimer.end()}))).apply(this,arguments)}function Ne(e){const{anotherSession:t,isUnsupportedTakeover:n,updating:r,hardExpired:i,mainLoaded:a,mode:o}=e;if((0,d.isMDBackend)()){var s;if(null===(s=e.temporaryBan)||void 0===s?void 0:s.banned)return Ce.TEMP_BAN;if(e.startLogout)return Ce.LOGOUT}if(r||i)return Ce.CLIENT_EXPIRED_DIALOG;if(n)return Ce.UNSUPPORTED_TAKEOVER;if(t)return Ce.ANOTHER_SESSION;switch(o){case ue.StreamMode.QR:return Ce.QR;case ue.StreamMode.SYNCING:return Ce.SYNCING;case ue.StreamMode.OFFLINE:return Ce.OFFLINE;case ue.StreamMode.PROXYBLOCK:return Ce.PROXYBLOCK;case ue.StreamMode.CONFLICT:return Ce.CONFLICT;case ue.StreamMode.TOS_BLOCK:return Ce.TOS_BLOCK;case ue.StreamMode.SMB_TOS_BLOCK:return Ce.SMB_TOS_BLOCK;case ue.StreamMode.DEPRECATED_VERSION:return Ce.DEPRECATED_VERSION;case ue.StreamMode.MAIN:if(!a)return Ce.STARTUP;if((0,d.isMDBackend)()){if(e.stayInSync)return Ce.SYNCING;if(e.primaryForceUpgrade)return Ce.PRIMARY_FORCE_UPGRADE}return Ce.MAIN}throw new Error(`app:render Error invalid StreamMode: ${o}`)}function ke(){return D.Conn.platform?Promise.resolve(D.Conn.platform):new Promise((e=>{const t=()=>{const{platform:n}=D.Conn;null!=n&&(D.Conn.off("change:platform",t),e(n))};D.Conn.on("change:platform",t)}))}t.AppWrapper=De},50669:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default=class{constructor(e,t,n){this.retryCount=0,this.asset=e,this.resolution=t,this.priority=n}getLoadUrlPromise(){return this._loadUrlPromise}setLoadUrlPromise(e,t){this._loadUrlPromise=e,this._loadUrlAbortController=t}abortLoadUrlPromise(){var e;null===(e=this._loadUrlAbortController)||void 0===e||e.abort()}getConsumerPromise(){return this._consumerPromise}setConsumerPromise(e){this._consumerPromise=e}getConsumerPromiseResolve(){return this._consumerPromiseResolve}setConsumerPromiseResolve(e,t){this._consumerPromiseResolve=e,this._consumerAbortController=t}abortConsumerPromise(){var e;null===(e=this._consumerAbortController)||void 0===e||e.abort()}}},95480:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(!n(92658).default.supported)return;const t=!0===e.estimateStorage,r=n(25613).default,o=n(64237).default,p=navigator.serviceWorker;(0,a.detectWebpSupport)().then((t=>{const n=(0,i.default)(e.keep,(e=>[e[s.default.RES.LOW],e[s.default.RES.HIGH]])).map((e=>{var n;const r=null===(n=e[t&&e[u]?u:d])||void 0===n?void 0:n.split("/");return null!=r?r[r.length-1]:null}));(null==p?void 0:p.controller)&&r.request(p.controller,o.CLEAN_ASSETS,n).catch((()=>{}))})).then((()=>t?(0,l.default)():null)).then((e=>{e&&new c.default.WebcStorageStat({webcStorageUsage:e.usage,webcStorageQuota:e.quota}).commit()}))};var i=r(n(94654)),a=n(61498),o=r(n(41143)),s=r(n(30588)),l=r(n(63236)),c=r(n(11339));(0,o.default)(!0,"service worker builds only");const d="default",u="webp"},30588:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;const n={LOW:"low",HIGH:"high"},r=window.matchMedia("\n    only screen and (-webkit-min-device-pixel-ratio: 2),\n    only screen and (min-device-pixel-ratio: 2),\n    only screen and (min-resolution: 2dppx)\n"),i={RES:n,currentRes:r.matches?n.HIGH:n.LOW};r.addListener((function(e){const t=e.matches?n.HIGH:n.LOW;if(t===i.currentRes)return;i.currentRes=t;const r=document.createEvent("Event");r.initEvent("dpichange",!0,!0),window.dispatchEvent(r)}));var a=i;t.default=a},10816:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(68929)),a=r(n(2525)),o=r(n(35161)),s=r(n(73955));t.default=class{constructor(e){this.rules={},this.styleSheet=this.createStyleSheet(e)}createStyleSheet(e){const t=e||(0,s.default)("dynamic-style-");let n=document.createElement("style");return n.id=t,n.type="text/css",document.head&&document.head.appendChild(n),n=n.sheet,n}addRule(e,t){const n=this.styleSheet.cssRules.length,r=(0,o.default)(t,((e,t)=>`${t}: ${e};`)).join(" ");return this.styleSheet.insertRule(`${e} { ${r} }`,n),this.rules[e]=this.styleSheet.cssRules[n],this.rules[e]}updateRule(e,t){const n=this.rules[e];return(0,a.default)(t,((e,t)=>{n.style[(0,i.default)(t)]=e})),n}setRule(e,t){return this.rules[e]?this.updateRule(e,t):this.addRule(e,t)}}},14315:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.emojiAssetMapCreator=function(e){return t=>d(t,e)},t.getEmojiTypeFromPlatform=u;var i=r(n(52628)),a=r(n(44908)),o=r(n(88306)),s=n(17239),l=n(13045),c=n(95885);const d=(0,o.default)(((e,t)=>{const n=new Map,r=u(e),o=t[r],s=o.SELECTOR,d=Math.ceil((0,a.default)((0,i.default)(o.UNICODE_TO_EMOJI)).length/l.BUCKET_SIZE);for(let e=0;e<d;e+=1){const t=`emoji-${s}-b${e}`,i=40;n.set(t,{id:t,selectors:[`.emoji.${s}.b${e}`,`.emojik.${s}.b${e}`],low:{default:(0,c.getEmojiSpritesPath)(r,e,40,"png"),webp:(0,c.getEmojiSpritesPath)(r,e,i,"webp")},high:{default:(0,c.getEmojiSpritesPath)(r,e,64,"png"),webp:(0,c.getEmojiSpritesPath)(r,e,64,"webp")}})}return n}));function u(e){switch(e){case s.PLATFORMS.IPHONE:case s.PLATFORMS.SMBI:case s.PLATFORMS.IPAD:case s.PLATFORMS.IPOD:return l.EMOJI_TYPE.APPLE;default:return l.EMOJI_TYPE.WHATSAPP}}},78359:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.emojiCompletionTracker=t.InitialEmojisCompletionContext=t.EmojiCompletionTracker=void 0;var r=n(89721),i=n(67294);class a{constructor(){var e=this;this._loadingEmojisCount=0,this._hasTriggeredEmojiPreload=!1,this._firstRun=!1,this.beginPreload=function(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];e._hasTriggeredEmojiPreload||(e._hasTriggeredEmojiPreload=!0,window.setTimeout((()=>{r.AssetLoader.loadEmojis()}),t?1e3:0))},this.beginPreloadFallback=()=>{window.setTimeout((()=>{this.beginPreload(!1)}),5e3)},this.incrementLoadingEmojisCount=()=>{this._hasTriggeredEmojiPreload||(this._firstRun||(this._firstRun=!0,this._firstRunTiming=performance.now()),this._loadingEmojisCount+=1)},this.decrementLoadingEmojisCount=()=>{this._hasTriggeredEmojiPreload||(this._loadingEmojisCount-=1,0===this._loadingEmojisCount&&this._firstRun&&(this.beginPreload(!0),__LOG__(2)`EmojiCompletionTracker:firstScreenEmojis complete in ${Math.ceil(performance.now()-this._firstRunTiming)} ms`))}}}t.EmojiCompletionTracker=a;const o=new a;t.emojiCompletionTracker=o;const s=(0,i.createContext)(o);t.InitialEmojisCompletionContext=s},89721:(e,t,n)=>{"use strict";var r=n(59182).default,i=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.LOAD_PRIORITY=t.AssetLoaderImpl=t.AssetLoaderClass=t.AssetLoader=void 0;var a=i(n(48926)),o=i(n(52628)),s=i(n(18446)),l=n(89385),c=i(n(45095)),d=i(n(9006)),u=i(n(47259)),p=i(n(41143)),f=i(n(50669)),h=i(n(30588)),_=i(n(10816)),g=n(67247),m=n(14315),y=n(13045),E=n(7087),S=i(n(11339)),v=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=b(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(47272)),T=i(n(95480));function b(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(b=function(e){return e?n:t})(e)}const C={INITIAL_EMOJI_LOAD:1,INITIAL_ASSET_LOAD:2,THEME_ASSET_LOAD:2,HELP_ANIMATED_DOODLE:2,LAZY_LOAD_EMOJI:2,NOTIFICATION_ICON:2};t.LOAD_PRIORITY=C;class A{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:90;this._assetStyle=new _.default("asset-style"),this._requestedAssets={},this._loadingDataMap={},this._getEmojiForPlatform=null,this._currentResolution=h.default.currentRes,this._currentlyLoadingCount=0,this._queue=new d.default((e=>-e.priority)),this._hasLoggedDecrementBelowZero=!1,this._handleDpiChange=()=>{const e=h.default.currentRes,t=this._currentResolution;e!==t&&(this._currentResolution=e,Object.keys(this._requestedAssets).forEach((e=>{this._cancelLoad(e,t)})),this._loadAssets((0,o.default)(this._requestedAssets),C.INITIAL_EMOJI_LOAD,{forceCheck:!1}).catch((0,l.catchAbort)((()=>{}))))},this._maxConcurrentRequests=e,window.addEventListener("dpichange",this._handleDpiChange)}initEmojiAsset(e){this._getEmojiForPlatform=e}loadInitialAssets(e){const t=new S.default.WebcAssetLoad({webcAssetName:"initial-assets",webcAssetFromCache:!1,webcAssetCacheType:S.default.WEBC_ASSET_CACHE_TYPE_CODE.UNCACHED});this._loadAssets(e,C.INITIAL_ASSET_LOAD,{estimateStorage:!0}).then((()=>{t.markWebcAssetLoadT(),t.commit();const e=t.webcAssetLoadT;__LOG__(2)`AssetLoader:loadInitialAssets complete in ${e}ms`})).catch((0,l.catchAbort)((()=>{__LOG__(2)`AssetLoader:loadInitialAssets cancelled by more recent request.`})))}loadEmoji(e,t){if(this._getEmojiForPlatform&&this._currentPlatform){const n=this._getEmojiForPlatform(this._currentPlatform),r=g.EmojiUtil.getBucket(e),i=this._getEmojiPrefix(),a=n.get(`${i}b${r}`),o=this._currentResolution;return a?this.loadAsset(a,t,!1).catch((0,l.catchAbort)((()=>{__LOG__(2)`AssetLoader: loadEmoji Cancelled by more recent request: ${a.id}-${o}`}))):Promise.reject(new Error("The given emoji glyph id was not found"))}return Promise.reject(new Error("emojiForPlatform or currentPlatform are not set"))}loadEmojis(){const e=(0,c.default)(this._currentPlatform,"this._currentPlatform");(0,p.default)(null!=this._getEmojiForPlatform,"Emojis were loaded before initializing the emoji assets!");const t=Array.from(this._getEmojiForPlatform(e).values()),n=new S.default.WebcAssetLoad({webcAssetName:"emojis",webcAssetFromCache:!1,webcAssetCacheType:S.default.WEBC_ASSET_CACHE_TYPE_CODE.UNCACHED});this._loadAssets(t,C.INITIAL_EMOJI_LOAD,{estimateStorage:!0}).then((()=>{n.markWebcAssetLoadT(),n.commit();const e=n.webcAssetLoadT;__LOG__(2)`AssetLoader:loadEmojis complete in ${e}ms`})).catch((0,l.catchAbort)((()=>{__LOG__(2)`AssetLoader:loadEmojis cancelled by more recent request.`})))}loadAsset(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const{id:i}=e,a=h.default.currentRes,o=this._requestedAssets[i];if(o&&!(0,s.default)(e,o))return Promise.reject(new Error(["Attempted to load an asset using an already used ID"].join("\n")));this._requestedAssets[i]=e,this._loadingDataMap[i]=this._loadingDataMap[i]||{};const c="high"===a?"low":"high";this._cancelLoad(i,c);const d=this._loadingDataMap[i][a];if(d&&!n)return d.promise;const u=new f.default(e,a,t),p=new r,{signal:_}=p,g=this._buildPromise(u,p).then((t=>{if(_.aborted)throw new l.AbortError;const{selectors:n}=e;return n&&this._assetStyle.setRule(`${n.join(", ")}`,{"background-image":`url('${t}')`}),t})).catch((e=>{const t=this._loadingDataMap[i][a],n=m!==t;if(n||(this._loadingDataMap[i][a]=null),e.name===l.ABORT_ERROR&&(__LOG__(2)`Asset load cancelled by more recent request: ${i}-${a}`,n&&t))return t.promise;throw e}));u.setConsumerPromise(g);const m={promise:g,abort:e=>{this._abortUrlPromise(u,e)}};return this._loadingDataMap[i][a]=m,d&&d.abort(!1),this._startLoad(),g}_buildPromise(e,t){const n=new Promise((n=>{e.setConsumerPromiseResolve(n,t),this._queue.push(e)}));return(0,u.default)(n,t.signal)}_startLoad(){if(!(this._currentlyLoadingCount>=this._maxConcurrentRequests))for(let e=0;e<this._maxConcurrentRequests-this._currentlyLoadingCount;e++){const e=this._queue.pull();if(!e)return;this._currentlyLoadingCount+=1,(0,E.loadUrl)(e).then((()=>{this._decrementCurrentlyLoadingCount(),this._startLoad()})).catch((0,l.catchAbort)((()=>{this._decrementCurrentlyLoadingCount(),this._startLoad()}))).catch((t=>{this._decrementCurrentlyLoadingCount(),e.retryCount+=1;const n=v.expBackoff(e.retryCount,12e4,1e3,.1);setTimeout((()=>{this._queue.push(e),this._startLoad()}),n),this._startLoad(),(0,E.getSupportedImageFormatUrl)(e).then((e=>{const n=e.split("/");__LOG__(3)`Asset: ${n[n.length-1]} failed. Retrying... ${t.toString()}`}))}))}}_abortUrlPromise(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e.getLoadUrlPromise()){e.abortLoadUrlPromise();const n=e.getConsumerPromise();t&&n&&e.abortConsumerPromise()}this._startLoad()}_cancelLoad(e,t){var n;const r=null===(n=this._loadingDataMap[e])||void 0===n?void 0:n[t];r&&(this._loadingDataMap[e][t]=null,r.abort(!0))}setPlatform(e){if(e===this._currentPlatform)return;this._currentPlatform=e;const t=((0,m.getEmojiTypeFromPlatform)(e)===y.EMOJI_TYPE.APPLE?y.EMOJI_TYPE.WHATSAPP:y.EMOJI_TYPE.APPLE)===y.EMOJI_TYPE.APPLE?"emoji-apple-":"emoji-wa-";if(Object.keys(this._requestedAssets).forEach((e=>{e.startsWith(t)&&(this._cancelLoad(e,"high"),this._cancelLoad(e,"low"))})),null==this._getEmojiForPlatform)return;const n=Array.from(this._getEmojiForPlatform(e).values());this._loadAssets(n,C.INITIAL_EMOJI_LOAD,{forceCheck:!1})}_getEmojiPrefix(){return(0,m.getEmojiTypeFromPlatform)(this._currentPlatform)===y.EMOJI_TYPE.APPLE?"emoji-apple-":"emoji-wa-"}_loadAssets(e,t,n){var r=this;return(0,a.default)((function*(){const i=!1!==(null==n?void 0:n.forceCheck),a=!0===(null==n?void 0:n.estimateStorage),s=yield Promise.all(e.map((e=>r.loadAsset(e,t,i))));return(0,T.default)({keep:(0,o.default)(r._requestedAssets),estimateStorage:a}),s}))()}_decrementCurrentlyLoadingCount(){this._currentlyLoadingCount<=0&&!this._hasLoggedDecrementBelowZero&&(this._hasLoggedDecrementBelowZero=!0,__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("Tried to decrease _loadingCount below zero, would have been negative.")),this._currentlyLoadingCount=Math.max(0,this._currentlyLoadingCount-1)}}t.AssetLoaderImpl=A;const P=new A;t.AssetLoader=P;const M=A;t.AssetLoaderClass=M},7087:(e,t,n)=>{"use strict";var r=n(59182).default,i=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.LoadUrlError=void 0,t.getSupportedImageFormatUrl=h,t.loadUrl=function(e){const t=new r,n=h(e).then(function(){var n=(0,a.default)((function*(n){yield l.default.waitIfOffline({signal:t.signal});const r=Date.now(),i=yield(0,d.extendedFetch)(n,{signal:t.signal}),a=e.getConsumerPromiseResolve();if(!i.ok||!a)throw new f(n,i.status,Date.now()-r);a(n)}));return function(){return n.apply(this,arguments)}}());return e.setLoadUrlPromise(n,t),n};var a=i(n(48926)),o=n(40265),s=i(n(45095)),l=i(n(81602)),c=n(61498),d=n(61181);const u="default",p="webp";class f extends((0,o.customError)("LoadUrlError")){constructor(e,t,n){super(`Failed to load url. StatusCode: ${t}. Duration: ${n} ms`),this.url=e,this.statusCode=t}}function h(){return _.apply(this,arguments)}function _(){return(_=(0,a.default)((function*(e){const t=yield(0,c.detectWebpSupport)(),{asset:n,resolution:r}=e,i=t&&n[r][p]?p:u;return(0,s.default)(n[r][i],"asset[resolution][format]")}))).apply(this,arguments)}t.LoadUrlError=f},64481:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PRODUCT_LIST_ITEM_HEIGHT=t.MAX_REPLY_PRODUCT_TITLE_LENGTH=t.MAX_REPLY_PRODUCT_DESC_LENGTH=void 0;t.PRODUCT_LIST_ITEM_HEIGHT=96;t.MAX_REPLY_PRODUCT_TITLE_LENGTH=40;t.MAX_REPLY_PRODUCT_DESC_LENGTH=95},40682:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(14296));var a={get:()=>i.default.getFullLocale().replace("-","_")};t.default=a},29821:(e,t,n)=>{"use strict";var r=n(95318)(n(48926)),i=n(85893);function a(){return(a=(0,r.default)((function*(){var e;window.Promise=n(74121).Z;const{setupLodashMemoizeCache:t}=n(48174);t(),window.__LOG__=n(39948).log,window.SEND_LOGS=n(86374).sendLogs,window.onerror=n(58955).HC,window.onunhandledrejection=n(58955).TG;const{setGlobals:a}=n(12670),{createJidUtils:o}=n(52230);a({config:{},jidUtils:o({platform:"whatsapp"}),myJids:null});const s=n(4285).default;self.URL=self.URL||self.webkitURL,self.AudioContext=self.AudioContext||self.webkitAudioContext,self.requestFileSystem=self.requestFileSystem||self.webkitRequestFileSystem,n(64369).default;const{KEYS:l}=n(72407),{UA:c}=n(26741),d="1"===(null==s?void 0:s.getItem(l.LOGOUT_DIRTY_BIT)),u="true"===(null==s?void 0:s.getItem(l.MD_OPTED_IN)),p=!(null==s?void 0:s.getItem(l.LAST_WID_MD))&&!(null==s?void 0:s.getItem(l.LAST_WID)),{deleteAllIdb:f}=n(5558),{initWAWC:h}=n(20869);if(d||p&&u)try{yield f(),yield h()}catch(e){__LOG__(4,void 0,new Error,void 0,["bootstrap_qr"])`Preemptive db delete failed with error ${e}`}else try{n(39948).Logger.clearLogsPreemptive()}catch(e){}const _=new(0,n(53565).default)((null!==(e=window.location.search)&&void 0!==e?e:"").toLowerCase());d&&(null==s||s.clear(),_.set("post_logout","1"),window.location.href=`${window.location.pathname}?${_.toString()}`);const g=_.get("logout_reason");if(null!=g){(0,n(54602).setPrevLogoutReasonCode)(g)}if("1"===_.get("post_logout")||null!=g){n(76139).default.canMuckHistory()&&window.history.replaceState({},document.title,"/")}const{initModules:m}=n(56599);m();const{injectWamDependencies:y}=n(77959);y({Browser:n(79264).default,Crashlog:n(86374),CONST:n(64369).default,Metric:n(11339).default,UserPrefs:n(99234),WamStorage:n(26372).default,isUserLoggedIn:n(9530).isLoggedIn,uploadStats:n(85195).Z,WamContext:n(88353).I,PsIdStore:n(29590).Z,CoreWamStorageAdaptor:n(75838),uploadPrivateStats:n(24569).Z});const{exeTimer:E}=n(71119);E.start();const S=n(45095).default,v=n(73935);n(67294),c.isSafari&&c.browserVersion.startsWith("13.")&&(S(document.body,"document.body").className+=" text-rendering-bug-fix"),n(94114),window.Velocity=n(12641),n(38161),window.WebFont=n(75933);const T=n(77303),b=n(22854).Z;T.set(b);const{isFunction:C}=n(51737);["getSelection","open","focus"].forEach((function(e){const t=Object.getPrototypeOf(window)[e];C(t)&&window[e]!==t&&(window[e]=t)}));const A=n(86374);window.Debug||(window.Debug={}),window.Debug.uploadLogs=A.upload;try{if(c.isLocalStorageBroken){const e=n(11554).default;yield e.loadUserIdb()}}finally{const e=n(14296).default;e.init(n(99234).getLangPref()).then((0,r.default)((function*(){const{Clock:e}=yield Promise.resolve().then(n.bind(n,40234));e.setIs24HourBasedOnLocale()}))),n(39948).Logger;const{App:t,hasPending:a}=n(94300);window.Debug.VERSION="2.2210.9",window.Debug.DESKTOP_BETA=!1,window.Debug.BUILD_ID="359061622";const o=n(79264).default;window.onbeforeunload=function(){{const{stopCommsBeforeUnload:t}=n(94300);if(u&&!a())try{t()}catch(e){__LOG__(4,void 0,new Error)`error while stopping comms onbeforeunload: ${e}`}if(o.isDownloading())return void o.clearDownloading();if(__LOG__(2)`webclient close/reload triggered`,__LOG__(2)`latest hash: ${"fdca65977a5968d197b73228961b4afe2515c724"}`,__LOG__(2)`version: ${"2.2210.9"}`,o.promptUnloadGuards>0)return;if(a())return e.t(343)}},window.addEventListener("dragover",(function(e){e.preventDefault()})),window.addEventListener("drop",(function(e){e.preventDefault()})),n(71798).loadSVGData();(0,n(93860).Z)()||(v.render((0,i.jsx)(t,{}),S(document.getElementById("app"),"document.getElementById('app')")),E.end())}if(window.navigator.serviceWorker&&!window.navigator.serviceWorker.controller)try{window.navigator.serviceWorker.register("/serviceworker.js",{scope:"/"})}catch(e){}}))).apply(this,arguments)}!function(){a.apply(this,arguments)}()},29237:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return(0,s.jsxs)("span",{className:(0,i.default)({[a.default.block]:!e.inline}),children:[(0,s.jsx)("span",{className:a.default.actionText,onClick:e.action,children:e.children}),(0,s.jsx)(o.default,{className:a.default.chevron,directional:!0,name:"chevron-right-text"})]})};var i=r(n(94184)),a=r(n(40369)),o=r(n(23217)),s=n(85893)},30152:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SMB_SEARCH_FILTERS=void 0;t.SMB_SEARCH_FILTERS={UNREAD:"unread",GROUP:"group",BROADCAST:"broadcast",CONTACT:"contact",NON_CONTACT:"non_contact"}},46331:(e,t,n)=>{"use strict";var r=n(59182).default,i=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ToastPosition=t.ActionType=t.ActionToast=void 0,t.genId=function(e){return(0,a.default)(e||"action_toast")};var a=i(n(73955)),o=n(89385),s=n(13959),l=n(67294),c=n(88102),d=n(50452),u=n(85893);const p={LEFT:"LEFT",RIGHT:"RIGHT"};t.ToastPosition=p;t.ActionType=class{constructor(e,t){if(!e)throw new Error("ActionType must have text!");this.text=e,t&&(this.action=t.actionText,this.handler=t.actionHandler)}};class f extends l.Component{constructor(){super(...arguments),this.state={currentInitialAction:this.props.initialAction,actionType:this.props.initialAction,pending:!0},this._action=null,this._handleAction=()=>{this.state.actionType&&this.state.actionType.handler&&this.state.actionType.handler().catch((()=>{}))},this._handleDismiss=()=>{c.Cmd.closeToast(this)}}static getDerivedStateFromProps(e,t){const n=e.initialAction;return n!==t.currentInitialAction?{currentInitialAction:n,actionType:n,pending:!0}:null}componentDidMount(){this._runAction(this.props.pendingAction)}componentDidUpdate(e){e.pendingAction!==this.props.pendingAction&&this._runAction(this.props.pendingAction)}_runAction(e){this._action&&this._action.controller.abort();const t=new r,n=t.signal,i=e.then((e=>{if(n.aborted)throw new o.AbortError;this.setState({actionType:e,pending:!1})})).catch((e=>{if(e.name===o.ABORT_ERROR)throw e;this.setState({actionType:e,pending:!1})})).then((()=>(0,s.delayMs)(this.props.settleDuration))).then((()=>{if(n.aborted)throw new o.AbortError;c.Cmd.closeToast(this)})).catch((0,o.catchAbort)((()=>{})));this._action={promise:i,controller:t}}render(){const{actionType:e}=this.state;if(!e)return null;let t,n;return e.action&&e.handler&&(n=(0,u.jsx)(d.ToastActionBtn,{buttonText:e.action,onClick:this._handleAction})),this.state.pending||(t=(0,u.jsx)(d.ToastDismissBtn,{onClick:this._handleDismiss})),(0,u.jsx)(d.ToastBody,{toastPosition:this.props.toastPosition,actionText:e.text,actionBtn:n,dismissBtn:t})}}t.ActionToast=f,f.defaultProps={settleDuration:5e3,toastPosition:p.LEFT},f.displayName="ActionToast"},48840:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.URL=void 0;t.URL="https://web.whatsapp.com/"},51650:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.APICmd=void 0,t.isWAURL=function(e){return n.test(e)};t.APICmd={GROUP_INVITE:"GROUP_INVITE",MSG_SEND:"MSG_SEND",INVALID:"INVALID",CATALOG:"CATALOG",PRODUCT:"PRODUCT"};const n=/^whatsapp:\/\/.*/i},81093:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.matchProductUrl=t.matchCatalogUrl=void 0,t.parseAPICmd=function(e){if("string"!=typeof e)return{resultType:s.APICmd.INVALID,data:void 0};const t=(e=>{let t=e.match(u);if(t)return{code:t[2],url:t[1]||"/"};if(t=e.match(p),t)return{code:t[1]};if(t=e.match(f),t)return{code:t[1]};if(t=e.match(h),t)return{code:t[1]}})(e);if(t)return{resultType:s.APICmd.GROUP_INVITE,data:t};const n=function(e){let t=e.match(O)||e.match(I);if(t)return R(t);if(t=e.match(w),t)return(0,i.default)((0,i.default)({},R(t)),{},{url:"/"})}(e);if(n)return{resultType:s.APICmd.CATALOG,data:n};const r=function(e){let t=M(e,C);if(t)return D(t);if(t=M(e,A),t)return(0,i.default)((0,i.default)({},D(t)),{},{url:"/"})}(e);if(r)return{resultType:s.APICmd.PRODUCT,data:r};const a=(e=>{let t=e.match(y);if(t){const e=m(t[2]);if(e)return e.url=t[1]||"/",e}if(t=e.match(E),t)return m(t[1]);if(t=e.match(S),t)return m(t[1]);if(t=e.match(v),t){let e;if(t[1]&&(e={phone:`${t[1]}@c.us`}),t[2]){const n=m(t[2]);n&&(e=(0,i.default)((0,i.default)({},e),n))}return e}})(e);if(a)return{resultType:s.APICmd.MSG_SEND,data:a};return{resultType:s.APICmd.INVALID,data:void 0}},t.parseConversionData=g;var i=r(n(81109)),a=n(8584),o=n(48840),s=n(51650),l=r(n(53565));const c=(d=o.URL,d.replace(/\/+$/,"")).replace(/[\/\.]/g,"\\$&");var d;const u=new RegExp(`^${c}((?:/\\w+)*)/accept/?\\?code=(\\w+)$`,"i"),p=/^https?:\/\/chat\.whatsapp\.com\/invite\/(\w+)$/i,f=/^https?:\/\/chat\.whatsapp\.com\/(\w+)$/i,h=/^whatsapp:\/\/chat\/?\?code=(\w+)$/i,_={text:"text",phone:"phone",data:"data",source:"source",context:"context",icebreaker:"icebreaker",source_url:"source_url"};function g(e){if(!e||"string"!=typeof e)return;const t=a.Binary.build(e);return t.size()>512?void 0:t.readBuffer()}function m(e){const t={};if(new l.default(e).forEach(((e,n)=>{const r=n.toLowerCase();if(r===_.data){const n=g(e);if(!n)return;t.conversionTuple||(t.conversionTuple={}),t.conversionTuple.conversionData=n}else if(r===_.source){const n=e;if((0,a.numUtf8Bytes)(n)>32)return;t.conversionTuple||(t.conversionTuple={}),t.conversionTuple.conversionSource=n}else r===_.source_url?(t.ctwaContextLinkData=t.ctwaContextLinkData||{},t.ctwaContextLinkData.sourceUrl=e):r===_.context?(t.ctwaContextLinkData=t.ctwaContextLinkData||{},t.ctwaContextLinkData.context=e):r===_.icebreaker?(t.ctwaContextLinkData=t.ctwaContextLinkData||{},t.ctwaContextLinkData.icebreaker=e):_[r]&&(t[r]=e)})),t.phone&&(t.phone=t.phone.replace(/\D/g,"")+"@c.us",t.ctwaContextLinkData&&(t.ctwaContextLinkData.phone=t.phone)),t.phone||t.text)return t}const y=new RegExp(`^${c}((?:/\\w+)*)/send/?\\?(.+)$`,"i"),E=/^https?:\/\/api\.whatsapp\.com\/send\/?\?(.+)$/i,S=/^whatsapp:\/\/send\/?\?(.*)$/i,v=/^https?:\/\/wa\.me\/?([0-9]{0,20})?\/?\??(.+)?$/i,T=new RegExp(`^${c}(?:(?:/\\w+)*)/product/([0-9]{0,20})/([0-9]{0,20})$`,"i"),b=new RegExp(`^${c}(?:(?:/\\w+)*)/product/([^/]{0,200})/([0-9]{0,20})$`,"i"),C=[/^https?:\/\/wa\.me\/p\/([0-9]{0,20})\/([0-9]{0,20})$/i,/^whatsapp:\/\/product\/([0-9]{0,20})\/([0-9]{0,20})$/i,/^https?:\/\/wa\.me\/p\/([^\/]{0,200})\/([0-9]{0,20})$/i,/^whatsapp:\/\/product\/([^\/]{0,200})\/([0-9]{0,20})$/i],A=[T,b],P=[...C,...A];function M(e,t){for(let n=0;n<t.length;n++){const r=e.match(t[n]);if(r)return r}}t.matchProductUrl=e=>null!=M(e,P);const O=/^https?:\/\/wa\.me\/c\/([0-9]{0,20})$/i,I=/^whatsapp:\/\/catalog\/([0-9]{0,20})$/i,w=new RegExp(`^${c}(?:(?:/\\w+)*)/catalog/([0-9]{0,20})$`,"i");t.matchCatalogUrl=e=>[O,I,w].some((t=>e.match(t)));function R(e){return{catalogOwnerJid:`${e[1]}@s.whatsapp.net`}}function D(e){return{productId:e[1],businessOwnerJid:`${e[2]}@s.whatsapp.net`}}},39770:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let{a8nText:t,children:n,className:r,xstyle:m,disabled:y,onClick:E,nowrap:S,spinner:v,type:T}=e;const[b,C]=(0,d.default)(E,{disabled:y}),[A,P]=(0,l.default)(),M=(0,c.default)(b,A);let O;switch(T){case"primary":O="white";break;case"secondary":case"plain-white":case"simplified":O="highlight";break;default:O="default"}y&&(O="default");return(0,_.jsx)("div",(0,i.default)((0,i.default)({},C),{},{"data-a8n":a.default.key(t),className:(0,o.default)(u.default.button,{[u.default.primary]:"primary"===T,[u.default.secondary]:"secondary"===T,[u.default.plainWhite]:"plain-white"===T,[u.default.disabled]:y,[u.default.nowrap]:S,[u.default.simplified]:"simplified"===T,[u.default.warning]:"warning"===T,[u.default.solidWarning]:"solidWarning"===T,[u.default.strong]:"strong"===T,[u.default.strongPrimary]:"strong-primary"===T,[u.default.itemFocused]:P},r,(0,s.default)(m)),ref:M,children:(0,_.jsxs)(p.FlexRow,{align:"center",justify:"center",children:[(0,_.jsx)(f.default,{a8nText:a.default.key("content"),children:null!=n?n:null}),v?(0,_.jsx)(f.default,{a8nText:a.default.key("spinner"),xstyle:g.spinner,children:(0,_.jsx)(h.Spinner,{color:O,size:16})}):null]})}))};var i=r(n(81109)),a=r(n(99964)),o=r(n(94184)),s=r(n(56720)),l=r(n(85647)),c=r(n(78506)),d=r(n(34470)),u=r(n(44889)),p=n(29623),f=r(n(48846)),h=n(11054),_=n(85893);const g={spinner:{paddingStart:"mhcwslh8"}}},99360:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{children:t,href:n,onClick:r,title:c,className:d,tabIndex:u}=e;return(0,s.jsx)("a",{"data-a8n":i.default.key(e.a8n),"data-testid":"clickable-link",className:(0,a.default)(d,(0,o.default)(l)),href:null!=n?n:void 0,onClick:e=>{null!=n&&(e.metaKey||e.altKey)||(e.preventDefault(),r(e))},role:"button",rel:"noreferrer noopener",target:"_blank",title:c,tabIndex:null!=u?u:void 0,children:t})};var i=r(n(99964)),a=r(n(94184)),o=r(n(56720)),s=n(85893);const l={cursor:"ajgl1lbb"}},40249:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.Type=t.ContextMenuManagerImpl=t.ContextMenuManager=void 0;var i=r(n(81109)),a=r(n(40436)),o=n(67294),s=n(88102),l=n(60811),c=r(n(14296)),d=n(84387),u=r(n(33358)),p=r(n(2773)),f=n(85893);const h={MENU:"MENU",TOOLTIP:"TOOLTIP"};t.Type=h;const _={originX:0,originY:0,offsetX:0,offsetY:0,dirX:l.DirX.RIGHT,dirY:l.DirY.BOTTOM,type:l.MenuType.dropdown};function g(e,t,n,r){switch(e){case l.DirX.RIGHT:return t;case l.DirX.LEFT:return n;case l.DirX.CENTER:return t+r/2}}class m extends o.Component{constructor(){super(...arguments),this.state={},this._setRefMenuContainer=e=>{this._refMenuContainer=e},this._setRefDropdown=e=>{this._refDropdown=e},this._handleClose=e=>{(!e||this.state.menu&&this.state.menu.uim===e)&&this.setState({menu:void 0})},this._handleOpen=(e,t)=>{var n;let{menu:r}=this.state;(null===(n=r)||void 0===n?void 0:n.uim)&&r.uim.pop(),r=(0,i.default)((0,i.default)((0,i.default)({},_),{},{dirX:c.default.isRTL()?l.DirX.LEFT:l.DirX.RIGHT},e),{},{key:Math.random(),isTemporaryRender:!0}),e.event&&(r=(0,i.default)((0,i.default)({},r),{},{originX:e.event.clientX,originY:e.event.clientY,offsetX:null!=e.offsetX?e.offsetX:10,offsetY:null!=e.offsetY?e.offsetY:10}),e.event.stopPropagation()),this.setState({menu:r},(()=>{var e;t(null===(e=this._refMenuContainer)||void 0===e?void 0:e.getElement()),this._setDirection()}))},this.isOpen=()=>null!=this.state.menu}componentDidMount(){const e=this.props.type===h.MENU?"open_context_menu":"open_tooltip";this.props.listeners.add(s.Cmd,e,this._handleOpen);const t=this.props.type===h.MENU?"close_context_menu":"close_tooltip";this.props.listeners.add(s.Cmd,t,this._handleClose)}_setDirection(){if(!this._refDropdown)return;const e=this._refDropdown.clientWidth,t=this._refDropdown.clientHeight+10,n=window.innerWidth,r=window.innerHeight;if(!this.state.menu)return;const{anchor:a,originX:o,originY:s,offsetX:c,offsetY:d,dirX:u,dirY:p}=this.state.menu;let f=o,h=o,_=s,m=s,y=0;if(a&&a instanceof HTMLElement){const e=a.getBoundingClientRect();f=e.left,h=e.right,m=e.bottom,_=e.top,y=a.offsetWidth}let E=u;E===l.DirX.RIGHT&&f+e>n&&h-e>0?E=l.DirX.LEFT:E===l.DirX.LEFT&&h-e<0&&f+e<n?E=l.DirX.RIGHT:E===l.DirX.CENTER&&(h+e/2>n?E=l.DirX.LEFT:f-e/2<0&&(E=l.DirX.RIGHT));let S,v=p;v===l.DirY.BOTTOM&&m+t+d>r&&_-t>0?v=l.DirY.TOP:v===l.DirY.TOP&&_-0-t<0&&m+t+d<r&&(v=l.DirY.BOTTOM),S=v===l.DirY.TOP?_:m;let T=c,b=d;a||(E===l.DirX.LEFT&&(T=0),v===l.DirY.TOP&&(b=0)),this.setState({menu:(0,i.default)((0,i.default)({},this.state.menu),{},{dirX:E,dirY:v,originX:g(E,f,h,y),originY:S,offsetX:T,offsetY:b,isTemporaryRender:!1})})}render(){let e,t="dropdown";if(this.state.menu){const{menu:n,key:r,originX:i,originY:a,offsetX:s,offsetY:c,dirX:d,dirY:p,type:h,autoFocus:_,findFirstItem:g,horizontal:m,isTemporaryRender:y,theme:E}=this.state.menu,S=Array.isArray(n)?n.map((e=>(0,o.cloneElement)(e,{theme:E}))):n;e=(0,f.jsx)(l.Dropdown,{origin:{x:i+s,y:a+c},onRef:this._setRefDropdown,type:h,dirX:d,dirY:p,horizontal:m,autoFocus:_,findFirstItem:g,isTemporaryRender:y,children:(0,f.jsx)(u.default,{ref:this._setRefMenuContainer,children:S})},"key-"+r),t="picker"===h?"dropdown-picker":"dropdown"}return(0,f.jsx)(p.default.Consumer,{children:n=>{var r;return(0,f.jsx)(p.default.Provider,{value:(null===(r=this.state.menu)||void 0===r?void 0:r.uim)||n,children:(0,f.jsx)(a.default,{transitionName:t,children:e})})}})}}t.ContextMenuManagerImpl=m,m.displayName="ContextMenuManagerImpl";const y=(0,d.ListenerHOC)(m);t.ContextMenuManager=class extends y{isOpen(){return this.getComponent().isOpen()}}},11933:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.Clipboard=t.APP_TEXT_MIMETYPE=void 0;var i=r(n(96026)),a=r(n(16579)),o=r(n(65345)),s=n(9964),l=r(n(5818)),c=r(n(56695)),d=r(n(48442)),u=n(52596);t.APP_TEXT_MIMETYPE="application/whatsapp";class p{constructor(e){this._value=e||""}append(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return this._value=[this.toString(),e].filter((e=>e)).join(t),this}prepend(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return this._value=[e,this.toString()].filter((e=>e)).join(t),this}toString(){return this._value}}class f{static fromEl(e){const t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,s.isCopyable)(e))?(0,s.getAppTextTemplateData)(e):null;return new f("",t)}static getTemplate(e){let t=e;if(!t)return null;if(!(t instanceof HTMLElement)){if(!t.parentElement)return null;t=t.parentElement}let n=new f("${appText}"),r=t,i=5,a=0,o=!1;for(;r&&a<i;)r instanceof HTMLElement&&(0,s.isCopyable)(r)?(n=f.fromEl(r,!0).append(n.toString()),o=o||!n.isPlainText(),i=5):a++,r=r.parentElement;return o?n.toString():null}constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0;this._innerAppText=new p(e),this._appTextTemplate=t}append(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return this._innerAppText.append(e,t),this}prepend(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return this._innerAppText.prepend(e,t),this}isPlainText(){return Boolean(!this._appTextTemplate&&""!==this._appTextTemplate)}toString(){return this._appTextTemplate||""===this._appTextTemplate?this._appTextTemplate.replace(/\$\{appText\}/g,this._innerAppText.toString()):this._innerAppText.toString()}}class h{constructor(e,t){const n=e||"";this._plainText=new p(n),t&&(this._appText=new f(n,t))}static _copyableChildrenToClipboard(e){const t=(0,s.findCopyableChildren)(e);return(0,a.default)(t,((e,t)=>e.prepend(this.fromEl(t),"\n")),new h)}static _pruneRangeNodes(e,t,n){let r=t.cloneContents().childNodes,i=(0,l.default)(t);const a=[],o=[];for(let t=0;t<r.length;t++){const s=r[t],l=i[t].parentElement;(n||(0,u.isSelectable)(i[t])||(0,u.hasSelectableChildren)(s))&&(e.contains(i[t])||l&&l.contains(e))&&(a.push(s),o.push(i[t]))}r=a,i=o;let s=n;if(1===r.length){const e=r[0];s=s||(0,u.isSelectable)(i[0]),s||(r=(0,u.findSelectableChildren)(e,s),s=!1)}return{rangeNodes:r,parentIsSelectable:s}}static fromCopyableEl(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=(0,s.getPrePlainTextData)(e)||"",r=new h(n),i=(0,s.getPlainTextData)(e),o=(0,s.getAppTextTemplateData)(e),l=new h("",o);return i||""===i?(l.appendPlainText(i),r.append(l)):t||(0,u.isSelectable)(e)?(0,c.default)(e,"br")?r.appendPlainText("\n"):((0,a.default)(e.childNodes,((e,t)=>{const n=(0,c.default)(t,"div")?"\n":"";return e.prepend(this.fromSelectableNode(t),n)}),l),r.append(l)):(l.append(this._copyableChildrenToClipboard(e)),r.append(l))}static fromEl(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return(0,s.isCopyable)(e)||t?this.fromCopyableEl(e,t):this._copyableChildrenToClipboard(e)}static fromNode(e,t){return e instanceof HTMLElement?this.fromEl(e,t):t?this.fromSelectableNode(e):new h}static fromRange(e,t){const n=t.commonAncestorContainer,r=f.getTemplate(n),i=new h("",r),o=(0,u.isSelectAll)(n)?n:(0,u.findSelectAllParent)(n);if(o instanceof HTMLElement)return i.append(this.fromCopyableEl(o));const{parentIsSelectable:s,rangeNodes:l}=this._pruneRangeNodes(e,t,(0,u.isSelectable)(n));return(0,a.default)(l,((e,t)=>{const n=this.fromNode(t,s),r=s||n.toAppString().endsWith("\n")?"":"\n";return e.prepend(n,r)}),i)}static fromSelectableNode(e){if((0,d.default)(e))return new h(e.textContent);if(!(e instanceof HTMLElement))return new h;const t=new h;return(0,o.default)(e,(e=>(0,d.default)(e)||(0,s.isCopyable)(e)?[]:Array.from(e.childNodes)),(n=>{let r;(0,s.isCopyable)(n)&&n instanceof HTMLElement?(r=this.fromCopyableEl(n,!0),t.append(r)):(0,d.default)(n)?t.appendPlainText(n.textContent):(0,c.default)(e,"br")&&t.appendPlainText("\n")})),t}static fromSelection(e,t){const n=new h;return(0,i.default)(t.rangeCount).map((n=>{const r=t.getRangeAt(n);return this.fromRange(e,r)})).reduce(((e,t)=>e.append(t,"\n")),n)}append(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return e.hasAppText()?(this._appText=this._appText||new f(this.toPlainString()),this._appText.append(e.toAppString(),t)):this.hasAppText()&&this._appText.append(e.toAppString(),t),this._plainText.append(e.toPlainString(),t),this}appendPlainText(e){return this.append(new h(e)),this}prepend(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return e.hasAppText()?(this._appText=this._appText||new f(this.toPlainString()),this._appText.prepend(e.toAppString(),t)):this.hasAppText()&&this._appText.prepend(e.toAppString(),t),this._plainText.prepend(e.toPlainString(),t),this}hasAppText(){return Boolean(this._appText)}toAppText(){return this.hasAppText()?this._appText:new f(this.toPlainString())}toPlainString(){return this._plainText.toString()}toAppString(){return this.hasAppText()?this._appText.toString():this.toPlainString()}}t.Clipboard=h},9964:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.Copyable=t.COPYABLE_CSS_SELECTOR=t.COPYABLE_CSS_CLASS=void 0,t.CopyableCode=function(e){return(0,u.jsx)("code",(0,a.default)({},P(e)))},t.CopyableDel=function(e){return(0,u.jsx)("del",(0,a.default)({},P(e)))},t.CopyableDiv=function(e){return(0,u.jsx)("div",(0,a.default)({},P(e)))},t.CopyableEm=function(e){return(0,u.jsx)("em",(0,a.default)({},P(e)))},t.CopyableImg=void 0,t.CopyableLink=function(e){const t=P(e),n=t.href;if(n&&!o.default.hasValidUrlScheme(n))return(0,u.jsx)("span",{});return(0,u.jsx)("a",(0,a.default)({},t))},t.CopyableSpan=function(e){return(0,u.jsx)("span",(0,a.default)({},P(e)))},t.CopyableStrong=function(e){return(0,u.jsx)("strong",(0,a.default)({},P(e)))},t.CopyableUl=function(e){return(0,u.jsx)("ul",(0,a.default)({},P(e)))},t.PLAIN_TEXT_DATA_ATTR=void 0,t.findCopyableChildren=function(e){const t=Array.from(e.querySelectorAll(g));return t.filter((e=>!t.some((t=>t!==e&&t.contains(e)))))},t.getAppTextTemplateData=function(e){return e.dataset[T]},t.getPlainTextData=function(e){return e.dataset[y]},t.getPrePlainTextData=function(e){return e.dataset[S]},t.isCopyable=function(e){return e instanceof HTMLElement&&(0,d.default)(e,g)};var i=r(n(6479)),a=r(n(81109)),o=r(n(76139)),s=r(n(94184)),l=n(67294),c=r(n(19198)),d=r(n(20603)),u=n(85893);const p=["forwardedRef"],f=["element"],h=["plainText","prePlainText","appTextTemplate"],_="copyable-text";t.COPYABLE_CSS_CLASS=_;const g=".copyable-text";t.COPYABLE_CSS_SELECTOR=g;const m="data-plain-text",y=(0,c.default)(m);t.PLAIN_TEXT_DATA_ATTR=y;const E="data-pre-plain-text",S=(0,c.default)(E),v="data-app-text-template",T=(0,c.default)(v);const b=(0,l.forwardRef)(((e,t)=>{var n;let{forwardedRef:r}=e;const o=P((0,i.default)(e,p));return(0,u.jsx)("img",(0,a.default)((0,a.default)({ref:null!=r?r:t},o),{},{alt:null!==(n=o.alt)&&void 0!==n?n:""}))}));function C(e,t){let{element:n}=e,r=(0,i.default)(e,f);return(0,u.jsx)(n,(0,a.default)((0,a.default)({},P(r)),{},{ref:t}))}t.CopyableImg=b;const A=(0,l.forwardRef)(C);function P(e){let{plainText:t,prePlainText:n,appTextTemplate:r}=e,o=(0,i.default)(e,h);const l=(0,a.default)({},o);return l.className=(0,s.default)(o.className,_),null!=t&&(l[m]=t),null!=n&&(l[E]=n),null!=r&&(l[v]=r),l}t.Copyable=A},5354:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(81109)),a=r(n(6479)),o=r(n(94184)),s=n(67294),l=n(11933),c=r(n(97922)),d=n(85893);const u=["canCut","children","className","testid"];function p(e,t){let{canCut:n,children:r,className:s,testid:l}=e,p=(0,a.default)(e,u);const f=(0,i.default)((0,i.default)({},p),{},{className:(0,o.default)(s,c.default.noop,"copyable-area"),onCopy:_,onCut:n?g:void 0});return(0,d.jsx)("div",(0,i.default)((0,i.default)({},f),{},{ref:t,"data-testid":l,children:r}))}var f=(0,s.forwardRef)(p);function h(e){const t=e.currentTarget;if(!(t instanceof HTMLElement))return!1;const n=l.Clipboard.fromSelection(t,window.getSelection());e.clipboardData.setData("text/plain",n.toPlainString());try{e.clipboardData.setData(l.APP_TEXT_MIMETYPE,n.toAppString())}catch(e){}return!0}function _(e){h(e,window.getSelection())&&(e.stopPropagation(),e.preventDefault())}function g(e){const t=window.getSelection();h(e)&&(t.deleteFromDocument(),e.stopPropagation(),e.preventDefault(),e.target.dispatchEvent(new Event("input",{bubbles:!0,cancelable:!0})))}t.default=f},52596:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.Selectable=t.SELECTABLE_INPUT_CSS_CLASS=t.SELECTABLE_CSS_SELECTOR=t.SELECTABLE_CSS_CLASS=void 0,t.SelectableCode=function(e){const t=O(e);return e.selectable?(0,p.jsx)(c.CopyableCode,(0,a.default)({},t)):(0,p.jsx)("code",(0,a.default)({},t))},t.SelectableDel=function(e){const t=O(e);return e.selectable?(0,p.jsx)(c.CopyableDel,(0,a.default)({},t)):(0,p.jsx)("del",(0,a.default)({},t))},t.SelectableDiv=function(e){const t=O(e);return e.selectable?(0,p.jsx)(c.CopyableDiv,(0,a.default)({},t)):(0,p.jsx)("div",(0,a.default)({},t))},t.SelectableEm=function(e){const t=O(e);return e.selectable?(0,p.jsx)(c.CopyableEm,(0,a.default)({},t)):(0,p.jsx)("em",(0,a.default)({},t))},t.SelectableImg=void 0,t.SelectableLink=function(e){const t=O(e),n=e.href;if(n&&!o.default.hasValidUrlScheme(n))return(0,p.jsx)("span",{});return e.selectable?(0,p.jsx)(c.CopyableLink,(0,a.default)({},t)):(0,p.jsx)("a",(0,a.default)({},t))},t.SelectableSpan=function(e){const t=O(e);return e.selectable?(0,p.jsx)(c.CopyableSpan,(0,a.default)({},t)):(0,p.jsx)("span",(0,a.default)({},t))},t.SelectableStrong=function(e){const t=O(e);return e.selectable?(0,p.jsx)(c.CopyableStrong,(0,a.default)({},t)):(0,p.jsx)("strong",(0,a.default)({},t))},t.SelectableUl=function(e){const t=O(e);return e.selectable?(0,p.jsx)(c.CopyableUl,(0,a.default)({},t)):(0,p.jsx)("ul",(0,a.default)({},t))},t.createSelectableElement=function(e,t){const n=document.createElement(e);n.setAttribute("class",m),(t||""===t)&&(n.dataset[c.PLAIN_TEXT_DATA_ATTR]=t);return n},t.findSelectAllParent=function(e){if(!C(e))return null;let t,n=e,r=0;for(;n&&r<5;){if(b(n)&&n instanceof HTMLElement){t=n;break}n=n.parentElement,r++}return t},t.findSelectableChildren=function(e,t){if(!(e instanceof HTMLElement))return[];if(t||T(e))return Array.from(e.childNodes);const n=Array.from(e.querySelectorAll(y));return n.filter((e=>!n.some((t=>t!==e&&t.contains(e)))))},t.hasSelectableChildren=function(e){if(!(e instanceof HTMLElement))return!1;return!!e.querySelector(y)},t.isSelectAll=b,t.isSelectable=T;var i=r(n(6479)),a=r(n(81109)),o=r(n(76139)),s=r(n(94184)),l=n(67294),c=n(9964),d=r(n(20603)),u=r(n(8581)),p=n(85893);const f=["forwardedRef"],h=["element"],_=["className","plainText","prePlainText","appTextTemplate","selectable","selectAll"],g="selectable-text";t.SELECTABLE_CSS_CLASS=g;const m=`${c.COPYABLE_CSS_CLASS} selectable-text`,y=".selectable-text";t.SELECTABLE_CSS_SELECTOR=y;const E=m;t.SELECTABLE_INPUT_CSS_CLASS=E;const S="select-all",v=".select-all";function T(e){if(!e)return!1;if(!(e instanceof HTMLElement)){return T(e.parentElement)}return(0,d.default)(e,y)||(0,d.default)(e,".selectable-text *")}function b(e){return!!e&&(e instanceof HTMLElement?(0,d.default)(e,v):b(e.parentElement))}function C(e){return!!e&&(e instanceof HTMLElement?(0,d.default)(e,".select-all *"):C(e.parentElement))}const A=(0,l.forwardRef)(((e,t)=>{var n;let{forwardedRef:r}=e,o=(0,i.default)(e,f);const s=O(o);return o.selectable?(0,p.jsx)(c.CopyableImg,(0,a.default)({forwardedRef:t},s)):(0,p.jsx)("img",(0,a.default)((0,a.default)({ref:t},s),{},{alt:null!==(n=o.alt)&&void 0!==n?n:""}))}));function P(e,t){let{element:n}=e,r=(0,i.default)(e,h);const o=O(r);return r.selectable?(0,p.jsx)(c.Copyable,(0,a.default)((0,a.default)({element:n},o),{},{ref:t})):(0,p.jsx)(n,(0,a.default)((0,a.default)({},o),{},{ref:t}))}t.SelectableImg=A;const M=(0,l.forwardRef)(P);function O(e){let{className:t,plainText:n,prePlainText:r,appTextTemplate:a,selectable:o,selectAll:l}=e;const c=(0,i.default)(e,_);return o&&(c.plainText=n,c.prePlainText=r,c.appTextTemplate=a),c.className=(0,s.default)(t,u.default.noop,{[g]:o,[S]:o&&l}),c}t.Selectable=M},19198:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return(0,i.default)(e.replace(/^data-/,""))};var i=r(n(68929))},56695:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return e instanceof HTMLElement&&e.tagName.toLowerCase()===t.toLowerCase()}},20603:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(!(e instanceof HTMLElement))return!1;return n.call(e,t)};const n=Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector},48442:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return Boolean(e&&3===e.nodeType)}},5818:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(e.collapsed)return[];if(e.startContainer===e.endContainer)return(0,a.default)(e.startContainer)?[e.startContainer]:Array.prototype.slice.call(e.startContainer.childNodes,e.startOffset,e.endOffset);const t=e.commonAncestorContainer.childNodes;let n,r;n=e.commonAncestorContainer===e.startContainer?t[0]:o(e.commonAncestorContainer,e.startContainer);(0,i.default)(n,"range is invalid: start missing"),r=e.commonAncestorContainer===e.endContainer?t[t.length-1]:o(e.commonAncestorContainer,e.endContainer);(0,i.default)(r,"range is invalid: end missing");const s=r,l=e=>null==e?void 0:e.nextSibling,c=[];let d=n;for(;d&&d!==s;)c.push(d),d=l(d)||l(d.parentNode);return c.push(s),c};var i=r(n(41143)),a=r(n(48442));function o(e,t){let n=t;for(;n.parentNode!==e;){if(!n.parentNode)return null;n=n.parentNode}return n}},60811:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.REACTION_DETAILS_WIDTH=t.MenuType=t.EMOJI_PICKER_WIDTH=t.Dropdown=t.DirY=t.DirX=void 0;var i=r(n(81109)),a=r(n(45095)),o=n(81703),s=r(n(45120)),l=r(n(52013)),c=r(n(94184)),d=n(67294),u=n(88102),p=r(n(23257)),f=r(n(3222)),h=n(29424),_=r(n(14296)),g=n(85893);const m=parseInt(p.default["-emoji-picker-width"].replace(/px$/,""),10);t.EMOJI_PICKER_WIDTH=m;const y=parseInt(p.default["-reaction-details-width"].replace(/px$/,""),10);t.REACTION_DETAILS_WIDTH=y;t.MenuType={dropdown:"dropdown",dropdown_menu:"dropdown_menu",dropdown_text:"dropdown_text",menu:"menu",picker:"picker",emoji_picker:"emoji_picker",sticker_picker:"sticker_picker",color_picker:"color_picker",tooltip:"tooltip",reaction_details_pane:"reaction_details_pane",reaction_send_tray:"reaction_send_tray"};const E=n(76672).Mirrored(["LEFT","CENTER","RIGHT"]);t.DirX=E;const S=n(76672).Mirrored(["TOP","BOTTOM"]);function v(e){switch(e){case E.RIGHT:return E.LEFT;case E.LEFT:return E.RIGHT;case E.CENTER:return E.CENTER}}function T(e,t,n){return e!==E.CENTER||null==t||null==n?null:{left:t.offsetWidth/2-n.offsetWidth/2}}t.DirY=S;class b extends d.Component{constructor(){super(...arguments),this.state={showShortcuts:!1,keyboard:!1,selected:null},this._setRefDropdown=e=>{this._refDropdown=e,this.props.onRef&&this.props.onRef(e)},this._setRefNib=e=>{this._refNib=e},this._setRefList=e=>{this._refList=e},this._floaterEscapeOverlap=()=>{this._refList&&this._refDropdown&&!this.props.isTemporaryRender&&u.Cmd.floaterEscapeOverlap(this._refDropdown,10)},this._handleMouseMove=()=>{l.default.focus(this._refDropdown),this.setState({keyboard:!1})},this._selectPrevious=e=>{C(e);const{activeChildren:t,currentlyFocusedIndex:n}=this._getActiveChildren();0!==t.length&&this._focusNewActiveChild(t,n-1)},this.selectNext=e=>{C(e);const{activeChildren:t,currentlyFocusedIndex:n}=this._getActiveChildren();0!==t.length&&this._focusNewActiveChild(t,n+1)},this._getActiveChildren=()=>{const e=Array.from((0,a.default)(this._refList,"this._refList").querySelectorAll("li:not(.dropdown-item-disabled)"));return{activeChildren:e,currentlyFocusedIndex:e.indexOf(this.state.selected)}},this._focusNewActiveChild=(e,t)=>{const n=(t<0?e.length-1:t)%e.length;l.default.focus(e[n]),this.setState({keyboard:!0,selected:e[n]})},this.close=e=>{e.preventDefault();const{uim:t}=this.props;t&&t.uie.requestDismiss()},this.default=e=>{const t=this.props.onDefault;if(t){s.default.shouldIndicateFocus();const{uim:n}=this.props;n&&n.uie.requestDismiss(),t(e)}},this._resetSelected=e=>{e.stopPropagation(),l.default.focus(this._refDropdown),this.setState({selected:void 0})}}getElement(){return this._refDropdown}_allowKeyboard(){const e=this.props.type;return"emoji_picker"!==e&&"reaction_details_pane"!==e&&"reaction_send_tray"!==e&&"sticker_picker"!==e&&"color_picker"!==e&&"dropdown_text"!==e}componentDidMount(){if(this._floaterEscapeOverlap(),!this._allowKeyboard())return;const{autoFocus:e,children:t,findFirstItem:n}=this.props;if(e){var r;const e=null===(r=this._refList)||void 0===r?void 0:r.querySelector("[tabindex]");let i;n&&e||this._refList&&this._refList.firstChild instanceof HTMLDivElement&&e?i=e:this._refList&&this._refList.children.length>0?i=this._refList.children[0]:null!=t&&(i=d.Children.toArray(t)[0]),l.default.focus(i),this.setState({keyboard:!0,selected:i})}else l.default.focus(this._refDropdown)}componentDidUpdate(e){e.isTemporaryRender&&!this.props.isTemporaryRender&&this._floaterEscapeOverlap()}getStyle(){var e;const{dirX:t,dirY:n,flipOnRTL:r,origin:a}=this.props,s={},l=null!==(e=this.props.style)&&void 0!==e?e:{},[c,d]=function(e,t,n){return[n&&_.default.isRTL()?v(e):e,t]}(t,n,r);if(s[(0,o.compatPrefix)("transformOrigin")]=function(e,t){const n=v(e);return`${t===S.TOP?S.BOTTOM:S.TOP} ${n}`}(c,d),!a)return(0,i.default)((0,i.default)({},l),s);const u=function(e,t,n,r){var i,a;const o={};switch(e){case E.RIGHT:o.left=Math.min(window.innerWidth-(null!==(i=null==r?void 0:r.offsetWidth)&&void 0!==i?i:0)-32,n.x);break;case E.LEFT:o.right=window.innerWidth-n.x;break;case E.CENTER:o.left=n.x-(null!==(a=null==r?void 0:r.offsetWidth)&&void 0!==a?a:0)/2,o.marginLeft=0,o.marginRight=0}switch(t){case S.BOTTOM:{o.top=n.y;const e=null==r?void 0:r.offsetHeight;if(null!=e){const t=window.innerHeight-e-32;o.top=Math.min(t,n.y)}break}case S.TOP:o.bottom=window.innerHeight-n.y}return o}(c,d,a,this._refDropdown);return(0,i.default)((0,i.default)((0,i.default)({},l),s),u)}render(){const e=this.props,t=e.type,n=(0,c.default)({[p.default.container]:"dropdown"===t||"dropdown_menu"===t||"emoji_picker"===t||"sticker_picker"===t||"color_picker"===t||"reaction_details_pane"===t||"reaction_send_tray"===t||"dropdown_text"===t,[p.default.right]:"dropdown_menu"===t,[p.default.icons]:"menu"===t,[p.default.picker]:"picker"===t,[p.default.emoji]:"emoji_picker"===t,[p.default.sticker]:"sticker_picker"===t,[p.default.colorPicker]:"color_picker"===t,[p.default.reactionDetails]:"reaction_details_pane"===t,[p.default.reactionSendTray]:"reaction_send_tray"===t,[p.default.text]:"dropdown_text"===t,[p.default.tooltip]:"tooltip"===t,[p.default.inverse]:("picker"===t||"emoji_picker"===t||"sticker_picker"===t||"color_picker"===t||"reaction_details_pane"===t||"reaction_send_tray"===t||"dropdown_text"===t||"tooltip"===t)&&e.dirX===E.LEFT,[p.default.inverseVertical]:("emoji_picker"===t||"sticker_picker"===t||"color_picker"===t||"reaction_details_pane"===t||"reaction_send_tray"===t||"dropdown_text"===t)&&e.dirY===S.TOP}),r="picker"===t||"emoji_picker"===t||"sticker_picker"===t||"dropdown_text"===t||"tooltip"===t?(0,g.jsx)("div",{"data-testid":"tooltip-nib",ref:this._setRefNib,className:p.default.nib,"data-animate-dropdown-nib":!0,style:T(this.props.dirX,this._refDropdown,this._refNib)}):null;if(this._allowKeyboard()){const t={enter:this.default,tab:C,"shift+tab":C,up:()=>{},down:()=>{}};return e.horizontal?(t[_.default.LR("left","right")]=this._selectPrevious,t[_.default.LR("right","left")]=this.selectNext,t[_.default.LR("up","down")]=this._selectPrevious,t[_.default.LR("down","up")]=this.selectNext):(t.up=this._selectPrevious,t.down=this.selectNext,t[_.default.LR("left","right")]=this.close,t[_.default.LR("right","left")]=this.default),(0,g.jsxs)(h.HotKeys,{ref:this._setRefDropdown,handlers:t,className:n,style:this.getStyle(),onMouseMove:this.state.keyboard?this._handleMouseMove:null,onMouseUp:this._resetSelected,children:[(0,g.jsx)("ul",{"data-testid":e.testid,ref:this._setRefList,className:p.default.items,children:e.children}),r]})}return(0,g.jsxs)("div",{ref:this._setRefDropdown,className:n,style:this.getStyle(),"data-testid":e.testid,children:[e.children,r]})}}function C(e){e.stopPropagation(),e.preventDefault()}b.defaultProps={type:"dropdown",dirX:E.RIGHT,dirY:S.BOTTOM},b.displayName="DropdownImpl";const A=(0,f.default)(b);t.Dropdown=A},12591:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ExternalLink=void 0,t.openExternalLink=function(e){if(!s.default.hasValidUrlScheme(e))return void(e.toLowerCase().startsWith("javascript:")&&(__LOG__(4,void 0,new Error,!0)`Bad url: ${e}`,SEND_LOGS("URL error")));const t=document.createElement("a");t.href=e,t.target="_blank",t.rel="noopener noreferrer",t.style.display="none",document.body&&document.body.appendChild(t);t.click(),document.body&&document.body.removeChild(t)};var i=n(64331),a=r(n(99964)),o=r(n(64369)),s=r(n(76139)),l=n(67294),c=(r(n(77793)),r(n(54889))),d=n(85893);function u(e){const t=(0,l.useRef)(),n=e=>{var n;(0,c.default)(e)&&(null===(n=t.current)||void 0===n||n.click())},{children:r,className:u,href:p,isLongTemplateUrl:f,onClick:h,a8nText:_,"aria-label":g}=e;return s.default.hasValidUrlScheme(p)?f?(0,d.jsxs)("a",{ref:t,rel:"noopener noreferrer",className:u,href:p,target:"_blank",onClick:h,onKeyDown:n,"aria-label":g,children:[(0,i.substring)(p,0,o.default.TEMPLATE_URL_START),(0,d.jsx)("span",{children:""}),(0,i.substring)(p,p.length-o.default.TEMPLATE_URL_END,p.length)]}):(0,d.jsx)("a",{ref:t,rel:"noopener noreferrer",className:u,href:p,target:"_blank",onClick:h,onKeyDown:n,"data-a8n":a.default.key(_),"aria-label":g,children:r}):(p.toLowerCase().startsWith("javascript:")&&(__LOG__(4,void 0,new Error,!0)`Bad url: ${p}`,SEND_LOGS("URL error")),null)}const p=(0,l.memo)(u);t.ExternalLink=p},24113:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DefaultFavicon=function(e){let{children:t}=e;return(0,r.useEffect)((()=>{(0,i.setTitleAndIcon)(0)}),[]),t},t.ErrorFavicon=function(e){let{children:t}=e;return(0,r.useEffect)((()=>{(0,i.setTitleAndIcon)(-1)}),[]),t};var r=n(67294),i=n(11728)},29623:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.FlexRow=t.FlexContainer=t.FlexColumn=void 0;var i=r(n(81109)),a=r(n(6479)),o=r(n(99964)),s=r(n(94184)),l=n(67294),c=r(n(56720)),d=n(85893);const u=["a8nText","align","as","direction","justify","wrap","children","className","xstyle","style"],p={flex:{display:"p357zi0d",minWidth:"ktfrpxia",minHeight:"nu7pwgvd"},directionHorizontal:{flexDirection:"sap93d0t"},directionVertical:{flexDirection:"f8m0rgwh"},directionHorizontalReverse:{flexDirection:"v76qf5v1"},directionVerticalReverse:{flexDirection:"qzvtbs9h"},justifyStart:{justifyContent:"fhf7t426"},justifyCenter:{justifyContent:"ac2vgrno"},justifyEnd:{justifyContent:"kcgo1i74"},justifyAll:{justifyContent:"o4u7okr9"},justifyAround:{justifyContent:"j1p1mz06"},justifyEvenly:{justifyContent:"s1e5xcja"},alignCenter:{alignItems:"gndfcl4n"},alignStart:{alignItems:"r15c9g6i"},alignEnd:{alignItems:"r6jd426a"},alignStretch:{alignItems:"elxb2u3l"},alignBaseline:{alignItems:"e4eao3g2"},wrap:{flexWrap:"lkhkxwyq"},wrapReverse:{flexWrap:"ns59xd2u"}},f=(0,l.forwardRef)((function(e,t){const{a8nText:n,align:r="start",as:l="div",direction:f,justify:h="start",wrap:_="nowrap",children:g,className:m,xstyle:y,style:E}=e,S=(0,a.default)(e,u);return(0,d.jsx)(l,(0,i.default)((0,i.default)({className:(0,s.default)((0,c.default)(p.flex,"start"===h&&p.justifyStart,"center"===h&&p.justifyCenter,"end"===h&&p.justifyEnd,"all"===h&&p.justifyAll,"around"===h&&p.justifyAround,"evenly"===h&&p.justifyEvenly,"vertical"===f&&p.directionVertical,"horizontal"===f&&p.directionHorizontal,"vertical-reverse"===f&&p.directionVerticalReverse,"horizontal-reverse"===f&&p.directionHorizontalReverse,"start"===r&&p.alignStart,"center"===r&&p.alignCenter,"end"===r&&p.alignEnd,"stretch"===r&&p.alignStretch,"baseline"===r&&p.alignBaseline,"wrap"===_&&p.wrap,"wrap-reverse"===_&&p.wrapReverse,y),m),ref:t,style:E,"data-a8n":o.default.key(n)},S),{},{children:g}))}));t.FlexContainer=f,f.displayName="FlexContainer";const h=(0,l.forwardRef)((function(e,t){return(0,d.jsx)(f,(0,i.default)((0,i.default)({},e),{},{direction:"horizontal",ref:t,children:e.children}))}));t.FlexRow=h,h.displayName="FlexRow";const _=(0,l.forwardRef)((function(e,t){return(0,d.jsx)(f,(0,i.default)((0,i.default)({},e),{},{direction:"vertical",ref:t,children:e.children}))}));t.FlexColumn=_,_.displayName="FlexColumn"},48846:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(81109)),a=r(n(15206)),o=n(67294),s=r(n(56720)),l=n(85893);const c={flexItem:{flexGrow:"tvf2evcx",flexShrink:"m0h2a7mj",flexBasis:"lb5m6g5c",order:"j7l1k36l",minWidth:"ktfrpxia",minHeight:"nu7pwgvd"},alignAuto:{alignSelf:"gjuq5ydh"},alignStart:{alignSelf:"ex3gcxaf"},alignCenter:{alignSelf:"o2es7gts"},alignEnd:{alignSelf:"rwlvdxyg"},alignStretch:{alignSelf:"l33m68ws"}},d=(0,o.forwardRef)((function(e,t){const{a8nText:n,align:r="auto",as:o="div",basis:d,xstyle:u,children:p,order:f,grow:h,shrink:_,style:g}=e,m={flexBasis:"string"==typeof d||null==d?d:`${d}px`,flexGrow:h,flexShrink:_,order:f};return(0,l.jsx)(o,{className:(0,s.default)(c.flexItem,"auto"===r&&c.alignAuto,"start"===r&&c.alignStart,"center"===r&&c.alignCenter,"end"===r&&c.alignEnd,"stretch"===r&&c.alignStretch,u),"data-a8n":n,ref:t,style:(0,i.default)((0,i.default)({},g),(0,a.default)(m)),children:p})}));d.displayName="FlexItem";var u=d;t.default=u},47065:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(89385),a=n(50796),o=r(n(64369)),s=r(n(76139)),l=n(67294),c=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=_(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(35232)),d=r(n(97827)),u=r(n(72668)),p=n(52596),f=r(n(90012)),h=n(85893);function _(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(_=function(e){return e?n:t})(e)}const g=new u.default;class m extends l.Component{static getDerivedStateFromProps(e,t){return e.src!==t.src?{src:e.src,available:!0}:null}constructor(e){super(e),this._refNative=(0,l.createRef)(),this.getElement=()=>this._refNative.current,this._handleLoad=e=>{const{target:t}=e;if(t instanceof HTMLImageElement){const t=this.getImgElement();(null==t?void 0:t.complete)&&this._showImgElement(t),this.props.onLoad&&this.props.onLoad(e),this.setState({loading:!1})}},this._handleError=e=>{this.setState({available:!1});const{src:t,crossOrigin:n,noXHR:r,hasPrivacyChecks:o}=this.props;if(!t||!function(e){return"/"===e[0]||s.default.isHttp(e)}(t))return void this.setState({error:e.error});const l=this.retry;let u;if(l)if(y(l,this.props)){if(!l.noXHR)return;u=l}else{l.release()&&g.remove(l),u=new d.default(t,n,r,o)}else u=new d.default(t,n,r,o);this.retry=u;const p=g.enqueue(u),f=this.props.getUnmountSignal();p.then((()=>{u===this.retry&&(f.aborted||this.setState({available:!0}))})).catch((0,a.filteredCatch)([c.ServerStatusError,c.GaveUpRetry],(e=>{u===this.retry&&(f.aborted||(this.setState({available:!1,error:e}),this.props.onError&&this.props.onError(e)))}))).catch((0,a.filteredCatch)(c.Unmount,(()=>{}))).catch((0,i.catchAbort)((()=>{})))},this._handleContextMenu=e=>{this.props.disableContextMenu&&e.preventDefault()},this.state={src:e.src,available:!0,error:null,loading:!0}}componentDidMount(){if(!this.props.src)return;const e=this.getImgElement();e&&!e.complete&&this._hideImgElement(e)}componentDidUpdate(e){if(y(e,this.props)||this._cancelRetry(),!this.props.src)return;const t=this.getImgElement();t&&!t.complete&&this._hideImgElement(t)}componentWillUnmount(){this._cancelRetry()}_cancelRetry(){if(this.retry){const e=this.retry;e.release()&&g.remove(e)}}getImgElement(){return this._refNative.current}_showImgElement(e){"visible"!==e.style.visibility&&(e.style.visibility="visible")}_hideImgElement(e){"hidden"!==e.style.visibility&&(e.style.visibility="hidden")}render(){const{alt:e,className:t,crossOrigin:n,draggable:r,onClick:i,onMouseMove:a,plainText:s,selectable:l,src:c,style:d,renderLoading:u,renderError:f}=this.props,{available:_,error:g,loading:m}=this.state;if(g&&f)return f(g);const y=Boolean(_&&c);return(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(p.SelectableImg,{ref:this._refNative,plainText:s||"",selectable:Boolean(l),crossOrigin:n?"anonymous":void 0,onError:y?this._handleError:()=>{},onLoad:y?this._handleLoad:()=>{},src:y&&null!=c?c:o.default.ONE_BY_ONE_TRANS_GIF,alt:e,className:t,draggable:r,onClick:i,onMouseMove:a,style:d,onContextMenu:this._handleContextMenu}),m&&u&&u()]})}}function y(e,t){return e.src===t.src&&e.crossOrigin===t.crossOrigin&&e.noXHR===t.noXHR&&e.hasPrivacyChecks===t.hasPrivacyChecks}m.defaultProps={crossOrigin:!0,noXHR:!1,hasPrivacyChecks:!0},m.displayName="Img";var E=(0,f.default)(m);t.default=E},97827:(e,t,n)=>{"use strict";var r=n(59182).default,i=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(89385),o=n(38284),s=(n(88156),i(n(11854))),l=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=d(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(35232)),c=i(n(11339));function d(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(d=function(e){return e?n:t})(e)}t.default=class{constructor(e,t,n,r){this.src=e,this.crossOrigin=t,this.noXHR=n,this.hasPrivacyChecks=r,this.generation=0,this.refCount=0,this.inProgress=!1}key(){return`co:${this.crossOrigin?"Y":"N"},noXHR:${this.noXHR?"Y":"N"},src:${this.src}`}sendXHR(){if(this.noXHR)return Promise.resolve(!0);const e=this.src;this.inProgress=!0;const t=new r,n=(0,o.promiseTimeout)(s.default.get(e,void 0,void 0,t.signal),3e4,"ImgRetryTimeout");return this._xhrRequest={promise:n,controller:t},this._xhrRequest.promise.then((t=>{const{status:n}=t;if(n>=200&&n<400)return!0;if(n>=500){__LOG__(2)`Img:Retry ${e} failed with error code ${n}. Retrying.`;return new c.default.WebcImgError({webcImgErrorCode:n}).commit(),!1}__LOG__(2)`Img:Retry ${e} failed with error code ${n}. Not retrying.`;throw new c.default.WebcImgError({webcImgErrorCode:n}).commit(),new l.ServerStatusError(null,e,n)})).catch((e=>{if(e instanceof l.ServerStatusError)throw e;if(e.name===a.ABORT_ERROR)throw e;return!1})).finally((()=>{this.inProgress=!1}))}release(){return this.refCount--,this.refCount<=0&&(this._xhrRequest&&this._xhrRequest.controller.abort(),!0)}shouldRetain(){return this.refCount>0}}},72668:(e,t,n)=>{"use strict";var r=n(59182).default,i=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(89385),o=i(n(45095)),s=i(n(47259)),l=n(88156),c=n(30764),d=i(n(81602)),u=h(n(35232)),p=h(n(47272));function f(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(f=function(e){return e?n:t})(e)}function h(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=f(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}return r.default=e,n&&n.set(e,r),r}class _{constructor(){this._queue=new Map,this._inDelay=new Map,this._numInProgress=0}static maxInProgressRetry(){return 20}enqueue(e){const t=this._queue.get(e.key());if(t){if(e.hasPrivacyChecks!==t.hasPrivacyChecks){const t=`Img:hasPrivacyChecks shouldn't change ${e.key()}`;return Promise.reject(t)}return t.refCount++,t.deferred.promise}return e.deferred=new l.Resolvable,e.refCount++,this._addToQueue(e),e.deferred.promise}remove(e){const t=e.key();this._queue.delete(t);const n=this._inDelay.get(t);n&&(n.controller.abort(),this._inDelay.delete(t))}_addToQueue(e){const t=e.generation;if(e.generation++,t>10){const t=`Stop retrying ${e.src} after 10 times`;throw new u.GaveUpRetry(t)}const n=e.key();if(0===t)this._queue.set(n,e),this._startProcessing();else{const i=new r,o=i.signal,l=(0,s.default)(p.expDelaySec(t,60,0),o).catch((0,a.catchAbort)((()=>{})));this._inDelay.set(e.key(),{promise:l,controller:i}),l.then((()=>{this._inDelay.delete(n),o.aborted||this._queue.set(n,e),this._startProcessing()}))}}_startProcessing(){this._waitPromise||(this._waitPromise=d.default.waitIfOffline({signal:(new r).signal}).then((()=>{this._waitPromise=null,c.UIBusyTasks.enqueue((()=>{this._processRetries()}))})))}_processRetries(){const e=this._queue.values();let t;for(;(t=e.next())&&!t.done&&!(this._numInProgress>_.maxInProgressRetry());){const e=t.value;this._processRetry((0,o.default)(e,"retry"))}}_processRetry(e){e.inProgress||(e.deferred.resolveWasCalled()?this._queue.delete(e.key()):(this._numInProgress++,e.sendXHR().then((t=>{this._queue.delete(e.key()),t?e.deferred.resolve():e.shouldRetain()&&this._addToQueue(e)})).catch((t=>{this._queue.delete(e.key()),e.deferred.reject(t)})).finally((()=>{this._numInProgress--}))))}}t.default=_},29424:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.SpecialKeyMap=t.HotKeys=void 0;var i=r(n(81109)),a=r(n(6479)),o=r(n(52628)),s=n(67294),l=r(n(78506)),c=r(n(55010)),d=n(89618),u=n(85893);const p=["component","handlers","children","onFocus","onBlur"],f={alt:"Alt",ctrl:"Control",meta:"Meta",shift:"Shift"},h=(0,o.default)(f),_={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,capslock:20,esc:27,space:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,ins:45,del:46,meta:224};t.SpecialKeyMap=_;const g={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},m={option:"alt",command:"meta",return:"enter",escape:"esc",plus:"+"},y=(0,s.forwardRef)(((e,t)=>{const{component:n="div",handlers:r,children:o,onFocus:f=(()=>{}),onBlur:h=(()=>{})}=e,_=(0,a.default)(e,p),m=(0,s.useRef)(!1),y=(0,s.useRef)(),v=(0,l.default)(t,y);(0,c.default)((()=>{if(m.current){const e=document.activeElement;y.current===e&&d.UIM.Manager.refocusTopUie()}}));const T=r&&Object.keys(r).some((e=>null!=r[e]));return(0,u.jsx)(n,(0,i.default)((0,i.default)({ref:v,tabIndex:"-1",onKeyPress:T?e=>{r&&Object.keys(r).forEach((t=>{const n=r[t];if(null==n)return;const i=S(t),[a]=i;g[a]||E(i,e)&&n(e)}))}:null,onKeyDown:T?e=>{r&&Object.keys(r).forEach((t=>{const n=r[t];if(null==n)return;const i=S(t),[a]=i;g[a]&&E(i,e)&&n(e)}))}:null},_),{},{onFocus:e=>{m.current=!0,f(e)},onBlur:e=>{m.current=!1,h(e)},children:o}))}));function E(e,t){let[n,r]=e;return n===t.which&&h.every((e=>r&&e===r?t.getModifierState(r):!t.getModifierState(e)))}function S(e){let[t,n]=e.toLowerCase().split("+");m[t]&&(t=m[t]),m[n]&&(n=m[n]);let r,i=t;return n?(i=n,r=f[t],void 0===r?__LOG__(3)`Invalid HotKey Modifier: ${t}`:void 0===i&&__LOG__(3)`Invalid HotKey Key: ${n}`):void 0===i&&__LOG__(3)`Invalid HotKey Key: ${t}`,[_[i]||i.charCodeAt(0),r]}t.HotKeys=y,y.displayName="HotKeys"},54889:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let t=0;const n=e.charCode,r=e.keyCode;null!=n&&0!==n?t=n:null!=r&&0!==r&&(t=r);return i.has(t)};var r=n(29424);const i=new Set([r.SpecialKeyMap.enter,r.SpecialKeyMap.space])},70842:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=(0,n(67294).createContext)(!1);t.default=r},87956:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.RotateFocus=t.FocusType=void 0;var i=r(n(45120)),a=r(n(52013)),o=n(67294),s=r(n(78506)),l=n(54392),c=r(n(30769)),d=n(63454),u=n(85893);const p=d.FocusType;function f(e,t){const{focusType:n}=e,r=(0,o.useRef)(null),p=(0,s.default)(t,r);return(0,u.jsx)("div",{ref:p,style:e.style,className:c.default.container,onKeyDown:e=>{if(e.metaKey||e.ctrlKey)return;const t=r.current;let o;var s;(e.key===l.KEYBOARD_EVENT_KEY_VALUE.TAB?(e.stopPropagation(),e.preventDefault(),i.default.shouldIndicateFocus(),null!=t&&(o=(0,d.getNextTabbableElement)(t,e.shiftKey?d.TabDirection.BACKWARD:d.TabDirection.FORWARD,n))):null!=t&&t===document.activeElement&&(o=(0,d.getNextTabbableElement)(t,d.TabDirection.FORWARD,n,(e=>"input"===e.nodeName.toLowerCase()))),null!=o)&&(i.default.shouldIndicateFocus(),(s=o).restoreFocus?s.restoreFocus():a.default.focus(s))},tabIndex:"-1",children:e.children})}t.FocusType=p;const h=(0,o.forwardRef)(f);t.RotateFocus=h},22179:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(67294),a=r(n(78506)),o=n(54392),s=r(n(36037)),l=n(63454),c=n(85893);function d(e,t){const n=(0,i.useRef)(null),r=(0,a.default)(t,n);return(0,c.jsx)("div",{ref:r,className:s.default.container,onKeyDown:e=>{if(!e.metaKey&&!e.ctrlKey)return e.key===o.KEYBOARD_EVENT_KEY_VALUE.TAB?(e=>{const t=n.current;if(!t)return;const r=e.shiftKey?l.TabDirection.BACKWARD:l.TabDirection.FORWARD,i=(0,l.getNextTabbableElement)(t,r,l.FocusType.TABBABLE);null!=i&&(e.preventDefault(),i.focus())})(e):void 0},tabIndex:"-1",onBlur:e.onBlur,role:"dialog",children:e.children})}var u=(0,i.forwardRef)(d);t.default=u},63454:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.TabDirection=t.FocusType=void 0,t.getNextTabbableElement=function(e){let t,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s.FORWARD,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o.CUSTOM,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>!0;d===o.TABBABLE?(t=(0,a.tabbable)(e),n=()=>!0):(t=(0,i.default)(Array.from(e.querySelectorAll("[data-tab]")),(e=>parseInt(e.getAttribute("data-tab"),10)||0)),n=c);const p=r===s.FORWARD?1:-1;let f=0;const{activeElement:h}=document;if(h){const e=t.findIndex((e=>e.contains(h)));f=-1===e?0:l(e+p,t.length)}for(let e=0;e<t.length;e++){const r=l(f+e*p,t.length),i=t[r];if(n(i)&&u(i))return i}return null};var i=r(n(89734)),a=n(88388);const o=n(76672).Mirrored(["CUSTOM","TABBABLE"]);t.FocusType=o;const s=n(76672).Mirrored(["FORWARD","BACKWARD"]);function l(e,t){return(e+t)%t}function c(e){if(e.disabled)return!1;const t=parseInt(e.dataset.tab,10);return!("number"!=typeof t||t<0)&&!function(e){if("hidden"===getComputedStyle(e).visibility)return!0;let t=e;for(;t;){if("none"===getComputedStyle(t).display)return!0;t=t.parentElement}return!1}(e)}t.TabDirection=s},56074:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(41609)),a=n(67294),o=r(n(14296)),s=n(52596),l=n(85893);const c=/(.*?)__(\w+?)__/g;function d(e){const{onClick:t,wrapInHiddenToken:n,id:r,plural:d,params:u,className:p,tabIndex:f}=e;return(0,l.jsx)(s.SelectableSpan,{dir:o.default.isRTL()?"rtl":"ltr",selectable:!n,onClick:t,className:p,tabIndex:f,children:(()=>{const e=o.default.t(r,{_plural:d});if(!u||(0,i.default)(u))return e;let t,n;const s=[];for(;t=c.exec(e);){const e=t;s.push(e[1]);const r=e[2];if(r&&null!=u[r]){const e=Array.isArray(u[r])?u[r].map(((e,t)=>(0,l.jsx)(a.Fragment,{children:e},`child_${t}`))):(0,l.jsx)(a.Fragment,{children:u[r]},r);s.push(e)}n=e.index+e[0].length}return"number"==typeof n&&n<e.length&&s.push(e.slice(n)),0===s.length?e:s})()})}d.defaultProps={wrapInHiddenToken:!0};var u=d;t.default=u},81145:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){const e=(0,a.getPrevLogoutReasonCode)();if(null==e)return null;const[t,n]=function(e){let t=null,n=null;switch(e){case u.LOGOUT_REASON_CODE.CLIENT_FATAL:t=s.fbt._("A database error occurred on your browser. Please restart your computer and relink your device.",null,{hk:"2DbWxb"}).toString();break;case u.LOGOUT_REASON_CODE.SYNC_FAIL:t=s.fbt._("Your device could not link due to a sync issue. Please relink your device.",null,{hk:"2VkiMf"}).toString(),n=(0,i.getLinkDeviceFaqUrl)()}return[t,n]}(e);if(null==t||""===t)return null;const r=e===u.LOGOUT_REASON_CODE.CLIENT_FATAL,f=null!=n?(0,p.jsxs)(l.default,{action:()=>{(0,c.openExternalLink)(n)},children:[" ",s.fbt._("Learn more",null,{hk:"2S4fxr"})]}):null;return(0,p.jsxs)("div",{className:(0,o.default)(d.default.wrapper,r?d.default.error:d.default.warn),children:[r?(0,p.jsx)("span",{className:d.default.icon,children:(0,p.jsx)("svg",{width:"44",height:"44",viewBox:"0 0 44 44",xmlns:"http://www.w3.org/2000/svg",children:(0,p.jsx)("path",{d:"M22.0002 0.314301C10.0422 0.314301 0.314453 10.0421 0.314453 22C0.314453 33.958 10.0422 43.6857 22.0002 43.6857C33.9581 43.6857 43.6859 33.958 43.6859 22C43.6859 10.0421 33.9581 0.314301 22.0002 0.314301ZM30.1502 28.5196L28.5197 30.1501L22.0002 23.6305L15.4806 30.1501L13.8501 28.5196L20.3709 22L13.8501 15.4805L15.4806 13.85L22.0002 20.3695L28.521 13.85L30.1515 15.4805L23.6307 22L30.1502 28.5196Z",fill:"currentColor"})})}):(0,p.jsx)("span",{className:d.default.icon,children:(0,p.jsx)("svg",{width:"44",height:"44",viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg",children:(0,p.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M24 46C36.1503 46 46 36.1503 46 24C46 11.8497 36.1503 2 24 2C11.8497 2 2 11.8497 2 24C2 36.1503 11.8497 46 24 46ZM34.6473 31.164L25.2436 14.2344C25.1138 13.9995 24.9312 13.8053 24.7134 13.6705C24.4956 13.5357 24.2499 13.4649 24 13.4649C23.7501 13.4649 23.5044 13.5357 23.2866 13.6705C23.0687 13.8053 22.8861 13.9995 22.7564 14.2344L13.3527 31.164C13.2177 31.4068 13.144 31.6848 13.1392 31.9694C13.1344 32.254 13.1986 32.5349 13.3253 32.783C13.452 33.0312 13.6366 33.2377 13.86 33.3813C14.0834 33.5249 14.3376 33.6004 14.5964 33.6H33.4036C33.6624 33.6004 33.9166 33.5249 34.14 33.3813C34.3634 33.2377 34.548 33.0312 34.6747 32.783C34.8014 32.5349 34.8656 32.254 34.8608 31.9694C34.856 31.6848 34.7823 31.4068 34.6473 31.164ZM25.0909 19.2V26.4H22.9091V19.2H25.0909ZM22.9091 31.2V28.8H25.0909V31.2H22.9091Z",fill:"currentColor"})})}),(0,p.jsxs)("div",{className:d.default.textWrapper,children:[(0,p.jsx)("div",{children:t}),f]})]})};var i=n(21310),a=n(54602),o=r(n(94184)),s=n(48360),l=r(n(29237)),c=n(12591),d=r(n(24242)),u=n(83578),p=n(85893)},46641:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.shouldNotifyReaction=function(e){const{orphan:t,read:n,senderUserJid:r,parentMsgKey:s,reactionText:l}=e;if(!(0,o.receiveReactionsEnabled)())return!1;if(1===t)return!1;if(n)return!1;if((0,a.isReactionByMe)(r))return!1;return!!i.default.fromString(s).fromMe&&""!==l};var i=r(n(65212)),a=n(67811),o=n(57701)},22917:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PERMISSION_DENIED=t.PERMISSION_DEFAULT=t.PERMISSION_ALLOWED=void 0;t.PERMISSION_ALLOWED="granted";t.PERMISSION_DEFAULT="default";t.PERMISSION_DENIED="denied"},11728:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.setIcon=u,t.setTitleAndIcon=function(e){let t=l.default.t(1027);e>0&&(t="("+l.default.n(e)+") "+l.default.t(1027));clearTimeout(c),document.title=document.title+" ",c=setTimeout((()=>{document.title=t}),0),u(e)};var i=n(89385),a=r(n(27722)),o=n(26741),s=n(89721),l=r(n(14296));let c;const d=new a.default;function u(e){if(o.UA.isSafari)return;let t,r;-1===e?(t="favicon-error2",r={low:n(72174),high:n(5079)}):0===e?(t="favicon",r={low:n(68431),high:n(49420)}):e<10?(t="f0"+e,r={low:n(63509)(`./${t}.png`),high:n(76554)(`./${t}.png`)}):e<100?(t="f"+e,r={low:n(63509)(`./${t}.png`),high:n(76554)(`./${t}.png`)}):(t="f00",r={low:n(31213),high:n(95203)});const a={id:t,low:{default:r.low},high:{default:r.high}};d.enqueue(s.AssetLoader.loadAsset(a,s.LOAD_PRIORITY.NOTIFICATION_ICON,!1)).then((e=>e)).then((e=>{const n=document.getElementById("favicon");var r;(null==(r=n)?void 0:r.parentNode)&&r.parentNode.removeChild(r);const i=document.createElement("link");i.setAttribute("id","favicon"),i.setAttribute("rel","shortcut icon"),i.setAttribute("type","image/png"),i.setAttribute("href",e),i.setAttribute("src",e);const a=document.getElementsByTagName("head");(null==a?void 0:a[0])&&a[0].appendChild(i),__LOG__(2)`Favicon updated: ${t}`})).catch((0,i.catchAbort)((()=>{})))}},30351:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getDoNotDisturb=function(){try{var e,t;if("darwin"===process.platform)return(null===(e=window.Native.MacOSNotificationState)||void 0===e?void 0:e.getDoNotDisturb())||(null===(t=window.Native.MacOSNotificationState)||void 0===t?void 0:t.getNotificationState())===r.SESSION_SCREEN_IS_LOCKED;if("win32"===process.platform){var n,a,o,s,l;if((null===(n=window.Native.WindowsNotificationState)||void 0===n?void 0:n.getNotificationState())!==r.QUNS_ACCEPTS_NOTIFICATIONS)return!0;const e="win32"!==process.platform||process.windowsStore?null:"com.squirrel.WhatsApp.WhatsApp",t=e&&"YES"===(null===(a=window.Native.WindowsFocusAssist)||void 0===a||null===(o=a.isPriority(e))||void 0===o?void 0:o.name),c=null===(s=window.Native.WindowsFocusAssist)||void 0===s?void 0:s.getFocusAssist().name;return!!(t&&c===i.ALARMS_ONLY||!t&&[i.PRIORITY_ONLY,i.ALARMS_ONLY].includes(c))||!!(null===(l=window.Native.WindowsQuiteHours)||void 0===l?void 0:l.getIsQuietHours())}}catch(e){__LOG__(3)`getDoNotDisturb failed with error ${e}`}return!1};const r=n(76672).Mirrored(["UNKNOWN","SESSION_SCREEN_IS_LOCKED","SESSION_ON_CONSOLE_KEY","QUNS_NOT_PRESENT","QUNS_BUSY","QUNS_RUNNING_D3D_FULL_SCREEN","QUNS_PRESENTATION_MODE","QUNS_ACCEPTS_NOTIFICATIONS","QUNS_QUIET_TIME","QUNS_APP","UNKNOWN_ERROR"]),i=n(76672).Mirrored(["NOT_SUPPORTED","FAILED","OFF","PRIORITY_ONLY","ALARMS_ONLY"])},24161:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(80648)),a=n(85893);t.default=e=>{let{max:t=100,value:n}=e;return(0,a.jsx)("progress",{value:n,max:t,className:i.default.progress})}},28828:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){const e=(0,o.useRef)(null),[t,n]=(0,o.useState)(m.FIRST_OPEN),r=(0,s.default)();(0,l.useListener)(window,"dpichange",(()=>{r()}));const E=()=>{n(m.READY)},S=e=>{n(m.LOADING),e.stopPropagation(),e.preventDefault()},v=()=>{n(m.REPLAY);const t=e.current;t&&t.play()};let T,b;t===m.FIRST_OPEN&&(T=(0,h.jsx)("div",{className:u.default.overlay,children:(0,h.jsx)(p.Spinner,{size:32})}),b=E);const C=t===m.FIRST_OPEN||t===m.READY||t===m.LOADING?(0,h.jsx)(d.default,{className:(0,a.default)(u.default.poster,{[u.default.hidden]:t===m.FIRST_OPEN}),src:g[c.default.currentRes],onLoad:b},"poster"):null;let A,P;const M=_[c.default.currentRes],O=t!==m.FIRST_OPEN&&t!==m.READY?(0,h.jsx)("video",{autoPlay:!0,className:u.default.player,controls:!0,controlsList:"nodownload",onCanPlayThrough:()=>{t===m.LOADING&&n(m.FIRST_PLAY)},onEnded:()=>{n(m.ENDED)},ref:e,children:(0,h.jsx)("source",{src:M,type:"video/mp4"})},c.default.currentRes):null;switch(t){case m.READY:P=S,A=(0,h.jsx)(y,{});break;case m.LOADING:A=(0,h.jsx)(p.Spinner,{color:"white",size:32});break;case m.ENDED:P=v,A=(0,h.jsx)(f.default,{name:"refresh-large"});break;default:A=null,P=null}const I=A?(0,h.jsx)("div",{className:u.default.overlay,role:"button",onClick:P,children:(0,h.jsx)("div",{className:u.default.button,children:A})}):null;return(0,h.jsx)("div",{className:u.default.video,children:(0,h.jsxs)("div",{className:u.default.container,children:[(0,h.jsxs)(i.default,{transitionName:"fade",children:[T,I,C]}),O]})})};var i=r(n(40436)),a=r(n(94184)),o=n(67294),s=r(n(59312)),l=n(87550),c=r(n(30588)),d=r(n(47065)),u=r(n(71937)),p=n(11054),f=r(n(23217)),h=n(85893);const _={low:n(79061),high:n(73727)},g={low:n(17818),high:n(7246)},m=n(76672).Mirrored(["FIRST_OPEN","READY","LOADING","FIRST_PLAY","ENDED","REPLAY"]);const y=()=>(0,h.jsx)("div",{className:u.default.play,children:(0,h.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"28",height:"34",viewBox:"0 0 28 34",children:(0,h.jsx)("path",{fill:"#FFF",d:"M1 4.983v24.034a2.982 2.982 0 0 0 4.564 2.53L24.792 19.53a2.981 2.981 0 0 0 0-5.058L5.563 2.454A2.983 2.983 0 0 0 1 4.983z"})})})},22028:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const[t,n]=(0,_.useState)(O.getRememberMe),[r]=(0,_.useState)((()=>!!(0,b.getShowMdUpgradeCompleteMsg)())),[i]=(0,_.useState)((()=>!!(0,b.getForcedMdUpgradeComplete)())),[a,o]=(0,_.useState)(x.Socket.state===N.SOCKET_STATE.UNPAIRED_IDLE),[c,d]=(0,_.useState)(!u.default.online),[g,y]=(0,_.useState)(x.Socket.state===N.SOCKET_STATE.UNPAIRED);(0,m.useListener)(x.Socket,"change:state change:online",(()=>{o(x.Socket.state===N.SOCKET_STATE.UNPAIRED_IDLE),d(!u.default.online),y(x.Socket.state===N.SOCKET_STATE.UNPAIRED)})),(0,_.useEffect)((()=>{}),[]);const v=()=>{(0,s.isMDBackend)()?S.Cmd.refreshQR():x.Socket.poke()};let C;C=c?(0,F.jsx)(Y,{children:(0,F.jsxs)("div",{className:R.default.qrButton,children:[(0,F.jsx)("div",{className:R.default.qrButtonIcon,children:(0,F.jsx)(U.default,{name:"connection"})}),A.default.t(282)]},"expiry")}):a?(0,F.jsx)(Y,{children:(0,F.jsxs)("button",{className:R.default.qrButton,onClick:v,children:[(0,F.jsx)("div",{className:R.default.qrButtonIcon,children:(0,F.jsx)(U.default,{name:"refresh-large"})}),h.fbt._("Click to reload QR code",null,{hk:"pEkpW"})]},"expiry")}):g?(0,F.jsx)(Y,{}):(0,F.jsx)("div",{className:R.default.qrcode,children:(0,F.jsx)(k.Spinner,{})});const I=t?null:(0,F.jsx)("div",{className:(0,f.default)(R.default.tip,R.default.rememberMeTip),children:A.default.t(523)});let w;if(e.apiCmd)switch(e.apiCmd.resultType){case E.APICmd.GROUP_INVITE:w=(0,F.jsx)("div",{className:R.default.groupInviteTip,children:(0,F.jsx)("div",{className:R.default.tip,children:h.fbt._("Log in to WhatsApp Web to join this WhatsApp group",null,{hk:"3OnLb2"})})});break;case E.APICmd.MSG_SEND:w=(0,F.jsx)("div",{className:R.default.groupInviteTip,children:(0,F.jsx)("div",{className:R.default.tip,children:h.fbt._("Log in to WhatsApp Web to share",null,{hk:"2k3JEY"})})})}const D=(0,F.jsx)("strong",{children:(0,F.jsx)(P.default,{id:575,params:{android_menu_icon:(0,F.jsx)(K,{})}})}),L=(0,F.jsx)("strong",{children:(0,F.jsx)(P.default,{id:577,params:{iphone_settings_icon:(0,F.jsx)(W,{})}})}),j=(0,F.jsx)("strong",{children:h.fbt._("Linked Devices",null,{hk:"Nqq5i"})}),V=(0,F.jsx)(P.default,{id:578,params:{android_menu:D,iphone_settings:L,whatsapp_web_menu_item:j}}),$=(0,F.jsx)("strong",{children:h.fbt._("Link a Device",null,{hk:"v9hB7"})}),z=(0,F.jsx)(P.default,{id:579,params:{login_step_3_md_link_device:$}}),q=r||i||(0,b.mdOptedIn)();let J,Q;r&&(Q=(0,F.jsx)("div",{className:"landing-header-upgradeCompleteText",children:h.fbt._("Update complete. Scan the QR code to use WhatsApp Web.",null,{hk:"3mQH0X"})}));i&&(Q=(0,F.jsx)("div",{className:"landing-header-upgradeCompleteText",children:h.fbt._("Now use WhatsApp Web without keeping your phone online.",null,{hk:"1eDnsC"})}));J=(0,F.jsxs)("div",{className:"landing-header",children:[(0,F.jsx)(H,{}),(0,F.jsx)("div",{className:"landing-headerTitle",children:A.default.t(580)})]});let X=(0,F.jsx)(B.default,{});return(0,F.jsxs)("div",{className:"landing-wrapper",children:[J," ",Q,(0,F.jsxs)("div",{className:"landing-window",children:[(0,F.jsxs)("div",{className:"landing-main",children:[(0,F.jsx)(M.default,{}),(0,F.jsxs)("div",{className:R.default.qrWrapper,children:[(0,F.jsxs)("div",{className:R.default.text,children:[(0,F.jsx)("div",{className:(0,f.default)("landing-title",R.default.headline),children:h.fbt._("To use WhatsApp on your computer:",null,{hk:"3aGbOX"})}),(0,F.jsxs)("ol",{className:R.default.list,children:[(0,F.jsx)("li",{className:R.default.listItem,children:h.fbt._("Open WhatsApp on your phone",null,{hk:"3hHeUI"})}),(0,F.jsx)("li",{className:R.default.listItem,children:V}),q&&(0,F.jsx)("li",{className:R.default.listItem,children:z}),(0,F.jsx)("li",{className:R.default.listItem,children:h.fbt._("Point your phone to this screen to capture the code",null,{hk:"2SaWOV"})})]})]}),(0,F.jsxs)("div",{className:R.default.qr,children:[w,C]}),(0,F.jsx)(T.ExternalLink,{href:(0,l.getLoginFaqUrl)(),className:R.default.hint,children:A.default.t(576)}),(0,s.isMDBackend)()?null:(0,F.jsxs)("div",{className:R.default.toggle,children:[(0,F.jsx)(p.default,{transitionName:"fade_sifo",children:I}),(0,F.jsxs)("label",{children:[(0,F.jsx)("input",{type:"checkbox",name:"rememberMe",checked:t,onChange:e=>{x.Socket.isIncognito||G.default.setRememberMe(e.target.checked).catch((()=>{})),(0,O.setRememberMe)(e.target.checked),n((0,O.getRememberMe)())}}),A.default.t(595)]})]})]})]}),X,undefined,undefined]})]})};var i=r(n(48926)),a=n(15688),o=r(n(99964)),s=n(88555),l=n(21310),c=n(41906),d=r(n(79264)),u=r(n(81602)),p=r(n(40436)),f=r(n(94184)),h=n(48360),_=n(67294),g=r(n(51799)),m=n(87550),y=n(46308),E=n(51650),S=n(88102),v=(r(n(52665)),n(17239)),T=n(12591),b=n(99234),C=n(15875),A=r(n(14296)),P=r(n(56074)),M=r(n(81145)),O=n(53055),I=r(n(14528)),w=r(n(37360)),R=r(n(66937)),D=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=j(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(98250)),L=(n(52596),n(11849)),N=n(62583),k=n(11054),U=r(n(23217)),G=r(n(56891)),x=n(65044),B=r(n(28828)),F=n(85893);function j(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(j=function(e){return e?n:t})(e)}function Y(e){const t=e.children,[n,r]=(0,_.useState)(!1),l=(0,g.default)((()=>{r(!0)}),100),u=(0,_.useRef)(null),h=(0,_.useRef)(null),E=()=>{if(v.Conn.connected)return Promise.resolve(void 0);const e=v.Conn.ref;if((0,s.isMDBackend)())return L.waSignalStore.getRegistrationInfo().then(function(){var t=(0,i.default)((function*(t){const n=yield C.waNoiseInfo.get();if(!n||!n.staticKeyPair||!t)return __LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("Empty noiseInfo or empty regInfo"),null;const r=(0,a.encodeB64)(n.staticKeyPair.pubKey),i=(0,a.encodeB64)(t.identityKeyPair.pubKey),o=(0,y.getADVSecretKey)();return e+","+r+","+i+","+o}));return function(){return t.apply(this,arguments)}}());const t=d.default.id();return Promise.resolve().then((()=>{const n=D.getOrGenerate();return e+","+n+","+t}))},T=function(){var e=(0,i.default)((function*(){const e=u.current,t=h.current;if(null==e)return Promise.resolve();const n=yield E();n&&(I.default.inc(),t?t.makeCode(n):h.current=new w.default(e,{text:n,colorDark:"#122e31",width:c.QR_EDGE,height:c.QR_EDGE,correctLevel:w.default.CorrectLevel.L}),e.removeAttribute("title"),e.setAttribute("data-ref",n))}));return function(){return e.apply(this,arguments)}}();(0,m.useListener)(v.Conn,"change:ref",T),(0,_.useEffect)((()=>(T(),S.Cmd.initialLoadReady(),()=>{I.default.reset()})),[]);const b=(0,f.default)(R.default.qrcode,{[R.default.idle]:!!t}),A=n&&null==t?{cursor:"none"}:null;return(0,F.jsxs)("div",{ref:u,"data-a8n":o.default.key("qrcode"),className:b,onContextMenu:null,style:A,onMouseMove:()=>{n&&r(!1),l()},onMouseLeave:()=>{l.cancel(),r(!1)},children:[(0,F.jsx)(p.default,{transitionName:"scale",children:t}),(0,F.jsx)("div",{className:R.default.codeLogo,children:(0,F.jsx)(V,{})})]})}const K=()=>(0,F.jsx)("span",{className:R.default.icon,children:(0,F.jsxs)("svg",{height:"24px",viewBox:"0 0 24 24",width:"24px",children:[(0,F.jsx)("rect",{fill:"#f2f2f2",height:"24",rx:"3",width:"24"}),(0,F.jsx)("path",{d:"m12 15.5c.825 0 1.5.675 1.5 1.5s-.675 1.5-1.5 1.5-1.5-.675-1.5-1.5.675-1.5 1.5-1.5zm0-2c-.825 0-1.5-.675-1.5-1.5s.675-1.5 1.5-1.5 1.5.675 1.5 1.5-.675 1.5-1.5 1.5zm0-5c-.825 0-1.5-.675-1.5-1.5s.675-1.5 1.5-1.5 1.5.675 1.5 1.5-.675 1.5-1.5 1.5z",fill:"#818b90"})]})}),W=()=>(0,F.jsx)("span",{className:R.default.icon,children:(0,F.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",children:[(0,F.jsx)("rect",{fill:"#F2F2F2",width:"24",height:"24",rx:"3"}),(0,F.jsx)("path",{d:"M12 18.69c-1.08 0-2.1-.25-2.99-.71L11.43 14c.24.06.4.08.56.08.92 0 1.67-.59 1.99-1.59h4.62c-.26 3.49-3.05 6.2-6.6 6.2zm-1.04-6.67c0-.57.48-1.02 1.03-1.02.57 0 1.05.45 1.05 1.02 0 .57-.47 1.03-1.05 1.03-.54.01-1.03-.46-1.03-1.03zM5.4 12c0-2.29 1.08-4.28 2.78-5.49l2.39 4.08c-.42.42-.64.91-.64 1.44 0 .52.21 1 .65 1.44l-2.44 4C6.47 16.26 5.4 14.27 5.4 12zm8.57-.49c-.33-.97-1.08-1.54-1.99-1.54-.16 0-.32.02-.57.08L9.04 5.99c.89-.44 1.89-.69 2.96-.69 3.56 0 6.36 2.72 6.59 6.21h-4.62zM12 19.8c.22 0 .42-.02.65-.04l.44.84c.08.18.25.27.47.24.21-.03.33-.17.36-.38l.14-.93c.41-.11.82-.27 1.21-.44l.69.61c.15.15.33.17.54.07.17-.1.24-.27.2-.48l-.2-.92c.35-.24.69-.52.99-.82l.86.36c.2.08.37.05.53-.14.14-.15.15-.34.03-.52l-.5-.8c.25-.35.45-.73.63-1.12l.95.05c.21.01.37-.09.44-.29.07-.2.01-.38-.16-.51l-.73-.58c.1-.4.19-.83.22-1.27l.89-.28c.2-.07.31-.22.31-.43s-.11-.35-.31-.42l-.89-.28c-.03-.44-.12-.86-.22-1.27l.73-.59c.16-.12.22-.29.16-.5-.07-.2-.23-.31-.44-.29l-.95.04c-.18-.4-.39-.77-.63-1.12l.5-.8c.12-.17.1-.36-.03-.51-.16-.18-.33-.22-.53-.14l-.86.35c-.31-.3-.65-.58-.99-.82l.2-.91c.03-.22-.03-.4-.2-.49-.18-.1-.34-.09-.48.01l-.74.66c-.39-.18-.8-.32-1.21-.43l-.14-.93a.426.426 0 00-.36-.39c-.22-.03-.39.05-.47.22l-.44.84-.43-.02h-.22c-.22 0-.42.01-.65.03l-.44-.84c-.08-.17-.25-.25-.48-.22-.2.03-.33.17-.36.39l-.13.88c-.42.12-.83.26-1.22.44l-.69-.61c-.15-.15-.33-.17-.53-.06-.18.09-.24.26-.2.49l.2.91c-.36.24-.7.52-1 .82l-.86-.35c-.19-.09-.37-.05-.52.13-.14.15-.16.34-.04.51l.5.8c-.25.35-.45.72-.64 1.12l-.94-.04c-.21-.01-.37.1-.44.3-.07.2-.02.38.16.5l.73.59c-.1.41-.19.83-.22 1.27l-.89.29c-.21.07-.31.21-.31.42 0 .22.1.36.31.43l.89.28c.03.44.1.87.22 1.27l-.73.58c-.17.12-.22.31-.16.51.07.2.23.31.44.29l.94-.05c.18.39.39.77.63 1.12l-.5.8c-.12.18-.1.37.04.52.16.18.33.22.52.14l.86-.36c.3.31.64.58.99.82l-.2.92c-.04.22.03.39.2.49.2.1.38.08.54-.07l.69-.61c.39.17.8.33 1.21.44l.13.93c.03.21.16.35.37.39.22.03.39-.06.47-.24l.44-.84c.23.02.44.04.66.04z",fill:"#818b90"})]})}),H=()=>(0,F.jsx)("span",{className:R.default.icon,children:(0,F.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"39",height:"39",viewBox:"0 0 39 39",children:[(0,F.jsx)("path",{fill:"#00E676",d:"M10.7 32.8l.6.3c2.5 1.5 5.3 2.2 8.1 2.2 8.8 0 16-7.2 16-16 0-4.2-1.7-8.3-4.7-11.3s-7-4.7-11.3-4.7c-8.8 0-16 7.2-15.9 16.1 0 3 .9 5.9 2.4 8.4l.4.6-1.6 5.9 6-1.5z"}),(0,F.jsx)("path",{fill:"#FFF",d:"M32.4 6.4C29 2.9 24.3 1 19.5 1 9.3 1 1.1 9.3 1.2 19.4c0 3.2.9 6.3 2.4 9.1L1 38l9.7-2.5c2.7 1.5 5.7 2.2 8.7 2.2 10.1 0 18.3-8.3 18.3-18.4 0-4.9-1.9-9.5-5.3-12.9zM19.5 34.6c-2.7 0-5.4-.7-7.7-2.1l-.6-.3-5.8 1.5L6.9 28l-.4-.6c-4.4-7.1-2.3-16.5 4.9-20.9s16.5-2.3 20.9 4.9 2.3 16.5-4.9 20.9c-2.3 1.5-5.1 2.3-7.9 2.3zm8.8-11.1l-1.1-.5s-1.6-.7-2.6-1.2c-.1 0-.2-.1-.3-.1-.3 0-.5.1-.7.2 0 0-.1.1-1.5 1.7-.1.2-.3.3-.5.3h-.1c-.1 0-.3-.1-.4-.2l-.5-.2c-1.1-.5-2.1-1.1-2.9-1.9-.2-.2-.5-.4-.7-.6-.7-.7-1.4-1.5-1.9-2.4l-.1-.2c-.1-.1-.1-.2-.2-.4 0-.2 0-.4.1-.5 0 0 .4-.5.7-.8.2-.2.3-.5.5-.7.2-.3.3-.7.2-1-.1-.5-1.3-3.2-1.6-3.8-.2-.3-.4-.4-.7-.5h-1.1c-.2 0-.4.1-.6.1l-.1.1c-.2.1-.4.3-.6.4-.2.2-.3.4-.5.6-.7.9-1.1 2-1.1 3.1 0 .8.2 1.6.5 2.3l.1.3c.9 1.9 2.1 3.6 3.7 5.1l.4.4c.3.3.6.5.8.8 2.1 1.8 4.5 3.1 7.2 3.8.3.1.7.1 1 .2h1c.5 0 1.1-.2 1.5-.4.3-.2.5-.2.7-.4l.2-.2c.2-.2.4-.3.6-.5s.4-.4.5-.6c.2-.4.3-.9.4-1.4v-.7s-.1-.1-.3-.2z"})]})}),V=()=>(0,F.jsx)("span",{className:R.default.icon,children:(0,F.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"64",height:"64",viewBox:"0 0 64 64",children:[(0,F.jsx)("path",{fill:"#FFF",d:"M6.525 43.936a29.596 29.596 0 0 1-3.039-13.075C3.494 14.568 16.755 1.313 33.05 1.313c7.904.004 15.328 3.082 20.91 8.666 5.581 5.586 8.653 13.01 8.65 20.907-.007 16.294-13.266 29.549-29.558 29.549a29.648 29.648 0 0 1-12.508-2.771L1.391 62.687l5.134-18.751z"}),(0,F.jsx)("path",{fill:"#123033",d:"M50.801 13.135c-4.739-4.742-11.039-7.354-17.752-7.357-13.837 0-25.094 11.253-25.099 25.085a25.039 25.039 0 0 0 3.349 12.541l-3.56 12.999 13.304-3.488a25.084 25.084 0 0 0 11.996 3.054h.011c13.83 0 25.088-11.256 25.095-25.087.002-6.703-2.607-13.005-7.344-17.747zM33.05 51.733h-.008a20.866 20.866 0 0 1-10.62-2.906l-.762-.452-7.894 2.07 2.108-7.694-.497-.789a20.802 20.802 0 0 1-3.189-11.097c.004-11.496 9.361-20.85 20.87-20.85a20.73 20.73 0 0 1 14.746 6.115 20.733 20.733 0 0 1 6.104 14.752c-.006 11.497-9.363 20.851-20.858 20.851z"}),(0,F.jsx)("path",{fill:"#123033",d:"M25.429 19.26a8.65 8.65 0 0 0-1.028.011 2.352 2.352 0 0 0-.95.255c-.221.114-.427.277-.75.582-.305.288-.481.54-.668.782a6.974 6.974 0 0 0-1.443 4.291l.001.003a8.243 8.243 0 0 0 .844 3.607c1.043 2.307 2.763 4.746 5.035 7.008a24.676 24.676 0 0 0 1.657 1.6 24.145 24.145 0 0 0 9.814 5.229s.751.179 1.391.218c.021.001.04.003.061.003a9.207 9.207 0 0 0 1.422-.033 5.086 5.086 0 0 0 2.129-.59c.423-.225.623-.337.978-.561 0 0 .11-.072.319-.23.345-.257.558-.438.845-.736.211-.22.394-.479.534-.772.2-.417.401-1.213.481-1.874.061-.505.042-.781.036-.952-.011-.275-.238-.558-.487-.678l-1.486-.668s-2.222-.967-3.581-1.587a1.278 1.278 0 0 0-.452-.104c-.341-.021-.723.068-.966.324v-.004c-.013-.001-.182.145-2.031 2.385-.102.122-.341.387-.754.362a1.086 1.086 0 0 1-.185-.029 3.402 3.402 0 0 1-.49-.17c-.316-.134-.427-.185-.643-.278l-.013-.006a15.361 15.361 0 0 1-4.013-2.556 15.88 15.88 0 0 1-.927-.885c-1.074-1.041-1.953-2.148-2.607-3.24-.035-.06-.09-.146-.15-.242-.107-.174-.225-.381-.262-.523-.095-.376.157-.678.157-.678s.622-.68.911-1.05c.278-.356.518-.704.671-.952.301-.484.39-.982.238-1.37a216.767 216.767 0 0 0-2.219-5.215c-.156-.339-.598-.589-1.005-.636a6.284 6.284 0 0 0-.414-.041"})]})})},9294:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default=class{constructor(e){this.cache=new Map,this.howBig=0,this.fn=e}getKeyString(e){return"string"==typeof e?e:e.join("_")}getRefSetter(e){const t=this.getKeyString(e);let n=this.cache.get(t);return n||(n=n=>{this.fn(e,n),n||this.cache.delete(t)},this.cache.set(t,n),Math.floor(this.cache.size/500)>this.howBig&&(__LOG__(4,void 0,new Error)`[SetRefCache] Large cache detected with ${this.cache.size} entries`,this.howBig=Math.floor(this.cache.size/500))),n}}},88406:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(41609)),a=r(n(76521));class o extends a.default{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"next";super(),this.list=e,this.index=-1,this.value=void 0,this.getter=t,this.deleteDir=n}init(){let e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.list=n,null!=this.value)if((0,i.default)(n))this.unset();else{if(e=n.indexOf(this.value),e>-1){if(e===this.index)return;t=!0,r=!1}else if(!r||this.index<0)e=-1;else{const r="prev"===this.deleteDir?-1:0;e=this.index+r,e=Math.max(e,0),e=Math.min(e,n.length-1),t=e>-1}this.set(e,r,t)}}unset(){const e=this.value;this.value=void 0,this.index=-1,null!=e&&this.trigger(this.getter(e),!1)}reset(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.index<0||null!=this.value&&this.trigger(this.getter(this.value),"focus",e)}set(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!this.list.length)return;const r=Math.min(Math.max(e,-1),this.list.length-1),i=this.value,a=r>-1?this.list[r]:void 0;null!=a?(this.value=a,this.trigger(this.getter(a),!0===t?"focus":"select")):!0===n&&(this.value=void 0),!0===n&&null!=i&&i!==a&&this.trigger(this.getter(i),!1),this.index=r}getVal(){return this.value}setVal(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n=this.list.indexOf(e);n>-1?this.set(n,t):(this.unset(),this.value=e)}setFirst(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];(0,i.default)(this.list)||this.set(0,e,!0)}setLast(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];(0,i.default)(this.list)||this.set(this.list.length-1,e,!0)}setPrev(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];(0,i.default)(this.list)||this.set(this.prev(),e,!0)}setNext(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];(0,i.default)(this.list)||this.set(this.next(),e,!0)}prev(){return(0,i.default)(this.list)||-1===this.index?-1:this.index-1}next(){return(0,i.default)(this.list)?-1:Math.min(this.index+1,this.list.length-1)}}var s=o;t.default=s},31703:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(76139)),a=r(n(99360)),o=n(12591),s=r(n(14296)),l=n(85893);t.default=()=>{const e=i.default.build("https://www.whatsapp.com/legal/small-business-terms/",{lg:s.default.getLocale()});return(0,l.jsx)(a.default,{href:e,onClick:t=>{t.preventDefault(),setTimeout((()=>(0,o.openExternalLink)(e)),10)},children:s.default.t(547)})}},11054:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.RADIUS=void 0,t.Spinner=function(e){const{size:t=65,stroke:n=4,styleThemes:r,color:i=d.default,outgoingMsg:c,max:u=100,value:f}=e,h=function(e,t){if(null==e)return null;const n=Math.max(Math.min(e,t),0);return Math.ceil(100*n/t)}(f,u);(0,a.useEffect)((()=>{}),[]);const _=40+n;return(0,s.jsxs)("svg",{className:(0,o.default)(null==h&&l.container||l.rotate,...(r||[]).map((e=>l[e]))),width:t,height:t,viewBox:`0 0 ${_} ${_}`,role:"status",children:[null!=h?(0,s.jsx)(p,{viewBoxSide:_,stroke:n,outgoingMsg:c,color:"default",progress:u}):null,(0,s.jsx)(p,{progress:h,viewBoxSide:_,stroke:n,outgoingMsg:c,color:i})]})},t.styleThemeOptions=t.colorOptions=void 0;var i=r(n(66919)),a=n(67294),o=r(n(56720)),s=n(85893);const l={accent:{stroke:"dba1p600"},container:{animationName:"gdrnme8s",animationDuration:"hbnrezoj",animationTimingFunction:"f8mos8ky",animationIterationCount:"tkmeqcnu",zIndex:"b9fczbqn"},default:{stroke:"a5uym4to"},highlight:{stroke:"sku37djt"},progress:{stroke:"gibn6ev6"},in:{stroke:"ptcoeott"},noop:{visibility:"g5crjs6l"},out:{stroke:"mbixqzja"},rounded:{strokeLinecap:"bvgz89zs"},path:{animationName:"nmreelbr",animationDuration:"sw4r90y6",animationTimingFunction:"gaqnkt02",animationIterationCount:"tkmeqcnu",strokeDasharray:"kzgl1sas",strokeDashoffset:"fwna6xbl"},solidwhite:{stroke:"ad0o4787"},white:{stroke:"qaop2s2o"},rotate:{transform:"bwjm0vhl",transformOrigin:"sx61ek5s"}},c=(0,i.default)({noop:null});t.styleThemeOptions=c;const d=(0,i.default)({default:null,highlight:null,solidwhite:null,white:null,accent:null,progress:null});t.colorOptions=d;function u(e){if(null==e)return null;const t=Math.ceil(40*Math.PI);return{strokeDasharray:`${t} ${t}`,strokeDashoffset:t-e/100*t}}function p(e){let{stroke:t,viewBoxSide:n,progress:r,color:i,outgoingMsg:a}=e;return(0,s.jsx)("circle",{style:u(r),className:(0,o.default)(l.rounded,null==r&&l.path,l[i],!1===a&&l.in,a&&l.out),cx:n/2,cy:n/2,r:20,fill:"none",strokeWidth:t})}t.RADIUS=20},90669:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.STICKER_PADDING=t.STICKER_PACK_FETCH_TIMEOUT=t.STICKER_MAKER_IMAGE_PADDING=t.STICKER_LIST_ITEM_HEIGHT=t.STICKER_DIMENSION=t.STICKER_BORDER_WIDTH=void 0;t.STICKER_DIMENSION=512;t.STICKER_BORDER_WIDTH=8;t.STICKER_PADDING=36;t.STICKER_LIST_ITEM_HEIGHT=156;t.STICKER_MAKER_IMAGE_PADDING=20;t.STICKER_PACK_FETCH_TIMEOUT=86400},23217:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{className:t,containerRef:n,directional:r,display:l,height:c,name:d,color:u,title:p,style:f,width:h,xstyle:_,iconXstyle:g,"aria-label":m,"aria-hidden":y}=e;return(0,o.jsx)(a.SVGBase,{"aria-hidden":y,"aria-label":m,className:t,containerRef:n,height:c,isRTL:!!r&&i.default.isRTL(),display:l,name:d,title:p,style:f,width:h,xstyle:[_,u&&s[`${u}Color`]],iconXstyle:g})};r(n(56720));var i=r(n(14296)),a=n(71798),o=n(85893);const s={secondaryColor:{color:"aft2yglh"},tealColor:{color:"jq3rn4u7"},grayColor:{color:"hsqj3bek"}}},71798:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.SVGBase=void 0,t.getInternalSVGData=function(){},t.loadSVGData=T,t.loadSpecificSVG=function(){return b.apply(this,arguments)};var i=r(n(81109)),a=r(n(6479)),o=r(n(48926)),s=n(89385),l=r(n(45095)),c=n(13959),d=n(4352),u=r(n(94184)),p=n(67294),f=r(n(56720)),h=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=y(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(47272)),_=r(n(3409)),g=n(85893);const m=["aria-label","aria-hidden","name","isRTL","className","display","containerRef","height","width","xstyle","iconXstyle"];function y(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(y=function(e){return e?n:t})(e)}const E={reverse:{display:"f804f6gw",transform:"n4o0o7gj"},inline:{display:"l7jjieqr",verticalAlign:"fewfhwl7"}};let S,v;function T(e){return v||(v=(0,d.promiseLoop)(((t,r,i)=>{if(null==e?void 0:e.aborted)throw new s.AbortError;const a=(0,c.delayMs)(h.expBackoff(i,12e4,1e3,.1));return n.e(5512).then(n.bind(n,69692)).then((e=>{S=e.default,t()})).catch((()=>a))})))}function b(){return(b=(0,o.default)((function*(e){return yield T(),(0,l.default)(S,"SVGData")[e]}))).apply(this,arguments)}function C(e){const t=e.split("-");for(let e=1;e<t.length;e++)t[e]=t[e].charAt(0).toUpperCase()+t[e].slice(1).toLowerCase();return t.join("")}function A(e){if(null==e)return{};const t=e.attributes;return t.length>0?function(e){const t={};for(const n of e){let e=n.name;e.startsWith("xmlns")||(e.includes("-")?e=C(e):"class"===e&&(e="className"),t[e]=n.value)}return t}(t):{}}function P(e){var t;const[n,r]=(0,p.useState)(!!S),o=(0,_.default)();(0,p.useEffect)((()=>{n||T(o).then((()=>{if(o.aborted)throw new s.AbortError;r(!0)})).catch((()=>{}))}),[]);const{"aria-label":l,"aria-hidden":c,name:d,isRTL:h,className:y,display:v,containerRef:b,height:C,width:P,xstyle:M,iconXstyle:O}=e,I=(0,a.default)(e,m);if(S&&!S[d])throw new Error("Missing SVG for '"+d+"'!");const w=null===(t=S)||void 0===t?void 0:t[d],R=(0,p.useMemo)((()=>function(e){if(null==e)return null;const t=document.createElement("div");t.innerHTML=e;const n=t.firstElementChild;return"svg"===(null==n?void 0:n.tagName)?(t.removeChild(n),n):null}(w)),[w]),D=(0,p.useMemo)((()=>A(R)),[R]),L={};return null==C&&null==P||(L.height=C,L.width=P,L.preserveAspectRatio="xMidYMid meet"),(0,g.jsx)("span",(0,i.default)((0,i.default)({"data-testid":d,"aria-hidden":c,"aria-label":l,ref:b,"data-icon":d,className:(0,u.default)(y,(0,f.default)(h&&E.reverse,"inline"===v&&E.inline,M))},I),{},{children:(0,g.jsx)("svg",(0,i.default)((0,i.default)((0,i.default)({},D),L),{},{className:(0,f.default)(O),dangerouslySetInnerHTML:{__html:null==R?void 0:R.innerHTML}}))}))}const M=(0,p.memo)(P);t.SVGBase=M},3137:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(76521));class a extends i.default{constructor(){super(),this.mediaQuery=window.matchMedia("(prefers-color-scheme: dark)"),this.theme=this.getCurrentTheme(),this.handleThemeChange=()=>{const e=this.getCurrentTheme();e!==this.theme&&(this.theme=e,this.trigger("system_theme_change",e))},this.mediaQuery.addListener(this.handleThemeChange)}getCurrentTheme(){return this.mediaQuery.matches?"dark":"light"}}var o=new a;t.default=o},13923:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.Text=p,t.TextDiv=function(e){return(0,c.jsx)(p,(0,a.default)({as:"div"},e))},t.TextHeader=function(e){const{level:t="1"}=e,n=(0,i.default)(e,d);return(0,c.jsx)(p,(0,a.default)({as:f[t]},n))},t.TextLabel=function(e){let{htmlFor:t}=e,n=(0,i.default)(e,u);return(0,c.jsx)(p,(0,a.default)((0,a.default)({as:"label"},n),{},{extras:{htmlFor:t}}))},t.TextParagraph=function(e){return(0,c.jsx)(p,(0,a.default)({as:"p"},e))},t.TextSpan=function(e){return(0,c.jsx)(p,(0,a.default)({as:"span"},e))};var i=r(n(6479)),a=r(n(81109)),o=r(n(94184)),s=r(n(56720)),l=r(n(98285)),c=n(85893);const d=["level"],u=["htmlFor"];function p(e){var t,n,r,i;const d=null!==(t=e.as)&&void 0!==t?t:"span",u=e.theme?l.default[e.theme]:null,p=e.color?l.default[`color-${e.color}`]:null,f=l.default[`weight-${null!==(n=e.weight)&&void 0!==n?n:"normal"}`],h=null!=e.customSize||null!=(null!==(r=e.xstyle)&&void 0!==r?r:{}).fontSize?null:null!==(i=e.size)&&void 0!==i?i:"14",_=null!=h?l.default[`size-${h}`]:null;let g;return null!=e.customSize&&(g={fontSize:"string"==typeof e.customSize?e.customSize:`${e.customSize}px`}),(0,c.jsx)(d,(0,a.default)((0,a.default)({},e.extras),{},{className:(0,o.default)(u,p,_,f,e.className,(0,s.default)(e.xstyle)),style:g,"data-testid":e.testid,children:e.children}))}const f={1:"h1",2:"h2",3:"h3",4:"h4",5:"h5",6:"h6"}},50452:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ToastImpl=t.ToastDismissBtn=t.ToastBody=t.ToastActionBtn=t.Toast=void 0,t.genId=function(e){return(0,i.default)(e||"toast")};var i=r(n(73955)),a=r(n(99964)),o=n(28298),s=n(67294),l=r(n(56720)),c=n(88102),d=r(n(23217)),u=r(n(4478)),p=n(85893);const f={btnSuccess:{color:"j5au4wul",fontWeight:"nbipi2bn"},button:{color:"dud78hvd",cursor:"ajgl1lbb",fontSize:"f8jlpxt4",lineHeight:"a4ywakfo",flexShrink:"oq44ahr5"},close:{color:"afo7vhit"},right:{right:"grt5ktjy"},toast:{alignItems:"gndfcl4n",backgroundColor:"cqvkqxai",borderTopStartRadius:"cynldqnp",borderTopEndRadius:"l5pmshjt",borderBottomEndRadius:"ecxr5yey",borderBottomStartRadius:"lysxvg3k",color:"k17s6i4e",display:"p357zi0d",fontSize:"f8jlpxt4",lineHeight:"a4ywakfo"}};class h extends s.PureComponent{constructor(){super(...arguments),this.delay=this.props.setTimeout((()=>{c.Cmd.closeToast(this)}),this.props.duration),this._handleDismiss=()=>{c.Cmd.closeToast(this),this.props.onDismiss&&this.props.onDismiss()}}getId(){return this.props.id}restartDelay(){this.props.clearTimeout(this.delay),this.delay=this.props.setTimeout((()=>{c.Cmd.closeToast(this)}),this.props.duration)}render(){const{msg:e,action:t}=this.props;let n;return t&&(n=(0,p.jsx)(_,{buttonText:t.actionText,onClick:t.dismiss?this._handleDismiss:t.onAction,theme:t.theme})),(0,p.jsx)(g,{actionText:e,actionBtn:n})}}t.ToastImpl=h,h.defaultProps={duration:4e3},h.displayName="ToastImpl";const _=e=>{let{buttonText:t,onClick:n,theme:r}=e;return(0,p.jsx)("button",{className:(0,l.default)(f.button,o.uiMargin.start15,"success"===r&&f.btnSuccess),onClick:n,children:t})};t.ToastActionBtn=_;t.ToastDismissBtn=e=>{let{buttonText:t,onClick:n}=e;return(0,p.jsx)("button",{className:(0,l.default)(f.close,o.uiMargin.start15),onClick:n,children:(0,p.jsx)(d.default,{name:"x-alt"})})};const g=e=>{let{toastPosition:t,actionText:n,actionBtn:r,dismissBtn:i}=e;return(0,p.jsxs)("div",{className:(0,l.default)(f.toast,o.uiPadding.vert12,o.uiPadding.horiz16,"RIGHT"===t&&f.right),"data-a8n":a.default.key("toast-body"),children:[(0,p.jsx)("span",{children:n}),r,i]})};t.ToastBody=g;const m=(0,u.default)(h);t.Toast=class extends m{restartDelay(){const e=this.getComponent();e&&e.restartDelay()}}},93373:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ToastManager=function(){const e=(0,u.default)((()=>new Map)),t=(t,n)=>{n?e.current.set(t,n):e.current.delete(t)},n=(0,u.default)((()=>new g.default(t))),r=(0,c.useRef)(null),[v,T]=(0,c.useState)({}),b=(0,f.default)(v),C=(t,n)=>{let r;(r=e.current.get(t.props.id))&&r instanceof m.Toast?r.restartDelay():T((0,i.default)((0,i.default)({},v),{},{[t.props.id]:{toast:t,position:n}}))};(0,p.useListener)(h.Cmd,"open_toast",C),(0,p.useListener)(h.Cmd,"close_toast",(e=>{v[e.props.id]&&T((0,o.default)(v,e.props.id))}));const A=null;(0,p.useListener)(A,"cannot_reach_phone",(e=>{C((0,y.jsx)(m.Toast,{msg:e,id:(0,m.genId)()}))})),(0,p.useListener)(A,"window_error",(e=>{C((0,y.jsx)(m.Toast,{msg:` ${e}`,id:(0,m.genId)()}))})),(0,p.useListener)(A,"ping_sent",(e=>{C((0,y.jsx)(m.Toast,{msg:e,id:(0,m.genId)()}))})),(0,c.useEffect)((()=>{r.current=Object.keys(null!=b?b:{}).length>Object.keys(v).length}),[v,b]);const P=r.current,M=(0,a.default)(v,["toast","id"]).reverse().map(((e,t)=>{let{toast:r,position:i}=e;return(0,y.jsx)("div",{ref:n.current.getRefSetter(r.props.id),className:(0,d.default)(S.wrapper,i===E.CENTER&&S.center,i===E.RIGHT&&S.right,0===t&&P&&S.slide0,1===t&&S.slide1,2===t&&S.slide2,t>=3&&S.slide3),children:(0,y.jsx)("div",{className:(0,d.default)(i===E.CENTER&&(_.default.isRTL()?S.transformRight:S.transformLeft)),children:(0,c.cloneElement)(r)})},r.props.id)})),O=s.UA.isTrident?"fade_sifo":"toast-transition";return(0,y.jsx)(l.default,{transitionName:O,children:M})},t.ToastPosition=void 0;var i=r(n(81109)),a=r(n(89734)),o=r(n(57557)),s=n(26741),l=r(n(40436)),c=n(67294),d=r(n(56720)),u=r(n(16223)),p=n(87550),f=r(n(37453)),h=n(88102),_=r(n(14296)),g=r(n(9294)),m=n(50452),y=n(85893);const E=n(76672)({LEFT:"LEFT",CENTER:"CENTER",RIGHT:"RIGHT"});t.ToastPosition=E;const S={slide0:{transform:"qdd0en2n"},slide1:{transform:"gqonocmn"},slide2:{transform:"b5bqnu92"},slide3:{opacity:"axi1ht8l",transform:"j7iro104"},wrapper:{opacity:"bs7a17vp",bottom:"jxacihee",lineHeight:"d53pemmv",marginTop:"fgtikrv0",marginEnd:"gqi0zhd6",marginBottom:"dblt22a0",marginStart:"nzcjdldu",minHeight:"ocs0cmsa",position:"lhggkp7q",zIndex:"pglj95m3",transition:"byw3xhqn"},center:{start:"m7kgcvyw",marginStart:"svoq16ka",marginEnd:"jnwc1y2a"},transformLeft:{transform:"t9w6h8zt"},transformRight:{transform:"ajuzgosp"},right:{end:"ebjesfe0"}}},3222:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t,n;return(t=class extends s.WrappedComponent{render(){return this.state.hasError?null:(0,c.jsx)(l.default.Consumer,{children:t=>(0,c.jsx)(e,(0,i.default)((0,i.default)({ref:this.setComponent},this.props),{},{uim:(0,a.default)(t,"uim")}))})}}).defaultProps=null!==(n=e.defaultProps)&&void 0!==n?n:void 0,t.displayName=`UIM(${(0,o.default)(e)})`,t.wrappedComponent=e,t};var i=r(n(81109)),a=r(n(45095)),o=r(n(38701)),s=n(7128),l=r(n(2773)),c=n(85893)},89618:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.UIMState=t.UIM=void 0;var i=r(n(84753)),a=r(n(82729)),o=r(n(57538));const s=n(76672).Mirrored(["ACTIVE","PASSIVE","INACTIVE","DEAD"]);t.UIMState=s;class l{static maybePreventScroll(e){var t;const n=null===(t=l.Manager.getTop())||void 0===t?void 0:t.uie.getNode();e.target instanceof HTMLElement&&n&&!n.contains(e.target)&&(e.preventDefault(),e.stopPropagation())}constructor(e,t){this.shouldRequestFocus=!0,this.parent=e||this,e||(l.Manager.root&&(__LOG__(4,void 0,new Error,!0)`Attempting to set multiple UIM tree roots. Expecting only one.`,SEND_LOGS("multiple-uim-roots")),l.Manager.root=this),this.uie=t,this.children=[],this.setState(t.getUIMState())}getState(){return this._state}setState(e){switch(e){case s.ACTIVE:this.lastActive=Date.now(),l.Manager.setTop(this);break;case s.PASSIVE:this.lastActive=Date.now(),this._state!==s.ACTIVE&&l.Manager.setTop(l.findMostRecentlyActiveFocusable());break;case s.INACTIVE:this._state&&this._state!==e&&l.Manager.setTop(l.findMostRecentlyActiveFocusable());break;case s.DEAD:}this._state=e}activate(){this.setState(this._state)}branch(e){const t=new l(this,e);return this.children.push(t),l.pprint(),t}pop(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.getState()===s.DEAD)return;this._invalidateAndDismissChildren(this.children,e),(0,a.default)(this.parent.children,(e=>e===this));const n=l.findMostRecentlyActiveFocusable(this);n&&(n.shouldRequestFocus=t),l.Manager.setTop(n),l.pprint()}_invalidateAndDismissChildren(e,t){e.forEach((e=>{e.setState(s.DEAD),e.uie.requestDismiss(t),this._invalidateAndDismissChildren(e.children,t)}))}static findMostRecentlyActiveFocusable(e){const{root:t}=l.Manager;if(t)return c(t,e,(e=>{const t=e.getState();return t===s.ACTIVE||t===s.PASSIVE}))}static findMostRecentlyActiveDismissable(e){const{root:t}=l.Manager;if(t)return c(t,e,(e=>e.getState()===s.ACTIVE))||c(t,e,(e=>e.getState()===s.PASSIVE))}static pprint(e){if(!e&&!l.Manager.verbose)return;const{root:t}=l.Manager;t&&__LOG__(2)`${u(t,[])}`}}function c(e,t,n){if(!e.children.length)return e;const r=e.children.filter((e=>e!==t)).map((e=>c(e,t,n))).concat([e]).filter(Boolean).filter(n);return(0,i.default)(r,"lastActive")}t.UIM=l,l.State=s,l.Manager={_top:void 0,setTop(e){e&&(e.lastActive=Date.now()),e&&this._top!==e&&e.getState()!==s.INACTIVE&&e.getState()!==s.DEAD&&e.shouldRequestFocus&&e.uie.requestFocus(),e&&(e.shouldRequestFocus=!0),null!=this._top&&this._top.uie.popable()&&window.removeEventListener("wheel",l.maybePreventScroll,{passive:!1,capture:!0}),e&&e.uie.popable()&&window.addEventListener("wheel",l.maybePreventScroll,{passive:!1,capture:!0}),this._top=e},getTop(){return this._top},refocusTopUie(){setTimeout((()=>{null!=this._top&&document.activeElement===document.body&&this._top.uie.requestFocus()}),0)},root:void 0,verbose:!1};function d(e,t,n,r){let i;i=n&&r?"":n&&!r?"":!n&&r?"":"",e===l.Manager.root&&(i="");let a=e.uie.getDisplayName();e===l.Manager.getTop()&&(a=`${a} `);const o=`(${function(e){switch(e){case s.ACTIVE:return"A";case s.PASSIVE:return"P";case s.INACTIVE:return"I";case s.DEAD:return"D"}}(e.getState())})${r?"\n":""}`;return`${t.join("")}${i} ${a} ${o}`}function u(e,t,n){return d(e,t,n,!!e.children.length)+e.children.map(((r,i)=>{const a=i<e.children.length-1;return u(r,n?t.concat([" "]):t.concat(["  "]),a)})).join("\n")}window.addEventListener("keydown",(e=>{if(e.keyCode!==o.default.ESC)return;const t=l.Manager.getTop(),n=(null==t?void 0:t.getState())===s.ACTIVE?t:l.findMostRecentlyActiveDismissable();n&&n.uie.escapable()&&(e.stopPropagation(),e.preventDefault(),n&&n.uie.requestDismiss(!1))}),{capture:!0});let p=null;function f(e,t){const n=e&&e.getState()===s.ACTIVE&&e.uie.popable()?e:l.findMostRecentlyActiveDismissable();if(!n||!n.uie.popable())return null;const r=n.uie.getNode();return r&&t.target instanceof Node&&r.contains(t.target)?null:n}window.addEventListener("mousedown",(e=>{if(p=null,!e.screenX||!e.screenY)return;const t=f(l.Manager.getTop(),e);t&&2===e.button?t.uie.requestDismiss():p=t}),{capture:!0}),window.addEventListener("mouseup",(e=>{if(!e.screenX||!e.screenY)return void(p=null);const t=f(l.Manager.getTop(),e);t&&t===p&&setTimeout((()=>t.uie.requestDismiss()),0),p=null}),{capture:!0})},18644:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.UIE=void 0;var i=n(89618),a=n(67294),o=r(n(38701)),s=r(n(2773)),l=n(85893);let c=null;class d extends a.Component{constructor(e,t){super(e,t),this._didMount=!1,this._pendingRequestFocus=!1,this._requestFocusTimeout=null,this._refAnchorElement=(0,a.createRef)(),this._setRefChild=e=>{var t;const n="function"==typeof(null==e?void 0:e.getComponent)?e.getComponent():e;this._refChild=n;const r=null===(t=this.props.children)||void 0===t?void 0:t.ref;r&&("function"==typeof r?r(n):r.current=n)},this.uim=this.context?this.context.branch(this):new i.UIM(void 0,this)}componentDidUpdate(e){e.uimState!==this.props.uimState&&this.uim.setState(this.props.uimState)}componentWillUnmount(){c&&this._requestFocusTimeout===c&&(clearTimeout(c),c=null),this.uim.pop(!0,this.props.requestRecentFocusOnUnmount)}activate(){this.uim.activate()}popable(){return this.props.popable}escapable(){return this.props.escapable}requestDismiss(e){this.props.requestDismiss&&this.props.requestDismiss(e)}componentDidMount(){const{requestFocus:e}=this.props;this._didMount=!0,e&&this._pendingRequestFocus&&this._maybeCallRequestFocus()}requestFocus(){const{requestFocus:e}=this.props;e&&this._didMount?this._maybeCallRequestFocus():this._pendingRequestFocus=!0}getDisplayName(){return this.props.displayName}getRef(){return this._refChild}getUIMState(){return this.props.uimState}getNode(){const e=this._refChild;if(null!=e){if(e instanceof HTMLElement)return e;let t="";try{const n=e.getElement();if(null==n||n instanceof HTMLElement)return n;t=`Non HTML element received:\n${(0,o.default)(n.constructor)}`}catch(e){t=`${e.message}:\n${e.stack}`}__LOG__(4,void 0,new Error,!0)`UIE received a child component that does not have a compatible API:\n${t}`,SEND_LOGS("uie-bad-child-api");const n=this._refAnchorElement.current;if((null==n?void 0:n.previousElementSibling)instanceof HTMLElement)return n.previousElementSibling}return null}render(){const{children:e}=this.props;if(!e)return null;const t=(0,a.cloneElement)(e,{ref:this._setRefChild});return(0,l.jsxs)(s.default.Provider,{value:this.uim,children:[t,(0,l.jsx)("div",{ref:this._refAnchorElement,style:{display:"none"},hidden:!0})]})}_maybeCallRequestFocus(){const{requestFocus:e}=this.props;e&&(c&&clearTimeout(c),this._requestFocusTimeout=c=setTimeout((()=>{e(),this._requestFocusTimeout=c=null}),0))}}t.UIE=d,d.State=i.UIM.State,d.defaultProps={uimState:i.UIM.State.ACTIVE,requestRecentFocusOnUnmount:!0},d.contextType=s.default,d.displayName="UIE"},33358:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(67294),i=n(85893),a=(0,r.forwardRef)((function(e,t){let{children:n}=e;const a=(0,r.useRef)();return(0,r.useImperativeHandle)(t,(()=>({getElement:()=>a.current}))),(0,i.jsx)("div",{ref:a,children:n})}));t.default=a},2773:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=(0,n(67294).createContext)(null);t.default=r},78123:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_CHAT_WALLPAPER=void 0,t.colorExistsInTheme=function(e,t){const n=u(t);return e===i||n.some((t=>t.toUpperCase()===e.toUpperCase()))},t.getDoodleAssetName=function(e,t){if(r.ServerProps.wallpapersV2&&"light"===t&&e!==i){const n=p(e,t,"doodle");if(n)return`data-asset-chat-background-${n}`}let n=`data-asset-chat-background-${t}`;"light"===t&&e===i&&(n="data-asset-chat-background-dark");return n},t.getDoodleOpacity=function(e,t){if(r.ServerProps.wallpapersV2){const n=p(e,t,"opacity");if(n)return n}if("light"===t&&e===i)return"0.4";return"0.06"},t.getWallpaperColorPropValue=p,t.getWallpaperColors=u,t.invertTransparentWallpaperColors=function(e,t){if(r.ServerProps.wallpapersV2)return"light"===e&&t!==i&&!!p(t,e,"invertTransparentWallpaperColors");const n=o.includes(t);return!!u(e).includes(t)&&(n?"light"===e:"dark"===e)},t.toggleWallpaperColor=function(e,t){const n=u(t);if(e===i)return i;if(r.ServerProps.wallpapersV2){const r=n.findIndex((t=>t.toUpperCase()===e.toUpperCase()));if(-1!==r)return"light"===t?d[r]:c[r]}return e};var r=n(64551);const i="default_chat_wallpaper";t.DEFAULT_CHAT_WALLPAPER=i;const a=["#ccebdc","#aed8c7","#7acba5","#c7e9eb","#a9dbd8","#68d5d9","#6ec3d4","#f2dad5","#f2d5e1","#fbcad2","#ffa7a8","#cbdaec","#d7d3eb","#e5c0eb","#d0deb1","#dee0b4","#e6dfa8","#f7e9a8","#ffd1a4","#ff8a8c","#ff5978","#f56056","#dc6e4f","#e6e365","#73c780","#2293a4","#219ed9","#2b5aa6","#74676a","#48324d","#dee3e9","#d9dade","#c0c1c4","#7e90a3","#55626f","#243640","#162127"],o=["#ff8a8c","#ff5978","#f56056","#dc6e4f","#73c780","#2293a4","#219ed9","#2b5aa6","#74676a","#48324d","#7e90a3","#55626f","#243640","#162127"],s={"#BBE4E5":{doodle:"dark",opacity:"0.42"},"#AED8C7":{doodle:"dark",opacity:"0.3"},"#7ACBA5":{doodle:"dark",opacity:"0.26"},"#CBDAEC":{doodle:"dark",opacity:"0.42"},"#66D2D5":{doodle:"dark",opacity:"0.26"},"#63BDCF":{doodle:"dark",opacity:"0.26"},"#D6D0F0":{doodle:"dark",opacity:"0.36"},"#CECECE":{doodle:"dark",opacity:"0.36"},"#D1DABE":{doodle:"dark",opacity:"0.36"},"#E6E1B1":{doodle:"dark",opacity:"0.42"},"#FEEFA9":{doodle:"light",opacity:"0.06"},"#FED297":{doodle:"dark",opacity:"0.42"},"#FD9A9B":{doodle:"dark",opacity:"0.26"},"#FD6769":{doodle:"dark",opacity:"0.26"},"#FB4668":{doodle:"dark",opacity:"0.26"},"#922040":{doodle:"dark",opacity:"0.17",invertTransparentWallpaperColors:!0},"#DC6E4F":{doodle:"dark",opacity:"0.2"},"#644D52":{doodle:"dark",opacity:"0.13",invertTransparentWallpaperColors:!0},"#517E7E":{doodle:"dark",opacity:"0.13"},"#3190BB":{doodle:"dark",opacity:"0.13"},"#35558A":{doodle:"dark",opacity:"0.1",invertTransparentWallpaperColors:!0},"#55626F":{doodle:"dark",opacity:"0.1",invertTransparentWallpaperColors:!0},"#1D2326":{doodle:"dark",opacity:"0.1",invertTransparentWallpaperColors:!0},"#301E34":{doodle:"dark",opacity:"0.1",invertTransparentWallpaperColors:!0},"#ECF0F1":{doodle:"light",opacity:"0.06"},"#FFFEA2":{doodle:"light",opacity:"0.06"},"#E7E8D2":{doodle:"light",opacity:"0.06"}},l={"#0F2424":{doodle:"dark",opacity:"0.05"},"#12261F":{doodle:"dark",opacity:"0.055"},"#11241C":{doodle:"dark",opacity:"0.055"},"#111E27":{doodle:"dark",opacity:"0.06"},"#0F2224":{doodle:"dark",opacity:"0.06"},"#0E2125":{doodle:"dark",opacity:"0.055"},"#1F1D25":{doodle:"dark",opacity:"0.06"},"#212121":{doodle:"dark",opacity:"0.055"},"#1F211C":{doodle:"dark",opacity:"0.055"},"#23231B":{doodle:"dark",opacity:"0.055"},"#262419":{doodle:"dark",opacity:"0.055"},"#261F17":{doodle:"dark",opacity:"0.055"},"#261717":{doodle:"dark",opacity:"0.055"},"#260F10":{doodle:"dark",opacity:"0.06"},"#260A10":{doodle:"dark",opacity:"0.07"},"#19050B":{doodle:"dark",opacity:"0.075"},"#21100C":{doodle:"dark",opacity:"0.07"},"#0F0C0C":{doodle:"dark",opacity:"0.065"},"#101919":{doodle:"dark",opacity:"0.06"},"#0A1D25":{doodle:"dark",opacity:"0.055"},"#0D1523":{doodle:"dark",opacity:"0.065"},"#0D0F11":{doodle:"dark",opacity:"0.07"},"#0A0C0D":{doodle:"dark",opacity:"0.07"},"#110B12":{doodle:"dark",opacity:"0.07"},"#1E1F1F":{doodle:"dark",opacity:"0.055"},"#262618":{doodle:"dark",opacity:"0.055"},"#23231F":{doodle:"dark",opacity:"0.055"}},c=Object.keys(s),d=Object.keys(l);function u(e){return r.ServerProps.wallpapersV2?"light"===e?c:d:a}function p(e,t,n){const r="light"===t?s:l;for(const t in r)if(t.toUpperCase()===e.toUpperCase())return r[t][n];return null}},32554:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.displayHighQualityLinkPreview=function(e,t){if(!Boolean(e.thumbnailDirectPath||e.thumbnailHQ)||null==e.thumbnailHeight||null==e.thumbnailWidth)return!1;if(a(e.t))return!1;return!(t===i.DISPLAY_TYPE.GALLERY)},t.hqLinkPreviewExpired=a;var r=n(40234),i=n(5177);function a(e){return r.Clock.globalUnixTime()-e>2592e3}},94270:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ReactionBubbleType=void 0;const r=n(76672).Mirrored(["DEFAULT","NON_CONVERSATION","STICKER","MEDIA_ITEM"]);t.ReactionBubbleType=r},52930:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return o(null,a.default.fromForwardsStrings(e.sort(((e,t)=>t.length-e.length)).map((e=>`${e}${s}`))),null,0)};var i=r(n(3522)),a=r(n(55205));function o(e,t,n,r,a){const c=[];let d=!1,u=a;if(null==u)if(e&&1===r){l.has(e)&&(u=!0)}else e&&n&&2===r&&(u=l.has(n+e));t.getChildren().forEach((t=>{t.prefix!==s?c.push(o(t.prefix,t.node,e,r+1,u)):d=!0}));const p=""!==e||null==n||u?(0,i.default)(e||""):"?";let f=0===c.length?"":`(?:${c.join("|")})`;return f&&d&&(f+="?"),`${p}${f}`}const s="\n",l=new Set(["","","","","",""])},13045:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VARIATION_CATEGORY=t.ORDERED_CATEGORY_IDS=t.LARGE_EMOJI_SIZE=t.HEART_EMOJIS=t.EMOJI_WIDTH=t.EMOJI_TYPE=t.CATEGORY_ORDERING=t.CATEGORY_MAPPING=t.CATEGORIES=t.BUCKET_SIZE=void 0;t.BUCKET_SIZE=25;t.CATEGORIES={SMILEYS_PEOPLE:"SMILEYS_PEOPLE",ANIMALS_NATURE:"ANIMALS_NATURE",FOOD_DRINK:"FOOD_DRINK",ACTIVITY:"ACTIVITY",TRAVEL_PLACES:"TRAVEL_PLACES",OBJECTS:"OBJECTS",SYMBOLS:"SYMBOLS",FLAGS:"FLAGS"};t.CATEGORY_MAPPING={"Smileys & People":"SMILEYS_PEOPLE","Animals & Nature":"ANIMALS_NATURE","Food & Drink":"FOOD_DRINK",Activity:"ACTIVITY","Travel & Places":"TRAVEL_PLACES",Objects:"OBJECTS",Symbols:"SYMBOLS",Flags:"FLAGS"};const r=["SMILEYS_PEOPLE","ANIMALS_NATURE","FOOD_DRINK","ACTIVITY","TRAVEL_PLACES","OBJECTS","SYMBOLS","FLAGS"];t.ORDERED_CATEGORY_IDS=r;t.EMOJI_TYPE={APPLE:"APPLE",WHATSAPP:"WHATSAPP"};t.EMOJI_WIDTH={small:20,large:32};const i=n(76672).Mirrored(["MEDIUM","LARGE","XLARGE"]);t.LARGE_EMOJI_SIZE=i;const a=[...r,"VARIATION"];t.CATEGORY_ORDERING=a;const o=a.indexOf("VARIATION");t.VARIATION_CATEGORY=o;t.HEART_EMOJIS=["","","","","","","","","","","","","","",""]},4837:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default={APPLE:["1d5e731","ba8bdec","2face08","a545008","8874004","c042b58","c3dc945","819bb22","f919b04","f142326","6342703","db8af96","254c6ee","9459d66","b757de6","c5531c6","eee0808","f44302b","0997ed3","5ab9f55","b7a4ec9","9fe8c9b","7934132","c5bfe3a","d9fe696","180bdeb","c65b738","1687c2a","2364fb1","2dac913","0e7766c","ca7e73b","7692c5e","7c4d80d","8cd6ca7","5ad1ddc","9f877c8","27c5d08","3099209","efd3a70","cf951db","2dcac8b","f61ea23","d1aa9c1","a220a6a","af6a7cf","69c3949","52aae5d","fa896fa","e057afe","f610f34","0a28f77","c8c4335","5b8e2f7","8431d9f","bc2093e","41cd719","7ad8d55","56d4834","c12380b","2d91dc3","334914c","3d9393f","4d871e0","24f0539","d55fc7d","38b3000","62ab315","531b804","3ed3a1e","7e1babf","d9c9192","3076c3a","ddf36af","da748cb","3ebbc9f","a33f9a6","bd66159","6df0912","1d628c1","724ef42","08d827e","05a67b6","7816bb1","42974a4","6525db2","aeb25f3","3bed38e","87ef56d","88fbe9c","a843e57","d042204","748969e","c624bfc","f99b5a3","a15a462","6db790b","8f595b1","ed170c1","28caf36","1ec6250","1f54af3","7f43cd3","979a532","9b0ac77","13b8ceb","6639e79","d0b8ff7","e6296a8","42437ce","d59625c","620ec44","5130c11","3745318","1b38856","937b1d8","098fd51","b67d38a","ccea594","80472df","f45a839","c267e9b","6134a43","e3ddadf","217cb2e","27794e6","ce1bca0","2ec6308","dca927a","5099652","8606b5c","ff70a07","99acb30","d0ad76f","10378f5","d69be1f","cd9e3d0","a5ba00a","dc7c828","55c6310","c8df73e"],WHATSAPP:["275ab2d","2daeeb8","2224eba","0b9fe45","17c7395","a55d276","72434c2","1dd3846","270a5f3","7a609af","4bc31db","a662a91","1a6e349","5d916f5","893eec6","6bd244c","d41b50c","1390219","1e2bb45","6fda0bc","5da7428","2a928c7","d0de61a","951eaf0","abf067b","7d8ffef","c3f1765","63c4caa","57db7e9","a5c7aae","3f057f6","3e451ea","8e8748b","9674031","6a75fe0","c5081c9","1b3d484","87ac96a","8af6206","3e4cd80","dea012c","0bfd00d","ac92df9","5988695","7fc1fef","f064985","ffefa9d","35d35a9","c4e922a","7a7637f","bec2fdf","5543365","b434947","59fdfea","3dbba43","9a04fc9","c8efe85","858b6bb","bc37e7d","0df49c7","7e953c6","a99489e","620104d","4775444","838a358","36f0702","73011a9","8830247","4b471be","e607bf5","e4f5f3f","d7e8913","f80d26f","efbc9b8","e8a7519","ec05a92","ad38c5f","33a2551","5e1660c","1395194","c585594","37ebc47","c1eba8a","78e2b60","929560c","fae06f3","4e858e5","428370e","21fa232","8189c09","c7cdfc4","52d7641","10d01ec","251748f","e15b9d8","76c46c9","05bd55e","d321ca5","6fb5d64","6b996dd","1d332e2","d5334af","e41e707","bef85df","87d3d34","db6d4e3","98dee68","03e68f5","338835d","a6b0372","968722c","1d7689c","d50117f","dba5f1b","e030c5c","d4ba921","f4a2a06","1cd377e","21622a3","13dd7ff","fb69465","16c51db","67a21f5","b8dc46e","f501f99","21b8cd1","18851e7","77c853f","0276720","9573645","a609d4f"]}},95885:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getEmojiSpritesPath=function(e,t,n,r){const o=(0,i.default)(a.default[e][t],"emojiSpriteHashes[emojiType][bucketId]");return`${s}/emoji-${t}-${n}_${o}.${r}`},t.getGlyphPath=function(e,t,n){return{low:l(`${t}-${"large"===n?"40":"64"}.png`,e.toLowerCase()),high:l(`${t}-64.png`,e.toLowerCase())}};var i=r(n(45095)),a=r(n(4837)),o=n(30614);const s="/img";function l(e,t){let n=null;return n="/img",`/img/${o.prefixHash}_${t.slice(0,1)}_${e}`}},67247:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getPermutations=t.OPEN_BOX_CHAR=t.EmojiUtil=void 0,t.isBaseCoupleEmoji=function(e){return m.includes(e)};var i=r(n(42905)),a=r(n(88306)),o=r(n(48447)),s=r(n(45095)),l=r(n(5298)),c=r(n(94184)),d=r(n(41143)),u=r(n(52930)),p=n(13045),f=n(95885),h=r(n(1429));t.OPEN_BOX_CHAR="";const _=["","","","",""],g=new RegExp(_.join("|"),"g"),m=["","","","","","","","","","","",""],y=p.HEART_EMOJIS.map((e=>e)),E=new Set(["","","","","","","","","","","","","","","",""]),S=e=>e.replace(/\uFE0F/g,""),v=(0,a.default)(((e,t)=>function n(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(r.length===t)return[r];let i=[];for(let t=0;t<e.length;t++){const a=[...r];a.push(e[t]),i=i.concat(n(a))}return i}()),((e,t)=>e.toString()+t));t.getPermutations=v;function T(e){return e.every((t=>t===e[0]))?e[0]:e.join("")}const b=new class{constructor(){var e=this;this.skinToneVariations=_,this._specialEmojiRegex=null,this.emojiRegex=()=>{const e=this._createEmojiRegexIfNeeded();return e.lastIndex=0,e},this._createEmojiRegexIfNeeded=(0,l.default)((()=>{const e=this._getEmojiRegexSource();return new RegExp("("+e+")","g")})),this.onlyEmojiRegex=()=>{const e=this._createOnlyEmojiRegexIfNeeded();return e.lastIndex=0,e},this._createOnlyEmojiRegexIfNeeded=(0,l.default)((()=>{const e=this._getEmojiRegexSource();return new RegExp("^("+e+")+$","g")})),this.convertToTextWithoutSpecialEmojis=e=>{if(!this._specialEmojiRegex){const e=(0,u.default)(Object.keys(h.default));this._specialEmojiRegex=new RegExp(`(${e})`,"g")}return this._specialEmojiRegex.lastIndex=0,e.replace(this._specialEmojiRegex,(e=>h.default[e]))},this.splitEmojis=e=>!1===this.containsOnlyEmoji(e)?null:e.split(this.emojiRegex()).filter(Boolean),this.containsEmoji=e=>this.emojiRegex().test(e),this.containsOnlyEmoji=e=>this.onlyEmojiRegex().test(e),this.matchLargeEmojiPattern=e=>{if(e.length>50||e.includes(" "))return null;const t=this._getLargeEmojisRegex().exec(e);return t?t.filter(Boolean).slice(1):null},this.normalizeEmojiFromString=e=>this.normalizeEmoji(e),this.normalizeEmoji=e=>{const t=S(e),{unqualifiedToNormalizedEmoji:n}=this._getDerivedMaps();return n.get(t)},this.normalizeAllEmojis=(0,a.default)((e=>e?e.replace(this.emojiRegex(),((e,t)=>{var n;return E.has(t)?"":null!==(n=this.normalizeEmoji(t))&&void 0!==n?n:""})):"")),this.getSkinToneVariant=(e,t)=>{const n=this._getBaseToSkinToneEmojis().get(e);if(null==n)return null;const r=T(t);return n.get(r)},this._getDerivedMaps=(0,l.default)((()=>{const{orderedEmojis:e,legacyToEmoji:t}=this._getConfig(),n=new Map,r=new Map,a=new Map;let o=0;return e.forEach(((e,t)=>{if(""===e||null==e)return;(Array.isArray(e)?e:[e]).forEach((e=>{r.set(e,t);const n=S(e);a.set(n,e)})),n.set(t,o),o++})),(0,i.default)(t).forEach((e=>{let[t,n]=e;r.set(t,n);const i=S(t);a.set(i,t)})),{emojiToGlyphId:r,glyphIdToIndex:n,unqualifiedToNormalizedEmoji:a}})),this._getBaseToSkinToneEmojis=(0,l.default)((()=>{const{emojiToGlyphId:e}=this._getDerivedMaps(),t=new Map;for(const n of e.keys()){let e;const r=n.replace(g,(t=>(null==e&&(e=[]),e.push(t),"")));if(null==e)continue;const i=e;let a;a=""===r?"":""===r?"":""===r?"":""===r?"":""===r?"":r;const o=this.normalizeEmoji(a);if(null==o)continue;let s=t.get(o);null==s&&(s=new Map,s.set("",o),t.set(o,s));const l=T(i);s.set(l,n)}return t})),this._getSkinToneEmojisToBase=(0,l.default)((()=>{const e=new Map;for(const[t,n]of this._getBaseToSkinToneEmojis().entries())for(const r of n.values())e.set(r,t);return e})),this._getEmojiRegexSource=(0,l.default)((()=>{const{emojiToGlyphId:e}=this._getDerivedMaps();return(0,u.default)([...Array.from(e.keys()),...Array.from(E)].filter(Boolean))})),this._createLargeEmojisRegexIfNeeded=(0,l.default)((()=>{const e=this._getEmojiRegexSource();return new RegExp(`^(${e})(${e})?(${e})?$`)})),this.getEmojisInCategory=e=>{var t;return null!==(t=this._getConfig().categorizedEmojis[e])&&void 0!==t?t:[]},this._getEmojiToCategory=(0,l.default)((()=>{const{categorizedEmojis:e}=this._getConfig(),t=new Map;return Object.keys(e).forEach((n=>{const r=p.CATEGORY_ORDERING.indexOf(n);e[n].forEach((e=>{const n=this.normalizeEmoji(e);null!=n&&t.set(n,r)}))})),t})),this.getGlyphId=e=>{const t=this.normalizeEmoji(e);if(null==t)return null;const{emojiToGlyphId:n}=this._getDerivedMaps();return n.get(t)},this.getGlyphPath=(e,t)=>(0,f.getGlyphPath)(this._getConfig().emojiType,e,t),this.isGlyphCached=e=>{const t=this._getGlyphIndex(e);return this._getCachedGlyphs().get(t)},this.markGlyphCached=e=>{const t=this._getGlyphIndex(e);this._getCachedGlyphs().set(t)},this._getCachedGlyphs=(0,l.default)((()=>new o.default(this._getGlyphCount()))),this.getCssClasses=function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"small";return(0,c.default)(`b${e.getBucket(t)}`,"small"===n?"emoji":"emojik",e._getConfig().emojiType===p.EMOJI_TYPE.APPLE?"apple":"wa")},this.getStyle=function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"small";const{xpos:r,ypos:i}=e._getCoordinates(t,n);return{backgroundPosition:`-${r}px -${i}px`}},this.getBucket=e=>{const t=this._getGlyphIndex(e);return`${Math.floor(t/p.BUCKET_SIZE)}`},this.getHeartEmojis=(0,l.default)((()=>y.map(this.normalizeEmoji).filter(Boolean))),this._getLastBucketId=(0,l.default)((()=>{const e=this._getGlyphCount();return e-e%p.BUCKET_SIZE})),this._getLastBucketCols=(0,l.default)((()=>Math.floor(Math.sqrt(this._getGlyphCount()-this._getLastBucketId()))))}configure(e){e!==this._config&&(this._config=e,this.getHeartEmojis.reset(),this._specialEmojiRegex=null,this._createEmojiRegexIfNeeded.reset(),this._createLargeEmojisRegexIfNeeded.reset(),this._createOnlyEmojiRegexIfNeeded.reset(),this._getEmojiRegexSource.reset(),this._getCachedGlyphs.reset(),this._getSkinToneEmojisToBase.reset(),this._getBaseToSkinToneEmojis.reset(),this._getEmojiToCategory.reset(),this._getLastBucketId.reset(),this._getLastBucketCols.reset(),this._getDerivedMaps.reset())}_getConfig(){return(0,d.default)(null!=this._config,"Attempt to use EmojiUtil before it's been configured"),this._config}isEmoji(e){return null!=this.normalizeEmoji(e)}getSkinToneBase(e){var t;const n=this.normalizeEmoji(e);return null==n?null:null!==(t=this._getSkinToneEmojisToBase().get(n))&&void 0!==t?t:null}_getLargeEmojisRegex(){const e=this._createLargeEmojisRegexIfNeeded();return e.lastIndex=0,e}_getGlyphCount(){const{glyphIdToIndex:e}=this._getDerivedMaps();return e.size}_getCoordinates(e,t){const n=this._getGlyphIndex(e),r=n%p.BUCKET_SIZE,i=n>=this._getLastBucketId()?this._getLastBucketCols():Math.floor(Math.sqrt(p.BUCKET_SIZE)),a=p.EMOJI_WIDTH[t],o=Math.floor(r/i);return{xpos:Math.floor(r%i)*a,ypos:o*a,width:a}}_getGlyphIndex(e){const{glyphIdToIndex:t}=this._getDerivedMaps();return(0,s.default)(t.get(e),"glyphIdToIndex.get(glyphId)")}getEmojiAggregate(e){return this.removeSkinTone(this.getNormalizedOrTofu(e))}removeSkinTone(e){return e}getNormalizedOrTofu(e){return this.normalizeEmojiFromString(e)?e:""}};t.EmojiUtil=b},45017:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let t=null,n=0;try{var r;const i=e.length;for(;n<i;){const r=e.codePointAt(n),i=r>65535?2:1;if(m(t)&&(r<48||r>57))if(45===r)0===t.phoneNumberParenthesesDepth?45===t.phoneNumberLastSignificantCodePoint?E(t,n):0===t.phoneNumber.length?h(t):d(t):h(t);else if(46===r)0===t.phoneNumberParenthesesDepth?46===t.phoneNumberLastSignificantCodePoint?E(t,n):0===t.phoneNumber.length?h(t):c(t):h(t);else if(40===r);else if(41===r)S(t,n);else if(32===r)if(32===t.phoneNumberLastSignificantCodePoint)h(t);else{y(t,n)||u(t)}else E(t,n);switch(r){case 42:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:m(t)||(t||(t=s(e)),f(t,n)),p(t,r);break;case 43:t||(t=s(e)),f(t,n),l(t);break;case 40:m(t)||(t||(t=s(e)),f(t,n)),_(t,n)}n+=i}return t&&null!=t.openings&&E(t,e.length),(null===(r=t)||void 0===r?void 0:r.parsedPhoneNumbers)&&t.parsedPhoneNumbers.length>0?t.parsedPhoneNumbers.reduce(((e,t)=>(e.push({phone:t.matchedText,index:t.start}),e)),[]):[]}catch(e){return __LOG__(4,void 0,new Error,!0)`findPhoneNumbers parse error: ${String(e)}`,SEND_LOGS("findPhoneNumbers-error"),[]}};var i=r(n(88306)),a=n(40277),o=n(99234);function s(e){return{uniqueId:0,text:e,openings:null,phoneNumber:"",phoneNumberStartsWithPlus:!1,phoneNumberLastSignificantCodePoint:-1,phoneNumberParenthesesDepth:0,phoneNumberLeadingZeroes:0,phoneNumberCurrentlyMatchingLeadingZeroes:!0,parsedPhoneNumbers:null}}function l(e){e.phoneNumberStartsWithPlus=!0}function c(e){e.phoneNumberLastSignificantCodePoint=46}function d(e){e.phoneNumberLastSignificantCodePoint=45}function u(e){e.phoneNumberLastSignificantCodePoint=32}function p(e,t){e.phoneNumber=e.phoneNumber+String.fromCodePoint(t),e.phoneNumberLastSignificantCodePoint=t,e.phoneNumberCurrentlyMatchingLeadingZeroes&&(48===t?e.phoneNumberLeadingZeroes++:e.phoneNumberCurrentlyMatchingLeadingZeroes=!1)}function f(e,t){null==e.openings?(e.openings=t,e.phoneNumber="",e.phoneNumberStartsWithPlus=!1,e.phoneNumberLastSignificantCodePoint=-1,e.phoneNumberParenthesesDepth=0,e.phoneNumberLeadingZeroes=0,e.phoneNumberCurrentlyMatchingLeadingZeroes=!0):__LOG__(4,void 0,new Error)`Msg formatting: cannot open a style before closing it`}function h(e){null!=e.openings?e.openings=null:__LOG__(4,void 0,new Error)`Msg formatting: cannot close a style before opening it`}function _(e,t){1!==e.phoneNumberParenthesesDepth?(e.phoneNumberParenthesesDepth++,e.phoneNumberLastSignificantCodePoint=-1):h(e)}const g=(0,i.default)((e=>(0,a.phoneCC)(e)));function m(e){return null!=e&&null!=e.openings}function y(e,t){const n=function(e,t){if(null==e.openings)return;if(1===e.phoneNumberParenthesesDepth)return null;const n=e.phoneNumber.slice(Math.min(2,e.phoneNumberLeadingZeroes));if(0===n.length)return null;let r=!1,i=n;if(e.phoneNumberStartsWithPlus||e.phoneNumberLeadingZeroes>=2){const e=(0,a.findCC)(n),t=n.slice(e.length);r=(0,a.isPotentiallyValid)(e,t)}else{var s;const e=(null===(s=(0,o.getMaybeMeUser)())||void 0===s?void 0:s.toString())||"",t=g(e);if(r=(0,a.isPotentiallyValid)(t,n),r)i=`${t}${n}`;else{const e=(0,a.findCC)(n);if(e===t){const t=n.slice(e.length);r=(0,a.isPotentiallyValid)(e,t)}}}if(r){const n=e.openings;if(null==n)return null;const r=45===e.phoneNumberLastSignificantCodePoint||46===e.phoneNumberLastSignificantCodePoint?t-1:t,a=e.text.slice(n,r);return{start:n,end:r,id:"phone"+ ++e.uniqueId,phoneNumber:i,matchedText:a}}return null}(e,t);return null!=n&&(h(e),e.parsedPhoneNumbers?e.parsedPhoneNumbers.push(n):e.parsedPhoneNumbers=[n],!0)}function E(e,t){y(e,t)||h(e)}function S(e,t){0===e.phoneNumberParenthesesDepth||e.phoneNumberLastSignificantCodePoint<48||e.phoneNumberLastSignificantCodePoint>57?h(e):(e.phoneNumberParenthesesDepth--,e.phoneNumberLastSignificantCodePoint=-1)}},63448:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.formatNFMText=o,t.formatNFMTextPreview=function(e){if(e.nativeFlowName===a.default.ORDER_DETAILS){const t=(0,i.formatOrderDetailsMessagePreview)(e);if(null!=t)return t}return o(e)};var i=n(37899),a=r(n(5165));function o(e){return e.caption||""}},38701:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return"string"==typeof e?e:e&&(e.displayName||e.name)||"Component"}},7128:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.WrappedComponent=t.HOCRef=void 0,t._getComponent=function(){const e=this.component||this.refs.component;if("function"==typeof e._getComponent)return e._getComponent();return e};var i=r(n(81109)),a=r(n(45095)),o=n(67294);t.HOCRef="component";class s extends o.Component{constructor(e){super(e),this.setComponent=e=>{this.component=e},this.state=(0,i.default)({},this.state)}static getDerivedStateFromError(){return{hasError:!0}}componentDidCatch(e,t){__LOG__(4,void 0,new Error,!0)`${e.stack}\n${t.componentStack}`,SEND_LOGS("component-did-catch")}getComponent(){return this.component instanceof s?this.component.getComponent():(0,a.default)(this.component,"this.component")}}t.WrappedComponent=s},84387:(e,t,n)=>{"use strict";var r=n(59182).default,i=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ListenerHOC=function(e){var t,n;return(t=class extends d.WrappedComponent{constructor(){super(...arguments),this.listeners=new f}componentDidMount(){this.listeners.internalUseOnlyMarkMounted()}componentWillUnmount(){this.listeners.internalUseOnlyMarkUnmounted()}_getComponent(){return d._getComponent.call(this)}render(){return this.state.hasError?null:(0,p.jsx)(e,(0,a.default)((0,a.default)({ref:this.setComponent},this.props),{},{listeners:this.listeners}))}}).defaultProps=null!==(n=e.defaultProps)&&void 0!==n?n:void 0,t.displayName=`Listener(${(0,c.default)(e)})`,t.wrappedComponent=null,t},t.Listeners=void 0;var a=i(n(81109)),o=n(89385),s=n(98159),l=n(88102),c=i(n(38701)),d=n(7128),u=n(59923),p=n(85893);class f{constructor(){this._mounted=!1,this._unmounted=!1,this._listeners=new Set,this._remove=e=>{e.disengage(),this._listeners.delete(e)}}_add(e){this._unmounted?__LOG__(3)`Listener added after unmounting`:(this._listeners.add(e),this._mounted&&e.engage())}internalUseOnlyMarkMounted(){this._mounted=!0,this._listeners.forEach((e=>{e.engage()}))}internalUseOnlyMarkUnmounted(){this._unmounted=!0,this._listeners.forEach(this._remove),this._abortController&&this._abortController.abort()}add(e,t,n,r){const i=this,a=new u.Listener(e,t,(function(){i._unmounted||n.apply(this,arguments)}),r,n);this._add(a)}addOnce(e,t,n,r){const i=this,a=new u.Listener(e,t,(function(){i._remove(a),i._unmounted||n.apply(this,arguments)}),r,n);this._add(a)}remove(e,t,n,r){this._listeners.forEach((i=>{i.represents(e,t,n,r)&&this._remove(i)}))}uiIdle(e){l.Cmd.uiBusy?this.addOnce(l.Cmd,"ui_idle",e):(this._abortController=this._abortController||new r,(0,s.documentFlushed)({signal:this._abortController.signal}).then((()=>{e()}),(e=>{if(e.name!==o.ABORT_ERROR)throw e})))}testsOnlyGetListeners(){return this._listeners}}t.Listeners=f},31019:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.unproxy=function(e){if(null==e?void 0:e.$ProxyState$state)return e.$ProxyState$state;return e}},4478:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t;return(t=class extends l.WrappedComponent{constructor(){var e;super(...arguments),e=this,this._timers=new Map,this._timerId=0,this._unmounted=!1,this.setInterval=(e,t)=>{this._unmounted&&(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("Setting interval after unmount"));const n=++this._timerId,r=window.setInterval(e,t);return this._timers.set(n,(()=>{window.clearInterval(r),this._timers.delete(n)})),n},this.clearInterval=e=>{const t=this._timers.get(e);t&&t()},this.setTimeout=(e,t)=>{this._unmounted&&(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("Setting timeout after unmount"));const[n,r]=this._cbWrapper(e),i=window.setTimeout(r,t);return this._timers.set(n,(()=>{window.clearTimeout(i),this._timers.delete(n)})),n},this.clearTimeout=e=>{const t=this._timers.get(e);t&&t()},this.requestAnimationFrame=e=>{this._unmounted&&(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("Requesting animation frame after unmount"));const[t,n]=this._cbWrapper(e),r=window.requestAnimationFrame(n);return this._timers.set(t,(()=>{window.cancelAnimationFrame(r),this._timers.delete(t)})),t},this.cancelAnimationFrame=e=>{const t=this._timers.get(e);t&&t()},this.throttle=(t,n,r)=>{this._unmounted&&(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("Throttling after unmount"));const[i,a]=this._cbWrapper(t),s=(0,o.default)(a,n,r),l=s.cancel.bind(s);s.cancel=()=>{l(),this._timers.delete(i)};const c=function(){e._unmounted||(e._timers.set(i,s.cancel),s(...arguments))};return c.cancel=s.cancel,c.flush=s.flush,c},this.debounce=(t,n,r)=>{this._unmounted&&(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("Debouncing after unmount"));const[i,o]=this._cbWrapper(t),s=(0,a.default)(o,n,r),l=s.cancel.bind(s),c=s.flush.bind(s);s.cancel=()=>{l(),this._timers.delete(i)},s.flush=()=>{c()};const d=function(){e._unmounted||(e._timers.set(i,s.cancel),s(...arguments))};return d.cancel=s.cancel,d.flush=s.flush,d},this._cbWrapper=t=>{const n=++this._timerId;return[n,function(){e._timers.delete(n),t(...arguments)}]}}_getComponent(){return l._getComponent.call(this)}componentWillUnmount(){this._unmounted=!0,this._timers.forEach((e=>e()))}render(){return this.state.hasError?null:(0,c.jsx)(e,(0,i.default)({ref:this.setComponent,setInterval:this.setInterval,clearInterval:this.clearInterval,setTimeout:this.setTimeout,clearTimeout:this.clearTimeout,requestAnimationFrame:this.requestAnimationFrame,cancelAnimationFrame:this.cancelAnimationFrame,debounce:this.debounce,throttle:this.throttle},this.props))}}).displayName=`Timer(${(0,s.default)(e)})`,t.wrappedComponent=null,t};var i=r(n(81109)),a=r(n(23279)),o=r(n(23493)),s=r(n(38701)),l=n(7128),c=n(85893)},90012:(e,t,n)=>{"use strict";var r=n(59182).default,i=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t,n;return(t=class extends s.WrappedComponent{constructor(){super(...arguments),this._isUnmounted=!1,this._controller=null,this.getUnmountSignal=()=>(this._controller||(this._controller=new r,this._isUnmounted&&this._controller.abort()),this._controller.signal)}componentWillUnmount(){var e;this._isUnmounted=!0,null===(e=this._controller)||void 0===e||e.abort()}_getComponent(){return s._getComponent.call(this)}render(){return this.state.hasError?null:(0,l.jsx)(e,(0,a.default)({ref:this.setComponent,getUnmountSignal:this.getUnmountSignal},this.props))}}).defaultProps=null!==(n=e.defaultProps)&&void 0!==n?n:void 0,t.displayName=`UnmountSignal(${(0,o.default)(e)})`,t.wrappedComponent=null,t};var a=i(n(81109)),o=i(n(38701)),s=n(7128),l=n(85893)},51799:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){const r=(0,o.default)(e),{leading:s,trailing:l,maxWait:c}=null!=n?n:{},d=(0,a.useMemo)((()=>(0,i.default)(r,t,n)),[t,s,c,l,r]);return(0,a.useEffect)((()=>d.cancel),[d]),d};var i=r(n(23279)),a=n(67294),o=r(n(89113))},85647:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){const[e,t]=(0,r.useState)(!1),n=(0,a.useFocusVisibility)();return[(0,i.useFocus)({onFocusChange:t}),e&&n]};var r=n(67294),i=n(60480),a=n(22885)},59312:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){const[,e]=(0,r.useReducer)((e=>e+1),0);return e};var r=n(67294)},70393:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;const{immediate:r=!1}=null!=n?n:{},o=(0,a.default)(e),s=(0,i.useRef)(),l=(0,i.useCallback)((()=>{s.current&&clearInterval(s.current)}),[]),c=(0,i.useCallback)((()=>{l(),s.current=setInterval(o,t)}),[l,t,o]);return(0,i.useEffect)((()=>(r&&c(),l)),[r,c,l]),[c,l]};var i=n(67294),a=r(n(89113))},16747:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){const e=(0,r.useRef)(!1);(0,r.useEffect)((()=>(e.current=!0,()=>{e.current=!1})),[]);return(0,r.useCallback)((()=>e.current),[])};var r=n(67294)},16223:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=(0,r.useRef)();null==t.current&&(t.current=e());return t};var r=n(67294)},87550:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.useAddListenerOnce=function(){const e=(0,o.useRef)(),t=(0,o.useCallback)(((t,n,r,a)=>{e.current=c(t,n,r,(0,i.default)((0,i.default)({},a),{},{once:!0}))}),[]),n=(0,o.useCallback)((()=>{var t;null===(t=e.current)||void 0===t||t.call(e)}),[]);return(0,o.useEffect)((()=>n),[n]),[t,n]},t.useListener=function(e,t,n,r){const i=(0,s.default)(n),a=d(t);(0,o.useLayoutEffect)((()=>{if(null!=n)return c(e,t,i,r)}),[e,null==n,a])},t.useListeners=function(e){const t=e.map((e=>{let{callback:t}=e;return t})),n=(0,o.useRef)(t);n.current=t;const r=e.map((e=>{let{source:t,eventOrEvents:n}=e;return`${(0,a.default)(t)},${d(n)}`})).join("-");(0,o.useLayoutEffect)((()=>{const t=e.map(((e,t)=>{let{source:r,eventOrEvents:i,opts:a}=e;return c(r,i,(function(){for(var e,r,i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return null===(e=(r=n.current)[t])||void 0===e?void 0:e.call(r,...a)}),a)}));return()=>t.forEach((e=>e()))}),[r])};var i=r(n(81109)),a=r(n(92226)),o=n(67294),s=r(n(89113)),l=n(59923);function c(e,t,n,r){if(null==e)return()=>{};const i=function(e,t){if(Array.isArray(t))return(0,l.isEventsType)(e)?[t.join(" ")]:t;return[t]}(e,t).map((t=>new l.Listener(e,t,(function(){(null==r?void 0:r.once)&&a(),n(...arguments)}),r)));i.forEach((e=>{e.engage()}));const a=()=>{i.forEach((e=>{e.disengage()}))};return a}function d(e){return Array.isArray(e)?e.join("\0"):e}},78506:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(48313).useMergeRefs;t.default=r},55010:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=(0,a.default)(e);(0,i.useEffect)((()=>t),[t])};var i=n(67294),a=r(n(89113))},37453:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=(0,r.useRef)();return(0,r.useEffect)((()=>{t.current=e})),t.current};var r=n(67294)},89113:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=(0,r.useRef)(e);t.current=e;return(0,r.useCallback)((function(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return null===(e=t.current)||void 0===e?void 0:e.call(t,...r)}),[])};var r=n(67294)},34470:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n;const r=(0,i.useRef)(),s=!0===(null==t?void 0:t.disabled),l=s?o:e;return[e=>{r.current=e},{"aria-disabled":null!==(n=null==t?void 0:t.disabled)&&void 0!==n?n:void 0,onClick:l,onKeyPress:function(e){var t;(0,a.default)(e)&&(e.stopPropagation(),e.preventDefault(),null===(t=r.current)||void 0===t||t.click())},role:"button",tabIndex:s?-1:0}]};var i=n(67294),a=r(n(54889));function o(){}},46428:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.useManualTimeout=o,t.useTimeout=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;const{immediate:r=!1}=null!=n?n:{},[a,s]=o(e),l=(0,i.useCallback)((()=>a(t)),[a,t]);return(0,i.useEffect)((()=>{r&&l()}),[r,l]),[l,s]};var i=n(67294),a=r(n(89113));function o(e){const t=(0,a.default)(e),n=(0,i.useRef)(),r=(0,i.useCallback)((()=>{n.current&&clearTimeout(n.current)}),[]),o=(0,i.useCallback)((e=>{r(),n.current=setTimeout(t,e)}),[r,t]);return(0,i.useEffect)((()=>r),[r]),[o,r]}},3409:(e,t,n)=>{"use strict";var r=n(59182).default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){const[e]=(0,i.useState)((()=>new r));return(0,i.useEffect)((()=>()=>e.abort()),[e]),e.signal};var i=n(67294)},56599:(e,t,n)=>{"use strict";var r=n(59182).default,i=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.initModules=function(){c()};var a=i(n(51463)),o=n(19770),s=n(46582);const l={minTimeout:1e3,maxTimeout:12e4,retries:1/0,signal:(new r).signal};const c=(0,a.default)((function(){return(0,o.exponentialBackoff)(l,((e,t)=>Promise.all([n.e(2101),n.e(7964)]).then(n.bind(n,67019)).catch((n=>(__LOG__(3)`failed to load main bundle`,10===t&&(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("failed to load main bundle")),e(n)))))).then((e=>(0,s.setMainBundleModules)(e)))}))},46582:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getMainBundleModules=o,t.requireCallCollection=function(){return S.apply(this,arguments)},t.requireChatCollection=function(){return m.apply(this,arguments)},t.requireClearAppStates=function(){return h.apply(this,arguments)},t.requireContactCollection=function(){return l.apply(this,arguments)},t.requireEmojiAssetMapCreator=function(){return p.apply(this,arguments)},t.requireEmojiConfig=function(){return u.apply(this,arguments)},t.requireHandleSocketMessage=function(){return d.apply(this,arguments)},t.requireHandleVideoStreamingRequest=function(){return _.apply(this,arguments)},t.requireLabelCollection=function(){return g.apply(this,arguments)},t.requireLoadProtoVersions=function(){return c.apply(this,arguments)},t.requireMain=function(){return s.apply(this,arguments)},t.requireMsgCollection=function(){return y.apply(this,arguments)},t.requireSetHandlers=function(){return b.apply(this,arguments)},t.requireStatusV3Collection=function(){return f.apply(this,arguments)},t.requireStickerPackCollection=function(){return E.apply(this,arguments)},t.requireVoip=function(){return v.apply(this,arguments)},t.requireVoipCommonDisabled=function(){return T.apply(this,arguments)},t.setMainBundleModules=function(e){return a.resolve(e),e};var i=r(n(48926));const a=new(n(88156).Resolvable);function o(){return a.promise}function s(){return(s=(0,i.default)((function*(){return(yield o()).requireMain()}))).apply(this,arguments)}function l(){return(l=(0,i.default)((function*(){return(yield o()).requireContactCollection()}))).apply(this,arguments)}function c(){return(c=(0,i.default)((function*(){return(yield o()).requireLoadProtoVersions()}))).apply(this,arguments)}function d(){return(d=(0,i.default)((function*(){return(yield o()).requireHandleSocketMessage()}))).apply(this,arguments)}function u(){return(u=(0,i.default)((function*(){return(yield o()).requireEmojiConfig()}))).apply(this,arguments)}function p(){return(p=(0,i.default)((function*(){return(yield o()).requireEmojiAssetMapCreator()}))).apply(this,arguments)}function f(){return(f=(0,i.default)((function*(){return(yield o()).requireStatusV3Collection()}))).apply(this,arguments)}function h(){return(h=(0,i.default)((function*(){return(yield o()).requireClearAppStates()}))).apply(this,arguments)}function _(){return(_=(0,i.default)((function*(){return(yield o()).requireHandleVideoStreamingRequest()}))).apply(this,arguments)}function g(){return(g=(0,i.default)((function*(){return(yield o()).requireLabelCollection()}))).apply(this,arguments)}function m(){return(m=(0,i.default)((function*(){return(yield o()).requireChatCollection()}))).apply(this,arguments)}function y(){return(y=(0,i.default)((function*(){return(yield o()).requireMsgCollection()}))).apply(this,arguments)}function E(){return(E=(0,i.default)((function*(){return(yield o()).requireStickerPackCollection()}))).apply(this,arguments)}function S(){return(S=(0,i.default)((function*(){return(yield o()).requireCallCollection()}))).apply(this,arguments)}function v(){return(v=(0,i.default)((function*(){return(yield o()).requireVoip()}))).apply(this,arguments)}function T(){return(T=(0,i.default)((function*(){return(yield o()).requireVoipCommonDisabled()}))).apply(this,arguments)}function b(){return(b=(0,i.default)((function*(){return(yield o()).requireSetHandlers()}))).apply(this,arguments)}},59923:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.Listener=void 0,t.isEventsType=o;var i=n(81703),a=r(n(76521));function o(e){return e instanceof a.default||"function"==typeof e.on&&"function"==typeof e.off}t.Listener=class{constructor(e,t,n,r,a){this._hasEngaged=!1,this._hasDisengaged=!1,this.source=e,this.cb=n,this.opts=r,this._cbIdentifier=a,o(e)?this.event=t:this.event=(0,i.compatPrefix)(t,e)}engage(){if(this._hasEngaged||this._hasDisengaged)return;this._hasEngaged=!0;const e=this.source,t=this.event;o(e)?(e.on(t,this.cb),"function"==typeof e.incObservers&&e.incObservers()):this.opts?e.addEventListener(t,this.cb,this.opts):e.addEventListener(t,this.cb)}disengage(){if(this._hasDisengaged)return;if(this._hasDisengaged=!0,!this._hasEngaged)return;const e=this.source,t=this.event;o(e)?(e.off(this.event,this.cb),"function"==typeof e.decObservers&&e.decObservers()):this.opts?e.removeEventListener(t,this.cb,this.opts):e.removeEventListener(t,this.cb)}represents(e,t,n,r){var i;if(this.source!==e)return!1;if(this.event!==t)return!1;if(this._cbIdentifier!==n)return!1;const{capture:a=!1,once:o=!1,passive:s=!1}=null!=r?r:{},{capture:l=!1,once:c=!1,passive:d=!1}=null!==(i=this.opts)&&void 0!==i?i:{};return a===l&&o===c&&s===d}}},65273:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(81109)),a=r(n(30988)),o=r(n(18446)),s=n(50833),l=n(39581),c=r(n(48014)),d=n(47732),u=n(39989),p=r(n(16186)),f=r(n(24055)),h=r(n(46668)),_=n(81829);class g{static create(){const{backgroundColor:e,tintColor:t}=d.DEFAULT_DOMINANT_COLOR.getBackgroundAndTintColors();return new g({id:Math.random(),frame:new f.default({origin:new p.default({x:0,y:0}),size:new h.default({width:0,height:0}),rotation:0,scale:0}),layers:[],paintLayer:new s.DrawLayer({size:h.default.empty(),type:s.DrawLayerType.Paint}),outlineLayer:new s.DrawLayer({size:h.default.empty(),type:s.DrawLayerType.Outline}),background:null,selectedLayer:null,backgroundColor:e,tintColor:t,rotation:0,cropFrame:new f.default({origin:new p.default({x:0,y:0}),size:new h.default({width:0,height:0}),rotation:0,scale:0})})}constructor(e){this._props=Object.freeze((0,i.default)({},e)),Object.freeze(this)}_update(e){const t=(0,i.default)({},this._props);return null!=e.layers&&(t.layers=e.layers),void 0!==e.paintLayer&&(t.paintLayer=e.paintLayer),void 0!==e.outlineLayer&&(t.outlineLayer=e.outlineLayer),void 0!==e.background&&(t.background=e.background),void 0!==e.frame&&(t.frame=e.frame,t.frame&&(t.cropFrame=t.cropFrame.updateXYWidthHeight({x:0,y:0,width:t.frame.width,height:t.frame.height}))),void 0!==e.cropFrame&&(t.cropFrame=e.cropFrame),void 0!==e.selectedLayer&&(t.selectedLayer=e.selectedLayer),null!=e.backgroundColor&&(t.backgroundColor=e.backgroundColor),null!=e.tintColor&&(t.tintColor=e.tintColor),null!=e.rotation&&(t.rotation=e.rotation),(0,o.default)(this._props,t)?this:new g(t)}updateLayer(e,t){if(e instanceof _.TextLayer&&!(t instanceof _.TextLayer)||e instanceof u.ImageLayer&&!(t instanceof u.ImageLayer))throw new TypeError("MediaEditorData: calling _updateLayer with two different layer types");if(e===t)return this;const n=this.layers.map((n=>n===e?t:n));let r=this.selectedLayer;return r===e&&(r=t),this._update({layers:n,selectedLayer:r})}setBackground(e,t){const{fitToSquare:n=!1,scale:r=1}=null!=t?t:{},i=u.ImageLayer.create({type:u.ImageLayerType.Background,origin:new p.default({x:0,y:0}),image:e,editable:!0,scale:r}),a=i.frame.dimension,o=n?f.default.create({x:0,y:0,width:a,height:a,scale:1,rotation:0}):i.frame,l=new p.default({x:(o.width-i.width)/2,y:(o.height-i.height)/2}),c=i.setScale(r).setOrigin(l),h=(0,d.getDominantColor)(e),{backgroundColor:_,tintColor:g}=h.getBackgroundAndTintColors(),m=new s.DrawLayer({size:o.size,type:s.DrawLayerType.Paint}),y=new s.DrawLayer({size:o.size,type:s.DrawLayerType.Outline});return this._update({background:c,frame:o,backgroundColor:_,tintColor:g,paintLayer:m,outlineLayer:y})}updateBackground(e,t,n,r){var i;const a=null===(i=this.background)||void 0===i?void 0:i.setImage(e).setOrigin(t).setRotation(n).setScale(r);return this._update({background:a,selectedLayer:a})}addImageLayer(e){const t=u.ImageLayer.create(e),n=[...this.layers,t];return this._update({layers:n,selectedLayer:t})}addImageLayerToCenter(e){const t=this.toCanvasPoint(new p.default({x:this.screenWidth/2,y:this.screenHeight/2})),n=new p.default({x:t.x-e.image.width/2,y:t.y-e.image.height/2}),r=(0,i.default)({origin:n,rotation:-this.rotation},e);return this.addImageLayer(r)}addTextLayer(e){const t=e instanceof _.TextLayer?e:_.TextLayer.create((0,i.default)((0,i.default)({},e),{},{rotation:-this.rotation})),n=[...this.layers,t];return this._update({layers:n,selectedLayer:t})}setText(e,t){return this.updateLayer(e,e.setText(t))}setTextColor(e,t){return this.updateLayer(e,e.setTextColor(t))}setTextBackground(e,t){return this.updateLayer(e,e.setTextBackground(t))}setFont(e,t){return this.updateLayer(e,e.setFont(t))}setAlignment(e,t){return this.updateLayer(e,e.setAlignment(t))}setRotation(e){if(e%90!=0)throw new Error("canvas can only be rotated at a 90 degrees interval");return this._update({rotation:e%360})}setCrop(e,t){if(e.x<0||e.y<0||e.x+t.width>this.width||e.y+t.height>this.height)throw new Error("canvas crop must stays within the frame bound");const n=new f.default({origin:e,size:t,rotation:0,scale:0});return this._update({cropFrame:n})}addEmptyTextLayer(e,t){const n={origin:new p.default({x:this.width/4,y:this.height/2}),text:"",textColor:e,textBackground:!1,font:t,alignment:l.TextAlignment.CENTER};return this.addTextLayer(n)}addPaintPath(e){const t=this.paintLayer.addPath(e);return this._update({paintLayer:t})}addOutlinePath(e){const t=this.outlineLayer.addPath(e);return this._update({outlineLayer:t})}cropToOutline(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0;if(this.outlineLayer.isEmpty())return this;const n=this.outlineLayer.getAllPoints(),r=(0,c.default)(n,this.frame.rotation,this.frame.scale),i=null!=t?t:r.size.dimension,a=e*r.size.dimension/i,o=r.addPadding(a,this.frame);return this.setCrop(o.origin,o.size)}clearOutlinePaths(){const e=this.outlineLayer.clearPaths();return this._update({outlineLayer:e})}translateLayer(e,t){return this.updateLayer(e,e.setOrigin(t))}translateBackground(e){var t;const n=null===(t=this.background)||void 0===t?void 0:t.setOrigin(e);return this._update({background:n,selectedLayer:n})}transformLayer(e,t,n){return this.updateLayer(e,e.setRotation(t).setScale(n))}transformBackground(e,t){var n;const r=null===(n=this.background)||void 0===n?void 0:n.setRotation(e).setScale(t);return this._update({background:r,selectedLayer:r})}setSelectedLayer(e){return this._update({selectedLayer:e})}moveToTop(e){if(this.layers[this.layers.length-1]===e)return this;const t=[...this.layers.filter((t=>t!==e)),e];return this._update({layers:t})}clearSelectedLayer(){return this._update({selectedLayer:null})}deleteLayer(e){e.delete();let t={layers:this.layers.filter((t=>t!==e))};return e===this.selectedLayer&&(t=(0,i.default)((0,i.default)({},t),{},{selectedLayer:null})),this._update(t)}deleteAllLayers(){return this.layers.forEach((e=>e.delete())),this._update({layers:[],paintLayer:new s.DrawLayer({size:this.size,type:s.DrawLayerType.Paint}),outlineLayer:new s.DrawLayer({size:this.size,type:s.DrawLayerType.Outline}),selectedLayer:null})}hasEdits(){return!this.paintLayer.isEmpty()||!this.outlineLayer.isEmpty()||this.layers.length>0||0!==this.rotation||!this.size.equals(this._props.cropFrame.size)}get layers(){return this._props.layers}get lastTextLayer(){const e=(0,a.default)(this.layers,(e=>e instanceof _.TextLayer));return e instanceof _.TextLayer?e:null}get paintLayer(){return this._props.paintLayer}get outlineLayer(){return this._props.outlineLayer}get background(){return this._props.background}get selectedLayer(){return this._props.selectedLayer}get backgroundColor(){return this._props.backgroundColor}get tintColor(){return this._props.tintColor}get size(){return this._props.frame.size}get frame(){return this._props.frame}get width(){return this._props.frame.width}get height(){return this._props.frame.height}get cropWidth(){return this._props.cropFrame.width}get cropHeight(){return this._props.cropFrame.height}get cropOrigin(){return this._props.cropFrame.origin}get cropSize(){return this._props.cropFrame.size}get cropCenter(){return this._props.cropFrame.getCenter()}get screenWidth(){return this.rotation%180==0?this.cropWidth:this.cropHeight}get screenHeight(){return this.rotation%180==0?this.cropHeight:this.cropWidth}get canvasCenter(){return new p.default({x:this.width/2,y:this.height/2})}get rotation(){return this._props.rotation}get id(){return this._props.id}toScreenPoint(e){const t=Math.max(this.width,this.height),n=new p.default({x:t/2,y:t/2}),r=new p.default({x:e.x+(t-this.width)/2,y:e.y+(t-this.height)/2}).rotate(n,this.rotation),i=new p.default({x:this.cropCenter.x+(t-this.width)/2,y:this.cropCenter.y+(t-this.height)/2}).rotate(n,this.rotation),a=new p.default({x:i.x-this.screenWidth/2,y:i.y-this.screenHeight/2});return new p.default({x:r.x-a.x,y:r.y-a.y})}toCanvasPoint(e){const t=Math.max(this.width,this.height),n=new p.default({x:t/2,y:t/2}),r=this.cropCenter.rotate(n,this.rotation),i=new p.default({x:r.x-this.screenWidth/2,y:r.y-this.screenHeight/2}),a=new p.default({x:e.x+i.x,y:e.y+i.y}).rotate(n,-this.rotation);return new p.default({x:a.x,y:a.y})}resetCropRotate(){return this.setRotation(0).setCrop(new p.default({x:0,y:0}),new h.default({width:this.width,height:this.height}))}isRotated(){return 0!==this.rotation}isCropped(){return!this.cropOrigin.equals(new p.default({x:0,y:0}))||!this.cropSize.equals(this.size)}isOutlined(){return!this.outlineLayer.isEmpty()}}t.default=g},92320:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.COLORS=void 0,t.getAllColors=function(){return Object.keys(i)},t.getColorValue=function(e){return a[e]};var r=n(16241);const i=Object.freeze({BLACK:"BLACK",GRAY:"GRAY",WHITE:"WHITE",BLUE:"BLUE",GREEN:"GREEN",PURPLE:"PURPLE",ORANGE:"ORANGE",RED:"RED"});t.COLORS=i;const a={[i.BLACK]:r.Color.fromHex("#434343"),[i.GRAY]:r.Color.fromHex("#9DA0A9"),[i.WHITE]:r.Color.fromHex("#FFFFFF"),[i.BLUE]:r.Color.fromHex("#33CEFF"),[i.GREEN]:r.Color.fromHex("#64DC2F"),[i.PURPLE]:r.Color.fromHex("#BD73FF"),[i.ORANGE]:r.Color.fromHex("#F49226"),[i.RED]:r.Color.fromHex("#FF4A4A")}},39581:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextAlignment=t.FONTS=void 0,t.getAllFonts=function(){return Object.keys(i)},t.getFontStyle=function(e){return a[e]},t.getFontTranslation=function(e){switch(e){case i.SANS_SERIF:return r.fbt._("Sans Serif",null,{hk:"oqthG"});case i.SERIF:return r.fbt._("Serif",null,{hk:"1EWGvo"});case i.NORICAN_REGULAR:return r.fbt._("Norican",null,{hk:"RU2yb"});case i.BRYNDAN_WRITE:return r.fbt._("Bryndan Write",null,{hk:"2d40Ei"});case i.OSWALD_HEAVY:return r.fbt._("Oswald",null,{hk:"vyZEQ"});default:throw new Error("Unsupported font")}};var r=n(48360);const i=Object.freeze({SANS_SERIF:"SANS_SERIF",SERIF:"SERIF",NORICAN_REGULAR:"NORICAN_REGULAR",BRYNDAN_WRITE:"BRYNDAN_WRITE",OSWALD_HEAVY:"OSWALD_HEAVY"});t.FONTS=i;const a={[i.SANS_SERIF]:{fontFamily:"sans-serif"},[i.SERIF]:{fontFamily:'"Droid Serif", serif'},[i.NORICAN_REGULAR]:{fontFamily:'"Norican"'},[i.BRYNDAN_WRITE]:{fontFamily:'"Bryndan-Write"'},[i.OSWALD_HEAVY]:{fontFamily:'"Oswald"',fontWeight:"bold"}},o=n(76672).Mirrored(["LEFT","CENTER","RIGHT"]);t.TextAlignment=o},70638:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;class n{constructor(e){const{points:t,color:n,thickness:r,smoothing:i}=e;this._points=[...t],this._color=n,this._thickness=r,this._smoothing=i,Object.freeze(this)}update(e){let t=this.points,r=this.color,i=this.thickness,a=this.smoothing;return null!=e.points&&(t=e.points),null!=e.color&&(r=e.color),null!=e.thickness&&(i=e.thickness),null!=e.smoothing&&(a=e.smoothing),new n({points:t,color:r,thickness:i,smoothing:a})}clone(){const e={points:[...this.points],color:this.color.clone(),thickness:this.thickness,smoothing:this.smoothing};return new n(e)}toString(){return`points: [${this.points.map((e=>e.toString())).join(", ")}]\ncolor: ${this.color.toString()}\nthickness: ${this.thickness}`}equals(e){return this.color.equals(e.color)&&Math.abs(this.thickness-e.thickness)<Number.EPSILON&&this.points.length===e.points.length&&this.points.every(((t,n)=>t.equals(e.points[n])))}isDrag(){return this.points.length>1}isSmooth(){return this.smoothing||this.isDrag()}isStraight(){return!this.isSmooth()}get points(){return this._points}get color(){return this._color}get thickness(){return this._thickness}get smoothing(){return this._smoothing}}t.default=n},16186:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(81109)),a=r(n(18446));class o{constructor(e){this._props=Object.freeze((0,i.default)({},e)),Object.freeze(this)}update(e){const t=(0,i.default)({},this._props);return null!=e.x&&(t.x=e.x),null!=e.y&&(t.y=e.y),(0,a.default)(this._props,t)?this:new o(t)}clone(){return new o(this._props)}toString(){return`(${this.x}x, ${this.y}y)`}equals(e){return Math.abs(this.x-e.x)<Number.EPSILON&&Math.abs(this.y-e.y)<Number.EPSILON}distance(e){return Math.sqrt((e.x-this.x)**2+(e.y-this.y)**2)}rotate(e,t){const n=t*Math.PI/180,r=this.x-e.x,i=this.y-e.y,a=Math.cos(n)*r-Math.sin(n)*i+e.x,s=Math.sin(n)*r+Math.cos(n)*i+e.y;return new o({x:Math.round(100*a)/100,y:Math.round(100*s)/100})}get x(){return this._props.x}get y(){return this._props.y}}t.default=o},24055:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(81109)),a=r(n(18446)),o=r(n(16186)),s=r(n(46668));class l{static create(e){return new l({origin:new o.default({x:e.x,y:e.y}),size:new s.default({width:e.width,height:e.height}),rotation:e.rotation,scale:e.scale})}constructor(e){this._props=Object.freeze((0,i.default)({},e)),Object.freeze(this)}updateXYWidthHeight(e){const t=(0,i.default)({},this._props);return null==e.x&&null==e.y||(t.origin=t.origin.update({x:e.x,y:e.y})),null==e.width&&null==e.height||(t.size=t.size.update({width:e.width,height:e.height})),null!=e.rotation&&(t.rotation=e.rotation),null!=e.scale&&(t.scale=e.scale),this.update(t)}update(e){const t=(0,i.default)({},this._props);return null!=e.origin&&(t.origin=e.origin),null!=e.size&&(t.size=e.size),null!=e.rotation&&(t.rotation=e.rotation),null!=e.scale&&Math.abs(t.scale-e.scale)>1e-6&&(t.scale=e.scale),(0,a.default)(this._props,t)?this:new l(t)}clone(){return new l(this._props)}addPadding(e,t){const n=this.getTopLeft(),r=t.getTopLeft(),i=new o.default({x:Math.max(r.x,n.x-e),y:Math.max(r.y,n.y-e)}),a=this.getBottomRight(),s=t.getBottomRight(),l=new o.default({x:Math.min(s.x,a.x+e),y:Math.min(s.y,a.y+e)}),c=l.x-i.x,d=l.y-i.y;return this.updateXYWidthHeight({x:i.x,y:i.y,width:c,height:d})}toString(){return`(${this.origin.toString()}, ${this.size.toString()}, ${this.rotation}r)`}equals(e){return this.origin.equals(e.origin)&&this.size.equals(e.size)&&this.rotation===e.rotation&&this.scale===e.scale}contains(e){return e.x>=this.x&&e.y>=this.y&&e.x<this.x+this.width&&e.y<this.y+this.height}getTopLeft(){return new o.default({x:this.x,y:this.y})}getTopCenter(){return new o.default({x:this.x+this.width/2,y:this.y})}getTopRight(){return new o.default({x:this.x+this.width,y:this.y})}getLeftCenter(){return new o.default({x:this.x,y:this.y+this.height/2})}getCenter(){return new o.default({x:this.x+this.width/2,y:this.y+this.height/2})}getRightCenter(){return new o.default({x:this.x+this.width,y:this.y+this.height/2})}getBottomLeft(){return new o.default({x:this.x,y:this.y+this.height})}getBottomCenter(){return new o.default({x:this.x+this.width/2,y:this.y+this.height})}getBottomRight(){return new o.default({x:this.x+this.width,y:this.y+this.height})}get origin(){return this._props.origin}get size(){return this._props.size}get x(){return this.origin.x}get y(){return this.origin.y}get width(){return this.size.width}get height(){return this.size.height}get rotation(){return this._props.rotation}get scale(){return this._props.scale}get dimension(){return this.size.dimension}}t.default=l},46668:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(81109)),a=r(n(18446));class o{constructor(e){const{width:t,height:n}=e;if(t<0)throw new RangeError("MediaEditor:Size width cannot be negative");if(n<0)throw new RangeError("MediaEditor:Size height cannot be negative");this._props=Object.freeze({width:t,height:n}),Object.freeze(this)}update(e){const t=(0,i.default)({},this._props);return null!=e.width&&(t.width=e.width),null!=e.height&&(t.height=e.height),(0,a.default)(this._props,t)?this:new o(t)}clone(){return new o(this._props)}toString(){return`(${this.width}w, ${this.height}h)`}equals(e){return Math.abs(this.width-e.width)<Number.EPSILON&&Math.abs(this.height-e.height)<Number.EPSILON}isEmpty(){return this.equals(o.empty())}static empty(){return new o({width:0,height:0})}get width(){return this._props.width}get height(){return this._props.height}get dimension(){return Math.max(this.width,this.height)}}t.default=o},50833:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.DrawLayerType=t.DrawLayer=void 0;var i=n(83428),a=r(n(70638)),o=r(n(16186)),s=r(n(24055));const l=n(76672).Mirrored(["Paint","Outline"]);t.DrawLayerType=l;class c{constructor(e){if(this._type=e.type,null!=e.size){const t=e.size;this._frame=new s.default({origin:new o.default({x:0,y:0}),size:t,rotation:0,scale:1}),this._paths=[]}else null!=e.frame&&null!=e.paths&&(this._frame=e.frame,this._paths=e.paths);e.id?this._id=e.id:this._id=(0,i.generateLayerId)(e.type),Object.freeze(this)}delete(){}_update(e){let t=this._paths;null!=e.paths&&(t=e.paths);const n=this._frame,r=this._type;return new c({id:this.id,paths:t,frame:n,type:r})}setOrigin(){throw new TypeError("MediaEditor:DrawLayer resetting origin is not allowed")}setRotation(){throw new TypeError("MediaEditor:DrawLayer resetting rotation is not allowed")}setScale(){throw new TypeError("MediaEditor:DrawLayer resetting scale is not allowed")}addPath(e){const t=new a.default(e),n=[...this._paths,t];return this._update({paths:n})}clearPaths(){return this._update({paths:[]})}isEmpty(){return 0===this._paths.length}getAllPoints(){return this.paths.reduce(((e,t)=>(!t.smoothing&&e.length&&e.push(e[e.length-1]),t.isDrag()&&e.push(t.points[0]),e.push(...t.points.flatMap((e=>t.isSmooth()?[e]:[e,e]))),e)),[])}get paths(){return this._paths}get editable(){return!1}get id(){return this._id}get type(){return this._type}get frame(){return this._frame}get origin(){return this._frame.origin}get size(){return this._frame.size}get x(){return this._frame.x}get y(){return this._frame.y}get width(){return this._frame.width}get height(){return this._frame.height}get rotation(){return this._frame.rotation}get scale(){return this._frame.scale}}t.DrawLayer=c},39989:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ImageLayerType=t.ImageLayer=void 0;var i=r(n(81109)),a=r(n(18446)),o=n(83428),s=r(n(24055)),l=r(n(46668));const c=n(76672).Mirrored(["Image","Emoji","Sticker","Background"]);t.ImageLayerType=c;class d{static create(e){var t;const n=e.image.width,r=e.image.height;if(!n||!r)throw new Error("Image must have valid width and height");return new d({id:(0,o.generateLayerId)("image"),type:e.type,image:e.image,editable:e.editable,frame:new s.default({origin:e.origin,size:new l.default({width:n,height:r}),rotation:null!==(t=e.rotation)&&void 0!==t?t:0,scale:e.scale})})}constructor(e){this._props=Object.freeze((0,i.default)({},e)),Object.freeze(this)}delete(){}setOrigin(e){return this._update({frame:this.frame.update({origin:e})})}setRotation(e){return this._update({frame:this.frame.update({rotation:e})})}setScale(e){return this._update({frame:this.frame.update({scale:e})})}setFrame(e){return this._update({frame:e})}setImage(e){return this._update({image:e})}setEditable(e){return this._update({editable:e})}_update(e){const t=(0,i.default)({},this._props);if(null!=e.image){const n=e.image.width,r=e.image.height;if(!n||!r)throw new Error("Image must have valid width and height");t.image=e.image,t.frame=new s.default({origin:this.frame.origin,size:new l.default({width:n,height:r}),rotation:this.frame.rotation,scale:this.frame.scale})}return null!=e.editable&&(t.editable=e.editable),null!=e.frame&&(t.frame=e.frame),(0,a.default)(this._props,t)?this:new d(t)}get image(){return this._props.image}get editable(){return this._props.editable}get id(){return this._props.id}get frame(){return this._props.frame}get origin(){return this._props.frame.origin}get size(){return this._props.frame.size}get x(){return this._props.frame.x}get y(){return this._props.frame.y}get width(){return this._props.frame.width}get height(){return this._props.frame.height}get rotation(){return this._props.frame.rotation}get scale(){return this._props.frame.scale}isSticker(){return this._props.type===c.Sticker}isEmoji(){return this._props.type===c.Emoji}isBackground(){return this._props.type===c.Background}}t.ImageLayer=d},81829:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.TextLayer=t.DEFAULT_FONT_SIZE=void 0;var i=r(n(81109)),a=r(n(18446)),o=n(16241),s=n(92320),l=(n(39581),n(83428)),c=r(n(16186)),d=r(n(24055)),u=r(n(46668)),p=n(31323),f=n(51234);t.DEFAULT_FONT_SIZE=18;const h={lineVerticalPadding:6,lineHorizontalPadding:8,layerPadding:6,backgroundBorderRadius:5,backgroundShadow:{offsetX:0,offsetY:1,radius:6,spread:0,color:new o.Color(0,0,0,.32)}};class _{static create(e){var t;const n=[],r=g(n,h);let i=0;return null!=e.rotation&&(i=e.rotation),new _({id:(0,l.generateLayerId)("text"),text:"",textColor:e.textColor,textBackground:e.textBackground,font:e.font,alignment:e.alignment,lines:n,frame:new d.default({origin:new c.default({x:e.origin.x-r.width/2,y:e.origin.y-r.height/2}),size:r,rotation:i,scale:null!==(t=e.scale)&&void 0!==t?t:1}),maxWidth:0,backgroundPath:""}).setText(e.text)}constructor(e){this._props=Object.freeze((0,i.default)({},e)),Object.freeze(this)}delete(){}setOrigin(e){return this._update({frame:this.frame.update({origin:e})})}setRotation(e){return this._update({frame:this.frame.update({rotation:e})})}setScale(e){return this._update({frame:this.frame.update({scale:e})})}setText(e){return this._update({text:e})}setTextColor(e){return this._update({textColor:e})}setTextBackground(e){return this._update({textBackground:e})}setFont(e){return this._update({font:e})}setAlignment(e){return this._update({alignment:e})}_update(e){const t=(0,i.default)({},this._props);if(null!=e.frame&&(t.frame=e.frame),null!=e.textColor&&(t.textColor=e.textColor),null!=e.textBackground&&(t.textBackground=e.textBackground),null!=e.text&&e.text!==t.text||null!=e.font&&e.font!==t.font){var n,r;t.text=null!==(n=e.text)&&void 0!==n?n:t.text,t.font=null!==(r=e.font)&&void 0!==r?r:t.font,t.lines=(0,f.getLines)(t.text,t.font,18,this._props.maxWidth);const i=g(t.lines,h),a=t.frame.size,o=t.frame.origin,s=new c.default({x:o.x+a.width/2-i.width/2,y:o.y+a.height/2-i.height/2});t.frame=t.frame.update({origin:s,size:i})}if(null!=e.alignment&&(t.alignment=e.alignment),this.font!==t.font||this.text!==t.text||this.alignment!==t.alignment){const e=t.lines.map((e=>e.width));t.backgroundPath=(0,p.generateTextBackgroundPath)(e,t.alignment,{lineVerticalPadding:this.styles.lineVerticalPadding,lineHorizontalPadding:this.styles.lineHorizontalPadding,lineHeight:this.lineHeight,arcSize:this.styles.backgroundBorderRadius})}return(0,a.default)(this._props,t)?this:new _(t)}get lines(){return this._props.lines}get linesOfText(){return this.lines.map((e=>e.text))}get lineWidths(){return this.lines.map((e=>e.width))}get numberOfLines(){return this.lines.length}get fontSize(){return 18}get lineHeight(){return this.fontSize}get styles(){return h}get text(){return this._props.text}get textColor(){return this._props.textColor}get textBackgroundColor(){return this.textColor.isLight()?(0,s.getColorValue)(s.COLORS.BLACK):(0,s.getColorValue)(s.COLORS.WHITE)}get textBackground(){return this._props.textBackground}get font(){return this._props.font}get editable(){return!0}get id(){return this._props.id}get alignment(){return this._props.alignment}get frame(){return this._props.frame}get origin(){return this.frame.origin}get size(){return this.frame.size}get x(){return this.frame.x}get y(){return this.frame.y}get width(){return this.frame.width}get height(){return this.frame.height}get rotation(){return this.frame.rotation}get scale(){return this.frame.scale}get backgroundPath(){return this._props.backgroundPath}}function g(e,t){const n=Math.max(...e.map((e=>e.width)),0)+2*t.lineHorizontalPadding+2*t.layerPadding,r=e.length*(18+2*t.lineVerticalPadding)+2*t.layerPadding;return new u.default({width:n,height:r})}t.TextLayer=_},16241:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Color=void 0,t.cleanHex=s,t.compareHex=function(e,t){if(!e||!t)return!1;const n=s(e),r=s(t);if(n===r)return!0;let i=0,a=0;for(;i<e.length;){if(n[i]!==r[a]||n[i]!==r[a+1])return!1;i+=1,a+=2}return!0},t.isValidHex=function(e){if(!e)return!1;const t=s(e);if(3===t.length)return n.test(t);if(6===t.length)return r.test(t);return!1};const n=/^[0-9A-F]{3}$/i,r=/^[0-9A-F]{6}$/i;class i{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;if(e<0||e>255)throw new RangeError(`red (${e} given) should be >= 0 and <= 255`);if(t<0||t>255)throw new RangeError(`green (${t} given) should be >= 0 and <= 255`);if(n<0||n>255)throw new RangeError(`blue (${n} given) should be >= 0 and <= 255`);if(r<0||r>1)throw new RangeError(`alpha (${r} given) should be >= 0 and <= 1`);this._red=e,this._green=t,this._blue=n,this._alpha=r}static fromHex(e){let t=e.trim().toLowerCase();if(t.length&&"#"===t[0]&&(t=t.substr(1)),3!==t.length&&6!==t.length)throw new RangeError(`hex ${e} does not have 3 or 6 digits`);3===t.length&&(t=`${t[0]}${t[0]}${t[1]}${t[1]}${t[2]}${t[2]}`);const n=parseInt(t.substr(0,2),16),r=parseInt(t.substr(2,2),16),a=parseInt(t.substr(4,2),16);if(isNaN(n)||isNaN(r)||isNaN(a))throw new RangeError(`hex ${e} is invalid`);return new i(n,r,a,1)}static _fromHsl(e,t,n){let r,o,s;if(0===t||0===n)r=o=s=n;else{const i=n<.5?n*(1+t):n+t-n*t,l=2*n-i;r=a(l,i,e+1/3),o=a(l,i,e),s=a(l,i,e-1/3)}return new i(Math.round(255*r),Math.round(255*o),Math.round(255*s))}toRgb(){return{red:this._red,green:this._green,blue:this._blue}}toRgba(){return{red:this._red,green:this._green,blue:this._blue,alpha:this._alpha}}toRgbString(){return`rgb(${this._red}, ${this._green}, ${this._blue})`}toRgbaString(){return`rgba(${this._red}, ${this._green}, ${this._blue}, ${this._alpha})`}toHex(){return`#${o(this._red.toString(16),2)}${o(this._green.toString(16),2)}${o(this._blue.toString(16),2)}`.toUpperCase()}toHsl(){const e=this._red/255,t=this._green/255,n=this._blue/255,r=Math.max(e,t,n),i=Math.min(e,t,n);let a=(r+i)/2,o=(r+i)/2;const s=(r+i)/2;if(r===i)a=o=0;else{const l=r-i;switch(o=s>.5?l/(2-r-i):l/(r+i),r){case e:a=(t-n)/l+(t<n?6:0);break;case t:a=(n-e)/l+2;break;case n:a=(e-t)/l+4}a/=6}return{hue:a,saturation:o,lightness:s}}getBackgroundAndTintColors(){const{hue:e,saturation:t,lightness:n}=this.toHsl();let r,a;if(n<.55&&t>.1){let o=e;e>.08&&e<.22&&(o=e<.08+.14?.08:.22),r=i._fromHsl(o,t<.01?0:Math.max(t,.75),Math.min(n,.25)),a=new i(255,255,255,1)}else r=i._fromHsl(e,Math.min(t,.33),Math.max(n,.9)),a=i._fromHsl(e,0===t?0:.4,.2);return{backgroundColor:r,tintColor:a}}withAlpha(e){return new i(this._red,this._green,this._blue,e)}isLight(){return.299*this._red+.587*this._green+.114*this._blue>190}isWhite(){const{lightness:e}=this.toHsl();return e>=.996}equals(e){return this._red===e._red&&this._green===e._green&&this._blue===e._blue&&this._alpha===e._alpha}clone(){return new i(this._red,this._green,this._blue,this._alpha)}toString(){return`(${this._red}, ${this._green}, ${this._blue}, ${this._alpha})`}get red(){return this._red}get green(){return this._green}get blue(){return this._blue}get alpha(){return this._alpha}}function a(e,t,n){let r=n;return r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+6*(t-e)*r:r<.5?t:r<2/3?e+(t-e)*(2/3-r)*6:e}function o(e,t){return e.length>=t?e:"0".repeat(t-e.length)+e}function s(e){let t=e.trim();return"#"===t.substring(0,1)&&(t=t.substring(1).toLowerCase()),t}t.Color=i,i.Black=new i(0,0,0),i.White=new i(255,255,255)},83428:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.generateLayerId=function(e){const t=Math.random().toString(36).substring(2,10);return`${e}-${t}`}},48014:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){let r=1/0,a=1/0,o=0,s=0;e.forEach((e=>{const t=e.x,n=e.y;t<r&&(r=t),t>o&&(o=t),n<a&&(a=n),n>s&&(s=n)}));const l=o-r,c=s-a;return i.default.create({x:r,y:a,width:l,height:c,rotation:t,scale:n})};var i=r(n(24055))},47732:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_DOMINANT_COLOR=void 0,t.getDominantColor=function(e){const t=function(e){const t=document.createElement("canvas"),n=t.getContext("2d");if(!n)return null;const r=t.height=e.height,i=t.width=e.width;n.drawImage(e,0,0);try{return n.getImageData(0,0,i,r).data}catch(e){return null}}(e);return t?function(e){let t=0,n=0,i=0,a=0,o=0;for(let r=0;r<e.length;r+=20){const s=e[r+3],l=e[r]*s,c=e[r+1]*s,d=e[r+2]*s;t+=l,n+=c,i+=d,a+=s,o++}return a?new r.Color(Math.round(t/a),Math.round(n/a),Math.round(i/a),Math.round(a/o)/255):new r.Color(0,0,0,0)}(t):i};var r=n(16241);const i=new r.Color(220,220,220);t.DEFAULT_DOMINANT_COLOR=i},31323:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.generateTextBackgroundPath=function(e,t,n){const a=n.arcSize,o=[],s=[],l=Math.max(...e),c=n.lineHeight+2*n.lineVerticalPadding;e.forEach(((i,a)=>{const d=i+2*n.lineHorizontalPadding;let u=0;switch(t){case r.TextAlignment.LEFT:u=0;break;case r.TextAlignment.CENTER:u=(l-i)/2;break;case r.TextAlignment.RIGHT:u=l-i}const p=a*c;o.push({y:p,x:u}),s.push({y:p,x:u+d}),a===e.length-1&&(o.push({y:p+c,x:u}),s.push({y:p+c,x:u+d}))}));let d=[];for(let{left:e,points:t}of[{left:!0,points:o},{left:!1,points:s}]){let n=t,r=!0;for(;r;){t=n,n=[],r=!1;for(let i=0;i<t.length;i++){const o=t[i];if(0===i)n.push(o);else{n.length>=2&&n[n.length-1].x===n[n.length-2].x&&(n.pop(),r=!0);const t=n[n.length-1];o.x!==t.x&&Math.abs(o.x-t.x)<2*a&&(r=!0,e&&t.x<o.x||!e&&t.x>o.x?o.x=t.x:t.x=o.x),n.push(o)}}}const i=[];for(let e=0;e<n.length;e++){const t=n[e];if(0===e||e===n.length-1){i.push(t);continue}const r=n[e-1];if(t.x!==r.x){const e={x:r.x,y:t.y},n=i.length-1;i.length>=2&&i[n].x===e.x&&i[n].x===i[n-1].x&&i.pop(),i.push(e)}i.push(t)}e||i.reverse(),d=d.concat(i)}return function(e,t){function n(t){return 0===t?e[e.length-1]:e[t-1]}function r(t){return t===e.length-1?e[0]:e[t+1]}const a=[];for(let o=0;o<e.length;o++){const{start:s,end:l,clockwise:c}=i(e[o],n(o),r(o),t),d=o===e.length-1?0:o+1,{start:u}=i(e[d],n(d),r(d),t);0===o&&a.push(`M ${s.x},${s.y}`),a.push(`A ${t},${t} 0 0 ${c?1:0} ${l.x},${l.y}`),a.push(`L ${u.x},${u.y}`)}return a.push("Z"),a.join("\n")}(d,a)};var r=n(39581);function i(e,t,n,r){const i=t.y===e.y,a={y:i?e.y:t.y>e.y?e.y+r:e.y-r,x:i?t.x>e.x?e.x+r:e.x-r:e.x},o=e.y===n.y;return{start:a,end:{y:o?e.y:n.y>e.y?e.y+r:e.y-r,x:o?n.x>e.x?e.x+r:e.x-r:e.x},clockwise:i&&(t.y<n.y&&t.x<n.x||t.x>n.x&&t.y>n.y)||!i&&(t.y<n.y&&t.x>n.x||t.x<n.x&&t.y>n.y)}}},51234:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getLines=function(e,t,n,i){const a=[];for(const s of e.split("\n")){if(""===s){a.push({text:"",width:0,words:[]});continue}const e=s.split(" ");let l="",c=0,d=[];for(let s=0;s<e.length;s++){const u=(0!==s?" ":"")+e[s],p=l+u,f=o(p,t,n);if(i>0&&f>i&&c>0)a.push({text:l,width:c,words:d}),l="",c=0,d=[],s--;else{l=p,c=f;for(const e of u.split(r.EmojiUtil.emojiRegex())){if(!e)continue;let i=null;if(r.EmojiUtil.isEmoji(e)){const t=r.EmojiUtil.getGlyphId(e);null!=t&&(i=r.EmojiUtil.getGlyphPath(t,"xlarge").high)}const a=o(e,t,n);d.push({text:e,width:a,emojiPath:i})}}}c>0&&a.push({text:l,width:c,words:d})}return a},t.getTextBounds=function(e,t){const n=`${t}px ${(0,i.getFontStyle)(e).fontFamily}`,r=l.get(n);if(null!=r)return r;const a="ABCDEF",c=Math.round(o(a,e,t)),d=t,u=s().getContext("2d");u.textBaseline="middle",u.font=n,u.fillStyle="red",u.fillText(a,0,d/2);const p=u.getImageData(0,0,c,d).data;let f=1/0,h=1/0,_=1/0;for(let e=0;e<c;e++)for(let t=0;t<d;t++){p[4*(t*c+e)+3]>0&&(h=Math.min(h,t),f=Math.min(f,e),_=Math.min(_,d-t))}u.clearRect(0,0,c,d);const g={top:h,left:f,bottom:_};return l.set(u.font,g),g};var r=n(67247),i=n(39581);let a;function o(e,t,n){const a=s().getContext("2d");a.font=`${n}px ${(0,i.getFontStyle)(t).fontFamily}`;let o=0;for(const t of e.split(r.EmojiUtil.emojiRegex()))r.EmojiUtil.isEmoji(t)?o+=n:o+=a.measureText(t).width;return o}function s(){return null==a&&(a=document.createElement("canvas"),a.width=9999,a.height=99),a}const l=new Map},89248:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return(0,i.useEffect)((()=>{c.Updater.restart(!0).then((()=>{c.Updater.restart()}))}),[]),(0,d.jsxs)(s.Modal,{cover:!0,title:o.default.t(800),children:[(0,d.jsx)("div",{children:o.default.t(799)}),(0,d.jsx)("div",{className:a.default.pending,children:(0,d.jsx)(l.Spinner,{stroke:4,size:40,color:"highlight"})})]})};var i=n(67294),a=r(n(8762)),o=r(n(14296)),s=n(57224),l=n(11054),c=n(83023),d=n(85893)},52665:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(48360),a=n(67294),o=r(n(56720)),s=r(n(39770)),l=n(29424),c=n(57224),d=n(85893);const u=(e,t)=>{const n=t=>{var n;t.stopPropagation(),t.preventDefault(),null===(n=e.onCancel)||void 0===n||n.call(e)},r=e.onOK?(0,d.jsx)(s.default,{a8nText:"popup-controls-ok",type:"primary",onClick:t=>{var n;t.stopPropagation(),t.preventDefault(),null===(n=e.onOK)||void 0===n||n.call(e)},disabled:e.okDisabled,spinner:!0===e.okSpinner,children:null!=e.okText?e.okText:i.fbt._("OK",null,{hk:"2KEeHb"})}):null,a=e.onCancel?(0,d.jsx)(s.default,{a8nText:"popup-controls-cancel",type:e.onOK?"secondary":"primary",onClick:n,children:e.cancelText||i.fbt._("Cancel",null,{hk:"H0gNq"})}):null,u={escape:e.onCancel?n:()=>{}},p=(0,d.jsxs)("div",{className:(0,o.default)(e.btnContainer),children:[a,r]});return(0,d.jsx)(l.HotKeys,{handlers:u,ref:t,children:(0,d.jsx)(c.Modal,{actions:p,children:e.children,cover:e.cover,onDragChange:e.onDragChange,onDrop:e.onDrop,type:e.type,title:e.title})})};var p=(0,a.forwardRef)(u);t.default=p},8623:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let{children:t,cancelText:n,onCancel:r,okText:o,onOK:s}=e;return(0,a.jsx)(i.default,{cover:!0,children:t,cancelText:n,onCancel:r,okText:o,onOK:s})};var i=r(n(52665)),a=n(85893)},31760:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(81109)),a=r(n(48926)),o=n(13959),s=n(67294),l=r(n(16747)),c=n(87550),d=n(88102),u=n(28237),p=n(99608),f=n(65044),h=n(85893);const _=n(76672).Mirrored(["INITIAL_LOAD","CONNECTING","FAKE_FILL","DOWNLOADING","ORGANIZING"]),g=n(76672).Mirrored(["NOT_STARTED","STARTED","PAST_MIN_TIME"]);var m=e=>{let{onReady:t,onLogout:n,initialLoadReady:r}=e;const m=(0,l.default)(),y=(0,s.useRef)(!1),[E,S]=(0,s.useState)(r?p.Stage.CONNECTING:p.Stage.INITIAL_LOAD),[v,T]=(0,s.useState)({INITIAL_LOAD:r?g.PAST_MIN_TIME:g.NOT_STARTED,CONNECTING:g.NOT_STARTED,FAKE_FILL:g.NOT_STARTED,DOWNLOADING:g.NOT_STARTED,ORGANIZING:g.NOT_STARTED}),[b,C]=(0,s.useState)(0),[A,P]=(0,s.useState)(null);(0,c.useListener)(d.Cmd,"offline_progress_update",(()=>{v.CONNECTING===g.PAST_MIN_TIME&&C(u.OfflineMessageHandler.getOfflineDeliveryProgress());const e=u.OfflineMessageHandler.getHasMessagesToDownload();null==A&&null!=e&&P(e)}));const M=(0,s.useCallback)(function(){var e=(0,a.default)((function*(e,t){T((t=>(0,i.default)((0,i.default)({},t),{},{[e]:g.STARTED}))),__LOG__(2)`DebouncedLoadingScreen: ${e} - starts minimum display time`,yield(0,o.delayMs)(t),m()&&(T((t=>(0,i.default)((0,i.default)({},t),{},{[e]:g.PAST_MIN_TIME}))),__LOG__(2)`DebouncedLoadingScreen: ${e} - ends minimum display time`)}));return function(){return e.apply(this,arguments)}}(),[m]),{CONNECTING:O,DOWNLOADING:I,ORGANIZING:w,FAKE_FILL:R,INITIAL_LOAD:D}=v;return(0,s.useEffect)((()=>{if(w===g.PAST_MIN_TIME)y.current||(t(),y.current=!0);else if(I===g.PAST_MIN_TIME&&b>=100&&w===g.NOT_STARTED)(0,o.delayMs)(450).then((()=>{m()&&(S(p.Stage.ORGANIZING),M(_.ORGANIZING,800))}));else if(O===g.PAST_MIN_TIME&&null!=A&&I===g.NOT_STARTED&&R===g.NOT_STARTED){const e=u.OfflineMessageHandler.getFinishedDownloading();A&&!e?(S(p.Stage.DOWNLOADING),C(u.OfflineMessageHandler.getOfflineDeliveryProgress()),M(_.DOWNLOADING,450)):(C(100),M(_.FAKE_FILL,450).then((()=>{m()&&(f.Socket.hasSynced?y.current||(t(),y.current=!0):(S(p.Stage.ORGANIZING),M(_.ORGANIZING,800)))})))}else r&&D===g.PAST_MIN_TIME&&O===g.NOT_STARTED?(S(p.Stage.CONNECTING),M(_.CONNECTING,1500)):D===g.NOT_STARTED&&M(_.INITIAL_LOAD,500)}),[b,t,A,M,m,r,O,I,w,R,D]),(0,h.jsx)(p.LoadingScreen,{stage:E,progress:b,onLogout:n})};t.default=m},94049:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(48360),a=r(n(52665)),o=r(n(14296)),s=n(83578),l=n(65044),c=n(85893);t.default=()=>(0,c.jsx)(a.default,{cover:!0,cancelText:o.default.t(596),onCancel:l.Socket.logout.bind(l.Socket,!0,s.LogoutReason.UserInitiated),okText:o.default.t(574),onOK:l.Socket.poke.bind(l.Socket),children:i.fbt._('The version of WhatsApp on your phone is too old. Please update to the latest version, then click "LOG IN" to continue using WhatsApp.',null,{hk:"2gorpJ"})})},79592:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(67294),a=r(n(37453)),o=r(n(83322)),s=n(85893);function l(e,t){const{disableFromWithin:n,onDrop:r,onDragChange:l}=e,[c,d]=(0,i.useState)(!1),[u,p]=(0,i.useState)(!1),[f,h]=(0,i.useState)(!1),_=(0,a.default)(u),g=()=>{n&&d(!0)},m=()=>{n&&d(!1)},y=e=>{e.preventDefault(),e.stopPropagation(),u||c||(p(!0),h(!1),function(e){if(e.dataTransfer){try{if(!e.dataTransfer.dropEffect)return}catch(e){return}e.dataTransfer.effectAllowed&&(e.nativeEvent.dataTransfer.dropEffect="copy")}}(e))};return(0,i.useEffect)((()=>{null!=_&&_!==u&&l&&l(u,f)}),[f,u,l,_]),(0,i.useImperativeHandle)(t,(()=>({onDragStart:g,onDragEnd:m,onDragOver:y}))),(0,s.jsx)("div",{className:o.default.mask,style:u?{}:{display:"none"},onDragLeave:e=>{e.preventDefault(),e.stopPropagation(),u&&(p(!1),h(!1))},onDrop:e=>{e.preventDefault(),e.stopPropagation(),p(!1),h(!0),r&&!c&&r(e)}},"mask")}var c=(0,i.forwardRef)(l);t.default=c},13259:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return(0,p.jsx)(a.default,{cover:!0,cancelText:o.default.t(596),onCancel:f,okText:i.fbt._("UPDATE",null,{hk:"2YdJcK"}),onOK:h,children:i.fbt._("Please update to the latest version of WhatsApp. This version has expired.",null,{hk:"2Gcdji"})})};var i=n(48360),a=r(n(52665)),o=r(n(14296)),s=n(83578),l=r(n(11339)),c=n(48694),d=n(83023),u=n(65044),p=n(85893);function f(){var e;u.Socket.logout(!0,s.LogoutReason.UserInitiated),new l.default.CompanionForceUpgradeUserAction({forceUpgradeUserAction:l.default.FORCE_UPGRADE_USER_ACTION_TYPE.LOGOUT,forceUpgradeReason:null!==(e=c.PrimaryForceUpgrade.forceUpgradeReason)&&void 0!==e?e:""}).commit()}function h(){var e;new l.default.CompanionForceUpgradeUserAction({forceUpgradeUserAction:l.default.FORCE_UPGRADE_USER_ACTION_TYPE.UPGRADE,forceUpgradeReason:null!==(e=c.PrimaryForceUpgrade.forceUpgradeReason)&&void 0!==e?e:""}).commit(),d.Updater.update(null,!0,0)}},99608:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.Stage=t.LoadingScreen=void 0;var i=r(n(94184)),a=n(48360),o=n(67294),s=r(n(59312)),l=n(87550),c=r(n(39770)),d=r(n(14296)),u=r(n(56074)),p=r(n(24326)),f=r(n(24161)),h=n(85893);const _=n(76672).Mirrored(["INITIAL_LOAD","CONNECTING","DOWNLOADING","ORGANIZING"]);t.Stage=_;const g=e=>{(0,o.useEffect)((()=>{const e=document.getElementById("initial_startup");(null==e?void 0:e.parentNode)&&e.parentNode.removeChild(e)}),[]);const t=(0,s.default)();(0,l.useListener)(d.default,"locale_change",t);const n=e.stage===_.INITIAL_LOAD,r=e.stage===_.CONNECTING,g=e.stage===_.DOWNLOADING,E=e.stage===_.ORGANIZING,S=(0,i.default)(p.default.container,{[p.default.containerFixed]:!e.debug,[p.default.initialLoad]:n,[p.default.connecting]:r,[p.default.downloading]:g,[p.default.organizing]:E,[p.default.web]:!0}),v=(0,i.default)(p.default.graphic,{[p.default.shimmering]:n||E}),T=(0,i.default)(p.default.logout,{[p.default.showWarning]:g}),b=(0,i.default)(p.default.warning,{[p.default.showWarning]:g});let C;switch(e.stage){case _.INITIAL_LOAD:C=d.default.t(1027);break;case _.CONNECTING:C=d.default.t(357);break;case _.DOWNLOADING:C=(0,h.jsx)(u.default,{id:587,params:{progress:e.progress}});break;case _.ORGANIZING:C=a.fbt._("Organizing messages",null,{hk:"2ldft"})}return(0,h.jsxs)("div",{className:S,children:[(0,h.jsx)("div",{className:v,children:(0,h.jsx)(m,{})}),(0,h.jsx)("div",{className:p.default.progress,children:(0,h.jsx)(f.default,{value:e.progress,max:100})}),(0,h.jsx)("div",{className:p.default.main,children:C}),(0,h.jsxs)("div",{className:p.default.secondary,children:[(0,h.jsx)(y,{})," ",d.default.t(401)]}),null,null!=e.onLogout&&(0,h.jsx)("div",{className:T,children:(0,h.jsx)(c.default,{type:"plain-white",onClick:e.onLogout,children:d.default.t(596)})}),(0,h.jsx)("div",{className:b,children:a.fbt._("Don't close this window. Your messages are downloading.",null,{hk:"23nekH"})})]})},m=()=>(0,h.jsx)("span",{children:(0,h.jsxs)("svg",{width:"250px",height:"52px",viewBox:"0 0 250 52",version:"1.1",xmlns:"http://www.w3.org/2000/svg",children:[(0,h.jsxs)("g",{className:p.default.dots,children:[(0,h.jsx)("circle",{fill:"#B6B6B6",cx:"65.7636689",cy:"21.1046108",r:"3.65625"}),(0,h.jsx)("circle",{fill:"#B6B6B6",cx:"81.0791876",cy:"19.3283142",r:"3.65625"}),(0,h.jsx)("circle",{fill:"#B6B6B6",cx:"96.3947063",cy:"17.7846275",r:"3.65625"}),(0,h.jsx)("circle",{fill:"#B6B6B6",cx:"111.710225",cy:"17.5274031",r:"3.65625"}),(0,h.jsx)("circle",{fill:"#B6B6B6",cx:"127.025744",cy:"17.6118619",r:"3.65625"}),(0,h.jsx)("circle",{fill:"#B6B6B6",cx:"142.341262",cy:"18.4196288",r:"3.65625"}),(0,h.jsx)("circle",{fill:"#B6B6B6",cx:"157.656781",cy:"19.9893339",r:"3.65625"}),(0,h.jsx)("circle",{fill:"#B6B6B6",cx:"172.9723",cy:"22.0657859",r:"3.65625"})]}),(0,h.jsx)("path",{className:p.default.laptop,d:"M190.14097 4.7518926h48.227869l.281462-.00596781c1.058365-.00288774 2.664865.25185461 2.695721 2.87464716.142823 12.13996425 0 22.28077555 0 34.40910725 0 .06028-.024112.168784-.036168.217008l-16.394805-.0086927c-12.47317.0007215-24.136918.0136044-37.78743-.0033633l-.010915-6.2953341c-.030319-9.5718533-.105914-18.2714581.010915-28.31872515.033356-2.86867935 1.976535-2.91690333 3.013351-2.86867935zm20.097267 4.28597465l-19.256815-.00079524.002426 4.98254029c-.000422 6.5558423-.012657 12.8111695-.002954 19.3619492l.011919 4.9777941h46.536157l.008754-4.9777414c.010547-8.1882109.002637-15.913459.002637-24.3331514l-27.302124-.01059555zM179.195421 44.6572387c.397848-.036168.807752-.024112 1.2056-.024112 9.620684 0 19.241369-.012056 28.862053 0 .132616.4701838.54252 1.6393289 1.036816 1.6393289 3.255119.012056 4.510238 0 7.765357 0 .542519.036168.988591-1.1450331 1.133263-1.6513849 9.910029 0 19.820057.012056 29.730086.012056.084392.012056.265232.036168.349624.048224-.016075.2571945-.016075 1.0085894 0 2.2541846 0 1.4209691-1.193544 1.8201689-1.965128 2.1215688-.421959.1205599-.868031.1326159-1.289991.1928959h-63.560505c-.651024-.072336-1.350272-.108504-1.916904-.4701838-.566631-.2893439-1.000647-.7595278-1.350271-1.2779356v-2.8446419z",fill:"currentColor"}),(0,h.jsx)("path",{className:p.default.logo,d:"M37.7314595,31.1612046 C37.0876293,30.8391042 33.9223475,29.2816062 33.332139,29.0666255 C32.7419305,28.8517683 32.3127104,28.7444016 31.8834903,29.3887258 C31.4542703,30.0332973 30.2204788,31.4835521 29.8447567,31.91339 C29.4692818,32.3428571 29.0936834,32.3968494 28.4499768,32.0745019 C27.8060232,31.7521544 25.7314595,31.0723707 23.272278,28.8787027 C21.3582085,27.171583 20.0661004,25.0632896 19.6905019,24.4185946 C19.315027,23.7741467 19.6505946,23.4257297 19.9729421,23.1046178 C20.2625483,22.8161235 20.6167722,22.352556 20.9386255,21.9767104 C21.2606023,21.6007413 21.3678456,21.3320154 21.5824556,20.9026718 C21.7970657,20.472834 21.6898224,20.0968649 21.528834,19.7746409 C21.3678456,19.452417 20.0801853,16.2831815 19.543722,14.993915 C19.0210965,13.7387491 18.4903166,13.9087567 18.0950733,13.8887413 C17.7199691,13.870085 17.2902548,13.8661313 16.8611583,13.8661313 C16.4319382,13.8661313 15.7343629,14.0272433 15.144278,14.6716911 C14.5540695,15.3163861 12.8908108,16.8740077 12.8908108,20.0429961 C12.8908108,23.2121081 15.1978996,26.2734826 15.5198765,26.7031969 C15.8417297,27.1330348 20.0597992,33.6360772 26.5184865,36.4250193 C28.05461,37.0883707 29.2539305,37.4846023 30.1888494,37.7811274 C31.7312742,38.2713822 33.1348263,38.2021931 34.2440772,38.0363861 C35.4810811,37.8515521 38.0533127,36.478888 38.5898996,34.9750116 C39.1263629,33.470888 39.1263629,32.1818687 38.9653745,31.91339 C38.8045097,31.6447876 38.3752896,31.4835521 37.7314595,31.1612046 M25.9838765,47.2013591 L25.9752278,47.2013591 C22.1322625,47.1998763 18.3629343,46.1674749 15.0745946,44.2160926 L14.2926332,43.7519074 L6.18674906,45.8782394 L8.35027028,37.9751042 L7.84111198,37.1648494 C5.69723552,33.7549343 4.56500386,29.8139923 4.56660833,25.767166 C4.57130502,13.9587954 14.1789652,4.35187645 25.9924016,4.35187645 C31.7128649,4.35385328 37.0902239,6.58458689 41.1338378,10.6327722 C45.1773282,14.680834 47.4028724,20.0618996 47.4007737,25.7843398 C47.3959539,37.5936988 37.7882934,47.2013591 25.9838765,47.2013591 M44.2112742,7.556695 C39.3464092,2.68614672 32.8767258,0.00271814672 25.9836293,0 C11.7809421,0 0.221652509,11.5584247 0.215969112,25.7654363 C0.21411583,30.3069652 1.40058687,34.7397683 3.65553668,38.6475984 L-4.61852778e-14,52 L13.6596757,48.4167413 C17.4233205,50.4695597 21.6607876,51.5516293 25.9733745,51.5531121 L25.9838765,51.5531121 L25.984,51.5531121 C40.1852046,51.5531121 51.7456062,39.9934517 51.7512912,25.7860695 C51.7538842,18.9011274 49.0761392,12.4271197 44.2112742,7.556695",fill:"currentColor"})]})}),y=()=>(0,h.jsx)("span",{children:(0,h.jsx)("svg",{width:"10px",height:"12px",viewBox:"0 0 10 12",version:"1.1",xmlns:"http://www.w3.org/2000/svg",children:(0,h.jsx)("path",{d:"M5.00847986,1.6 C6.38255462,1.6 7.50937014,2.67435859 7.5940156,4.02703389 L7.59911976,4.1906399 L7.599,5.462 L7.75719976,5.46214385 C8.34167974,5.46214385 8.81591972,5.94158383 8.81591972,6.53126381 L8.81591972,9.8834238 C8.81591972,10.4731038 8.34167974,10.9525438 7.75719976,10.9525438 L2.25767996,10.9525438 C1.67527998,10.9525438 1.2,10.4731038 1.2,9.8834238 L1.2,6.53126381 C1.2,5.94158383 1.67423998,5.46214385 2.25767996,5.46214385 L2.416,5.462 L2.41679995,4.1906399 C2.41679995,2.81636129 3.49135449,1.68973395 4.84478101,1.60510326 L5.00847986,1.6 Z M5.00847986,2.84799995 C4.31163824,2.84799995 3.73624912,3.38200845 3.6709675,4.06160439 L3.6647999,4.1906399 L3.663,5.462 L6.35,5.462 L6.35111981,4.1906399 C6.35111981,3.53817142 5.88169076,2.99180999 5.26310845,2.87228506 L5.13749818,2.85416626 L5.00847986,2.84799995 Z",fill:"currentColor"})})}),E=(0,o.memo)(g);t.LoadingScreen=E},7260:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(48360),a=r(n(79436)),o=n(11054),s=n(13923),l=n(85893);var c=()=>(0,l.jsx)("div",{className:a.default.background,children:(0,l.jsxs)("div",{className:a.default.mainWrapper,children:[(0,l.jsx)(o.Spinner,{size:50,stroke:4,color:"highlight"}),(0,l.jsx)(s.TextDiv,{className:a.default.logoutTitle,size:"32",children:i.fbt._("Logging Out",null,{hk:"1YEOxc"})}),(0,l.jsx)(s.TextDiv,{theme:"muted",children:i.fbt._("Do not close this window",null,{hk:"14ygD4"})})]})});t.default=c},57224:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ModalTheme=t.Modal=void 0;var i=r(n(41609)),a=r(n(99964)),o=r(n(94184)),s=n(67294),l=r(n(5354)),c=r(n(79592)),d=r(n(17152)),u=n(85893);const p=n(76672).Mirrored(["Box","Flex","Guide","Tower","Auto","Invite","ColumnButtons","Multiline","Upgrade","CustomSize"]);t.ModalTheme=p;const f=(0,s.forwardRef)(((e,t)=>{const n=(0,s.useRef)(null),r=null!=e.title?(0,u.jsx)("div",{"data-a8n":a.default.key("popup-title"),className:d.default.popupTitle,children:e.title}):null,f=e.type===p.CustomSize&&e.dimensions?{height:`${e.dimensions.height}px`,width:`${e.dimensions.width}px`}:null,h=(0,o.default)(d.default.popup,{[d.default.popupFlexInvite]:e.type===p.Invite,[d.default.popupFlexUpgrade]:e.type===p.Upgrade,[d.default.popupBox]:e.type===p.Box,[d.default.popupFlex]:e.type===p.Flex,[d.default.popupTower]:e.type===p.Tower,[d.default.popupAuto]:e.type===p.Auto,[d.default.popupColumnButtons]:e.type===p.ColumnButtons,[d.default.popupMultiline]:e.type===p.Multiline,[d.default.popupCustomSize]:e.type===p.CustomSize}),_=(0,i.default)(e.actions)?null:(0,u.jsx)("div",{className:d.default.popupControls,children:e.actions}),g=(0,o.default)("overlay",d.default.backdrop,{[d.default.backdropCover]:e.cover,[d.default.popupGuide]:e.type===p.Guide}),m=(0,u.jsx)("div",{className:d.default.popupContainer,children:(0,u.jsx)("div",{className:h,"data-animate-modal-popup":!0,style:f,children:(0,u.jsxs)("div",{className:d.default.popupBody,"data-animate-modal-body":!0,children:[r,(0,u.jsx)("div",{"data-a8n":a.default.key("popup-contents"),className:d.default.popupContents,children:e.children}),_]})})});return(0,u.jsxs)(l.default,{className:g,onDragOver:e=>{var t;null===(t=n.current)||void 0===t||t.onDragOver(e)},onDragStart:e=>{var t;null===(t=n.current)||void 0===t||t.onDragStart(e)},onDragEnd:e=>{var t;null===(t=n.current)||void 0===t||t.onDragEnd(e)},ref:t,"data-animate-modal-backdrop":!0,children:[e.onDrop&&(0,u.jsx)(c.default,{ref:n,disableFromWithin:!0,onDragChange:e.onDragChange,onDrop:e.onDrop}),m]})}));t.Modal=f,f.displayName="Modal"},66776:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.MediaType=void 0,t.ModalManager=function(e){const{type:t,contextMenuRef:n}=e,r=(0,l.useRef)(null),[S,v]=(0,l.useState)(void 0),[T,b]=(0,l.useState)(null),[C,A]=(0,l.useState)(m),[P,M]=(0,l.useState)(void 0),[O,I]=(0,l.useState)(!1),w=()=>{if(!r.current)return;const e=r.current.getNode();e&&!e.contains(document.activeElement)&&o.default.focus(e)},R=()=>{if(!r.current)return;const e=r.current.getNode();e&&o.default.focus(e)},D=e=>{(e=>{const t=e.relatedTarget,r=null==n?void 0:n.current,i=!!r&&r.isOpen();return t instanceof HTMLElement&&!e.currentTarget.contains(t)&&!i})(e)&&w()},L=e=>{S&&(v(void 0),b(null),e&&A(e))},N=e=>{e===T&&L()};let k;(0,d.useListener)(u.Cmd,`open_${t}`,(function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.transition||m;const{uim:i,blockClose:o}=n;S&&(r=y);const s=(0,a.default)(`ModalManager${t}`);let d=e;t===E&&(d=(0,l.cloneElement)(e,{requestFocus:R})),c.default.unstable_batchedUpdates((()=>{v(d),b(s),A(r),M(i),I(null!=o&&o)}))})),(0,d.useListener)(u.Cmd,`close_${t}`,L),S&&(k=(0,g.jsx)(h.UIE,{displayName:`Modal${(0,i.default)(e.type)}`,escapable:!O,ref:r,requestFocus:w,requestDismiss:N.bind(null,T),children:e.type===E?(0,g.jsx)(f.default,{onBlur:D,children:S}):(0,g.jsx)(p.RotateFocus,{children:S})},T));return(0,g.jsx)(_.default.Consumer,{children:e=>(0,g.jsx)(_.default.Provider,{value:P||e,children:(0,g.jsx)(s.default,{transitionName:C,children:k})})})},t.ModalType=void 0;var i=r(n(11700)),a=r(n(73955)),o=r(n(52013)),s=r(n(40436)),l=n(67294),c=r(n(73935)),d=n(87550),u=n(88102),p=n(87956),f=r(n(22179)),h=n(18644),_=r(n(2773)),g=n(85893);const m="modal",y="none",E="modal";t.ModalType=E;t.MediaType="media"},22476:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.MUTE_ALWAYS_EXPIRATION_SENTINEL=void 0,t.calculateMuteExpiration=function(e){if(e===Number.POSITIVE_INFINITY)return-1;return 60*e*60+(0,a.default)().unix()},t.getAllMuteDurations=s,t.getDefaultMuteDuration=function(){return s()[0].duration};var i=n(48360),a=r(n(30381)),o=n(64551);function s(e){return e?[{label:i.fbt._("1 Hour",null,{hk:"2z3e4J"}),duration:1},{label:i.fbt._("8 Hours",null,{hk:"3orTzw"}),duration:8},{label:i.fbt._("1 Day",null,{hk:"11RKz3"}),duration:24},{label:i.fbt._("1 Week",null,{hk:"23fAj3"}),duration:168}]:[{label:i.fbt._("8 Hours",null,{hk:"3orTzw"}),duration:8},{label:i.fbt._("1 Week",null,{hk:"23fAj3"}),duration:168},o.ServerProps.muteAlways?{label:i.fbt._("Always",null,{hk:"26Zr18"}),duration:Number.POSITIVE_INFINITY}:{label:i.fbt._("1 Year",null,{hk:"45Hta7"}),duration:8760}]}t.MUTE_ALWAYS_EXPIRATION_SENTINEL=-1},96753:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(48360),a=r(n(14296)),o=n(57224),s=n(85893);t.default=()=>(0,s.jsx)(o.Modal,{title:i.fbt._("Computer not connected",null,{hk:"300jSy"}),cover:!0,children:a.default.t(583)})},40626:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(21310),a=n(48360),o=r(n(52665)),s=n(12591),l=r(n(14296)),c=n(85893);function d(){(0,s.openExternalLink)((0,i.getCannotConnectFaqUrl)())}t.default=()=>(0,c.jsx)(o.default,{cover:!0,title:l.default.t(259),okText:l.default.t(547),onOK:d,children:a.fbt._("Your computer is connected to a network that prevents WhatsApp from working correctly",null,{hk:"GhGFR"})})},57050:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(81629)),a=n(21310),o=n(48360),s=r(n(30381)),l=n(67294),c=r(n(52665)),d=n(12591),u=r(n(14296)),p=n(84387),f=n(99608),h=r(n(39326)),_=n(8080),g=r(n(4478)),m=n(65044),y=n(85893);class E extends l.PureComponent{constructor(e){super(e),this._forceUpdate=()=>{this.forceUpdate()},this._retried=()=>{null!=this.timeout&&(this.props.clearTimeout(this.timeout),this.timeout=null),null!=this.interval&&(this.props.clearInterval(this.interval),this.interval=null),this.setState({retriable:!1}),this.startTimeout()},this._allowRetry=()=>{this.setState({retriable:!0}),this.interval=this.props.setInterval(this._forceUpdate,1e3)},this.retry=()=>{m.Socket.poke(),this._retried()},this._handleLearnMoreClick=()=>{(0,d.openExternalLink)((0,a.getCannotConnectFaqUrl)())},this.state={retriable:!1}}componentDidMount(){this.startTimeout();const e=document.getElementById("initial_startup");(null==e?void 0:e.parentNode)&&e.parentNode.removeChild(e),this.props.listeners.add(_.Stream,"change:displayInfo",this._forceUpdate),this.props.listeners.add(m.Socket,"change:retryTimestamp",this._retried)}startTimeout(){this.timeout=this.props.setTimeout(this._allowRetry,3e3)}logout(){__LOG__(2)`Startup: user selected logout`,m.Socket.logout()}render(){let e,t,n,r;const{progress:a}=this.props;switch(_.Stream.displayInfo){case _.StreamInfo.OPENING:e=u.default.t(358),t=u.default.t(583),r=this.logout;break;case _.StreamInfo.PAIRING:case _.StreamInfo.TIMEOUT:e=u.default.t(778),t=(0,y.jsxs)("span",{children:[o.fbt._("Make sure your phone has an active Internet connection.",null,{hk:"4u0X1o"}),(0,y.jsx)("span",{className:h.default.action,onClick:this._handleLearnMoreClick,role:"button",children:u.default.t(547)})]}),r=this.logout;break;case _.StreamInfo.SYNCING:case _.StreamInfo.CONNECTING:return(0,y.jsx)(f.LoadingScreen,{progress:a,stage:f.Stage.INITIAL_LOAD});default:return _.Stream.mode===_.StreamMode.MAIN?(0,y.jsx)(f.LoadingScreen,{progress:a,stage:f.Stage.INITIAL_LOAD}):null}const l=this.state.retriable;if(l){const e=m.Socket.retryTimestamp-Date.now();if(isNaN(e)||e<1)n=u.default.t(719),(0,i.default)((()=>m.Socket.poke()));else if(e<6e4){const t=Math.ceil(e/1e3);n=u.default.t(721,{number:t,_plural:t})}else n=u.default.t(720,{duration:s.default.duration(e).humanize()})}else n=u.default.t(719);return(0,y.jsxs)(c.default,{cover:!0,title:e,okText:u.default.t(718),onOK:l?this.retry:()=>{},cancelText:r?u.default.t(596):null,onCancel:r,children:[n,(0,y.jsx)("hr",{className:h.default.divider}),(0,y.jsx)("div",{className:h.default.textTip,children:t})]})}}E.displayName="Startup";var S=(0,g.default)((0,p.ListenerHOC)(E));t.default=S},37538:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=(0,a.default)();let n,r;(0,s.useListener)(f.Stream,"change:displayInfo",t);const[g]=(0,o.default)(t,1e3),[m]=(0,l.useTimeout)(g,6e3),y=f.Stream.displayInfo;(0,i.useEffect)((()=>{m();const e=document.getElementById("initial_startup");(null==e?void 0:e.parentNode)&&e.parentNode.removeChild(e)}),[]);const E=()=>{__LOG__(2)`Startup: user selected logout`,h.Socket.logout()};switch(y){case f.StreamInfo.OPENING:case f.StreamInfo.PAIRING:case f.StreamInfo.TIMEOUT:n=u.default.t(358),r=u.default.t(583);break;case f.StreamInfo.SYNCING:case f.StreamInfo.CONNECTING:return(0,_.jsx)(d.default,{initialLoadReady:e.initialLoadReady,onReady:e.onReady,onLogout:E});default:return f.Stream.mode===f.StreamMode.MAIN?(0,_.jsx)(d.default,{initialLoadReady:e.initialLoadReady,onReady:e.onReady,onLogout:E}):null}return(0,_.jsxs)(c.default,{cover:!0,title:n,cancelText:u.default.t(596),onCancel:E,children:[(0,_.jsx)("hr",{className:p.default.divider}),(0,_.jsx)("div",{className:p.default.textTip,children:r})]})};var i=n(67294),a=r(n(59312)),o=r(n(70393)),s=n(87550),l=n(46428),c=r(n(52665)),d=r(n(31760)),u=r(n(14296)),p=r(n(57525)),f=n(8080),h=n(65044),_=n(85893)},68481:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return(0,l.jsxs)(i.default,{cover:!0,cancelText:a.default.t(596),onCancel:s.Socket.logout.bind(s.Socket,!0,o.LogoutReason.UserInitiated),okText:a.default.t(574),onOK:s.Socket.poke.bind(s.Socket),children:[e.description,"",e.children]})};var i=r(n(52665)),a=r(n(14296)),o=n(83578),s=n(65044),l=n(85893)},58955:(e,t,n)=>{"use strict";t.TG=function(e){const{promise:t,reason:n}=e;if(r.Logger.logUncaughtError(n,t),!d(n))return;const i=n instanceof Error&&n.stack?null:`unhandled-rejection: ${n}`;a.upload({reason:i,hasTaggedMessage:!0})},t.HC=function(e,t,i,o,u){if(function(e){const t=[...s];return t.push(...l),t.some((t=>{let{partialUserAgent:n,partialMsg:r}=t;return c.includes(n)&&String(e).includes(r)}))}(e))return __LOG__(3)`Ignored Error: ${e||(u||"").toString()}`,!0;try{const{UIM:e}=n(89618);e.pprint(!0)}catch(e){__LOG__(3)`UIM Print Failed!`}const p=t.split("?")[0];let f;f=p&&"number"==typeof i?` (${p}:${i}:${o})`:p?` (${p})`:"";if("Script error."===e&&!u)return r.Logger.logUncaughtError(`${f} ${e}`),p&&a.upload({reason:"script-error",hasTaggedMessage:!0}),!1;const h=u instanceof Error&&u.stack?u:`${e||`Given: ${String(u)}`}`;if(r.Logger.logUncaughtError(h),!d(u))return!0;return a.upload({reason:null,hasTaggedMessage:!0}),!0};var r=n(39948),i=n(35232),a=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=o(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var s=i?Object.getOwnPropertyDescriptor(e,a):null;s&&(s.get||s.set)?Object.defineProperty(r,a,s):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(86374));function o(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(o=function(e){return e?n:t})(e)}const s=[{partialUserAgent:"Chrome",partialMsg:"ResizeObserver loop limit exceeded"}],l=[{partialUserAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.113 Safari/537.36",partialMsg:"Cannot read property 'style' of null"},{partialUserAgent:"Mozilla/5.0 (Windows NT 6.2; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.78 Safari/537.36",partialMsg:"Unexpected token :"},{partialUserAgent:"Firefox/52.0,,Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.9.0.4) Gecko/20100101 Firefox/52.0",partialMsg:"Cannot read property 'style' of undefined"},{partialUserAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_5) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/12.1.1 Safari/605.1.15",partialMsg:"is not an object"},{partialUserAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.113 Safari/537.36",partialMsg:"Cannot read property 'getElementsByTagName' of undefined"},{partialUserAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/67.0.3396.99 Safari/537.36",partialMsg:"Can't find variable: dismissKeyboard"},{partialUserAgent:"Mozilla/5.0 (Windows NT 6.2; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.78 Safari/537.36",partialMsg:"ReferenceError: None is not defined"}],c=window.navigator.userAgent;function d(e){return!(e instanceof i.DbOnLogoutAbort)}},27838:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getIsTabActive=function(){return s},t.isAnotherTabActive=function(){return l.apply(this,arguments)},t.setTabActive=function(){s=!0};var i=r(n(48926)),a=r(n(25613)),o=r(n(64237));let s=!1;function l(){return(l=(0,i.default)((function*(){const e=navigator.serviceWorker;if(null==e?void 0:e.controller)try{return(yield a.default.request(e.controller,o.default.ACTIVE_TAB)).some((e=>!0===e.isActive))}catch(e){return __LOG__(4,void 0,new Error,!0)`error: ${e}`,SEND_LOGS("ACTIVE_TAB service worker call failed"),!1}return!1}))).apply(this,arguments)}},97628:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ThemeContext=t.THEME_ASSETS=void 0,t.applyThemeToUI=u,t.getSystemThemeMode=c,t.getTheme=function(){var e;if(c())return o.default.getCurrentTheme();return null!==(e=(0,a.getTheme)())&&void 0!==e?e:"light"},t.setSystemThemeMode=d,t.setTheme=l;var i=n(67294),a=n(99234),o=r(n(3137));const s={light:[{id:"bg-chat-light",selectors:["[data-asset-chat-background-light]"],low:{default:n(33557)},high:{default:n(33557)}},{id:"bg-chat-dark",selectors:["[data-asset-chat-background-dark]"],low:{default:n(29347)},high:{default:n(29347)}},{id:"intro-connection-light",selectors:["[data-asset-intro-image-light]"],low:{default:n(5250)},high:{default:n(12891)}}],dark:[{id:"bg-chat-dark",selectors:["[data-asset-chat-background-dark]"],low:{default:n(29347)},high:{default:n(29347)}},{id:"intro-connection-dark",selectors:["[data-asset-intro-image-dark]"],low:{default:n(35729)},high:{default:n(74548)}}]};function l(e){(0,a.setTheme)(e),u(e)}function c(){var e;return null===(e=(0,a.getSystemThemeMode)())||void 0===e||e}function d(e){(0,a.setSystemThemeMode)(e)}function u(e){const t=document.body;null==t||t.classList.toggle("dark","dark"===e)}t.THEME_ASSETS=s;const p={theme:o.default.getCurrentTheme(),systemThemeMode:!0,setTheme:l,setSystemThemeMode:d},f=(0,i.createContext)(p);t.ThemeContext=f},54793:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.UpdaterBase=t.DownloadState=void 0;var i=n(40265),a=r(n(85074)),o=n(40234),s=r(n(76521)),l=r(n(11554)),c=r(n(14442)),d=n(52622);const u=n(76672).Mirrored(["UPDATE_DOWNLOADED","UPDATE_NOT_AVAILABLE","ERROR"]);t.DownloadState=u;class p extends s.default{constructor(){super(),this._forceUpdateOnTakeOver=!1,this.latestUpdateIteration=0,this.activeVersion=new d.Version("2.2210.9"),l.default.onVersionChange((()=>this.setForceUpdateOnTakeOver()))}setForceUpdateOnTakeOver(){this._forceUpdateOnTakeOver=!0}shouldForceUpdateOnTakeOver(){const e=this._forceUpdateOnTakeOver;return this._forceUpdateOnTakeOver=!1,!!e}isExpired(){return o.Clock.globalUnixTime()>Number(c.default)}clearHardExpiration(){this.hardExpirationTimer&&(a.default.clearTimeout(this.hardExpirationTimer),this.hardExpirationTimer=void 0),this.stopListening(n(8080).Stream,"change:couldForce")}update(){throw new i.UnimplementedMethod("Updater::update")}restart(){throw new i.UnimplementedMethod("Updater::restart")}manualDownload(){throw new i.UnimplementedMethod("Updater::manualDownload")}killServiceWorker(){throw new i.UnimplementedMethod("Updater::killServiceWorker")}}t.UpdaterBase=p},14442:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;const r=document.getElementById("hard_expire_time");let i=null==r||null===(n=r.dataset)||void 0===n?void 0:n.time;i||(__LOG__(3)`hard expire time not found on dom, using fallback of 1572566400 (2019/11/1)`,i="1572566400");var a=i;t.default=a},48440:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.PLATFORMS=void 0,t.checkForUpdates=function(){return h.apply(this,arguments)},t.updatePoll=t.hasUpdate=void 0;var i=r(n(48926)),a=r(n(28195)),o=r(n(26847)),s=n(83023),l=n(52622),c=n(42448);const d="https://web.whatsapp.com/check-update",u={WEB:"web",DARWIN:"darwin",WIN32:"win32",MACSTORE:"darwin-store",WINSTORE:"win32-store",DARWIN_BETA:"darwin-beta",WIN32_BETA:"win32-beta"};t.PLATFORMS=u;const p=e=>[e.isBroken,e.isBelowSoft,e.isBelowHard,e.beta].some(Boolean);t.hasUpdate=p;const f=new a.default({name:"updater",interval:1800,restingInterval:3600,randomIntervalExtension:180});function h(){return(h=(0,i.default)((function*(){const e=u[c.WAM_PLATFORM],t=l.SANITIZED_VERSION_STR;let r=null;if(!navigator.onLine)return __LOG__(2)`Update check skipped because user is offline.`,!1;try{const n=yield(0,o.default)(`${d}?version=${t}&platform=${e}`);if(!n.ok)throw Error(n.statusText);r=yield n.json();const i=(new Date).toISOString();__LOG__(2)`Updater: Checked at ${i} ${JSON.stringify({response:r,version:t})}`}catch(e){__LOG__(4,void 0,new Error)`Updater: Version check failed`}if(!r||!p(r))return!1;const{isBelowHard:i,isBelowSoft:a,hardUpdateTime:f,currentVersion:h,isBroken:_,beta:g}=r;__LOG__(2)`Updater: App will update. ${JSON.stringify({response:r,version:t})}`;const m=i?f:null;return"web"===e?s.Updater.update(h,a,m):_?n(8080).Stream.needsManualDownload=!0:s.Updater.update(void 0,a,m,g),!0}))).apply(this,arguments)}t.updatePoll=f},83023:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.UpdaterImpl=t.Updater=void 0;var i=n(54793),a=n(52622),o=r(n(85074)),s=r(n(79264)),l=r(n(92658));class c extends i.UpdaterBase{update(e,t,r){__LOG__(2)`AppUpdate:update current: ${String(this.activeVersion)} latest: ${String(e)}`;const s=++this.latestUpdateIteration,l=null==e?void 0:new a.Version(e);this.clearHardExpiration();const c=n(8080).Stream;return"number"==typeof r&&(this.hardExpirationTimer=o.default.setLocalTimeout((()=>(c.clientExpired=!0,this._update(l).then((e=>{e===i.DownloadState.UPDATE_DOWNLOADED&&this.restart()})))),Date.now()+r)),this.updateInProgress=Promise.resolve(this.updateInProgress).then((()=>this._update(l))).then((e=>{this.updateInProgress=void 0;const n=s!==this.latestUpdateIteration,a=e===i.DownloadState.ERROR,o=e===i.DownloadState.UPDATE_NOT_AVAILABLE;return n||a||o||(!0!==t&&"number"!=typeof r||(c.needsUpdate=!0),"number"==typeof r&&this.listenToAndRun(c,"change:couldForce",(()=>{c.couldForce&&this.restart()}))),e})),this.updateInProgress}_update(e){if(!this.activeVersion.equals(e)&&l.default.alive)return this._swUpdate();const t=this.activeVersion.equals(e)?i.DownloadState.UPDATE_NOT_AVAILABLE:i.DownloadState.UPDATE_DOWNLOADED;return Promise.resolve(t)}killServiceWorker(){if(!l.default.alive)return Promise.resolve();const e=navigator.serviceWorker;return e?(__LOG__(2)`Killing service worker`,e.ready.then((e=>e.unregister())).then((e=>{__LOG__(2)`Service worker unregistration status: ${String(e)}`}))):Promise.resolve()}_swUpdate(){const e=navigator.serviceWorker;return e?e.ready.then((t=>new Promise((n=>{function r(e){o(),__LOG__(3)`Unable to update service worker to version. Error: ${String(e)}`}function a(){o(),n(i.DownloadState.UPDATE_DOWNLOADED)}function o(){e.removeEventListener("error",r),e.removeEventListener("controllerchange",a)}e.addEventListener("error",r),e.addEventListener("controllerchange",a),t.update().then((()=>{t.installing||n(i.DownloadState.UPDATE_NOT_AVAILABLE)})).catch((e=>{r(e),n(i.DownloadState.ERROR)}))})))).catch((e=>(__LOG__(3)`Unable to update serviceworker, error: ${e}`,i.DownloadState.ERROR))):Promise.resolve(i.DownloadState.ERROR)}restart(e){return!0===e?this.update(void 0,!0,0):(s.default.hardRefresh(void 0,!1),Promise.resolve(i.DownloadState.UPDATE_DOWNLOADED))}}t.UpdaterImpl=c;const d=new c;t.Updater=d},52622:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Version=t.SANITIZED_VERSION_STR=void 0,t.sanitizeVersionStr=o;var r=n(40265);class i extends((0,r.customError)("InvalidVersion")){}class a{constructor(e){const t=e.split(".");if(3!==t.length)throw new i("Version format does not contain 3 numbers.");if(this.primary=Number.parseInt(t[0],10),this.secondary=Number.parseInt(t[1],10),this.tertiary=Number.parseInt(t[2],10),Number.isNaN(this.primary)||Number.isNaN(this.secondary)||Number.isNaN(this.tertiary))throw new i("Version contains a non-parseable string.")}lt(e){let t=e;return"string"==typeof t&&(t=new a(t)),this.primary<t.primary||this.primary===t.primary&&this.secondary<t.secondary||this.primary===t.primary&&this.secondary===t.secondary&&this.tertiary<t.tertiary}equals(e){let t=e;return!!t&&("string"==typeof t&&(t=new a(t)),this.primary===t.primary&&this.secondary===t.secondary&&this.tertiary===t.tertiary)}toString(){return`${this.primary}.${this.secondary}.${this.tertiary}`}}function o(e){return e.replace(/\.[di]$/,"")}t.Version=a;const s=o("2.2210.9");t.SANITIZED_VERSION_STR=s},99964:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={key(e){}};t.default=n},72117:(e,t,n)=>{"use strict";var r=n(95318);t.Z=void 0;var i=r(n(48926)),a=n(40265),o=n(50796),s=n(38284),l=r(n(85074)),c=n(99234),d=r(n(10151)),u=n(53055),p=n(65044);const f=n(9896).default,h=6e5,_="init",g="ping",m="pong",y="local-takeover";var E=new class{init(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(0,i.default)((function*(){const n=t+1;if(n>3)return!0;const r=(0,c.getNoTakeover)();(0,c.setNoTakeover)(),p.Socket.preload();if(yield e._pingForOtherLocalSession())return e._updateMutex(),yield(0,d.default)(!r),!1;if(r)return!0;throw n}))()}takeoverLocal(e){return(0,c.getMutex)()?((0,c.setMutex)(y),(0,s.promiseTimeout)(f(window,"storage",c.takeoverFilter),3e4,"takeoverLocalTimeout").then((t=>{const n=(0,c.parseTakeover)(t.newValue);return(0,u.getRememberMe)()||(0,u._setAllKeyValues)(n),p.Socket.mustExitLoop=!1,(0,c.removeMutex)(),this.init(e)})).catch((0,o.filteredCatch)(a.TimeoutError,(()=>(__LOG__(3)`app:takeoverLocal timeout`,p.Socket.mustExitLoop=!1,(0,c.removeMutex)(),this.init(e)))))):this.init(e)}unloadMutex(){const e=(0,c.getMutex)();e&&this._ourMutex&&e.includes(this._ourMutex)&&(0,c.removeMutex)()}storagePong(e){if(!(0,c.mutexFilter)(e))return;const t=(0,c.parseMutex)(e.newValue);return t?t===y?(this._clearMutexTimer(),p.Socket.exitLoop(),(0,c.localTakeoverSuccess)(),!0):void(0===t.indexOf(g)&&(0,c.setMutex)(m+Math.random())):void 0}_clearMutexTimer(){this._updateMutexTimerID&&l.default.clearTimeout(this._updateMutexTimerID)}_updateMutex(){this._clearMutexTimer();const e=Date.now();(0,c.setMutex)(this._ourMutex=_+"_"+e),this._updateMutexTimerID=l.default.setLocalTimeout(this._updateMutex.bind(this),e+h)}_pingForOtherLocalSession(){let e=(0,c.getMutex)();if(e){e+="";let t=1e4;if(e.indexOf("_")>0){const n=e.split("."),r=parseInt(n[n.length-1],10);if(Number.isFinite(r)){r<Date.now()-9e5&&(__LOG__(2)`app:_pingForOtherLocalSession stale mutex`,t=1e3)}}const n=(0,s.promiseTimeout)(f(window,"storage",c.mutexFilter),t,"waitForOtherLocalSessionTimeout").then((()=>!1)).catch((0,o.filteredCatch)(a.TimeoutError,(function(){return __LOG__(3)`app:_pingForOtherLocalSession mutex timeout`,!0})));return(0,c.setMutex)(g+Math.random()),n}return Promise.resolve(!0)}};t.Z=E},81703:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.compatPrefix=function(e,t){let a;if(0===e.indexOf(n)){a=e.substring(n.length);return i(window.Modernizr?window.Modernizr.prefixed(n):n,n,a)}if(0===e.indexOf(r)){a=e.substring(r.length);return i(window.Modernizr?window.Modernizr.prefixed(r):r,r,a)}return window.Modernizr.prefixed(e,t,!1)||e};const n="animation",r="transition";function i(e,t,n){const r=e.toLowerCase().indexOf(t),i=e.slice(0,r).toLowerCase();return 0===e.indexOf(t)?i+e.slice(r)+n.toLowerCase():i+e.slice(r)+n}},5177:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DISPLAY_TYPE=void 0;t.DISPLAY_TYPE={CONVERSATION:"CONVERSATION",MSG_INFO:"MSG_INFO",STARRED_MSGS:"STARRED_MSGS",GALLERY:"GALLERY",REPLY_STAGE:"REPLY_STAGE",QUOTED_MSG:"QUOTED_MSG",CONTACT_CARD:"CONTACT_CARD",ORDER:"ORDER"}},98159:(e,t,n)=>{"use strict";var r=n(59182).default,i=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.documentFlushed=function(e){var t;const n=null!==(t=null==e?void 0:e.signal)&&void 0!==t?t:l();return new Promise(((e,t)=>{if(n.aborted)return void t(new o.AbortError);let r;function i(){n.removeEventListener("abort",l);const e=s.indexOf(a);-1!==e&&s.splice(e,1),0===s.length&&null!=r&&(r(),r=null)}function a(){i(),e()}function l(){i(),t(new o.AbortError)}s.push(a),n.addEventListener("abort",l),1===s.length&&(r=function(){let e;const t=requestAnimationFrame((()=>{e=setTimeout((()=>{c()}),0)}));return()=>{cancelAnimationFrame(t),clearTimeout(e)}}())}))},t.resolveAllForTestingOnly=void 0;var a=i(n(51463)),o=n(89385);const s=[],l=(0,a.default)((()=>(new r).signal));function c(){for(;s.length>0;){s.shift()()}}t.resolveAllForTestingOnly=()=>(c(),Promise.resolve())},45120:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(21338));var a=new class{constructor(){this.shouldIndicateFocusTimestamp=0}shouldIndicateFocus(){this.shouldIndicateFocusTimestamp=Date.now()}maybeIndicateFocus(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i.default.focusAnimation;Date.now()-this.shouldIndicateFocusTimestamp>200||this.indicateFocus(e,t)}indicateFocus(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i.default.focusAnimation;e&&(e.classList.remove(t),e.offsetWidth,e.classList.add(t))}};t.default=a},52013:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(57319);let i=[],a=!1;const o=new r.ShiftTimer((function(){i=[],a=!1}));document.addEventListener("keydown",(()=>{o.forceRunNow()}),{capture:!0,passive:!0});var s={focus:function(e,t){if(e&&(!i.length||e!==i[i.length-1])){if(a=a||null!=window.event,function(e){5===i.length&&i.shift(),i.push(e)}(e),function(){if(i.length<5)return!1;const e=new Set;for(let t=0;t<i.length;t++){if(e.has(i[t]))return!0;e.add(i[t])}return!1}()&&!a)return __LOG__(4,void 0,new Error,!0)`Focus loop encountered.`,void SEND_LOGS("focus-loop");o.onOrBefore(75),e.focus(t)}}};t.default=s},41906:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SCROLL_FUDGE=t.QR_EDGE=t.LAYOUT_2COLUMNS_MAX_WIDTH=void 0;t.SCROLL_FUDGE=100;t.LAYOUT_2COLUMNS_MAX_WIDTH=1024;t.QR_EDGE=264},30764:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UIBusyTasks=t.IdleEnum=t.IdleCallbackTasks=void 0;var r=n(57319),i=n(90466);const a=n(76672).Mirrored(["IDLE_CALLBACK","UI_BUSY"]);t.IdleEnum=a;class o{constructor(e){this.busyMap=new Map,this.busyId=0,this._clearBusyMap=()=>{this.busyMap.clear()},this._taskMap=new Map,this.taskId=0,this.runIdleLoop=()=>{this.idleType===a.IDLE_CALLBACK?this.idleCallbackId=(0,i.requestIdleCallback)(this._ricOnIdle):this.isIdle()&&this._uiBusyOnIdle()},this._ricOnIdle=e=>{let t;const n=this._taskMap.entries();for(;(t=n.next())&&!t.done;){const[n,r]=t.value;if(r(),this._taskMap.delete(n),e.timeRemaining()<=0)break}this._taskMap.size>0&&this.runIdleLoop()},this.idleType=e}setBusy(e){let t=e;return null!=t&&this.busyMap.has(t)?this.busyMap.set(t,this.busyMap.get(t)+1):(t=++this.busyId,this.busyMap.set(t,1)),this.busyTimer||(this.busyTimer=new r.ShiftTimer(this._clearBusyMap)),this.busyTimer.debounce(1e3),t}decBusy(e){if(null==e)return;const t=this.busyMap.get(e);null!=t&&0!==t&&(1===t?this.clearBusy(e):this.busyMap.set(e,t-1))}clearBusy(e){null!=this.busyMap.get(e)&&this.busyMap.delete(e),this.isIdle()&&(this.busyTimer.cancel(),this._taskMap.size>0&&window.setTimeout(this.runIdleLoop,0))}isIdle(){return 0===this.busyMap.size}isBusy(){return this.busyMap.size>0}cancelIdleLoop(){this.idleType===a.IDLE_CALLBACK&&null!=this.idleCallbackId&&(0,i.cancelIdleCallback)(this.idleCallbackId)}_uiBusyOnIdle(){let e;const t=this._taskMap.entries();for(;(e=t.next())&&!e.done;){const[t,n]=e.value;if(n(),this._taskMap.delete(t),this.isBusy())break}}enqueue(e){return this._taskMap.set(++this.taskId,e),1===this._taskMap.size&&this.runIdleLoop(),this.taskId}dequeue(e){const t=this._taskMap.delete(e);return t&&0===this._taskMap.size&&this.cancelIdleLoop(),t}isInQueue(e){return this._taskMap.has(e)}}const s=new o(a.UI_BUSY);t.UIBusyTasks=s;const l=new o(a.IDLE_CALLBACK);t.IdleCallbackTasks=l},77144:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.isWeb=t.isOSWin=t.isOSRTL=t.isOSMac=t.isOSLTR=t.isNative=t.hasSafariFix=t.hasFontFix=t.hasFirefoxFix=t.hasEdgeFix=void 0;var i=n(26741),a=r(n(14296));null!=window.Native&&a.default.isRTL(window.Native.appGetLocale());t.isNative=!1;t.isWeb=!0;const o=i.UA.isSafari;t.hasSafariFix=o;const s=i.UA.isTrident;t.hasEdgeFix=s;const l=i.UA.isGecko;t.hasFirefoxFix=l;const c=i.UA.browser===i.BROWSER_TYPE.CHROME||i.UA.browser===i.BROWSER_TYPE.OPERA;t.hasFontFix=c;t.isOSLTR=!1;t.isOSRTL=!1;const d=i.UA.os===i.OS_TYPE.MAC;t.isOSMac=d;const u=i.UA.os===i.OS_TYPE.WINDOWS;t.isOSWin=u},13643:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(12641));const a=[.1,.82,.25,1],o=[.69,0,.79,.14],s=[.84,.07,.93,.46];i.default.RegisterEffect("attach.Up",{defaultDuration:300,calls:[[{opacity:[1,0],translateY:["0%","150%"],scaleX:[1,.3],scaleY:[1,.3]},1,{easing:[300,22]}]]}),i.default.RegisterEffect("attach.Down",{defaultDuration:200,easing:o,calls:[[{opacity:[0,1],translateY:["100%","0%"],scaleX:[.3,1],scaleY:[.3,1]},1,{easing:[.33,0,.39,.91]}]]}),i.default.RegisterEffect("dropdown.Down",{defaultDuration:200,easing:a,calls:[[{opacity:[1,0],translateY:["0%","-15px"]},1,{easing:a}]]});var l={pop:{duration:200,easing:s,enter:{props:{scaleX:[1,.5],scaleY:[1,.5],opacity:[1,0]}},leave:{props:{scaleX:[.5,1],scaleY:[.5,1],opacity:[0,1]}}},slide:{duration:200,easing:a,enter:{props:"slideDown"},leave:{props:"slideUp"}},scaleY:{duration:200,easing:a,enter:{props:{scaleY:[1,0],transformOrigin:"center"}},leave:{props:{scaleY:[0,1],transformOrigin:"center"}}},scale:{duration:500,easing:a,enter:{props:{scaleX:[1,0],scaleY:[1,0]}},leave:{props:{scaleX:[0,1],scaleY:[0,1]}}},fade:{duration:200,easing:a,enter:{props:{opacity:[1,0]}},leave:{props:{opacity:[0,1]}}},messageComposer:{duration:300,easing:"easeInOut",enter:{props:{opacity:[1,0],translateX:[0,-100]}},leave:{props:{opacity:[0,1],translateX:[-100,0]}}},pttComposer:{duration:300,easing:"easeInOut",enter:{props:{opacity:[1,0]}},leave:{props:{opacity:[0,1]}}},"fade-fast":{easing:"ease",enter:{props:{opacity:[1,0]},duration:150},leave:{props:{opacity:[0,1]},duration:100}},"ptt-out-of-chat":{enter:{props:{translateY:["-100%","0%"],opacity:[1,0]},duration:250,delay:150,easing:"ease"},leave:{props:{translateY:["0%","-100%"],opacity:[0,1]},duration:250,delay:150,easing:"ease"}},fade_sifo:{enter:{props:{opacity:[1,0]},duration:250},leave:{props:{opacity:[0,1]},duration:100}},capture:{enter:{props:{opacity:[1,0]},duration:350},leave:[{selector:"[data-animate-capture-snapshot]",props:"transition.bounceDownOut",duration:700},{selector:"[data-animate-capture-webcam]",props:{opacity:[0,1]},duration:100,easing:"ease"}]},butterbar:{enter:{props:"slideDown",easing:a,duration:700},leave:{props:"slideUp",easing:o,duration:350}},modal:{enter:[{selector:"[data-animate-modal-backdrop]",props:{opacity:[1,0]},duration:300,easing:[.19,.73,.28,1]},{selector:"[data-animate-modal-popup]",props:{scaleX:[1,0],scaleY:[1,0],opacity:[1,0]},easing:[.19,.73,.28,1],delay:180,duration:200},{selector:"[data-animate-modal-popup]",props:{opacity:[0,0]},duration:180}],leave:[{selector:"[data-animate-modal-backdrop]",props:{opacity:[0,1]},duration:300,easing:o,delay:100},{selector:"[data-animate-modal-popup]",props:{scaleX:[0,1],scaleY:[0,1]},easing:o,duration:200}]},"modal-flow":{enter:[{selector:"[data-animate-modal-backdrop]",props:{opacity:[1,0]},duration:300,easing:[.19,.73,.28,1]},{selector:"[data-animate-modal-popup]",props:{scaleX:[1,0],scaleY:[1,0],opacity:[1,1]},easing:[.19,.73,.28,1],delay:180,duration:200},{selector:"[data-animate-modal-popup]",props:{opacity:[0,0]},duration:180}],leave:[{selector:"[data-animate-modal-backdrop]",props:{opacity:[0,1]},duration:300,easing:o,delay:100},{selector:"[data-animate-modal-popup]",props:{scaleX:[0,1],scaleY:[0,1]},easing:o,duration:200}]},"flow-transition-modal-push":{duration:300,easing:a,enter:{props:{opacity:[1,0]}},leave:{props:{opacity:[0,1]}}},"flow-transition-modal-pop":{duration:300,easing:a,enter:{props:{opacity:[1,0]}},leave:{props:{opacity:[0,1]}}},"flow-transition-box-size-drawer-push":{duration:300,easing:a,enter:[{selector:"[data-animate-modal-body]",props:{translateX:["0%","100%"]}}],leave:[{props:{background:["transparent","transparent"]}},{selector:"[data-animate-modal-popup]",props:{background:["transparent","transparent"],boxShadow:["none","none"]}},{selector:"[data-animate-modal-body]",props:{translateX:["-100%","0%"]}}]},"flow-transition-box-size-drawer-pop":{duration:300,easing:a,enter:[{selector:"[data-animate-modal-body]",props:{translateX:["0%","-100%"]}}],leave:[{props:{background:["transparent","transparent"]}},{selector:"[data-animate-modal-popup]",props:{background:["transparent","transparent"],boxShadow:["none","none"]}},{selector:"[data-animate-modal-body]",props:{translateX:["100%","0%"]}}]},"flow-transition-drawer-push":{duration:300,easing:a,enter:{props:{translateX:["0%","100%"]}},leave:{props:{translateX:["-100%","0%"]}}},"flow-transition-drawer-pop":{duration:300,easing:a,enter:{props:{translateX:["0%","-100%"]}},leave:{props:{translateX:["100%","0%"]}}},"drawer-left":{enter:[{props:{translateX:["0%","-100%"]},duration:300,easing:a},{selector:"[data-animate-drawer-title]",props:{translateX:[0,-50],opacity:[1,0]},duration:500,easing:"easeOut"}],leave:[{props:{translateX:["-100%","0%"]},duration:300,easing:o}]},"drawer-left-rtl":{enter:[{props:{translateX:["0%","100%"]},duration:300,easing:a},{selector:"[data-animate-drawer-title]",props:{translateX:[0,50],opacity:[1,0]},duration:500,easing:"easeOut"}],leave:[{props:{translateX:["100%","0%"]},duration:300,easing:o}]},dropdown:{duration:300,easing:a,enter:[{selector:"[data-animate-dropdown-item]",props:"dropdown.Down",delay:50,duration:375,stagger:25,drag:!0},{props:{scale:[1,0]}},{props:{opacity:[1,0]},duration:100}],leave:{props:{scaleX:[0,1],scaleY:[0,1],opacity:[0,1]}}},"dropdown-picker":{duration:300,easing:a,enter:[{selector:"[data-animate-dropdown-item]",props:{opacity:[1,0]},delay:50,duration:200},{selector:"[data-animate-dropdown-nib]",props:{opacity:[1,0],rotateZ:["45deg"],translateY:["0%","-100%"]}},{props:{scale:[1,0]}},{props:{opacity:[1,0]},duration:100}],leave:[{selector:"[data-animate-dropdown-item]",props:{opacity:[1,0]},duration:100},{selector:"[data-animate-dropdown-nib]",props:{opacity:[1,0]},duration:150},{props:{scaleX:[0,1],scaleY:[0,1],opacity:[0,1]}}]},"profile-viewer":{duration:500,easing:[.1,1.03,.28,.99],leave:[{delay:400,props:{opacity:[0,1]}},{selector:"[data-animate-profile-viewer]",props:{borderRadius:["50%","0%"]}}]},"media-viewer":{duration:300,easing:[.1,1.03,.28,.99],leave:{selector:"[data-animate-media-viewer]",props:{opacity:[0,1]}}},"status-v3-quoted-msg":{enter:{props:{translateY:["0%","100%"],opacity:[1,0]},duration:200,easing:a},leave:{props:{translateY:["100%","0%"],opacity:[0,1]},duration:200,easing:o}},"status-v3-panel":{enter:{props:{translateY:["0%","100%"],opacity:[1,0]},duration:300,easing:a},leave:{props:{translateY:["100%","0%"],opacity:[0,1]},duration:200,easing:o}},"status-v3-modal":{easing:[.55,.085,.68,.53],enter:{duration:100,selector:"[data-animate-status-v3-modal-background]",props:{opacity:[1,0]}},leave:{duration:100,selector:"[data-animate-status-v3-modal-background]",props:{opacity:[0,1]}}},"quoted-status-v3-modal":{easing:[.55,.085,.68,.53],enter:{duration:100,selector:"[data-animate-status-v3-viewer]",props:{opacity:[1,0]}},leave:{duration:100,selector:"[data-animate-status-v3-viewer]",props:{opacity:[0,1]}}},"status-v3-player":{easing:[.55,.085,.68,.53],enter:{duration:200,props:{opacity:[1,0]}},leave:{duration:200,props:{opacity:[0,1]}}},menu:{enter:{selector:"[data-animate-menu-icons-item]",props:"attach.Up",duration:700,stagger:30,drag:!1},leave:{selector:"[data-animate-menu-icons-item]",props:"attach.Down",duration:200,stagger:30}},emoji:{duration:300,easing:a,enter:{props:{height:[291,0]}},leave:{props:{height:[0,291]}}},ptt:{enter:[{selector:"[data-animate-btn-border]",easing:"easeInOut",props:{scaleX:[1,.5],scaleY:[1,.5],opacity:[1,0]},duration:250,delay:100},{selector:"[data-animate-ptt-counter]",easing:"easeInOut",props:{scaleX:[1,.8],scaleY:[1,.8],opacity:[1,0]},duration:250,delay:100},{props:{opacity:[1,0]},duration:150,easing:a}],leave:[{selector:"[data-animate-btn-border]",easing:a,props:{scaleX:[.5,1],scaleY:[.5,1],opacity:[0,1]},duration:250},{selector:"[data-animate-ptt-counter]",easing:a,props:{scaleX:[.5,1],scaleY:[.5,1],opacity:[0,1]},duration:250},{props:{opacity:[0,1]},duration:300,easing:a}]},"slide-left":{duration:300,easing:a,enter:{props:{translateX:["0%","100%"]}},leave:{props:{translateX:["100%","0%"]}}},"slide-left-rtl":{duration:300,easing:a,enter:{props:{translateX:["0%","-100%"]}},leave:{props:{translateX:["-100%","0%"]}}},"slide-forward":{duration:200,easing:[.19,.93,.18,.99],enter:{props:{translateX:["0%","100%"]}},leave:{props:{translateX:["-100%","0%"]}}},"slide-back":{duration:200,easing:[.19,.93,.18,.99],enter:{props:{translateX:["0%","-100%"]}},leave:{props:{translateX:["100%","0%"]}}},"media-slide-forward":{duration:200,easing:[.19,.93,.18,.99],enter:[{selector:"[data-animate-attach-media]",props:{opacity:[1,0],translateX:["0%","30%"]}},{selector:"[data-animate-media-caption]",props:{opacity:[1,0]}}],leave:[{selector:"[data-animate-attach-media]",props:{opacity:[0,1],translateX:["-30%","0%"]}},{selector:"[data-animate-media-caption]",props:{opacity:[0,1]}}]},"media-slide-back":{duration:200,easing:[.19,.93,.18,.99],enter:[{selector:"[data-animate-attach-media]",props:{opacity:[1,0],translateX:["0%","-30%"]}},{selector:"[data-animate-media-caption]",props:{opacity:[1,0]}}],leave:[{selector:"[data-animate-attach-media]",props:{opacity:[0,1],translateX:["30%","0%"]}},{selector:"[data-animate-media-caption]",props:{opacity:[0,1]}}]},"slide-down-date":{duration:300,enter:{props:{translateY:["0%","-130%"],opacity:[1,0]},easing:a},leave:{props:{translateY:["-130%","0%"],opacity:[0,1]},easing:o}},"slide-down-test":{duration:300,easing:a,enter:{props:{height:["auto","0"],opacity:[1,0]}},leave:{props:{translateY:["-130%","0%"],opacity:[0,1]}}},"pop-fast-reverse":{duration:75,easing:[.14,.62,.33,.9],enter:[{selector:"[data-js-context-icon]",props:{translateX:["0%","-100%"]}},{props:{opacity:[1,.5]}}],leave:[{selector:"[data-js-context-icon]",props:{translateX:["-100%","0%"]}},{props:{opacity:[0,1]}}]},"pop-fast":{duration:75,easing:[.14,.62,.33,.9],enter:[{selector:"[data-js-context-icon]",props:{translateX:["0%","100%"]}},{props:{opacity:[1,.5]}}],leave:[{selector:"[data-js-context-icon]",props:{translateX:["100%","0%"]}},{props:{opacity:[0,1]}}]},"pop-fast-chat":{duration:75,easing:[.14,.62,.33,.9],enter:[{props:{width:["20px","5px"],opacity:[1,.5]}}],leave:[{props:{width:["5px","20px"],opacity:[0,1]}}]},"toast-transition":{duration:300,easing:a,cleanOnComplete:!0,enter:{props:{translateY:["0%","100%"],opacity:[1,0]}},leave:{props:{opacity:[0,1]}}},"slide-up-down":{duration:300,easing:a,enter:{props:{translateY:["0%","100%"]}},leave:{props:{translateY:["100%","0%"]}}},"slide-up-down-footer":{duration:200,easing:a,enter:[{props:{translateY:["0%","100%"]}},{selector:"[data-animate-btn]",props:{opacity:[1,0],scale:[1,0]},delay:200,duration:300}],leave:[{props:{translateY:["100%","0%"]},delay:200},{selector:"[data-animate-btn]",props:{opacity:[0,1],scale:[.6,1]},duration:200}]},"slide-up":{duration:300,easing:a,enter:{props:{translateY:["0%","100%"]}},leave:{props:{translateY:["100%","0%"]}}},"slide-up-fade-in-eta":{duration:100,easing:a,enter:{props:{translateY:["0%","100%"],opacity:[1,0],height:[20,0]}},leave:{props:{translateY:["100%","0%"],opacity:[0,1],height:[0,20]}}},"slide-down":{duration:300,easing:a,enter:{props:{translateY:["0%","-100%"]}},leave:{props:{translateY:["-100%","0%"]}}},"emoji-search-slide-away":{duration:300,enter:{easing:"easeOutCubic",props:{translateY:["0%","-100%"]}},leave:{easing:"easeInCubic",props:{translateY:["-100%","0%"]}}},"emoji-search-slide-away-fast":{duration:80,enter:{easing:"easeOutCubic",props:{translateY:["0%","-100%"]}},leave:{easing:"easeInCubic",props:{translateY:["-100%","0%"]}}},"emoji-search-panel-slide-up":{duration:300,easing:a,enter:{props:{translateY:["0%","100%"],opacity:[1,0]}},leave:{props:{translateY:["100%","0%"],opacity:[0,1]}}},none:{},btn:{duration:300,easing:a,enter:{props:{scale:[1,0],opacity:[1,0]}},leave:{props:{scale:[0,1],opacity:[0,1]}}},pop_delay:{duration:300,enter:[{props:{scale:[1,0],opacity:[1,0]},delay:500,easing:a}],leave:{props:"transition.expandOut",easing:o}},"delay-leave":{duration:1,enter:{props:{opacity:[1,1]}},leave:{props:{opacity:[1,1]},delay:300}},"media-caption":{enter:[{props:{opacity:[0,0],translateY:["100%","100%"]},duration:200},{props:{opacity:[1,0],translateY:["0%","100%"]},easing:a,delay:200,duration:300}],leave:{props:{opacity:[0,1]},easing:"ease",duration:300}},"media-scale":{enter:[{selector:"[data-animate-media-caption]",props:{opacity:[0,0],translateY:["100%","100%"]},duration:200},{selector:"[data-animate-media-caption]",props:{opacity:[1,0],translateY:["0%","100%"]},easing:a,delay:200,duration:300},{selector:"[data-animate-attach-media]",props:{opacity:[0,0]},duration:200},{selector:"[data-animate-attach-media]",props:{opacity:[1,0],scale:[1,.625],display:"flex"},delay:200,duration:300,easing:a}],leave:[{selector:"[data-animate-media-caption]",props:{opacity:[0,1]},easing:"ease",duration:300},{selector:"[data-animate-attach-media]",props:{opacity:[0,1],scale:[.5,1],display:"flex"},delay:0,duration:200,easing:o}]},"thumb-scale":{duration:400,easing:a,enter:{props:"transition.expandIn"},leave:{props:"transition.expandOut"}},"thumb-scale-flex":{duration:400,easing:a,enter:{props:{scale:[1,0],display:"flex"}},leave:{duration:200,props:{scale:[0,1],display:"flex"}}},default:{duration:300,enter:{props:{opacity:[1,0]}},leave:{props:{opacity:[0,1]}}},noop:{duration:0},"noop-full-opacity":{duration:0,enter:{props:{opacity:[1,1]}},leave:{props:{opacity:[1,1]}}},pip:{enter:{props:{opacity:[1,0]},duration:400},leave:{props:{scaleX:[.5,1],scaleY:[.5,1],opacity:[0,1]},duration:200,easing:s}},voip:{enter:{props:{opacity:[1,0]},duration:400},leave:{props:{scaleX:[.5,1],scaleY:[.5,1],opacity:[0,1]},duration:200,easing:s}},"replace-fade":{enter:[{props:{opacity:[0,0]},duration:400},{props:{opacity:[1,0]},duration:400,delay:400}],leave:{props:{opacity:[0,1]},duration:400}}};t.default=l},28298:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.uiPadding=t.uiMargin=void 0;r(n(56720));const i={horizMinus6:{marginEnd:"n3fdhnkw",marginStart:"heai6z19"},startMinus6:{marginStart:"heai6z19"},endMinus6:{marginEnd:"n3fdhnkw"},horizMinus4:{marginEnd:"isg5rw3j",marginStart:"nxn8agaf"},startMinus4:{marginStart:"nxn8agaf"},endMinus4:{marginEnd:"isg5rw3j"},topMinus3:{marginTop:"if44n927"},topMinus1:{marginTop:"o9i7y497"},all0:{marginTop:"tt8xd2xn",marginEnd:"jnwc1y2a",marginBottom:"mpdn4nr2",marginStart:"svoq16ka"},horiz0:{marginEnd:"jnwc1y2a",marginStart:"svoq16ka"},vert0:{marginTop:"tt8xd2xn",marginBottom:"mpdn4nr2"},top0:{marginTop:"tt8xd2xn"},bottom0:{marginBottom:"mpdn4nr2"},end0:{marginEnd:"jnwc1y2a"},start0:{marginStart:"svoq16ka"},top1:{marginTop:"b9l0eqez"},all2:{marginTop:"kiiy14zj",marginEnd:"om6y7gxh",marginBottom:"j4enbv94",marginStart:"gj5xqxfh"},horiz2:{marginEnd:"om6y7gxh",marginStart:"gj5xqxfh"},vert2:{marginTop:"kiiy14zj",marginBottom:"j4enbv94"},top2:{marginTop:"kiiy14zj"},bottom2:{marginBottom:"j4enbv94"},end2:{marginEnd:"om6y7gxh"},start2:{marginStart:"gj5xqxfh"},all3:{marginTop:"g1eqewly",marginEnd:"kjemk6od",marginBottom:"kzyzudjh",marginStart:"k6y3xtnu"},horiz3:{marginEnd:"kjemk6od",marginStart:"k6y3xtnu"},vert3:{marginTop:"g1eqewly",marginBottom:"kzyzudjh"},top3:{marginTop:"g1eqewly"},bottom3:{marginBottom:"kzyzudjh"},end3:{marginEnd:"kjemk6od"},start3:{marginStart:"k6y3xtnu"},all4:{marginTop:"qt60bha0",marginEnd:"mw4yctpw",marginBottom:"inww9tbj",marginStart:"qnz2jpws"},horiz4:{marginEnd:"mw4yctpw",marginStart:"qnz2jpws"},vert4:{marginTop:"qt60bha0",marginBottom:"inww9tbj"},top4:{marginTop:"qt60bha0"},bottom4:{marginBottom:"inww9tbj"},end4:{marginEnd:"mw4yctpw"},start4:{marginStart:"qnz2jpws"},all5:{marginTop:"hymafltn",marginEnd:"q471nw87",marginBottom:"g105fvfm",marginStart:"p3lsiedt"},horiz5:{marginEnd:"q471nw87",marginStart:"p3lsiedt"},vert5:{marginTop:"hymafltn",marginBottom:"g105fvfm"},top5:{marginTop:"hymafltn"},bottom5:{marginBottom:"g105fvfm"},end5:{marginEnd:"q471nw87"},start5:{marginStart:"p3lsiedt"},all6:{marginTop:"iin4x6c7",marginEnd:"claouzo6",marginBottom:"ngycyvoj",marginStart:"oz0g9ue8"},horiz6:{marginEnd:"claouzo6",marginStart:"oz0g9ue8"},vert6:{marginTop:"iin4x6c7",marginBottom:"ngycyvoj"},top6:{marginTop:"iin4x6c7"},bottom6:{marginBottom:"ngycyvoj"},end6:{marginEnd:"claouzo6"},start6:{marginStart:"oz0g9ue8"},all8:{marginTop:"dj1c3cmq",marginEnd:"bugiwsl0",marginBottom:"or9x5nie",marginStart:"fooq7fky"},horiz8:{marginEnd:"bugiwsl0",marginStart:"fooq7fky"},vert8:{marginTop:"dj1c3cmq",marginBottom:"or9x5nie"},top8:{marginTop:"dj1c3cmq"},bottom8:{marginBottom:"or9x5nie"},end8:{marginEnd:"bugiwsl0"},start8:{marginStart:"fooq7fky"},all10:{marginTop:"opp68qpq",marginEnd:"spjzgwxb",marginBottom:"brac1wpa",marginStart:"a3oefunm"},horiz10:{marginEnd:"spjzgwxb",marginStart:"a3oefunm"},vert10:{marginTop:"opp68qpq",marginBottom:"brac1wpa"},top10:{marginTop:"opp68qpq"},bottom10:{marginBottom:"brac1wpa"},end10:{marginEnd:"spjzgwxb"},start10:{marginStart:"a3oefunm"},all12:{marginTop:"iy2cu22y",marginEnd:"oz083wsx",marginBottom:"t4zgqcuo",marginStart:"g9zvcdbd"},horiz12:{marginEnd:"oz083wsx",marginStart:"g9zvcdbd"},vert12:{marginTop:"iy2cu22y",marginBottom:"t4zgqcuo"},top12:{marginTop:"iy2cu22y"},bottom12:{marginBottom:"t4zgqcuo"},end12:{marginEnd:"oz083wsx"},start12:{marginStart:"g9zvcdbd"},bottom14:{marginBottom:"k0lnf8n4"},all15:{marginTop:"eg3lofc5",marginEnd:"ds60debm",marginBottom:"pz0xruzv",marginStart:"htq1q0kf"},horiz15:{marginEnd:"ds60debm",marginStart:"htq1q0kf"},vert15:{marginTop:"eg3lofc5",marginBottom:"pz0xruzv"},top15:{marginTop:"eg3lofc5"},bottom15:{marginBottom:"pz0xruzv"},end15:{marginEnd:"ds60debm"},start15:{marginStart:"htq1q0kf"},top16:{marginTop:"fgtikrv0"},all20:{marginTop:"c46o30wg",marginEnd:"rvlagp7p",marginBottom:"du8bjn1j",marginStart:"bv1sdm6y"},horiz20:{marginEnd:"rvlagp7p",marginStart:"bv1sdm6y"},vert20:{marginTop:"c46o30wg",marginBottom:"du8bjn1j"},top20:{marginTop:"c46o30wg"},bottom20:{marginBottom:"du8bjn1j"},end20:{marginEnd:"rvlagp7p"},start20:{marginStart:"bv1sdm6y"},vert28:{marginTop:"ignnouf6",marginBottom:"bibl1e27"},top28:{marginTop:"ignnouf6"},bottom28:{marginBottom:"bibl1e27"},all30:{marginTop:"nylzjxre",marginEnd:"lfum0007",marginBottom:"bvhm1occ",marginStart:"r6x3u63k"},horiz30:{marginEnd:"lfum0007",marginStart:"r6x3u63k"},vert30:{marginTop:"nylzjxre",marginBottom:"bvhm1occ"},top30:{marginTop:"nylzjxre"},bottom30:{marginBottom:"bvhm1occ"},end30:{marginEnd:"lfum0007"},start30:{marginStart:"r6x3u63k"}},a={horizMinus6:i.horizMinus6,startMinus6:i.startMinus6,endMinus6:i.endMinus6,horizMinus4:i.horizMinus4,startMinus4:i.startMinus4,endMinus4:i.endMinus4,topMinus3:i.topMinus3,topMinus1:i.topMinus1,all0:i.all0,horiz0:i.horiz0,vert0:i.vert0,top0:i.top0,bottom0:i.bottom0,end0:i.end0,start0:i.start0,top1:i.top1,all2:i.all2,horiz2:i.horiz2,vert2:i.vert2,top2:i.top2,bottom2:i.bottom2,end2:i.end2,start2:i.start2,all3:i.all3,horiz3:i.horiz3,vert3:i.vert3,top3:i.top3,bottom3:i.bottom3,end3:i.end3,start3:i.start3,all4:i.all4,horiz4:i.horiz4,vert4:i.vert4,top4:i.top4,bottom4:i.bottom4,end4:i.end4,start4:i.start4,all5:i.all5,horiz5:i.horiz5,vert5:i.vert5,top5:i.top5,bottom5:i.bottom5,end5:i.end5,start5:i.start5,all6:i.all6,horiz6:i.horiz6,vert6:i.vert6,top6:i.top6,bottom6:i.bottom6,end6:i.end6,start6:i.start6,all8:i.all8,horiz8:i.horiz8,vert8:i.vert8,top8:i.top8,bottom8:i.bottom8,end8:i.end8,start8:i.start8,all10:i.all10,horiz10:i.horiz10,vert10:i.vert10,top10:i.top10,bottom10:i.bottom10,end10:i.end10,start10:i.start10,all12:i.all12,horiz12:i.horiz12,vert12:i.vert12,top12:i.top12,bottom12:i.bottom12,end12:i.end12,start12:i.start12,bottom14:i.bottom14,all15:i.all15,horiz15:i.horiz15,vert15:i.vert15,top15:i.top15,bottom15:i.bottom15,end15:i.end15,start15:i.start15,top16:i.top16,all20:i.all20,horiz20:i.horiz20,vert20:i.vert20,top20:i.top20,bottom20:i.bottom20,end20:i.end20,start20:i.start20,vert28:i.vert28,top28:i.top28,bottom28:i.bottom28,all30:i.all30,horiz30:i.horiz30,vert30:i.vert30,top30:i.top30,bottom30:i.bottom30,end30:i.end30,start30:i.start30};t.uiMargin=a;const o={all0:{paddingTop:"i5tg98hk",paddingEnd:"f9ovudaz",paddingBottom:"przvwfww",paddingStart:"gx1rr48f"},horiz0:{paddingEnd:"f9ovudaz",paddingStart:"gx1rr48f"},vert0:{paddingTop:"i5tg98hk",paddingBottom:"przvwfww"},top0:{paddingTop:"i5tg98hk"},bottom0:{paddingBottom:"przvwfww"},end0:{paddingEnd:"f9ovudaz"},start0:{paddingStart:"gx1rr48f"},top1:{paddingTop:"qbqilfqo"},all2:{paddingTop:"ppypbuwx",paddingEnd:"fhfm09ip",paddingBottom:"s8gyl5p1",paddingStart:"mjn2akup"},horiz2:{paddingEnd:"fhfm09ip",paddingStart:"mjn2akup"},vert2:{paddingTop:"ppypbuwx",paddingBottom:"s8gyl5p1"},top2:{paddingTop:"ppypbuwx"},bottom2:{paddingBottom:"s8gyl5p1"},end2:{paddingEnd:"fhfm09ip"},start2:{paddingStart:"mjn2akup"},all3:{paddingTop:"ocd2b0bc",paddingEnd:"folpon7g",paddingBottom:"aa0kojfi",paddingStart:"snweb893"},horiz3:{paddingEnd:"folpon7g",paddingStart:"snweb893"},vert3:{paddingTop:"ocd2b0bc",paddingBottom:"aa0kojfi"},top3:{paddingTop:"ocd2b0bc"},bottom3:{paddingBottom:"aa0kojfi"},end3:{paddingEnd:"folpon7g"},start3:{paddingStart:"snweb893"},all4:{paddingTop:"eujn52yf",paddingEnd:"jfqm35v0",paddingBottom:"ckm995li",paddingStart:"bdbt56hn"},horiz4:{paddingEnd:"jfqm35v0",paddingStart:"bdbt56hn"},vert4:{paddingTop:"eujn52yf",paddingBottom:"ckm995li"},top4:{paddingTop:"eujn52yf"},bottom4:{paddingBottom:"ckm995li"},end4:{paddingEnd:"jfqm35v0"},start4:{paddingStart:"bdbt56hn"},all5:{paddingTop:"qomlamqu",paddingEnd:"lnjlmjd6",paddingBottom:"bxcbqipq",paddingStart:"mc6o24uu"},horiz5:{paddingEnd:"lnjlmjd6",paddingStart:"mc6o24uu"},vert5:{paddingTop:"qomlamqu",paddingBottom:"bxcbqipq"},top5:{paddingTop:"qomlamqu"},bottom5:{paddingBottom:"bxcbqipq"},end5:{paddingEnd:"lnjlmjd6"},start5:{paddingStart:"mc6o24uu"},all6:{paddingTop:"n1yiu2zv",paddingEnd:"abxuf49s",paddingBottom:"eb4rp10x",paddingStart:"mhcwslh8"},horiz6:{paddingEnd:"abxuf49s",paddingStart:"mhcwslh8"},vert6:{paddingTop:"n1yiu2zv",paddingBottom:"eb4rp10x"},top6:{paddingTop:"n1yiu2zv"},bottom6:{paddingBottom:"eb4rp10x"},end6:{paddingEnd:"abxuf49s"},start6:{paddingStart:"mhcwslh8"},top7:{paddingTop:"esbfogcw"},all8:{paddingTop:"fbgy3m38",paddingEnd:"ft2m32mm",paddingBottom:"oq31bsqd",paddingStart:"nu34rnf1"},horiz8:{paddingEnd:"ft2m32mm",paddingStart:"nu34rnf1"},vert8:{paddingTop:"fbgy3m38",paddingBottom:"oq31bsqd"},top8:{paddingTop:"fbgy3m38"},bottom8:{paddingBottom:"oq31bsqd"},end8:{paddingEnd:"ft2m32mm"},start8:{paddingStart:"nu34rnf1"},all9:{paddingTop:"qlb265nb",paddingEnd:"i8go5xc4",paddingBottom:"n0ziumnz",paddingStart:"e1yunedv"},horiz9:{paddingEnd:"i8go5xc4",paddingStart:"e1yunedv"},vert9:{paddingTop:"qlb265nb",paddingBottom:"n0ziumnz"},top9:{paddingTop:"qlb265nb"},bottom9:{paddingBottom:"n0ziumnz"},end9:{paddingEnd:"i8go5xc4"},start9:{paddingStart:"e1yunedv"},all10:{paddingTop:"emrlamx0",paddingEnd:"itegkywt",paddingBottom:"aiput80m",paddingStart:"rppts313"},horiz10:{paddingEnd:"itegkywt",paddingStart:"rppts313"},vert10:{paddingTop:"emrlamx0",paddingBottom:"aiput80m"},top10:{paddingTop:"emrlamx0"},bottom10:{paddingBottom:"aiput80m"},end10:{paddingEnd:"itegkywt"},start10:{paddingStart:"rppts313"},all12:{paddingTop:"b7n2qyd4",paddingEnd:"btzf6ewn",paddingBottom:"ekpn4oxx",paddingStart:"nqtxkp62"},horiz12:{paddingEnd:"btzf6ewn",paddingStart:"nqtxkp62"},vert12:{paddingTop:"b7n2qyd4",paddingBottom:"ekpn4oxx"},top12:{paddingTop:"b7n2qyd4"},bottom12:{paddingBottom:"ekpn4oxx"},end12:{paddingEnd:"btzf6ewn"},start12:{paddingStart:"nqtxkp62"},horiz13:{paddingEnd:"pbp0z3j0",paddingStart:"rn41jex5"},start13:{paddingStart:"rn41jex5"},end13:{paddingEnd:"pbp0z3j0"},bottom14:{paddingBottom:"p9a4hubg"},all15:{paddingTop:"pxvlsfnc",paddingEnd:"kyc7k6mt",paddingBottom:"n3bptxsn",paddingStart:"f78eapp6"},horiz15:{paddingEnd:"kyc7k6mt",paddingStart:"f78eapp6"},vert15:{paddingTop:"pxvlsfnc",paddingBottom:"n3bptxsn"},top15:{paddingTop:"pxvlsfnc"},bottom15:{paddingBottom:"n3bptxsn"},end15:{paddingEnd:"kyc7k6mt"},start15:{paddingStart:"f78eapp6"},all16:{paddingTop:"tvsr5v2h",paddingEnd:"l9g3jx6n",paddingBottom:"jd93c9cp",paddingStart:"lyvj5e2u"},horiz16:{paddingEnd:"l9g3jx6n",paddingStart:"lyvj5e2u"},start16:{paddingStart:"lyvj5e2u"},end16:{paddingEnd:"l9g3jx6n"},all18:{paddingTop:"a71rq12o",paddingEnd:"tcyu26xv",paddingBottom:"pcbmd69e",paddingStart:"i8b31kl9"},horiz18:{paddingEnd:"tcyu26xv",paddingStart:"i8b31kl9"},top18:{paddingTop:"a71rq12o"},all20:{paddingTop:"nlnf8xo7",paddingEnd:"iffbo4e8",paddingBottom:"r219jyu0",paddingStart:"khscay3k"},horiz20:{paddingEnd:"iffbo4e8",paddingStart:"khscay3k"},vert20:{paddingTop:"nlnf8xo7",paddingBottom:"r219jyu0"},top20:{paddingTop:"nlnf8xo7"},bottom20:{paddingBottom:"r219jyu0"},end20:{paddingEnd:"iffbo4e8"},start20:{paddingStart:"khscay3k"},all24:{paddingTop:"a4bywxmn",paddingEnd:"h1a80dm5",paddingBottom:"lzi2pvmc",paddingStart:"sta02ykp"},horiz24:{paddingEnd:"h1a80dm5",paddingStart:"sta02ykp"},vert24:{paddingTop:"a4bywxmn",paddingBottom:"lzi2pvmc"},top24:{paddingTop:"a4bywxmn"},bottom24:{paddingBottom:"lzi2pvmc"},end24:{paddingEnd:"h1a80dm5"},start24:{paddingStart:"sta02ykp"},all30:{paddingTop:"msavwer2",paddingEnd:"bcymb0na",paddingBottom:"slgfab0f",paddingStart:"e8k79tju"},horiz30:{paddingEnd:"bcymb0na",paddingStart:"e8k79tju"},vert30:{paddingTop:"msavwer2",paddingBottom:"slgfab0f"},top30:{paddingTop:"msavwer2"},bottom30:{paddingBottom:"slgfab0f"},end30:{paddingEnd:"bcymb0na"},start30:{paddingStart:"e8k79tju"},horiz36:{paddingEnd:"lk91ofgv",paddingStart:"s9xya5d7"},start36:{paddingStart:"s9xya5d7"},end36:{paddingEnd:"lk91ofgv"}},s={all0:o.all0,horiz0:o.horiz0,vert0:o.vert0,top0:o.top0,bottom0:o.bottom0,end0:o.end0,start0:o.start0,top1:o.top1,all2:o.all2,horiz2:o.horiz2,vert2:o.vert2,top2:o.top2,bottom2:o.bottom2,end2:o.end2,start2:o.start2,all3:o.all3,horiz3:o.horiz3,vert3:o.vert3,top3:o.top3,bottom3:o.bottom3,end3:o.end3,start3:o.start3,all4:o.all4,horiz4:o.horiz4,vert4:o.vert4,top4:o.top4,bottom4:o.bottom4,end4:o.end4,start4:o.start4,all5:o.all5,horiz5:o.horiz5,vert5:o.vert5,top5:o.top5,bottom5:o.bottom5,end5:o.end5,start5:o.start5,all6:o.all6,horiz6:o.horiz6,vert6:o.vert6,top6:o.top6,bottom6:o.bottom6,end6:o.end6,start6:o.start6,top7:o.top7,all8:o.all8,horiz8:o.horiz8,vert8:o.vert8,top8:o.top8,bottom8:o.bottom8,end8:o.end8,start8:o.start8,all9:o.all9,horiz9:o.horiz9,vert9:o.vert9,top9:o.top9,bottom9:o.bottom9,end9:o.end9,start9:o.start9,all10:o.all10,horiz10:o.horiz10,vert10:o.vert10,top10:o.top10,bottom10:o.bottom10,end10:o.end10,start10:o.start10,all12:o.all12,horiz12:o.horiz12,vert12:o.vert12,top12:o.top12,bottom12:o.bottom12,end12:o.end12,start12:o.start12,horiz13:o.horiz13,start13:o.start13,end13:o.end13,bottom14:o.bottom14,all15:o.all15,horiz15:o.horiz15,vert15:o.vert15,top15:o.top15,bottom15:o.bottom15,end15:o.end15,start15:o.start15,all16:o.all16,horiz16:o.horiz16,start16:o.start16,end16:o.end16,all18:o.all18,horiz18:o.horiz18,top18:o.top18,all20:o.all20,horiz20:o.horiz20,vert20:o.vert20,top20:o.top20,bottom20:o.bottom20,end20:o.end20,start20:o.start20,all24:o.all24,horiz24:o.horiz24,vert24:o.vert24,top24:o.top24,bottom24:o.bottom24,end24:o.end24,start24:o.start24,all30:o.all30,horiz30:o.horiz30,vert30:o.vert30,top30:o.top30,bottom30:o.bottom30,end30:o.end30,start30:o.start30,horiz36:o.horiz36,start36:o.start36,end36:o.end36};t.uiPadding=s},22712:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.MainAudioChannel=void 0;var i=r(n(76521));class a extends i.default{registerMedia(e){let t=null;const n=()=>{t=this.claim(e,(()=>{e.pause()}))},r=()=>{var e;null===(e=t)||void 0===e||e()};return e.addEventListener("play",n),e.addEventListener("pause",r),()=>{var i;null===(i=t)||void 0===i||i(),e.removeEventListener("play",n),e.removeEventListener("pause",r)}}claim(e,t){const n=this._active;return null!=n&&e!==n.key&&(n.pause(),this.trigger("paused_DEPRECATED_DO_NOT_USE",n.key)),this._active={key:e,pause:t},()=>{var t;e===(null===(t=this._active)||void 0===t?void 0:t.key)&&(this._active=null)}}}const o=new a;t.MainAudioChannel=o},62831:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return u.apply(this,arguments)};var i=r(n(48926)),a=r(n(2525)),o=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=s(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(12641));function s(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(s=function(e){return e?n:t})(e)}const l="finish",c="stop",d=new Map;function u(){return(u=(0,i.default)((function*(e,t,n){if(!e)return;for(var r=arguments.length,i=new Array(r>3?r-3:0),a=3;a<r;a++)i[a-3]=arguments[a];if("string"==typeof t&&(t===l||t===c))return(0,o.default)(e,t,n,...i);p(e,(e=>{const t=d.get(e)||0;d.set(e,t+1)}));const s=t;if("object"==typeof n&&"object"==typeof s){let e;"function"==typeof n.begin&&(e=n.begin),n.begin=t=>{for(const e in s){const n=s[e];Array.isArray(n)&&(0,o.hook)(t,e,n[1])}e&&e(t)}}const u=yield(0,o.default)(e,t,n,...i);return p(u,(e=>{const t=(d.get(e)||1)-1;0===t?(d.delete(e),f(e)):d.set(e,t)})),u}))).apply(this,arguments)}function p(e,t){Array.isArray(e)?e.forEach((e=>{t(e)})):t(e)}function f(e){var t;const n=o.default.Utilities.data(e),{delayedElements:r}=o.default.State;(0,a.default)(r,((t,n)=>{"count"!==n&&(t!==e&&t||delete r[n])})),(null==n||null===(t=n.velocity)||void 0===t?void 0:t.tweensContainer)&&(n.velocity.tweensContainer.element=null),o.default.Utilities.removeData(e,["fxqueue","velocity"])}},40436:(e,t,n)=>{"use strict";var r=n(59182).default,i=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(n(81109)),o=i(n(6479)),s=i(n(57557)),l=i(n(41609)),c=n(51737),d=n(30764),u=(function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=E(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r)}(n(35232)),i(n(13643))),p=i(n(62831)),f=n(67294),h=n(73935),_=n(53175),g=n(88102),m=n(85893);const y=["selector"];function E(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(E=function(e){return e?n:t})(e)}const S="enter",v="leave",T="appear";class b extends f.Component{constructor(){super(...arguments),this._isUnmounted=!1,this._controller=null,this.setBusy=()=>{this.busyId=d.UIBusyTasks.setBusy(this.busyId),this.isBusy||(this.isBusy=!0,g.Cmd.setUiBusy(!0,"vtg"))},this.unsetBusy=()=>{null!=this.busyId&&(d.UIBusyTasks.clearBusy(this.busyId),delete this.busyId),this.isBusy&&(this.uiBusy=!1,g.Cmd.setUiBusy(!1,"vtg"))},this.componentWillAppear=e=>{this.animateIfEnabled(T,e)},this.componentWillEnter=e=>{this.animateIfEnabled(S,e)},this.componentWillLeave=e=>{this.animateIfEnabled(v,e)},this.getUnmountSignal=()=>(this._controller||(this._controller=new r,this._isUnmounted&&this._controller.abort()),this._controller.signal)}componentWillUnmount(){var e;this._isUnmounted=!0,null===(e=this._controller)||void 0===e||e.abort();const t=A(this,window.Node);(0,p.default)(t,"finish")}_getTransition(){const{transitionName:e}=this.props;if(e&&!u.default[e])throw __LOG__(4,void 0,new Error,!0)` ${e} wasn't found in VelocityTransitionGroupChild transitions.`,SEND_LOGS("transition-name"),new Error("Invalid transitionName");return e?u.default[e]:u.default.default}getTransitionNodes(e,t){let n=t;Array.isArray(n)||(n=[n]);const r={};return n.map((t=>{const{selector:n}=t,i=(0,o.default)(t,y);let s;return s=n?n in r?r[n]:r[n]=e?Array.from(e.querySelectorAll(n)):void 0:e,(0,l.default)(s)?void 0:(0,a.default)({nodes:s},i)})).filter(Boolean)}blockAction(e){e.preventDefault(),e.stopPropagation()}animateTransitions(e){let t=e;const{delay:n=0,children:r,onAnimationComplete:i}=this.props,{staggerDelay:a}=f.Children.only(r);t===T&&(t=S);const o=this._getTransition(),l=o[t];if(!o||!l)return Promise.resolve();const c=(0,s.default)(o,v,S),d=A(this,window.Node),u=this.getTransitionNodes(d,l);return t===v&&(null==d?void 0:d.setAttribute)&&d.addEventListener&&(d.setAttribute("pointerEvents","none",d),d.addEventListener("keypress",this.blockAction,!0),d.addEventListener("keydown",this.blockAction,!0)),Promise.all(u.map((e=>{const{nodes:t,props:r,easing:i,duration:o,delay:s,stagger:l,drag:d}=e;return(0,p.default)(t,r,{easing:i||c.easing||"easeInSine",duration:o||c.duration||0,delay:a||n||s||c.delay||0,queue:c.queue||!1,stagger:l||!1,drag:d||!1})}))).finally((()=>{c.cleanOnComplete&&t===S&&u.forEach((e=>{const t=e.nodes;(Array.isArray(t)?t:[t]).forEach((e=>e.removeAttribute("style")))})),t===v&&(null==d?void 0:d.removeEventListener)&&(d.removeEventListener("keypress",this.blockAction,!0),d.removeEventListener("keydown",this.blockAction,!0)),i&&i()}))}animateIfEnabled(e,t){let n=!1;switch(e){case S:n=this.props.transitionEnter;break;case v:n=this.props.transitionLeave;break;case T:n=this.props.transitionAppear}n?(this.setBusy(),this.animateTransitions(e).finally((()=>{this.unsetBusy()})).then((()=>{this.getUnmountSignal().aborted||(0,c.isFunction)(t)&&t()}))):t()}rejectOnUnmount(){return this._rejectPromise||(this._rejectPromise=new Promise(((e,t)=>{this._rejector=t})),this._rejectPromise.catch((()=>{}))),this._rejectPromise}render(){return f.Children.only(this.props.children)}}b.defaultProps={transitionAppear:!1,transitionEnter:!0,transitionLeave:!0},b.displayName="VelocityTransitionGroupChild";class C extends f.Component{constructor(){super(...arguments),this._wrapChild=e=>(0,m.jsx)(b,(0,a.default)((0,a.default)({},this.props),{},{children:e}))}render(){return(0,m.jsx)(_.TransitionGroup,{childFactory:this._wrapChild,className:this.props.className,transitionName:this.props.transitionName,component:this.props.component,children:this.props.children})}}function A(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window.HTMLElement;const n=(0,h.findDOMNode)(e);if(n){if(n instanceof t)return n;throw new Error(`[forbiddenFindDOMNode] returned node not instance of ${String(t)}`)}return n}t.default=C,C.defaultProps={transitionAppear:!1,transitionEnter:!0,transitionLeave:!0},C.displayName="VelocityTransitionGroup"},89345:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(76521));class a extends i.default{constructor(){super(...arguments),this.openVoipWindow=()=>{this.manager&&this.manager.openVoipWindow()},this.closeVoipWindow=()=>{this.manager&&this.manager.closeVoipWindow()}}register(e){this.manager=e}unregister(){this.manager&&this.manager.closeVoipWindow(),this.manager=null}}var o=new a;t.default=o},80666:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.MediaEditorAction=t.AttachMedia=t.ATTACH_MEDIA_STATE=void 0;var i=r(n(48926)),a=n(50796),o=n(65885),s=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=g(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(35232)),l=n(15461),c=n(29984),d=n(11290),u=r(n(65273)),p=n(78986),f=r(n(50170)),h=r(n(34949)),_=(n(13705),n(90669));function g(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(g=function(e){return e?n:t})(e)}const m=n(76672).Mirrored(["Outline","OutlineDone","CropRotateCanvas"]);t.MediaEditorAction=m;const y={READY:"ready",PROCESSING:"processing",ERROR:"error"};t.ATTACH_MEDIA_STATE=y;class E extends d.BaseModel{constructor(){super(...arguments),this.id=(0,d.prop)(),this.file=(0,d.prop)(),this.uiProcessed=(0,d.prop)(!1),this.fileOrigin=(0,d.prop)(),this.isVcardOverMmsDocument=(0,d.prop)(!1),this.stickerMaker=(0,d.prop)(!1),this.state=(0,d.session)(),this.mediaPrep=(0,d.session)(),this.mimetype=(0,d.session)(),this.originalMimetype=(0,d.session)(),this.processPromise=(0,d.session)(),this.exception=(0,d.session)(),this.caption=(0,d.session)(),this.type=(0,d.session)(l.MSG_TYPE.UNKNOWN),this.mediaEditorData=(0,d.session)(),this.lastMediaEditorAction=(0,d.session)(),this.editedFile=(0,d.session)(),this._mediaEditorUndoStack=(0,d.session)((()=>[])),this._mediaEditorRedoStack=(0,d.session)((()=>[])),this.preview=(0,d.session)(),this.fullPreview=(0,d.session)(),this.fullPreviewSize=(0,d.session)(),this.filename=(0,d.session)(),this.documentPageCount=(0,d.session)(),this.isGif=(0,d.session)(),this.gifAttribution=(0,d.session)(),this.previewable=(0,d.derived)((function(){if(!this.type||!this.mimetype||!this.fullPreview)return!1;switch(this.type){case l.MSG_TYPE.DOCUMENT:return!!this.filename;case l.MSG_TYPE.IMAGE:case l.MSG_TYPE.VIDEO:return!(!this.fullPreviewSize||!this.preview);case l.MSG_TYPE.AUDIO:case l.MSG_TYPE.STICKER:case l.MSG_TYPE.PTT:case l.MSG_TYPE.UNKNOWN:return!0;default:throw new Error(`Unsupported attach media type ${this.type}`)}}),["preview","fullPreview","type","filename","fullPreviewSize","mimetype"]),this.filesize=(0,d.derived)((function(){return this.file instanceof h.default?this.file.size():this.file instanceof Blob?this.file.size:null}),["file"]),this.fileExt=(0,d.derived)((function(){return this.filename?(0,o.getFileExtension)(this.filename):null}),["filename"])}initialize(){if(super.initialize(),!(this.file instanceof Promise))throw new Error("cannot process non-promise file");this.processAttachment(this.file)}processAttachment(e){this.state=y.PROCESSING,this.mediaEditorData=u.default.create(),this.processPromise=this._processAttachmentPromiseHelper(e).then((()=>{const e=new Image;e.src=this.fullPreview,e.onload=()=>{const t={};this.stickerMaker&&(t.fitToSquare=!0,t.scale=1-2*_.STICKER_MAKER_IMAGE_PADDING/_.STICKER_DIMENSION),this.mediaEditorData=this.mediaEditorData.setBackground(e,t)}}))}_processAttachmentPromiseHelper(e){var t=this;return e.then(function(){var e=(0,i.default)((function*(e){t.set(e);const n={},{file:r,filename:i,isGif:a,asSticker:s,stickerMaker:d,gifAttribution:u,isVcardOverMmsDocument:f,documentPageCount:g}=e;!0===a?(n.asGif=!0,n.gifAttribution=u):e.type===o.FILETYPE.DOCUMENT&&(n.asDocument=!0,n.filename=i,n.isVcardOverMmsDocument=f,n.documentPageCount=g),n.asSticker=s,!0===d&&(n.minDimension=_.STICKER_DIMENSION,n.transparency=!0),n.precomputedFields={fullHeight:e.fullPreviewSize?e.fullPreviewSize.height:void 0,fullWidth:e.fullPreviewSize?e.fullPreviewSize.width:void 0,preview:e.preview,duration:e.duration};const m=h.default.createFromData(r,r.type),E=(0,p.prepRawMedia)(m,n);t.set({mediaPrep:E});const S=yield E.waitForPrep(),v=S.documentPreview,T=S.mediaBlob instanceof h.default?window.URL.createObjectURL(S.mediaBlob.forceToBlob()):window.URL.createObjectURL(S.mediaBlob),b={file:S.mediaBlob,fullPreview:T,type:S.type,filename:S.filename,mimetype:S.mimetype,originalMimetype:e.mimetype,preview:S.preview,state:y.READY,isGif:S.isGif,fullPreviewSize:void 0,documentPageCount:g,isVcardOverMmsDocument:S.isVcardOverMmsDocument,editedFile:S.mediaBlob};(0,c.isNonZeroNumber)(S.fullWidth)&&(0,c.isNonZeroNumber)(S.fullHeight)&&(b.fullPreviewSize={height:S.fullHeight,width:S.fullWidth}),S.type===l.MSG_TYPE.IMAGE&&(b.preview=T),S.type===l.MSG_TYPE.DOCUMENT&&v&&(b.fullPreview=v.url,b.preview=v.thumbUrl,b.fullPreviewSize={height:v.height,width:v.width},b.documentPageCount=v.pdfPages),t.set(b),t.previewable||(__LOG__(4,void 0,new Error,!0)`Invariant violated, processed file is not previewable`,SEND_LOGS("AttachMedia processFile"))}));return function(){return e.apply(this,arguments)}}()).catch((0,a.filteredCatch)([s.InvalidMediaFileType,s.InvalidImageFileType],(t=>{if(this.isGif||this.type===o.FILETYPE.DOCUMENT)throw t;return this._processAttachmentPromiseHelper(e.then((e=>(e.type=o.FILETYPE.DOCUMENT,e))))}))).catch((0,a.filteredCatch)([f.default,s.MediaFileFailedLoad,s.MediaFileEmpty],(e=>(this.set({exception:e,state:y.ERROR}),this)))).catch((()=>(__LOG__(3)`AttachMedia:processFile convert unexpected error to InvalidMediaFileType:`,this.set({exception:new s.InvalidMediaFileType,state:y.ERROR}),this)))}sendToChat(e,t){if(!this.mediaPrep)return Promise.reject(new Error("MediaPrep not available"));if(this.state===y.ERROR)return Promise.reject(new Error(this.exception));if(!(this.state!==y.PROCESSING||this.previewable&&t.addEvenWhilePreparing))return Promise.reject(new Error("Media still processing"));if(this.state===y.READY)return this.mediaPrep.sendToChat(e,t);const n={mimetype:this.mimetype};switch(this.type){case l.MSG_TYPE.VIDEO:n.isGif=this.isGif,n.gifAttribution=this.gifAttribution;case l.MSG_TYPE.IMAGE:n.width=this.fullPreviewSize.width,n.height=this.fullPreviewSize.height,n.body=this.preview,t.placeholderProps=n;break;case l.MSG_TYPE.DOCUMENT:n.pageCount=this.documentPageCount,n.filename=this.filename,n.body=this.preview,t.placeholderProps=n;break;case l.MSG_TYPE.AUDIO:case l.MSG_TYPE.PTT:}return this.mediaPrep.sendToChat(e,t)}getFileType(){if(!(this.file instanceof Blob||this.file instanceof File))throw new Error("expected file to be a Blob or File");return(0,o.typeFromMimetype)(this.file.type)}isViewableOnce(){return new Set([l.MSG_TYPE.IMAGE,l.MSG_TYPE.VIDEO]).has(this.type)&&!this.isGif}isSendableAsSticker(){return this.type===l.MSG_TYPE.IMAGE}delete(){this.fullPreview&&window.URL.revokeObjectURL(this.fullPreview),super.delete()}updateMediaEditorData(e,t){return this.mediaEditorData===e||(t.undoable&&(this._mediaEditorUndoStack.push([this.mediaEditorData,this.lastMediaEditorAction]),this.lastMediaEditorAction=t.lastAction,this._mediaEditorRedoStack=[]),this.mediaEditorData=e),this.mediaEditorData}undoMediaEditorData(){if(this.canUndoMediaEditorData()){this._mediaEditorRedoStack.push([this.mediaEditorData,this.lastMediaEditorAction]);const[e,t]=this._mediaEditorUndoStack.pop();this.mediaEditorData=e,this.lastMediaEditorAction=t}}redoMediaEditorData(){if(this.canRedoMediaEditorData()){this._mediaEditorUndoStack.push([this.mediaEditorData,this.lastMediaEditorAction]);const[e,t]=this._mediaEditorRedoStack.pop();this.mediaEditorData=e,this.lastMediaEditorAction=t}}canUndoMediaEditorData(){return this._mediaEditorUndoStack.length>0}canRedoMediaEditorData(){return this._mediaEditorRedoStack.length>0}updateEditedFile(e){this.editedFile=e}updatePreview(e){window.URL.revokeObjectURL(this.preview),this.preview=e}updateFullPreview(e){window.URL.revokeObjectURL(this.fullPreview),this.fullPreview=e}updateCaption(e){this.caption=e}}E.Proxy="attachMedia";const S=(0,d.defineModel)(E);t.AttachMedia=S},14075:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(48926)),a=r(n(64369)),o=n(65885),s=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=g(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(35232)),l=n(48360),c=n(80666),d=n(1255),u=r(n(14296)),p=n(90535),f=r(n(50170)),h=n(64551),_=r(n(88406));function g(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(g=function(e){return e?n:t})(e)}const{IMAGE:m,VIDEO:y,DOCUMENT:E,AUDIO:S}=o.FILETYPE,{READY:v,ERROR:T,PROCESSING:b}=c.ATTACH_MEDIA_STATE;let C=1;class A extends d.BaseCollection{constructor(e){let{chatParticipantCount:t}=e;super(),this.errorMsgs=null,this.ignored=0,this.mediaPickerStatsLogger=new p.MediaPickerStatsLogger,this.selection=new _.default([],(e=>e.id),"prev"),this.isStickerMaker=!1,this.mediaPickerStatsLogger.chatRecipients=t,this.listenTo(this.selection,"all",this._handleSelectionEvents.bind(this))}_handleSelectionEvents(e,t){"focus"!==t&&!1!==t||this.trigger("active-change")}removeSingleton(e,t){var n;e&&(t||this.mediaPickerStatsLogger.logDelete(e.id),e.url&&window.URL.revokeObjectURL(e.url),(null===(n=e.original)||void 0===n?void 0:n.url)&&window.URL.revokeObjectURL(e.original.url))}remove(e,t){const n=super.remove(e,t);return n.forEach((e=>this.removeSingleton(e,t))),this.selection.init(this.getPreviewableMedias(),!0),n}delete(){super.delete(),this.forEach((e=>this.removeSingleton(e))),this.selection.init(this.getPreviewableMedias(),!0)}reorder(e,t){return this.reorderMutate(e,t),this.selection.init(this.getPreviewableMedias(),!0),this.getPreviewableMedias()}replace(e,t){const n=this.get(e);if(!n)return;const r=this.indexOf(n),i=n.caption;this.remove(n,{silent:!0}),n.delete();const a=new c.AttachMedia({id:e,caption:i,file:this._normalizeAttachment(t)});return this.add(a,r?{at:r}:{}),a.processPromise}getValidMedias(){return this.filter((e=>e.state===v||e.state===b))}getPreviewableMedias(){return this.filter((e=>e.previewable))}getActive(){return this.selection.getVal()}setActive(e){this.selection.setVal(e)}unsetActive(){this.selection.unset()}setNextAsActive(){const e=this.selection.list.length-1;return-1===this.selection.index||this.selection.index===e||this.selection.setNext(),this.selection.getVal()}setPrevAsActive(){return-1===this.selection.index||0===this.selection.index||this.selection.setPrev(),this.selection.getVal()}processAttachments(e,t){var n=this;return(0,i.default)((function*(){const r=n.getPreviewableMedias().length,i=e.length+r>a.default.MAX_FILES?Math.max(a.default.MAX_FILES-r,0):e.length,o=e.length-i;0===i?o&&n.trigger("max_upload_limit",o):n.ignore(o);const s=e.slice(0,i).map((e=>new c.AttachMedia({id:C++,file:n._normalizeAttachment(e),fileOrigin:t})));n.add(s);const l=n.getActive();return n.unsetActive(),Promise.all(e).then((()=>{n._attemptToSetNextActiveFromAdded(s,l)})),yield Promise.all(s.map((e=>e.processPromise))),s.forEach((e=>n._logMediaAdd(e,t))),n._attemptToSetNextActiveFromAdded(s,l)}))()}_attemptToSetNextActiveFromAdded(e,t){if(this.getActive())return;if(this.getModelsArray().some((e=>e.state===b&&!e.previewable)))return;let n=e.find((e=>e.previewable));n||(n=t),this.selection.init(this.getPreviewableMedias()),n&&this.setActive(n)}_logMediaAdd(e,t){if(null==t)return;const n=e.isGif?"gif":e.type;this.mediaPickerStatsLogger.logAdd(e.id,n,t)}_normalizeAttachment(e){return(0,i.default)((function*(){const t=yield Promise.resolve(e);return t.filename||(t.filename=t.file.name),t.mimetype||(t.mimetype=t.file.type),t.type||(t.type=(0,o.typeFromMimetype)(t.file.type)),!t.type&&t.mimetype&&(t.type=(0,o.typeFromMimetype)(t.mimetype)),t}))()}ignore(e){e>0&&(this.ignored+=e)}uiProcessMsgs(){let e,t=[],n=0,r=0,i=0,o=0,c=0,d=0,p=0,_=0,g=0,v=0,C=0,A=!1;const P=u.default.filesize(h.ServerProps.media),M=u.default.filesize((0,h.getMaxFilesSizeServerProp)()),O=u.default.filesize(1024*h.ServerProps.vcardMaxSizeKb);if(this.forEach((t=>{if(!t.uiProcessed&&(!e&&t.previewable&&(e=t),t.state!==b&&(t.uiProcessed=!0,t.state===T)))if(t.exception instanceof f.default)switch(t.getFileType()){case m:n+=1;break;case y:r+=1;break;case S:i+=1;break;case E:t.isVcardOverMmsDocument?c+=t.documentPageCount:o+=1}else if(t.exception instanceof s.MediaFileEmpty)switch(t.getFileType()){case m:d+=1;break;case y:p+=1;break;case S:_+=1;break;case E:t.isVcardOverMmsDocument?v+=t.documentPageCount:g+=1}else t.exception instanceof s.MediaFileFailedLoad?A=!0:C+=1})),n>0&&t.push(u.default.t(525,{number:n,_plural:n,maxSize:P})),r>0&&t.push(u.default.t(809,{number:r,_plural:r,maxSize:P})),i>0&&t.push(u.default.t(150,{number:i,_plural:i,maxSize:P})),o>0&&t.push(u.default.t(400,{number:o,_plural:o,maxSize:M})),c>0&&t.push(u.default.t(367,{_plural:c,maxSize:O})),d>0&&t.push(u.default.t(524,{number:d,_plural:d})),p>0&&t.push(u.default.t(807,{number:p,_plural:p})),_>0&&t.push(u.default.t(148,{number:_,_plural:_})),g>0&&t.push(u.default.t(399,{number:g,_plural:g})),v>0&&t.push(u.default.t(366,{number:v,_plural:v})),C>0&&t.push(u.default.t(459,{number:C,_plural:C})),A&&(t=[],t.push(l.fbt._("The item you tried adding failed to load.",null,{hk:"1MmBvO"}))),t.length>1){t=[];const e=n+r+i+o,a=d+p+_+g,s=e+a+C;0===C?(0!==e&&t.push(u.default.t(460,{number:e,_plural:e,maxSize:M})),0!==a&&t.push(u.default.t(456,{number:a,_plural:a}))):t.push(u.default.t(458,{number:s,_plural:s}))}const I=t.join(" ");this.errorMsgs=I,this.ignore(this.getPreviewableMedias().length-a.default.MAX_FILES);const w=this.ignored;return this.ignored=0,w&&this.trigger("max_upload_limit",w),C>0&&this.trigger("files_not_supported"),{errorMsgs:I}}canSend(){return!this.getModelsArray().some((e=>e.state===b&&!e.previewable))}}t.default=A,A.model=c.AttachMedia},78083:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Agent=void 0;var r=n(11290);class i extends r.BaseModel{constructor(){super(...arguments),this.id=(0,r.prop)(),this.deviceID=(0,r.prop)(),this.name=(0,r.prop)(),this.isDeleted=(0,r.prop)(!1)}getCollection(){return n(72894).AgentCollection}}i.Proxy="agent";const a=(0,r.defineModel)(i);t.Agent=a},72894:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AgentCollection=void 0;var r=n(78083),i=n(1255);class a extends i.BaseCollection{constructor(){super(),this._agentsByDeviceID=new Map,this.triggerDeviceIDMapUpdate=()=>{this._agentsByDeviceID=new Map,this.getModelsArray().forEach((e=>{this._agentsByDeviceID.set(e.deviceID,e)}))},this.on("add remove reset",this.triggerDeviceIDMapUpdate)}getByDeviceID(e){return this._agentsByDeviceID.get(e)}initializeFromCache(e){this.add(e,{merge:!0})}}a.model=r.Agent;const o=new a;t.AgentCollection=o},32742:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.BusinessCategoriesResult=t.BUSINESS_CATEGORY_EMPTY_STR_ID=void 0;var i=r(n(89867)),a=n(11290);t.BUSINESS_CATEGORY_EMPTY_STR_ID="__empty_query__";class o extends a.BaseModel{constructor(){super(...arguments),this.id=(0,a.prop)(),this.categories=(0,a.prop)(),this.notABizId=(0,a.prop)()}getCollection(){return n(3754).BusinessCategoriesResultCollection}}o.Proxy="BusinessCategoriesResult",o.idClass=i.default;const s=(0,a.defineModel)(o);t.BusinessCategoriesResult=s},3754:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.BusinessCategoriesResultCollectionImpl=t.BusinessCategoriesResultCollection=void 0;var i=r(n(48926)),a=n(1255),o=n(32742),s=n(46977);class l extends a.BaseCollection{_find(e){return(0,i.default)((function*(){const{categories:t,notABizId:n}=yield(0,s.queryBusinessCategories)(e);return new o.BusinessCategoriesResult({id:e,categories:t,notABizId:n})}))()}}t.BusinessCategoriesResultCollectionImpl=l,l.model=o.BusinessCategoriesResult,l.staleCollection=!0;const c=new l;t.BusinessCategoriesResultCollection=c},64886:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(89867)),a=n(11290);class o extends a.BaseModel{constructor(){super(...arguments),this.id=(0,a.prop)(),this.cypher=(0,a.prop)(),this.cypherExpirationTimestamp=(0,a.prop)()}}o.Proxy="business_direct_connection",o.idClass=i.default;var s=(0,a.defineModel)(o);t.default=s},15131:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(48926)),a=r(n(45095)),o=n(1255),s=r(n(64886)),l=n(884),c=n(46977),d=n(30155),u=n(36993),p=n(52542);class f extends o.BaseCollection{_getValidCertificate(e,t,n){return(0,i.default)((function*(){if(!n&&(null==t?void 0:t.certificateChain)){const e=yield(0,l.getValidCertificate)((0,p.stringToCertificateString)(t.certificateChain));if(e)return e}return(0,l.getValidCertificate)(yield(0,l.fetchCertificateFullChain)(e))}))()}_getCypherFromDborApi(e){var t=this;let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return(0,i.default)((function*(){const r=yield(0,u.fetchDirectConnectionKeys)(e.toJid());if(!n&&r&&!(0,l.isExpired)(r.cypherExpirationTimestamp))return{id:e,cypher:(0,d.stringToCypherString)(r.cypher),cypherExpirationTimestamp:r.cypherExpirationTimestamp};const[i,o]=yield Promise.all([t._getValidCertificate(e,r,n),(0,c.querySignedUserInfo)(e)]);if(null==i)return __LOG__(3)`[direct-connection] no certificate returned from the get_public_key IQ`,null;const s=(0,a.default)(yield(0,l.getCypher)(i.chain,o),"yield getCypher(validCertificate.chain, userInfo)"),f=o.phoneNumberSignatureExpiration;return yield(0,u.createOrUpdateDirectConnectionKeys)({id:e.toJid(),cypher:(0,d.cypherStringToString)(s),cypherExpirationTimestamp:f,certificateChain:(0,p.certificateStringToString)(i.string)}),{id:e,cypher:s,cypherExpirationTimestamp:f}}))()}getCypher(e){var t=this;let{forceRenew:n=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,i.default)((function*(){const r=n?null:t.get(e);return!r||(0,l.isExpired)(r.cypherExpirationTimestamp)?[].concat(yield t.update(e,{forceRenewDirectConnection:n}))[0]:r}))()}_find(e){return this._getCypherFromDborApi(e)}_update(e,t){let{forceRenewDirectConnection:n}=t;return this._getCypherFromDborApi(e,n)}}f.model=s.default;var h=new f;t.default=h},884:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.fetchCertificateFullChain=function(){return _.apply(this,arguments)},t.getCypher=function(){return h.apply(this,arguments)},t.getValidCertificate=function(){return f.apply(this,arguments)},t.isCypherNeeded=function(){return g.apply(this,arguments)},t.isExpired=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,o.default)();if(null==e)return!0;const n=(0,o.default)(e,p);return!(n.isValid()&&n.isAfter(t))},t.timestampFormat=void 0;var i=r(n(48926)),a=r(n(45095)),o=r(n(30381)),s=n(46977),l=n(69951),c=n(30155),d=n(90915),u=n(52542);const p="YYYYMMDDTHHmmssZ";function f(){return(f=(0,i.default)((function*(e){const t=yield(0,u.extractCertificates)(e),{result:n}=yield(0,u.validateCertificates)(t.slice(1,-1),t.slice(-1));return n?{string:e,chain:t}:null}))).apply(this,arguments)}function h(){return(h=(0,i.default)((function*(e,t){const n=(0,u.arrayBufferToBase64)(yield(0,u.getRandomValues)(new Uint8Array(16)));return(0,c.genCypher)(e[0],n,{phone_number:t.phoneNumber,ttl_timestamp:t.phoneNumberSignatureExpiration,phone_number_signature:t.phoneNumberSignature})}))).apply(this,arguments)}function _(){return(_=(0,i.default)((function*(e){const[{certificate:t},n]=yield Promise.all([(0,s.queryBusinessPublicKey)(e),(0,u.fetchFromCABundle)()]);if(null==t)throw new Error("[direct-connection] no certificate returned from the get_public_key IQ");const r=yield(0,u.extractCertificates)(t),i=(0,a.default)(yield(0,u.genRootIssuers)(r,n),"yield genRootIssuers(extractedCertificate, caBundle)");return(0,u.encodeToString)([...r,...i])}))).apply(this,arguments)}function g(){return(g=(0,i.default)((function*(e){var t;const r=n(93581).BusinessProfileCollection;return Boolean((0,d.supportsDirectConnection)()&&null!=l.ChatCollection.get(e)&&(null===(t=(yield r.find(e)).profileOptions)||void 0===t?void 0:t.directConnection))}))).apply(this,arguments)}t.timestampFormat=p},48018:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.MAX_BUSINESS_CATEGORIES=t.DEFAULTS=t.BusinessProfile=void 0;var i=r(n(89867)),a=n(11290);t.MAX_BUSINESS_CATEGORIES=3;class o extends a.BaseModel{constructor(){super(...arguments),this.id=(0,a.prop)(),this.tag=(0,a.prop)(),this.description=(0,a.prop)(),this.categories=(0,a.prop)(),this.profileOptions=(0,a.prop)(),this.email=(0,a.prop)(),this.website=(0,a.prop)(),this.latitude=(0,a.prop)(),this.longitude=(0,a.prop)(),this.businessHours=(0,a.prop)(),this.catalogStatus=(0,a.prop)(),this.address=(0,a.prop)(),this.structuredAddress=(0,a.prop)(),this.legalEntityDetails=(0,a.prop)(),this.fbPage=(0,a.prop)(),this.igProfessional=(0,a.prop)(),this.isProfileLinked=(0,a.prop)(),this.directConnection=(0,a.prop)(),this.stale=(0,a.session)(!0)}markStale(){this.stale=!0,this.hasObservers()&&this.getCollection().find(this.id)}getCollection(){return n(93581).BusinessProfileCollection}isValid(){return Array.isArray(this.categories)}}o.Proxy="businessProfile",o.idClass=i.default;const s=(0,a.defineModel)(o);t.BusinessProfile=s;t.DEFAULTS={description:null,email:null,website:null}},93581:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.CATALOG_EXISTS=t.BusinessProfileCollectionImpl=t.BusinessProfileCollection=void 0;var i=r(n(81109)),a=r(n(48926)),o=n(1255),s=n(48018),l=n(46977),c=n(94010),d=n(19380);t.CATALOG_EXISTS="catalog_exists";class u extends o.BaseCollection{_find(e){return this._findAndParse(e,{queryCatalog:!0})}_update(e,t){return this._findAndParse(e,{queryCatalog:!1,getMerchantCompliance:null==t?void 0:t.getMerchantCompliance})}_findAndParse(e,t){var n=this;let{queryCatalog:r,getMerchantCompliance:o}=t;return(0,a.default)((function*(){const t=n.gadd(e);if(!t.id.isUser())return __LOG__(2)`Store:BusinessProfile:find businessProfile is only available to users (${String(e)})`,Promise.resolve({id:e});const a=yield(0,l.queryBusinessProfile)([{wid:t.id,tag:t.tag}],o);if(!Array.isArray(a))return __LOG__(3)`Received invalid business profile response`,null;if(0===a.length)return __LOG__(2)`Store:BusinessProfile:find No businessProfile found for ${String(e)}`,{id:e};const s=a[0],{wid:u,tag:p}=s,f={id:u,tag:p},{profile:h}=s;if(h){const t=d.ContactCollection.get(e);return t&&!t.isContactSyncCompleted&&(t.set("isBusiness",!0),t.set("forcedBusinessUpdateFromServer",!0)),(0,i.default)((0,i.default)({},(0,c.parseBusinessProfile)({id:s.wid,profile:h,queryCatalog:r})),f)}return f}))()}fetchBizProfile(e){const t=this.get(e);return t&&t.markStale(),this.find(e)}onResume(){this.filter((e=>e.stale&&e.hasObservers())).map((e=>this.find(e.id)))}handle(e){let[t]=e;t&&null!=t.tag||__LOG__(3)`Store:BusinessProfile:handle Received invalid update from server`;const n=this.gadd(t.wid);t.tag!==n.tag&&n.markStale()}getValid(e){const t=this.get(e);if(null==t?void 0:t.isValid())return t}}t.BusinessProfileCollectionImpl=u,u.model=s.BusinessProfile,u.staleCollection=!0;const p=new u;t.BusinessProfileCollection=p},93170:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.businessTypeOptions=t.VERIFIED_LEVEL=t.DAYS_OF_WEEK=t.COMMERCE_EXPERIENCE_TYPES=t.BUSINESS_PROFILE_FIELDS_LENGTH=t.BUSINESS_HOUR_MODES=void 0;t.VERIFIED_LEVEL={UNKNOWN:0,LOW:1,HIGH:2};t.DAYS_OF_WEEK=["sun","mon","tue","wed","thu","fri","sat"];t.BUSINESS_HOUR_MODES={OPEN_24H:"open_24h",SPECIFIC_HOURS:"specific_hours",APPOINTMENT_ONLY:"appointment_only"};const r=n(76672)({CATALOG:"catalog",NONE:"none",SHOP:"shop"});t.COMMERCE_EXPERIENCE_TYPES=r;t.businessTypeOptions={limitedLiabilityPartnership:"Limited liability partnership",soleProprietorship:"Sole proprietorship",partnership:"Partnership",publicCompany:"Public Company",privateCompany:"Private Company",other:"Other"};t.BUSINESS_PROFILE_FIELDS_LENGTH={WEBSITE:256,DESCRIPTION:512,EMAIL:128,ADDRESS:256}},94010:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.CATALOG_EXISTS=t.BUSINESS_OPEN_STATUS=void 0,t.getBusinessOpenState=b,t.hasShop=t.hasCatalog=t.goToShop=t.goToCommerceManager=void 0,t.isBusinessOpen=A,t.parseBusinessProfile=t.isShopBanned=t.isCompleteBizProfile=void 0,t.quickReplyHoursStr=function(e){const t=A(e)?l.fbt._("We're currently *open*",null,{hk:"1Skaff"}):l.fbt._("We're currently *closed*",null,{hk:"18eiaZ"}),n=l.fbt._("Our business hours are:",null,{hk:"Qljt"}),r=(0,h.getBusinessHours)(e,!0).map((e=>`${(0,o.default)(e.day)}: ${e.hours}`)).join("\n");return[t,n,r].join("\n")};var i=r(n(81109)),a=r(n(6479)),o=r(n(48403)),s=r(n(79264)),l=n(48360),c=n(48018),d=n(93170),u=n(99989),p=n(19380),f=n(64551),h=n(26316);const _=["business_hours","catalog_status","structured_address","profile_options","address","legal_entity_details","fb_page","ig_professional","profile_is_linked"],g="catalog_exists";t.CATALOG_EXISTS=g;const m=e=>{var t;return(null==e||null===(t=e.profile_options)||void 0===t?void 0:t.commerce_experience)===d.COMMERCE_EXPERIENCE_TYPES.CATALOG||(null==e?void 0:e.catalog_status)===g};t.hasCatalog=e=>{var t;return e&&e instanceof c.BusinessProfile?(null===(t=e.profileOptions)||void 0===t?void 0:t.commerceExperience)===d.COMMERCE_EXPERIENCE_TYPES.CATALOG||e.catalogStatus===g:m(e)};const y=e=>{var t,n;return(null==e||null===(t=e.profileOptions)||void 0===t?void 0:t.commerceExperience)===d.COMMERCE_EXPERIENCE_TYPES.SHOP&&Boolean(null==e||null===(n=e.profileOptions)||void 0===n?void 0:n.shopURL)};t.hasShop=y;t.isShopBanned=e=>{var t,n;return(null==e||null===(t=e.profileOptions)||void 0===t?void 0:t.commerceExperience)===d.COMMERCE_EXPERIENCE_TYPES.NONE||y(e)&&!!(null==e||null===(n=e.profileOptions)||void 0===n?void 0:n.isBanned)};t.goToShop=e=>{var t;const n=null==e||null===(t=e.profileOptions)||void 0===t?void 0:t.shopURL;n&&s.default.open(n)};t.goToCommerceManager=e=>{var t;const n=null==e||null===(t=e.profileOptions)||void 0===t?void 0:t.commerceManagerURL;s.default.open(n||"https://business.facebook.com/commerce_manager/")};const E=e=>m(e)||f.ServerProps.shopsProductGrid&&(e=>{var t,n;return(null==e||null===(t=e.profile_options)||void 0===t?void 0:t.commerce_experience)===d.COMMERCE_EXPERIENCE_TYPES.SHOP&&Boolean(null==e||null===(n=e.profile_options)||void 0===n?void 0:n.shop_url)})(e),S=e=>{let{email:t,landline_number:n,mobile_number:r}=e;const i={email:t};return n&&(i.landlineNumber=n),r&&(i.mobileNumber=r),i},v=e=>{let{entity_name:t,entity_type:n,is_registered:r,entity_type_custom:i,customer_care_details:a,grievance_officer_details:o}=e;const s={entityName:t,entityType:n,isRegistered:r};return i&&(s.entityTypeCustom=i),a&&(s.customerCareDetails=(e=>{let{email:t,landline_number:n,mobile_number:r}=e;return S({email:t,landline_number:n,mobile_number:r})})(a)),o&&(s.grievanceOfficerDetails=(e=>{let{name:t,email:n,landline_number:r,mobile_number:i}=e;const a=S({email:n,landline_number:r,mobile_number:i});return a.name=t,a})(o)),s};t.parseBusinessProfile=e=>{let{profile:t,id:n,queryCatalog:r}=e;if(!t)return{id:n};const{business_hours:o,catalog_status:s,structured_address:l,profile_options:f,address:h,legal_entity_details:g,fb_page:m,ig_professional:y,profile_is_linked:S}=t,T=(0,a.default)(t,_),b={};return b.businessHours=o?(e=>{let{config:t,timezone:n}=e;const r={};return t.forEach((e=>{const{day_of_week:t,mode:n}=e;if(n===d.BUSINESS_HOUR_MODES.SPECIFIC_HOURS){const{open_time:i,close_time:a}=e;r[t]||(r[t]={mode:n,hours:[]}),null!=i&&null!=a&&r[t].hours&&r[t].hours.push([i,a])}else r[t]={mode:n}})),{config:r,timezone:n}})(o):null,f&&(b.profileOptions={},b.profileOptions.commerceExperience=f.commerce_experience,b.profileOptions.cartEnabled=f.cart_enabled,b.profileOptions.directConnection=f.direct_connection,null!=f.shop_url&&(b.profileOptions.shopURL=f.shop_url),null!=f.commerce_manager_url&&(b.profileOptions.commerceManagerURL=f.commerce_manager_url),null!=f.is_banned&&(b.profileOptions.isBanned=f.is_banned)),E(t)&&(b.catalogStatus=s,r&&u.CatalogCollection.findCarouselCatalog(n).then((e=>{const t=Array.isArray(e)?e[0]:e,r=p.ContactCollection.get(n);r&&(r.businessCatalog=t)})).catch((()=>__LOG__(3)`Store:BusinessProfile:missing catalog`))),l?b.structuredAddress={streetAddress:l.street_address,cityId:l.city_id,localizedCityName:l.localized_city_name,zipCode:l.zip_code}:b.address=h||null,g&&(b.legalEntityDetails=v(g)),m&&(b.fbPage={displayName:m.display_name,likes:m.likes,id:m.id}),y&&(b.igProfessional={handle:y.ig_handle,followers:y.followers}),null!=S&&(b.isProfileLinked=!!S),(0,i.default)((0,i.default)((0,i.default)((0,i.default)({},c.DEFAULTS),T),b),{},{id:n})};t.isCompleteBizProfile=e=>{var t,n;return null!=e.address&&null!=e.description&&null!=(null===(t=e.businessHours)||void 0===t?void 0:t.config)&&0!==Object.keys(e.businessHours.config).length&&null!=e.email&&0!==(null===(n=e.website)||void 0===n?void 0:n.length)};const T={OPEN:"open",CLOSED:"closed",OPEN_TODAY:"open_today",CLOSED_TODAY:"closed_today",OPEN_APPOINTMENT:"open_appointment",OPEN_24H:"open_24h",UNKNOWN:"unknown"};function b(e,t){var n,r;if(null==e.timezone)return{status:"unknown"};const i=t||new Date,a=new Date(i.toLocaleString("en-US",{timeZone:e.timezone})),o=(i.getTime()-a.getTime())/1e3/60,s=e.config[d.DAYS_OF_WEEK[i.getDay()]];if(!s)return{status:T.CLOSED_TODAY};switch(s.mode){case d.BUSINESS_HOUR_MODES.OPEN_24H:if(s)return{status:T.OPEN_24H};break;case d.BUSINESS_HOUR_MODES.APPOINTMENT_ONLY:if(s)return{status:T.OPEN_APPOINTMENT};break;case d.BUSINESS_HOUR_MODES.SPECIFIC_HOURS:const e=60*i.getHours()+i.getMinutes();if(1===(null===(n=s.hours)||void 0===n?void 0:n.length)){const t=s.hours[0][0],n=s.hours[0][1];return e>=t&&e<=n?{status:T.OPEN,openUntil:C(o+n)}:e<=t?{status:T.CLOSED,opensAt:C(o+t)}:{status:T.CLOSED}}if(2===(null===(r=s.hours)||void 0===r?void 0:r.length)){const t=s.hours[0][0],n=s.hours[0][1],r=s.hours[1][0],i=s.hours[1][1];return e>=t&&e<=n?{status:T.OPEN,openUntil:C(o+n),additionalOpen:C(o+r),additionalClose:C(o+i)}:e<t?{status:T.CLOSED,opensAt:C(o+t),additionalOpen:C(o+r),additionalClose:C(o+i)}:e>=r&&e<=i?{status:T.OPEN,openUntil:C(o+i)}:e<r?{status:T.CLOSED,opensAt:C(o+r)}:{status:T.CLOSED}}}return{status:"unknown"}}function C(e){const t=new Date,n=Math.floor(e/60);return t.setHours(n),t.setMinutes(e%60),t.setSeconds(0),t}function A(e){switch(b(e).status){case T.OPEN_24H:case T.OPEN_APPOINTMENT:case T.OPEN:return!0;case T.CLOSED:case T.CLOSED_TODAY:default:return!1}}t.BUSINESS_OPEN_STATUS=T},65999:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(11290),i=n(57037);class a extends r.BaseModel{constructor(){super(...arguments),this.id=(0,r.prop)(),this.products=(0,r.prop)(),this.itemCount=(0,r.prop)(),this.total=(0,r.prop)(),this.currency=(0,r.prop)(),this.message=(0,r.prop)()}countTotals(){const e=this.cartItemCollection.reduce(((e,t)=>{var n;return e.currency.add(t.currency),{itemCount:e.itemCount+t.quantity,total:e.total+t.quantity*(null!==(n=t.priceAmount1000)&&void 0!==n?n:0),currency:e.currency}}),{itemCount:0,total:0,currency:new Set}),t=1===e.currency.size,n={itemCount:e.itemCount,total:t?e.total:null,currency:t?e.currency.values().next().value:null};this.set(n,{silent:!0})}initialize(){super.initialize(),this.cartItemCollection=new i.CartItemCollection,this.listenTo(this,"change:cartItemCollection",this.countTotals)}getCollection(){return n(12392).CartCollection}}a.Proxy="cart";var o=(0,r.defineModel)(a);t.default=o},12392:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.CartCollectionImpl=t.CartCollection=void 0;var i=n(88555),a=n(14648),o=n(1255),s=r(n(65999)),l=n(17239),c=n(53055);class d extends o.BaseCollection{constructor(e,t){super(),this.imageWidth=100,this.imageHeight=100,null!=e&&(this.imageWidth=e),null!=t&&(this.imageHeight=t)}saveToCache(){if(!(0,i.isMDBackend)())try{if(!l.Conn.shouldSaveToCache())return;const e=this.reduce(((e,t)=>{const{cartItemCollection:n,itemCount:r,total:i,currency:a,id:o,message:s}=t,l=n.map((e=>({id:e.id,priceAmount1000:e.priceAmount1000,currency:e.currency,name:e.name,quantity:e.quantity,imageHash:e.imageHash})));return l.length>0&&e.push({id:o,products:l,itemCount:r,total:i,currency:a,message:s}),e}),[]);(0,c.setCollection)(d.cachePolicy.id,e,!0)}catch(e){__LOG__(3)`Error while saving carts to cache, ${String(e)}`}}initializeFromCache(e){try{(e||[]).forEach((e=>{const t=new s.default({id:e.id,itemCount:e.itemCount,total:e.total,currency:e.currency,message:e.message});t.cartItemCollection.add(e.products),this.add(t,{merge:!0})}))}catch(e){__LOG__(3)`Error while restoring carts from cache, ${String(e)}`}}findCart(e){return this.gadd(e)}}t.CartCollectionImpl=d,d.model=s.default,d.cachePolicy={id:"cart_collection",policy:a.CACHE_POLICY.LOAD,delay:2e3};const u=new d;t.CartCollection=u},9581:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MAX_QUANTITY=t.CartItem=void 0;var r=n(11290);t.MAX_QUANTITY=99;class i extends r.BaseModel{constructor(){super(...arguments),this.id=(0,r.prop)(),this.priceAmount1000=(0,r.prop)(),this.currency=(0,r.prop)(),this.name=(0,r.prop)(),this.quantity=(0,r.prop)(),this.imageHash=(0,r.prop)(),this.imageCdnUrl=(0,r.prop)()}getCollection(){return n(12392).CartCollection}}i.Proxy="cart-item";const a=(0,r.defineModel)(i);t.CartItem=a},57037:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CartItemCollection=void 0;var r=n(1255),i=n(9581);class a extends r.BaseCollection{}t.CartItemCollection=a,a.model=i.CartItem},21423:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(1255),i=n(17304);class a extends r.BaseCollection{constructor(){super(...arguments),this.hasProductBefore=!0}delete(){super.delete(),this.stopListening(),this.reset()}queryProducts(e){const t=e.msgs;return this.hasProductBefore=!1,this.add(t.filter((e=>null!=e.asProduct)),{at:0}),Promise.resolve()}}t.default=a,a.model=i.Msg,a.comparator=(e,t)=>e.t-t.t},34535:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InteractiveMessageHeaderMediaType=t.IM_MEDIA_HEADER_TYPES=void 0;const r=n(76672).Mirrored(["IMAGE","VIDEO","DOCUMENT"]);t.InteractiveMessageHeaderMediaType=r;const i=new Set([r.IMAGE,r.VIDEO,r.DOCUMENT]);t.IM_MEDIA_HEADER_TYPES=i},84064:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(76672)({NATIVE_FLOW:"native_flow",SHOPS_STOREFRONT:"shops_storefront"});t.default=r},5165:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(76672)({ORDER_DETAILS:"order_details",ORDER_STATUS:"order_status"});t.default=r},8803:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Label=void 0,t.intColorToHex=d;var r=n(88555),i=n(11290),a=n(17239),o=n(59846),s=n(34741),l=n(59802);class c extends i.BaseModel{constructor(){super(...arguments),this.id=(0,i.prop)(),this.name=(0,i.prop)(),this.colorIndex=(0,i.prop)(),this.color=(0,i.prop)(),this.count=(0,i.prop)(),this.stale=(0,i.session)(!0),this.hexColor=(0,i.derived)((function(){if((0,r.isMDBackend)()){const e=this.colorIndex;if(null==e)return;return a.Conn.platform===a.PLATFORMS.SMBI?o.IPHONE_LABEL_COLOR_PALETTE[e]:o.ANDROID_LABEL_COLOR_PALETTE[e]}if(this.color)return d(this.color)}),["color","colorIndex"])}initialize(){super.initialize(),this.labelItemCollection=new s.LabelItemCollection,this._triggerLabelUpdate(),this.listenTo(this,"change:name",this._triggerLabelUpdate),this.listenTo(this,"change:color",this._triggerLabelUpdate),this.listenTo(this,"change:colorIndex",this._triggerLabelUpdate),this.listenTo(this,"change:count",this._triggerLabelUpdate),(0,r.isMDBackend)()&&(this.listenTo(this.labelItemCollection,"add",this._handleLabelItemCollectionUpdate),this.listenTo(this.labelItemCollection,"remove",this._handleLabelItemCollectionUpdate))}_find(e){return Promise.resolve({id:e})}_triggerLabelUpdate(){this.name&&n(16770).LabelCollection.trigger(`label_updated_${this.id}`)}_handleLabelItemCollectionUpdate(){const e=this.labelItemCollection.filter((e=>e.parentType!==l.LabelItemParentType.Contact)).length;this.count=String(e)}}function d(e){return`#${(parseInt(e,10)>>>0).toString(16).slice(-6)}`}c.Proxy="label";const u=(0,i.defineModel)(c);t.Label=u},16770:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.LabelCollectionImpl=t.LabelCollection=void 0;var i=r(n(48926)),a=r(n(82729)),o=n(89385),s=n(50796),l=n(13959),c=n(4352),d=n(92574),u=n(88555),p=N(n(35232)),f=n(48360),h=n(46331),_=n(1255),g=n(88102),m=n(17239),y=n(45741),E=n(99234),S=r(n(14296)),v=n(8803),T=n(82663),b=n(59846),C=n(50047),A=n(59802),P=n(35389),M=r(n(11339)),O=N(n(47272)),I=r(n(35609)),w=r(n(56891)),R=n(65044),D=n(85893);function L(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(L=function(e){return e?n:t})(e)}function N(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=L(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}return r.default=e,n&&n.set(e,r),r}class k extends _.BaseCollection{constructor(){super(),this.checksum=void 0,this.listenTo(this,"remove",this.handleRemove)}initializeAssociationsFromCache(e){e.forEach((e=>{let{labelId:t,associationId:n,type:r}=e;(0,P.addToLabelCollection)(n,[t],r===T.LabelAssociationType.Jid?A.LabelItemParentType.Chat:A.LabelItemParentType.Msg)}))}addNewLabel(e,t){if((0,u.isMDBackend)())throw new Error("This call is only supported in non-MD mode");(0,C.logLabelOperationEvent)(M.default.LABEL_OPERATIONS.ADD,1,M.default.LABEL_TARGETS.LABEL);const n=w.default.createLabel(e,t),r=new h.ActionType(f.fbt._("Adding new label: {labelName}",[f.fbt._param("labelName",e)],{hk:"4iHRrD"})),i=(0,h.genId)(),a=n.then((t=>{let{status:n}=t;return 200===n?new h.ActionType(S.default.t(95,{labelName:e})):new h.ActionType(S.default.t(94,{labelName:e}))})).catch((()=>(__LOG__(3)`addingNewLabel dropped`,new h.ActionType(S.default.t(94,{labelName:e})))));return g.Cmd.openToast((0,D.jsx)(h.ActionToast,{id:i,initialAction:r,pendingAction:a})),n}removeAllLabelsMD(e){return this.addOrRemoveLabelsMD((e.labels||[]).map((e=>({type:"remove",id:e}))),[e])}addOrRemoveLabelsMD(e,t){(0,u.isLegacyWebdBackend)()||e.forEach((e=>{let{id:n,type:r}=e;t.forEach((e=>{const t=(0,P.getParentTypeFromModel)(e),i=e.id.toString();"add"===r?(0,P.addToLabelCollection)(i,[n],t):(0,P.removeLabelFromCollection)(i,n,t)}))}))}addOrRemoveLabels(e,t){const n=(0,h.genId)(),r=new h.ActionType(S.default.t(5,{count:e.length,_plural:e.length})),i=(0,y.editLabelAssociation)(e,t).then((()=>{this.addOrRemoveLabelsMD(e,t)})).then((()=>new h.ActionType(S.default.t(7,{count:e.length,_plural:e.length})))).catch((()=>(__LOG__(3)`addingNewLabel dropped`,new h.ActionType(S.default.t(6)))));g.Cmd.openToast((0,D.jsx)(h.ActionToast,{id:n,initialAction:r,pendingAction:i}))}deleteLabel(e){(0,C.logLabelOperationEvent)(M.default.LABEL_OPERATIONS.DELETE,1,M.default.LABEL_TARGETS.LABEL);const t=w.default.deleteLabel(e),n=this.get(e);if(!n)return void __LOG__(2)`deleteLabel - label does not exist`;const{name:r}=n,i=new h.ActionType(S.default.t(46,{labelName:r})),a=(0,h.genId)(),o=t.then((e=>{let{status:t}=e;return 200===t?new h.ActionType(f.fbt._("Deleted label: {labelName}",[f.fbt._param("labelName",r)],{hk:"4bqQlK"})):new h.ActionType(f.fbt._("Deleting label: {labelName} failed",[f.fbt._param("labelName",r)],{hk:"1j0DXC"}))})).catch((()=>(__LOG__(3)`addingNewLabel dropped`,new h.ActionType(f.fbt._("Deleting label: {labelName} failed",[f.fbt._param("labelName",r)],{hk:"1j0DXC"})))));return g.Cmd.openToast((0,D.jsx)(h.ActionToast,{id:a,initialAction:i,pendingAction:o})),t}_getActionLabelUpdateString(e,t){switch(e){case b.LABEL_PROPERTIES.NAME:return t===b.UPDATE_STATUS.UPDATING?f.fbt._("Updating label name",null,{hk:"2FancO"}):t===b.UPDATE_STATUS.SUCCEEDED?f.fbt._("Label name updated",null,{hk:"Nacb5"}):f.fbt._("Label name update failed",null,{hk:"33PW5z"});case b.LABEL_PROPERTIES.COLOR:return t===b.UPDATE_STATUS.UPDATING?f.fbt._("Updating label color",null,{hk:"49XPdJ"}):t===b.UPDATE_STATUS.SUCCEEDED?f.fbt._("Label color updated",null,{hk:"2cuEYz"}):f.fbt._("Label color update failed",null,{hk:"Dzw1J"})}return""}updateLabel(e,t){(0,C.logLabelOperationEvent)(M.default.LABEL_OPERATIONS.EDIT,1,M.default.LABEL_TARGETS.LABEL);const n=w.default.editLabel(e.id,e.name,e.color),r=new h.ActionType(this._getActionLabelUpdateString(t,b.UPDATE_STATUS.UPDATING)),i=(0,h.genId)(),a=n.then((e=>{let{status:n}=e;return 200===n?new h.ActionType(this._getActionLabelUpdateString(t,b.UPDATE_STATUS.SUCCEEDED)):new h.ActionType(this._getActionLabelUpdateString(t,b.UPDATE_STATUS.FAILED))})).catch((()=>(__LOG__(3)`updatingLabel dropped`,new h.ActionType(this._getActionLabelUpdateString(t,b.UPDATE_STATUS.FAILED)))));return g.Cmd.openToast((0,D.jsx)(h.ActionToast,{id:i,initialAction:r,pendingAction:a})),n}getNewLabelColor(){return(0,i.default)((function*(){try{return(yield w.default.queryNextLabelColor()).labelColors[0].color}catch(e){return}}))()}getLabelColorPalette(){return this.labelColorPalette=this.labelColorPalette||(0,E.getSmbLabelPalette)(),this.labelColorPalette&&this.labelColorPalette.waVersion===m.Conn.phone.wa_version?Promise.resolve(this.labelColorPalette.colors):this._getColorPaletteLoop().then((e=>{const t=e.labelColors.map((e=>{let{color:t}=e;return t}));return(0,E.setSmbLabelPalette)({colors:t,waVersion:m.Conn.phone.wa_version}),t})).catch((()=>{}))}_getColorPaletteLoop(){return(0,c.promiseLoop)(((e,t,n)=>{const r=(0,l.delayMs)(O.expBackoff(n,12e4,1e3,.1));return("CONNECTED"===R.Socket.stream?Promise.resolve():(0,I.default)(R.Socket,"change:stream",(()=>"CONNECTED"===R.Socket.stream))).then((()=>w.default.queryLabelPalette().then((t=>{e(t)})))).catch((e=>{if(e.name===o.ABORT_ERROR)throw e;return n>3||404===e?(__LOG__(3)`labels:loadLabelPalette:error ${String(e)}`,404===e?Promise.reject(new d.E404):Promise.reject(new p.GaveUpRetry(`Gave up loading label palette ${n} tries`))):r}))}),0)}handleRemove(e){const{labelItemCollection:t}=e;t.toArray().forEach((e=>{const{parentId:t,parentType:n,labelId:r}=e,i=(0,P.getParentCollection)(n).get(t);i&&(i.labels=(0,a.default)(i.labels,(e=>e!==r)))}))}onResume(){this.filter((e=>e.hasObservers())).forEach((e=>{this.find(e.id).catch((0,s.filteredCatch)(d.WebdDrop,(()=>{})))}))}delete(){super.delete(),delete this.checksum}sync(e){if(!e||this.checksum!==e)return this.findQuery({}).catch((0,s.filteredCatch)([d.WebdDrop,p.ProtoVersionUndefined],(()=>{})))}handle(e){var t,n;if(e.checksum&&this.updateChecksum(e.checksum),null===(t=e.labels)||void 0===t||null===(n=t[0])||void 0===n?void 0:n.labelUpdates){let t;return e.labels[0].labelUpdates.forEach((e=>{e.collection.forEach((n=>{n!==A.LabelItemParentType.Msg&&n!==A.LabelItemParentType.Chat||(t=!0);const r=e.id,i=(0,P.getParentCollection)(n).get(e.id);i&&(i.labels&&i.labels.forEach((t=>{e.labels.includes(t)||(0,P.removeLabelFromCollection)(r,t,n)})),i.labels=e.labels)}))})),void(t&&this.trigger("bulk_msg_chat_label_change"))}const r=[],i=[];e.labels.forEach((e=>{"delete"===e.type?r.push(e.label):i.push(e.label)})),this.remove(r.map((e=>{let{id:t}=e;return t}))),this.add(i,{merge:!0})}_findQuery(){var e=this;return(0,i.default)((function*(){const t=yield w.default.queryLabels();return t.checksum&&e.updateChecksum(t.checksum),t.labels}))()}_find(){return this._findQuery()}updateChecksum(e){this.checksum=e}getLabelsForModel(e,t){return this.filter((n=>n.labelItemCollection.get((0,P.createLabelItemId)(e,n.id,t)))).map((e=>e.id))}}t.LabelCollectionImpl=k,k.model=v.Label,k.staleCollection=!0,k.resumeOnAvailable=!0;const U=new k;t.LabelCollection=U},59846:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UPDATE_STATUS=t.LABEL_PROPERTIES=t.IPHONE_LABEL_COLOR_PALETTE=t.ANDROID_LABEL_COLOR_PALETTE=void 0;t.ANDROID_LABEL_COLOR_PALETTE=["#FF9485","#64C4FF","#FFD429","#DFAEF0","#99B6C1","#55CCB3","#FF9DFF","#D3A91D","#6D7CCE","#D7E752","#00D0E2","#FFC5C7","#93CEAC","#F74848","#00A0F2","#83E422","#FFAF04","#B5EBFF","#9BA6FF","#9368CF"];t.IPHONE_LABEL_COLOR_PALETTE=["#A62C71","#90A841","#C1A03F","#792138","#AE8774","#F0B330","#B6B327","#C69FCC","#8B6990","#FF8A8C","#54C265","#FF7B6B","#26C4DC","#57C9FF","#74676A","#7E90A3","#5696FF","#6E257E","#7ACBA5","#243640"];const n=Object.freeze({NAME:"name",COLOR:"color"});t.LABEL_PROPERTIES=n;const r=Object.freeze({UPDATING:"updating",SUCCEEDED:"succeeded",FAILED:"failed"});t.UPDATE_STATUS=r},24137:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(11290);n(59802);class i extends r.BaseModel{constructor(){super(...arguments),this.id=(0,r.prop)(),this.parentType=(0,r.prop)(),this.parentId=(0,r.prop)(),this.labelId=(0,r.prop)()}}i.Proxy="labelItem";var a=(0,r.defineModel)(i);t.default=a},34741:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.LabelItemCollection=void 0;var i=r(n(82569)),a=n(88555),o=n(1255),s=r(n(24137)),l=n(35389);class c extends o.BaseCollection{constructor(){super(),(0,a.isMDBackend)()&&(this.listenTo(this,"add",this._handleAdd),this.listenTo(this,"remove",this._handleRemove))}_handleAdd(e){this._handleChange(e,!0)}_handleRemove(e){this._handleChange(e,!1)}_handleChange(e,t){const n=(0,l.getParentCollection)(e.parentType).get(e.parentId);if(!n)return;const r=n.labels||[];t?r.includes(e.labelId)||(n.labels=[e.labelId].concat(r)):n.labels=(0,i.default)(r,e.labelId)}}t.LabelItemCollection=c,c.model=s.default},52388:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(48926)),a=r(n(45095)),o=r(n(89867)),s=n(11290),l=n(9468),c=n(96519),d=n(21374),u=n(12496),p=n(5641);class f extends s.BaseModel{constructor(){super(...arguments),this.id=(0,s.prop)(),this.afterCursor=(0,s.prop)(),this.index=(0,s.prop)(),this.fetchedFromServer=(0,s.session)(),this._products=(0,s.session)(),this._msgs=(0,s.session)()}initialize(){super.initialize(),this.productCollection=new p.ProductCollection,this.msgProductCollection=new p.ProductCollection,this.collections=new u.ProductCollCollection,this.listenTo(this,"change:_products",this.triggerProductUpdate),this.listenTo(this,"change:_msgs",this.triggerMsgUpdate),this.triggerProductUpdate(),this.triggerMsgUpdate()}triggerProductUpdate(){this._products&&this.productCollection.add(this._products,{merge:!0}),this._products=void 0}triggerMsgUpdate(){this._msgs&&this.msgProductCollection.add(this._msgs,{merge:!0}),this._msgs=void 0}markProductCollectionOld(){this.productCollection.forEach((e=>e.markOld()))}addProduct(e){var t=this;return(0,i.default)((function*(){const{id:n}=t,r=yield(0,c.addProduct)(e),i=t.productCollection.at(0);r.catalogWid=n,r.index=i?i.index-1:0;const o=t.productCollection.add(r,{merge:!0,at:0})[0];return(0,a.default)(o,"addedProduct")}))()}editProduct(e){var t=this;return(0,i.default)((function*(){const n=yield(0,c.editProduct)(e),r=t.productCollection.add(n,{merge:!0})[0];return t.collections&&t.collections.forEach((t=>{t.productCollection.get(e.id)&&t.productCollection.add(n,{merge:!0})})),(0,a.default)(r,"editedProduct")}))()}refreshProduct(e){var t=this;return(0,i.default)((function*(){const n=t.productCollection.get(e);n&&(n.stale=!0);const r=yield(0,c.queryProduct)(t.id,e);if(null!=r.data){const i=(0,d.mapProductResponseToModel)(r.data,t.id);n&&t.productCollection.add(i,{merge:!0}),t.collections&&t.collections.forEach((t=>{t.productCollection.get(e)&&t.productCollection.add(i,{merge:!0})}))}}))()}pullProduct(e,t){var n=this;return(0,i.default)((function*(){const r=yield(0,c.queryProduct)(n.id,e,void 0,void 0,void 0,t);if("NOT_FOUND"===r.error&&n.productCollection.remove(e),null!=r.data){const e=new l.Product((0,d.mapProductResponseToModel)(r.data,n.id));n.updateProduct(e)}}))()}updateProduct(e){this.productCollection.add(e,{merge:!1})}getCollection(){return n(99989).CatalogCollection}}f.Proxy="catalog",f.idClass=o.default;var h=(0,s.defineModel)(f);t.default=h},99989:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.CatalogCollectionImpl=t.CatalogCollection=void 0;var i=r(n(48926)),a=n(51737),o=n(92574),s=n(45454),l=n(1255),c=r(n(52388)),d=n(78711),u=n(96519),p=n(21374),f=n(48870),h=(n(27798),n(64551));class _ extends l.BaseCollection{addMsgAsProduct(e){const t=e.businessOwnerJid&&(0,s.createWid)(e.businessOwnerJid);if(!t)return;const n=this.get(t),r=n&&e.productId&&n.msgProductCollection.get(e.productId),i=n&&e.productId?n.productCollection.get(e.productId):null;if((null==i?void 0:i.t)&&i.t>=e.t)return;if(null==r?void 0:r.fetchedFromServer)return;const a=(0,p.mapMsgToProductModel)(e);return super.add({id:t,afterCursor:void 0,_msgs:[a],stale:!0,fetchedFromServer:!!i},{merge:!0})}_queryProduct(e){var t=()=>super.add,n=this;let{catalogWid:r,productId:a,productMsgMediaData:s,width:l,height:c,shouldFetchComplianceFields:d,canLogQpl:f}=e;return(0,i.default)((function*(){const e=yield(0,u.queryProduct)(r,a,l,c,d,f);if("NOT_FOUND"===e.error){const e=n.get(r);return null==e||e.productCollection.remove(a),Promise.reject(new o.E404("CatalogCollection:findProduct:_queryProduct NOT_FOUND"))}if(!e.data)return t().call(n,{id:r,afterCursor:void 0});const{data:i}=e;if(!i.image_cdn_urls)return Promise.reject(new Error("CatalogCollection:findProduct:_queryProduct: could not find image_cdn_urls for product"));const h=(0,p.mapProductResponseToModel)(i,r);h.productMsgMediaData=s;const _=[h];return t().call(n,{id:r,afterCursor:void 0,_products:_,_msgs:_},{merge:!0})}))()}findProduct(e){let{catalogWid:t,productId:n,productMsgMediaData:r,shouldFetchComplianceFields:i,canLogQpl:a}=e;return n?this._queryProduct({catalogWid:t,productId:n,productMsgMediaData:r,shouldFetchComplianceFields:i,canLogQpl:a}):Promise.reject(new Error("CatalogCollection:findProduct Received productId type "+(void 0===n?"undefined":"null")))}_queryCatalog(e,t,n,r,a,o){return(0,i.default)((function*(){const i=e?e.index:0;o&&f.QPL.markerPoint(o,"datasource_catalog_start");const s=yield(0,u.queryCatalog)(t,n,10,void 0,void 0,r,a);if(o&&f.QPL.markerPoint(o,"datasource_catalog_end"),!s.data.length)return{id:t,afterCursor:null};const l=[];return s.data.forEach((e=>{e.image_cdn_urls&&l.push((0,p.mapProductResponseToModel)(e,t))})),{id:t,afterCursor:s.paging.cursors.after,_products:l,fetchedFromServer:!0,index:i+l.length}}))()}_findQuery(e,t){const n=this.get(e),r=n&&!n.stale?n.afterCursor:void 0;return this._queryCatalog(n,e,r,void 0,void 0,null==t?void 0:t.markerId)}_find(e,t){return this._findQuery(e,t)}findCarouselCatalog(e){var t=()=>super.add,n=this;return(0,i.default)((function*(){const r=n.get(e),i=(0,a.isString)(e)?(0,s.createWid)(e):e;r&&r.set({index:0});const o=yield n._queryCatalog(r,i,void 0,void 0,Boolean(h.ServerProps.shopsProductGrid));return r&&r.markProductCollectionOld(),t().call(n,o,{merge:!0})}))()}findNextProductPage(e,t){var n=this;return(0,i.default)((function*(){!0===t&&(0,d.qplPointCatalogView)("datasource_start");const r=yield n.update(e);!0===t&&(0,d.qplPointCatalogView)("datasource_end");return(Array.isArray(r)?r[0]:r).productCollection.getProductModels()}))()}findCollectionMembership(e,t){var n=()=>super.add,r=this;return(0,i.default)((function*(){let i=r.get(e);const o=(0,a.isString)(e)?(0,s.createWid)(e):e,l=i&&!i.stale?i.afterCursor:void 0,c=yield r._queryCatalog(i,o,l,t);n().call(r,c,{merge:!0}),i=r.get(e),i&&(i.stale=!1)}))()}}t.CatalogCollectionImpl=_,_.model=c.default,_.staleCollection=!0;const g=new _;t.CatalogCollection=g},78711:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.qplPointCatalogView=function(e){r.QPL.markerPoint(i.QuickLogMarkerId.WHATSAPP_CATALOG_VIEW,e)},t.qplPointProductMessageSend=function(e){r.QPL.markerPoint(i.QuickLogMarkerId.WHATSAPP_PRODUCT_MESSAGE_SEND,e)};var r=n(48870),i=n(27798)},9468:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.Product=t.MIN_PRICE=t.MAX_PRODUCT_IMAGES=t.MAX_PRICE=void 0;var i=n(65885),a=n(11290),o=r(n(2320)),s=n(58668),l=n(7514);t.MIN_PRICE=0;t.MAX_PRICE=4503599627370496;t.MAX_PRODUCT_IMAGES=10;class c extends a.BaseModel{constructor(){super(...arguments),this.old=(0,a.session)(!1),this.checkmark=(0,a.session)(!1),this.id=(0,a.prop)(),this.isHidden=(0,a.prop)(),this.catalogWid=(0,a.prop)(),this.url=(0,a.prop)(),this.name=(0,a.prop)(),this.description=(0,a.prop)(),this.availability=(0,a.prop)(),this.reviewStatus=(0,a.prop)(),this.canAppeal=(0,a.prop)(),this.currency=(0,a.prop)(),this.priceAmount1000=(0,a.prop)(),this.salePriceAmount1000=(0,a.prop)(),this.salePriceStartDate=(0,a.prop)(),this.salePriceEndDate=(0,a.prop)(),this.retailerId=(0,a.prop)(),this.productImageCollection=(0,a.session)(),this.imageCount=(0,a.prop)(),this.index=(0,a.prop)(),this.additionalImageCdnUrl=(0,a.prop)(),this.additionalImageHashes=(0,a.prop)(),this.imageCdnUrl=(0,a.prop)(),this.imageHash=(0,a.prop)(),this.complianceInfo=(0,a.prop)(),this.productMsgMediaData=(0,a.session)(),this.fetchedFromServer=(0,a.session)(),this.t=(0,a.prop)()}initialize(){super.initialize(),this.productImageCollection=new l.ProductImageCollection,this.listenTo(this,"change:imageCdnUrl",this.triggerMainImageUpdate),this.initImageUpdate()}triggerAdditionalImageUpdate(){var e;let t=0;null===(e=this.additionalImageCdnUrl)||void 0===e||e.forEach(((e,n)=>{this.productImageCollection.gadd({id:`_${n+1}`,mediaUrl:e,fetchedFromServer:this.fetchedFromServer,old:!1},{merge:!0}),t=n+1})),this.productImageCollection.filter(((e,n)=>n>t)).forEach((e=>e.markOld()))}triggerMainImageUpdate(){var e;this.imageCdnUrl?this.productImageCollection.gadd({id:"_0",mediaUrl:this.imageCdnUrl,fetchedFromServer:this.fetchedFromServer,old:!1},{merge:!0}):null===(e=this.productImageCollection.get("_0"))||void 0===e||e.markOld()}initImageUpdate(){if(this.fetchedFromServer||!this.productMsgMediaData)this.triggerMainImageUpdate();else for(let e=0;e<this.imageCount;e++)this.productImageCollection.gadd({id:`_${e}`,type:"product",mediaData:new o.default({mediaStage:s.MEDIA_DATA_STAGE.PREPARING}),fetchedFromServer:this.fetchedFromServer,old:!1},{merge:!0})}markOld(){this.old=!0}lazyloadProductImageCollection(){return this.triggerAdditionalImageUpdate(),this.productImageCollection}getProductImageCollectionCount(){return this.productImageCollection.length}getProductImageCollectionHead(){return this.productImageCollection.head()}getHeadImageFile(){var e;const{productImageCollection:t,name:n}=this,r=t.head();if(!r)return;let a;const o=null===(e=r.mediaData)||void 0===e?void 0:e.mediaBlob;if(o._blob&&(a=o._blob),!a)return;return(0,i.createFile)([a],`${n}.jpg`,{type:"image/jpeg"})}evictImagesFromCache(){this.productImageCollection.forEach((e=>e.evictFromCache()))}getPreviewImage(){return this.productImageCollection.head()}}c.Proxy="product";const d=(0,a.defineModel)(c);t.Product=d},91450:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.createProductMsgSnapshot=E,t.sendProductMessage=function(){return S.apply(this,arguments)};var i=r(n(81109)),a=r(n(48926)),o=r(n(45095)),s=n(15461),l=n(48360),c=n(80666),d=r(n(14075)),u=n(88102),p=n(78711),f=r(n(11339)),h=n(13151),_=n(50452),g=n(85893);function m(){return y.apply(this,arguments)}function y(){return(y=(0,a.default)((function*(e,t){const n=(0,o.default)(new d.default({chatParticipantCount:t}),"new AttachMediaCollection({\n  chatParticipantCount\n})");if((0,p.qplPointProductMessageSend)("image_upload_start"),yield n.processAttachments([{file:e}],f.default.MEDIA_PICKER_ORIGIN_TYPE.CHAT_PHOTO_LIBRARY),(0,p.qplPointProductMessageSend)("image_upload_end"),!n.canSend())return;const r=n.getPreviewableMedias();if(1!==r.length)return;const[i]=r;return i.caption||(i.caption=void 0),i}))).apply(this,arguments)}function E(e){return(0,i.default)((0,i.default)({businessOwnerJid:e.catalogWid.toString({legacy:!0}),productId:e.id.toString(),url:e.url,productImageCount:e.getProductImageCollectionCount(),title:e.name,description:e.description},0===e.priceAmount1000?{priceAmount1000:null,currencyCode:null}:{currencyCode:e.currency,priceAmount1000:e.priceAmount1000}),{},{salePriceAmount1000:(0,h.isSalePriceActive)(e)?e.salePriceAmount1000:null})}function S(){return(S=(0,a.default)((function*(e,t,n){const r=t.getHeadImageFile();if(!r)throw u.Cmd.openToast((0,g.jsx)(_.Toast,{msg:l.fbt._("Can not send product before media is ready",null,{hk:"1dON6O"}),id:(0,_.genId)()})),new Error("Tried to send product message. Media file is not available.");const a=e.getParticipantCount(),o=yield m(r,a);if(!o)throw u.Cmd.openToast((0,g.jsx)(_.Toast,{msg:l.fbt._("Can not send product before media is ready",null,{hk:"1dON6O"}),id:(0,_.genId)()})),new Error("Tried to send product message. Media data is not available.");const d={quotedMsg:n,caption:o.caption,addEvenWhilePreparing:o.previewable&&o.state===c.ATTACH_MEDIA_STATE.PROCESSING,useBasePropsType:!0};o.sendToChat(e,(0,i.default)((0,i.default)({},d),{},{type:s.MSG_TYPE.PRODUCT,productMsgOptions:E(t)}))}))).apply(this,arguments)}},94629:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(11290),i=n(5641);class a extends r.BaseModel{constructor(){super(...arguments),this.id=(0,r.prop)(),this.name=(0,r.prop)(),this.isHidden=(0,r.prop)(),this.reviewStatus=(0,r.prop)(),this.commerceUrl=(0,r.prop)(),this.rejectReason=(0,r.prop)(),this.totalItemsCount=(0,r.prop)(),this.afterCursor=(0,r.prop)(),this.canAppeal=(0,r.prop)()}initialize(){super.initialize(),this.productCollection=new i.ProductCollection,this.afterCursor=void 0}addProducts(e){this.productCollection.add(e,{merge:!0})}}a.Proxy="productColl";var o=(0,r.defineModel)(a);t.default=o},12496:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ProductCollCollection=void 0;var i=r(n(48926)),a=r(n(89636)),o=n(1255),s=n(97951),l=n(21374),c=r(n(94629)),d=n(60323),u=n(48870);n(27798);const p=100,f=e=>({id:e.id,name:e.name,reviewStatus:e.reviewStatus,totalItemsCount:e.totalItemsCount,canAppeal:e.canAppeal,commerceUrl:e.commerceUrl,rejectReason:e.rejectReason});class h extends o.BaseCollection{constructor(){super(...arguments),this.afterCursor=""}findCollectionsList(e,t,n,r){var a=this;return(0,i.default)((function*(){r&&u.QPL.markerPoint(r,"datasource_collections_start");try{const n=yield(0,s.attemptWithDirectConnectionRetry)(e,(n=>(0,d.queryCollections)(e,a.afterCursor,10,t,p,p,n)));r&&u.QPL.markerPoint(r,"datasource_collections_end"),a.afterCursor=n.afterCursor,a.add(n.collections.map(f),{merge:!0}),n.collections.forEach((t=>{const n=a.get(t.id);n&&n.addProducts(t.products.map((t=>(0,l.mapProductResponseToModel)(t,e))))})),a.trigger("change")}catch(e){throw __LOG__(4,!0,new Error,!0)`Failed findCollectionsList, error: ${e}`,SEND_LOGS("Find collections list failed"),e}}))()}getCollectionModels(e){const t=this.toArray();return e?t:t.filter((e=>!e.isHidden&&"APPROVED"===e.reviewStatus))}findCollectionProducts(e,t,n,r){var o=this;return(0,i.default)((function*(){let n=o.get(t);const i=n?n.afterCursor:void 0;r&&u.QPL.markerPoint(r,"datasource_start");try{const c=yield(0,s.attemptWithDirectConnectionRetry)(e,(n=>(0,a.default)({catalogWid:e,collectionId:t,afterCursor:i,limit:10,width:p,height:p,directConnectionEncryptedInfo:n})));r&&u.QPL.markerPoint(r,"datasource_end"),1===c.collections.length&&(o.add(c.collections.map(f),{merge:!0}),n=o.get(t),n&&(n.addProducts(c.collections[0].products.map((t=>(0,l.mapProductResponseToModel)(t,e)))),n.afterCursor=c.afterCursor))}catch(e){throw __LOG__(4,!0,new Error,!0)`Failed findCollectionProducts, error: ${e}`,SEND_LOGS("Find collection products failed"),e}}))()}}t.ProductCollCollection=h,h.model=c.default,h.staleCollection=!0},5641:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ProductCollection=t.PRODUCT_REVIEW_STATUS=void 0;var r=n(1255),i=n(9468);const a={NO_REVIEW:"NO_REVIEW",PENDING:"PENDING",REJECTED:"REJECTED",APPROVED:"APPROVED",OUTDATED:"OUTDATED"};t.PRODUCT_REVIEW_STATUS=a;class o extends r.BaseCollection{getProductModels(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t=super.toArray();if(super.length<1)return t;const n=super.head();if(!(null==n?void 0:n.catalogWid))return t;const r=e?new Set([a.OUTDATED,a.NO_REVIEW,a.APPROVED,a.REJECTED,a.PENDING]):new Set([a.APPROVED]),i=super.filter((e=>r.has(e.reviewStatus)&&!e.old));return e?i:i.filter((e=>!e.isHidden))}add(e,t){const n=t?super.add(e,t):super.add(e);return this.sort(),n}evictImagesFromCache(e){const t=this.get(e);t&&t.evictImagesFromCache()}}t.ProductCollection=o,o.model=i.Product,o.comparator=function(e,t){return e.index-t.index}},51954:(e,t,n)=>{"use strict";var r=n(59182).default,i=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.STATIC_WHATSAPP_IMAGE_URI=t.ProductImage=void 0;var a=i(n(48926)),o=i(n(81109)),s=n(37178),l=n(35232),c=n(96177),d=n(11290),u=n(18309),p=n(55975),f=n(78986),h=i(n(2320)),_=n(58668),g=n(56406),m=i(n(34949));const y="https://static.whatsapp.net";t.STATIC_WHATSAPP_IMAGE_URI=y;const E=(0,s.createTimer)({algo:{type:"fibonacci",first:0,second:1},jitter:.25,max:9e5});function S(e){return"_productimage_"+(e.includes(y)?e:new URL(e).pathname)}class v extends d.BaseModel{constructor(){super(...arguments),this.id=(0,d.prop)(),this.type=(0,d.prop)(),this.mediaUrl=(0,d.prop)(),this.blobUrl=(0,d.session)(),this.mediaData=(0,d.session)(),this.fetchedFromServer=(0,d.prop)(),this.old=(0,d.session)(!1)}initialize(){super.initialize(),this.listenTo(this,"change:mediaUrl change:fetchedFromServer",this.triggerImageUpdate),this.triggerImageUpdate()}_processAndUpdateMediaData(e){let t={};const n=m.default.createFromData(e,"image/jpeg");(0,f.prepRawMedia)(n,{}).waitForPrep().then((e=>(t=(0,o.default)((0,o.default)({},t),{},{mediaBlob:e.mediaBlob,type:e.type,mimetype:e.mimetype,fullWidth:e.fullWidth,fullHeight:e.fullHeight}),Promise.all(["string"==typeof e.preview?m.default.createFromBase64Jpeg(e.preview):Promise.resolve(null),m.default.createFromData(e.mediaBlob),(0,u.calculateFilehashFromBlob)(e.mediaBlob)])))).then((e=>{const[n,r,i]=e;t=(0,o.default)((0,o.default)({},t),{},{preview:n,mediaBlob:r,renderableUrl:r.url(),mediaStage:_.MEDIA_DATA_STAGE.RESOLVED,filehash:i}),i!==this.mediaData.filehash&&this.mediaData.set(t)}))}triggerImageUpdate(){var e=this;return(0,a.default)((function*(){if(!e.fetchedFromServer||!e.mediaUrl)return;e.mediaData||e.addChild("mediaData",new h.default({mediaStage:_.MEDIA_DATA_STAGE.PREPARING}));const t=S(e.mediaUrl),n=yield p.LruMediaStore.get(t);if(n)return e._processAndUpdateMediaData(n);const i={delay:e=>{let{taskDuration:t}=e;const n=1e3*E();return Math.max(n-t,0)},signal:(new r).signal,retries:10};try{const{result:n}=yield(0,c.backoff)(i,function(){var t=(0,a.default)((function*(t){const n=yield(0,g.fetchMedia)(e.mediaUrl);return n&&n.status>=200&&n.status<300?n:t(new l.CatalogImageDownloadError)}));return function(){return t.apply(this,arguments)}}());p.LruMediaStore.put(t,n),e._processAndUpdateMediaData(n)}catch(t){__LOG__(3)`Failed to fetch ${e.mediaUrl}`,e.mediaData.set({mediaStage:_.MEDIA_DATA_STAGE.ERROR_MISSING})}}))()}markOld(){this.old=!0}evictFromCache(){if(this.mediaUrl){const e=S(this.mediaUrl);p.LruMediaStore.del(e)}}}v.Proxy="productImage";const T=(0,d.defineModel)(v);t.ProductImage=T},7514:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ProductImageCollection=void 0;var r=n(1255),i=n(51954);class a extends r.BaseCollection{toArray(){return super.filter((e=>e.old?(this.remove(e),!1):e))}}t.ProductImageCollection=a,a.model=i.ProductImage},89295:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ProductMessageList=t.INVALID_PRODUCT_TOKEN=void 0;var i=r(n(48926)),a=r(n(65212)),o=n(11290),s=n(884),l=n(99989),c=n(69951),d=n(21374),u=n(5641),p=n(92002),f=n(40264),h=n(64551);const _="DELETED";t.INVALID_PRODUCT_TOKEN=_;const g=["ERROR","SUCCESS"];class m extends o.BaseModel{constructor(){super(...arguments),this.id=(0,o.prop)(),this.catalogId=(0,o.prop)(),this.title=(0,o.prop)(),this.requiresDirectConnection=(0,o.prop)(),this._productsLoadingStatus=(0,o.session)(),this._productList=(0,o.session)(),this._products=(0,o.session)()}initialize(){super.initialize(),this.productCollection=l.CatalogCollection.gadd({id:this.catalogId}).productCollection,this._productsLoadingStatus=new Map,this.listenTo(this,"change:_products",this.triggerProductUpdate),this.triggerProductUpdate(),this.listenTo(this.productCollection,"remove",this.triggerProductRemoved),this.listenTo(c.ChatCollection,"add",this.triggerChatAdded)}triggerProductRemoved(e){(0,p.updateProductListHeaderImageRejected)(e,this.id)}triggerProductUpdate(){null!=this._products&&(this._products.forEach((e=>{const t=this._getFetchStatus(e);if(this.setProductLoadingStatus(e.id,t),"DELETED"===e.status&&this.triggerProductRemoved(e),"DELETED"!==e.status&&"ERROR"!==t){const t=(0,d.mapProductResponseToModel)(e,this.catalogId);t.reviewStatus===u.PRODUCT_REVIEW_STATUS.REJECTED&&this.triggerProductRemoved(t),this.productCollection.add(t,{merge:!0})}})),this._products=void 0)}triggerChatAdded(e){var t=this;return(0,i.default)((function*(){e.id.equals(t.catalogId)&&(yield(0,s.isCypherNeeded)(t.catalogId))&&(t.productCollection.reset(),t._productsLoadingStatus=new Map)}))()}getNextProductBatchToLoad(){const e=this.getPageSize(),t=this._productList.productSections.reduce(((e,t)=>{let{products:n}=t;return[...e,...n.map((e=>{let{productId:t}=e;return t})).filter(Boolean).filter((e=>"NONE"===this.getProductLoadingStatus(e)))]}),[]).slice(0,e);return t.forEach((e=>this.setProductLoadingStatus(e,"PENDING"))),t}getPageSize(){const e=h.ServerProps.webProductListMessagePageSize||f.PRODUCT_PAGE_SIZE,t=this.getProductSize();return t<3*e?t:2*e}getProductSize(){return this._productList.productSections.reduce(((e,t)=>{let{products:n}=t;return e+n.length}),0)}setProductLoadingStatus(e,t){this._productsLoadingStatus.set(e,t)}getProductLoadingStatus(e){return this._productsLoadingStatus.get(e)||"NONE"}getTotalProductsFetchedOrFailed(){return Array.from(this._productsLoadingStatus).filter((e=>{let[t,n]=e;return g.includes(n)})).length}getProductList(){return this._productList}getSections(){return this._productList.productSections}getSectionsCount(){return this._productList.productSections.reduce(((e,t)=>{let{title:n}=t;return null!=n&&""!==n?e+1:e}),0)}isFetching(){let e=!1;return this._productsLoadingStatus.forEach((t=>{"PENDING"===t&&(e=!0)})),e}_getFetchStatus(e){return e.status!==_&&e.image_cdn_urls?"SUCCESS":"ERROR"}}m.Proxy="product_list",m.idClass=a.default;const y=(0,o.defineModel)(m);t.ProductMessageList=y},18952:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ProductMessageListCollectionImpl=t.ProductMessageListCollection=void 0;var i=r(n(48926)),a=n(45454),o=n(1255),s=n(96519),l=n(89295);n(27798);class c extends o.BaseCollection{_queryProductList(e,t){return(0,i.default)((function*(){const n=e.catalogId,r=yield(0,s.queryProductList)(n,e.getNextProductBatchToLoad(),void 0,void 0,t);return{id:e.id,_products:r,fetchedFromServer:!0}}))()}_findQuery(e,t){const n=this.get(e);return null==n?Promise.resolve({id:e}):this._queryProductList(n,null==t?void 0:t.markerId)}_find(e,t){return this._findQuery(e,t)}getOrAdd(e,t,n,r,i){let o=this.get(e);if(null!=o)return o;if(null==r)return null;const s=(0,a.createWid)(r);return o=this.add({id:e,catalogId:s,_productList:t,title:i,requiresDirectConnection:n})[0],null!=o?o:null}}t.ProductMessageListCollectionImpl=c,c.model=l.ProductMessageList,c.staleCollection=!0;const d=new c;t.ProductMessageListCollection=d},40264:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PRODUCT_PAGE_SIZE=void 0;t.PRODUCT_PAGE_SIZE=6},13151:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isSalePriceActive=t.isEmptyPrice=t.getActivePrice=void 0;const n=e=>null!=e.salePriceAmount1000&&(null==e.salePriceStartDate||e.salePriceStartDate<=Date.now())&&(null==e.salePriceEndDate||e.salePriceEndDate>Date.now());t.isSalePriceActive=n;const r=e=>n(e)?e.salePriceAmount1000:e.priceAmount1000;t.getActivePrice=r;t.isEmptyPrice=e=>{const{currency:t,priceAmount1000:n}=e,i=r(e);return!t||null==n||null==i}},6822:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ProductComplianceCategory=t.ProductAvailability=void 0;const r=n(76672)({IN_STOCK:"in stock",OUT_OF_STOCK:"out of stock",UNKNOWN:"unknown"});t.ProductAvailability=r;const i=n(76672)({Default:"DEFAULT",CountryOriginExempt:"COUNTRY_ORIGIN_EXEMPT"});t.ProductComplianceCategory=i},65563:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.QuickReplyTypes=void 0;const r=n(76672)({TEXT:"text",ADDRESS_SMART_DEFAULT:"address_smart_default",HOURS_SMART_DEFAULT:"hours_smart_default",PROFILE_SMART_DEFAULT:"profile_smart_default"});t.QuickReplyTypes=r},47169:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(11290),i=n(65563),a=n(76892);class o extends r.BaseModel{constructor(){super(...arguments),this.id=(0,r.prop)(),this.shortcut=(0,r.prop)(),this.message=(0,r.prop)(),this.count=(0,r.prop)(),this.keywords=(0,r.prop)(),this.pendingCount=(0,r.session)(0),this.totalCount=(0,r.derived)((function(){return this.count+this.pendingCount}),["count","pendingCount"]),this.type=(0,r.derived)((function(){var e;switch(null!==(e=i.QuickReplyTypes.cast(this.id))&&void 0!==e?e:i.QuickReplyTypes.TEXT){case i.QuickReplyTypes.ADDRESS_SMART_DEFAULT:return i.QuickReplyTypes.ADDRESS_SMART_DEFAULT;case i.QuickReplyTypes.HOURS_SMART_DEFAULT:return i.QuickReplyTypes.HOURS_SMART_DEFAULT;case i.QuickReplyTypes.PROFILE_SMART_DEFAULT:return i.QuickReplyTypes.PROFILE_SMART_DEFAULT;default:return i.QuickReplyTypes.TEXT}}),["id"])}useOnce(){this.isSmartDefault()?(this.count+=1,(0,a.updateQuickReply)(this)):(this.pendingCount+=1,this.getCollection().periodicFlush())}getCollection(){return n(99662).QuickReplyCollection}isSmartDefault(){switch(this.type){case i.QuickReplyTypes.PROFILE_SMART_DEFAULT:case i.QuickReplyTypes.HOURS_SMART_DEFAULT:case i.QuickReplyTypes.ADDRESS_SMART_DEFAULT:return!0;default:return!1}}}o.Proxy="quickReply";var s=(0,r.defineModel)(o);t.default=s},99662:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.QuickReplyCollectionImpl=t.QuickReplyCollection=void 0;var i=r(n(48926)),a=n(50796),o=n(57319),s=n(92574),l=n(88555),c=n(14648),d=n(1255),u=n(7293),p=r(n(47169)),f=n(47787),h=r(n(56891));class _ extends d.BaseCollection{constructor(){super(...arguments),this.checksum=void 0,this.flushCountsTimer=new o.ShiftTimer((()=>{this.hasPendingCounts()&&this.flushCounts()})),this.sortQuickReply=(e,t)=>e.totalCount===t.totalCount?e.id<t.id?-1:1:e.totalCount>t.totalCount?-1:1,this.onCountsFlushed=e=>{let{id:t,count:n}=e;const r=this.get(t);r&&(r.count=n,r.pendingCount=0)}}delete(){super.delete(),delete this.checksum}filterShortcuts(e){return this.filter((t=>{let{shortcut:n}=t;return n.toLowerCase().startsWith(e.toLowerCase())})).sort(this.sortQuickReply)}sync(e){(0,f.addSmartDefaults)(),u.GK.supportsFeature(u.GK.F.QUICK_REPLIES_QUERY)&&(this.synced()&&this.checksum===e?this.hasPendingCounts()&&this.flushCounts():this.findQuery({}).catch((0,a.filteredCatch)(s.WebdDrop,(()=>{}))))}periodicFlush(){u.GK.supportsFeature(u.GK.F.QUICK_REPLIES_QUERY)&&this.flushCountsTimer.debounceAndCap(2e3,5e3)}updateChecksum(e){this.checksum=e}synced(){return void 0!==this.checksum}hasPendingCounts(){return this.some((e=>{let{pendingCount:t}=e;return t>0}))}getAllPendingCounts(){const e={};return this.forEach((t=>{let{id:n,pendingCount:r}=t;r>0&&(e[n]=r)})),e}flushCounts(){if((0,l.isMDBackend)())throw new Error("This call is only supported in non-MD mode");const e=this.getAllPendingCounts();h.default.flushQuickReplyCounts(e).then((t=>{t.checksum&&this.updateChecksum(t.checksum),t.data.filter((t=>{let{id:n}=t;return void 0!==e[n]})).forEach(this.onCountsFlushed)})).catch((0,a.filteredCatch)(s.WebdDrop,(()=>{})))}_findQuery(){var e=this;return(0,i.default)((function*(){if((0,l.isMDBackend)())throw new Error("This call is only supported in non-MD mode");const t=e.getAllPendingCounts(),n=yield h.default.queryQuickReplies(t);return n.checksum&&e.updateChecksum(n.checksum),n.data.filter((e=>{let{id:n}=e;return void 0!==t[n]})).forEach(e.onCountsFlushed),n.data}))()}handle(e){e.checksum&&this.updateChecksum(e.checksum);const t=[],n=[];e.quickReplies.forEach((e=>{"delete"===e.type?t.push(e):n.push(e)})),this.remove(t.map((e=>{let{id:t}=e;return t}))),this.add(n,{merge:!0})}}t.QuickReplyCollectionImpl=_,_.model=p.default,_.cachePolicy={id:"quick_replies_collection",policy:c.CACHE_POLICY.LOAD,delay:2e3};const g=new _;t.QuickReplyCollection=g},47787:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addSmartDefaults=function(){(function(){const e=o.QuickReplyTypes.PROFILE_SMART_DEFAULT,t=function(){const e=a.ContactCollection.get((0,s.getMaybeMeUser)());if(e){const t=o.QuickReplyTypes.PROFILE_SMART_DEFAULT;return new l.default({id:t,shortcut:i.fbt._("profile",null,{hk:"10UPRT"}).toString(),message:e.displayName,count:-1,keywords:[]})}}(),r=n(99662).QuickReplyCollection;r.get(e)?t&&r.add({id:e,message:t.message},{merge:!0}):t&&r.add(t,{merge:!0})})(),function(){const e=o.QuickReplyTypes.ADDRESS_SMART_DEFAULT,t=function(){const e=n(93581).BusinessProfileCollection.get((0,s.getMaybeMeUser)());if((null==e?void 0:e.latitude)||(null==e?void 0:e.longitude)||(null==e?void 0:e.address)){const t=o.QuickReplyTypes.ADDRESS_SMART_DEFAULT,n=e.address||i.fbt._("Map Location",null,{hk:"3wlwI4"});return new l.default({id:t,shortcut:i.fbt._("address",null,{hk:"38K1PS"}).toString(),message:i.fbt._("{pinEmoji} {address}",[i.fbt._param("pinEmoji",""),i.fbt._param("address",n)],{hk:"huwFP"}).toString(),count:-1,keywords:[]})}}(),r=n(99662).QuickReplyCollection;r.get(e)?t&&r.add({id:e,message:t.message},{merge:!0}):t&&r.add(t,{merge:!0})}(),function(){const e=o.QuickReplyTypes.HOURS_SMART_DEFAULT,t=function(){var e;const t=n(93581).BusinessProfileCollection,r=n(94010).quickReplyHoursStr,a=t.get((0,s.getMaybeMeUser)());if(null==a||null===(e=a.businessHours)||void 0===e?void 0:e.config){const e=o.QuickReplyTypes.HOURS_SMART_DEFAULT,t=r(a.businessHours);return new l.default({id:e,shortcut:i.fbt._("hours",null,{hk:"1WmWJY"}).toString(),message:t,count:-1,keywords:[]})}}(),r=n(99662).QuickReplyCollection;r.get(e)?t&&r.add({id:e,message:t.message},{merge:!0}):t&&r.add(t,{merge:!0})}()};var i=n(48360),a=n(19380),o=n(65563),s=n(99234),l=r(n(47169))},89310:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(89867)),a=n(11290);class o extends a.BaseModel{constructor(){super(...arguments),this.id=(0,a.prop)()}contact(){return n(19380).ContactCollection.gadd(this.id)}getCollection(){return n(32826).BlocklistCollection}}o.Proxy="blocklist",o.idClass=i.default;var s=(0,a.defineModel)(o);t.default=s},32826:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.BlocklistCollectionImpl=t.BlocklistCollection=void 0;var i=n(1255),a=r(n(89310));class o extends i.BaseCollection{constructor(){super(),this.listenTo(this,"add",this.blockContact),this.listenTo(this,"remove",this.unblockContact)}blockContact(e){e.contact().isContactBlocked=!0}unblockContact(e){e.contact().isContactBlocked=!1}}t.BlocklistCollectionImpl=o,o.model=a.default;const s=new o;t.BlocklistCollection=s},15871:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(11290);class i extends r.BaseModel{constructor(){super(...arguments),this.id=(0,r.prop)(),this.displayText=(0,r.prop)(),this.selected=(0,r.session)(!1)}}i.Proxy="replyButton";var a=(0,r.defineModel)(i);t.default=a},47688:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ButtonCollection=void 0;var i=n(1255),a=r(n(15871));class o extends i.BaseCollection{}t.ButtonCollection=o,o.model=a.default},63183:(e,t,n)=>{"use strict";var r=n(59182).default,i=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ConversationEndOfHistoryTransferModelPropType=t.Chat=t.CHAT_KIND=void 0,t.getForwardedMessageFields=Qe;var a=i(n(48926)),o=i(n(81109)),s=i(n(57557)),l=i(n(2525)),c=i(n(91966)),d=i(n(75472)),u=i(n(66678)),p=i(n(41609)),f=i(n(23279)),h=n(89385),_=n(50796),g=i(n(27722)),m=i(n(11782)),y=i(n(45095)),E=n(13959),S=n(4352),v=n(35470),T=i(n(85074)),b=n(92574),C=n(88555),A=n(40234),P=n(13042),M=i(n(64369)),O=$e(n(35232)),I=i(n(65212)),w=n(15461),R=n(76562),D=n(64603),L=i(n(89867)),N=n(45454),k=n(48360),U=n(57849),G=n(46331),x=n(48504),B=n(11290),F=i(n(54248)),j=n(48285),Y=i(n(6977)),K=i(n(77653)),W=i(n(65568)),H=n(51612),V=i(n(21423)),$=i(n(16173)),z=n(88102),q=n(17239),J=i(n(96563)),Q=n(19380),X=i(n(35667)),Z=n(47473),ee=n(24606),te=n(60324),ne=i(n(63236)),re=n(99234),ie=i(n(78542)),ae=n(7293),oe=n(57701),se=n(29331),le=i(n(14296)),ce=n(35389),de=n(41566),ue=n(78986),pe=i(n(11339)),fe=n(17304),he=n(59871),_e=n(55843),ge=n(54676),me=n(72472),ye=n(6684),Ee=n(371),Se=n(68315),ve=n(91450),Te=n(82039),be=i(n(6704)),Ce=n(81027),Ae=n(86657),Pe=n(75887),Me=(n(13705),n(19569)),Oe=n(69694),Ie=n(92052),we=n(30152),Re=n(19011),De=i(n(58492)),Le=$e(n(47272)),Ne=n(70768),ke=n(37894),Ue=i(n(41809)),Ge=n(43323),xe=n(27211),Be=n(58871),Fe=i(n(87798)),je=n(84728),Ye=i(n(35609)),Ke=i(n(56891)),We=n(65044),He=n(85893);function Ve(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(Ve=function(e){return e?n:t})(e)}function $e(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=Ve(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}return r.default=e,n&&n.set(e,r),r}const ze=n(76672)({COMPLETE_BUT_MORE_MESSAGES_REMAIN_ON_PRIMARY:0,COMPLETE_AND_NO_MORE_MESSAGE_REMAIN_ON_PRIMARY:1,INCOMPLETE:2,NOT_INCLUDED_IN_HIST_SYNC:3});t.ConversationEndOfHistoryTransferModelPropType=ze;const qe={GROUP:"group",BROADCAST:"broadcast",CHAT:"chat"};t.CHAT_KIND=qe;class Je extends De.default{constructor(){super(...arguments),this.id=(0,B.prop)(),this.t=(0,B.prop)(),this.unreadCount=(0,B.prop)(0),this.archive=(0,B.prop)(),this.isReadOnly=(0,B.prop)(),this.isAnnounceGrpRestrict=(0,B.prop)(),this.modifyTag=(0,B.prop)(),this.muteExpiration=(0,B.prop)(0),this.name=(0,B.prop)(),this.notSpam=(0,B.prop)(),this.pin=(0,B.prop)(),this.labels=(0,B.prop)(),this.changeNumberOldJid=(0,B.prop)(),this.changeNumberNewJid=(0,B.prop)(),this.lastReceivedKey=(0,B.prop)(),this.ephemeralDuration=(0,B.prop)(),this.ephemeralSettingTimestamp=(0,B.prop)(),this.disappearingModeInitiator=(0,B.prop)(),this.createdLocally=(0,B.session)(),this.pendingAction=(0,B.session)(),this.formattedTitle=(0,B.session)(),this.active=(0,B.session)(),this.pausedTimerId=(0,B.session)(),this.presenceResendTimerId=(0,B.session)(),this.recording=(0,B.session)(),this.typing=(0,B.session)(),this.colors=(0,B.session)(),this.composeContents=(0,B.session)((()=>({}))),this.attachMediaContents=(0,B.session)(),this.pttRecordingSession=(0,B.session)(),this.squelch=(0,B.session)(),this.reactionSquelch=(0,B.session)(),this.pendingSeenCount=(0,B.session)(0),this.unreadMsgAnchor=(0,B.session)(),this.markedUnread=(0,B.session)(),this.trusted=(0,B.session)(),this.canSend=(0,B.session)(),this.promises=(0,B.session)((()=>({}))),this.ftsCache=(0,B.session)((()=>({}))),this.composeQuotedMsg=(0,B.session)(),this.composeQuotedMsgRemoteJid=(0,B.session)(),this.quotedMsgAdminGroupJid=(0,B.session)(),this.quotedMsgAdminGroupSubject=(0,B.session)(),this.quotedMsgAdminParentGroupJid=(0,B.session)(),this.groupMetadata=(0,B.session)(),this.presence=(0,B.session)(),this.mute=(0,B.session)(),this.contact=(0,B.session)(),this.liveLocation=(0,B.session)(),this.liveLocationQueried=(0,B.session)(!1),this.ackedProps=(0,B.session)((()=>({}))),this.mediaCount=(0,B.session)(0),this.linkCount=(0,B.session)(0),this.docCount=(0,B.session)(0),this.productCount=(0,B.session)(0),this.isParentGroup=(0,B.session)(),this.unreadMentionsOfMe=(0,B.prop)(),this.unreadMentionCount=(0,B.prop)(),this.hasUnreadMention=(0,B.prop)(!1),this.archiveAtMentionViewedInDrawer=(0,B.prop)(!1),this.hasChatBeenOpened=(0,B.prop)(!1),this.tcToken=(0,B.prop)(),this.tcTokenTimestamp=(0,B.prop)(),this.tcTokenSenderTimestamp=(0,B.prop)(),this.msgUnsyncedButtonReplyMsgs=(0,B.prop)(),this.vcardDismissed=(0,B.session)(!1),this.endOfHistoryTransfer=(0,B.session)(!1),this.endOfHistoryTransferType=(0,B.prop)(),this.hasEstablishedE2EESession=(0,B.session)(!1),this.pendingInitialLoading=(0,B.prop)(!1),this.kind=(0,B.derived)((function(){return L.default.isGroup(this.id)?qe.GROUP:L.default.isBroadcast(this.id)?qe.BROADCAST:L.default.isUser(this.id)?qe.CHAT:void __LOG__(2)`chat:unknown kind id:${this.id.toString()}`})),this.isUser=(0,B.derived)((function(){return L.default.isUser(this.id)})),this.isPSA=(0,B.derived)((function(){return L.default.isPSA(this.id)})),this.isGroup=(0,B.derived)((function(){return L.default.isGroup(this.id)})),this.isBroadcast=(0,B.derived)((function(){return L.default.isBroadcast(this.id)})),this.isBusinessGroup=(0,B.derived)((function(){var e;const t=null===(e=this.groupMetadata)||void 0===e?void 0:e.participants.getAdmins();if(!t)return!1;for(const e of t){const t=Q.ContactCollection.get(e.id);if(null==t?void 0:t.isBusiness)return!0}return!1})),this.canUnread=(0,B.derived)((function(){return!this.isBroadcast})),this.hasUnread=(0,B.derived)((function(){return 0!==this.unreadCount}),["unreadCount"]),this.optimisticUnreadCount=(0,B.derived)((function(){const{unreadCount:e,pendingSeenCount:t}=this;return e===M.default.MARKED_AS_UNREAD?e:Math.max(0,e-t)}),["unreadCount","pendingSeenCount"]),this.shouldShowUnreadDivider=(0,B.derived)((function(){if(0===this.unreadCount)return!1;if(this.unreadMsgAnchor){const{msgChunk:e}=this.unreadMsgAnchor,t=e?e.getModelsArray():[];return this.unreadMsgAnchor!==t.find((e=>e.isUnreadType))}if(this.msgs.msgLoadState.noEarlierMsgs){return this.msgs.filter((e=>e.isUnreadType)).length!==this.unreadCount}return!0}),["unreadCount","unreadMsgAnchor"]),this.shouldAppearInList=(0,B.derived)((function(){if((0,C.isMDBackend)()&&this.isBroadcast)return!1;if(L.default.isStatusV3(this.id))return!1;if((0,C.isMDBackend)()&&this.endOfHistoryTransferType===ze.NOT_INCLUDED_IN_HIST_SYNC&&0===this.msgs.length)return!1;if(this.isGroup&&!0===this.isParentGroup)return!1;if(this._shouldAppearInListLatched)return!0;const e=this.msgs.some((e=>!(e.type===w.MSG_TYPE.GROUPS_V4_INVITE&&e.from.equals((0,re.getMaybeMeUser)())||e.isInitialE2ENotification||e.type===w.MSG_TYPE.CALL_LOG||e.isBizNotification||"change_number"===e.subtype||e.isDisappearingModeSystemMessage)));return this._shouldAppearInListLatched=!this.createdLocally||e,this._shouldAppearInListLatched}),["createdLocally","msgs","msgsLength","isParentGroup"]),this.previewMessage=(0,B.derived)((function(){for(let e=this.msgs.length-1;e>=0;e--){const t=this.msgs.at(e);if(t&&t.type!==w.MSG_TYPE.E2E_NOTIFICATION&&t.type!==w.MSG_TYPE.NOTIFICATION_TEMPLATE&&t.type!==w.MSG_TYPE.REACTION)return t}if(this.msgs.length>0)return this.msgs.last()}),["msgs","msgsChanged"]),this.showChangeNumberNotification=(0,B.derived)((function(){if(!ae.GK.supportsFeature(ae.GK.F.CHANGE_NUMBER_V_2))return!1;const{changeNumberOldJid:e,changeNumberNewJid:t,id:n,isUser:r}=this;if(!r)return!1;if(!e&&!t)return!1;const i=Q.ContactCollection.get(t||n);return!(null==i?void 0:i.isMyContact)}),["changeNumberOldJid","changeNumberNewJid","id","isUser"]),this.shouldShowUnreadInTitle=(0,B.derived)((function(){const e=!!this.muteExpiration;if(this.archive)return!1;if(this.optimisticUnreadCount<=0)return!1;if(!this.isGroup)return!e;if(!e)return!0;if(!this.msgs||0===this.msgs.length)return!1;let t=!1;const n=this.msgs,r=this.optimisticUnreadCount;let i=Math.max(0,n.length-r);for(;i<n.length;i++){const e=this.msgs.at(i);if(!e)continue;const n=(0,re.getMaybeMeUser)();if(e.isMentioned(n)||e.isQuoted(n)){const n=this.getCollection().get(e.sender);if(!n||!n.muteExpiration){t=!0;break}}}return t}),["isGroup","archive","optimisticUnreadCount","muteExpiration"]),this.deleteSignal=(0,B.derived)((function(){return this._abortController.signal}))}initialize(){super.initialize(),this.addQueue=new g.default,this.sendQueue=new g.default,this._ephemeralMessagesToDelete=new Set,this._ephemeralMessageTimerIds=new Map,this._abortController=new r,this.msgs.msgLoadState.contextLoaded=!0,this.addChild("presence",Se.PresenceCollection.gadd(this.id));const e=me.MuteCollection.get(this.id);if(e?this.addChild("mute",e):this.addChild("mute",me.MuteCollection.gadd({id:this.id,expiration:this.muteExpiration})),this.listenTo(this.mute,"change:expiration",this.updateMuteExpiration),this.addChild("contact",Q.ContactCollection.gadd(this.id)),this.name&&!this.contact.name){const e={name:this.name};this.isGroup?this.contact.set(e):(0,xe.updateLocal)(this.contact.id,e).then((()=>{this.contact.set(e)}))}if(this.listenTo(this.contact,"change:name",this.updateTitle),this.listenTo(this.contact,"change:isContactBlocked",this.updateCanSend),this.isGroup&&(this.trusted=!0),this.listenTo(Ne.TosManager,"change",this.updateCanSend),this.listenTo(this.contact,"change:privacyMode",this.updateCanSend),this.isGroup||this.isBroadcast){const e=this.getGroupMetadataCollection();let t;this.isBroadcast&&!e.get(this.id)&&(t=!0);const n=e.gadd(this.id);if(this.addChild("groupMetadata",n),this.listenTo(n,"change:stale change:announce",this.updateIsAnnounceGrpRestrict),this.listenTo(n.participants,"change:isAdmin add remove",this.updateIsAnnounceGrpRestrict),this.listenTo(n,"change:trusted change:stale",this.isTrusted),this.listenTo(n,"change:participants change:stale",this.updateReadOnly),this.listenTo(n.participants,"change:contact.formattedShortName",this.updateTitle),(0,de.isGroupCatchUpEnabled)()){if(this.unreadMentionsOfMe){const e=this.unreadMentionsOfMe.map((e=>new Ue.default({id:e.id,timestamp:e.timestamp})));n.unreadMentionMetadata.addUnreadMentions(e,Ge.UnreadMessageType.PERSISTANCE_LOAD)}null!=this.unreadMentionCount&&(n.unreadMentionMetadata.pendingUnreadMentionCount=this.unreadMentionCount),this._handleUnreadMention(),this.listenTo(n.unreadMentionMetadata.unreadMentionCollection,"add remove reset",this._handleUnreadMention),this.listenTo(n.unreadMentionMetadata,"change:pendingUnreadMentionCount",this._handleUnreadMention)}this.updateReadOnly(),this.updateIsAnnounceGrpRestrict();const r=this.id;this.listenTo(this,"change:isReadOnly",(function(){this.isTrusted(),this.updateCanSend(),Te.ProfilePicThumbCollection.update(r).catch((0,_.filteredCatch)(b.WebdDrop,(()=>{}))),e.update(r).catch((0,_.filteredCatch)(b.WebdDrop,(()=>{})))})),this.listenTo(this,"change:isAnnounceGrpRestrict",this.updateCanSend),this.listenTo(this,"change:archive",(()=>{!0===this.archive&&(0,x.shouldEnableArchiveV2)()&&(0,Ie.setArchiveEnabledSetting)(!0)})),this.listenTo(n,"change:isParentGroup",(()=>{this.isParentGroup=n.isParentGroup})),this.isParentGroup=n.isParentGroup,t&&e.update(r).catch((0,_.filteredCatch)(b.WebdDrop,(()=>{})))}else this.listenTo(this.presence,"change:isOnline",(()=>(0,Ee.presenceOnlineChanged)(this)));const t=this.getCollection();t.notSpam[this.id]&&!this.notSpam&&(0,Me.sendNotSpam)(this).catch((()=>{})),t.notSpam[this.id]=!!this.notSpam,this.notSpam||this.listenTo(this,"change:notSpam",this.onNotSpamChange),this.updateTitle(),this.isTrusted(),this.updateCanSend(),this.listenTo(this.contact,"change:isMyContact",this.isTrusted),this.listenTo(this.msgs,"add",this.onNewMsg),this.listenTo(this.msgs,"update_sort_time",this.updateSortTime),this.listenTo(this.msgs,"bulk_add",this.addMediaMsgs),this.listenTo(this.msgs,"add",this._deregisterExpiredViewOnceMessage),this.listenTo(this.msgs,"bulk_add",this.deregisterExpiredViewOnceBulkMessages),this.listenTo(this.msgs,"add remove change:ephemeralExpirationTimestamp change:keptBy",this._resetEphemeralMessageExpirationTimer),this.listenTo(this.msgs,"bulk_add",(e=>{e.forEach((e=>{this._resetEphemeralMessageExpirationTimer(e)}))})),this.listenTo(this,"change:msgs",this.resetMediaMsgs),this._saveAssignedColors=(0,f.default)(this.saveAssignedColors,1e3),this.listenTo(this,"change:active",this._handleActiveUpdate),this.pendingAction=0,this.listenTo(this,"change:t change:modifyTag",this._clearFtsCache),this.listenTo(le.default,"locale_change",(()=>{this.updateTitle()})),q.Conn.isSMB&&(0,ce.initializeLabels)(this)}_handleUnreadMention(){this.isGroup&&this.groupMetadata&&(0,de.isElevatedImportantMessageEnabled)()&&(this.hasUnreadMention=this.groupMetadata.unreadMentionMetadata.getUnreadMentionCount()>0)}isSupportGroup(){var e;return this.isGroup&&!0===(null===(e=this.groupMetadata)||void 0===e?void 0:e.support)}isSupportGroupOrSupportAdmin(){return this.isSupportGroup()||(0,ie.default)(this.id.user)}set(e,t,n){"string"==typeof e?"muteExpiration"===e&&this.mute&&this.mute.setMute(t):e.hasOwnProperty("muteExpiration")&&this.mute&&this.mute.setMute(e.muteExpiration);return super.set(e,t,n)}addPendingAction(e){const t=()=>{this.decPending()};e.then(t,t),this.pendingAction++}decPending(){this.pendingAction>0?this.pendingAction--:(__LOG__(2)`chat:onPendingActionUpdate pendingAction value is invalid`,this.pendingAction=0)}_handleActiveUpdate(){this.isGroup&&this.active&&(this.squelch=M.default.SQUELCH_RESET_VALUE,this.reactionSquelch=M.default.SQUELCH_RESET_VALUE,this.hasChatBeenOpened=!0),this.presence.chatActive=this.active,this.active||(this.msgs.filter((e=>(0,je.isExpired)(e.safe()))).forEach(ue.deregisterMsg),(0,C.isMDBackend)()&&(0,te.removeExpiredMessagesFromHistory)(Array.from(this._ephemeralMessagesToDelete)).then((()=>{if((0,oe.receiveReactionsEnabled)()){const e=Array.from(this._ephemeralMessagesToDelete).map((e=>e.id.toString()));if(e.length>0){(0,n(68819).getJobManager)().waitUntilPersisted(ye.jobSerializers.deleteReactions(this.id.toString(),e))}}})),this._ephemeralMessagesToDelete.forEach((e=>{this._ephemeralMessagesToDelete.delete(e),e.delete({skipUpdatingSortTime:!0,doNotResetLastReceived:!0})})))}onPendingActionUpdate(){this.pendingAction<0&&(__LOG__(2)`chat:onPendingActionUpdate pendingAction value is invalid`,this.pendingAction=0)}onNotSpamChange(){var e;(this.getCollection().notSpam[this.id]=this.notSpam,this.isGroup)&&(null===(e=this.groupMetadata)||void 0===e||e.set({notAddedByContact:!1}));this.isTrusted(),this.notSpam&&this.stopListening(this,"change:notSpam")}hasMaybeSentMsgToChat(){return this.getAllMsgs().some((e=>e.isSentByMe))}isTrusted(){let e=!1;var t;this.isGroup?e=this.isReadOnly||this.notSpam||(null===(t=this.groupMetadata)||void 0===t?void 0:t.isTrusted()):this.isBroadcast?e=!0:this.isUser&&(e=this.notSpam||this.contact.isMyContact);return!e&&this.hasMaybeSentMsgToChat()&&(e=!0),this.trusted=Boolean(e)}updateMuteExpiration(){const e=Number(this.mute.expiration);(0,Be.updateLocal)(this.id,{muteExpiration:e}).then((()=>this.muteExpiration=e))}updateTitle(){var e,t;this.isBroadcast?this.formattedTitle=this.contact.name||(null!==(e=null===(t=this.groupMetadata)||void 0===t?void 0:t.participants)&&void 0!==e?e:[]).map((function(e){return e.contact.formattedShortName})).join(", "):this.isUser?this.formattedTitle=this.contact.getFormattedUser()||"":this.isGroup&&(this.formattedTitle=this.contact.name)}isSuspendedGroup(){if((0,C.isMDBackend)()){var e;return(0,U.getABPropConfigValue)("group_suspend_v0_enabled")&&this.isGroup&&!!(null===(e=this.groupMetadata)||void 0===e?void 0:e.suspended)}return!1}shouldHideParticipants(){return this.isSuspendedGroup()&&(0,U.getABPropConfigValue)("group_suspend_v1_enabled")}isTerminatedGroup(){var e;return this.isGroup&&!!(null===(e=this.groupMetadata)||void 0===e?void 0:e.terminated)}isInviteGrowthLockedGroup(){var e;return!(!(0,C.isMDBackend)()||!(0,U.getABPropConfigValue)("growth_lock_v0_enabled"))&&(this.isGroup&&"invite"===(null===(e=this.groupMetadata)||void 0===e?void 0:e.growthLockType)&&(this.groupMetadata.growthLockExpiration||0)>A.Clock.globalUnixTime())}title(){return this.isGroup?this.formattedTitle||k.fbt._("unknown subject",null,{hk:"3Lg3Zm"}).toString():this.formattedTitle}getTcToken(){return(0,C.isMDBackend)()?null==this.tcToken||null==this.tcTokenTimestamp||(0,D.isTokenExpired)(this.tcTokenTimestamp,D.TcTokenMode.Receiver)?null:this.tcToken:null}isPresenceUnknown(){return!(!(0,C.isMDBackend)()||!(0,U.getABPropConfigValue)("trusted_contacts_ti")||null!=this.getTcToken())}updateCanSend(){return this.isReadOnly||this.isAnnounceGrpRestrict||(0,ke.shouldBlockByTos)(this.contact)||(0,Z.shouldBlockByCountry)(this.contact)?this.canSend=!1:this.isUser?this.canSend=!(this.contact.isContactBlocked||this.isPSA):this.canSend=!0}delete(){super.delete(),this.getCollection().remove(this.id),this._abortController.abort(),this.presence.delete(),this.liveLocation&&this.liveLocation.delete(),z.Cmd.closeChat(this),this.groupMetadata&&this.groupMetadata.delete(),this.mediaMsgs&&this.mediaMsgs.delete(),this.linkMsgs&&this.linkMsgs.delete(),this.docMsgs&&this.docMsgs.delete(),this.productMsgs&&this.productMsgs.delete();const e=this.starredMsgs;e&&(e.delete(),e.stopListening(),e.reset()),this.receivedVcardMsgs&&this.receivedVcardMsgs.delete(),(0,re.deleteComposeContents)(this.id)}isDirty(){return 0!==this.unreadCount}resetMediaMsgs(){const{mediaMsgs:e,linkMsgs:t,docMsgs:n,productMsgs:r}=this;e&&(e.delete(),e.queryMedia({chat:this})),t&&(t.delete(),t.queryLinks(this)),n&&(n.delete(),n.queryDocs(this)),r&&(r.delete(),r.queryProducts(this))}isMsgForMediaCollection(e){return e.isMedia&&!e.isViewOnce}addMediaMsgs(e,t){if(!e)return;const n=Array.isArray(e)?e:[e],r=[],i=[],a=[],s=[];n.forEach((e=>{this.isMsgForMediaCollection(e)&&r.push(e),e.asDoc&&a.push(e),e.linkPreview&&i.push(e),null!=e.asProduct&&s.push(e)}));const{mediaMsgs:l}=this;if(l&&r.length){const e=(0,oe.isMediaGalleryFixEnabled)()?(0,o.default)((0,o.default)({},t),{},{silent:!1}):(0,o.default)({},t);l.add(r,e)}this.linkMsgs&&i.length&&this.linkMsgs.add(i,t),this.docMsgs&&a.length&&this.docMsgs.add(a,t),this.productMsgs&&s.length&&this.productMsgs.add(s,t)}onNewMsg(e){var t=this;if(!e)return;let n=Promise.resolve();e.isSentByMe&&!this.notSpam&&(n=(0,Be.updateLocal)(this.id,{notSpam:!0}).then((()=>this.notSpam=!0))),"i"!==e.eventType&&n.then((0,a.default)((function*(){const n={};if((0,C.isLegacyWebdBackend)()&&(n.t=e.t),t.promises.updateSortTime&&t.promises.updateSortTime.abortController.abort(),t.updateMediasCountOnMsg(e),((0,C.isLegacyWebdBackend)()||(0,C.isMDBackend)()&&e.isSentByMeFromWeb)&&t.archive&&(0,x.shouldUnarchiveChat)(e.isSentByMe)&&(n.archive=!1),t.promises.setArchive&&t.promises.setArchive.abortController.abort(),e.isSentByMe?t.markedUnread=!1:((0,F.default)({id:t.id,participant:e.author,type:"paused"},!1),(0,C.isLegacyWebdBackend)()&&("a"!==e.eventType&&"d"!==e.eventType||(n.unreadCount=t.unreadCount+1||1))),yield(0,Be.updateLocal)(t.id,n),(0,C.isMDBackend)())try{const{unreadCount:e,timestamp:r}=yield(0,j.getChatMeta)(t.id);n.t=r,n.unreadCount=e}catch(e){__LOG__(4,void 0,new Error)`onNewMsg: unable to find metadata from chat table for id:${t.id.toString()}`}return n}))).then((t=>{e.isSentByMeFromWeb&&e.sendDeferred?this.setAndKeepPrevious(t,e.sendDeferred.promise):this.set(t);const n=X.default.get(this.id);if(n&&(n.timestamp=A.Clock.globalUnixTime()),"gp2"!==e.type||"add"!==e.subtype&&"create"!==e.subtype||this.getGroupMetadataCollection().trigger(`group_participant_change_${(0,re.getMaybeMeUser)().toString()}`,this.id),!e.isSentByMe){switch(e.eventType){case"d":case"a":"d"===e.eventType&&z.Cmd.alertNewMsg(e),this.msgs.length<P.MSG_PRELOAD_THRESHOLD&&this.loadEarlierMsgs(void 0,pe.default.WEBC_QUERY_TRIGGER_TYPE.NEW_MESSAGE_PREFETCH).catch((0,_.filteredCatch)(b.E404,(()=>{}))).catch((e=>{__LOG__(2)`chat:onNewMsg failed\n${e}`}));break;case"n":e.type===w.MSG_TYPE.CALL_LOG&&z.Cmd.alertNewMsg(e);break;case"s":if("gp2"===e.type&&"add"===e.subtype&&(0,re.getMaybeMeUser)().equals(e.recipients[0])&&!this.contact.name)return;z.Cmd.alertNewMsg(e);this.getGroupMetadataCollection().trigger(`group_participant_change_${(0,re.getMaybeMeUser)().toString()}`,this.id)}const n=e.mediaData;if(!n||"image"!==n.type&&"video"!==n.type||z.Cmd.newMediaMsg(e),(0,C.isMDBackend)()&&t.unreadCount&&(0,se.processOrphanPeerReceipt)(e.id),(0,de.isGroupCatchUpEnabled)()&&(0,ge.isImportantMessage)(e)){var r;const t=new Ue.default({id:e.id.toString(),timestamp:e.t});if(null===(r=this.groupMetadata)||void 0===r||r.unreadMentionMetadata.addUnreadMentions(t,Ge.UnreadMessageType.NEW_MESSAGE),this.archiveAtMentionViewedInDrawer){const e=new Map;e.set(this.id.toString(),!1),(0,j.updateChatArchiveDrawer)(e),this.archiveAtMentionViewedInDrawer=!1}}}}))}canPin(){var e;if(this.archive)return!1;const t=null===(e=this.promises)||void 0===e?void 0:e.setArchive;return!(null==t?void 0:t.archive)}canArchive(){return!this.isBroadcast||ae.GK.supportsFeature(ae.GK.F.ARCHIVE_BROADCAST)}sendDismissChangeNumber(){if(this.promises.sendDismissChangeNumber)return this.promises.sendDismissChangeNumber;const e=(0,C.isMDBackend)()?Promise.resolve({status:200,_duplicate:null}):Ke.default.sendConversationDismissChangeNumber(this.id);this.promises.sendDismissChangeNumber=e;const t=new G.ActionType(k.fbt._("Dismissing change number notification.",null,{hk:"XSlwz"})),n=e.then((e=>200===e.status?new G.ActionType(k.fbt._("Change number notification dismissed.",null,{hk:"1QpySR"})):e.status>=400?new G.ActionType(k.fbt._("Couldn't dismiss change number notification.",null,{hk:"4BWKLI"})):void 0)).catch((()=>(__LOG__(3)`models:chat:sendDismissChangeNumber dropped`,new G.ActionType(k.fbt._("Couldn't dismiss change number notification.",null,{hk:"4BWKLI"}),{actionText:le.default.t(129),actionHandler:this.sendDismissChangeNumber.bind(this)}))));return z.Cmd.openToast((0,He.jsx)(G.ActionToast,{id:(0,G.genId)(),initialAction:t,pendingAction:n})),e.then((e=>{if(200===e.status&&!e._duplicate)return(0,Be.updateLocal)(this.id,{changeNumberNewJid:void 0,changeNumberOldJid:void 0}).then((()=>{this.changeNumberOldJid=this.changeNumberNewJid=void 0}))})).finally((()=>{this.promises.sendDismissChangeNumber=null}))}setComposeContents(e){this.composeContents=e}getSessionPersistedComposeContents(){return(0,re.getComposeContents)(this.id)}getComposeContents(){return(0,p.default)(this.composeContents)?this.getSessionPersistedComposeContents()||{}:this.composeContents}setAttachMediaContents(e){this.attachMediaContents=e}preload(){1===this.msgs.length&&this.loadEarlierMsgs().catch((0,_.filteredCatch)(b.E404,(()=>{}))).catch((e=>{__LOG__(2)`chat:preload failed\n${e}`}))}onEmptyMRM(){__LOG__(2)`models:Chat:removeMsg 0 messages left, querying...`,this.loadEarlierMsgs().catch((0,_.filteredCatch)(b.E404,(()=>{}))).catch((e=>{__LOG__(2)`chat:onEmptyMRM failed\n${e}`}))}loadEarlierMsgs(e,t,n){var r=this;return(0,a.default)((function*(){(0,C.isMDBackend)()&&(yield r.waitForChatLoading());let i=e;const a=null!=t?t:pe.default.WEBC_QUERY_TRIGGER_TYPE.USER_SCROLL;if(i||(i=r.msgs),i.msgLoadState.noEarlierMsgs)return Promise.resolve();if(i.msgLoadState.isLoadingEarlierMsgs)return i.loadEarlierPromise;const o=i?i.head():null,s=yield r._loadMsgs("before",i,a,n),l=o?o.msgChunk:i;return l&&Array.isArray(s)&&s.length<P.PAGE_SIZE&&(l.msgLoadState.noEarlierMsgs=!!(0,C.isLegacyWebdBackend)()||r.endOfHistoryTransferType!==ze.INCOMPLETE),l&&r.isMostRecentCMC(l)&&r.trigger("msgs:loadEarlier"),s}))()}isMostRecentCMC(e){return this.msgs===e}loadRecentMsgs(e,t){let n=e;return n||(n=this.msgs),this.isMostRecentCMC(n)?Promise.resolve():n.msgLoadState.isLoadingRecentMsgs?n.loadRecentPromise:this._loadMsgs("after",n,pe.default.WEBC_QUERY_TRIGGER_TYPE.USER_SCROLL,t)}_loadMsgs(e,t,n,r){let i;i="after"===e?t.last():t.head();let a={};i?a=i.id.clone():a.remote=this.id,a.count=P.PAGE_SIZE,a.direction=e;const o=(0,_e.newMessageQueryEvent)(n);return this._loadMsgsPromiseLoop(i,t,he.MsgCollection.findQuery.bind(he.MsgCollection,a,{logOnSend:e=>{o.webcResponseBytes+=e.binarySize}}),e,o,!0,r)}_updateMsgLoadState(e,t,n){const r=(null==e?void 0:e.msgChunk)&&e.msgChunk!==t;t.msgLoadState.contextLoaded=!0,e&&r&&((0,y.default)(e.msgChunk,"msg.msgChunk").msgLoadState.contextLoaded=!0),"after"===n?t.msgLoadState.isLoadingRecentMsgs=!1:"before"===n?t.msgLoadState.isLoadingEarlierMsgs=!1:"around"===n&&(t.msgLoadState.isLoadingAroundMsgs=!1)}_loadMsgsPromiseLoop(e,t,n,r,i){var o=this;let s=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],l=arguments.length>6?arguments[6]:void 0;const c=performance.now();"after"===r?(t.msgLoadState.isLoadingRecentMsgs=!0,i.webcMessageQueryType=pe.default.WEBC_MESSAGE_QUERY_DIRECTION.LOAD_NEXT):"before"===r?(t.msgLoadState.isLoadingEarlierMsgs=!0,i.webcMessageQueryType=pe.default.WEBC_MESSAGE_QUERY_DIRECTION.LOAD_PREV):"around"===r&&(t.msgLoadState.isLoadingAroundMsgs=!0,i.webcMessageQueryType=pe.default.WEBC_MESSAGE_QUERY_DIRECTION.LOAD_AROUND),i.webcBrowserNetworkType=(0,R.getEffectiveNetworkType)(),i.webcChatType=this.getWebcChatType(),"number"==typeof this.initialIndex&&(i.webcChatPosition=this.initialIndex);const d=(0,be.default)([l,this._abortController.signal].filter(Boolean),(s=>(0,S.promiseLoop)(function(){var l=(0,a.default)((function*(a,l,d){if(s.aborted)throw new h.AbortError;const u=(0,E.delayMs)(Le.expBackoff(d,12e4,1e3,.1));let p=Promise.resolve();(0,C.isLegacyWebdBackend)()&&"CONNECTED"!==We.Socket.stream&&(p=(0,Ye.default)(We.Socket,"change:stream",(()=>"CONNECTED"===We.Socket.stream)));try{yield p;const l=yield n();if(s.aborted)throw new h.AbortError;let d;i.webcQueryT=Math.ceil(performance.now()-c),Array.isArray(l[0])?(d=l[0][0],l.forEach((e=>(0,_e.logMessageCounts)(i,e)))):(d=l[0],(0,_e.logMessageCounts)(i,l)),d&&(i.webcEarliestMessageT=d.t,d.msgChunk===o.msgs&&(i.webcEarliestMessageIndex=o.msgs.length-1)),(0,ne.default)().then((e=>{e&&(i.webcBrowserStorageQuotaBytes=e.quota,i.webcBrowserStorageQuotaUsedBytes=e.usage)})).finally((()=>i.commit())),o._updateMsgLoadState(e,t,r),a(l)}catch(n){if(n.name===h.ABORT_ERROR)throw n;return d>3||404===n?(o._updateMsgLoadState(e,t,r),__LOG__(3)`chat:loadMsgs:error ${String(n)}`,404===n?Promise.reject(new b.E404):Promise.reject(new O.GaveUpRetry(`Gave up msg fetch after ${d} tries`))):u}}));return function(){return l.apply(this,arguments)}}(),0))).catch((0,_.filteredCatch)(O.GaveUpRetry,(()=>[]))).catch((0,_.filteredCatch)(b.E404,(e=>{if(s)return[];throw e})));return"after"===r?t.loadRecentPromise=d:"before"===r?t.loadEarlierPromise=d:"around"===r&&(t.loadAroundPromise=d),d}getSearchContext(e,t){let n,r=null;e instanceof fe.Msg?r=e:e instanceof I.default&&(n=e);let i=r?r.msgChunk:void 0;const a=Math.trunc(P.PAGE_SIZE/3*2);if(!i||!i.msgLoadState.contextLoaded){i||(i=new H.ChatMsgsCollection,this.msgChunks.push(i),r&&i.add(r));const e=r?r.id.clone():n.clone();e.count=a;const o=function(){if(r)return r.msgChunk;if(null!=n){const e=he.MsgCollection.get(n);return(null==e?void 0:e.msgChunk)?e.msgChunk:i}return i},s=(0,_e.newMessageQueryEvent)(pe.default.WEBC_QUERY_TRIGGER_TYPE.SEARCH_RESULT_CLICK);this._loadMsgsPromiseLoop(r,i,he.MsgCollection.getContext.bind(he.MsgCollection,e,o,(e=>{s.webcResponseBytes+=e.binarySize})),"around",s,null==t).then((e=>{const t=o();t&&i&&t!==i&&this.notifyMsgCollectionMerge(t,i,t);const s=e[0],l=n?he.MsgCollection.get(n):r;l&&Array.isArray(s)&&s.length<a&&((0,y.default)(l.msgChunk,"loadedMsg.msgChunk").msgLoadState.noEarlierMsgs=!!(0,C.isLegacyWebdBackend)()||this.endOfHistoryTransferType!==ze.INCOMPLETE,i&&l.msgChunk!==i&&(i.msgLoadState.noEarlierMsgs=!ae.GK.supportsFeature(ae.GK.F.MD_BACKEND)||this.endOfHistoryTransferType!==ze.INCOMPLETE))})).catch((()=>{t&&(t.isQuotedMsgAvailable=!1)}))}return{collection:i,msg:r,key:n,highlightMsg:!0}}sendStarMsgs(e,t){return this.promises.sendStarMsgs?this.promises.sendStarMsgs:this.promises.sendStarMsgs=(0,Oe.sendStarMsgs)(this.id,e,t).then((()=>{e.forEach((e=>{e.set("star",t)})),t?(0,Re.addStarredMsgs)(e):(0,Re.removeStarredMsgs)(e)})).finally((()=>{this.promises.sendStarMsgs=null}))}sendRevokeMsgs(e,t){return this.promises.sendRevokeMsgs?this.promises.sendRevokeMsgs:this.promises.sendRevokeMsgs=Promise.all(e.map((e=>(0,Ce.sendRevoke)(e,e.canSenderRevoke()?z.Revoke.Sender:z.Revoke.Admin,t)))).finally((()=>{this.promises.sendRevokeMsgs=null}))}sendDeleteMsgs(e,t){return this.promises.sendDeleteMsgs||(this.promises.sendDeleteMsgs=(0,Ae.sendDeleteMsgs)(e,t,this.id).then((()=>(e.forEach((e=>{e.delete()})),e.length))).catch((0,_.filteredCatch)(b.ServerStatusCodeError,(()=>{let t=0;return e.forEach((e=>{(e.ack===v.ACK.FAILED||e.isExpired())&&(e.delete(),t++)})),t}))).finally((()=>{this.promises.sendDeleteMsgs=null}))),this.promises.sendDeleteMsgs}deleteMsgs(e,t){this.deleteMsgsBeforeMsgInclusive(void 0,!e,t)}deleteMsgsOlderThan(e,t,n){const r=this.msgs;let i=r.head();!i||i.t>=e||(i=r.last(),i&&i.t<e?this.deleteMsgs(t,n):this.deleteMsgsPartial((function(r){return r&&(n&&!(0,ge.msgMatchesType)(r,n)||r.star&&!t||r.t>=e||r.isInitialE2ENotification)})))}deleteMsgsBeforeMsgInclusive(e){let t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2?arguments[2]:void 0;if(e){if(!this.msgs.get(e.id))return;t=this.msgs.indexOf(e)}else t=this.msgs.length;this.deleteMsgsPartial((function(e,i){return r&&!(0,ge.msgMatchesType)(e,r)||e.msgChunk===this.msgs&&i>t||n&&e.star||e.isInitialE2ENotification&&n}),!0)}deleteMsgsPartial(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=this.unreadCount;if(this.getAllCMCs().forEach((n=>{const r=n.filter(((t,n,r)=>!e.apply(this,[t,n,r])));n.remove(r,void 0,t),r.forEach((e=>{e.delete()}))})),(0,u.default)(this.msgChunks).forEach((e=>{0===e.length&&this.removeMsgsCollection(e)})),this.msgs.length>0){const e=n>this.msgs.length?this.msgs.length:n;(0,Be.updateLocal)(this.id,{unreadCount:e}).then((()=>{this.unreadCount=e,this.msgs.msgLoadState.noEarlierMsgs=!ae.GK.supportsFeature(ae.GK.F.MD_BACKEND)||this.endOfHistoryTransferType!==ze.INCOMPLETE}))}}deleteMessages(e){this.msgs.remove(e)}getFirstMsgWithStatus(){return this.msgs.getModelsArray().find((function(e){return!e.isNotification&&(e.isSentByMe||e.type===w.MSG_TYPE.PTT||e.isViewOnce||e.isEphemeral)}))}getLastReceivedMsg(){for(let e=this.msgs.length-1;e>=0;e--){const t=this.msgs.at(e);if(t&&(!t.local||t.ack>v.ACK.CLOCK))return t}}getLastReceivedNonExpiredMsg(e){for(let t=this.msgs.length-1;t>=0;t--){const n=this.msgs.at(t);if(n&&(!n.local||n.ack>v.ACK.CLOCK)&&(!n.isEphemeral||null!=n.ephemeralExpirationTimestamp&&n.ephemeralExpirationTimestamp>e))return n}}getLastMsgKeyForAction(){const e=this.msgs.last();let t;return e&&(t=!this.lastReceivedKey||e.id.fromMe&&e.local&&e.ack===v.ACK.CLOCK?e.id:this.lastReceivedKey),t||void 0}getLastTimestampMsg(){for(let e=this.msgs.length-1;e>=0;e--){const t=this.msgs.at(e);if(t&&"i"!==(0,ge.eventTypeFromMsgType)(t))return t}}getWebcChatType(){switch(this.kind){case qe.CHAT:return pe.default.WEBC_CHAT_TYPE.INDIVIDUAL;case qe.GROUP:return pe.default.WEBC_CHAT_TYPE.GROUP;case qe.BROADCAST:return pe.default.WEBC_CHAT_TYPE.BROADCAST_LIST;default:throw new TypeError(`Invalid Chat.kind ${String(this.kind)}`)}}deregisterExpiredViewOnceBulkMessages(e){e.forEach(this._deregisterExpiredViewOnceMessage)}_deregisterExpiredViewOnceMessage(e){(0,je.isExpired)(e.safe())&&(0,ue.deregisterMsg)(e)}_resetEphemeralMessageExpirationTimer(e){var t=this;T.default.clearTimeout(this._ephemeralMessageTimerIds.get(e)),this._ephemeralMessageTimerIds.delete(e),this._ephemeralMessagesToDelete.delete(e);const{ephemeralExpirationTimestamp:r}=e;if(null==r||!this.msgs.includes(e)||null!=e.keptBy)return;const i=function(){var r=(0,a.default)((function*(){if(t._ephemeralMessageTimerIds.delete(e),t.active)t._ephemeralMessagesToDelete.add(e);else{if((0,C.isMDBackend)()&&(yield(0,te.removeExpiredMessagesFromHistory)([e]),(0,oe.receiveReactionsEnabled)())){const r=n(68819).getJobManager;yield r().waitUntilPersisted(ye.jobSerializers.deleteReactions(t.id.toString(),[e.id.toString()]))}e.delete({skipUpdatingSortTime:!0,doNotResetLastReceived:!0})}}));return function(){return r.apply(this,arguments)}}();if(e.isExpired())i();else{const t=T.default.setGlobalTimeout(i,1e3*r);this._ephemeralMessageTimerIds.set(e,t)}}sendProductMessage(e,t){var n=this;return(0,a.default)((function*(){yield(0,ve.sendProductMessage)(n,e,t)}))()}sendGroupInviteMessage(e,t,n,r,i,a){const o=(0,re.getMaybeMeUser)(),s={ack:v.ACK.CLOCK,from:o,id:new I.default({from:o,to:this.id,id:I.default.newId(),participant:void 0,selfDir:"out"}),local:!0,self:"out",t:A.Clock.globalUnixTime(),to:this.id,type:"groups_v4_invite",isNewMsg:!0,inviteGrpJpegThum:a,inviteCode:n,inviteCodeExp:r,inviteGrp:e,inviteGrpName:t,comment:i};return(0,Pe.addAndSendMsgToChat)(this,s)[1]}_isMediaMsg(e){return Boolean(e.asMms&&!e.ctwaContext)}isUnreadMsg(e){const t=this.msgs.filter((e=>e.isUnreadType));return t.includes(e,t.length-this.unreadCount)}_forwardMessageAndSendToChat(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._isMediaMsg(e))return(0,ue.forwardMediaMsg)(e,this,n).then(void 0);const r=Qe(e),i=(0,re.getMaybeMeUser)();let a;(0,C.isMDBackend)()?t.isGroup()&&(a=(0,N.toUserWid)(i)):a=void 0;const o=new I.default({from:i,to:t,id:I.default.newId(),participant:a,selfDir:"out"});e.ctwaContext&&(r.body=e.ctwaContext.sourceUrl,r.type=w.MSG_TYPE.CHAT,r.mediaObject=void 0),this.isEphemeralSettingOn()&&(r.ephemeralDuration=this.getEphemeralSetting());const s=this.getEphemeralSettingTimestamp();null!=s&&(r.ephemeralSettingTimestamp=s);const l=this.getDisappearingModeInitiator();return null!=l&&(r.disappearingModeInitiator=l),Object.assign(r,{id:o,from:i,t:A.Clock.globalUnixTime(),to:t,ack:v.ACK.CLOCK,participant:void 0,local:!0,self:"out",isNewMsg:!0,star:!1,isForwarded:e.isForwarded||!e.isSentByMe,forwardedFromWeb:!0,forwardingScore:e.getForwardingScoreWhenForwarded(),multicast:n}),(0,Pe.addAndSendMsgToChat)(this,r),Promise.resolve()}forwardMessages(e){var t=this;let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return(0,a.default)((function*(){const r=t.id,i=t.contact;if(i.isUser&&i.isBlocked())throw new J.default("Forwarded to contact is blocked",i);const a=[];for(const i of e)try{yield t._forwardMessageAndSendToChat(i,r,n)}catch(e){t._isMediaMsg(i)&&a.push(i)}return a}))()}updateReadOnly(){var e;if(this.isSupportGroup()&&this.isReadOnly)return;let t=Promise.resolve();if(this.isGroup&&!(null===(e=this.groupMetadata)||void 0===e?void 0:e.stale)){let e=!1;var n,r;if((0,C.isMDBackend)())e=!(null===(n=this.groupMetadata)||void 0===n?void 0:n.participants.get((0,re.getMeUser)()));else e=!(null===(r=this.groupMetadata)||void 0===r?void 0:r.participants.get((0,re.getMaybeMeUser)()));t=(0,Be.updateLocal)(this.id,{isReadOnly:e}).then((()=>this.isReadOnly=e))}t.then((()=>{this.isBroadcast&&this.updateTitle()}))}updateIsAnnounceGrpRestrict(){const e=this.groupMetadata;if(this.isGroup&&null!=e&&!e.stale){const t=e.participants.get((0,re.getMaybeMeUser)()),n=t&&!t.isAdmin&&e.announce;(0,Be.updateLocal)(this.id,{isAnnounceGrpRestrict:n}).then((()=>this.isAnnounceGrpRestrict=n))}}sortMsgs(e){const t=e.map((e=>{const t=(0,y.default)(e.msgChunk,"msg.msgChunk");return{msg:e,chunkT:(0,y.default)(t.at(0),"chunk.at(0)").t,index:t.indexOf(e)}}));return(0,d.default)(t,["chunkT","index"]).map((e=>e.msg))}waitForChatLoading(){let e=Promise.resolve();return(0,C.isMDBackend)()&&this.pendingInitialLoading&&(e=(0,Ye.default)(this,"change:pendingInitialLoading",(()=>!this.pendingInitialLoading))),e}_updateAssignedColor(){var e,t;if(!this.colors)return;const n=null!==(e=null===(t=this.groupMetadata)||void 0===t?void 0:t.participants)&&void 0!==e?e:[],r=this.colors,i=(0,c.default)(Object.keys(r),n.map((e=>e.id.toString())).map(m.default));i.forEach((function(e){delete r[e]})),i.length&&this._saveAssignedColors()}loadAssignedColors(){return this.groupMetadata&&this.listenTo(this.groupMetadata.participants,"remove reset",this._updateAssignedColor),(0,re.getGroupParticipantAssignedColor)(this.id)||{}}saveAssignedColors(){const e=this.colors;e&&(0,re.setGroupParticipantAssignedColor)(this.id,e)}assignedColor(e){const t=this.colors||(this.colors=this.loadAssignedColors());let n;const r=(0,m.default)(e.toString());if(n=t[r])return n;const i={};(0,l.default)(t,((e,t)=>{i[e]?i[e].push(t):i[e]=[t]}));let a=Number.POSITIVE_INFINITY;for(let e=1;e<=17;e++){if(!i[e]){n=e;break}i[e].length<a&&(a=i[e].length,n=e)}return t[r]=n,this._saveAssignedColors(),n}unstarAll(){const e=this.getAllMsgs();e.forEach((e=>{e&&(e.star=!1)})),(0,Re.removeStarredMsgs)(e)}constructMediaMsgs(e){if(!e)return this.getMediaMsgs();if(e.isViewOnce)return new W.default;let t;return this.getMediaMsgs().includes(e)||e.msgChunk===this.msgs?(t=this.getMediaMsgs(),t.hasMediaAfter=!1):t=new W.default,t.includes(e)||(e.msgChunk?t.add(e.msgChunk.filter(this.isMsgForMediaCollection)):t.add(e)),t}fts(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2?arguments[2]:void 0;if(1===t){const r=this.ftsCache[e];if(r)return r;const i=he.MsgCollection.search(e,t,n,this.id);this.ftsCache[e]=i;const a=()=>{this.ftsCache[e]=null};return setTimeout(a,3e5),i.catch(a),i}return he.MsgCollection.search(e,t,n,this.id)}_clearFtsCache(){this.ftsCache={}}updateSortTime(){if(this.promises.updateSortTime)return;const e=new r,t=e.signal,n=(0,be.default)([t,this._abortController.signal],(e=>(0,E.delayMs)(0).then((()=>{const e=this.getLastTimestampMsg();if(e)this.t=e.t;else if(!this.msgs.msgLoadState.noEarlierMsgs&&!this.pendingMsgs)return this.loadEarlierMsgs()})).then((t=>{if(e.aborted)throw new h.AbortError;if(t){const e=this.getLastTimestampMsg();this.t=e?e.t:void 0}})).catch((()=>{})).finally((()=>{this.promises.updateSortTime=void 0}))));this.promises.updateSortTime={promise:n,abortController:e}}removeFromCollection(e){var t;(e.star&&(0,Re.removeStarredMsgs)([e]),e.isMedia&&this.mediaMsgs?this.mediaMsgs.remove(e):e.getLinks().length>0&&this.linkMsgs?this.linkMsgs.remove(e):e.asDoc&&this.docMsgs?this.docMsgs.remove(e):null!=e.asProduct&&this.productMsgs&&this.productMsgs.remove(e),this.updateMediasCountOnMsg(e,!0),(0,de.isGroupCatchUpEnabled)()&&e.chat.isGroup)&&(null===(t=e.chat.groupMetadata)||void 0===t||t.unreadMentionMetadata.removeUnreadMentions(e.id.toString()))}countAllMedia(){return(0,C.isLegacyWebdBackend)()?(__LOG__(4,void 0,new Error,!0)`countAllMedia can be called only from MD code`,SEND_LOGS("countAllMedia-not-from-MD"),Promise.resolve(0)):null!=this.promises.sendDelete?Promise.resolve(0):Promise.all([this.getMediaMsgs(),this.getLinkMsgs(),this.getDocMsgs()].map((e=>e.count(this)))).then((e=>e.reduce(((e,t)=>e+(null!=t?t:0)),0)))}getMediaMsgs(){return this.mediaMsgs||(this.mediaMsgs=new W.default),this.mediaMsgs}getLinkMsgs(){return this.linkMsgs||(this.linkMsgs=new K.default),this.linkMsgs}getDocMsgs(){return this.docMsgs||(this.docMsgs=new Y.default),this.docMsgs}getParticipantCount(){var e;return(null===(e=this.groupMetadata)||void 0===e?void 0:e.participants.length)||1}getProductMsgs(){return this.productMsgs||(this.productMsgs=new V.default),this.productMsgs}getReceivedVcardMsgs(){return this.contact.isMyContact||!this.contact.isUser?null:(this.receivedVcardMsgs||(this.receivedVcardMsgs=new $.default,this.receivedVcardMsgs.parent=this),this.receivedVcardMsgs)}dismissVcard(){this.vcardDismissed=!0}updateMediasCountOnMsg(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!ae.GK.supportsFeature(ae.GK.F.MEDIAS_COUNT))return;const n=t?-1:1;e.isMedia&&(this.mediaCount+=n);const r=e.getLinks().length;r&&(this.linkCount+=n*r),e.asDoc&&(this.docCount+=n)}resetMediasCount(e){ae.GK.supportsFeature(ae.GK.F.MEDIAS_COUNT)&&(null!=e.mediaCount&&(this.mediaCount=e.mediaCount),null!=e.linkCount&&(this.linkCount=e.linkCount),null!=e.docCount&&(this.docCount=e.docCount))}getStarredMsgs(){let e=this.starredMsgs;return e||(this.starredMsgs=e=new Re.StarredMsgCollection,this.starredMsgs.add(Re.AllStarredMsgsCollection.filter((e=>e.chat===this)))),e}setAndKeepPrevious(e,t){const n=Object.keys(e);n.forEach((e=>{e in this.ackedProps||(this.ackedProps[e]=this[e])})),t.finally((()=>{n.forEach((e=>{delete this.ackedProps[e]}))})),this.set(e)}getAckedPhoneProps(){return{wid:this.id,mute:this.mute.expiration,active:this.active,isReadOnly:this.isReadOnly,modifyTag:this.modifyTag,unreadCount:this.unreadCount,ephemeralDuration:this.ephemeralDuration,ephemeralSettingTimestamp:this.ephemeralSettingTimestamp,changeNumberOldJid:this.changeNumberOldJid,changeNumberNewJid:this.changeNumberNewJid,archive:"archive"in this.ackedProps?this.ackedProps.archive:this.archive,notSpam:"notSpam"in this.ackedProps?this.ackedProps.notSpam:this.notSpam,pin:"pin"in this.ackedProps?this.ackedProps.pin:this.pin}}matchFilter(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return!!(0,p.default)(e)||(e.label?this.labels&&this.labels.includes(e.label):e.kind===we.SMB_SEARCH_FILTERS.UNREAD?!!this.hasUnread&&!this.isBroadcast:e.kind===we.SMB_SEARCH_FILTERS.CONTACT?this.contact.isMyContact&&!this.contact.isGroup&&!this.isBroadcast:e.kind===we.SMB_SEARCH_FILTERS.NON_CONTACT?!this.contact.isMyContact&&!this.contact.isGroup&&!this.isBroadcast:e.kind===this.kind)}getEphemeralSetting(){var e;const t=this.isGroup?null===(e=this.groupMetadata)||void 0===e?void 0:e.ephemeralDuration:this.ephemeralDuration;return null==t||0===t?null:t<0?(__LOG__(3)`[ephemeral] invalid duration of ${t} for chat ${this.id.toString()}`,null):t}getEphemeralSettingTimestamp(){return this.isGroup||0===this.ephemeralSettingTimestamp?null:this.ephemeralSettingTimestamp}isEphemeralSettingOn(){const e=this.getEphemeralSetting();return null!=e&&0!==e}shouldShowEphemeralSetting(){if(!ae.GK.supportsAnyFeature(ae.GK.F.EPHEMERAL_MESSAGES,ae.GK.F.MD_BACKEND))return!1;if(this.isGroup){var e,t;const n=null===(e=this.groupMetadata)||void 0===e?void 0:e.participants.getSuperAdmin();if(null==n?void 0:n.contact.isEnterprise)return!1;if(!(null===(t=this.groupMetadata)||void 0===t?void 0:t.canSetEphemeralSetting())&&!this.isEphemeralSettingOn())return!1}return!this.isBroadcast&&!this.contact.isEnterprise}getDisappearingModeInitiator(){return this.isGroup?null:(0,de.isDisappearingModeEnabled)()?null!=this.disappearingModeInitiator?this.disappearingModeInitiator:this.isEphemeralSettingOn()?ee.DisappearingModeInitiator.ChangedInChat:null:null}getCollection(){return n(69951).ChatCollection}getGroupMetadataCollection(){return n(63928).default}}function Qe(e){var t;let n=["buttons","caption","broadcast","ephemeralDuration","ephemeralSettingTimestamp","ephemeralStartTimestamp","ephemeralOutOfSync","dynamicReplyButtons","replyButtons","isMdHistoryMsg","bizPrivacyStatus"];!0===e.isDynamicReplyButtonsMsg&&e.type===w.MSG_TYPE.CHAT||(n=["footer",...n]),(null===(t=e.quotedMsg)||void 0===t?void 0:t.type)!==w.MSG_TYPE.PRODUCT&&(n=["quotedMsg","quotedParticipant","quotedRemoteJid","quotedStanzaID",...n]);const r=e.asUrl;return null==r||null==r.mediaKeyTimestamp||(0,Fe.default)(r.mediaKeyTimestamp)||(n=["mediaKey","mediaKeyTimestamp","thumbnailHQ","thumbnailDirectPath","thumbnailSha256","thumbnailEncSha256","thumbnailHeight","thumbnailWidth",...n]),(0,s.default)(e.toJSON(),n)}Je.Proxy="chat",Je.idClass=L.default;const Xe=(0,B.defineModel)(Je);t.Chat=Xe},42265:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=(e,t)=>{const n=e.pin||0,r=t.pin||0;if(n||r)return n!==r?n>r?-1:1:e.id.toString()<t.id.toString()?-1:1;const i=e.t||0,a=t.t||0;return i!==a?i>a?-1:1:e.id.toString()<t.id.toString()?-1:1};t.default=n},69951:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ChatCollectionImpl=t.ChatCollection=void 0;var i=r(n(48926)),a=r(n(35937)),o=r(n(39693)),s=r(n(63105)),l=r(n(35161)),c=r(n(41609)),d=r(n(23279)),u=n(50796),p=n(13959),f=n(67602),h=n(92574),_=n(13042),g=n(30764),m=r(n(65212)),y=r(n(89867)),E=n(1255),S=n(80140),v=n(63183),T=r(n(42265)),b=n(17239),C=n(19380),A=n(11082),P=r(n(41220)),M=r(n(82058)),O=n(7293),I=n(16770),w=r(n(51783)),R=n(53055),D=n(99662),L=n(91692),N=n(3060),k=n(32613),U=n(3553),G=r(n(68132)),x=n(62583),B=n(16774),F=n(66299),j=n(27211),Y=r(n(35609)),K=n(65044);class W extends E.BaseCollection{constructor(){super(),this.notSpam={},this.promises={sendUnstarAll:null},this._sortEnabled=!1,this._viewOnceCleanupTaskQueue=new Set,this.enableSortListener(),this.listenTo(K.Socket,"change:stream",(()=>{K.Socket.stream===x.SOCKET_STREAM.RESUMING&&this.forEach((e=>{e.pendingMsgs=!1}))})),this.listenToOnce(this,"sort",(0,d.default)(this.setIndexes,100)),this._scheduleViewOnceMediaCleanup()}_scheduleViewOnceMediaCleanup(){clearTimeout(this._viewOnceCleanupTimeout),this._viewOnceCleanupTimeout=setTimeout((()=>{g.IdleCallbackTasks.enqueue((()=>{this._runViewOnceMediaCleanup(),this._scheduleViewOnceMediaCleanup()}))}),18e5)}_runViewOnceMediaCleanup(){this.forEach((e=>{const t=e.id;this._viewOnceCleanupTaskQueue.has(t)||(g.IdleCallbackTasks.enqueue((()=>{this._viewOnceCleanupTaskQueue.delete(t);const e=this.get(t);!1===(null==e?void 0:e.active)&&e.deregisterExpiredViewOnceBulkMessages(e.msgs)})),this._viewOnceCleanupTaskQueue.add(t))}))}enableSortListener(e){this._sortEnabled||(this.listenTo(this,"change:t change:pin change:shouldAppearInList",this.sort),e&&this.sort(),this._sortEnabled=!0)}disableSortListener(){this._sortEnabled&&(this.stopListening(null,null,this.sort),this._sortEnabled=!1)}setIndexes(){this.forEach(((e,t)=>{e.initialIndex=t}))}getActive(){return this.filter((e=>e.active))[0]}_findQuery(e){var t=this;return(0,i.default)((function*(){const r={},i=yield(0,A.find)(!!e.retry,r);if("preempted"===i)return Promise.reject(new E.CollectionSilentQueryError("chats preempted"));if(b.Conn.platform===b.PLATFORMS.IPHONE||b.Conn.platform===b.PLATFORMS.SMBI){const e=n(59871).MsgCollection;(0,c.default)(i)?e.trigger(_.COLLECTION_HAS_SYNCED):setTimeout((()=>{e.trigger(_.COLLECTION_HAS_SYNCED)}),2500)}return t.trigger(_.COLLECTION_HAS_SYNCED,r),Promise.resolve(i)}))()}sync(){this.findQuery({}).catch((0,u.filteredCatch)(h.WebdDrop,(()=>{})));const e=n(59871).MsgCollection;return Promise.all([(0,Y.default)(this,_.COLLECTION_HAS_SYNCED),e.hasSynced()])}getKeysForResyncMsgs(){return this.filter((function(e){return e.shouldAppearInList})).map((function(e){const t=e.getAckedPhoneProps(),n=e.lastReceivedKey;return n&&(t.id=n.id,t.fromMe=n.fromMe.toString(),t.participant=n.participant),t}))}resyncMessages(){var e=this;return(0,i.default)((function*(){__LOG__(2)`ChatStore:resyncMessages`;const t=e.getKeysForResyncMsgs();try{const r=yield(0,N.resyncMessages)(t);if(r.status>=400)return __LOG__(3)`ChatStore:resyncMessages resume error ${r.status}`,Promise.reject(new Error("ChatStore:resyncMessages resume error "+r.status));__LOG__(2)`ChatStore:resyncMessages resume success`;try{e.disableSortListener(),r.data.forEach((t=>{if(t.disableUnreadAnchor=!1,t.firstUnreadKey=void 0,t.keys&&1===t.keys.length){const e=t.keys[0];t.firstUnreadKey=new m.default({id:e[0],fromMe:e[1],participant:e[2],remote:t.id})}if("delete"!==t.type&&!y.default.isPSA(t.id)){const e=C.ContactCollection.get(t.id);if(e){if(t.name){const n={name:t.name};(0,j.updateLocal)(e.id,n).then((()=>{e.set(n)}))}}else C.ContactCollection.add({id:t.id,name:t.name})}const n=e.get(t.id);if(n)if("clear"===t.type){n.resetMediaMsgs();const e=[];n.msgs.forEach((t=>e.push(t))),n.msgChunks.length&&n.msgChunks.forEach((t=>{t.forEach((t=>e.push(t)))})),n.set({t:t.t,unreadCount:t.unreadCount,createdLocally:!1,archive:t.archive,isReadOnly:t.isReadOnly,modifyTag:t.modifyTag,msgs:[],notSpam:t.notSpam,unreadMsgAnchor:void 0,disableUnreadAnchor:t.disableUnreadAnchor,pendingMsgs:t.pendingMsgs,pin:t.pin,changeNumberOldJid:t.changeNumberOldJid,changeNumberNewJid:t.changeNumberNewJid,muteExpiration:t.muteExpiration,ephemeralDuration:t.ephemeralDuration,ephemeralSettingTimestamp:t.ephemeralSettingTimestamp}),e.forEach((e=>{e.delete()})),__LOG__(2)`model:chat:resume: cleared chat for ${t.id}`}else"delete"===t.type?(n.delete(),__LOG__(2)`model:chat:resume: deleted chat for ${t.id}`):n.set(t,{merge:!0});else e.add(t)})),e.enableSortListener(!0)}catch(e){__LOG__(3)`model:chat:resume error in processing reply:${String(e)}`}(0,p.delayMs)(100).then((()=>{O.GK.supportsFeature(O.GK.F.USER_NOTICE)&&w.default.sync(!0),O.GK.supportsFeature(O.GK.F.SETTINGS_SYNC)&&G.default.sync(!0),r.checksum&&(0,k.resyncContacts)(r.checksum),r.statusChecksum&&n(59387).StatusV3Collection.sync(r.statusChecksum),r.quickRepliesChecksum&&D.QuickReplyCollection.sync(r.quickRepliesChecksum),r.labelsChecksum&&I.LabelCollection.sync(r.labelsChecksum),r.stickerPackChecksum&&F.StickerPackCollection.sync(r.stickerPackChecksum),null!=r.recentStickersChecksum&&L.RecentStickerCollection.sync(r.recentStickersChecksum),null!=r.starredStickersChecksum&&B.StarredStickerCollection.sync(r.starredStickersChecksum)})).catch((e=>{__LOG__(3)`model:chat:resume error in processing checksum:${String(e)}`}))}catch(e){return(0,u.filteredCatch)(h.WebdDrop,(function(e){return __LOG__(3)`ChatStore:resyncMessages resume dropped`,Promise.reject(e)}))(e)}}))()}unstarAllMessages(e,t){return(0,U.unstarAllMessages)(e,t)}forwardMessagesToChats(e,t){return(0,i.default)((function*(){const r=Promise.all(e.map((e=>(0,f.promiseProps)({message:e,canForward:e.canForward()&&(null!=n(59871).MsgCollection.get(e.id)||e.isEphemeral)})))),a=yield Promise.all(t.filter((e=>e.canSend)).map(function(){var e=(0,i.default)((function*(e){let t;t=e.isUser&&e.contact.isBlocked()?(0,S.unblockContact)(e.contact):Promise.resolve(!0);const[n]=yield Promise.all([r,t]),i=(0,l.default)((0,s.default)(n,{canForward:!0}),"message"),a=(0,l.default)((0,s.default)(n,{canForward:!1}),"message");return(0,f.promiseProps)({chat:e,undelivered:e.forwardMessages(i,!0),canForward:i,cannotForward:a})}));return function(){return e.apply(this,arguments)}}())),c=(0,o.default)(a.map((e=>{let{chat:t,undelivered:n,canForward:r,cannotForward:i}=e,a=null;return(n.length||i.length)&&(a=(0,P.default)({chat:t,undelivered:n,canForward:r,cannotForward:i})),a?{chat:t,reason:a}:null})));if(c.length)throw new M.default(c);return!0}))()}saveToCache(){if(!b.Conn.shouldSaveToCache())return;const{id:e}=W.cachePolicy;__LOG__(2)`ChatCollection:saveToCache save: ${String(e)}`;const t=this.map(((e,t)=>{const n=e.toJSON(),r=t<20?Math.min(e.unreadCount+20,50):Math.min(Math.max(3,e.unreadCount),20);return n.msgs=e.msgs?e.msgs.slice(-r).map((e=>(0,a.default)(e.toJSON(),(e=>void 0!==e)))):[],n}));(0,R.setCollection)(e,t,!0)}onResume(){const e=this.getActive();e&&e.presence.subscribe()}delete(){super.delete(),this.listenToOnce(this,"sort",(0,d.default)(this.setIndexes,100))}}t.ChatCollectionImpl=W,W.model=v.Chat,W.comparator=T.default;const H=new W;t.ChatCollection=H},6977:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(48926)),a=n(50796),o=n(92574),s=n(88555),l=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=p(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(35232)),c=n(1255),d=n(17304),u=n(59871);function p(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(p=function(e){return e?n:t})(e)}class f extends c.BaseCollection{constructor(){var e;super(...arguments),e=this,this.hasDocBefore=!0,this._count=null,this.count=function(){var t=(0,i.default)((function*(t){var n;if((0,s.isLegacyWebdBackend)())return __LOG__(4,void 0,new Error,!0)`count can be called only from MD code`,SEND_LOGS("count-docs-not-from-MD"),null;if(null!=e._count)return e._count;const r=t.msgs.filter(h),i=null!==(n=r[0])&&void 0!==n?n:t.msgs.head();if(null==i)return 0;try{var a;const t=null!==(a=(yield u.MsgCollection.queryMedia(i.id.remote,1/0,"before",i.id,"document")).length)&&void 0!==a?a:0,n=t>0&&r.length>0?1:0;return e._count=t+r.length-n,e._count}catch(e){return __LOG__(4,!0,new Error,!0)`Failed to count docs for chat ${t.id}`,SEND_LOGS(`md-failed-docs-count: ${e.message}`),null}}));return function(){return t.apply(this,arguments)}}()}delete(){super.delete(),this.stopListening(),this.reset()}add(e,t){return this._count=null,super.add(e,t)}remove(e,t){return this._count=null,super.remove(e,t)}queryDocs(e,t){if(t)return this.queryDocBefore||(this.queryDocBefore=u.MsgCollection.queryMedia(t.id.remote,u.MEDIA_QUERY_LIMIT,"before",t.id,"document").then((e=>((!e||e.length<u.MEDIA_QUERY_LIMIT)&&(this.hasDocBefore=!1),this.add(e.filter(h),{at:0}),{length:e.length}))).catch((0,a.filteredCatch)([o.WebdDrop,l.ProtoVersionUndefined,o.E404],(()=>{}))).finally((()=>{this.queryDocBefore=null,this.trigger("query_doc_before")})),this.trigger("query_doc_before")),this.queryDocBefore;const n=e.msgs;if(0===this.length){if(!n||0===n.length)return this.hasDocBefore=!1,new Promise((e=>{e({eof:!0})}));this.add(n.filter(h),{at:0})}if(e.msgs.msgLoadState.noEarlierMsgs)return this.hasDocBefore=!1,new Promise((e=>{e({eof:!0})}));if(this.length<=2*u.MEDIA_QUERY_LIMIT){const t=0===this.length?n.head():this.head();return this.queryDocs(e,t)}return new Promise((e=>{e({eof:!1})}))}}function h(e){return null!=e.asDoc&&!e.isVcardOverMmsDocument}t.default=f,f.model=d.Msg},77653:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(48926)),a=n(50796),o=n(4352),s=n(92574),l=n(88555),c=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=f(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(35232)),d=n(1255),u=n(17304),p=n(59871);function f(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(f=function(e){return e?n:t})(e)}class h extends d.BaseCollection{constructor(){var e;super(...arguments),e=this,this.hasLinkBefore=!0,this._count=null,this.count=function(){var t=(0,i.default)((function*(t){var n;if((0,l.isLegacyWebdBackend)())return __LOG__(4,void 0,new Error,!0)`count can be called only from MD code`,SEND_LOGS("count-links-not-from-MD"),null;if(null!=e._count)return e._count;const r=t.msgs.filter((e=>e.getLinks().length>0)),i=null!==(n=r[0])&&void 0!==n?n:t.msgs.head();if(null==i)return 0;try{var a;const t=null!==(a=(yield p.MsgCollection.queryMedia(i.id.remote,1/0,"before",i.id,"url")).length)&&void 0!==a?a:0,n=t>0&&r.length>0?1:0;return e._count=t+r.length-n,e._count}catch(e){return __LOG__(4,!0,new Error,!0)`Failed to count medias for chat ${t.id}`,SEND_LOGS(`md-failed-medias-count: ${e.message}`),null}}));return function(){return t.apply(this,arguments)}}()}delete(){super.delete(),this.stopListening(),this.reset()}add(e,t){return this._count=null,super.add(e,t)}remove(e,t){return this._count=null,super.remove(e,t)}queryLinks(e,t){if(t)return this.queryLinkBefore||(this.queryLinkBefore=p.MsgCollection.queryMedia(t.id.remote,p.MEDIA_QUERY_LIMIT,"before",t.id,"url").then((e=>((!e||e.length<p.MEDIA_QUERY_LIMIT)&&(this.hasLinkBefore=!1),this.add(e,{at:0}),this.createLinksAndAddMsgs(e),{length:e.length}))).catch((0,a.filteredCatch)([s.WebdDrop,c.ProtoVersionUndefined,s.E404],(()=>{}))).finally((()=>{this.queryLinkBefore=null,this.trigger("query_link_before")})),this.trigger("query_link_before")),this.queryLinkBefore;const n=e.msgs.getModelsArray();if(0===this.length){if(!n||0===n.length)return this.hasLinkBefore=!1,new Promise((e=>{e({eof:!0})}));this.add(n.filter((e=>e.getLinks().length>0)),{at:0}),this.createLinksAndAddMsgs(n)}if(e.msgs.msgLoadState.noEarlierMsgs)return this.hasLinkBefore=!1,new Promise((e=>{e({eof:!0})}));if(this.length<=2*p.MEDIA_QUERY_LIMIT){const t=0===this.length?e.msgs.head():this.head();return this.queryLinks(e,t)}return new Promise((e=>{e({eof:!1})}))}createLinksAndAddMsgs(e){const t=[];(0,o.promiseLoop)(((n,r,i)=>{if(e.length===i)return void n();const a=e[i];if(null!=a){a.getLinks().length&&t.push(a)}})).then((()=>{this.add(t),this.trigger("query_link_before")}))}}t.default=h,h.model=u.Msg,h.comparator=(e,t)=>e.t-t.t},65568:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(48926)),a=n(50796),o=n(92574),s=n(88555),l=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=p(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(35232)),c=n(1255),d=n(17304),u=n(59871);function p(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(p=function(e){return e?n:t})(e)}const f="before",h="after";function _(e){return e.isMedia&&!e.isViewOnce}class g extends c.BaseCollection{constructor(){var e;super(...arguments),e=this,this.hasMediaBefore=!0,this.hasMediaAfter=!0,this._count=null,this.count=function(){var t=(0,i.default)((function*(t){var n;if((0,s.isLegacyWebdBackend)())return __LOG__(4,void 0,new Error,!0)`count can be called only from MD code`,SEND_LOGS("count-media-not-from-MD"),null;if(null!=e._count)return e._count;const r=t.msgs.filter(_),i=null!==(n=r[0])&&void 0!==n?n:t.msgs.head();if(null==i)return 0;try{var a;const t=null!==(a=(yield u.MsgCollection.queryMedia(i.id.remote,1/0,"before",i.id)).mediaCount)&&void 0!==a?a:0,n=t>0&&r.length>0?1:0;return e._count=t+r.length-n,e._count}catch(e){return __LOG__(4,!0,new Error,!0)`Failed to count medias for chat ${t.id}`,SEND_LOGS(`md-failed-medias-count: ${e.message}`),null}}));return function(){return t.apply(this,arguments)}}()}delete(){super.delete(),this.stopListening()}add(e,t){return this._count=null,super.add(e,t)}remove(e,t){return this._count=null,super.remove(e,t)}getAfter(e){const t=this.indexOf(e);return t<0||t===this.length-1?null:this.at(t+1)}getBefore(e){const t=this.indexOf(e);return t<=0?null:this.at(t-1)}loadEarlierMedias(){const e=this.head();e&&this.queryMedia({msg:e})}loadRecentMedias(){const e=this.last();e&&this.queryMedia({msg:e,direction:h})}loadMoreAroundIfNeeded(e){if(!e||e.isViewOnce)return;const t=this.indexOf(e);t<20&&this.hasMediaBefore&&this.loadEarlierMedias(),this.length-t<20&&this.hasMediaAfter&&this.loadRecentMedias()}queryMedia(e){var t;const{chat:n,msg:r}=e,i=null!==(t=e.direction)&&void 0!==t?t:f;if(!r&&n){const e=n.msgs;if(!e||0===e.length)return this.hasMediaBefore=!1,new Promise((e=>{e({eof:!0})}));this.add(e.filter(_),{at:0});const t=this.toArray();if(n.msgs.msgLoadState.noEarlierMsgs)return this.hasMediaBefore=!1,new Promise((e=>{e({eof:!0})}));if(t.length<=2*u.MEDIA_QUERY_LIMIT){const r=0===t.length?e.head():t[0];return this.queryMedia({chat:n,msg:r})}return new Promise((e=>{e({eof:!1})}))}if(r&&i===f){if(this.queryMediaBefore)return this.queryMediaBefore;let e=0;return this.queryMediaBefore=u.MsgCollection.queryMedia(r.id.remote,u.MEDIA_QUERY_LIMIT,i,r.isMedia?r.id:void 0).then((t=>{const r=t.messages;(!r||r.length<u.MEDIA_QUERY_LIMIT)&&(this.hasMediaBefore=!1);let i=[];r&&r.length>0&&(i=r.filter(_)),this.add(i,{at:0});const a={mediaCount:t.mediaCount,linkCount:t.linkCount,docCount:t.docCount};return n&&n.resetMediasCount(a),e=i.length,{length:e}})).catch((0,a.filteredCatch)([o.WebdDrop,l.ProtoVersionUndefined,o.E404],(()=>{}))).finally((()=>{this.queryMediaBefore=null,this.trigger("query_media_before",e)})),this.trigger("query_media_before",0),this.queryMediaBefore}if(r&&i===h)return this.queryMediaAfter?this.queryMediaAfter:this.queryMediaAfter=u.MsgCollection.queryMedia(r.id.remote,u.MEDIA_QUERY_LIMIT,i,r.id).then((e=>{const t=e.messages;(!t||t.length<u.MEDIA_QUERY_LIMIT)&&(this.hasMediaAfter=!1);let r=[];t&&t.length>0&&(r=t.filter(_)),this.add(r);const i={mediaCount:e.mediaCount,linkCount:e.linkCount,docCount:e.docCount};return n&&n.resetMediasCount(i),{length:r.length}})).catch((0,a.filteredCatch)([o.WebdDrop,l.ProtoVersionUndefined,o.E404],(()=>{}))).finally((()=>{this.queryMediaAfter=null,this.trigger("query_media_after")}))}}t.default=g,g.model=d.Msg,g.comparator=(e,t)=>e.t-t.t},51612:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.MsgLoadState=t.ChatMsgsCollection=void 0;var i=r(n(81109)),a=r(n(41143)),o=n(1255),s=n(11290),l=n(17304);class c extends s.BaseModel{constructor(){super(...arguments),this.noEarlierMsgs=(0,s.prop)(),this.isLoadingEarlierMsgs=(0,s.prop)(),this.isLoadingRecentMsgs=(0,s.prop)(),this.isLoadingAroundMsgs=(0,s.prop)(),this.contextLoaded=(0,s.prop)()}}c.Proxy="msgLoad";const d=(0,s.defineModel)(c);t.MsgLoadState=d;class u extends o.BaseCollection{constructor(){super(),this.msgLoadState=new d({noEarlierMsgs:!1,isLoadingEarlierMsgs:!1,isLoadingRecentMsgs:!1,isLoadingAroundMsgs:!1,contextLoaded:!1}),this.listenTo(this,"add remove reset sort",this.triggerChangeLast)}delete(){this.stopListening(),super.delete(),this.msgLoadState.delete()}triggerChangeLast(e,t,n){const r=this.last();if(this._last!==r){this._last=r;let i=!1;const a=!!n.add,o=!!n.remove;t.includes(e)&&a&&!o&&(i=!0),this.trigger("change:last",r,i)}}add(e,t){let r;Array.isArray(e)?1===e.length&&(r=e[0]):r=e;let a=[];if(null!=r&&(r.isInitialE2ENotification||r.isDisappearingModeSystemMessage)){const n=this.some((e=>e.isInitialE2ENotification));if(r.isInitialE2ENotification&&(n||(a=super.add(e,(0,i.default)((0,i.default)({},t),{},{at:0})))),r.isDisappearingModeSystemMessage){if(!this.some((e=>e.isDisappearingModeSystemMessage))){const r=n?1:0;a=super.add(e,(0,i.default)((0,i.default)({},t),{},{at:r}))}}a&&this.trigger("insert_msgs",a,t)}else a=super.add(e,t);if(a.length>0){n(59871).MsgCollection.add(a,t).forEach((e=>{e&&this.isModel(e)&&(e.msgChunk=this)})),this.trigger("bulk_add",a,t)}return a}remove(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=super.remove(e,t),i=!!t&&t.silent,a=r.filter((e=>!!e));return a.length&&!i&&(this.trigger("remove_msgs",a,t),n||this.trigger("update_sort_time")),r}replace(e){this.msgLoadState=e.msgLoadState,this.loadRecentPromise=e.loadRecentPromise,this.loadEarlierPromise=e.loadEarlierPromise,this.loadAroundPromise=e.loadAroundPromise;const t=e.getModelsArray();this.set(t,{silent:!0,merge:!1}),t.forEach((e=>{this.isModel(e)&&(e.msgChunk=this)})),this.trigger("bulk_add",t)}onMsgLoadStateChange(e){let t;const n=()=>{e()},r=()=>{(0,a.default)(null!=t,"prevMsgLoadState cannot be null after bulk_add"),t.off("change",n);const r=this.msgLoadState;r.on("change",n),t=r,e()};t=this.msgLoadState,t.on("change",n),this.on("bulk_add",r);let i=()=>{(0,a.default)(null!=t,"prevMsgLoadState cannot be null when unsubscribing"),this.off("bulk_add",r),t.off("change",n)};return()=>{const e=i;e&&(i=null,e())}}}t.ChatMsgsCollection=u,u.model=l.Msg},33929:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_PREFERENCE=t.ChatPreference=void 0;var i=r(n(89867)),a=n(11290);const o="defaultPreference";t.DEFAULT_PREFERENCE=o;class s extends a.BaseModel{constructor(){super(...arguments),this.id=(0,a.prop)(),this.wallpaperColor=(0,a.prop)(),this.saveToCameraRoll=(0,a.prop)(),this.showDoodle=(0,a.prop)()}getCollection(){return n(66034).default}}s.Proxy="chatPreference",s.idClass=i.default,s.allowedIds=[o];const l=(0,a.defineModel)(s);t.ChatPreference=l},66034:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(14648),i=n(1255),a=n(33929),o=n(72407),s=n(78123);class l extends i.BaseCollection{initializeFromCache(e){this.add([{id:a.DEFAULT_PREFERENCE,wallpaperColor:s.DEFAULT_CHAT_WALLPAPER,saveToCameraRoll:!0,showDoodle:!0},...e||[]],{merge:!0})}get(e){return super.get(e)||super.get(a.DEFAULT_PREFERENCE)}delete(){super.delete(),this.add({id:a.DEFAULT_PREFERENCE,wallpaperColor:s.DEFAULT_CHAT_WALLPAPER,saveToCameraRoll:!0,showDoodle:!0})}}l.model=a.ChatPreference,l.cachePolicy={id:o.KEYS.CHAT_PREFERENCE_COLLECTION,policy:r.CACHE_POLICY.LOAD,delay:1e3};var c=new l;t.default=c},16173:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(50796),i=n(92574),a=n(1255),o=n(7293),s=n(17304),l=n(59871);class c extends a.BaseCollection{constructor(){super(...arguments),this.syncPromise=null,this.isSynced=!1}onResume(){this.isSynced=!1,this.sync(this.parent)}sync(e){return o.GK.supportsFeature(o.GK.F.INDEX_RECEIVED_VCARD)?this.isSynced?Promise.resolve():(this.syncPromise||(this.syncPromise=l.MsgCollection.queryVcard(e.id).then((e=>this.add(e))).catch((0,r.filteredCatch)(i.E499,(()=>{}))).catch((()=>{})).finally((()=>{this.isSynced=!0,this.syncPromise=null}))),this.syncPromise):(this.isSynced=!0,Promise.resolve())}}t.default=c,c.model=s.Msg,c.resumeOnAvailable=!0},11006:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(31727)),a=r(n(41809));class o extends i.default{oldestUnreadMention(){var e;const t=null!==(e=this.last())&&void 0!==e?e:null;return t&&this.remove(t),t}}t.default=o,o.model=a.default,o.comparator=(e,t)=>t.timestamp-e.timestamp},4550:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return s.apply(this,arguments)};var i=r(n(48926)),a=r(n(44558)),o=n(55975);function s(){return(s=(0,i.default)((function*(){(yield Promise.allSettled([(0,a.default)(),o.LruMediaStore.clear()])).forEach((e=>{if("rejected"===e.status)throw e.reason}))}))).apply(this,arguments)}},98423:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.handle=function(e){let[t]=e;switch(t.type){case"read":if(t.isStatus){p.StatusV3Collection.handle([t]);break}case"unread":const e=a.ChatCollection.get(t.jid);e&&("read"===t.type?(0,f.markSeen)(e):"unread"===t.type&&(0,f.markUnseen)(e));break;case"log":o.upload({reason:o.SERVER_REQUESTED,immediate:!0,force:!0,isHighPri:!0});break;case"privacy":if(t.jid){const e=c.PresenceCollection.get(t.jid);e&&e.reset(),d.ProfilePicThumbCollection.update(t.jid).catch((0,r.filteredCatch)(i.WebdDrop,(()=>{}))),u.StatusCollection.update(t.jid).catch((0,r.filteredCatch)(i.WebdDrop,(()=>{})))}else __LOG__(3)`Store:Cmd:handle:privacy no jid`;break;case"identity":if(t.jid){const e=s.ContactCollection.get(t.jid);e?(0,l.updateIdentity)(e,t):__LOG__(3)`Store:Cmd:handle:identity no contact`}else __LOG__(3)`Store:Cmd:handle:identity no jid`;break;default:__LOG__(3)`Store:Cmd:handle:unknown ${t.type}`}};var r=n(50796),i=n(92574),a=n(69951),o=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=h(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(86374)),s=n(19380),l=n(84765),c=n(68315),d=n(82039),u=n(46133),p=n(59387),f=n(9609);function h(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(h=function(e){return e?n:t})(e)}},17239:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.PLATFORMS=t.ConnImpl=t.Conn=void 0;var i=r(n(23279)),a=r(n(44908)),o=n(88555),s=n(11290),l=n(88102),c=n(99234),d=r(n(83938)),u=r(n(14296)),p=n(33970),f=n(46582),h=r(n(11339)),_=n(69594);const g={ANDROID:"android",BB:"bb",BBX:"bbx",IPAD:"ipad",IPHONE:"iphone",IPOD:"ipod",S40:"s40",SMBA:"smba",SMBI:"smbi",SYMBIAN:"symbian",WP7:"wp7"};t.PLATFORMS=g;class m extends s.BaseModel{constructor(){super(...arguments),this.id=(0,s.prop)(),this.ref=(0,s.prop)(),this.refTTL=(0,s.prop)(),this.refId=(0,s.prop)(),this.wid=(0,s.prop)(),this.connected=(0,s.prop)(),this.protoVersion=(0,s.prop)(),this.clientToken=(0,s.prop)(),this.serverToken=(0,s.prop)(),this.secret=(0,s.prop)(),this.isResponse=(0,s.prop)(),this.battery=(0,s.prop)(),this.plugged=(0,s.prop)(),this.lc=(0,s.prop)(),this.lg=(0,s.prop)(),this.locales=(0,s.prop)(),this.is24h=(0,s.prop)(),this.platform=(0,s.prop)(),this.phone=(0,s.prop)(),this.tos=(0,s.prop)(),this.smbTos=(0,s.prop)(0),this.pushname=(0,s.prop)(),this.blockStoreAdds=(0,s.session)(!1),this.isVoipInitialized=(0,s.session)(!1),this.refExpiry=(0,s.derived)((function(){return Date.now()+this.refTTL}),["ref","refTTL"]),this.locale=(0,s.derived)((function(){return this.formatLocale(this.lg,this.lc)}),["lg","lc"]),this.localesList=(0,s.derived)((function(){return this.locales&&this.locales.length?this.locales.split(",").map((e=>{const[t,n]=e.split("-");return t?[t,n]:null})).filter(Boolean):this.lg?[[this.lg,this.lc]]:[]}),["locales","lg","lc"]),this.allLocales=(0,s.derived)((function(){return(0,a.default)(this.localesList.map((e=>{let[t,n]=e;return this.formatLocale(t,n)}))).filter(Boolean)}),["localesList"]),this.allLanguages=(0,s.derived)((function(){return(0,a.default)(this.localesList.map((e=>{let[t,n]=e;return t})))}),["localesList"]),this.platformField=(0,s.derived)((function(){return"wp7"===this.platform?h.default.PLATFORM_TYPE.WP:this.platform&&h.default.PLATFORM_TYPE[this.platform.toUpperCase()]||h.default.PLATFORM_TYPE.UNKNOWN}),["platform"]),this.tosShowCallNotification=(0,s.derived)((function(){return(0,o.isMDBackend)()||this.tos<2}),["tos"]),this.isSMB=(0,s.derived)((function(){return this.platform===g.SMBA||this.platform===g.SMBI}),["platform"])}initialize(){s.BaseModel.prototype.initialize.call(this),this.listenTo(this,"change:locale",(function(e,t){u.default.setLocale(t,p.L10N_PRIORITY.PHONE)})),this.listenTo(this,"change:plugged",(0,i.default)((()=>{h.default.Global.webcPhoneCharging=this.plugged}),5e3,{leading:!0})),this.listenTo(this,"change:phone",(()=>{!function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{mcc:t,mnc:n}=e;t&&"string"==typeof t&&(t=parseInt(t,10));n&&"string"==typeof n&&(n=parseInt(n,10));h.default.Global.set({mcc:null!=t?t:null,mnc:null!=n?n:null,webcPhoneDeviceManufacturer:e.device_manufacturer||null,webcPhoneDeviceModel:e.device_model||null,webcPhoneOsBuildNumber:e.os_build_number||null,webcPhoneOsVersion:e.os_version||null,webcPhoneAppVersion:e.wa_version||null})}(this.phone)})),this.listenTo(this,"change:platform",this.handlePlatformChange),this.listenTo(l.Cmd,"main_stream_mode_ready_legacy",this.updateVoipAvailability)}delete(){(0,c.setPushname)(),(0,c.setVersion)(),this.clear()}canSetMyPushname(){return!this.isSMB}updateVoipAvailability(){__LOG__(2)`Conn: updateVoipAvailability`,(0,f.requireVoip)().then((e=>{if(!(0,_.isVoiceCallEnabled)()&&!(0,_.isVideoCallEnabled)())return __LOG__(2)`Conn: updateVoipAvailability, Voip GK false`,e.cleanup(),void(this.isVoipInitialized=!1);this.id&&(0,c.getMaybeMeUser)()?(0,d.default)().then((t=>{t?(__LOG__(2)`Conn: updateVoipAvailability, isSystemCapableOfVoip true`,e.init().then((t=>{__LOG__(2)`Conn: updateVoipAvailability, Voip initialized: ${t}`,this.isVoipInitialized=t,t&&e.updateAudioVideoSwitch()}))):(__LOG__(2)`Conn: updateVoipAvailability, isSystemCapableOfVoip false`,e.cleanup(),this.isVoipInitialized=!1)})):(__LOG__(2)`Conn: updateVoipAvailability, getMaybeMeUser undefined`,e.cleanup(),this.isVoipInitialized=!1)}))}handlePlatformChange(){__LOG__(2)`Conn: platform change: ${this.platform}`,this.platform&&((0,c.setLastMobilePlatform)(this.platform),h.default.Global.set({webcPhonePlatform:this.platformField}))}formatLocale(e,t){return e?t?e.toLowerCase()+"-"+t.toUpperCase():e.toLowerCase():null}shouldSaveToCache(){return!!(0,c.getMe)()&&!!this.id}}t.ConnImpl=m,m.Proxy="conn";const y=new((0,s.defineModel)(m))({id:"1"});t.Conn=y},32161:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=new RegExp("[A-Za-z-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------]");t.default=n},121:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(11782)),a=r(n(89867)),o=r(n(62054)),s=r(n(32161)),l=n(11290),c=n(32826),d=n(352),u=n(93170),p=n(17239),f=n(47969),h=n(99234),_=n(57701),g=r(n(14296)),m=n(35389),y=n(82039),E=n(959),S=n(46133);const v=/^[^0-9]+$/;class T extends l.BaseModel{constructor(){super(...arguments),this.id=(0,l.prop)(),this.name=(0,l.prop)(),this.shortName=(0,l.prop)(),this.pushname=(0,l.prop)(),this.type=(0,l.prop)("in"),this.verifiedName=(0,l.prop)(),this.isBusiness=(0,l.prop)(),this.isEnterprise=(0,l.prop)(),this.verifiedLevel=(0,l.prop)(),this.privacyMode=(0,l.prop)(),this.statusMute=(0,l.prop)(),this.sectionHeader=(0,l.prop)(),this.labels=(0,l.prop)(),this.isContactSyncCompleted=(0,l.prop)(),this.forcedBusinessUpdateFromServer=(0,l.prop)(),this.disappearingModeDuration=(0,l.prop)(),this.disappearingModeSettingTimestamp=(0,l.prop)(),this.isContactBlocked=(0,l.session)(!1),this.verificationString=(0,l.session)(),this.verificationBinary=(0,l.session)(),this.pendingAction=(0,l.session)(),this.promises=(0,l.session)((()=>({}))),this.status=(0,l.session)(),this.profilePicThumb=(0,l.session)(),this.businessProfile=(0,l.session)(),this.commonGroups=(0,l.session)(),this.liveLocations=(0,l.session)(),this.businessCatalog=(0,l.session)(),this.locale=(0,l.session)(),this.notifyName=(0,l.derived)((function(){return this.isBusiness&&this.verifiedLevel!==u.VERIFIED_LEVEL.HIGH?this.verifiedName:this.pushname}),["pushname","isBusiness","verifiedLevel","verifiedName"]),this.mentionName=(0,l.derived)((function(){return!this.isMyContact&&this.isBusiness&&this.verifiedLevel!==u.VERIFIED_LEVEL.HIGH?null:this.name||this.notifyName}),["isMyContact","isBusiness","verifiedLevel","name","notifyName"]),this.displayName=(0,l.derived)((function(){return this.isMe&&p.Conn.pushname?p.Conn.pushname:this.mentionName||(0,o.default)(this.id)}),["id","mentionName","isMe"]),this.userid=(0,l.derived)((function(){return this.isUser?a.default.user(this.id):null})),this.userhash=(0,l.derived)((function(){return this.isUser?(0,i.default)((this.id.user||"")+"WA_ADD_NOTIF"):null})),this.searchName=(0,l.derived)((function(){return a.default.isPSA(this.id)?g.default.accentFold(g.default.t(1022)):this.name?g.default.accentFold(this.name):null}),["name","id","locale"]),this.searchVerifiedName=(0,l.derived)((function(){return this.verifiedLevel!==u.VERIFIED_LEVEL.HIGH?null:this.verifiedName?g.default.accentFold(this.verifiedName):null}),["verifiedLevel","verifiedName"]),this.header=(0,l.derived)((function(){if(this.name){const e=this.name.toLowerCase(),t=s.default.exec(e);if(t&&0===t.index||t&&v.test(e.slice(t.index))){const e=t[0],n=g.default.removeAccents(e);return(0,f.getCollator)().compare(n,e)?e:n}return"#"}}),["name"]),this.isMe=(0,l.derived)((function(){return this.id.equals((0,h.getMaybeMeUser)())})),this.isUser=(0,l.derived)((function(){return a.default.isUser(this.id)})),this.isGroup=(0,l.derived)((function(){return a.default.isGroup(this.id)})),this.isBroadcast=(0,l.derived)((function(){return a.default.isBroadcast(this.id)})),this.isPSA=(0,l.derived)((function(){return a.default.isPSA(this.id)})),this.formattedShortNameWithNonBreakingSpaces=(0,l.derived)((function(){return this.id?this.isMe?g.default.t(1013):this.shortName||this.formattedName&&this.formattedName.replace(/\s/g," "):""}),["shortName","formattedName","id","locale"]),this.formattedShortName=(0,l.derived)((function(){return this.id?this.isMe?g.default.t(1013):this.shortName||this.formattedName:""}),["shortName","formattedName","id","locale"]),this.formattedName=(0,l.derived)((function(){return this.id?this.isMe?g.default.t(1013):a.default.isPSA(this.id)?g.default.t(1022):this.name?this.name:this.verifiedLevel===u.VERIFIED_LEVEL.HIGH&&this.verifiedName?this.verifiedName:this.isUser?(0,o.default)(this.id):"":""}),["name","id","locale","verifiedLevel","verifiedName"]),this.formattedUser=(0,l.derived)((function(){return this.getFormattedUser()}),["name","id","locale","verifiedLevel","verifiedName"]),this.isWAContact=(0,l.derived)((function(){return this.isUser&&"in"===this.type}),["type"]),this.isMyContact=(0,l.derived)((function(){var e;return!(!this.isUser||!(null===(e=this.name)||void 0===e?void 0:e.length))}),["name"]),this.showBusinessCheckmarkAsPrimary=(0,l.derived)((function(){return this.isBusiness&&this.verifiedLevel===u.VERIFIED_LEVEL.HIGH&&(this.name===this.verifiedName||!this.name)}),["isBusiness","verifiedLevel","name","verifiedName"]),this.showBusinessCheckmarkAsSecondary=(0,l.derived)((function(){return this.isBusiness&&this.verifiedLevel===u.VERIFIED_LEVEL.HIGH&&Boolean(this.name)&&this.name!==this.verifiedName}),["isBusiness","verifiedLevel","name","verifiedName"]),this.shouldForceBusinessUpdate=(0,l.derived)((function(){return!this.forcedBusinessUpdateFromServer&&!this.isContactSyncCompleted}),["forcedBusinessUpdateFromServer","isContactSyncCompleted"])}initialize(){super.initialize(),this.id&&(this.isMe&&this.addChild("status",S.StatusCollection.gadd(this.id)),this.isMe&&this.addChild("profilePicThumb",y.ProfilePicThumbCollection.gadd(this.id)),(this.isBusiness||this.isMe&&p.Conn.isSMB)&&this.addChild("businessProfile",n(93581).BusinessProfileCollection.gadd(this.id)),this.listenTo(this,"change:isBusiness",(()=>(0,d.onIsBusinessChange)(this))),this.isMe&&this.listenTo(p.Conn,"change:pushname",(()=>{this.set({pushname:p.Conn.pushname})})),this.listenTo(g.default,"locale_change",(()=>{this.locale=g.default.getLocale()})),this.listenTo(this,"change:name",this.updateShortName),this.isContactBlocked=!!c.BlocklistCollection.get(this.id),this.pendingAction=0,p.Conn.isSMB&&(0,m.initializeLabels)(this))}updateShortName(){if(this.isUser&&this.name&&!this.shortName){const e=(0,E.getShortName)(this.name);e&&this.set("shortName",e)}}getStatus(){return a.default.user(this.id)||__LOG__(2)`contact:getStatus for non-user ${this.id.toString()}`,this.status=S.StatusCollection.gadd(this.id)}getProfilePicThumb(){return this.profilePicThumb=y.ProfilePicThumbCollection.gadd(this.id)}addPendingAction(e){const t=()=>{this.decPending()};return e.then(t,t),this.pendingAction++,e}decPending(){this.pendingAction>0?this.pendingAction--:(__LOG__(2)`contact:onPendingActionUpdate pendingAction value is invalid`,this.pendingAction=0)}isBlocked(){return!!c.BlocklistCollection.get(this.id)}searchMatch(e,t,n){var r;return(0,_.canDisplayLabel)()&&n?!(e&&this.searchName&&!this.searchName.includes(e))&&Boolean(null===(r=this.labels)||void 0===r?void 0:r.includes(n)):!!e&&(!(!this.searchName||!this.searchName.includes(e))||(!(!this.userid||!this.userid.includes(e))||(!!(t&&this.userid&&this.userid.includes(t))||(!(!this.searchVerifiedName||!this.searchVerifiedName.includes(e))||!(!this.pushname||!g.default.accentFold(this.pushname).includes(e))))))}getFormattedUser(){return this.id?a.default.isPSA(this.id)?g.default.t(1022):this.name?this.name:this.verifiedLevel===u.VERIFIED_LEVEL.HIGH&&this.verifiedName?this.verifiedName:(0,o.default)(this.id):""}set(e,t,n){const r=super.set(e,t,n);if("string"!=typeof e&&(null==t?void 0:t.merge)&&r){if(r.isPSA)return r;!e.name&&r.name&&(r.unset("name"),r.unset("shortName")),!e.verifiedName&&r.verifiedName&&r.unset("verifiedName")}return r}getCollection(){return n(19380).ContactCollection}setNotMyContact(){this.name&&this.set("name",void 0)}}T.Proxy="contact",T.idClass=a.default;var b=(0,l.defineModel)(T);t.default=b},19380:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ContactCollectionImpl=t.ContactCollection=void 0;var i=r(n(23279)),a=n(50796),o=n(92574),s=n(13042),l=n(1255),c=n(45873),d=r(n(121)),u=n(47969),p=n(43024),f=n(8071),h=n(99234),_=r(n(14296)),g=r(n(35029)),m=n(62583),y=r(n(35609)),E=n(65044);class S extends l.BaseCollection{constructor(){super(),this._contactHashes=new g.default,this.checksum=void 0,this._frequentContacts={},this._sort=(0,i.default)((()=>super.sort()),1e3),this._silentSort=(0,i.default)((()=>super.sort({silent:!0})),1e3),this.listenTo(_.default,"locale_change",(()=>this.sort())),this.listenTo(this,"change:name",this.sort),this.listenTo(E.Socket,"change:stream",(()=>{E.Socket.stream===m.SOCKET_STREAM.RESUMING&&this.forEach((e=>{e.unset("verificationString"),e.unset("verificationBinary")}))})),this.listenTo(this,"add",this.contactAdded),this.listenTo(this,"remove",this.contactRemoved)}sort(e){return(null==e?void 0:e.silent)?this._silentSort():this._sort()}ensureSorted(){this._sort.flush()}initializeFromCache(e){e&&(__LOG__(2)`Store:Contact init from cache`,this.add(e,{silent:!0,merge:!0}))}contactAdded(e){this._contactHashes.put(e)}contactRemoved(e){this._contactHashes.remove(e)}contactHashLength(){return this._contactHashes.length}delete(){super.delete(),this.setChecksum(),delete this.checksum,this._frequentContacts={},(0,f.setFrequent)({}).catch((()=>{})),this._contactHashes.clear()}isFilteredContact(e){return!!e.name&&!e.isMe&&!e.isPSA&&e.isWAContact}getFilteredContacts(){return this.filter((function(e){return e.name&&!e.isMe&&!e.isPSA&&e.isWAContact}))}getGroupContacts(){return this.filter((e=>e.isGroup))}_find(e){const t=this.get(e);return t?Promise.resolve(t):Promise.resolve({id:e})}_findQuery(e){return(0,p.contactFindQuery)(e)}sync(){return this.findQuery({}).catch((0,a.filteredCatch)(o.WebdDrop,(()=>{}))),(0,y.default)(this,s.COLLECTION_HAS_SYNCED)}updateFrequentContacts(e){this._frequentContacts=e}frequentContacts(e,t){let n=e&&this._frequentContacts[e];if(n||(n=this._frequentContacts.message),!n)return[];const r=null==t?void 0:t.id;return n.map((e=>this.get(e))).filter((e=>!!e&&!e.id.equals(r)))}getUserCount(){return this.map((e=>e.isUser?1:0)).reduce(((e,t)=>e+t),0)}setChecksum(e){this.checksum=e,(0,h.setContactChecksum)(this.checksum),(0,c.setChecksum)(e).catch((()=>{}))}resolveWidsFromHash(e){return this._contactHashes.get(e)}}t.ContactCollectionImpl=S,S.model=d.default,S.comparator=u.ContactComparator;const v=new S;t.ContactCollection=v},47969:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ContactComparator=void 0,t.getCollator=function(){return o};var r=n(88102),i=n(99234),a=n(33970);let o;s(),r.Cmd.on("set_locale",s);function s(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a.DEFAULT_LOCALE;if(null===(e=self.Intl)||void 0===e?void 0:e.Collator){const e=self.Intl.Collator([t],{sensitivity:"base"});o={compare(t,n){try{return e.compare(t,n)}catch(e){return 0}}}}else o={compare:(e,t)=>e.localeCompare(t)}}t.ContactComparator=(e,t)=>{const n=e.id.toString(),r=t.id.toString(),a=(0,i.getMaybeMeUser)(),s=a&&a.toString();if(n===s)return 1;if(r===s)return-1;const l=e.name,c=t.name;if(!l&&c)return 1;if(l&&!c)return-1;if(l&&c&&e.header&&t.header){const n=o.compare(e.header,t.header);return 0===n?o.compare(l,c):n}return n&&r?n.localeCompare(r):-1}},959:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getShortName=function(e){if(null==e)return null;const[t]=e.split(/\s/);if(i.default.exec(t))return t;return __LOG__(2)`[short-name] unable to get short name for contact: ${e}`,null};var i=r(n(32161))},35029:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(82729)),a=r(n(45095)),o=r(n(89867));class s{constructor(){this._map={},this.length=0}static getSidelistHash(e){return e.isUser?"string"==typeof e.userhash&&e.userhash.slice?e.userhash.slice(0,4):(__LOG__(3)`Store:Contact can't call slice on contact.userhash`,null):null}put(e){const t=s.getSidelistHash(e);if(t&&!this._map[t]){if(this._map[t]){const n=this._map[t];n instanceof o.default?this._map[t]=[n,e.id]:n instanceof Array&&n.push(e.id)}else this._map[t]=e.id;this.length++}}remove(e){const t=s.getSidelistHash(e);if(!t||!this._map[t])return;const n=(0,a.default)(this._map[t],"this._map[hash]");n instanceof o.default?delete this._map[t]:n instanceof Array&&(0,i.default)(n,(t=>t.equals(e.id))),this.length++}get(e){const t=this._map[e];return t instanceof o.default?[t]:t}clear(){this._map={},this.length=0}}t.default=s},18787:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ConversionTupleExpiry=t.ConversionTuple=void 0;var i=n(8584),a=r(n(85074)),o=n(40234),s=r(n(89867)),l=n(11290);const c=604800;t.ConversionTupleExpiry=c;class d extends l.BaseModel{constructor(){super(...arguments),this.id=(0,l.prop)(),this.conversionData=(0,l.prop)(),this.conversionSource=(0,l.prop)(),this.timestamp=(0,l.prop)((()=>o.Clock.globalUnixTime())),this.alarmId=(0,l.session)()}initialize(){super.initialize(),this.listenTo(this,"change:timestamp",this._setExpiryTimer),this._setExpiryTimer()}_setExpiryTimer(){const e=this.timestamp+c;if(e<0)return __LOG__(3)`Invalid conversionTuple timer`,void this.delete();this.alarmId=a.default.setLocalTimeout((()=>{this.delete()}),1e3*e,this.alarmId)}_clearAlarm(){this.alarmId&&(a.default.clearTimeout(this.alarmId),this.alarmId=void 0)}elapsedSeconds(){return o.Clock.globalUnixTime()-this.timestamp}formatTuple(){const e={conversionDelaySeconds:this.elapsedSeconds()};return this.conversionData&&(e.conversionData=this.conversionData),this.conversionSource&&(e.conversionSource=this.conversionSource),e}toJSON(){const e=this.serialize(),t=e.conversionData;if(t instanceof ArrayBuffer){const n=new i.Binary(t);e.conversionData=n.readString(t.byteLength)}return e}delete(){super.delete(),this.getCollection().remove(this.id),this._clearAlarm()}getCollection(){return n(35667).default}}d.Proxy="conversionTuple",d.idClass=s.default;const u=(0,l.defineModel)(d);t.ConversionTuple=u},35667:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(40234),i=n(14648),a=n(1255),o=n(18787),s=n(81093);class l extends a.BaseCollection{initializeFromCache(e){if(!e)return;const t=r.Clock.globalUnixTime()-o.ConversionTupleExpiry,n=e.filter((e=>e.timestamp-t>0)).map((e=>{const t=(0,s.parseConversionData)(e.conversionData);return t?e.conversionData=t:delete e.conversionData,e}));this.add(n),this.saveToCache()}}l.model=o.ConversionTuple,l.cachePolicy={id:"conversion_tuple",policy:i.CACHE_POLICY.LOAD,delay:1e3};var c=new l;t.default=c},21547:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(11290);const i=864e5;class a extends r.BaseModel{constructor(){super(...arguments),this.id=(0,r.prop)(),this.startTime=(0,r.prop)(),this.pttCancelBroadcast=(0,r.prop)(0),this.pttCancelGroup=(0,r.prop)(0),this.pttCancelIndividual=(0,r.prop)(0),this.pttDraftReviewBroadcast=(0,r.prop)(0),this.pttDraftReviewGroup=(0,r.prop)(0),this.pttDraftReviewIndividual=(0,r.prop)(0),this.pttFastplaybackBroadcast=(0,r.prop)(0),this.pttFastplaybackGroup=(0,r.prop)(0),this.pttFastplaybackIndividual=(0,r.prop)(0),this.pttLockBroadcast=(0,r.prop)(0),this.pttLockGroup=(0,r.prop)(0),this.pttLockIndividual=(0,r.prop)(0),this.pttPlaybackBroadcast=(0,r.prop)(0),this.pttPlaybackGroup=(0,r.prop)(0),this.pttPlaybackIndividual=(0,r.prop)(0),this.pttRecordBroadcast=(0,r.prop)(0),this.pttRecordGroup=(0,r.prop)(0),this.pttRecordIndividual=(0,r.prop)(0),this.pttSendBroadcast=(0,r.prop)(0),this.pttSendGroup=(0,r.prop)(0),this.pttSendIndividual=(0,r.prop)(0),this.pttPausedRecordBroadcast=(0,r.prop)(0),this.pttPausedRecordGroup=(0,r.prop)(0),this.pttPausedRecordIndividual=(0,r.prop)(0),this.pttStopTapBroadcast=(0,r.prop)(0),this.pttStopTapGroup=(0,r.prop)(0),this.pttStopTapIndividual=(0,r.prop)(0),this.pttOutOfChatBroadcast=(0,r.prop)(0),this.pttOutOfChatGroup=(0,r.prop)(0),this.pttOutOfChatIndividual=(0,r.prop)(0)}getEndTime(){return this.startTime+i}shouldBeSubmitted(){return!this.isExpired()&&this.getEndTime()<Date.now()}isExpired(){const e=Date.now()-18144e5;return this.startTime<e}}a.Proxy="daily-aggregated-stats";var o=(0,r.defineModel)(a);t.default=o},66423:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.DailyAggregatedStatsCollectionImpl=t.DailyAggregatedStatsCollection=void 0;var i=r(n(45095)),a=n(14648),o=n(1255),s=r(n(21547)),l=n(99234);const c=864e5;class d extends o.BaseCollection{gaddForDate(e){var t;const n=(0,l.getDailyStatsStartTime)(),r=e.getTime()-n,a=Math.floor(r/c),o=n+c*a;return null!==(t=this.get(o))&&void 0!==t?t:(0,i.default)(this.add({id:o.toString(),startTime:o})[0],"this.add({\n  id: startTime.toString(),\n  startTime\n})[0]")}gaddForToday(){return this.gaddForDate(new Date)}initializeFromCache(e){if(null==e)return;const t=e.map((e=>new s.default(e))).filter((e=>p(e)&&!e.isExpired()));this.add(t)}serialize(){return this.toArray().filter((e=>p(e)&&!e.isExpired())).map((e=>e.toJSON()))}}t.DailyAggregatedStatsCollectionImpl=d,d.model=s.default,d.cachePolicy={id:"daily_aggregated_stats",policy:a.CACHE_POLICY.LOAD,delay:1e3};const u=new d;function p(e){return(e.startTime-(0,l.getDailyStatsStartTime)())%c==0}t.DailyAggregatedStatsCollection=u},93894:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(11290);class i extends r.BaseModel{constructor(){super(...arguments),this.id=(0,r.prop)(),this.weight=(0,r.prop)()}}i.Proxy="recentEmoji";var a=(0,r.defineModel)(i);t.default=a},92671:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.RecentEmojiCollectionImpl=t.RecentEmojiCollection=void 0;var i=r(n(23493)),a=r(n(23279)),o=n(50796),s=n(92574),l=n(88555),c=n(14648),d=n(1255),u=n(67247),p=n(7293),f=n(72407),h=r(n(93894)),_=r(n(56891));class g extends d.BaseCollection{constructor(){super(),this.dirty=!1,this._throttledSync=(0,i.default)((function(e){e.sync()}),36,{leading:!1}),this.listenTo(this,"change:weight change:length",(0,a.default)(this._sortTrimScale,100))}_sortTrimScale(){const e=this.length;e&&(this.sort(),e>36&&this.remove(this.models.slice(36)))}delete(){super.delete(),this.dirty=!1,this._throttledSync.cancel()}sync(){return this.findQuery({},{set:!0}).finally((()=>{this.dirty=!1})).catch((0,o.filteredCatch)(s.WebdDrop,(()=>{})))}_findQuery(){return p.GK.supportsFeature(p.GK.F.RECENT_EMOJI_SYNC)&&(0,l.isLegacyWebdBackend)()?_.default.recentEmojiQuery(this.dirty?this.toArray():void 0).then((function(e){if(Array.isArray(e))return e.forEach((function(e){e.id=u.EmojiUtil.normalizeAllEmojis(e.id)})),e;throw __LOG__(3)`models:recentEmoji:findQuery error`,new Error("recent emoji fetch error")})):Promise.reject(new d.CollectionSilentQueryError("gk recent emoji sync unsupported"))}throttledSync(){p.GK.supportsFeature(p.GK.F.RECENT_EMOJI_SYNC)&&(__LOG__(2)`models:RecentEmoji:throttledSync dirty: ${String(this.dirty)}`,this._throttledSync(this))}increment(e){const t=u.EmojiUtil.getSkinToneBase(e)||e;this.get(t)||this.add({id:t,weight:0}),this.forEach((e=>{e.id===t?e.weight+=1:e.weight*=.9})),this.dirty=!0,this.throttledSync()}}t.RecentEmojiCollectionImpl=g,g.cachePolicy={id:f.KEYS.RECENT_EMOJI_COLLECTION,policy:c.CACHE_POLICY.LOAD,delay:2e3},g.comparator=(e,t)=>e.weight>t.weight?-1:1,g.model=h.default;const m=new g;t.RecentEmojiCollection=m},14423:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(48926)),a=n(50796),o=n(57319),s=n(92574),l=n(88555),c=r(n(89867)),d=n(48360),u=n(57849),p=n(11290),f=n(19380),h=n(99234),_=n(57701),g=n(62415),m=n(55981),y=n(41566),E=(r(n(11339)),r(n(96091))),S=r(n(48911)),v=n(48537),T=r(n(73213)),b=r(n(11824)),C=n(97270),A=r(n(56891));class P extends p.BaseModel{constructor(){super(...arguments),this.participants=(0,p.collection)(E.default),this.pendingParticipants=(0,p.collection)(S.default),this.id=(0,p.prop)(),this.creation=(0,p.prop)(),this.owner=(0,p.prop)(),this.desc=(0,p.prop)(),this.descId=(0,p.prop)(),this.descTime=(0,p.prop)(),this.descOwner=(0,p.prop)(),this.restrict=(0,p.prop)(),this.announce=(0,p.prop)(),this.noFrequentlyForwarded=(0,p.prop)(),this.ephemeralDuration=(0,p.prop)(),this.growthLockExpiration=(0,p.prop)(),this.growthLockType=(0,p.prop)(),this.size=(0,p.prop)(),this.support=(0,p.prop)(),this.suspended=(0,p.prop)(!1),this.terminated=(0,p.prop)(!1),this.uniqueShortNameMap=(0,p.prop)(),this.isParentGroup=(0,p.prop)(),this.parentGroup=(0,p.prop)(),this.defaultSubgroup=(0,p.prop)(),this.unjoinedSubgroups=(0,p.prop)((()=>[])),this.joinedSubgroups=(0,p.session)((()=>[])),this.stale=(0,p.session)(!0),this.trusted=(0,p.session)(!0),this.inviteCode=(0,p.session)(),this.groupInviteCodePromise=(0,p.session)(),this.revokeGroupInvitePromise=(0,p.session)(),this.revokeGroupV4AddInvitePromise=(0,p.session)(),this.groupInviteLink=(0,p.derived)((function(){return this.inviteCode?`https://chat.whatsapp.com/${this.inviteCode}`:null}),["inviteCode"]),this.cachedDeviceCount=(0,p.session)(),this.cachedDeviceSizeBucket=(0,p.session)(),this.notAddedByContact=(0,p.prop)(!1),this.addedBy=(0,p.prop)(),this.groupType=(0,p.derived)((function(){return!0===this.defaultSubgroup?m.GroupType.DEFAULT_ANNOUNCEMENT_GROUP:null!=this.parentGroup?m.GroupType.SUBGROUP:!0===this.isParentGroup?m.GroupType.COMMUNITY:m.GroupType.DEFAULT}),["parentGroup","isParentGroup","defaultSubgroup"]),this.displayedDesc=(0,p.derived)((function(){return(0,_.communitiesEnabled)()&&this.groupType===m.GroupType.DEFAULT_ANNOUNCEMENT_GROUP?d.fbt._("",null,{hk:"4kc4Kr"}).toString():this.desc}),["desc","groupType"])}hasUniqueShortNameMention(e){var t;if(!this.uniqueShortNameMap||!e.shortName||!e.isMyContact)return!1;const n=this._normalizeShortName(e.shortName);return null!==(t=this.uniqueShortNameMap.get(n))&&void 0!==t&&t}_normalizeShortName(e){return e.toLowerCase().trim()}delete(){super.delete(),this.getCollection().remove(this.id),this.participants.delete()}canSetSubject(){return(!(0,_.communitiesEnabled)()||this.groupType!==m.GroupType.DEFAULT_ANNOUNCEMENT_GROUP)&&(!!this.participants.iAmMember()&&((this.participants.iAmAdmin()||!0!==this.restrict)&&!this.support))}canSetDescription(){return(!(0,_.communitiesEnabled)()||this.groupType!==m.GroupType.DEFAULT_ANNOUNCEMENT_GROUP)&&(!(!this.participants.iAmMember()||!this.participants.iAmAdmin()&&this.restrict)&&!this.support)}canSetGroupProperty(){return!!this.participants.iAmAdmin()&&!this.support}canSetEphemeralSetting(){const e=!this.support;return!!this.participants.iAmMember()&&((this.participants.iAmAdmin()||!(this.restrict||!(0,l.isMDBackend)()||!(0,u.getABPropConfigValue)("ephemeral_allow_group_members")))&&e)}initialize(){p.BaseModel.prototype.initialize.call(this),this.listenTo(this.participants,"change:isAdmin change:isSuperAdmin change:contact.isMyContact sort remove reset",this.isTrusted),this.listenTo(this.participants,"add remove reset",this.triggerParticipantsChange),this.listenTo(this,"change:owner",this.isTrusted),this.listenTo(this,"change:notAddedByContact",this.isTrusted),this.isTrusted(),this._updateUniqueShortNameMapTimer=this._createUniqueNameMapShiftTimer(),this.listenTo(this.participants,"change:contact.shortName",this.onParticipantShortNameUpdated),this.uniqueShortNameMap=new Map,this.unreadMentionMetadata=new b.default,this.groupType===m.GroupType.COMMUNITY&&(0,C.updateJoinedSubgroups)(this)}onParticipantShortNameUpdated(){var e;null===(e=this._updateUniqueShortNameMapTimer)||void 0===e||e.debounce(P.UPDATE_NAME_MAP_DEBOUNCE_TIME)}triggerParticipantsChange(){var e;(0,y.isDropLastNameEnabled)()&&(null===(e=this._updateUniqueShortNameMapTimer)||void 0===e||e.debounce(P.UPDATE_NAME_MAP_DEBOUNCE_TIME));this.trigger("change:participants")}_createUniqueNameMapShiftTimer(){return new o.ShiftTimer((()=>{if((0,y.isDropLastNameEnabled)()){const e=new Map;this.participants&&this.participants.forEach((t=>{if(t.contact.shortName&&t.contact.isMyContact){const n=this._normalizeShortName(t.contact.shortName);e.has(n)?e.set(n,!1):e.set(n,!0)}})),this.uniqueShortNameMap=e}}))}isTrusted(){if(this.stale)return this.trusted;if(this.support)return this.trusted=!0;if(this.addedBy){const e=f.ContactCollection.get(this.addedBy);if(null==e?void 0:e.isMyContact)return this.notAddedByContact=!1,this.trusted=!0}return this.notAddedByContact?this.trusted=!1:this.trusted=!0}revokeGroupV4AddInvite(e){if(this.revokeGroupV4AddInvitePromise)return this.revokeGroupV4AddInvitePromise;const t=this.id.toString(),{pendingParticipants:n}=this;let r=Promise.resolve();return r=(0,v.revokeGroupInviteV4)(e,t),this.revokeGroupV4AddInvitePromise=r.then((t=>(t.status>=200&&t.status<300&&n.remove(e),t.status))).catch((()=>(__LOG__(3)`models:groupMetadata:participantCollection:revokeGroupV4AddInvite failed`,500))).finally((()=>{this.revokeGroupV4AddInvitePromise=null}))}queryGroupV4PendingInvite(){var e=this;return(0,i.default)((function*(){if((0,l.isMDBackend)())return void(yield(0,g.updatePendingParticipants)(e.id));const t=(0,h.getMaybeMeUser)().toString(),n=e.id.toString();return A.default.findGroupPendingInvitesFromPhone(t,n).then((t=>{e.collection&&e.collection.add({id:e.id,pendingParticipants:t.participants},{merge:!0})})).catch((0,a.filteredCatch)(s.WebdDrop,(()=>{})))}))()}getJoinedSubgroupsMetadata(){const e=this.getCollection();return this.joinedSubgroups.map((t=>e.get(t.toString()))).filter(Boolean)}getUnjoinedSubgroupsMetadata(){return this.unjoinedSubgroups.map((e=>T.default.get(e.toString()))).filter(Boolean)}getSubgroupsMetadata(){return[...this.getJoinedSubgroupsMetadata(),...this.getUnjoinedSubgroupsMetadata()]}getCollection(){return n(63928).default}}P.Proxy="groupMetadata",P.idClass=c.default,P.UPDATE_NAME_MAP_DEBOUNCE_TIME=200;var M=(0,p.defineModel)(P);t.default=M},63928:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(48926)),a=r(n(93386)),o=n(50796),s=n(92574),l=n(88555),c=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=b(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(35232)),d=r(n(89867)),u=n(45454),p=n(1255),f=n(69951),h=n(42822),_=n(57701),g=n(90101),m=r(n(14423)),y=n(96269),E=n(10790),S=n(95716),v=n(97270),T=r(n(56891));function b(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(b=function(e){return e?n:t})(e)}class C extends p.BaseCollection{constructor(){super(),this.listenTo(this,"add",this.onGroupAdd),this.listenTo(this,"remove",this.onGroupRemove),this.listenTo(this,"change:parentGroup",this.onParentGroupChange)}onGroupAdd(e){if(!e.participants.iAmMember())return;const t=e.parentGroup?this.get(e.parentGroup.toString()):null;if(null!=t){const n=e.id;(0,v.addJoinedSubgroup)(t,n)}}onGroupRemove(e){if(!e.participants.iAmMember())return;const t=e.parentGroup?this.get(e.parentGroup.toString()):null;if(null!=t){const n=e.id;(0,v.removeJoinedSubgroup)(t,n)}}onParentGroupChange(e,t,n){if(!e.participants.iAmMember())return;const r=e.id,i=null!=t?this.get(t.toString()):null,a=null!=n?this.get(n.toString()):null;null!=i&&(0,v.addJoinedSubgroup)(i,r),null!=a&&(0,v.removeJoinedSubgroup)(a,r)}onResume(){(0,a.default)(f.ChatCollection.where({active:!0}).filter((e=>e.isGroup||e.isBroadcast)),f.ChatCollection.where({isBroadcast:!0})).forEach((e=>{this.find(e.id).catch((0,o.filteredCatch)([s.WebdDrop,c.ProtoVersionUndefined],(()=>{})))}))}_find(e){var t=this;return(0,i.default)((function*(){if(d.default.isGroup(e)){var r;const t=n(69951).ChatCollection.get(e);if(null==t?void 0:t.isReadOnly)return(0,l.isMDBackend)()?(__LOG__(3)`queryGroupFromPhone: not implemented for MD`,Promise.resolve({id:e})):(0,y.queryGroupFromPhone)(e);let i=yield(0,g.getGroupMetadataFromStorage)(e);if(null==i)i=yield(0,E.sendQueryGroup)(e);else{const t=i.unjoinedSubgroups;if((0,_.communitiesEnabled)()&&null!=t&&t.length>0){const n=yield(0,S.getUnjoinedSubgroupsMetadataFromStorage)(t);(0,h.addUnjoinedSubgroupsToCollection)(n,e)}}return(0,E.updateSubject)(e,null!=(null===(r=i)||void 0===r?void 0:r.subject)?i.subject:""),i}if(d.default.isBroadcast(e)){if((0,l.isMDBackend)())return __LOG__(3)`contactFindBroadcast: not implemented for MD`,Promise.resolve({id:e});const n=yield T.default.contactFindBroadcast(e);if(200===n.status){const r=t.get(e);return r&&!r.stale?r:{id:e,participants:n.recipients}}if(404===n.status)return __LOG__(3)`models:GroupMetadataCollection:_find:False broadcast list query`,{id:e};throw __LOG__(3)`models:GroupMetadataCollection:_find:bclist error: ${n.status}`,new Error("models:GroupMetadataCollection:_find:bclist error: "+n.status)}return __LOG__(2)`groupMetadata:find trying to fetch non-group/bclist wid ${e.toString()}`,Promise.reject(new Error(`groupMetadata:find trying to fetch non-group/bclist wid ${e.toString()}`))}))()}_handle(e){return e}handlePendingInvite(e){const{gid:t,participants:n}=e;this.add({id:(0,u.createWid)(t),pendingParticipants:n},{merge:!0})}}C.model=m.default,C.staleCollection=!0;var A=new C;t.default=A},55981:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GroupType=void 0;const r=n(76672).Mirrored(["DEFAULT","COMMUNITY","SUBGROUP","DEFAULT_ANNOUNCEMENT_GROUP"]);t.GroupType=r},45077:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(89867)),a=n(11290),o=n(19380);class s extends a.BaseModel{constructor(){super(...arguments),this.id=(0,a.prop)(),this.isAdmin=(0,a.prop)(),this.isSuperAdmin=(0,a.prop)(),this.contact=(0,a.session)()}initialize(){super.initialize(),this.addChild("contact",o.ContactCollection.gadd(this.id))}}s.Proxy="participant",s.idClass=i.default;var l=(0,a.defineModel)(s);t.default=l},96091:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(23279)),a=n(88555),o=n(69951),s=r(n(31727)),l=n(19380),c=n(56489),d=n(99234),u=n(57701),p=r(n(14296)),f=r(n(45077)),h=r(n(26812)),_=n(97270);class g extends s.default{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),this._updateSubgroup=e=>{var t,n,r;const i=(0,d.getMaybeMeUser)();if(!i||!i.equals(e.id))return;const a=this.parent.id,s=a?null===(t=o.ChatCollection.get(a.toString()))||void 0===t||null===(n=t.groupMetadata)||void 0===n?void 0:n.parentGroup:null,l=s?null===(r=o.ChatCollection.get(s.toString()))||void 0===r?void 0:r.groupMetadata:null;null!=l&&(this.iAmMember()?(0,_.addJoinedSubgroup)(l,a):(0,_.removeJoinedSubgroup)(l,a))},this._debouncedSort=(0,i.default)((()=>this.sort()),1e3),this.sendForNeededAddRequest=e=>{var t,n;const r=this.parent.id,i=o.ChatCollection.assertGet(r),a=null!==(t=null===(n=i.groupMetadata)||void 0===n?void 0:n.desc)&&void 0!==t?t:"";(0,c.sendForNeededAddRequest)(e,i.formattedTitle||i.name,a,this.parent.id)},this.listenTo(this,"change:contact.name",this._debouncedSort),this.listenTo(p.default,"locale_change",this._debouncedSort),this.listenTo(this,"add remove",this._updateSubgroup)}delete(){this.forEach((function(e){e.delete()})),this.stopListening(),this.reset()}ensureSorted(){this._debouncedSort.flush()}set(e,t){const n=t||{};return n.isParticipantCollectionAdd||(n.remove=!0),super.set(e,n)}add(e,t){const n=t||{};return n.isParticipantCollectionAdd=!0,super.add(e,n)}canAdd(){return!!this.iAmAdmin()}canPromote(e){return!!e&&(!(0,d.getMaybeMeUser)().equals(e.id)&&(!!this.iAmAdmin()&&!e.isAdmin))}canDemote(e){var t;if(!e)return!1;if(!this.iAmAdmin())return!1;const n=this.parent.id,r=o.ChatCollection.assertGet(n);if((!(0,u.cadminSelfDemoteEnabled)()||!0!==(null===(t=r.groupMetadata)||void 0===t?void 0:t.isParentGroup)||1===this.getAdmins().length)&&(0,d.getMaybeMeUser)().equals(e.id))return!1;return!e.isSuperAdmin&&!!e.isAdmin}canRemove(e){return!!e&&(!(0,d.getMaybeMeUser)().equals(e.id)&&!!this.iAmAdmin())}canVerifyIdentity(e){return!(0,a.isLegacyWebdBackend)()&&(!!e&&!(0,d.getMaybeMeUser)().equals(e.id))}iAmMember(){return 1===this.filter((e=>e.id.equals((0,d.getMaybeMeUser)()))).length}iAmRestrictedMember(){var e;const t=this.parent.id;return!0===(null===(e=o.ChatCollection.assertGet(t).groupMetadata)||void 0===e?void 0:e.restrict)&&!this.iAmAdmin()}iAmAdmin(){return 1===this.filter((e=>e.id.equals((0,d.getMaybeMeUser)())&&e.isAdmin)).length}iAmSuperAdmin(){return 1===this.filter((e=>e.id.equals((0,d.getMaybeMeUser)())&&e.isSuperAdmin)).length}getAdmins(){return this.where({isAdmin:!0})}getSuperAdmin(){return this.findFirst((e=>e.isSuperAdmin))}getMyContacts(){return this.filter((e=>{var t;return!!(null===(t=l.ContactCollection.get(e.id))||void 0===t?void 0:t.isMyContact)}))}}t.default=g,g.model=f.default,g.comparator=h.default},26812:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(47969);var i=(e,t)=>(0,r.ContactComparator)(e.contact,t.contact);t.default=i},48911:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(23279)),a=r(n(31727)),o=r(n(14296)),s=r(n(45077)),l=r(n(26812));class c extends a.default{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),this._debouncedSort=(0,i.default)((()=>this.sort()),1e3),this.listenTo(this,"change:contact.name",this._debouncedSort),this.listenTo(o.default,"locale_change",this._debouncedSort)}delete(){this.forEach((function(e){e.delete()})),this.stopListening(),this.reset()}ensureSorted(){this._debouncedSort.flush()}set(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.isParticipantCollectionAdd||(t.remove=!0),super.set(e,t)}add(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.isParticipantCollectionAdd=!0,super.add(e,t)}}t.default=c,c.model=s.default,c.comparator=l.default},33689:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(89867)),a=n(48360),o=n(11290),s=n(55981),l=r(n(96091));class c extends o.BaseModel{constructor(){super(...arguments),this.id=(0,o.prop)(),this.subject=(0,o.prop)(),this.parentGroupId=(0,o.prop)(),this.defaultSubgroup=(0,o.prop)(),this.desc=(0,o.prop)(),this.participants=(0,o.collection)(l.default),this.groupType=(0,o.derived)((function(){return!0===this.defaultSubgroup?s.GroupType.DEFAULT_ANNOUNCEMENT_GROUP:s.GroupType.SUBGROUP}),["defaultSubgroup"]),this.displayedDesc=(0,o.derived)((function(){return this.groupType===s.GroupType.DEFAULT_ANNOUNCEMENT_GROUP?a.fbt._("",null,{hk:"4kc4Kr"}).toString():this.desc}),["desc","groupType"])}}c.Proxy="unjoinedSubgroupMetadata",c.idClass=i.default;var d=(0,o.defineModel)(c);t.default=d},73213:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(1255),a=r(n(33689));class o extends i.BaseCollection{}o.model=a.default;var s=new o;t.default=s},11824:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(11290),a=r(n(11006));n(43323);class o extends i.BaseModel{constructor(){super(...arguments),this.unreadMentionCollection=(0,i.prop)(),this.pendingUnreadMentionCount=(0,i.prop)()}initialize(){this.unreadMentionCollection=new a.default,this.pendingUnreadMentionCount=0}hasMentionId(e){return null!=this.unreadMentionCollection.get(e)}addUnreadMentions(e){this.unreadMentionCollection.add(e)}removeUnreadMentions(e){this.unreadMentionCollection.remove(e)}oldestUnreadMention(){return this.unreadMentionCollection.oldestUnreadMention()}reset(){this.pendingUnreadMentionCount=0,this.unreadMentionCollection.reset()}getUnreadMentionCount(){return this.pendingUnreadMentionCount+this.unreadMentionCollection.length}}var s=(0,i.defineModel)(o);t.default=s},43323:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UnreadMessageType=void 0;const r=n(76672).Mirrored(["NEW_MESSAGE","PERSISTANCE_LOAD","HISTORYC_SYNC_CHUNK"]);t.UnreadMessageType=r},1255:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.CollectionSilentQueryError=t.BaseCollection=void 0;var i=r(n(48926)),a=r(n(81109)),o=r(n(73955)),s=r(n(39693)),l=r(n(43063)),c=n(50796),d=n(51737),u=n(92574),p=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=v(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(35232)),f=n(14648),h=n(73923),_=r(n(31727)),g=n(17239),m=n(53055),y=(n(27798),n(62583)),E=n(8080),S=n(65044);function v(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(v=function(e){return e?n:t})(e)}const T="QUERY",b="FIND",C="UPDATE",A=(new Object).toString(),P={id:"none",policy:f.CACHE_POLICY.NONE};class M extends Error{constructor(e){super(e),this.name="CollectionSilentQueryError",this.message=e}}t.CollectionSilentQueryError=M;class O extends _.default{constructor(){super(),this._inflight={},this._cachePolicy=(0,h.createCachePolicy)(this,this.constructor.cachePolicy||P),this._staleCollection=this.constructor.staleCollection||!1,this._resumeOnAvailable=this.constructor.resumeOnAvailable||!1,(!0===this._staleCollection||(0,d.isFunction)(this.onResume))&&(this.listenTo(S.Socket,"change:stream",this._handleStreamChange),this.listenTo(S.Socket,"didResume",this._onResume),this._resumeOnAvailable&&this.listenTo(E.Stream,"change:available",(()=>{E.Stream.available&&this._needsUpdate&&this._onResume()}))),this._cachePolicy.enableCaching(),this._cachePolicy.constructor.policy===f.CACHE_POLICY.LOAD&&this.listenTo(g.Conn,"me_ready",this._updateFromCache)}initializeFromCache(e){this.add(e)}saveToCache(){if(!g.Conn.shouldSaveToCache())return;const{id:e}=this._cachePolicy;__LOG__(2)`baseCollection:saveToCache save: ${String(e)}`,(0,m.setCollection)(e,this.toJSON())}add(e,t){if(e){if(g.Conn.blockStoreAdds)throw new u.LogoutDrop("adding to store when blocking store adds");const n=Array.isArray(e)?e:[e];if(n.every((e=>null==e?void 0:e.isState))){const e=(0,l.default)(n,(e=>this.get(e.id)));return e.length&&super.add(e,t),n}}return super.add(e,t)}findQuery(e,t){return this._query(T,e,t)}find(e,t){return e?this._query(b,e,t):(__LOG__(4,void 0,new Error,!0)`Called find without an id`,SEND_LOGS("find-without-id"),Promise.reject(new Error("called find without an id")))}update(e,t){return e?this._query(C,e,t):(__LOG__(4,void 0,new Error,!0)`Called update without an id`,SEND_LOGS("update-without-id"),Promise.reject(new Error("called update without an id")))}handle(e){const t=this._handle(e.shift());if(this._staleCollection){const e=Array.isArray(t)?t:[t];(0,s.default)(e).forEach((e=>{e.stale=!1}))}this.add(t,{merge:!0})}gadd(e,t){if(this.modelClass.prototype.isIdType(e)){const n=this.get(e);return n||this.add({id:e},t)[0]}if(e.id){const n=t||{};return n.merge=!0,this.add(e,n)[0]}throw new Error("gadd called without an id attr (id)")}gaddUp(e){let t,n=this._staleCollection;if(this.modelClass.prototype.isIdType(e)){const r={stale:n,id:e};t=this.get(e)||this.add(r,{merge:!0})[0]}else e.id&&(this.get(e.id)&&(n=!1),e=(0,a.default)({stale:n},e),t=this.add(e,{merge:!0})[0]);if(t){const e=t;return t.stale&&this.find(t.id).catch((0,c.filteredCatch)(u.WebdDrop,(()=>{}))),e}throw new Error(".gaddUp called without an id attr (id)")}delete(){this._inflight={},this.reset()}isStateStale(e){const t=this.get(e);return!!t&&t.stale}_handleResume(){switch(S.Socket.stream){case y.SOCKET_STREAM.DISCONNECTED:if(!this._staleCollection)return;this.forEach((e=>{e&&(e.stale=!0)}));break;case y.SOCKET_STREAM.RESUMING:case y.SOCKET_STREAM.SYNCING:case y.SOCKET_STREAM.CONNECTED:}}_onResume(){(0,d.isFunction)(this.onResume)&&(this._resumeOnAvailable&&!E.Stream.available?this._needsUpdate=!0:(this.onResume(),this._needsUpdate=!1))}_query(e,t,n){let r=(0,d.isString)(t)?t:t.toString();r===A&&(r=(0,o.default)("collection_query_"));const i=e===T?void 0:this.get(t),a="force-"+r;return(this._inflight[a]&&e===b||e===C)&&(r=a),this._inflight[r]?e===b&&i&&!i.stale?Promise.resolve(i):this._inflight[r]:!i||i.stale||e===C?this._inflight[r]=this._serverQuery(e,t,n).finally((()=>{delete this._inflight[r]})).catch((0,c.filteredCatch)(u.LogoutDrop,(e=>{__LOG__(3)`LogoutDrop error: ${e.toString()}`}))).catch((e=>{if(!(e instanceof M))throw e;__LOG__(2)`baseCollection:query query promise rejected: ${String(e)}`})).catch((0,c.filteredCatch)(u.WebdDrop,(function(e){throw __LOG__(3)`WebdDrop error: ${e.toString()}`,e}))):Promise.resolve(i)}_serverQuery(e,t,n){var r=this;return(0,i.default)((function*(){let i;if(e===C)i=r._update(t,n);else if(e===b)i=r._find(t,n);else{const e=null==n?void 0:n.logOnSend;i=r._findQuery(t,e)}const a=yield i;if(r._staleCollection){const e=Array.isArray(a)?a:[a];(0,s.default)(e).forEach((function(e){void 0===e.stale&&(e.stale=!1)}))}let o;if(o=(null==n?void 0:n.set)?r.set(a):r.add(a,{merge:!0}),Array.isArray(a))return o;if(o[0])return o[0];throw new p.ModelCreateError("Unknown",a)}))()}_update(e,t){return this._find(e,t)}_handleStreamChange(){this._handleResume(),this._cachePolicy.constructor.policy===f.CACHE_POLICY.LOAD&&this._updateFromCache()}_updateFromCache(){const{id:e}=this._cachePolicy;this._cachePolicy.disableCaching(),g.Conn.shouldSaveToCache()&&(__LOG__(2)`baseCollection:initFromCache load: ${String(e)}`,this.initializeFromCache((0,m.getCollection)(e)),this._cachePolicy.enableCaching())}}t.BaseCollection=O},25389:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.BaseMirror=void 0,t.genBitMask=function(e,t){const n=[];for(let r=0;r<t.length;r++){const i=e[`change:${t[r]}`],a=Math.floor(i/32);o(n,a+1),n[a]|=1<<i%32}return n},t.genMirrorMask=function(e){const t={};let n=0;const r=e=>{t[`change:${e}`]=n++};e.props&&Object.keys(e.props).forEach(r);e.session&&Object.keys(e.session).forEach(r);e.derived&&Object.keys(e.derived).forEach(r);return t};var i=r(n(4788));function a(e,t){e[t]=e[e.length-1],e.pop()}function o(e,t){if(t<=e.length)return;const n=t-e.length;for(let t=0;t<n;t++)e.push(0)}t.BaseMirror=class{constructor(e){this.state=e}destructor(){this.state.off("all",this.onGatherEvent,this)}initListener(){this.state.on("all",this.onGatherEvent,this),this.masks=[],this.listeners=[],this.changeEvents=[]}onGatherEvent(e){if("change"===e){if(!this.changeEvents.filter(Boolean).length)return;this.onChange(),this.changeEvents=[]}else{const t=this.state.mirrorMask[e];if(void 0===t)return;const n=t/32|0;o(this.changeEvents,n+1),this.changeEvents[n]|=1<<(t%32|0)}}onChange(){const e=this.state,t=this.changeEvents;(0,i.default)(this.masks,this.listeners).forEach((n=>{let[r,i]=n;const a=Math.min(t.length,r.length);for(let n=0;n<a;n++)if(t[n]&r[n]){const[t,n]=i;null!=t&&null!=n&&t(n,e);break}}))}addListener(e,t,n){this.listeners||this.initListener(),this.masks.push(t),this.listeners.push([e,n])}removeListener(e){const t=this.listeners;for(let n=0;n<t.length;n++)t[n][0]===e&&(t[n][0]=null,t[n][1]=null,a(this.masks,n),a(t,n))}}},11290:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.BaseModel=void 0,Object.defineProperty(t,"collection",{enumerable:!0,get:function(){return h.collection}}),t.defineModel=function(e){const t=(0,h.convert)(e),n=(0,h.stateExtend)(m,t);if(e.Proxy){const r=(0,p.genMirrorMask)(t);n.prototype.mirrorMask=r,n.prototype.proxyName=e.Proxy,(0,_.ProxyStateFactory)(e.Proxy,t,r)}return n},Object.defineProperty(t,"derived",{enumerable:!0,get:function(){return h.derived}}),Object.defineProperty(t,"prop",{enumerable:!0,get:function(){return h.prop}}),Object.defineProperty(t,"session",{enumerable:!0,get:function(){return h.session}});var i=r(n(81109)),a=r(n(7287)),o=r(n(2525)),s=r(n(52353)),l=r(n(14176)),c=n(51737),d=n(92574),u=r(n(76521)),p=n(25389),f=n(88102),h=n(67820),_=n(80134);const g=/^change:/;class m extends u.default{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(super(),this.stale=(0,h.session)(!1),this.__fired=null,this.__changes=null,this.__initialized=!1,t._internalInitializationDoNotUse)return;this.stale=(null==e?void 0:e.stale)||this.getDefault("stale"),this.parent=t.parent,this.collection=t.collection,this._initDeriveds(),this._initCollections();const n=this.__defaults,r=n?(0,i.default)((0,i.default)({},n),e):e;r&&!function(e){for(const t in e)if(e.hasOwnProperty(t))return!1;return!0}(r)&&this.set(r,(0,i.default)({silent:!0},t)),this.initialize(),this.__initialized=!0}initialize(){if(this.collection&&this.id&&!this.collection.modelClass.prototype.isIdType(this.id))throw new Error(`Model id:${String(this.id)} is wrong type`);this._uiObservers=0,this.mirrorMask&&(this.mirror=new p.BaseMirror(this))}_refreshStaleModel(){if(this._uiObservers||!this.stale){if(!this.getCollection)throw new Error("base_model:_refreshStaleModel getCollection does not exist");this.getCollection().find(this.id).catch(d.WebdDrop,(()=>{}))}}incObservers(e){if(this._uiObservers++,e)return;n(81602).default.online&&this.stale&&(f.Cmd.uiBusy?this.listenToOnce(f.Cmd,"ui_idle",this._refreshStaleModel):this._refreshStaleModel())}decObservers(){this._uiObservers>0&&this._uiObservers--,0===this._uiObservers&&this.stopListening(f.Cmd,"ui_idle",this._refreshStaleModel)}hasObservers(){return this._uiObservers>0}addChild(e,t){const n={};n[e]=t,this.set(n,{silent:!0}),this.listenTo(t,"all",this._getCachedEventBubblingHandler(e))}get(e){return this[e]}set(e,t,n){var r;let i=n;return"string"==typeof e?this._set(e,t,i):(i=t,(null===(r=i)||void 0===r?void 0:r.merge)?this._set((0,l.default)(e,s.default),i):this._set(e,i))}_markChange(e,t){this.__initialized&&(this._getChanges().push({key:e,oldValue:t}),this.__fired&&(this.__fired[e]=!1))}_set(e,t,n){const r=!!this.__changes,[i,a]=(0,c.isString)(e)?[{[e]:t},n]:[e,t];let o=Object.keys(i).reduce(((e,t)=>{const n=this._setKV(t,i[t],a);return n&&e.push(...n),e}),[]),s=0;for(;o&&o.length>0;){if(s++>5)throw new Error("Circular derived properties / event listeners");const e=this._topo;if(!e)throw new Error("_topo unexpectedly undefined");const t=y(e,o);o=t.reduce(((e,n,r)=>{const i=this._setD(n,t.slice(r+1));return i&&e.push(...i),e}),[])}if(!(null==a?void 0:a.silent)&&this.hasUnfiredChanges()){const e=this.__fired={},t=this._getChanges(),n=t.length>0;for(;t.length;){const{key:n,oldValue:r}=t.shift();if(!e[n]){e[n]=!0;const t=this._definition[n].evt;if(this.isListening(t)||this.isListening("all")){const e=this[n];this.trigger(t,this,e,r)}}}(n&&this.isListening("change")||this.isListening("all"))&&this.trigger("change",this)}return r||(this.__changes&&(this.__changes=null),this.__fired&&(this.__fired=null)),this}_setKV(e,t,n){if(this._collections[e])return void this[e].set(t,n);const r=this._definition[e];if(!r)return void(this[e]=t);if(r.attr===h.Attr.DERIVED)throw new Error(`Attempting to directly set derived property: ${e}`);const i=r.sk,a=this[e];if(t===a)return;this[i]=t,this._markChange(e,a);const o=this._deps;return(null==o?void 0:o[e])?o[e]:void 0}_setD(e,t){var n;const r=this._definition[e],i=r.sk,a=r.fn.call(this),o=this[i];if(a!==o&&(this[i]=a,this._markChange(e,o),null===(n=this._deps)||void 0===n?void 0:n[e])){const n=function(e,t){const n=new Set(t);return e.filter((e=>!n.has(e)))}(this._deps[e],t);if(n.length)return n}}hasUnfiredChanges(){const e=this.__fired,t=this.__changes;if(!t)return!1;if(!e)return!0;for(let n=0;n<t.length;n++)if(!e[t[n].key])return!0;return!1}_getChanges(){return this.__changes||(this.__changes=[])}_initDeriveds(){this.__derived.forEach((e=>{this[this._definition[e].sk]=h.INIT}))}_initCollections(){(0,o.default)(this._collections,((e,t)=>{this[t]=new e(null,{parent:this})}))}unset(e,t){const n=Array.isArray(e)?e:[e];this.set((0,a.default)(n),t)}clear(){this.unset([...this.__props,...this.__session])}delete(){this.stopListening()}reset(){this.set(this.__defaults)}toJSON(){return this.serialize()}serialize(){const e={};for(let t=0;t<this.__props.length;t++)e[this.__props[t]]=this[this.__props[t]];return(0,o.default)(this._collections,((t,n)=>{e[n]=this[n].serialize()})),e}getDefault(e){const t=this._definition[e];if(!t)return;const n=t.defaultValue;return(0,c.isFunction)(n)?n():n}_getCachedEventBubblingHandler(e){return function(t,n,r){g.test(t)?this.trigger("change:"+e+"."+t.split(":")[1],n,r):"change"===t&&this.trigger("change",this)}.bind(this)}static isIdType(e){return!(!this.allowedIds||!this.allowedIds.includes(e))||(this.idClass?e instanceof this.idClass:"string"==typeof e)}}function y(e,t){const n=new Set(t);return e.filter((e=>n.has(e)))}t.BaseModel=m},14648:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.CACHE_POLICY=t.BaseCachePolicy=void 0;var i=r(n(76521));const a={LOAD:"LOAD",NONE:"NONE"};t.CACHE_POLICY=a;class o extends i.default{constructor(e,t){super(),this._collection=e,this._id=t}enableCaching(){}disableCaching(){}get collection(){return this._collection}get id(){return this._id}}t.BaseCachePolicy=o,o.policy=a.NONE},73923:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.createCachePolicy=function(e,t){switch(t.policy){case"LOAD":return new i.default(e,t);case"NONE":return new a.default(e,t)}return new a.default(e,{id:"none",policy:"NONE"})};var i=r(n(1088)),a=r(n(58433))},1088:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(23279)),a=n(14648);class o extends a.BaseCachePolicy{constructor(e,t){super(e,t.id),this._trigger=t.trigger||"all",this._delay=t.delay,this._saveToCache=(0,i.default)(this.saveToCache,this._delay)}saveToCache(){this.collection.saveToCache()}enableCaching(){this.listenTo(this.collection,this._trigger,this._saveToCache)}disableCaching(){this.stopListening(this.collection,this._trigger,this._saveToCache)}}t.default=o,o.policy=a.CACHE_POLICY.LOAD},58433:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(14648);class i extends r.BaseCachePolicy{constructor(e,t){super(e,t.id)}}t.default=i,i.policy=r.CACHE_POLICY.NONE},31727:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(81109)),a=n(48206),o=r(n(76521));class s extends o.default{constructor(){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),e.parent&&(this.parent=e.parent);const{model:t,comparator:n}=this.constructor;if(!t)throw new Error("Collection initialized without model. It is likely that you have a circular dependency. Run `yarn lint:circular` to find it and use inline `require` instead of `import` to avoid it.");this.modelClass=t,n&&(this._comparator=n),this._reset()}add(e,t){let n;return n=Array.isArray(e)?e.slice():e?[e]:[],this.set(n,(0,i.default)({merge:!1,add:!0,remove:!1},t))}set(e,t){if(!e)return __LOG__(3)`collection:set called with no models`,[];const n=(0,i.default)({add:!0,remove:!0,merge:!0},t);let r,a,o,s;const l=this._comparator&&!1!==n.sort,c=[],d=[],u={},{add:p,merge:f,remove:h}=n,_=null!=n.at?n.at:void 0,g=!(l||!p||!h)&&[];for(let t=0,i=e.length;t<i;t++){if(s=e[t],this.isModel(s)&&(a=s),r=s.id,!r){__LOG__(3)`collection:set model has no id`;continue}if(o=this.get(r),o){const r=o;h&&(u[o.id.toString()]=!0),f&&(s=a&&s===a?a.attributes:s,r.set(s,n)),e[t]=r}else if(p){if(a=e[t]=this._prepareModel(s,n),!a)continue;{const e=a;c.push(e),this._addReference(e)}}if(a=o||a,!a)continue;const i=a;!g||a.id&&u[a.id.toString()]||g.push(i),u[i.id.toString()]=!0}if(h){for(let e=0,t=this.length;e<t;e++){a=this._models[e];const t=a;u[a.id.toString()]||d.push(t)}d.length&&this.remove(d,(0,i.default)({},n))}let m;if(c.length||(null==g?void 0:g.length))if(l&&(m=!0),"number"==typeof _)this._models.splice(_,0,...c);else{const e=g||c;for(let t=0,n=e.length;t<n;t++)this._models.push(e[t])}if(m&&this.sort({silent:!0}),!n.silent){for(let e=0,t=c.length;e<t;e++)a=c[e],a.trigger?a.trigger("add",a,this,n):this.trigger("add",a,this,n);(m||g.length)&&this.trigger("sort",this,n)}return e}remove(e){let t,n,r,i,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const o=Array.isArray(e)?e.slice():[e],s=[];for(let e=0,l=o.length;e<l;e++)if(i=o[e],i&&(r=i instanceof this.modelClass?i.id:i,t=s[e]=this.get(r),t)){const e=t;this._deIndex(t),n=this._models.indexOf(t),this._models.splice(n,1),a.silent||(a.index=n,e.trigger?e.trigger("remove",t,this,a):this.trigger("remove",t,this,a)),this._removeReference(e)}return s}reset(){for(let e=0,t=this._models.length;e<t;e++)this._removeReference(this._models[e]);this._reset(),this.trigger("reset",this)}sort(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this._comparator)throw new Error("Cannot sort without comparator");return this._models.sort(this._comparator.bind(this)),e.silent||this.trigger("sort",this,e),this}replaceId(e,t){const n=this.get(e);n&&(this._removeFromIndex(e),n.set({id:t}),this._addIndex(n))}reorderMutate(e,t){(0,a.arrayMoveMutate)(this._models,e,t)}get(e){return this._index[e]}assertGet(e){const t=this._index[e];return t||(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("Collection:assertGet no result")),t}at(e){return this._models[e]}get length(){return this._models.length}get isCollection(){return!0}get models(){return this._models}serialize(){return this.map((e=>e.toJSON()))}toJSON(){return this.serialize()}isModel(e){return e instanceof this.modelClass}includes(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return 0===t?e instanceof this.modelClass&&null!=this.get(e.id):this._models.includes(e,t)}indexOf(e,t){return this._models.indexOf(e,t)}lastIndexOf(e,t){return this._models.lastIndexOf(e,t)}every(e){return this._models.every(e)}some(e){return this._models.some(e)}forEach(e){this._models.forEach(e)}map(e){return this._models.map(e)}filter(e){return this._models.filter(e)}findFirst(e){return this._models.find(e)}reduce(e,t){return this._models.reduce(e,t)}slice(e,t){return this._models.slice(e,t)}where(e){return this.filter((t=>{for(const n in e)if(e[n]!==t.get(n))return!1;return!0}))}head(){return this._models[0]}last(){return this._models[this._models.length-1]}toArray(){return this._models.slice()}getModelsArray(){return this._models}reorder(e,t){return(0,a.arrayMove)(this._models,e,t)}_reset(){this._models=[],this._index={}}_prepareModel(e,t){if(this.isModel(e))return e.collection||(e.collection=this),e;const n=(0,i.default)((0,i.default)({},t),{},{collection:this});try{return new this.modelClass(e,n)}catch(e){return void __LOG__(3)`collection:_prepareModel exception: ${e.stack}`}}_addReference(e){this._addIndex(e),e.collection||(e.collection=this),e.on&&e.on("all",this._onModelEvent,this)}_removeReference(e){this===e.collection&&delete e.collection,this._deIndex(e),e.off&&e.off("all",this._onModelEvent,this)}_addIndex(e){this._index[e.id]=e}_deIndex(e){delete this._index[e.id]}_removeFromIndex(e){this.get(e)&&delete this._index[e]}_onModelEvent(e,t,n,r){const i=e.indexOf(":"),a=-1===i?e:e.slice(0,i);("add"!==a&&"remove"!==a||n===this)&&("destroy"===a&&this.remove(t,r),this.trigger.apply(this,arguments))}}t.default=s},67820:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.NO_DEFAULT_VALUE=t.INIT=t.Attr=void 0,t.collection=function(e){return{val:e,type:m}},t.convert=function(e){const t=new e({},{_internalInitializationDoNotUse:!0}),n={name:e.name||"Unknown",props:{},session:{},derived:{},collections:{},isIdType:e.isIdType};e.Collection&&(n.Collection=e.Collection);e.idClass&&(n.idClass=e.idClass);e.allowedIds&&(n.allowedIds=e.allowedIds);const r=new Set(["constructor"]),i=new Set(["collection","parent","__changes","__fired","__initialized"]);(function(e){const t=[];for(const n in e)"function"!=typeof e[n]&&t.push([n,e[n]]);return t})(t).forEach((t=>{let[a,s]=t;if(!i.has(a)&&null!=s)switch(s.type){case h:n.props[a]=y(s);break;case _:n.session[a]=y(s);break;case g:n.derived[a]=(0,o.default)(s,"type"),r.add(s.fn.name);break;case m:n.collections[a]=s.val;break;default:throw new Error(`Invalid defineModel Class type for ${e.name}:${a}.`)}}));const a=function(e){const t={},n=Object.getPrototypeOf({});let r=e;Object.getOwnPropertyNames(r).forEach((e=>{"function"==typeof r[e]&&(t[e]=r[e])}));for(;(r=Object.getPrototypeOf(r))&&r!==n;)Object.getOwnPropertyNames(r).forEach((e=>{e in t||(t[e]=r[e])}));return t}(t);return r.forEach((e=>{delete a[e]})),Object.assign(n,a),n},t.derived=function(e,t){return{fn:e,deps:t,type:g}},t.prop=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f;const t={defaultValue:e,type:h};return t},t.session=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f;const t={defaultValue:e,type:_};return t},t.stateExtend=function(e,t){const n=(0,l.default)(t.name,"protoDef.name");delete t.name;const r=function(e,t){return{[t]:class extends e{}}[t]}(e,n),s=r.prototype,c=s.__props=[],f=s.__session=[],h=s.__derived=[],_=s._collections={},g=s._definition={},m=s._derived={};(0,a.default)(t.props,(function(e,t){c.push(t),S(s,t,e,p.PROP)})),(0,a.default)(t.session,(function(e,t){f.push(t),S(s,t,e,p.SESSION)})),(0,a.default)(t.derived,(function(e,t){h.push(t),function(e,t,n){const r=E(t),i=n.fn;e._definition[t]=e._derived[t]={sk:r,evt:"change:"+t,attr:p.DERIVED,fn:i,deps:n.deps},Object.defineProperty(e,t,{get(){const e=this[r];if(e!==u)return e;const t=i.call(this);return this[r]=t,t},set(){throw new TypeError(`'${t}' is a derived property, it can't be set directly.`)}})}(s,t,e)})),(0,a.default)(t.collections,(function(e,t){_[t]=e})),Object.assign(s,(0,o.default)(t,["props","session","derived","collections"]));const y=c.concat(f),v=y.length;Object.defineProperties(s,{attributes:{get(){const e={};for(let t=0;t<v;++t)e[y[t]]=this[y[t]];return e}},isState:{get:()=>!0,set(){throw new Error("attempt to set isState")}}});const T={};for(let e=0;e<v;e++){const t=y[e];"defaultValue"in g[t]&&(T[t]=u)}(0,i.default)(T)||(s.__defaults=T);if(h.length){const e=[],t={},n={};(0,a.default)(m,((r,i)=>{n[i]=!0,(0,a.default)(r.deps,(r=>{n[r]=!0,(t[r]||(t[r]=[])).push(i),e.push([i,r])}))})),e.length&&(s._deps=t,s._topo=d.default.array(Object.keys(n),e).reverse())}return r};var i=r(n(41609)),a=r(n(2525)),o=r(n(57557)),s=r(n(13218)),l=r(n(45095)),c=n(51737),d=r(n(94633));const u={sentinel:"DEFAULT VALUE PLACEHOLDER"};t.INIT=u;const p={PROP:"PROP",SESSION:"SESSION",DERIVED:"DERIVED"};t.Attr=p;const f=Symbol("NO_DEFAULT_VALUE");t.NO_DEFAULT_VALUE=f;const h="Props",_="Session",g="Derived",m="Collection";function y(e){const t=e.defaultValue;return t===f?{}:{defaultValue:t}}function E(e){return"__x_"+e}function S(e,t,n,r){if(!(0,s.default)(n))throw new Error("Invalid Prop/Session definition.");const i={sk:E(t),evt:`change:${t}`,attr:r};void 0!==n.defaultValue&&(i.defaultValue=n.defaultValue),e._definition[t]=i;const a=(0,c.isFunction)(i.defaultValue);if(null!=i.defaultValue&&!a){if(Array.isArray(i.defaultValue))throw new Error("Do not return mutable types as default values as they are shared. Type: Array provided.");if((0,s.default)(i.defaultValue))throw new Error("Do not return mutable types as default values as they are shared. Type: WAUnsafeObjectType provided.")}const o=i.sk;Object.defineProperty(e,t,{set(e){this.set(t,e)},get(){const e=this[o];return e!==u?e:a?this[o]=i.defaultValue():i.defaultValue}})}},80134:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ProxyStates=t.ProxyStateFactory=t.DuplicatedProxyProperty=void 0;var i=r(n(6479)),a=n(40265);const o=["props","session","collections","derived"];class s extends((0,a.customError)("DuplicatedProxyProperty")){}t.DuplicatedProxyProperty=s;const l={};t.ProxyStates=l;t.ProxyStateFactory=(e,t,n)=>{const{props:r,session:a,collections:c,derived:d}=t,u=(0,i.default)(t,o),p=function(e){this.$ProxyState$state=e},f={};if([r,a,c,d].forEach((t=>{t&&Object.keys(t).forEach((t=>{f[t]={get(){return __LOG__(4,void 0,new Error,!0)`Cannot read proxy property "${e}.${t}" created in <${this.$ProxyState$ComponentName}/>. Make sure it is in your list of concerns.`,SEND_LOGS("Invalid ProxyState Access"),this.$ProxyState$state[t]},set(n){__LOG__(4,void 0,new Error,!0)`Cannot write proxy property "${e}.${t}" created in <${this.$ProxyState$ComponentName}/>. Make sure it is in your list of concerns.`,SEND_LOGS("Invalid ProxyState Write"),this.$ProxyState$state[t]=n}}}))})),f.proxyName={value:e},f.mirrorMask={value:n},f.isProxyOf={value(e){return this.$ProxyState$state===e}},["set","get",...Object.keys(u)].forEach((e=>{f[e]={value(){const t=this.$ProxyState$state;return t[e].apply(t,arguments)}}})),(p.prototype=Object.create(null,f)).constructor=p,e in l)throw new s(`Duplicated proxy property "${e}".`);l[e]=p}},71306:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(50796),a=n(92574),o=n(88555),s=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=E(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(35232)),l=r(n(89867)),c=n(48360),d=n(46331),u=n(11290),p=n(69951),f=n(88102),h=n(99234),_=r(n(14296)),g=r(n(33861)),m=r(n(56891)),y=n(85893);function E(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(E=function(e){return e?n:t})(e)}class S extends u.BaseModel{constructor(){super(...arguments),this.id=(0,u.prop)(),this.duration=(0,u.prop)(),this.participants=(0,u.collection)(g.default),this.active=(0,u.session)(!1),this.keepAliveTimer=(0,u.session)(),this.stopPromise=(0,u.session)()}initialize(){super.initialize(),this.listenTo(this.participants,"remove reset",(()=>{this.hasParticipants()||this.delete()}));const e=p.ChatCollection.get(this.id);e&&!e.liveLocation&&(e.liveLocation=this)}delete(){super.delete(),this.stopViewingMap(),this.participants.delete(),this.getCollection().remove(this.id);const e=p.ChatCollection.get(this.id);e&&(e.liveLocation=void 0)}hasParticipants(){return this.participants.length>0}startViewingMap(){this.active||(this.active=!0,this._updateLiveLocations(),this._startKeepAlive())}stopViewingMap(){this.active&&(this.active=!1,this._pauseLiveLocations(),this._stopKeepAlive())}userHasLiveLocation(e){return!!this.participants.get(e)}iHaveLiveLocation(){return this.userHasLiveLocation((0,h.getMaybeMeUser)())}stopMyLiveLocation(e){if(!this.iHaveLiveLocation())return Promise.reject(new s.ActionError);if(this.stopPromise)return this.stopPromise;if((0,o.isMDBackend)())return Promise.reject(new Error("This call is only supported in non-MD mode"));const t=this.stopPromise=m.default.disableLiveLocation(this.id),n=new d.ActionType(c.fbt._("Stopping live location sharing",null,{hk:"3Zapuy"})),r=e||(0,d.genId)(),i=t.then((e=>200===e.status?new d.ActionType(c.fbt._("Stopped sharing live location",null,{hk:"1sRjWg"})):e.status>=400?new d.ActionType(c.fbt._("Couldn't stop sharing live location",null,{hk:"2ckYx4"})):void 0)).catch((()=>(__LOG__(3)`models:liveLocation:disableLiveLocation dropped`,new d.ActionType(c.fbt._("Couldn't stop sharing live location",null,{hk:"2ckYx4"}),{actionText:_.default.t(129),actionHandler:this.stopMyLiveLocation.bind(this,r)}))));return f.Cmd.openToast((0,y.jsx)(d.ActionToast,{id:r,initialAction:n,pendingAction:i})),t.then((e=>{if(200===e.status&&!e._duplicate){const e=this.participants.get((0,h.getMaybeMeUser)());e&&e.disable()}})).finally((()=>{this.stopPromise=null}))}_updateLiveLocations(){this.getCollection().update(this.id).catch((()=>{}))}_pauseLiveLocations(){m.default.unsubscribeLiveLocation(this.id).catch((0,i.filteredCatch)(a.WebdDrop,(()=>{})))}_sendKeepAlive(){m.default.subscribeLiveLocation(this.id,!1).catch((0,i.filteredCatch)(a.WebdDrop,(()=>{})))}_startKeepAlive(){if(null!=this.keepAliveTimer)return;const e=this.duration;null!=e&&0!==e&&(this.keepAliveTimer=window.setInterval(this._sendKeepAlive.bind(this),1e3*e))}_stopKeepAlive(){null!=this.keepAliveTimer&&(window.clearInterval(this.keepAliveTimer),this.keepAliveTimer=null)}getCollection(){return n(85865).LiveLocationCollection}}S.Proxy="liveLocation",S.idClass=l.default;var v=(0,u.defineModel)(S);t.default=v},85865:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.LiveLocationCollectionImpl=t.LiveLocationCollection=void 0;var i=r(n(81109)),a=r(n(48926)),o=n(50796),s=n(51737),l=n(92574),c=n(88555),d=n(40234),u=n(15461),p=r(n(89867)),f=n(1255),h=n(19380),_=r(n(71306)),g=r(n(56891));class m extends f.BaseCollection{_find(e){var t=this;return(0,a.default)((function*(){if(!p.default.isUser(e)&&!p.default.isGroup(e))return Promise.reject(new Error("invalid wid for live location: "+e));if((0,c.isMDBackend)())return Promise.reject(new Error("This call is only supported in non-MD mode"));const n=yield g.default.subscribeLiveLocation(e,!0);if(n.status&&n.status>=400)return 499===n.status?__LOG__(2)`liveLocation:subscribe query not implemented on the phone`:__LOG__(3)`model:LiveLocation:_find error ${n.status}`,Promise.reject(n.status);const r=(0,s.isNumber)(n.duration)?n.duration:void 0,a=n.participants?n.participants.map((e=>(0,i.default)((0,i.default)({},t._extractLocationFields(e)),{},{id:e.id,expiration:0===e.expiration?1/0:e.expiration}))):[];return{id:e,duration:r,participants:a}}))()}getActive(e){var t=this;return(0,a.default)((function*(){if(!p.default.isUser(e)&&!p.default.isGroup(e))return Promise.reject(new Error("invalid wid for live location: "+e));try{const n=yield g.default.queryActiveLiveLocation(e);if(n.status&&n.status>=400)return 499===n.status?__LOG__(2)`liveLocation:participant query not implemented on the phone`:__LOG__(3)`model:LiveLocation:getActive error ${n.status}`,Promise.reject(n.status);if(!n.participants||!n.participants.length)return;const r=n.participants.map((e=>({id:e.id,expiration:0===e.expiration?1/0:e.expiration})));t.add({id:e,participants:r},{merge:!0})}catch(e){return(0,o.filteredCatch)(l.WebdDrop,(()=>{}))(e)}}))()}onResume(){this.filter((e=>e.active&&e.hasParticipants())).forEach((e=>{this.update(e.id)}))}handle(e){Array.isArray(e)?e.forEach((e=>{switch(e.type){case"update":{const t=this._extractLocationFields(e),n=h.ContactCollection.get(e.jid);(null==n?void 0:n.liveLocations)&&n.liveLocations.forEach((e=>e.set(t)));break}case"disable":{const t=this.get(e.chat);if(t){const n=t.participants.get(e.jid);n&&(e.seq>n.sequence||-1===e.seq)&&n.disable()}break}default:__LOG__(3)`models:liveLocation:handle unknown type: ${e.type}`}})):__LOG__(3)`models:liveLocation:handle unrecognized payload`}processMsg(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.type===u.MSG_TYPE.LOCATION&&e.isLive||(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("collection:liveLocation trying to process non live-location msg"));const n=e.id.remote,{lat:r,lng:i,accuracy:a,speed:o,degrees:s,sequence:l,comment:c,shareDuration:p,t:f}=e;if(!f||!p)return;const h=f+p;if(h<=d.Clock.globalUnixTime())return;const _={id:e.sender,lat:r,lng:i,accuracy:a,speed:o,degrees:s,sequence:l,comment:c,expiration:h,lastUpdated:f,msg:e};-1===l&&delete _.sequence;const g=this.get(n);if(g){const e=g.participants.get(_.id);if(t)return void(e&&e.lastUpdated<=_.lastUpdated&&e.set(_));if(e&&g.participants.removeParticipant(e),g.hasParticipants())return void g.participants.add(_)}this.add({id:n,participants:[_]})}removeMsg(e){e.type===u.MSG_TYPE.LOCATION&&e.isLive||(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("collection:liveLocation trying to remove non live-location msg"));const t=e.id.remote,n=e.sender,r=this.get(t);r&&r.participants.remove(n)}_extractLocationFields(e){return void 0===e.lat||void 0===e.lng?{}:{lastUpdated:d.Clock.globalUnixTime()-e.elapsed,lat:e.lat,lng:e.lng,accuracy:e.accuracy,speed:e.speed,degrees:e.degrees,comment:e.comment}}}t.LiveLocationCollectionImpl=m,m.model=_.default,m.staleCollection=!0,m.resumeOnAvailable=!0;const y=new m;t.LiveLocationCollection=y},57465:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(51737),a=r(n(85074)),o=n(40234),s=r(n(89867)),l=n(11290),c=n(19380),d=n(99234),u=n(3879);class p extends l.BaseModel{constructor(){super(...arguments),this.id=(0,l.prop)(),this.msg=(0,l.prop)(),this.lat=(0,l.prop)(),this.lng=(0,l.prop)(),this.accuracy=(0,l.prop)(),this.speed=(0,l.prop)(),this.degrees=(0,l.prop)(),this.sequence=(0,l.prop)(),this.comment=(0,l.prop)(),this.expiration=(0,l.prop)(),this.lastUpdated=(0,l.prop)(),this.contact=(0,l.session)(),this.expireTimerId=(0,l.session)(),this.disabled=(0,l.session)(!1),this.isMe=(0,l.derived)((function(){return this.id.equals((0,d.getMaybeMeUser)())}),["id"]),this.valid=(0,l.derived)((function(){return t=this.lat,(0,i.isNumber)(t)&&t>=-90&&t<=90&&(e=this.lng,(0,i.isNumber)(e)&&e>=-180&&e<=180);var e,t}),["lat","lng"])}initialize(){super.initialize(),this.addChild("contact",c.ContactCollection.gadd(this.id)),(0,u.addLiveLocation)(this.contact,this),this.listenTo(this,"change:expiration",this._setExpireTimer),this._setExpireTimer()}delete(){super.delete(),this._disableMsg(),(0,u.removeLiveLocation)(this.contact,this),this._clearExpireTimer()}remainingTime(){return this.expiration-o.Clock.globalUnixTime()}elapsedTime(){return o.Clock.globalUnixTime()-this.lastUpdated}disable(){this.disabled=!0}_disableMsg(){const e=this.msg;e&&(e.shareDuration=o.Clock.globalUnixTime()-e.t-1)}_setExpireTimer(){this.expiration&&(this.remainingTime()<=0?this._expire():this.expireTimerId=a.default.setGlobalTimeout(this._expire.bind(this),1e3*this.expiration,this.expireTimerId))}_clearExpireTimer(){a.default.clearTimeout(this.expireTimerId),this.expireTimerId=null}_expire(){this.disable()}}p.Proxy="liveLocationParticipant",p.idClass=s.default;var f=(0,l.defineModel)(p);t.default=f},33861:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(1255),a=n(47969),o=n(99234),s=r(n(57465));class l extends i.BaseCollection{constructor(){super(),this.listenTo(this,"change:disabled",(e=>{e.disabled&&this.removeParticipant(e)}))}delete(){this.forEach((e=>this.removeParticipant(e)))}validLocations(){return this.filter((e=>e.valid))}removeParticipant(e){this.remove(e),e.delete()}}t.default=l,l.model=s.default,l.comparator=(e,t)=>{const n=(0,o.getMaybeMeUser)();return e.contact.id.equals(n)?-1:t.contact.id.equals(n)?1:(0,a.ContactComparator)(e.contact,t.contact)}},96876:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(57319),a=n(40234),o=n(11290),s=n(99234),l=n(7293),c=r(n(68132)),d=n(65044);class u extends o.BaseModel{constructor(){super(...arguments),this.id=(0,o.prop)(),this.showAwarenessMsg=(0,o.prop)(!1),this.showCountDownMsg=(0,o.prop)(!1),this.daysLeftTillDeadline=(0,o.prop)(0),this.expirationTime=(0,o.prop)(),this.deadlineExpiredLogoutTimer=(0,o.session)()}processMdOptInDeadline(){if(l.GK.supportsFeature(l.GK.F.EXTERNAL_MD_OPT_IN_AVAILABLE)&&c.default.mdOptInDeadline.timestamp>0){const e=c.default.mdOptInDeadline.timestamp,t=a.Clock.globalUnixTime(),n=a.Clock.daysDelta(t,e);if(t>e)return __LOG__(2)`MdOptInDeadline:processMdOptInDeadline logout due to MD opt-in deadline expiration`,(0,s.setMdOptedIn)(!0),(0,s.setShowMdUpgradeCompleteMsg)(!0),(0,s.setForcedMdUpgradeComplete)(!0),void d.Socket.logout();0===n?this.set({showCountDownMsg:!0,expirationTime:a.Clock.relativeStr(e).toString(),daysLeftTillDeadline:null,showAwarenessMsg:!1}):n<=7?this.set({showCountDownMsg:!0,daysLeftTillDeadline:n,expirationTime:null,showAwarenessMsg:!1}):this.set({showAwarenessMsg:!0,expirationTime:null,daysLeftTillDeadline:null,showCountDownMsg:!1}),this.deadlineExpiredLogoutTimer.cancel(),this.deadlineExpiredLogoutTimer.onOrAfter(1e3*(e-t))}}initialize(){super.initialize(),this.deadlineExpiredLogoutTimer=new i.ShiftTimer((function(){__LOG__(2)`MdOptInDeadline:deadlineExpiredLogoutTimer logout due to MD opt-in deadline expiration`,(0,s.setMdOptedIn)(!0),(0,s.setShowMdUpgradeCompleteMsg)(!0),(0,s.setForcedMdUpgradeComplete)(!0),d.Socket.logout()}))}}u.Proxy="mdOptInDeadline";var p=new((0,o.defineModel)(u));t.default=p},17304:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.MsgImpl=t.Msg=void 0,t.createProductInquiry=function(e,t,n,r){const i=function(e){return new Se(e)}({ack:m.ACK.CLOCK,id:new T.default({id:"product_inquiry",remote:t,fromMe:!0}),from:t,t:E.Clock.globalUnixTime(),type:b.MSG_TYPE.PRODUCT,title:e.name,description:e.description,businessOwnerJid:t.toString({legacy:!0}),productId:e.id.toString(),url:e.url,productImageCount:e.getProductImageCollectionCount(),body:n.preview instanceof ie.default?n.preview.getBase64():null,currencyCode:e.currency,priceAmount1000:e.priceAmount1000,salePriceAmount1000:(0,oe.isSalePriceActive)(e)?e.salePriceAmount1000:null,sessionId:r});return i.mediaData.set(n),i};var i=r(n(48926)),a=r(n(23279)),o=r(n(57557)),s=r(n(45578)),l=r(n(41609)),c=r(n(39138)),d=ye(n(93131)),u=r(n(45095)),p=n(40277),f=n(27870),h=n(88156),_=n(51737),g=n(64331),m=n(35470),y=n(88555),E=n(40234),S=r(n(64369)),v=ye(n(95726)),T=r(n(65212)),b=n(15461),C=n(15411),A=n(93778),P=r(n(89867)),M=r(n(62054)),O=n(57849),I=n(11290),w=n(63726),R=n(64481),D=n(88102),L=n(17239),N=n(19380),k=n(24606),U=n(24808),G=n(67247),x=r(n(63236)),B=r(n(45017)),F=n(63448),j=n(90915),Y=n(99234),K=n(6901),W=r(n(53988)),H=n(57701),V=(n(55981),r(n(84064))),$=r(n(14296)),z=n(35389),q=n(11902),J=n(41566),Q=ye(n(78986)),X=r(n(2320)),Z=n(58668),ee=r(n(11339)),te=n(43257),ne=ye(n(54676)),re=r(n(5165)),ie=r(n(34949)),ae=n(81093),oe=n(13151),se=n(4136),le=n(19708),ce=n(13705),de=n(64551),ue=n(8080),pe=r(n(50039)),fe=n(97563),he=n(12896),_e=n(84728),ge=r(n(35609));function me(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(me=function(e){return e?n:t})(e)}function ye(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=me(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}return r.default=e,n&&n.set(e,r),r}class Ee extends I.BaseModel{constructor(){super(...arguments),this.id=(0,I.prop)(),this.rowId=(0,I.prop)(),this.body=(0,I.prop)(),this.type=(0,I.prop)(),this.subtype=(0,I.prop)(),this.t=(0,I.prop)(),this.notifyName=(0,I.prop)(),this.from=(0,I.prop)(),this.to=(0,I.prop)(),this.author=(0,I.prop)(),this.self=(0,I.prop)("in"),this.ack=(0,I.prop)(),this.invis=(0,I.prop)(),this.isNewMsg=(0,I.prop)(),this.star=(0,I.prop)(!1),this.keptBy=(0,I.prop)(),this.recvFresh=(0,I.prop)(),this.caption=(0,I.prop)(),this.interactiveAnnotations=(0,I.prop)(),this.contextInfo=(0,I.prop)(),this.clientUrl=(0,I.prop)(),this.loc=(0,I.prop)(),this.lat=(0,I.prop)(),this.lng=(0,I.prop)(),this.isLive=(0,I.prop)(),this.accuracy=(0,I.prop)(),this.speed=(0,I.prop)(),this.degrees=(0,I.prop)(),this.comment=(0,I.prop)(),this.sequence=(0,I.prop)(),this.shareDuration=(0,I.prop)(),this.finalLat=(0,I.prop)(),this.finalLng=(0,I.prop)(),this.finalAccuracy=(0,I.prop)(),this.finalThumbnail=(0,I.prop)(),this.finalSpeed=(0,I.prop)(),this.finalDegrees=(0,I.prop)(),this.finalTimeOffset=(0,I.prop)(),this.deprecatedMms3Url=(0,I.prop)(),this.directPath=(0,I.prop)(),this.mimetype=(0,I.prop)(),this.duration=(0,I.prop)(),this.filehash=(0,I.prop)(),this.encFilehash=(0,I.prop)(),this.size=(0,I.prop)(),this.filename=(0,I.prop)(),this.streamingSidecar=(0,I.prop)(),this.mediaKey=(0,I.prop)(),this.mediaKeyTimestamp=(0,I.prop)(),this.pageCount=(0,I.prop)(),this.isGif=(0,I.prop)(),this.gifAttribution=(0,I.prop)(),this.isViewOnce=(0,I.prop)(),this.streamable=(0,I.prop)(),this.width=(0,I.prop)(),this.height=(0,I.prop)(),this.thumbnailDirectPath=(0,I.prop)(),this.thumbnailSha256=(0,I.prop)(),this.thumbnailEncSha256=(0,I.prop)(),this.thumbnailHeight=(0,I.prop)(),this.thumbnailWidth=(0,I.prop)(),this.waveform=(0,I.prop)(),this.staticUrl=(0,I.prop)(),this.stickerPackId=(0,I.prop)(),this.stickerPackName=(0,I.prop)(),this.stickerPackPublisher=(0,I.prop)(),this.scanLengths=(0,I.prop)(),this.scansSidecar=(0,I.prop)(),this.isFromTemplate=(0,I.prop)(!1),this.devicesAdded=(0,I.prop)(),this.devicesRemoved=(0,I.prop)(),this.isThisDeviceAdded=(0,I.prop)(),this.firstFrameLength=(0,I.prop)(),this.firstFrameSidecar=(0,I.prop)(),this.isAnimated=(0,I.prop)(),this.canonicalUrl=(0,I.prop)(),this.matchedText=(0,I.prop)(),this.thumbnail=(0,I.prop)(),this.thumbnailHQ=(0,I.prop)(),this.richPreviewType=(0,I.prop)(),this.doNotPlayInline=(0,I.prop)(),this.title=(0,I.prop)(),this.description=(0,I.prop)(),this.businessOwnerJid=(0,I.prop)(),this.productId=(0,I.prop)(),this.currencyCode=(0,I.prop)(),this.priceAmount1000=(0,I.prop)(),this.salePriceAmount1000=(0,I.prop)(),this.retailerId=(0,I.prop)(),this.url=(0,I.prop)(),this.productImageCount=(0,I.prop)(),this.sessionId=(0,I.prop)(),this.pollName=(0,I.prop)(),this.pollOptions=(0,I.prop)(),this.pollEncKey=(0,I.prop)(),this.pollSelectableOptionsCount=(0,I.prop)(),this.recipients=(0,I.prop)(),this.broadcast=(0,I.prop)(),this.quotedMsg=(0,I.prop)(),this.quotedStanzaID=(0,I.prop)(),this.quotedRemoteJid=(0,I.prop)(),this.quotedParticipant=(0,I.prop)(),this.quotedGroupSubject=(0,I.prop)(),this.quotedParentGroupJid=(0,I.prop)(),this.mentionedJidList=(0,I.prop)(),this.footer=(0,I.prop)(),this.hydratedButtons=(0,I.prop)(),this.buttons=(0,I.prop)(),this.selectedId=(0,I.prop)(),this.selectedIndex=(0,I.prop)(),this.multicast=(0,I.prop)(),this.urlText=(0,I.prop)(),this.urlNumber=(0,I.prop)(),this.clearMedia=(0,I.prop)(),this.isVcardOverMmsDocument=(0,I.prop)(!1),this.vcardList=(0,I.prop)(),this.vcardFormattedName=(0,I.prop)(),this.revokeSender=(0,I.prop)(),this.protocolMessageKey=(0,I.prop)(),this.futureproofBuffer=(0,I.prop)(),this.templateParams=(0,I.prop)(),this.textColor=(0,I.prop)(),this.backgroundColor=(0,I.prop)(),this.font=(0,I.prop)(),this.campaignId=(0,I.prop)(),this.campaignDuration=(0,I.prop)(),this.actionLink=(0,I.prop)(),this.statusPSAReadTimestamp=(0,I.prop)(),this.isForwarded=(0,I.prop)(!1),this.forwardingScore=(0,I.prop)(),this.labels=(0,I.prop)(),this.hasReaction=(0,I.prop)(!1),this.paymentCurrency=(0,I.prop)(),this.paymentAmount1000=(0,I.prop)(),this.paymentMessageReceiverJid=(0,I.prop)(),this.paymentTransactionTimestamp=(0,I.prop)(),this.paymentStatus=(0,I.prop)(),this.paymentTxnStatus=(0,I.prop)(),this.paymentNoteMsg=(0,I.prop)(),this.paymentRequestMessageKey=(0,I.prop)(),this.paymentExpiryTimestamp=(0,I.prop)(),this.paymentInviteServiceType=(0,I.prop)(),this.paymentBackground=(0,I.prop)(),this.ephemeralStartTimestamp=(0,I.prop)(),this.ephemeralDuration=(0,I.prop)(),this.ephemeralSettingTimestamp=(0,I.prop)(),this.ephemeralOutOfSync=(0,I.prop)(),this.ephemeralSharedSecret=(0,I.prop)(),this.disappearingModeInitiator=(0,I.prop)(),this.bizPrivacyStatus=(0,I.prop)(),this.privacyModeWhenSent=(0,I.prop)(),this.verifiedBizName=(0,I.prop)(),this.inviteCode=(0,I.prop)(),this.inviteCodeExp=(0,I.prop)(),this.inviteGrp=(0,I.prop)(),this.inviteGrpName=(0,I.prop)(),this.inviteGrpJpegThum=(0,I.prop)(),this.inviteGrpType=(0,I.prop)(),this.sellerJid=(0,I.prop)(),this.message=(0,I.prop)(),this.orderTitle=(0,I.prop)(),this.itemCount=(0,I.prop)(),this.orderId=(0,I.prop)(),this.surface=(0,I.prop)(),this.status=(0,I.prop)(),this.token=(0,I.prop)(),this.totalAmount1000=(0,I.prop)(),this.totalCurrencyCode=(0,I.prop)(),this.historySyncMetaData=(0,I.prop)(),this.mdDowngrade=(0,I.prop)(),this.isSendFailure=(0,I.prop)(),this.appStateSyncKeyShare=(0,I.prop)(),this.appStateSyncKeyRequest=(0,I.prop)(),this.appStateFatalExceptionNotification=(0,I.prop)(),this.broadcastParticipants=(0,I.prop)(),this.broadcastEphSettings=(0,I.prop)(),this.broadcastId=(0,I.prop)(),this.ctwaContext=(0,I.prop)(),this.list=(0,I.prop)(),this.listResponse=(0,I.prop)(),this.productListItemCount=(0,I.prop)(),this.productHeaderImageRejected=(0,I.prop)(!1),this.lastPlaybackProgress=(0,I.prop)(0),this.sendDeferred=(0,I.session)(),this.local=(0,I.session)(),this.search=(0,I.session)(),this.msgChunk=(0,I.session)(),this.phoneUploading=(0,I.session)(),this.startOfDay=(0,I.session)(),this.startOfDaySkew=(0,I.session)(),this._quotedMsgObj=(0,I.session)(),this.isQuotedMsgAvailable=(0,I.session)(!0),this.senderObj=(0,I.session)(),this.mediaData=(0,I.session)(),this.forwardedFromWeb=(0,I.session)(!1),this.squelch=(0,I.session)(),this.wamMessageSendPerfReporter=(0,I.session)(),this.isDynamicReplyButtonsMsg=(0,I.prop)(!1),this.dynamicReplyButtons=(0,I.prop)(),this.replyButtons=(0,I.prop)(),this.buttonsResponse=(0,I.prop)(),this.selectedButtonId=(0,I.prop)(),this.headerType=(0,I.prop)(),this.nativeFlowName=(0,I.prop)(),this.nativeFlowButtons=(0,I.prop)(),this.interactiveHeader=(0,I.prop)(),this.interactiveType=(0,I.prop)(),this.interactivePayload=(0,I.prop)(),this.reactionParentKey=(0,I.prop)(),this.reactionText=(0,I.prop)(),this.reactionTimestamp=(0,I.prop)(),this.revokeDuration=(0,I.session)(),this.isMdHistoryMsg=(0,I.prop)(!1),this._links=(0,I.session)((()=>[])),this._headerLinks=(0,I.session)((()=>[])),this._footerLinks=(0,I.session)((()=>[])),this.linksIndexParsed=(0,I.session)(0),this._phoneNumbers=(0,I.session)((()=>[])),this._headerPhoneNumbers=(0,I.session)((()=>[])),this._footerPhoneNumbers=(0,I.session)((()=>[])),this.phoneNumbersIndexParsed=(0,I.session)(0),this._waitForPhoneUploadPromise=(0,I.session)(),this.requiresDirectConnection=(0,I.prop)(null),this.pttForwardedFeaturesEnabled=(0,I.prop)(!1),this.chat=(0,I.derived)((function(){return this._getChatCollection().get(this.id.remote)})),this.hasTemplateButtons=(0,I.derived)((function(){return this.isFromTemplate&&null!=this.buttons&&this.buttons.length>0}),["buttons"]),this.ephemeralExpirationTimestamp=(0,I.derived)((function(){const{ephemeralDuration:e,ephemeralStartTimestamp:t,t:n,subtype:r,id:{fromMe:i}}=this;return(0,K.getEphemeralExpirationTimestamp)(e,t,n,r,i)}),["t","subtype","ephemeralStartTimestamp","ephemeralDuration"]),this.isEphemeral=(0,I.derived)((function(){return(this.type!==b.MSG_TYPE.PROTOCOL||"ephemeral_setting"!==this.subtype)&&(null!=this.ephemeralDuration&&0!==this.ephemeralDuration)}),["ephemeralDuration","type","subtype"]),this.isRevoke=(0,I.derived)((function(){return this.type===b.MSG_TYPE.PROTOCOL&&["sender_revoke","admin_revoke"].includes(this.subtype)}),["type","subtype"]),this.isQuickReply=(0,I.derived)((function(){if(!this.hasTemplateButtons)return!1;if(null==this.buttons)return!1;const e=this.buttons.at(0);return null!=e&&e.subtype===C.TEMPLATE_BUTTON_SUBTYPE.QUICK_REPLY}),["buttons"]),this.isFutureproof=(0,I.derived)((function(){return this.type===b.MSG_TYPE.UNKNOWN||this.type===b.MSG_TYPE.PAYMENT&&"futureproof"===this.subtype}),["type","subtype"]),this.isGroupMsg=(0,I.derived)((function(){return P.default.isGroup(this.from)||P.default.isGroup(this.to)})),this.isStickerMsg=(0,I.derived)((function(){return this.type===b.MSG_TYPE.STICKER})),this.isStatusV3=(0,I.derived)((function(){return P.default.isStatusV3(this.id.remote)})),this.isPSA=(0,I.derived)((function(){return P.default.isPSA(this.id.remote)})),this.isProductListMessage=(0,I.derived)((function(){var e;return this.type===b.MSG_TYPE.LIST&&(null===(e=this.list)||void 0===e?void 0:e.listType)===U.Message$ListMessageListType.PRODUCT_LIST})),this.isRTL=(0,I.derived)((function(){return"rtl"===this.dir||void 0===this.dir&&$.default.isRTL()}),["dir"]),this.asProductInquiry=(0,I.derived)((function(){const e=this.safe();return e.type===b.MSG_TYPE.PRODUCT&&e.id&&e.id.id.startsWith(w.PRODUCT_INQUIRY_TYPE)?e:null})),this.statusV3TextBg=(0,I.derived)((function(){if(!this.isStatusV3)return null;const e=this.backgroundColor;return e?`rgba(${e>>16&255}, ${e>>8&255}, ${255&e}, ${e>>24&255})`:null})),this.isSentByMe=(0,I.derived)((function(){return"in"!==this.id.self&&!this.isNotification&&P.default.equals(this.from,(0,Y.getMaybeMeUser)())})),this.isSentByMeFromWeb=(0,I.derived)((function(){return this.id.fromMe&&this.local&&this.isUserCreatedType}),["isUserCreatedType"]),this.isRevokedByMe=(0,I.derived)((function(){return P.default.equals(this.revokeSender,(0,Y.getMaybeMeUser)())})),this.isInternational=(0,I.derived)((function(){var e;const t=this.id.fromMe?this.to.toString({legacy:!0}):this.from.toString({legacy:!0}),n=null===(e=(0,Y.getMaybeMeUser)())||void 0===e?void 0:e.toString({legacy:!0});return t&&n?(0,p.phoneCC)(t)!==(0,p.phoneCC)(n):(__LOG__(3)`Msg: could not derive isInternational as some data is missing`,!1)})),this.isNotification=(0,I.derived)((function(){return ne.isNotification(this.type,this.subtype)}),["type","subtype"]),this.asGroupNotification=(0,I.derived)((function(){const e=this.safe();switch(e.type){case b.MSG_TYPE.GROUP_NOTIFICATION:case b.MSG_TYPE.GP2:return e;default:return null}}),["type"]),this.asBroadcastNotification=(0,I.derived)((function(){const e=this.safe();return e.type===b.MSG_TYPE.BROADCAST_NOTIFICATION?e:null}),["type"]),this.isBizNotification=(0,I.derived)((function(){if(this.type===b.MSG_TYPE.NOTIFICATION_TEMPLATE){if(w.BIZ_SYSTEM_MSG_SUBTYPES.includes(this.subtype))return!0;if(w.BIZ_SYSTEM_MSG_SUBTYPES_V2.includes(this.subtype))return!0;switch(this.subtype){case"verified_initial_unknown":case"verified_initial_low":case"verified_initial_high":case"verified_transition_any_to_none":case"verified_transition_any_to_high":case"verified_transition_high_to_low":case"verified_transition_high_to_unknown":case"verified_transition_unknown_to_low":case"verified_transition_low_to_unknown":case"verified_transition_none_to_low":case"verified_transition_none_to_unknown":case"biz_verified_transition_top_to_bottom":case"biz_verified_transition_bottom_to_top":case"biz_intro_top":case"biz_intro_bottom":case"biz_name_change":case"biz_move_to_consumer_app":case"biz_two_tier_migration_top":case"biz_two_tier_migration_bottom":return!0;default:return!1}}return!1}),["type","subtype"]),this.asProduct=(0,I.derived)((function(){const e=this.safe();return"product"===e.type?e:null}),["type"]),this.asAlbumAsset=(0,I.derived)((function(){const e=this.safe();return e.type!==b.MSG_TYPE.IMAGE&&(e.type!==b.MSG_TYPE.VIDEO||!0===e.isGif)||e.isNotification||e.caption||e.asRevoked||e.quotedMsg||e.ctwaContext||e.isViewOnce?null:e}),["type","isNotification","caption","isForwarded","asRevoked","isGif","quotedMsg","ctwaContext","isViewOnce"]),this.asAutoDownloadableMedia=(0,I.derived)((function(){const e=this.safe();switch(e.type){case b.MSG_TYPE.IMAGE:case b.MSG_TYPE.STICKER:case b.MSG_TYPE.AUDIO:case b.MSG_TYPE.PTT:case b.MSG_TYPE.VIDEO:case b.MSG_TYPE.DOCUMENT:return e}return(0,ne.typeIsUrl)(e)?e:null}),["type"]),this.asGroupedSticker=(0,I.derived)((function(){const e=this.safe();return e.type!==b.MSG_TYPE.STICKER||e.isNotification||e.asRevoked||e.quotedMsg||e.ctwaContext?null:e}),["type","isNotification","asRevoked","quotedMsg","ctwaContext"]),this.isMedia=(0,I.derived)((function(){return["image","video","audio"].includes(this.type)}),["type"]),this.asDoc=(0,I.derived)((function(){const e=this.safe();return e.type===b.MSG_TYPE.DOCUMENT?e:null}),["type"]),this.asImage=(0,I.derived)((function(){const e=this.safe();return e.type===b.MSG_TYPE.IMAGE?e:null}),["type"]),this.asVideo=(0,I.derived)((function(){const e=this.safe();return e.type===b.MSG_TYPE.VIDEO?e:null}),["type"]),this.asAudio=(0,I.derived)((function(){const e=this.safe();return e.type===b.MSG_TYPE.AUDIO?e:null}),["type"]),this.asPtt=(0,I.derived)((function(){const e=this.safe();return e.type===b.MSG_TYPE.PTT?e:null}),["type"]),this.asMms=(0,I.derived)((function(){const e=this.safe();return(0,ne.typeIsMms)(e)?e:null}),["type"]),this.asUrl=(0,I.derived)((function(){const e=this.safe();return(0,ne.typeIsUrl)(e)?e:null}),["type","subtype"]),this.asRevoked=(0,I.derived)((function(){const e=this.safe();return e.type===b.MSG_TYPE.REVOKED?e:null}),["type"]),this.asViewOnce=(0,I.derived)((function(){const e=this.asVisualMedia;return(null==e?void 0:e.isViewOnce)?e:null}),["type","isViewOnce"]),this.asVisualMedia=(0,I.derived)((function(){const e=this.safe();return e.type===b.MSG_TYPE.IMAGE||e.type===b.MSG_TYPE.VIDEO?e:null}),["type"]),this.numTimesForwarded=(0,I.derived)((function(){return this.forwardingScore?this.forwardingScore||0:this.isForwarded?1:0}),["isForwarded","forwardingScore"]),this.isFrequentlyForwarded=(0,I.derived)((function(){return this.numTimesForwarded>=S.default.FREQUENTLY_FORWARDED_SENTINEL}),["numTimesForwarded"]),this.eventType=(0,I.derived)((function(){if(!this.isNewMsg)return"i";const e=(0,ne.eventTypeFromMsgType)(this);return this.invis?"i"===e?"i":"n":e}),["type","invis","isNewMsg"]),this.sender=(0,I.derived)((function(){return this.isSentByMe?this.from:this.isGroupMsg||this.isStatusV3?this.author:this.from})),this.text=(0,I.derived)((function(){var e;if(this.isFromTemplate||this.isDynamicReplyButtonsMsg)return this.type===b.MSG_TYPE.CHAT?this.body:this.caption;switch(this.type){case b.MSG_TYPE.CHAT:return this.body;case b.MSG_TYPE.IMAGE:case b.MSG_TYPE.VIDEO:return this.caption;case b.MSG_TYPE.LOCATION:return this.isLive?this.comment:void 0;case b.MSG_TYPE.PAYMENT:const{paymentNoteMsg:t}=this;return t?t.body:void 0;case b.MSG_TYPE.GROUPS_V4_INVITE:return this.comment;case b.MSG_TYPE.LIST:return null===(e=this.list)||void 0===e?void 0:e.description;case b.MSG_TYPE.PRODUCT:return(0,c.default)(this.title,{length:R.MAX_REPLY_PRODUCT_TITLE_LENGTH});case b.MSG_TYPE.HSM:case b.MSG_TYPE.TEMPLATE_BUTTON_REPLY:return this.body;case b.MSG_TYPE.INTERACTIVE:return null!=this.nativeFlowName?(0,F.formatNFMText)(this):this.caption;case b.MSG_TYPE.NATIVE_FLOW:return(0,F.formatNFMText)(this);default:return}}),["type","body","caption","comment","isLive","paymentNoteMsg","subtype"]),this.containsEmoji=(0,I.derived)((function(){const{text:e}=this;return!!e&&G.EmojiUtil.containsEmoji(e)}),["text"]),this.isFailed=(0,I.derived)((function(){const e=this.isSentByMe&&this.ack<m.ACK.CLOCK;return(0,y.isMDBackend)()?e||!!this.mdDowngrade||!!this.isSendFailure:e}),["isSentByMe","ack","mdDowngrade","isSendFailure"]),this.vcard=(0,I.derived)((function(){if(this.type===b.MSG_TYPE.VCARD)try{return(0,A.parseVcard)(this.body)}catch(e){return}}),["type","body"]),this.isUnsentMedia=(0,I.derived)((function(){return this.ack<m.ACK.SENT&&null!=this.asMms&&this.isSentByMe}),["ack","asMms","isSentByMe"]),this.dir=(0,I.derived)((function(){return this.type===b.MSG_TYPE.VCARD?this.subtype?d.dir(this.subtype):void 0:this.text?d.dir(this.text):void 0}),["type","text","subtype"]),this.rtl=(0,I.derived)((function(){return this.type===b.MSG_TYPE.VCARD?!!this.subtype&&"rtl"===d.dir(this.subtype):!!this.text&&"rtl"===d.dir(this.text)}),["type","text","subtype"]),this.linkPreview=(0,I.derived)((function(){return(0,_.isString)(this.matchedText)&&(!(0,l.default)(this.title)||!(0,l.default)(this.description))&&this.body.includes(this.matchedText)}),["matchedText","body","title","description"]),this.isGroupsV4InviteExpired=(0,I.derived)((function(){if(this.type!==b.MSG_TYPE.GROUPS_V4_INVITE)return!1;if(!this.inviteCode)return!0;const e=(new Date).getTime()/1e3;return parseInt(e,10)>=parseInt(this.inviteCodeExp,10)}),["type","inviteCode","inviteCodeExp"]),this.isUnreadType=(0,I.derived)((function(){return(0,he.isUnreadTypeMsg)(this)}),["type"]),this.isUserCreatedType=(0,I.derived)((function(){return[b.MSG_TYPE.PROTOCOL,b.MSG_TYPE.CHAT,b.MSG_TYPE.LOCATION,b.MSG_TYPE.VCARD,b.MSG_TYPE.MULTI_VCARD,b.MSG_TYPE.IMAGE,b.MSG_TYPE.VIDEO,b.MSG_TYPE.AUDIO,b.MSG_TYPE.PTT,b.MSG_TYPE.DOCUMENT,b.MSG_TYPE.STICKER,b.MSG_TYPE.PRODUCT,b.MSG_TYPE.GROUPS_V4_INVITE,b.MSG_TYPE.ORDER].includes(this.type)}),["type"]),this.supportsMessageFooter=(0,I.derived)((function(){return this.isFromTemplate||this.isDynamicReplyButtonsMsg}),["isDynamicReplyButtonsMsg","isFromTemplate"]),this.supportsMessageFooterLinks=(0,I.derived)((function(){return this.isDynamicReplyButtonsMsg||this.type===b.MSG_TYPE.LIST||this.type===b.MSG_TYPE.INTERACTIVE}),["type","isDynamicReplyButtonsMsg"]),this.hasBodyOrFooter=(0,I.derived)((function(){return null!=this.text||null!=this.footer}),["text","footer"]),this.initialPageSize=(0,I.derived)((function(){return this.isFrequentlyForwarded?308:768}),["isFrequentlyForwarded"]),this.productListHeaderImage=(0,I.derived)((function(){var e,t,n,r;return!0===this.productHeaderImageRejected?null:null!==(e=null===(t=this.list)||void 0===t||null===(n=t.productListInfo)||void 0===n||null===(r=n.headerImage)||void 0===r?void 0:r.jpegThumbnail)&&void 0!==e?e:null}),["productHeaderImageRejected","list"]),this.isInitialE2ENotification=(0,I.derived)((function(){return this.type===b.MSG_TYPE.E2E_NOTIFICATION&&"encrypt"===this.subtype||w.BIZ_SYSTEM_MSG_SUBTYPES_V2_INIT.includes(this.subtype)}),["type","subtype"]),this.isDisappearingModeSystemMessage=(0,I.derived)((function(){return this.type===b.MSG_TYPE.NOTIFICATION_TEMPLATE&&"disappearing_mode"===this.subtype}),["type","subtype"]),this.asPttLike=(0,I.derived)((function(){const e=this.safe();return e.type===b.MSG_TYPE.PTT||e.pttForwardedFeaturesEnabled&&e.type===b.MSG_TYPE.AUDIO&&(0,te.isOpus)(e.mimetype)&&null!=e.waveform?e:null}),["type","mimetype","pttForwardedFeaturesEnabled","waveform"]),this._saveLastPlaybackProgress=(0,a.default)(((e,t)=>{(0,fe.updateLocal)(e,{lastPlaybackProgress:t})}),500)}initialize(){if(super.initialize(),this.pttForwardedFeaturesEnabled=de.ServerProps.pttForwardedFeaturesEnabled,this._pendingAckUpdate=new f.PromiseQueue,this.sender)this.addChild("senderObj",N.ContactCollection.gadd(this.sender));else switch(this.type){case b.MSG_TYPE.NOTIFICATION:case b.MSG_TYPE.NOTIFICATION_TEMPLATE:case b.MSG_TYPE.GROUP_NOTIFICATION:case b.MSG_TYPE.GP2:case b.MSG_TYPE.BROADCAST_NOTIFICATION:case b.MSG_TYPE.E2E_NOTIFICATION:case b.MSG_TYPE.CALL_LOG:case b.MSG_TYPE.PROTOCOL:break;default:__LOG__(2)`msg:msg with no sender id:${this.id.toString()}, from:${this.from.toString()}, author:${this.author&&this.author.toString()}, type:${this.type}`}let e;this.mentionedJidList=this.mentionedJidList||[],this.mentionedJidList.forEach((e=>N.ContactCollection.gadd(e)));const t=this.getCollection();(e=t.preAck[this.id])&&(__LOG__(2)`Msg:initialize updating msg with out of order ack`,this.updateAck(e.ack,e.t),delete t.preAck[this.id]),this.type===b.MSG_TYPE.CIPHERTEXT&&this.listenToOnce(this,"change:type",this.onCiphertextDecrypted),this.mediaObject=void 0,ne.typeIsMms(this)&&(this._createMediaDataChild(),this.isViewOnce&&!(0,_e.isUnviewed)(this.safe())||Q.registerMsg(this)),this.isSentByMeFromWeb&&(this.sendDeferred=new h.Resolvable,this.sendDeferred.promise.finally((()=>{this.sendDeferred=null}))),this.isLive&&n(85865).LiveLocationCollection.processMsg(this,!1),L.Conn.isSMB&&(0,z.initializeLabels)(this),this.isViewOnce&&(this.listenTo(this,"change:ack",this.onViewOnceMediaStatusChanged),this.listenTo(this.mediaData,"change:mediaStage",this.onViewOnceMediaStatusChanged))}_getLinks(e){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;if((arguments.length>2&&void 0!==arguments[2]?arguments[2]:0)>=t)return[arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],t];const n=(0,g.firstNCodepoints)(e,t);let r=v.findLinks(n,false,this.sender);if((0,g.numCodepoints)(e)>t&&r.length>0){const i=r[r.length-1];(0,g.numCodepoints)(n.slice(0,i.index))+(0,g.numCodepoints)(i.url)===t&&(r=v.findLinks(e,false,this.sender))}return[r,t]}_getPhoneNumbers(e){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;if((arguments.length>2&&void 0!==arguments[2]?arguments[2]:0)>=t)return[arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],t];const n=(0,g.firstNCodepoints)(e,t);let r=(0,B.default)(n);if((0,g.numCodepoints)(e)>t&&r.length>0){const i=r[r.length-1];(0,g.numCodepoints)(n.slice(0,i.index))+(0,g.numCodepoints)(i.phone)===t&&(r=(0,B.default)(e))}return[r,t]}getLinks(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.initialPageSize+1;const{text:t}=this;if(null==t)return this._links;const[n,r]=this._getLinks(t,this._links,this.linksIndexParsed,e);return this.linksIndexParsed=r,this._links=n}_displayHeaderLinksForListMessages(){var e,t;return"list"===this.type&&(null===(e=this.list)||void 0===e?void 0:e.listType)===U.Message$ListMessageListType.SINGLE_SELECT&&null!=(null===(t=this.list)||void 0===t?void 0:t.title)}_displayHeaderLinksForNonListMessages(){return!0===this.isDynamicReplyButtonsMsg&&null!=this.title}_getHeaderLinks(e){if(this._headerLinks.length>0)return this._headerLinks;const[t]=this._getLinks(e,this._headerLinks);return this._headerLinks=t}getHeaderLinks(){var e,t;return this._displayHeaderLinksForListMessages()?this._getHeaderLinks((null===(t=this.list)||void 0===t?void 0:t.title)||""):this._displayHeaderLinksForNonListMessages()?this._getHeaderLinks(this.title):this.type===b.MSG_TYPE.INTERACTIVE&&null!=(null===(e=this.interactiveHeader)||void 0===e?void 0:e.title)?this._getHeaderLinks(this.interactiveHeader.title):[]}getFooterLinks(){if(!this.supportsMessageFooterLinks||null==this.footer)return[];if(this._footerLinks.length>0)return this._footerLinks;const[e]=this._getLinks(this.footer,this._footerLinks);return this._footerLinks=e}getGalleryLinks(){return(0,s.default)(this.getLinks(),"href").filter((e=>e.isHttp))}getSuspiciousLinks(){return this.getLinks().filter((e=>{var t;return null===(t=e.suspiciousCharacters)||void 0===t?void 0:t.size}))}getPhoneNumbers(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.initialPageSize+1;if(!(0,H.hyperlinkedPhoneNumbersEnabled)())return[];const{text:t}=this;if(null==t)return this._phoneNumbers;const[n,r]=this._getPhoneNumbers(t,this._phoneNumbers,this.phoneNumbersIndexParsed,e);return this.phoneNumbersIndexParsed=r,this._phoneNumbers=n}_getHeaderPhoneNumbers(e){if(this._headerPhoneNumbers.length>0)return this._headerPhoneNumbers;const[t]=this._getPhoneNumbers(e,this._headerPhoneNumbers);return this._headerPhoneNumbers=t}getHeaderPhoneNumbers(){var e,t;return this._displayHeaderLinksForListMessages()?this._getHeaderPhoneNumbers((null===(t=this.list)||void 0===t?void 0:t.title)||""):this._displayHeaderLinksForNonListMessages()?this._getHeaderPhoneNumbers(this.title):this.type===b.MSG_TYPE.INTERACTIVE&&null!=(null===(e=this.interactiveHeader)||void 0===e?void 0:e.title)?this._getHeaderPhoneNumbers(this.interactiveHeader.title):[]}getFooterPhoneNumbers(){if(!this.supportsMessageFooterLinks||null==this.footer)return[];if(this._footerPhoneNumbers.length>0)return this._footerPhoneNumbers;const[e]=this._getPhoneNumbers(this.footer,this._footerPhoneNumbers);return this._footerPhoneNumbers=e}_createMediaDataChild(){this.addChild("mediaData",new X.default)}hasSymbol(){return this.type===b.MSG_TYPE.INTERACTIVE?this.interactiveType===V.default.SHOPS_STOREFRONT||this.interactiveType===V.default.NATIVE_FLOW&&this.nativeFlowName===re.default.ORDER_DETAILS:this.type===b.MSG_TYPE.NATIVE_FLOW?this.nativeFlowName===re.default.ORDER_DETAILS:["image","video","audio","ptt","location","vcard","multi_vcard","document","ciphertext","oversized","unknown","call_log","revoked","sticker","payment","groups_v4_invite","product","order"].includes(this.type)}mayFail(){return this.isSentByMe&&this.ack<m.ACK.SENT}isUnsentPhoneMsg(){return!this.local&&this.isSentByMe&&this.ack<m.ACK.SENT}replyChecks(){return!this.mayFail()&&!this.isNotification&&!this.chat.isSuspendedGroup()&&!this.chat.isTerminatedGroup()&&this.type!==b.MSG_TYPE.UNKNOWN&&this.type!==b.MSG_TYPE.CIPHERTEXT&&this.type!==b.MSG_TYPE.OVERSIZED&&this.type!==b.MSG_TYPE.REVOKED&&this.interactiveButtonsReleased()}canReply(){return!(this.type===b.MSG_TYPE.LIST&&!(0,ne.listMsgCanRender)(this))&&(this.chat.canSend&&this.replyChecks())}canPrivateReply(){return!this.mayFail()&&!this.isNotification&&this.type!==b.MSG_TYPE.UNKNOWN&&this.type!==b.MSG_TYPE.CIPHERTEXT&&this.type!==b.MSG_TYPE.OVERSIZED&&this.type!==b.MSG_TYPE.REVOKED&&!this.isSentByMe&&this.isGroupMsg&&this.interactiveButtonsReleased()}canPrivateReplyInRestrictedGrp(){return!!this.chat.isAnnounceGrpRestrict&&!this.chat.isReadOnly&&!this.mayFail()&&!this.isSentByMe&&!this.isNotification&&this.type!==b.MSG_TYPE.UNKNOWN&&this.type!==b.MSG_TYPE.CIPHERTEXT&&this.type!==b.MSG_TYPE.OVERSIZED&&this.type!==b.MSG_TYPE.REVOKED&&this.interactiveButtonsReleased()}canForward(){var e,t;if(this.type===b.MSG_TYPE.CIPHERTEXT)return!1;if(this.type===b.MSG_TYPE.OVERSIZED)return!1;if(this.type===b.MSG_TYPE.REVOKED)return!1;if(this.type===b.MSG_TYPE.UNKNOWN)return!1;if(this.type===b.MSG_TYPE.PAYMENT)return!1;if(this.type===b.MSG_TYPE.LIST)return(null===(e=this.list)||void 0===e?void 0:e.listType)===U.Message$ListMessageListType.PRODUCT_LIST&&(0,ne.listMsgCanRender)(this);if(this.type===b.MSG_TYPE.GROUPS_V4_INVITE)return!1;if(this.type===b.MSG_TYPE.LOCATION&&this.isLive)return!1;if(this.type===b.MSG_TYPE.ORDER)return!1;if(this.type===b.MSG_TYPE.INTERACTIVE&&null!=this.nativeFlowName)return!1;if(!this.interactiveButtonsReleased())return!1;if(this.ack<m.ACK.SENT&&this.isSentByMe)return!1;if(this.asMms){const e=this.mediaData;if(e.mediaStage===Z.MEDIA_DATA_STAGE.EXISTS)return!0;if(e.mediaStage===Z.MEDIA_DATA_STAGE.ERROR_MISSING)return!1;if(e.mediaStage===Z.MEDIA_DATA_STAGE.ERROR_UNSUPPORTED)return!1;if(e.mediaStage!==Z.MEDIA_DATA_STAGE.RESOLVED&&(this.type===b.MSG_TYPE.IMAGE||this.type===b.MSG_TYPE.VIDEO||this.type===b.MSG_TYPE.PTT))return!1;if(this.isViewOnce)return!1;if(this.isUnsentMedia)return!1}return!(null===(t=this.nativeFlowButtons)||void 0===t?void 0:t.length)}canQuickForward(){return!(!this.canForward()||this.isFrequentlyForwarded||0!==this.getSuspiciousLinks().length||null!=this.asPttLike||this.type===b.MSG_TYPE.STICKER||!this.interactiveButtonsReleased())&&(null!=this.asMms||this.linkPreview||this.type===b.MSG_TYPE.VCARD||this.type===b.MSG_TYPE.LOCATION||null!=this.ctwaContext)}canStar(){return!(this.type===b.MSG_TYPE.LIST&&!(0,ne.listMsgCanRender)(this))&&(!this.isEphemeral&&!this.isNotification&&!this.isFutureproof&&!this.isViewOnce&&this.type!==b.MSG_TYPE.REVOKED&&!(this.ack<m.ACK.SENT&&this.isSentByMe)&&this.interactiveButtonsReleased())}interactiveButtonsReleased(){return this.isFromTemplate||!this.hasTemplateButtons&&this.type!==b.MSG_TYPE.TEMPLATE_BUTTON_REPLY}isGroupLeave(){return"gp2"===this.type&&("leave"===this.subtype||"remove"===this.subtype)&&P.default.equals(this.recipients[0],(0,Y.getMaybeMeUser)())}isTrusted(){var e;return!!P.default.equals(this.sender,(0,Y.getMaybeMeUser)())||(!!(null===(e=this.senderObj)||void 0===e?void 0:e.isMyContact)||(this.isGroupMsg?this.chat.isTrusted():this.chat.notSpam))}getVcardWids(){return this.type!==b.MSG_TYPE.VCARD?null:(0,A.vcardWids)(this.vcard)}getLocObject(){const e=this.loc;if(e){const[t,n=null]=e.split("\n");return{name:t,addr:n}}return null}resumeRemoteUpload(){return this.isUnsentPhoneMsg()&&!this.phoneUploading&&((0,le.sendMsgRecord)(this).then((e=>{e!==ce.SendMsgResult.OK&&(this.phoneUploading=!1)})),this.phoneUploading=!0),this.forceDownloadMediaEvenIfExpensive()}forceRMR(){return Promise.reject(new Error("unimplemented forceRMR"))}isForcingRMR(){return!1}cancelDownload(){Q.cancelDownloadMsg(this)}resumeUpload(){return this.mediaData.mediaStage!==Z.MEDIA_DATA_STAGE.NEED_UPLOAD&&(__LOG__(4,void 0,new Error,!0)`resumeUpload called while state was ${this.mediaData.mediaStage}`,SEND_LOGS("resume-non-need-upload")),Q.resumeUploadMsg(this)}cancelUpload(){Q.cancelUploadMsg(this)}waitForPhoneUpload(){var e=this;return(0,i.default)((function*(){Boolean(e.mediaData.filehash)&&!e.isUnsentPhoneMsg()||(e._waitForPhoneUploadPromise||(e._waitForPhoneUploadPromise=(0,ge.default)(e.mediaData,"change:mediaStage change:filehash",(()=>Boolean(e.mediaData.filehash)&&!e.isUnsentPhoneMsg()))),yield e._waitForPhoneUploadPromise,e._waitForPhoneUploadPromise=null)}))()}forceDownloadMediaEvenIfExpensive(){return this.downloadMedia({downloadEvenIfExpensive:!0,rmrReason:ee.default.WEBC_RMR_REASON_CODE.MSG_CLICK,isUserInitiated:!0})}downloadMedia(e){if(this.asRevoked)return Promise.resolve();const{downloadEvenIfExpensive:t,rmrReason:n,isUserInitiated:r,isAutoDownload:i}=e;if(!r&&!this.isTrusted())return Promise.resolve();if(this.asMms||(__LOG__(4,void 0,new Error,!0)`id: ${this.id.toString()} type: ${this.type}`,SEND_LOGS("media-fault: downloadMedia msg is not mms type")),this.isUnsentPhoneMsg()){let t=this._waitForPhoneUploadPromise;return t||(t=this._waitForPhoneUploadPromise=(0,ge.default)(this.mediaData,"change:mediaStage change:filehash",(()=>!!this.mediaData.filehash&&!this.isUnsentPhoneMsg())).then((()=>{this._waitForPhoneUploadPromise=null}))),t.then((()=>this.downloadMedia(e)))}return Q.downloadMsg({msg:this,isUserClick:n===ee.default.WEBC_RMR_REASON_CODE.MSG_CLICK,downloadEvenIfExpensive:t,rmrReason:n,rmrData:this._getRmrData(n),mode:r?"manual":"auto",isAutoDownload:i})}_getRmrData(e){const t={webcRmrReason:e,webcMessageT:this.t},n=this.chat;if(n){t.webcChatType=n.getWebcChatType(),null!=n.initialIndex&&(t.webcChatPosition=n.initialIndex);const{msgChunk:e}=this;e&&e===n.msgs&&(t.webcMessageIndex=e.length-e.indexOf(this)-1)}return t}applyUpdate(e){if(e.type&&this.type!==e.type&&ne.typeIsMms(e))return this.type!==b.MSG_TYPE.CIPHERTEXT&&(__LOG__(4,void 0,new Error,!0)`updated ${this.id.toString()} from ${this.type} to ${String(e.type)}`,SEND_LOGS("invalid-type-update")),this._createMediaDataChild(),Q.registerMsgEarly(this,e),Q.prepareMsg(this).then((()=>{this.set(e)})).catch((e=>{__LOG__(4,void 0,new Error,!0)`error = ${String(e)}`,SEND_LOGS("preregister-error")}));if(this.set(e),this.isLive&&n(85865).LiveLocationCollection.processMsg(this,!0),this.paymentTransactionTimestamp){this.getCollection().updateLastTransactionTime(this.id.remote,this.paymentTransactionTimestamp)}return Promise.resolve()}waitForPrep(){var e=this;return(0,i.default)((function*(){var t;const n=null==e.requiresDirectConnection?(0,j.genDirectConnectionMessageModifiers)(e.type,null===(t=e.list)||void 0===t?void 0:t.listType,e.businessOwnerJid).then((t=>e.set(t))):Promise.resolve(),r=ne.typeIsMms(e)?Q.prepareMsg(e):Promise.resolve();return yield n,r}))()}delete(e){super.delete();n(19011).AllStarredMsgsCollection.remove(this),this.isLive&&n(85865).LiveLocationCollection.removeMsg(this);this.getCollection().remove(this.id),this.msgChunk&&this.msgChunk.remove(this.id,{},Boolean(null==e?void 0:e.skipUpdatingSortTime)),ne.typeIsMms(this)&&Q.deregisterMsg(this),n(16770).LabelCollection.removeAllLabelsMD(this);const t=this._getChatCollection().get(this.id.remote);if(t){t.unreadMsgAnchor===this&&(t.unreadMsgAnchor=void 0);if((!e||!e.doNotResetLastReceived)&&t.lastReceivedKey===this.id){let e;const n=t.getLastReceivedMsg();n&&(e=n.id),(0,q.setLastReceivedKey)(t.id,e).then((()=>{t.lastReceivedKey=e}))}t.composeQuotedMsg===this&&(t.composeQuotedMsg=null)}}isLastMessage(){const e=this.chat.msgs.last();return this.id.equals(null==e?void 0:e.id)}quotedMsgObj(){if(!this.quotedMsg&&!this.paymentRequestMessageKey)return null;if(this._quotedMsgObj){const e=this.getCollection();return ne.getOriginalQuotedMsgIfPossible(this._quotedMsgObj,e)}if(this.quotedMsg)this._quotedMsgObj=this._getQuotedMsgObj();else{if(!this.paymentRequestMessageKey)return null;this._quotedMsgObj=this._getQuotedPaymentRequestMsg()}const e=this.getCollection();return ne.getOriginalQuotedMsgIfPossible(this._quotedMsgObj,e)}_getQuotedMsgObj(){const e=(0,Y.getMaybeMeUser)(),t=!this.quotedParticipant||P.default.equals(this.quotedParticipant,e),n=t?"out":"in",r=this.quotedRemoteJid?this.quotedRemoteJid:this.id.remote,i={id:this.quotedStanzaID,from:t?e:r,to:t?r:e,self:n,author:(0,u.default)(this.quotedParticipant,"this.quotedParticipant"),remote:r};return!(P.default.isGroup(i.from)||P.default.isGroup(i.to))&&!P.default.isStatusV3(r)||P.default.equals(e,this.quotedParticipant)&&!(0,y.isMDBackend)()||(i.participant=(0,u.default)(this.quotedParticipant,"this.quotedParticipant")),Object.assign(i,this.quotedMsg),ne.createQuotedMsg(i)}_getQuotedPaymentRequestMsg(){if(!this.paymentRequestMessageKey)return null;const e=this.paymentRequestMessageKey.remote?this.paymentRequestMessageKey.remote:this.id.remote,t=this.paymentRequestMessageKey.fromMe,n=null!=this.paymentRequestMessageKey.self?this.paymentRequestMessageKey.self:t?"out":"in",r=this.paymentRequestMessageKey.participant||this.paymentMessageReceiverJid,i={id:this.paymentRequestMessageKey.id,from:t?(0,Y.getMaybeMeUser)():e,to:t?e:(0,Y.getMaybeMeUser)(),self:n,participant:r,author:r,remote:e,amount1000:this.paymentAmount1000,currency:this.paymentCurrency,receiverJid:this.sender,type:this.type,subtype:"request"};return ne.createQuotedMsg(i)}getQuotedMsgAdminGroupJid(){return null==this.quotedMsg?this.quotedRemoteJid:null}getQuotedMsgAdminGroupSubject(){return null==this.quotedMsg?this.quotedGroupSubject:null}getQuotedMsgAdminParentGroupJid(){return null==this.quotedMsg?this.quotedParentGroupJid:null}msgContextInfo(e){const t=(0,o.default)(this.toJSON(),["id","t","notifyName","from","to","author","self","ack","invis","isNewMsg","star","recvFresh","recipients","broadcast","quotedMsg","quotedStanzaID","quotedRemoteJid","quotedParticipant","senderObj","multicast","replyButtons","buttons"]);let n=null;return e&&!this.id.remote.equals(e)&&(n=this.id.remote),{quotedMsg:t,quotedParticipant:this.sender,quotedStanzaID:this.id.id,quotedRemoteJid:n}}displayName(e,t){if(!this.sender)return"";if(this.sender.equals((0,Y.getMaybeMeUser)()))return $.default.t(1013);const n=this.senderObj,r=e?n.shortName:void 0;if(r)return r;if(n.name)return n.name;const i=t&&this.notifyName?" ~"+this.notifyName:"";return(0,M.default)(this.sender)+i}isQuoted(e){const t=this.quotedMsgObj();return!!t&&t.sender.equals(e)}isMentioned(e){return!!this.mentionedJidList&&this.mentionedJidList.findIndex((t=>t.equals(e)))>-1}mentionMap(){if(!this.mentionedJidList)return null;if(!this.mentionedJidList.length)return null;const e={};return this.mentionedJidList.forEach((t=>{e[`@${P.default.user(t)||""}`]=N.ContactCollection.gadd(t)})),e}updateAck(e,t){const n=this.ack;(0,y.isMDBackend)()&&!this.isStatusV3&&this.chat.isGroup&&this.isMdHistoryMsg&&e>=m.ACK.RECEIVED&&this.id.fromMe||((0,_.isNumber)(e)&&(void 0===n||e>n||e===m.ACK.FAILED)?(this.ack=e,e>=1&&null!=t&&null==this.ephemeralStartTimestamp&&this.updateEphemeralStartTimestamp(t),"ephemeral_setting"===this.subtype&&1===e&&null!=t&&(0,pe.default)(this.chat,t),this._pendingAckUpdate.enqueue((()=>(0,fe.updateLocal)(this.id,{ack:e})))):e===m.ACK.FAILED&&this.ack===m.ACK.CLOCK&&(this.ack=m.ACK.FAILED,this.phoneUploading=!1,this._pendingAckUpdate.enqueue((()=>(0,fe.updateLocal)(this.id,{ack:e})))))}updateLastPlaybackProgress(e){this.lastPlaybackProgress=e,this._saveLastPlaybackProgress(this.id,e)}avParams(){return Q.mediaMetadata(this)}resend(){var e=this;if(this.isFailed){const t={ack:m.ACK.CLOCK};return(0,y.isMDBackend)()&&(t.isSendFailure=!1,t.mdDowngrade=!1),this._pendingAckUpdate.enqueue((0,i.default)((function*(){yield(0,fe.updateLocal)(e.id,t),e.set(t)}))),this.asMms?this.isSentByMeFromWeb?this.resumeUpload():this.resumeRemoteUpload():(0,le.sendMsgRecord)(this)}return Promise.resolve()}onCiphertextDecrypted(){if(this.isStatusV3)return;const e=this.chat,t=e.msgs.length,n=e.msgs.indexOf(this);-1!==n&&t-n<=10&&D.Cmd.alertNewMsg(this)}onViewOnceMediaStatusChanged(){if(!this.isViewOnce)return;if(null==this.mediaData)return;const e=this.isSentByMe&&this.ack>=m.ACK.SENT&&this.mediaData.mediaStage===Z.MEDIA_DATA_STAGE.RESOLVED,t=!this.isSentByMe&&this.ack>=m.ACK.PLAYED;(e||t)&&(this.stopListening(this,"change:ack",this.onViewOnceMediaStatusChanged),this.stopListening(this.mediaData,"change:mediaStage",this.onViewOnceMediaStatusChanged),Q.deregisterMsg(this))}_canRevoke(){var e;return!(this.chat.isGroup&&!(null===(e=this.chat.groupMetadata)||void 0===e?void 0:e.participants.iAmMember()))&&(this.isUserCreatedType&&(!P.default.isBroadcast(this.id.remote)||"iphone"===L.Conn.platform)&&!this.broadcast&&!this.isUnsentPhoneMsg()&&!this.isUnsentMedia&&!this.chat.isSuspendedGroup()&&!this.chat.isTerminatedGroup())}canSenderRevoke(){const e=(0,J.isSenderRevokeWindowSenderEnabled)()?se.REVOKE_WINDOW_V2:se.REVOKE_WINDOW,t=Math.trunc(+new Date/1e3)-this.t<=e;return this._canRevoke()&&this.id.fromMe&&t}canAdminRevoke(){var e;const t=Math.trunc(+new Date/1e3)-this.t<=se.REVOKE_WINDOW_V2;return(0,H.adminRevokeSenderEnabled)()&&this._canRevoke()&&!this.id.fromMe&&Boolean(null===(e=this.chat.groupMetadata)||void 0===e?void 0:e.participants.iAmAdmin())&&t}getWamDisappearingModeInitiator(){const e=this.disappearingModeInitiator;if(null==e)return null;switch(e){case k.DisappearingModeInitiator.InitiatedByMe:return ee.default.DISAPPEARING_CHAT_INITIATOR_TYPE.INITIATED_BY_ME;case k.DisappearingModeInitiator.InitiatedByOther:return ee.default.DISAPPEARING_CHAT_INITIATOR_TYPE.INITIATED_BY_OTHER;case k.DisappearingModeInitiator.ChangedInChat:return ee.default.DISAPPEARING_CHAT_INITIATOR_TYPE.CHAT}}getWamMessageType(){return this.isStatusV3?ee.default.MESSAGE_TYPE.STATUS:this.isGroupMsg?ee.default.MESSAGE_TYPE.GROUP:P.default.isBroadcast(this.id.remote)?ee.default.MESSAGE_TYPE.BROADCAST:ee.default.MESSAGE_TYPE.INDIVIDUAL}getWamMediaType(){var e,t;if(!0===this.isDynamicReplyButtonsMsg)return ee.default.MEDIA_TYPE.BUTTON_MESSAGE;switch(this.type){case b.MSG_TYPE.IMAGE:return ee.default.MEDIA_TYPE.PHOTO;case b.MSG_TYPE.VIDEO:return this.mediaData.isGif?ee.default.MEDIA_TYPE.GIF:ee.default.MEDIA_TYPE.VIDEO;case b.MSG_TYPE.AUDIO:return ee.default.MEDIA_TYPE.AUDIO;case b.MSG_TYPE.PTT:return ee.default.MEDIA_TYPE.PTT;case b.MSG_TYPE.DOCUMENT:return ee.default.MEDIA_TYPE.DOCUMENT;case b.MSG_TYPE.UNKNOWN:return ee.default.MEDIA_TYPE.FUTURE;case b.MSG_TYPE.LOCATION:return this.isLive?ee.default.MEDIA_TYPE.LIVE_LOCATION:ee.default.MEDIA_TYPE.LOCATION;case b.MSG_TYPE.VCARD:return ee.default.MEDIA_TYPE.CONTACT;case b.MSG_TYPE.MULTI_VCARD:return ee.default.MEDIA_TYPE.CONTACT_ARRAY;case b.MSG_TYPE.CHAT:return this.linkPreview?(0,ae.matchCatalogUrl)(this.matchedText)?ee.default.MEDIA_TYPE.CATALOG_LINK:(0,ae.matchProductUrl)(this.matchedText)?ee.default.MEDIA_TYPE.PRODUCT_LINK:ee.default.MEDIA_TYPE.URL:ee.default.MEDIA_TYPE.NONE;case b.MSG_TYPE.STICKER:return ee.default.MEDIA_TYPE.STICKER;case b.MSG_TYPE.PRODUCT:return ee.default.MEDIA_TYPE.PRODUCT_IMAGE;case b.MSG_TYPE.LIST:switch(null!==(e=null===(t=this.list)||void 0===t?void 0:t.listType)&&void 0!==e?e:U.Message$ListMessageListType.UNKNOWN){case U.Message$ListMessageListType.SINGLE_SELECT:return ee.default.MEDIA_TYPE.LIST;case U.Message$ListMessageListType.PRODUCT_LIST:return ee.default.MEDIA_TYPE.PRODUCT_LIST;default:return ee.default.MEDIA_TYPE.NONE}case b.MSG_TYPE.LIST_RESPONSE:return ee.default.MEDIA_TYPE.LIST_REPLY;case b.MSG_TYPE.BUTTONS_RESPONSE:return ee.default.MEDIA_TYPE.BUTTON_RESPONSE_MESSAGE;case b.MSG_TYPE.ORDER:return ee.default.MEDIA_TYPE.ORDER;case b.MSG_TYPE.INTERACTIVE:return(0,W.default)(this.interactiveType);case b.MSG_TYPE.REACTION:return ee.default.MEDIA_TYPE.REACTION;default:return ee.default.MEDIA_TYPE.NONE}}getForwardingScoreWhenForwarded(){const e=this.numTimesForwarded+(this.id.fromMe?0:1);return e>=de.ServerProps.frequentlyForwardedThreshold?S.default.FREQUENTLY_FORWARDED_SENTINEL:e}updateEphemeralStartTimestamp(e){var t=this;return(0,i.default)((function*(){yield(0,fe.updateLocal)(t.id,{ephemeralStartTimestamp:e}),t.ephemeralStartTimestamp=e}))()}isExpired(){return null!=this.ephemeralExpirationTimestamp&&this.ephemeralExpirationTimestamp<=E.Clock.globalUnixTime()}timeUntilExpiration(){const e=this.ephemeralExpirationTimestamp;return null==e?null:this.isExpired()?0:e-E.Clock.globalUnixTime()}_logStorageEstimate(e){return(0,i.default)((function*(){const t=yield(0,x.default)();t&&(e.webcBrowserStorageQuotaBytes=t.quota,e.webcBrowserStorageQuotaUsedBytes=t.usage)}))()}getCollection(){return n(59871).MsgCollection}_getChatCollection(){return n(69951).ChatCollection}isDownloadable(){var e;return!this.asRevoked&&(!this.isViewOnce&&(this.type===b.MSG_TYPE.VCARD||this.type===b.MSG_TYPE.MULTI_VCARD||!!(null===(e=this.mediaData)||void 0===e?void 0:e.isDownloadable())&&this.type!==b.MSG_TYPE.STICKER))}safe(){return this}unsafe(){return this}canKeepOrUnkeep(){return!(!(0,y.isMDBackend)()||!(0,O.getABPropConfigValue)("keep_in_chat_sender"))&&(this.isEphemeral&&this.id.fromMe&&ue.Stream.displayInfo!==ue.StreamInfo.OFFLINE)}}t.MsgImpl=Ee,Ee.Proxy="msg",Ee.idClass=T.default;const Se=(0,I.defineModel)(Ee);t.Msg=Se},52846:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(65212)),a=n(11290);class o extends a.BaseModel{constructor(){super(...arguments),this.id=(0,a.prop)(),this.unsyncedButtonReplies=(0,a.prop)()}}o.Proxy="msgButtonReplyMsg",o.idClass=i.default;var s=(0,a.defineModel)(o);t.default=s},81037:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(1255),a=r(n(52846));class o extends i.BaseCollection{}t.default=o,o.model=a.default},59871:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.MsgCollectionImpl=t.MsgCollection=t.MEDIA_QUERY_LIMIT=void 0;var i=r(n(81109)),a=r(n(48926)),o=n(50796),s=r(n(45095)),l=n(67602),c=n(51737),d=n(92574),u=n(88555),p=n(13042),f=r(n(65212)),h=n(15461),_=r(n(89867)),g=n(45454),m=n(29984),y=n(1255),E=n(24808),S=n(76581),v=n(80872),T=n(99234),b=n(17304),C=r(n(81037)),A=n(17780),P=n(64551),M=(n(30152),n(62583)),O=r(n(86500)),I=r(n(35609)),w=r(n(56891)),R=n(65044);t.MEDIA_QUERY_LIMIT=50;class D extends y.BaseCollection{constructor(){super(),this.lastReceivedReceipt={},this.lastReceivedPaymentTransaction={},this.preAck={},this.pendingAdd={},this.ftsCache={},this.productListMessagesPrefetchChain=Promise.resolve([]),this.onSearchTag=e=>{this.pendingSearchTag=e},this.listenTo(P.ServerProps,"change:pttForwardedFeaturesEnabled",(()=>{this.forEach((e=>{"ptt"!==e.type&&"audio"!==e.type||(e.pttForwardedFeaturesEnabled=P.ServerProps.pttForwardedFeaturesEnabled)}))})),this.listenTo(R.Socket,"change:stream",(function(){R.Socket.stream===M.SOCKET_STREAM.DISCONNECTED&&(this.preAck={})})),this.listenTo(this,"remove",this.removeFromCollection)}removeFromCollection(e){e.chat&&e.chat.removeFromCollection(e)}_findQuery(e,t){var r=this;return(0,a.default)((function*(){const i=r;let a;switch(e.direction){case"before":case"after":a=e.direction;break;default:a="before"}const o={add:a,isHistory:!0},s=yield(0,S.msgFindQuery)(a,e,t,void 0);return s.status>=400?(__LOG__(3)`model:Msg:findQuery error ${s.status}`,Promise.reject(s.status)):(s.forEach((function(e){e.invis=!0})),__LOG__(2)`model:Msg:findQuery:got:${s.length}:${e.direction}`,i.processMultipleMessages(e.remote,s,o,(function(){const t=i.get(e),r=n(69951).ChatCollection.get(e.remote);return t?t.msgChunk:r?r.msgs:void 0})))}))()}add(e,t){const n=(Array.isArray(e)?e:[e]).filter((e=>{if(null==e.ephemeralDuration||0===e.ephemeralDuration)return!0;return!new b.Msg(e).isExpired()})),r=super.add(n,t);return this._syncTemplateButtonClickState(r),this._syncQuickReplyButtonClickState(r),this._prefetchProductListMessages(r),r}_prefetchProductListMessages(e){const t=n(18952).ProductMessageListCollection;this.productListMessagesPrefetchChain=e.filter((e=>{var t,n;return null!=e&&e.isNewMsg&&e.type===h.MSG_TYPE.LIST&&(null===(t=e.list)||void 0===t?void 0:t.listType)===E.Message$ListMessageListType.PRODUCT_LIST&&null!=(null===(n=e.list)||void 0===n?void 0:n.productListInfo)})).reduce(((e,n)=>{var r,i;if(null==n)return e;const a=n.requiresDirectConnection,o=n.isForwarded?n.businessOwnerJid:n.from.toString({legacy:!0}),s=null===(r=n.list)||void 0===r?void 0:r.productListInfo;if(null==o||null==s)return e;const l=t.getOrAdd(n.id,s,a,o,null===(i=n.list)||void 0===i?void 0:i.title);return null==l||0!==l.productCollection.getModelsArray().length||l.isFetching()?e:e.then((()=>t.update(l.id)))}),this.productListMessagesPrefetchChain)}_syncTemplateButtonClickState(e){for(let t=0;t<e.length;t++){const n=e[t];if(!n)continue;const r=n.chat;if(n.type===h.MSG_TYPE.TEMPLATE_BUTTON_REPLY&&null!=n.selectedIndex&&n.sender.equals((0,T.getMaybeMeUser)())){null==r.msgUnsyncedButtonReplyMsgs&&(r.msgUnsyncedButtonReplyMsgs=new C.default);const{msgUnsyncedButtonReplyMsgs:e}=r,t=n.quotedMsgObj();if(!t)continue;let i=e.get(t.id);i||(e.add({id:t.id,unsyncedButtonReplies:new O.default}),i=e.get(t.id));const{unsyncedButtonReplies:a}=(0,s.default)(i,"buttonReplyMsg");a.add(n);const o=this.get(t.id);if(null==o?void 0:o.buttons){const e=o.buttons.get(`${(0,s.default)(n.selectedIndex,"msg.selectedIndex")}`);e&&(e.selected=!0),a.remove(n)}}else if(n.isFromTemplate&&n.buttons){const{msgUnsyncedButtonReplyMsgs:e}=r;if(null==e)continue;const t=e.get(n.id);t&&(t.unsyncedButtonReplies.forEach((e=>{const t=(0,s.default)(n.buttons,"msg.buttons").get(`${(0,s.default)(e.selectedIndex,"replyMsg.selectedIndex")}`);t&&(t.selected=!0)})),t.unsyncedButtonReplies.delete())}}}_syncQuickReplyButtonClickState(e){for(let t=0;t<e.length;t++){const n=e[t];if(n)if(n.type===h.MSG_TYPE.BUTTONS_RESPONSE&&null!=n.selectedButtonId&&n.sender.equals((0,T.getMaybeMeUser)())){const e=n.quotedMsgObj();if(!e)continue;const t=this.get(e.id);if(null==t?void 0:t.replyButtons){const e=t.replyButtons.get(n.selectedButtonId);e&&(e.selected=!0)}}else if(n.isDynamicReplyButtonsMsg&&n.replyButtons&&n.replyButtons.every((e=>!e.selected))&&n.chat){const e=Math.max(0,n.chat.msgs.models.length-1e3);n.chat.msgs.getModelsArray().slice(e).filter((e=>{var t;return e.type===h.MSG_TYPE.BUTTONS_RESPONSE&&null!=e.selectedButtonId&&e.sender.equals((0,T.getMaybeMeUser)())&&(null===(t=e.quotedMsgObj())||void 0===t?void 0:t.id.toString())===n.id.toString()})).map((e=>{let{selectedButtonId:t}=e;return t})).forEach((e=>{var t;const r=null===(t=n.replyButtons)||void 0===t?void 0:t.get(e);null!=r&&(r.selected=!0)}))}}}getStarred(e,t,n,r){var i=this;return(0,a.default)((function*(){const a={count:"number"!=typeof t||isNaN(t)?p.PAGE_SIZE:t,chat:e||void 0,remote:null==n?void 0:n.remote,id:null==n?void 0:n.id,fromMe:null==n?void 0:n.fromMe,participant:null==n?void 0:n.participant,media:r?"gif":void 0},o=yield(0,S.msgFindQuery)("star",a),s=o.status;return o.status>=400?(499===s?__LOG__(2)`model:Msg:getStarred error 499 (unimplemented)`:__LOG__(3)`model:Msg:getStarred error ${s}`,Promise.reject(s)):i.processMultipleMessages(void 0,o,{add:"search"})}))()}getMessagesById(e){var t=this;return(0,a.default)((function*(){const n=yield(0,S.msgFindByIds)(e);return(0,l.promiseProps)({messages:t.processMultipleMessages(void 0,n,{add:"search"}),eof:!0,canceled:!1})}))()}queryVcard(e){var t=this;return(0,a.default)((function*(){const n=yield(0,S.queryVcard)(e);return 499===n.status?(__LOG__(2)`model:Msg:queryVcard error 499 (unimplemented)`,Promise.reject(new d.E499)):t.processMultipleMessages(void 0,n,{add:"search"})}))()}incrementalStarredUpdate(e){return this.processMultipleMessages(void 0,e,{add:"search"})}search(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};const a=`${e}__${i.label||i.kind||""}`;if(1===t&&!r){const o=this.ftsCache[a];if(o)return o;const s=this._search(e,t,n,r,i.label,i.kind);this.ftsCache[a]=s;const l=()=>{this.ftsCache[a]=null};return setTimeout(l,v.FTS_TTL),s.catch(l),s}return this._search(e,t,n,r,i.label,i.kind)}_search(e,t,n,r,i,o){var s=this;return(0,a.default)((function*(){const a={searchTerm:e,page:(0,c.isNumber)(t)&&0!==t?t:1,count:(0,c.isNumber)(n)&&0!==n?n:p.PAGE_SIZE,remote:r,tagToCancel:r?s.pendingSearchTag:void 0,label:i,kind:o},u=yield(0,S.msgFindQuery)("search",a,void 0,s.onSearchTag);if(a.tagToCancel===s.pendingSearchTag&&(s.pendingSearchTag=void 0),499===u.status)return(0,l.promiseProps)({messages:Promise.resolve([]),eof:!1,canceled:!0});if(404===u.status)return Promise.reject(new d.E404);if(u.status>=400)return __LOG__(3)`model:Msg:search error ${u.status}`,Promise.reject(new d.ServerStatusCodeError(u.status,"failed to find a msg during fts"));const f=Array.isArray(u)?u:u.messages,h=!!Array.isArray(u)||u.eof;return(0,l.promiseProps)({messages:s.processMultipleMessages(void 0,f,{add:"search"}),eof:h,canceled:!1})}))()}queryMedia(e,t,n,r,i){var o=this;return(0,a.default)((function*(){const a={remote:e,count:(0,c.isNumber)(t)&&0!==t?t:p.PAGE_SIZE,id:null==r?void 0:r.id,fromMe:null==r?void 0:r.fromMe,participant:null==r?void 0:r.participant,direction:n||"before",media:i},s=yield(0,S.msgFindQuery)("media",a);return s.status>=400?(__LOG__(3)`model:Msg:media error ${s.status}`,404===s.status?Promise.reject(new d.E404):Promise.reject(new d.ServerStatusCodeError(s.status,"failed to find a msg during media query"))):i?o.processMultipleMessages(void 0,s,{add:"search"}):(0,l.promiseProps)({docCount:s.docCount,linkCount:s.linkCount,mediaCount:s.mediaCount,messages:o.processMultipleMessages(void 0,s.messages,{add:"search"})})}))()}getContext(e,t,n){const r=this.get(e);if(r)return Promise.all([(0,S.msgFindQuery)("before",e,n),(0,S.msgFindQuery)("after",e,n)]).then((n=>{let[i,a]=n;if(!Array.isArray(i)||!Array.isArray(a))throw __LOG__(3)`model:msg:getContext fetch error`,i.status||a.status;return r.search=!1,Promise.all([this.processMultipleMessages(e.remote,i,{add:"before",isHistory:!0},t),this.processMultipleMessages(e.remote,a,{add:"after",isHistory:!0},t)])}));const i={add:"after",isHistory:!0};return(0,S.msgFindQuery)("after",e,n).then((n=>{if(!Array.isArray(n))throw __LOG__(3)`model:msg:getContext:after fetch error`,n.status;if(_.default.isStatusV3(n[0].id.remote))throw new Error("statusV3, stop querying before the msg");return this.processMultipleMessages(e.remote,n,i,t)})).then((t=>{const r=(0,s.default)(t[0],"after[0]"),i=r.id.clone();i.count=e.count+1;const a={add:"before",isHistory:!0};return Promise.all([(0,S.msgFindQuery)("before",i,n).then((t=>{if(!Array.isArray(t))throw __LOG__(3)`model:msg:getContext:before fetch error`,t.status;if(!t[t.length-1].id.equals(e))throw __LOG__(3)`model:msg:getContext:before ctx message mismatch`,405;return this.processMultipleMessages(e.remote,t,a,(function(){return r.msgChunk}))})),Promise.resolve(t)])}))}hasSynced(){return(0,I.default)(this,p.COLLECTION_HAS_SYNCED)}delete(){super.delete(),this.lastReceivedReceipt={},this.lastReceivedPaymentTransaction={},this.preAck={}}getKeysForResyncReceipts(){const e=[],t=(0,i.default)((0,i.default)({},this.lastReceivedReceipt),this.lastReceivedPaymentTransaction);for(const r in t){const t=(0,g.createWid)(r),i=n(69951).ChatCollection.get(t);let a;if(i&&(a=i.getFirstMsgWithStatus()),a){const n=a.id;n.t=this.lastReceivedReceipt[t]||a.t||0,n.payT=this.lastReceivedPaymentTransaction[t],e.push(n)}else __LOG__(3)`Msg:resyncReceipts wid in lastReceivedReceipt, but no msg: ${t.toString()}`}return e}resyncReceipts(){__LOG__(2)`Msg:resyncReceipts`;const e=this.getKeysForResyncReceipts();return 0===e.length?Promise.resolve():(0,u.isMDBackend)()?Promise.reject(new Error("This call is only supported in non-MD mode")):w.default.resyncReceipts(e).then((e=>{Array.isArray(e)?(__LOG__(2)`Msg:resyncReceipts success`,e.forEach((e=>{this.updateLastReceipt(e.id,e.t),this.updateLastTransactionTime(e.id,e.payT),e.acks.forEach((t=>{const{id:n,fromMe:r,participant:i,status:a,t:o}=t;if(null!=n&&null!=r&&null!=a){const t=new f.default({fromMe:r,remote:e.id,id:n,participant:i}),s=this.get(t);s&&(s.isEphemeral&&o?s.updateEphemeralStartTimestamp(o):s.updateAck(a))}else __LOG__(3)`Msg:resyncReceipts invalid response: ${JSON.stringify(t)}`})),e.msgs.length>0&&this.processMultipleMessages(e.id,e.msgs,{update:!0,isHistory:!1}).catch((0,o.filteredCatch)(d.LogoutDrop,(()=>{})))}))):__LOG__(3)`Msg:resyncReceipts error`})).catch((0,o.filteredCatch)([d.LogoutDrop,d.EphemeralDrop,d.BrowserReplacedDrop],(()=>{}))).catch((e=>{throw __LOG__(3)`Msg:resyncReceipts dropped ${String(e)} ${e?e.stack:"no stack"}`,new Error("Msg:resyncReceipts dropped")}))}updateLastReceipt(e,t){const n=this.lastReceivedReceipt[e];(0,m.isNonZeroNumber)(t)&&(!n||t>n)&&(this.lastReceivedReceipt[e]=t)}updateLastTransactionTime(e,t){const n=this.lastReceivedPaymentTransaction[e];t&&(!n||t>n)&&(this.lastReceivedPaymentTransaction[e]=t)}processMultipleMessages(e,t,n,r){let i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const a=()=>(0,A._processMultipleMessages)(e,t,n,r);if(e){let t;const n=this.pendingAdd[e];return t=n&&i?n.then(a):a(),t.finally((()=>{e&&this.pendingAdd[e]===t&&(this.pendingAdd[e]=null)})).catch((()=>{})),this.pendingAdd[e]=t}return a()}markAllAsStale(){this.forEach((e=>e.unset("recvFresh")))}}t.MsgCollectionImpl=D,D.model=b.Msg;const L=new D;t.MsgCollection=L},54311:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ParticipantCollection=t.MsgInfoParticipant=t.MsgInfo=void 0;var i=r(n(65212)),a=r(n(89867)),o=n(11290),s=r(n(31727)),l=n(19380),c=n(47969);class d extends o.BaseModel{constructor(){super(...arguments),this.id=(0,o.prop)(),this.t=(0,o.prop)(),this.contact=(0,o.session)()}initialize(){super.initialize(),this.addChild("contact",l.ContactCollection.gadd(this.id))}}d.Proxy="msgInfoParticipant",d.idClass=a.default;const u=(0,o.defineModel)(d);t.MsgInfoParticipant=u;class p extends s.default{}t.ParticipantCollection=p,p.model=u,p.comparator=(e,t)=>(0,c.ContactComparator)(e.contact,t.contact);class f extends o.BaseModel{constructor(){super(...arguments),this.id=(0,o.prop)(),this.usePlayReceipt=(0,o.prop)(),this.playedRemaining=(0,o.prop)(0),this.readRemaining=(0,o.prop)(0),this.deliveryRemaining=(0,o.prop)(0),this.deliveryPrivacyMode=(0,o.prop)(),this.played=(0,o.collection)(p),this.read=(0,o.collection)(p),this.delivery=(0,o.collection)(p),this.settled=(0,o.derived)((function(){return this.usePlayReceipt?!this.playedRemaining:!this.readRemaining}),["usePlayReceipt","playedRemaining","readRemaining"])}getCollection(){return n(17972).MsgInfoCollection}}f.Proxy="msgInfo",f.idClass=i.default;const h=(0,o.defineModel)(f);t.MsgInfo=h},17972:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.MsgInfoCollectionImpl=t.MsgInfoCollection=void 0;var i=r(n(65212)),a=n(1255),o=n(54311),s=n(28259),l=n(52821),c=n(62583),d=n(65044);class u extends a.BaseCollection{_initializeStaleCollection(){this.listenTo(d.Socket,"change:stream",(()=>{d.Socket.stream===c.SOCKET_STREAM.DISCONNECTED&&this.forEach((e=>{e.settled||e.set("stale",!0)}))}))}_find(e){const t=n(59871).MsgCollection.get(e);return t?t.isSentByMe?(0,s.sendQueryMsgInfo)(t):Promise.reject(new a.CollectionSilentQueryError("message not sent by me")):Promise.reject(new a.CollectionSilentQueryError(`No message found for id: ${e}`))}updateInfo(e,t,n,r,a,o){const s=new i.default({from:t,to:n,id:e,participant:a}),c=new i.default({from:t,to:n,id:e}),d=this.get(s)||this.get(c);if(d)return(0,l.updateMsgInfo)(d,r,a,o)}}t.MsgInfoCollectionImpl=u,u.model=o.MsgInfo,u.staleCollection=!0;const p=new u;t.MsgInfoCollection=p},54676:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addRecordsToChat=C,t.broadcastFanout=function(e){let t;if(!e.invis){const r=b(e);r&&(t=r.map((e=>e.remote)),r.forEach((t=>{const r=n(59871).MsgCollection;if(!r.some((0,o.default)({id:t}))){const i=O(e);i.to=t.remote,i.id=t,i.broadcast=!0;const a=r.add(i,{merge:!0});(0,n(50101).findChat)(t.remote).then((function(e){a.forEach((t=>{if(t.type!==u.MSG_TYPE.PROTOCOL){e.isEphemeralSettingOn()&&(t.ephemeralDuration=e.getEphemeralSetting());const n=e.getEphemeralSettingTimestamp();null!=n&&(t.ephemeralSettingTimestamp=n);const r=e.getDisappearingModeInitiator();null!=r&&(t.disappearingModeInitiator=r)}})),C(a,e,!0)}))}})))}return t},t.createQuotedMsg=function(e){if(!e)return null;const t=new d.default({from:e.from,to:e.to,id:e.id,participant:e.participant,selfDir:e.self});e.id=t;return new(0,n(17304).Msg)(e).safe()},t.eventTypeFromMsgType=function(e){const t=e.type,r=e.subtype,i=(0,h.getMaybeMeUser)();let a;if(t===u.MSG_TYPE.GP2||t===u.MSG_TYPE.GROUP_NOTIFICATION)if("subject"===r)a="n";else if("add"===r||"invite"===r)a=e.recipients&&p.default.equals(e.recipients[0],i)?"s":"i";else if(!(0,_.cadminSelfDemoteEnabled)()||"promote"!==r&&"demote"!==r)a="remove"===r?e.recipients&&p.default.equals(e.recipients[0],i)?"n":"i":"create"===r?"n":"i";else{const t=n(63928).default.get(e.id.remote),r=(null==t?void 0:t.groupType)===g.GroupType.DEFAULT_ANNOUNCEMENT_GROUP;a=r&&e.recipients&&p.default.equals(e.recipients[0],i)?"s":"i"}else a=t===u.MSG_TYPE.BROADCAST_NOTIFICATION||t===u.MSG_TYPE.NOTIFICATION||t===u.MSG_TYPE.E2E_NOTIFICATION?"create"===r?"n":"i":t===u.MSG_TYPE.GROUPS_V4_INVITE&&e.from.equals(i)?"i":t===u.MSG_TYPE.CALL_LOG?"n":e.broadcast?p.default.isBroadcast(e.id.remote)?"n":"i":t===u.MSG_TYPE.REVOKED?"i":p.default.isPSA(e.id.remote)?e.ack===l.ACK.RECEIVED?"d":"a":t===u.MSG_TYPE.CIPHERTEXT||t===u.MSG_TYPE.OVERSIZED?"a":t===u.MSG_TYPE.NOTIFICATION_TEMPLATE||t===u.MSG_TYPE.PROTOCOL&&"ephemeral_setting"===r||t===u.MSG_TYPE.UNKNOWN&&"reaction"===r||t===u.MSG_TYPE.REACTION||(0,_.isPollsFutureproofUpdateHidingEnabled)()&&t===u.MSG_TYPE.UNKNOWN&&r===u.MSG_TYPE.POLL_UPDATE?"i":"d";return a},t.getBroadcastFanoutKeys=b,t.getOriginalQuotedMsgIfPossible=function(e,t){var n;if(!e)return e;const r=null===(n=t.get(e.id))||void 0===n?void 0:n.safe();return r&&!r.asRevoked?r:e},t.getReferentialKey=function(e){const t=n(45454);if(e.broadcastId&&t.isWidlike(e.broadcastId)){const n=e.id;return new d.default({fromMe:n.fromMe,remote:t.createWidFromWidLike(e.broadcastId),id:n.id,participant:n.remote})}return e.id},t.hasMentionOfMe=v,t.isImportantMessage=function(e){return v(e)||T(e)},t.isNotification=function(e,t){switch(e){case u.MSG_TYPE.GROUP_NOTIFICATION:case u.MSG_TYPE.GP2:case u.MSG_TYPE.BROADCAST_NOTIFICATION:case u.MSG_TYPE.NOTIFICATION:case u.MSG_TYPE.NOTIFICATION_TEMPLATE:case u.MSG_TYPE.E2E_NOTIFICATION:case u.MSG_TYPE.CALL_LOG:return!0;case u.MSG_TYPE.PROTOCOL:return"ephemeral_setting"===t;default:return!1}},t.listMsgCanRender=function(e){var t;return(null===(t=e.list)||void 0===t?void 0:t.listType)!==f.Message$ListMessageListType.PRODUCT_LIST||(0,_.productListMessagesEnabled)()&&!S.ServerProps.webProductListMessageRenderKillSwitch},t.msgMatchesType=function(e,t){switch(t){case"text":return e.type===u.MSG_TYPE.CHAT&&"url"!==e.subtype;case"image":return e.type===u.MSG_TYPE.IMAGE;case"video":return e.type===u.MSG_TYPE.VIDEO&&!e.isGif;case"gif":return e.type===u.MSG_TYPE.VIDEO&&e.isGif;case"audio":return e.type===u.MSG_TYPE.AUDIO;case"ptt":return e.type===u.MSG_TYPE.PTT;case"document":return e.type===u.MSG_TYPE.DOCUMENT;case"location":return e.type===u.MSG_TYPE.LOCATION;case"vcard":return e.type===u.MSG_TYPE.VCARD||e.type===u.MSG_TYPE.MULTI_VCARD;case"url":return e.type===u.MSG_TYPE.CHAT&&"url"===e.subtype;case"sticker":return e.type===u.MSG_TYPE.STICKER;case void 0:default:return!1}},t.repliedToMyMessage=T,t.typeIsMms=function(e){var t;switch(e.type){case"image":case"video":case"audio":case"ptt":case"sticker":case"document":case"product":return!0;case"protocol":return"history_sync_notification"===e.subtype;case u.MSG_TYPE.NATIVE_FLOW:return e.headerType===f.Message$ButtonsMessageHeaderType.IMAGE;case u.MSG_TYPE.INTERACTIVE:return Boolean((null===(t=e.interactiveHeader)||void 0===t?void 0:t.mediaType)&&m.IM_MEDIA_HEADER_TYPES.has(e.interactiveHeader.mediaType));default:return!1}},t.typeIsUrl=function(e){return e.type===u.MSG_TYPE.CHAT&&"url"===e.subtype},t.viewOnceMessageOpened=function(e){return e.isViewOnce&&!e.isSentByMe&&e.ack>=l.ACK.PLAYED};var i=r(n(48926)),a=r(n(30988)),o=r(n(6410)),s=r(n(35161)),l=n(35470),c=n(92574),d=r(n(65212)),u=n(15461),p=r(n(89867)),f=n(24808),h=n(99234),_=n(57701),g=n(55981),m=n(34535),y=r(n(78144)),E=n(11902),S=n(64551);function v(e){const t=(0,h.getMaybeMeUser)();return!!(null==e?void 0:e.mentionedJidList)&&e.mentionedJidList.some((e=>t.user===e.user&&t.server===e.server))}function T(e){const t=(0,h.getMaybeMeUser)();return!(!t||!e)&&(!(!e.quotedMsg||!e.quotedParticipant)&&t.equals(e.quotedParticipant))}function b(e){var t;let r,i,a;if(e instanceof n(17304).Msg)i=e,a=e.id;else{if(!(e instanceof d.default))return void __LOG__(3)`model:msgs:broadcastFanout: unknown msgOrKey: ${String(e)}`;a=e}if(!p.default.isStatusV3(a.remote)){if((null===(t=i)||void 0===t?void 0:t.recipients)&&0!==i.recipients.length)r=i.recipients;else{const e=n(63928).default.get(a.remote);e?r=(0,s.default)(O(e.participants),"id"):__LOG__(2)`model:msgs:broadcastFanout no group_metadata rec for bclist, cant fanout: ${a.remote.toString()}`}return r?r.map((e=>new d.default({fromMe:a.fromMe,remote:e,id:a.id}))):void 0}}function C(e,t,r,i,a,o){const s=(0,_.isPollsFutureproofUpdateHidingEnabled)()?e.filter((e=>{return!((t=e).type===u.MSG_TYPE.UNKNOWN&&t.subtype===u.MSG_TYPE.POLL_UPDATE);var t})):e,l=i||t.msgs;if(0===s.length)return;let c=l===t.msgs;if(o)if(c)__LOG__(2)`models:msg:store:resetMostRecentMsgs .msgs === cmc !`,A(t,l,s);else{c=!0;A(t,l,s).then((()=>{const e=new(0,n(51612).ChatMsgsCollection);e.replace(t.msgs),t.msgChunks.push(e),t.replaceMsgsCollection(l),t.msgs.trigger("change:last",t.msgs.last())}))}else r?c?A(t,l,s):M(l,s):M(l,s,{at:0,silent:s.every(I)});const d=n(59871).MsgCollection;if(r&&c||!d.lastReceivedReceipt[t.id]){for(let e=s.length-1;e>=0;e--){const t=s[e],n=t.id;if(n.fromMe&&!t.isNotification){d.updateLastReceipt(n.remote,t.t);break}}}if(r&&c||!d.lastReceivedPaymentTransaction[t.id]){for(let e=s.length-1;e>=0;e--){const t=s[e],n=t.id;t.paymentTransactionTimestamp&&d.updateLastTransactionTime(n.remote,t.paymentTransactionTimestamp)}}const p=a;p&&!t.unreadMsgAnchor&&(t.disableUnreadAnchor?t.disableUnreadAnchor=!1:t.unreadMsgAnchor=s.find((function(e){return e.id.toString()===p.toString()})))}function A(){return P.apply(this,arguments)}function P(){return(P=(0,i.default)((function*(e,t,n){const r=(0,a.default)(n,(e=>!!e));if(!r)return Promise.resolve();M(t,n),yield(0,E.setLastReceivedKey)(e.id,r.id),e.lastReceivedKey=r.id}))).apply(this,arguments)}function M(e,t,n){try{e.add(t,n)}catch(e){if(!(e instanceof c.LogoutDrop))throw e;__LOG__(3)`setRecords LogoutDrop: ${e.toString()}`}}function O(e){return null!=e&&"object"==typeof e?JSON.parse(JSON.stringify(e),y.default):e}function I(e){return"i"===e.eventType}},40214:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.Mute=t.GLOBAL_REACTIONS_MUTE=t.GLOBAL_MUTE=void 0;var i=n(51737),a=r(n(85074)),o=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=_(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(35232)),s=r(n(89867)),l=r(n(30381)),c=n(46331),d=n(11290),u=n(88102),p=r(n(14296)),f=n(45197),h=n(85893);function _(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(_=function(e){return e?n:t})(e)}const g="global_mute";t.GLOBAL_MUTE=g;const m="global_reactions_mute";t.GLOBAL_REACTIONS_MUTE=m;class y extends d.BaseModel{constructor(){super(...arguments),this.id=(0,d.prop)(),this.expiration=(0,d.prop)(0),this.callExpiration=(0,d.prop)(0),this._unmuteTimer=(0,d.session)(),this._unmuteCallTimer=(0,d.session)(),this.promises=(0,d.session)((function(){return{}})),this.isMuted=(0,d.derived)((function(){return!!this.expiration}),["expiration"]),this.isCallMuted=(0,d.derived)((function(){return!!this.callExpiration}),["callExpiration"])}initialize(){super.initialize(),null!=this.expiration&&0!==this.expiration&&this.mute(this.expiration),null!=this.callExpiration&&0!==this.callExpiration&&this.muteCall(this.callExpiration)}setMute(e,t){(e||this.expiration)&&e!==this.expiration&&(e?this.mute(e,t):this.unmute(t))}mute(e,t,n){let r=e;if(!(0,i.isNumber)(r))return __LOG__(2)`models:Mute:mute called with invalid expiration ${r}`,Promise.reject(new o.ActionError);r=Math.round(r),r>2e9&&__LOG__(2)`models:Mute:mute called with wrong units?${this.id.toString()} exp:${r}`;const d=()=>{if(this.isMuted&&(a.default.clearTimeout(this._unmuteTimer),this.unset("_unmuteTimer")),-1===r)__LOG__(2)`models:Mute:mute ${this.id.toString()} muted, no expiration`;else{const e=r-(0,l.default)().unix();__LOG__(2)`models:Mute:mute ${this.id.toString()} duration:${e}`,this._unmuteTimer=a.default.setGlobalTimeout(this.unmute.bind(this),1e3*r)}this.set({expiration:r})},_=s.default.isGroup(this.id);if(t){if(this.promises.mute)return this.promises.mute;const e=this.promises.mute=(0,f.sendConversationMute)(this.id,r,this.expiration),i=_?new c.ActionType(p.default.t(66)):new c.ActionType(p.default.t(31)),a=n||(0,c.genId)(),o=this.promises.mute.catch((()=>{__LOG__(3)`models:Mute:mute dropped`;const e=_?p.default.t(64):p.default.t(29);throw new c.ActionType(e,{actionText:p.default.t(129),actionHandler:this.mute.bind(this,r,t,a)})})).then((e=>{if(200===e.status){const e=_?p.default.t(65):p.default.t(30);return new c.ActionType(e,{actionText:p.default.t(133),actionHandler:this.unmute.bind(this,t,a)})}if(e.status>=400)throw _?new c.ActionType(p.default.t(64)):new c.ActionType(p.default.t(29))}));return u.Cmd.openToast((0,h.jsx)(c.ActionToast,{id:a,initialAction:i,pendingAction:o})),e.then((function(e){200!==e.status||e._duplicate||d()})).finally((()=>{this.promises.mute=null}))}return d(),Promise.resolve()}muteCall(e){let t=e;if(!(0,i.isNumber)(t))return __LOG__(2)`models:Mute:muteCall called with invalid expiration ${t}`,Promise.reject(new o.ActionError);if(t=Math.round(t),t>2e9&&__LOG__(2)`models:Mute:muteCall called with wrong units?${this.id.toString()} exp:${t}`,this.isCallMuted&&(a.default.clearTimeout(this._unmuteCallTimer),this.unset("_unmuteCallTimer")),-1===t)__LOG__(2)`models:Mute:muteCall ${this.id.toString()} muted, no expiration`;else{const e=t-(0,l.default)().unix();__LOG__(2)`models:Mute:muteCall ${this.id.toString()} duration:${e}`,this._unmuteCallTimer=a.default.setGlobalTimeout(this.unmuteCall.bind(this),1e3*t)}return this.set({callExpiration:t}),Promise.resolve()}canMute(){let e=!1;if(s.default.isGroup(this.id)){const t=n(63928).default.get(this.id);t&&(e=t.participants.iAmMember())}return e||s.default.isUser(this.id)}_clearUnmuteTimer(){a.default.clearTimeout(this._unmuteTimer),this.unset("_unmuteTimer"),this.expiration=0}_clearUnmuteCallTimer(){a.default.clearTimeout(this._unmuteCallTimer),this.unset("_unmuteCallTimer"),this.callExpiration=0}unmute(e,t){const n=()=>{__LOG__(2)`models:Mute:unmute ${this.id.toString()}`,this._clearUnmuteTimer()},r=s.default.isGroup(this.id);if(e){if(this.promises.unmute)return this.promises.unmute;const i=this.promises.unmute=(0,f.sendConversationMute)(this.id,0,this.expiration),a=r?new c.ActionType(p.default.t(73)):new c.ActionType(p.default.t(42)),o=t||(0,c.genId)(),s=this.promises.unmute.catch((()=>{__LOG__(3)`models:Mute:unmute dropped`;const t=r?p.default.t(71):p.default.t(40);throw new c.ActionType(t,{actionText:p.default.t(129),actionHandler:this.unmute.bind(this,e,o)})})).then((e=>{if(200===e.status)return r?new c.ActionType(p.default.t(72)):new c.ActionType(p.default.t(41));if(e.status>=400)throw r?new c.ActionType(p.default.t(71)):new c.ActionType(p.default.t(40))}));return u.Cmd.openToast((0,h.jsx)(c.ActionToast,{id:o,initialAction:a,pendingAction:s})),i.then((function(e){200!==e.status||e._duplicate||n()})).finally((()=>{this.promises.unmute=null}))}return n(),Promise.resolve()}unmuteCall(){return __LOG__(2)`models:Mute:unmuteCall ${this.id.toString()}`,this._clearUnmuteCallTimer(),Promise.resolve()}delete(){super.delete(),this.getCollection().remove(this.id),this._clearUnmuteTimer()}getCollection(){return n(72472).MuteCollection}}y.Proxy="mute",y.idClass=s.default,y.allowedIds=[g,m];const E=(0,d.defineModel)(y);t.Mute=E},72472:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MuteCollectionImpl=t.MuteCollection=void 0;var r=n(14648),i=n(1255),a=n(17239),o=n(99234),s=n(57701),l=n(40214),c=n(53055);let d=!0,u=!0,p=!0,f=!0,h=!1,_=!1;class g extends i.BaseCollection{initializeFromCache(e){Array.isArray(e)?e.forEach((e=>{[l.GLOBAL_MUTE,l.GLOBAL_REACTIONS_MUTE].includes(e.id)&&this.add(e,{remove:!1})})):null!=e&&e.id===l.GLOBAL_MUTE&&this.add(e,{remove:!1}),this.setGlobalNotifications((0,o.getGlobalNotifications)()),this.setGlobalSounds((0,o.getGlobalSounds)()),this.setGlobalCallRingtone((0,o.getGlobalCallRingtone)()),this.setGlobalPreviews((0,o.getGlobalPreviews)()),this.setCollapseMuted((0,o.getCollapseMuted)()),this.setOutgoingMessageSound((0,o.getOutgoingMessageSound)())}saveToCache(){if(!a.Conn.shouldSaveToCache())return;const{id:e}=this.constructor.cachePolicy,t=[];__LOG__(2)`models:mute:cache-save: ${String(e)}`;const n=this.get(l.GLOBAL_MUTE),r=this.get(l.GLOBAL_REACTIONS_MUTE);n&&t.push(n.toJSON()),(0,s.receiveReactionsEnabled)()&&r&&t.push(r.toJSON()),t.length?(0,c.setCollection)(e,t):__LOG__(3)`models:mute:cache-save: globalMuteModel or globalReactionsMuteModel does not exist`}globalMute(){const e=this.get(l.GLOBAL_MUTE);return e||this.add({id:l.GLOBAL_MUTE})[0]}globalReactionsMute(){const e=this.get(l.GLOBAL_REACTIONS_MUTE);return e||this.add({id:l.GLOBAL_REACTIONS_MUTE})[0]}getGlobalSounds(){return d}setGlobalSounds(e){d=e,(0,o.setGlobalSounds)(e)}getGlobalCallRingtone(){return u}setGlobalCallRingtone(e){u=e,(0,o.setGlobalCallRingtone)(e)}getGlobalNotifications(){return p}setGlobalNotifications(e){p=e,(0,o.setGlobalNotifications)(e)}getGlobalPreviews(){return f}setGlobalPreviews(e){f=e,(0,o.setGlobalPreviews)(e)}getCollapseMuted(){return h}setCollapseMuted(e){h=e,(0,o.setCollapseMuted)(e),this.trigger("change:collapseMuted",h)}getOutgoingMessageSound(){return _}setOutgoingMessageSound(e){_=e,(0,o.setOutgoingMessageSound)(e)}handle(e){e.forEach((e=>{const t=n(69951).ChatCollection.get(e.id);t&&"mute"===e.type&&t.mute.setMute(e.muteExpiration)}))}}t.MuteCollectionImpl=g,g.model=l.Mute,g.cachePolicy={id:"mute",policy:r.CACHE_POLICY.LOAD,delay:1e3};const m=new g;t.MuteCollection=m},51783:(e,t,n)=>{"use strict";var r=n(59182).default,i=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(n(81109)),o=i(n(48926)),s=n(89385),l=i(n(42341)),c=n(40265),d=n(50796),u=i(n(45095)),p=n(40277),f=n(37178),h=n(92574),_=n(23082),g=i(n(76139)),m=n(29984),y=n(96177),E=n(11290),S=n(17239),v=i(n(26847)),T=n(99234),b=n(7293),C=i(n(14296)),A=i(n(11339)),P=n(64551);class M extends((0,c.customError)("NoticeJsonParseError")){}const O=["logout","refresh"],I=(0,f.createTimer)({algo:{type:"constant",delay:432e5}}),w=(0,f.createTimer)({algo:{type:"fibonacci",first:0,second:1},max:18e6});class R extends E.BaseModel{constructor(){super(...arguments),this.id=(0,E.prop)(),this.noticeId=(0,E.prop)(),this.blocking=(0,E.prop)(),this.policyVersion=(0,E.prop)(),this.banner=(0,E.prop)(),this.blockingModal=(0,E.prop)(),this.shouldShowButterBar=(0,E.session)(!0),this.backgroundFetches=(0,E.session)()}initialize(){super.initialize(),this.fetchNoticeData=this.fetchNoticeData.bind(this),this.listenTo(C.default,"locale_change",this.fetchNoticeData)}dismissButterBarNotice(){0!==P.ServerProps.greenAlertBannerDuration&&(new A.default.UserNotice({userNoticeId:this.noticeId,userNoticeContentVersion:this.policyVersion,userNoticeEvent:A.default.USER_NOTICE_EVENT.BANNER_DISMISS}).commit(),this._dismissAndStartButterBarTimer(P.ServerProps.greenAlertBannerDuration),(0,T.setNoticeBannerClosedAt)(Date.now()))}_dismissAndStartButterBarTimer(e){this.shouldShowButterBar=!1,this._clearButterBarTimer(),this._butterBarTimeoutHandler=window.setTimeout((()=>{this.shouldShowButterBar=!0,(0,T.setNoticeBannerClosedAt)(null)}),e)}delete(){this.resetNotice(),super.delete()}sanitizeBlockingModal(e){if(!e)return null;const t=e=>{if(!e)return null;const t=e.action;if(t){const n=O.find((e=>`whatsapp:user-notice?action=${e}`===t));if(n)return e.action=n,e;__LOG__(3)`Notice: Unknown action type ${t}`}return null};return e.primaryButton=t(e.primaryButton),e.secondaryButton=t(e.secondaryButton),e}_isoFromCallingCode(e){const t=parseInt(e,10),n=l.default[t];return(0,u.default)(n,"isoFromCC")}validateResponseFields(e,t){e.forEach((e=>{if(!(e in t))throw new Error(`Missing field ${e} in notice content.`)}))}extractBlockingModal(e){if(e)return this.validateResponseFields(["icon","iconDescription","title","body","primaryButton"],e),this.validateResponseFields(["light","dark"],e.icon),{icon:{light:e.icon.light,dark:e.icon.dark},iconSvg:{light:"",dark:""},iconDescription:e.iconDescription,title:e.title,body:e.body,primaryButton:e.primaryButton,secondaryButton:e.secondaryButton}}extractBanner(e){if(e)return this.validateResponseFields(["icon","iconDescription","text"],e),this.validateResponseFields(["light","dark"],e.icon),{icon:{light:e.icon.light,dark:e.icon.dark},iconDescription:e.iconDescription,text:e.text,iconSvg:{light:"",dark:""}}}extractUserNoticeContent(e){const{policyVersion:t}=e;if(!t)throw new Error("Missing field policyVersion in notice content.");__LOG__(2)`Notice:fetchNoticeData successful for policyVersion ${t}`;const n=e.banner&&this.extractBanner(e.banner),r=e["blocking-modal"]&&this.extractBlockingModal(e["blocking-modal"]),i=r&&this.sanitizeBlockingModal(r);this.set({policyVersion:t,blockingModal:i,banner:n}),this.makeIconFetch(n,i)}resetBackgroundFetches(){var e;null===(e=this.backgroundFetches)||void 0===e||e.forEach((e=>{__LOG__(2)`Notice: aborting fetches`,e.abort()}))}resetNotice(){this.resetBackgroundFetches(),this.unset(["banner","blocking","blockingModal","noticeId","policyVersion"]),(0,T.setNoticeId)(null),(0,T.setNoticeBannerClosedAt)(null),this._clearButterBarTimer(),this.shouldShowButterBar=!0}_clearButterBarTimer(){const e=this._butterBarTimeoutHandler;null!=e&&window.clearTimeout(e)}fetchNoticeData(){if((0,m.isNonZeroNumber)(this.noticeId)&&b.GK.supportsFeature(b.GK.F.USER_NOTICE)){var e,t;this.resetBackgroundFetches(),this.set({blockingModal:void 0,banner:void 0});const n=(0,T.getMeUser)(),r=(0,p.findCC)(n.user),i=this._isoFromCallingCode(r),a=g.default.build("https://www.whatsapp.com/user-notice/v1/",{id:this.noticeId,lg:null!==(e=S.Conn.lg)&&void 0!==e?e:"zz",lc:null!==(t=S.Conn.lc)&&void 0!==t?t:"ZZ",cc:i,platform:S.Conn.isSMB?"smbweb":"web"});this.makeContentFetch(a)}}_shouldUpdateVersion(e,t){return null==e||null!=t&&t>e}handleResponse(e){if(b.GK.supportsFeature(b.GK.F.USER_NOTICE))if(e.length){const{blocking:t,id:n,version:r}=e[0],i=this.noticeId,a=this._shouldUpdateVersion(this.policyVersion,r);__LOG__(2)`Notice: received notice id: ${n}, blocking: ${t}, version: ${r}`,this.set({blocking:t,noticeId:n,policyVersion:a?r:this.policyVersion}),(n!==i||a)&&this.fetchNoticeData();n!==(0,T.getNoticeId)()&&((0,T.setNoticeId)(n),(0,T.setNoticeBannerClosedAt)(null),this._clearButterBarTimer(),this.shouldShowButterBar=!0),e.length>1&&(__LOG__(4,void 0,new Error,!0)`Notice: more than one notice from phone response`,SEND_LOGS("notice-unallowed-length"))}else __LOG__(2)`Notice: received empty notice`,this.resetNotice()}sync(e){!0!==e&&this._initializeShouldShowButterBar();const t="Notice:sync"+(e?" resume":"");__LOG__(2)`${t}`;return(0,n(56891).default.queryNoticeState)(e).then((e=>{200===e.status?(__LOG__(2)`${t} success`,this.handleResponse(e.notices)):__LOG__(3)`${t} error receive status code ${e.status}`})).catch((0,d.filteredCatch)(h.WebdDrop,(function(){__LOG__(3)`${t} dropped`}))).catch((e=>{__LOG__(4,void 0,new Error,!0)`${t} failed with error: ${e}`,SEND_LOGS("notice-query-failed")}))}_initializeShouldShowButterBar(){const e=(0,T.getNoticeBannerClosedAt)();if(null!=e&&0!==P.ServerProps.greenAlertBannerDuration){const t=e+P.ServerProps.greenAlertBannerDuration-Date.now();if(t>0)return void this._dismissAndStartButterBarTimer(t)}this.shouldShowButterBar=!0}makeContentFetch(e){var t=this;return(0,o.default)((function*(){try{const n=yield t.attemptFirstFetchAndRetriesAfter(e);try{const e=n&&JSON.parse(n);e&&t.extractUserNoticeContent(e)}catch(e){throw new A.default.UserNoticeError({userNoticeId:t.noticeId,userNoticeContentVersion:t.policyVersion,userNoticeErrorEvent:A.default.USER_NOTICE_ERROR_EVENT.JSON_PARSE}).commit(),new M(`Received invalid User Notice content for id ${t.noticeId}`)}}catch(e){if(e.name===s.ABORT_ERROR)return;if("NoticeJsonParseError"!==e.name){new A.default.UserNoticeError({userNoticeId:t.noticeId,userNoticeContentVersion:t.policyVersion,userNoticeErrorEvent:A.default.USER_NOTICE_ERROR_EVENT.JSON_FETCH}).commit()}t.resetNotice(),__LOG__(4,void 0,new Error,!0)`Notice: Error Message : ${e.message}`,SEND_LOGS("notice-content-error")}}))()}makeIconFetch(e,t){var n=this;return(0,o.default)((function*(){const r=[null==e?void 0:e.icon.light,null==e?void 0:e.icon.dark,null==t?void 0:t.icon.light,null==t?void 0:t.icon.dark].map((e=>e?n.attemptFirstFetchAndRetriesAfter(e):Promise.resolve(null)));try{const[e,t,i,o]=yield Promise.all(r);let s=n.banner,l=n.blockingModal;n.banner&&e&&t&&(s=(0,a.default)((0,a.default)({},n.banner),{iconSvg:{light:e,dark:t}})),n.blockingModal&&i&&o&&(l=(0,a.default)((0,a.default)({},n.blockingModal),{iconSvg:{light:i,dark:o}})),n.set({banner:s,blockingModal:l})}catch(e){if(e.name===s.ABORT_ERROR)return;new A.default.UserNoticeError({userNoticeId:n.noticeId,userNoticeContentVersion:n.policyVersion,userNoticeErrorEvent:A.default.USER_NOTICE_ERROR_EVENT.IMAGE_FETCH}).commit(),__LOG__(4,void 0,new Error,!0)`Notice: Icon fetch error : ${e.message}`,SEND_LOGS("notice-icon-fetch-error")}}))()}shouldRetry(e){return 404===e||429===e||e>=500}attemptFirstFetchAndRetriesAfter(e){var t=this;return(0,o.default)((function*(){var n;const i=new r,a=i.signal,o=null!==(n=t.backgroundFetches)&&void 0!==n?n:[];t.backgroundFetches=[...o,i];try{const n=yield(0,v.default)(e,{signal:a});if(!n.ok){const e=n.status;throw t.shouldRetry(e)?new _.HttpStatusCodeError(e,"noticeFetchErr"):new Error("contentResponseUnhandledError")}return n.text()}catch(n){if("HttpStatusCodeError"===n.name)return t.retryFetch(e,n.status);throw n}}))()}retryFetch(e,t){var n,i=this;const a=new r,s=a.signal,l=null!==(n=this.backgroundFetches)&&void 0!==n?n:[];this.backgroundFetches=[...l,a];const c=function(){var t=(0,o.default)((function*(t){__LOG__(2)`Notice: Fetch Retry attempt`;const n=yield(0,v.default)(e,{signal:s});if(!n.ok){if(__LOG__(3)`Notice: Could Not download`,i.shouldRetry(n.status))return t(new Error("retryFailed"));throw new Error("contentResponseUnhandledError")}return n.text()}));return function(){return t.apply(this,arguments)}}();let d,u;return 404===t?(u=2,d=e=>{let{taskDuration:t}=e;const n=I();return Math.max(n-t,0)}):(u=8,d=e=>{let{taskDuration:t}=e;const n=36e5*w();return Math.max(n-t,0)}),(0,y.backoff)({delay:d,retries:u,signal:s},c)}}R.Proxy="notice";var D=new((0,E.defineModel)(R))({id:"default_notice_id"});t.default=D},3e4:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.Presence=t.ChatstateCollection=t.Chatstate=void 0,t.processStagesRecursively=m;var i=r(n(23279)),a=n(40234),o=r(n(89867)),s=n(48360),l=n(1255),c=n(11290),d=n(19380),u=r(n(14296)),p=n(42931);class f extends c.BaseModel{constructor(){super(...arguments),this.id=(0,c.prop)(),this.type=(0,c.prop)(),this.t=(0,c.prop)(),this.deny=(0,c.prop)(),this.updateTime=(0,c.session)(),this.expireTimerId=(0,c.session)()}}f.Proxy="chatstate",f.idClass=o.default;const h=(0,c.defineModel)(f);t.Chatstate=h;class _ extends l.BaseCollection{}t.ChatstateCollection=_,_.model=h;class g extends c.BaseModel{constructor(){super(...arguments),this.id=(0,c.prop)(),this.isOnline=(0,c.session)(!1),this.stale=(0,c.session)(!0),this.hasData=(0,c.session)(!1),this.isSubscribed=(0,c.session)(!1),this.withholdDisplayStage=(0,c.session)(p.WithholdDisplayStage.None),this.forceDisplay=(0,c.session)(!1),this.chatActive=(0,c.session)(!1),this.withholdDisplayTimer=(0,c.session)(),this.forceDisplayTimer=(0,c.session)(),this.chatstate=(0,c.session)(),this.chatstates=(0,c.collection)(_),this.isGroup=(0,c.derived)((function(){return o.default.isGroup(this.id)})),this.isUser=(0,c.derived)((function(){return o.default.isUser(this.id)}))}initialize(){super.initialize();const e=this.isGroup?{id:"",type:"unavailable"}:{id:this.id};this.addChild("chatstate",new h(e)),this.isGroup?this.listenTo(this.chatstates,"add change",(0,i.default)((()=>{let e,t=!1;this.chatstates.forEach((n=>{"composing"!==n.type&&"recording"!==n.type||e&&!(e.updateTime<n.updateTime)||(e=n),t=t||"unavailable"!==n.type})),this.set({isOnline:t}),this.chatstate.set({id:e?e.id:"",type:e?e.type:"unavailable"})}))):this.listenTo(this.chatstate,"change:type",(()=>{this.isOnline="unavailable"!==this.chatstate.type})),this.listenTo(this,"change:chatActive",this.onChatActiveChange)}delete(){super.delete(),this.getCollection().remove(this.id),this.chatstate.delete(),this.chatstates.forEach((e=>e.delete()))}reset(){this.hasData=!1,this.isGroup?this.chatstates.forEach((e=>{e.type="unavailable"})):this.isUser&&(this.chatstate.unset("t"),this.chatstate.unset("deny")),this.chatstate.set({id:this.isGroup?"":this.id,type:"unavailable",t:void 0,deny:void 0})}isActive(){const e=this.chatstate.type;return this.hasData&&("composing"===e||"recording"===e)}getGroupSubtitleText(){if(!this.hasData)return null;if(!this.isGroup)return __LOG__(4,void 0,new Error,!0)`getGroupSubtitleText is used when presence is not for a group`,SEND_LOGS("getGroupSubtitleText-not-group"),null;const e=this._getActiveContact();if(null==e)return null;const t=e.formattedShortName;return"composing"===this.chatstate.type?u.default.t(862,{participant:t}):u.default.t(863,{participant:t})}_getActiveContact(){const e=this.chatstate.id;return e?d.ContactCollection.get(e):null}getUserSubtitleText(){if(!this.hasData)return null;if(!this.isUser)return __LOG__(4,void 0,new Error,!0)`getUserSubtitleText is used when presence is not for a user`,SEND_LOGS("getUserSubtitleText-not-user"),null;const e=this.chatstate;switch(e.type){case"available":return u.default.t(857);case"composing":return s.fbt._("typing",null,{hk:"49dYir"});case"recording":return s.fbt._("recording audio",null,{hk:"21blv0"});case"unavailable":return e.deny||null==e.t?null:a.Clock.lastSeenStr(e.t)}}getFormattedString(){return this.hasData?this.isGroup?this.getGroupSubtitleText():this.isUser?this.getUserSubtitleText():null:null}onChatActiveChange(){if(this.chatActive){if(this.hasData)this.withholdDisplayStage=p.WithholdDisplayStage.None;else{const e=this._getActiveContact();!0===(null==e?void 0:e.isBusiness)?m(this,[p.WithholdDisplayStage.Business,p.WithholdDisplayStage.Info,p.WithholdDisplayStage.None]):m(this,[p.WithholdDisplayStage.Info,p.WithholdDisplayStage.None])}this.forceDisplayTimer=setTimeout((()=>{this.set({forceDisplay:!0,forceDisplayTimer:void 0})}),2e3)}else this.withholdDisplayTimer&&(clearTimeout(this.withholdDisplayTimer),this.withholdDisplayTimer=void 0),this.forceDisplayTimer&&(clearTimeout(this.forceDisplayTimer),this.forceDisplayTimer=void 0)}subscribe(){return this.getCollection().find(this.id)}getCollection(){return n(68315).PresenceCollection}}function m(e,t){if(0===t.length)return;const[n,...r]=t;e.set({withholdDisplayStage:n,withholdDisplayTimer:n===p.WithholdDisplayStage.None?null:setTimeout((()=>{m(e,r)}),n===p.WithholdDisplayStage.Business?5e3:1500)})}g.Proxy="presence",g.idClass=o.default;const y=(0,c.defineModel)(g);t.Presence=y},68315:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.PresenceCollectionImpl=t.PresenceCollection=void 0;var i=r(n(48926)),a=n(88555),o=n(64603),s=r(n(89867)),l=n(57849),c=n(1255),d=n(3e4),u=n(2253);class p extends c.BaseCollection{_subscribe(e){return(0,i.default)((function*(){const t=n(69951).ChatCollection.get(e);if((0,a.isMDBackend)()&&(0,l.getABPropConfigValue)("trusted_contacts_reciprocity")&&null!=t){const e=null!=t.tcTokenSenderTimestamp&&(0,o.isTokenExpired)(t.tcTokenSenderTimestamp,o.TcTokenMode.Receiver);if(!t.contact.isBusiness&&!e&&!t.contact.isWAContact)return}yield(0,u.subscribePresence)(e,null==t?void 0:t.getTcToken())}))()}_find(e){var t=this;return(0,i.default)((function*(){return!t.gadd(e).isUser||s.default.isServer(e)||s.default.isPSA(e)||(yield t._subscribe(e)),{id:e}}))()}reSubscribeWhenActive(e){var t=this;return(0,i.default)((function*(){const n=t.get(e);null!=n&&!1!==n.isSubscribed&&(yield t._subscribe(e))}))()}clearAllPresence(){this.forEach((e=>{e.reset(),e.set({stale:!0,isSubscribed:!1})}))}}t.PresenceCollectionImpl=p,p.model=d.Presence,p.staleCollection=!0;const f=new p;t.PresenceCollection=f},42931:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WithholdDisplayStage=void 0;const r=n(76672).Mirrored(["Info","Business","None"]);t.WithholdDisplayStage=r},34771:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PrimaryFeaturesClass=t.PrimaryFeatures=void 0;var r=n(11290),i=n(99234);class a extends r.BaseModel{constructor(){super(...arguments),this.features=(0,r.prop)(),this.contactExcept=(0,r.prop)(!1),this.reactionsSend=(0,r.prop)(!1),this.ddmSettings=(0,r.prop)(!1)}initializeFromLocalStorage(){this._setPrimaryFeatures((0,i.getPrimaryFeatures)())}setPrimaryFeatures(e){(0,i.setPrimaryFeatures)(e),this._setPrimaryFeatures(e)}_setPrimaryFeatures(e){this.features=e;const t=new Set(e);this.contactExcept=t.has("contact_except"),this.reactionsSend=t.has("reactions_send"),this.ddmSettings=t.has("ddm_settings")}}t.PrimaryFeaturesClass=a,a.Proxy="primaryFeatures";const o=new((0,r.defineModel)(a))({id:"1"});t.PrimaryFeatures=o},48694:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.PrimaryForceUpgradeClass=t.PrimaryForceUpgrade=void 0;var i=n(57849),a=n(11290),o=n(88102),s=r(n(11339)),l=n(34771),c=n(52622);class d extends a.BaseModel{constructor(){super(...arguments),this.forceUpgradeReason=(0,a.prop)(),this.shouldForceUpgrade=(0,a.derived)((function(){return null!=this.forceUpgradeReason}),["forceUpgradeReason"])}setup(){(0,i.getABPropConfigValue)("comparion_force_upgrade")&&(this._update(),this.listenTo(o.Cmd,"on_ab_props_update",(()=>{this._update()})),this.listenTo(l.PrimaryFeatures,"change:features",(()=>{this._update()})))}_update(){try{var e;const n=function(){const e=(0,i.getABPropConfigValue)("companion_min_versions");return JSON.parse(e.substr(5)).map((e=>{let{feature:t,min_version:n}=e;return{feature:t,minVersion:n}}))}(),r=new Set(null!==(e=l.PrimaryFeatures.features)&&void 0!==e?e:[]),a=new c.Version(c.SANITIZED_VERSION_STR),o=n.find((e=>{let{feature:t,minVersion:n}=e;return r.has(t)&&a.lt(n)})),d=this.shouldForceUpgrade;var t;if(this.forceUpgradeReason=null==o?void 0:o.feature,!d&&this.shouldForceUpgrade)new s.default.CompanionForceUpgradeUserAction({forceUpgradeUserAction:s.default.FORCE_UPGRADE_USER_ACTION_TYPE.SHOW,forceUpgradeReason:null!==(t=this.forceUpgradeReason)&&void 0!==t?t:""}).commit();__LOG__(2)`PrimaryForceUpgradeClass: shouldForceUpgrade ${this.shouldForceUpgrade}`}catch(e){__LOG__(4,void 0,new Error,!0)`PrimaryForceUpgradeClass: ${e}`,SEND_LOGS("primary-force-upgrade-error")}}}t.PrimaryForceUpgradeClass=d,d.Proxy="primaryForceUpgrade";const u=new((0,a.defineModel)(d))({id:"1"});t.PrimaryForceUpgrade=u},41601:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PROFILE_PIC_COMMAND=t.PP_URL=t.PP_TOK=t.PP_REF=void 0;t.PP_URL="https://web.whatsapp.com/pp";t.PP_REF="/pp";t.PP_TOK="/pp";const n=Object.freeze({REMOVE:"remove",SET:"set"});t.PROFILE_PIC_COMMAND=n},93836:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ProfilePicThumb=t.FALLBACK=void 0;var i=r(n(81109)),a=n(88555),o=r(n(76139)),s=r(n(89867)),l=n(11290),c=n(99234),d=n(41601),u=r(n(92658));const p={SINGLE:"SINGLE",GROUP:"GROUP"};t.FALLBACK=p;class f extends l.BaseModel{constructor(){super(...arguments),this.id=(0,l.prop)(),this.token=(0,l.prop)(),this.tag=(0,l.prop)(),this.raw=(0,l.prop)(),this.eurl=(0,l.prop)(),this.previewEurl=(0,l.prop)(),this.stale=(0,l.session)(!0),this.eurlStale=(0,l.session)(!1),this.pendingPic=(0,l.session)(),this.img=(0,l.derived)((function(){return this.raw?"data:image/jpeg;base64,"+this.raw:!this.tag&&this.stale?null:this.tag?(0,a.isMDBackend)()?this.previewEurl:this.generateUrl("s"):void 0}),["tag","raw","stale","eurl","eurlStale","previewEurl"]),this.imgFull=(0,l.derived)((function(){return!this.raw&&this.tag||!this.stale?!this.raw&&this.tag?(0,a.isMDBackend)()?this.eurl:this.generateUrl("l"):void 0:null}),["tag","raw","stale","eurl","eurlStale"]),this.fallbackType=(0,l.derived)((function(){return s.default.isUser(this.id)?p.SINGLE:(s.default.isGroup(this.id),p.GROUP)}),["id"])}markStale(e){this.stale=!0,(null==e?void 0:e.eurl)&&(this.eurlStale=!0)}validate(){if(this.stale||this.eurlStale)return this.getCollection().update(this.id)}generateUrl(e){let t={t:e,u:this.id.toString(),i:this.tag||"",n:this.token||""};return this.token||(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("profilePicThumb::generateUrl: empty token for profile pic")),u.default.alive&&this.eurl&&!this.eurlStale&&(t=(0,i.default)({e:this.eurl},t)),o.default.build(d.PP_URL,t)}canSet(){if(s.default.isGroup(this.id)){var e;const t=n(69951).ChatCollection.get(this.id);return!(null==t||null===(e=t.groupMetadata)||void 0===e?void 0:e.participants.iAmRestrictedMember())}return!!this.id.equals((0,c.getMaybeMeUser)())}canDelete(){if(s.default.isGroup(this.id)&&this.tag){var e;const t=n(69951).ChatCollection.assertGet(this.id);return!(null==t||null===(e=t.groupMetadata)||void 0===e?void 0:e.participants.iAmRestrictedMember())}return!(!this.id.equals((0,c.getMaybeMeUser)())||!this.tag)}getCollection(){return n(82039).ProfilePicThumbCollection}}f.Proxy="profilePicThumb",f.idClass=s.default;const h=(0,l.defineModel)(f);t.ProfilePicThumb=h},82039:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ProfilePicThumbCollectionImpl=t.ProfilePicThumbCollection=void 0;var i=r(n(41609)),a=n(50796),o=r(n(11782)),s=n(92574),l=n(88555),c=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=v(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(35232)),d=n(93778),u=r(n(89867)),p=n(45454),f=n(14648),h=n(1255),_=n(17239),g=n(55981),m=n(53055),y=n(41601),E=n(78426),S=n(93836);function v(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(v=function(e){return e?n:t})(e)}class T extends h.BaseCollection{get(e){const t=super.get(e);if(!this.modelClass.prototype.isIdType(e))return t;const n=super.get((0,o.default)(e.toString()));if(n){if(this.remove(n,{silent:!0}),t&&t.tag)return t;const r=n.toJSON();return r.id=e,this.add(r,{silent:!0,merge:!0})[0]}return t||void 0}saveToCache(){if(!_.Conn.shouldSaveToCache())return;const e=T.cachePolicy.id;let t=this.filter((e=>u.default.isWid(e.id)&&!!e.eurl&&!!e.token));t=t.map((function(e){const t=e.toJSON();return t.id=(0,o.default)(t.id.toString()),t})),__LOG__(2)`models:profilePic:cache-save: ${String(e)}`,(0,m.setCollection)(e,t)}initializeFromCache(e){if(!this.length||!e)return;const t=this.reduce(((e,t)=>(e[(0,o.default)(t.id.toString())]=t.id.toString(),e)),new Object);if((0,i.default)(t))return;const n=e.reduce(((e,n)=>(t[n.id]&&(n.id=(0,p.createWid)(t[n.id]),n.stale=!0,n.token&&e.push(n)),e)),[]);this.add(n,{merge:!0})}onResume(){const e=this.filter((e=>{const t=n(69951).ChatCollection.get(e.id);return e.hasObservers()&&e.stale&&(u.default.isUser(e.id)||u.default.isGroup(e.id))&&!(null==t?void 0:t.isReadOnly)})).map((e=>(e.tag||e.unset("tag",{silent:!0}),e)));this.resyncPictures(e)}_find(e){var t;const r=n(69951).ChatCollection.get(e),i=(null==r||null===(t=r.groupMetadata)||void 0===t?void 0:t.groupType)===g.GroupType.COMMUNITY,o=n(73213).default.get(e.toString());if((null==r?void 0:r.isReadOnly)&&!i&&null==o)return(0,l.isMDBackend)()?Promise.resolve({id:e,stale:!0}):(0,E.profilePicFindThumbFromPhone)(e,this.get(e)).then((e=>(e.tag||e.raw||(e.eurl=null,e.tag=null,e.raw=null,e.eurlStale=!1),e))).catch((0,a.filteredCatch)(c.ProtoVersionUndefined,(()=>({id:e,stale:!0}))));if((u.default.isUser(e)||u.default.isGroup(e))&&!u.default.isPSA(e)){const t={id:e},n={};return u.default.isGroup(e)&&(i?n.parentGroupId=e:null!=o&&(n.parentGroupId=o.parentGroupId)),(0,E.profilePicFind)(e,n).then((e=>(t.tag=e.tag,t.raw=null,t.eurl=e.eurl,t.eurlStale=!1,t.token=e.token,(0,l.isMDBackend)()&&(t.previewEurl=e.previewEurl),t))).catch((0,a.filteredCatch)(s.ServerStatusCodeError,(e=>{switch(e.status){case 401:t.tag="",t.raw=void 0;break;case 423:case 429:t.stale=!0;break;default:t.tag=null,t.eurl=null,t.eurlStale=!1}return Promise.resolve(t)}))).catch((0,a.filteredCatch)(s.WebdDrop,(function(){return{id:e,stale:!0}})))}return Promise.resolve({id:e,tag:null})}imageChanged(e,t){const n=this.get(e);n&&(t===y.PROFILE_PIC_COMMAND.REMOVE?n.set({tag:void 0,eurl:void 0}):t!==y.PROFILE_PIC_COMMAND.SET&&n.tag===t||this.update(n.id).catch((0,a.filteredCatch)(s.WebdDrop,(()=>{}))))}resyncPictures(e){return 0===e.length?Promise.resolve():(0,E.profilePicResync)(e.map((function(e){return{id:e.id,tag:e.tag}}))).then((t=>{__LOG__(2)`ProfilePicThumbStore:resyncPictures success`,t.forEach((t=>{const n=this.get(t.id);n&&n.set({tag:t.tag,token:t.token,raw:void 0,stale:!1,eurl:t.eurl,eurlStale:!1,previewEurl:t.previewEurl}),e.forEach((e=>{e.eurlStale&&this.update(e.id)})),e.forEach((e=>{e.stale=!1}))}))})).catch((0,a.filteredCatch)(s.WebdDrop,(()=>{}))).catch((0,a.filteredCatch)(s.ServerStatusCodeError,(e=>{423===e.status||429===e.status?__LOG__(3)`ProfilePicThumbStore:resyncPictures blocked ${e.status}`:e.status>=400&&__LOG__(3)`ProfilePicThumbStore:resyncPictures dropped: ${String(e)}`}))).catch((function(e){__LOG__(3)`ProfilePicThumbStore:resyncPictures dropped: ${String(e)}`}))}findThumbnailWid(e){return e.find((e=>{var t;return null===(t=this.get(e))||void 0===t?void 0:t.img}))}getThumbnailWidFromVcard(e){if(!e)return null;const t=(0,d.vcardWids)(e);if(!t)return;const n=this.findThumbnailWid(t);return n||(t.length?t[0]:null)}}t.ProfilePicThumbCollectionImpl=T,T.model=S.ProfilePicThumb,T.staleCollection=!0,T.resumeOnAvailable=!0,T.cachePolicy={id:"profile_pic_thumb",trigger:"change:tag change:raw",policy:f.CACHE_POLICY.LOAD,delay:5e3};const b=new T;t.ProfilePicThumbCollection=b},31592:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ReactionsSendersCollection=t.ReactionsSenders=t.Reactions=t.AggReactionsCollection=t.AggReactions=void 0;var i=r(n(94654)),a=n(35470),o=r(n(65212)),s=n(67811),l=n(45454),c=n(11290),d=r(n(31727)),u=n(19380);class p extends c.BaseModel{constructor(){super(...arguments),this.id=(0,c.prop)(),this.msgKey=(0,c.prop)(),this.parentMsgKey=(0,c.prop)(),this.reactionText=(0,c.prop)(),this.timestamp=(0,c.prop)(),this.senderUserJid=(0,c.prop)(),this.read=(0,c.prop)(),this.orphan=(0,c.prop)(),this.ack=(0,c.prop)(),this.isSendFailure=(0,c.prop)(),this.isFailed=(0,c.derived)((function(){return(0,s.isReactionByMe)(this.senderUserJid)&&null!=this.ack&&this.ack<a.ACK.CLOCK||Boolean(this.isSendFailure)}),["ack","isSendFailure"]),this.senderObj=(0,c.session)(),this.parentMsg=(0,c.derived)((function(){return this._getMsgCollection().get(this.parentMsgKey)}))}initialize(){super.initialize(),this.addChild("senderObj",u.ContactCollection.gadd((0,l.createUserWid)(this.senderUserJid)))}_getMsgCollection(){return n(59871).MsgCollection}isEqual(e){return this.id.equals(e.id)}}p.Proxy="reactionsSenders",p.idClass=o.default;const f=(0,c.defineModel)(p);t.ReactionsSenders=f;class h extends d.default{}t.ReactionsSendersCollection=h,h.model=f,h.comparator=(e,t)=>(0,s.isReactionByMe)(e.senderUserJid)?-1:(0,s.isReactionByMe)(t.senderUserJid)?1:t.timestamp-e.timestamp;class _ extends c.BaseModel{constructor(){super(...arguments),this.id=(0,c.prop)(),this.aggregateEmoji=(0,c.prop)(),this.hasReactionByMe=(0,c.prop)(),this.senders=(0,c.collection)(h)}}_.Proxy="aggReactions";const g=(0,c.defineModel)(_);t.AggReactions=g;class m extends d.default{}t.AggReactionsCollection=m,m.model=g,m.comparator=(e,t)=>{const n=t.senders.length-e.senders.length;if(e.hasReactionByMe)return-1;if(t.hasReactionByMe)return 1;if(0===n){const n=t.senders.at(0),r=e.senders.at(0);if(n&&r)return n.timestamp-r.timestamp}return n};class y extends c.BaseModel{constructor(){super(...arguments),this.id=(0,c.prop)(),this.reactionByMe=(0,c.prop)(),this.reactions=(0,c.collection)(m)}unreadSenders(){return(0,i.default)(this.reactions.toArray(),(e=>e.senders.filter((e=>!e.read&&!(0,s.isReactionByMe)(e.senderUserJid))))).map((e=>{let{id:t,parentMsgKey:n,reactionText:r,senderUserJid:i}=e;return{msgKey:t,parentMsgKey:o.default.fromString(n),reactionText:r,senderUserJid:i}}))}getCollection(){return n(31464).ReactionsCollection}}y.Proxy="reactions",y.idClass=o.default;const E=(0,c.defineModel)(y);t.Reactions=E},31464:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ReactionsCollectionImpl=t.ReactionsCollection=void 0;var i=r(n(81109)),a=r(n(48926)),o=n(51737),s=n(35470),l=r(n(65212)),c=n(67811),d=n(1255),u=n(67247),p=n(31592),f=n(15665);class h extends d.BaseCollection{_find(e){return(0,a.default)((function*(){const t=n(59871).MsgCollection,r=t.get(e);if(!r){const{messages:n}=yield t.getMessagesById([e]),r=n[0];return r?(0,f.sendQueryReactions)(r):Promise.reject(new d.CollectionSilentQueryError(`No message found for id: ${e}`))}return(0,f.sendQueryReactions)(r)}))()}addOrUpdateReaction(e){if(e.reactionText===c.REVOKED_REACTION_TEXT)return this.removeReaction(e);const t=this.get(e.parentMsgKey);if(t){const{reactionSenderModel:n,reactionAggregateWithSender:r}=this.getAggregateEmojiAndSender(t,e.senderUserJid);if(r&&n){if(!(e.timestamp>n.timestamp))return;(0,c.isReactionByMe)(e.senderUserJid)&&this._removeSelfReaction(e),this._removeAggregateEmojiAndSender(t,n,r)}this._addNewReactionToAggregate(e,t)}}removeReaction(e){if((0,c.isReactionByMe)(e.senderUserJid))return this._removeSelfReaction(e);const t=this.get(e.parentMsgKey);if(t){const{reactionAggregateWithSender:n,reactionSenderModel:r}=this.getAggregateEmojiAndSender(t,e.senderUserJid);n&&r&&(this._removeAggregateEmojiAndSender(t,r,n),r.trigger("revoked"))}else __LOG__(3)`reactions_collection:removeReaction no reactions model found`}_addNewReactionToAggregate(e,t){const n=u.EmojiUtil.getEmojiAggregate(e.reactionText),r=t.reactions.get(n),a=l.default.fromString(e.msgKey),o=(0,i.default)((0,i.default)({},e),{},{id:a}),s=(0,c.isReactionByMe)(e.senderUserJid);r?(s&&(r.set({hasReactionByMe:!0}),t.set({reactionByMe:e})),r.senders.add(o),t.reactions.sort(),r.trigger("change:senders")):(s&&t.set({reactionByMe:e}),t.reactions.add({aggregateEmoji:n,hasReactionByMe:s,id:n,senders:[o]}))}_removeAggregateEmojiAndSender(e,t,n){n.senders.remove(t.id),0===n.senders.length?e.reactions.remove(n.id):e.reactions.sort(),n.trigger("change:senders")}getAggregateEmojiAndSender(e,t){let n=null,r=null;for(let i=0;i<e.reactions.length;i++){const a=e.reactions.at(i),o=null==a?void 0:a.senders.findFirst((e=>e.senderUserJid===t));if(o){n=o,r=a;break}}return{reactionSenderModel:n,reactionAggregateWithSender:r}}_removeSelfReaction(e){const t=this.get(e.parentMsgKey);if(null==t||t.set({reactionByMe:null}),t){const{reactionAggregateWithSender:n,reactionSenderModel:r}=this.getAggregateEmojiAndSender(t,e.senderUserJid);null==n||n.set({hasReactionByMe:!1}),n&&r&&(this._removeAggregateEmojiAndSender(t,r,n),r.trigger("revoked"))}}markReactionsAsRead(e){e.forEach((e=>{const{parentMsgKey:t,msgKey:n,reactionText:r}=e,a=u.EmojiUtil.getEmojiAggregate(r),o=this.get(t);if(o){const e=o.reactions.get(a),t=null==e?void 0:e.senders.get(n);t?t.set((0,i.default)((0,i.default)({},t),{},{read:!0})):__LOG__(3)`reactions_collection:markReactionsAsRead Reaction sender model not found`}}))}getExistingSenderModelFromReactionDetails(e){const{parentMsgKey:t,msgKey:n,reactionText:r}=e,i=u.EmojiUtil.getEmojiAggregate(r),a=this.get(t);if(a){const e=a.reactions.get(i);return null==e?void 0:e.senders.get(n)}__LOG__(3)`reactions_collection:getExistingSenderModelFromReactionDetails Reactions sender model not found for this message id`}updateFailedPropsForExistingSentReaction(e,t,n){const r=this.getExistingSenderModelFromReactionDetails(e);if(r){const e={};null!=t&&(e.ack=t),null!=n&&(e.isSendFailure=n),r.set((0,i.default)((0,i.default)({},r),e))}}shouldUpdateAck(e,t){const n=this.getExistingSenderModelFromReactionDetails(e);if(n){const e=n.ack;return!(!(0,o.isNumber)(t)||!(void 0===e||null==e||t>e||t===s.ACK.FAILED))}return __LOG__(3)`reactions_collection:shouldUpdateAck Reaction sender model not found`,!1}deleteReactionsByParentMessageKey(e){this.remove(e)}}t.ReactionsCollectionImpl=h,h.model=p.Reactions;const _=new h;t.ReactionsCollection=_},53988:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(null==e)return a.default.MEDIA_TYPE.NONE;switch(e){case i.default.SHOPS_STOREFRONT:return a.default.MEDIA_TYPE.SHOP_STOREFRONT;case i.default.NATIVE_FLOW:return a.default.MEDIA_TYPE.INTERACTIVE_NFM}};var i=r(n(84064)),a=r(n(11339))},26287:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getNativeFlowNameByButtonName=function(e){switch(e){case"review_and_pay":return i.default.ORDER_DETAILS;case"review_order":return i.default.ORDER_STATUS}},t.isValidNativeFlowMessage=void 0;var i=r(n(5165)),a=n(34841),o=n(88998);t.isValidNativeFlowMessage=e=>{if(null==e.nativeFlowName)return!1;switch(e.nativeFlowName){case i.default.ORDER_DETAILS:return null!=(0,a.getOrderInfo)(e);case i.default.ORDER_STATUS:return null!=(0,o.getOrderStatusInfo)(e)}}},34841:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.paramsJsonToOrderInfo=t.getOrderInfo=void 0;var i=n(15461),a=r(n(84064)),o=r(n(5165)),s=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=l(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(45218));function l(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(l=function(e){return e?n:t})(e)}function c(e){var t;const n=null==e?void 0:e.value;if(null==n)return;const r=null!==(t=null==e?void 0:e.offset)&&void 0!==t?t:1;return parseFloat(null!=n?n:0)/parseInt(r,10)}const d=(e,t)=>{var n,r;if("review_and_pay"!==e||null==t)return null;const i=s.parse(t),{order:a,currency:o,reference_id:l}=i,d=c(i.total_amount),u=null!==(n=null==a?void 0:a.items)&&void 0!==n?n:[],p=u.map((e=>{var t,n,r,i;return{id:null!==(t=null!==(n=null==e?void 0:e.product_id)&&void 0!==n?n:null==e?void 0:e.retailer_id)&&void 0!==t?t:"",name:null!==(r=null==e?void 0:e.name)&&void 0!==r?r:"",amount:c(null==e?void 0:e.amount),quantity:parseInt(null!==(i=null==e?void 0:e.quantity)&&void 0!==i?i:0,10),isCustomItem:Boolean(null==e?void 0:e.isCustomItem),isQuantitySet:Boolean(null==e?void 0:e.isQuantitySet)}})),f=p.reduce(((e,t)=>e+t.quantity),0),h=null===(r=u[0])||void 0===r?void 0:r.name;if(null==h||null==l||null==o||null==d)return null;return{title:h,referenceId:l,currency:o,quantity:f,shipping:c(null==a?void 0:a.shipping),tax:c(null==a?void 0:a.tax),discount:c(null==a?void 0:a.discount),subtotal:c(null==a?void 0:a.subtotal),totalAmount:d,items:p}};t.paramsJsonToOrderInfo=d;t.getOrderInfo=e=>{var t;if(e.nativeFlowName!==o.default.ORDER_DETAILS)return null;if(e.type===i.MSG_TYPE.INTERACTIVE&&e.interactiveType===a.default.NATIVE_FLOW&&(null===(t=e.interactivePayload)||void 0===t?void 0:t.buttons)){const{name:t,buttonParamsJson:n}=e.interactivePayload.buttons[0];return d(t,n)}if(e.type===i.MSG_TYPE.NATIVE_FLOW){var n;const{nativeFlowInfo:t}=(null!==(n=e.nativeFlowButtons)&&void 0!==n?n:[])[0];return d(null==t?void 0:t.name,null==t?void 0:t.paramsJson)}}},88998:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.paramsJsonToOrderStatusInfo=t.getOrderStatusInfo=t.getOrderMessage=t.getDefaultOrderStatus=t.findOrderStatusMessage=t.findOrderStatus=t.findOrderDetailsMessage=t.OrderStatus=void 0;var i=r(n(30988)),a=n(15461),o=r(n(84064)),s=r(n(5165)),l=n(34841);const c=n(76672)({Pending:"pending",Processing:"processing",PartiallyShipped:"partially_shipped",Shipped:"shipped",Complete:"completed",Canceled:"canceled"});t.OrderStatus=c;const d=(e,t)=>{if("review_order"!==e||null==t)return null;const{order:n,reference_id:r}=JSON.parse(t),i=c.cast(null==n?void 0:n.status);return null==i||null==r?null:{refId:r,status:i}};t.paramsJsonToOrderStatusInfo=d;const u=e=>{var t;if(e.nativeFlowName!==s.default.ORDER_STATUS)return null;if(e.type===a.MSG_TYPE.INTERACTIVE&&e.interactiveType===o.default.NATIVE_FLOW&&(null===(t=e.interactivePayload)||void 0===t?void 0:t.buttons)){const{name:t,buttonParamsJson:n}=e.interactivePayload.buttons[0];return d(t,n)}if(e.type===a.MSG_TYPE.NATIVE_FLOW){var n;const{nativeFlowInfo:t}=(null!==(n=e.nativeFlowButtons)&&void 0!==n?n:[])[0];return d(null==t?void 0:t.name,null==t?void 0:t.paramsJson)}};t.getOrderStatusInfo=u;const p=(e,t)=>{var n;const r=e.msgs.getModelsArray().slice(-1e3);return null===(n=(0,i.default)(r,(e=>{var n;return e.nativeFlowName===s.default.ORDER_DETAILS&&(null===(n=(0,l.getOrderInfo)(e))||void 0===n?void 0:n.referenceId)===t})))||void 0===n?void 0:n.safe()};t.findOrderDetailsMessage=p;t.getOrderMessage=e=>{var t;const n=null===(t=u(e))||void 0===t?void 0:t.refId;return null==n?null:p(e.chat,n)};const f=(e,t)=>{var n;const r=e.msgs.getModelsArray().slice(-1e3);return null===(n=(0,i.default)(r,(e=>{var n;return e.nativeFlowName===s.default.ORDER_STATUS&&(null===(n=u(e))||void 0===n?void 0:n.refId)===t})))||void 0===n?void 0:n.safe()};t.findOrderStatusMessage=f;const h=()=>c.Pending;t.getDefaultOrderStatus=h;t.findOrderStatus=(e,t)=>{var n;const r=f(e,t),i=null!=r?u(r):null;return null!==(n=null==i?void 0:i.status)&&void 0!==n?n:h()}},90837:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.validateOrderAndSendReceipt=void 0;var r=n(69951),i=n(88998),a=n(99326);const o=new Set([i.OrderStatus.Complete,i.OrderStatus.Canceled]);t.validateOrderAndSendReceipt=(e,t)=>{if(!e)return!0;const n=r.ChatCollection.get(e.toString());if(!n)return!0;const s=(0,i.getOrderStatusInfo)(t);if(!s)return!0;const l=(0,i.findOrderStatusMessage)(n,s.refId);if(!l)return!0;const c=(0,i.getOrderStatusInfo)(l);if(!c)return!0;if(c.status===s.status)return!1;const d=s.status!==(0,i.getDefaultOrderStatus)()&&!o.has(c.status);return d||(0,a.sendOrderStatusUpdateFailureReceipt)(t,a.BizErrorReason.InvalidTransition),d}},99326:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BizErrorReason=void 0,t.sendOrderStatusUpdateFailureReceipt=function(e,t){(0,i.castStanza)((0,r.wap)("receipt",{type:"error",to:(0,r.CUSTOM_STRING)(e.from.toJid()),id:(0,r.CUSTOM_STRING)(e.id.id)},(0,r.wap)("biz",{reason:(0,r.CUSTOM_STRING)(String(t))}),(0,r.wap)("error",{type:"order-status-update-failed"})))};var r=n(31914),i=n(24747);const a=n(76672)({InvalidTransition:"invalid-transition",CancellationFailed:"cancellation-failed"});t.BizErrorReason=a},84728:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VIEW_ONCE_EXPIRE_AFTER=void 0,t.isExpired=c,t.isUnviewed=function(e){return!l(e)&&!c(e)},t.isViewed=l,t.setViewOnceTestExpire_INTERNAL=function(){};var r=n(35470),i=n(40234),a=n(31019);let o=1209600;function s(e){const t=(0,a.unproxy)(e);return null!=t?t.asViewOnce:null}function l(e){var t;return(null===(t=s(e))||void 0===t?void 0:t.ack)===r.ACK.PLAYED}function c(e){const t=s(e);if(null==t)return!1;const n=i.Clock.globalUnixTime()-(0,a.unproxy)(t).t;return!l(t)&&n>=o}t.VIEW_ONCE_EXPIRE_AFTER=o},64551:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ServerPropsImpl=t.ServerProps=t.DEFAULT_MAX_FILE_SIZE_BYTES=void 0,t.getMaxFilesSizeServerProp=function(){return y.maxFileSize};var i=n(11290),a=n(7293),o=r(n(11339)),s=n(40264),l=r(n(53565));const c={imageMaxKBytes:function(e){if("number"==typeof e&&e>0)return 1024*e},pttConversationWaveform:function(e){return Boolean(e)},pttOotPlayback:function(e){return Boolean(e)},pttRememberPlayPosition:function(e){return Boolean(e)},pttWaveformSend:function(e){return Boolean(e)},pttPausableEnabled:function(e){return Boolean(e)},pttForwardedFeaturesEnabled:function(e){return Boolean(e)},maxParticipants:function(e){if("number"==typeof e&&e>0)return e-1},media:h,maxElectronFileSize:f,maxFileSize:f,streamingUploadChunkSize:h,groupDescLength:_,statusVideoMaxDuration:_,muteAlways:g,viewOnceRead:g,viewOnceWrite:g,ctwaContextRender:g,serverPropsVersion:_,wallpapersV2:g,hfmStringChanges:g,webServerStickerPanel:g,shopsProductGrid:g,stickerMaker:function(e){return Boolean(e)},downloadHostSwitchingEnabled:function(e){return Boolean(e)},uploadHostSwitchingEnabled:function(e){return Boolean(e)},webUploadDocumentThumbMmsEnabled:m,webDownloadDocumentThumbMmsEnabled:m,webDownloadStatusThumbMmsEnabled:function(e){return!!a.GK.supportsFeature(a.GK.F.DOWNLOAD_STATUS_THUMB_MMS)&&Boolean(e)}},d=104857600;t.DEFAULT_MAX_FILE_SIZE_BYTES=d;const u=604800;class p extends i.BaseModel{constructor(){super(...arguments),this.serverPropsVersion=(0,i.prop)(),this.gifSearch=(0,i.prop)(!1),this.imageMaxEdge=(0,i.prop)(1600),this.imageMaxKBytes=(0,i.prop)(1048576),this.maxParticipants=(0,i.prop)(101),this.maxSubject=(0,i.prop)(25),this.media=(0,i.prop)(16777216),this.maxElectronFileSize=(0,i.prop)(d),this.maxFileSize=(0,i.prop)(d),this.streamingUploadChunkSize=(0,i.prop)(0),this.groupDescLength=(0,i.prop)(0),this.multicastLimitGlobal=(0,i.prop)(5),this.frequentlyForwardedThreshold=(0,i.prop)(5),this.frequentlyForwardedMax=(0,i.prop)(1),this.ephemeralMessagesAllowedValues=(0,i.prop)("604800"),this.productMediaAttachments=(0,i.prop)(!1),this.muteAlways=(0,i.prop)(!1),this.viewOnceRead=(0,i.prop)(!1),this.viewOnceWrite=(0,i.prop)(!1),this.wallpapersV2=(0,i.prop)(!1),this.hfmStringChanges=(0,i.prop)(!1),this.mmsVCacheAggregationEnabled=(0,i.prop)(!1),this.mmsHotContentTimespan=(0,i.prop)(0),this.mmsCatV1ForwardHotOverrideEnabled=(0,i.prop)(!1),this.pttConversationWaveform=(0,i.prop)(!1),this.pttOotPlayback=(0,i.prop)(!1),this.pttPausableEnabled=(0,i.prop)(!1),this.pttPlaybackSpeedEnabled=(0,i.prop)(!1),this.pttPlaybackSpeedHideDelay=(0,i.prop)(1500),this.pttWaveformSend=(0,i.prop)(!1),this.pttRememberPlayPosition=(0,i.prop)(!1),this.pttForwardedFeaturesEnabled=(0,i.prop)(!1),this.templateDocMimeTypes=(0,i.prop)(1),this.mmsMediaKeyTTL=(0,i.prop)(1/0),this.vcardAsDocumentSizeKb=(0,i.prop)(0),this.vcardMaxSizeKb=(0,i.prop)(1e3),this.mmsVcardAutodownloadSizeKb=(0,i.prop)(1024),this.webUploadDocumentThumbMmsEnabled=(0,i.prop)(!1),this.webDownloadDocumentThumbMmsEnabled=(0,i.prop)(!1),this.webSendDocumentThumbInMessageDisabled=(0,i.prop)(!1),this.webDownloadStatusThumbMmsEnabled=(0,i.prop)(!1),this.statusVideoMaxDuration=(0,i.prop)(30),this.groupCallMaxParticipants=(0,i.prop)(0),this.webVoipMacOsMinVersion=(0,i.prop)(""),this.webVoipWindowsOsMinVersion=(0,i.prop)(""),this.ctwaContextRender=(0,i.prop)(!1),this.ctwaContextCompose=(0,i.prop)(!1),this.syncdInlineMutationsMaxCount=(0,i.prop)(1e3),this.syncdPatchProtobufMaxSize=(0,i.prop)(100),this.syncdKeyMaxUseDays=(0,i.prop)(30),this.syncdWaitForKeyTimeoutDays=(0,i.prop)(2),this.syncdAdditionalMutations=(0,i.prop)(1),this.syncdSentinelTimeoutSeconds=(0,i.prop)(3),this.syncdPatchDeviceIndexIncluded=(0,i.prop)(!1),this.syncdClearChatDeleteChatEnabled=(0,i.prop)(!1),this.syncdPinChatEnabled=(0,i.prop)(!1),this.webPaymentBackgroundEnabled=(0,i.prop)(!1),this.webBizProfileOptions=(0,i.prop)(3),this.webBizProfileEdit=(0,i.prop)(!1),this.webBizProfileV3Enabled=(0,i.prop)(!1),this.webBizProfileV3M2=(0,i.prop)(!1),this.mdBlocklistV2=(0,i.prop)(!1),this.webShopsChatHeaderButtonEnabled=(0,i.prop)(!1),this.shopsHideCatalogAttachmentEntrypoint=(0,i.prop)(!1),this.shopsHeaderDropdownMenuItem=(0,i.prop)(!1),this.shopsProductGrid=(0,i.prop)(!1),this.webListMessage=(0,i.prop)(!1),this.webCartV11OrderMessageChanges=(0,i.prop)(!1),this.webButtonsMessage=(0,i.prop)(!1),this.greenAlertBannerDuration=(0,i.prop)(0),this.webSMBUpsellInBizProfile=(0,i.prop)(!1),this.webProductListMessageFallback=(0,i.prop)(!1),this.webProductListMessage=(0,i.prop)(!1),this.webProductListMessageRenderKillSwitch=(0,i.prop)(!1),this.webProductListMessagePageSize=(0,i.prop)(s.PRODUCT_PAGE_SIZE),this.webMediaAutoDownloadEnabled=(0,i.prop)(!1),this.webYouTubePlayerEnhancements=(0,i.prop)(!1),this.webServerStickerPanel=(0,i.prop)(!1),this.webCollectionsDisplay=(0,i.prop)(!1),this.webCollectionsManagement=(0,i.prop)(!1),this.webCollectionsAppealEnabled=(0,i.prop)(!1),this.webCartOnOffToggle=(0,i.prop)(!1),this.downloadHostSwitchingEnabled=(0,i.prop)(!1),this.uploadHostSwitchingEnabled=(0,i.prop)(!1),this.isDirectConnectionForPLMTransparent=(0,i.prop)(!0),this.webPipRedesign=(0,i.prop)(!1),this.blockCatalogCreationEcommerceComplianceIndia=(0,i.prop)(!1),this.ecommerceComplianceIndia=(0,i.prop)(!1),this.editEcommerceComplianceIndia=(0,i.prop)(!1),this.smbEcommerceComplianceIndiaM4=(0,i.prop)(!1),this.smbEcommerceComplianceIndiaM4_5=(0,i.prop)(!1),this.webMdMigrationExperience=(0,i.prop)(!1),this.stickerMaker=(0,i.prop)(!1),this.webLogUploadDownloadCrashes=(0,i.prop)(!1),this.webLargeFilesUi=(0,i.prop)(!1),this.webMdMmsSyncDeletionRequest=(0,i.prop)(!0),this.webForwardingLimitToGroups=(0,i.prop)(!1)}delete(){super.delete(),this.updateProps({})}initialize(){super.initialize()}updateProps(e){let t=e;o.default.Global.webcBucket=t.bucket||null,this.__props.forEach((e=>{let n=t[e];void 0===n?n="serverPropsVersion"===e?this.serverPropsVersion:this.getDefault(e):c[e]&&(n=c[e](n),void 0===n&&(n=this.getDefault(e))),this.set(e,n)}));for(const e in a.GK.F)void 0!==t[e]&&a.GK.setFeature(e,t[e])}updateSelectiveProps(e){let t=e;o.default.Global.webcBucket=t.bucket||null,this.__props.forEach((e=>{let n=t[e];void 0!==n&&(c[e]&&(n=c[e](n),void 0===n&&(n=this.getDefault(e))),this.set(e,n))}));for(const n in a.GK.F)void 0!==t[n]&&a.GK.setFeature(n,e[n])}extendAndOverrideFromURLParams(e){const t=new l.default(window.location.search),n=e;return this.__props.forEach((e=>{if(!0===t.has(e)){const r=t.get(e);if(null==r)return;"true"===r||"false"===r?n[e]="true"===r:isNaN(r)||isNaN(parseFloat(r))?n[e]=r:n[e]=parseFloat(r)}})),n}handlePayload(e){"number"==typeof e.status&&e.status>=400||this.updateProps(e)}handle(e){const t=e.shift();this.handlePayload(t)}getGroupCallMaxParticipants(){return this.groupCallMaxParticipants}getEphemeralMessagesAllowedValues(){try{return this.ephemeralMessagesAllowedValues.split(",").map((e=>parseInt(e,10)))}catch(e){return __LOG__(4,void 0,new Error,!0)`[ephemeral] incorrect type for ephemeralMessagesAllowedValues`,SEND_LOGS("ephemeral"),[u]}}}function f(e){return h(e)}function h(e){if("number"==typeof e&&e>0)return 1024*e*1024}function _(e){if("number"==typeof e&&e>0)return e}function g(e){if("number"==typeof e)return!!e}function m(e){return Boolean(e)}t.ServerPropsImpl=p,p.Proxy="serverProps";const y=new((0,i.defineModel)(p))({id:"1"});t.ServerProps=y},68132:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(50796),i=n(92574),a=n(11290),o=n(57701),s=n(80208);const l={classic:!1,enabled:!1},c={timestamp:0};class d extends a.BaseModel{constructor(){super(...arguments),this.id=(0,a.prop)(),this.archive=(0,a.prop)(),this.disappearingMode=(0,a.prop)(),this.mdOptInDeadline=(0,a.prop)(),this.showArchiveV2=(0,a.derived)((function(){return!!this.archive.enabled&&!this.archive.classic}),["archive","enabled"])}delete(){this.set({archive:l,disappearingMode:l,mdOptInDeadline:c}),super.delete()}handleResponse(e){e.length?e.forEach((e=>{switch(__LOG__(2)`Settings: received setting type: ${e.type}`,e.type){case s.ARCHIVE_SETTINGS_KEY:var t;if(!(0,o.archiveV2Supported)()){__LOG__(4,void 0,new Error,!0)`Settings:handleResponse archive settings response is unsupported`,SEND_LOGS("archive-setting-unsupported");break}this.set({archive:{classic:e.value.classic,enabled:null!==(t=e.value.enabled)&&void 0!==t?t:this.archive.enabled}});break;case s.DISAPPEARING_MODE_SETTINGS_KEY:this.set({disappearingMode:{duration:e.value.duration,settingTimestamp:e.value.settingTimestamp}});break;case s.MD_OPT_IN_DEADLINE_SETTINGS_KEY:this.set({mdOptInDeadline:{timestamp:e.value.timestamp}})}})):__LOG__(2)`Settings: received empty settings`,n(96876).default.processMdOptInDeadline()}sync(e){const t="Settings:sync"+(e?" resume":"");__LOG__(2)`${t}`;return(0,n(56891).default.querySettings)(e).then((e=>{200===e.status?(__LOG__(2)`${t} success`,this.handleResponse(e.settings)):__LOG__(3)`${t} error receive status code ${e.status}`})).catch((0,r.filteredCatch)(i.WebdDrop,(function(){__LOG__(3)`${t} dropped`}))).catch((e=>{__LOG__(4,void 0,new Error,!0)`${t} failed with error: ${e}`,SEND_LOGS("settings-query-failed")}))}}d.Proxy="settings";var u=new((0,a.defineModel)(d))({id:"default_settings_id",archive:l,disappearingMode:{duration:0,settingTimestamp:0},mdOptInDeadline:c});t.default=u},11810:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(33856)),a=r(n(29521)),o=r(n(63105)),s=n(1255),l=n(7293),c=n(17304),d=n(59871),u=n(62583),p=n(65044);class f extends s.BaseCollection{constructor(){super(),this.syncPromise=null,this.isSynced=!1,this.listenTo(p.Socket,"change:stream",(()=>{p.Socket.stream===u.SOCKET_STREAM.DISCONNECTED&&(this.isSynced=!1)}))}onResume(){this.isSynced=!1,this.sync()}maySync(){return l.GK.supportsFeature(l.GK.F.STARRED_GIFS)}sync(){return this.isSynced?Promise.resolve():this.syncPromise?this.syncPromise:this.maySync()?(this.syncPromise=d.MsgCollection.getStarred(void 0,void 0,void 0,!0).then((e=>{let t=[];(null==e?void 0:e.length)&&(t=(0,o.default)(e,(e=>(null==e?void 0:e.isGif)&&!e.isUnsentMedia))),this.set(t)})).catch((e=>{499!==e&&__LOG__(3)`starred gif msgs sync error: `})).finally((()=>{this.syncPromise=null,this.isSynced=!0})),this.syncPromise):Promise.resolve()}add(e,t){if(!e||!this.maySync()||!this.isSynced)return[];let n=this.isModel(e)?[e]:e;return n=(0,a.default)((0,o.default)(n,(e=>e.isGif)),this.toArray(),((e,t)=>e.body===t.body)),super.add(n,t)}remove(e,t){if(!e||!this.maySync()||!this.isSynced)return[];let n=this.isModel(e)?[e]:e;return n=(0,i.default)((0,o.default)(n,(e=>e.isGif)),this.toArray(),((e,t)=>e.body===t.body)),super.remove(n,t)}}f.model=c.Msg,f.comparator=function(e,t){return t.t-e.t};var h=new f;t.default=h},19011:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.StarredMsgCollection=t.AllStarredMsgsCollection=void 0,t.addStarredMsgs=function(e){f.add(e),e.forEach((e=>{e.chat.starredMsgs&&e.chat.starredMsgs.add(e)})),d.default.add(e)},t.removeStarredMsgs=h;var i=r(n(45095)),a=n(13042),o=n(1255),s=n(17304),l=n(59871),c=n(62583),d=r(n(11810)),u=n(65044);class p extends o.BaseCollection{constructor(){super(),this.syncPromise=null,this.isSynced=!1,this.listenTo(u.Socket,"change:stream",(()=>{u.Socket.stream===c.SOCKET_STREAM.DISCONNECTED?this.isSynced=!1:u.Socket.stream===c.SOCKET_STREAM.CONNECTED&&this.delete()}))}process(e,t,n,r){r?this.delete():this.updateMsgs(e,t,n)}sync(e){if(this.isSynced)return Promise.resolve();if(null!=this.syncPromise)return this.syncPromise;const t=this;let n;const r=this.last();return r&&(n=r.id),this.syncPromise=l.MsgCollection.getStarred(e,a.PAGE_SIZE,n).then((function(e){e.length&&t.add(e,{silent:!0}),e.length<a.PAGE_SIZE&&(t.isSynced=!0)})).catch((function(){__LOG__(3)`starred msg sync error: `})).finally((()=>{t.syncPromise=null,t.trigger("sync")})),this.trigger("sync"),(0,i.default)(this.syncPromise,"syncPromise can not be null")}updateMsgs(e,t,n){const r=this.syncPromise||Promise.resolve();this.syncPromise=r.then((()=>{if(e){return(t.length>0?l.MsgCollection.incrementalStarredUpdate(t):Promise.resolve([])).then((e=>{const t=e.concat(n);this.isSynced&&(this.add(t,{silent:!0}),d.default.add(e)),t.forEach((e=>{e.chat.starredMsgs&&e.chat.starredMsgs.add(e)})),this.trigger("sync")})).catch((()=>{__LOG__(3)`models:starred:update:error: `}))}h(t.concat(n).filter((e=>!e.star)))})).finally((()=>{this.syncPromise=null}))}delete(){this.isSynced=!1,super.delete()}}let f;function h(e){f.remove(e),e.forEach((e=>{e.chat.starredMsgs&&e.chat.starredMsgs.remove(e)}))}t.StarredMsgCollection=p,p.model=s.Msg,p.comparator=(e,t)=>t.t-e.t,t.AllStarredMsgsCollection=f,t.AllStarredMsgsCollection=f=new p},67234:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(89867)),a=n(11290);class o extends a.BaseModel{constructor(){super(...arguments),this.id=(0,a.prop)(),this.status=(0,a.prop)(),this.stale=(0,a.session)(!0)}getCollection(){return n(46133).StatusCollection}}o.Proxy="status",o.idClass=i.default;var s=(0,a.defineModel)(o);t.default=s},46133:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.StatusCollectionImpl=t.StatusCollection=void 0;var i=n(50796),a=n(92574),o=r(n(89867)),s=n(45454),l=n(1255),c=r(n(67234)),d=n(44334);class u extends l.BaseCollection{onResume(){this.filter((e=>e.hasObservers())).forEach((e=>{this.find(e.id).catch((0,i.filteredCatch)(a.WebdDrop,(()=>{})))}))}_find(e){const t=e instanceof o.default?e:(0,s.createWid)(e);return(0,d.getStatus)(t)}handle(e){let[t]=e;const n=this.get(t.id);n&&(n.status=t.status,n.stale=!1)}}t.StatusCollectionImpl=u,u.model=c.default,u.idClass=o.default,u.staleCollection=!0,u.resumeOnAvailable=!0;const p=new u;t.StatusCollection=p},32591:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getPSACampaigns=a,t.getPsaCampaignIndex=function(e,t){if(0===t.length)return-1;let n=0,r=t[0].campaignId;for(let i=1;i<t.length;i++){const{id:a,campaignId:o}=t[i];if(r!==o?(r=o,n=0):n++,a.toString()===e.toString())return n}return-1},t.getPsaCampaignsString=function(e){const t=a(e),n=[];return Object.keys(t).forEach((e=>{const r=t[e],{numberOfStatus:i,numberOfReadStatus:a}=r;n.push(`${e}:${i-a}`)})),n.join(",")},t.isCampaignExpired=o,t.isExpiredStatusPSA=function(e,t){const n=a(e);return Object.keys(n).every((e=>o(n[e],t)))};var r=n(92844),i=n(40234);function a(e){const t={};return e.forEach((e=>{let{t:n,campaignId:r,campaignDuration:i,statusPSAReadTimestamp:a}=e;if(!r)return;t[r]||(t[r]={id:r,t:n,duration:i,firstReadTimestamp:null,numberOfStatus:0,numberOfReadStatus:0});const o=t[r];o.numberOfStatus++,null!=a&&(o.numberOfReadStatus++,(null==o.firstReadTimestamp||a<o.firstReadTimestamp)&&(o.firstReadTimestamp=a))})),t}function o(e,t){const n=e.firstReadTimestamp;if(null!=n)return(0,r.castToUnixTime)(i.Clock.globalUnixTime()-n)>t;const a=e.duration;return null!=a&&i.Clock.globalUnixTime()-e.t>a}},47896:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(48926)),a=r(n(85074)),o=n(40234),s=n(13042),l=r(n(89867)),c=n(11290),d=n(19380),u=n(46898),p=n(32591),f=r(n(58492));const h=86400;class _ extends f.default{constructor(){super(...arguments),this.id=(0,c.prop)(),this.t=(0,c.prop)(),this.unreadCount=(0,c.prop)(0),this.totalCount=(0,c.prop)(0),this.pic=(0,c.prop)(),this._msgs=(0,c.prop)((()=>[])),this.readKeys=(0,c.session)((()=>({}))),this.contact=(0,c.session)(),this.expireTimer=(0,c.session)(),this.expireTs=(0,c.session)(),this.hasUnread=(0,c.derived)((function(){return this.unreadCount>0}),["unreadCount"]),this.readCount=(0,c.derived)((function(){const e=this.totalCount-this.unreadCount;return Number.isFinite(e)?e:(__LOG__(3)`Bad status v3 read count, ${this.totalCount}, ${this.unreadCount}`,0)}),["unreadCount","totalCount"]),this.lastStatus=(0,c.derived)((function(){return this.msgs.last()}),["msgsChanged","totalCount"])}initialize(){super.initialize(),this.addChild("contact",d.ContactCollection.gadd(this.id)),this.listenTo(this.msgs,"add bulk_add",(()=>{window.setTimeout((()=>{this.setupStatusExpiration()}))})),this.listenTo(this,"change:lastStatus",(()=>{this.lastStatus&&(this.t=this.lastStatus.t)}))}isExpired(){return this.id.isPSA()?(0,p.isExpiredStatusPSA)(this.msgs.toArray(),h):o.Clock.globalUnixTime()-this.t>h}setupStatusExpiration(){const e=this.msgs.at(0);if(!e)return;if("number"==typeof this.expireTs&&this.expireTs<=e.t)return;const t=e.t+h+1;t<o.Clock.globalUnixTime()?window.setTimeout((()=>{this.expireMsg()})):(this.expireTimer=a.default.setGlobalTimeout(this.expireMsg.bind(this),1e3*t,this.expireTimer),this.expireTs=e.t)}_removeSingleMsg(e){const t=this.msgs;this.unreadCount>this.totalCount-1&&this.unreadCount--,this.totalCount--,t.remove(e),e.delete()}expireMsg(){if(this.id.isPSA())return void this.expirePSAMsg();const e=this.msgs;for(;e.length>0;){const t=e.at(0);if(!t)break;if(t.t+h>o.Clock.globalUnixTime())break;this._removeSingleMsg(t)}this.expireTs=void 0,this.expireTimer=void 0,0!==this.totalCount&&this.setupStatusExpiration()}expirePSAMsg(){const e=(0,p.getPSACampaigns)(this.msgs.toArray());this.msgs.forEach((t=>{const{campaignId:n}=t;if(null==n)return;(0,p.isCampaignExpired)(e[n],h)&&this._removeSingleMsg(t)})),this.expireTs=void 0,this.expireTimer=void 0,0!==this.totalCount&&this.setupStatusExpiration()}revokeMsgs(e){const t=new Set(e);this.msgs.filter((e=>t.has(e.id.toString()))).forEach((e=>this._removeSingleMsg(e))),0===this.totalCount&&(this.expireTs=void 0,this.expireTimer=void 0)}delete(){__LOG__(2)`Status v3 deleted with total count: ${this.totalCount}`,super.delete(),this.expireTimer&&a.default.clearTimeout(this.expireTimer),null!=this.expireTs&&(this.expireTs=void 0),this.getCollection().remove(this.id)}onEmptyMRM(){__LOG__(2)`Status V3 onEmptyMRM with total count: ${this.totalCount}, noEarlierMsgs: ${this.msgs.msgLoadState.noEarlierMsgs?"true":"false"}`,this.msgs.msgLoadState.noEarlierMsgs&&0===this.totalCount?this.delete():this.totalCount>0&&this.loadMore().catch((()=>{})).finally((()=>{this.msgs.length||this.delete()}))}loadMore(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s.PAGE_SIZE;return(0,i.default)((function*(){if(e.msgs.msgLoadState.noEarlierMsgs)return Promise.resolve();if(e.msgs.msgLoadState.isLoadingEarlierMsgs)return e.msgs.loadEarlierPromise;const n=0!==t?t:s.PAGE_SIZE,r=e.getCollection();try{const t=yield r.loadMore(e.id,n,e.msgs.last());return Array.isArray(t)&&t.length<n&&(e.msgs.msgLoadState.noEarlierMsgs=!0),t}catch(t){return 404===t&&e.delete(),Promise.reject(t)}}))()}handleReadStatus(e){this.readKeys[e]||(this.readKeys[e]=!0,this.unreadCount>0&&this.unreadCount--)}sendReadStatus(e,t,n){var r=this;return(0,i.default)((function*(){(yield(0,u.sendReadStatus)(e,t,n))&&r.handleReadStatus(e)}))()}getCollection(){return n(59387).StatusV3Collection}}_.Proxy="statusV3",_.idClass=l.default;var g=(0,c.defineModel)(_);t.default=g},59387:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.StatusV3CollectionImpl=t.StatusV3Collection=void 0;var i=r(n(48926)),a=r(n(41609)),o=r(n(63105)),s=r(n(35161)),l=r(n(12297)),c=n(50796),d=n(52230),u=n(92574),p=n(88555),f=n(40234),h=n(45454),_=n(57849),g=n(1255),m=n(99234),y=n(7293),E=r(n(11339)),S=n(59871),v=r(n(34949)),T=n(46898),b=r(n(47896));class C extends g.BaseCollection{delete(){super.delete(),delete this.checksum}_find(e){return Promise.resolve({id:e})}findQuery(e,t){var n=()=>super.findQuery,r=this;return(0,i.default)((function*(){const i=(yield n().call(r,e,t))||[];return yield Promise.all(i.map((e=>{if(!e)return;let t=0;return e.msgs.forEach((n=>{t<e._msgs.length&&e._msgs[t].id.toString()===n.id.toString()?++t:n.delete()})),e._msgs.length>0?r.addStatusMessages(e.id,e._msgs):Promise.resolve()}))),i}))()}_findQuery(){var e=this;return(0,i.default)((function*(){const t=yield(0,T.queryStatusAll)();return e.checksum=t.checksum,Promise.all(t.statuses.map((e=>{e.totalCount!==e._msgs.length&&e.totalCount<=20&&__LOG__(3)`Received ${e._msgs.length} status V3 messages when total count is ${e.totalCount} for ${e.id}`;const t=e.pic;return t?v.default.createFromData(t,"image/jpeg").then((t=>(e.pic=t,e))):e})))}))()}loadMore(e,t,n){return(0,i.default)((function*(){const r=yield(0,T.queryStatusUpdate)(e,t,null==n?void 0:n.id);return r.status>=400?(__LOG__(3)`model:statusv3:findQuery error ${r.status}`,Promise.reject(r.status)):(r.forEach((function(e){e.invis=!0})),__LOG__(2)`model:statusv3:loadMore:${r.length}`,S.MsgCollection.processMultipleMessages((0,h.createWid)(d.STATUS_JID),r,{add:"after",isHistory:!0}))}))()}sync(e){const t=window.performance.now();return!e||this.checksum&&this.checksum!==e?this.findQuery({},{set:this.hasSynced()}).catch((0,c.filteredCatch)(u.WebdDrop,(()=>{}))).finally((()=>{this.trigger("sync")})).then((e=>{const n=window.performance.now(),r=Math.round(n-t);return this.logMetrics({type:"sync",syncTime:r}),this.forEach((e=>{e.msgs.length>e.totalCount&&__LOG__(2)`Total count: ${e.totalCount}, msgs length: ${e.msgs.length}`})),e})):Promise.resolve(void 0)}logMetrics(e){let t;t="sync"===e.type?new E.default.WebcStatusSync({webcStatusSyncT:e.syncTime}):new E.default.WebcStatusSession({webcStatusSessionId:e.sessionId});const n=this.filter((e=>!e.contact.isMe)),r=n.filter((e=>!e.contact.statusMute)),i=r.filter((e=>e.hasUnread)),a=r.filter((e=>!e.hasUnread)),o=n.filter((e=>e.contact.statusMute)),s=(0,l.default)(r.map((e=>e.unreadCount))),c=(0,l.default)(r.map((e=>e.readCount))),d=(0,l.default)(o.map((e=>e.totalCount)));t.webcStatusRecentItemCount=s,t.webcStatusRecentRowCount=i.length,t.webcStatusViewedItemCount=c,t.webcStatusViewedRowCount=a.length,t.webcStatusMutedItemCount=d,t.webcStatusMutedRowCount=o.length,t.commit()}hasSynced(){return!!(0,p.isMDBackend)()||!!this.checksum}handleUpdate(e,t,n){const r=e.id.fromMe?(0,m.getMaybeMeUser)():e.author;if(this.updateChecksum(t),this.hasSynced()){if(n)return!0;const t=this.get(r);if(t){const n=y.GK.supportsFeature(y.GK.F.MD_BACKEND)||t.totalCount===t.msgs.length;if("sender_revoke"===e.subtype){const n=t.msgs.toArray().slice(0,t.totalCount-t.unreadCount),r=(0,s.default)(n,(e=>e.id.toString())),i={totalCount:t.totalCount-1};r.find((t=>t===e.protocolMessageKey.toString()))||t.readKeys[e.protocolMessageKey.toString()]||(i.unreadCount=t.unreadCount-1),t.set(i)}else{const n={totalCount:t.totalCount+1};e.invis||(n.unreadCount=t.unreadCount+1),n.t=e.t,t.set(n)}return!n&&e.body&&v.default.createFromBase64Jpeg(e.body).then((e=>{t.pic=e})),n}return this.add({id:r,t:e.t,unreadCount:e.invis?0:1,totalCount:1}),!0}return!1}updateChecksum(e){e?this.hasSynced()&&(this.checksum=e):__LOG__(2)`models:statusV3:no_checksum`}handle(e){const t=e.shift();if(Array.isArray(t))__LOG__(3)`models:statusV3:unexpected update`;else switch(t.type){case"read":this.updateChecksum(t.checksum);const e=this.get(t.chat);e?e.handleReadStatus(t.key):__LOG__(2)`models:statusV3:read:no_status:${[t.chat,t.key].join()}`;break;default:__LOG__(3)`models:statusV3:unknown:${t.type}`}}addStatusMessages(e,t){return S.MsgCollection.processMultipleMessages((0,h.createWid)(d.STATUS_JID),t,{add:"after",isHistory:!0})}getUnexpired(e){let t=!1;(0,p.isMDBackend)()&&(t=(0,_.getABPropConfigValue)("web_status_psa"));const n=this.filter((e=>!(e.totalCount<=0)&&(!e.isExpired()&&(!e.contact.isMe&&(!!e.contact.isMyContact||!!e.contact.isPSA&&t)))));if(t&&n.sort(((e,t)=>e.contact.isPSA===t.contact.isPSA?0:e.contact.isPSA?-1:1)),e){return(0,o.default)(n,(e=>e.unreadCount>0))}return(0,o.default)(n,(e=>0===e.unreadCount))}getMyStatus(){const e=this.filter((e=>e.contact.isMe));if(!((0,a.default)(e)||f.Clock.globalUnixTime()-e[0].t>86400))return e[0]}getPSAStatus(){const e=this.filter((e=>e.contact.isPSA));if(0!==e.length)return e[0]}}t.StatusV3CollectionImpl=C,C.model=b.default,C.comparator=(e,t)=>t.t-e.t;const A=new C;t.StatusV3Collection=A},77040:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(11290);class i extends r.BaseModel{constructor(){super(...arguments),this.id=(0,r.prop)(),this.sticker=(0,r.prop)(),this.timestamp=(0,r.prop)(),this.stickerHashWithoutMeta=(0,r.prop)()}}i.Proxy="favoriteSticker";var a=(0,r.defineModel)(i);t.default=a},70723:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(48926)),a=n(40234),o=n(30764),s=n(1255),l=r(n(77069)),c=r(n(77040)),d=n(55975),u=n(76214),p=n(99718);class f extends s.BaseCollection{_addSaveTask(){this._idleTaskId&&o.IdleCallbackTasks.isInQueue(this._idleTaskId)||(this._idleTaskId=o.IdleCallbackTasks.enqueue((()=>{this._saveToDb()})))}_saveToDb(){var e=this;return(0,i.default)((function*(){const t=e.toArray().map((e=>{const t=e.sticker.toDbData();return{id:e.id,timestamp:e.timestamp,sticker:{index:t.index,width:t.width,height:t.height,size:t.size,mimetype:t.mimetype,filehash:t.filehash,directPath:t.directPath,mediaKey:t.mediaKey,mediaKeyTimestamp:t.mediaKeyTimestamp,encFilehash:t.encFilehash,deprecatedMms3Url:t.deprecatedMms3Url,type:"sticker"},stickerHashWithoutMeta:e.stickerHashWithoutMeta}}));try{const e=(0,u.getFavoriteStickersTable)();yield e.clear(),yield e.bulkCreateOrReplace(t)}catch(e){__LOG__(4,void 0,new Error,!0)`FavoriteStickerCollection attempt to save to database failed`,SEND_LOGS(e)}}))()}_dbDataToModel(e){return new c.default({id:e.id,timestamp:e.timestamp,stickerHashWithoutMeta:e.stickerHashWithoutMeta,sticker:new p.StickerModel(e.sticker)})}_getStickerHashWithoutMeta(e){return(0,i.default)((function*(){const t=yield d.LruMediaStore.get(e);return null==t?e:(0,l.default)(t)}))()}addNewSticker(e){var t=this;return(0,i.default)((function*(){if(t.get(e.filehash))return;const n=new c.default({id:e.filehash,sticker:e,stickerHashWithoutMeta:yield t._getStickerHashWithoutMeta(e.filehash),timestamp:a.Clock.globalUnixTime()});t.add(n),t._addSaveTask()}))()}removeAndSave(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=this.remove(e,t);return n.length&&this._addSaveTask(),n}initializeFromCache(e){const t=e.map((e=>this._dbDataToModel(e)));this.add(t),this._addSaveTask()}}f.model=c.default;var h=new f;t.default=h},14048:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return(0,r.getABPropConfigValue)("web_sticker_store")};var r=n(57849)},20238:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(11290);class i extends r.BaseModel{constructor(){super(...arguments),this.id=(0,r.prop)(),this.sticker=(0,r.prop)(),this.timestamp=(0,r.prop)(),this.msgId=(0,r.prop)()}}i.Proxy="recentSticker";var a=(0,r.defineModel)(i);t.default=a},91692:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.RecentStickerCollectionImpl=t.RecentStickerCollection=t.RECENT_STICKERS_LIMIT=void 0;var i=r(n(48926)),a=r(n(81109)),o=r(n(6479)),s=r(n(78403)),l=r(n(45095)),c=n(88555),d=n(1255),u=n(17239),p=n(57701),f=n(99718),h=r(n(56891));const _=["weight"],g=32;t.RECENT_STICKERS_LIMIT=g;class m extends d.BaseCollection{constructor(){super(...arguments),this._checksum="",this._syncStatus="NONE",this._weightMap=new Map,this._sortTrimScale=()=>{const e=this.length;if(!e)return;if(this.sort(),e>g){for(let t=g;t<e;t++)this._weightMap.delete((0,l.default)(this.at(t),"this.at(i)").id);this.remove(this.models.slice(g))}const t=this.head(),n=this.last();t&&n&&this._getWeight(t)<10&&this._getWeight(n)>.01||this.forEach(((t,n)=>{this._weightMap.set(t.id,1+(e-n)/e*3)}))}}_comparator(e,t){return u.Conn.platform===u.PLATFORMS.ANDROID?this._getWeight(t)-this._getWeight(e):e.index>t.index?1:-1}_getWeight(e){return(0,l.default)(this._weightMap.get(e.id),"this._weightMap.get(sticker.id)")}_findQuery(){return(0,p.isRecentStickersEnabled)()?(0,c.isMDBackend)()?Promise.reject(new Error("This call is only supported in non-MD mode")):h.default.queryRecentStickers().then((e=>{let{checksum:t,stickers:n}=e;return this.setChecksum(t),u.Conn.platform===u.PLATFORMS.ANDROID&&(this._weightMap.clear(),n.forEach((e=>{let{id:t,weight:n}=e;this._weightMap.set(t,n)}))),n.map(((e,t)=>{let{weight:n}=e,r=(0,o.default)(e,_);return(0,a.default)((0,a.default)({},r),{},{mediaKey:(0,s.default)(r.mediaKey),index:t})}))})):Promise.reject(new Error("gk recent sticker sync unsupported"))}enqueue(e){(0,p.isRecentStickersEnabled)()&&0!==e.length&&(u.Conn.platform===u.PLATFORMS.ANDROID?this._enqueueAndroid(e):this._enqueueiOS(e))}addStickerWithMediaData(e){const t=new f.StickerModel(e);t.id||(t.id=t.filehash),this.enqueue([t])}_enqueueAndroid(e){e.forEach((e=>{this.get(e.id)||(this._weightMap.set(e.id,0),this.add(e)),this.forEach((t=>{let n=this._getWeight(t);t.id===e.id?n+=1:n*=.9,this._weightMap.set(t.id,Math.round(1e3*n)/1e3)}))})),this._sortTrimScale()}_enqueueiOS(e){this.forEach(((e,t)=>{e.index=g+t}));const t=new Set(e.map((e=>e.id)));e.reduce(((e,n)=>t.has(n.id)?(t.delete(n.id),[n].concat(e)):e),[]).slice(0,g).forEach(((e,t)=>{const n=this.get(e.id);n?n.index=t:this.add({id:e.id,deprecatedMms3Url:e.deprecatedMms3Url,directPath:e.directPath,filehash:e.filehash,encFilehash:e.encFilehash,mediaKey:e.mediaKey,mediaKeyTimestamp:e.mediaKeyTimestamp,width:e.width,height:e.height,size:e.size,mimetype:e.mimetype,type:e.type,index:t})})),this.sort(),this.remove(this.slice(g))}setChecksum(e){this._checksum=e}sync(e){var t=this;return(0,i.default)((function*(){(0,p.isRecentStickersEnabled)()&&(null!=e&&e===t._checksum||(yield t._sync()))}))()}_sync(){var e=this;return(0,i.default)((function*(){if("INPROGRESS"!==e._syncStatus){e._syncStatus="INPROGRESS";try{yield e.findQuery({},{set:!0}),e.sort(),e._syncStatus="SUCCESS"}catch(t){__LOG__(3)`collection:recent_sticker:_sync error `,e._syncStatus="FAILURE"}}}))()}isSynced(){return"SUCCESS"===this._syncStatus||"FAILURE"===this._syncStatus}reset(){return this._syncStatus="NONE",this._weightMap.clear(),super.reset()}}t.RecentStickerCollectionImpl=m,m.model=f.StickerModel;const y=new m;t.RecentStickerCollection=y},49264:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.RecentStickerCollectionMd=t.RecentStickerCollection=t.RECENT_STICKERS_LIMIT=void 0;var i=r(n(48926)),a=n(40234),o=n(30764),s=n(1255),l=n(88297),c=n(76214),d=n(59871),u=r(n(20238)),p=n(99718);t.RECENT_STICKERS_LIMIT=32;class f extends s.BaseCollection{constructor(){super(...arguments),this._hasInitializedFromCache=!1}_comparator(e,t){return e.timestamp<t.timestamp?1:-1}_dbDataToModel(e){return new u.default({id:e.id,timestamp:e.timestamp,msgId:e.msgId,sticker:new p.StickerModel(e.sticker)})}_addSaveTask(){this._idleTaskId&&o.IdleCallbackTasks.isInQueue(this._idleTaskId)||(this._idleTaskId=o.IdleCallbackTasks.enqueue((()=>{this._saveToDb()})))}_saveToDb(){var e=this;return(0,i.default)((function*(){const t=e.toArray().map((e=>{const t=e.sticker.toDbData();return{id:e.id,timestamp:e.timestamp,msgId:e.msgId,sticker:{id:t.id,index:t.index,width:t.width,height:t.height,size:t.size,mimetype:t.mimetype,filehash:t.filehash,directPath:t.directPath,mediaKey:t.mediaKey,mediaKeyTimestamp:t.mediaKeyTimestamp,encFilehash:t.encFilehash,deprecatedMms3Url:t.deprecatedMms3Url,type:"sticker"}}}));try{const e=(0,c.getRecentStickersTable)();yield e.clear(),yield e.bulkCreateOrReplace(t)}catch(e){__LOG__(4,void 0,new Error,!0)`RecentStickerCollection attempt to save to database failed`,SEND_LOGS(e)}}))()}addStickerWithMediaData(e,t){this.addNewSticker(new p.StickerModel(e),t)}addNewSticker(e,t){e.id||(e.id=e.filehash),this.enqueue([[e,a.Clock.globalUnixTime(),t]])}enqueue(e){if(0===e.length)return;const t=new Set(e.map((e=>e[0].id))),n=e.reduce(((e,n)=>{let[r,i,a]=n;return t.has(r.id)?(t.delete(r.id),[[r,i,a]].concat(e)):e}),[]),r=[];let i=!1;n.forEach((e=>{let[t,n,a]=e;const o=this.get(t.id);if(o)o.timestamp<=n&&(o.timestamp=n,i=!0);else{const e=this._dbDataToModel({id:t.id,timestamp:n,sticker:{id:t.id,index:t.index,width:t.width,height:t.height,size:t.size,mimetype:t.mimetype,filehash:t.filehash,directPath:t.directPath,mediaKey:t.mediaKey,mediaKeyTimestamp:t.mediaKeyTimestamp,encFilehash:t.encFilehash,deprecatedMms3Url:t.deprecatedMms3Url,type:"sticker"},msgId:a});r.push(e),i=!0}})),i&&(this.addAndSort(r),this._hasInitializedFromCache&&this._addSaveTask())}updateDirectPath(e,t){const n=this.get(e);(null==n?void 0:n.sticker)?(n.sticker.directPath=t,this.set([n],{remove:!1,add:!1,silent:!0,sort:!1}),this._addSaveTask()):__LOG__(4,void 0,new Error)`updateDirectPaths called with a stickerId that doesn't match any in the collection`}updateStickerMediaData(e,t){const n=this.get(e);null!=t&&null!=n&&(t.directPath&&(n.sticker.directPath=t.directPath),t.encFilehash&&(n.sticker.encFilehash=t.encFilehash),t.mediaKey&&(n.sticker.mediaKey=t.mediaKey),t.mediaKeyTimestamp&&(n.sticker.mediaKeyTimestamp=t.mediaKeyTimestamp),this.set([n],{remove:!1,add:!1,silent:!0,sort:!1}),this._addSaveTask())}stickersMissingDirerctPath(e){return e.filter((e=>null==e.sticker.directPath))}associateStickerWithMsg(e,t){return(0,i.default)((function*(){var n;const{messages:r}=yield d.MsgCollection.getMessagesById([t]),i=(null===(n=e.mediaObject)||void 0===n?void 0:n.associatedMsgs())||[];!e.mediaObject||0!==i.length&&r.some((e=>i.includes(e)))||(0,l.associateMediaWithMsg)(e.mediaObject,r[r.length-1])}))()}initializeFromCache(e){const t=e.map((e=>{const t=this._dbDataToModel(e);return this.associateStickerWithMsg(t.sticker,t.msgId),t})),n=this.toArray();if(this.addAndSort(t),n.length){const e=new Set(t.map((e=>e.id)));n.some((t=>e.has(t)))&&this._addSaveTask()}this._hasInitializedFromCache=!0}addAndSort(e){this.add(e),this.sort(),this.length>32&&this.set(this.toArray().slice(0,32))}removeAndSave(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=this.remove(e,t);return n.length&&this._addSaveTask(),n}delete(){super.delete()}}t.RecentStickerCollection=f,f.model=u.default;const h=new f;t.RecentStickerCollectionMd=h},16774:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.StarredStickerCollectionImpl=t.StarredStickerCollection=t.STARRED_STICKERS_PAGE_SIZE=void 0;var i=r(n(48926)),a=r(n(81109)),o=r(n(78403)),s=n(88555),l=n(1255),c=n(57701),d=n(99718),u=r(n(56891));t.STARRED_STICKERS_PAGE_SIZE=24;class p extends l.BaseCollection{constructor(){super(...arguments),this._checksum="",this._syncStatus="NONE",this._currentPage=0,this._total=0}_findQuery(){return(0,c.isStarredStickersEnabled)()?(0,s.isMDBackend)()?Promise.reject(new Error("This call is only supported in non-MD mode")):u.default.queryStarredStickers(this._currentPage+1,24).then((e=>{let{checksum:t,total:n,stickers:r}=e;return this._checksum=t,this._currentPage+=1,this._total=n,r.map(((e,t)=>(0,a.default)((0,a.default)({},e),{},{mediaKey:(0,o.default)(e.mediaKey),index:this.length+t})))})):Promise.reject(new Error("gk starred sticker sync unsupported"))}add(e,t,n){return n&&(this._total+=1),super.add(e,t)}remove(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this._total-=1,super.remove(e,t)}syncNextPage(){return this.canLoadMore()?this._sync(!1).then((()=>{this.trigger("next_page_sync")})):Promise.resolve()}sync(e){return(0,c.isStarredStickersEnabled)()&&(null==e||e!==this._checksum)?(this.reset(),this._sync(!0).then((()=>{this.trigger("sync")}))):Promise.resolve()}_sync(e){var t=this;return(0,i.default)((function*(){if("INPROGRESS"===t._syncStatus)return Promise.resolve();t._syncStatus="INPROGRESS";try{yield t.findQuery({},{set:e}),t._syncStatus="SUCCESS"}catch(e){__LOG__(3)`collection:starred_sticker:_sync error `,t._syncStatus="FAILURE"}}))()}isSynced(){return"SUCCESS"===this._syncStatus||"FAILURE"===this._syncStatus}canLoadMore(){return 0!==this._total&&this.length<this._total}getRemaining(){return this._total-this.length}reset(){return this._syncStatus="NONE",this._currentPage=0,this._checksum="",this._total=0,super.reset()}}t.StarredStickerCollectionImpl=p,p.model=d.StickerModel,p.comparator=(e,t)=>e.index>=t.index?1:-1;const f=new p;t.StarredStickerCollection=f},99718:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.StickerModel=t.Sticker=void 0;var i=r(n(51463)),a=n(40234),o=n(11290),s=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=d(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(78986)),l=r(n(2320)),c=n(58668);function d(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(d=function(e){return e?n:t})(e)}const u=(0,i.default)((()=>new h({id:"placeholder",isPlaceholder:!0}))),p=(0,i.default)((()=>new h({id:"createButton",isCreateButton:!0})));class f extends o.BaseModel{constructor(){super(...arguments),this.id=(0,o.prop)(),this.mediaData=(0,o.session)(),this.mediaObject=(0,o.prop)(),this.deprecatedMms3Url=(0,o.prop)(),this.directPath=(0,o.prop)(),this.filehash=(0,o.prop)(),this.height=(0,o.prop)(),this.index=(0,o.prop)(),this.mediaKey=(0,o.prop)(),this.mediaKeyTimestamp=(0,o.prop)(),this.mimetype=(0,o.prop)(),this.size=(0,o.prop)(),this.type=(0,o.prop)(c.OUTWARD_TYPES.STICKER),this.encFilehash=(0,o.prop)(),this.width=(0,o.prop)(),this.stickerPackId=(0,o.prop)(),this.stickerPackName=(0,o.prop)(),this.stickerPackPublisher=(0,o.prop)(),this.isPlaceholder=(0,o.prop)(),this.isCreateButton=(0,o.prop)()}initialize(){super.initialize(),this.addChild("mediaData",new l.default),this.isPlaceholder||this.isCreateButton||s.registerSticker(this)}downloadMedia(){return s.downloadStickerOrStickerPackIcon(this,"STICKER").catch((e=>{__LOG__(4,void 0,new Error,!0)`id: ${this.id}, error: ${String(e.stack||e)}`,SEND_LOGS("sticker-panel:sticker download failed")}))}toDbData(){return{id:this.id||this.filehash,index:this.index||0,width:this.width,height:this.height,size:this.size,mimetype:this.mimetype,filehash:this.filehash,directPath:this.directPath,mediaKey:this.mediaKey,mediaKeyTimestamp:null!=this.mediaKeyTimestamp?this.mediaKeyTimestamp:a.Clock.globalUnixTime(),encFilehash:this.encFilehash,deprecatedMms3Url:this.deprecatedMms3Url,type:c.OUTWARD_TYPES.STICKER}}delete(){super.delete(),s.deregisterSticker(this)}}t.Sticker=f,f.Proxy="sticker",f.getPlaceholder=u,f.getCreateButton=p;const h=(0,o.defineModel)(f);t.StickerModel=h,h.getPlaceholder=u},67963:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StickerCollectionImpl=t.StickerCollection=t.FETCH_STATE=void 0;var r=n(1255),i=n(99718);t.FETCH_STATE={PENDING:"PENDING",SUCCESS:"SUCCESS",ERROR:"ERROR"};class a extends r.BaseCollection{fetch(){throw new Error(`${this.constructor.name}.fetch is not implemented`)}}t.StickerCollectionImpl=a,a.model=i.StickerModel;const o=new a;t.StickerCollection=o},74470:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.StickerPackModel=t.StickerPack=t.PRE_PLACEHOLDER_ID=void 0;var i=n(11290),a=r(n(2320)),o=n(58668),s=r(n(63488));const l="placeholder:";t.PRE_PLACEHOLDER_ID=l;const c=e=>{let{index:t,page:n}=e;return new u({id:`placeholder:${t}`,index:t,page:n})};class d extends i.BaseModel{constructor(){super(...arguments),this.id=(0,i.prop)(),this.index=(0,i.prop)(),this.name=(0,i.prop)(),this.page=(0,i.prop)(),this.url=(0,i.prop)(),this.mimetype=(0,i.prop)("image/png"),this.mediaData=(0,i.session)(),this.mediaObject=(0,i.prop)(),this.directPath=(0,i.prop)(),this.filehash=(0,i.prop)(),this.mediaKey=(0,i.prop)(),this.mediaKeyTimestamp=(0,i.prop)(),this.size=(0,i.prop)(),this.type=(0,i.prop)(o.OUTWARD_TYPES.IMAGE),this.encFilehash=(0,i.prop)(),this.deprecatedMms3Url=(0,i.derived)((function(){return this.isFirstParty?"":this.url}),["isFirstParty"]),this.stickers=(0,i.derived)((function(){return this._stickers=this._stickers||new s.default(this.id.split("#")[0],this.isFirstParty),this._stickers}),["id"]),this.isPlaceholder=(0,i.derived)((function(){return d.isPlaceholderId(this.id)}),["id"]),this.isFirstParty=(0,i.derived)((function(){return Boolean(this.url)&&!this.mediaKey}),["url","mediaKey"])}initialize(){super.initialize(),this.isPlaceholder||this.isFirstParty||(this.addChild("mediaData",new a.default({renderableUrl:""})),n(78986).registerStickerPackIcon(this))}downloadMedia(){return this.isPlaceholder||this.isFirstParty?Promise.resolve():n(78986).downloadStickerOrStickerPackIcon(this,"STICKER_PACK").catch((e=>{__LOG__(4,void 0,new Error,!0)`id: ${this.id}, error: ${String(e.stack||e)}`,SEND_LOGS("sticker-panel:sticker-pack download failed")}))}delete(){super.delete(),n(78986).deregisterStickerPackIcon(this)}}t.StickerPack=d,d.Proxy="stickerPack",d.createPlaceholder=c,d.isPlaceholderId=e=>new RegExp("^placeholder:").test(e);const u=(0,i.defineModel)(d);t.StickerPackModel=u,u.createPlaceholder=c,u.isPlaceholderId=d.isPlaceholderId},66299:(e,t,n)=>{"use strict";var r=n(59182).default,i=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.StickerPackCollectionImpl=t.StickerPackCollection=t.PAGE_SIZE_POPUP=t.PAGE_SIZE_COMPOSE_BOX=t.PAGE_FETCH_STATE=void 0;var a=i(n(81109)),o=i(n(48926)),s=i(n(98913)),l=i(n(78718)),c=n(89385),d=i(n(47259)),u=n(1255),p=n(74470),f=i(n(56891));t.PAGE_SIZE_COMPOSE_BOX=9;t.PAGE_SIZE_POPUP=6;const h={PENDING:"PENDING",SUCCESS:"SUCCESS",ERROR:"ERROR"};t.PAGE_FETCH_STATE=h;class _ extends u.BaseCollection{constructor(){super(),this.checksum=null,this._pageFetchRequests={},this.pageFetchStates={},this._handleChecksumChange=()=>{Object.keys(this.pageFetchStates).forEach((e=>this._resetFetchPageStateAndPromise(parseInt(e,10)))),this._resetRangeWithPlaceholders(0,this.length),this.fetchAt(0,!1,!0)},this.listenTo(this,"change:checksum",this._handleChecksumChange)}createPlaceholder(e){return _.createPlaceholder(e)}preFetch(){var e=this;return(0,o.default)((function*(){yield e.fetchAt(0).then((()=>Promise.all(e.filter((e=>e.isFirstParty)).map((e=>e.stickers.fetch())))))}))()}fetchAt(e,t,n){return this._fetchPageWithIndex(e,Boolean(t),Boolean(n))}hasFetchedData(){return Object.keys(this.pageFetchStates).some((e=>this.pageFetchStates[parseInt(e,10)]===h.SUCCESS))}isFetchingData(){return Object.keys(this.pageFetchStates).some((e=>this.pageFetchStates[parseInt(e,10)]===h.PENDING))}pageWithIndex(e){return _.pageWithIndex(e)}reset(){return this.setChecksum(null,{silent:!0}),Object.keys(this.pageFetchStates).forEach((e=>this._resetFetchPageStateAndPromise(parseInt(e,10)))),super.reset()}sync(e){this.setChecksum(e)}setChecksum(e,t){if(this.checksum!==e){this.checksum=e;return(null==t?void 0:t.silent)||this.trigger("change:checksum",e),!0}return!1}_fetchPageWithIndex(e,t,n){const r=this.pageWithIndex(e);return this._fetchPage(r,t,n)}_fetchPage(e,t,n){const i=this.pageFetchStates[e];if(t&&i!==h.PENDING){const t=this._pageFetchRequests[e];t&&(t.controller.abort(),delete this._pageFetchRequests[e])}if(this._pageFetchRequests[e])return this._pageFetchRequests[e].promise;const a=this.length;this._insertPagePlaceholders(e),this._setFetchPageState(e,h.PENDING);const o=new r,s=o.signal,l=(0,d.default)(f.default.queryStickerPacks(e,9),s).then((t=>{if(s.aborted)throw new c.AbortError;const r=this._parseStickerPacksRes(e,t),i=n||this.setChecksum(t.checksum,{silent:!0}),o=9*(e-1),l=9*(e+0);this._resetRange(o,l,r),i&&(this._resetRangeWithPlaceholders(0,o),this._resetRangeWithPlaceholders(Math.min(o+r.length,l),t.count));const d=this.length;a!==d&&this.trigger("change:length",d),this._setFetchPageState(e,h.SUCCESS)})).catch((t=>{if(t.name===c.ABORT_ERROR)return __LOG__(2)`StickerPack page fetch promise cancelled: ${e}`,void this._unsetFetchPageStateAndPromise(e);this._setFetchPageState(e,h.ERROR)}));return this._pageFetchRequests[e]={promise:l,controller:o},l}_insertPagePlaceholders(e){const t=e-1;this._resetRangeWithPlaceholders(9*t,9*(t+1))}_parseStickerPacksRes(e,t){if(200!==t.status||!t.data)throw new Error("sticker packs query error");return t.data.map(((t,n)=>(0,a.default)((0,a.default)({},(0,l.default)(t,["id","mimetype","name","url","mediaKey","filehash","directPath"])),{},{encFilehash:t.encFilehash,page:e,index:9*(e-1)+n})))}_resetRangeWithPlaceholders(e,t){this._resetRange(e,t,(0,s.default)(t-e,(t=>_.createPlaceholder(e+t))))}_resetRange(e,t,n){this._forEachInRange(e,t,((t,r)=>{const i=n[r-e];if(t)if(i)t.id===i.id?(this.remove(t,{silent:!0}),this.add(i)):(this.remove(t),this.add(i));else{let e=t;for(;e;)this.remove(e),e=this.at(r)}else i&&this.add(i)}))}_forEachInRange(e,t,n){for(let r=e;r<t;r++){n(this.at(r),r)}}_resetFetchPageStateAndPromise(e){if(e in this.pageFetchStates){var t;if(this.pageFetchStates[e]===h.PENDING)null===(t=this._pageFetchRequests[e])||void 0===t||t.controller.abort();else this._unsetFetchPageStateAndPromise(e)}}_setFetchPageState(e,t){this.pageFetchStates[e]!==t&&(this.pageFetchStates[e]=t,this.trigger("change:pageFetchStates",e,t))}_unsetFetchPageState(e){e in this.pageFetchStates&&(delete this.pageFetchStates[e],this.trigger("change:pageFetchStates",e))}_unsetFetchPageStateAndPromise(e){delete this._pageFetchRequests[e],this._unsetFetchPageState(e)}}t.StickerPackCollectionImpl=_,_.model=p.StickerPackModel,_.comparator=function(e,t){return e.index<t.index?-1:e.index>t.index?1:0},_.createPlaceholder=function(e){return p.StickerPackModel.createPlaceholder({index:e,page:this.pageWithIndex(e)})},_.pageWithIndex=function(e){return Math.floor(e/9)+1};const g=new _;t.StickerPackCollection=g},63488:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(81109)),a=r(n(78718)),o=n(88555),s=n(40234),l=n(77905),c=r(n(14048)),d=n(67963),u=n(90669),p=r(n(56891));class f extends d.StickerCollectionImpl{constructor(e,t){super(),this._parseStickersRes=e=>{if(200!==e.status||!e.data)throw new Error("sticker pack stickers query error");return e.data.map(((e,t)=>(0,i.default)((0,i.default)({},(0,a.default)(e,["directPath","mimetype","mediaKey","filehash","width","height"])),{},{index:t,id:e.filehash,deprecatedMms3Url:e.url,encFilehash:e.encFilehash,mediaKeyTimestamp:0})))},this.stickerPackId=e,this.isFirstParty=t,this._firstPartyFetchTimestamp=null;const n=f._cache[this.stickerPackId];if(n)return n;let r;const o=this;Object.defineProperty(this,"fetchState",{get:()=>r,set(e){r!==e&&(r=e,o.trigger("change:fetchState",e))}})}fetch(e){var t;const r=(0,o.isMDBackend)()&&(0,c.default)()&&this.isFirstParty&&s.Clock.globalUnixTime()-(null!==(t=this._firstPartyFetchTimestamp)&&void 0!==t?t:0)>=u.STICKER_PACK_FETCH_TIMEOUT;if((e||r)&&this.fetchState!==d.FETCH_STATE.PENDING&&delete this._fetchPromise,this._fetchPromise)return this._fetchPromise;this.fetchState=d.FETCH_STATE.PENDING;if(n(74470).StickerPackModel.isPlaceholderId(this.stickerPackId))return this._fetchPromise=new Promise((()=>{})),this._fetchPromise;let i;return this.isFirstParty?((0,o.isMDBackend)()&&(0,c.default)()&&(this._firstPartyFetchTimestamp=s.Clock.globalUnixTime()),i=(0,l.fetchFirstPartyStickers)(this.stickerPackId)):i=p.default.queryStickersInStickerPack(this.stickerPackId).then(this._parseStickersRes),this._fetchPromise=i.then((e=>{const t=Math.max(this.length||e.length);this._resetRange(0,t,e),this.fetchState=d.FETCH_STATE.SUCCESS})).catch((()=>{this.fetchState=d.FETCH_STATE.ERROR})),this._fetchPromise}_resetRange(e,t,n){this._forEachInRange(e,t,((t,r)=>{const i=n[r-e];t?i?t.id===i.id?t.set(i):(this.remove(t),this.add(i)):this.remove(t):i&&this.add(i)}))}_forEachInRange(e,t,n){for(let r=e;r<t;r++){n(this.at(r),r)}}}t.default=f,f._cache={},f.comparator=(e,t)=>e.index<t.index?-1:e.index>t.index?1:0},8080:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.StreamMode=t.StreamInfo=t.Stream=t.Obscurity=void 0;var i=r(n(23279)),a=n(57319),o=n(88555),s=r(n(81602)),l=n(11290),c=n(88102),d=n(99234),u=r(n(11339)),p=n(58052),f=n(71119),h=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=v(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(43840)),_=n(53055),g=n(371),m=n(62583),y=n(83023),E=n(12099),S=n(65044);function v(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(v=function(e){return e?n:t})(e)}const T=n(76672).Mirrored(["OFFLINE","OPENING","PAIRING","SYNCING","RESUMING","CONNECTING","NORMAL","TIMEOUT"]);t.StreamInfo=T;const b=n(76672).Mirrored(["QR","MAIN","SYNCING","OFFLINE","CONFLICT","PROXYBLOCK","TOS_BLOCK","SMB_TOS_BLOCK","DEPRECATED_VERSION"]);t.StreamMode=b;const C=n(76672).Mirrored(["SHOW","OBSCURE","HIDE"]);t.Obscurity=C;class A extends l.BaseModel{constructor(){super(...arguments),this.info=(0,l.session)(T.NORMAL),this.mode=(0,l.session)(b.SYNCING),this.obscurity=(0,l.session)(C.HIDE),this.needsUpdate=(0,l.session)(),this.clientExpired=(0,l.session)(!1),this.hardExpired=(0,l.session)(!1),this.lastSyncStart=(0,l.session)(O()),this.needsManualDownload=(0,l.session)(),this.couldForce=(0,l.session)(),this.uiActive=(0,l.session)(),this.available=(0,l.session)(!0),this.unavailableShiftTimer=(0,l.session)(),this.unavailableLogoutTimer=(0,l.session)(),this.unobscureShiftTimer=(0,l.session)(),this.timeoutEvent=(0,l.session)(),this.resumeCount=(0,l.session)(0),this.phoneAuthed=(0,l.session)(!1),this._activeModeMeasure=(0,l.session)(),this.displayInfo=(0,l.derived)((function(){return function(e,t){switch(t){case C.SHOW:return e;case C.HIDE:return S.Socket.hasSynced?T.NORMAL:T.CONNECTING;case C.OBSCURE:switch(e){case T.OPENING:case T.PAIRING:case T.SYNCING:case T.RESUMING:return T.CONNECTING;default:return e}}return __LOG__(3)`Stream:unknown obscure level:`,e}(this.info,this.obscurity)}),["info","obscurity"])}initialize(){super.initialize(),(0,o.isMDBackend)()&&!(0,p.isRegistered)()&&(this.mode=b.QR),this._activeModeMeasure=h.startMeasure(`Stream.mode: ${this.mode}`),__LOG__(2)`Stream:rememberMe: ${String((0,_.getRememberMe)())}`,this.unavailableShiftTimer=new a.ShiftTimer((()=>this.markUnavailable())),this.unobscureShiftTimer=new a.ShiftTimer((()=>this.unobscure())),this.unavailableLogoutTimer=new a.ShiftTimer((function(){(0,_.getRememberMe)()||(__LOG__(2)`Stream:unavailableLogoutTimer logout due to inactivity`,S.Socket.logout())})),this.listenTo(S.Socket,"change:state change:stream change:hasSynced",this.onSocketUpdate),this.listenTo(s.default,"change:online",this.onSocketUpdate),this.listenTo(this,"change:available",this.onAvailableUpdate),this.listenTo(this,"change:phoneAuthed",this.onPhoneAuthedUpdate),this.listenTo(this,"change:info change:displayInfo change:mode",(0,i.default)(this.onSelfUpdate)),this.listenTo(this,"change:info",this.logPageResume),this.listenTo(this,"change:info",this.updateWamLog),this.listenTo(this,"change:mode",this.logModeChange),this.listenTo(this,"change:available change:uiActive",this.updateCouldForce),this.listenTo(c.Cmd,"midnight",this.updateHardExpire.bind(this)),(0,o.isMDBackend)()&&this.listenTo(c.Cmd,"socket_stream_disconnected",(()=>{n(68315).PresenceCollection.clearAllPresence()})),window.document&&document.addEventListener("visibilitychange",this.updateCouldForce),this.updateCouldForce(),this.updateHardExpire()}delete(){}markAvailable(){this.unavailableShiftTimer.cancel(),this.available=!0}markUnavailable(e){null!=e&&0!==e?this.unavailableShiftTimer.onOrBefore(e):(this.unavailableShiftTimer.cancel(),this.available=!1)}onSelfUpdate(){__LOG__(2)`Stream:onSelfUpdate mode:${this.mode} info:${this.info} view:${this.displayInfo}`;let e=this.timeoutEvent;if(this.info===T.TIMEOUT)e||(this.timeoutEvent=e=new u.default.WebcPhoneDisconnected),this.displayInfo===T.TIMEOUT&&null==this._bbarTime&&(this._bbarTime=Date.now());else if(e){e.markWebcPhoneDisconnectedT();const t=this._bbarTime;null!=t&&(e.webcPhoneBbarShownT=Date.now()-t),e.commit(),this.timeoutEvent=null,this._bbarTime=null}this.mode===b.MAIN&&c.Cmd.readyForMainStreamModeLegacy()}onSocketUpdate(){const e={},t=function(){switch(S.Socket.state){case m.SOCKET_STATE.TIMEOUT:return T.TIMEOUT;case m.SOCKET_STATE.OPENING:return s.default.online?T.OPENING:T.OFFLINE;case m.SOCKET_STATE.PAIRING:return S.Socket.hasSynced?T.RESUMING:T.PAIRING;case m.SOCKET_STATE.CONNECTED:return S.Socket.stream!==m.SOCKET_STREAM.CONNECTED?S.Socket.hasSynced?T.NORMAL:T.SYNCING:T.NORMAL;case m.SOCKET_STATE.UNLAUNCHED:case m.SOCKET_STATE.PROXYBLOCK:default:return T.NORMAL}}();if(e.info=t,e.mode=function(){let e=!1;e=(0,o.isMDBackend)()?(0,p.isRegistered)():(0,d.knowsPhone)();if(!e&&S.Socket.state!==m.SOCKET_STATE.PROXYBLOCK)return b.QR;const t=S.Socket.hasSynced;switch(S.Socket.state){case m.SOCKET_STATE.PROXYBLOCK:return b.PROXYBLOCK;case m.SOCKET_STATE.CONFLICT:return b.CONFLICT;case m.SOCKET_STATE.TOS_BLOCK:return b.TOS_BLOCK;case m.SOCKET_STATE.SMB_TOS_BLOCK:return b.SMB_TOS_BLOCK;case m.SOCKET_STATE.DEPRECATED_VERSION:return b.DEPRECATED_VERSION;case m.SOCKET_STATE.UNLAUNCHED:return b.SYNCING;case m.SOCKET_STATE.UNPAIRED_IDLE:case m.SOCKET_STATE.UNPAIRED:return b.QR;case m.SOCKET_STATE.OPENING:if(!s.default.online&&!S.Socket.hasSynced)return b.OFFLINE;default:return t||S.Socket.stream===m.SOCKET_STREAM.CONNECTED?b.MAIN:b.SYNCING}}(),e.phoneAuthed=S.Socket.stream!==m.SOCKET_STREAM.DISCONNECTED,t===T.NORMAL)this.unobscureShiftTimer.cancel(),e.obscurity=C.HIDE;else if(t===T.OFFLINE)this.unobscureShiftTimer.cancel(),e.obscurity=C.OBSCURE;else switch(this.obscurity){case C.HIDE:this.unobscureShiftTimer.onOrBefore(18e3);break;case C.OBSCURE:this.unobscureShiftTimer.onOrBefore(3e3);break;case C.SHOW:}this.set(e)}unobscure(){this.obscurity=C.SHOW}onPhoneAuthedUpdate(){if(this.phoneAuthed){this.sendAvailability(!0);n(92671).RecentEmojiCollection.sync()}}onAvailableUpdate(){const e=this.available;if(__LOG__(2)`Stream:onAvailableUpdate user ${e?"available":"unavailable"}`,e||(0,_.getRememberMe)()?this.unavailableLogoutTimer.cancel():this.unavailableLogoutTimer.onOrBefore(78e4),this.sendAvailability(!1),(0,o.isMDBackend)())if(e){const{sendDeliveryReceiptsAfterPresence:e}=n(7992);e()}else{n(68315).PresenceCollection.clearAllPresence()}}sendAvailability(e){(e||this.uiActive)&&(this.available?(0,g.sendPresenceAvailable)():(0,g.sendPresenceUnavailable)())}updateCouldForce(){this.couldForce=!this.uiActive||!this.available&&document.hidden}updateHardExpire(){y.Updater.isExpired()&&(this.hardExpired=!0,y.Updater.restart(!0))}logPageResume(){this.info===T.RESUMING&&(this.resumeCount++,new u.default.WebcPageResume({webcResumeCount:this.resumeCount}).commit())}updateWamLog(){const e=this.info===T.NORMAL;(0,f.streamInfoChange)(this.info,E.WatchedSocketModel.numSocketsAttempted,e),e&&this.stopListening(this,"change:info",this.updateWamLog)}logModeChange(){this._activeModeMeasure&&this._activeModeMeasure.end(),this.mode===b.SYNCING&&(this.lastSyncStart=O()),this._activeModeMeasure=h.startMeasure(`Stream.mode: ${this.mode}`),new u.default.WebcStreamModeChange({webcStreamMode:P(this.mode)}).commit()}}function P(e){switch(e){case b.QR:return u.default.WEBC_STREAM_MODE_CODE.QR;case b.MAIN:return u.default.WEBC_STREAM_MODE_CODE.MAIN;case b.SYNCING:return u.default.WEBC_STREAM_MODE_CODE.SYNCING;case b.OFFLINE:return u.default.WEBC_STREAM_MODE_CODE.OFFLINE;case b.CONFLICT:return u.default.WEBC_STREAM_MODE_CODE.CONFLICT;case b.PROXYBLOCK:return u.default.WEBC_STREAM_MODE_CODE.PROXYBLOCK;case b.DEPRECATED_VERSION:return u.default.WEBC_STREAM_MODE_CODE.DEPRECATED_VERSION;case b.TOS_BLOCK:case b.SMB_TOS_BLOCK:return u.default.WEBC_STREAM_MODE_CODE.TOS_BLOCK}}A.Proxy="stream";const M=new((0,l.defineModel)(A));function O(){return Math.floor(window.performance.now())}t.Stream=M},58492:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(82569)),a=r(n(85564)),o=n(11290),s=n(51612);class l extends o.BaseModel{constructor(){super(...arguments),this.id=(0,o.prop)(),this.pendingMsgs=(0,o.prop)(),this.labels=(0,o.prop)(),this.msgChunks=(0,o.session)((()=>[])),this.lastReceivedKey=(0,o.session)(),this.unreadMsgAnchor=(0,o.session)(),this.disableUnreadAnchor=(0,o.session)(),this.msgsLength=(0,o.session)(),this.msgsChanged=(0,o.session)(0),this.msgs=(0,o.collection)(s.ChatMsgsCollection)}initialize(){super.initialize(),this.listenTo(this.msgs,"change:last",(()=>{this.msgsChanged++})),this.listenTo(this.msgs,"add remove bulk_add",(()=>{this.msgsChanged++,this.msgsLength=this.msgs.length}))}onEmptyMRM(){throw new Error("onEmptyMRM not implemented")}delete(){super.delete(),this.getAllCMCs().forEach((e=>{e.forEach((e=>{e.delete()})),e.delete()}))}removeMsg(e){const t=e.msgChunk;if(!t)return;t.indexOf(e)<0||(__LOG__(2)`models:Chat:removeMsg ${e.get("id")}`,t.remove(e),0===t.length&&(t===this.msgs?this.onEmptyMRM():this.removeMsgsCollection(t)))}getAllCMCs(){return this.msgChunks.concat([this.msgs])}getAllMsgs(){return(0,a.default)(this.getAllCMCs().map((e=>e.getModelsArray())))}replaceMsgsCollection(e){__LOG__(2)`model:Chat:replaceMsgsCollection:${this.id.toString()}`;const t={msg:e.last()};this.msgs.replace(e),this.notifyMsgCollectionMerge(e,this.msgs,this.msgs,t),this.msgChunks=(0,i.default)(this.msgChunks,e),e.delete()}removeMsgsCollection(e){this.msgChunks=(0,i.default)(this.msgChunks,e),e.delete()}notifyMsgCollectionMerge(e,t,n,r){this.trigger("change:cmc:merge",e,t,n,r)}}t.default=l},11897:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(11290);class i extends r.BaseModel{constructor(){super(...arguments),this.id=(0,r.prop)(),this.displayText=(0,r.prop)(),this.subtype=(0,r.prop)(),this.url=(0,r.prop)(),this.phoneNumber=(0,r.prop)(),this.selectionId=(0,r.prop)(),this.selected=(0,r.session)(!1)}}i.Proxy="templateButton";var a=(0,r.defineModel)(i);t.default=a},82988:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.TemplateButtonCollection=void 0;var i=n(1255),a=r(n(11897));class o extends i.BaseCollection{}t.TemplateButtonCollection=o,o.model=a.default,o.comparator=(e,t)=>e.id<t.id?-1:e.id>t.id?1:0},86500:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(1255),i=n(17304);class a extends r.BaseCollection{}t.default=a,a.model=i.Msg,a.comparator=function(e,t){return t.t-e.t}},41809:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(11290);class i extends r.BaseModel{constructor(){super(...arguments),this.id=(0,r.prop)(),this.timestamp=(0,r.prop)()}}i.Proxy="unreadMention";var a=(0,r.defineModel)(i);t.default=a},91036:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.updateDisappearingMode=function(){return c.apply(this,arguments)};var i=r(n(48926)),a=n(45454),o=n(19380),s=n(41566),l=n(27211);function c(){return(c=(0,i.default)((function*(e,t,n){if(!(0,s.isDisappearingModeEnabled)())return Promise.resolve();const r=(0,a.createUserWid)(e.user),i=o.ContactCollection.get(r);if(i){const{disappearingModeSettingTimestamp:e}=i;if(null==e&&0!==n||null!=e&&e<n){const e={disappearingModeDuration:t,disappearingModeSettingTimestamp:n};yield(0,l.updateLocal)(r,e),i.set(e),__LOG__(2)`updateDisappearingMode: Contact=${r.toString()} updated, new duration=${t} t=${n}.`}}}))).apply(this,arguments)}},36473:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(22712),a=n(11290),o=r(n(47791)),s=n(88102),l=n(17239),c=n(69594),d=n(49835);class u extends a.BaseModel{constructor(){super(...arguments),this.id=(0,a.prop)(),this.peerJid=(0,a.prop)(),this.offerTime=(0,a.prop)(),this.isVideo=(0,a.prop)(!1),this.isGroup=(0,a.prop)(!1),this.groupCallParticipants=(0,a.prop)(),this.canHandleLocally=(0,a.prop)(!1),this.outgoing=(0,a.prop)(!1),this.webClientShouldHandle=(0,a.prop)(!1),this.participants=(0,a.collection)(o.default),this.callInfo=(0,a.prop)(),this._state=(0,a.prop)(),this._ringTimeout=(0,a.prop)()}getState(){return this._state}setState(e){var t;(t=this._state,e in f[t||"EMPTY"])&&(this._state=e,this.handleNotification())}handleNotification(){const e=this.getState();if(!(!l.Conn.tosShowCallNotification||!this.peerJid||(0,c.isVoiceCallEnabled)()&&!this.isVideo||(0,c.isVideoCallEnabled)()&&this.isVideo))if(e===d.CALL_STATES.INCOMING_RING){s.Cmd.alertCall(this.peerJid,this.id,this.isVideo,this.isGroup,this.canHandleLocally);i.MainAudioChannel.claim(this,(()=>{}))()}else s.Cmd.cancelCall(this.peerJid)}getCollection(){return n(60868).CallCollection}}u.Proxy="call";var p=(0,a.defineModel)(u);t.default=p;const f={EMPTY:{[d.CALL_STATES.INCOMING_RING]:!0,[d.CALL_STATES.OUTGOING_CALLING]:!0,[d.CALL_STATES.CONNECTING]:!0,[d.CALL_STATES.REJECTED]:!0,[d.CALL_STATES.HANDLED_REMOTELY]:!0,[d.CALL_STATES.ENDED]:!0,[d.CALL_STATES.FAILED]:!0},INCOMING_RING:{[d.CALL_STATES.HANDLED_REMOTELY]:!0,[d.CALL_STATES.CONNECTING]:!0,[d.CALL_STATES.ACTIVE]:!0,[d.CALL_STATES.REJECTED]:!0,[d.CALL_STATES.ENDED]:!0,[d.CALL_STATES.REMOTE_CALL_IN_PROGRESS]:!0,[d.CALL_STATES.FAILED]:!0},OUTGOING_CALLING:{[d.CALL_STATES.OUTGOING_RING]:!0,[d.CALL_STATES.CONNECTING]:!0,[d.CALL_STATES.ENDED]:!0,[d.CALL_STATES.FAILED]:!0,[d.CALL_STATES.ACTIVE]:!0,[d.CALL_STATES.NOT_ANSWERED]:!0,[d.CALL_STATES.REMOTE_CALL_IN_PROGRESS]:!0},OUTGOING_RING:{[d.CALL_STATES.CONNECTING]:!0,[d.CALL_STATES.ACTIVE]:!0,[d.CALL_STATES.REJECTED]:!0,[d.CALL_STATES.ENDED]:!0,[d.CALL_STATES.FAILED]:!0,[d.CALL_STATES.NOT_ANSWERED]:!0},CONNECTING:{[d.CALL_STATES.ACTIVE]:!0,[d.CALL_STATES.ENDED]:!0,[d.CALL_STATES.REMOTE_CALL_IN_PROGRESS]:!0,[d.CALL_STATES.FAILED]:!0},CONNECTION_LOST:{[d.CALL_STATES.ACTIVE]:!0,[d.CALL_STATES.ENDED]:!0,[d.CALL_STATES.FAILED]:!0},ACTIVE:{[d.CALL_STATES.ENDED]:!0,[d.CALL_STATES.FAILED]:!0,[d.CALL_STATES.CONNECTION_LOST]:!0},HANDLED_REMOTELY:{},ENDED:{},REJECTED:{},REMOTE_CALL_IN_PROGRESS:{},FAILED:{},NOT_ANSWERED:{}}},60868:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.CallCollectionImpl=t.CallCollection=void 0;var i=r(n(81109)),a=r(n(82492)),o=r(n(14176)),s=n(88156),l=n(22712),c=r(n(64369)),d=n(1255),u=r(n(36473)),p=r(n(83938)),f=r(n(29861)),h=n(30351),_=n(69594),g=n(66934),m=n(45473),y=n(32968),E=n(49835);const{VOIP_LOG_COLOR:S}=c.default;let v=null,T=null;class b extends d.BaseCollection{constructor(){super(...arguments),this.pendingOffers={},this.pendingVoipCapChecks={}}handleQuery(){return Promise.resolve()}handle(e){var t;v&&T||(v=n(84356).Voip,T=n(84356).checkVoipCapability);const r=e.shift();if(null===(t=r.data)||void 0===t?void 0:t[0]){const e=g.VoipSignaling.parseCallSignalingMsg(r);if(!e)return;let t={};(0,_.isVoiceCallEnabled)()&&(Array.isArray(r.data[0])&&(r.data=r.data[0]),(0,g.base64DecodeRecursively)(r.data),t={peer_jid:e.peer_jid,payload:r.data,peer_platform:e.peer_platform,peer_app_version:e.peer_version,epoch_msec:null!=e.t?String(1e3*e.t):void 0,elapsed_msec:null!=e.e?String(1e3*e.e):void 0,is_offline:r.data[1].offline});const n=e.call_id;let a=null,o=null,l=null;const c=JSON.parse(JSON.stringify(r)),d=c.data[2]&&c.data[2].find((e=>"enc"===e[0]));d&&(d[2]="xxx bytes"),__LOG__(2)`voip:incoming_signaling(peer):${JSON.stringify(e)}:`;let u=!1;switch(e.type){case m.TYPE.OFFER:if((0,h.getDoNotDisturb)()&&!f.default.isFocused)return void __LOG__(2)`CallCollection:handle: ignoring incoming call offer because do not disturb mode is enabled or screen is locked`;if(u=!0,a=e.isVideoCall,o=e.isGroupCall_DEPRECATED,l=e.t,v.isInitialized()){this.pendingVoipCapChecks[n]=Promise.all([T((0,i.default)({},e)),(0,p.default)()]).then((e=>{let[t,n]=e;return t&&n}));const t=r.data[2]&&r.data[2].find((e=>"enc"===e[0]));this.pendingOffers[n]=new s.Resolvable,this.pendingOffers[n].promise.then((e=>{e&&g.VoipSignaling.receiveCallOfferKey(e,t)}))}}this.pendingVoipCapChecks[n]?this.pendingVoipCapChecks[n].then((i=>{let s;var c;(s=!o&&(a?i&&(0,_.isVideoCallEnabled)():i),this.processIncomingCall(n,r.from,{isVideo:a,isGroupCall:o,canHandleLocally:s,offerTime:l}),s&&this.pendingOffers[n]&&(0,_.isVoiceCallEnabled)())?this.pendingOffers[n].promise.then((()=>{var n;null===(n=v)||void 0===n||n.handleIncomingSignalingMessage(e,t)})):(this.cleanupPendingOffer(n),null===(c=v)||void 0===c||c.handleIncomingSignalingMessage(e,t))})).finally((()=>{delete this.pendingVoipCapChecks[n]})):this.pendingOffers[n]?(u&&this.processIncomingCall(n,r.from),(0,_.isVoiceCallEnabled)()&&this.pendingOffers[n].promise.then((()=>{var n;null===(n=v)||void 0===n||n.handleIncomingSignalingMessage(e,t)}))):(u&&this.processIncomingCall(n,r.from,{isVideo:a,isGroupCall:o,canHandleLocally:!1,offerTime:l}),v.handleIncomingSignalingMessage(e,t))}else{__LOG__(2)`voip:incoming_signaling(paired phone):${JSON.stringify(r)}:`;const e=this.get(r.id);switch(r.type){case"offer_key":const t=this.pendingOffers[r.id];t&&r.key instanceof ArrayBuffer?t.resolve(r.key):__LOG__(3)`received offer_key: no pending offer`;break;case"accept":case"reject":e&&e.setState(E.CALL_STATES.HANDLED_REMOTELY),v.callEndByHandledRemotely(r.id),this.cleanupPendingOffer(r.id);break;case"terminate":e&&e.setState(E.CALL_STATES.ENDED),this.cleanupPendingOffer(r.id)}}}processIncomingCall(e,t,n){if(null!=this.get(e))return void __LOG__(2)`voip:processIncomingCall: Attempting to add existing call with call ID`;let r=n;const i={id:e};null!=t&&(i.peerJid=t),r&&(r=(0,o.default)(r,(e=>null==e)),(0,a.default)(i,r)),this.add(i,{merge:!0})}cleanupPendingOffer(e){delete this.pendingOffers[e]}setActiveCall(e){var t,n;const r=this.activeCall&&!e,i=null===(t=this.activeCall)||void 0===t?void 0:t.webClientShouldHandle;this.activeCall=e,this.trigger("change:activeCall",e),r&&i&&(0,y.playEndCallTone)(),null===(n=this._releaseAudioChannelClaim)||void 0===n||n.call(this),null!=e&&(this._releaseAudioChannelClaim=l.MainAudioChannel.claim(this,(()=>{})))}}t.CallCollectionImpl=b,b.model=u.default;const C=new b;t.CallCollection=C},50064:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(11290);class i extends r.BaseModel{constructor(){super(...arguments),this.id=(0,r.prop)(),this.callId=(0,r.prop)(),this.isIncoming=(0,r.prop)(!1),this.isRinging=(0,r.prop)(!1),this.isInterrupted=(0,r.prop)(!1),this.isMuted=(0,r.prop)(!1),this.isTrafficStopped=(0,r.prop)(!1),this.isInvitingToGroupCall=(0,r.prop)(!1),this.isVideoStopped=(0,r.prop)(!1),this.isVideoPaused=(0,r.prop)(!1),this.isVideoDecodePaused=(0,r.prop)(!1),this.isVideoDecodeStarted=(0,r.prop)(!1),this.isOfferingVideoUpgrade=(0,r.prop)(!1)}}i.Proxy="callParticipant";var a=(0,r.defineModel)(i);t.default=a},47791:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(32304)),a=n(1255),o=r(n(50064));class s extends a.BaseCollection{}t.default=s,s.model=o.default,s.comparator=(e,t)=>e.id===t.id?0:(0,i.default)(e.id,t.id)?-1:1},29861:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(11290);class i extends r.BaseModel{constructor(){super(...arguments),this.isFocused=(0,r.session)(!0)}initialize(){super.initialize(),this._onFocus=this._onFocus.bind(this),this._onBlur=this._onBlur.bind(this)}delete(){super.delete()}_onFocus(){this.isFocused=!0}_onBlur(){this.isFocused=!1}}i.Proxy="mainWindowState";var a=new((0,r.defineModel)(i));t.default=a},77107:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(11290),i=n(49835);class a extends r.BaseModel{constructor(){super(...arguments),this.callId=(0,r.prop)(),this.peerJid=(0,r.prop)(),this.pc=(0,r.prop)(),this.answer=(0,r.prop)(),this.localStream=(0,r.prop)(),this.remoteAudioStream=(0,r.prop)(),this.remoteVideoStream=(0,r.prop)(),this._state=(0,r.prop)(i.WEB_CALL_STATES.NONE)}getState(){return this._state}setState(e){const t=e;(function(e,t){const n=e||i.WEB_CALL_STATES.NONE;return t in s[n]})(this._state,t)&&(this._state=t)}}a.Proxy="webCall";var o=(0,r.defineModel)(a);t.default=o;const s={NONE:{[i.WEB_CALL_STATES.OUTGOING_CALLING]:!0,[i.WEB_CALL_STATES.INCOMING_CALLING]:!0},OUTGOING_CALLING:{[i.WEB_CALL_STATES.ACTIVE]:!0,[i.WEB_CALL_STATES.NONE]:!0},INCOMING_CALLING:{[i.WEB_CALL_STATES.ACTIVE]:!0,[i.WEB_CALL_STATES.NONE]:!0},ACTIVE:{[i.WEB_CALL_STATES.NONE]:!0}}},19037:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;const n={cache:{},delete(){n.cache={}}};var r=n;t.default=r},65044:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.Socket=void 0;var i=r(n(48926)),a=r(n(6410)),o=r(n(82569)),s=r(n(63105)),l=r(n(2525)),c=r(n(91966)),d=r(n(13218)),u=r(n(78718)),p=r(n(35161)),f=r(n(41609)),h=n(89385),_=n(15688),g=n(8584),m=n(40265),y=n(50796),E=n(13959),S=n(4352),v=n(38284),T=n(92574),b=n(88555),C=n(40234),A=Ae(n(86374)),P=r(n(4285)),M=r(n(79264)),O=Ae(n(35232)),I=r(n(38469)),w=r(n(30381)),R=n(54602),D=n(57849),L=n(67146),N=r(n(48446)),k=n(11290),U=r(n(4550)),G=r(n(69048)),x=n(88102),B=n(24747),F=n(17239),j=r(n(66405)),Y=r(n(33163)),K=r(n(71520)),W=r(n(55738)),H=n(64319),V=n(27086),$=n(99234),z=n(7293),q=n(57701),J=n(77303),Q=n(16703),X=n(83578),Z=n(46582),ee=n(76214),te=n(58052),ne=r(n(51783)),re=n(85417),ie=n(72407),ae=n(53055),oe=r(n(7353)),se=Ae(n(98250)),le=n(64551),ce=r(n(68132)),de=n(318),ue=n(62583),pe=r(n(94030)),fe=n(24439),he=Ae(n(47272)),_e=n(14892),ge=n(83023),me=r(n(53565)),ye=n(52622),Ee=r(n(35609)),Se=r(n(60723)),ve=r(n(21244)),Te=r(n(15078)),be=n(66567);function Ce(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(Ce=function(e){return e?n:t})(e)}function Ae(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=Ce(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}return r.default=e,n&&n.set(e,r),r}class Pe extends((0,m.customError)("ExternalPoke")){}class Me extends((0,m.customError)("MustExitLoop")){}class Oe extends((0,m.customError)("Denied401Failed")){}class Ie extends((0,m.customError)("Denied409Conflict")){}class we extends((0,m.customError)("DeniedTOS")){}class Re extends((0,m.customError)("DeniedTOSGDPR",!0,we)){}class De extends((0,m.customError)("DeniedTOSSMB",!0,we)){}class Le extends((0,m.customError)("DeniedUnknown")){}class Ne extends((0,m.customError)("ForcedRefresh")){}class ke extends((0,m.customError)("TooManyRefRequest")){}class Ue extends((0,m.customError)("UILogout")){}class Ge extends((0,m.customError)("WindowOffline")){}class xe extends((0,m.customError)("PhoneFailedPing")){}class Be extends((0,m.customError)("AssertionFailed")){}class Fe extends((0,m.customError)("TakeoverRequested")){}class je extends((0,m.customError)("PhoneReplacedClient")){}class Ye extends((0,m.customError)("NoSecretBundle")){}class Ke extends((0,m.customError)("PhoneKickedClient")){}class We extends((0,m.customError)("TempServerError")){}const He={SYNC_INFO:["Conn",Y.default.OBJECT],CHALLENGE:["Cmd",{type:"challenge",challenge:Y.default.STRING}],DISCONNECT:["Cmd",{type:"disconnect",kind:void 0}],HARD_REFRESH:["Cmd",{type:"update"}],UPGRADE_MD_FOR_INTERNAL_USER:["Cmd",{type:"upgrade_md"}],UPGRADE_MD_FOR_PROD:["Cmd",{type:"upgrade_md_prod",version:void 0}],PONG:["Pong",Y.default.BOOLEAN]},Ve={TAG:e=>new Y.default({tag:e,data:Y.default.ANY,binarySize:Y.default.ANY}),SYNC_INFO:new Y.default({tag:Y.default.ANY,data:He.SYNC_INFO,binarySize:Y.default.ANY}),CHALLENGE:new Y.default({tag:Y.default.ANY,data:He.CHALLENGE,binarySize:Y.default.ANY}),DISCONNECT:new Y.default({tag:Y.default.ANY,data:He.DISCONNECT,binarySize:Y.default.ANY}),HARD_REFRESH:new Y.default({tag:Y.default.ANY,data:He.HARD_REFRESH,binarySize:Y.default.ANY}),UPGRADE_MD_FOR_INTERNAL_USER:new Y.default({tag:Y.default.ANY,data:He.UPGRADE_MD_FOR_INTERNAL_USER,binarySize:Y.default.ANY}),UPGRADE_MD_FOR_PROD:new Y.default({tag:Y.default.ANY,data:He.UPGRADE_MD_FOR_PROD,binarySize:Y.default.ANY}),PONG:new Y.default({tag:Y.default.ANY,data:He.PONG,binarySize:Y.default.ANY})},$e=new Y.default({status:e=>"number"==typeof e&&e>=500,_:void 0}),ze=new Y.default({status:e=>"number"==typeof e&&499===e,_:void 0}),qe=new Y.default({status:e=>"number"==typeof e,_:void 0});class Je extends k.BaseModel{constructor(){super(...arguments),this.socketPreload=(0,k.session)(),this.socket=(0,k.session)(),this.launchGeneration=(0,k.session)(0),this.backoffGeneration=(0,k.session)(0),this.hasSynced=(0,k.session)(),this.state=(0,k.session)(ue.SOCKET_STATE.UNLAUNCHED),this.stream=(0,k.session)(ue.SOCKET_STREAM.DISCONNECTED),this.canSend=(0,k.session)(),this.sendQueue=(0,k.session)(),this.sendHash=(0,k.session)(),this.cancelHash=(0,k.session)(),this.doubleAckHash=(0,k.session)(),this.sequence=(0,k.session)(0),this.shortTagBase=(0,k.session)(),this.socketWatcher=(0,k.session)(),this.refWatcher=(0,k.session)(),this.phoneWatchdog=(0,k.session)(),this.pendingPhoneReqs=(0,k.session)(0),this.isIncognito=(0,k.session)(),this.runPromise=(0,k.session)(),this.streamPromise=(0,k.session)(),this.conflictPromise=(0,k.session)(),this.resumePromise=(0,k.session)(),this.logoutMutex=(0,k.session)(0),this.retryTimestamp=(0,k.session)(),this.pokeable=(0,k.session)(),this.launched=(0,k.session)(),this.mustExitLoop=(0,k.session)(),this.syncTag=(0,k.session)(),this.lastPhoneMessage=(0,k.session)(),this.shouldForceReconnect=(0,k.session)(!1),this.shouldUpgradeToMDIntern=(0,k.session)(!1),this.shouldUpgradeToMDPord=(0,k.session)(!1)}initialize(){(0,b.isLegacyWebdBackend)()&&(this.sendQueue=[],this.sendHash={},this.cancelHash={},this.doubleAckHash={},this.phoneWatchdog=new be.Watchdog({waitAlgorithm:(0,be.fibonacci)(3e3,3e3,36e5),onTimeout:this.phoneTimedOut.bind(this),onActivated:this.onPhoneWatchdogActivated.bind(this),onFed:this.onPhoneWatchdogFed.bind(this),onDeactivated:this.onPhoneWatchdogDeactivated.bind(this)})),this.listenTo(this,"change:state",this.onStateChange.bind(this)),this.listenTo(this,"change:stream",this.onStreamChange.bind(this)),(0,E.delayMs)(0).then(W.default).then((e=>{this.isIncognito=e})),this.listenTo(x.Cmd,"log_socket_summary",this.summary),this.listenTo(x.Cmd,"set_socket_state",(e=>{this.state=e})),this.listenTo(x.Cmd,"open_socket_stream",(()=>{this.openStream(),this.hasSynced&&this.set({stream:ue.SOCKET_STREAM.CONNECTED})})),this.listenTo(x.Cmd,"socket_stream_disconnected",(()=>{this.set({stream:ue.SOCKET_STREAM.DISCONNECTED})})),this.listenTo(x.Cmd,"on_critical_sync_done",(()=>{__LOG__(2)`[ws2] observed on_critical_sync_done`,this.onCriticalSyncDone()})),this.listenTo(x.Cmd,"main_stream_mode_ready",(()=>{__LOG__(2)`[ws2] observed main_stream_mode_ready`,!(0,b.isMDBackend)()||(0,te.getAllCriticalDataSynced)()?(__LOG__(2)`[ws2] moving to main screen from main_stream_mode_ready`,this.set({hasSynced:!0,stream:ue.SOCKET_STREAM.CONNECTED})):__LOG__(2)`[ws2] did not meet conditions to move to main screen`})),this.listenTo(x.Cmd,"socket_stream_disconnected",(()=>{this.stream=ue.SOCKET_STREAM.DISCONNECTED}))}preload(){(0,b.isLegacyWebdBackend)()&&(this.socketPreload=new pe.default)}send(e){const t=new oe.default(e);this.sendQueue.push(t),this.flushQueue()}send2(e){return new Promise(((t,n)=>{const r=new oe.default(e);r.onSend=t,r.onDrop=n,this.sendQueue.push(r),this.flushQueue()}))}shortTag(){return this.shortTagBase||(this.shortTagBase=((0,w.default)().unix()%1e3).toString()),`${this.shortTagBase}.--${this.sequence++}`}tag(e){return`${(0,w.default)().unix()}.--${this.sequence++}`}launch(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;__LOG__(2)`ws2:Launch gen${this.launchGeneration} (backoff gen${this.backoffGeneration})`;const n=300*he.expBackoff(this.backoffGeneration,100),r=Date.now()+n;if(this.launched)return __LOG__(4,void 0,new Error,!0)`ws2:launch redundantly called!`,void SEND_LOGS("redundant-launch");function i(){__LOG__(2)`ws2:socket loop closed`,this.socketPreload&&this.socketPreload.deactivate(),this.clearState(),this.set({state:ue.SOCKET_STATE.UNLAUNCHED,mustExitLoop:!1,launched:!1,socketPreload:null})}this.mustExitLoop?i.call(this):(this.launched=!0,this.run(t,e).then((function(e){return[e,!1]})).catch((0,y.filteredCatch)(Me,(()=>(this.mustExitLoop=!0,[!1,!1])))).catch((0,y.filteredCatch)(Fe,(function(){return[!1,!0]}))).catch((e=>(__LOG__(3,!0,void 0,!0)`ws2:run error unknown!\n${e.stack}`,SEND_LOGS("unknown-error-in-ws-loop"),this.clearState(),[!0,!1]))).then((e=>{let[t,a]=e;if(this.mustExitLoop)i.call(this);else{const e=Date.now();this.launchGeneration++,this.backoffGeneration=t&&e<r+6e4?this.backoffGeneration+1:0;const i=e<r?Math.min(r-e,n):0;this.launched=!1,this.launch(a,i)}})))}poke(){this.pokeable?this.pokeable.poke():this.phoneWatchdog.forceTimeout()}takeover(){if(!this.conflictPromise)throw"Takeover called without conflict!";this.conflictPromise.cancel(new Fe)}exitLoop(e){this.mustExitLoop=!0,this.runPromise&&this.runPromise.cancel(e||new Me)}_setLogoutDirtyBit(){P.default&&P.default.setItem(ie.KEYS.LOGOUT_DIRTY_BIT,"1")}_removeLogoutDirtyBit(){P.default&&P.default.removeItem(ie.KEYS.LOGOUT_DIRTY_BIT)}_hasDirtyBitSet(){P.default&&P.default.getItem(ie.KEYS.LOGOUT_DIRTY_BIT)}clearCredentialsAndStoredData(e){var t=this;return(0,i.default)((function*(){let n=!1;e===X.LogoutReason.ClientFatalError&&(n=!0),t._setLogoutDirtyBit(),n=yield t.clearCredentials(),t._hasDirtyBitSet()&&(n=!0),t._setLogoutDirtyBit();try{yield t.destroyStorage()}catch(e){n=!0,__LOG__(4,void 0,new Error,void 0,["logout"])`destroyStorage: failed with error ${e}`}(0,b.isMDBackend)()&&(0,D.clearABPropConfigs)(),n||t._removeLogoutDirtyBit();const r=new me.default;if(n&&"Firefox"!==M.default.info().name&&r.set("post_logout","1"),e){const t=(0,R.getErrorCodeFromLogoutReason)(e);t&&r.set("logout_reason",t)}const i=r.toString();null==i||""===i?window.location.reload():window.location.href=`${window.location.pathname}?${r.toString()}`}))()}destroyStorage(){return(0,i.default)((function*(){const e=[(0,ee.destroy)(),(0,fe.destroyStorage)()];(0,b.isMDBackend)()&&(e.push((0,V.destroy)()),e.push((0,re.destroy)()),e.push((0,Q.destroy)()),e.push(G.default.clearInitializationPromises())),yield Promise.all(e)}))()}logout(){var e=this;let t,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:X.LogoutReason.UserInitiated;P.default&&(0,b.isMDBackend)()&&(P.default.removeItem("WebEncKeySalt"),P.default.removeItem("WANoiseInfo")),(0,J.get)().setLogoutState(!0),(0,b.isLegacyWebdBackend)()?t=this.runPromise:x.Cmd.onStartingLogout(),__LOG__(2)`ws2:user logged out`;let o=Promise.resolve();if((0,b.isMDBackend)()){const e=Math.min(20,Math.max(0,le.ServerProps.syncdSentinelTimeoutSeconds));o=(0,v.promiseTimeout)(n(37933).Z(),1e3*e).catch((()=>__LOG__(3)`ws2: multi-device logout did not manage to send sentinel patch`))}(0,v.promiseTimeout)(o.then((()=>{this.stream===ue.SOCKET_STREAM.DISCONNECTED||r?this.sendCurrentLogout(null,a):this.sendCurrentLogout(this.socket,a)})).catch(function(){var t=(0,i.default)((function*(t){__LOG__(4,void 0,new Error)`ws2: [logout error] sendCurrentLogoutPromise errored with ${t}`,yield e.clearCredentialsAndStoredData(a),x.Cmd.logout()}));return function(){return t.apply(this,arguments)}}()),3e3,"network request took more than 3 seconds").then((0,i.default)((function*(){(0,b.isLegacyWebdBackend)()&&(x.Cmd.onStartingLogout(),yield new Promise((e=>setTimeout(e,100)))),yield e.clearCredentialsAndStoredData(a),t&&t.cancel(new Ue),e.state===ue.SOCKET_STATE.OPENING&&e.trigger("change:state"),x.Cmd.logout()}))).catch(function(){var t=(0,i.default)((function*(t){__LOG__(4,void 0,new Error)`ws2: [logout error] sentinelPromise or sendCurrentLogoutPromise timed out with ${t}`,yield e.clearCredentialsAndStoredData(a),x.Cmd.logout()}));return function(){return t.apply(this,arguments)}}()).finally((()=>{(0,J.get)().setLogoutState(!1)}))}summary(){__LOG__(2)`ws:summary --------------------------------`,__LOG__(2)`ws state           ${this.state}`,__LOG__(2)`wd online:         ${String(navigator.onLine)}`,__LOG__(2)`ws socket id:      ${this.socket?this.socket.id:"n/a"}`,__LOG__(2)`ws queue:`,(0,f.default)(this.sendQueue)||I.default.print((0,p.default)(this.sendQueue,(function(e){const t=(0,u.default)(e,"tag","state","age","ephemeral","isToPhone");return(null==e?void 0:e.toString)&&(t.debug=e.toString()),t}))).split(/\n/).forEach((function(e){__LOG__(2)`${e}`})),__LOG__(2)`ws hash:`,(0,f.default)(this.sendHash)||I.default.print((0,p.default)(this.sendHash,(function(e){const t=(0,u.default)(e,"tag","state","age","ephemeral","isToPhone");return(null==e?void 0:e.toString)&&(t.debug=e.toString()),t}))).split(/\n/).forEach((function(e){__LOG__(2)`${e}`}))}registerHandler(e){(0,b.isMDBackend)()||(this.handler&&(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("ws2: attempting to register handler multiple times")),this.handler=e)}onStateChange(){__LOG__(2)`ws2:state change: ${this.state}`}onStreamChange(){__LOG__(2)`ws2:stream change: ${this.stream}`,this.stream===ue.SOCKET_STREAM.DISCONNECTED&&((0,b.isMDBackend)()?Te.default.clear():this.onRefCycle(),this.unset("resumePromise"))}onRefCycle(){__LOG__(2)`ws2:onRefCycle`,this.sendQueue.forEach((function(e){e.state=oe.default.STATE.NEW,e.age=0})),this.clearSendHash()}onActivity(e){if(e){const t=e.data;if(Ve.UPGRADE_MD_FOR_INTERNAL_USER.test(e))__LOG__(2)`ws2: can upgrade to md! (flow for internal users)`,this.shouldUpgradeToMDIntern=!0,this.exitLoop();else if(Ve.UPGRADE_MD_FOR_PROD.test(e)){if(__LOG__(2)`ws2: upgrade to md! (flow for external users)`,Array.isArray(t)&&2===(null==t?void 0:t.length)&&t[1]&&t[1].type&&t[1].version){const e="string"==typeof t[1].version&&t[1].version,n=e&&new ye.Version(e),r=new ye.Version(ye.SANITIZED_VERSION_STR);if(n&&r.lt(n))return(0,$.setMdOptedIn)(!0),ge.Updater.restart(!0),void this.exitLoop()}this.shouldUpgradeToMDPord=!0,this.exitLoop()}else if(Ve.HARD_REFRESH.test(e))__LOG__(2)`ws2:hard refresh!`,ge.Updater.restart(!0);else if(t){const n=Array.isArray(t)?` [${String(t[0])}, ...]`:"",r=(0,d.default)(t)&&"number"==typeof t.status?t.status:null;Te.default.logRecv(e.tag,e.binarySize,r);const i=null!=r?`,{status:${r}}`:"";__LOG__(2)`    recv: ${e.tag}${n}${i}`}else Te.default.logAck(e.tag),__LOG__(2)`     ack: ${e.tag}`}else C.Clock.setSkew(this.socket.timeSkew||0);this.sendRemainingLogouts()}onPhoneWatchdogActivated(){}onPhoneWatchdogFed(){this.state=ue.SOCKET_STATE.CONNECTED}onPhoneWatchdogDeactivated(){}flushQueue(){if(!this.sendQueue.length)return;const e=this.sendQueue.filter((e=>e.state===oe.default.STATE.NEW&&this.canRequestBeSent(e))),t=C.Clock.localUnixTime(),n=[],r=[];e.forEach((e=>{!function(e,t){if(e.resendGuard&&!e.resendGuard())return!0;if(e.binaryOpts&&null!=e.binaryOpts.expires&&0!==e.binaryOpts.expires)return t-e.binaryOpts.expires>120;return!1}(e,t)?r.push(e):n.push(e)})),this.sendQueue=(0,c.default)(this.sendQueue,n),n.forEach((e=>{delete this.sendHash[e.tag],delete this.doubleAckHash[e.tag],Te.default.delete(e.tag),e.onSend({status:408})})),r.length&&r.forEach((e=>{this._send(e)}))}phoneTimedOut(){const e=this.phoneWatchdog.failGeneration;if(1===e){__LOG__(3)`ws2:Phone timed out`;const e=(0,p.default)(this.sendHash,"tag");__LOG__(3)`ws2:Outstanding Reqs: ${e.join(",")}`}x.Cmd.sentPing(e);const t=this.phoneWatchdog.waitAlgorithm(this.phoneWatchdog);return this.set({state:ue.SOCKET_STATE.TIMEOUT,retryTimestamp:Date.now()+t}),this._basicSend({tag:this.tag("ping"),data:["admin","test"]},"ping"),!0}clearSendHash(e){if(e)(0,l.default)(this.sendHash,(function(e){e.resendTimer&&clearTimeout(e.resendTimer),e.onDrop(new T.LogoutDrop(e.toString()))}));else{const e=(0,s.default)(this.sendHash,"ephemeral");__LOG__(3)`Ephemeral Drop: ${(0,p.default)(e,"tag").join(",")}`,e.forEach((function(e){e.resendTimer&&clearTimeout(e.resendTimer),e.onDrop(new T.EphemeralDrop(e.toString()))}))}this.sendHash={},this.doubleAckHash={},this.pendingPhoneReqs=0,this.phoneWatchdog&&this.phoneWatchdog.deactivate(),Te.default.clear()}_basicSend(e,t){__LOG__(2)`low-send: ${t} ${String(e.tag)}`,Te.default.logBasicSend(e.tag,e.data),this.socket.cast(`${String(e.tag)},${String(JSON.stringify(e.data))}`)}_send(e){e.tag=e.getTag()||this.shortTag(),e.onTag&&e.onTag(e.tag),this.sendHash[e.tag]=e,e.tagToCancel&&(this.cancelHash[e.tag]=e.tagToCancel),(e.isCallOffer||e.isWap4Bridge)&&(this.doubleAckHash[e.tag]=e),e.binaryOpts?e.binaryOpts.debugObj:e.data,Te.default.logSend(e),__LOG__(2)`    send: ${String(e.tag)}, ${e.toString()}`,this.socket.send(e.serialize()),e.isToPhone&&this.pendingPhoneReqs++,e.state=oe.default.STATE.SENT}sendBasic(e){return this.socket?(e.tag=this.tag(),this._basicSend(e,"external"),this.socket.nextMessage(Ve.TAG(e.tag))):Promise.reject(new Error("socket not open"))}sendEphemeral(e){e.ephemeral=!0;const t=new oe.default(e);this.canRequestBeSent(t)?this._send(t):t.onDrop(new T.EphemeralDrop(t.toString()))}sendEphemeral2(e){return new Promise(((t,n)=>{const r=new oe.default(e);r.ephemeral=!0,this.canRequestBeSent(r)?(r.onSend=t,r.onDrop=e=>{__LOG__(4,void 0,new Error)`ws2:sendEphemeral2:request.onDrop`,n(e)},this._send(r)):n(new T.EphemeralDrop(r.toString()))}))}sendEphemeralIgnore(e){e.ephemeral=!0,e.ignore=!0,e.tag=this.tag();const t=new oe.default(e);if(this.canRequestBeSent(t)){const e=t.serialize();this.socket.send(e),__LOG__(2)`sending: ${String(t.tag)}, ${t.toString()}`}else t.onDrop(new T.EphemeralDrop(t.toString()))}on5xx(e){__LOG__(3)`ws2:onMessage 5xx error ${String(e.tag)}`,e.on5xx&&e.on5xx(),e.resends>=5?(__LOG__(3)`ws2:onMessage dropping ${String(e.tag)}`,e.onDrop(new T.Server5xxDrop),delete this.sendHash[e.tag],Te.default.delete(e.tag),this.sendQueue=(0,o.default)(this.sendQueue,e)):this.maybeResendRequestEventually(e)}onMessage(e){const t=e.tag,r=e.data,i=e.binarySize;if(Qe(r)&&(this.lastPhoneMessage=(0,w.default)().unix()),Ve.PONG.test(e)){if(r[1]){let e=0,t=!1;(0,l.default)(this.sendHash,(function(r){if(!r.isToPhone)return;const i=++r.age;40===i?(t=!0,__LOG__(4,void 0,new Error)`${r.tag+" likely dead: "+r.toString()}`,x.Cmd.cannotReachPhone("("+r.tag+") "+r.toString()),n(56891).default.cannotReachPhone()):i<40&&e++})),this.pendingPhoneReqs=e,this.phoneWatchdog.feed(),0===e&&this.phoneWatchdog.deactivate(),t&&__LOG__(3)`ws2:error-cannot-reach-phone`}else this.state!==ue.SOCKET_STATE.TIMEOUT?__LOG__(3)`ws2:Pang while not timed-out`:this.runPromise.cancel(new xe);return}const a=this.sendHash[t];if(a){if(!r)return a.state=oe.default.STATE.WEBDACKED,void(a.isToPhone&&this.phoneWatchdog.activate());if(a.retryOn5xx&&$e.test(r))this.on5xx(a,r);else{let n=!0;if(this.doubleAckHash[t]&&(delete this.doubleAckHash[t],!a.isCallOffer&&!a.isWap4Bridge||200!==r.status||r.payload||(n=!1)),n){let n;try{a.logOnSend&&a.logOnSend(e),n=a.onSend(r)}catch(e){if(e instanceof T.E401)return void this.logout();__LOG__(3)`ws2:onMessage error`,a.onDrop(e)}if($e.test(n)?this.on5xx(a,n):(delete this.sendHash[t],this.sendQueue=(0,o.default)(this.sendQueue,a)),ze.test(r)){const e=this.cancelHash[t];if(e){const n=this.sendHash[e];delete this.cancelHash[t],delete this.sendHash[e],this.sendQueue=(0,o.default)(this.sendQueue,n)}}}}a.isToPhone&&(a.age<40&&this.pendingPhoneReqs--,this.phoneWatchdog.feed(),0===this.pendingPhoneReqs&&this.phoneWatchdog.deactivate())}else if(r){if(qe.test(r))__LOG__(3)`ws2: unexpected response status`;else if(r instanceof ArrayBuffer)n(56891).default.handle(r,this,t,i).catch((0,y.filteredCatch)(T.WebdDrop,(()=>{})));else try{this.handler?this.handler(r):__LOG__(3)`ws2: received message, but no handler is registered`}catch(e){if(e instanceof O.UpdateImmediately)this.exitLoop(e);else{if(!(e instanceof O.DeprecatedProtocolVersion))throw e;this.runPromise&&this.runPromise.cancel(e)}}Qe(r)&&this.phoneWatchdog.feed()}}run(e,t){var n=this;return this.runPromise=K.default.resolve(e).cancellable().then((e=>{if(this.state=ue.SOCKET_STATE.OPENING,x.Cmd.incrementProgress(),e>0){__LOG__(2)`ws2:Run Backoff ${e}ms`;const t=(0,E.delayMs)(e).cancellable().catch((0,y.filteredCatch)(Pe,(()=>{})));return this.setPokeable(t,Date.now()+e),t}})).finally((()=>{this.unset("pokeable"),this.unset("retryTimestamp")})).then((()=>(x.Cmd.incrementProgress(),__LOG__(2)`ws2:Running`,this.openSocket()))).then((e=>{if(x.Cmd.incrementProgress(),e.onactivity=this.onActivity.bind(this),this.socket=e,this.socketWatcher=(0,N.default)(this.runPromise,this.throwOnClose()),this.state=ue.SOCKET_STATE.PAIRING,void 0===this.isIncognito)return(0,Ee.default)(this,"change:isIncognito")})).then((()=>{x.Cmd.incrementProgress(),this.shortTagBase=((0,w.default)().unix()%1e3).toString();const e=this.initConn();if((0,$.knowsPhone)()){const n=this.requestSync(t),r=Promise.all([e,n]).finally((function(){e.cancel(),n.cancel()})),i=(0,Z.requireChatCollection)().then((e=>{this.hasSynced&&e.length<=5e3&&(0,b.isLegacyWebdBackend)()&&(this.resumePromise=this.runResume(!0))}));return Promise.all([r,i])}return e.then((()=>{this.set({state:ue.SOCKET_STATE.UNPAIRED,refWatcher:(0,N.default)(this.runPromise,this.manageRef())})}))})).then((()=>this.waitForSyncInfo())).finally((()=>{this.refWatcher&&(this.refWatcher.cancel(),this.unset("refWatcher"))})).then(function(){var e=(0,i.default)((function*(e){return x.Cmd.incrementProgress(),__LOG__(2)`ws2:completed ${n.hasSynced?"re-auth":"auth"}`,n.state=ue.SOCKET_STATE.CONNECTED,F.Conn.blockStoreAdds=!1,F.Conn.platform=e.platform,yield(0,Se.default)(),e}));return function(){return e.apply(this,arguments)}}()).then((function(e){return __LOG__(2)`ws2:main loaded`,e.initial=!0,(0,j.default)([e])})).then((()=>(0,ee.initialize)().catch((e=>{__LOG__(3)`Error initializing database during sync: ${e}`,__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("Error initializing database during sync")})))).then((()=>{const e=this.openStream();return this.streamPromise=e,e})).then((function(){return new K.default})).catch((0,y.filteredCatch)(O.SocketClosed,(function(e){throw e.event instanceof Ue?e.event:e}))).catch((e=>{__LOG__(3)`ws2:run loop interrupt: ${e}`,this.set({canSend:!1,stream:ue.SOCKET_STREAM.DISCONNECTED,runPromise:null}),this.phoneWatchdog.deactivate(),this.streamPromise&&(this.streamPromise.cancel(),this.unset("streamPromise")),this.socketWatcher&&(this.socketWatcher.cancel(),this.unset("socketWatcher"));const t=this.socket;if(t&&t.state!==ue.WATCHED_SOCKET_STATE.CLOSED&&(t.detachCallbacks(),t.close(!0,e)),this.unset("socket"),this.shouldUpgradeToMDIntern)return x.Cmd.upgradeToMDInternal(),!1;if(this.shouldUpgradeToMDPord)return x.Cmd.upgradeToMDProd(),!1;throw e})).catch((0,y.filteredCatch)(O.UpdateImmediately,(e=>{throw this.updateImmediately(e.message),new Me}))).catch((0,y.filteredCatch)(O.DeprecatedProtocolVersion,(()=>this.deprecatedVersion()))).catch((0,y.filteredCatch)([T.E401,xe],(function(){return!1}))).catch((0,y.filteredCatch)(Ne,(()=>(this.clearState(),!1)))).catch((0,y.filteredCatch)([O.SocketClosed,O.SocketError,We],(()=>!0))).catch((0,y.filteredCatch)(Le,function(){var e=(0,i.default)((function*(){return __LOG__(3)`ws2:sync rejected, logging out`,yield n.sendCurrentLogout(null,X.LogoutReason.UnknownCompanion),yield n.clearCredentialsAndStoredData(),x.Cmd.logout(),!1}));return function(){return e.apply(this,arguments)}}())).catch((0,y.filteredCatch)([Oe,Ke],function(){var e=(0,i.default)((function*(e){return __LOG__(2)`ws2:phone disassociated via ${String(e)}`,yield n.clearCredentialsAndStoredData(),x.Cmd.logout(),!1}));return function(){return e.apply(this,arguments)}}())).catch((0,y.filteredCatch)(Ye,(0,i.default)((function*(){return __LOG__(3,void 0,void 0,!0)`ws2:No secret bundle!`,SEND_LOGS("no-secret-bundle"),yield n.clearCredentialsAndStoredData(),x.Cmd.logout(),!1})))).catch((0,y.filteredCatch)(ke,(()=>(this.state=ue.SOCKET_STATE.UNPAIRED_IDLE,this.setPokeable((0,ve.default)().then((()=>{throw new Ge})).catch((0,y.filteredCatch)(Pe,(()=>!1)))))))).catch((0,y.filteredCatch)(O.BlockedByProxy,(()=>(M.default.promptUnloadGuards++,this.state=ue.SOCKET_STATE.PROXYBLOCK,this.setPokeable((new K.default).catch((0,y.filteredCatch)(Pe,(()=>!1))).finally((function(){M.default.promptUnloadGuards--}))))))).catch((0,y.filteredCatch)(we,(e=>{__LOG__(2)`ws2:denied tos`;const t=this.setPokeable((new K.default).cancellable().catch((0,y.filteredCatch)(Pe,(()=>!1)))).cancellable(),n=e instanceof Re?ue.SOCKET_STATE.TOS_BLOCK:ue.SOCKET_STATE.SMB_TOS_BLOCK;return this.clearState(),this.set({state:n,runPromise:t}),t}))).catch((0,y.filteredCatch)([Ie,je],(e=>{e instanceof Ie?__LOG__(2)`ws2:phone denied (conflict)`:__LOG__(2)`ws2:phone replaced`;const t=(new K.default).cancellable();return this.set({state:ue.SOCKET_STATE.CONFLICT,conflictPromise:t,runPromise:t}),this.clearState(),t}))).finally((()=>{this.conflictPromise&&this.conflictPromise.cancel()})).catch((0,y.filteredCatch)([Ue,Ge],(function(){return!1})))}openSocket(){const e=this.socketPreload;if(this.socketPreload=null,(null==e?void 0:e.socket)&&e.socket.state===ue.WATCHED_SOCKET_STATE.OPEN)return Promise.resolve(e.socket);const t=e&&e.active?e:new pe.default,n=()=>{this.retryTimestamp=t.retryTimestamp};t.on("change:retryTimestamp",n),this.pokeable=t;const r=(0,Ee.default)(t,"change:socket").cancellable().then((()=>t.socket)).finally((()=>{t.off("change:retryTimestamp",n),t.onerror=null,t.deactivate(),this.pokeable=null}));return t.onerror=e=>{r.cancel(e)},r}initConn(){var e=this;return(0,i.default)((function*(){const t=e.tag("init"),n=M.default.info(),r=[Number("2"),Number("2210"),Number("9")];e._basicSend({tag:t,data:["admin","init",r,[n.os||"Unknown",n.name||"Unknown",n.version||"Unknown"],M.default.id(),!e.isIncognito&&!!(0,ae.getRememberMe)()]},"init");const i=yield e.socket.nextMessage(Ve.TAG(t)).get("data");C.Clock.setSkew(Date.now()-i.time),(0,j.default)([{id:"1",ref:i.ref,refTTL:i.ttl}])}))()}manageRef(){var e=this;return(0,S.promiseLoop)(function(){var t=(0,i.default)((function*(t,n,r){const i=F.Conn.refExpiry-Date.now()-500,a=(yield(0,E.delayMs)(Math.max(i,0)).cancellable().then((()=>{if(r>=5)throw new ke;__LOG__(2)`ws2:Requesting Ref Update`;const t=e.tag("qr"+r);return e._basicSend({tag:t,data:["admin","Conn","reref"]},"reref"),e.socket.nextMessage(Ve.TAG(t))}))).data;switch(a.status){case 200:return __LOG__(2)`ws2:Updating Ref`,void(0,j.default)([{ref:a.ref,refTTL:a.ttl}]);case 304:return __LOG__(2)`ws2:Keeping Ref`,void t();case 429:throw __LOG__(2)`ws2:Server denied new ref`,new ke;default:throw __LOG__(3)`ws2:Bad Ref Response!`,new Be("unrecognized ref request status ("+a.status+")")}}));return function(){return t.apply(this,arguments)}}()).cancellable()}requestSync(e){if(this.syncTag=this.tag("sync"),!se.load())return Promise.reject(new Ye);const{client:t,server:n}=(0,$.getLoginTokens)(),r=["admin","login",t,n,M.default.id()];e?r.push("takeover"):this.hasSynced&&(r.push(this.shouldForceReconnect?"force_reconnect":"reconnect"),r.push((0,$.getMaybeMeUser)()));const i=()=>(this._basicSend({tag:this.syncTag,data:r},"sync"),!0),a=new be.Watchdog({waitAlgorithm:(0,be.fibonacci)(0,8500,6e4),onTimeout:i});a.on("change:ts",(()=>{this.retryTimestamp=a.ts})),this.pokeable=a,a.activate(),i();const o=this.socket.nextMessage(Ve.TAG(this.syncTag)),s=this.lookForAndHandleChallenge().catch((0,h.catchAbort)((()=>{}))).catch(o.cancel.bind(o));return o.then((e=>{__LOG__(2)`ws2:login`;const t=e.data;switch(t.status){case 200:return e;case 401:throw new Oe;case 403:throw t.tos>=2?new Re:t.smbTos?new De:new Le;case 405:throw __LOG__(3,void 0,void 0,!0)`ws2:Already authorized!`,SEND_LOGS("already-authorized"),new Ne;case 409:throw new Ie;case 500:throw new We;default:throw __LOG__(3)`ws2:unknown error! status:${t.status}`,new Le}})).finally((()=>{s.cancel(),a.deactivate(),this.unset("pokeable"),this.unset("retryTimestamp")}))}waitForSyncInfo(){var e=this;return(0,i.default)((function*(){return(yield e.socket.nextMessage(Ve.SYNC_INFO)).data[1]}))()}lookForAndHandleChallenge(){var e=this;return(0,i.default)((function*(){const t=yield e.socket.nextMessage(Ve.CHALLENGE).then((function(e){__LOG__(2)`ws2:challenged!`;const t=(0,_.decodeB64)(e.data[1].challenge);return se.getSecurityToken(t)})).then((t=>{const n=(0,$.getLoginTokens)(),r=n?n.server:void 0;if(!r)throw __LOG__(3)`ws2:handleChallenge no server token!`,new Error("Handle challenge no server token");const i=e.tag("challenge");return e._basicSend({tag:i,data:["admin","challenge",t,r,M.default.id()]},"challenge"),e.socket.nextMessage(Ve.TAG(i))}));return t.data.status>=500?Promise.reject(new We):t.data.status>=400?(__LOG__(3)`ws2:handleChallenge failed challenge!`,Promise.reject(new Oe)):void __LOG__(2)`ws2:handleChallenge passed challenge`}))()}throwOnClose(){return this.socket.nextMessage(Ve.DISCONNECT).then((function(e){throw"replaced"===e.data[1].kind?new je:new Ke}))}onCriticalSyncDone(){(0,b.isMDBackend)()&&(__LOG__(2)`[ws2] moving to main screen from onCriticalSyncDone`,this.set({hasSynced:!0,stream:ue.SOCKET_STREAM.CONNECTED}))}openStream(){var e=this;return(0,i.default)((function*(){if((0,b.isMDBackend)()){return(0,$.getMeUser)()&&(F.Conn.blockStoreAdds=!1,F.Conn.id="1",F.Conn.trigger("me_ready")),void(yield(0,L.addMeToContacts)())}let t;if(e.canSend=!0,e.hasSynced)e.resumePromise||(e.resumePromise=e.runResume(!1)),t=e.resumePromise.finally((()=>{e.unset("resumePromise")}));else{const r=(0,Z.requireContactCollection)().then((e=>e.sync()));if(t=(0,Z.requireChatCollection)().then((e=>e.sync())).cancellable().then((()=>(e.set({hasSynced:!0,stream:ue.SOCKET_STREAM.CONNECTED}),(0,Z.requireStickerPackCollection)().then((e=>{e.preFetch()})).catch((e=>{__LOG__(3)`Error: prefetch StickerPacks\n${e.stack}`})),z.GK.supportsFeature(z.GK.F.USER_NOTICE)&&ne.default.sync(),z.GK.supportsFeature(z.GK.F.SETTINGS_SYNC)&&ce.default.sync(),r))).catch((t=>{throw e.set({hasSynced:!1,stream:ue.SOCKET_STREAM.DISCONNECTED}),t})).catch((0,h.catchAbort)((()=>{}))),(0,Z.requireStatusV3Collection)().then((e=>{e.sync()})),F.Conn.isSMB){if(z.GK.supportsFeature(z.GK.F.QUICK_REPLIES_QUERY)){n(99662).QuickReplyCollection.sync()}(0,q.canDisplayLabel)()&&(0,Z.requireLabelCollection)().then((e=>{e.sync()}))}}try{return yield(0,Z.requireMsgCollection)().cancellable().then((e=>{e.markAllAsStale()})),e.stream=e.hasSynced?ue.SOCKET_STREAM.RESUMING:ue.SOCKET_STREAM.SYNCING,e.socket.onmessage=e.onMessage.bind(e),e.socket.releaseMessages(),t}catch(e){return(0,h.catchAbort)((function(){t.cancel()}))(e)}}))()}queryReceivedActions(){const e=this,t=(0,s.default)(this.sendQueue,"clientCacheable"),r=(0,p.default)(t,"tag").filter((function(e){return e}));return __LOG__(2)`ws2:queryReceivedActions`,0===r.length?Promise.resolve():n(56891).default.queryReceivedActions(r).then((function(n){Array.isArray(n)?n.forEach((function(t){const n=function(e,t){for(let n=t;n<e.length;n++){const t=e[n];if(t.tag)return t}}(e.sendQueue,parseInt(t.id,10)||0);if(n)if(__LOG__(2)`ws2:queryReceivedActions found dup: ${t.id},${t.code}`,delete e.sendHash[t.id],Te.default.delete(t.id),e.sendQueue=(0,o.default)(e.sendQueue,n),n.onSend){const e=n.onSend({status:t.code,_duplicate:!0});$e.test(e)&&n.onDrop(new T.Server5xxDrop)}else __LOG__(3)`ws2:queryReceivedActions onSendDup undefined; should be defined: ${t.id}`,n.onDrop(new T.ConventionViolationDrop);else __LOG__(3)`ws2:queryReceivedActions unknown tag in response: ${t.id}`})):"replaced"===n?(t.forEach((function(e){e.onDrop(new T.BrowserReplacedDrop)})),e.sendQueue=(0,c.default)(e.sendQueue,t)):__LOG__(3)`ws2:queryReceivedActions error`}))}runResume(e){return Promise.all([this.queryReceivedActions(),(0,Z.requireChatCollection)().then((e=>e.resyncMessages())),(0,Z.requireMsgCollection)().then((e=>e.resyncReceipts()))]).then((()=>{this.trigger("didResume"),this.flushQueue(),this.stream=ue.SOCKET_STREAM.CONNECTED})).catch((0,y.filteredCatch)(T.WebdDrop,(()=>{this.stream=ue.SOCKET_STREAM.DISCONNECTED}))).catch((0,h.catchAbort)((()=>{this.stream=ue.SOCKET_STREAM.DISCONNECTED}))).catch((t=>{if(!e)throw __LOG__(3,!0,void 0,!0)`ws2:error during resume, resyncing: ${String(t)}\n${t.stack}`,SEND_LOGS("error-on-resume"),this.stream=ue.SOCKET_STREAM.DISCONNECTED,new Ne;if(this.canSend)return this.runResume(!1);this.unset("resumePromise")}))}setPokeable(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.retryTimestamp;return this.set({pokeable:{poke(){e.cancel(new Pe)}},retryTimestamp:t}),e}clearCredentials(){var e=this;return(0,i.default)((function*(){(0,ae.updatePreservedUserKeys)();let t=!1;try{t=yield e.clearState()}catch(e){t=!0}try{(0,$.setBrowserId)()}catch(e){t=!0,__LOG__(4,void 0,new Error,void 0,["logout"])`ws2:clearState error ${e}`}try{(0,$.setUnknownId)()}catch(e){__LOG__(4,void 0,new Error,void 0,["logout"])`ws2:setUnknownId error ${e}`}try{(0,$.setMe)()}catch(e){t=!0,__LOG__(4,void 0,new Error,void 0,["logout"])`ws2:setMe error ${e}`}if((0,b.isMDBackend)()){try{(0,te.clearRegistrationInfo)()}catch(e){t=!0,__LOG__(4,void 0,new Error,void 0,["logout"])`ws2:clearRegistrationInfo error ${e}`}try{yield(0,de.destroy)()}catch(e){t=!0,__LOG__(4,void 0,new Error,void 0,["logout"])`ws2:destroySignal error ${e}`}try{yield(0,H.deleteEncKeysAndCache)();(0,n(52927).cn)()}catch(e){t=!0}}else{try{(0,$.clearTokens)()}catch(e){t=!0,__LOG__(4,void 0,new Error,void 0,["logout"])`ws2:clearTokens error ${e}`}try{se.clear()}catch(e){t=!0,__LOG__(4,void 0,new Error,void 0,["logout"])`ws2:SecretBundle clear error ${e}`}}try{yield(0,ae.clearAllLocalState)()}catch(e){t=!0,__LOG__(4,void 0,new Error,void 0,["logout"])`ws2:clearAllLocalState error ${e}`}return t}))()}clearState(){var e=this;return(0,i.default)((function*(){__LOG__(2)`ws2:clearState`;let t=!1;e.sendQueue=[],e.clearSendHash(!0),e.unset("hasSynced");try{(yield(0,Z.requireClearAppStates)())()}catch(e){t=!0,e instanceof O.DbOnLogoutAbort?__LOG__(3)`ws2:clearState failed due to DB operations aborted: ${e.stack}`:(__LOG__(4,void 0,new Error,!0)`ws2:clearState error ${e.stack}`,SEND_LOGS("clear_session_app_state"))}try{yield(0,U.default)()}catch(e){t=!0,e instanceof O.DbOnLogoutAbort?__LOG__(3)`ws2:clearState failed due to DB operations aborted: ${e.stack}`:(__LOG__(4,void 0,new Error,!0)`ws2:clearState error ${e.stack}`,SEND_LOGS("clear_persistent_app_state"))}return t}))()}maybeResendRequestEventually(e){const t=300*he.expBackoff(e.resends,100);__LOG__(2)`ws2:Resending ${e.toString()} in ${t}ms`,e.state=oe.default.STATE.WILL_RETRY,e.resendTimer=setTimeout((()=>{e.resends++,e.resendTimer=void 0,this.sendHash[e.tag]===e&&(!e.resendGuard||e.resendGuard()?this._send(e):e.onSend({status:408}))}),t)}sendCurrentLogout(e,t){let r;if((0,b.isMDBackend)())r=(0,_e.unpairDevice)(t).then((e=>{200!==e.status&&__LOG__(3)`ws2:multi-device logout failed with error code ${e.status}`,(0,B.stopComms)()})).catch((e=>{__LOG__(4,!0,new Error)`[CRITICAL] unpairDevice failed with error, preoceed with local logout \n${e.stack}`})),r||(r=Promise.reject(new Error("sendCurrentLogout: should not reach")));else{let t;t=se.load()?n(56891).default.logoutToken().then((e=>{const t={t:(0,$.getLogoutToken)(),m:e},n=(0,$.getOldLogoutCreds)();return n.push(t),(0,$.setOldLogoutCreds)(n),t})):Promise.resolve({}),r=t.then((t=>{if(e&&e.state===ue.WATCHED_SOCKET_STATE.OPEN){let n=this.logoutMutex;this.logoutMutex=n<=0?n=1:++n,__LOG__(2)`ws2:logout through socket`,e.partingSend(new Ue,'goodbye,,["admin","Conn","disconnect"]',(e=>0===e.indexOf("goodbye,"))).then((function(e){e?(__LOG__(2)`ws2:logout through socket success`,Xe(t)):__LOG__(3)`ws2:logout through socket failure, will POST`})).finally((()=>{this.logoutMutex===n&&(this.logoutMutex=0)}))}else this.logoutMutex<0&&(this.logoutMutex=0),this.sendRemainingLogouts()}))}return r}sendRemainingLogouts(){let e=this.logoutMutex;if(0!==e)return;const t=n(11854).default,r=(0,$.getOldLogoutCreds)();0!==r.length?(this.logoutMutex=e=1,Promise.all((0,p.default)(r,function(){var e=(0,i.default)((function*(e){__LOG__(2)`ws2:POST logout`;try{yield t.post("https://web.whatsapp.com/logout",e),Xe(e)}catch(e){__LOG__(3)`ws2:POST logout failure`}}));return function(){return e.apply(this,arguments)}}())).finally((()=>{e===this.logoutMutex&&(this.logoutMutex=0)}))):this.logoutMutex=-1}updateImmediately(e){A.upload({reason:e,immediate:!0}).finally((()=>{ge.Updater.restart(!0)}))}deprecatedVersion(){__LOG__(2)`ws2:deprecated version`,A.upload({reason:"ws2:deprecated version",immediate:!0});const e=this.setPokeable((new K.default).cancellable().catch((0,y.filteredCatch)(Pe,(()=>!1)))).cancellable();return this.clearState(),this.set({state:ue.SOCKET_STATE.DEPRECATED_VERSION,runPromise:e}),e}canRequestBeSent(e){return!!this.canSend||Boolean(this.socket)&&(0,$.knowsPhone)()&&e.serverCacheable}}function Qe(e){return e instanceof g.Binary}function Xe(e){const t=(0,$.getOldLogoutCreds)(),n=(0,a.default)(e);(0,$.setOldLogoutCreds)((0,s.default)(t,(e=>!n(e))))}const Ze=new((0,k.defineModel)(Je));t.Socket=Ze},27086:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.clearInitializePromise=function(){f=null},t.destroy=function(){return(0,s.destroyStorage)().catch((()=>p.resolve(new i.default(s.DATABASE_NAME).delete()))).finally((()=>(f=null,p.resolve(new i.default("fts-storage-dogfooding").delete()))))},Object.defineProperty(t,"getIndexV1Table",{enumerable:!0,get:function(){return l.getTable}}),Object.defineProperty(t,"getIndexV2Table",{enumerable:!0,get:function(){return c.getTable}}),Object.defineProperty(t,"getIndexV3Table",{enumerable:!0,get:function(){return u.getTable}}),Object.defineProperty(t,"getManifestTable",{enumerable:!0,get:function(){return a.getTable}}),Object.defineProperty(t,"getPurgeRangeQueueTable",{enumerable:!0,get:function(){return o.getTable}}),Object.defineProperty(t,"getV2TokenToPrefixMappingTable",{enumerable:!0,get:function(){return d.getTable}}),t.initialize=function(){null==f&&((0,s.createStorage)(),(0,a.addTable)(),(0,l.addTable)(),(0,c.addTable)(),(0,d.addTable)(),(0,o.addTable)(),(0,u.addTable)(),f=(0,s.getStorage)().initialize().catch((e=>{throw __LOG__(4,!0,new Error,!0)`Assertion failed!`,SEND_LOGS("Failed to initialize fts storage"),e})));return f};var i=r(n(86128)),a=n(66991),o=n(69508),s=n(36376),l=n(94831),c=n(57810),d=n(80277),u=n(22812);const p=n(74121).Z;let f},66991:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.TABLE_NAME=t.ManifestKeys=void 0,t.addTable=function(){(0,a.getStorage)().add(l).version((0,s.manifestCreateTable)(),[new o.default("key"),new i.default("tokenizerVersion"),new i.default("schemaVersion"),new i.default("isCurrent"),new i.default("lastMsgKeyViaFullIndexer"),new i.default("isFullIndexingComplete")]).view((e=>e||null))},t.getTable=function(){return(0,a.getStorage)().table(l)};var i=r(n(79051)),a=n(36376),o=r(n(89362)),s=n(43809);const l="manifest";t.TABLE_NAME=l;const c=Object.freeze({PREV_VERSION:"prev.version",CURR_VERSION:"curr.version",NEXT_VERSION:"next.version"});t.ManifestKeys=c},69508:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.TABLE_NAME=void 0,t.addTable=function(){(0,o.getStorage)().add(l).version((0,s.purgeRangeQueueCreateTable)(),[new a.default(["chatId","tsOfLastMessage","startRowId","endRowId"]),new i.default("offset")]).view((e=>e))},t.getTable=function(){return(0,o.getStorage)().table(l)};var i=r(n(79051)),a=r(n(54180)),o=n(36376),s=n(43809);const l="fts-purge-range-queue";t.TABLE_NAME=l},94831:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.TABLE_NAME=void 0,t.addTable=function(){(0,s.getStorage)().add(d).version((0,c.ftsV1IndexCreateTable)(),[new l.default("token"),new o.default("ids"),new a.default("ids"),new o.default("prefixes"),new a.default("prefixes")]).view((e=>e?(0,i.buildEntry)(e.prefixes,e.ids):null))},t.getTable=function(){return(0,s.getStorage)().table(d)};var i=n(96573),a=r(n(92061)),o=r(n(79051)),s=n(36376),l=r(n(89362)),c=n(43809);const d="fts-v1-index";t.TABLE_NAME=d},57810:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.TABLE_NAME=void 0,t.addTable=function(){(0,c.getStorage)().add(u).version((0,d.ftsV2IndexCreateTable)(),[new l.default(["id","chatId","token"]),new s.default("id"),new s.default("chatId"),new s.default("token"),new o.default(["chatId","token"]),new a.default("timestamp"),new o.default(["id","token"])]).view((e=>e?(0,i.buildEntry)(e.id,e.chatId,e.token,e.timestamp):null))},t.getTable=function(){return(0,c.getStorage)().table(u)};var i=n(44152),a=r(n(79051)),o=r(n(34654)),s=r(n(19570)),l=r(n(54180)),c=n(36376),d=n(43809);const u="fts-v2-index";t.TABLE_NAME=u},80277:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.TABLE_NAME=void 0,t.addTable=function(){(0,o.getStorage)().add(c).version((0,l.ftsV2TokenToPrefixesCreateTable)(),[new s.default("token"),new a.default("prefixes"),new i.default("prefixes")]).view((e=>e||null))},t.getTable=function(){return(0,o.getStorage)().table(c)};var i=r(n(92061)),a=r(n(79051)),o=n(36376),s=r(n(89362)),l=n(43809);const c="fts-v2-token-prefixes";t.TABLE_NAME=c},22812:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.TABLE_NAME=void 0,t.addTable=function(){(0,c.getStorage)().add(u).version((0,d.ftsV3IndexCreateTable)(),[new l.default("ftsRowId"),new o.default("id"),new s.default("id"),new o.default("chatId"),new s.default("chatId"),new o.default("timestamp"),new o.default("prefixes"),new a.default("prefixes")]).view((e=>e?(0,i.buildDBEntry)(e.ftsRowId,e.id,e.chatId,e.timestamp,e.prefixes):null))},t.getTable=function(){return(0,c.getStorage)().table(u)};var i=n(14056),a=r(n(92061)),o=r(n(79051)),s=r(n(19570)),l=r(n(81674)),c=n(36376),d=n(43809);const u="fts-v3-index";t.TABLE_NAME=u},36376:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.DATABASE_NAME=void 0,t.createStorage=function(){const e=new o.default(c);d=new s.Storage(e),d.addErrorHandler(i.default.AbortError,(e=>{e.message.includes("QuotaExceededError")&&l.StorageCmd.trigger("storage_not_enough_space")}))},t.destroyStorage=function(){if(null==d)return Promise.reject(new Error("[fts-storage] Storage should be created first before being destroyed"));return d.purge().then((()=>{d=null})).catch((e=>{throw d=null,e}))},t.getStorage=function(){return(0,a.default)(null!=d,"[fts-storage] Storage should be created first before being accessed"),d};var i=r(n(86128)),a=r(n(41143)),o=r(n(98883)),s=n(37521),l=n(23283);const c="fts-storage";t.DATABASE_NAME=c;let d=null},43809:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ftsV1IndexCreateTable=function(){return(0,r.getStorage)().versions.version(0)},t.ftsV2IndexCreateTable=function(){return(0,r.getStorage)().versions.version(3)},t.ftsV2TokenToPrefixesCreateTable=function(){return(0,r.getStorage)().versions.version(4)},t.ftsV3IndexCreateTable=function(){return(0,r.getStorage)().versions.version(5)},t.manifestCreateTable=function(){return(0,r.getStorage)().versions.version(1)},t.purgeRangeQueueCreateTable=function(){return(0,r.getStorage)().versions.version(2)};var r=n(36376)},16703:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.destroy=function(){return(0,o.destroyStorage)().catch((()=>s.resolve(new i.default(o.DATABASE_NAME).delete()))).finally((()=>{l=null}))},t.initialize=function(){null==l&&((0,o.createStorage)(),(0,a.addTable)(),l=(0,o.getStorage)().initialize().catch((e=>{throw __LOG__(4,!0,new Error,!0)`Assertion failed!`,SEND_LOGS("Failed to initialize jobs storage"),e})));return l};var i=r(n(86128)),a=n(57267),o=n(87758);const s=n(74121).Z;let l},57267:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,l.getStorage)().add("jobs-store").version((0,c.jobsCreateV1Table)(),[new o.default("jobId"),new i.default("type"),new i.default("uniqKey"),new a.default("uniqKey"),new i.default("original"),new i.default("current"),new i.default("step"),new i.default("startTime"),new i.default("endTime"),new i.default("stepHardStartCountAfterTimeout"),new i.default("stepFirstStartTime"),new i.default("waitUntil"),new i.default("backedOffCount"),new i.default("version")]).version((0,c.jobsCreateV2Table)(),[new i.default("stepUnexpectedErrorCount"),new s.default("endTime")]).view((e=>({jobId:e.jobId,type:e.type,uniqKey:e.uniqKey,original:e.original,current:e.current,step:e.step,startTime:e.startTime,stepHardStartCountAfterTimeout:e.stepHardStartCountAfterTimeout,stepFirstStartTime:e.stepFirstStartTime,waitUntil:e.waitUntil,backedOffCount:e.backedOffCount,version:e.version,stepUnexpectedErrorCount:e.stepUnexpectedErrorCount})))},t.getTable=function(){return(0,l.getStorage)().table("jobs-store")};var i=r(n(79051)),a=r(n(19570)),o=r(n(81674)),s=r(n(23263)),l=n(87758),c=n(93695)},87758:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.DATABASE_NAME=void 0,t.createStorage=function(){const e=new o.default(c);d=new s.Storage(e),d.addErrorHandler(i.default.AbortError,(e=>{e.message.includes("QuotaExceededError")&&l.StorageCmd.trigger("storage_not_enough_space")}))},t.destroyStorage=function(){if(null==d)return Promise.reject(new Error("[jobs-storage] Storage should be created first before being destroyed"));return d.purge().then((()=>{d=null})).catch((e=>{throw d=null,e}))},t.getStorage=function(){return(0,a.default)(null!=d,"[jobs-storage] Storage should be created first before being accessed"),d};var i=r(n(86128)),a=r(n(41143)),o=r(n(98883)),s=n(37521),l=n(23283);const c="jobs-storage";t.DATABASE_NAME=c;let d=null},93695:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.jobsCreateV1Table=function(){return(0,r.getStorage)().versions.version(0)},t.jobsCreateV2Table=function(){return(0,r.getStorage)().versions.version(1)};var r=n(87758)},98883:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(48926)),a=r(n(45095)),o=n(66751),s=r(n(86128)),l=r(n(41143)),c=n(86445),d=n(12669),u=n(78585);s.default.Promise.PSD.onunhandled=()=>{};const p=n(74121).Z;function f(){return(f=(0,i.default)((function*(e,t,n,r){if(!d.DbEncKeyStore)throw new Error("feature is not yet implemented");const i=r?d.DbEncKeyStore.dbMsgEncKeys[d.DbEncKeyStore.dbMsgEncKeys.length-1]:d.DbEncKeyStore.encKeys[d.DbEncKeyStore.encKeys.length-1],a=new Uint8Array(16);self.crypto.getRandomValues(a);const o=n===c.ENCRYPTED_VALUE_TYPE.STRING?(new TextEncoder).encode(e):e;try{const e=self.crypto.subtle.encrypt({iv:a,name:d.DB_ENCRYPTION_CIPHER},i.key,o),t=null==s.default.currentTransaction?e:s.default.waitFor(e);return{_data:yield p.resolve(t),iv:a,_keyId:i.id}}catch(e){throw v(e,"encryptDbMaterial",null),e}}))).apply(this,arguments)}function h(){return(h=(0,i.default)((function*(e,t,n,r){if(!d.DbEncKeyStore)throw new Error("feature is not yet implemented");const{_data:i,iv:a,_keyId:o}=e,u=r?d.DbEncKeyStore.dbMsgEncKeys.filter((e=>e.id===o))[0]:d.DbEncKeyStore.encKeys.filter((e=>e.id===o))[0];if((0,l.default)(null!=u,"Encryption key id not found"),null==i)return i;try{const e=self.crypto.subtle.decrypt({iv:a,name:d.DB_ENCRYPTION_CIPHER},u.key,i),t=null==s.default.currentTransaction?e:s.default.waitFor(e),r=yield p.resolve(t);return n===c.ENCRYPTED_VALUE_TYPE.STRING?new TextDecoder("utf-8").decode(r):r}catch(e){throw v(e,"encryptDbMaterial",null),e}}))).apply(this,arguments)}class _{constructor(e,t,n,r,i,a){this.table=e,this.view=n,this.db=t,this.propFilter=r,this.tableEncryptedColumns=new Map(Object.keys(i).map((e=>[e,i[e]]))),this.shouldUseDbMsgEncKeyForEncryptedCol=a}asyncView(e){var t=this;let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return(0,i.default)((function*(){if(!t._hasEncryptedColumn()||!n)return t.view(e);const r=yield t._decryptColumns(e);return t.view(r)}))()}_decryptColumns(e){var t=this;return(0,i.default)((function*(){(0,l.default)("object"==typeof e,"Called `_decryptColumns` with primitive value");const n=Array.from(t.tableEncryptedColumns.entries()).map((n=>{let[r,i]=n;const a=e[r];return(null==a?void 0:a._data)&&(null==a?void 0:a.iv)?function(){return h.apply(this,arguments)}(a,r,i,t.shouldUseDbMsgEncKeyForEncryptedCol).then((t=>{e[r]=t})):a}));return yield Promise.all(n),e}))()}_encryptColumns(e){const t=Array.from(this.tableEncryptedColumns.entries()).map((t=>{let[n,r]=t;const i=e[n];return null==i?i:function(){return f.apply(this,arguments)}(i,n,r,this.shouldUseDbMsgEncKeyForEncryptedCol).then((t=>{e[n]=t}))}));return Promise.all(t).then((()=>e))}_addAndEncrypt(e){var t=this;return(0,i.default)((function*(){if(!t._hasEncryptedColumn())return t.table.add(e);const n=yield t._encryptSingleUpdate(e);return t.table.add(n)}))()}_putAndEncrypt(e){var t=this;return(0,i.default)((function*(){if(!t._hasEncryptedColumn())return t.table.put(e);const n=yield t._encryptColumns(e);return t.table.put(n)}))()}_bulkAddAndEncrypt(e){return this._hasEncryptedColumn()?this._encryptBulkUpdates(e).then((e=>this.table.bulkAdd(e))):this.table.bulkAdd(e)}_bulkPutAndEncrypt(e){return this._hasEncryptedColumn()?s.default.waitFor(this._encryptBulkUpdates(e)).then((e=>this.table.bulkPut(e))):this.table.bulkPut(e)}_encryptBulkUpdates(e){if(!this._hasEncryptedColumn())return p.resolve(e);const t=[],n=e.map(((e,n)=>this._encryptColumns(e).then((e=>{t[n]=e}))));return Promise.all(n).then((()=>t))}_encryptSingleUpdate(e){var t=this;return(0,i.default)((function*(){if(!t._hasEncryptedColumn())return e;return yield t._encryptColumns(e)}))()}asyncViewMap(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this._hasEncryptedColumn()||!t)return Promise.resolve(e.map((e=>e?this.view(e):null)));const n=e.map((e=>null!=e?this.asyncView(e):p.resolve(null)));return p.resolve(null==s.default.currentTransaction?Promise.all(n):s.default.waitFor(Promise.all(n)))}preflightEncryptSingleRecord(e){return this.tableEncryptedColumns,Object.keys(e).forEach((t=>{this.tableEncryptedColumns.has(t)||delete e[t]})),this._encryptColumns(e)}postflightDecryptSingleRecord(e){var t=this;return(0,i.default)((function*(){const n=yield t._decryptColumns(e);return t.view(n)}))()}bulkCreateWith_ALREADY_ENCRYPTED_RECORDS_ONLY(e){return T(e,this.tableEncryptedColumns),p.resolve(this.table.bulkAdd(e)).catch((e=>{throw v(e,"bulkCreateWith_ALREADY_ENCRYPTED_RECORDS_ONLY",this.table.name),e}))}bulkCreateOrReplace_ALREADY_ENCRYPTED_RECORDS_ONLY(e){return T(e,this.tableEncryptedColumns),p.resolve(this.table.bulkPut(e)).catch((e=>{throw v(e,"bulkCreateOrReplace",this.table.name),e}))}create(e){const t=this.propFilter(e);return p.resolve(this._addAndEncrypt(t)).catch((e=>{throw v(e,"create",this.table.name),e}))}createOrReplace(e){const t=this.propFilter(e);return p.resolve(this._putAndEncrypt(t)).catch((e=>{throw v(e,"createOrReplace",this.table.name),e}))}createOrMerge(e,t){var n=this;return(0,i.default)((function*(){const r=n.propFilter(t),i=yield n._encryptColumns(r);return p.resolve(n.db.transaction("rw",n.table,(()=>n.table.where(":id").equals(e).modify((e=>{Object.assign(e,i)})).then((e=>{if(1!==e)return n.table.add(i)})))).then((()=>{}))).catch((e=>{throw v(e,"createOrMerge",n.table.name),e}))}))()}get(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return p.resolve(this.table.get(e)).then((e=>e?this.asyncView(e,t):null)).catch((e=>{throw v(e,"get",this.table.name),e}))}merge(e,t){var n=this;return(0,i.default)((function*(){const r=n.propFilter(t),i=yield n._encryptSingleUpdate(r);return p.resolve(n.table.update(e,i)).catch((e=>{throw v(e,"merge",n.table.name),e}))}))()}remove(e){return p.resolve(this.table.delete(e)).catch((e=>{throw v(e,"remove",this.table.name),e}))}bulkCreate(e){const t=e.map((e=>this.propFilter(e)));return this._hasEncryptedColumn()?p.resolve(this.db.transaction("rw",this.table,(()=>this._bulkAddAndEncrypt(t)))).catch((e=>{throw v(e,"bulkCreate",this.table.name),e})):p.resolve(this.table.bulkAdd(t))}bulkCreateOrReplace(e){const t=e.map((e=>this.propFilter(e)));return this._hasEncryptedColumn()?p.resolve(this.db.transaction("rw",this.table,(()=>this._bulkPutAndEncrypt(t)))).catch((e=>{throw v(e,"bulkCreateOrReplace",this.table.name),e})):p.resolve(this.table.bulkPut(t))}bulkCreateOrMerge(e){var t=this;return(0,i.default)((function*(){const n=new Map,r=t._primaryKey();function a(){return(a=(0,i.default)((function*(e){const n=t.table.where(":id").anyOf(Array.from(e.keys()));yield n.modify((t=>{Object.assign(t,e.get(t[r])),e.delete(t[r])}));return Array.from(e.values())}))).apply(this,arguments)}return(yield t._encryptBulkUpdates(e)).forEach((e=>{const i=t.propFilter(e);(0,l.default)(r in i,"Called `bulkCreateOrMerge` with item(s) not including the primary key"),n.set(i[r],i)})),p.resolve(t.db.transaction("rw",t.table,(()=>function(){return a.apply(this,arguments)}(n).then((e=>0===e.length?p.resolve():t.table.bulkPut(e)))))).catch((e=>{throw v(e,"bulkCreateOrMerge",t.table.name),e}))}))()}bulkGet(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return 0===e.length?p.resolve([]):p.resolve(this.db.transaction("r",this.table,(()=>{const t=e.map((e=>this.table.get(e)));return s.default.Promise.all(t)}))).then((e=>this.asyncViewMap(e,t))).catch((e=>{throw v(e,"bulkGet",this.table.name),e}))}bulkRemove(e){return 0===e.length?p.resolve():p.resolve(this.db.transaction("rw",this.table,(()=>this.table.bulkDelete(e)))).catch((e=>{throw v(e,"bulkRemove",this.table.name),e}))}bulkRemoveByIndex(e,t){return 0===t.length?p.resolve():p.resolve(E(this.table.where(y(e)).anyOf(t)).delete()).catch((e=>{throw v(e,"bulkRemoveByIndex",this.table.name),e}))}all(e,t){let n=E(this.table.orderBy((null==e?void 0:e.index)?y(e.index):":id"),e);t&&(n=n.until(t));let r=null;switch(null==e?void 0:e.returnKeyType){case"keys":r=p.resolve(n.keys());break;case"primary_key":r=p.resolve(n.primaryKeys());break;default:r=p.resolve(n.toArray()).then((t=>this.asyncViewMap(t,null==e?void 0:e.shouldDecrypt)))}return r.catch((e=>{throw v(e,"all",this.table.name),e}))}count(){return p.resolve(this.table.count()).catch((e=>{throw v(e,"count",this.table.name),e}))}bulkDeleteRange(e,t,n,r){return E(this.table.where(y(e)).between(t,n,!!(null==r?void 0:r.lowerInclusive),!!(null==r?void 0:r.upperInclusive)),r).delete().catch((e=>{throw v(e,"bulkDeleteRange",this.table.name),e}))}equals(e,t,n){return p.resolve(E(this.table.where(y(e)).equals(t),n).toArray()).then((e=>this.asyncViewMap(e,null==n?void 0:n.shouldDecrypt))).catch((e=>{throw v(e,"equals",this.table.name),e}))}anyOf(e,t,n){return 0===t.length?p.resolve([]):p.resolve(E(this.table.where(y(e)).anyOf(t),n).distinct().toArray()).then((e=>this.asyncViewMap(e,null==n?void 0:n.shouldDecrypt))).catch((e=>{throw v(e,"anyOf",this.table.name),e}))}startsWithAnyOf(e,t,n){return 0===t.length?p.resolve([]):p.resolve(E(this.table.where(y(e)).startsWithAnyOf(t),n).distinct().toArray()).then((e=>this.asyncViewMap(e,null==n?void 0:n.shouldDecrypt))).catch((e=>{throw v(e,"startsWithAnyOf",this.table.name),e}))}greaterThan(e,t,n){const r=(null==n?void 0:n.inclusive)?this.table.where(y(e)).aboveOrEqual(t):this.table.where(y(e)).above(t);return p.resolve(E(r,n).toArray()).then((e=>this.asyncViewMap(e,null==n?void 0:n.shouldDecrypt))).catch((e=>{throw v(e,"greaterThan",this.table.name),e}))}lessThan(e,t,n){const r=(null==n?void 0:n.inclusive)?this.table.where(y(e)).belowOrEqual(t):this.table.where(y(e)).below(t);return p.resolve(E(r,n).toArray()).then((e=>this.asyncViewMap(e,null==n?void 0:n.shouldDecrypt))).catch((e=>{throw v(e,"lessThan",this.table.name),e}))}between(e,t,n,r,i){const a=E(this.table.where(y(e)).between(t,n,!!(null==r?void 0:r.lowerInclusive),!!(null==r?void 0:r.upperInclusive)),r);let o=null;switch(null==r?void 0:r.returnKeyType){case"keys":o=p.resolve(a.keys());break;case"primary_key":o=p.resolve(a.primaryKeys());break;default:o=i?p.resolve(a.until(i).toArray()).then((e=>this.asyncViewMap(e,null==r?void 0:r.shouldDecrypt))):p.resolve(a.toArray()).then((e=>this.asyncViewMap(e,null==r?void 0:r.shouldDecrypt)))}return o.catch((e=>{throw v(e,"between",this.table.name),e}))}forEachSortedBy(e,t){var n=this;return this.table.orderBy(e).each(function(){var e=(0,i.default)((function*(e){const r=yield n._decryptColumns(e);return t(r)}));return function(){return e.apply(this,arguments)}}()).catch((e=>{throw v(e,"forEachSortedBy",this.table.name),e}))}forEach(e){var t=this;return this.table.each(function(){var n=(0,i.default)((function*(n){const r=yield t._decryptColumns(n);return e(r)}));return function(){return n.apply(this,arguments)}}()).catch((e=>{throw v(e,"forEach",this.table.name),e}))}clear(){return p.resolve(this.table.clear()).catch((e=>{throw v(e,"clear",this.table.name),e}))}_primaryKey(){return this.table.schema.primKey.name}_hasEncryptedColumn(){return this.tableEncryptedColumns.size>0}}function g(e){if(e.length>1)return e.forEach((e=>{(0,l.default)(e.primaryKey&&e.primaryKey===u.PRIMARY_KEY_TYPE.COMPOSITE,"Invalid column passed to `formatPrimaryKey`")})),`[${e.map((e=>e.name)).join("+")}]`;const t=e[0];return(0,l.default)(t.primaryKey&&t.primaryKey!==u.PRIMARY_KEY_TYPE.COMPOSITE,"Invalid column passed to `formatPrimaryKey`"),t.primaryKey===u.PRIMARY_KEY_TYPE.AUTO_INCREMENT?`${t.name}++`:t.name}function m(e){switch(e.type){case u.INDEX_TYPE.SIMPLE:return e.column;case u.INDEX_TYPE.COMPOSITE:return`[${e.columns.join("+")}]`;case u.INDEX_TYPE.ARRAY:return`*${e.column}`;case u.INDEX_TYPE.UNIQUE:return`&${e.column}`}throw new Error(`Cannot format index of type "${e.type}"`)}function y(e){return 1===e.length?e[0]:`[${e.join("+")}]`}function E(e,t){let n=e;return(null==t?void 0:t.reverse)&&(n=n.reverse()),t&&null!=t.offset&&(n=n.offset(t.offset)),t&&null!=t.limit&&0!==t.limit&&(n=n.limit(t.limit)),n}function S(e){return p.resolve(e)}function v(e,t,n){__LOG__(3,!0)`idb faild to do Operation: ${t} on Table: ${n}. Failed with error ${e}`}function T(e,t){const n=Array.from(t.entries());e.forEach((()=>{n.forEach((t=>{let[n,r]=t;if(e[n]&&!(e[n]._keyId&&e[n]._data&&e[n].iv))throw new Error("[CRITICAL] Records contain unencrypted field")}))}))}t.default=class{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:S;this.tableNames=new Map,this.tableColumns=new Map,this.tableEncryptedColumns=new Map,this.errorHandlers=new Map,this.name=e,this.db=new s.default(this.name),this.transformSchema=t}initialize(e,t,n,r){return r&&(this.errorHandlers=r),function(e,t,n,r,i){return(0,o.promiseReduce)(e,((e,a)=>i((0,u.cloneSchema)(a)).then((i=>{if((0,l.default)(!(i.name in e),"Multiple tables resulted in the same transformed name"),i.deleted)return e[i.name]=null,e;t.set(a.name,i.name),n.set(a.name,i.columns.map((e=>e.name))),r.set(a.name,i.encryptedColumns||{});const o=i.columns.filter((e=>e.primaryKey));(0,l.default)(o.length>=1,`No primary key was defined for "${a.name}"`);const s=[g(o)].concat(i.indexes.map(m)).join(", ");return e[i.name]=s,e}))),{})}(t,this.tableNames,this.tableColumns,this.tableEncryptedColumns,this.transformSchema).then((t=>{this.db.version(e+1).stores(t).upgrade((e=>{var t;if(n)return null===(t=e[n.name])||void 0===t?void 0:t.toCollection().modify(n.callback)}))}))}open(){return p.resolve(this.db.open())}transact(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"rw";return p.resolve(this.db.transaction(n,e,(()=>t()))).catch((e=>{const t=this.errorHandlers.get(e.name);if(!t)throw e;t(e)}))}close(){return this.db.close(),p.resolve()}view(e,t,n,r){(0,l.default)(this.tableNames.has(e),`Attemped to get view for uninitialized table "${e}"`),(0,l.default)(this.tableColumns.has(e),`Attemped to get columns for uninitialized table "${e}"`);const i=n?function(e){if(!e)return e=>e;return t=>{const n={};return e.forEach((e=>{t.hasOwnProperty(e)&&(n[e]=t[e])})),n}}(this.tableColumns.get(e)):e=>e;return new _(this.db.table(this.tableNames.get(e)),this.db,t,i,(0,a.default)(this.tableEncryptedColumns.get(e),"this.tableEncryptedColumns.get(table)"),r)}available(){return p.resolve(!0)}reset(){return this.tableNames=new Map,p.resolve(this.db.delete())}}},76140:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(35232),a=r(n(52991));t.default=class{constructor(e,t){this.errorHandlers=new Map,this._view=e,t&&(this.errorHandlers=t)}_maybeHandleError(e){const t=this.errorHandlers.get(e.name);t&&t(e)}_read(e){if(a.default.isLogoutInProgress)return Promise.reject(new i.DbOnLogoutAbort("dropping db read operation due to logout"));return e(this._view()).catch((e=>{throw this._maybeHandleError(e),e}))}_write(e){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&a.default.isLogoutInProgress)return Promise.reject(new i.DbOnLogoutAbort("dropping db write operation due to logout"));return e(this._view()).catch((e=>{throw this._maybeHandleError(e),e}))}create(e){return this._write((t=>t.create(e)))}preflightEncryptSingleRecord(e){return this._write((t=>t.preflightEncryptSingleRecord(e)))}postflightDecryptSingleRecord(e){return this._write((t=>t.postflightDecryptSingleRecord(e)))}bulkCreateWith_ALREADY_ENCRYPTED_RECORDS_ONLY(e){return this._write((t=>t.bulkCreateWith_ALREADY_ENCRYPTED_RECORDS_ONLY(e)))}bulkCreateOrReplace_ALREADY_ENCRYPTED_RECORDS_ONLY(e){return this._write((t=>t.bulkCreateOrReplace_ALREADY_ENCRYPTED_RECORDS_ONLY(e)))}createOrReplace(e){return this._write((t=>t.createOrReplace(e)))}createOrMerge(e,t){return this._write((n=>n.createOrMerge(e,t)))}get(e){return this._read((t=>t.get(e)))}merge(e,t){return this._write((n=>n.merge(e,t)))}remove(e){return this._write((t=>t.remove(e)))}bulkCreate(e){return this._write((t=>t.bulkCreate(e)))}bulkCreateOrReplace(e){return this._write((t=>t.bulkCreateOrReplace(e)))}bulkCreateOrMerge(e){return this._write((t=>t.bulkCreateOrMerge(e)))}bulkGet(e,t){return this._read((n=>n.bulkGet(e,t)))}bulkRemoveByIndex(e,t){return this._write((n=>n.bulkRemoveByIndex(e,t)))}bulkRemove(e){return this._write((t=>t.bulkRemove(e)))}bulkDeleteRange(e,t,n){return this._write((r=>r.bulkDeleteRange(e,t,n)))}all(e,t){return this._read((n=>n.all(e,t)))}count(){return this._read((e=>e.count()))}equals(e,t,n){return this._read((r=>r.equals(e,t,n)))}anyOf(e,t,n){return this._read((r=>r.anyOf(e,t,n)))}startsWithAnyOf(e,t,n){return this._read((r=>r.startsWithAnyOf(e,t,n)))}greaterThan(e,t,n){return this._read((r=>r.greaterThan(e,t,n)))}lessThan(e,t,n){return this._read((r=>r.lessThan(e,t,n)))}between(e,t,n,r,i){return this._read((a=>a.between(e,t,n,r,i)))}forEachSortedBy(e,t){return this._read((n=>n.forEachSortedBy(e,t)))}forEach(e){return this._read((t=>t.forEach(e)))}clear(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._write((e=>e.clear()),e)}}},67204:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(41143)),a=r(n(73212));class o extends a.default{constructor(e){super(),(0,i.default)("AbstractPrimaryKey"!==this.constructor.name,"Cannot instantiate abstract class AbstractPrimaryKey"),Array.isArray(e)?this.columns=[...e]:this.columns=[e]}validate(e){(0,i.default)(0===e.columns.length,"Attempted to add primary key after other columns")}apply(){throw new Error("Subclass of `AbstractPrimaryKey` must implement `apply` method")}}t.default=o},92061:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(41143)),a=r(n(73212)),o=n(78585);class s extends a.default{constructor(e){super(),this.column=e}validate(e){const t=e.columns.find((e=>e.name===this.column));(0,i.default)(t,`Attempted to add index on non-existent column "${this.column}" in "${e.name}"`),(0,i.default)(t&&(!t.primaryKey||t.primaryKey===o.PRIMARY_KEY_TYPE.COMPOSITE),`Cannot add index on primary key on table "${e.name}"`),(0,i.default)(!e.indexes.some((e=>(e.type===o.INDEX_TYPE.ARRAY||e.type===o.INDEX_TYPE.SIMPLE||e.type===o.INDEX_TYPE.UNIQUE)&&(0,o.indexContainsColumn)(e,this.column))),`Attempted to add index "${this.column}" which already exists in "${e.name}"`)}apply(e){const t=(0,o.cloneSchema)(e);return t.indexes.push(this._getIndex()),t}_getIndex(){return{type:o.INDEX_TYPE.ARRAY,column:this.column}}}t.default=s},79051:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(41143)),a=r(n(73212)),o=n(78585);class s extends a.default{constructor(e){super(),this.name=e}validate(e){(0,i.default)(!e.columns.find((e=>e.name===this.name)),`Attempted to add column "${this.name}" to "${e.name}" but it already exists`)}apply(e){const t=(0,o.cloneSchema)(e);return t.columns.push({name:this.name}),t}}t.default=s},34654:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(41143)),a=r(n(73212)),o=n(78585);class s extends a.default{constructor(e){super(),this.columns=[...e]}validate(e){this.columns.forEach((t=>{(0,i.default)(e.columns.find((e=>e.name===t)),`Attempted to add index on non-existent column "${t}" in "${e.name}"`)})),(0,i.default)(this.columns.length>1,"Attempted to add composite index for only 1 column"),(0,i.default)(-1===(0,o.findIndex)(e,this._getIndex()),`Attempted to add index [${String(this.columns)}], which already exists in "${e.name}"`);const t=e.columns.filter((e=>e.primaryKey&&e.primaryKey===o.PRIMARY_KEY_TYPE.COMPOSITE)).map((e=>e.name));(0,i.default)(t.length!==this.columns.length||t.some((e=>!this.columns.includes(e))),`Attempted to add index [${String(this.columns)}], which already is the primary key in "${e.name}"`)}apply(e){const t=(0,o.cloneSchema)(e);return t.indexes.push(this._getIndex()),t}_getIndex(){return{type:o.INDEX_TYPE.COMPOSITE,columns:this.columns}}}t.default=s},86445:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ENCRYPTED_VALUE_TYPE=t.AddEncryptedColumn=void 0;var i=r(n(41143)),a=r(n(73212)),o=n(78585);const s=Object.freeze({STRING:"String",ARRAY_BUFFER:"ArrayBuffer"});t.ENCRYPTED_VALUE_TYPE=s;class l extends a.default{constructor(e,t){super(),this.name=e,this.dataType=t}validate(e){(0,i.default)(!e.columns.find((e=>e.name===this.name)),`Attempted to add encrypted column "${this.name}" to "${e.name}" but it already exists`)}apply(e){const t=(0,o.cloneSchema)(e);return t.columns.push({name:this.name}),t.encryptedColumns[this.name]=this.dataType,t}}t.AddEncryptedColumn=l},19570:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(41143)),a=r(n(73212)),o=n(78585);class s extends a.default{constructor(e){super(),this.keyPath=e,this.column=e.split(".")[0]}validate(e){const t=e.columns.find((e=>e.name===this.column));(0,i.default)(t,`Attempted to add index on non-existent column "${this.column}" in "${e.name}"`),(0,i.default)(t&&(!t.primaryKey||t.primaryKey===o.PRIMARY_KEY_TYPE.COMPOSITE),`Cannot add index on primary key on table "${e.name}"`),(0,i.default)(!e.indexes.some((e=>(e.type===o.INDEX_TYPE.ARRAY||e.type===o.INDEX_TYPE.SIMPLE||e.type===o.INDEX_TYPE.UNIQUE)&&(0,o.indexContainsColumn)(e,this.column))),`Attempted to add index "${this.column}" which already exists in "${e.name}"`)}apply(e){const t=(0,o.cloneSchema)(e);return t.indexes.push(this._getIndex()),t}_getIndex(){return{type:o.INDEX_TYPE.SIMPLE,column:this.keyPath}}}t.default=s},39043:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(41143)),a=r(n(73212)),o=n(78585);class s extends a.default{constructor(e){super(),this.column=e}validate(e){const t=e.columns.find((e=>e.name===this.column));(0,i.default)(t,`Attempted to add index on non-existent column "${this.column}" in "${e.name}"`),(0,i.default)(t&&(!t.primaryKey||t.primaryKey===o.PRIMARY_KEY_TYPE.COMPOSITE),`Cannot add index on primary key on table "${e.name}"`),(0,i.default)(!e.indexes.some((e=>(e.type===o.INDEX_TYPE.ARRAY||e.type===o.INDEX_TYPE.SIMPLE||e.type===o.INDEX_TYPE.UNIQUE)&&(0,o.indexContainsColumn)(e,this.column))),`Attempted to add index "${this.column}" which already exists in "${e.name}"`)}apply(e){const t=(0,o.cloneSchema)(e);return t.indexes.push(this._getIndex()),t}_getIndex(){return{type:o.INDEX_TYPE.UNIQUE,column:this.column}}}t.default=s},81674:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(41143)),a=r(n(67204)),o=n(78585);class s extends a.default{validate(e){super.validate(e),(0,i.default)(this.columns&&1===this.columns.length,"Attempted to add UserDefinedPrimaryKey over wrong number of columns")}apply(e){const t=(0,o.cloneSchema)(e);return t.columns.unshift({name:this.columns[0],primaryKey:o.PRIMARY_KEY_TYPE.AUTO_INCREMENT}),t}}t.default=s},54180:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(41143)),a=r(n(67204)),o=n(78585);class s extends a.default{validate(e){super.validate(e),(0,i.default)(this.columns&&this.columns.length>1,"Attempted to add composite primary key for only 1 column")}apply(e){const t=(0,o.cloneSchema)(e);return this.columns.forEach((e=>{t.columns.push({name:e,primaryKey:o.PRIMARY_KEY_TYPE.COMPOSITE})})),t}}t.default=s},73212:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(41143));t.default=class{constructor(){(0,i.default)("Mutation"!==this.constructor.name,"Cannot instantiate abstract class Mutation")}validate(){throw new Error("Subclasses of Mutaton must implement `validate`")}apply(){throw new Error("Subclasses of Mutaton must implement `apply`")}}},45441:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(41143)),a=r(n(73212)),o=n(78585);class s extends a.default{constructor(e){super(),this.column=e}validate(e){(0,i.default)(-1!==(0,o.findIndex)(e,this._getIndex()),`Attempted to remove non-existent index "${this.column}" on "${e.name}"`)}apply(e){const t=(0,o.cloneSchema)(e),n=(0,o.findIndex)(e,this._getIndex());return t.indexes.splice(n,1),t}_getIndex(){return{type:o.INDEX_TYPE.ARRAY,column:this.column}}}t.default=s},23263:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(41143)),a=r(n(73212)),o=n(78585);class s extends a.default{constructor(e){super(),this.name=e}validate(e){const t=e.columns.find((e=>e.name===this.name));(0,i.default)(t,`Attempted to remove column "${this.name}" from "${e.name}" but it doesn't exist`),(0,i.default)(!t.primaryKey,`Attempted to remove primary key column "${this.name}". Removing primary keys is not supported.`),(0,i.default)(!e.indexes.some((e=>(0,o.indexContainsColumn)(e,this.name))),`Attempted to remove column "${this.name}" from "${e.name}" but an index exists with the column`)}apply(e){const t=(0,o.cloneSchema)(e);return t.columns.splice(t.columns.findIndex((e=>e.name===this.name)),1),t}}t.default=s},79913:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(41143)),a=r(n(73212)),o=n(78585);class s extends a.default{constructor(e){super(),this.columns=[...e].sort()}validate(e){(0,i.default)(-1!==(0,o.findIndex)(e,this._getIndex()),`Attempted to remove non-existent index [${String(this.columns)}] on "${e.name}"`)}apply(e){const t=(0,o.cloneSchema)(e),n=(0,o.findIndex)(e,this._getIndex());return t.indexes.splice(n,1),t}_getIndex(){return{type:o.INDEX_TYPE.COMPOSITE,columns:this.columns}}}t.default=s},42062:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(41143)),a=r(n(73212)),o=n(78585);class s extends a.default{constructor(e){super(),this.column=e}validate(e){(0,i.default)(-1!==(0,o.findIndex)(e,this._getIndex()),`Attempted to remove non-existent index "${this.column}" on "${e.name}"`)}apply(e){const t=(0,o.cloneSchema)(e),n=(0,o.findIndex)(e,this._getIndex());return t.indexes.splice(n,1),t}_getIndex(){return{type:o.INDEX_TYPE.SIMPLE,column:this.column}}}t.default=s},89362:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(41143)),a=r(n(67204)),o=n(78585);class s extends a.default{validate(e){super.validate(e),(0,i.default)(this.columns&&1===this.columns.length,"Attempted to add UserDefinedPrimaryKey over wrong number of columns")}apply(e){const t=(0,o.cloneSchema)(e);return t.columns.unshift({name:this.columns[0],primaryKey:o.PRIMARY_KEY_TYPE.USER_DEFINED}),t}}t.default=s},5183:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.sortMutations=function(e){return[...e].sort(E)};var i=r(n(41143)),a=r(n(92061)),o=r(n(79051)),s=r(n(34654)),l=n(86445),c=r(n(19570)),d=r(n(39043)),u=r(n(81674)),p=r(n(54180)),f=r(n(45441)),h=r(n(23263)),_=r(n(79913)),g=r(n(42062)),m=r(n(89362));const y=[_.default,f.default,g.default,h.default,u.default,m.default,p.default,o.default,c.default,a.default,s.default,d.default,l.AddEncryptedColumn];function E(e,t){const n=y.indexOf(e.constructor),r=y.indexOf(t.constructor);return(0,i.default)(-1!==n,`Mutation ${e.constructor.name} is not a known mutation type`),(0,i.default)(-1!==r,`Mutation ${e.constructor.name} is not a known mutation type`),n-r}},78585:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.PRIMARY_KEY_TYPE=t.INDEX_TYPE=void 0,t.cloneSchema=function(e){return{name:e.name,columns:e.columns.map((e=>(0,i.default)({},e))),indexes:e.indexes.map(c),encryptedColumns:(0,i.default)({},e.encryptedColumns||{}),deleted:e.deleted}},t.emptySchema=function(e){return{name:e,columns:[],indexes:[],encryptedColumns:{}}},t.findIndex=function(e,t){return e.indexes.findIndex((e=>function(e,t){if(e.type!==t.type)return!1;switch(e.type){case s.SIMPLE:case s.ARRAY:case s.UNIQUE:return(0,a.default)(t.type===e.type,"Index types are not equal"),e.column===t.column;case s.COMPOSITE:return(0,a.default)(t.type===e.type,"Index types are not equal"),e.columns.length===t.columns.length&&!e.columns.some((e=>!t.columns.includes(e)))}throw new Error(`cannot compare unknown indexes of types: ${e.type}, ${t.type}`)}(t,e)))},t.freezeSchema=function(e){return Object.freeze({name:e.name,columns:Object.freeze(e.columns.map(Object.freeze)),indexes:Object.freeze(e.indexes.map(l)),encryptedColumns:Object.freeze((0,i.default)({},e.encryptedColumns||{})),deleted:e.deleted})},t.indexContainsColumn=function(e,t){switch(e.type){case s.SIMPLE:case s.ARRAY:case s.UNIQUE:return e.column===t;case s.COMPOSITE:return!!e.columns.find((e=>e===t))}throw new Error(`cannot check indexes of unknown index type: ${e.type}`)};var i=r(n(81109)),a=r(n(41143));const o=Object.freeze({AUTO_INCREMENT:"auto-increment",USER_DEFINED:"user-defined",COMPOSITE:"composite"});t.PRIMARY_KEY_TYPE=o;const s=Object.freeze({SIMPLE:"simple",COMPOSITE:"composite",ARRAY:"array",UNIQUE:"unique"});function l(e){switch(e.type){case s.SIMPLE:return Object.freeze({type:s.SIMPLE,column:e.column});case s.ARRAY:return Object.freeze({type:s.ARRAY,column:e.column});case s.COMPOSITE:return Object.freeze({type:s.COMPOSITE,columns:Object.freeze(e.columns.map(Object.freeze))});case s.UNIQUE:return Object.freeze({type:s.UNIQUE,column:e.column})}throw new Error(`cannot freeze index of unknown type: ${e.type}`)}function c(e){switch(e.type){case s.SIMPLE:return{type:s.SIMPLE,column:e.column};case s.UNIQUE:return{type:s.UNIQUE,column:e.column};case s.COMPOSITE:return{type:s.COMPOSITE,columns:e.columns.map((e=>e))};case s.ARRAY:return{type:s.ARRAY,column:e.column}}throw new Error(`cannot clone unknown index type: ${e.type}`)}t.INDEX_TYPE=s},90288:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StorageVersionManager=t.MissingVersionError=t.InvalidVersionError=t.DuplicateVersionError=void 0;class n extends Error{constructor(){super(...arguments),this.name="DuplicateVersionError"}}t.DuplicateVersionError=n;class r extends Error{constructor(){super(...arguments),this.name="InvalidVersionError"}}t.InvalidVersionError=r;class i extends Error{constructor(){super(...arguments),this.name="MissingVersionError"}}t.MissingVersionError=i;t.StorageVersionManager=class{constructor(){this.versions=new Set,this._max=-1}claim(e){if(e<0)throw new r("Versions must by greater than or equal to zero!");if(this.versions.has(e))throw new n(`Version #${e} has already been claimed!`);this.versions.add(e),this._max=Math.max(this.getMax(),e)}version(e){if(e<0)throw new r("Versions must by greater than or equal to zero!");return e}validate(){for(let e=0;e<=this.getMax();++e)if(!this.versions.has(e))throw new i(`Schema version #${e} is missing!`)}getMax(){return this._max}}},37521:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.Storage=t.NotInitializedError=t.NoSuchTableError=t.NoSuchDatabaseError=t.NoFallbackError=t.DuplicateTableError=t.DuplicateDatabaseError=t.AlreadyInitializedError=void 0;var i=r(n(48926)),a=r(n(76140)),o=n(90288),s=r(n(26196));class l extends Error{constructor(){super(...arguments),this.name="AlreadyInitializedError"}}t.AlreadyInitializedError=l;class c extends Error{constructor(){super(...arguments),this.name="DuplicateDatabaseError"}}t.DuplicateDatabaseError=c;class d extends Error{constructor(){super(...arguments),this.name="DuplicateTableError"}}t.DuplicateTableError=d;class u extends Error{constructor(){super(...arguments),this.name="NoFallbackError"}}t.NoFallbackError=u;class p extends Error{constructor(){super(...arguments),this.name="NoSuchDatabaseError"}}t.NoSuchDatabaseError=p;class f extends Error{constructor(){super(...arguments),this.name="NoSuchTableError"}}t.NoSuchTableError=f;class h extends Error{constructor(){super(...arguments),this.name="NotInitializedError"}}t.NotInitializedError=h;t.Storage=class{constructor(e){this.tables=new Map,this.views=new Map,this.state=1,this.versions=new o.StorageVersionManager,this.errorHandlers=new Map,this._database=e}addErrorHandler(e,t){const n=(new e).name;this.errorHandlers.set(n,t)}add(e){if(this.tables.has(e))throw new d(`Table "${e}" already added. Reuse the definition.`);const t=new s.default(e,this.versions);return this.tables.set(e,t),t}_getBackingDB(){return this._database}_unsafeGetOrCreateView(e){if(this.views.has(e))return this.views.get(e);const t=this._database.view(e.name,e.rowview,e.shouldEnablePropFilter,e.shouldUseDbMsgEncKeyForEncryptedCol);return this.views.set(e,t),t}_guardInitializedThunk(e){return()=>{if(3&this.state)throw new h("Storage must be initialized before accessing a table!");return e()}}table(e){const t=this.tables.get(e);if(!t)throw new f(`Unknown table ${e} requested, ensure table is defined!`);if(!this._getBackingDB())throw new p(`Unable to find associated database with table "${e}"`);return new a.default(this._guardInitializedThunk((()=>this._unsafeGetOrCreateView(t))),this.errorHandlers)}lock(e,t){if(3&this.state)return Promise.reject(new h("Initialize storage before attempting to lock tables!"));for(let t=0;t<e.length;++t)if(!this.tables.has(e[t]))return Promise.reject(new f(`Requested lock of unknown table "${e[t]}"`));const n=e.map((e=>{const t=this.tables.get(e);if(t)return t;throw new f(`Requested lock of unknown table "${e}"`)})).map((e=>this._unsafeGetOrCreateView(e)));return this._getBackingDB().transact(e,(0,i.default)((function*(){return t(n)}))).finally((()=>{}))}_getUpgraderForCurrentVersion(e,t){for(let n=0;n<e.length;n++)if(e[n].maxVersion===t){const r=e[n].upgraders.get(t);if(r)return{name:e[n].name,callback:r}}}_applyDatabaseVersion(e,t,n){const r=t,i=n.map((e=>e.schema(r))).filter(Boolean);return e.initialize(t,i,this._getUpgraderForCurrentVersion(n,r),this.errorHandlers)}initialize(){var e=this;return(0,i.default)((function*(){if(4&e.state)throw new l("Storage instance has already been initialized");if(e.versions.validate(),!e._database)throw new p(`"${e._database.constructor.name}" failed availability check!`);yield e._database.available();const t=Array.from(e.tables.values()),n=e._getBackingDB();if(t&&n){for(let r=0;r<=e.versions.getMax();r++)yield e._applyDatabaseVersion(n,r,t);yield n.open(),e.state=4}}))()}purge(){return this.state=2,this.views=new Map,this._getBackingDB().reset().then((()=>{}))}}},26196:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(81109)),a=r(n(41143)),o=n(78585),s=n(5183);function l(e){return e}t.default=class{constructor(e,t){this.maxVersion=-1,this.versions=new Map,this.upgraders=new Map,this.shouldEnablePropFilter=!0,this.shouldUseDbMsgEncKeyForEncryptedCol=!1,this.name=e,this.versionManager=t}version(e,t,n){this.versionManager.claim(e),(0,a.default)(!this.versions.has(e),`Table "${this.name}" already has version #${+e} defined!`),(0,a.default)(e>this.maxVersion,`Versions for table ${this.name} must be defined in order`),this.maxVersion=e;const r=this.schema(e)||(0,o.emptySchema)(this.name),i=(0,s.sortMutations)(t).reduce(((e,t)=>(t.validate(e),t.apply(e))),(0,o.cloneSchema)(r));return this.versions.set(e,(0,o.freezeSchema)(i)),this.upgraders.set(e,n),this}delete(e){this.versionManager.claim(e),(0,a.default)(!this.versions.has(e),`Table "${this.name}" already has version #${+e} defined!`),(0,a.default)(e>this.maxVersion,`Versions for table ${this.name} must be defined in order`),this.maxVersion=e;const t=this.schema(e)||(0,o.emptySchema)(this.name),n=(0,i.default)((0,i.default)({},t),{},{deleted:!0});return this.versions.set(e,(0,o.freezeSchema)(n)),this}view(e){return this.rowview=e,this}enablePropFilter(e){return this.shouldEnablePropFilter=e,this}useDbMsgEncKeyForEncryptedCol(e){return this.shouldUseDbMsgEncKeyForEncryptedCol=e,this}schema(e){const t=this.versions.get(e);if(t)return t;const n=Array.from(this.versions.keys()).map(l).sort(((e,t)=>e-t)).filter((t=>t<e)).pop();return n||0===n?this.versions.get(n)||(0,o.emptySchema)(this.name):null}}},29830:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.initialize=void 0;var i=r(n(51463)),a=n(24439);const o=(0,i.default)((()=>(0,a.getStorage)().initialize()));t.initialize=o},3971:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.storePrimaryIndex=t.storeDataIndex=t.IdbArrayBufferTable=void 0;var i=r(n(79051)),a=n(24439),o=r(n(89362));const s="id";t.storePrimaryIndex=s;const l="data";t.storeDataIndex=l;const c="lru-media-array-buffer";(0,a.getStorage)().add(c).version((0,a.getStorage)().versions.version(0),[new o.default(s),new i.default(l)]).view((e=>({id:e.id,data:e.data})));const d=(0,a.getStorage)().table(c);t.IdbArrayBufferTable=d},9362:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.metaInfoSizeIndex=t.metaInfoPrimaryIndex=t.metaInfoDateIndex=t.IdbMetaInfoTable=void 0;var i=r(n(79051)),a=r(n(19570)),o=n(24439),s=r(n(89362));t.metaInfoPrimaryIndex="id";const l="timestamp";t.metaInfoDateIndex=l;const c="size";t.metaInfoSizeIndex=c;const d="lru-media-meta-info";(0,o.getStorage)().add(d).version((0,o.getStorage)().versions.version(1),[new s.default("id"),new i.default(l),new a.default(l)]).version((0,o.getStorage)().versions.version(2),[new i.default(c)]).view((e=>({id:e.id,timestamp:e.timestamp,size:e.size||0})));const u=(0,o.getStorage)().table(d);t.IdbMetaInfoTable=u},24439:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.DATABASE_NAME=void 0,t.createStorage=p,t.destroyStorage=function(){return f.apply(this,arguments)},t.getStorage=function(){return(0,o.default)(null!=u,"[lru-media-storage-idb] Storage should be created first before being accessed"),u};var i=r(n(48926)),a=r(n(86128)),o=r(n(41143)),s=r(n(98883)),l=n(37521),c=n(23283);const d="lru-media-storage-idb";t.DATABASE_NAME=d;let u=null;function p(){const e=new s.default(d);u=new l.Storage(e),u.addErrorHandler(a.default.AbortError,(e=>{e.message.includes("QuotaExceededError")&&c.StorageCmd.trigger("storage_not_enough_space")}))}function f(){return(f=(0,i.default)((function*(){if(null==u)throw new Error("[lru-media-storage-idb] Storage should be created first before being destroyed");try{yield u.purge()}finally{u=null}}))).apply(this,arguments)}p()},34541:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getABPropConfigs=function(){return(0,l.initializeWithoutGKs)().then((()=>(0,a.getTable)().all().then((e=>e))))},t.getConfigValue=function(e){const t=o.ABPropConfigs[e];if(null==t)return __LOG__(4,!0,new Error,!0)`invalid ABProps config name`,SEND_LOGS("invalid ABProps config name: "+e),Promise.reject(new Error("invalid ABProps config name"));const[n,r,i]=t;return(0,l.initializeWithoutGKs)().then((()=>(0,a.getTable)().get(String(n)).then((e=>e?d(e.configValue,r,i):i))))},t.parseConfigValue=d,t.setConfigAccessed=function(e){return(0,c.getStorage)().lock(["abpropConfigs"],function(){var t=(0,i.default)((function*(t){let[n]=t;const r=yield n.get(String(e));null!=r&&!0!==(null==r?void 0:r.hasAccessed)&&(yield n.merge(String(e),{hasAccessed:!0}))}));return function(){return t.apply(this,arguments)}}())},t.updateABPropConfigs=function(e){return(0,c.getStorage)().lock(["abpropConfigs"],function(){var t=(0,i.default)((function*(t){let[n]=t;const r=yield n.all(),i=new Map;r.forEach((e=>{null!=e.configExpoKey&&i.set(e.configCode,{configCode:e.configCode,configValue:e.configValue,configExpoKey:e.configExpoKey,hasAccessed:e.hasAccessed})}));let a=!1;const o=[];e.forEach(((e,t)=>{let n=!1;const r=i.get(String(t));if(r){const i=r.configExpoKey;null!=i&&e.configExpoKey!==i?(s.exposureKeys.delete(i),a=!0,s.accessedConfigs.delete(t)):null!=i&&(n=r.hasAccessed)}o.push({configCode:String(t),configValue:e.configValue,configExpoKey:e.configExpoKey,hasAccessed:n})})),a&&(0,s.updateGlobalExpoKey)(),yield n.clear(),yield n.bulkCreate(o)}));return function(){return t.apply(this,arguments)}}())};var i=r(n(48926)),a=n(32446),o=n(64388),s=n(92182),l=n(23356),c=n(99069);function d(e,t,n){return null==e||null==t?n:"bool"===t?"1"===e||"True"===e||"true"===e:"int"===t?parseInt(e,10):"float"===t?parseFloat(e):e}},38342:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t._cache=void 0,t.addActiveMessageRange=function(){return _.apply(this,arguments)},t.bulkUpdateActiveMessageRanges=function(e){return f.bulkCreateOrReplaceRanges(e)},t.getActiveMessageRanges=function(e){return f.getRangesForChat(e)},t.getActiveRangeAction=function(e,t){switch(e){case"archive":return c.ActiveRangeAction.Archive;case"markChatAsRead":return c.ActiveRangeAction.MarkChatAsRead;case"clearChat":return(null==t?void 0:t.deleteStarred)&&t.deleteMedia?c.ActiveRangeAction.ClearChatDeleteStarredDeleteMedia:(null==t?void 0:t.deleteStarred)&&!t.deleteMedia?c.ActiveRangeAction.ClearChatDeleteStarredKeepMedia:(null==t?void 0:t.deleteMedia)&&!t.deleteStarred?c.ActiveRangeAction.ClearChatKeepStarredDeleteMedia:c.ActiveRangeAction.ClearChatKeepStarredKeepMedia;case"deleteChat":return(null==t?void 0:t.deleteMedia)?c.ActiveRangeAction.DeleteChatDeleteMedia:c.ActiveRangeAction.DeleteChatKeepMedia;default:throw new Error("unsupported active message range action")}},t.removeActiveMessageRange=function(e,t){return f.removeRange(e,t)},t.updateActiveMessageRange=function(e){return f.createOrReplaceRange(e)};var i=r(n(81109)),a=r(n(48926)),o=r(n(45095)),s=n(381),l=n(84902),c=n(69702),d=n(23356),u=n(30986);let p=new Map;const f={reset:()=>{p=new Map},removeRange(e,t){var n;return null===(n=p.get(e))||void 0===n||n.delete(t),(0,d.getActiveMessageRangesTable)().remove([e,t])},createOrReplaceRange(e){let t=p.get(e.chatId);return null==t&&(t=new Map,p.set(e.chatId,t)),t.set(e.action,e),(0,d.getActiveMessageRangesTable)().createOrReplace(e)},bulkCreateOrReplaceRanges:e=>(e.forEach((e=>{let t=p.get(e.chatId);null==t&&(t=new Map,p.set(e.chatId,t)),t.set(e.action,e)})),(0,d.getActiveMessageRangesTable)().bulkCreateOrReplace(e)),getRangesForChat:e=>(0,a.default)((function*(){let t=p.get(e);if(null==t){const n=yield(0,d.getActiveMessageRangesTable)().anyOf(["chatId"],[e]);t=new Map(n.map((e=>[e.action,e]))),p.set(e,t)}return Array.from(t.values())}))()};function h(e,t){switch(e){case c.ActiveRangeAction.Archive:return{action:c.ActiveRangeAction.Archive,actionValue:(0,o.default)(t.archiveChatAction,"syncActionValue.archiveChatAction")};case c.ActiveRangeAction.MarkChatAsRead:return{action:c.ActiveRangeAction.MarkChatAsRead,actionValue:(0,o.default)(t.markChatAsReadAction,"syncActionValue.markChatAsReadAction")};case c.ActiveRangeAction.ClearChatKeepStarredKeepMedia:return{action:c.ActiveRangeAction.ClearChatKeepStarredKeepMedia,actionValue:(0,o.default)(t.clearChatAction,"syncActionValue.clearChatAction")};case c.ActiveRangeAction.ClearChatKeepStarredDeleteMedia:return{action:c.ActiveRangeAction.ClearChatKeepStarredDeleteMedia,actionValue:(0,o.default)(t.clearChatAction,"syncActionValue.clearChatAction")};case c.ActiveRangeAction.ClearChatDeleteStarredKeepMedia:return{action:c.ActiveRangeAction.ClearChatDeleteStarredKeepMedia,actionValue:(0,o.default)(t.clearChatAction,"syncActionValue.clearChatAction")};case c.ActiveRangeAction.ClearChatDeleteStarredDeleteMedia:return{action:c.ActiveRangeAction.ClearChatDeleteStarredDeleteMedia,actionValue:(0,o.default)(t.clearChatAction,"syncActionValue.clearChatAction")};case c.ActiveRangeAction.DeleteChatDeleteMedia:return{action:c.ActiveRangeAction.DeleteChatDeleteMedia,actionValue:(0,o.default)(t.deleteChatAction,"syncActionValue.deleteChatAction")};case c.ActiveRangeAction.DeleteChatKeepMedia:return{action:c.ActiveRangeAction.DeleteChatKeepMedia,actionValue:(0,o.default)(t.deleteChatAction,"syncActionValue.deleteChatAction")};default:throw new Error(`unsupported action for message ranges: ${String(e)}`)}}function _(){return(_=(0,a.default)((function*(e,t,n){var r;const a=(0,l.decodeProtobuf)(s.SyncActionValueSpec,n),{actionValue:o}=h(t,a),c=(null===(r=o.messageRange)||void 0===r?void 0:r.messages)||[],d=yield(0,u.filterReceivedMessagesInRange)(e,c),p=Math.max(0,c.length-d.length);return f.createOrReplaceRange((0,i.default)((0,i.default)({chatId:e},h(t,a)),{},{remainingMessages:p}))}))).apply(this,arguments)}t._cache=f},73382:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getBlocklist=function(){if((0,r.isLegacyWebdBackend)())return Promise.resolve([]);return(0,a.getTable)().all().then((e=>e.map((e=>(0,i.createUserWid)(e.id)))))},t.updateBlocklist=function(e){if((0,r.isLegacyWebdBackend)()||!e)return Promise.resolve(!1);const t=e.map((e=>({id:e.toString()})));return(0,o.getStorage)().lock(["blocklist"],(e=>{let[n]=e;return n.clear().then((()=>n.bulkCreate(t).then((()=>!0))))}))};var r=n(88555),i=n(45454),a=n(89426),o=n(99069)},60112:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.createOrUpdateChatEvents=function(e){return d.enqueue((0,i.default)((function*(){const t=(yield(0,l.getTable)().bulkGet(e.map((e=>{let{chatId:t,startTs:n}=e;return[t,n]})))).map(((t,n)=>{const r=e[n],i=function(e,t,n){if(null==n)return(0,a.default)({chatId:e,startTs:t},c);return Object.keys(c).reduce(((e,t)=>(null==e[t]&&(e[t]=c[t]),e)),n)}(r.chatId,r.startTs,t);return s.COUNT_FIELD_NAMES.forEach((e=>{i[e]+=r[e]})),i.msgsSent+=r.addMsgsSent,i.msgsReceived+=r.addMsgsReceived,i.viewOnceMsgsSent+=r.addViewOnceMsgsSent,i.viewOnceMsgsReceived+=r.addViewOnceMsgsReceived,i.viewOnceMessagesOpened+=r.addViewOnceMsgsOpened,i.callOffersSent+=r.addCallOffersSent,i.callOffersReceived+=r.addCallOffersReceived,i.totalCallDuration+=r.addTotalCallDuration,i}));return(0,l.getTable)().bulkCreateOrReplace(t)})))},t.deleteBeforeInclusive=function(){return u.apply(this,arguments)},t.getBeforeInclusive=function(e){return(0,l.getTable)().lessThan(["startTs"],e,{inclusive:!0})},t.getChatEvent=function(e,t){return(0,l.getTable)().get([e,t])};var i=r(n(48926)),a=r(n(81109)),o=n(27870),s=n(61840),l=n(91314);const c=Object.freeze((0,a.default)({msgsSent:0,msgsReceived:0,viewOnceMsgsSent:0,viewOnceMsgsReceived:0,viewOnceMessagesOpened:0,callOffersSent:0,callOffersReceived:0,totalCallDuration:0},s.COUNT_FIELDS)),d=new o.PromiseQueue;function u(){return(u=(0,i.default)((function*(e){return yield(0,l.getTable)().bulkDeleteRange(["startTs"],0,e+1)}))).apply(this,arguments)}},48285:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addUnreadMentionChat=function(e,t){return(0,_.getStorage)().lock(["chat"],function(){var n=(0,i.default)((function*(n){let[r]=n;const i=Array.from(e.keys());if(0===i.length)return;const a=yield(0,u.getTable)().bulkGet(i);if(!a||0===a.length)return void __LOG__(4,void 0,new Error)`addUnreadMentionChat: could not find chats`;const o=[];return a.forEach((n=>{if(n){var r;const a=n.id.toString();let s=null!==(r=n.unreadMentionsOfMe)&&void 0!==r?r:[];const l=e.get(a);l&&(s=s.concat(l));let c={id:a,unreadMentionsOfMe:s};if(t){var i;c={id:a,unreadMentionsOfMe:s,unreadMentionCount:null!==(i=t.get(a))&&void 0!==i?i:0}}o.push(c)}})),(0,u.getTable)().bulkCreateOrMerge(o)}));return function(){return n.apply(this,arguments)}}())},t.createChat=function(e,t){return(0,u.getTable)().create((0,a.default)({id:e.toString()},t)).catch((e=>{if(e instanceof l.DbOnLogoutAbort)throw e;throw __LOG__(4,!0,new Error,!0)`update chat table failed`,SEND_LOGS("update chat table failed when create local"),new Error("update chat table failed")}))},t.getChatMeta=function(){return g.apply(this,arguments)},t.markMessageAndChatAsRead=function(e,t,n){return(0,_.getStorage)().lock(["message","chat"],function(){var r=(0,i.default)((function*(r){let[i,a]=r;const s=yield(0,f.getTable)().equals(["from","pendingReadReceipt"],[t,1],{shouldDecrypt:!1}),l=[];let c=0;const d=[];s.forEach((t=>{if(null==e||null!=t.rowId&&t.rowId>e){if(c++,(0,p.isGroupCatchUpEnabled)()&&(0,h.isImportantMessage)(t)){const e={id:t.id,timestamp:t.t};d.push(e)}}else l.push({id:t.id,ack:Math.max(t.ack,o.ACK.READ),pendingReadReceipt:null})}));const u=0===c&&n?-1:c,_=[a.createOrMerge(t,{id:t,unreadCount:u,unreadMentionsOfMe:d,unreadMentionCount:0})];l.length>0&&_.push((0,f.getTable)().bulkCreateOrMerge(l)),yield Promise.all(_)}));return function(){return r.apply(this,arguments)}}())},t.pruneExpiredTcTokens=function(){return m.apply(this,arguments)},t.reduceChatUnreadCount=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(0,_.getStorage)().lock(["chat"],function(){var n=(0,i.default)((function*(n){let[r]=n;const i=yield r.get(e);if(null==i)return void __LOG__(4,void 0,new Error)`reduceChatUnreadCount: could not find chat with id ${e}`;const a=Math.max(i.unreadCount-t,0);return r.merge(e,{unreadCount:a})}));return function(){return n.apply(this,arguments)}}())},t.removeUnreadMentionChat=function(e){return(0,_.getStorage)().lock(["chat"],function(){var t=(0,i.default)((function*(t){let[n]=t;const r=Array.from(e.keys());if(0===r.length)return;const i=yield(0,u.getTable)().bulkGet(r);if(!i||0===i.length)return void __LOG__(4,void 0,new Error)`removeUnreadMentionChat: could not find chats`;const a=[];return i.forEach((t=>{if(t){var n;let r=null!==(n=t.unreadMentionsOfMe)&&void 0!==n?n:[];const i=e.get(t.id.toString());i&&(r=r.filter((e=>!i.includes(e.id)))),a.push({id:t.id.toString(),unreadMentionsOfMe:r})}})),(0,u.getTable)().bulkCreateOrMerge(a)}));return function(){return t.apply(this,arguments)}}())},t.updateChatArchiveDrawer=function(e){return(0,_.getStorage)().lock(["chat"],(t=>{let[n]=t;const r=Array.from(e.keys());if(0===r.length)return Promise.resolve();const i=r.map((t=>{var n;return{id:t,archiveAtMentionViewedInDrawer:null!==(n=e.get(t))&&void 0!==n&&n}}));return n.bulkCreateOrMerge(i)}))},t.updateChatForMarkAsReadSync=function(e){return(0,_.getStorage)().lock(["chat"],function(){var t=(0,i.default)((function*(t){let[n]=t;const r=yield n.get(e);if(null!=r)return-1===r.unreadCount?n.createOrMerge(e,{id:e,unreadCount:0,unreadMentionsOfMe:[],unreadMentionCount:0}):void 0;__LOG__(4,void 0,new Error)`updateMarkChatAsReadSync: could not find chat with id ${e}`}));return function(){return t.apply(this,arguments)}}())};var i=r(n(48926)),a=r(n(81109)),o=n(35470),s=n(88555),l=n(35232),c=n(64603),d=n(57849),u=n(68638),p=n(41566),f=n(90981),h=n(54676),_=n(99069);function g(){return(g=(0,i.default)((function*(e){const t=yield(0,u.getTable)().get(e.toString());return t?{unreadCount:t.unreadCount,timestamp:t.t}:Promise.reject(new Error("Failed to find row in chat table with id:"+e.toString()))}))).apply(this,arguments)}function m(){return(m=(0,i.default)((function*(){if((0,s.isLegacyWebdBackend)()||!(0,d.getABPropConfigValue)("trusted_contacts"))return;const e=(0,c.tokenExpirationCutoff)(c.TcTokenMode.Receiver),t=yield(0,u.getTable)().lessThan(["tcTokenTimestamp"],e);if(!t||0===t.length)return;const n=t.map((e=>({id:e.id,tcToken:null,tcTokenTimestamp:null})));yield(0,u.getTable)().bulkCreateOrMerge(n)}))).apply(this,arguments)}},35673:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.isAddressBookContact=function(){return l.apply(this,arguments)},t.setNotAddressBookContacts=function(e){if((0,a.isMDBackend)())return(0,s.getStorage)().lock(["contact"],(()=>{const t=e.map((e=>({id:e,isAddressBookContact:0,name:void 0})));return(0,o.getContactTable)().bulkCreateOrMerge(t)}));return Promise.resolve()};var i=r(n(48926)),a=n(88555),o=n(76214),s=n(99069);function l(){return(l=(0,i.default)((function*(e){const t=yield(0,o.getContactTable)().get(e);return null!=t&&0!==t.isAddressBookContact}))).apply(this,arguments)}},9108:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.bulkCreateOrReplaceDeviceRecord=function(){return E.apply(this,arguments)},t.bulkGetDeviceRecord=g,t.createOrReplaceDeviceRecord=function(){return y.apply(this,arguments)},t.doesDeviceHashMatch=function(){return C.apply(this,arguments)},t.getAllDeviceLists=function(){return(0,u.getTable)().all()},t.getDeviceIds=S,t.getDeviceInfoForSync=function(){return b.apply(this,arguments)},t.getDeviceRecord=h,t.getMyDeviceList=function(){return A.apply(this,arguments)},t.hasDevice=function(){return T.apply(this,arguments)};var i=r(n(48926)),a=r(n(94654)),o=n(52230),s=n(42430),l=n(88555),c=n(69315),d=n(45454),u=n(60996),p=n(99234);const f=new s.LruCache({sizeLimit:2e3,getSize:()=>1});function h(){return _.apply(this,arguments)}function _(){return(_=(0,i.default)((function*(e){if((0,l.isMDBackend)()){if(!f.has(e)){const t=yield(0,u.getTable)().get(e);f.put(e,t)}return f.get(e)}return Promise.reject(new Error("getDeviceRecord: not supported for non md"))}))).apply(this,arguments)}function g(){return m.apply(this,arguments)}function m(){return(m=(0,i.default)((function*(e){if((0,l.isMDBackend)()){const t=[];e.forEach((e=>{f.has(e)||t.push(e)}));return(yield(0,u.getTable)().bulkGet(t)).forEach(((e,n)=>{f.put(t[n],e)})),e.map((e=>f.get(e)))}return Promise.reject(new Error("bulkGetDeviceRecord: not supported for non md"))}))).apply(this,arguments)}function y(){return(y=(0,i.default)((function*(e){return(0,l.isMDBackend)()?(yield(0,u.getTable)().createOrReplace(e),void f.put(e.id,e)):Promise.reject(new Error("createOrReplaceDeviceRecord: not supported for non md"))}))).apply(this,arguments)}function E(){return(E=(0,i.default)((function*(e){return(0,l.isMDBackend)()?(yield(0,u.getTable)().bulkCreateOrReplace(e),void e.forEach((e=>{f.put(e.id,e)}))):Promise.reject(new Error("bulkCreateOrReplaceDeviceRecord: not supported for non md"))}))).apply(this,arguments)}function S(){return v.apply(this,arguments)}function v(){return(v=(0,i.default)((function*(e){if((0,l.isMDBackend)()){return(yield g(e)).map((e=>{if(e&&!e.deleted){const t=e.devices.map((e=>e.id));return{id:e.id,devices:t}}return null}))}return Promise.reject(new Error("getDeviceIds: not supported without model storage and md backend"))}))).apply(this,arguments)}function T(){return(T=(0,i.default)((function*(e,t){if((0,l.isLegacyWebdBackend)())return!1;if(t===o.DEFAULT_DEVICE_ID)return!0;const[n]=yield S([e.user]);return!!n&&!!n.devices.includes(t)}))).apply(this,arguments)}function b(){return(b=(0,i.default)((function*(e){if((0,l.isMDBackend)()){return(yield g(e)).map((e=>{if(e&&!e.deleted){const t=e.devices.map((e=>e.id));return{id:e.id,devices:t,timestamp:e.timestamp,expectedTs:e.expectedTs}}return null}))}return Promise.reject(new Error("getDeviceIds: not supported without model storage and md backend"))}))).apply(this,arguments)}function C(){return(C=(0,i.default)((function*(e,t){if((0,l.isMDBackend)()){if(null==t)return!0;const n=(yield S([e.user])).map((e=>e?e.devices.map((t=>(0,d.createDeviceWidFromUserAndDevice)(e.id,t))):[])),r=(0,a.default)(n,(e=>e));return(yield(0,c.phashV2)(r))!==t}return!1}))).apply(this,arguments)}function A(){return(A=(0,i.default)((function*(){const e=(0,p.assertGetMe)(),t=yield h(e.user);if(!t||t.deleted)throw new Error("syncd: cannot find my device list");return t}))).apply(this,arguments)}},36993:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createOrUpdateDirectConnectionKeys=function(e){if((0,r.isMDBackend)())return(0,i.getTable)().createOrMerge(e.id,e);return Promise.resolve()},t.fetchDirectConnectionKeys=function(e){if((0,r.isMDBackend)())return(0,i.getTable)().get(e);return Promise.resolve()};var r=n(88555),i=n(68259)},62415:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.persistGroupInviteV4Msg=function(e,t){if((0,o.isMDBackend)())return(0,d.getTable)().createOrMerge(e,t);return Promise.resolve()},t.revokeGroupInvites=function(){return u.apply(this,arguments)},t.updatePendingParticipants=function(){return p.apply(this,arguments)};var i=r(n(81109)),a=r(n(48926)),o=n(88555),s=n(40234),l=n(45454),c=n(99234),d=n(35884);function u(){return(u=(0,a.default)((function*(e,t,n,r){if((0,o.isMDBackend)()){const a=yield(0,d.getTable)().equals(["from","to","groupId"],[e,t,n]).then((e=>e.filter((e=>!e.expired&&e.expiration<=r))));return(0,d.getTable)().bulkCreateOrReplace(a.map((e=>(0,i.default)((0,i.default)({},e),{},{expired:!0})))),a}return Promise.resolve(null)}))).apply(this,arguments)}function p(){return(p=(0,a.default)((function*(e){if((0,o.isMDBackend)()){var t;const r=null===(t=(0,c.getMaybeMeUser)())||void 0===t?void 0:t.toString(),i=n(63928).default.gadd(e);yield(0,d.getTable)().equals(["from","groupId"],[r,e.toString()]).then((e=>e.filter((e=>!e.expired&&s.Clock.globalUnixTime()<=e.expiration)))).then((e=>{e.forEach((e=>{i.pendingParticipants.add({id:(0,l.createUserWid)(e.to)})}))}))}return Promise.resolve()}))).apply(this,arguments)}},90101:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getGroupMetadataFromStorage=function(e){if((0,o.isMDBackend)())return(0,c.getStorage)().lock(["group-metadata","participant"],function(){var t=(0,i.default)((function*(t){let[n,r]=t;const i=yield n.get(e.toString());if(i){const t=yield r.get(e.toString());if(null==t?void 0:t.deviceSyncComplete){var a;__LOG__(2,void 0,void 0,void 0,["groups"])`found groupMetadata in storage for group id ${e.toString()}`;const n=new Set(t.admins);return{id:e,owner:i.owner&&(0,s.createWid)(i.owner),creation:i.creation,desc:i.desc,descId:i.descId,descOwner:i.descOwner&&(0,s.createWid)(i.descOwner),descTime:i.descTime,restrict:i.restrict||!1,announce:i.announce||!1,noFrequentlyForwarded:i.noFrequentlyForwarded||!1,ephemeralDuration:i.ephemeralDuration||0,participants:null===(a=t.participants)||void 0===a?void 0:a.map((e=>({id:(0,s.createWid)(e),isAdmin:n.has(e),isSuperAdmin:!1}))),subject:i.subject,support:!0===i.support,notAddedByContact:i.notAddedByContact||!1,addedBy:i.addedBy&&(0,s.createWid)(i.addedBy)}}}return __LOG__(2,void 0,void 0,void 0,["groups"])`did not find groupMetadata in storage for group id ${e.toString()}`,null}));return function(){return t.apply(this,arguments)}}());return Promise.resolve(null)},t.persistGroupMetadata=function(e,t){if((0,o.isMDBackend)())return(0,l.getTable)().createOrMerge(e.toString(),(0,a.default)({id:e.toString()},t));return Promise.resolve()};var i=r(n(48926)),a=r(n(81109)),o=n(88555),s=n(45454),l=n(64632),c=n(99069)},41037:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addNotification=f,t.enqueueNotification=function(){return h.apply(this,arguments)},t.fetchNextHitorySyncChunkForProcessing=function(){return _.apply(this,arguments)},t.getByChunkOrderNumber=function(e,t){let n;if((0,o.isLegacyWebdBackend)())n=Promise.reject(new Error("getNotificationForChunk for history sync notification: not supported without md backend"));else if(n=(0,s.getTable)().equals(["chunkOrder","syncType"],[e,t]),!n)return Promise.reject(new Error("getNotificationForChunk history sync notification: not supported for non MD"));return n},t.getNextUnProcessedNotification=u,t.markChunkForReuploadPending=function(e){return c.delete(e),(0,s.getTable)().merge(e,{reuploadPending:!0})},t.removeLocalFailureFromInFlightChunk=function(e){c.delete(e)},t.updateCurrentlyProcessed=p;var i=r(n(81109)),a=r(n(48926)),o=n(88555),s=n(15118),l=n(58052);const c=new Set;function d(){return(d=(0,a.default)((function*(e,t,n){const r=(0,l.getLastHistorySycnedChunk)();if(4===e)return!0;if([2,3].includes(e)&&1===t){if(3===e){return!!(0,l.getInitialHistorySyncComplete)()}const t=(0,l.getHistorySyncStatus)();return!!(null==t?void 0:t.recentCompleted)}if(null==r)return!1;const[i,a]=r.split("_");return i===`${e}`&&a===""+(t-1)||(i===`${e}`&&a===`${t}`?(__LOG__(2,void 0,void 0,void 0,["History sync"])`isPreviousChunkProcessed: next chunk already processed ${e}_${t}, last processed: ${r} `,yield p(n),!1):(__LOG__(2,void 0,void 0,void 0,["History sync"])`isPreviousChunkProcessed returned false for ${e}_${t}, last processed: ${r} `,!1))}))).apply(this,arguments)}function u(){let e;if((0,o.isLegacyWebdBackend)())e=Promise.reject(new Error("getNextUnProcessed for history sync notification: not supported without md backend"));else if(e=(0,s.getTable)().equals(["processed"],0,{shouldDecrypt:!1}).then(function(){var e=(0,a.default)((function*(e){var t;const n=e.filter((e=>!c.has(e.msgKey)&&!e.reuploadPending)).sort(((e,t)=>e.syncType<t.syncType?1:e.syncType>t.syncType?-1:e.syncType===t.syncType&&null!=e.chunkOrder&&null!=t.chunkOrder?e.chunkOrder-t.chunkOrder:0));let r=n.length>0?n[0]:void 0;if(null!=(null===(t=r)||void 0===t?void 0:t.chunkOrder)){if(r){if(!(yield function(){return d.apply(this,arguments)}(r.syncType,r.chunkOrder,r.msgKey)))return;r=yield(0,s.getTable)().postflightDecryptSingleRecord(r)}return r}var i;__LOG__(2,void 0,void 0,void 0,["History sync"])`getNextUnProcessedNotification chunkOrder is null, ${null===(i=r)||void 0===i?void 0:i.msgKey}`}));return function(){return e.apply(this,arguments)}}()),!e)return Promise.reject(new Error("getNextUnProcessed history sync notification: not supported for non MD"));return e}function p(e){let t;if((0,o.isLegacyWebdBackend)())t=Promise.reject(new Error("updateCurrentProcessed for history sync notification: not supported without md backend"));else if(c.delete(e),t=(0,s.getTable)().remove(e),!t)return Promise.reject(new Error("updateCurrentProcessed history sync notification: not supported for non MD"));return t.catch((e=>{__LOG__(2,void 0,void 0,void 0,["History sync"])`updateCurrentlyProcessed failed with error ${e}`}))}function f(e){let t;if((0,o.isLegacyWebdBackend)())t=Promise.reject(new Error("add history sync notification: not supported without md backend"));else{const n=e.downloadOptions.mediaKey,r=e.downloadOptions.directPath,a=e.downloadOptions.filehash,o=e.downloadOptions.encFilehash;e.downloadOptions.mediaKey="",e.downloadOptions.directPath="",e.downloadOptions.filehash="",e.downloadOptions.encFilehash="";const l=(0,i.default)((0,i.default)({},e),{},{chunkEncryptionKey:n,directPath:r,filehash:a,encFilehash:o});if(e.processed=0,t=(0,s.getTable)().createOrMerge(e.msgKey,l),!t)return Promise.reject(new Error("add history sync notification: not supported for non MD"))}return t}function h(){return(h=(0,a.default)((function*(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];yield f(e),t&&c.add(e.msgKey)}))).apply(this,arguments)}function _(){return(_=(0,a.default)((function*(){if(c.size>0)return null;const e=yield u();return e&&(e.downloadOptions.mediaKey=e.chunkEncryptionKey,delete e.chunkEncryptionKey,e.downloadOptions.directPath=e.directPath||e.downloadOptions.directPath,delete e.directPath,e.downloadOptions.filehash=""===e.downloadOptions.filehash?e.filehash:e.downloadOptions.filehash,delete e.filehash,e.downloadOptions.encFilehash=e.encFilehash,delete e.encFilehash,c.add(e.msgKey)),e}))).apply(this,arguments)}},54598:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.queryAndRemoveLocalLabelAssociation=function(){return s.apply(this,arguments)},t.queryLocalLabelAssociation=o;var i=r(n(48926)),a=n(82663);function o(e){return(0,a.getTable)().anyOf(["associationId","type"],e.map((e=>{let{associationId:t,type:n}=e;return[t,n]})))}function s(){return(s=(0,i.default)((function*(e){const t=yield o(e);yield(0,a.getTable)().bulkRemove(t.map((e=>{let{labelId:t,associationId:n,type:r}=e;return[t,n,r]})))}))).apply(this,arguments)}},14748:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getDeviceUpdateLock=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if((0,r.isLegacyWebdBackend)())return Promise.reject(new Error("This call is only supported in MD mode"));let a=["participant","device-list"];t&&(a=[...a,"message"]);n&&(a=[...a,"missing-keys"]);return(0,i.getStorage)().lock(a,(t=>e(t)))};var r=n(88555),i=n(99069)},47124:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.RetryEligibilityResult=void 0,t.createOrMergeReceiptRecords=function(e){if((0,l.isMDBackend)()){const t=new Map;return e.forEach((e=>{var n;const{msgKey:r,receiverId:i}=e,a=(0,c.toUserWid)(i).toString(),s=r.toString(),l=`${s},${a}`,d=null!==(n=i.device)&&void 0!==n?n:o.DEFAULT_DEVICE_ID,u=t.get(l);u?u.deviceNotDelivered.push(d):t.set(l,{msgKey:s,receiverUserJid:a,deviceDelivered:[],deviceNotDelivered:[d]})})),(0,f.getStorage)().lock(["message-info"],function(){var e=(0,a.default)((function*(e){let[n]=e;const r=Array.from(t.values()).map((e=>[e.msgKey,e.receiverUserJid]));return(yield n.anyOf(["msgKey","receiverUserJid"],r)).forEach((e=>{const n=`${e.msgKey},${e.receiverUserJid}`,r=t.get(n);r&&t.set(n,(0,i.default)((0,i.default)({},e),{},{deviceNotDelivered:[...e.deviceNotDelivered,...r.deviceNotDelivered]}))})),(0,p.getTable)().bulkCreateOrReplace(Array.from(t.values()))}));return function(){return e.apply(this,arguments)}}())}return Promise.reject(new Error("createOrMergeReceiptRecords: not supported for non MD"))},t.isRetryEligible=function(e,t,n,r){if((0,l.isMDBackend)()){const i=(0,c.toUserWid)(t).toString(),a=t.device||0;return(0,p.getTable)().get([e.toString(),i]).then((s=>s?s.deviceNotDelivered.includes(a)?null!=n&&r>=n?g.ELIGIBLE:null!=t.device&&t.device!==o.DEFAULT_DEVICE_ID||null!=s.delivery?g.INELIGIBLE_CHANGED_IDENTITY:g.ELIGIBLE:(__LOG__(2)`MessageInfoStore: ${e.toString()},${i}:${a} has been delivered`,g.INELIGIBLE_ALREADY_DELIVERED):(__LOG__(2)`MessageInfoStore: missing record for ${e.toString()},${i}`,g.INELIGIBLE_RECORD_MISSING)))}return Promise.resolve(g.INELIGIBLE_NOT_MD)},t.queryMsgInfo=function(e){if((0,l.isMDBackend)()){const t=String(e);return(0,u.getTable)().get(t).then((t=>{const n=t?t.count:null;return(0,p.getTable)().equals(["msgKey"],e.toString()).then((t=>{const r={delivery:[],deliveryRemaining:0,played:[],playedRemaining:0,read:[],readRemaining:0};let i=0;t.forEach((e=>{const t=(0,c.createWid)(e.receiverUserJid);if(!(0,d.getMeUser)().equals(t)){!function(e){const t=e.read;null!=t&&(null==e.delivery||e.delivery>t)&&(e.delivery=t)}(e);for(let n=0;n<_.length;n++){const i=_[n],a=e[i];if(null!=a){r[i].push({id:t,t:a});break}}null!=e.delivery&&null!=e.deliveryPrivacyMode&&(r.deliveryPrivacyMode=e.deliveryPrivacyMode),i+=1}}));const a=null!=n&&0!==n?n:i;return __LOG__(2)`queryMsgInfo: ${e}, ack count: ${n}, receiver: ${a},
played: ${r.played.length}, read: ${r.read.length}, delivery: ${r.delivery.length}`,r.playedRemaining=a-r.played.length,r.readRemaining=r.playedRemaining-r.read.length,r.deliveryRemaining=r.readRemaining-r.delivery.length,r}))}))}return Promise.reject(new Error("queryMsgInfo: not supported without model storage"))},t.updateReceiptRecords=function(e,t,n,r,i){if((0,l.isMDBackend)()){const a=h[e],o=(0,c.toUserWid)(n).toString(),l=n.device||0;return a?function(e,t,n,r,i,a){if(0===i.length)return Promise.resolve();return(0,f.getStorage)().lock(["message-info"],(o=>{let[l]=o;const c=i.map((e=>[e,n]));return l.bulkGet(c).then((o=>{const c=[];return i.forEach(((i,l)=>{const d=o[l];if(!d){__LOG__(2)`updateReceiptRecords: got receipt for peer msg ${i},${n}`;const r={msgKey:i,receiverUserJid:n,[e]:t,deviceDelivered:[],deviceNotDelivered:[]};return e===s.ACK_STRING.DELIVERY&&null!=a&&(r.deliveryPrivacyMode=a),void c.push(r)}if(e!==h[s.ACK.INACTIVE]){const n=d[e];(null==d[e]||n>t)&&(d[e]=t),e===s.ACK_STRING.DELIVERY&&null!=a&&(d.deliveryPrivacyMode=a)}d.deviceNotDelivered.length>0&&(d.deviceDelivered.push(r),d.deviceDelivered=d.deviceDelivered.filter(((e,t,n)=>n.indexOf(e)===t)),d.deviceNotDelivered=d.deviceNotDelivered.filter((e=>e!==r))),c.push(d)})),l.bulkCreateOrReplace(c)}))}))}(a,t,o,l,r,i):Promise.reject(new Error(`updateReceiptRecords: not supported ack type ${e}`))}return Promise.reject(new Error("updateReceiptRecords: not supported for non MD"))};var i=r(n(81109)),a=r(n(48926)),o=n(52230),s=n(35470),l=n(88555),c=(r(n(89867)),n(45454)),d=n(99234),u=n(90981),p=n(52489),f=n(99069);const h={[s.ACK.RECEIVED]:s.ACK_STRING.DELIVERY,[s.ACK.READ]:s.ACK_STRING.READ,[s.ACK.PLAYED]:s.ACK_STRING.PLAYED,[s.ACK.INACTIVE]:s.ACK_STRING.INACTIVE},_=[s.ACK_STRING.PLAYED,s.ACK_STRING.READ,s.ACK_STRING.DELIVERY],g=Object.freeze({ELIGIBLE:"ELGIBLE",INELIGIBLE_RECORD_MISSING:"INELIGIBLE_RECORD_MISSING",INELIGIBLE_ALREADY_DELIVERED:"INELIGIBLE_ALREADY_DELIVERED",INELIGIBLE_NOT_MD:"INELIGIBLE_NOT_MD",INELIGIBLE_CHANGED_IDENTITY:"INELIGIBLE_CHANGED_IDENTITY"});t.RetryEligibilityResult=g},86868:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.removeMessagesFromHistory=function(e){if((0,i.isMDBackend)()){const t=[];return(0,o.initializeWithoutGKs)().then((()=>{if(e.length>0)return(0,l.getTable)().bulkGet(e).then((e=>{e.forEach((e=>{null!=(null==e?void 0:e.rowId)&&t.push(String(e.rowId))}))}))})).then((()=>(0,d.getStorage)().lock(["message","label-association"],(()=>{const t=(0,c.queryAndRemoveLocalLabelAssociation)(e.map((e=>({associationId:e,type:s.LabelAssociationType.Message}))));return Promise.all([(0,l.getTable)().bulkRemove(e),t])})))).then((()=>{t.length>0&&a.default.purge(t)})).then((()=>{})).catch((e=>{throw __LOG__(4,void 0,new Error)`removeMessagesFromHistory: error ${e}`,e}))}return Promise.resolve()};var i=n(88555),a=r(n(69048)),o=n(23356),s=n(82663),l=n(90981),c=n(54598),d=n(99069);n(79038)},60324:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.pruneExpiredMessages=function(){if((0,r.isMDBackend)())return __LOG__(2,void 0,void 0,void 0,["ephemeral-messages"])`pruneExpiredMessages started`,(0,o.getTable)().lessThan(["expiredTimestamp"],i.Clock.globalUnixTime(),{shouldDecrypt:!1}).then((e=>(0,a.removeMessagesFromHistory)(e.map((e=>e.id.toString()))).then((()=>(__LOG__(2,void 0,void 0,void 0,["ephemeral-messages"])`pruneExpiredMessages completed`,e)))));return Promise.resolve([])},t.removeExpiredMessagesFromHistory=function(e){if((0,r.isMDBackend)())return(0,a.removeMessagesFromHistory)(e.map((e=>e.id.toString())));return Promise.resolve()};var r=n(88555),i=n(40234),a=n(86868),o=n(90981)},35588:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getMsgByMsgKey=function(e){if((0,o.isMDBackend)()){let t;return t=e instanceof s.default?e.toString():e,(0,c.getTable)().get(t).then((e=>e?(0,d.hydrateMessage)(e):null))}return Promise.resolve(null)},t.getMsgsByMsgKey=function(e){if((0,o.isMDBackend)())return(0,c.getTable)().bulkGet(e).then((e=>e.filter(Boolean).map(d.hydrateMessage)));return Promise.resolve([])},t.msgFindQuery=function(e,t){if(null!=t.label)return Promise.resolve([]);if("before"===e)return function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20;if((0,o.isMDBackend)()&&e instanceof s.default){const n=e.remote.toString();return(0,c.getTable)().equals(["id"],e.toString()).then((r=>{if(0===r.length)throw __LOG__(3)`Anchor message ${e.toString()} does not exist in message table`,new p;const a=r[0],o=(0,d.getInChatMsgId)(a.internalId||""),s=Math.max(0,o-t),c=(0,d.craftInternalId)(n,o);let u=(0,d.craftInternalId)(n,s);const f={lowerInclusive:!0,upperInclusive:!1};return(0,l.receiveReactionsEnabled)()?(u=(0,d.beginningOfChat)(e.remote),(0,d.queryChatVisibleMessageHelper)(u,c,(0,i.default)((0,i.default)({},f),{},{reverse:!0}),t).then((e=>e.reverse().map(d.hydrateMessage)))):(0,d.queryChatMessageHelper)(u,c,f).then((e=>e.map(d.hydrateMessage)))}))}return Promise.resolve([])}(t,t.count);if("after"===e)return function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:u;if((0,o.isMDBackend)()&&e instanceof s.default){const n=e.remote.toString();return(0,c.getTable)().equals(["id"],e.toString()).then((r=>{if(0===r.length)throw __LOG__(3)`Anchor message ${e.toString()} does not exist in message table`,new p;const i=r[0],a=(0,d.getInChatMsgId)(i.internalId||""),o=(0,d.craftInternalId)(n,a);let s=(0,d.craftInternalId)(n,a+t);const c={lowerInclusive:!1,upperInclusive:!0};return(0,l.receiveReactionsEnabled)()?(s=(0,d.endOfChat)(e.remote),(0,d.queryChatVisibleMessageHelper)(o,s,c,t).then((e=>e.map(d.hydrateMessage)))):(0,d.queryChatMessageHelper)(o,s,c).then((e=>e.map(d.hydrateMessage)))}))}return Promise.resolve([])}(t,t.count).catch((0,a.filteredCatch)(p,(()=>({status:404}))));if("star"===e){const e=null==t.id?void 0:new s.default(t);return null!=t.chat?function(e,t,n){if((0,o.isMDBackend)())return Promise.resolve().then((()=>{if(null!=n)return(0,c.getTable)().get(n.toString())})).then((n=>{const r=null==n?[(0,d.endOfChat)(e),1/0]:[n.internalId,n.isStarred],i=[(0,d.beginningOfChat)(e),0];return(0,c.getTable)().between(["internalId","isStarred"],i,r,{lowerInclusive:!1,upperInclusive:!1,reverse:!0,limit:t}).then((e=>e.map(d.hydrateMessage)))}));return Promise.resolve([])}(t.chat,t.count,e):function(e,t){if((0,o.isMDBackend)())return Promise.resolve().then((()=>{if(null!=t)return(0,c.getTable)().get(t.toString())})).then((t=>{const n=null==t?1/0:t.isStarred;return(0,c.getTable)().between(["isStarred"],0,n,{lowerInclusive:!1,upperInclusive:!1,reverse:!0,limit:e}).then((e=>e.map(d.hydrateMessage)))}));return Promise.resolve([])}(t.count,e)}if("search"===e){const e={};t.remote&&(e.remote=t.remote.toString()),t.count&&t.page>=0&&(e.limit=t.count,e.page=t.page);const{default:r}=n(69048);return r.search(t.searchTerm,e)}if("media"===e){const e=t.remote,n=null==t.id?void 0:new s.default(t);return"document"===t.media?f(e,t.count,t.direction,"isDocMsg",n).then((e=>e.map(d.hydrateMessage))):"url"===t.media?f(e,t.count,t.direction,"hasLink",n).then((e=>e.map(d.hydrateMessage))):Promise.all(["isMediaMsg","isDocMsg","hasLink"].map((r=>f(e,t.count,t.direction,r,n).then((e=>e.map(d.hydrateMessage)))))).then((e=>{let[t,n,r]=e;const i=[t,r,n].flat();return{docCount:n.length,linkCount:r.length,mediaCount:t.length,messages:i}}))}return __LOG__(3)`Message query type ${e} not implemented.`,Promise.reject(new Error(`Message query type ${e} not implemented.`))},t.queryMessageType=f,t.queryVcard=function(e){if((0,o.isMDBackend)())return(0,c.getTable)().equals(["vcardWAids"],e.toString()).then((e=>e.map(d.hydrateMessage)));return Promise.resolve()};var i=r(n(81109)),a=n(50796),o=n(88555),s=r(n(65212)),l=n(57701),c=n(90981),d=n(12896);const u=20;class p extends Error{constructor(){super(...arguments),this.name="NoAnchorMessageError"}}function f(e,t,n,r,i){if((0,o.isMDBackend)()){return(null==i?Promise.resolve(void 0):(0,c.getTable)().equals(["id"],i.toString())).then((a=>{if(i&&null!=a&&0===a.length)throw __LOG__(3)`Anchor message ${i&&i.toString()} does not exist in message table`,new p;const o=null==a?void 0:a[0];let s,l,u=!1;return"before"===n?(s=(0,d.beginningOfChat)(e),l=null==o?(0,d.endOfChat)(e):(0,d.craftInternalId)(e.toString(),(0,d.getInChatMsgId)(o.internalId||"")),u=!0):(s=null==o?(0,d.beginningOfChat)(e):(0,d.craftInternalId)(e.toString(),(0,d.getInChatMsgId)(o.internalId||"")),l=(0,d.endOfChat)(e)),(0,c.getTable)().between(["internalId",r],[s,0],[l,1/0],{lowerInclusive:!1,upperInclusive:!1,limit:t,reverse:u})}))}return Promise.resolve([])}},84886:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"DuplicateMessageError",{enumerable:!0,get:function(){return r.DuplicateMessageError}}),Object.defineProperty(t,"getMsgByMsgKey",{enumerable:!0,get:function(){return i.getMsgByMsgKey}}),Object.defineProperty(t,"getMsgsByMsgKey",{enumerable:!0,get:function(){return i.getMsgsByMsgKey}}),Object.defineProperty(t,"msgFindQuery",{enumerable:!0,get:function(){return i.msgFindQuery}}),Object.defineProperty(t,"processPaymentMessages",{enumerable:!0,get:function(){return r.processPaymentMessages}}),Object.defineProperty(t,"processRevokeMsgs",{enumerable:!0,get:function(){return r.processRevokeMsgs}}),Object.defineProperty(t,"queryVcard",{enumerable:!0,get:function(){return i.queryVcard}}),Object.defineProperty(t,"removeMessagesFromHistory",{enumerable:!0,get:function(){return a.removeMessagesFromHistory}}),Object.defineProperty(t,"starMessages",{enumerable:!0,get:function(){return r.starMessages}}),Object.defineProperty(t,"storeInitialSyncMessages",{enumerable:!0,get:function(){return r.storeInitialSyncMessages}}),Object.defineProperty(t,"storeMessages",{enumerable:!0,get:function(){return r.storeMessages}}),Object.defineProperty(t,"storeRecentAndFullHistSyncMessages",{enumerable:!0,get:function(){return r.storeRecentAndFullHistSyncMessages}}),Object.defineProperty(t,"unstarMessages",{enumerable:!0,get:function(){return r.unstarMessages}}),Object.defineProperty(t,"updateExistingMessages",{enumerable:!0,get:function(){return r.updateExistingMessages}}),Object.defineProperty(t,"updateMessage",{enumerable:!0,get:function(){return r.updateMessage}});var r=n(90641),i=n(35588),a=n(86868)},30986:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t._test=void 0,t.deleteMessagesInMessageRange=function(e,t,n){const{lastMessageTimestamp:r,lastSystemMessageTimestamp:a,messages:o}=t;return(0,p.getStorage)().lock(["message"],function(){var t=(0,i.default)((function*(t){let[i]=t,s=[];const l=[];null!=r&&(l.push(S(e,r,h.MessagePropertyType.IncomingChatMessage,n)),l.push(S(e,r,h.MessagePropertyType.Outgoing,n)));const c=null!=a?a:r;null!=c&&l.push(S(e,c,h.MessagePropertyType.SystemMessage,n)),l.push(function(){return T.apply(this,arguments)}(o,n));const d=yield Promise.all(l);s=s.concat(...d);const u=null==n?void 0:n.skipMessages;return u&&(s=s.filter((e=>!u.has(e)))),yield i.bulkRemove(s),s}));return function(){return t.apply(this,arguments)}}())},t.filterReceivedMessagesInRange=function(){return m.apply(this,arguments)},t.fixMessageRange=function(e){var t,n;const r=e.messages,i={messages:r,lastMessageTimestamp:e.lastMessageTimestamp};if(r.length>_){const{messages:e,newLastMessageTimestamp:t}=y(r,_);null!=t&&(i.lastMessageTimestamp=t),i.messages=e}(0,a.numberOrThrowIfTooLarge)(null!==(t=e.lastSystemMessageTimestamp)&&void 0!==t?t:0)>(0,a.numberOrThrowIfTooLarge)(null!==(n=i.lastMessageTimestamp)&&void 0!==n?n:0)&&(i.lastSystemMessageTimestamp=e.lastSystemMessageTimestamp);return i},t.getAdditionalMessages=function(){return g.apply(this,arguments)},t.getFirstSystemMessageTimestamp=function(e){return(0,u.getTable)().between(["messageRangeIndex"],(0,h.beginningOfMessageRange)(e,h.MessagePropertyType.SystemMessage),(0,h.endOfMessageRange)(e,h.MessagePropertyType.SystemMessage),{lowerInclusive:!0,reverse:!1,limit:1,shouldDecrypt:!1}).then((e=>{var t;return(0,h.extractC2STimestampFromMessageRangeIndex)(null===(t=e[0])||void 0===t?void 0:t.messageRangeIndex)}))},t.getLastMessageTimestamp=function(e){return(0,u.getTable)().between(["messageRangeIndex"],(0,h.beginningOfMessageRange)(e,h.MessagePropertyType.IncomingChatMessage),(0,h.endOfMessageRange)(e,h.MessagePropertyType.IncomingChatMessage),{lowerInclusive:!0,reverse:!0,limit:1,shouldDecrypt:!1}).then((e=>{var t;return(0,h.extractC2STimestampFromMessageRangeIndex)(null===(t=e[0])||void 0===t?void 0:t.messageRangeIndex)}))},t.getLastSystemMessageTimestamp=function(e){return(0,u.getTable)().between(["messageRangeIndex"],(0,h.beginningOfMessageRange)(e,h.MessagePropertyType.SystemMessage),(0,h.endOfMessageRange)(e,h.MessagePropertyType.SystemMessage),{lowerInclusive:!0,reverse:!0,limit:1,shouldDecrypt:!1}).then((e=>{var t;return(0,h.extractC2STimestampFromMessageRangeIndex)(null===(t=e[0])||void 0===t?void 0:t.messageRangeIndex)}))},t.timestampComparison=E;var i=r(n(48926)),a=n(8243),o=r(n(45095)),s=n(92844),l=n(40234),c=r(n(65212)),d=n(15461),u=n(90981),p=n(99069),f=n(93650),h=n(12896);const _=1e3;function g(){return(g=(0,i.default)((function*(e,t,n){const r=(0,u.getTable)().between(["messageRangeIndex"],(0,h.beginningOfMessageRange)(e,h.MessagePropertyType.Outgoing,t),(0,h.endOfMessageRange)(e,h.MessagePropertyType.Outgoing),{reverse:!0,shouldDecrypt:!1}),i=(0,u.getTable)().anyOf(["messageRangeIndex"],[(0,h.beginningOfMessageRange)(e,h.MessagePropertyType.IncomingChatMessage,t),(0,h.beginningOfMessageRange)(e,h.MessagePropertyType.Outgoing,t),(0,h.beginningOfMessageRange)(e,h.MessagePropertyType.Outgoing)],{reverse:!0,shouldDecrypt:!1}),a=yield Promise.all([r,i]).then((e=>{let[t,r]=e;return t.concat(r).filter((e=>-1!==e.ack&&!e.isSendFailure&&!e.mdDowngrade)).filter((e=>!((null==n?void 0:n.excludeStarred)&&e.isStarred))).map((e=>{var t;const n=c.default.fromString(e.id),r=null!==(t=(0,h.extractC2STimestampFromMessageRangeIndex)(e.messageRangeIndex))&&void 0!==t?t:void 0;return{key:(0,f.msgKeyToProtobuf)(n),timestamp:r}}))})),{messages:o,newLastMessageTimestamp:s}=y(a,(null==n?void 0:n.limit)||_);return{messages:o,newLastMessageTimestamp:s}}))).apply(this,arguments)}function m(){return(m=(0,i.default)((function*(e,t){if(0===t.length)return t;const n=t.map((e=>(0,f.protobufToMsgKey)((0,o.default)(e.key,"syncActionMessage.key")).toString())),r=yield(0,u.getTable)().bulkGet(n,!1);return t.filter(((e,t)=>null!=r[t]))}))).apply(this,arguments)}function y(e,t){const n=[],r=[];if(e.forEach((e=>{null!=e.timestamp?n.push(e):r.push(e)})),n.length<t)return{messages:e};const i=n.sort(E).slice(0,t),s=i[i.length-1];return{messages:i.concat(r),newLastMessageTimestamp:(0,a.numberOrThrowIfTooLarge)((0,o.default)(s.timestamp,"smallestTimestampMessage.timestamp"))}}function E(e,t){const[n,r]=[e,t].map((e=>(0,a.numberOrThrowIfTooLarge)((0,o.default)(e.timestamp,"syncActionMessage.timestamp"))));return r-n}function S(){return v.apply(this,arguments)}function v(){return(v=(0,i.default)((function*(e,t,n,r){let i=yield(0,u.getTable)().between(["messageRangeIndex"],(0,h.beginningOfMessageRange)(e,n),(0,h.beginningOfMessageRange)(e,n,(0,a.numberOrThrowIfTooLarge)(t)),{lowerInclusive:!0,upperInclusive:!0,shouldDecrypt:!1});return n===h.MessagePropertyType.SystemMessage&&!1!==(null==r?void 0:r.skipRecentSystemMessages)&&(i=i.filter((e=>!((0,h.isSecuritySensitiveMessage)(e)&&e.t>l.Clock.globalUnixTime()-s.DAY_SECONDS)))),(null==r?void 0:r.skipStarred)&&(i=i.filter((e=>void 0===e.isStarred))),n===h.MessagePropertyType.SystemMessage&&(i=i.filter((e=>!(e.type===d.MSG_TYPE.E2E_NOTIFICATION&&"encrypt"===e.subtype)))),i.map((e=>e.id))}))).apply(this,arguments)}function T(){return(T=(0,i.default)((function*(e,t){const n=e.map((e=>(0,f.protobufToMsgKey)((0,o.default)(e.key,"syncActionMessage.key")).toString())),r=yield(0,u.getTable)().bulkGet(n),i=[];return r.forEach((e=>{null!=e&&((null==t?void 0:t.skipStarred)&&null!=e.isStarred||i.push(e.id))})),i}))).apply(this,arguments)}const b={limitAdditionalMessages:y};t._test=b},90641:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.PreviousMsgNotPlaceholderError=t.DuplicateMessageError=void 0,t.encryptMultipleMsgs=Q,t.processPaymentMessages=function(){return z.apply(this,arguments)},t.processRevokeMsgs=function(){return $.apply(this,arguments)},t.starMessages=function(e){if((0,c.isMDBackend)())return(0,I.getTable)().bulkGet(e).then((e=>{const t=e.filter(Boolean).map((e=>({id:e.id,isStarred:e.rowId})));return(0,I.getTable)().bulkCreateOrMerge(t)}));return Promise.resolve()},t.storeEncryptedMessage=Z,t.storeInitialSyncMessages=function(){return W.apply(this,arguments)},t.storeMessageInTransaction=ee,t.storeMessages=function(){return V.apply(this,arguments)},t.storeRecentAndFullHistSyncMessages=function(){return H.apply(this,arguments)},t.unstarMessages=function(e){if((0,c.isMDBackend)())return(0,I.getTable)().bulkCreateOrMerge(e.map((e=>({id:e,isStarred:void 0}))));return Promise.resolve()},t.updateExistingMessages=function(e,t){if((0,c.isMDBackend)()){var n;const r=null==t?null===(n=e[0])||void 0===n?void 0:n.id.remote:t;if(r){const t=e.map((e=>ae((0,G.convertToMessageRowType)(e),r.toString(),!!(0,u.findLink)(e.body,!0))));return Promise.resolve((0,I.getTable)().bulkCreateOrMerge(t)).then((()=>{E.default.index()})).catch((e=>{throw __LOG__(3)`Error storing messages`,e}))}}return Promise.resolve()},t.updateMessage=function(e){if((0,c.isMDBackend)())return(0,N.getStorage)().lock(["message"],function(){var t=(0,a.default)((function*(t){let[n]=t;const r=yield n.get(e.id.toString());if(!r)throw new Error(`[messaging] updateMessage: msgId::${e.id.toString()}, Failed to find previous message row in message table`);if(!function(e){if(null==e?void 0:e.type){if(e.type===f.MSG_TYPE.CIPHERTEXT)return!0;if(e.type===f.MSG_TYPE.UNKNOWN&&"fanout"===e.subtype)return!0}return!1}(r))throw __LOG__(2,void 0,void 0,void 0,["messaging"])`updateMessage: msgId::${e.id.toString()}, Previous row in message table is not a placeholder`,new Y;null!=r.t&&(e.t=r.t),r.ack>e.ack&&(e.ack=r.ack);const i=ae((0,G.convertToMessageRowType)(e),e.from.toString(),!!(0,u.findLink)(e.body,!0),void 0,void 0,r.pendingReadReceipt);if(i.rowId=r.rowId,i.internalId=r.internalId,null==i.rowId||null==i.internalId)throw new Error(`[messaging] updateMessage: msgId::${e.id.toString()}, missing rowId or internalId`);yield n.createOrReplace(i),(0,w.populatePlaceHolderAction)(r),E.default.index()}));return function(){return t.apply(this,arguments)}}());return Promise.resolve()};var i=r(n(81109)),a=r(n(48926)),o=r(n(2525)),s=n(52613),l=n(52230),c=n(88555),d=n(40234),u=n(95726),p=r(n(65212)),f=n(15461),h=n(93778),_=r(n(89867)),g=n(45454),m=r(n(86128)),y=n(48285),E=r(n(69048)),S=n(12669),v=n(35588),T=n(44936),b=n(99234),C=n(6901),A=n(57701),P=r(n(52991)),M=n(62415),O=n(41566),I=n(90981),w=n(63728),R=n(76214),D=n(54676),L=n(49831),N=n(99069),k=r(n(41809)),U=n(43323),G=n(12896),x=n(21224),B=n(65044);const F=1e9;class j extends Error{constructor(){super(...arguments),this.name="DuplicateMessageError"}}t.DuplicateMessageError=j;class Y extends Error{constructor(){super(...arguments),this.name="PreviousMsgNotPlaceholderError"}}t.PreviousMsgNotPlaceholderError=Y;class K extends Error{constructor(){super(...arguments),this.name="DroppingMsgRowDueToLogout"}}function W(){return(W=(0,a.default)((function*(e){if((0,c.isMDBackend)()){yield S.DbEncKeyStore.waitForFinalDbMsgEncKey();let t=0;(0,o.default)(e,(e=>{let{msgs:n}=e;return t+=n.length}));const r=new Map,i=new Map,a=Object.keys(e).reduce(((t,n)=>{let i=t.nextRowId,a=F-e[n].msgs.length;const{pendingUnreadIds:o,unreadMentions:s}=ne(e[n].chatInfo.unreadCount||0,e[n].msgs);(0,O.isGroupCatchUpEnabled)()&&s.length&&r.set(n,s);const l=[];return e[n].msgs.forEach((e=>{try{i++,a++,e.isMdHistoryMsg=!0;const t=ae((0,G.convertToMessageRowType)(e),(0,g.createWid)(n).toString(),!!(0,u.findLink)(e.body,!0),i,a,o.has(String(e.id)));l.push(t)}catch(e){if(e instanceof K)throw e;__LOG__(4,void 0,new Error,void 0,["encryptMultipleMsgs"])`storeInitialSyncMessages failed with error: ${e.name}, message: ${e.message}, stack: ${e.stack}`}})),{nextRowId:i,messages:t.messages.concat(l)}}),{nextRowId:F-t,messages:[]});return a.messages.forEach((e=>{e.type===f.MSG_TYPE.GROUPS_V4_INVITE&&(0,M.persistGroupInviteV4Msg)(e.id.toString(),{id:e.id.toString(),from:e.from.toString(),to:e.to.toString(),groupId:e.inviteGrp,expiration:parseInt(e.inviteCodeExp,10),expired:d.Clock.globalUnixTime()>=parseInt(e.inviteCodeExp,10)})})),(0,O.isGroupCatchUpEnabled)()&&r.size&&(r.forEach(((e,t)=>{var r,a;const o=n(69951).ChatCollection.get((0,g.createWid)(t)),s=e.map((e=>{let{id:t,timestamp:n}=e;return new k.default({id:t,timestamp:n})})),l=null==o||null===(r=o.groupMetadata)||void 0===r?void 0:r.unreadMentionMetadata,c=null!==(a=null==l?void 0:l.pendingUnreadMentionCount)&&void 0!==a?a:0;(null==l?void 0:l.pendingUnreadMentionCount)&&(l.pendingUnreadMentionCount=Math.max(c-s.length,0),i.set(t,l.pendingUnreadMentionCount)),null==l||l.addUnreadMentions(s,U.UnreadMessageType.HISTORYC_SYNC_CHUNK)})),(0,y.addUnreadMentionChat)(r,i)),(0,N.getStorage)().lock(["message"],(e=>{let[t]=e;return t.bulkCreate(a.messages).catch((e=>{if(__LOG__(3)`Error storing MD initial sync messages with error ${e}`,e instanceof m.default.BulkError||e instanceof m.default.ConstraintError)return __LOG__(2,void 0,void 0,void 0,["History sync"])`Retrying initial sync bulk add on error`,t.bulkCreateOrMerge(a.messages);throw e}))})).then((()=>{m.default.ignoreTransaction((()=>{(0,T.getTable)().bulkCreateOrReplace(a.messages.map((e=>({id:String(e.rowId)})))).then((()=>{E.default.index()}))}))})).catch((e=>{__LOG__(3)`Error storing MD initial sync messages with error ${e} after retry`}))}return Promise.resolve()}))).apply(this,arguments)}function H(){return(H=(0,a.default)((function*(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if((0,c.isMDBackend)()){let a=e;const o=n(69951).ChatCollection,s=new Map,l=new Map;try{a=yield(0,L.applyOrphanRevoke)(e)}catch(e){__LOG__(4,void 0,new Error,void 0,["History Sync"])`applyOrphanRevoke failed with error ${e}`}a.forEach((e=>{if(e.type===f.MSG_TYPE.GROUPS_V4_INVITE&&(0,M.persistGroupInviteV4Msg)(e.id.toString(),{id:e.id.toString(),from:e.from.toString(),to:e.to.toString(),groupId:e.inviteGrp,expiration:parseInt(e.inviteCodeExp,10),expired:d.Clock.globalUnixTime()>=parseInt(e.inviteCodeExp,10)}),(0,O.isGroupCatchUpEnabled)()&&(0,D.isImportantMessage)(e)){const a=e.id.remote.toString();let c=0;if(l.has(a)){var t;c=null!==(t=l.get(a))&&void 0!==t?t:0}else{var n,r;const e=o.get(a);c=null!==(n=null==e||null===(r=e.groupMetadata)||void 0===r?void 0:r.unreadMentionMetadata.pendingUnreadMentionCount)&&void 0!==n?n:0,l.set(a,c)}if(c>0){l.set(a,c-1);const t={id:e.id.toString(),timestamp:e.t};var i;if(s.has(a))null===(i=s.get(a))||void 0===i||i.push(t);else s.set(a,[t])}}}));return Z(yield Q(a,r),t,i).then((()=>{(0,O.isGroupCatchUpEnabled)()&&s.size>0&&(s.forEach(((e,t)=>{var n,r;const i=o.get(t),a=null!==(n=l.get(t))&&void 0!==n?n:0,c=null==i||null===(r=i.groupMetadata)||void 0===r?void 0:r.unreadMentionMetadata;if(0===(null==c?void 0:c.pendingUnreadMentionCount)||(null==i?void 0:i.hasChatBeenOpened))s.delete(t);else if(c&&c.pendingUnreadMentionCount>0){c.pendingUnreadMentionCount=a;const t=e.map((e=>new k.default({id:e.id.toString(),timestamp:e.timestamp})));c.addUnreadMentions(t,U.UnreadMessageType.HISTORYC_SYNC_CHUNK)}})),s.size>0&&(0,y.addUnreadMentionChat)(s,l))})).catch((()=>{__LOG__(3)`Error storing MD recent or full sync messages`}))}return Promise.resolve()}))).apply(this,arguments)}function V(){return(V=(0,a.default)((function*(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return(0,c.isMDBackend)()?(yield S.DbEncKeyStore.waitForFinalDbMsgEncKey(),Promise.resolve(ee(e,t,n)).then((()=>{E.default.index()})).catch((e=>{throw e instanceof m.default.BulkError||e instanceof m.default.ConstraintError?new j:(__LOG__(3)`Error storing messages`,e)}))):Promise.resolve()}))).apply(this,arguments)}function $(){return($=(0,a.default)((function*(e){if((0,c.isMDBackend)()){const t=[],n=[],r=[],i=new Map,o=e.filter((e=>{const{revokeMsgKey:t,newMsgKey:n,subtype:r}=e;let i=!0;return"admin_revoke"===r?(0,A.adminRevokeReceiverEnabled)()?_.default.isGroup(t.remote)?_.default.equals(t.remote,n.remote)||(i=!1,__LOG__(2)`processRevokeMsgs: ${String(t)} has not been revoked`,__LOG__(3,void 0,void 0,!0)`processRevokeMsgs: admin revoke came for the different group than the original message was in`,SEND_LOGS("process-admin-revoke-message")):(i=!1,__LOG__(2)`processRevokeMsgs: ${String(t)} has not been revoked`,__LOG__(3,void 0,void 0,!0)`processRevokeMsgs: admin revoke was sent to a non-group chat`,SEND_LOGS("process-admin-revoke-message")):(i=!1,__LOG__(2)`processRevokeMsgs: admin revoke feature is disabled, ${String(t)} has not been revoked`):(i=_.default.equals(t.remote,n.remote)&&_.default.equals(t.participant,n.participant)&&t.fromMe===n.fromMe,i||__LOG__(2)`processRevokeMsgs: invalid revoke request ${String(t)}, ${String(n)}`),i}));o.forEach((e=>{n.push(e.revokeMsgKey.toString()),r.push(e.newMsgKey.toString())}));const s=o.length;yield(0,N.getStorage)().lock(["message","orphan-revoke"],function(){var e=(0,a.default)((function*(e){let[a,l]=e;const c=yield(0,R.getMessageTable)().bulkGet(n.concat(r),!1),d=c.slice(0,s),u=c.slice(s),h=[],_=[];d.forEach(((e,a)=>{var s,l;if(null==e)return __LOG__(2)`processRevokeMsg: orphan revoke message key ${d[a]}`,void _.push({msgKey:n[a],sender:o[a].sender,timestamp:o[a].timestamp,subtype:null!==(l=o[a].subtype)&&void 0!==l?l:"sender_revoke"});if(h.push({id:r[a],to:e.to,author:e.author,type:f.MSG_TYPE.REVOKED,subtype:"admin_revoke"===o[a].subtype?"admin":"sender",revokeSender:o[a].sender,protocolMessageKey:n[a],protocolMessageRowId:null===(s=u[a])||void 0===s?void 0:s.rowId,from:e.from,t:e.t,rowId:e.rowId,internalId:e.internalId,messageRangeIndex:e.messageRangeIndex}),t.push(String(e.rowId)),(0,O.isGroupCatchUpEnabled)()&&(0,D.isImportantMessage)(e)){const t=p.default.fromString(e.id).remote.toString();if(i.has(t)){var c;const n=null!==(c=i.get(t))&&void 0!==c?c:[];i.set(t,[...n,e.id])}else i.set(t,[e.id])}}));const g=[(0,R.getMessageTable)().bulkRemove(n),(0,R.getMessageTable)().bulkCreateOrReplace(h)];_.length>0&&g.push((0,R.getOrphanRevokeTable)().bulkCreateOrReplace(_)),yield Promise.all(g)}));return function(){return e.apply(this,arguments)}}()),E.default.purge(t),(0,O.isGroupCatchUpEnabled)()&&(0,y.removeUnreadMentionChat)(i)}return Promise.resolve()}))).apply(this,arguments)}function z(){return(z=(0,a.default)((function*(e){if((0,c.isMDBackend)()){const t=[],n=[],r=e.map((e=>e.paymentRequestMessageKey?e.paymentRequestMessageKey.toString():"")).filter((e=>""!==e)),i=e.filter((e=>"payment_action_request_declined"===e.subtype||"payment_transaction_request_cancelled"===e.subtype)).map((e=>e.id.toString()));return(0,N.getStorage)().lock(["message"],function(){var o=(0,a.default)((function*(a){let[o]=a;const s=yield(0,v.getMsgsByMsgKey)(r.concat(i)),l=new Map;return s.forEach((e=>{null!=e&&l.set(e.id.toString(),e)})),e.forEach((e=>{var r;const i=null===(r=e.paymentRequestMessageKey)||void 0===r?void 0:r.toString(),a=l.get(i||"");if(a)if("send"===e.subtype&&null!=e.paymentTxnStatus)t.push({id:i,paymentTxnStatus:e.paymentTxnStatus});else{const n=a.from.isGroup()?a.author:a.from,r=a.paymentMessageReceiverJid.equals((0,b.getMeUser)())?n:a.paymentMessageReceiverJid;"payment_action_request_declined"===e.subtype?t.push({id:i,paymentStatus:x.PaymentInfoStatus.REJECTED,paymentTxnStatus:x.PaymentInfoTxnStatus.COLLECT_REJECTED}):"payment_transaction_request_cancelled"===e.subtype&&t.push({id:i,paymentStatus:x.PaymentInfoStatus.CANCELLED,paymentTxnStatus:x.PaymentInfoTxnStatus.COLLECT_CANCELED}),t.push({id:e.id.toString(),type:f.MSG_TYPE.NOTIFICATION_TEMPLATE,templateParams:[r,a.paymentCurrency,String(a.paymentAmount1000)]})}else l.get(e.id.toString())&&!e.isMdHistoryMsg&&n.push(e.id.toString())})),yield(0,R.getMessageTable)().bulkRemove(n),yield(0,R.getMessageTable)().bulkCreateOrMerge(t),t}));return function(){return o.apply(this,arguments)}}())}return null}))).apply(this,arguments)}function q(){return J.apply(this,arguments)}function J(){return(J=(0,a.default)((function*(e,t){if(P.default.isLogoutInProgress)return Promise.reject(new K);null!=t&&(yield(0,s.asyncSleepAfterGivenLoopIteration)(t,35,100));const n=(0,R.getMessageTable)(),r=oe(e),a=(0,G.convertToMessageRowType)(e),o=yield n.preflightEncryptSingleRecord((0,i.default)({},a));return[(0,i.default)((0,i.default)((0,i.default)({},a),o),{},{vcardWAids:r}),!!(0,u.findLink)(e.body,!0)]}))).apply(this,arguments)}function Q(){return X.apply(this,arguments)}function X(){return(X=(0,a.default)((function*(e){let t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(yield S.DbEncKeyStore.waitForFinalDbMsgEncKey(),yield new Promise((e=>setTimeout(e,0))),n){t=[];for(let n=0;n<e.length;n++)try{const r=e[n],i=yield q(r,n);t.push(i)}catch(e){if(e instanceof K)throw e;__LOG__(4,void 0,new Error,void 0,["encryptMultipleMsgs"])`processAndEncryptSingleMsgRow with throttle failed with error: ${e.name}, message: ${e.message}, stack: ${e.stack}`}}else t=yield Promise.all(e.map(function(){var e=(0,a.default)((function*(e){return yield q(e).catch((e=>{if(e instanceof K)throw e;__LOG__(4,void 0,new Error,void 0,["encryptMultipleMsgs"])`processAndEncryptSingleMsgRow without throttle failed with error: ${e.name}, message: ${e.message}, stack: ${e.stack}`})).finally((()=>{}))}));return function(){return e.apply(this,arguments)}}())),t=t.filter(Boolean);return t}))).apply(this,arguments)}function Z(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return(0,N.getStorage)().lock(["message"],function(){var r=(0,a.default)((function*(r){let[i]=r;const a=yield i.all({reverse:!n,limit:1,index:["rowId"],returnKeyType:"keys"}).then((e=>0===e.length?F:e[0])),o={};yield Promise.all(t.map((e=>{const t=(0,g.createWid)(e),r=(0,G.beginningOfChat)(t),a=(0,G.endOfChat)(t);return i.between(["internalId"],r,a,{limit:1,reverse:!n,returnKeyType:"keys"}).then((e=>o[t.toString()]=0===e.length?F:(0,G.getInChatMsgId)(e[0])))})));const s=n?-1:1,l=e.map(((e,t)=>{let[r,i]=e;n&&(r.isMdHistoryMsg=!0);const l=p.default.fromString(r.id),c=l.remote.toString(),d=o[c]+1*s;o[c]=d;const u=!n&&te(l,r);return ae(r,c,i,a+s*(t+1),d,u)}));return i.bulkCreateWith_ALREADY_ENCRYPTED_RECORDS_ONLY(l).catch((e=>{if(n&&e instanceof m.default.BulkError)return __LOG__(4,void 0,new Error)`[storeEncryptedMessage] BulkError in bulkCreate, retrying with bulk create or replace`,i.bulkCreateOrReplace_ALREADY_ENCRYPTED_RECORDS_ONLY(l);throw e})).then((()=>l))}));return function(){return r.apply(this,arguments)}}()).then((e=>{m.default.ignoreTransaction((()=>{(0,T.getTable)().bulkCreateOrReplace(e.map((e=>({id:String(e.rowId)})))).then((()=>{E.default.index()}))}))}))}function ee(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=null==t?e[0].id.remote:t,i=(0,G.beginningOfChat)(r),o=(0,G.endOfChat)(r);return(0,N.getStorage)().lock(["chat","message"],function(){var t=(0,a.default)((function*(t){let[a,s]=t;const l=yield a.get(r.toString());if(!r.isStatusV3()&&(null!=l||(0,G.shouldCreateChatWithMsgs)(e))){const t=yield re(l,e,r);yield a.createOrMerge(r.toString(),t)}const c=s.all({reverse:!n,limit:1,index:["rowId"],returnKeyType:"keys"}).then((e=>0===e.length?F:e[0])),d=s.between(["internalId"],i,o,{limit:1,reverse:!n,returnKeyType:"keys"}).then((e=>0===e.length?F:(0,G.getInChatMsgId)(e[0]))),[p,f]=yield Promise.all([c,d]),h=n?p-e.length:p+1,_=n?f-e.length:f+1,g=e.map(((e,t)=>{const i=(0,G.convertToMessageRowType)(e),a=!n&&te(e.id,e);return ae(i,r.toString(),!!(0,u.findLink)(e.body,!0),h+t,_+t,a)}));return s.bulkCreate(g).then((()=>g))}));return function(){return t.apply(this,arguments)}}()).then((e=>{m.default.ignoreTransaction((()=>{(0,T.getTable)().bulkCreateOrReplace(e.map((e=>({id:String(e.rowId)}))))}))}))}function te(e,t){if(e.fromMe||e.remote.isStatusV3())return!1;const n=(0,D.eventTypeFromMsgType)(t);return"a"===n||"d"===n}function ne(e,t){let n=e;const r=new Set,i=[];for(let e=t.length-1;e>=0&&!(n<=0);e--){const a=t[e];if(te(a.id,a)&&(n--,r.add(String(a.id)),(0,O.isGroupCatchUpEnabled)()&&(0,D.isImportantMessage)(a))){const e={id:String(a.id),timestamp:a.t};i.push(e)}}return{pendingUnreadIds:r,unreadMentions:i}}function re(){return ie.apply(this,arguments)}function ie(){return(ie=(0,a.default)((function*(e,t,n){var r;let i,a=Math.max(0,e?e.unreadCount:0);const o=null!==(r=null==e?void 0:e.unreadMentionsOfMe)&&void 0!==r?r:[];return t.forEach((e=>{const t=(0,D.eventTypeFromMsgType)(e);if("i"!==t&&(e&&null!=e.t&&(null==i||e.t>i)&&(i=e.t),"a"!==t&&"d"!==t||e.id.fromMe||(a+=1),(0,O.isGroupCatchUpEnabled)())){if(te(e.id,e)&&(0,D.isImportantMessage)(e)){const t={id:e.id.toString(),timestamp:e.t};o.push(t)}}})),e&&null!=e.t&&(null==i||e.t>i)&&(i=e.t),{id:n.toString(),unreadCount:a,t:i,unreadMentionsOfMe:o}}))).apply(this,arguments)}function ae(e,t,n,r,a,o){const s=[f.MSG_TYPE.IMAGE,f.MSG_TYPE.VIDEO,f.MSG_TYPE.AUDIO].includes(e.type),c=(0,i.default)((0,i.default)({},e),{},{vcardWAids:e.vcardWAids||oe(e),id:e.id.toString(),isStarred:e.star?r:void 0,hasLink:"chat"===e.type&&n?r:void 0,isMediaMsg:s?r:void 0,isDocMsg:e.type===f.MSG_TYPE.DOCUMENT?r:void 0,expiredTimestamp:se(e)});null!=r&&(c.rowId=r),null!=a&&(c.internalId=(0,G.craftInternalId)(t,a)),o&&t!==l.STATUS_JID&&(c.pendingReadReceipt=1);let d=e.c2sTimestamp;var u;e.id.fromMe&&!B.Socket.hasSynced?d=null!==(u=e.c2sTimestamp)&&void 0!==u?u:e.t:d=e.t;try{c.messageRangeIndex=(0,G.craftMessageRangeIndex)(t,!p.default.fromString(e.id).fromMe,f.SYSTEM_MESSAGE_TYPES.includes(e.type),d)}catch(e){__LOG__(4,void 0,new Error)`[process-msg] craftMessageRangeIndex failed with error ${e}`}return c}function oe(e){let t=[];if("vcard"===e.type)t=[e.body];else{if("multi_vcard"!==e.type)return;t=e.vcardList.map((e=>e.vcard))}return t.filter(Boolean).reduce(((e,t)=>{const n=(0,h.vcardWids)((0,h.parseVcard)(t));return e.concat(n.map((e=>e.toString())))}),[])}function se(e){const{ephemeralDuration:t,ephemeralStartTimestamp:n,t:r,subtype:i,id:{fromMe:a}}=e,o=(0,C.getEphemeralExpirationTimestamp)(t,n,r,i,a);return null!=o?o:void 0}},13946:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getBoundsForChat=function(){return c.apply(this,arguments)},t.queryAndRemoveMessageHistory=function(){return u.apply(this,arguments)},t.queryAndRemoveMessagesInMessageRange=function(){return d.apply(this,arguments)};var i=r(n(48926)),a=r(n(69048)),o=n(90981),s=n(30986),l=n(12896);function c(){return(c=(0,i.default)((function*(e){const t=(0,l.beginningOfChat)(e),n=(0,l.endOfChat)(e),r=yield(0,o.getTable)().between(["internalId"],t,n,{lowerInclusive:!1,upperInclusive:!1,limit:1});if(0===r.length)return null;const i=r[0].rowId,a=yield(0,o.getTable)().between(["internalId"],t,n,{lowerInclusive:!1,upperInclusive:!1,limit:1,reverse:!0});if(0===a.length)return null;const s=a[0].rowId,c=a[0].t;return null==i||null==s?null:{startRowId:i,endRowId:s,tsOfLastMessage:c}}))).apply(this,arguments)}function d(){return(d=(0,i.default)((function*(e,t,n){const r=yield(0,s.deleteMessagesInMessageRange)(e,t,n);return a.default.purge(r),r}))).apply(this,arguments)}function u(){return(u=(0,i.default)((function*(e){const t=(0,l.beginningOfChat)(e),n=(0,l.endOfChat)(e),r=yield(0,o.getTable)().between(["internalId"],t,n,{lowerInclusive:!1,upperInclusive:!1,returnKeyType:"primary_key"});return yield(0,o.getTable)().bulkRemove(r),r}))).apply(this,arguments)}},12896:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.MessagePropertyType=t.MSG_OPAQUE_DATA_KEYS=void 0,t.beginningOfChat=function(e){return`${e.toString()}_/`},t.beginningOfMessageRange=function(e,t,n){const r=null!=n?P(n):"";return`${e.toString()}_${t}_${r}`},t.convertToMessageRowType=function(e){var t;let n=(0,o.default)({},e);e.quotedMsg&&(n.quotedMsg=(0,o.default)({},e.quotedMsg));(null===(t=e.quotedMsg)||void 0===t?void 0:t.paymentNoteMsg)&&(n.quotedMsg.paymentNoteMsg=(0,o.default)({},e.quotedMsg.paymentNoteMsg));e.paymentNoteMsg&&(n.paymentNoteMsg=(0,o.default)({},e.paymentNoteMsg));n.id=e.id.toString(),e.from&&(n.from=e.from.toString());e.protocolMessageKey&&(n.protocolMessageKey=e.protocolMessageKey.toString());e.paymentRequestMessageKey&&(n.paymentRequestMessageKey=e.paymentRequestMessageKey.toString());return delete n.notifyName,delete n.local,delete n.isNewMsg,delete n.clearMedia,delete n.multicast,delete n.urlNumber,delete n.urlText,delete n.linkPreview,delete n.star,delete n.forwardedFromWeb,n=function(e){var t,n,r;const i={currentMsg:{},quotedMsg:{}};if(null===(t=e.paymentNoteMsg)||void 0===t?void 0:t.body){var a;i.currentMsg.paymentNoteMsgBody=e.paymentNoteMsg.body,null===(a=e.paymentNoteMsg)||void 0===a||delete a.body}(null===(n=e.quotedMsg)||void 0===n||null===(r=n.paymentNoteMsg)||void 0===r?void 0:r.body)&&(i.quotedMsg.paymentNoteMsgBody=e.quotedMsg.paymentNoteMsg.body,delete e.quotedMsg.paymentNoteMsg.body);C.forEach((t=>{i.currentMsg[t]=e[t],delete e[t]})),e.quotedMsg&&C.forEach((t=>{i.quotedMsg[t]=e.quotedMsg[t],delete e.quotedMsg[t]}));const o=(0,f.encodeProtobuf)(y.MsgRowOpaqueDataSpec,i);return e.msgRowOpaqueData=o.readBuffer(),e}(n),n},t.craftInternalId=function(e,t){const n=P(t);return`${e}_${n}_m`},t.craftMessageRangeIndex=function(e,t,n,r){let i;i=n?A.SystemMessage:t?A.IncomingChatMessage:A.Outgoing;return`${e}_${i}_${null!=r?P(r):""}`},t.endOfChat=function(e){return`${e.toString()}_g`},t.endOfMessageRange=function(e,t){return`${e.toString()}_${t}_g`},t.extractC2STimestampFromMessageRangeIndex=function(e){if(e){const t=e.split("_")[2];return t?M(t):null}return null},t.getInChatMsgId=function(e){return M(e.split("_")[1])},t.getKeyMsgsFromChatHistory=function(e,t){if((0,l.isMDBackend)()){performance.now();const r=(0,h.getABPropConfigValue)("web_init_chat_max_unread_message_count");let i,a,o,s,l=e.unreadCount,c=0;const u=[];let p=0;const f=n=>(c++,n.type!==d.MSG_TYPE.PROTOCOL&&(n.type!==d.MSG_TYPE.REACTION&&((0,g.receiveReactionsEnabled)()&&R(n)?0!==r&&p>=r?(s||(s=n.id),o||(__LOG__(3)`[init-from-storage] getKeyMsgsFromChatHistory: Exceeded limit ${r} to find a non futureproof reaction message`,o=n),!0):(t||u.push(n),p++,!1):(s||(s=n.id),o||(o=n),a||[d.MSG_TYPE.E2E_NOTIFICATION,d.MSG_TYPE.PROTOCOL,d.MSG_TYPE.REACTION].includes(n.type)||(a=n),!t&&(null!=a||c>10)||(!(!(0===l||0!==r&&e.unreadCount>=r)||!a)||!!(l>0&&w(n)&&(l-=1,0===l))&&(i=n.id.toString(),!0))))));return(0,E.getTable)().between(["internalId"],`${e.id}_/`,`${e.id}_g`,{reverse:!0},f).then((()=>{if(u.length){(0,n(8765).o0)(u)}return{anchor:i,previewMsg:a||o,lastReceivedKey:s}}))}return Promise.resolve({anchor:void 0,previewMsg:void 0,lastReceivedKey:void 0})},t.hydrateMessage=function(e){var t;let n=(0,o.default)({},e);e.quotedMsg&&(n.quotedMsg=(0,o.default)({},e.quotedMsg));(null===(t=e.quotedMsg)||void 0===t?void 0:t.paymentNoteMsg)&&(n.quotedMsg.paymentNoteMsg=(0,o.default)({},e.quotedMsg.paymentNoteMsg));e.paymentNoteMsg&&(n.paymentNoteMsg=(0,o.default)({},e.paymentNoteMsg));e.paymentBackground&&(n.paymentBackground=(0,o.default)({},e.paymentBackground));const r=c.default.fromString(n.id),i=n.protocolMessageKey?c.default.fromString(n.protocolMessageKey):void 0,a=n.paymentRequestMessageKey?c.default.fromString(n.paymentRequestMessageKey):void 0,s=(0,v.hydrateWids)(n);s.id=r,i&&(s.protocolMessageKey=i);a&&(s.paymentRequestMessageKey=a);return n.star=void 0!==n.isStarred,n.isMdHistoryMsg=n.rowId<b,delete n.internalId,delete n.isStarred,delete n.count,delete n.hasLink,delete n.isMediaMsg,delete n.isDocMsg,delete n.expiredTimestamp,delete n.pendingReadReceipt,n=function(e){const t=(0,p.decodeProtobuf)(y.MsgRowOpaqueDataSpec,e.msgRowOpaqueData);if(t.currentMsg){var n;if(t.currentMsg.paymentNoteMsgBody&&e.paymentNoteMsg)e.paymentNoteMsg.body=null===(n=t.currentMsg)||void 0===n?void 0:n.paymentNoteMsgBody;C.forEach((n=>{var r;e[n]=null===(r=t.currentMsg)||void 0===r?void 0:r[n]}))}e.quotedMsg&&t.quotedMsg&&(t.quotedMsg.paymentNoteMsgBody&&(e.quotedMsg.paymentNoteMsg.body=t.quotedMsg.paymentNoteMsgBody),C.forEach((n=>{var r;e.quotedMsg[n]=null===(r=t.quotedMsg)||void 0===r?void 0:r[n]})));return e}(n),n},t.isReactionFutureproof=R,t.isSecuritySensitiveMessage=function(e){var t;const n=new Map([[d.MSG_TYPE.GP2,["remove","add","ephemeral","invite","leave"]],[d.MSG_TYPE.E2E_NOTIFICATION,["encrypt","encrypt_now","e2e_identity_unavailable","identity","device"]],[d.MSG_TYPE.NOTIFICATION_TEMPLATE,["change_number","verified_initial_unknown","verified_initial_low","verified_initial_high","verified_transition_any_to_none","verified_transition_any_to_high","verified_transition_high_to_low","verified_transition_high_to_unknown","verified_transition_unknown_to_low","verified_transition_low_to_unknown","verified_transition_none_to_low","verified_transition_none_to_unknown","payment_transaction_status_update_failed","payment_transaction_status_update_refunded","payment_transaction_status_update_refund_failed","payment_transaction_status_receiver_pending_setup","payment_transaction_status_receiver_success_after_hiccup","payment_transaction_request_cancelled","payment_action_account_setup_reminder","payment_action_send_payment_reminder","payment_action_send_payment_invitation","payment_action_request_declined","payment_action_request_expired"]]]);return(null===(t=n.get(e.type))||void 0===t?void 0:t.includes(e.subtype))||!1},t.isUnreadTypeMsg=w,t.queryChatMessageHelper=function(){return O.apply(this,arguments)},t.queryChatVisibleMessageHelper=function(){return I.apply(this,arguments)},t.shouldCreateChatWithMsgs=function(e){return e.some((e=>e.type!==d.MSG_TYPE.NOTIFICATION_TEMPLATE))},t.shouldRenderInUI=L;var i=r(n(6479)),a=r(n(48926)),o=r(n(81109)),s=n(35470),l=n(88555),c=r(n(65212)),d=n(15461),u=n(45454),p=n(84902),f=n(60980),h=n(57849),_=n(99234),g=n(57701),m=n(41566),y=n(82348),E=n(90981),S=n(52489),v=n(64448);const T=["limit"],b=1e9,C=["body","caption","clientUrl","loc","lng","isLive","lat","paymentAmount1000","canonicalUrl","matchedText","title","description","futureproofBuffer"];t.MSG_OPAQUE_DATA_KEYS=C;const A=n(76672)({IncomingChatMessage:"1",Outgoing:"2",SystemMessage:"3"});function P(e){const t=e.toString(16);return(t.length-1).toString(16)+t}function M(e){return parseInt(e.substring(1),16)}function O(){return(O=(0,a.default)((function*(e,t,n){if((0,l.isMDBackend)()){const r=(yield(0,E.getTable)().between(["internalId"],e,t,n)).filter((e=>L(e)));return yield N(r),r}return Promise.resolve([])}))).apply(this,arguments)}function I(){return(I=(0,a.default)((function*(e,t,r,a){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];const{limit:s}=r,c=(0,i.default)(r,T),d=(0,h.getABPropConfigValue)("web_init_chat_max_unread_message_count");if((0,l.isMDBackend)()){const r=[];let i=0;const s=e=>null!=a&&i===a||!!L(e,o)&&(i++,i>d&&__LOG__(3)`queryChatVisibleMessageHelper: visibleMsgsCount exceeds the threshold`,!1),l=(yield(0,E.getTable)().between(["internalId"],e,t,c,s)).filter((e=>(0,g.receiveReactionsEnabled)()&&R(e)&&!o.includes(e.id.toString())?(r.push(e),!1):!!L(e,o)));if(r.length){(0,n(8765).o0)(r)}return yield N(l),l}return Promise.resolve([])}))).apply(this,arguments)}function w(e){if(e.type===d.MSG_TYPE.UNKNOWN&&"reaction"===e.subtype)return!1;const t=[d.MSG_TYPE.CHAT,d.MSG_TYPE.IMAGE,d.MSG_TYPE.VIDEO,d.MSG_TYPE.AUDIO,d.MSG_TYPE.PTT,d.MSG_TYPE.DOCUMENT,d.MSG_TYPE.VCARD,d.MSG_TYPE.LOCATION,d.MSG_TYPE.CIPHERTEXT,d.MSG_TYPE.OVERSIZED,d.MSG_TYPE.MULTI_VCARD,d.MSG_TYPE.STICKER,d.MSG_TYPE.PRODUCT,d.MSG_TYPE.GROUPS_V4_INVITE];return(0,m.isSenderRevokeUiEnabled)()||t.push(d.MSG_TYPE.REVOKED),t.includes(e.type)}function R(e){return e.type===d.MSG_TYPE.UNKNOWN&&e.subtype===d.MSG_TYPE.REACTION}function D(e){return e.type===d.MSG_TYPE.UNKNOWN&&e.subtype===d.MSG_TYPE.POLL_UPDATE}function L(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return e.type!==d.MSG_TYPE.REACTION&&((!(0,g.isPollsFutureproofUpdateHidingEnabled)()||!D(e))&&(e.type!==d.MSG_TYPE.DEBUG&&!((0,g.receiveReactionsEnabled)()&&R(e)&&!t.includes(e.id.toString()))))}function N(){return k.apply(this,arguments)}function k(){return(k=(0,a.default)((function*(e){const t=U(e);if(0===t.length)return;const n=yield(0,S.getTable)().anyOf(["msgKey"],t.map((e=>e.id))),r=new Map,i=[];n.forEach((e=>{const t=(0,u.createWid)(e.receiverUserJid);if((0,_.getMeUser)().equals(t))return;const n=r.get(e.msgKey)||{played:0,read:0,delivery:0};null!=e.played?n.played++:null!=e.read?n.read++:null!=e.delivery&&n.delivery++,r.set(e.msgKey,n)})),t.forEach((e=>{const{ack:t,id:n}=e,a=r.get(n);if(!a)return;let o=null,l=e.count||1;0==(l-=a.played)?o=s.ACK.PLAYED:0==(l-=a.read)?o=s.ACK.READ:0==(l-=a.delivery)&&(o=s.ACK.RECEIVED),null!=o&&o>t&&(e.ack=o,i.push({id:n,ack:o})),i.length>0&&(__LOG__(2,void 0,void 0,void 0,["message-store"])`maybeUpdateMsgAck: storing ack updates ${JSON.stringify(i)}`,(0,E.getTable)().bulkCreateOrMerge(i))}))}))).apply(this,arguments)}function U(e){return e.filter((e=>{if(!w(e))return!1;if(e.type===d.MSG_TYPE.CIPHERTEXT||e.type===d.MSG_TYPE.UNKNOWN||e.ack<=s.ACK.CLOCK)return!1;const t=c.default.fromString(e.id);if(!t.fromMe)return!1;if(t.remote.isGroup()&&(null!=e.rowId&&e.rowId<b||null==e.count))return __LOG__(2,void 0,void 0,void 0,["message-store"])`getMsgMayNeedAckUpdate: skip update for history group message ${e.id}`,!1;if(e.type===d.MSG_TYPE.PTT){if(e.ack===s.ACK.PLAYED)return!1}else if(e.ack===s.ACK.READ)return!1;return!0}))}t.MessagePropertyType=A},40221:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createOrUpdateOrphanReceipt=function(e,t,n){if((0,r.isMDBackend)())return(0,a.getStorage)().lock(["orphan-receipt"],(r=>{let[i]=r;return i.bulkGet(n).then((r=>{const a=n.reduce(((n,i,a)=>{let o=r[a];o||(o={msgKey:i});const s=o[e];return(null==s||s>t)&&(o[e]=t,n.push(o)),n}),[]);return i.bulkCreateOrReplace(a)}))}));return Promise.reject(new Error("updateReceiptRecords: not supported for non MD"))},t.getOrphanReceipt=function(e){if((0,r.isMDBackend)())return(0,i.getTable)().get(e);return Promise.reject(new Error("getOrphanReceipt: not supported for non MD"))},t.removeOrphanReceipt=function(e){if((0,r.isMDBackend)())return(0,i.getTable)().remove(e);return Promise.reject(new Error("removeOrphanReceipt: not supported for non MD"))};var r=n(88555),i=n(56161),a=n(99069)},49831:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.applyOrphanRevoke=function(){return d.apply(this,arguments)};var i=r(n(48926)),a=n(88555),o=n(15461),s=r(n(89867)),l=n(45454),c=n(88851);function d(){return(d=(0,i.default)((function*(e){if((0,a.isMDBackend)()){const t=yield(0,c.getTable)().bulkGet(e.map((e=>String(e.id)))),n=[],r=[];return t.forEach(((t,i)=>{const a=e[i];if(null!=t){var c;if(__LOG__(2)`applyOrphanRevoke: find orphan revoke for message ${a.id.toString()}`,!s.default.isStatusV3(a.id.remote))r.push({id:a.id,to:a.to,author:a.author,revokeSender:(0,l.createWidFromWidLike)(null!==(c=t.sender)&&void 0!==c?c:a.sender),type:o.MSG_TYPE.REVOKED,subtype:"admin_revoke"===t.subtype?"admin":"sender",protocolMessageKey:a.id,from:a.from,t:a.t,broadcast:a.broadcast});n.push(t.msgKey)}else r.push(a)})),(0,c.getTable)().bulkRemove(n),r}return Promise.reject(new Error("applyOrphanRevoke: called in non-md mode"))}))).apply(this,arguments)}},43201:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.GroupUnSyncedError=void 0,t.getGroupSenderKeyList=function(e){let t;if((0,i.isLegacyWebdBackend)())t=Promise.reject(new Error("getGroupSenderKeyList: not supported without model storage and md backend"));else{const r=e.toString();if(t=(0,l.getTable)().get(r).then((t=>{const r=[],i=[];if(!t)return{skDistribList:r,skList:i,rotateKey:!1};const{senderKey:o,rotateKey:l}=t;return Array.from(o.keys()).forEach((e=>{o.get(e)?i.push((0,a.createWid)(e)):r.push((0,a.createWid)(e))})),function(e,t){const r=n(63928).default.get(e);null!=r&&(r.cachedDeviceCount=t,r.cachedDeviceSizeBucket=(0,s.default)(t))}(e,r.length+i.length),l?{skDistribList:r.concat(i),skList:[],rotateKey:l}:{skDistribList:r,skList:i,rotateKey:l}})),!t)return Promise.reject(new Error("getGroupSenderKeyList: not supported"))}return t},t.markForgetSenderKey=function(e,t){let n;if((0,i.isLegacyWebdBackend)())n=Promise.reject(new Error("markForgetSenderKey: not supported without model storage and md backend"));else{const r=e.toString();if(n=(0,c.getStorage)().lock(["participant"],(e=>{let[n]=e;return n.get(r).then((e=>{if(e)return n.createOrReplace(u(e,t,!1));__LOG__(2)`markForgetSenderKey: group participant info missing for group ${r}`}))})),!n)return Promise.reject(new Error("markForgetSenderKey: not supported"))}return n},t.markHasSenderKey=function(e,t){let n;if((0,i.isLegacyWebdBackend)())n=Promise.reject(new Error("markHasSenderKey: not supported without model storage and md backend"));else{const r=e.toString();if(n=(0,c.getStorage)().lock(["participant"],(e=>{let[n]=e;return n.get(r).then((e=>{if(e)return n.createOrReplace(u(e,t,!0));__LOG__(2)`markHasSenderKey: group participant info missing for group ${r}`}))})),!n)return Promise.reject(new Error("markHasSenderKey: not supported"))}return n};var i=n(88555),a=n(45454),o=n(99234),s=r(n(16786)),l=n(96826),c=n(99069);class d extends Error{constructor(){super(...arguments),this.name="GroupUnSyncedError"}}function u(e,t,n){const r=new Map(e.senderKey);let i=!1;return t.forEach((e=>{if(e.equals((0,o.assertGetMe)()))return;const t=String(e);r.has(t)?r.set(t,n):i=!0})),{groupId:e.groupId,senderKey:r,participants:e.participants,admins:e.admins,rotateKey:i,deviceSyncComplete:e.deviceSyncComplete}}t.GroupUnSyncedError=d},238:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.storePeerMessages=function(e){const t=e.map((e=>(0,i.default)((0,i.default)({},e.toJSON()),{},{id:String(e.id),to:String(e.to)})));(0,a.getTable)().bulkCreate(t)};var i=r(n(81109)),a=n(98136)},75861:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.disallowedRowsToLists=s,t.queryDisallowedLists=function(){return o.apply(this,arguments)};var i=r(n(48926)),a=n(61319);function o(){return(o=(0,i.default)((function*(){try{return s(yield(0,a.getTable)().all())}catch(e){return __LOG__(4,!0,new Error,!0)`privacy_settings_drawer: get all privacy disallowed lists failed`,SEND_LOGS("privacy_settings_drawer: get all privacy disallowed lists failed"),{status:null,groupadd:null,last:null,profile:null}}}))).apply(this,arguments)}function s(e){const t={status:null,groupadd:null,last:null,profile:null};return e.forEach((e=>{switch(e.id){case a.PrivacyDisallowedListType.About:return void(t.status=e);case a.PrivacyDisallowedListType.GroupAdd:return void(t.groupadd=e);case a.PrivacyDisallowedListType.LastSeen:return void(t.last=e);case a.PrivacyDisallowedListType.ProfilePicture:t.profile=e}})),t}},63374:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.PARENT_MSG_PLACEHOLDER_ORPHAN_THRESHOLD=void 0,t.changeOrphanStateReactions=function(e){if((0,s.isMDBackend)())return(0,f.getStorage)().lock(["reactions"],function(){var t=(0,a.default)((function*(t){let[n]=t;const r=e.map((e=>[e,1])),i=yield(0,p.getTable)().anyOf(["parentMsgKey","orphan"],r);return i.forEach((e=>{e.orphan=0,e.orphanReason=void 0})),yield n.bulkCreateOrReplace(i),i}));return function(){return t.apply(this,arguments)}}());return Promise.reject(new Error("changeOrphanStateReactions: not supported for non MD"))},t.createOrUpdateReactions=function(e){if((0,s.isMDBackend)()){const t=new Map;return e.forEach((e=>{const{parentMsgKey:n,senderUserJid:r}=e;(0,l.isReactionByMe)(r)&&(e.read=!0);const i=`${n},${r}`,a=t.get(i);a?a.timestamp<=e.timestamp&&t.set(i,e):t.set(i,e)})),(0,f.getStorage)().lock(["reactions"],function(){var e=(0,a.default)((function*(e){let[n]=e;const r=Array.from(t.values()).map((e=>[e.parentMsgKey,e.senderUserJid]));return(yield n.anyOf(["parentMsgKey","senderUserJid"],r)).forEach((e=>{const n=`${e.parentMsgKey},${e.senderUserJid}`,r=t.get(n);r&&r.timestamp<=e.timestamp&&t.delete(n)})),yield n.bulkCreateOrReplace(Array.from(t.values())),Array.from(t.values())}));return function(){return e.apply(this,arguments)}}())}return Promise.reject(new Error("createOrUpdateReactions: not supported for non MD"))},t.deleteReactionsByParentMessageKey=function(e){if((0,s.isMDBackend)()){const t=[];return(0,f.getStorage)().lock(["reactions"],function(){var n=(0,a.default)((function*(n){let[r]=n;return(yield r.equals(["parentMsgKey"],e)).forEach((e=>t.push([e.parentMsgKey,e.senderUserJid]))),r.bulkRemove(t)}));return function(){return n.apply(this,arguments)}}())}return Promise.reject(new Error("deleteReactionsByParentMessageKey: not supported for non MD"))},t.deleteReactionsByParentMessageKeys=function(e){if((0,s.isMDBackend)()){const t=[];return(0,f.getStorage)().lock(["reactions"],function(){var n=(0,a.default)((function*(n){let[r]=n;return(yield r.anyOf(["parentMsgKey"],e)).forEach((e=>t.push([e.parentMsgKey,e.senderUserJid]))),yield r.bulkRemove(t),t.map((e=>e[0]))}));return function(){return n.apply(this,arguments)}}())}return Promise.reject(new Error("deleteReactionsByParentMessageKeys: not supported for non MD"))},t.getReactions=function(){return g.apply(this,arguments)},t.getReactionsFromParentMsg=function(){return _.apply(this,arguments)},t.markReactionRowsAsRead=function(e){return m({reactions:e,read:!0})},t.markReactionsAsReadByMessageKeysInStore=function(e){if((0,s.isMDBackend)())return(0,f.getStorage)().lock(["reactions"],function(){var t=(0,a.default)((function*(t){let[n]=t;const r=(yield n.anyOf(["msgKey"],e.map((e=>e.toString())))).map((e=>(0,i.default)((0,i.default)({},e),{},{read:!0})));return yield n.bulkCreateOrReplace(r),r}));return function(){return t.apply(this,arguments)}}());return Promise.reject(new Error("deleteReactionsByParentMessageKey: not supported for non MD"))},t.markReactionsAsReadOrOrphan=m,t.pruneExpiredOrphanReactions=function(){if((0,s.isMDBackend)())return(0,f.getStorage)().lock(["reactions"],function(){var e=(0,a.default)((function*(e){let[t]=e;const n=yield(0,p.getTable)().equals(["orphan"],1),r=[];n.forEach((e=>{const t=(0,o.castToUnixTime)(e.timestamp/1e3);let n;if(e.orphanReason===h.OrphanReactionsReasonType.ParentMsgMissing?n=(0,d.getABPropConfigValue)("reaction_cleanup_days"):e.orphanReason===h.OrphanReactionsReasonType.ParentMsgPlaceholder&&(n=60),null!=n){!(0,o.happenedWithin)(t,o.DAY_SECONDS*n)&&r.push(e)}}));const i=r.map((e=>[e.parentMsgKey,e.senderUserJid]));return i.length,t.bulkRemove(i)}));return function(){return e.apply(this,arguments)}}());return Promise.reject(new Error("pruneExpiredOrphanReactions: not supported for non MD"))},t.updateFailedPropsForSentReactions=function(e){let{reaction:t,ack:n,isSendFailure:r}=e;if((0,s.isMDBackend)())return(0,f.getStorage)().lock(["reactions"],function(){var e=(0,a.default)((function*(e){let[a]=e;const o=yield a.get([t.parentMsgKey,t.senderUserJid]);o||__LOG__(3)`reactions-store:updateFailedPropsForSentReactions record not found`;const s={};return null!=n&&(s.ack=n),null!=r&&(s.isSendFailure=r),a.createOrReplace((0,i.default)((0,i.default)({},o),s))}));return function(){return e.apply(this,arguments)}}());return Promise.reject(new Error("updateFailedPropsForSentReactions: not supported for non MD"))};var i=r(n(81109)),a=r(n(48926)),o=n(92844),s=n(88555),l=n(67811),c=r(n(5030)),d=n(57849),u=n(67247),p=n(72821),f=n(99069),h=n(26704);function _(){return(_=(0,a.default)((function*(e){const t=new Map;return yield(0,f.getStorage)().lock(["reactions"],function(){var n=(0,a.default)((function*(n){let[r]=n;(yield r.anyOf(["parentMsgKey"],e)).forEach((e=>{const{reactionText:n,orphan:r}=e;if(n!==l.REVOKED_REACTION_TEXT&&1!==r){var i;const n=null!==(i=t.get(e.parentMsgKey))&&void 0!==i?i:[];n.push(e),t.set(e.parentMsgKey,n)}}))}));return function(){return n.apply(this,arguments)}}()),t}))).apply(this,arguments)}function g(){return(g=(0,a.default)((function*(e){if((0,s.isMDBackend)()){const t=yield(0,p.getTable)().equals(["parentMsgKey"],e),n={reactions:[],reactionByMe:null},r=new Map;t.forEach((e=>{const{reactionText:t,orphan:i}=e;if(t!==l.REVOKED_REACTION_TEXT&&1!==i){var a;const i=u.EmojiUtil.getEmojiAggregate(t),o=null!==(a=r.get(i))&&void 0!==a?a:[];r.set(i,[...o,e]);(0,c.default)(e.msgKey).fromMe&&(n.reactionByMe=e)}}));const i=n.reactionByMe?u.EmojiUtil.getEmojiAggregate(n.reactionByMe.reactionText):"";return r.forEach(((e,t)=>{let r=!1;t===i&&(r=!0),n.reactions.push({aggregateEmoji:t,senders:e,hasReactionByMe:r})})),n}return Promise.reject(new Error("getReactions: not supported for non MD"))}))).apply(this,arguments)}function m(e){let{reactions:t,read:n,orphan:r,orphanReason:o}=e;return 0===t.length?Promise.resolve():(0,s.isMDBackend)()?(0,f.getStorage)().lock(["reactions"],function(){var e=(0,a.default)((function*(e){let[a]=e;const s=t.map((e=>[e.parentMsgKey,e.senderUserJid])),l=yield a.anyOf(["parentMsgKey","senderUserJid"],s),c={};n&&(c.read=n),void 0!==r&&(c.orphan=r,void 0!==o&&(c.orphanReason=o));const d=l.map((e=>(0,i.default)((0,i.default)({},e),c)));return a.bulkCreateOrReplace(d)}));return function(){return e.apply(this,arguments)}}()):Promise.reject(new Error("markReactionsAsReadOrOrphan: not supported for non MD"))}t.PARENT_MSG_PLACEHOLDER_ORPHAN_THRESHOLD=60},6331:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.queryStatusAllMD=function(){const e=(0,c.createWid)(a.STATUS_JID);return d.DbEncKeyStore.waitForFinalDbMsgEncKey().then((()=>(0,p.queryChatMessageHelper)((0,p.beginningOfChat)(e),(0,p.endOfChat)(e),{lowerInclusive:!1,upperInclusive:!1}).then((e=>{const t=[],n=[];e.forEach((e=>{e.author?(0,o.happenedWithin)((0,o.castToUnixTime)(e.t),o.DAY_SECONDS)&&e.type!==l.MSG_TYPE.REVOKED?n.push((0,p.hydrateMessage)(e)):t.push(e.id):__LOG__(3)`Author is null for status v3 message`})),(0,u.getTable)().bulkRemove(t);const r=(0,i.default)(n,(e=>e.author.toString())),a=[];for(const e in r){const t=r[e],n=t.filter((e=>e.ack<s.ACK.READ)).length,i=t[t.length-1].t;a.push({id:(0,c.createWid)(e),unreadCount:n,totalCount:t.length,t:i,_msgs:t})}return{statuses:a}}))))};var i=r(n(7739)),a=n(52230),o=n(92844),s=n(35470),l=n(15461),c=n(45454),d=n(12669),u=n(90981),p=n(12896)},60998:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getTaskScheduledTime=function(e){return(0,i.getTable)().get(e).then((e=>null==e?void 0:e.time))},t.updateTaskScheduledTime=function(e,t){return(0,r.getStorage)().lock(["tasks-scheduled-time"],(n=>{let[r]=n;return r.createOrReplace({taskName:e,time:t})}))};var r=n(99069),i=n(33850)},95716:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addUnjoinedSubgroupMetadataToStorage=function(e,t){(0,r.getTable)().createOrMerge(e.toString(),{id:e.toString(),subject:t})},t.getUnjoinedSubgroupsMetadataFromStorage=function(e){const t=e.map((e=>e.toString()));return(0,r.getTable)().bulkGet(t)},t.removeUnjoinedSubgroupMetadataFromStorage=function(e){(0,r.getTable)().remove(e.toString())};var r=n(7528)},64448:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.hydrateWids=function e(t){if(Array.isArray(t))return t.map(((t,n)=>e((0,a.default)(n,t,i.isWidlike,i.createWidFromWidLike))));if(t&&"object"==typeof t){const n=Object.keys(t);for(let r=0;r<n.length;r++){const o=n[r];t[o]=e((0,a.default)(o,t[o],i.isWidlike,i.createWidFromWidLike))}return t}return t};var i=n(45454),a=r(n(78144))},68708:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.VerifiedBusinessNameUpdateType=void 0,t.createOrUpdateVerifiedBusinessName=function(){return l.apply(this,arguments)},t.getAllVerifiedNames=function(){let e=Promise.resolve([]);e=(0,a.isLegacyWebdBackend)()?Promise.reject(new Error("getAllVerifiedNames: not supported without md backend")):(0,o.getTable)().all();return e},t.hasBusinessNameVerificationChanged=function(e,t,n){if((0,a.isLegacyWebdBackend)())return Promise.reject(new Error("hasBusinessNameVerificationChanged: not supported without md backend"));return(0,o.getTable)().get(e.user).then((e=>!e||e.serial!==n||e.level!==t))};var i=r(n(48926)),a=n(88555),o=n(85808);const s=n(76672).Mirrored(["Replace","Merge"]);function l(){return(l=(0,i.default)((function*(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s.Replace;if(!(0,a.isMDBackend)())throw new Error("createOrUpdateVerifiedBusinessName: not supported without md backend");{const n=(0,o.getTable)();t===s.Replace?yield n.createOrReplace(e):yield n.createOrMerge(e.id,e)}}))).apply(this,arguments)}t.VerifiedBusinessNameUpdateType=s},76214:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={initialize:!0};t.initialize=function(){if((0,i.isLegacyWebdBackend)())return Promise.resolve();return(0,a.initializeWithoutGKs)()};var i=n(88555),a=n(23356);Object.keys(a).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===a[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}}))}))},23356:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.clearInitializePromise=function(){$=null},t.destroy=function(){return(0,F.destroyStorage)().catch((()=>V.resolve(new i.default(F.DATABASE_NAME).delete()))).finally((()=>{$=null}))},Object.defineProperty(t,"getABPropConfigsTable",{enumerable:!0,get:function(){return a.getTable}}),Object.defineProperty(t,"getActiveMessageRangesTable",{enumerable:!0,get:function(){return o.getTable}}),Object.defineProperty(t,"getAgentTable",{enumerable:!0,get:function(){return s.getTable}}),Object.defineProperty(t,"getBlocklistTable",{enumerable:!0,get:function(){return l.getTable}}),Object.defineProperty(t,"getCartTable",{enumerable:!0,get:function(){return c.getTable}}),Object.defineProperty(t,"getChatTable",{enumerable:!0,get:function(){return d.getTable}}),Object.defineProperty(t,"getCollectionVersionTable",{enumerable:!0,get:function(){return p.getTable}}),Object.defineProperty(t,"getContactTable",{enumerable:!0,get:function(){return f.getTable}}),Object.defineProperty(t,"getDeviceListTable",{enumerable:!0,get:function(){return h.getTable}}),Object.defineProperty(t,"getDirectConnectionKeysTable",{enumerable:!0,get:function(){return _.getTable}}),Object.defineProperty(t,"getEncryptedMutationsTable",{enumerable:!0,get:function(){return g.getTable}}),Object.defineProperty(t,"getFavoriteStickersTable",{enumerable:!0,get:function(){return m.getTable}}),Object.defineProperty(t,"getFtsIndexingQueueTable",{enumerable:!0,get:function(){return y.getTable}}),Object.defineProperty(t,"getGroupInviteV4Table",{enumerable:!0,get:function(){return E.getTable}}),Object.defineProperty(t,"getGroupMetadataTable",{enumerable:!0,get:function(){return S.getTable}}),Object.defineProperty(t,"getHistorySyncNotificationTable",{enumerable:!0,get:function(){return v.getTable}}),Object.defineProperty(t,"getInactiveReceiptTable",{enumerable:!0,get:function(){return T.getTable}}),Object.defineProperty(t,"getLabelAssociationTable",{enumerable:!0,get:function(){return C.getTable}}),Object.defineProperty(t,"getLabelTable",{enumerable:!0,get:function(){return b.getTable}}),Object.defineProperty(t,"getMessageTable",{enumerable:!0,get:function(){return A.getTable}}),Object.defineProperty(t,"getMissingKeysTable",{enumerable:!0,get:function(){return M.getTable}}),Object.defineProperty(t,"getMsgInfoTable",{enumerable:!0,get:function(){return P.getTable}}),Object.defineProperty(t,"getOrphanPaymentNotificationTable",{enumerable:!0,get:function(){return O.getTable}}),Object.defineProperty(t,"getOrphanReceiptTable",{enumerable:!0,get:function(){return I.getTable}}),Object.defineProperty(t,"getOrphanRevokeTable",{enumerable:!0,get:function(){return w.getTable}}),Object.defineProperty(t,"getParticipantTable",{enumerable:!0,get:function(){return R.getTable}}),Object.defineProperty(t,"getPeerMessageTable",{enumerable:!0,get:function(){return L.getTable}}),Object.defineProperty(t,"getPendingMutationsTable",{enumerable:!0,get:function(){return N.getTable}}),Object.defineProperty(t,"getPrivacyDisallowedListTable",{enumerable:!0,get:function(){return k.getTable}}),Object.defineProperty(t,"getProfilePicThumbTable",{enumerable:!0,get:function(){return U.getTable}}),Object.defineProperty(t,"getQuickReplyTable",{enumerable:!0,get:function(){return G.getTable}}),Object.defineProperty(t,"getReactionsTable",{enumerable:!0,get:function(){return x.getTable}}),Object.defineProperty(t,"getRecentStickersTable",{enumerable:!0,get:function(){return B.getTable}}),Object.defineProperty(t,"getSyncActionsTable",{enumerable:!0,get:function(){return j.getTable}}),Object.defineProperty(t,"getSyncKeysTable",{enumerable:!0,get:function(){return Y.getTable}}),Object.defineProperty(t,"getTasksScheduledTimeTable",{enumerable:!0,get:function(){return K.getTable}}),Object.defineProperty(t,"getVerifiedBusinessNameTable",{enumerable:!0,get:function(){return H.getTable}}),t.initializeWithoutGKs=function(){null==$&&((0,F.createStorage)(),(0,a.addTable)(),(0,K.addTable)(),(0,f.addTable)(),(0,l.addTable)(),(0,U.addTable)(),(0,d.addTable)(),(0,A.addTable)(),(0,P.addTable)(),(0,x.addTable)(),(0,R.addTable)(),(0,I.addTable)(),(0,h.addTable)(),(0,b.addTable)(),(0,C.addTable)(),(0,T.addTable)(),(0,H.addTable)(),(0,v.addTable)(),(0,g.addTable)(),(0,G.addTable)(),(0,S.addTable)(),(0,Y.addTable)(),(0,o.addTable)(),(0,y.addTable)(),(0,c.addTable)(),(0,M.addTable)(),(0,B.addTable)(),(0,m.addTable)(),(0,E.addTable)(),(0,O.addTable)(),(0,L.addTable)(),(0,w.addTable)(),(0,N.addTable)(),(0,p.addTable)(),(0,j.addTable)(),(0,k.addTable)(),(0,_.addTable)(),(0,u.addTable)(),(0,D.addTable)(),(0,W.addTable)(),(0,s.addTable)(),$=(0,F.getStorage)().initialize().catch((e=>{throw __LOG__(4,!0,new Error,!0)`Assertion failed!`,SEND_LOGS("Failed to initialize model storage"),e})));return $};var i=r(n(86128)),a=n(32446),o=n(69702),s=n(11785),l=n(89426),c=n(44786),d=n(68638),u=n(91314),p=n(94771),f=n(4233),h=n(60996),_=n(68259),g=n(5198),m=n(51722),y=n(44936),E=n(35884),S=n(64632),v=n(15118),T=n(71720),b=n(94337),C=n(82663),A=n(90981),P=n(52489),M=n(47274),O=n(45377),I=n(56161),w=n(88851),R=n(96826),D=n(41803),L=n(98136),N=n(87125),k=n(61319),U=n(96189),G=n(73821),x=n(72821),B=n(29953),F=n(99069),j=n(34296),Y=n(63776),K=n(33850),W=n(7528),H=n(85808);const V=n(74121).Z;let $},32446:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,a.getStorage)().add("abpropConfigs").version((0,s.abpropsConfigCreateTable)(),[new o.default("configCode"),new i.default("configValue"),new i.default("configExpoKey")]).version((0,s.addHasAccessedToAbpropsConfigTable)(),[new i.default("hasAccessed")]).view((e=>({configCode:e.configCode,configValue:e.configValue,configExpoKey:e.configExpoKey,hasAccessed:e.hasAccessed})))},t.getTable=function(){return(0,a.getStorage)().table("abpropConfigs")};var i=r(n(79051)),a=n(99069),o=r(n(89362)),s=n(406)},69702:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ActiveRangeAction=void 0,t.addTable=function(){(0,s.getStorage)().add("active-message-ranges").version((0,l.activeMessageRangesCreateTable)(),[new o.default(["chatId","action"]),new a.default("chatId"),new i.default("actionValue"),new i.default("remainingMessages")]).view((e=>e))},t.getTable=function(){return(0,s.getStorage)().table("active-message-ranges")};var i=r(n(79051)),a=r(n(19570)),o=r(n(54180)),s=n(99069),l=n(406);const c=Object.freeze({Unknown:"unknown",Archive:"archive",MarkChatAsRead:"markChatAsRead",ClearChatKeepStarredKeepMedia:"clearChat_0_0",ClearChatKeepStarredDeleteMedia:"clearChat_0_1",ClearChatDeleteStarredKeepMedia:"clearChat_1_0",ClearChatDeleteStarredDeleteMedia:"clearChat_1_1",DeleteChatDeleteMedia:"deleteChat_1",DeleteChatKeepMedia:"deleteChat_0"});t.ActiveRangeAction=c},11785:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,a.getStorage)().add("agent").version((0,s.agentCreateTable)(),[new o.default("id"),new i.default("deviceID"),new i.default("name"),new i.default("isDeleted")]).view((e=>e))},t.getTable=function(){return(0,a.getStorage)().table("agent")};var i=r(n(79051)),a=n(99069),o=r(n(89362)),s=n(406)},89426:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,i.getStorage)().add("blocklist").version((0,o.blocklistCreateTable)(),[new a.default("id")]).view((e=>({id:e.id})))},t.getTable=function(){return(0,i.getStorage)().table("blocklist")};var i=n(99069),a=r(n(89362)),o=n(406)},44786:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,a.getStorage)().add("cart").version((0,s.cartCreateTable)(),[new o.default("id"),new i.default("products"),new i.default("message"),new i.default("total"),new i.default("currency"),new i.default("itemCount")]).view((e=>e))},t.getTable=function(){return(0,a.getStorage)().table("cart")};var i=r(n(79051)),a=n(99069),o=r(n(89362)),s=n(406)},91314:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,l.getStorage)().add(d).version((0,c.addChatThreadLoggingTable)(),[new s.default(["chatId","startTs"]),new o.default("chatId"),new o.default("startTs"),new a.default("msgsSent"),new a.default("msgsReceived"),new a.default("viewOnceMsgsSent"),new a.default("viewOnceMsgsReceived"),new a.default("viewOnceMessagesOpened"),new a.default("callOffersSent"),new a.default("callOffersReceived"),new a.default("totalCallDuration"),...i.COUNT_FIELD_NAMES.map((e=>new a.default(e)))]).view((e=>e))},t.getTable=function(){return(0,l.getStorage)().table(d)};var i=n(61840),a=r(n(79051)),o=r(n(19570)),s=r(n(54180)),l=n(99069),c=n(406);const d="chat-thread-logging-pending-events"},68638:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,s.getStorage)().add("chat").version((0,c.chatCreateTable)(),[new l.default("id"),new i.default("t"),new i.default("unreadCount"),new i.default("archive"),new i.default("isReadOnly"),new i.default("isAnnounceGrpRestrict"),new i.default("modifyTag"),new i.default("muteExpiration"),new i.default("name"),new i.default("notSpam"),new i.default("pin"),new i.default("changeNumberOldJid"),new i.default("changeNumberNewJid"),new i.default("ephemeralDuration"),new i.default("ephemeralSettingTimestamp"),new i.default("unreadMsgAnchorId"),new i.default("endOfHistoryTransferType")]).version((0,c.chatAddDisappearingModeInitiator)(),[new i.default("disappearingModeInitiator")]).version((0,c.addUnreadMentionToChatTable)(),[new i.default("unreadMentionsOfMe")]).version((0,c.addUnreadMentionCountToChatTable)(),[new i.default("unreadMentionCount")]).version((0,c.addTcTokenToChatTable)(),[new a.AddEncryptedColumn("tcToken",a.ENCRYPTED_VALUE_TYPE.ARRAY_BUFFER)]).version((0,c.addTcTokenTimestampToChatTable)(),[new i.default("tcTokenTimestamp"),new o.default("tcTokenTimestamp")]).version((0,c.addArchiveAtMentionViewedInDrawer)(),[new i.default("archiveAtMentionViewedInDrawer")]).version((0,c.addTcTokenSenderTimestampToChatTable)(),[new i.default("tcTokenSenderTimestamp")]).view((e=>e))},t.getTable=function(){return(0,s.getStorage)().table("chat")};var i=r(n(79051)),a=n(86445),o=r(n(19570)),s=n(99069),l=r(n(89362)),c=n(406)},94771:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,a.getStorage)().add("collection-version").version((0,s.collectionVersionCreateTable)(),[new o.default("collection"),new i.default("version"),new i.default("state"),new i.default("finiteFailureStartTime"),new i.default("ltHash")]).view((e=>e))},t.getTable=function(){return(0,a.getStorage)().table("collection-version")};var i=r(n(79051)),a=n(99069),o=r(n(89362)),s=n(406)},4233:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,o.getStorage)().add("contact").version((0,l.contactCreateTable)(),[new s.default("id"),new i.default("name"),new i.default("shortName"),new i.default("pushname"),new i.default("type"),new i.default("verifiedName"),new i.default("isBusiness"),new i.default("isEnterprise"),new i.default("verifiedLevel"),new i.default("statusMute"),new i.default("sectionHeader"),new i.default("isAddressBookContact"),new a.default("isAddressBookContact")]).version((0,l.contactAddIsContactSyncCompleted)(),[new i.default("isContactSyncCompleted"),new a.default("isContactSyncCompleted")]).version((0,l.contactAddDisappearingModeProperties)(),[new i.default("disappearingModeDuration"),new i.default("disappearingModeSettingTimestamp")]).view((e=>e))},t.getTable=function(){return(0,o.getStorage)().table("contact")};var i=r(n(79051)),a=r(n(19570)),o=n(99069),s=r(n(89362)),l=n(406)},60996:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,a.getStorage)().add("device-list").version((0,s.deviceListCreateTable)(),[new o.default("id"),new i.default("devices"),new i.default("nextVersion"),new i.default("rawId"),new i.default("timestamp"),new i.default("validIndexes"),new i.default("currentIndex")]).version((0,s.deviceListAddDelete)(),[new i.default("deleted")]).version((0,s.deviceListAddV2Fields)(),[new i.default("expectedTs"),new i.default("expectedTsLastDeviceJobTs"),new i.default("expectedTsUpdateTs")]).view((e=>e))},t.getTable=function(){return(0,a.getStorage)().table("device-list")};var i=r(n(79051)),a=n(99069),o=r(n(89362)),s=n(406)},68259:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,a.getStorage)().add("direct-connection-keys").version((0,s.directConnectionKeysCreateTable)(),[new o.default("id"),new i.default("certificateChain"),new i.default("cypher"),new i.default("cypherExpirationTimestamp")]).view((e=>e))},t.getTable=function(){return(0,a.getStorage)().table("direct-connection-keys")};var i=r(n(79051)),a=n(99069),o=r(n(89362)),s=n(406)},5198:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,o.getStorage)().add("encrypted-mutations").version((0,s.encryptedMutationsCreateTable)(),[new a.default("id"),new i.default("collectionName"),new i.default("keyId"),new i.default("indexMac"),new i.default("operation"),new i.default("indexAndValueCipherText")]).view((e=>e))},t.getTable=function(){return(0,o.getStorage)().table("encrypted-mutations")};var i=r(n(79051)),a=r(n(81674)),o=n(99069),s=n(406)},51722:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,a.getStorage)().add("favorite-stickers").version((0,s.favoriteStickersCreateTable)(),[new o.default("id"),new i.default("timestamp"),new i.default("sticker"),new i.default("stickerHashWithoutMeta")]).view((e=>e))},t.getTable=function(){return(0,a.getStorage)().table("favorite-stickers")};var i=r(n(79051)),a=n(99069),o=r(n(89362)),s=n(406)},44936:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,i.getStorage)().add("fts-indexing-queue").version((0,o.ftsIndexingQueueCreateTable)(),[new a.default("id")]).view((e=>e))},t.getTable=function(){return(0,i.getStorage)().table("fts-indexing-queue")};var i=n(99069),a=r(n(89362)),o=n(406)},35884:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,o.getStorage)().add("group-invite-v4").version((0,l.groupInviteV4CreateTable)(),[new s.default("id"),new i.default("from"),new i.default("to"),new i.default("groupId"),new i.default("expiration"),new i.default("expired"),new a.default(["from","to","groupId"])]).version((0,l.addGroupFromKeyToGroupInviteV4)(),[new a.default(["from","groupId"])]).view((e=>e))},t.getTable=function(){return(0,o.getStorage)().table("group-invite-v4")};var i=r(n(79051)),a=r(n(34654)),o=n(99069),s=r(n(89362)),l=n(406)},64632:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,o.getStorage)().add("group-metadata").version((0,l.groupMetadataCreateTable)(),[new s.default("id"),new i.default("subject"),new i.default("subjectTime"),new i.default("creation"),new i.default("owner"),new i.default("desc"),new i.default("descId"),new i.default("descTime"),new i.default("descOwner"),new i.default("restrict"),new i.default("announce"),new i.default("a_v_id"),new i.default("noFrequentlyForwarded"),new i.default("ephemeralDuration"),new i.default("size"),new i.default("support"),new i.default("suspended"),new i.default("terminated"),new i.default("notAddedByContact"),new i.default("addedBy"),new i.default("parentGroup"),new i.default("subgroups"),new i.default("isParentGroup"),new i.default("defaultSubgroup"),new i.default("growthLockExpiration"),new i.default("growthLockType")]).version((0,l.migrateSubgroupsArray)(),[new a.default("subgroups"),new i.default("unjoinedSubgroups")]).view((e=>e))},t.getTable=function(){return(0,o.getStorage)().table("group-metadata")};var i=r(n(79051)),a=r(n(23263)),o=n(99069),s=r(n(89362)),l=n(406)},15118:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,s.getStorage)().add("history-sync-notification").version((0,c.historySyncNotificationsCreateTable)(),[new l.default("msgKey"),new i.default("downloadOptions"),new i.default("syncType"),new a.AddEncryptedColumn("chunkEncryptionKey",a.ENCRYPTED_VALUE_TYPE.STRING),new i.default("chunkOrder"),new i.default("processed"),new o.default("syncType"),new o.default("chunkOrder"),new o.default("processed"),new i.default("isReupload"),new i.default("historySyncStepStartedTs"),new i.default("historySyncPayloadSize"),new i.default("reuploadPending")]).version((0,c.encryptHistorySyncDirectPath)(),[new a.AddEncryptedColumn("directPath",a.ENCRYPTED_VALUE_TYPE.STRING)]).version((0,c.encryptHistorySyncFilehash)(),[new a.AddEncryptedColumn("filehash",a.ENCRYPTED_VALUE_TYPE.STRING),new a.AddEncryptedColumn("encFilehash",a.ENCRYPTED_VALUE_TYPE.STRING)]).view((e=>e)).useDbMsgEncKeyForEncryptedCol(!0)},t.getTable=function(){return(0,s.getStorage)().table("history-sync-notification")};var i=r(n(79051)),a=n(86445),o=r(n(19570)),s=n(99069),l=r(n(89362)),c=n(406)},71720:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,a.getStorage)().add("inactive-receipt").version((0,s.inactiveReceiptCreateTable)(),[new o.default("msgId"),new i.default("chatId"),new i.default("participantId")]).view((e=>e))},t.getTable=function(){return(0,a.getStorage)().table("inactive-receipt")};var i=r(n(79051)),a=n(99069),o=r(n(89362)),s=n(406)},82663:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.LabelAssociationType=void 0,t.addTable=function(){(0,s.getStorage)().add("label-association").version((0,l.labelAssociationCreateTable)(),[new o.default(["labelId","associationId","type"]),new a.default("labelId"),new i.default(["associationId","type"])]).view((e=>e))},t.getTable=function(){return(0,s.getStorage)().table("label-association")};var i=r(n(34654)),a=r(n(19570)),o=r(n(54180)),s=n(99069),l=n(406);const c=n(76672)({Jid:"jid",Message:"message"});t.LabelAssociationType=c},94337:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,a.getStorage)().add("label").version((0,s.labelCreateTable)(),[new o.default("id"),new i.default("name"),new i.default("colorIndex"),new i.default("predefinedId")]).view((e=>e))},t.getTable=function(){return(0,a.getStorage)().table("label")};var i=r(n(79051)),a=n(99069),o=r(n(89362)),s=n(406)},52489:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,s.getStorage)().add("message-info").version((0,l.messageInfoCreateTable)(),[new o.default(["msgKey","receiverUserJid"]),new i.default("delivery"),new i.default("read"),new i.default("played"),new i.default("deviceDelivered"),new i.default("deviceNotDelivered"),new a.default("msgKey")]).version((0,l.messageInfoAddDeliveryPrivacyMode)(),[new i.default("deliveryPrivacyMode")]).view((e=>e))},t.getTable=function(){return(0,s.getStorage)().table("message-info")};var i=r(n(79051)),a=r(n(19570)),o=r(n(54180)),s=n(99069),l=n(406)},90981:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,u.getStorage)().add("message").version((0,f.messageCreateTable)(),[new p.default("id"),new a.default("internalId"),new c.default("internalId"),new a.default("rowId"),new c.default("rowId"),new a.default("type"),new a.default("subtype"),new a.default("t"),new a.default("notifyName"),new a.default("from"),new a.default("to"),new a.default("author"),new a.default("self"),new a.default("ack"),new a.default("invis"),new a.default("isStarred"),new l.default("isStarred"),new a.default("mentionedJidList"),new a.default("count"),new a.default("devicesAdded"),new a.default("devicesRemoved"),new a.default("isThisDeviceAdded"),new a.default("recipients"),new a.default("protocolMessageKey"),new a.default("protocolMessageRowId"),new a.default("templateParams"),new o.default(["internalId","isStarred"]),new a.default("vcardWAids"),new i.default("vcardWAids"),new a.default("hasLink"),new a.default("isMediaMsg"),new a.default("isDocMsg"),new o.default(["internalId","isMediaMsg"]),new o.default(["internalId","isDocMsg"]),new o.default(["internalId","hasLink"]),new a.default("ephemeralStartTimestamp"),new a.default("ephemeralDuration"),new a.default("ephemeralSettingTimestamp"),new a.default("ephemeralOutOfSync"),new a.default("expiredTimestamp"),new l.default("expiredTimestamp"),new a.default("directPath"),new a.default("mimetype"),new a.default("duration"),new a.default("filehash"),new a.default("uploadhash"),new a.default("size"),new a.default("filename"),new a.default("streamingSidecar"),new a.default("mediaKey"),new a.default("mediaKeyTimestamp"),new a.default("pageCount"),new a.default("isGif"),new a.default("gifAttribution"),new a.default("isViewOnce"),new a.default("width"),new a.default("height"),new a.default("scanLengths"),new a.default("scansSidecar"),new a.default("interactiveAnnotations"),new a.default("firstFrameLength"),new a.default("firstFrameSidecar"),new a.default("isAnimated"),new a.default("thumbnail"),new a.default("richPreviewType"),new a.default("doNotPlayInline"),new a.default("broadcast"),new a.default("broadcastParticipants"),new a.default("broadcastId"),new a.default("quotedMsg"),new a.default("quotedStanzaID"),new a.default("quotedRemoteJid"),new a.default("quotedParticipant"),new a.default("footer"),new a.default("hydratedButtons"),new a.default("selectedId"),new a.default("selectedIndex"),new a.default("vcardFormattedName"),new a.default("isVcardOverMmsDocument"),new a.default("businessOwnerJid"),new a.default("productId"),new a.default("currencyCode"),new a.default("priceAmount1000"),new a.default("retailerId"),new a.default("url"),new a.default("productImageCount"),new a.default("paymentCurrency"),new a.default("paymentMessageReceiverJid"),new a.default("paymentTransactionTimestamp"),new a.default("paymentStatus"),new a.default("paymentNoteMsg"),new a.default("paymentRequestMessageKey"),new a.default("paymentExpiryTimestamp"),new a.default("message"),new a.default("orderTitle"),new a.default("itemCount"),new a.default("orderId"),new a.default("surface"),new a.default("status"),new a.default("token"),new a.default("textColor"),new a.default("backgroundColor"),new a.default("font"),new a.default("isForwarded"),new a.default("forwardingScore"),new a.default("ctwaContext"),new a.default("mdDowngrade"),new a.default("messageRangeIndex"),new l.default("messageRangeIndex"),new a.default("vcardList"),new a.default("totalAmount1000"),new a.default("totalCurrencyCode"),new a.default("list"),new a.default("listResponse"),new a.default("isDynamicReplyButtonsMsg"),new a.default("dynamicReplyButtons"),new a.default("selectedButtonId"),new a.default("sellerJid"),new a.default("deprecatedMms3Url"),new a.default("encFilehash"),new s.AddEncryptedColumn("msgRowOpaqueData",s.ENCRYPTED_VALUE_TYPE.ARRAY_BUFFER),new a.default("thumbnailDirectPath"),new a.default("thumbnailSha256"),new a.default("thumbnailEncSha256"),new a.default("thumbnailHeight"),new a.default("thumbnailWidth"),new a.default("revokeSender"),new a.default("pendingReadReceipt"),new o.default(["from","pendingReadReceipt"]),new a.default("inviteGrpType"),new a.default("quotedGroupSubject"),new a.default("quotedParentGroupJid"),new a.default("reactionParentKey"),new a.default("reactionTimestamp"),new a.default("reactionText"),new a.default("lastPlaybackProgress"),new a.default("hasReaction"),new a.default("keptBy")]).version((0,f.messageAddIsSendFailureProperties)(),[new a.default("isSendFailure")]).version((0,f.messageAddPaymentTxnStatus)(),[new a.default("paymentTxnStatus")]).version((0,f.messageAddProductListPreviewInfo)(),[new a.default("productListItemCount")]).version((0,f.messageAddPrivacyModeFields)(),[new a.default("privacyModeWhenSent"),new a.default("bizPrivacyStatus")]).version((0,f.messageAddProductListPreviewHeaderImage)(),[new a.default("productHeaderImageRejected")]).version((0,f.messageAddDisappearingModeInitiator)(),[new a.default("disappearingModeInitiator")]).version((0,f.messageAddGroupInviteV4)(),[new a.default("inviteGrp"),new a.default("inviteGrpName"),new a.default("comment"),new a.default("inviteCode"),new a.default("inviteCodeExp")]).version((0,f.addSupportForHSMButtons)(),[new a.default("isFromTemplate")]).version((0,f.messageAddPaymentRequestNFMFields)(),[new a.default("nativeFlowButtons"),new a.default("paymentRequestHeader")]).version((0,f.addWaveformToAudioMessages)(),[new a.default("waveform")]).version((0,f.messageRemovePaymentRequestHeaderField)(),[new d.default("paymentRequestHeader")]).version((0,f.messageAddNativeFlowNameField)(),[new a.default("nativeFlowName")]).version((0,f.addStaticURLToImageVideoMessages)(),[new a.default("staticUrl")]).version((0,f.addRequiresDirectConnection)(),[new a.default("requiresDirectConnection")]).version((0,f.messageAddPaymentInviteServiceType)(),[new a.default("paymentInviteServiceType")]).version((0,f.addStatusPSACampaignFields)(),[new a.default("campaignId"),new a.default("campaignDuration")]).version((0,f.messageAddPaymentBackground)(),[new a.default("paymentBackground")]).version((0,f.messageAddInteractiveMessageFields)(),[new a.default("interactiveHeader"),new a.default("interactiveType"),new a.default("interactivePayload")]).version((0,f.messageAddActionLink)(),[new a.default("actionLink")]).version((0,f.messageAddHeaderType)(),[new a.default("headerType")]).version((0,f.messageStatusPSAReadTimestamp)(),[new a.default("statusPSAReadTimestamp")]).view((e=>e)).enablePropFilter(!0).useDbMsgEncKeyForEncryptedCol(!0)},t.getTable=function(){return(0,u.getStorage)().table("message")};var i=r(n(92061)),a=r(n(79051)),o=r(n(34654)),s=n(86445),l=r(n(19570)),c=r(n(39043)),d=r(n(23263)),u=n(99069),p=r(n(89362)),f=n(406)},47274:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,a.getStorage)().add("missing-keys").version((0,s.missingKeysCreateTable)(),[new o.default("keyHex"),new i.default("keyId"),new i.default("timestamp"),new i.default("deviceResponses")]).view((e=>e))},t.getTable=function(){return(0,a.getStorage)().table("missing-keys")};var i=r(n(79051)),a=n(99069),o=r(n(89362)),s=n(406)},45377:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,a.getStorage)().add("orphan-payment-notification").version((0,s.orphanPaymentNotificationCreateTable)(),[new o.default("msgKey"),new i.default("receiver"),new i.default("currency"),new i.default("amount1000"),new i.default("type"),new i.default("status"),new i.default("ts")]).view((e=>e))},t.getTable=function(){return(0,a.getStorage)().table("orphan-payment-notification")};var i=r(n(79051)),a=(n(52586),n(99069)),o=r(n(89362)),s=n(406)},56161:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,a.getStorage)().add("orphan-receipt").version((0,s.orphanReceiptCreateTable)(),[new o.default("msgKey"),new i.default("delivery"),new i.default("read"),new i.default("played")]).view((e=>e))},t.getTable=function(){return(0,a.getStorage)().table("orphan-receipt")};var i=r(n(79051)),a=n(99069),o=r(n(89362)),s=n(406)},88851:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,a.getStorage)().add("orphan-revoke").version((0,s.orphanRevokeCreateTable)(),[new o.default("msgKey"),new i.default("sender"),new i.default("timestamp"),new i.default("subtype")]).view((e=>e))},t.getTable=function(){return(0,a.getStorage)().table("orphan-revoke")};var i=r(n(79051)),a=n(99069),o=r(n(89362)),s=n(406)},96826:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,o.getStorage)().add("participant").version((0,l.participantCreateTable)(),[new s.default("groupId"),new a.default("senderKey"),new a.default("participants"),new a.default("admins"),new a.default("rotateKey"),new a.default("version"),new i.default("participants"),new a.default("deviceSyncComplete")]).view((e=>e))},t.getTable=function(){return(0,o.getStorage)().table("participant")};var i=r(n(92061)),a=r(n(79051)),o=n(99069),s=r(n(89362)),l=n(406)},41803:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,a.getStorage)().add("payment-backgrounds").version((0,s.paymentBackgroundsCreateTable)(),[new o.default("id"),new i.default("imageBuffer")]).view((e=>e))},t.getTable=function(){return(0,a.getStorage)().table("payment-backgrounds")};var i=r(n(79051)),a=n(99069),o=r(n(89362)),s=n(406)},98136:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,a.getStorage)().add("peer-message").version((0,s.peerMessageCreateTable)(),[new o.default("id"),new i.default("to"),new i.default("type"),new i.default("subtype"),new i.default("appStateSyncKeyShare"),new i.default("appStateSyncKeyRequest"),new i.default("appStateFatalExceptionNotification")]).view((e=>e))},t.getTable=function(){return(0,a.getStorage)().table("peer-message")};var i=r(n(79051)),a=n(99069),o=r(n(89362)),s=n(406)},87125:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,s.getStorage)().add("pending-mutations").version((0,l.pendingMutationsCreateTable)(),[new o.default("id"),new i.default("collection"),new i.default("index"),new a.default("index"),new i.default("timestamp"),new a.default("collection"),new i.default("version"),new i.default("operation"),new i.default("binarySyncAction")]).version((0,l.addActionToPendingMutations)(),[new i.default("action"),new a.default("action")]).view((e=>e))},t.getTable=function(){return(0,s.getStorage)().table("pending-mutations")};var i=r(n(79051)),a=r(n(19570)),o=r(n(81674)),s=n(99069),l=n(406)},61319:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.PrivacyDisallowedListType=void 0,t.addTable=function(){(0,a.getStorage)().add("privacy-disallowed-list").version((0,s.privacyDisallowedListCreateTable)(),[new o.default("id"),new i.default("disallowedList")]).version((0,s.privacyDisallowedListAddDhashField)(),[new i.default("dhash")]).view((e=>({id:e.id,disallowedList:e.disallowedList,dhash:e.dhash})))},t.getTable=function(){return(0,a.getStorage)().table("privacy-disallowed-list")};var i=r(n(79051)),a=n(99069),o=r(n(89362)),s=n(406);const l=n(76672)({About:"status",GroupAdd:"groupadd",LastSeen:"last",ProfilePicture:"profile"});t.PrivacyDisallowedListType=l},96189:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,a.getStorage)().add("profile-pic-thumb").version((0,s.profilePicThumbCreateTable)(),[new o.default("id"),new i.default("tag"),new i.default("raw"),new i.default("eurl"),new i.default("previewEurl")]).view((e=>({id:e.id,tag:e.tag,raw:e.raw,eurl:e.eurl,previewEurl:e.previewEurl})))},t.getTable=function(){return(0,a.getStorage)().table("profile-pic-thumb")};var i=r(n(79051)),a=n(99069),o=r(n(89362)),s=n(406)},73821:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,a.getStorage)().add("quick-reply").version((0,s.quickReplyCreateTable)(),[new o.default("id"),new i.default("shortcut"),new i.default("message"),new i.default("count"),new i.default("keywords")]).view((e=>e))},t.getTable=function(){return(0,a.getStorage)().table("quick-reply")};var i=r(n(79051)),a=n(99069),o=r(n(89362)),s=n(406)},72821:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,l.getStorage)().add("reactions").version((0,c.reactionsCreateTable)(),[new s.default(["parentMsgKey","senderUserJid"]),new i.default("msgKey"),new i.default("reactionText"),new i.default("timestamp"),new i.default("orphan"),new i.default("orphanReason"),new i.default("read"),new i.default("ack"),new i.default("isSendFailure"),new o.default("parentMsgKey"),new o.default("orphan")]).version((0,c.addReactionTableOrphanIndex)(),[new a.default(["parentMsgKey","orphan"])]).version((0,c.addReactionTableMsgKeyIndex)(),[new o.default("msgKey")]).view((e=>e))},t.getTable=function(){return(0,l.getStorage)().table("reactions")};var i=r(n(79051)),a=r(n(34654)),o=r(n(19570)),s=r(n(54180)),l=n(99069),c=(n(26704),n(406))},29953:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,a.getStorage)().add("recent-stickers").version((0,s.recentStickersCreateTable)(),[new o.default("id"),new i.default("timestamp"),new i.default("sticker"),new i.default("msgId"),new i.default("weight")]).view((e=>e))},t.getTable=function(){return(0,a.getStorage)().table("recent-stickers")};var i=r(n(79051)),a=n(99069),o=r(n(89362)),s=n(406)},34296:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,s.getStorage)().add("sync-actions").version((0,c.syncActionsCreateTable)(),[new l.default("index"),new i.default("keyId"),new i.default("version"),new i.default("actionState"),new o.default("actionState"),new i.default("modelId"),new i.default("modelType"),new a.default(["modelId","modelType","actionState"]),new i.default("valueMac"),new i.default("indexMac"),new o.default("indexMac"),new i.default("collection"),new o.default("collection"),new i.default("timestamp"),new i.default("action"),new o.default("action"),new i.default("binarySyncAction"),new i.default("binarySyncData")]).view((e=>e))},t.getTable=function(){return(0,s.getStorage)().table("sync-actions")};var i=r(n(79051)),a=r(n(34654)),o=r(n(19570)),s=n(99069),l=r(n(89362)),c=n(406)},63776:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,s.getStorage)().add("sync-keys").version((0,c.syncKeysCreateTable)(),[new l.default("keyId"),new i.default("timestamp"),new i.default("fingerprint"),new a.AddEncryptedColumn("keyData",a.ENCRYPTED_VALUE_TYPE.ARRAY_BUFFER),new i.default("keyEpoch"),new o.default("keyEpoch")]).view((e=>e))},t.getTable=function(){return(0,s.getStorage)().table("sync-keys")};var i=r(n(79051)),a=n(86445),o=r(n(19570)),s=n(99069),l=r(n(89362)),c=n(406)},33850:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,a.getStorage)().add("tasks-scheduled-time").version((0,s.tasksScheduledTimeCreateTable)(),[new o.default("taskName"),new i.default("time")]).view((e=>e))},t.getTable=function(){return(0,a.getStorage)().table("tasks-scheduled-time")};var i=r(n(79051)),a=n(99069),o=r(n(89362)),s=n(406)},26704:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OrphanReactionsReasonType=void 0;const r=n(76672).Mirrored(["ParentMsgPlaceholder","ParentMsgMissing"]);t.OrphanReactionsReasonType=r},7528:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,a.getStorage)().add("unjoined-subgroup-metadata").version((0,s.unjoinedSubgroupMetadataCreateTable)(),[new o.default("id"),new i.default("subject"),new i.default("subjectTime"),new i.default("defaultSubgroup")]).view((e=>e))},t.getTable=function(){return(0,a.getStorage)().table("unjoined-subgroup-metadata")};var i=r(n(79051)),a=n(99069),o=r(n(89362)),s=n(406)},85808:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,o.getStorage)().add("verified-business-name").version((0,l.verifiedBusinessNameCreateTable)(),[new s.default("id"),new i.default("serial"),new i.default("name"),new i.default("isApi"),new i.default("level"),new i.default("actualActors"),new i.default("hostStorage"),new i.default("privacyModeTs")]).version((0,l.verifiedBusinessNameAddPrivacyMode)(),[new i.default("privacyMode"),new a.default("actualActors"),new a.default("hostStorage"),new a.default("privacyModeTs")]).view((e=>e))},t.getTable=function(){return(0,o.getStorage)().table("verified-business-name")};var i=r(n(79051)),a=r(n(23263)),o=n(99069),s=r(n(89362)),l=n(406)},99069:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.DATABASE_NAME=void 0,t.createStorage=function(){const e=new o.default(c);d=new s.Storage(e),d.addErrorHandler(i.default.AbortError,(e=>{e.message.includes("QuotaExceededError")&&l.StorageCmd.trigger("storage_not_enough_space")}))},t.destroyStorage=function(){if(null==d)return Promise.reject(new Error("[model-storage] Storage should be created first before being destroyed"));return d.purge().then((()=>{d=null})).catch((e=>{throw d=null,e}))},t.getStorage=function(){return(0,a.default)(null!=d,"[model-storage] Storage should be created first before being accessed"),d};var i=r(n(86128)),a=r(n(41143)),o=r(n(98883)),s=n(37521),l=n(23283);const c="model-storage";t.DATABASE_NAME=c;let d=null},36163:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.restoreAgents=function(){return ge.apply(this,arguments)},t.restoreArchiveV2Settings=function(){if((0,R.archiveV2Supported)()){const e=(0,Y.getArchiveV2EnabledSetting)(),t=(0,Y.getUnarchiveChatsSetting)();null!=e&&(te.default.archive=(0,a.default)((0,a.default)({},te.default.archive),{},{enabled:e})),null!=t&&(te.default.archive=(0,a.default)((0,a.default)({},te.default.archive),{},{classic:t}))}},t.restoreBlocklist=function(){return(0,h.getTable)().all().then((e=>{_.BlocklistCollection.initializeFromCache(e.map(ie.hydrateWids))}))},t.restoreCarts=function(){return(0,m.getTable)().all().then((e=>{y.CartCollection.initializeFromCache(e.map(ie.hydrateWids))}))},t.restoreChatsAndMessages=function(){return pe.apply(this,arguments)},t.restoreFavoriteStickers=function(){if((0,l.isMDBackend)()&&(0,u.getABPropConfigValue)("sticker_md_favorite_stickers_enabled"))return(0,M.getTable)().all().then((e=>O.default.initializeFromCache(e)));return Promise.resolve()},t.restoreGroupParticipants=function(){const e=N.default.filter((e=>0===e.participants.length)).map((e=>e.id.toString()));if(0!==e.length)return(0,H.getTable)().bulkGet(e).then((e=>{e.forEach((e=>{if(null==e)return Promise.resolve();const t=N.default.get(e.groupId);if(null!=t){const n=new Set(e.admins),r=e.participants.map((e=>new V.default({id:(0,d.createUserWid)(e),isAdmin:n.has(e),isSuperAdmin:!1})));t.participants.add(r,{merge:!0})}}))}));return Promise.resolve()},t.restoreGroupsContactsAndProfilePics=function(){return(0,k.initializeWithoutGKs)().then((()=>{performance.now();const e=(0,b.getTable)().all().then((e=>{C.ContactCollection.checksum=(0,F.getContactChecksum)()||"",C.ContactCollection.add(e.map(ie.hydrateWids),{silent:!0,merge:!0})})),t=(0,L.getTable)().all().then((e=>{N.default.add(e.map(ie.hydrateWids)),e.forEach((e=>{(0,q.updateSubject)((0,d.createWidFromWidLike)(e.id),e.subject),(0,D.updatePendingParticipants)((0,d.createWidFromWidLike)(e.id))}))})),n=(0,$.getTable)().all().then((e=>{z.ProfilePicThumbCollection.add(e.map(ie.hydrateWids),{silent:!0})}));return Promise.all([e,t,n])})).then((()=>{}))},t.restoreImportantMetaData=function(){__LOG__(2)`[InitFromStorage] will attempt to initialize metadata from storage`,T.Conn.trigger("me_ready");const e=(0,I.getPushname)(),t=(0,I.getLastMobilePlatform)();if(null==t)throw new Error("platform not found in UserPrefs.");T.Conn.pushname=e,T.Conn.platform=t,__LOG__(2)`[InitFromStorage] important metadata loaded`},t.restoreLabelAssociations=function(){if((0,R.canDisplayLabel)())return(0,G.getTable)().all().then((e=>{x.LabelCollection.initializeAssociationsFromCache(e)}));return Promise.resolve()},t.restoreLabels=function(){if((0,R.canDisplayLabel)())return(0,U.getTable)().all().then((e=>{x.LabelCollection.initializeFromCache(e)}));return Promise.resolve()},t.restoreQuickReplies=function(){if((0,R.canSendQuickReply)())return(0,J.getTable)().all().then((e=>{Q.QuickReplyCollection.initializeFromCache(e)}));return Promise.resolve()},t.restoreRecentStickers=function(){if((0,l.isMDBackend)()&&ee.ServerProps.webServerStickerPanel)return(0,X.getTable)().all().then((e=>Z.RecentStickerCollectionMd.initializeFromCache(e)));return Promise.resolve()},t.updateGKFeatures=function(){(0,l.isMDBackend)()&&((0,F.setGKProto)(w.GK.proto),(0,F.setGKFeatures)(w.GK.features))};var i=r(n(48926)),a=r(n(81109)),o=n(27870),s=n(92844),l=n(88555),c=r(n(65212)),d=n(45454),u=n(57849),p=n(11785),f=n(72894),h=n(89426),_=n(32826),g=n(93170),m=n(44786),y=n(12392),E=n(68638),S=n(69951),v=n(51612),T=n(17239),b=n(4233),C=n(19380),A=n(12669),P=n(1973),M=n(51722),O=r(n(70723)),I=n(99234),w=n(7293),R=n(57701),D=n(62415),L=n(64632),N=r(n(63928)),k=n(23356),U=n(94337),G=n(82663),x=n(16770),B=n(90981),F=n(50313),j=n(59871),Y=n(58052),K=n(29731),W=n(97480),H=n(96826),V=r(n(45077)),$=n(96189),z=n(82039),q=n(10790),J=n(73821),Q=n(99662),X=n(29953),Z=n(49264),ee=n(64551),te=r(n(68132)),ne=n(12896),re=n(134),ie=n(64448),ae=n(85808);n(79038);function oe(e){return null!=e.t&&(0,s.happenedWithin)((0,s.castToUnixTime)(e.t),s.DAY_SECONDS)||null!=e.pin&&e.pin>0}function se(e){return Promise.all(e.map((e=>{const t=oe(e);return(0,ne.getKeyMsgsFromChatHistory)(e,t).then((n=>{let{anchor:r,previewMsg:i,lastReceivedKey:o}=n;return{chat:(0,a.default)((0,a.default)({},e),{},{unreadMsgAnchorId:t?r:void 0}),previewMsg:i,lastReceivedKey:o}}))})))}function le(e){const{tasks:t,lastMessageKeys:n}=function(e){const t=[],n=[];return e.forEach((e=>{let{chat:r,previewMsg:i,lastReceivedKey:o}=e;oe(r)||i&&i.id!==o?(performance.now(),t.push(function(e,t){if(oe(e)){if(e.unreadCount>=20)return ce(e,t).then((()=>function(e){if(!e.unreadMsgAnchorId)return __LOG__(3)`unreadMsgAnchorId is not defined`,Promise.resolve();return(0,B.getTable)().equals(["id"],e.unreadMsgAnchorId).then((t=>{if(0===t.length)return void __LOG__(3)`Unread anchor message does not exist in message table`;const n=(0,ne.getInChatMsgId)(t[0].internalId||""),r=Math.max(0,n-5);let i;if((0,R.receiveReactionsEnabled)()){const t=function(e,t){const n=(0,ne.beginningOfChat)((0,d.createWid)(e.id)),r=(0,ne.craftInternalId)(e.id,t);return(0,ne.queryChatVisibleMessageHelper)(n,r,(0,a.default)((0,a.default)({},{lowerInclusive:!0,upperInclusive:!1}),{},{reverse:!0}),5).then((e=>e.reverse()))}(e,n),r=function(e,t){return(0,ne.queryChatVisibleMessageHelper)((0,ne.craftInternalId)(e.id,t),(0,ne.endOfChat)((0,d.createWid)(e.id)),{lowerInclusive:!0,upperInclusive:!1},5)}(e,n);i=Promise.all([t,r]).then((e=>{let[t,n]=e;return[...t,...n]}))}else i=(0,ne.queryChatMessageHelper)((0,ne.craftInternalId)(e.id,r),(0,ne.craftInternalId)(e.id,n+5),{lowerInclusive:!0,upperInclusive:!1});return i.then((t=>{if(t.length-5<0)return;const n=t[t.length-5].id,r=t.map((e=>{const t=(0,ne.hydrateMessage)(e);return t.invis=!0,t}));return j.MsgCollection.processMultipleMessages((0,d.createWidFromWidLike)(e.id),r,{pendingMsgsDone:!0,resume:!1,add:"unread",isHistory:!0,firstUnreadKey:c.default.fromString(n)},new v.ChatMsgsCollection)})).then()}))}(e)));if(0===e.unreadCount)return ce(e,t);let n;if(__LOG__(2)`restoreMessagesForChat: restoring last ${e.unreadCount+5} messages.`,(0,R.receiveReactionsEnabled)()){const r=[];t&&(0,ne.isReactionFutureproof)(t)&&r.push(t.id.toString()),n=(0,ne.queryChatVisibleMessageHelper)(`${e.id}_/`,`${e.id}_g`,{reverse:!0},e.unreadCount+5,r)}else n=(0,ne.queryChatMessageHelper)(`${e.id}_/`,`${e.id}_g`,{reverse:!0,limit:e.unreadCount+5});return n.then((t=>j.MsgCollection.processMultipleMessages((0,d.createWidFromWidLike)(e.id),t.map(ne.hydrateMessage).reverse(),{pendingMsgsDone:!0,resume:!1,add:"last",isHistory:!0}))).then()}return ce(e,t)}(r,i).then((()=>{if(r.unreadMsgAnchorId){const e=c.default.fromString(r.unreadMsgAnchorId),t=j.MsgCollection.get(e);if(!t)return void __LOG__(3)`Unread anchor message is not in message collection.`;const n=S.ChatCollection.get((0,d.createWidFromWidLike)(r.id));n&&(n.unreadMsgAnchor=t)}})))):n.push(String(o))})),{tasks:t,lastMessageKeys:n}}(e);return t.push(function(e){return performance.now(),(0,B.getTable)().bulkGet(e).then(function(){var e=(0,i.default)((function*(e){yield Promise.all(e.map((e=>{if(!e)return Promise.resolve();const t=(0,ne.hydrateMessage)(e);return t.invis=!0,j.MsgCollection.processMultipleMessages(t.id.remote,[t],{pendingMsgsDone:!1,resume:!1,add:"last",isHistory:!0})})))}));return function(){return e.apply(this,arguments)}}()).catch((e=>{throw __LOG__(4,void 0,new Error)`loadLastMessagesFromDB: failed with error: ${e}`,e}))}(n)),Promise.all(t)}function ce(){return de.apply(this,arguments)}function de(){return(de=(0,i.default)((function*(e,t){let n;const r=[];if(null!=t&&null!=t.internalId){const i=t.internalId;(0,R.receiveReactionsEnabled)()?(t&&(0,ne.isReactionFutureproof)(t)&&r.push(t.id.toString()),n=yield(0,ne.queryChatVisibleMessageHelper)(i,`${e.id}_g`,{lowerInclusive:!0},void 0,r)):n=yield(0,ne.queryChatMessageHelper)(i,`${e.id}_g`,{lowerInclusive:!0})}else{const t=1;n=(0,R.receiveReactionsEnabled)()?yield(0,ne.queryChatVisibleMessageHelper)(`${e.id}_/`,`${e.id}_g`,{reverse:!0},t):yield(0,ne.queryChatMessageHelper)(`${e.id}_/`,`${e.id}_g`,{reverse:!0,limit:t})}__LOG__(2)`processPreviewMessageInChat: restoring ${n.length} message.`,j.MsgCollection.processMultipleMessages((0,d.createWidFromWidLike)(e.id),n.map((e=>{const t=(0,ne.hydrateMessage)(e);return t.invis=!0,t})),{pendingMsgsDone:!1,resume:!1,add:"last",isHistory:!0})}))).apply(this,arguments)}function ue(e){switch(e){case"unknown":return g.VERIFIED_LEVEL.UNKNOWN;case"low":return g.VERIFIED_LEVEL.LOW;case"high":return g.VERIFIED_LEVEL.HIGH;default:return g.VERIFIED_LEVEL.UNKNOWN}}function pe(){return(pe=(0,i.default)((function*(){return yield A.DbEncKeyStore.waitForFinalDbMsgEncKey(),(0,k.initializeWithoutGKs)().then(re.updatePeerReceipts).then((0,i.default)((function*(){const e=yield(0,E.getTable)().all();(0,l.isMDBackend)()&&W.OfflineResumeReporter.logOfflineChatThreadCount(e.length),e.sort(((e,t)=>{var n,r;return-((null!==(n=e.t)&&void 0!==n?n:0)-(null!==(r=t.t)&&void 0!==r?r:0))})),S.ChatCollection.add(e.map((e=>(0,ie.hydrateWids)((0,a.default)((0,a.default)({},e),{},{pendingInitialLoading:!0})))),{merge:!0});const t=(0,u.getABPropConfigValue)("web_init_chat_batch_size")||100;return yield fe(e,t)}))).then(he).catch((e=>{throw __LOG__(4,void 0,new Error)`restoreChatsAndMessages: failed with error: ${e}`,e}))}))).apply(this,arguments)}function fe(e,t){let n=Promise.resolve();const r=new o.PromiseQueue;for(let a=0;a<e.length;a+=t){const o=e.slice(a,a+t),s=function(){var e=(0,i.default)((function*(){performance.now();const e=yield se(o);yield le(e),e.forEach((e=>{let{chat:t}=e;const n=S.ChatCollection.get(t.id);n&&n.set({pendingInitialLoading:!1})}))}));return function(){return e.apply(this,arguments)}}();0===a?n=r.enqueue((()=>new K.NonPersistJob("initialChatLoad",s,{priority:P.JOB_PRIORITY.SKIP}).waitUntilCompleted())):r.enqueue((()=>new K.NonPersistJob("initialChatLoad",s).waitUntilCompleted()))}return n}function he(){return _e.apply(this,arguments)}function _e(){return(_e=(0,i.default)((function*(){(yield(0,ae.getTable)().all()).forEach((e=>{let t;try{t=(0,d.createUserWid)(e.id)}catch(e){return __LOG__(4,void 0,new Error,!0)`restore-business-info: invalid wid`,void SEND_LOGS("restore-business-info: invalid wid")}const n=S.ChatCollection.get(t);if(n){const t={isBusiness:!0,isEnterprise:e.isApi,verifiedName:e.name,verifiedLevel:ue(e.level||"unknown"),privacyMode:e.privacyMode};n.contact.set(t),"high"===e.level&&e.name&&!n.contact.name&&n.contact.set({name:e.name})}}))}))).apply(this,arguments)}function ge(){return(ge=(0,i.default)((function*(){if((0,R.isMultiDeviceAgentsEnabled)()){const e=yield(0,p.getTable)().all();f.AgentCollection.initializeFromCache(e)}}))).apply(this,arguments)}},406:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.abpropsConfigCreateTable=function(){return(0,r.getStorage)().versions.version(19)},t.activeMessageRangesCreateTable=function(){return(0,r.getStorage)().versions.version(23)},t.addActionToPendingMutations=function(){return(0,r.getStorage)().versions.version(48)},t.addArchiveAtMentionViewedInDrawer=function(){return(0,r.getStorage)().versions.version(61)},t.addChatThreadLoggingTable=function(){return(0,r.getStorage)().versions.version(78)},t.addGroupFromKeyToGroupInviteV4=function(){return(0,r.getStorage)().versions.version(55)},t.addHasAccessedToAbpropsConfigTable=function(){return(0,r.getStorage)().versions.version(77)},t.addReactionTableMsgKeyIndex=function(){return(0,r.getStorage)().versions.version(75)},t.addReactionTableOrphanIndex=function(){return(0,r.getStorage)().versions.version(71)},t.addRequiresDirectConnection=function(){return(0,r.getStorage)().versions.version(63)},t.addStaticURLToImageVideoMessages=function(){return(0,r.getStorage)().versions.version(60)},t.addStatusPSACampaignFields=function(){return(0,r.getStorage)().versions.version(65)},t.addSupportForHSMButtons=function(){return(0,r.getStorage)().versions.version(46)},t.addTcTokenSenderTimestampToChatTable=function(){return(0,r.getStorage)().versions.version(62)},t.addTcTokenTimestampToChatTable=function(){return(0,r.getStorage)().versions.version(57)},t.addTcTokenToChatTable=function(){return(0,r.getStorage)().versions.version(56)},t.addUnreadMentionCountToChatTable=function(){return(0,r.getStorage)().versions.version(51)},t.addUnreadMentionToChatTable=function(){return(0,r.getStorage)().versions.version(44)},t.addWaveformToAudioMessages=function(){return(0,r.getStorage)().versions.version(50)},t.agentCreateTable=function(){return(0,r.getStorage)().versions.version(82)},t.blocklistCreateTable=function(){return(0,r.getStorage)().versions.version(4)},t.cartCreateTable=function(){return(0,r.getStorage)().versions.version(25)},t.chatAddDisappearingModeInitiator=function(){return(0,r.getStorage)().versions.version(36)},t.chatCreateTable=function(){return(0,r.getStorage)().versions.version(6)},t.collectionVersionCreateTable=function(){return(0,r.getStorage)().versions.version(1)},t.contactAddDisappearingModeProperties=function(){return(0,r.getStorage)().versions.version(35)},t.contactAddIsContactSyncCompleted=function(){return(0,r.getStorage)().versions.version(28)},t.contactCreateTable=function(){return(0,r.getStorage)().versions.version(3)},t.deviceListAddDelete=function(){return(0,r.getStorage)().versions.version(41)},t.deviceListAddV2Fields=function(){return(0,r.getStorage)().versions.version(59)},t.deviceListCreateTable=function(){return(0,r.getStorage)().versions.version(11)},t.directConnectionKeysCreateTable=function(){return(0,r.getStorage)().versions.version(70)},t.encryptHistorySyncDirectPath=function(){return(0,r.getStorage)().versions.version(42)},t.encryptHistorySyncFilehash=function(){return(0,r.getStorage)().versions.version(45)},t.encryptedMutationsCreateTable=function(){return(0,r.getStorage)().versions.version(15)},t.favoriteStickersCreateTable=function(){return(0,r.getStorage)().versions.version(73)},t.ftsIndexingQueueCreateTable=function(){return(0,r.getStorage)().versions.version(24)},t.groupInviteV4CreateTable=function(){return(0,r.getStorage)().versions.version(39)},t.groupMetadataCreateTable=function(){return(0,r.getStorage)().versions.version(20)},t.historySyncNotificationsCreateTable=function(){return(0,r.getStorage)().versions.version(14)},t.inactiveReceiptCreateTable=function(){return(0,r.getStorage)().versions.version(12)},t.labelAssociationCreateTable=function(){return(0,r.getStorage)().versions.version(17)},t.labelCreateTable=function(){return(0,r.getStorage)().versions.version(16)},t.messageAddActionLink=function(){return(0,r.getStorage)().versions.version(72)},t.messageAddDisappearingModeInitiator=function(){return(0,r.getStorage)().versions.version(37)},t.messageAddGroupInviteV4=function(){return(0,r.getStorage)().versions.version(38)},t.messageAddHeaderType=function(){return(0,r.getStorage)().versions.version(74)},t.messageAddInteractiveMessageFields=function(){return(0,r.getStorage)().versions.version(69)},t.messageAddIsSendFailureProperties=function(){return(0,r.getStorage)().versions.version(27)},t.messageAddNativeFlowNameField=function(){return(0,r.getStorage)().versions.version(54)},t.messageAddPaymentBackground=function(){return(0,r.getStorage)().versions.version(68)},t.messageAddPaymentInviteServiceType=function(){return(0,r.getStorage)().versions.version(64)},t.messageAddPaymentRequestNFMFields=function(){return(0,r.getStorage)().versions.version(49)},t.messageAddPaymentTxnStatus=function(){return(0,r.getStorage)().versions.version(29)},t.messageAddPrivacyModeFields=function(){return(0,r.getStorage)().versions.version(32)},t.messageAddProductListPreviewHeaderImage=function(){return(0,r.getStorage)().versions.version(34)},t.messageAddProductListPreviewInfo=function(){return(0,r.getStorage)().versions.version(30)},t.messageCreateTable=function(){return(0,r.getStorage)().versions.version(7)},t.messageInfoAddDeliveryPrivacyMode=function(){return(0,r.getStorage)().versions.version(33)},t.messageInfoCreateTable=function(){return(0,r.getStorage)().versions.version(8)},t.messageRemovePaymentRequestHeaderField=function(){return(0,r.getStorage)().versions.version(52)},t.messageStatusPSAReadTimestamp=function(){return(0,r.getStorage)().versions.version(76)},t.migrateSubgroupsArray=function(){return(0,r.getStorage)().versions.version(80)},t.missingKeysCreateTable=function(){return(0,r.getStorage)().versions.version(26)},t.orphanPaymentNotificationCreateTable=function(){return(0,r.getStorage)().versions.version(40)},t.orphanReceiptCreateTable=function(){return(0,r.getStorage)().versions.version(10)},t.orphanRevokeCreateTable=function(){return(0,r.getStorage)().versions.version(47)},t.participantCreateTable=function(){return(0,r.getStorage)().versions.version(9)},t.paymentBackgroundsCreateTable=function(){return(0,r.getStorage)().versions.version(79)},t.peerMessageCreateTable=function(){return(0,r.getStorage)().versions.version(43)},t.pendingMutationsCreateTable=function(){return(0,r.getStorage)().versions.version(0)},t.privacyDisallowedListAddDhashField=function(){return(0,r.getStorage)().versions.version(67)},t.privacyDisallowedListCreateTable=function(){return(0,r.getStorage)().versions.version(58)},t.profilePicThumbCreateTable=function(){return(0,r.getStorage)().versions.version(5)},t.quickReplyCreateTable=function(){return(0,r.getStorage)().versions.version(18)},t.reactionsCreateTable=function(){return(0,r.getStorage)().versions.version(66)},t.recentStickersCreateTable=function(){return(0,r.getStorage)().versions.version(53)},t.syncActionsCreateTable=function(){return(0,r.getStorage)().versions.version(2)},t.syncKeysCreateTable=function(){return(0,r.getStorage)().versions.version(21)},t.tasksScheduledTimeCreateTable=function(){return(0,r.getStorage)().versions.version(22)},t.unjoinedSubgroupMetadataCreateTable=function(){return(0,r.getStorage)().versions.version(81)},t.verifiedBusinessNameAddPrivacyMode=function(){return(0,r.getStorage)().versions.version(31)},t.verifiedBusinessNameCreateTable=function(){return(0,r.getStorage)().versions.version(13)};var r=n(99069)},97153:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addUserToPendingDeviceSync=function(e){if((0,a.isMDBackend)())return(0,s.getTable)().bulkCreateOrMerge(e.map((e=>({id:e}))));return Promise.resolve()},t.doPendingDeviceSync=function(){return l.apply(this,arguments)};var i=r(n(48926)),a=n(88555),o=n(45454),s=n(12071);function l(){return(l=(0,i.default)((function*(){if((0,a.isMDBackend)())try{const e=yield(0,s.getTable)().all(),t=n(10823).syncDeviceListJob;yield t(e.map((e=>(0,o.createWid)(e.id))),null,null),yield(0,s.getTable)().bulkRemove(e.map((e=>e.id)))}catch(e){__LOG__(4,!0,new Error)`doPendingDeviceSync failed during RESUME_WITH_OPEN_TAB`}yield Promise.resolve()}))).apply(this,arguments)}},85417:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.destroy=function(){return(0,c.destroyStorage)().catch((()=>d.resolve(new i.default(c.DATABASE_NAME).delete()))).finally((()=>{u=null}))},t.initialize=function(){null==u&&((0,c.createStorage)(),(0,l.addTable)(),(0,a.addTable)(),(0,o.addTable)(),(0,s.addTable)(),u=(0,c.getStorage)().initialize().catch((e=>{throw __LOG__(4,!0,new Error,!0)`Assertion failed!`,SEND_LOGS("Failed to initialize offd storage"),e})));return u};var i=r(n(86128)),a=n(93771),o=n(78956),s=n(12071),l=n(33235),c=n(43950);const d=n(74121).Z;let u},93771:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,o.getStorage)().add("dangling-receipt").version((0,o.getStorage)().versions.version(1),[new a.default("id"),new i.default("receipts")]).view((e=>({id:e.id,receipts:e.receipts})))},t.getTable=function(){return(0,o.getStorage)().table("dangling-receipt")};var i=r(n(79051)),a=r(n(81674)),o=n(43950)},78956:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,o.getStorage)().add("peer-read-receipt").version((0,o.getStorage)().versions.version(2),[new a.default("id"),new i.default("msgKeys"),new i.default("ts"),new i.default("ack")]).view((e=>({id:e.id,ts:e.ts,msgKeys:e.msgKeys,ack:e.ack})))},t.getTable=function(){return(0,o.getStorage)().table("peer-read-receipt")};var i=r(n(79051)),a=r(n(81674)),o=n(43950)},12071:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,i.getStorage)().add("pending-device-sync").version((0,i.getStorage)().versions.version(4),[new a.default("id")]).view((e=>({id:e.id})))},t.getTable=function(){return(0,i.getStorage)().table("pending-device-sync")};var i=n(43950),a=r(n(89362))},33235:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,a.getStorage)().add("read-receipt").version((0,a.getStorage)().versions.version(0),[new o.default("id"),new i.default("externalIds")]).delete((0,a.getStorage)().versions.version(3)).view((e=>({id:e.id,externalIds:e.externalIds})))},t.getTable=function(){return(0,a.getStorage)().table("read-receipt")};var i=r(n(79051)),a=n(43950),o=r(n(89362))},43950:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.DATABASE_NAME=void 0,t.createStorage=function(){const e=new o.default(c);d=new s.Storage(e),d.addErrorHandler(i.default.AbortError,(e=>{e.message.includes("QuotaExceededError")&&l.StorageCmd.trigger("storage_not_enough_space")}))},t.destroyStorage=function(){if(null==d)return Promise.reject(new Error("[offd-storage] Storage should be created first before being destroyed"));return d.purge().then((()=>{d=null})).catch((e=>{throw d=null,e}))},t.getStorage=function(){return(0,a.default)(null!=d,"[offd-storage] Storage should be created first before being accessed"),d};var i=r(n(86128)),a=r(n(41143)),o=r(n(98883)),s=n(37521),l=n(23283);const c="offd-storage";t.DATABASE_NAME=c;let d=null},134:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.updatePeerReceipts=function(){return _.apply(this,arguments)};var i=r(n(81109)),a=r(n(48926)),o=n(52230),s=n(35470),l=n(88555),c=r(n(65212)),d=n(41566),u=n(90981),p=n(54676),f=n(78956),h=n(99069);function _(){return(_=(0,a.default)((function*(){if((0,l.isMDBackend)()){const e=yield(0,f.getTable)().all(),t=[],n=[];e.forEach((e=>{e.ack===s.ACK.READ?t.push(e):e.ack===s.ACK.PLAYED?n.push(e):__LOG__(3)`updatePeerReceipts: unknown ack type: ${e.ack}`}));const{chatUpdates:r,ackUpdates:a}=yield g(t),o=new Map(a.map((e=>[e.id,e])));y(n).forEach((e=>{const t=o.get(e.id);null==t?o.set(e.id,e):o.set(e.id,(0,i.default)((0,i.default)({},t),{},{ack:e.ack}))}));const l=Array.from(o.values());return yield(0,h.getStorage)().lock(["message","chat"],(e=>{let[t,n]=e;return Promise.all([t.bulkCreateOrMerge(l),n.bulkCreateOrMerge(r)])})),(0,f.getTable)().clear()}return Promise.resolve()}))).apply(this,arguments)}function g(){return m.apply(this,arguments)}function m(){return(m=(0,a.default)((function*(e){const t=[],n=[],r=new Map,i=new Set;e.forEach((e=>{e.msgKeys.forEach((e=>{const t=c.default.fromString(e).remote.toString();t!==o.STATUS_JID&&(r.set(t,{unreadCount:0,lastUnreadMsgRowId:void 0,unreadMentionsOfMe:[],unreadMentionCount:0}),i.add(e))}))}));const a=Array.from(r.keys()),l=yield(0,u.getTable)().anyOf(["from","pendingReadReceipt"],a.map((e=>[e,1])),{shouldDecrypt:!1});return l.forEach((e=>{const t=r.get(e.from),{rowId:n,id:a}=e;null!=t&&null!=n&&i.has(a)&&(null==t.lastUnreadMsgRowId||n>t.lastUnreadMsgRowId)&&(t.lastUnreadMsgRowId=n)})),l.forEach((e=>{const n=r.get(e.from),{rowId:i}=e;if(null!=n&&null!=i&&null!=n.lastUnreadMsgRowId)if(i<=n.lastUnreadMsgRowId)t.push({id:e.id,ack:s.ACK.READ,pendingReadReceipt:null});else if(n.unreadCount+=1,(0,d.isGroupCatchUpEnabled)()&&(0,p.isImportantMessage)(e)){const t={id:e.id,timestamp:e.t};n.unreadMentionsOfMe.push(t)}})),a.forEach((e=>{const t=r.get(e);null!=t&&null!=t.lastUnreadMsgRowId&&n.push({id:e,unreadCount:t.unreadCount,unreadMentionsOfMe:t.unreadMentionsOfMe})})),{chatUpdates:n,ackUpdates:t}}))).apply(this,arguments)}function y(e){const t=new Set;return e.forEach((e=>{e.ack===s.ACK.PLAYED&&e.msgKeys.forEach((e=>t.add(e)))})),Array.from(t).map((e=>({id:e,ack:s.ACK.PLAYED,pendingReadReceipt:null})))}},63719:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.add=function(e){d=d.concat(e.map(p)),u()},t.deleteRange=E,t.getFromBottom=_,t.rowCount=m;var i=r(n(48926)),a=r(n(23493)),o=n(94398),s=n(30433),l=n(94398);const c=1e5;let d=[];const u=(0,a.default)((()=>T()),200);function p(e){return{marker_id:e.marker_id,method:e.method,action_id:e.action_id,duration_ns:e.duration_ns,marker_type:e.marker_type,sample_rate:e.sample_rate,points:e.points,instance_id:e.instance_id,metadata:e.metadata||{application_analytics:{time_since_qpl_module_init:0}},flags:e.flags,annotations_bool_array:e.annotations_bool_array,annotations_bool:e.annotations_bool,annotations_double_array:e.annotations_double_array,annotations_double:e.annotations_double,annotations_int_array:e.annotations_int_array,annotations_int:e.annotations_int,annotations_string_array:e.annotations_string_array,annotations:e.annotations}}function f(){return h.apply(this,arguments)}function h(){return(h=(0,i.default)((function*(){try{yield(0,o.initialize)()}catch(e){throw __LOG__(4,!0,new Error,!0)`QPL Storage, error calling initializeQplStorage, error ${e}`,SEND_LOGS("QPL Storage init error"),e}}))).apply(this,arguments)}function _(){return g.apply(this,arguments)}function g(){return(g=(0,i.default)((function*(e){return yield f(),(0,l.getQplEventsTable)().all({limit:e,offset:0})}))).apply(this,arguments)}function m(){return y.apply(this,arguments)}function y(){return(y=(0,i.default)((function*(){return yield f(),(0,l.getQplEventsTable)().count()}))).apply(this,arguments)}function E(){return S.apply(this,arguments)}function S(){return(S=(0,i.default)((function*(e,t){return yield f(),(0,l.getQplEventsTable)().bulkDeleteRange(["id"],e-1,t+1).then((()=>{}))}))).apply(this,arguments)}let v=null;function T(){return b.apply(this,arguments)}function b(){return(b=(0,i.default)((function*(){if(yield f(),v)v.then(T);else if(d.length>0){const e=d;d=[];try{const t=yield m();if(t+e.length>c){(0,s.maxStorageEventCountReached)();const n=t+e.length-c;yield C(n)}}catch(e){return __LOG__(4,!0,new Error,!0)`QPL Storage, error during checking for excessive events ${e}`,void SEND_LOGS("QPL Storage, error saving events")}v=(0,l.getQplEventsTable)().bulkCreate(e).then((()=>{v=null})).catch((e=>{__LOG__(4,!0,new Error,!0)`QPL Storage, error saving events ${e}`,SEND_LOGS("QPL Storage, error saving events"),v=null}))}}))).apply(this,arguments)}function C(){return A.apply(this,arguments)}function A(){return(A=(0,i.default)((function*(e){const t=yield _(e),n=t[0].id||0,r=t[t.length-1].id||0;yield E(n,r)}))).apply(this,arguments)}},94398:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.destroy=function(){return(0,o.destroyStorage)().catch((()=>s.resolve(new i.default(o.DATABASE_NAME).delete()))).finally((()=>{l=null}))},Object.defineProperty(t,"getQplEventsTable",{enumerable:!0,get:function(){return a.getTable}}),t.initialize=function(){null==l&&((0,o.createStorage)(),(0,a.addTable)(),l=(0,o.getStorage)().initialize().catch((e=>{throw __LOG__(4,!0,new Error,!0)`Assertion failed!`,SEND_LOGS("Failed to initialize qpl storage"),e})));return l};var i=r(n(86128)),a=n(4882),o=n(96367);const s=n(74121).Z;let l},4882:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,o.getStorage)().add("qpl-events").version((0,s.qplEventsCreateTable)(),[new a.default("id"),new i.default("marker_id"),new i.default("instance_id"),new i.default("action_id"),new i.default("sample_rate"),new i.default("method"),new i.default("duration_ns"),new i.default("points"),new i.default("metadata"),new i.default("marker_type"),new i.default("flags"),new i.default("annotations"),new i.default("annotations_double"),new i.default("annotations_int"),new i.default("annotations_bool"),new i.default("annotations_string_array"),new i.default("annotations_double_array"),new i.default("annotations_int_array"),new i.default("annotations_bool_array")]).view((e=>e))},t.getTable=function(){return(0,o.getStorage)().table("qpl-events")};var i=r(n(79051)),a=r(n(81674)),o=n(96367),s=n(51542)},96367:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.DATABASE_NAME=void 0,t.createStorage=function(){const e=new o.default(c);d=new s.Storage(e),d.addErrorHandler(i.default.AbortError,(e=>{e.message.includes("QuotaExceededError")&&l.StorageCmd.trigger("storage_not_enough_space")}))},t.destroyStorage=function(){if(null==d)return Promise.reject(new Error("[qpl-storage] Storage should be created first before being destroyed"));return d.purge().then((()=>{d=null})).catch((e=>{throw d=null,e}))},t.getStorage=function(){return(0,a.default)(null!=d,"[qpl-storage] Storage should be created first before being accessed"),d};var i=r(n(86128)),a=r(n(41143)),o=r(n(98883)),s=n(37521),l=n(23283);const c="qpl-storage";t.DATABASE_NAME=c;let d=null},51542:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.qplEventsCreateTable=function(){return(0,r.getStorage)().versions.version(0)};var r=n(96367)},318:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.destroy=function(){return(0,p.destroyStorage)().catch((()=>f.resolve(new i.default(p.DATABASE_NAME).delete()))).finally((()=>{h=null}))},Object.defineProperty(t,"getBaseKeyTable",{enumerable:!0,get:function(){return a.getTable}}),Object.defineProperty(t,"getIdentityTable",{enumerable:!0,get:function(){return o.getTable}}),Object.defineProperty(t,"getMetaTable",{enumerable:!0,get:function(){return s.getTable}}),Object.defineProperty(t,"getPreKeyTable",{enumerable:!0,get:function(){return l.getTable}}),Object.defineProperty(t,"getSenderKeyTable",{enumerable:!0,get:function(){return c.getTable}}),Object.defineProperty(t,"getSessionTable",{enumerable:!0,get:function(){return d.getTable}}),Object.defineProperty(t,"getSignedPreKeyTable",{enumerable:!0,get:function(){return u.getTable}}),t.initialize=function(){null==h&&((0,p.createStorage)(),(0,a.addTable)(),(0,o.addTable)(),(0,s.addTable)(),(0,l.addTable)(),(0,c.addTable)(),(0,d.addTable)(),(0,u.addTable)(),h=(0,p.getStorage)().initialize().catch((e=>{throw __LOG__(4,!0,new Error,!0)`Assertion failed!`,SEND_LOGS("Failed to initialize signal storage"),e})));return h};var i=r(n(86128)),a=n(50930),o=n(35523),s=n(80919),l=n(64415),c=n(6259),d=n(1777),u=n(45726),p=n(77246);const f=n(74121).Z;let h},50930:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,s.getStorage)().add("baseKey-store").version((0,l.baseKeyCreateTable)(),[new o.default("id"),new i.default("address"),new i.default("originalMsgId"),new i.default("baseKey"),new a.default(["address","originalMsgId"])]).view((e=>({id:e.id,address:e.address,originalMsgId:e.originalMsgId,baseKey:e.baseKey})))},t.getTable=function(){return(0,s.getStorage)().table("baseKey-store")};var i=r(n(79051)),a=r(n(34654)),o=r(n(81674)),s=n(77246),l=n(12126)},35523:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,a.getStorage)().add("identity-store").version((0,s.identityCreateTable)(),[new o.default("identifier"),new i.default("identityKey"),new i.default("rowId")]).view((e=>({identifier:e.identifier,identityKey:e.identityKey,rowId:e.rowId})))},t.getTable=function(){return(0,a.getStorage)().table("identity-store")};var i=r(n(79051)),a=n(77246),o=r(n(89362)),s=n(12126)},80919:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,a.getStorage)().add("signal-meta-store").version((0,s.metaCreateTable)(),[new o.default("key"),new i.default("value")]).view((e=>({key:e.key,value:e.value})))},t.getTable=function(){return(0,a.getStorage)().table("signal-meta-store")};var i=r(n(79051)),a=n(77246),o=r(n(89362)),s=n(12126)},64415:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,o.getStorage)().add("prekey-store").version((0,s.preKeyCreateTable)(),[new a.default("keyId"),new i.default("keyPair"),new i.default("isDirectDistribution")]).view((e=>({keyId:e.keyId,keyPair:e.keyPair,isDirectDistribution:e.isDirectDistribution})))},t.getTable=function(){return(0,o.getStorage)().table("prekey-store")};var i=r(n(79051)),a=r(n(81674)),o=n(77246),s=n(12126)},6259:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,o.getStorage)().add("senderkey-store").version((0,l.senderKeyCreateTable)(),[new s.default("senderKeyName"),new i.default("senderKey"),new i.default("senderId"),new a.default("senderId")]).view((e=>({senderKeyName:e.senderKeyName,senderKey:e.senderKey,senderId:e.senderId})))},t.getTable=function(){return(0,o.getStorage)().table("senderkey-store")};var i=r(n(79051)),a=r(n(19570)),o=n(77246),s=r(n(89362)),l=n(12126)},1777:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,a.getStorage)().add("session-store").version((0,s.sessionCreateTable)(),[new o.default("address"),new i.default("session")]).view((e=>({address:e.address,session:e.session})))},t.getTable=function(){return(0,a.getStorage)().table("session-store")};var i=r(n(79051)),a=n(77246),o=r(n(89362)),s=n(12126)},45726:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,o.getStorage)().add("signed-prekey-store").version((0,s.signedPreKeyCreateTable)(),[new a.default("keyId"),new i.default("keyPair"),new i.default("signature")]).view((e=>({keyId:e.keyId,keyPair:e.keyPair,signature:e.signature})))},t.getTable=function(){return(0,o.getStorage)().table("signed-prekey-store")};var i=r(n(79051)),a=r(n(81674)),o=n(77246),s=n(12126)},77246:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.DATABASE_NAME=void 0,t.createStorage=function(){const e=new o.default(c);d=new s.Storage(e),d.addErrorHandler(i.default.AbortError,(e=>{e.message.includes("QuotaExceededError")&&l.StorageCmd.trigger("storage_not_enough_space")}))},t.destroyStorage=function(){if(null==d)return Promise.reject(new Error("[signal-storage] Storage should be created first before being destroyed"));return d.purge().then((()=>{d=null})).catch((e=>{throw d=null,e}))},t.getStorage=function(){return(0,a.default)(null!=d,"[signal-storage] Storage should be created first before being accessed"),d};var i=r(n(86128)),a=r(n(41143)),o=r(n(98883)),s=n(37521),l=n(23283);const c="signal-storage";t.DATABASE_NAME=c;let d=null},12126:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.baseKeyCreateTable=function(){return(0,r.getStorage)().versions.version(5)},t.identityCreateTable=function(){return(0,r.getStorage)().versions.version(0)},t.metaCreateTable=function(){return(0,r.getStorage)().versions.version(1)},t.preKeyCreateTable=function(){return(0,r.getStorage)().versions.version(2)},t.senderKeyCreateTable=function(){return(0,r.getStorage)().versions.version(6)},t.sessionCreateTable=function(){return(0,r.getStorage)().versions.version(3)},t.signedPreKeyCreateTable=function(){return(0,r.getStorage)().versions.version(4)};var r=n(77246)},12669:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ENC_KEY_TTL=t.ENC_KEY_TABLE_NAME=t.ENC_KEY_DB_NAME=t.DbEncKeyStore=t.DB_ENCRYPTION_CIPHER=void 0;var i=r(n(81109)),a=r(n(48926)),o=n(15688),s=n(88156),l=n(92844),c=r(n(86128)),d=r(n(41143)),u=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=p(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(35232));function p(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(p=function(e){return e?n:t})(e)}const f=n(74121).Z,h="wawc_db_enc";t.ENC_KEY_DB_NAME=h;const _="keys";t.ENC_KEY_TABLE_NAME=_;const g={name:"HKDF"},m={hash:"SHA-256"},y=4*l.WEEK_MILLISECONDS*24;t.ENC_KEY_TTL=y;const E="fts_hmac_keys",S="AES-CBC";t.DB_ENCRYPTION_CIPHER=S;function v(){const e=new Uint8Array(128);return self.crypto.getRandomValues(e),self.crypto.subtle.importKey("raw",e,g,!1,["deriveKey"])}const T=new class{constructor(){var e=this;this._waitUntilFinalDbEncKeyReady=new s.Resolvable,this._waitUntilEncKeyReady=new s.Resolvable,this._waitUntilFinalFtsHmacKeyReady=new s.Resolvable,this._getOrUpdateEncKeys=e=>this._getDbOrThrow().keys.orderBy("id").toArray().then((t=>{if(!t||0===t.length)return this._addNewEncKey(e);const n=t[t.length-1]._expiration;if(null!=n&&n<=(new Date).getTime())return this._addNewEncKey(e);this._ephemeralLocalEncSalt=e;const r=t.map(function(){var t=(0,a.default)((function*(t){const n=yield self.crypto.subtle.deriveKey((0,i.default)((0,i.default)((0,i.default)({},g),m),{},{salt:e,info:new Uint8Array(1)}),t.key,{name:S,length:128},!1,["encrypt","decrypt"]);return(0,i.default)((0,i.default)({},t),{},{key:n})}));return function(){return t.apply(this,arguments)}}());return Promise.all(r).then((e=>{this._keys=e,this._waitUntilEncKeyReady.resolve()}))})),this._getOrUpdateFtsKey=()=>this._getDbOrThrow().fts_hmac_keys.orderBy("id").toArray().then((e=>{if(!e||0===e.length)return this._addNewFtsHMACKey();if(e.length>1)throw new u.DBInvalidFtsHMACKey;this._ftsHMACKey=e[e.length-1]})),this._addNewEncKey=e=>v().then((t=>this._getDbOrThrow().keys.add({key:t,_expiration:(new Date).getTime()+y}).then((()=>this._getOrUpdateEncKeys(e))))),this._addNewFtsHMACKey=()=>v().then((e=>this._getDbOrThrow().fts_hmac_keys.add({key:e}).then((()=>this._getOrUpdateFtsKey())))),this.generateFinalDbEncryptionAndFtsKey=e=>{if(null!=this._finalDbMsgEncKeys||null==this._ephemeralLocalEncSalt)return Promise.resolve();const t=(0,o.decodeB64)(e);return this._generateFinalFtsHmacKey(t),this._generateFinalDbMsgEncryptionKey(t),Promise.resolve()},this._generateFinalDbMsgEncryptionKey=t=>this._getDbOrThrow().keys.orderBy("id").toArray().then((n=>{const r=n.map(function(){var n=(0,a.default)((function*(n){let r;(0,d.default)(null!=e._ephemeralLocalEncSalt,"local salt is undefined");try{r=yield self.crypto.subtle.deriveKey((0,i.default)((0,i.default)((0,i.default)({},g),m),{},{salt:t,info:new Uint8Array(e._ephemeralLocalEncSalt||0)}),n.key,{name:S,length:128},!1,["encrypt","decrypt"])}catch(t){throw e._ephemeralLocalEncSalt=null,t}return(0,i.default)((0,i.default)({},n),{},{key:r})}));return function(){return n.apply(this,arguments)}}());return Promise.all(r).then((e=>{this._ephemeralLocalEncSalt=null,this._finalDbMsgEncKeys=e,this._waitUntilFinalDbEncKeyReady.resolve()}))})).finally((()=>{this._ephemeralLocalEncSalt=null})),this._generateFinalFtsHmacKey=function(){var t=(0,a.default)((function*(t){if(!e._ftsHMACKey||null==e._ftsHMACKey.key||null==e._ftsHMACKey.id)throw __LOG__(2)`Base ftsHMACKey is null in _generateFinalFtsHmacKey`,new u.DBInvalidFtsHMACKey;const[n,r]=[e._ftsHMACKey.id,e._ftsHMACKey.key],a=yield self.crypto.subtle.deriveKey((0,i.default)((0,i.default)((0,i.default)({},g),m),{},{salt:t,info:new Uint8Array(0)}),r,{name:"HMAC",hash:"SHA-256"},!1,["sign"]);e._finalFtsHmacKey={id:n,key:a},e._waitUntilFinalFtsHmacKeyReady.resolve()}));return function(){return t.apply(this,arguments)}}()}init(e){if(this._db)return f.resolve();this._db=new c.default(h),this._getDbOrThrow().version(1).stores({[_]:"++id, _expirtation",[E]:"++id"}),this._getDbOrThrow().version(2).stores({[_]:"++id",[E]:"++id"});const t=e.buffer.slice(e.byteOffset,e.byteLength+e.byteOffset);return f.resolve(this._getDbOrThrow().open()).then((()=>Promise.all([this._getOrUpdateEncKeys(t),this._getOrUpdateFtsKey()])))}_getDbOrThrow(){if(null==this._db)throw new Error("[db_encryption_key] db is not initialized");return this._db}deleteKeys(){return Promise.all([this._getDbOrThrow().table(_).clear(),this._getDbOrThrow().table(E).clear()]).then((()=>{})).finally((()=>(this._db=null,f.resolve(c.default.delete(h)).catch((()=>c.default.delete(h))))))}deleteKeyCache(){this._keys=null,this._ftsHMACKey=null,this._finalDbMsgEncKeys=null,this._waitUntilFinalDbEncKeyReady=new s.Resolvable,this._waitUntilFinalFtsHmacKeyReady=new s.Resolvable,this._waitUntilEncKeyReady=new s.Resolvable,this._finalFtsHmacKey=null,this._ephemeralLocalEncSalt=null}waitForEncKey(){return this._waitUntilEncKeyReady.promise}waitForFinalDbMsgEncKey(){return this._waitUntilFinalDbEncKeyReady.promise}waitForFinalFtsHmacKey(){return this._waitUntilFinalFtsHmacKeyReady.promise}get encKeys(){if(!this._keys)throw new u.DbEncKeyNotLoaded(_);return this._keys}get dbMsgEncKeys(){if(!this._finalDbMsgEncKeys)throw new u.DbMsgEncKeyNotLoaded(_);return this._finalDbMsgEncKeys}get ftsHMACKey(){if(!this._finalFtsHmacKey)throw new u.DbEncKeyNotLoaded(E);return this._finalFtsHmacKey}};t.DbEncKeyStore=T},44558:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return a.apply(this,arguments)};var i=r(n(48926));function a(){return(a=(0,i.default)((function*(){const e=window.caches;if(null==e)return;const t=yield e.keys();yield Promise.all(t.map((t=>e.delete(t))))}))).apply(this,arguments)}},23283:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.StorageCmdImpl=t.StorageCmd=void 0;var i=r(n(76521));class a extends i.default{}t.StorageCmdImpl=a;const o=new a;t.StorageCmd=o},11554:(e,t,n)=>{"use strict";var r=n(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(40265),a=n(50796),o=n(38284),s=n(5558),l=n(26741),c=r(n(86128)),d=r(n(30381)),u=r(n(11339));const p={ERROR:"error",OPENING:"opening",BLOCKED:"blocked",OPEN:"open",CLOSED:"closed",FAILED:"failed"};let f=!1,h=null;function _(){this._dbName=s.WEB_IDB_DB_NAMES.wawc,this._db=new c.default(this._dbName),this._db.on("versionchange",(e=>{this._db.close(),__LOG__(2)`db: close db due to versionchange`,e&&null!=e.newVersion&&e.newVersion!==e.oldVersion&&(f=!0,h&&h())})),this._db.version(1).stores({logs:"line,log"}),this._db.version(2).stores({logs:"line,log",assets:"key,hash,data"}),this._db.version(3).stores({logs:"line,log",assets:"key,hash,data",wam:",buffer,prevValues,lastSend"}),this._db.version(4).stores({logs:"line,log",assets:"key,hash,data",wam:",key,buffer",l10n:"key,hash,t"}).upgrade((function(e){e.wam.toCollection().modify((function(e){e.key=e.lastSend,delete e.prevValues,delete e.lastSend}))})),this._db.version(5).stores({logs:"line,log",assets:null,wam:",key,buffer",l10n:"key,hash,t"}),this._db.version(6).stores({logs:"line,log,timestamp",wam:",key,buffer",l10n:"key,hash,t"}).upgrade((e=>{e.logs.toCollection().count().then((()=>{e.logs.toCollection().modify((e=>{const{log:t}=e;e.timestamp=1e3*(0,d.default)(t.slice(5,28),"YYYY-MM-DD HH:mm:ss.SSS").unix()}))}))})),this._db.version(7).stores({logs:"line,log,timestamp",wam:",key,buffer",l10n:"key,hash,t",user:"key"}),this._db.version(8).stores({logs:"line,log,timestamp",wam:",key,buffer,channel",l10n:"key,hash,t",user:"key"}).upgrade((e=>{e.wam.toCollection().modify((e=>{e.channel="regular"}))})),this._db.version(9).stores({logs:"line,log,timestamp",wam:",key,buffer,channel",wam_meta:"streamId,seqNum",l10n:"key,hash,t",user:"key"}),this._db.version(10).stores({logs:"line,log,timestamp",wam:",key,buffer,channel",wam_meta:"streamId,seqNum",ps_meta:"key, value, rotateInDays, lastRotationTimeUtc",ps_tokens:"key",l10n:"key,hash,t",user:"key"}),this.openAttempt=0,this.openDB().catch((e=>{__LOG__(3)`openDB failed: ${e}`})),this._dbState=p.OPENING}_.prototype.loadUserIdb=function(){return this.idb().then((e=>e.transaction("rw",e.user,(()=>e.user.toArray().then((e=>e.forEach((e=>{this.permanentStorage.dataStore[e.key]=e.value})))))))).catch((e=>{__LOG__(3)`db:loadUserIdb:Error ${e}`}))},_.prototype.openDB=function(){this._db.isOpen()&&(this._db.close(),__LOG__(2)`db: close db due to duplicate openDB`);const e=(0,o.promiseTimeout)(Promise.resolve(this._db.open()),1e4).then((()=>{__LOG__(2)`db: Successfully opened db`;return new u.default.WebcDbOpen({webcDbName:this._dbName,webcDbOpenWasSuccess:!0,webcDbOpenNumAttempts:this.openAttempt}).commit(),this._dbState=p.OPEN,p.OPEN})).catch((0,a.filteredCatch)(i.TimeoutError,(()=>{__LOG__(2)`db:openDB blocked`;return new u.default.WebcDbOpen({webcDbName:this._dbName,webcDbOpenWasSuccess:!1,webcDbOpenNumAttempts:this.openAttempt}).commit(),this._dbState=p.BLOCKED,p.BLOCKED}))).catch((e=>{if(__LOG__(3)`db:openDB:Error ${e}`,this.openAttempt>1||l.UA.isSafari){this.opening=void 0,this._dbState=p.ERROR;throw new u.default.WebcDbOpen({webcDbName:this._dbName,webcDbOpenWasSuccess:!1,webcDbOpenNumAttempts:this.openAttempt}).commit(),p.ERROR}return this.openAttempt+=1,this._db.delete().catch((e=>{throw __LOG__(3)`db:deleteDB:Error ${e}`,this.opening=void 0,this._dbState=p.ERROR,p.ERROR})).then((()=>this.openDB()))})).then((e=>{if(this.opening=void 0,e===p.BLOCKED)throw p.BLOCKED;return this._db}));return this.opening||(this.opening=e),e},_.prototype.idb=function(){return this._db.isOpen()?Promise.resolve(this._db):this._db.hasFailed()?(__LOG__(3)`Dexie: database failed to open, hasClosed ${this._db.hasBeenClosed()}`,Promise.reject(new Error(p.FAILED))):this._dbState===p.BLOCKED?(__LOG__(3)`Dexie: database is blocked`,Promise.reject(new Error(p.BLOCKED))):this.opening?this.opening:(__LOG__(3)`Dexie: database is closed`,Promise.reject(new Error(p.CLOSED)))},_.prototype.onVersionChange=function(e){h=e,f&&h()},_.prototype.State=p;var g=new _;t.default=g},64045:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let{error:t}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(null!=t)return t;return new Error(e)}},57538:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=Object.freeze({BACKSPACE:8,TAB:9,RETURN:13,SHIFT:16,CTRL:17,ALT:18,PAUSE_BREAK:19,CAPS_LOCK:20,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,ZERO:48,ONE:49,TWO:50,THREE:51,FOUR:52,FIVE:53,SIX:54,SEVEN:55,EIGHT:56,NINE:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,LEFT_WINDOW_KEY:91,RIGHT_WINDOW_KEY:92,SELECT_KEY:93,NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,MULTIPLY:106,ADD:107,SUBTRACT:109,DECIMAL_POINT:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUM_LOCK:144,SCROLL_LOCK:145,SEMI_COLON:186,EQUAL_SIGN:187,COMMA:188,DASH:189,PERIOD:190,FORWARD_SLASH:191,GRAVE_ACCENT:192,OPEN_BRACKET:219,BACK_SLASH:220,CLOSE_BRAKET:221,SINGLE_QUOTE:222});t.default=n},15206:(e,t,n)=>{"use strict";var r=n(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t={};for(const[n,r]of(0,i.default)(e))null!=r&&(t[n]=r);return t};var i=r(n(89916))},89916:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return Object.entries(e)}},66919:(e,t,n)=>{"use strict";var r=n(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t={};if(!(e instanceof Object)||Array.isArray(e))throw(0,i.default)("keyMirror(...): Argument must be an object.","comet_infra");for(const n in e)e.hasOwnProperty(n)&&(t[n]=n);return t};var i=r(n(64045))},57291:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=[];for(const n of e)null!=n&&t.push(n);return t}},29347:(e,t,n)=>{e.exports=n.p+"img/bg-chat-tile-dark_a4be512e7195b6b733d9110b408f075d.png"},33557:(e,t,n)=>{e.exports=n.p+"img/bg-chat-tile-light_04fcacde539c58cca6745483d4858c52.png"},31213:(e,t,n)=>{e.exports=n.p+"img/f00_50f7c47f611e65a746f1d8328172af4c.png"},8750:(e,t,n)=>{e.exports=n.p+"img/f01_3d1e81d38917ed4427168024350d8df6.png"},48738:(e,t,n)=>{e.exports=n.p+"img/f02_c83a3786caa656cdcea06396bbc6c1fc.png"},15494:(e,t,n)=>{e.exports=n.p+"img/f03_dc76f32180586199d7e1872dd004832c.png"},15885:(e,t,n)=>{e.exports=n.p+"img/f04_f13406e16c2b6a8dda89763cf005b02b.png"},5851:(e,t,n)=>{e.exports=n.p+"img/f05_566b33dfb23660bf5fa83125a9dd8218.png"},68540:(e,t,n)=>{e.exports=n.p+"img/f06_f564cba48589a560af4b6e8408ae1718.png"},30293:(e,t,n)=>{e.exports=n.p+"img/f07_ae76e3caeb9dde2ad18eab0ce141d223.png"},91131:(e,t,n)=>{e.exports=n.p+"img/f08_59c98baa006f5eac6629be0957fd73f2.png"},27879:(e,t,n)=>{e.exports=n.p+"img/f09_1a7f295d0fa98fa1d2a63f8dc4600341.png"},8610:(e,t,n)=>{e.exports=n.p+"img/f10_53c9084de35f9f003ed395e1d120d9b6.png"},32641:(e,t,n)=>{e.exports=n.p+"img/f11_c129c05bc58cad686e0934357d6194fb.png"},98479:(e,t,n)=>{e.exports=n.p+"img/f12_bf90fa5257d34005ad5b75ffebb9b74c.png"},25670:(e,t,n)=>{e.exports=n.p+"img/f13_156bc51d4150b9b257fa4e2e774ce985.png"},759:(e,t,n)=>{e.exports=n.p+"img/f14_95fa7d926a8cf1638985d3cd551fac31.png"},52264:(e,t,n)=>{e.exports=n.p+"img/f15_454f1add82fcb11fbb4086c8be3b1bd9.png"},86035:(e,t,n)=>{e.exports=n.p+"img/f16_9ca6324f98317f9d73084696719d2b9b.png"},94878:(e,t,n)=>{e.exports=n.p+"img/f17_9376c16fcd9b554de8a081973bebe9aa.png"},67514:(e,t,n)=>{e.exports=n.p+"img/f18_cc883fb28c32b1652826de5dc16feee0.png"},23533:(e,t,n)=>{e.exports=n.p+"img/f19_c448ba8ef94abcf763e25003aa15d27d.png"},86319:(e,t,n)=>{e.exports=n.p+"img/f20_4ebcff229b29e651b73640d0cd8eccb2.png"},65664:(e,t,n)=>{e.exports=n.p+"img/f21_54d02a1f6ad665760923ecfae9c9ff25.png"},10191:(e,t,n)=>{e.exports=n.p+"img/f22_ca38cbb571fbddb6900518455b8a20b9.png"},48850:(e,t,n)=>{e.exports=n.p+"img/f23_851a6d2ec552319ddaac7ff8ff37263e.png"},92553:(e,t,n)=>{e.exports=n.p+"img/f24_7806bc8ea69d9441ff27032fbaf52907.png"},53453:(e,t,n)=>{e.exports=n.p+"img/f25_68d927d9d12aef33387b683be6341340.png"},78691:(e,t,n)=>{e.exports=n.p+"img/f26_eb28a47950f61dc80827a74063d8786a.png"},17430:(e,t,n)=>{e.exports=n.p+"img/f27_d53f3b6cf583d7a41f3434d18fe4456e.png"},40610:(e,t,n)=>{e.exports=n.p+"img/f28_245f3d8d8dae33bdc04373918922c5a8.png"},78643:(e,t,n)=>{e.exports=n.p+"img/f29_31c6170329c4cf5808fe773488b5d143.png"},73434:(e,t,n)=>{e.exports=n.p+"img/f30_105e340803065abb74841ce2fff42b4b.png"},54981:(e,t,n)=>{e.exports=n.p+"img/f31_db46b1350eb553583212866aa44e2ac0.png"},86488:(e,t,n)=>{e.exports=n.p+"img/f32_4c358e4136bab81e06b7fd7171a7908c.png"},28881:(e,t,n)=>{e.exports=n.p+"img/f33_5a8f246313db052d67853a40f77a6427.png"},71199:(e,t,n)=>{e.exports=n.p+"img/f34_8588016a836bc826824d0656c8b7b0bc.png"},97836:(e,t,n)=>{e.exports=n.p+"img/f35_8aefe3b46c378109f0f780b6954e18db.png"},77985:(e,t,n)=>{e.exports=n.p+"img/f36_793fc72fadaf963507fc6802a9470970.png"},73570:(e,t,n)=>{e.exports=n.p+"img/f37_8d8f6653cbe1f6dd3783174a8af618da.png"},42949:(e,t,n)=>{e.exports=n.p+"img/f38_54b8f37e9f1251bfe9a2a2ef88a31912.png"},21404:(e,t,n)=>{e.exports=n.p+"img/f39_23a6e90aa9166a2fb981cc171abe8513.png"},21792:(e,t,n)=>{e.exports=n.p+"img/f40_923f39f07df4b8ad006e1115dcb206ec.png"},86197:(e,t,n)=>{e.exports=n.p+"img/f41_87448793e4bcea7fae3cfa7532e45033.png"},79685:(e,t,n)=>{e.exports=n.p+"img/f42_cd0e42183cff2e75bdde0c139bbb641a.png"},39346:(e,t,n)=>{e.exports=n.p+"img/f43_9f44150edcf010967cf272c80bd4ff14.png"},89128:(e,t,n)=>{e.exports=n.p+"img/f44_7f5d4a3e29f21bd5d5572a1543448949.png"},86904:(e,t,n)=>{e.exports=n.p+"img/f45_04c55805346c4afbc7f8084570a2cd48.png"},86906:(e,t,n)=>{e.exports=n.p+"img/f46_1e9f9b05193093b5d0d80d9c936bcb36.png"},63265:(e,t,n)=>{e.exports=n.p+"img/f47_152a85c5e9ff12d5f85050ecad1d4313.png"},7029:(e,t,n)=>{e.exports=n.p+"img/f48_bd6d89500662b8605997f54027b2e650.png"},39871:(e,t,n)=>{e.exports=n.p+"img/f49_42185158c0bfff92c70f417c74297ce7.png"},58360:(e,t,n)=>{e.exports=n.p+"img/f50_d825d156222c0d93428f4ecd78564c75.png"},35277:(e,t,n)=>{e.exports=n.p+"img/f51_51e116016636d309962001419e70d5f1.png"},63418:(e,t,n)=>{e.exports=n.p+"img/f52_5296e30be9bec98ccf173a9be6e711a9.png"},58235:(e,t,n)=>{e.exports=n.p+"img/f53_f81b7a3702779e190aeefb7e2183e636.png"},132:(e,t,n)=>{e.exports=n.p+"img/f54_37b3eb612da7ad6c0b20b65e4fdae582.png"},33417:(e,t,n)=>{e.exports=n.p+"img/f55_0c3d912e971e18d6fe8946550262d0e6.png"},50407:(e,t,n)=>{e.exports=n.p+"img/f56_97a65c1c44dced234e0fbb5f78cb277f.png"},29423:(e,t,n)=>{e.exports=n.p+"img/f57_88b41898da1ce86274ee318e1713f437.png"},32176:(e,t,n)=>{e.exports=n.p+"img/f58_56649fe103006ec4fc5bdea5c69f7828.png"},50874:(e,t,n)=>{e.exports=n.p+"img/f59_1dd065a271b58e1ecb9bb3b6c261107f.png"},21578:(e,t,n)=>{e.exports=n.p+"img/f60_4b277b056575663ee9dbf81fecce989e.png"},22129:(e,t,n)=>{e.exports=n.p+"img/f61_ef3fba8c7e6d895afacfb334e7a746ff.png"},33819:(e,t,n)=>{e.exports=n.p+"img/f62_edecb61bfd5cd13895dd8134898d4402.png"},97359:(e,t,n)=>{e.exports=n.p+"img/f63_245e85a3728d5fed6ff9acf1182f4797.png"},39887:(e,t,n)=>{e.exports=n.p+"img/f64_48df8c352924ef1153bb8fd56f5af198.png"},38275:(e,t,n)=>{e.exports=n.p+"img/f65_162b82a8adaf7d2815129f38f265bfb6.png"},71673:(e,t,n)=>{e.exports=n.p+"img/f66_c626c592461087351ad719fa3118959d.png"},21264:(e,t,n)=>{e.exports=n.p+"img/f67_daa263ddff773a14e3ababc4b485a7c9.png"},96007:(e,t,n)=>{e.exports=n.p+"img/f68_ec21f5c8c90ec3bbf634290d6e6025c0.png"},59163:(e,t,n)=>{e.exports=n.p+"img/f69_549a880f1517135abf8914b4cb31fa92.png"},91732:(e,t,n)=>{e.exports=n.p+"img/f70_a69c6599124e3c33d7fac368b07c0249.png"},3913:(e,t,n)=>{e.exports=n.p+"img/f71_4aceb1dc5eaeb5f9cdddf4975e45a841.png"},92293:(e,t,n)=>{e.exports=n.p+"img/f72_f4ed6835609bf3831a20437e8e47d2dc.png"},51577:(e,t,n)=>{e.exports=n.p+"img/f73_94b8b5d2760e6afd967fd74a008cfae0.png"},26347:(e,t,n)=>{e.exports=n.p+"img/f74_2cd31cfe47f05fabb12f9b9f76fc2b6b.png"},70345:(e,t,n)=>{e.exports=n.p+"img/f75_25366bc618fe77d5dfd9db90133f2766.png"},60318:(e,t,n)=>{e.exports=n.p+"img/f76_1347ad29de86f3d0ceb3bf329b06a0a7.png"},86426:(e,t,n)=>{e.exports=n.p+"img/f77_6749eab5d350640476c8ec39ebc3e4db.png"},62002:(e,t,n)=>{e.exports=n.p+"img/f78_9effc679939e4458adafae48294a5db5.png"},49889:(e,t,n)=>{e.exports=n.p+"img/f79_36df3d2cd225fa6b3a6c84c69b72bed1.png"},24324:(e,t,n)=>{e.exports=n.p+"img/f80_f94a52bb981c25a9f8643a55d023be59.png"},59354:(e,t,n)=>{e.exports=n.p+"img/f81_fb74d3d4cc5a27e62e93586c7d09e47e.png"},74992:(e,t,n)=>{e.exports=n.p+"img/f82_2741f2d09772f3e9e836f2c50fb0bf99.png"},80502:(e,t,n)=>{e.exports=n.p+"img/f83_f8586167f3fde3b1e0c7dbb479e5c0ab.png"},74260:(e,t,n)=>{e.exports=n.p+"img/f84_f5b79393aa7e2979b376c76f46d39b52.png"},64108:(e,t,n)=>{e.exports=n.p+"img/f85_7ea40f8452fb838a747fb0881ffd5980.png"},71042:(e,t,n)=>{e.exports=n.p+"img/f86_486fdf332fda50c1cd7c4b9bd8a3f993.png"},95563:(e,t,n)=>{e.exports=n.p+"img/f87_91e88bfc16e4baddaf2fc4f881c3efc5.png"},64594:(e,t,n)=>{e.exports=n.p+"img/f88_286401f05def8a122db7f4686e383691.png"},68005:(e,t,n)=>{e.exports=n.p+"img/f89_658f39d559719b5b6208346f6a7753b9.png"},16888:(e,t,n)=>{e.exports=n.p+"img/f90_d5612bad79e603d92135c3bbfbcd14d1.png"},52943:(e,t,n)=>{e.exports=n.p+"img/f91_58bb429f953c740a98bcab0c032e8e25.png"},24613:(e,t,n)=>{e.exports=n.p+"img/f92_970e0969177b051897bdd55bf12ee3ae.png"},94922:(e,t,n)=>{e.exports=n.p+"img/f93_4776ec98a5d48ae85b24621ad1eac6eb.png"},18725:(e,t,n)=>{e.exports=n.p+"img/f94_296c4ae16a836cf0903cc5ef0476333c.png"},82950:(e,t,n)=>{e.exports=n.p+"img/f95_888ec2f78b312aed756a8d7008dc979b.png"},7251:(e,t,n)=>{e.exports=n.p+"img/f96_5b97286be655dbd4f5aa79f5f008c5ce.png"},17978:(e,t,n)=>{e.exports=n.p+"img/f97_b4ff99d92592c44b5d8a5b501fc24da6.png"},86273:(e,t,n)=>{e.exports=n.p+"img/f98_0922d228059acde80cc489a2879fe864.png"},31666:(e,t,n)=>{e.exports=n.p+"img/f99_c608e2edac2f741a5a39b814ba36c287.png"},10331:(e,t,n)=>{e.exports=n.p+"img/favicon-error_ac2b4ac0b3a8a9d2256d517e69a3e272.png"},72174:(e,t,n)=>{e.exports=n.p+"img/favicon-error2_fb2afa4bfd23495c7bd2555bb080bb35.png"},68431:(e,t,n)=>{e.exports=n.p+"img/favicon_c5088e888c97ad440a61d247596f88e5.png"},95203:(e,t,n)=>{e.exports=n.p+"img/f00_81a748c30861e19178cb90ab8b31c9e4.png"},66574:(e,t,n)=>{e.exports=n.p+"img/f01_78cd893586564a736b94f919cd2851f7.png"},19833:(e,t,n)=>{e.exports=n.p+"img/f02_4bfcfe058a11109e81b7e9cbdfdeb02a.png"},39974:(e,t,n)=>{e.exports=n.p+"img/f03_577fd59324f5db48af17efcba0a23ea5.png"},86727:(e,t,n)=>{e.exports=n.p+"img/f04_841c20c722f90620ba13762ae73f6143.png"},78808:(e,t,n)=>{e.exports=n.p+"img/f05_c1bde74d642126370c5da5fb0de680c6.png"},71258:(e,t,n)=>{e.exports=n.p+"img/f06_eb85be6945aa4a51c3e05d97ecb1c290.png"},64497:(e,t,n)=>{e.exports=n.p+"img/f07_4d1031e781a9619d0579571eb2049ee6.png"},66114:(e,t,n)=>{e.exports=n.p+"img/f08_4d61c3d691066fa829ad43af1d6063ca.png"},12430:(e,t,n)=>{e.exports=n.p+"img/f09_f9d4e1b3266f81e8952251520de80711.png"},29809:(e,t,n)=>{e.exports=n.p+"img/f10_1f2eeb1340d4c4b4d423117d47d5f56e.png"},41191:(e,t,n)=>{e.exports=n.p+"img/f11_699424412fed1628d27e04957a284d2e.png"},87642:(e,t,n)=>{e.exports=n.p+"img/f12_ef4dd9b4bc88503d33fde312a57af7f9.png"},26841:(e,t,n)=>{e.exports=n.p+"img/f13_0bf1895a611a2187f9758ac305e87d2e.png"},7967:(e,t,n)=>{e.exports=n.p+"img/f14_df2ad83835b022116ce26f030de1a13d.png"},38817:(e,t,n)=>{e.exports=n.p+"img/f15_cffc8769d0c2ef7f8f8d5fc16e339cab.png"},65587:(e,t,n)=>{e.exports=n.p+"img/f16_8b958a65cb9dbf5c7716f1c865391473.png"},38297:(e,t,n)=>{e.exports=n.p+"img/f17_83147bc30e9d1cfe9ae417bf4afc2f77.png"},61665:(e,t,n)=>{e.exports=n.p+"img/f18_9595be739a769411763ad68c24cb245f.png"},16962:(e,t,n)=>{e.exports=n.p+"img/f19_2b465cf764fb53292292e003e070268a.png"},42387:(e,t,n)=>{e.exports=n.p+"img/f20_a781e4e7a5b4d97c226843b0f2d1472d.png"},74420:(e,t,n)=>{e.exports=n.p+"img/f21_b03a1e45532edd017ebbda6b8e2566bb.png"},84319:(e,t,n)=>{e.exports=n.p+"img/f22_809ee1be83cf9aba76ecde6bf3e65e58.png"},43302:(e,t,n)=>{e.exports=n.p+"img/f23_e2c0fa78795ee79b68fdbdca50a960ae.png"},34444:(e,t,n)=>{e.exports=n.p+"img/f24_3832927a08d4eec1867a7d7c4ba2fcd7.png"},14231:(e,t,n)=>{e.exports=n.p+"img/f25_0ade03b46b6e8819de9523bc8ff6a7cd.png"},15842:(e,t,n)=>{e.exports=n.p+"img/f26_e38c0e2c62dae55d9cdf26d8c22b6b9d.png"},25925:(e,t,n)=>{e.exports=n.p+"img/f27_b4871a7570313a9f599b1911f339413d.png"},10149:(e,t,n)=>{e.exports=n.p+"img/f28_1b3971aa7b75218570c3d9940aa4a73d.png"},90154:(e,t,n)=>{e.exports=n.p+"img/f29_f2c7a605126e29e8885601cdc65e6aa0.png"},701:(e,t,n)=>{e.exports=n.p+"img/f30_712d71bfb048818a771a9d144b40d9aa.png"},27707:(e,t,n)=>{e.exports=n.p+"img/f31_1d19e90516ce464192bd7016d05a2dba.png"},95169:(e,t,n)=>{e.exports=n.p+"img/f32_9a70dc1de944f622b350752076a6310d.png"},77763:(e,t,n)=>{e.exports=n.p+"img/f33_1f3382e82a8abe7cdce46f789f7c4ede.png"},98593:(e,t,n)=>{e.exports=n.p+"img/f34_29dc69ea8e91117dae46fcf7e7f58417.png"},16569:(e,t,n)=>{e.exports=n.p+"img/f35_fa478612d2487e2fead293b7005566ea.png"},35807:(e,t,n)=>{e.exports=n.p+"img/f36_bb827e69f0979553e18c0fd1cb192b02.png"},82439:(e,t,n)=>{e.exports=n.p+"img/f37_b06f5850d2c8eda0c51ad5491779af6c.png"},41360:(e,t,n)=>{e.exports=n.p+"img/f38_0b370e976457b876910c4a638ac302e2.png"},93127:(e,t,n)=>{e.exports=n.p+"img/f39_a09d7dfecc70b04ec35edc2967c60a30.png"},62369:(e,t,n)=>{e.exports=n.p+"img/f40_ed134cdcd59bb430218f2be2cdd20aa1.png"},55876:(e,t,n)=>{e.exports=n.p+"img/f41_a785dbfd120b89c2e8616357b9722163.png"},31990:(e,t,n)=>{e.exports=n.p+"img/f42_4149402ff16c6de0b1b06eff01619455.png"},36009:(e,t,n)=>{e.exports=n.p+"img/f43_d543d1bc6a09014ac24d7189b0ced761.png"},24580:(e,t,n)=>{e.exports=n.p+"img/f44_9ffa8beb4bd1c21f328fdd822cba19a7.png"},61400:(e,t,n)=>{e.exports=n.p+"img/f45_0c3cea68945b437380dacd15cbe90ded.png"},78354:(e,t,n)=>{e.exports=n.p+"img/f46_58320ab4676a6287d9dec0790f0d88fc.png"},27020:(e,t,n)=>{e.exports=n.p+"img/f47_5f2ac6f7a9fe79dc3d9a701872c0d0f8.png"},27961:(e,t,n)=>{e.exports=n.p+"img/f48_5fdbdf26d5c581f2a84ebfa50355bd2d.png"},8725:(e,t,n)=>{e.exports=n.p+"img/f49_7bd9cdf5a225ef778b0abd7c9b5310ba.png"},25129:(e,t,n)=>{e.exports=n.p+"img/f50_f4b49b8b3eb729c1fd7c991958aa67b7.png"},33690:(e,t,n)=>{e.exports=n.p+"img/f51_cccd95bad4c9b8e03d05f634e91d2cc8.png"},15722:(e,t,n)=>{e.exports=n.p+"img/f52_8cc8a9757166f53c59a5a1c5e2ebeb00.png"},94416:(e,t,n)=>{e.exports=n.p+"img/f53_623900497390a42269ea6c7ffd812ecc.png"},59965:(e,t,n)=>{e.exports=n.p+"img/f54_c114021c7945464df273df92403987cb.png"},97937:(e,t,n)=>{e.exports=n.p+"img/f55_bcfef9ad8bf26d250613af9b04c918cf.png"},91425:(e,t,n)=>{e.exports=n.p+"img/f56_76dd317a660aa4927e72484ef9d903fb.png"},40564:(e,t,n)=>{e.exports=n.p+"img/f57_72ed0f17ab92bb06761245cb5a7fd73b.png"},35705:(e,t,n)=>{e.exports=n.p+"img/f58_8b9aa917870bcfabc296989c8a810446.png"},1474:(e,t,n)=>{e.exports=n.p+"img/f59_1a64de23c9ec094314b18a18108319ce.png"},5285:(e,t,n)=>{e.exports=n.p+"img/f60_4926d3e8b53f38a3c792cb7b3e07d48d.png"},60792:(e,t,n)=>{e.exports=n.p+"img/f61_08509dff37749613925fe8b16a84ba56.png"},1219:(e,t,n)=>{e.exports=n.p+"img/f62_0869c06452d4ebecdc99f7192ebc702f.png"},66899:(e,t,n)=>{e.exports=n.p+"img/f63_6083f333c2239cba7bbde44e7607a67c.png"},14772:(e,t,n)=>{e.exports=n.p+"img/f64_5d2e1af055fb2cb08326de8e4a844eab.png"},61160:(e,t,n)=>{e.exports=n.p+"img/f65_c863d05c20e4ff179c46170a5311afaf.png"},26671:(e,t,n)=>{e.exports=n.p+"img/f66_1971ad2c6440b2fc909759d8614ef901.png"},18327:(e,t,n)=>{e.exports=n.p+"img/f67_8817a536067dadbc7dc0b1ce0c7cca51.png"},8659:(e,t,n)=>{e.exports=n.p+"img/f68_11393ba2b52ac23a884f923672858aa3.png"},80157:(e,t,n)=>{e.exports=n.p+"img/f69_6a31bf9a0987d546a53d7e8e148d9fa3.png"},14440:(e,t,n)=>{e.exports=n.p+"img/f70_6a12b8c8cf306de335b3174c92c7d63d.png"},90805:(e,t,n)=>{e.exports=n.p+"img/f71_363e1241dbcac22f3bebce9bb5e03e85.png"},39619:(e,t,n)=>{e.exports=n.p+"img/f72_ae6ac1146134ea79656c595a1a2d0e8b.png"},30472:(e,t,n)=>{e.exports=n.p+"img/f73_c9b6d05e598e5adf69ceab85f5db96ac.png"},60325:(e,t,n)=>{e.exports=n.p+"img/f74_67c9ceb4623d37c005ae86e28e4e9fbe.png"},59019:(e,t,n)=>{e.exports=n.p+"img/f75_62cbd93e646a20f624123b595584f2a2.png"},69536:(e,t,n)=>{e.exports=n.p+"img/f76_6862123772ba72af8d1f307c0d2b4895.png"},71717:(e,t,n)=>{e.exports=n.p+"img/f77_78710dcf8b6d89f3951e7887f95408bf.png"},35033:(e,t,n)=>{e.exports=n.p+"img/f78_59e408dc54ae0bd33f3617f7ee9bb2e0.png"},62003:(e,t,n)=>{e.exports=n.p+"img/f79_6682dcc8dd4b1c197e7ec7b9b3deb601.png"},65263:(e,t,n)=>{e.exports=n.p+"img/f80_0d13bdc19570b4c3577062fd0a3a1428.png"},39681:(e,t,n)=>{e.exports=n.p+"img/f81_bfb32e248b9a30d62e32a1f7ea4e7e98.png"},61422:(e,t,n)=>{e.exports=n.p+"img/f82_286f2cdea929dc7b1565aad502aaf165.png"},50966:(e,t,n)=>{e.exports=n.p+"img/f83_4984ad9c5348e8717965f575ac7ea534.png"},60408:(e,t,n)=>{e.exports=n.p+"img/f84_4d4303666006c977553c896dd850fc1b.png"},69738:(e,t,n)=>{e.exports=n.p+"img/f85_10cbc8d1444126f654a032456a74a72c.png"},87724:(e,t,n)=>{e.exports=n.p+"img/f86_03d43f57ad876d0367274524fd27b4ec.png"},93370:(e,t,n)=>{e.exports=n.p+"img/f87_610b9a8f68249032da365af5a664fc41.png"},63963:(e,t,n)=>{e.exports=n.p+"img/f88_5ad6ef9e65165c4bb4c670ce875a5fb5.png"},13976:(e,t,n)=>{e.exports=n.p+"img/f89_e049c6b076ab9212a901406939d7274e.png"},26034:(e,t,n)=>{e.exports=n.p+"img/f90_88c16bdd2fd8228ad1ec89ce3f0cb118.png"},41727:(e,t,n)=>{e.exports=n.p+"img/f91_78d445d5baae7479cac968c11f6724dc.png"},54257:(e,t,n)=>{e.exports=n.p+"img/f92_34f845f9fa2a3667d8d747453f63ad68.png"},61109:(e,t,n)=>{e.exports=n.p+"img/f93_2f324509fe48d002f5a944b003cd180d.png"},2801:(e,t,n)=>{e.exports=n.p+"img/f94_c406ffa6170c14bcbe3158ab7879ce16.png"},11318:(e,t,n)=>{e.exports=n.p+"img/f95_7ce72143c371f981d394ab9b3391f5ea.png"},25889:(e,t,n)=>{e.exports=n.p+"img/f96_bc32095dc9dab040674f58592e10451b.png"},30341:(e,t,n)=>{e.exports=n.p+"img/f97_eedf5849b413d903c4cc72cca6ce0576.png"},51222:(e,t,n)=>{e.exports=n.p+"img/f98_8d47ec83349711222b6d9346049676f1.png"},53279:(e,t,n)=>{e.exports=n.p+"img/f99_d27a48329dde7e88d3d7cd348d745f91.png"},81740:(e,t,n)=>{e.exports=n.p+"img/favicon-error_ef91873fcda4eda22679f675ebf6ed24.png"},5079:(e,t,n)=>{e.exports=n.p+"img/favicon-error2_7ce1b67dbef23e87862b3c12b9b32676.png"},49420:(e,t,n)=>{e.exports=n.p+"img/favicon_94e99ab189284094867d2e1220e42e9f.png"},35729:(e,t,n)=>{e.exports=n.p+"img/intro-connection-dark_0ee01153183b5ebd9b296399cc2104b0.jpg"},74548:(e,t,n)=>{e.exports=n.p+"img/intro-connection-hq-dark_f8cb12a6fc73afaf9d5903b7849bebd6.jpg"},12891:(e,t,n)=>{e.exports=n.p+"img/intro-connection-hq-light_9466a20e6d2921a21ac7ab82419be157.jpg"},5250:(e,t,n)=>{e.exports=n.p+"img/intro-connection-light_c98cc75f2aa905314d74375a975d2cf2.jpg"},7246:(e,t,n)=>{e.exports=n.p+"img/qr-video-hq_c001ebd6ddb0ba5fc7de491dfb556024.png"},17818:(e,t,n)=>{e.exports=n.p+"img/qr-video_0c6ec69b054fdeb31cf3e5e10290fd8e.png"},73727:(e,t,n)=>{e.exports=n.p+"whatsapp-webclient-login-hq_0e0caf2391158ebc09fe32edd1022d03.mp4"},79061:(e,t,n)=>{e.exports=n.p+"whatsapp-webclient-login_c09223f0813e7c3adc16476cba2a5d0d.mp4"},6357:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r={wrapper:"_1ADa8",isQR:"nMnIl",isQr:"nMnIl",draggableHeader:"_2jOS3",isMain:"_3Nsgw"}},85954:(e,t,n)=>{"use strict";n.r(t)},40369:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r={block:"Hbbsz",chevron:"gGn1n",actionText:"_3jR9Y"}},44889:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r={button:"_20C5O",plainWhite:"GObVX",primary:"_2Zdgs",secondary:"_1zOyO",solidWarning:"_3opZY",strongPrimary:"pNwLD",warning:"_1XvHd",itemFocused:"_2yKMT",disabled:"_3fyVm",nowrap:"_1gUOr",simplified:"_1RguK",strong:"SEZ8N"}},97922:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r={noop:"tm2tP"}},8581:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r={noop:"i0jNr"}},23257:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r={"-emoji-picker-width":"388px",emojiPickerWidth:"388px","-reaction-details-width":"375px",reactionDetailsWidth:"375px",container:"o--vV",reactionDetails:"_3HjyJ",reactionSendTray:"B_YVs",right:"wGJyi",picker:"_3nQGi",tooltip:"_3t1CR",items:"_1HnQz",nib:"_2hkxa",inverse:"QLmve",colorPicker:"fe-ue",emoji:"_3IU7z",sticker:"_1166F",inverseVertical:"_24No0",text:"_3h2j_",icons:"_1lPfJ"}},77793:(e,t,n)=>{"use strict";n.r(t)},30769:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r={container:"_1N4rE"}},36037:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r={container:"_209uk"}},24242:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r={wrapper:"_3Xwf5",icon:"_3I5Fs",textWrapper:"_162_t",error:"U_F60",warn:"_2jaWt"}},80648:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r={progress:"_35Zb2"}},71937:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r={video:"_3-soo",container:"_1hsvr",player:"_1WD62",poster:"kqpxs",hidden:"_2XlyB",overlay:"_1E40b",button:"_2wAIt",play:"_11Jja"}},66937:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r={qrWrapper:"_1N3oL",text:"_2WuPw",qr:"_25pwu",headline:"_3-XoE",list:"_2A31C",listItem:"QtrYx",hint:"_3aF8K",toggle:"_2lolS",tip:"_2jR6Q",rememberMeTip:"w2rV5",codeCopy:"_3YgA3",qrcode:"_2UwZ_",codeLogo:"b77wc",idle:"n4LVt",qrButton:"_2znac",qrButtonIcon:"_1pFa_",groupInviteTip:"_3Egqg",icon:"_30yMe"}},98285:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r={"weight-light":"_7qtH8",weightLight:"_7qtH8","weight-normal":"_1lF7t",weightNormal:"_1lF7t","weight-medium":"_3EVTz",weightMedium:"_3EVTz","weight-semibold":"_3VDu5",weightSemibold:"_3VDu5","weight-bold":"_2I4o9",weightBold:"_2I4o9","size-8":"_2Le-W",size8:"_2Le-W","size-9":"_2lMoY",size9:"_2lMoY","size-10":"_3QN-O",size10:"_3QN-O","size-11":"_1uSon",size11:"_1uSon","size-12":"_1MfDb",size12:"_1MfDb","size-13":"_2xTZM",size13:"_2xTZM","size-14":"VWPRY",size14:"VWPRY","size-15":"_3SFxP",size15:"_3SFxP","size-16":"_1FXE6",size16:"_1FXE6","size-17":"_2LoZ-",size17:"_2LoZ-","size-18":"ioBp1",size18:"ioBp1","size-19":"oUgLo",size19:"oUgLo","size-20":"_1ioN3",size20:"_1ioN3","size-22":"Urfuj",size22:"Urfuj","size-24":"_3rp2W",size24:"_3rp2W","size-26":"_1651n",size26:"_1651n","size-28":"_1o3ni",size28:"_1o3ni","size-30":"_3jq2u",size30:"_3jq2u","size-32":"_1Zkh5",size32:"_1Zkh5","size-36":"_2gaDs",size36:"_2gaDs","size-48":"i_P7s",size48:"i_P7s","size-60":"_116zp",size60:"_116zp",title:"_3NUK1",large:"_3WYXy","section-title":"_2MNpf",sectionTitle:"_2MNpf","chat-info-section-title":"x2dsD",chatInfoSectionTitle:"x2dsD","section-title-larger":"_24CNZ",sectionTitleLarger:"_24CNZ",small:"TWzFz",muted:"_3Bg5b","muted-small":"_2gdKz",mutedSmall:"_2gdKz",plain:"_26jM1","popup-title":"wMe6l",popupTitle:"wMe6l","color-accent":"_35orJ",colorAccent:"_35orJ","color-danger":"_2Hpjf",colorDanger:"_2Hpjf","color-dark":"PoW1D",colorDark:"PoW1D","color-primary":"_2cf_G",colorPrimary:"_2cf_G","color-secondary":"AjtLy",colorSecondary:"AjtLy","color-muted":"_2P9Q7",colorMuted:"_2P9Q7","color-success":"_3Vwf8",colorSuccess:"_3Vwf8"}},8762:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r={pending:"_3zTDv"}},83322:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r={mask:"_25anU"}},24326:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r={container:"_1INL_",web:"_1UG2S",containerFixed:"_1iyey",graphic:"_26aja",logo:"_35GDA",dots:"_2pp-n",laptop:"_1JPfm",shimmering:"_1dEQH",shimmer:"_3vobx",initialLoad:"_2FX6G",didYouKnow:"WD35o",logout:"_3iu7m",organizing:"A_WMk",progress:"_30oB1",main:"_2dfCc",secondary:"_2e4Ei",warning:"QgIWN",showWarning:"_3dIM5",dot:"behLh",connecting:"_2VJL-",downloading:"ygjbp"}},79436:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r={background:"_2c_rw",mainWrapper:"_5XBCY",logoutTitle:"_329-Z"}},17152:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r={backdrop:"_2B4d4",popupContainer:"_3ev9-",popup:"_3J6wB",popupBody:"nne8e",popupTitle:"_1bpDE",backdropCover:"_1QH2G",popupContents:"_2Nr6U",popupBox:"_2DOJ8",popupFlex:"_2EOHJ",popupAuto:"_1PdSy",popupControls:"_2i3w0",popupFlexInvite:"_3cUTm",popupFlexUpgrade:"_1jalA",popupTower:"_2ctZG",popupGuide:"_1hMip",popupColumnButtons:"_1Nf9C",popupMultiline:"_37AQP",popupCustomSize:"_2fblo"}},39326:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r={action:"_1WVC6",textTip:"_14jEY",divider:"_1Uvap"}},57525:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r={textTip:"_2Z6v5",divider:"_2Xgjp"}},21338:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r={focusAnimation:"_2BW67",focusAnimationKeyframes:"k4bcw"}},89350:(e,t,n)=>{"use strict";function r(){return new Worker(n.p+"opus.769eb25c1475e18001e2.worker.js")}n.r(t),n.d(t,{default:()=>r})},35474:(e,t,n)=>{"use strict";function r(){return new Worker(n.p+"index.e48fd0fe6f90335c3ff7.worker.js")}n.r(t),n.d(t,{default:()=>r})},91528:(e,t,n)=>{"use strict";function r(){return new Worker(n.p+"milan.df7e9fe0012bf2b673ef.worker.js")}n.r(t),n.d(t,{default:()=>r})},23573:(e,t,n)=>{"use strict";function r(){return new Worker(n.p+"rgba_to_webp.worker.73cf0c075ce7e96424c2.worker.js")}n.r(t),n.d(t,{default:()=>r})},82578:(e,t,n)=>{"use strict";function r(){return new Worker(n.p+"webp_to_rgba.worker.9d8a97deb706cdeba4c9.worker.js")}n.r(t),n.d(t,{default:()=>r})},42329:()=>{}},e=>{"use strict";e.O(0,[1174],(()=>{return t=29821,e(e.s=t);var t}));e.O()}]);
//# sourceMappingURL=https://web.whatsapp.com/bootstrap_qr.8c19f3b9920c01c16ec8.js.map
